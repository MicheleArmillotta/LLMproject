[
  {
    "function_name": "bt_hci_unregister",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hci.c",
    "lines": "572-586",
    "snippet": "bool bt_hci_unregister(struct bt_hci *hci, unsigned int id)\n{\n\tstruct evt *evt;\n\n\tif (!hci || !id)\n\t\treturn false;\n\n\tevt = queue_remove_if(hci->evt_list, match_evt_id, UINT_TO_PTR(id));\n\tif (!evt)\n\t\treturn false;\n\n\tevt_free(evt);\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/hci.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include \"monitor/bt.h\"",
      "#include <sys/uio.h>",
      "#include <sys/socket.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "evt_free",
          "args": [
            "evt"
          ],
          "line": 583
        },
        "resolved": true,
        "details": {
          "function_name": "evt_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hci.c",
          "lines": "100-108",
          "snippet": "static void evt_free(void *data)\n{\n\tstruct evt *evt = data;\n\n\tif (evt->destroy)\n\t\tevt->destroy(evt->user_data);\n\n\tfree(evt);\n}",
          "includes": [
            "#include \"src/shared/hci.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include \"monitor/bt.h\"",
            "#include <sys/uio.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hci.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/mainloop.h\"\n#include \"monitor/bt.h\"\n#include <sys/uio.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void evt_free(void *data)\n{\n\tstruct evt *evt = data;\n\n\tif (evt->destroy)\n\t\tevt->destroy(evt->user_data);\n\n\tfree(evt);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_remove_if",
          "args": [
            "hci->evt_list",
            "match_evt_id",
            "UINT_TO_PTR(id)"
          ],
          "line": 579
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_if",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "278-316",
          "snippet": "void *queue_remove_if(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry, *prev = NULL;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tentry = queue->head;\n\n\twhile (entry) {\n\t\tif (function(entry->data, user_data)) {\n\t\t\tvoid *data;\n\n\t\t\tif (prev)\n\t\t\t\tprev->next = entry->next;\n\t\t\telse\n\t\t\t\tqueue->head = entry->next;\n\n\t\t\tif (!entry->next)\n\t\t\t\tqueue->tail = prev;\n\n\t\t\tdata = entry->data;\n\n\t\t\tfree(entry);\n\t\t\tqueue->entries--;\n\n\t\t\treturn data;\n\t\t} else {\n\t\t\tprev = entry;\n\t\t\tentry = entry->next;\n\t\t}\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid *queue_remove_if(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry, *prev = NULL;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tentry = queue->head;\n\n\twhile (entry) {\n\t\tif (function(entry->data, user_data)) {\n\t\t\tvoid *data;\n\n\t\t\tif (prev)\n\t\t\t\tprev->next = entry->next;\n\t\t\telse\n\t\t\t\tqueue->head = entry->next;\n\n\t\t\tif (!entry->next)\n\t\t\t\tqueue->tail = prev;\n\n\t\t\tdata = entry->data;\n\n\t\t\tfree(entry);\n\t\t\tqueue->entries--;\n\n\t\t\treturn data;\n\t\t} else {\n\t\t\tprev = entry;\n\t\t\tentry = entry->next;\n\t\t}\n\t}\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "UINT_TO_PTR",
          "args": [
            "id"
          ],
          "line": 579
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/hci.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/mainloop.h\"\n#include \"monitor/bt.h\"\n#include <sys/uio.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nbool bt_hci_unregister(struct bt_hci *hci, unsigned int id)\n{\n\tstruct evt *evt;\n\n\tif (!hci || !id)\n\t\treturn false;\n\n\tevt = queue_remove_if(hci->evt_list, match_evt_id, UINT_TO_PTR(id));\n\tif (!evt)\n\t\treturn false;\n\n\tevt_free(evt);\n\n\treturn true;\n}"
  },
  {
    "function_name": "match_evt_id",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hci.c",
    "lines": "564-570",
    "snippet": "static bool match_evt_id(const void *a, const void *b)\n{\n\tconst struct evt *evt = a;\n\tunsigned int id = PTR_TO_UINT(b);\n\n\treturn evt->id == id;\n}",
    "includes": [
      "#include \"src/shared/hci.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include \"monitor/bt.h\"",
      "#include <sys/uio.h>",
      "#include <sys/socket.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "PTR_TO_UINT",
          "args": [
            "b"
          ],
          "line": 567
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/hci.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/mainloop.h\"\n#include \"monitor/bt.h\"\n#include <sys/uio.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic bool match_evt_id(const void *a, const void *b)\n{\n\tconst struct evt *evt = a;\n\tunsigned int id = PTR_TO_UINT(b);\n\n\treturn evt->id == id;\n}"
  },
  {
    "function_name": "bt_hci_register",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hci.c",
    "lines": "535-562",
    "snippet": "unsigned int bt_hci_register(struct bt_hci *hci, uint8_t event,\n\t\t\t\tbt_hci_callback_func_t callback,\n\t\t\t\tvoid *user_data, bt_hci_destroy_func_t destroy)\n{\n\tstruct evt *evt;\n\n\tif (!hci)\n\t\treturn 0;\n\n\tevt = new0(struct evt, 1);\n\tevt->event = event;\n\n\tif (hci->next_evt_id < 1)\n\t\thci->next_evt_id = 1;\n\n\tevt->id = hci->next_evt_id++;\n\n\tevt->callback = callback;\n\tevt->destroy = destroy;\n\tevt->user_data = user_data;\n\n\tif (!queue_push_tail(hci->evt_list, evt)) {\n\t\tfree(evt);\n\t\treturn 0;\n\t}\n\n\treturn evt->id;\n}",
    "includes": [
      "#include \"src/shared/hci.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include \"monitor/bt.h\"",
      "#include <sys/uio.h>",
      "#include <sys/socket.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "evt"
          ],
          "line": 557
        },
        "resolved": true,
        "details": {
          "function_name": "evt_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hci.c",
          "lines": "100-108",
          "snippet": "static void evt_free(void *data)\n{\n\tstruct evt *evt = data;\n\n\tif (evt->destroy)\n\t\tevt->destroy(evt->user_data);\n\n\tfree(evt);\n}",
          "includes": [
            "#include \"src/shared/hci.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include \"monitor/bt.h\"",
            "#include <sys/uio.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hci.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/mainloop.h\"\n#include \"monitor/bt.h\"\n#include <sys/uio.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void evt_free(void *data)\n{\n\tstruct evt *evt = data;\n\n\tif (evt->destroy)\n\t\tevt->destroy(evt->user_data);\n\n\tfree(evt);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_push_tail",
          "args": [
            "hci->evt_list",
            "evt"
          ],
          "line": 556
        },
        "resolved": true,
        "details": {
          "function_name": "queue_push_tail",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "88-108",
          "snippet": "bool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "new0",
          "args": [
            "structevt",
            "1"
          ],
          "line": 544
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/hci.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/mainloop.h\"\n#include \"monitor/bt.h\"\n#include <sys/uio.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nunsigned int bt_hci_register(struct bt_hci *hci, uint8_t event,\n\t\t\t\tbt_hci_callback_func_t callback,\n\t\t\t\tvoid *user_data, bt_hci_destroy_func_t destroy)\n{\n\tstruct evt *evt;\n\n\tif (!hci)\n\t\treturn 0;\n\n\tevt = new0(struct evt, 1);\n\tevt->event = event;\n\n\tif (hci->next_evt_id < 1)\n\t\thci->next_evt_id = 1;\n\n\tevt->id = hci->next_evt_id++;\n\n\tevt->callback = callback;\n\tevt->destroy = destroy;\n\tevt->user_data = user_data;\n\n\tif (!queue_push_tail(hci->evt_list, evt)) {\n\t\tfree(evt);\n\t\treturn 0;\n\t}\n\n\treturn evt->id;\n}"
  },
  {
    "function_name": "bt_hci_flush",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hci.c",
    "lines": "519-533",
    "snippet": "bool bt_hci_flush(struct bt_hci *hci)\n{\n\tif (!hci)\n\t\treturn false;\n\n\tif (hci->writer_active) {\n\t\tio_set_write_handler(hci->io, NULL, NULL, NULL);\n\t\thci->writer_active = false;\n\t}\n\n\tqueue_remove_all(hci->cmd_queue, NULL, NULL, cmd_free);\n\tqueue_remove_all(hci->rsp_queue, NULL, NULL, cmd_free);\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/hci.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include \"monitor/bt.h\"",
      "#include <sys/uio.h>",
      "#include <sys/socket.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_remove_all",
          "args": [
            "hci->rsp_queue",
            "NULL",
            "NULL",
            "cmd_free"
          ],
          "line": 530
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_all",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "318-362",
          "snippet": "unsigned int queue_remove_all(struct queue *queue, queue_match_func_t function,\n\t\t\t\tvoid *user_data, queue_destroy_func_t destroy)\n{\n\tstruct queue_entry *entry;\n\tunsigned int count = 0;\n\n\tif (!queue)\n\t\treturn 0;\n\n\tentry = queue->head;\n\n\tif (function) {\n\t\twhile (entry) {\n\t\t\tvoid *data;\n\t\t\tunsigned int entries = queue->entries;\n\n\t\t\tdata = queue_remove_if(queue, function, user_data);\n\t\t\tif (entries == queue->entries)\n\t\t\t\tbreak;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(data);\n\n\t\t\tcount++;\n\t\t}\n\t} else {\n\t\tqueue->head = NULL;\n\t\tqueue->tail = NULL;\n\t\tqueue->entries = 0;\n\n\t\twhile (entry) {\n\t\t\tstruct queue_entry *tmp = entry;\n\n\t\t\tentry = entry->next;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(tmp->data);\n\n\t\t\tfree(tmp);\n\t\t\tcount++;\n\t\t}\n\t}\n\n\treturn count;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nunsigned int queue_remove_all(struct queue *queue, queue_match_func_t function,\n\t\t\t\tvoid *user_data, queue_destroy_func_t destroy)\n{\n\tstruct queue_entry *entry;\n\tunsigned int count = 0;\n\n\tif (!queue)\n\t\treturn 0;\n\n\tentry = queue->head;\n\n\tif (function) {\n\t\twhile (entry) {\n\t\t\tvoid *data;\n\t\t\tunsigned int entries = queue->entries;\n\n\t\t\tdata = queue_remove_if(queue, function, user_data);\n\t\t\tif (entries == queue->entries)\n\t\t\t\tbreak;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(data);\n\n\t\t\tcount++;\n\t\t}\n\t} else {\n\t\tqueue->head = NULL;\n\t\tqueue->tail = NULL;\n\t\tqueue->entries = 0;\n\n\t\twhile (entry) {\n\t\t\tstruct queue_entry *tmp = entry;\n\n\t\t\tentry = entry->next;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(tmp->data);\n\n\t\t\tfree(tmp);\n\t\t\tcount++;\n\t\t}\n\t}\n\n\treturn count;\n}"
        }
      },
      {
        "call_info": {
          "callee": "io_set_write_handler",
          "args": [
            "hci->io",
            "NULL",
            "NULL",
            "NULL"
          ],
          "line": 525
        },
        "resolved": true,
        "details": {
          "function_name": "io_set_write_handler",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-glib.c",
          "lines": "254-258",
          "snippet": "bool io_set_write_handler(struct io *io, io_callback_func_t callback,\n\t\t\t\tvoid *user_data, io_destroy_func_t destroy)\n{\n\treturn io_set_handler(io, G_IO_OUT, callback, user_data, destroy);\n}",
          "includes": [
            "#include \"src/shared/io.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/io.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nbool io_set_write_handler(struct io *io, io_callback_func_t callback,\n\t\t\t\tvoid *user_data, io_destroy_func_t destroy)\n{\n\treturn io_set_handler(io, G_IO_OUT, callback, user_data, destroy);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/hci.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/mainloop.h\"\n#include \"monitor/bt.h\"\n#include <sys/uio.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nbool bt_hci_flush(struct bt_hci *hci)\n{\n\tif (!hci)\n\t\treturn false;\n\n\tif (hci->writer_active) {\n\t\tio_set_write_handler(hci->io, NULL, NULL, NULL);\n\t\thci->writer_active = false;\n\t}\n\n\tqueue_remove_all(hci->cmd_queue, NULL, NULL, cmd_free);\n\tqueue_remove_all(hci->rsp_queue, NULL, NULL, cmd_free);\n\n\treturn true;\n}"
  },
  {
    "function_name": "bt_hci_cancel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hci.c",
    "lines": "497-517",
    "snippet": "bool bt_hci_cancel(struct bt_hci *hci, unsigned int id)\n{\n\tstruct cmd *cmd;\n\n\tif (!hci || !id)\n\t\treturn false;\n\n\tcmd = queue_remove_if(hci->cmd_queue, match_cmd_id, UINT_TO_PTR(id));\n\tif (!cmd) {\n\t\tcmd = queue_remove_if(hci->rsp_queue, match_cmd_id,\n\t\t\t\t\t\t\tUINT_TO_PTR(id));\n\t\tif (!cmd)\n\t\t\treturn false;\n\t}\n\n\tcmd_free(cmd);\n\n\twakeup_writer(hci);\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/hci.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include \"monitor/bt.h\"",
      "#include <sys/uio.h>",
      "#include <sys/socket.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "wakeup_writer",
          "args": [
            "hci"
          ],
          "line": 514
        },
        "resolved": true,
        "details": {
          "function_name": "wakeup_writer",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hci.c",
          "lines": "158-173",
          "snippet": "static void wakeup_writer(struct bt_hci *hci)\n{\n\tif (hci->writer_active)\n\t\treturn;\n\n\tif (hci->num_cmds < 1)\n\t\treturn;\n\n\tif (queue_isempty(hci->cmd_queue))\n\t\treturn;\n\n\tif (!io_set_write_handler(hci->io, io_write_callback, hci, NULL))\n\t\treturn;\n\n\thci->writer_active = true;\n}",
          "includes": [
            "#include \"src/shared/hci.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include \"monitor/bt.h\"",
            "#include <sys/uio.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hci.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/mainloop.h\"\n#include \"monitor/bt.h\"\n#include <sys/uio.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void wakeup_writer(struct bt_hci *hci)\n{\n\tif (hci->writer_active)\n\t\treturn;\n\n\tif (hci->num_cmds < 1)\n\t\treturn;\n\n\tif (queue_isempty(hci->cmd_queue))\n\t\treturn;\n\n\tif (!io_set_write_handler(hci->io, io_write_callback, hci, NULL))\n\t\treturn;\n\n\thci->writer_active = true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "cmd_free",
          "args": [
            "cmd"
          ],
          "line": 512
        },
        "resolved": true,
        "details": {
          "function_name": "cmd_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hci.c",
          "lines": "89-98",
          "snippet": "static void cmd_free(void *data)\n{\n\tstruct cmd *cmd = data;\n\n\tif (cmd->destroy)\n\t\tcmd->destroy(cmd->user_data);\n\n\tfree(cmd->data);\n\tfree(cmd);\n}",
          "includes": [
            "#include \"src/shared/hci.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include \"monitor/bt.h\"",
            "#include <sys/uio.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hci.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/mainloop.h\"\n#include \"monitor/bt.h\"\n#include <sys/uio.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void cmd_free(void *data)\n{\n\tstruct cmd *cmd = data;\n\n\tif (cmd->destroy)\n\t\tcmd->destroy(cmd->user_data);\n\n\tfree(cmd->data);\n\tfree(cmd);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_remove_if",
          "args": [
            "hci->rsp_queue",
            "match_cmd_id",
            "UINT_TO_PTR(id)"
          ],
          "line": 506
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_if",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "278-316",
          "snippet": "void *queue_remove_if(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry, *prev = NULL;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tentry = queue->head;\n\n\twhile (entry) {\n\t\tif (function(entry->data, user_data)) {\n\t\t\tvoid *data;\n\n\t\t\tif (prev)\n\t\t\t\tprev->next = entry->next;\n\t\t\telse\n\t\t\t\tqueue->head = entry->next;\n\n\t\t\tif (!entry->next)\n\t\t\t\tqueue->tail = prev;\n\n\t\t\tdata = entry->data;\n\n\t\t\tfree(entry);\n\t\t\tqueue->entries--;\n\n\t\t\treturn data;\n\t\t} else {\n\t\t\tprev = entry;\n\t\t\tentry = entry->next;\n\t\t}\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid *queue_remove_if(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry, *prev = NULL;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tentry = queue->head;\n\n\twhile (entry) {\n\t\tif (function(entry->data, user_data)) {\n\t\t\tvoid *data;\n\n\t\t\tif (prev)\n\t\t\t\tprev->next = entry->next;\n\t\t\telse\n\t\t\t\tqueue->head = entry->next;\n\n\t\t\tif (!entry->next)\n\t\t\t\tqueue->tail = prev;\n\n\t\t\tdata = entry->data;\n\n\t\t\tfree(entry);\n\t\t\tqueue->entries--;\n\n\t\t\treturn data;\n\t\t} else {\n\t\t\tprev = entry;\n\t\t\tentry = entry->next;\n\t\t}\n\t}\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "UINT_TO_PTR",
          "args": [
            "id"
          ],
          "line": 507
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "UINT_TO_PTR",
          "args": [
            "id"
          ],
          "line": 504
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/hci.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/mainloop.h\"\n#include \"monitor/bt.h\"\n#include <sys/uio.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nbool bt_hci_cancel(struct bt_hci *hci, unsigned int id)\n{\n\tstruct cmd *cmd;\n\n\tif (!hci || !id)\n\t\treturn false;\n\n\tcmd = queue_remove_if(hci->cmd_queue, match_cmd_id, UINT_TO_PTR(id));\n\tif (!cmd) {\n\t\tcmd = queue_remove_if(hci->rsp_queue, match_cmd_id,\n\t\t\t\t\t\t\tUINT_TO_PTR(id));\n\t\tif (!cmd)\n\t\t\treturn false;\n\t}\n\n\tcmd_free(cmd);\n\n\twakeup_writer(hci);\n\n\treturn true;\n}"
  },
  {
    "function_name": "match_cmd_id",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hci.c",
    "lines": "489-495",
    "snippet": "static bool match_cmd_id(const void *a, const void *b)\n{\n\tconst struct cmd *cmd = a;\n\tunsigned int id = PTR_TO_UINT(b);\n\n\treturn cmd->id == id;\n}",
    "includes": [
      "#include \"src/shared/hci.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include \"monitor/bt.h\"",
      "#include <sys/uio.h>",
      "#include <sys/socket.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "PTR_TO_UINT",
          "args": [
            "b"
          ],
          "line": 492
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/hci.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/mainloop.h\"\n#include \"monitor/bt.h\"\n#include <sys/uio.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic bool match_cmd_id(const void *a, const void *b)\n{\n\tconst struct cmd *cmd = a;\n\tunsigned int id = PTR_TO_UINT(b);\n\n\treturn cmd->id == id;\n}"
  },
  {
    "function_name": "bt_hci_send",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hci.c",
    "lines": "445-487",
    "snippet": "unsigned int bt_hci_send(struct bt_hci *hci, uint16_t opcode,\n\t\t\t\tconst void *data, uint8_t size,\n\t\t\t\tbt_hci_callback_func_t callback,\n\t\t\t\tvoid *user_data, bt_hci_destroy_func_t destroy)\n{\n\tstruct cmd *cmd;\n\n\tif (!hci)\n\t\treturn 0;\n\n\tcmd = new0(struct cmd, 1);\n\tcmd->opcode = opcode;\n\tcmd->size = size;\n\n\tif (cmd->size > 0) {\n\t\tcmd->data = malloc(cmd->size);\n\t\tif (!cmd->data) {\n\t\t\tfree(cmd);\n\t\t\treturn 0;\n\t\t}\n\n\t\tmemcpy(cmd->data, data, cmd->size);\n\t}\n\n\tif (hci->next_cmd_id < 1)\n\t\thci->next_cmd_id = 1;\n\n\tcmd->id = hci->next_cmd_id++;\n\n\tcmd->callback = callback;\n\tcmd->destroy = destroy;\n\tcmd->user_data = user_data;\n\n\tif (!queue_push_tail(hci->cmd_queue, cmd)) {\n\t\tfree(cmd->data);\n\t\tfree(cmd);\n\t\treturn 0;\n\t}\n\n\twakeup_writer(hci);\n\n\treturn cmd->id;\n}",
    "includes": [
      "#include \"src/shared/hci.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include \"monitor/bt.h\"",
      "#include <sys/uio.h>",
      "#include <sys/socket.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "wakeup_writer",
          "args": [
            "hci"
          ],
          "line": 484
        },
        "resolved": true,
        "details": {
          "function_name": "wakeup_writer",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hci.c",
          "lines": "158-173",
          "snippet": "static void wakeup_writer(struct bt_hci *hci)\n{\n\tif (hci->writer_active)\n\t\treturn;\n\n\tif (hci->num_cmds < 1)\n\t\treturn;\n\n\tif (queue_isempty(hci->cmd_queue))\n\t\treturn;\n\n\tif (!io_set_write_handler(hci->io, io_write_callback, hci, NULL))\n\t\treturn;\n\n\thci->writer_active = true;\n}",
          "includes": [
            "#include \"src/shared/hci.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include \"monitor/bt.h\"",
            "#include <sys/uio.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hci.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/mainloop.h\"\n#include \"monitor/bt.h\"\n#include <sys/uio.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void wakeup_writer(struct bt_hci *hci)\n{\n\tif (hci->writer_active)\n\t\treturn;\n\n\tif (hci->num_cmds < 1)\n\t\treturn;\n\n\tif (queue_isempty(hci->cmd_queue))\n\t\treturn;\n\n\tif (!io_set_write_handler(hci->io, io_write_callback, hci, NULL))\n\t\treturn;\n\n\thci->writer_active = true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "cmd"
          ],
          "line": 480
        },
        "resolved": true,
        "details": {
          "function_name": "evt_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hci.c",
          "lines": "100-108",
          "snippet": "static void evt_free(void *data)\n{\n\tstruct evt *evt = data;\n\n\tif (evt->destroy)\n\t\tevt->destroy(evt->user_data);\n\n\tfree(evt);\n}",
          "includes": [
            "#include \"src/shared/hci.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include \"monitor/bt.h\"",
            "#include <sys/uio.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hci.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/mainloop.h\"\n#include \"monitor/bt.h\"\n#include <sys/uio.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void evt_free(void *data)\n{\n\tstruct evt *evt = data;\n\n\tif (evt->destroy)\n\t\tevt->destroy(evt->user_data);\n\n\tfree(evt);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_push_tail",
          "args": [
            "hci->cmd_queue",
            "cmd"
          ],
          "line": 478
        },
        "resolved": true,
        "details": {
          "function_name": "queue_push_tail",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "88-108",
          "snippet": "bool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "cmd->data",
            "data",
            "cmd->size"
          ],
          "line": 466
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "malloc",
          "args": [
            "cmd->size"
          ],
          "line": 460
        },
        "resolved": true,
        "details": {
          "function_name": "btd_malloc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/util.c",
          "lines": "41-55",
          "snippet": "void *btd_malloc(size_t size)\n{\n\tif (__builtin_expect(!!size, 1)) {\n\t\tvoid *ptr;\n\n\t\tptr = malloc(size);\n\t\tif (ptr)\n\t\t\treturn ptr;\n\n\t\tfprintf(stderr, \"failed to allocate %zu bytes\\n\", size);\n\t\tabort();\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include <string.h>",
            "#include <limits.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include <string.h>\n#include <limits.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid *btd_malloc(size_t size)\n{\n\tif (__builtin_expect(!!size, 1)) {\n\t\tvoid *ptr;\n\n\t\tptr = malloc(size);\n\t\tif (ptr)\n\t\t\treturn ptr;\n\n\t\tfprintf(stderr, \"failed to allocate %zu bytes\\n\", size);\n\t\tabort();\n\t}\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "new0",
          "args": [
            "structcmd",
            "1"
          ],
          "line": 455
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/hci.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/mainloop.h\"\n#include \"monitor/bt.h\"\n#include <sys/uio.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nunsigned int bt_hci_send(struct bt_hci *hci, uint16_t opcode,\n\t\t\t\tconst void *data, uint8_t size,\n\t\t\t\tbt_hci_callback_func_t callback,\n\t\t\t\tvoid *user_data, bt_hci_destroy_func_t destroy)\n{\n\tstruct cmd *cmd;\n\n\tif (!hci)\n\t\treturn 0;\n\n\tcmd = new0(struct cmd, 1);\n\tcmd->opcode = opcode;\n\tcmd->size = size;\n\n\tif (cmd->size > 0) {\n\t\tcmd->data = malloc(cmd->size);\n\t\tif (!cmd->data) {\n\t\t\tfree(cmd);\n\t\t\treturn 0;\n\t\t}\n\n\t\tmemcpy(cmd->data, data, cmd->size);\n\t}\n\n\tif (hci->next_cmd_id < 1)\n\t\thci->next_cmd_id = 1;\n\n\tcmd->id = hci->next_cmd_id++;\n\n\tcmd->callback = callback;\n\tcmd->destroy = destroy;\n\tcmd->user_data = user_data;\n\n\tif (!queue_push_tail(hci->cmd_queue, cmd)) {\n\t\tfree(cmd->data);\n\t\tfree(cmd);\n\t\treturn 0;\n\t}\n\n\twakeup_writer(hci);\n\n\treturn cmd->id;\n}"
  },
  {
    "function_name": "bt_hci_set_close_on_unref",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hci.c",
    "lines": "437-443",
    "snippet": "bool bt_hci_set_close_on_unref(struct bt_hci *hci, bool do_close)\n{\n\tif (!hci)\n\t\treturn false;\n\n\treturn io_set_close_on_destroy(hci->io, do_close);\n}",
    "includes": [
      "#include \"src/shared/hci.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include \"monitor/bt.h\"",
      "#include <sys/uio.h>",
      "#include <sys/socket.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "io_set_close_on_destroy",
          "args": [
            "hci->io",
            "do_close"
          ],
          "line": 442
        },
        "resolved": true,
        "details": {
          "function_name": "io_set_close_on_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-glib.c",
          "lines": "145-156",
          "snippet": "bool io_set_close_on_destroy(struct io *io, bool do_close)\n{\n\tif (!io)\n\t\treturn false;\n\n\tif (do_close)\n\t\tg_io_channel_set_close_on_unref(io->channel, TRUE);\n\telse\n\t\tg_io_channel_set_close_on_unref(io->channel, FALSE);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/io.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/io.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nbool io_set_close_on_destroy(struct io *io, bool do_close)\n{\n\tif (!io)\n\t\treturn false;\n\n\tif (do_close)\n\t\tg_io_channel_set_close_on_unref(io->channel, TRUE);\n\telse\n\t\tg_io_channel_set_close_on_unref(io->channel, FALSE);\n\n\treturn true;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/hci.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/mainloop.h\"\n#include \"monitor/bt.h\"\n#include <sys/uio.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nbool bt_hci_set_close_on_unref(struct bt_hci *hci, bool do_close)\n{\n\tif (!hci)\n\t\treturn false;\n\n\treturn io_set_close_on_destroy(hci->io, do_close);\n}"
  },
  {
    "function_name": "bt_hci_unref",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hci.c",
    "lines": "420-435",
    "snippet": "void bt_hci_unref(struct bt_hci *hci)\n{\n\tif (!hci)\n\t\treturn;\n\n\tif (__sync_sub_and_fetch(&hci->ref_count, 1))\n\t\treturn;\n\n\tqueue_destroy(hci->evt_list, evt_free);\n\tqueue_destroy(hci->cmd_queue, cmd_free);\n\tqueue_destroy(hci->rsp_queue, cmd_free);\n\n\tio_destroy(hci->io);\n\n\tfree(hci);\n}",
    "includes": [
      "#include \"src/shared/hci.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include \"monitor/bt.h\"",
      "#include <sys/uio.h>",
      "#include <sys/socket.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "hci"
          ],
          "line": 434
        },
        "resolved": true,
        "details": {
          "function_name": "evt_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hci.c",
          "lines": "100-108",
          "snippet": "static void evt_free(void *data)\n{\n\tstruct evt *evt = data;\n\n\tif (evt->destroy)\n\t\tevt->destroy(evt->user_data);\n\n\tfree(evt);\n}",
          "includes": [
            "#include \"src/shared/hci.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include \"monitor/bt.h\"",
            "#include <sys/uio.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hci.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/mainloop.h\"\n#include \"monitor/bt.h\"\n#include <sys/uio.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void evt_free(void *data)\n{\n\tstruct evt *evt = data;\n\n\tif (evt->destroy)\n\t\tevt->destroy(evt->user_data);\n\n\tfree(evt);\n}"
        }
      },
      {
        "call_info": {
          "callee": "io_destroy",
          "args": [
            "hci->io"
          ],
          "line": 432
        },
        "resolved": true,
        "details": {
          "function_name": "io_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-glib.c",
          "lines": "111-135",
          "snippet": "void io_destroy(struct io *io)\n{\n\tif (!io)\n\t\treturn;\n\n\tif (io->read_watch) {\n\t\tg_source_remove(io->read_watch->id);\n\t\tio->read_watch = NULL;\n\t}\n\n\tif (io->write_watch) {\n\t\tg_source_remove(io->write_watch->id);\n\t\tio->write_watch = NULL;\n\t}\n\n\tif (io->disconnect_watch) {\n\t\tg_source_remove(io->disconnect_watch->id);\n\t\tio->disconnect_watch = NULL;\n\t}\n\n\tg_io_channel_unref(io->channel);\n\tio->channel = NULL;\n\n\tio_unref(io);\n}",
          "includes": [
            "#include \"src/shared/io.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/io.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nvoid io_destroy(struct io *io)\n{\n\tif (!io)\n\t\treturn;\n\n\tif (io->read_watch) {\n\t\tg_source_remove(io->read_watch->id);\n\t\tio->read_watch = NULL;\n\t}\n\n\tif (io->write_watch) {\n\t\tg_source_remove(io->write_watch->id);\n\t\tio->write_watch = NULL;\n\t}\n\n\tif (io->disconnect_watch) {\n\t\tg_source_remove(io->disconnect_watch->id);\n\t\tio->disconnect_watch = NULL;\n\t}\n\n\tg_io_channel_unref(io->channel);\n\tio->channel = NULL;\n\n\tio_unref(io);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_destroy",
          "args": [
            "hci->rsp_queue",
            "cmd_free"
          ],
          "line": 430
        },
        "resolved": true,
        "details": {
          "function_name": "queue_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "68-76",
          "snippet": "void queue_destroy(struct queue *queue, queue_destroy_func_t destroy)\n{\n\tif (!queue)\n\t\treturn;\n\n\tqueue_remove_all(queue, NULL, NULL, destroy);\n\n\tqueue_unref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid queue_destroy(struct queue *queue, queue_destroy_func_t destroy)\n{\n\tif (!queue)\n\t\treturn;\n\n\tqueue_remove_all(queue, NULL, NULL, destroy);\n\n\tqueue_unref(queue);\n}"
        }
      },
      {
        "call_info": {
          "callee": "__sync_sub_and_fetch",
          "args": [
            "&hci->ref_count",
            "1"
          ],
          "line": 425
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/hci.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/mainloop.h\"\n#include \"monitor/bt.h\"\n#include <sys/uio.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid bt_hci_unref(struct bt_hci *hci)\n{\n\tif (!hci)\n\t\treturn;\n\n\tif (__sync_sub_and_fetch(&hci->ref_count, 1))\n\t\treturn;\n\n\tqueue_destroy(hci->evt_list, evt_free);\n\tqueue_destroy(hci->cmd_queue, cmd_free);\n\tqueue_destroy(hci->rsp_queue, cmd_free);\n\n\tio_destroy(hci->io);\n\n\tfree(hci);\n}"
  },
  {
    "function_name": "bt_hci_ref",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hci.c",
    "lines": "410-418",
    "snippet": "struct bt_hci *bt_hci_ref(struct bt_hci *hci)\n{\n\tif (!hci)\n\t\treturn NULL;\n\n\t__sync_fetch_and_add(&hci->ref_count, 1);\n\n\treturn hci;\n}",
    "includes": [
      "#include \"src/shared/hci.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include \"monitor/bt.h\"",
      "#include <sys/uio.h>",
      "#include <sys/socket.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "__sync_fetch_and_add",
          "args": [
            "&hci->ref_count",
            "1"
          ],
          "line": 415
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/hci.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/mainloop.h\"\n#include \"monitor/bt.h\"\n#include <sys/uio.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstruct bt_hci *bt_hci_ref(struct bt_hci *hci)\n{\n\tif (!hci)\n\t\treturn NULL;\n\n\t__sync_fetch_and_add(&hci->ref_count, 1);\n\n\treturn hci;\n}"
  },
  {
    "function_name": "bt_hci_new_raw_device",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hci.c",
    "lines": "377-408",
    "snippet": "struct bt_hci *bt_hci_new_raw_device(uint16_t index)\n{\n\tstruct bt_hci *hci;\n\tstruct hci_filter flt;\n\tint fd;\n\n\tfd = create_socket(index, HCI_CHANNEL_RAW);\n\tif (fd < 0)\n\t\treturn NULL;\n\n\tmemset(&flt, 0, sizeof(flt));\n\tflt.type_mask = 1 << BT_H4_EVT_PKT;\n\tflt.event_mask[0] = 0xffffffff;\n\tflt.event_mask[1] = 0xffffffff;\n\n\tif (setsockopt(fd, SOL_HCI, HCI_FILTER, &flt, sizeof(flt)) < 0) {\n\t\tclose(fd);\n\t\treturn NULL;\n\t}\n\n\thci = create_hci(fd);\n\tif (!hci) {\n\t\tclose(fd);\n\t\treturn NULL;\n\t}\n\n\thci->is_stream = false;\n\n\tbt_hci_set_close_on_unref(hci, true);\n\n\treturn hci;\n}",
    "includes": [
      "#include \"src/shared/hci.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include \"monitor/bt.h\"",
      "#include <sys/uio.h>",
      "#include <sys/socket.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define HCI_FILTER\t2",
      "#define SOL_HCI\t\t0",
      "#define HCI_CHANNEL_RAW\t\t0"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bt_hci_set_close_on_unref",
          "args": [
            "hci",
            "true"
          ],
          "line": 405
        },
        "resolved": true,
        "details": {
          "function_name": "bt_hci_set_close_on_unref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hci.c",
          "lines": "437-443",
          "snippet": "bool bt_hci_set_close_on_unref(struct bt_hci *hci, bool do_close)\n{\n\tif (!hci)\n\t\treturn false;\n\n\treturn io_set_close_on_destroy(hci->io, do_close);\n}",
          "includes": [
            "#include \"src/shared/hci.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include \"monitor/bt.h\"",
            "#include <sys/uio.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hci.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/mainloop.h\"\n#include \"monitor/bt.h\"\n#include <sys/uio.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nbool bt_hci_set_close_on_unref(struct bt_hci *hci, bool do_close)\n{\n\tif (!hci)\n\t\treturn false;\n\n\treturn io_set_close_on_destroy(hci->io, do_close);\n}"
        }
      },
      {
        "call_info": {
          "callee": "close",
          "args": [
            "fd"
          ],
          "line": 399
        },
        "resolved": true,
        "details": {
          "function_name": "hfp_context_close_container",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
          "lines": "334-347",
          "snippet": "bool hfp_context_close_container(struct hfp_context *context)\n{\n\tskip_whitespace(context);\n\n\t/* The list shall be followed by a right parenthesis (\")\" V250 5.7.3.1*/\n\tif (context->data[context->offset] != ')')\n\t\treturn false;\n\n\tcontext->offset++;\n\n\tnext_field(context);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/hfp.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <ctype.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nbool hfp_context_close_container(struct hfp_context *context)\n{\n\tskip_whitespace(context);\n\n\t/* The list shall be followed by a right parenthesis (\")\" V250 5.7.3.1*/\n\tif (context->data[context->offset] != ')')\n\t\treturn false;\n\n\tcontext->offset++;\n\n\tnext_field(context);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "create_hci",
          "args": [
            "fd"
          ],
          "line": 397
        },
        "resolved": true,
        "details": {
          "function_name": "create_hci",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hci.c",
          "lines": "285-319",
          "snippet": "static struct bt_hci *create_hci(int fd)\n{\n\tstruct bt_hci *hci;\n\n\tif (fd < 0)\n\t\treturn NULL;\n\n\thci = new0(struct bt_hci, 1);\n\thci->io = io_new(fd);\n\tif (!hci->io) {\n\t\tfree(hci);\n\t\treturn NULL;\n\t}\n\n\thci->is_stream = true;\n\thci->writer_active = false;\n\thci->num_cmds = 1;\n\thci->next_cmd_id = 1;\n\thci->next_evt_id = 1;\n\n\thci->cmd_queue = queue_new();\n\thci->rsp_queue = queue_new();\n\thci->evt_list = queue_new();\n\n\tif (!io_set_read_handler(hci->io, io_read_callback, hci, NULL)) {\n\t\tqueue_destroy(hci->evt_list, NULL);\n\t\tqueue_destroy(hci->rsp_queue, NULL);\n\t\tqueue_destroy(hci->cmd_queue, NULL);\n\t\tio_destroy(hci->io);\n\t\tfree(hci);\n\t\treturn NULL;\n\t}\n\n\treturn bt_hci_ref(hci);\n}",
          "includes": [
            "#include \"src/shared/hci.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include \"monitor/bt.h\"",
            "#include <sys/uio.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hci.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/mainloop.h\"\n#include \"monitor/bt.h\"\n#include <sys/uio.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic struct bt_hci *create_hci(int fd)\n{\n\tstruct bt_hci *hci;\n\n\tif (fd < 0)\n\t\treturn NULL;\n\n\thci = new0(struct bt_hci, 1);\n\thci->io = io_new(fd);\n\tif (!hci->io) {\n\t\tfree(hci);\n\t\treturn NULL;\n\t}\n\n\thci->is_stream = true;\n\thci->writer_active = false;\n\thci->num_cmds = 1;\n\thci->next_cmd_id = 1;\n\thci->next_evt_id = 1;\n\n\thci->cmd_queue = queue_new();\n\thci->rsp_queue = queue_new();\n\thci->evt_list = queue_new();\n\n\tif (!io_set_read_handler(hci->io, io_read_callback, hci, NULL)) {\n\t\tqueue_destroy(hci->evt_list, NULL);\n\t\tqueue_destroy(hci->rsp_queue, NULL);\n\t\tqueue_destroy(hci->cmd_queue, NULL);\n\t\tio_destroy(hci->io);\n\t\tfree(hci);\n\t\treturn NULL;\n\t}\n\n\treturn bt_hci_ref(hci);\n}"
        }
      },
      {
        "call_info": {
          "callee": "setsockopt",
          "args": [
            "fd",
            "SOL_HCI",
            "HCI_FILTER",
            "&flt",
            "sizeof(flt)"
          ],
          "line": 392
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&flt",
            "0",
            "sizeof(flt)"
          ],
          "line": 387
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "create_socket",
          "args": [
            "index",
            "HCI_CHANNEL_RAW"
          ],
          "line": 383
        },
        "resolved": true,
        "details": {
          "function_name": "create_socket",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hci.c",
          "lines": "332-353",
          "snippet": "static int create_socket(uint16_t index, uint16_t channel)\n{\n\tstruct sockaddr_hci addr;\n\tint fd;\n\n\tfd = socket(PF_BLUETOOTH, SOCK_RAW | SOCK_CLOEXEC | SOCK_NONBLOCK,\n\t\t\t\t\t\t\t\tBTPROTO_HCI);\n\tif (fd < 0)\n\t\treturn -1;\n\n\tmemset(&addr, 0, sizeof(addr));\n\taddr.hci_family = AF_BLUETOOTH;\n\taddr.hci_dev = index;\n\taddr.hci_channel = channel;\n\n\tif (bind(fd, (struct sockaddr *) &addr, sizeof(addr)) < 0) {\n\t\tclose(fd);\n\t\treturn -1;\n\t}\n\n\treturn fd;\n}",
          "includes": [
            "#include \"src/shared/hci.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include \"monitor/bt.h\"",
            "#include <sys/uio.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define BTPROTO_HCI\t1"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hci.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/mainloop.h\"\n#include \"monitor/bt.h\"\n#include <sys/uio.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\n#define BTPROTO_HCI\t1\n\nstatic int create_socket(uint16_t index, uint16_t channel)\n{\n\tstruct sockaddr_hci addr;\n\tint fd;\n\n\tfd = socket(PF_BLUETOOTH, SOCK_RAW | SOCK_CLOEXEC | SOCK_NONBLOCK,\n\t\t\t\t\t\t\t\tBTPROTO_HCI);\n\tif (fd < 0)\n\t\treturn -1;\n\n\tmemset(&addr, 0, sizeof(addr));\n\taddr.hci_family = AF_BLUETOOTH;\n\taddr.hci_dev = index;\n\taddr.hci_channel = channel;\n\n\tif (bind(fd, (struct sockaddr *) &addr, sizeof(addr)) < 0) {\n\t\tclose(fd);\n\t\treturn -1;\n\t}\n\n\treturn fd;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/hci.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/mainloop.h\"\n#include \"monitor/bt.h\"\n#include <sys/uio.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\n#define HCI_FILTER\t2\n#define SOL_HCI\t\t0\n#define HCI_CHANNEL_RAW\t\t0\n\nstruct bt_hci *bt_hci_new_raw_device(uint16_t index)\n{\n\tstruct bt_hci *hci;\n\tstruct hci_filter flt;\n\tint fd;\n\n\tfd = create_socket(index, HCI_CHANNEL_RAW);\n\tif (fd < 0)\n\t\treturn NULL;\n\n\tmemset(&flt, 0, sizeof(flt));\n\tflt.type_mask = 1 << BT_H4_EVT_PKT;\n\tflt.event_mask[0] = 0xffffffff;\n\tflt.event_mask[1] = 0xffffffff;\n\n\tif (setsockopt(fd, SOL_HCI, HCI_FILTER, &flt, sizeof(flt)) < 0) {\n\t\tclose(fd);\n\t\treturn NULL;\n\t}\n\n\thci = create_hci(fd);\n\tif (!hci) {\n\t\tclose(fd);\n\t\treturn NULL;\n\t}\n\n\thci->is_stream = false;\n\n\tbt_hci_set_close_on_unref(hci, true);\n\n\treturn hci;\n}"
  },
  {
    "function_name": "bt_hci_new_user_channel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hci.c",
    "lines": "355-375",
    "snippet": "struct bt_hci *bt_hci_new_user_channel(uint16_t index)\n{\n\tstruct bt_hci *hci;\n\tint fd;\n\n\tfd = create_socket(index, HCI_CHANNEL_USER);\n\tif (fd < 0)\n\t\treturn NULL;\n\n\thci = create_hci(fd);\n\tif (!hci) {\n\t\tclose(fd);\n\t\treturn NULL;\n\t}\n\n\thci->is_stream = false;\n\n\tbt_hci_set_close_on_unref(hci, true);\n\n\treturn hci;\n}",
    "includes": [
      "#include \"src/shared/hci.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include \"monitor/bt.h\"",
      "#include <sys/uio.h>",
      "#include <sys/socket.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define HCI_CHANNEL_USER\t1"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bt_hci_set_close_on_unref",
          "args": [
            "hci",
            "true"
          ],
          "line": 372
        },
        "resolved": true,
        "details": {
          "function_name": "bt_hci_set_close_on_unref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hci.c",
          "lines": "437-443",
          "snippet": "bool bt_hci_set_close_on_unref(struct bt_hci *hci, bool do_close)\n{\n\tif (!hci)\n\t\treturn false;\n\n\treturn io_set_close_on_destroy(hci->io, do_close);\n}",
          "includes": [
            "#include \"src/shared/hci.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include \"monitor/bt.h\"",
            "#include <sys/uio.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hci.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/mainloop.h\"\n#include \"monitor/bt.h\"\n#include <sys/uio.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nbool bt_hci_set_close_on_unref(struct bt_hci *hci, bool do_close)\n{\n\tif (!hci)\n\t\treturn false;\n\n\treturn io_set_close_on_destroy(hci->io, do_close);\n}"
        }
      },
      {
        "call_info": {
          "callee": "close",
          "args": [
            "fd"
          ],
          "line": 366
        },
        "resolved": true,
        "details": {
          "function_name": "hfp_context_close_container",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
          "lines": "334-347",
          "snippet": "bool hfp_context_close_container(struct hfp_context *context)\n{\n\tskip_whitespace(context);\n\n\t/* The list shall be followed by a right parenthesis (\")\" V250 5.7.3.1*/\n\tif (context->data[context->offset] != ')')\n\t\treturn false;\n\n\tcontext->offset++;\n\n\tnext_field(context);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/hfp.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <ctype.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nbool hfp_context_close_container(struct hfp_context *context)\n{\n\tskip_whitespace(context);\n\n\t/* The list shall be followed by a right parenthesis (\")\" V250 5.7.3.1*/\n\tif (context->data[context->offset] != ')')\n\t\treturn false;\n\n\tcontext->offset++;\n\n\tnext_field(context);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "create_hci",
          "args": [
            "fd"
          ],
          "line": 364
        },
        "resolved": true,
        "details": {
          "function_name": "create_hci",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hci.c",
          "lines": "285-319",
          "snippet": "static struct bt_hci *create_hci(int fd)\n{\n\tstruct bt_hci *hci;\n\n\tif (fd < 0)\n\t\treturn NULL;\n\n\thci = new0(struct bt_hci, 1);\n\thci->io = io_new(fd);\n\tif (!hci->io) {\n\t\tfree(hci);\n\t\treturn NULL;\n\t}\n\n\thci->is_stream = true;\n\thci->writer_active = false;\n\thci->num_cmds = 1;\n\thci->next_cmd_id = 1;\n\thci->next_evt_id = 1;\n\n\thci->cmd_queue = queue_new();\n\thci->rsp_queue = queue_new();\n\thci->evt_list = queue_new();\n\n\tif (!io_set_read_handler(hci->io, io_read_callback, hci, NULL)) {\n\t\tqueue_destroy(hci->evt_list, NULL);\n\t\tqueue_destroy(hci->rsp_queue, NULL);\n\t\tqueue_destroy(hci->cmd_queue, NULL);\n\t\tio_destroy(hci->io);\n\t\tfree(hci);\n\t\treturn NULL;\n\t}\n\n\treturn bt_hci_ref(hci);\n}",
          "includes": [
            "#include \"src/shared/hci.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include \"monitor/bt.h\"",
            "#include <sys/uio.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hci.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/mainloop.h\"\n#include \"monitor/bt.h\"\n#include <sys/uio.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic struct bt_hci *create_hci(int fd)\n{\n\tstruct bt_hci *hci;\n\n\tif (fd < 0)\n\t\treturn NULL;\n\n\thci = new0(struct bt_hci, 1);\n\thci->io = io_new(fd);\n\tif (!hci->io) {\n\t\tfree(hci);\n\t\treturn NULL;\n\t}\n\n\thci->is_stream = true;\n\thci->writer_active = false;\n\thci->num_cmds = 1;\n\thci->next_cmd_id = 1;\n\thci->next_evt_id = 1;\n\n\thci->cmd_queue = queue_new();\n\thci->rsp_queue = queue_new();\n\thci->evt_list = queue_new();\n\n\tif (!io_set_read_handler(hci->io, io_read_callback, hci, NULL)) {\n\t\tqueue_destroy(hci->evt_list, NULL);\n\t\tqueue_destroy(hci->rsp_queue, NULL);\n\t\tqueue_destroy(hci->cmd_queue, NULL);\n\t\tio_destroy(hci->io);\n\t\tfree(hci);\n\t\treturn NULL;\n\t}\n\n\treturn bt_hci_ref(hci);\n}"
        }
      },
      {
        "call_info": {
          "callee": "create_socket",
          "args": [
            "index",
            "HCI_CHANNEL_USER"
          ],
          "line": 360
        },
        "resolved": true,
        "details": {
          "function_name": "create_socket",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hci.c",
          "lines": "332-353",
          "snippet": "static int create_socket(uint16_t index, uint16_t channel)\n{\n\tstruct sockaddr_hci addr;\n\tint fd;\n\n\tfd = socket(PF_BLUETOOTH, SOCK_RAW | SOCK_CLOEXEC | SOCK_NONBLOCK,\n\t\t\t\t\t\t\t\tBTPROTO_HCI);\n\tif (fd < 0)\n\t\treturn -1;\n\n\tmemset(&addr, 0, sizeof(addr));\n\taddr.hci_family = AF_BLUETOOTH;\n\taddr.hci_dev = index;\n\taddr.hci_channel = channel;\n\n\tif (bind(fd, (struct sockaddr *) &addr, sizeof(addr)) < 0) {\n\t\tclose(fd);\n\t\treturn -1;\n\t}\n\n\treturn fd;\n}",
          "includes": [
            "#include \"src/shared/hci.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include \"monitor/bt.h\"",
            "#include <sys/uio.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define BTPROTO_HCI\t1"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hci.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/mainloop.h\"\n#include \"monitor/bt.h\"\n#include <sys/uio.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\n#define BTPROTO_HCI\t1\n\nstatic int create_socket(uint16_t index, uint16_t channel)\n{\n\tstruct sockaddr_hci addr;\n\tint fd;\n\n\tfd = socket(PF_BLUETOOTH, SOCK_RAW | SOCK_CLOEXEC | SOCK_NONBLOCK,\n\t\t\t\t\t\t\t\tBTPROTO_HCI);\n\tif (fd < 0)\n\t\treturn -1;\n\n\tmemset(&addr, 0, sizeof(addr));\n\taddr.hci_family = AF_BLUETOOTH;\n\taddr.hci_dev = index;\n\taddr.hci_channel = channel;\n\n\tif (bind(fd, (struct sockaddr *) &addr, sizeof(addr)) < 0) {\n\t\tclose(fd);\n\t\treturn -1;\n\t}\n\n\treturn fd;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/hci.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/mainloop.h\"\n#include \"monitor/bt.h\"\n#include <sys/uio.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\n#define HCI_CHANNEL_USER\t1\n\nstruct bt_hci *bt_hci_new_user_channel(uint16_t index)\n{\n\tstruct bt_hci *hci;\n\tint fd;\n\n\tfd = create_socket(index, HCI_CHANNEL_USER);\n\tif (fd < 0)\n\t\treturn NULL;\n\n\thci = create_hci(fd);\n\tif (!hci) {\n\t\tclose(fd);\n\t\treturn NULL;\n\t}\n\n\thci->is_stream = false;\n\n\tbt_hci_set_close_on_unref(hci, true);\n\n\treturn hci;\n}"
  },
  {
    "function_name": "create_socket",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hci.c",
    "lines": "332-353",
    "snippet": "static int create_socket(uint16_t index, uint16_t channel)\n{\n\tstruct sockaddr_hci addr;\n\tint fd;\n\n\tfd = socket(PF_BLUETOOTH, SOCK_RAW | SOCK_CLOEXEC | SOCK_NONBLOCK,\n\t\t\t\t\t\t\t\tBTPROTO_HCI);\n\tif (fd < 0)\n\t\treturn -1;\n\n\tmemset(&addr, 0, sizeof(addr));\n\taddr.hci_family = AF_BLUETOOTH;\n\taddr.hci_dev = index;\n\taddr.hci_channel = channel;\n\n\tif (bind(fd, (struct sockaddr *) &addr, sizeof(addr)) < 0) {\n\t\tclose(fd);\n\t\treturn -1;\n\t}\n\n\treturn fd;\n}",
    "includes": [
      "#include \"src/shared/hci.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include \"monitor/bt.h\"",
      "#include <sys/uio.h>",
      "#include <sys/socket.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define BTPROTO_HCI\t1"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "close",
          "args": [
            "fd"
          ],
          "line": 348
        },
        "resolved": true,
        "details": {
          "function_name": "hfp_context_close_container",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
          "lines": "334-347",
          "snippet": "bool hfp_context_close_container(struct hfp_context *context)\n{\n\tskip_whitespace(context);\n\n\t/* The list shall be followed by a right parenthesis (\")\" V250 5.7.3.1*/\n\tif (context->data[context->offset] != ')')\n\t\treturn false;\n\n\tcontext->offset++;\n\n\tnext_field(context);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/hfp.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <ctype.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nbool hfp_context_close_container(struct hfp_context *context)\n{\n\tskip_whitespace(context);\n\n\t/* The list shall be followed by a right parenthesis (\")\" V250 5.7.3.1*/\n\tif (context->data[context->offset] != ')')\n\t\treturn false;\n\n\tcontext->offset++;\n\n\tnext_field(context);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bind",
          "args": [
            "fd",
            "(struct sockaddr *) &addr",
            "sizeof(addr)"
          ],
          "line": 347
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&addr",
            "0",
            "sizeof(addr)"
          ],
          "line": 342
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "socket",
          "args": [
            "PF_BLUETOOTH",
            "SOCK_RAW | SOCK_CLOEXEC | SOCK_NONBLOCK",
            "BTPROTO_HCI"
          ],
          "line": 337
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/hci.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/mainloop.h\"\n#include \"monitor/bt.h\"\n#include <sys/uio.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\n#define BTPROTO_HCI\t1\n\nstatic int create_socket(uint16_t index, uint16_t channel)\n{\n\tstruct sockaddr_hci addr;\n\tint fd;\n\n\tfd = socket(PF_BLUETOOTH, SOCK_RAW | SOCK_CLOEXEC | SOCK_NONBLOCK,\n\t\t\t\t\t\t\t\tBTPROTO_HCI);\n\tif (fd < 0)\n\t\treturn -1;\n\n\tmemset(&addr, 0, sizeof(addr));\n\taddr.hci_family = AF_BLUETOOTH;\n\taddr.hci_dev = index;\n\taddr.hci_channel = channel;\n\n\tif (bind(fd, (struct sockaddr *) &addr, sizeof(addr)) < 0) {\n\t\tclose(fd);\n\t\treturn -1;\n\t}\n\n\treturn fd;\n}"
  },
  {
    "function_name": "bt_hci_new",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hci.c",
    "lines": "321-330",
    "snippet": "struct bt_hci *bt_hci_new(int fd)\n{\n\tstruct bt_hci *hci;\n\n\thci = create_hci(fd);\n\tif (!hci)\n\t\treturn NULL;\n\n\treturn hci;\n}",
    "includes": [
      "#include \"src/shared/hci.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include \"monitor/bt.h\"",
      "#include <sys/uio.h>",
      "#include <sys/socket.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "create_hci",
          "args": [
            "fd"
          ],
          "line": 325
        },
        "resolved": true,
        "details": {
          "function_name": "create_hci",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hci.c",
          "lines": "285-319",
          "snippet": "static struct bt_hci *create_hci(int fd)\n{\n\tstruct bt_hci *hci;\n\n\tif (fd < 0)\n\t\treturn NULL;\n\n\thci = new0(struct bt_hci, 1);\n\thci->io = io_new(fd);\n\tif (!hci->io) {\n\t\tfree(hci);\n\t\treturn NULL;\n\t}\n\n\thci->is_stream = true;\n\thci->writer_active = false;\n\thci->num_cmds = 1;\n\thci->next_cmd_id = 1;\n\thci->next_evt_id = 1;\n\n\thci->cmd_queue = queue_new();\n\thci->rsp_queue = queue_new();\n\thci->evt_list = queue_new();\n\n\tif (!io_set_read_handler(hci->io, io_read_callback, hci, NULL)) {\n\t\tqueue_destroy(hci->evt_list, NULL);\n\t\tqueue_destroy(hci->rsp_queue, NULL);\n\t\tqueue_destroy(hci->cmd_queue, NULL);\n\t\tio_destroy(hci->io);\n\t\tfree(hci);\n\t\treturn NULL;\n\t}\n\n\treturn bt_hci_ref(hci);\n}",
          "includes": [
            "#include \"src/shared/hci.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include \"monitor/bt.h\"",
            "#include <sys/uio.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hci.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/mainloop.h\"\n#include \"monitor/bt.h\"\n#include <sys/uio.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic struct bt_hci *create_hci(int fd)\n{\n\tstruct bt_hci *hci;\n\n\tif (fd < 0)\n\t\treturn NULL;\n\n\thci = new0(struct bt_hci, 1);\n\thci->io = io_new(fd);\n\tif (!hci->io) {\n\t\tfree(hci);\n\t\treturn NULL;\n\t}\n\n\thci->is_stream = true;\n\thci->writer_active = false;\n\thci->num_cmds = 1;\n\thci->next_cmd_id = 1;\n\thci->next_evt_id = 1;\n\n\thci->cmd_queue = queue_new();\n\thci->rsp_queue = queue_new();\n\thci->evt_list = queue_new();\n\n\tif (!io_set_read_handler(hci->io, io_read_callback, hci, NULL)) {\n\t\tqueue_destroy(hci->evt_list, NULL);\n\t\tqueue_destroy(hci->rsp_queue, NULL);\n\t\tqueue_destroy(hci->cmd_queue, NULL);\n\t\tio_destroy(hci->io);\n\t\tfree(hci);\n\t\treturn NULL;\n\t}\n\n\treturn bt_hci_ref(hci);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/hci.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/mainloop.h\"\n#include \"monitor/bt.h\"\n#include <sys/uio.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstruct bt_hci *bt_hci_new(int fd)\n{\n\tstruct bt_hci *hci;\n\n\thci = create_hci(fd);\n\tif (!hci)\n\t\treturn NULL;\n\n\treturn hci;\n}"
  },
  {
    "function_name": "create_hci",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hci.c",
    "lines": "285-319",
    "snippet": "static struct bt_hci *create_hci(int fd)\n{\n\tstruct bt_hci *hci;\n\n\tif (fd < 0)\n\t\treturn NULL;\n\n\thci = new0(struct bt_hci, 1);\n\thci->io = io_new(fd);\n\tif (!hci->io) {\n\t\tfree(hci);\n\t\treturn NULL;\n\t}\n\n\thci->is_stream = true;\n\thci->writer_active = false;\n\thci->num_cmds = 1;\n\thci->next_cmd_id = 1;\n\thci->next_evt_id = 1;\n\n\thci->cmd_queue = queue_new();\n\thci->rsp_queue = queue_new();\n\thci->evt_list = queue_new();\n\n\tif (!io_set_read_handler(hci->io, io_read_callback, hci, NULL)) {\n\t\tqueue_destroy(hci->evt_list, NULL);\n\t\tqueue_destroy(hci->rsp_queue, NULL);\n\t\tqueue_destroy(hci->cmd_queue, NULL);\n\t\tio_destroy(hci->io);\n\t\tfree(hci);\n\t\treturn NULL;\n\t}\n\n\treturn bt_hci_ref(hci);\n}",
    "includes": [
      "#include \"src/shared/hci.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include \"monitor/bt.h\"",
      "#include <sys/uio.h>",
      "#include <sys/socket.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bt_hci_ref",
          "args": [
            "hci"
          ],
          "line": 318
        },
        "resolved": true,
        "details": {
          "function_name": "bt_hci_ref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hci.c",
          "lines": "410-418",
          "snippet": "struct bt_hci *bt_hci_ref(struct bt_hci *hci)\n{\n\tif (!hci)\n\t\treturn NULL;\n\n\t__sync_fetch_and_add(&hci->ref_count, 1);\n\n\treturn hci;\n}",
          "includes": [
            "#include \"src/shared/hci.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include \"monitor/bt.h\"",
            "#include <sys/uio.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hci.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/mainloop.h\"\n#include \"monitor/bt.h\"\n#include <sys/uio.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstruct bt_hci *bt_hci_ref(struct bt_hci *hci)\n{\n\tif (!hci)\n\t\treturn NULL;\n\n\t__sync_fetch_and_add(&hci->ref_count, 1);\n\n\treturn hci;\n}"
        }
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "hci"
          ],
          "line": 314
        },
        "resolved": true,
        "details": {
          "function_name": "evt_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hci.c",
          "lines": "100-108",
          "snippet": "static void evt_free(void *data)\n{\n\tstruct evt *evt = data;\n\n\tif (evt->destroy)\n\t\tevt->destroy(evt->user_data);\n\n\tfree(evt);\n}",
          "includes": [
            "#include \"src/shared/hci.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include \"monitor/bt.h\"",
            "#include <sys/uio.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hci.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/mainloop.h\"\n#include \"monitor/bt.h\"\n#include <sys/uio.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void evt_free(void *data)\n{\n\tstruct evt *evt = data;\n\n\tif (evt->destroy)\n\t\tevt->destroy(evt->user_data);\n\n\tfree(evt);\n}"
        }
      },
      {
        "call_info": {
          "callee": "io_destroy",
          "args": [
            "hci->io"
          ],
          "line": 313
        },
        "resolved": true,
        "details": {
          "function_name": "io_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-glib.c",
          "lines": "111-135",
          "snippet": "void io_destroy(struct io *io)\n{\n\tif (!io)\n\t\treturn;\n\n\tif (io->read_watch) {\n\t\tg_source_remove(io->read_watch->id);\n\t\tio->read_watch = NULL;\n\t}\n\n\tif (io->write_watch) {\n\t\tg_source_remove(io->write_watch->id);\n\t\tio->write_watch = NULL;\n\t}\n\n\tif (io->disconnect_watch) {\n\t\tg_source_remove(io->disconnect_watch->id);\n\t\tio->disconnect_watch = NULL;\n\t}\n\n\tg_io_channel_unref(io->channel);\n\tio->channel = NULL;\n\n\tio_unref(io);\n}",
          "includes": [
            "#include \"src/shared/io.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/io.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nvoid io_destroy(struct io *io)\n{\n\tif (!io)\n\t\treturn;\n\n\tif (io->read_watch) {\n\t\tg_source_remove(io->read_watch->id);\n\t\tio->read_watch = NULL;\n\t}\n\n\tif (io->write_watch) {\n\t\tg_source_remove(io->write_watch->id);\n\t\tio->write_watch = NULL;\n\t}\n\n\tif (io->disconnect_watch) {\n\t\tg_source_remove(io->disconnect_watch->id);\n\t\tio->disconnect_watch = NULL;\n\t}\n\n\tg_io_channel_unref(io->channel);\n\tio->channel = NULL;\n\n\tio_unref(io);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_destroy",
          "args": [
            "hci->cmd_queue",
            "NULL"
          ],
          "line": 312
        },
        "resolved": true,
        "details": {
          "function_name": "queue_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "68-76",
          "snippet": "void queue_destroy(struct queue *queue, queue_destroy_func_t destroy)\n{\n\tif (!queue)\n\t\treturn;\n\n\tqueue_remove_all(queue, NULL, NULL, destroy);\n\n\tqueue_unref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid queue_destroy(struct queue *queue, queue_destroy_func_t destroy)\n{\n\tif (!queue)\n\t\treturn;\n\n\tqueue_remove_all(queue, NULL, NULL, destroy);\n\n\tqueue_unref(queue);\n}"
        }
      },
      {
        "call_info": {
          "callee": "io_set_read_handler",
          "args": [
            "hci->io",
            "io_read_callback",
            "hci",
            "NULL"
          ],
          "line": 309
        },
        "resolved": true,
        "details": {
          "function_name": "io_set_read_handler",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-glib.c",
          "lines": "248-252",
          "snippet": "bool io_set_read_handler(struct io *io, io_callback_func_t callback,\n\t\t\t\tvoid *user_data, io_destroy_func_t destroy)\n{\n\treturn io_set_handler(io, G_IO_IN, callback, user_data, destroy);\n}",
          "includes": [
            "#include \"src/shared/io.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/io.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nbool io_set_read_handler(struct io *io, io_callback_func_t callback,\n\t\t\t\tvoid *user_data, io_destroy_func_t destroy)\n{\n\treturn io_set_handler(io, G_IO_IN, callback, user_data, destroy);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_new",
          "args": [],
          "line": 307
        },
        "resolved": true,
        "details": {
          "function_name": "queue_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "56-66",
          "snippet": "struct queue *queue_new(void)\n{\n\tstruct queue *queue;\n\n\tqueue = new0(struct queue, 1);\n\tqueue->head = NULL;\n\tqueue->tail = NULL;\n\tqueue->entries = 0;\n\n\treturn queue_ref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nstruct queue *queue_new(void)\n{\n\tstruct queue *queue;\n\n\tqueue = new0(struct queue, 1);\n\tqueue->head = NULL;\n\tqueue->tail = NULL;\n\tqueue->entries = 0;\n\n\treturn queue_ref(queue);\n}"
        }
      },
      {
        "call_info": {
          "callee": "io_new",
          "args": [
            "fd"
          ],
          "line": 293
        },
        "resolved": true,
        "details": {
          "function_name": "io_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-glib.c",
          "lines": "71-90",
          "snippet": "struct io *io_new(int fd)\n{\n\tstruct io *io;\n\n\tif (fd < 0)\n\t\treturn NULL;\n\n\tio = g_try_new0(struct io, 1);\n\tif (!io)\n\t\treturn NULL;\n\n\tio->channel = g_io_channel_unix_new(fd);\n\n\tg_io_channel_set_encoding(io->channel, NULL, NULL);\n\tg_io_channel_set_buffered(io->channel, FALSE);\n\n\tg_io_channel_set_close_on_unref(io->channel, FALSE);\n\n\treturn io_ref(io);\n}",
          "includes": [
            "#include \"src/shared/io.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/io.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nstruct io *io_new(int fd)\n{\n\tstruct io *io;\n\n\tif (fd < 0)\n\t\treturn NULL;\n\n\tio = g_try_new0(struct io, 1);\n\tif (!io)\n\t\treturn NULL;\n\n\tio->channel = g_io_channel_unix_new(fd);\n\n\tg_io_channel_set_encoding(io->channel, NULL, NULL);\n\tg_io_channel_set_buffered(io->channel, FALSE);\n\n\tg_io_channel_set_close_on_unref(io->channel, FALSE);\n\n\treturn io_ref(io);\n}"
        }
      },
      {
        "call_info": {
          "callee": "new0",
          "args": [
            "structbt_hci",
            "1"
          ],
          "line": 292
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/hci.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/mainloop.h\"\n#include \"monitor/bt.h\"\n#include <sys/uio.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic struct bt_hci *create_hci(int fd)\n{\n\tstruct bt_hci *hci;\n\n\tif (fd < 0)\n\t\treturn NULL;\n\n\thci = new0(struct bt_hci, 1);\n\thci->io = io_new(fd);\n\tif (!hci->io) {\n\t\tfree(hci);\n\t\treturn NULL;\n\t}\n\n\thci->is_stream = true;\n\thci->writer_active = false;\n\thci->num_cmds = 1;\n\thci->next_cmd_id = 1;\n\thci->next_evt_id = 1;\n\n\thci->cmd_queue = queue_new();\n\thci->rsp_queue = queue_new();\n\thci->evt_list = queue_new();\n\n\tif (!io_set_read_handler(hci->io, io_read_callback, hci, NULL)) {\n\t\tqueue_destroy(hci->evt_list, NULL);\n\t\tqueue_destroy(hci->rsp_queue, NULL);\n\t\tqueue_destroy(hci->cmd_queue, NULL);\n\t\tio_destroy(hci->io);\n\t\tfree(hci);\n\t\treturn NULL;\n\t}\n\n\treturn bt_hci_ref(hci);\n}"
  },
  {
    "function_name": "io_read_callback",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hci.c",
    "lines": "255-283",
    "snippet": "static bool io_read_callback(struct io *io, void *user_data)\n{\n\tstruct bt_hci *hci = user_data;\n\tuint8_t buf[512];\n\tssize_t len;\n\tint fd;\n\n\tfd = io_get_fd(hci->io);\n\tif (fd < 0)\n\t\treturn false;\n\n\tif (hci->is_stream)\n\t\treturn false;\n\n\tlen = read(fd, buf, sizeof(buf));\n\tif (len < 0)\n\t\treturn false;\n\n\tif (len < 1)\n\t\treturn true;\n\n\tswitch (buf[0]) {\n\tcase BT_H4_EVT_PKT:\n\t\tprocess_event(hci, buf + 1, len - 1);\n\t\tbreak;\n\t}\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/hci.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include \"monitor/bt.h\"",
      "#include <sys/uio.h>",
      "#include <sys/socket.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "process_event",
          "args": [
            "hci",
            "buf + 1",
            "len - 1"
          ],
          "line": 278
        },
        "resolved": true,
        "details": {
          "function_name": "process_event",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hci.c",
          "lines": "215-253",
          "snippet": "static void process_event(struct bt_hci *hci, const void *data, size_t size)\n{\n\tconst struct bt_hci_evt_hdr *hdr = data;\n\tconst struct bt_hci_evt_cmd_complete *cc;\n\tconst struct bt_hci_evt_cmd_status *cs;\n\n\tif (size < sizeof(struct bt_hci_evt_hdr))\n\t\treturn;\n\n\tdata += sizeof(struct bt_hci_evt_hdr);\n\tsize -= sizeof(struct bt_hci_evt_hdr);\n\n\tif (hdr->plen != size)\n\t\treturn;\n\n\tswitch (hdr->evt) {\n\tcase BT_HCI_EVT_CMD_COMPLETE:\n\t\tif (size < sizeof(*cc))\n\t\t\treturn;\n\t\tcc = data;\n\t\thci->num_cmds = cc->ncmd;\n\t\tprocess_response(hci, le16_to_cpu(cc->opcode),\n\t\t\t\t\t\tdata + sizeof(*cc),\n\t\t\t\t\t\tsize - sizeof(*cc));\n\t\tbreak;\n\n\tcase BT_HCI_EVT_CMD_STATUS:\n\t\tif (size < sizeof(*cs))\n\t\t\treturn;\n\t\tcs = data;\n\t\thci->num_cmds = cs->ncmd;\n\t\tprocess_response(hci, le16_to_cpu(cs->opcode), &cs->status, 1);\n\t\tbreak;\n\n\tdefault:\n\t\tqueue_foreach(hci->evt_list, process_notify, (void *) hdr);\n\t\tbreak;\n\t}\n}",
          "includes": [
            "#include \"src/shared/hci.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include \"monitor/bt.h\"",
            "#include <sys/uio.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hci.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/mainloop.h\"\n#include \"monitor/bt.h\"\n#include <sys/uio.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void process_event(struct bt_hci *hci, const void *data, size_t size)\n{\n\tconst struct bt_hci_evt_hdr *hdr = data;\n\tconst struct bt_hci_evt_cmd_complete *cc;\n\tconst struct bt_hci_evt_cmd_status *cs;\n\n\tif (size < sizeof(struct bt_hci_evt_hdr))\n\t\treturn;\n\n\tdata += sizeof(struct bt_hci_evt_hdr);\n\tsize -= sizeof(struct bt_hci_evt_hdr);\n\n\tif (hdr->plen != size)\n\t\treturn;\n\n\tswitch (hdr->evt) {\n\tcase BT_HCI_EVT_CMD_COMPLETE:\n\t\tif (size < sizeof(*cc))\n\t\t\treturn;\n\t\tcc = data;\n\t\thci->num_cmds = cc->ncmd;\n\t\tprocess_response(hci, le16_to_cpu(cc->opcode),\n\t\t\t\t\t\tdata + sizeof(*cc),\n\t\t\t\t\t\tsize - sizeof(*cc));\n\t\tbreak;\n\n\tcase BT_HCI_EVT_CMD_STATUS:\n\t\tif (size < sizeof(*cs))\n\t\t\treturn;\n\t\tcs = data;\n\t\thci->num_cmds = cs->ncmd;\n\t\tprocess_response(hci, le16_to_cpu(cs->opcode), &cs->status, 1);\n\t\tbreak;\n\n\tdefault:\n\t\tqueue_foreach(hci->evt_list, process_notify, (void *) hdr);\n\t\tbreak;\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "read",
          "args": [
            "fd",
            "buf",
            "sizeof(buf)"
          ],
          "line": 269
        },
        "resolved": true,
        "details": {
          "function_name": "notify_client_ready",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-client.c",
          "lines": "1221-1250",
          "snippet": "static void notify_client_ready(struct bt_gatt_client *client, bool success,\n\t\t\t\t\t\t\tuint8_t att_ecode)\n{\n\tconst struct queue_entry *entry;\n\n\tif (client->ready)\n\t\treturn;\n\n\tbt_gatt_client_ref(client);\n\tclient->ready = success;\n\n\tfor (entry = queue_get_entries(client->ready_cbs); entry;\n\t\t\t\t\t\t\tentry = entry->next) {\n\t\tstruct ready_cb *ready = entry->data;\n\n\t\tready->callback(success, att_ecode, ready->data);\n\t}\n\n\tqueue_remove_all(client->ready_cbs, NULL, NULL, ready_destroy);\n\n\t/* Notify clones */\n\tfor (entry = queue_get_entries(client->clones); entry;\n\t\t\t\t\t\t\tentry = entry->next) {\n\t\tstruct bt_gatt_client *clone = entry->data;\n\n\t\tnotify_client_ready(clone, success, att_ecode);\n\t}\n\n\tbt_gatt_client_unref(client);\n}",
          "includes": [
            "#include <sys/uio.h>",
            "#include <limits.h>",
            "#include <assert.h>",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-helpers.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/att.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/uio.h>\n#include <limits.h>\n#include <assert.h>\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-helpers.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/att.h\"\n#include <config.h>\n\nstatic void notify_client_ready(struct bt_gatt_client *client, bool success,\n\t\t\t\t\t\t\tuint8_t att_ecode)\n{\n\tconst struct queue_entry *entry;\n\n\tif (client->ready)\n\t\treturn;\n\n\tbt_gatt_client_ref(client);\n\tclient->ready = success;\n\n\tfor (entry = queue_get_entries(client->ready_cbs); entry;\n\t\t\t\t\t\t\tentry = entry->next) {\n\t\tstruct ready_cb *ready = entry->data;\n\n\t\tready->callback(success, att_ecode, ready->data);\n\t}\n\n\tqueue_remove_all(client->ready_cbs, NULL, NULL, ready_destroy);\n\n\t/* Notify clones */\n\tfor (entry = queue_get_entries(client->clones); entry;\n\t\t\t\t\t\t\tentry = entry->next) {\n\t\tstruct bt_gatt_client *clone = entry->data;\n\n\t\tnotify_client_ready(clone, success, att_ecode);\n\t}\n\n\tbt_gatt_client_unref(client);\n}"
        }
      },
      {
        "call_info": {
          "callee": "io_get_fd",
          "args": [
            "hci->io"
          ],
          "line": 262
        },
        "resolved": true,
        "details": {
          "function_name": "io_get_fd",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-glib.c",
          "lines": "137-143",
          "snippet": "int io_get_fd(struct io *io)\n{\n\tif (!io)\n\t\treturn -ENOTCONN;\n\n\treturn g_io_channel_unix_get_fd(io->channel);\n}",
          "includes": [
            "#include \"src/shared/io.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/io.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nint io_get_fd(struct io *io)\n{\n\tif (!io)\n\t\treturn -ENOTCONN;\n\n\treturn g_io_channel_unix_get_fd(io->channel);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/hci.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/mainloop.h\"\n#include \"monitor/bt.h\"\n#include <sys/uio.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic bool io_read_callback(struct io *io, void *user_data)\n{\n\tstruct bt_hci *hci = user_data;\n\tuint8_t buf[512];\n\tssize_t len;\n\tint fd;\n\n\tfd = io_get_fd(hci->io);\n\tif (fd < 0)\n\t\treturn false;\n\n\tif (hci->is_stream)\n\t\treturn false;\n\n\tlen = read(fd, buf, sizeof(buf));\n\tif (len < 0)\n\t\treturn false;\n\n\tif (len < 1)\n\t\treturn true;\n\n\tswitch (buf[0]) {\n\tcase BT_H4_EVT_PKT:\n\t\tprocess_event(hci, buf + 1, len - 1);\n\t\tbreak;\n\t}\n\n\treturn true;\n}"
  },
  {
    "function_name": "process_event",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hci.c",
    "lines": "215-253",
    "snippet": "static void process_event(struct bt_hci *hci, const void *data, size_t size)\n{\n\tconst struct bt_hci_evt_hdr *hdr = data;\n\tconst struct bt_hci_evt_cmd_complete *cc;\n\tconst struct bt_hci_evt_cmd_status *cs;\n\n\tif (size < sizeof(struct bt_hci_evt_hdr))\n\t\treturn;\n\n\tdata += sizeof(struct bt_hci_evt_hdr);\n\tsize -= sizeof(struct bt_hci_evt_hdr);\n\n\tif (hdr->plen != size)\n\t\treturn;\n\n\tswitch (hdr->evt) {\n\tcase BT_HCI_EVT_CMD_COMPLETE:\n\t\tif (size < sizeof(*cc))\n\t\t\treturn;\n\t\tcc = data;\n\t\thci->num_cmds = cc->ncmd;\n\t\tprocess_response(hci, le16_to_cpu(cc->opcode),\n\t\t\t\t\t\tdata + sizeof(*cc),\n\t\t\t\t\t\tsize - sizeof(*cc));\n\t\tbreak;\n\n\tcase BT_HCI_EVT_CMD_STATUS:\n\t\tif (size < sizeof(*cs))\n\t\t\treturn;\n\t\tcs = data;\n\t\thci->num_cmds = cs->ncmd;\n\t\tprocess_response(hci, le16_to_cpu(cs->opcode), &cs->status, 1);\n\t\tbreak;\n\n\tdefault:\n\t\tqueue_foreach(hci->evt_list, process_notify, (void *) hdr);\n\t\tbreak;\n\t}\n}",
    "includes": [
      "#include \"src/shared/hci.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include \"monitor/bt.h\"",
      "#include <sys/uio.h>",
      "#include <sys/socket.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_foreach",
          "args": [
            "hci->evt_list",
            "process_notify",
            "(void *) hdr"
          ],
          "line": 250
        },
        "resolved": true,
        "details": {
          "function_name": "queue_foreach",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "203-224",
          "snippet": "void queue_foreach(struct queue *queue, queue_foreach_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue || !function)\n\t\treturn;\n\n\tentry = queue->head;\n\tif (!entry)\n\t\treturn;\n\n\tqueue_ref(queue);\n\twhile (entry && queue->head && queue->ref_count > 1) {\n\t\tstruct queue_entry *next;\n\n\t\tnext = entry->next;\n\t\tfunction(entry->data, user_data);\n\t\tentry = next;\n\t}\n\tqueue_unref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid queue_foreach(struct queue *queue, queue_foreach_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue || !function)\n\t\treturn;\n\n\tentry = queue->head;\n\tif (!entry)\n\t\treturn;\n\n\tqueue_ref(queue);\n\twhile (entry && queue->head && queue->ref_count > 1) {\n\t\tstruct queue_entry *next;\n\n\t\tnext = entry->next;\n\t\tfunction(entry->data, user_data);\n\t\tentry = next;\n\t}\n\tqueue_unref(queue);\n}"
        }
      },
      {
        "call_info": {
          "callee": "process_response",
          "args": [
            "hci",
            "le16_to_cpu(cs->opcode)",
            "&cs->status",
            "1"
          ],
          "line": 246
        },
        "resolved": true,
        "details": {
          "function_name": "process_response",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hci.c",
          "lines": "183-203",
          "snippet": "static void process_response(struct bt_hci *hci, uint16_t opcode,\n\t\t\t\t\tconst void *data, size_t size)\n{\n\tstruct cmd *cmd;\n\n\tif (opcode == BT_HCI_CMD_NOP)\n\t\tgoto done;\n\n\tcmd = queue_remove_if(hci->rsp_queue, match_cmd_opcode,\n\t\t\t\t\t\tUINT_TO_PTR(opcode));\n\tif (!cmd)\n\t\treturn;\n\n\tif (cmd->callback)\n\t\tcmd->callback(data, size, cmd->user_data);\n\n\tcmd_free(cmd);\n\ndone:\n\twakeup_writer(hci);\n}",
          "includes": [
            "#include \"src/shared/hci.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include \"monitor/bt.h\"",
            "#include <sys/uio.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hci.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/mainloop.h\"\n#include \"monitor/bt.h\"\n#include <sys/uio.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void process_response(struct bt_hci *hci, uint16_t opcode,\n\t\t\t\t\tconst void *data, size_t size)\n{\n\tstruct cmd *cmd;\n\n\tif (opcode == BT_HCI_CMD_NOP)\n\t\tgoto done;\n\n\tcmd = queue_remove_if(hci->rsp_queue, match_cmd_opcode,\n\t\t\t\t\t\tUINT_TO_PTR(opcode));\n\tif (!cmd)\n\t\treturn;\n\n\tif (cmd->callback)\n\t\tcmd->callback(data, size, cmd->user_data);\n\n\tcmd_free(cmd);\n\ndone:\n\twakeup_writer(hci);\n}"
        }
      },
      {
        "call_info": {
          "callee": "le16_to_cpu",
          "args": [
            "cs->opcode"
          ],
          "line": 246
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "le16_to_cpu",
          "args": [
            "cc->opcode"
          ],
          "line": 236
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/hci.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/mainloop.h\"\n#include \"monitor/bt.h\"\n#include <sys/uio.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void process_event(struct bt_hci *hci, const void *data, size_t size)\n{\n\tconst struct bt_hci_evt_hdr *hdr = data;\n\tconst struct bt_hci_evt_cmd_complete *cc;\n\tconst struct bt_hci_evt_cmd_status *cs;\n\n\tif (size < sizeof(struct bt_hci_evt_hdr))\n\t\treturn;\n\n\tdata += sizeof(struct bt_hci_evt_hdr);\n\tsize -= sizeof(struct bt_hci_evt_hdr);\n\n\tif (hdr->plen != size)\n\t\treturn;\n\n\tswitch (hdr->evt) {\n\tcase BT_HCI_EVT_CMD_COMPLETE:\n\t\tif (size < sizeof(*cc))\n\t\t\treturn;\n\t\tcc = data;\n\t\thci->num_cmds = cc->ncmd;\n\t\tprocess_response(hci, le16_to_cpu(cc->opcode),\n\t\t\t\t\t\tdata + sizeof(*cc),\n\t\t\t\t\t\tsize - sizeof(*cc));\n\t\tbreak;\n\n\tcase BT_HCI_EVT_CMD_STATUS:\n\t\tif (size < sizeof(*cs))\n\t\t\treturn;\n\t\tcs = data;\n\t\thci->num_cmds = cs->ncmd;\n\t\tprocess_response(hci, le16_to_cpu(cs->opcode), &cs->status, 1);\n\t\tbreak;\n\n\tdefault:\n\t\tqueue_foreach(hci->evt_list, process_notify, (void *) hdr);\n\t\tbreak;\n\t}\n}"
  },
  {
    "function_name": "process_notify",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hci.c",
    "lines": "205-213",
    "snippet": "static void process_notify(void *data, void *user_data)\n{\n\tstruct bt_hci_evt_hdr *hdr = user_data;\n\tstruct evt *evt = data;\n\n\tif (evt->event == hdr->evt)\n\t\tevt->callback(user_data + sizeof(struct bt_hci_evt_hdr),\n\t\t\t\t\t\thdr->plen, evt->user_data);\n}",
    "includes": [
      "#include \"src/shared/hci.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include \"monitor/bt.h\"",
      "#include <sys/uio.h>",
      "#include <sys/socket.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "evt->callback",
          "args": [
            "user_data + sizeof(struct bt_hci_evt_hdr)",
            "hdr->plen",
            "evt->user_data"
          ],
          "line": 211
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/hci.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/mainloop.h\"\n#include \"monitor/bt.h\"\n#include <sys/uio.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void process_notify(void *data, void *user_data)\n{\n\tstruct bt_hci_evt_hdr *hdr = user_data;\n\tstruct evt *evt = data;\n\n\tif (evt->event == hdr->evt)\n\t\tevt->callback(user_data + sizeof(struct bt_hci_evt_hdr),\n\t\t\t\t\t\thdr->plen, evt->user_data);\n}"
  },
  {
    "function_name": "process_response",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hci.c",
    "lines": "183-203",
    "snippet": "static void process_response(struct bt_hci *hci, uint16_t opcode,\n\t\t\t\t\tconst void *data, size_t size)\n{\n\tstruct cmd *cmd;\n\n\tif (opcode == BT_HCI_CMD_NOP)\n\t\tgoto done;\n\n\tcmd = queue_remove_if(hci->rsp_queue, match_cmd_opcode,\n\t\t\t\t\t\tUINT_TO_PTR(opcode));\n\tif (!cmd)\n\t\treturn;\n\n\tif (cmd->callback)\n\t\tcmd->callback(data, size, cmd->user_data);\n\n\tcmd_free(cmd);\n\ndone:\n\twakeup_writer(hci);\n}",
    "includes": [
      "#include \"src/shared/hci.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include \"monitor/bt.h\"",
      "#include <sys/uio.h>",
      "#include <sys/socket.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "wakeup_writer",
          "args": [
            "hci"
          ],
          "line": 202
        },
        "resolved": true,
        "details": {
          "function_name": "wakeup_writer",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hci.c",
          "lines": "158-173",
          "snippet": "static void wakeup_writer(struct bt_hci *hci)\n{\n\tif (hci->writer_active)\n\t\treturn;\n\n\tif (hci->num_cmds < 1)\n\t\treturn;\n\n\tif (queue_isempty(hci->cmd_queue))\n\t\treturn;\n\n\tif (!io_set_write_handler(hci->io, io_write_callback, hci, NULL))\n\t\treturn;\n\n\thci->writer_active = true;\n}",
          "includes": [
            "#include \"src/shared/hci.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include \"monitor/bt.h\"",
            "#include <sys/uio.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hci.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/mainloop.h\"\n#include \"monitor/bt.h\"\n#include <sys/uio.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void wakeup_writer(struct bt_hci *hci)\n{\n\tif (hci->writer_active)\n\t\treturn;\n\n\tif (hci->num_cmds < 1)\n\t\treturn;\n\n\tif (queue_isempty(hci->cmd_queue))\n\t\treturn;\n\n\tif (!io_set_write_handler(hci->io, io_write_callback, hci, NULL))\n\t\treturn;\n\n\thci->writer_active = true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "cmd_free",
          "args": [
            "cmd"
          ],
          "line": 199
        },
        "resolved": true,
        "details": {
          "function_name": "cmd_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hci.c",
          "lines": "89-98",
          "snippet": "static void cmd_free(void *data)\n{\n\tstruct cmd *cmd = data;\n\n\tif (cmd->destroy)\n\t\tcmd->destroy(cmd->user_data);\n\n\tfree(cmd->data);\n\tfree(cmd);\n}",
          "includes": [
            "#include \"src/shared/hci.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include \"monitor/bt.h\"",
            "#include <sys/uio.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hci.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/mainloop.h\"\n#include \"monitor/bt.h\"\n#include <sys/uio.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void cmd_free(void *data)\n{\n\tstruct cmd *cmd = data;\n\n\tif (cmd->destroy)\n\t\tcmd->destroy(cmd->user_data);\n\n\tfree(cmd->data);\n\tfree(cmd);\n}"
        }
      },
      {
        "call_info": {
          "callee": "cmd->callback",
          "args": [
            "data",
            "size",
            "cmd->user_data"
          ],
          "line": 197
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "queue_remove_if",
          "args": [
            "hci->rsp_queue",
            "match_cmd_opcode",
            "UINT_TO_PTR(opcode)"
          ],
          "line": 191
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_if",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "278-316",
          "snippet": "void *queue_remove_if(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry, *prev = NULL;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tentry = queue->head;\n\n\twhile (entry) {\n\t\tif (function(entry->data, user_data)) {\n\t\t\tvoid *data;\n\n\t\t\tif (prev)\n\t\t\t\tprev->next = entry->next;\n\t\t\telse\n\t\t\t\tqueue->head = entry->next;\n\n\t\t\tif (!entry->next)\n\t\t\t\tqueue->tail = prev;\n\n\t\t\tdata = entry->data;\n\n\t\t\tfree(entry);\n\t\t\tqueue->entries--;\n\n\t\t\treturn data;\n\t\t} else {\n\t\t\tprev = entry;\n\t\t\tentry = entry->next;\n\t\t}\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid *queue_remove_if(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry, *prev = NULL;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tentry = queue->head;\n\n\twhile (entry) {\n\t\tif (function(entry->data, user_data)) {\n\t\t\tvoid *data;\n\n\t\t\tif (prev)\n\t\t\t\tprev->next = entry->next;\n\t\t\telse\n\t\t\t\tqueue->head = entry->next;\n\n\t\t\tif (!entry->next)\n\t\t\t\tqueue->tail = prev;\n\n\t\t\tdata = entry->data;\n\n\t\t\tfree(entry);\n\t\t\tqueue->entries--;\n\n\t\t\treturn data;\n\t\t} else {\n\t\t\tprev = entry;\n\t\t\tentry = entry->next;\n\t\t}\n\t}\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "UINT_TO_PTR",
          "args": [
            "opcode"
          ],
          "line": 192
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/hci.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/mainloop.h\"\n#include \"monitor/bt.h\"\n#include <sys/uio.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void process_response(struct bt_hci *hci, uint16_t opcode,\n\t\t\t\t\tconst void *data, size_t size)\n{\n\tstruct cmd *cmd;\n\n\tif (opcode == BT_HCI_CMD_NOP)\n\t\tgoto done;\n\n\tcmd = queue_remove_if(hci->rsp_queue, match_cmd_opcode,\n\t\t\t\t\t\tUINT_TO_PTR(opcode));\n\tif (!cmd)\n\t\treturn;\n\n\tif (cmd->callback)\n\t\tcmd->callback(data, size, cmd->user_data);\n\n\tcmd_free(cmd);\n\ndone:\n\twakeup_writer(hci);\n}"
  },
  {
    "function_name": "match_cmd_opcode",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hci.c",
    "lines": "175-181",
    "snippet": "static bool match_cmd_opcode(const void *a, const void *b)\n{\n\tconst struct cmd *cmd = a;\n\tuint16_t opcode = PTR_TO_UINT(b);\n\n\treturn cmd->opcode == opcode;\n}",
    "includes": [
      "#include \"src/shared/hci.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include \"monitor/bt.h\"",
      "#include <sys/uio.h>",
      "#include <sys/socket.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "PTR_TO_UINT",
          "args": [
            "b"
          ],
          "line": 178
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/hci.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/mainloop.h\"\n#include \"monitor/bt.h\"\n#include <sys/uio.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic bool match_cmd_opcode(const void *a, const void *b)\n{\n\tconst struct cmd *cmd = a;\n\tuint16_t opcode = PTR_TO_UINT(b);\n\n\treturn cmd->opcode == opcode;\n}"
  },
  {
    "function_name": "wakeup_writer",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hci.c",
    "lines": "158-173",
    "snippet": "static void wakeup_writer(struct bt_hci *hci)\n{\n\tif (hci->writer_active)\n\t\treturn;\n\n\tif (hci->num_cmds < 1)\n\t\treturn;\n\n\tif (queue_isempty(hci->cmd_queue))\n\t\treturn;\n\n\tif (!io_set_write_handler(hci->io, io_write_callback, hci, NULL))\n\t\treturn;\n\n\thci->writer_active = true;\n}",
    "includes": [
      "#include \"src/shared/hci.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include \"monitor/bt.h\"",
      "#include <sys/uio.h>",
      "#include <sys/socket.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "io_set_write_handler",
          "args": [
            "hci->io",
            "io_write_callback",
            "hci",
            "NULL"
          ],
          "line": 169
        },
        "resolved": true,
        "details": {
          "function_name": "io_set_write_handler",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-glib.c",
          "lines": "254-258",
          "snippet": "bool io_set_write_handler(struct io *io, io_callback_func_t callback,\n\t\t\t\tvoid *user_data, io_destroy_func_t destroy)\n{\n\treturn io_set_handler(io, G_IO_OUT, callback, user_data, destroy);\n}",
          "includes": [
            "#include \"src/shared/io.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/io.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nbool io_set_write_handler(struct io *io, io_callback_func_t callback,\n\t\t\t\tvoid *user_data, io_destroy_func_t destroy)\n{\n\treturn io_set_handler(io, G_IO_OUT, callback, user_data, destroy);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_isempty",
          "args": [
            "hci->cmd_queue"
          ],
          "line": 166
        },
        "resolved": true,
        "details": {
          "function_name": "queue_isempty",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "380-386",
          "snippet": "bool queue_isempty(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn true;\n\n\treturn queue->entries == 0;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_isempty(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn true;\n\n\treturn queue->entries == 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/hci.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/mainloop.h\"\n#include \"monitor/bt.h\"\n#include <sys/uio.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void wakeup_writer(struct bt_hci *hci)\n{\n\tif (hci->writer_active)\n\t\treturn;\n\n\tif (hci->num_cmds < 1)\n\t\treturn;\n\n\tif (queue_isempty(hci->cmd_queue))\n\t\treturn;\n\n\tif (!io_set_write_handler(hci->io, io_write_callback, hci, NULL))\n\t\treturn;\n\n\thci->writer_active = true;\n}"
  },
  {
    "function_name": "io_write_callback",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hci.c",
    "lines": "142-156",
    "snippet": "static bool io_write_callback(struct io *io, void *user_data)\n{\n\tstruct bt_hci *hci = user_data;\n\tstruct cmd *cmd;\n\n\tcmd = queue_pop_head(hci->cmd_queue);\n\tif (cmd) {\n\t\tsend_command(hci, cmd->opcode, cmd->data, cmd->size);\n\t\tqueue_push_tail(hci->rsp_queue, cmd);\n\t}\n\n\thci->writer_active = false;\n\n\treturn false;\n}",
    "includes": [
      "#include \"src/shared/hci.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include \"monitor/bt.h\"",
      "#include <sys/uio.h>",
      "#include <sys/socket.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_push_tail",
          "args": [
            "hci->rsp_queue",
            "cmd"
          ],
          "line": 150
        },
        "resolved": true,
        "details": {
          "function_name": "queue_push_tail",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "88-108",
          "snippet": "bool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "send_command",
          "args": [
            "hci",
            "cmd->opcode",
            "cmd->data",
            "cmd->size"
          ],
          "line": 149
        },
        "resolved": true,
        "details": {
          "function_name": "send_command",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hci.c",
          "lines": "110-140",
          "snippet": "static void send_command(struct bt_hci *hci, uint16_t opcode,\n\t\t\t\t\t\tvoid *data, uint8_t size)\n{\n\tuint8_t type = BT_H4_CMD_PKT;\n\tstruct bt_hci_cmd_hdr hdr;\n\tstruct iovec iov[3];\n\tint iovcnt;\n\n\tif (hci->num_cmds < 1)\n\t\treturn;\n\n\thdr.opcode = cpu_to_le16(opcode);\n\thdr.plen = size;\n\n\tiov[0].iov_base = &type;\n\tiov[0].iov_len  = 1;\n\tiov[1].iov_base = &hdr;\n\tiov[1].iov_len  = sizeof(hdr);\n\n\tif (size > 0) {\n\t\tiov[2].iov_base = data;\n\t\tiov[2].iov_len  = size;\n\t\tiovcnt = 3;\n\t} else\n\t\tiovcnt = 2;\n\n\tif (io_send(hci->io, iov, iovcnt) < 0)\n\t\treturn;\n\n\thci->num_cmds--;\n}",
          "includes": [
            "#include \"src/shared/hci.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include \"monitor/bt.h\"",
            "#include <sys/uio.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hci.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/mainloop.h\"\n#include \"monitor/bt.h\"\n#include <sys/uio.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void send_command(struct bt_hci *hci, uint16_t opcode,\n\t\t\t\t\t\tvoid *data, uint8_t size)\n{\n\tuint8_t type = BT_H4_CMD_PKT;\n\tstruct bt_hci_cmd_hdr hdr;\n\tstruct iovec iov[3];\n\tint iovcnt;\n\n\tif (hci->num_cmds < 1)\n\t\treturn;\n\n\thdr.opcode = cpu_to_le16(opcode);\n\thdr.plen = size;\n\n\tiov[0].iov_base = &type;\n\tiov[0].iov_len  = 1;\n\tiov[1].iov_base = &hdr;\n\tiov[1].iov_len  = sizeof(hdr);\n\n\tif (size > 0) {\n\t\tiov[2].iov_base = data;\n\t\tiov[2].iov_len  = size;\n\t\tiovcnt = 3;\n\t} else\n\t\tiovcnt = 2;\n\n\tif (io_send(hci->io, iov, iovcnt) < 0)\n\t\treturn;\n\n\thci->num_cmds--;\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_pop_head",
          "args": [
            "hci->cmd_queue"
          ],
          "line": 147
        },
        "resolved": true,
        "details": {
          "function_name": "queue_pop_head",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "163-185",
          "snippet": "void *queue_pop_head(struct queue *queue)\n{\n\tstruct queue_entry *entry;\n\tvoid *data;\n\n\tif (!queue || !queue->head)\n\t\treturn NULL;\n\n\tentry = queue->head;\n\n\tif (!queue->head->next) {\n\t\tqueue->head = NULL;\n\t\tqueue->tail = NULL;\n\t} else\n\t\tqueue->head = queue->head->next;\n\n\tdata = entry->data;\n\n\tfree(entry);\n\tqueue->entries--;\n\n\treturn data;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid *queue_pop_head(struct queue *queue)\n{\n\tstruct queue_entry *entry;\n\tvoid *data;\n\n\tif (!queue || !queue->head)\n\t\treturn NULL;\n\n\tentry = queue->head;\n\n\tif (!queue->head->next) {\n\t\tqueue->head = NULL;\n\t\tqueue->tail = NULL;\n\t} else\n\t\tqueue->head = queue->head->next;\n\n\tdata = entry->data;\n\n\tfree(entry);\n\tqueue->entries--;\n\n\treturn data;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/hci.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/mainloop.h\"\n#include \"monitor/bt.h\"\n#include <sys/uio.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic bool io_write_callback(struct io *io, void *user_data)\n{\n\tstruct bt_hci *hci = user_data;\n\tstruct cmd *cmd;\n\n\tcmd = queue_pop_head(hci->cmd_queue);\n\tif (cmd) {\n\t\tsend_command(hci, cmd->opcode, cmd->data, cmd->size);\n\t\tqueue_push_tail(hci->rsp_queue, cmd);\n\t}\n\n\thci->writer_active = false;\n\n\treturn false;\n}"
  },
  {
    "function_name": "send_command",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hci.c",
    "lines": "110-140",
    "snippet": "static void send_command(struct bt_hci *hci, uint16_t opcode,\n\t\t\t\t\t\tvoid *data, uint8_t size)\n{\n\tuint8_t type = BT_H4_CMD_PKT;\n\tstruct bt_hci_cmd_hdr hdr;\n\tstruct iovec iov[3];\n\tint iovcnt;\n\n\tif (hci->num_cmds < 1)\n\t\treturn;\n\n\thdr.opcode = cpu_to_le16(opcode);\n\thdr.plen = size;\n\n\tiov[0].iov_base = &type;\n\tiov[0].iov_len  = 1;\n\tiov[1].iov_base = &hdr;\n\tiov[1].iov_len  = sizeof(hdr);\n\n\tif (size > 0) {\n\t\tiov[2].iov_base = data;\n\t\tiov[2].iov_len  = size;\n\t\tiovcnt = 3;\n\t} else\n\t\tiovcnt = 2;\n\n\tif (io_send(hci->io, iov, iovcnt) < 0)\n\t\treturn;\n\n\thci->num_cmds--;\n}",
    "includes": [
      "#include \"src/shared/hci.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include \"monitor/bt.h\"",
      "#include <sys/uio.h>",
      "#include <sys/socket.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "io_send",
          "args": [
            "hci->io",
            "iov",
            "iovcnt"
          ],
          "line": 136
        },
        "resolved": true,
        "details": {
          "function_name": "io_send",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-glib.c",
          "lines": "266-284",
          "snippet": "ssize_t io_send(struct io *io, const struct iovec *iov, int iovcnt)\n{\n\tint fd;\n\tssize_t ret;\n\n\tif (!io || !io->channel)\n\t\treturn -ENOTCONN;\n\n\tfd = io_get_fd(io);\n\n\tdo {\n\t\tret = writev(fd, iov, iovcnt);\n\t} while (ret < 0 && errno == EINTR);\n\n\tif (ret < 0)\n\t\treturn -errno;\n\n\treturn ret;\n}",
          "includes": [
            "#include \"src/shared/io.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/io.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nssize_t io_send(struct io *io, const struct iovec *iov, int iovcnt)\n{\n\tint fd;\n\tssize_t ret;\n\n\tif (!io || !io->channel)\n\t\treturn -ENOTCONN;\n\n\tfd = io_get_fd(io);\n\n\tdo {\n\t\tret = writev(fd, iov, iovcnt);\n\t} while (ret < 0 && errno == EINTR);\n\n\tif (ret < 0)\n\t\treturn -errno;\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "cpu_to_le16",
          "args": [
            "opcode"
          ],
          "line": 121
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/hci.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/mainloop.h\"\n#include \"monitor/bt.h\"\n#include <sys/uio.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void send_command(struct bt_hci *hci, uint16_t opcode,\n\t\t\t\t\t\tvoid *data, uint8_t size)\n{\n\tuint8_t type = BT_H4_CMD_PKT;\n\tstruct bt_hci_cmd_hdr hdr;\n\tstruct iovec iov[3];\n\tint iovcnt;\n\n\tif (hci->num_cmds < 1)\n\t\treturn;\n\n\thdr.opcode = cpu_to_le16(opcode);\n\thdr.plen = size;\n\n\tiov[0].iov_base = &type;\n\tiov[0].iov_len  = 1;\n\tiov[1].iov_base = &hdr;\n\tiov[1].iov_len  = sizeof(hdr);\n\n\tif (size > 0) {\n\t\tiov[2].iov_base = data;\n\t\tiov[2].iov_len  = size;\n\t\tiovcnt = 3;\n\t} else\n\t\tiovcnt = 2;\n\n\tif (io_send(hci->io, iov, iovcnt) < 0)\n\t\treturn;\n\n\thci->num_cmds--;\n}"
  },
  {
    "function_name": "evt_free",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hci.c",
    "lines": "100-108",
    "snippet": "static void evt_free(void *data)\n{\n\tstruct evt *evt = data;\n\n\tif (evt->destroy)\n\t\tevt->destroy(evt->user_data);\n\n\tfree(evt);\n}",
    "includes": [
      "#include \"src/shared/hci.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include \"monitor/bt.h\"",
      "#include <sys/uio.h>",
      "#include <sys/socket.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "evt"
          ],
          "line": 107
        },
        "resolved": true,
        "details": {
          "function_name": "evt_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hci.c",
          "lines": "100-108",
          "snippet": "static void evt_free(void *data)\n{\n\tstruct evt *evt = data;\n\n\tif (evt->destroy)\n\t\tevt->destroy(evt->user_data);\n\n\tfree(evt);\n}",
          "note": "cyclic_reference_detected"
        }
      },
      {
        "call_info": {
          "callee": "evt->destroy",
          "args": [
            "evt->user_data"
          ],
          "line": 105
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/hci.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/mainloop.h\"\n#include \"monitor/bt.h\"\n#include <sys/uio.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void evt_free(void *data)\n{\n\tstruct evt *evt = data;\n\n\tif (evt->destroy)\n\t\tevt->destroy(evt->user_data);\n\n\tfree(evt);\n}"
  },
  {
    "function_name": "cmd_free",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hci.c",
    "lines": "89-98",
    "snippet": "static void cmd_free(void *data)\n{\n\tstruct cmd *cmd = data;\n\n\tif (cmd->destroy)\n\t\tcmd->destroy(cmd->user_data);\n\n\tfree(cmd->data);\n\tfree(cmd);\n}",
    "includes": [
      "#include \"src/shared/hci.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include \"monitor/bt.h\"",
      "#include <sys/uio.h>",
      "#include <sys/socket.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "cmd"
          ],
          "line": 97
        },
        "resolved": true,
        "details": {
          "function_name": "evt_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hci.c",
          "lines": "100-108",
          "snippet": "static void evt_free(void *data)\n{\n\tstruct evt *evt = data;\n\n\tif (evt->destroy)\n\t\tevt->destroy(evt->user_data);\n\n\tfree(evt);\n}",
          "includes": [
            "#include \"src/shared/hci.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include \"monitor/bt.h\"",
            "#include <sys/uio.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hci.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/mainloop.h\"\n#include \"monitor/bt.h\"\n#include <sys/uio.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void evt_free(void *data)\n{\n\tstruct evt *evt = data;\n\n\tif (evt->destroy)\n\t\tevt->destroy(evt->user_data);\n\n\tfree(evt);\n}"
        }
      },
      {
        "call_info": {
          "callee": "cmd->destroy",
          "args": [
            "cmd->user_data"
          ],
          "line": 94
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/hci.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/mainloop.h\"\n#include \"monitor/bt.h\"\n#include <sys/uio.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void cmd_free(void *data)\n{\n\tstruct cmd *cmd = data;\n\n\tif (cmd->destroy)\n\t\tcmd->destroy(cmd->user_data);\n\n\tfree(cmd->data);\n\tfree(cmd);\n}"
  }
]