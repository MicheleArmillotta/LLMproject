[
  {
    "function_name": "mgmt_unregister_all",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mgmt.c",
    "lines": "788-801",
    "snippet": "bool mgmt_unregister_all(struct mgmt *mgmt)\n{\n\tif (!mgmt)\n\t\treturn false;\n\n\tif (mgmt->in_notify) {\n\t\tqueue_foreach(mgmt->notify_list, mark_notify_removed,\n\t\t\t\t\t\tUINT_TO_PTR(MGMT_INDEX_NONE));\n\t\tmgmt->need_notify_cleanup = true;\n\t} else\n\t\tqueue_remove_all(mgmt->notify_list, NULL, NULL, destroy_notify);\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"lib/hci.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_remove_all",
          "args": [
            "mgmt->notify_list",
            "NULL",
            "NULL",
            "destroy_notify"
          ],
          "line": 798
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_all",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "318-362",
          "snippet": "unsigned int queue_remove_all(struct queue *queue, queue_match_func_t function,\n\t\t\t\tvoid *user_data, queue_destroy_func_t destroy)\n{\n\tstruct queue_entry *entry;\n\tunsigned int count = 0;\n\n\tif (!queue)\n\t\treturn 0;\n\n\tentry = queue->head;\n\n\tif (function) {\n\t\twhile (entry) {\n\t\t\tvoid *data;\n\t\t\tunsigned int entries = queue->entries;\n\n\t\t\tdata = queue_remove_if(queue, function, user_data);\n\t\t\tif (entries == queue->entries)\n\t\t\t\tbreak;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(data);\n\n\t\t\tcount++;\n\t\t}\n\t} else {\n\t\tqueue->head = NULL;\n\t\tqueue->tail = NULL;\n\t\tqueue->entries = 0;\n\n\t\twhile (entry) {\n\t\t\tstruct queue_entry *tmp = entry;\n\n\t\t\tentry = entry->next;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(tmp->data);\n\n\t\t\tfree(tmp);\n\t\t\tcount++;\n\t\t}\n\t}\n\n\treturn count;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nunsigned int queue_remove_all(struct queue *queue, queue_match_func_t function,\n\t\t\t\tvoid *user_data, queue_destroy_func_t destroy)\n{\n\tstruct queue_entry *entry;\n\tunsigned int count = 0;\n\n\tif (!queue)\n\t\treturn 0;\n\n\tentry = queue->head;\n\n\tif (function) {\n\t\twhile (entry) {\n\t\t\tvoid *data;\n\t\t\tunsigned int entries = queue->entries;\n\n\t\t\tdata = queue_remove_if(queue, function, user_data);\n\t\t\tif (entries == queue->entries)\n\t\t\t\tbreak;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(data);\n\n\t\t\tcount++;\n\t\t}\n\t} else {\n\t\tqueue->head = NULL;\n\t\tqueue->tail = NULL;\n\t\tqueue->entries = 0;\n\n\t\twhile (entry) {\n\t\t\tstruct queue_entry *tmp = entry;\n\n\t\t\tentry = entry->next;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(tmp->data);\n\n\t\t\tfree(tmp);\n\t\t\tcount++;\n\t\t}\n\t}\n\n\treturn count;\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_foreach",
          "args": [
            "mgmt->notify_list",
            "mark_notify_removed",
            "UINT_TO_PTR(MGMT_INDEX_NONE)"
          ],
          "line": 794
        },
        "resolved": true,
        "details": {
          "function_name": "queue_foreach",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "203-224",
          "snippet": "void queue_foreach(struct queue *queue, queue_foreach_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue || !function)\n\t\treturn;\n\n\tentry = queue->head;\n\tif (!entry)\n\t\treturn;\n\n\tqueue_ref(queue);\n\twhile (entry && queue->head && queue->ref_count > 1) {\n\t\tstruct queue_entry *next;\n\n\t\tnext = entry->next;\n\t\tfunction(entry->data, user_data);\n\t\tentry = next;\n\t}\n\tqueue_unref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid queue_foreach(struct queue *queue, queue_foreach_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue || !function)\n\t\treturn;\n\n\tentry = queue->head;\n\tif (!entry)\n\t\treturn;\n\n\tqueue_ref(queue);\n\twhile (entry && queue->head && queue->ref_count > 1) {\n\t\tstruct queue_entry *next;\n\n\t\tnext = entry->next;\n\t\tfunction(entry->data, user_data);\n\t\tentry = next;\n\t}\n\tqueue_unref(queue);\n}"
        }
      },
      {
        "call_info": {
          "callee": "UINT_TO_PTR",
          "args": [
            "MGMT_INDEX_NONE"
          ],
          "line": 795
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/mgmt.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"lib/hci.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nbool mgmt_unregister_all(struct mgmt *mgmt)\n{\n\tif (!mgmt)\n\t\treturn false;\n\n\tif (mgmt->in_notify) {\n\t\tqueue_foreach(mgmt->notify_list, mark_notify_removed,\n\t\t\t\t\t\tUINT_TO_PTR(MGMT_INDEX_NONE));\n\t\tmgmt->need_notify_cleanup = true;\n\t} else\n\t\tqueue_remove_all(mgmt->notify_list, NULL, NULL, destroy_notify);\n\n\treturn true;\n}"
  },
  {
    "function_name": "mgmt_unregister_index",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mgmt.c",
    "lines": "772-786",
    "snippet": "bool mgmt_unregister_index(struct mgmt *mgmt, uint16_t index)\n{\n\tif (!mgmt)\n\t\treturn false;\n\n\tif (mgmt->in_notify) {\n\t\tqueue_foreach(mgmt->notify_list, mark_notify_removed,\n\t\t\t\t\t\t\tUINT_TO_PTR(index));\n\t\tmgmt->need_notify_cleanup = true;\n\t} else\n\t\tqueue_remove_all(mgmt->notify_list, match_notify_index,\n\t\t\t\t\tUINT_TO_PTR(index), destroy_notify);\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"lib/hci.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_remove_all",
          "args": [
            "mgmt->notify_list",
            "match_notify_index",
            "UINT_TO_PTR(index)",
            "destroy_notify"
          ],
          "line": 782
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_all",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "318-362",
          "snippet": "unsigned int queue_remove_all(struct queue *queue, queue_match_func_t function,\n\t\t\t\tvoid *user_data, queue_destroy_func_t destroy)\n{\n\tstruct queue_entry *entry;\n\tunsigned int count = 0;\n\n\tif (!queue)\n\t\treturn 0;\n\n\tentry = queue->head;\n\n\tif (function) {\n\t\twhile (entry) {\n\t\t\tvoid *data;\n\t\t\tunsigned int entries = queue->entries;\n\n\t\t\tdata = queue_remove_if(queue, function, user_data);\n\t\t\tif (entries == queue->entries)\n\t\t\t\tbreak;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(data);\n\n\t\t\tcount++;\n\t\t}\n\t} else {\n\t\tqueue->head = NULL;\n\t\tqueue->tail = NULL;\n\t\tqueue->entries = 0;\n\n\t\twhile (entry) {\n\t\t\tstruct queue_entry *tmp = entry;\n\n\t\t\tentry = entry->next;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(tmp->data);\n\n\t\t\tfree(tmp);\n\t\t\tcount++;\n\t\t}\n\t}\n\n\treturn count;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nunsigned int queue_remove_all(struct queue *queue, queue_match_func_t function,\n\t\t\t\tvoid *user_data, queue_destroy_func_t destroy)\n{\n\tstruct queue_entry *entry;\n\tunsigned int count = 0;\n\n\tif (!queue)\n\t\treturn 0;\n\n\tentry = queue->head;\n\n\tif (function) {\n\t\twhile (entry) {\n\t\t\tvoid *data;\n\t\t\tunsigned int entries = queue->entries;\n\n\t\t\tdata = queue_remove_if(queue, function, user_data);\n\t\t\tif (entries == queue->entries)\n\t\t\t\tbreak;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(data);\n\n\t\t\tcount++;\n\t\t}\n\t} else {\n\t\tqueue->head = NULL;\n\t\tqueue->tail = NULL;\n\t\tqueue->entries = 0;\n\n\t\twhile (entry) {\n\t\t\tstruct queue_entry *tmp = entry;\n\n\t\t\tentry = entry->next;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(tmp->data);\n\n\t\t\tfree(tmp);\n\t\t\tcount++;\n\t\t}\n\t}\n\n\treturn count;\n}"
        }
      },
      {
        "call_info": {
          "callee": "UINT_TO_PTR",
          "args": [
            "index"
          ],
          "line": 783
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "queue_foreach",
          "args": [
            "mgmt->notify_list",
            "mark_notify_removed",
            "UINT_TO_PTR(index)"
          ],
          "line": 778
        },
        "resolved": true,
        "details": {
          "function_name": "queue_foreach",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "203-224",
          "snippet": "void queue_foreach(struct queue *queue, queue_foreach_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue || !function)\n\t\treturn;\n\n\tentry = queue->head;\n\tif (!entry)\n\t\treturn;\n\n\tqueue_ref(queue);\n\twhile (entry && queue->head && queue->ref_count > 1) {\n\t\tstruct queue_entry *next;\n\n\t\tnext = entry->next;\n\t\tfunction(entry->data, user_data);\n\t\tentry = next;\n\t}\n\tqueue_unref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid queue_foreach(struct queue *queue, queue_foreach_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue || !function)\n\t\treturn;\n\n\tentry = queue->head;\n\tif (!entry)\n\t\treturn;\n\n\tqueue_ref(queue);\n\twhile (entry && queue->head && queue->ref_count > 1) {\n\t\tstruct queue_entry *next;\n\n\t\tnext = entry->next;\n\t\tfunction(entry->data, user_data);\n\t\tentry = next;\n\t}\n\tqueue_unref(queue);\n}"
        }
      },
      {
        "call_info": {
          "callee": "UINT_TO_PTR",
          "args": [
            "index"
          ],
          "line": 779
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/mgmt.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"lib/hci.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nbool mgmt_unregister_index(struct mgmt *mgmt, uint16_t index)\n{\n\tif (!mgmt)\n\t\treturn false;\n\n\tif (mgmt->in_notify) {\n\t\tqueue_foreach(mgmt->notify_list, mark_notify_removed,\n\t\t\t\t\t\t\tUINT_TO_PTR(index));\n\t\tmgmt->need_notify_cleanup = true;\n\t} else\n\t\tqueue_remove_all(mgmt->notify_list, match_notify_index,\n\t\t\t\t\tUINT_TO_PTR(index), destroy_notify);\n\n\treturn true;\n}"
  },
  {
    "function_name": "mgmt_unregister",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mgmt.c",
    "lines": "749-770",
    "snippet": "bool mgmt_unregister(struct mgmt *mgmt, unsigned int id)\n{\n\tstruct mgmt_notify *notify;\n\n\tif (!mgmt || !id)\n\t\treturn false;\n\n\tnotify = queue_remove_if(mgmt->notify_list, match_notify_id,\n\t\t\t\t\t\t\tUINT_TO_PTR(id));\n\tif (!notify)\n\t\treturn false;\n\n\tif (!mgmt->in_notify) {\n\t\tdestroy_notify(notify);\n\t\treturn true;\n\t}\n\n\tnotify->removed = true;\n\tmgmt->need_notify_cleanup = true;\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"lib/hci.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "destroy_notify",
          "args": [
            "notify"
          ],
          "line": 762
        },
        "resolved": true,
        "details": {
          "function_name": "destroy_notify",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mgmt.c",
          "lines": "111-119",
          "snippet": "static void destroy_notify(void *data)\n{\n\tstruct mgmt_notify *notify = data;\n\n\tif (notify->destroy)\n\t\tnotify->destroy(notify->user_data);\n\n\tfree(notify);\n}",
          "includes": [
            "#include \"src/shared/mgmt.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/mgmt.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"lib/hci.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void destroy_notify(void *data)\n{\n\tstruct mgmt_notify *notify = data;\n\n\tif (notify->destroy)\n\t\tnotify->destroy(notify->user_data);\n\n\tfree(notify);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_remove_if",
          "args": [
            "mgmt->notify_list",
            "match_notify_id",
            "UINT_TO_PTR(id)"
          ],
          "line": 756
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_if",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "278-316",
          "snippet": "void *queue_remove_if(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry, *prev = NULL;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tentry = queue->head;\n\n\twhile (entry) {\n\t\tif (function(entry->data, user_data)) {\n\t\t\tvoid *data;\n\n\t\t\tif (prev)\n\t\t\t\tprev->next = entry->next;\n\t\t\telse\n\t\t\t\tqueue->head = entry->next;\n\n\t\t\tif (!entry->next)\n\t\t\t\tqueue->tail = prev;\n\n\t\t\tdata = entry->data;\n\n\t\t\tfree(entry);\n\t\t\tqueue->entries--;\n\n\t\t\treturn data;\n\t\t} else {\n\t\t\tprev = entry;\n\t\t\tentry = entry->next;\n\t\t}\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid *queue_remove_if(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry, *prev = NULL;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tentry = queue->head;\n\n\twhile (entry) {\n\t\tif (function(entry->data, user_data)) {\n\t\t\tvoid *data;\n\n\t\t\tif (prev)\n\t\t\t\tprev->next = entry->next;\n\t\t\telse\n\t\t\t\tqueue->head = entry->next;\n\n\t\t\tif (!entry->next)\n\t\t\t\tqueue->tail = prev;\n\n\t\t\tdata = entry->data;\n\n\t\t\tfree(entry);\n\t\t\tqueue->entries--;\n\n\t\t\treturn data;\n\t\t} else {\n\t\t\tprev = entry;\n\t\t\tentry = entry->next;\n\t\t}\n\t}\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "UINT_TO_PTR",
          "args": [
            "id"
          ],
          "line": 757
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/mgmt.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"lib/hci.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nbool mgmt_unregister(struct mgmt *mgmt, unsigned int id)\n{\n\tstruct mgmt_notify *notify;\n\n\tif (!mgmt || !id)\n\t\treturn false;\n\n\tnotify = queue_remove_if(mgmt->notify_list, match_notify_id,\n\t\t\t\t\t\t\tUINT_TO_PTR(id));\n\tif (!notify)\n\t\treturn false;\n\n\tif (!mgmt->in_notify) {\n\t\tdestroy_notify(notify);\n\t\treturn true;\n\t}\n\n\tnotify->removed = true;\n\tmgmt->need_notify_cleanup = true;\n\n\treturn true;\n}"
  },
  {
    "function_name": "mgmt_register",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mgmt.c",
    "lines": "719-747",
    "snippet": "unsigned int mgmt_register(struct mgmt *mgmt, uint16_t event, uint16_t index,\n\t\t\t\tmgmt_notify_func_t callback,\n\t\t\t\tvoid *user_data, mgmt_destroy_func_t destroy)\n{\n\tstruct mgmt_notify *notify;\n\n\tif (!mgmt || !event)\n\t\treturn 0;\n\n\tnotify = new0(struct mgmt_notify, 1);\n\tnotify->event = event;\n\tnotify->index = index;\n\n\tnotify->callback = callback;\n\tnotify->destroy = destroy;\n\tnotify->user_data = user_data;\n\n\tif (mgmt->next_notify_id < 1)\n\t\tmgmt->next_notify_id = 1;\n\n\tnotify->id = mgmt->next_notify_id++;\n\n\tif (!queue_push_tail(mgmt->notify_list, notify)) {\n\t\tfree(notify);\n\t\treturn 0;\n\t}\n\n\treturn notify->id;\n}",
    "includes": [
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"lib/hci.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "notify"
          ],
          "line": 742
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "956-985",
          "snippet": "static void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_push_tail",
          "args": [
            "mgmt->notify_list",
            "notify"
          ],
          "line": 741
        },
        "resolved": true,
        "details": {
          "function_name": "queue_push_tail",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "88-108",
          "snippet": "bool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "new0",
          "args": [
            "structmgmt_notify",
            "1"
          ],
          "line": 728
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/mgmt.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"lib/hci.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nunsigned int mgmt_register(struct mgmt *mgmt, uint16_t event, uint16_t index,\n\t\t\t\tmgmt_notify_func_t callback,\n\t\t\t\tvoid *user_data, mgmt_destroy_func_t destroy)\n{\n\tstruct mgmt_notify *notify;\n\n\tif (!mgmt || !event)\n\t\treturn 0;\n\n\tnotify = new0(struct mgmt_notify, 1);\n\tnotify->event = event;\n\tnotify->index = index;\n\n\tnotify->callback = callback;\n\tnotify->destroy = destroy;\n\tnotify->user_data = user_data;\n\n\tif (mgmt->next_notify_id < 1)\n\t\tmgmt->next_notify_id = 1;\n\n\tnotify->id = mgmt->next_notify_id++;\n\n\tif (!queue_push_tail(mgmt->notify_list, notify)) {\n\t\tfree(notify);\n\t\treturn 0;\n\t}\n\n\treturn notify->id;\n}"
  },
  {
    "function_name": "mgmt_cancel_all",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mgmt.c",
    "lines": "707-717",
    "snippet": "bool mgmt_cancel_all(struct mgmt *mgmt)\n{\n\tif (!mgmt)\n\t\treturn false;\n\n\tqueue_remove_all(mgmt->pending_list, NULL, NULL, destroy_request);\n\tqueue_remove_all(mgmt->reply_queue, NULL, NULL, destroy_request);\n\tqueue_remove_all(mgmt->request_queue, NULL, NULL, destroy_request);\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"lib/hci.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_remove_all",
          "args": [
            "mgmt->request_queue",
            "NULL",
            "NULL",
            "destroy_request"
          ],
          "line": 714
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_all",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "318-362",
          "snippet": "unsigned int queue_remove_all(struct queue *queue, queue_match_func_t function,\n\t\t\t\tvoid *user_data, queue_destroy_func_t destroy)\n{\n\tstruct queue_entry *entry;\n\tunsigned int count = 0;\n\n\tif (!queue)\n\t\treturn 0;\n\n\tentry = queue->head;\n\n\tif (function) {\n\t\twhile (entry) {\n\t\t\tvoid *data;\n\t\t\tunsigned int entries = queue->entries;\n\n\t\t\tdata = queue_remove_if(queue, function, user_data);\n\t\t\tif (entries == queue->entries)\n\t\t\t\tbreak;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(data);\n\n\t\t\tcount++;\n\t\t}\n\t} else {\n\t\tqueue->head = NULL;\n\t\tqueue->tail = NULL;\n\t\tqueue->entries = 0;\n\n\t\twhile (entry) {\n\t\t\tstruct queue_entry *tmp = entry;\n\n\t\t\tentry = entry->next;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(tmp->data);\n\n\t\t\tfree(tmp);\n\t\t\tcount++;\n\t\t}\n\t}\n\n\treturn count;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nunsigned int queue_remove_all(struct queue *queue, queue_match_func_t function,\n\t\t\t\tvoid *user_data, queue_destroy_func_t destroy)\n{\n\tstruct queue_entry *entry;\n\tunsigned int count = 0;\n\n\tif (!queue)\n\t\treturn 0;\n\n\tentry = queue->head;\n\n\tif (function) {\n\t\twhile (entry) {\n\t\t\tvoid *data;\n\t\t\tunsigned int entries = queue->entries;\n\n\t\t\tdata = queue_remove_if(queue, function, user_data);\n\t\t\tif (entries == queue->entries)\n\t\t\t\tbreak;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(data);\n\n\t\t\tcount++;\n\t\t}\n\t} else {\n\t\tqueue->head = NULL;\n\t\tqueue->tail = NULL;\n\t\tqueue->entries = 0;\n\n\t\twhile (entry) {\n\t\t\tstruct queue_entry *tmp = entry;\n\n\t\t\tentry = entry->next;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(tmp->data);\n\n\t\t\tfree(tmp);\n\t\t\tcount++;\n\t\t}\n\t}\n\n\treturn count;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/mgmt.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"lib/hci.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nbool mgmt_cancel_all(struct mgmt *mgmt)\n{\n\tif (!mgmt)\n\t\treturn false;\n\n\tqueue_remove_all(mgmt->pending_list, NULL, NULL, destroy_request);\n\tqueue_remove_all(mgmt->reply_queue, NULL, NULL, destroy_request);\n\tqueue_remove_all(mgmt->request_queue, NULL, NULL, destroy_request);\n\n\treturn true;\n}"
  },
  {
    "function_name": "mgmt_cancel_index",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mgmt.c",
    "lines": "692-705",
    "snippet": "bool mgmt_cancel_index(struct mgmt *mgmt, uint16_t index)\n{\n\tif (!mgmt)\n\t\treturn false;\n\n\tqueue_remove_all(mgmt->request_queue, match_request_index,\n\t\t\t\t\tUINT_TO_PTR(index), destroy_request);\n\tqueue_remove_all(mgmt->reply_queue, match_request_index,\n\t\t\t\t\tUINT_TO_PTR(index), destroy_request);\n\tqueue_remove_all(mgmt->pending_list, match_request_index,\n\t\t\t\t\tUINT_TO_PTR(index), destroy_request);\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"lib/hci.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_remove_all",
          "args": [
            "mgmt->pending_list",
            "match_request_index",
            "UINT_TO_PTR(index)",
            "destroy_request"
          ],
          "line": 701
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_all",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "318-362",
          "snippet": "unsigned int queue_remove_all(struct queue *queue, queue_match_func_t function,\n\t\t\t\tvoid *user_data, queue_destroy_func_t destroy)\n{\n\tstruct queue_entry *entry;\n\tunsigned int count = 0;\n\n\tif (!queue)\n\t\treturn 0;\n\n\tentry = queue->head;\n\n\tif (function) {\n\t\twhile (entry) {\n\t\t\tvoid *data;\n\t\t\tunsigned int entries = queue->entries;\n\n\t\t\tdata = queue_remove_if(queue, function, user_data);\n\t\t\tif (entries == queue->entries)\n\t\t\t\tbreak;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(data);\n\n\t\t\tcount++;\n\t\t}\n\t} else {\n\t\tqueue->head = NULL;\n\t\tqueue->tail = NULL;\n\t\tqueue->entries = 0;\n\n\t\twhile (entry) {\n\t\t\tstruct queue_entry *tmp = entry;\n\n\t\t\tentry = entry->next;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(tmp->data);\n\n\t\t\tfree(tmp);\n\t\t\tcount++;\n\t\t}\n\t}\n\n\treturn count;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nunsigned int queue_remove_all(struct queue *queue, queue_match_func_t function,\n\t\t\t\tvoid *user_data, queue_destroy_func_t destroy)\n{\n\tstruct queue_entry *entry;\n\tunsigned int count = 0;\n\n\tif (!queue)\n\t\treturn 0;\n\n\tentry = queue->head;\n\n\tif (function) {\n\t\twhile (entry) {\n\t\t\tvoid *data;\n\t\t\tunsigned int entries = queue->entries;\n\n\t\t\tdata = queue_remove_if(queue, function, user_data);\n\t\t\tif (entries == queue->entries)\n\t\t\t\tbreak;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(data);\n\n\t\t\tcount++;\n\t\t}\n\t} else {\n\t\tqueue->head = NULL;\n\t\tqueue->tail = NULL;\n\t\tqueue->entries = 0;\n\n\t\twhile (entry) {\n\t\t\tstruct queue_entry *tmp = entry;\n\n\t\t\tentry = entry->next;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(tmp->data);\n\n\t\t\tfree(tmp);\n\t\t\tcount++;\n\t\t}\n\t}\n\n\treturn count;\n}"
        }
      },
      {
        "call_info": {
          "callee": "UINT_TO_PTR",
          "args": [
            "index"
          ],
          "line": 702
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "UINT_TO_PTR",
          "args": [
            "index"
          ],
          "line": 700
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "UINT_TO_PTR",
          "args": [
            "index"
          ],
          "line": 698
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/mgmt.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"lib/hci.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nbool mgmt_cancel_index(struct mgmt *mgmt, uint16_t index)\n{\n\tif (!mgmt)\n\t\treturn false;\n\n\tqueue_remove_all(mgmt->request_queue, match_request_index,\n\t\t\t\t\tUINT_TO_PTR(index), destroy_request);\n\tqueue_remove_all(mgmt->reply_queue, match_request_index,\n\t\t\t\t\tUINT_TO_PTR(index), destroy_request);\n\tqueue_remove_all(mgmt->pending_list, match_request_index,\n\t\t\t\t\tUINT_TO_PTR(index), destroy_request);\n\n\treturn true;\n}"
  },
  {
    "function_name": "mgmt_cancel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mgmt.c",
    "lines": "662-690",
    "snippet": "bool mgmt_cancel(struct mgmt *mgmt, unsigned int id)\n{\n\tstruct mgmt_request *request;\n\n\tif (!mgmt || !id)\n\t\treturn false;\n\n\trequest = queue_remove_if(mgmt->request_queue, match_request_id,\n\t\t\t\t\t\t\tUINT_TO_PTR(id));\n\tif (request)\n\t\tgoto done;\n\n\trequest = queue_remove_if(mgmt->reply_queue, match_request_id,\n\t\t\t\t\t\t\tUINT_TO_PTR(id));\n\tif (request)\n\t\tgoto done;\n\n\trequest = queue_remove_if(mgmt->pending_list, match_request_id,\n\t\t\t\t\t\t\tUINT_TO_PTR(id));\n\tif (!request)\n\t\treturn false;\n\ndone:\n\tdestroy_request(request);\n\n\twakeup_writer(mgmt);\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"lib/hci.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "wakeup_writer",
          "args": [
            "mgmt"
          ],
          "line": 687
        },
        "resolved": true,
        "details": {
          "function_name": "wakeup_writer",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mgmt.c",
          "lines": "219-234",
          "snippet": "static void wakeup_writer(struct mgmt *mgmt)\n{\n\tif (!queue_isempty(mgmt->pending_list)) {\n\t\t/* only queued reply commands trigger wakeup */\n\t\tif (queue_isempty(mgmt->reply_queue))\n\t\t\treturn;\n\t}\n\n\tif (mgmt->writer_active)\n\t\treturn;\n\n\tmgmt->writer_active = true;\n\n\tio_set_write_handler(mgmt->io, can_write_data, mgmt,\n\t\t\t\t\t\twrite_watch_destroy);\n}",
          "includes": [
            "#include \"src/shared/mgmt.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/mgmt.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"lib/hci.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void wakeup_writer(struct mgmt *mgmt)\n{\n\tif (!queue_isempty(mgmt->pending_list)) {\n\t\t/* only queued reply commands trigger wakeup */\n\t\tif (queue_isempty(mgmt->reply_queue))\n\t\t\treturn;\n\t}\n\n\tif (mgmt->writer_active)\n\t\treturn;\n\n\tmgmt->writer_active = true;\n\n\tio_set_write_handler(mgmt->io, can_write_data, mgmt,\n\t\t\t\t\t\twrite_watch_destroy);\n}"
        }
      },
      {
        "call_info": {
          "callee": "destroy_request",
          "args": [
            "request"
          ],
          "line": 685
        },
        "resolved": true,
        "details": {
          "function_name": "destroy_request",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mgmt.c",
          "lines": "84-93",
          "snippet": "static void destroy_request(void *data)\n{\n\tstruct mgmt_request *request = data;\n\n\tif (request->destroy)\n\t\trequest->destroy(request->user_data);\n\n\tfree(request->buf);\n\tfree(request);\n}",
          "includes": [
            "#include \"src/shared/mgmt.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/mgmt.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"lib/hci.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void destroy_request(void *data)\n{\n\tstruct mgmt_request *request = data;\n\n\tif (request->destroy)\n\t\trequest->destroy(request->user_data);\n\n\tfree(request->buf);\n\tfree(request);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_remove_if",
          "args": [
            "mgmt->pending_list",
            "match_request_id",
            "UINT_TO_PTR(id)"
          ],
          "line": 679
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_if",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "278-316",
          "snippet": "void *queue_remove_if(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry, *prev = NULL;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tentry = queue->head;\n\n\twhile (entry) {\n\t\tif (function(entry->data, user_data)) {\n\t\t\tvoid *data;\n\n\t\t\tif (prev)\n\t\t\t\tprev->next = entry->next;\n\t\t\telse\n\t\t\t\tqueue->head = entry->next;\n\n\t\t\tif (!entry->next)\n\t\t\t\tqueue->tail = prev;\n\n\t\t\tdata = entry->data;\n\n\t\t\tfree(entry);\n\t\t\tqueue->entries--;\n\n\t\t\treturn data;\n\t\t} else {\n\t\t\tprev = entry;\n\t\t\tentry = entry->next;\n\t\t}\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid *queue_remove_if(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry, *prev = NULL;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tentry = queue->head;\n\n\twhile (entry) {\n\t\tif (function(entry->data, user_data)) {\n\t\t\tvoid *data;\n\n\t\t\tif (prev)\n\t\t\t\tprev->next = entry->next;\n\t\t\telse\n\t\t\t\tqueue->head = entry->next;\n\n\t\t\tif (!entry->next)\n\t\t\t\tqueue->tail = prev;\n\n\t\t\tdata = entry->data;\n\n\t\t\tfree(entry);\n\t\t\tqueue->entries--;\n\n\t\t\treturn data;\n\t\t} else {\n\t\t\tprev = entry;\n\t\t\tentry = entry->next;\n\t\t}\n\t}\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "UINT_TO_PTR",
          "args": [
            "id"
          ],
          "line": 680
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "UINT_TO_PTR",
          "args": [
            "id"
          ],
          "line": 675
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "UINT_TO_PTR",
          "args": [
            "id"
          ],
          "line": 670
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/mgmt.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"lib/hci.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nbool mgmt_cancel(struct mgmt *mgmt, unsigned int id)\n{\n\tstruct mgmt_request *request;\n\n\tif (!mgmt || !id)\n\t\treturn false;\n\n\trequest = queue_remove_if(mgmt->request_queue, match_request_id,\n\t\t\t\t\t\t\tUINT_TO_PTR(id));\n\tif (request)\n\t\tgoto done;\n\n\trequest = queue_remove_if(mgmt->reply_queue, match_request_id,\n\t\t\t\t\t\t\tUINT_TO_PTR(id));\n\tif (request)\n\t\tgoto done;\n\n\trequest = queue_remove_if(mgmt->pending_list, match_request_id,\n\t\t\t\t\t\t\tUINT_TO_PTR(id));\n\tif (!request)\n\t\treturn false;\n\ndone:\n\tdestroy_request(request);\n\n\twakeup_writer(mgmt);\n\n\treturn true;\n}"
  },
  {
    "function_name": "mgmt_reply",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mgmt.c",
    "lines": "631-660",
    "snippet": "unsigned int mgmt_reply(struct mgmt *mgmt, uint16_t opcode, uint16_t index,\n\t\t\t\tuint16_t length, const void *param,\n\t\t\t\tmgmt_request_func_t callback,\n\t\t\t\tvoid *user_data, mgmt_destroy_func_t destroy)\n{\n\tstruct mgmt_request *request;\n\n\tif (!mgmt)\n\t\treturn 0;\n\n\trequest = create_request(opcode, index, length, param,\n\t\t\t\t\tcallback, user_data, destroy);\n\tif (!request)\n\t\treturn 0;\n\n\tif (mgmt->next_request_id < 1)\n\t\tmgmt->next_request_id = 1;\n\n\trequest->id = mgmt->next_request_id++;\n\n\tif (!queue_push_tail(mgmt->reply_queue, request)) {\n\t\tfree(request->buf);\n\t\tfree(request);\n\t\treturn 0;\n\t}\n\n\twakeup_writer(mgmt);\n\n\treturn request->id;\n}",
    "includes": [
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"lib/hci.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "wakeup_writer",
          "args": [
            "mgmt"
          ],
          "line": 657
        },
        "resolved": true,
        "details": {
          "function_name": "wakeup_writer",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mgmt.c",
          "lines": "219-234",
          "snippet": "static void wakeup_writer(struct mgmt *mgmt)\n{\n\tif (!queue_isempty(mgmt->pending_list)) {\n\t\t/* only queued reply commands trigger wakeup */\n\t\tif (queue_isempty(mgmt->reply_queue))\n\t\t\treturn;\n\t}\n\n\tif (mgmt->writer_active)\n\t\treturn;\n\n\tmgmt->writer_active = true;\n\n\tio_set_write_handler(mgmt->io, can_write_data, mgmt,\n\t\t\t\t\t\twrite_watch_destroy);\n}",
          "includes": [
            "#include \"src/shared/mgmt.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/mgmt.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"lib/hci.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void wakeup_writer(struct mgmt *mgmt)\n{\n\tif (!queue_isempty(mgmt->pending_list)) {\n\t\t/* only queued reply commands trigger wakeup */\n\t\tif (queue_isempty(mgmt->reply_queue))\n\t\t\treturn;\n\t}\n\n\tif (mgmt->writer_active)\n\t\treturn;\n\n\tmgmt->writer_active = true;\n\n\tio_set_write_handler(mgmt->io, can_write_data, mgmt,\n\t\t\t\t\t\twrite_watch_destroy);\n}"
        }
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "request"
          ],
          "line": 653
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "956-985",
          "snippet": "static void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_push_tail",
          "args": [
            "mgmt->reply_queue",
            "request"
          ],
          "line": 651
        },
        "resolved": true,
        "details": {
          "function_name": "queue_push_tail",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "88-108",
          "snippet": "bool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "create_request",
          "args": [
            "opcode",
            "index",
            "length",
            "param",
            "callback",
            "user_data",
            "destroy"
          ],
          "line": 641
        },
        "resolved": true,
        "details": {
          "function_name": "create_request",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mgmt.c",
          "lines": "534-572",
          "snippet": "static struct mgmt_request *create_request(uint16_t opcode, uint16_t index,\n\t\t\t\tuint16_t length, const void *param,\n\t\t\t\tmgmt_request_func_t callback,\n\t\t\t\tvoid *user_data, mgmt_destroy_func_t destroy)\n{\n\tstruct mgmt_request *request;\n\tstruct mgmt_hdr *hdr;\n\n\tif (!opcode)\n\t\treturn NULL;\n\n\tif (length > 0 && !param)\n\t\treturn NULL;\n\n\trequest = new0(struct mgmt_request, 1);\n\trequest->len = length + MGMT_HDR_SIZE;\n\trequest->buf = malloc(request->len);\n\tif (!request->buf) {\n\t\tfree(request);\n\t\treturn NULL;\n\t}\n\n\tif (length > 0)\n\t\tmemcpy(request->buf + MGMT_HDR_SIZE, param, length);\n\n\thdr = request->buf;\n\thdr->opcode = htobs(opcode);\n\thdr->index = htobs(index);\n\thdr->len = htobs(length);\n\n\trequest->opcode = opcode;\n\trequest->index = index;\n\n\trequest->callback = callback;\n\trequest->destroy = destroy;\n\trequest->user_data = user_data;\n\n\treturn request;\n}",
          "includes": [
            "#include \"src/shared/mgmt.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/mgmt.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"lib/hci.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic struct mgmt_request *create_request(uint16_t opcode, uint16_t index,\n\t\t\t\tuint16_t length, const void *param,\n\t\t\t\tmgmt_request_func_t callback,\n\t\t\t\tvoid *user_data, mgmt_destroy_func_t destroy)\n{\n\tstruct mgmt_request *request;\n\tstruct mgmt_hdr *hdr;\n\n\tif (!opcode)\n\t\treturn NULL;\n\n\tif (length > 0 && !param)\n\t\treturn NULL;\n\n\trequest = new0(struct mgmt_request, 1);\n\trequest->len = length + MGMT_HDR_SIZE;\n\trequest->buf = malloc(request->len);\n\tif (!request->buf) {\n\t\tfree(request);\n\t\treturn NULL;\n\t}\n\n\tif (length > 0)\n\t\tmemcpy(request->buf + MGMT_HDR_SIZE, param, length);\n\n\thdr = request->buf;\n\thdr->opcode = htobs(opcode);\n\thdr->index = htobs(index);\n\thdr->len = htobs(length);\n\n\trequest->opcode = opcode;\n\trequest->index = index;\n\n\trequest->callback = callback;\n\trequest->destroy = destroy;\n\trequest->user_data = user_data;\n\n\treturn request;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/mgmt.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"lib/hci.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nunsigned int mgmt_reply(struct mgmt *mgmt, uint16_t opcode, uint16_t index,\n\t\t\t\tuint16_t length, const void *param,\n\t\t\t\tmgmt_request_func_t callback,\n\t\t\t\tvoid *user_data, mgmt_destroy_func_t destroy)\n{\n\tstruct mgmt_request *request;\n\n\tif (!mgmt)\n\t\treturn 0;\n\n\trequest = create_request(opcode, index, length, param,\n\t\t\t\t\tcallback, user_data, destroy);\n\tif (!request)\n\t\treturn 0;\n\n\tif (mgmt->next_request_id < 1)\n\t\tmgmt->next_request_id = 1;\n\n\trequest->id = mgmt->next_request_id++;\n\n\tif (!queue_push_tail(mgmt->reply_queue, request)) {\n\t\tfree(request->buf);\n\t\tfree(request);\n\t\treturn 0;\n\t}\n\n\twakeup_writer(mgmt);\n\n\treturn request->id;\n}"
  },
  {
    "function_name": "mgmt_send_nowait",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mgmt.c",
    "lines": "605-629",
    "snippet": "unsigned int mgmt_send_nowait(struct mgmt *mgmt, uint16_t opcode, uint16_t index,\n\t\t\t\tuint16_t length, const void *param,\n\t\t\t\tmgmt_request_func_t callback,\n\t\t\t\tvoid *user_data, mgmt_destroy_func_t destroy)\n{\n\tstruct mgmt_request *request;\n\n\tif (!mgmt)\n\t\treturn 0;\n\n\trequest = create_request(opcode, index, length, param,\n\t\t\t\t\tcallback, user_data, destroy);\n\tif (!request)\n\t\treturn 0;\n\n\tif (mgmt->next_request_id < 1)\n\t\tmgmt->next_request_id = 1;\n\n\trequest->id = mgmt->next_request_id++;\n\n\tif (!send_request(mgmt, request))\n\t\treturn 0;\n\n\treturn request->id;\n}",
    "includes": [
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"lib/hci.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "send_request",
          "args": [
            "mgmt",
            "request"
          ],
          "line": 625
        },
        "resolved": true,
        "details": {
          "function_name": "send_request",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mgmt.c",
          "lines": "160-189",
          "snippet": "static bool send_request(struct mgmt *mgmt, struct mgmt_request *request)\n{\n\tstruct iovec iov;\n\tssize_t ret;\n\n\tiov.iov_base = request->buf;\n\tiov.iov_len = request->len;\n\n\tret = io_send(mgmt->io, &iov, 1);\n\tif (ret < 0) {\n\t\tutil_debug(mgmt->debug_callback, mgmt->debug_data,\n\t\t\t\t\"write failed: %s\", strerror(-ret));\n\t\tif (request->callback)\n\t\t\trequest->callback(MGMT_STATUS_FAILED, 0, NULL,\n\t\t\t\t\t\t\trequest->user_data);\n\t\tdestroy_request(request);\n\t\treturn false;\n\t}\n\n\tutil_debug(mgmt->debug_callback, mgmt->debug_data,\n\t\t\t\t\"[0x%04x] command 0x%04x\",\n\t\t\t\trequest->index, request->opcode);\n\n\tutil_hexdump('<', request->buf, ret, mgmt->debug_callback,\n\t\t\t\t\t\t\tmgmt->debug_data);\n\n\tqueue_push_tail(mgmt->pending_list, request);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/mgmt.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/mgmt.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"lib/hci.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic bool send_request(struct mgmt *mgmt, struct mgmt_request *request)\n{\n\tstruct iovec iov;\n\tssize_t ret;\n\n\tiov.iov_base = request->buf;\n\tiov.iov_len = request->len;\n\n\tret = io_send(mgmt->io, &iov, 1);\n\tif (ret < 0) {\n\t\tutil_debug(mgmt->debug_callback, mgmt->debug_data,\n\t\t\t\t\"write failed: %s\", strerror(-ret));\n\t\tif (request->callback)\n\t\t\trequest->callback(MGMT_STATUS_FAILED, 0, NULL,\n\t\t\t\t\t\t\trequest->user_data);\n\t\tdestroy_request(request);\n\t\treturn false;\n\t}\n\n\tutil_debug(mgmt->debug_callback, mgmt->debug_data,\n\t\t\t\t\"[0x%04x] command 0x%04x\",\n\t\t\t\trequest->index, request->opcode);\n\n\tutil_hexdump('<', request->buf, ret, mgmt->debug_callback,\n\t\t\t\t\t\t\tmgmt->debug_data);\n\n\tqueue_push_tail(mgmt->pending_list, request);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "create_request",
          "args": [
            "opcode",
            "index",
            "length",
            "param",
            "callback",
            "user_data",
            "destroy"
          ],
          "line": 615
        },
        "resolved": true,
        "details": {
          "function_name": "create_request",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mgmt.c",
          "lines": "534-572",
          "snippet": "static struct mgmt_request *create_request(uint16_t opcode, uint16_t index,\n\t\t\t\tuint16_t length, const void *param,\n\t\t\t\tmgmt_request_func_t callback,\n\t\t\t\tvoid *user_data, mgmt_destroy_func_t destroy)\n{\n\tstruct mgmt_request *request;\n\tstruct mgmt_hdr *hdr;\n\n\tif (!opcode)\n\t\treturn NULL;\n\n\tif (length > 0 && !param)\n\t\treturn NULL;\n\n\trequest = new0(struct mgmt_request, 1);\n\trequest->len = length + MGMT_HDR_SIZE;\n\trequest->buf = malloc(request->len);\n\tif (!request->buf) {\n\t\tfree(request);\n\t\treturn NULL;\n\t}\n\n\tif (length > 0)\n\t\tmemcpy(request->buf + MGMT_HDR_SIZE, param, length);\n\n\thdr = request->buf;\n\thdr->opcode = htobs(opcode);\n\thdr->index = htobs(index);\n\thdr->len = htobs(length);\n\n\trequest->opcode = opcode;\n\trequest->index = index;\n\n\trequest->callback = callback;\n\trequest->destroy = destroy;\n\trequest->user_data = user_data;\n\n\treturn request;\n}",
          "includes": [
            "#include \"src/shared/mgmt.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/mgmt.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"lib/hci.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic struct mgmt_request *create_request(uint16_t opcode, uint16_t index,\n\t\t\t\tuint16_t length, const void *param,\n\t\t\t\tmgmt_request_func_t callback,\n\t\t\t\tvoid *user_data, mgmt_destroy_func_t destroy)\n{\n\tstruct mgmt_request *request;\n\tstruct mgmt_hdr *hdr;\n\n\tif (!opcode)\n\t\treturn NULL;\n\n\tif (length > 0 && !param)\n\t\treturn NULL;\n\n\trequest = new0(struct mgmt_request, 1);\n\trequest->len = length + MGMT_HDR_SIZE;\n\trequest->buf = malloc(request->len);\n\tif (!request->buf) {\n\t\tfree(request);\n\t\treturn NULL;\n\t}\n\n\tif (length > 0)\n\t\tmemcpy(request->buf + MGMT_HDR_SIZE, param, length);\n\n\thdr = request->buf;\n\thdr->opcode = htobs(opcode);\n\thdr->index = htobs(index);\n\thdr->len = htobs(length);\n\n\trequest->opcode = opcode;\n\trequest->index = index;\n\n\trequest->callback = callback;\n\trequest->destroy = destroy;\n\trequest->user_data = user_data;\n\n\treturn request;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/mgmt.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"lib/hci.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nunsigned int mgmt_send_nowait(struct mgmt *mgmt, uint16_t opcode, uint16_t index,\n\t\t\t\tuint16_t length, const void *param,\n\t\t\t\tmgmt_request_func_t callback,\n\t\t\t\tvoid *user_data, mgmt_destroy_func_t destroy)\n{\n\tstruct mgmt_request *request;\n\n\tif (!mgmt)\n\t\treturn 0;\n\n\trequest = create_request(opcode, index, length, param,\n\t\t\t\t\tcallback, user_data, destroy);\n\tif (!request)\n\t\treturn 0;\n\n\tif (mgmt->next_request_id < 1)\n\t\tmgmt->next_request_id = 1;\n\n\trequest->id = mgmt->next_request_id++;\n\n\tif (!send_request(mgmt, request))\n\t\treturn 0;\n\n\treturn request->id;\n}"
  },
  {
    "function_name": "mgmt_send",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mgmt.c",
    "lines": "574-603",
    "snippet": "unsigned int mgmt_send(struct mgmt *mgmt, uint16_t opcode, uint16_t index,\n\t\t\t\tuint16_t length, const void *param,\n\t\t\t\tmgmt_request_func_t callback,\n\t\t\t\tvoid *user_data, mgmt_destroy_func_t destroy)\n{\n\tstruct mgmt_request *request;\n\n\tif (!mgmt)\n\t\treturn 0;\n\n\trequest = create_request(opcode, index, length, param,\n\t\t\t\t\tcallback, user_data, destroy);\n\tif (!request)\n\t\treturn 0;\n\n\tif (mgmt->next_request_id < 1)\n\t\tmgmt->next_request_id = 1;\n\n\trequest->id = mgmt->next_request_id++;\n\n\tif (!queue_push_tail(mgmt->request_queue, request)) {\n\t\tfree(request->buf);\n\t\tfree(request);\n\t\treturn 0;\n\t}\n\n\twakeup_writer(mgmt);\n\n\treturn request->id;\n}",
    "includes": [
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"lib/hci.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "wakeup_writer",
          "args": [
            "mgmt"
          ],
          "line": 600
        },
        "resolved": true,
        "details": {
          "function_name": "wakeup_writer",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mgmt.c",
          "lines": "219-234",
          "snippet": "static void wakeup_writer(struct mgmt *mgmt)\n{\n\tif (!queue_isempty(mgmt->pending_list)) {\n\t\t/* only queued reply commands trigger wakeup */\n\t\tif (queue_isempty(mgmt->reply_queue))\n\t\t\treturn;\n\t}\n\n\tif (mgmt->writer_active)\n\t\treturn;\n\n\tmgmt->writer_active = true;\n\n\tio_set_write_handler(mgmt->io, can_write_data, mgmt,\n\t\t\t\t\t\twrite_watch_destroy);\n}",
          "includes": [
            "#include \"src/shared/mgmt.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/mgmt.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"lib/hci.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void wakeup_writer(struct mgmt *mgmt)\n{\n\tif (!queue_isempty(mgmt->pending_list)) {\n\t\t/* only queued reply commands trigger wakeup */\n\t\tif (queue_isempty(mgmt->reply_queue))\n\t\t\treturn;\n\t}\n\n\tif (mgmt->writer_active)\n\t\treturn;\n\n\tmgmt->writer_active = true;\n\n\tio_set_write_handler(mgmt->io, can_write_data, mgmt,\n\t\t\t\t\t\twrite_watch_destroy);\n}"
        }
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "request"
          ],
          "line": 596
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "956-985",
          "snippet": "static void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_push_tail",
          "args": [
            "mgmt->request_queue",
            "request"
          ],
          "line": 594
        },
        "resolved": true,
        "details": {
          "function_name": "queue_push_tail",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "88-108",
          "snippet": "bool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "create_request",
          "args": [
            "opcode",
            "index",
            "length",
            "param",
            "callback",
            "user_data",
            "destroy"
          ],
          "line": 584
        },
        "resolved": true,
        "details": {
          "function_name": "create_request",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mgmt.c",
          "lines": "534-572",
          "snippet": "static struct mgmt_request *create_request(uint16_t opcode, uint16_t index,\n\t\t\t\tuint16_t length, const void *param,\n\t\t\t\tmgmt_request_func_t callback,\n\t\t\t\tvoid *user_data, mgmt_destroy_func_t destroy)\n{\n\tstruct mgmt_request *request;\n\tstruct mgmt_hdr *hdr;\n\n\tif (!opcode)\n\t\treturn NULL;\n\n\tif (length > 0 && !param)\n\t\treturn NULL;\n\n\trequest = new0(struct mgmt_request, 1);\n\trequest->len = length + MGMT_HDR_SIZE;\n\trequest->buf = malloc(request->len);\n\tif (!request->buf) {\n\t\tfree(request);\n\t\treturn NULL;\n\t}\n\n\tif (length > 0)\n\t\tmemcpy(request->buf + MGMT_HDR_SIZE, param, length);\n\n\thdr = request->buf;\n\thdr->opcode = htobs(opcode);\n\thdr->index = htobs(index);\n\thdr->len = htobs(length);\n\n\trequest->opcode = opcode;\n\trequest->index = index;\n\n\trequest->callback = callback;\n\trequest->destroy = destroy;\n\trequest->user_data = user_data;\n\n\treturn request;\n}",
          "includes": [
            "#include \"src/shared/mgmt.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/mgmt.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"lib/hci.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic struct mgmt_request *create_request(uint16_t opcode, uint16_t index,\n\t\t\t\tuint16_t length, const void *param,\n\t\t\t\tmgmt_request_func_t callback,\n\t\t\t\tvoid *user_data, mgmt_destroy_func_t destroy)\n{\n\tstruct mgmt_request *request;\n\tstruct mgmt_hdr *hdr;\n\n\tif (!opcode)\n\t\treturn NULL;\n\n\tif (length > 0 && !param)\n\t\treturn NULL;\n\n\trequest = new0(struct mgmt_request, 1);\n\trequest->len = length + MGMT_HDR_SIZE;\n\trequest->buf = malloc(request->len);\n\tif (!request->buf) {\n\t\tfree(request);\n\t\treturn NULL;\n\t}\n\n\tif (length > 0)\n\t\tmemcpy(request->buf + MGMT_HDR_SIZE, param, length);\n\n\thdr = request->buf;\n\thdr->opcode = htobs(opcode);\n\thdr->index = htobs(index);\n\thdr->len = htobs(length);\n\n\trequest->opcode = opcode;\n\trequest->index = index;\n\n\trequest->callback = callback;\n\trequest->destroy = destroy;\n\trequest->user_data = user_data;\n\n\treturn request;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/mgmt.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"lib/hci.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nunsigned int mgmt_send(struct mgmt *mgmt, uint16_t opcode, uint16_t index,\n\t\t\t\tuint16_t length, const void *param,\n\t\t\t\tmgmt_request_func_t callback,\n\t\t\t\tvoid *user_data, mgmt_destroy_func_t destroy)\n{\n\tstruct mgmt_request *request;\n\n\tif (!mgmt)\n\t\treturn 0;\n\n\trequest = create_request(opcode, index, length, param,\n\t\t\t\t\tcallback, user_data, destroy);\n\tif (!request)\n\t\treturn 0;\n\n\tif (mgmt->next_request_id < 1)\n\t\tmgmt->next_request_id = 1;\n\n\trequest->id = mgmt->next_request_id++;\n\n\tif (!queue_push_tail(mgmt->request_queue, request)) {\n\t\tfree(request->buf);\n\t\tfree(request);\n\t\treturn 0;\n\t}\n\n\twakeup_writer(mgmt);\n\n\treturn request->id;\n}"
  },
  {
    "function_name": "create_request",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mgmt.c",
    "lines": "534-572",
    "snippet": "static struct mgmt_request *create_request(uint16_t opcode, uint16_t index,\n\t\t\t\tuint16_t length, const void *param,\n\t\t\t\tmgmt_request_func_t callback,\n\t\t\t\tvoid *user_data, mgmt_destroy_func_t destroy)\n{\n\tstruct mgmt_request *request;\n\tstruct mgmt_hdr *hdr;\n\n\tif (!opcode)\n\t\treturn NULL;\n\n\tif (length > 0 && !param)\n\t\treturn NULL;\n\n\trequest = new0(struct mgmt_request, 1);\n\trequest->len = length + MGMT_HDR_SIZE;\n\trequest->buf = malloc(request->len);\n\tif (!request->buf) {\n\t\tfree(request);\n\t\treturn NULL;\n\t}\n\n\tif (length > 0)\n\t\tmemcpy(request->buf + MGMT_HDR_SIZE, param, length);\n\n\thdr = request->buf;\n\thdr->opcode = htobs(opcode);\n\thdr->index = htobs(index);\n\thdr->len = htobs(length);\n\n\trequest->opcode = opcode;\n\trequest->index = index;\n\n\trequest->callback = callback;\n\trequest->destroy = destroy;\n\trequest->user_data = user_data;\n\n\treturn request;\n}",
    "includes": [
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"lib/hci.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "htobs",
          "args": [
            "length"
          ],
          "line": 562
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "htobs",
          "args": [
            "index"
          ],
          "line": 561
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "htobs",
          "args": [
            "opcode"
          ],
          "line": 560
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "request->buf + MGMT_HDR_SIZE",
            "param",
            "length"
          ],
          "line": 557
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "request"
          ],
          "line": 552
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "956-985",
          "snippet": "static void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}"
        }
      },
      {
        "call_info": {
          "callee": "malloc",
          "args": [
            "request->len"
          ],
          "line": 550
        },
        "resolved": true,
        "details": {
          "function_name": "btd_malloc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/util.c",
          "lines": "41-55",
          "snippet": "void *btd_malloc(size_t size)\n{\n\tif (__builtin_expect(!!size, 1)) {\n\t\tvoid *ptr;\n\n\t\tptr = malloc(size);\n\t\tif (ptr)\n\t\t\treturn ptr;\n\n\t\tfprintf(stderr, \"failed to allocate %zu bytes\\n\", size);\n\t\tabort();\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include <string.h>",
            "#include <limits.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include <string.h>\n#include <limits.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid *btd_malloc(size_t size)\n{\n\tif (__builtin_expect(!!size, 1)) {\n\t\tvoid *ptr;\n\n\t\tptr = malloc(size);\n\t\tif (ptr)\n\t\t\treturn ptr;\n\n\t\tfprintf(stderr, \"failed to allocate %zu bytes\\n\", size);\n\t\tabort();\n\t}\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "new0",
          "args": [
            "structmgmt_request",
            "1"
          ],
          "line": 548
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/mgmt.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"lib/hci.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic struct mgmt_request *create_request(uint16_t opcode, uint16_t index,\n\t\t\t\tuint16_t length, const void *param,\n\t\t\t\tmgmt_request_func_t callback,\n\t\t\t\tvoid *user_data, mgmt_destroy_func_t destroy)\n{\n\tstruct mgmt_request *request;\n\tstruct mgmt_hdr *hdr;\n\n\tif (!opcode)\n\t\treturn NULL;\n\n\tif (length > 0 && !param)\n\t\treturn NULL;\n\n\trequest = new0(struct mgmt_request, 1);\n\trequest->len = length + MGMT_HDR_SIZE;\n\trequest->buf = malloc(request->len);\n\tif (!request->buf) {\n\t\tfree(request);\n\t\treturn NULL;\n\t}\n\n\tif (length > 0)\n\t\tmemcpy(request->buf + MGMT_HDR_SIZE, param, length);\n\n\thdr = request->buf;\n\thdr->opcode = htobs(opcode);\n\thdr->index = htobs(index);\n\thdr->len = htobs(length);\n\n\trequest->opcode = opcode;\n\trequest->index = index;\n\n\trequest->callback = callback;\n\trequest->destroy = destroy;\n\trequest->user_data = user_data;\n\n\treturn request;\n}"
  },
  {
    "function_name": "mgmt_set_close_on_unref",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mgmt.c",
    "lines": "524-532",
    "snippet": "bool mgmt_set_close_on_unref(struct mgmt *mgmt, bool do_close)\n{\n\tif (!mgmt)\n\t\treturn false;\n\n\tmgmt->close_on_unref = do_close;\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"lib/hci.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"src/shared/mgmt.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"lib/hci.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nbool mgmt_set_close_on_unref(struct mgmt *mgmt, bool do_close)\n{\n\tif (!mgmt)\n\t\treturn false;\n\n\tmgmt->close_on_unref = do_close;\n\n\treturn true;\n}"
  },
  {
    "function_name": "mgmt_set_debug",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mgmt.c",
    "lines": "508-522",
    "snippet": "bool mgmt_set_debug(struct mgmt *mgmt, mgmt_debug_func_t callback,\n\t\t\t\tvoid *user_data, mgmt_destroy_func_t destroy)\n{\n\tif (!mgmt)\n\t\treturn false;\n\n\tif (mgmt->debug_destroy)\n\t\tmgmt->debug_destroy(mgmt->debug_data);\n\n\tmgmt->debug_callback = callback;\n\tmgmt->debug_destroy = destroy;\n\tmgmt->debug_data = user_data;\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"lib/hci.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "mgmt->debug_destroy",
          "args": [
            "mgmt->debug_data"
          ],
          "line": 515
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/mgmt.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"lib/hci.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nbool mgmt_set_debug(struct mgmt *mgmt, mgmt_debug_func_t callback,\n\t\t\t\tvoid *user_data, mgmt_destroy_func_t destroy)\n{\n\tif (!mgmt)\n\t\treturn false;\n\n\tif (mgmt->debug_destroy)\n\t\tmgmt->debug_destroy(mgmt->debug_data);\n\n\tmgmt->debug_callback = callback;\n\tmgmt->debug_destroy = destroy;\n\tmgmt->debug_data = user_data;\n\n\treturn true;\n}"
  },
  {
    "function_name": "mgmt_unref",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mgmt.c",
    "lines": "471-506",
    "snippet": "void mgmt_unref(struct mgmt *mgmt)\n{\n\tif (!mgmt)\n\t\treturn;\n\n\tif (__sync_sub_and_fetch(&mgmt->ref_count, 1))\n\t\treturn;\n\n\tmgmt_unregister_all(mgmt);\n\tmgmt_cancel_all(mgmt);\n\n\tqueue_destroy(mgmt->reply_queue, NULL);\n\tqueue_destroy(mgmt->request_queue, NULL);\n\n\tio_set_write_handler(mgmt->io, NULL, NULL, NULL);\n\tio_set_read_handler(mgmt->io, NULL, NULL, NULL);\n\n\tio_destroy(mgmt->io);\n\tmgmt->io = NULL;\n\n\tif (mgmt->close_on_unref)\n\t\tclose(mgmt->fd);\n\n\tif (mgmt->debug_destroy)\n\t\tmgmt->debug_destroy(mgmt->debug_data);\n\n\tfree(mgmt->buf);\n\tmgmt->buf = NULL;\n\n\tif (!mgmt->in_notify) {\n\t\tqueue_destroy(mgmt->notify_list, NULL);\n\t\tqueue_destroy(mgmt->pending_list, NULL);\n\t\tfree(mgmt);\n\t\treturn;\n\t}\n}",
    "includes": [
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"lib/hci.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "mgmt"
          ],
          "line": 503
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "956-985",
          "snippet": "static void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_destroy",
          "args": [
            "mgmt->pending_list",
            "NULL"
          ],
          "line": 502
        },
        "resolved": true,
        "details": {
          "function_name": "queue_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "68-76",
          "snippet": "void queue_destroy(struct queue *queue, queue_destroy_func_t destroy)\n{\n\tif (!queue)\n\t\treturn;\n\n\tqueue_remove_all(queue, NULL, NULL, destroy);\n\n\tqueue_unref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid queue_destroy(struct queue *queue, queue_destroy_func_t destroy)\n{\n\tif (!queue)\n\t\treturn;\n\n\tqueue_remove_all(queue, NULL, NULL, destroy);\n\n\tqueue_unref(queue);\n}"
        }
      },
      {
        "call_info": {
          "callee": "mgmt->debug_destroy",
          "args": [
            "mgmt->debug_data"
          ],
          "line": 495
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "close",
          "args": [
            "mgmt->fd"
          ],
          "line": 492
        },
        "resolved": true,
        "details": {
          "function_name": "hfp_context_close_container",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
          "lines": "334-347",
          "snippet": "bool hfp_context_close_container(struct hfp_context *context)\n{\n\tskip_whitespace(context);\n\n\t/* The list shall be followed by a right parenthesis (\")\" V250 5.7.3.1*/\n\tif (context->data[context->offset] != ')')\n\t\treturn false;\n\n\tcontext->offset++;\n\n\tnext_field(context);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/hfp.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <ctype.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nbool hfp_context_close_container(struct hfp_context *context)\n{\n\tskip_whitespace(context);\n\n\t/* The list shall be followed by a right parenthesis (\")\" V250 5.7.3.1*/\n\tif (context->data[context->offset] != ')')\n\t\treturn false;\n\n\tcontext->offset++;\n\n\tnext_field(context);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "io_destroy",
          "args": [
            "mgmt->io"
          ],
          "line": 488
        },
        "resolved": true,
        "details": {
          "function_name": "io_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-glib.c",
          "lines": "111-135",
          "snippet": "void io_destroy(struct io *io)\n{\n\tif (!io)\n\t\treturn;\n\n\tif (io->read_watch) {\n\t\tg_source_remove(io->read_watch->id);\n\t\tio->read_watch = NULL;\n\t}\n\n\tif (io->write_watch) {\n\t\tg_source_remove(io->write_watch->id);\n\t\tio->write_watch = NULL;\n\t}\n\n\tif (io->disconnect_watch) {\n\t\tg_source_remove(io->disconnect_watch->id);\n\t\tio->disconnect_watch = NULL;\n\t}\n\n\tg_io_channel_unref(io->channel);\n\tio->channel = NULL;\n\n\tio_unref(io);\n}",
          "includes": [
            "#include \"src/shared/io.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/io.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nvoid io_destroy(struct io *io)\n{\n\tif (!io)\n\t\treturn;\n\n\tif (io->read_watch) {\n\t\tg_source_remove(io->read_watch->id);\n\t\tio->read_watch = NULL;\n\t}\n\n\tif (io->write_watch) {\n\t\tg_source_remove(io->write_watch->id);\n\t\tio->write_watch = NULL;\n\t}\n\n\tif (io->disconnect_watch) {\n\t\tg_source_remove(io->disconnect_watch->id);\n\t\tio->disconnect_watch = NULL;\n\t}\n\n\tg_io_channel_unref(io->channel);\n\tio->channel = NULL;\n\n\tio_unref(io);\n}"
        }
      },
      {
        "call_info": {
          "callee": "io_set_read_handler",
          "args": [
            "mgmt->io",
            "NULL",
            "NULL",
            "NULL"
          ],
          "line": 486
        },
        "resolved": true,
        "details": {
          "function_name": "io_set_read_handler",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-glib.c",
          "lines": "248-252",
          "snippet": "bool io_set_read_handler(struct io *io, io_callback_func_t callback,\n\t\t\t\tvoid *user_data, io_destroy_func_t destroy)\n{\n\treturn io_set_handler(io, G_IO_IN, callback, user_data, destroy);\n}",
          "includes": [
            "#include \"src/shared/io.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/io.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nbool io_set_read_handler(struct io *io, io_callback_func_t callback,\n\t\t\t\tvoid *user_data, io_destroy_func_t destroy)\n{\n\treturn io_set_handler(io, G_IO_IN, callback, user_data, destroy);\n}"
        }
      },
      {
        "call_info": {
          "callee": "io_set_write_handler",
          "args": [
            "mgmt->io",
            "NULL",
            "NULL",
            "NULL"
          ],
          "line": 485
        },
        "resolved": true,
        "details": {
          "function_name": "io_set_write_handler",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-glib.c",
          "lines": "254-258",
          "snippet": "bool io_set_write_handler(struct io *io, io_callback_func_t callback,\n\t\t\t\tvoid *user_data, io_destroy_func_t destroy)\n{\n\treturn io_set_handler(io, G_IO_OUT, callback, user_data, destroy);\n}",
          "includes": [
            "#include \"src/shared/io.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/io.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nbool io_set_write_handler(struct io *io, io_callback_func_t callback,\n\t\t\t\tvoid *user_data, io_destroy_func_t destroy)\n{\n\treturn io_set_handler(io, G_IO_OUT, callback, user_data, destroy);\n}"
        }
      },
      {
        "call_info": {
          "callee": "mgmt_cancel_all",
          "args": [
            "mgmt"
          ],
          "line": 480
        },
        "resolved": true,
        "details": {
          "function_name": "mgmt_cancel_all",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mgmt.c",
          "lines": "707-717",
          "snippet": "bool mgmt_cancel_all(struct mgmt *mgmt)\n{\n\tif (!mgmt)\n\t\treturn false;\n\n\tqueue_remove_all(mgmt->pending_list, NULL, NULL, destroy_request);\n\tqueue_remove_all(mgmt->reply_queue, NULL, NULL, destroy_request);\n\tqueue_remove_all(mgmt->request_queue, NULL, NULL, destroy_request);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/mgmt.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/mgmt.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"lib/hci.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nbool mgmt_cancel_all(struct mgmt *mgmt)\n{\n\tif (!mgmt)\n\t\treturn false;\n\n\tqueue_remove_all(mgmt->pending_list, NULL, NULL, destroy_request);\n\tqueue_remove_all(mgmt->reply_queue, NULL, NULL, destroy_request);\n\tqueue_remove_all(mgmt->request_queue, NULL, NULL, destroy_request);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "mgmt_unregister_all",
          "args": [
            "mgmt"
          ],
          "line": 479
        },
        "resolved": true,
        "details": {
          "function_name": "mgmt_unregister_all",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mgmt.c",
          "lines": "788-801",
          "snippet": "bool mgmt_unregister_all(struct mgmt *mgmt)\n{\n\tif (!mgmt)\n\t\treturn false;\n\n\tif (mgmt->in_notify) {\n\t\tqueue_foreach(mgmt->notify_list, mark_notify_removed,\n\t\t\t\t\t\tUINT_TO_PTR(MGMT_INDEX_NONE));\n\t\tmgmt->need_notify_cleanup = true;\n\t} else\n\t\tqueue_remove_all(mgmt->notify_list, NULL, NULL, destroy_notify);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/mgmt.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/mgmt.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"lib/hci.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nbool mgmt_unregister_all(struct mgmt *mgmt)\n{\n\tif (!mgmt)\n\t\treturn false;\n\n\tif (mgmt->in_notify) {\n\t\tqueue_foreach(mgmt->notify_list, mark_notify_removed,\n\t\t\t\t\t\tUINT_TO_PTR(MGMT_INDEX_NONE));\n\t\tmgmt->need_notify_cleanup = true;\n\t} else\n\t\tqueue_remove_all(mgmt->notify_list, NULL, NULL, destroy_notify);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "__sync_sub_and_fetch",
          "args": [
            "&mgmt->ref_count",
            "1"
          ],
          "line": 476
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/mgmt.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"lib/hci.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid mgmt_unref(struct mgmt *mgmt)\n{\n\tif (!mgmt)\n\t\treturn;\n\n\tif (__sync_sub_and_fetch(&mgmt->ref_count, 1))\n\t\treturn;\n\n\tmgmt_unregister_all(mgmt);\n\tmgmt_cancel_all(mgmt);\n\n\tqueue_destroy(mgmt->reply_queue, NULL);\n\tqueue_destroy(mgmt->request_queue, NULL);\n\n\tio_set_write_handler(mgmt->io, NULL, NULL, NULL);\n\tio_set_read_handler(mgmt->io, NULL, NULL, NULL);\n\n\tio_destroy(mgmt->io);\n\tmgmt->io = NULL;\n\n\tif (mgmt->close_on_unref)\n\t\tclose(mgmt->fd);\n\n\tif (mgmt->debug_destroy)\n\t\tmgmt->debug_destroy(mgmt->debug_data);\n\n\tfree(mgmt->buf);\n\tmgmt->buf = NULL;\n\n\tif (!mgmt->in_notify) {\n\t\tqueue_destroy(mgmt->notify_list, NULL);\n\t\tqueue_destroy(mgmt->pending_list, NULL);\n\t\tfree(mgmt);\n\t\treturn;\n\t}\n}"
  },
  {
    "function_name": "mgmt_ref",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mgmt.c",
    "lines": "461-469",
    "snippet": "struct mgmt *mgmt_ref(struct mgmt *mgmt)\n{\n\tif (!mgmt)\n\t\treturn NULL;\n\n\t__sync_fetch_and_add(&mgmt->ref_count, 1);\n\n\treturn mgmt;\n}",
    "includes": [
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"lib/hci.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "__sync_fetch_and_add",
          "args": [
            "&mgmt->ref_count",
            "1"
          ],
          "line": 466
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/mgmt.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"lib/hci.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstruct mgmt *mgmt_ref(struct mgmt *mgmt)\n{\n\tif (!mgmt)\n\t\treturn NULL;\n\n\t__sync_fetch_and_add(&mgmt->ref_count, 1);\n\n\treturn mgmt;\n}"
  },
  {
    "function_name": "mgmt_new_default",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mgmt.c",
    "lines": "426-459",
    "snippet": "struct mgmt *mgmt_new_default(void)\n{\n\tstruct mgmt *mgmt;\n\tunion {\n\t\tstruct sockaddr common;\n\t\tstruct sockaddr_hci hci;\n\t} addr;\n\tint fd;\n\n\tfd = socket(PF_BLUETOOTH, SOCK_RAW | SOCK_CLOEXEC | SOCK_NONBLOCK,\n\t\t\t\t\t\t\t\tBTPROTO_HCI);\n\tif (fd < 0)\n\t\treturn NULL;\n\n\tmemset(&addr, 0, sizeof(addr));\n\taddr.hci.hci_family = AF_BLUETOOTH;\n\taddr.hci.hci_dev = HCI_DEV_NONE;\n\taddr.hci.hci_channel = HCI_CHANNEL_CONTROL;\n\n\tif (bind(fd, &addr.common, sizeof(addr.hci)) < 0) {\n\t\tclose(fd);\n\t\treturn NULL;\n\t}\n\n\tmgmt = mgmt_new(fd);\n\tif (!mgmt) {\n\t\tclose(fd);\n\t\treturn NULL;\n\t}\n\n\tmgmt->close_on_unref = true;\n\n\treturn mgmt;\n}",
    "includes": [
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"lib/hci.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "close",
          "args": [
            "fd"
          ],
          "line": 452
        },
        "resolved": true,
        "details": {
          "function_name": "hfp_context_close_container",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
          "lines": "334-347",
          "snippet": "bool hfp_context_close_container(struct hfp_context *context)\n{\n\tskip_whitespace(context);\n\n\t/* The list shall be followed by a right parenthesis (\")\" V250 5.7.3.1*/\n\tif (context->data[context->offset] != ')')\n\t\treturn false;\n\n\tcontext->offset++;\n\n\tnext_field(context);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/hfp.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <ctype.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nbool hfp_context_close_container(struct hfp_context *context)\n{\n\tskip_whitespace(context);\n\n\t/* The list shall be followed by a right parenthesis (\")\" V250 5.7.3.1*/\n\tif (context->data[context->offset] != ')')\n\t\treturn false;\n\n\tcontext->offset++;\n\n\tnext_field(context);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "mgmt_new",
          "args": [
            "fd"
          ],
          "line": 450
        },
        "resolved": true,
        "details": {
          "function_name": "mgmt_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mgmt.c",
          "lines": "380-424",
          "snippet": "struct mgmt *mgmt_new(int fd)\n{\n\tstruct mgmt *mgmt;\n\n\tif (fd < 0)\n\t\treturn NULL;\n\n\tmgmt = new0(struct mgmt, 1);\n\tmgmt->fd = fd;\n\tmgmt->close_on_unref = false;\n\n\tmgmt->len = 512;\n\tmgmt->buf = malloc(mgmt->len);\n\tif (!mgmt->buf) {\n\t\tfree(mgmt);\n\t\treturn NULL;\n\t}\n\n\tmgmt->io = io_new(fd);\n\tif (!mgmt->io) {\n\t\tfree(mgmt->buf);\n\t\tfree(mgmt);\n\t\treturn NULL;\n\t}\n\n\tmgmt->request_queue = queue_new();\n\tmgmt->reply_queue = queue_new();\n\tmgmt->pending_list = queue_new();\n\tmgmt->notify_list = queue_new();\n\n\tif (!io_set_read_handler(mgmt->io, can_read_data, mgmt, NULL)) {\n\t\tqueue_destroy(mgmt->notify_list, NULL);\n\t\tqueue_destroy(mgmt->pending_list, NULL);\n\t\tqueue_destroy(mgmt->reply_queue, NULL);\n\t\tqueue_destroy(mgmt->request_queue, NULL);\n\t\tio_destroy(mgmt->io);\n\t\tfree(mgmt->buf);\n\t\tfree(mgmt);\n\t\treturn NULL;\n\t}\n\n\tmgmt->writer_active = false;\n\n\treturn mgmt_ref(mgmt);\n}",
          "includes": [
            "#include \"src/shared/mgmt.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/mgmt.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"lib/hci.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstruct mgmt *mgmt_new(int fd)\n{\n\tstruct mgmt *mgmt;\n\n\tif (fd < 0)\n\t\treturn NULL;\n\n\tmgmt = new0(struct mgmt, 1);\n\tmgmt->fd = fd;\n\tmgmt->close_on_unref = false;\n\n\tmgmt->len = 512;\n\tmgmt->buf = malloc(mgmt->len);\n\tif (!mgmt->buf) {\n\t\tfree(mgmt);\n\t\treturn NULL;\n\t}\n\n\tmgmt->io = io_new(fd);\n\tif (!mgmt->io) {\n\t\tfree(mgmt->buf);\n\t\tfree(mgmt);\n\t\treturn NULL;\n\t}\n\n\tmgmt->request_queue = queue_new();\n\tmgmt->reply_queue = queue_new();\n\tmgmt->pending_list = queue_new();\n\tmgmt->notify_list = queue_new();\n\n\tif (!io_set_read_handler(mgmt->io, can_read_data, mgmt, NULL)) {\n\t\tqueue_destroy(mgmt->notify_list, NULL);\n\t\tqueue_destroy(mgmt->pending_list, NULL);\n\t\tqueue_destroy(mgmt->reply_queue, NULL);\n\t\tqueue_destroy(mgmt->request_queue, NULL);\n\t\tio_destroy(mgmt->io);\n\t\tfree(mgmt->buf);\n\t\tfree(mgmt);\n\t\treturn NULL;\n\t}\n\n\tmgmt->writer_active = false;\n\n\treturn mgmt_ref(mgmt);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bind",
          "args": [
            "fd",
            "&addr.common",
            "sizeof(addr.hci)"
          ],
          "line": 445
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&addr",
            "0",
            "sizeof(addr)"
          ],
          "line": 440
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "socket",
          "args": [
            "PF_BLUETOOTH",
            "SOCK_RAW | SOCK_CLOEXEC | SOCK_NONBLOCK",
            "BTPROTO_HCI"
          ],
          "line": 435
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/mgmt.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"lib/hci.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstruct mgmt *mgmt_new_default(void)\n{\n\tstruct mgmt *mgmt;\n\tunion {\n\t\tstruct sockaddr common;\n\t\tstruct sockaddr_hci hci;\n\t} addr;\n\tint fd;\n\n\tfd = socket(PF_BLUETOOTH, SOCK_RAW | SOCK_CLOEXEC | SOCK_NONBLOCK,\n\t\t\t\t\t\t\t\tBTPROTO_HCI);\n\tif (fd < 0)\n\t\treturn NULL;\n\n\tmemset(&addr, 0, sizeof(addr));\n\taddr.hci.hci_family = AF_BLUETOOTH;\n\taddr.hci.hci_dev = HCI_DEV_NONE;\n\taddr.hci.hci_channel = HCI_CHANNEL_CONTROL;\n\n\tif (bind(fd, &addr.common, sizeof(addr.hci)) < 0) {\n\t\tclose(fd);\n\t\treturn NULL;\n\t}\n\n\tmgmt = mgmt_new(fd);\n\tif (!mgmt) {\n\t\tclose(fd);\n\t\treturn NULL;\n\t}\n\n\tmgmt->close_on_unref = true;\n\n\treturn mgmt;\n}"
  },
  {
    "function_name": "mgmt_new",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mgmt.c",
    "lines": "380-424",
    "snippet": "struct mgmt *mgmt_new(int fd)\n{\n\tstruct mgmt *mgmt;\n\n\tif (fd < 0)\n\t\treturn NULL;\n\n\tmgmt = new0(struct mgmt, 1);\n\tmgmt->fd = fd;\n\tmgmt->close_on_unref = false;\n\n\tmgmt->len = 512;\n\tmgmt->buf = malloc(mgmt->len);\n\tif (!mgmt->buf) {\n\t\tfree(mgmt);\n\t\treturn NULL;\n\t}\n\n\tmgmt->io = io_new(fd);\n\tif (!mgmt->io) {\n\t\tfree(mgmt->buf);\n\t\tfree(mgmt);\n\t\treturn NULL;\n\t}\n\n\tmgmt->request_queue = queue_new();\n\tmgmt->reply_queue = queue_new();\n\tmgmt->pending_list = queue_new();\n\tmgmt->notify_list = queue_new();\n\n\tif (!io_set_read_handler(mgmt->io, can_read_data, mgmt, NULL)) {\n\t\tqueue_destroy(mgmt->notify_list, NULL);\n\t\tqueue_destroy(mgmt->pending_list, NULL);\n\t\tqueue_destroy(mgmt->reply_queue, NULL);\n\t\tqueue_destroy(mgmt->request_queue, NULL);\n\t\tio_destroy(mgmt->io);\n\t\tfree(mgmt->buf);\n\t\tfree(mgmt);\n\t\treturn NULL;\n\t}\n\n\tmgmt->writer_active = false;\n\n\treturn mgmt_ref(mgmt);\n}",
    "includes": [
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"lib/hci.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "mgmt_ref",
          "args": [
            "mgmt"
          ],
          "line": 423
        },
        "resolved": true,
        "details": {
          "function_name": "mgmt_ref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mgmt.c",
          "lines": "461-469",
          "snippet": "struct mgmt *mgmt_ref(struct mgmt *mgmt)\n{\n\tif (!mgmt)\n\t\treturn NULL;\n\n\t__sync_fetch_and_add(&mgmt->ref_count, 1);\n\n\treturn mgmt;\n}",
          "includes": [
            "#include \"src/shared/mgmt.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/mgmt.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"lib/hci.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstruct mgmt *mgmt_ref(struct mgmt *mgmt)\n{\n\tif (!mgmt)\n\t\treturn NULL;\n\n\t__sync_fetch_and_add(&mgmt->ref_count, 1);\n\n\treturn mgmt;\n}"
        }
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "mgmt"
          ],
          "line": 417
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "956-985",
          "snippet": "static void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}"
        }
      },
      {
        "call_info": {
          "callee": "io_destroy",
          "args": [
            "mgmt->io"
          ],
          "line": 415
        },
        "resolved": true,
        "details": {
          "function_name": "io_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-glib.c",
          "lines": "111-135",
          "snippet": "void io_destroy(struct io *io)\n{\n\tif (!io)\n\t\treturn;\n\n\tif (io->read_watch) {\n\t\tg_source_remove(io->read_watch->id);\n\t\tio->read_watch = NULL;\n\t}\n\n\tif (io->write_watch) {\n\t\tg_source_remove(io->write_watch->id);\n\t\tio->write_watch = NULL;\n\t}\n\n\tif (io->disconnect_watch) {\n\t\tg_source_remove(io->disconnect_watch->id);\n\t\tio->disconnect_watch = NULL;\n\t}\n\n\tg_io_channel_unref(io->channel);\n\tio->channel = NULL;\n\n\tio_unref(io);\n}",
          "includes": [
            "#include \"src/shared/io.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/io.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nvoid io_destroy(struct io *io)\n{\n\tif (!io)\n\t\treturn;\n\n\tif (io->read_watch) {\n\t\tg_source_remove(io->read_watch->id);\n\t\tio->read_watch = NULL;\n\t}\n\n\tif (io->write_watch) {\n\t\tg_source_remove(io->write_watch->id);\n\t\tio->write_watch = NULL;\n\t}\n\n\tif (io->disconnect_watch) {\n\t\tg_source_remove(io->disconnect_watch->id);\n\t\tio->disconnect_watch = NULL;\n\t}\n\n\tg_io_channel_unref(io->channel);\n\tio->channel = NULL;\n\n\tio_unref(io);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_destroy",
          "args": [
            "mgmt->request_queue",
            "NULL"
          ],
          "line": 414
        },
        "resolved": true,
        "details": {
          "function_name": "queue_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "68-76",
          "snippet": "void queue_destroy(struct queue *queue, queue_destroy_func_t destroy)\n{\n\tif (!queue)\n\t\treturn;\n\n\tqueue_remove_all(queue, NULL, NULL, destroy);\n\n\tqueue_unref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid queue_destroy(struct queue *queue, queue_destroy_func_t destroy)\n{\n\tif (!queue)\n\t\treturn;\n\n\tqueue_remove_all(queue, NULL, NULL, destroy);\n\n\tqueue_unref(queue);\n}"
        }
      },
      {
        "call_info": {
          "callee": "io_set_read_handler",
          "args": [
            "mgmt->io",
            "can_read_data",
            "mgmt",
            "NULL"
          ],
          "line": 410
        },
        "resolved": true,
        "details": {
          "function_name": "io_set_read_handler",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-glib.c",
          "lines": "248-252",
          "snippet": "bool io_set_read_handler(struct io *io, io_callback_func_t callback,\n\t\t\t\tvoid *user_data, io_destroy_func_t destroy)\n{\n\treturn io_set_handler(io, G_IO_IN, callback, user_data, destroy);\n}",
          "includes": [
            "#include \"src/shared/io.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/io.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nbool io_set_read_handler(struct io *io, io_callback_func_t callback,\n\t\t\t\tvoid *user_data, io_destroy_func_t destroy)\n{\n\treturn io_set_handler(io, G_IO_IN, callback, user_data, destroy);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_new",
          "args": [],
          "line": 408
        },
        "resolved": true,
        "details": {
          "function_name": "queue_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "56-66",
          "snippet": "struct queue *queue_new(void)\n{\n\tstruct queue *queue;\n\n\tqueue = new0(struct queue, 1);\n\tqueue->head = NULL;\n\tqueue->tail = NULL;\n\tqueue->entries = 0;\n\n\treturn queue_ref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nstruct queue *queue_new(void)\n{\n\tstruct queue *queue;\n\n\tqueue = new0(struct queue, 1);\n\tqueue->head = NULL;\n\tqueue->tail = NULL;\n\tqueue->entries = 0;\n\n\treturn queue_ref(queue);\n}"
        }
      },
      {
        "call_info": {
          "callee": "io_new",
          "args": [
            "fd"
          ],
          "line": 398
        },
        "resolved": true,
        "details": {
          "function_name": "io_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-glib.c",
          "lines": "71-90",
          "snippet": "struct io *io_new(int fd)\n{\n\tstruct io *io;\n\n\tif (fd < 0)\n\t\treturn NULL;\n\n\tio = g_try_new0(struct io, 1);\n\tif (!io)\n\t\treturn NULL;\n\n\tio->channel = g_io_channel_unix_new(fd);\n\n\tg_io_channel_set_encoding(io->channel, NULL, NULL);\n\tg_io_channel_set_buffered(io->channel, FALSE);\n\n\tg_io_channel_set_close_on_unref(io->channel, FALSE);\n\n\treturn io_ref(io);\n}",
          "includes": [
            "#include \"src/shared/io.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/io.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nstruct io *io_new(int fd)\n{\n\tstruct io *io;\n\n\tif (fd < 0)\n\t\treturn NULL;\n\n\tio = g_try_new0(struct io, 1);\n\tif (!io)\n\t\treturn NULL;\n\n\tio->channel = g_io_channel_unix_new(fd);\n\n\tg_io_channel_set_encoding(io->channel, NULL, NULL);\n\tg_io_channel_set_buffered(io->channel, FALSE);\n\n\tg_io_channel_set_close_on_unref(io->channel, FALSE);\n\n\treturn io_ref(io);\n}"
        }
      },
      {
        "call_info": {
          "callee": "malloc",
          "args": [
            "mgmt->len"
          ],
          "line": 392
        },
        "resolved": true,
        "details": {
          "function_name": "btd_malloc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/util.c",
          "lines": "41-55",
          "snippet": "void *btd_malloc(size_t size)\n{\n\tif (__builtin_expect(!!size, 1)) {\n\t\tvoid *ptr;\n\n\t\tptr = malloc(size);\n\t\tif (ptr)\n\t\t\treturn ptr;\n\n\t\tfprintf(stderr, \"failed to allocate %zu bytes\\n\", size);\n\t\tabort();\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include <string.h>",
            "#include <limits.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include <string.h>\n#include <limits.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid *btd_malloc(size_t size)\n{\n\tif (__builtin_expect(!!size, 1)) {\n\t\tvoid *ptr;\n\n\t\tptr = malloc(size);\n\t\tif (ptr)\n\t\t\treturn ptr;\n\n\t\tfprintf(stderr, \"failed to allocate %zu bytes\\n\", size);\n\t\tabort();\n\t}\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "new0",
          "args": [
            "structmgmt",
            "1"
          ],
          "line": 387
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/mgmt.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"lib/hci.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstruct mgmt *mgmt_new(int fd)\n{\n\tstruct mgmt *mgmt;\n\n\tif (fd < 0)\n\t\treturn NULL;\n\n\tmgmt = new0(struct mgmt, 1);\n\tmgmt->fd = fd;\n\tmgmt->close_on_unref = false;\n\n\tmgmt->len = 512;\n\tmgmt->buf = malloc(mgmt->len);\n\tif (!mgmt->buf) {\n\t\tfree(mgmt);\n\t\treturn NULL;\n\t}\n\n\tmgmt->io = io_new(fd);\n\tif (!mgmt->io) {\n\t\tfree(mgmt->buf);\n\t\tfree(mgmt);\n\t\treturn NULL;\n\t}\n\n\tmgmt->request_queue = queue_new();\n\tmgmt->reply_queue = queue_new();\n\tmgmt->pending_list = queue_new();\n\tmgmt->notify_list = queue_new();\n\n\tif (!io_set_read_handler(mgmt->io, can_read_data, mgmt, NULL)) {\n\t\tqueue_destroy(mgmt->notify_list, NULL);\n\t\tqueue_destroy(mgmt->pending_list, NULL);\n\t\tqueue_destroy(mgmt->reply_queue, NULL);\n\t\tqueue_destroy(mgmt->request_queue, NULL);\n\t\tio_destroy(mgmt->io);\n\t\tfree(mgmt->buf);\n\t\tfree(mgmt);\n\t\treturn NULL;\n\t}\n\n\tmgmt->writer_active = false;\n\n\treturn mgmt_ref(mgmt);\n}"
  },
  {
    "function_name": "can_read_data",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mgmt.c",
    "lines": "315-378",
    "snippet": "static bool can_read_data(struct io *io, void *user_data)\n{\n\tstruct mgmt *mgmt = user_data;\n\tstruct mgmt_hdr *hdr;\n\tstruct mgmt_ev_cmd_complete *cc;\n\tstruct mgmt_ev_cmd_status *cs;\n\tssize_t bytes_read;\n\tuint16_t opcode, event, index, length;\n\n\tbytes_read = read(mgmt->fd, mgmt->buf, mgmt->len);\n\tif (bytes_read < 0)\n\t\treturn false;\n\n\tutil_hexdump('>', mgmt->buf, bytes_read,\n\t\t\t\tmgmt->debug_callback, mgmt->debug_data);\n\n\tif (bytes_read < MGMT_HDR_SIZE)\n\t\treturn true;\n\n\thdr = mgmt->buf;\n\tevent = btohs(hdr->opcode);\n\tindex = btohs(hdr->index);\n\tlength = btohs(hdr->len);\n\n\tif (bytes_read < length + MGMT_HDR_SIZE)\n\t\treturn true;\n\n\tmgmt_ref(mgmt);\n\n\tswitch (event) {\n\tcase MGMT_EV_CMD_COMPLETE:\n\t\tcc = mgmt->buf + MGMT_HDR_SIZE;\n\t\topcode = btohs(cc->opcode);\n\n\t\tutil_debug(mgmt->debug_callback, mgmt->debug_data,\n\t\t\t\t\"[0x%04x] command 0x%04x complete: 0x%02x\",\n\t\t\t\t\t\tindex, opcode, cc->status);\n\n\t\trequest_complete(mgmt, cc->status, opcode, index, length - 3,\n\t\t\t\t\t\tmgmt->buf + MGMT_HDR_SIZE + 3);\n\t\tbreak;\n\tcase MGMT_EV_CMD_STATUS:\n\t\tcs = mgmt->buf + MGMT_HDR_SIZE;\n\t\topcode = btohs(cs->opcode);\n\n\t\tutil_debug(mgmt->debug_callback, mgmt->debug_data,\n\t\t\t\t\"[0x%04x] command 0x%02x status: 0x%02x\",\n\t\t\t\t\t\tindex, opcode, cs->status);\n\n\t\trequest_complete(mgmt, cs->status, opcode, index, 0, NULL);\n\t\tbreak;\n\tdefault:\n\t\tutil_debug(mgmt->debug_callback, mgmt->debug_data,\n\t\t\t\t\"[0x%04x] event 0x%04x\", index, event);\n\n\t\tprocess_notify(mgmt, event, index, length,\n\t\t\t\t\t\tmgmt->buf + MGMT_HDR_SIZE);\n\t\tbreak;\n\t}\n\n\tmgmt_unref(mgmt);\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"lib/hci.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "mgmt_unref",
          "args": [
            "mgmt"
          ],
          "line": 375
        },
        "resolved": true,
        "details": {
          "function_name": "mgmt_unref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mgmt.c",
          "lines": "471-506",
          "snippet": "void mgmt_unref(struct mgmt *mgmt)\n{\n\tif (!mgmt)\n\t\treturn;\n\n\tif (__sync_sub_and_fetch(&mgmt->ref_count, 1))\n\t\treturn;\n\n\tmgmt_unregister_all(mgmt);\n\tmgmt_cancel_all(mgmt);\n\n\tqueue_destroy(mgmt->reply_queue, NULL);\n\tqueue_destroy(mgmt->request_queue, NULL);\n\n\tio_set_write_handler(mgmt->io, NULL, NULL, NULL);\n\tio_set_read_handler(mgmt->io, NULL, NULL, NULL);\n\n\tio_destroy(mgmt->io);\n\tmgmt->io = NULL;\n\n\tif (mgmt->close_on_unref)\n\t\tclose(mgmt->fd);\n\n\tif (mgmt->debug_destroy)\n\t\tmgmt->debug_destroy(mgmt->debug_data);\n\n\tfree(mgmt->buf);\n\tmgmt->buf = NULL;\n\n\tif (!mgmt->in_notify) {\n\t\tqueue_destroy(mgmt->notify_list, NULL);\n\t\tqueue_destroy(mgmt->pending_list, NULL);\n\t\tfree(mgmt);\n\t\treturn;\n\t}\n}",
          "includes": [
            "#include \"src/shared/mgmt.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/mgmt.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"lib/hci.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid mgmt_unref(struct mgmt *mgmt)\n{\n\tif (!mgmt)\n\t\treturn;\n\n\tif (__sync_sub_and_fetch(&mgmt->ref_count, 1))\n\t\treturn;\n\n\tmgmt_unregister_all(mgmt);\n\tmgmt_cancel_all(mgmt);\n\n\tqueue_destroy(mgmt->reply_queue, NULL);\n\tqueue_destroy(mgmt->request_queue, NULL);\n\n\tio_set_write_handler(mgmt->io, NULL, NULL, NULL);\n\tio_set_read_handler(mgmt->io, NULL, NULL, NULL);\n\n\tio_destroy(mgmt->io);\n\tmgmt->io = NULL;\n\n\tif (mgmt->close_on_unref)\n\t\tclose(mgmt->fd);\n\n\tif (mgmt->debug_destroy)\n\t\tmgmt->debug_destroy(mgmt->debug_data);\n\n\tfree(mgmt->buf);\n\tmgmt->buf = NULL;\n\n\tif (!mgmt->in_notify) {\n\t\tqueue_destroy(mgmt->notify_list, NULL);\n\t\tqueue_destroy(mgmt->pending_list, NULL);\n\t\tfree(mgmt);\n\t\treturn;\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "process_notify",
          "args": [
            "mgmt",
            "event",
            "index",
            "length",
            "mgmt->buf + MGMT_HDR_SIZE"
          ],
          "line": 370
        },
        "resolved": true,
        "details": {
          "function_name": "process_notify",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mgmt.c",
          "lines": "296-313",
          "snippet": "static void process_notify(struct mgmt *mgmt, uint16_t event, uint16_t index,\n\t\t\t\t\tuint16_t length, const void *param)\n{\n\tstruct event_index match = { .event = event, .index = index,\n\t\t\t\t\t.length = length, .param = param };\n\n\tmgmt->in_notify = true;\n\n\tqueue_foreach(mgmt->notify_list, notify_handler, &match);\n\n\tmgmt->in_notify = false;\n\n\tif (mgmt->need_notify_cleanup) {\n\t\tqueue_remove_all(mgmt->notify_list, match_notify_removed,\n\t\t\t\t\t\t\tNULL, destroy_notify);\n\t\tmgmt->need_notify_cleanup = false;\n\t}\n}",
          "includes": [
            "#include \"src/shared/mgmt.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/mgmt.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"lib/hci.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void process_notify(struct mgmt *mgmt, uint16_t event, uint16_t index,\n\t\t\t\t\tuint16_t length, const void *param)\n{\n\tstruct event_index match = { .event = event, .index = index,\n\t\t\t\t\t.length = length, .param = param };\n\n\tmgmt->in_notify = true;\n\n\tqueue_foreach(mgmt->notify_list, notify_handler, &match);\n\n\tmgmt->in_notify = false;\n\n\tif (mgmt->need_notify_cleanup) {\n\t\tqueue_remove_all(mgmt->notify_list, match_notify_removed,\n\t\t\t\t\t\t\tNULL, destroy_notify);\n\t\tmgmt->need_notify_cleanup = false;\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "util_debug",
          "args": [
            "mgmt->debug_callback",
            "mgmt->debug_data",
            "\"[0x%04x] event 0x%04x\"",
            "index",
            "event"
          ],
          "line": 367
        },
        "resolved": true,
        "details": {
          "function_name": "util_debug",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/util.c",
          "lines": "57-71",
          "snippet": "void util_debug(util_debug_func_t function, void *user_data,\n\t\t\t\t\t\tconst char *format, ...)\n{\n\tchar str[78];\n\tva_list ap;\n\n\tif (!function || !format)\n\t\treturn;\n\n\tva_start(ap, format);\n\tvsnprintf(str, sizeof(str), format, ap);\n\tva_end(ap);\n\n\tfunction(str, user_data);\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include <string.h>",
            "#include <limits.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include <string.h>\n#include <limits.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid util_debug(util_debug_func_t function, void *user_data,\n\t\t\t\t\t\tconst char *format, ...)\n{\n\tchar str[78];\n\tva_list ap;\n\n\tif (!function || !format)\n\t\treturn;\n\n\tva_start(ap, format);\n\tvsnprintf(str, sizeof(str), format, ap);\n\tva_end(ap);\n\n\tfunction(str, user_data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "request_complete",
          "args": [
            "mgmt",
            "cs->status",
            "opcode",
            "index",
            "0",
            "NULL"
          ],
          "line": 364
        },
        "resolved": true,
        "details": {
          "function_name": "request_complete",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mgmt.c",
          "lines": "250-268",
          "snippet": "static void request_complete(struct mgmt *mgmt, uint8_t status,\n\t\t\t\t\tuint16_t opcode, uint16_t index,\n\t\t\t\t\tuint16_t length, const void *param)\n{\n\tstruct opcode_index match = { .opcode = opcode, .index = index };\n\tstruct mgmt_request *request;\n\n\trequest = queue_remove_if(mgmt->pending_list,\n\t\t\t\t\tmatch_request_opcode_index, &match);\n\tif (request) {\n\t\tif (request->callback)\n\t\t\trequest->callback(status, length, param,\n\t\t\t\t\t\t\trequest->user_data);\n\n\t\tdestroy_request(request);\n\t}\n\n\twakeup_writer(mgmt);\n}",
          "includes": [
            "#include \"src/shared/mgmt.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/mgmt.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"lib/hci.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void request_complete(struct mgmt *mgmt, uint8_t status,\n\t\t\t\t\tuint16_t opcode, uint16_t index,\n\t\t\t\t\tuint16_t length, const void *param)\n{\n\tstruct opcode_index match = { .opcode = opcode, .index = index };\n\tstruct mgmt_request *request;\n\n\trequest = queue_remove_if(mgmt->pending_list,\n\t\t\t\t\tmatch_request_opcode_index, &match);\n\tif (request) {\n\t\tif (request->callback)\n\t\t\trequest->callback(status, length, param,\n\t\t\t\t\t\t\trequest->user_data);\n\n\t\tdestroy_request(request);\n\t}\n\n\twakeup_writer(mgmt);\n}"
        }
      },
      {
        "call_info": {
          "callee": "btohs",
          "args": [
            "cs->opcode"
          ],
          "line": 358
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btohs",
          "args": [
            "cc->opcode"
          ],
          "line": 347
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mgmt_ref",
          "args": [
            "mgmt"
          ],
          "line": 342
        },
        "resolved": true,
        "details": {
          "function_name": "mgmt_ref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mgmt.c",
          "lines": "461-469",
          "snippet": "struct mgmt *mgmt_ref(struct mgmt *mgmt)\n{\n\tif (!mgmt)\n\t\treturn NULL;\n\n\t__sync_fetch_and_add(&mgmt->ref_count, 1);\n\n\treturn mgmt;\n}",
          "includes": [
            "#include \"src/shared/mgmt.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/mgmt.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"lib/hci.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstruct mgmt *mgmt_ref(struct mgmt *mgmt)\n{\n\tif (!mgmt)\n\t\treturn NULL;\n\n\t__sync_fetch_and_add(&mgmt->ref_count, 1);\n\n\treturn mgmt;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btohs",
          "args": [
            "hdr->len"
          ],
          "line": 337
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btohs",
          "args": [
            "hdr->index"
          ],
          "line": 336
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btohs",
          "args": [
            "hdr->opcode"
          ],
          "line": 335
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "util_hexdump",
          "args": [
            "'>'",
            "mgmt->buf",
            "bytes_read",
            "mgmt->debug_callback",
            "mgmt->debug_data"
          ],
          "line": 328
        },
        "resolved": true,
        "details": {
          "function_name": "util_hexdump",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/util.c",
          "lines": "73-113",
          "snippet": "void util_hexdump(const char dir, const unsigned char *buf, size_t len,\n\t\t\t\tutil_debug_func_t function, void *user_data)\n{\n\tstatic const char hexdigits[] = \"0123456789abcdef\";\n\tchar str[68];\n\tsize_t i;\n\n\tif (!function || !len)\n\t\treturn;\n\n\tstr[0] = dir;\n\n\tfor (i = 0; i < len; i++) {\n\t\tstr[((i % 16) * 3) + 1] = ' ';\n\t\tstr[((i % 16) * 3) + 2] = hexdigits[buf[i] >> 4];\n\t\tstr[((i % 16) * 3) + 3] = hexdigits[buf[i] & 0xf];\n\t\tstr[(i % 16) + 51] = isprint(buf[i]) ? buf[i] : '.';\n\n\t\tif ((i + 1) % 16 == 0) {\n\t\t\tstr[49] = ' ';\n\t\t\tstr[50] = ' ';\n\t\t\tstr[67] = '\\0';\n\t\t\tfunction(str, user_data);\n\t\t\tstr[0] = ' ';\n\t\t}\n\t}\n\n\tif (i % 16 > 0) {\n\t\tsize_t j;\n\t\tfor (j = (i % 16); j < 16; j++) {\n\t\t\tstr[(j * 3) + 1] = ' ';\n\t\t\tstr[(j * 3) + 2] = ' ';\n\t\t\tstr[(j * 3) + 3] = ' ';\n\t\t\tstr[j + 51] = ' ';\n\t\t}\n\t\tstr[49] = ' ';\n\t\tstr[50] = ' ';\n\t\tstr[67] = '\\0';\n\t\tfunction(str, user_data);\n\t}\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include <string.h>",
            "#include <limits.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include <string.h>\n#include <limits.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid util_hexdump(const char dir, const unsigned char *buf, size_t len,\n\t\t\t\tutil_debug_func_t function, void *user_data)\n{\n\tstatic const char hexdigits[] = \"0123456789abcdef\";\n\tchar str[68];\n\tsize_t i;\n\n\tif (!function || !len)\n\t\treturn;\n\n\tstr[0] = dir;\n\n\tfor (i = 0; i < len; i++) {\n\t\tstr[((i % 16) * 3) + 1] = ' ';\n\t\tstr[((i % 16) * 3) + 2] = hexdigits[buf[i] >> 4];\n\t\tstr[((i % 16) * 3) + 3] = hexdigits[buf[i] & 0xf];\n\t\tstr[(i % 16) + 51] = isprint(buf[i]) ? buf[i] : '.';\n\n\t\tif ((i + 1) % 16 == 0) {\n\t\t\tstr[49] = ' ';\n\t\t\tstr[50] = ' ';\n\t\t\tstr[67] = '\\0';\n\t\t\tfunction(str, user_data);\n\t\t\tstr[0] = ' ';\n\t\t}\n\t}\n\n\tif (i % 16 > 0) {\n\t\tsize_t j;\n\t\tfor (j = (i % 16); j < 16; j++) {\n\t\t\tstr[(j * 3) + 1] = ' ';\n\t\t\tstr[(j * 3) + 2] = ' ';\n\t\t\tstr[(j * 3) + 3] = ' ';\n\t\t\tstr[j + 51] = ' ';\n\t\t}\n\t\tstr[49] = ' ';\n\t\tstr[50] = ' ';\n\t\tstr[67] = '\\0';\n\t\tfunction(str, user_data);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "read",
          "args": [
            "mgmt->fd",
            "mgmt->buf",
            "mgmt->len"
          ],
          "line": 324
        },
        "resolved": true,
        "details": {
          "function_name": "notify_client_ready",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-client.c",
          "lines": "1221-1250",
          "snippet": "static void notify_client_ready(struct bt_gatt_client *client, bool success,\n\t\t\t\t\t\t\tuint8_t att_ecode)\n{\n\tconst struct queue_entry *entry;\n\n\tif (client->ready)\n\t\treturn;\n\n\tbt_gatt_client_ref(client);\n\tclient->ready = success;\n\n\tfor (entry = queue_get_entries(client->ready_cbs); entry;\n\t\t\t\t\t\t\tentry = entry->next) {\n\t\tstruct ready_cb *ready = entry->data;\n\n\t\tready->callback(success, att_ecode, ready->data);\n\t}\n\n\tqueue_remove_all(client->ready_cbs, NULL, NULL, ready_destroy);\n\n\t/* Notify clones */\n\tfor (entry = queue_get_entries(client->clones); entry;\n\t\t\t\t\t\t\tentry = entry->next) {\n\t\tstruct bt_gatt_client *clone = entry->data;\n\n\t\tnotify_client_ready(clone, success, att_ecode);\n\t}\n\n\tbt_gatt_client_unref(client);\n}",
          "includes": [
            "#include <sys/uio.h>",
            "#include <limits.h>",
            "#include <assert.h>",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-helpers.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/att.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/uio.h>\n#include <limits.h>\n#include <assert.h>\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-helpers.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/att.h\"\n#include <config.h>\n\nstatic void notify_client_ready(struct bt_gatt_client *client, bool success,\n\t\t\t\t\t\t\tuint8_t att_ecode)\n{\n\tconst struct queue_entry *entry;\n\n\tif (client->ready)\n\t\treturn;\n\n\tbt_gatt_client_ref(client);\n\tclient->ready = success;\n\n\tfor (entry = queue_get_entries(client->ready_cbs); entry;\n\t\t\t\t\t\t\tentry = entry->next) {\n\t\tstruct ready_cb *ready = entry->data;\n\n\t\tready->callback(success, att_ecode, ready->data);\n\t}\n\n\tqueue_remove_all(client->ready_cbs, NULL, NULL, ready_destroy);\n\n\t/* Notify clones */\n\tfor (entry = queue_get_entries(client->clones); entry;\n\t\t\t\t\t\t\tentry = entry->next) {\n\t\tstruct bt_gatt_client *clone = entry->data;\n\n\t\tnotify_client_ready(clone, success, att_ecode);\n\t}\n\n\tbt_gatt_client_unref(client);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/mgmt.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"lib/hci.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic bool can_read_data(struct io *io, void *user_data)\n{\n\tstruct mgmt *mgmt = user_data;\n\tstruct mgmt_hdr *hdr;\n\tstruct mgmt_ev_cmd_complete *cc;\n\tstruct mgmt_ev_cmd_status *cs;\n\tssize_t bytes_read;\n\tuint16_t opcode, event, index, length;\n\n\tbytes_read = read(mgmt->fd, mgmt->buf, mgmt->len);\n\tif (bytes_read < 0)\n\t\treturn false;\n\n\tutil_hexdump('>', mgmt->buf, bytes_read,\n\t\t\t\tmgmt->debug_callback, mgmt->debug_data);\n\n\tif (bytes_read < MGMT_HDR_SIZE)\n\t\treturn true;\n\n\thdr = mgmt->buf;\n\tevent = btohs(hdr->opcode);\n\tindex = btohs(hdr->index);\n\tlength = btohs(hdr->len);\n\n\tif (bytes_read < length + MGMT_HDR_SIZE)\n\t\treturn true;\n\n\tmgmt_ref(mgmt);\n\n\tswitch (event) {\n\tcase MGMT_EV_CMD_COMPLETE:\n\t\tcc = mgmt->buf + MGMT_HDR_SIZE;\n\t\topcode = btohs(cc->opcode);\n\n\t\tutil_debug(mgmt->debug_callback, mgmt->debug_data,\n\t\t\t\t\"[0x%04x] command 0x%04x complete: 0x%02x\",\n\t\t\t\t\t\tindex, opcode, cc->status);\n\n\t\trequest_complete(mgmt, cc->status, opcode, index, length - 3,\n\t\t\t\t\t\tmgmt->buf + MGMT_HDR_SIZE + 3);\n\t\tbreak;\n\tcase MGMT_EV_CMD_STATUS:\n\t\tcs = mgmt->buf + MGMT_HDR_SIZE;\n\t\topcode = btohs(cs->opcode);\n\n\t\tutil_debug(mgmt->debug_callback, mgmt->debug_data,\n\t\t\t\t\"[0x%04x] command 0x%02x status: 0x%02x\",\n\t\t\t\t\t\tindex, opcode, cs->status);\n\n\t\trequest_complete(mgmt, cs->status, opcode, index, 0, NULL);\n\t\tbreak;\n\tdefault:\n\t\tutil_debug(mgmt->debug_callback, mgmt->debug_data,\n\t\t\t\t\"[0x%04x] event 0x%04x\", index, event);\n\n\t\tprocess_notify(mgmt, event, index, length,\n\t\t\t\t\t\tmgmt->buf + MGMT_HDR_SIZE);\n\t\tbreak;\n\t}\n\n\tmgmt_unref(mgmt);\n\n\treturn true;\n}"
  },
  {
    "function_name": "process_notify",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mgmt.c",
    "lines": "296-313",
    "snippet": "static void process_notify(struct mgmt *mgmt, uint16_t event, uint16_t index,\n\t\t\t\t\tuint16_t length, const void *param)\n{\n\tstruct event_index match = { .event = event, .index = index,\n\t\t\t\t\t.length = length, .param = param };\n\n\tmgmt->in_notify = true;\n\n\tqueue_foreach(mgmt->notify_list, notify_handler, &match);\n\n\tmgmt->in_notify = false;\n\n\tif (mgmt->need_notify_cleanup) {\n\t\tqueue_remove_all(mgmt->notify_list, match_notify_removed,\n\t\t\t\t\t\t\tNULL, destroy_notify);\n\t\tmgmt->need_notify_cleanup = false;\n\t}\n}",
    "includes": [
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"lib/hci.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_remove_all",
          "args": [
            "mgmt->notify_list",
            "match_notify_removed",
            "NULL",
            "destroy_notify"
          ],
          "line": 309
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_all",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "318-362",
          "snippet": "unsigned int queue_remove_all(struct queue *queue, queue_match_func_t function,\n\t\t\t\tvoid *user_data, queue_destroy_func_t destroy)\n{\n\tstruct queue_entry *entry;\n\tunsigned int count = 0;\n\n\tif (!queue)\n\t\treturn 0;\n\n\tentry = queue->head;\n\n\tif (function) {\n\t\twhile (entry) {\n\t\t\tvoid *data;\n\t\t\tunsigned int entries = queue->entries;\n\n\t\t\tdata = queue_remove_if(queue, function, user_data);\n\t\t\tif (entries == queue->entries)\n\t\t\t\tbreak;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(data);\n\n\t\t\tcount++;\n\t\t}\n\t} else {\n\t\tqueue->head = NULL;\n\t\tqueue->tail = NULL;\n\t\tqueue->entries = 0;\n\n\t\twhile (entry) {\n\t\t\tstruct queue_entry *tmp = entry;\n\n\t\t\tentry = entry->next;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(tmp->data);\n\n\t\t\tfree(tmp);\n\t\t\tcount++;\n\t\t}\n\t}\n\n\treturn count;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nunsigned int queue_remove_all(struct queue *queue, queue_match_func_t function,\n\t\t\t\tvoid *user_data, queue_destroy_func_t destroy)\n{\n\tstruct queue_entry *entry;\n\tunsigned int count = 0;\n\n\tif (!queue)\n\t\treturn 0;\n\n\tentry = queue->head;\n\n\tif (function) {\n\t\twhile (entry) {\n\t\t\tvoid *data;\n\t\t\tunsigned int entries = queue->entries;\n\n\t\t\tdata = queue_remove_if(queue, function, user_data);\n\t\t\tif (entries == queue->entries)\n\t\t\t\tbreak;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(data);\n\n\t\t\tcount++;\n\t\t}\n\t} else {\n\t\tqueue->head = NULL;\n\t\tqueue->tail = NULL;\n\t\tqueue->entries = 0;\n\n\t\twhile (entry) {\n\t\t\tstruct queue_entry *tmp = entry;\n\n\t\t\tentry = entry->next;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(tmp->data);\n\n\t\t\tfree(tmp);\n\t\t\tcount++;\n\t\t}\n\t}\n\n\treturn count;\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_foreach",
          "args": [
            "mgmt->notify_list",
            "notify_handler",
            "&match"
          ],
          "line": 304
        },
        "resolved": true,
        "details": {
          "function_name": "queue_foreach",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "203-224",
          "snippet": "void queue_foreach(struct queue *queue, queue_foreach_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue || !function)\n\t\treturn;\n\n\tentry = queue->head;\n\tif (!entry)\n\t\treturn;\n\n\tqueue_ref(queue);\n\twhile (entry && queue->head && queue->ref_count > 1) {\n\t\tstruct queue_entry *next;\n\n\t\tnext = entry->next;\n\t\tfunction(entry->data, user_data);\n\t\tentry = next;\n\t}\n\tqueue_unref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid queue_foreach(struct queue *queue, queue_foreach_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue || !function)\n\t\treturn;\n\n\tentry = queue->head;\n\tif (!entry)\n\t\treturn;\n\n\tqueue_ref(queue);\n\twhile (entry && queue->head && queue->ref_count > 1) {\n\t\tstruct queue_entry *next;\n\n\t\tnext = entry->next;\n\t\tfunction(entry->data, user_data);\n\t\tentry = next;\n\t}\n\tqueue_unref(queue);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/mgmt.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"lib/hci.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void process_notify(struct mgmt *mgmt, uint16_t event, uint16_t index,\n\t\t\t\t\tuint16_t length, const void *param)\n{\n\tstruct event_index match = { .event = event, .index = index,\n\t\t\t\t\t.length = length, .param = param };\n\n\tmgmt->in_notify = true;\n\n\tqueue_foreach(mgmt->notify_list, notify_handler, &match);\n\n\tmgmt->in_notify = false;\n\n\tif (mgmt->need_notify_cleanup) {\n\t\tqueue_remove_all(mgmt->notify_list, match_notify_removed,\n\t\t\t\t\t\t\tNULL, destroy_notify);\n\t\tmgmt->need_notify_cleanup = false;\n\t}\n}"
  },
  {
    "function_name": "notify_handler",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mgmt.c",
    "lines": "277-294",
    "snippet": "static void notify_handler(void *data, void *user_data)\n{\n\tstruct mgmt_notify *notify = data;\n\tstruct event_index *match = user_data;\n\n\tif (notify->removed)\n\t\treturn;\n\n\tif (notify->event != match->event)\n\t\treturn;\n\n\tif (notify->index != match->index && notify->index != MGMT_INDEX_NONE)\n\t\treturn;\n\n\tif (notify->callback)\n\t\tnotify->callback(match->index, match->length, match->param,\n\t\t\t\t\t\t\tnotify->user_data);\n}",
    "includes": [
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"lib/hci.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "notify->callback",
          "args": [
            "match->index",
            "match->length",
            "match->param",
            "notify->user_data"
          ],
          "line": 292
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/mgmt.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"lib/hci.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void notify_handler(void *data, void *user_data)\n{\n\tstruct mgmt_notify *notify = data;\n\tstruct event_index *match = user_data;\n\n\tif (notify->removed)\n\t\treturn;\n\n\tif (notify->event != match->event)\n\t\treturn;\n\n\tif (notify->index != match->index && notify->index != MGMT_INDEX_NONE)\n\t\treturn;\n\n\tif (notify->callback)\n\t\tnotify->callback(match->index, match->length, match->param,\n\t\t\t\t\t\t\tnotify->user_data);\n}"
  },
  {
    "function_name": "request_complete",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mgmt.c",
    "lines": "250-268",
    "snippet": "static void request_complete(struct mgmt *mgmt, uint8_t status,\n\t\t\t\t\tuint16_t opcode, uint16_t index,\n\t\t\t\t\tuint16_t length, const void *param)\n{\n\tstruct opcode_index match = { .opcode = opcode, .index = index };\n\tstruct mgmt_request *request;\n\n\trequest = queue_remove_if(mgmt->pending_list,\n\t\t\t\t\tmatch_request_opcode_index, &match);\n\tif (request) {\n\t\tif (request->callback)\n\t\t\trequest->callback(status, length, param,\n\t\t\t\t\t\t\trequest->user_data);\n\n\t\tdestroy_request(request);\n\t}\n\n\twakeup_writer(mgmt);\n}",
    "includes": [
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"lib/hci.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "wakeup_writer",
          "args": [
            "mgmt"
          ],
          "line": 267
        },
        "resolved": true,
        "details": {
          "function_name": "wakeup_writer",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mgmt.c",
          "lines": "219-234",
          "snippet": "static void wakeup_writer(struct mgmt *mgmt)\n{\n\tif (!queue_isempty(mgmt->pending_list)) {\n\t\t/* only queued reply commands trigger wakeup */\n\t\tif (queue_isempty(mgmt->reply_queue))\n\t\t\treturn;\n\t}\n\n\tif (mgmt->writer_active)\n\t\treturn;\n\n\tmgmt->writer_active = true;\n\n\tio_set_write_handler(mgmt->io, can_write_data, mgmt,\n\t\t\t\t\t\twrite_watch_destroy);\n}",
          "includes": [
            "#include \"src/shared/mgmt.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/mgmt.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"lib/hci.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void wakeup_writer(struct mgmt *mgmt)\n{\n\tif (!queue_isempty(mgmt->pending_list)) {\n\t\t/* only queued reply commands trigger wakeup */\n\t\tif (queue_isempty(mgmt->reply_queue))\n\t\t\treturn;\n\t}\n\n\tif (mgmt->writer_active)\n\t\treturn;\n\n\tmgmt->writer_active = true;\n\n\tio_set_write_handler(mgmt->io, can_write_data, mgmt,\n\t\t\t\t\t\twrite_watch_destroy);\n}"
        }
      },
      {
        "call_info": {
          "callee": "destroy_request",
          "args": [
            "request"
          ],
          "line": 264
        },
        "resolved": true,
        "details": {
          "function_name": "destroy_request",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mgmt.c",
          "lines": "84-93",
          "snippet": "static void destroy_request(void *data)\n{\n\tstruct mgmt_request *request = data;\n\n\tif (request->destroy)\n\t\trequest->destroy(request->user_data);\n\n\tfree(request->buf);\n\tfree(request);\n}",
          "includes": [
            "#include \"src/shared/mgmt.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/mgmt.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"lib/hci.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void destroy_request(void *data)\n{\n\tstruct mgmt_request *request = data;\n\n\tif (request->destroy)\n\t\trequest->destroy(request->user_data);\n\n\tfree(request->buf);\n\tfree(request);\n}"
        }
      },
      {
        "call_info": {
          "callee": "request->callback",
          "args": [
            "status",
            "length",
            "param",
            "request->user_data"
          ],
          "line": 261
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "queue_remove_if",
          "args": [
            "mgmt->pending_list",
            "match_request_opcode_index",
            "&match"
          ],
          "line": 257
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_if",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "278-316",
          "snippet": "void *queue_remove_if(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry, *prev = NULL;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tentry = queue->head;\n\n\twhile (entry) {\n\t\tif (function(entry->data, user_data)) {\n\t\t\tvoid *data;\n\n\t\t\tif (prev)\n\t\t\t\tprev->next = entry->next;\n\t\t\telse\n\t\t\t\tqueue->head = entry->next;\n\n\t\t\tif (!entry->next)\n\t\t\t\tqueue->tail = prev;\n\n\t\t\tdata = entry->data;\n\n\t\t\tfree(entry);\n\t\t\tqueue->entries--;\n\n\t\t\treturn data;\n\t\t} else {\n\t\t\tprev = entry;\n\t\t\tentry = entry->next;\n\t\t}\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid *queue_remove_if(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry, *prev = NULL;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tentry = queue->head;\n\n\twhile (entry) {\n\t\tif (function(entry->data, user_data)) {\n\t\t\tvoid *data;\n\n\t\t\tif (prev)\n\t\t\t\tprev->next = entry->next;\n\t\t\telse\n\t\t\t\tqueue->head = entry->next;\n\n\t\t\tif (!entry->next)\n\t\t\t\tqueue->tail = prev;\n\n\t\t\tdata = entry->data;\n\n\t\t\tfree(entry);\n\t\t\tqueue->entries--;\n\n\t\t\treturn data;\n\t\t} else {\n\t\t\tprev = entry;\n\t\t\tentry = entry->next;\n\t\t}\n\t}\n\n\treturn NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/mgmt.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"lib/hci.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void request_complete(struct mgmt *mgmt, uint8_t status,\n\t\t\t\t\tuint16_t opcode, uint16_t index,\n\t\t\t\t\tuint16_t length, const void *param)\n{\n\tstruct opcode_index match = { .opcode = opcode, .index = index };\n\tstruct mgmt_request *request;\n\n\trequest = queue_remove_if(mgmt->pending_list,\n\t\t\t\t\tmatch_request_opcode_index, &match);\n\tif (request) {\n\t\tif (request->callback)\n\t\t\trequest->callback(status, length, param,\n\t\t\t\t\t\t\trequest->user_data);\n\n\t\tdestroy_request(request);\n\t}\n\n\twakeup_writer(mgmt);\n}"
  },
  {
    "function_name": "match_request_opcode_index",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mgmt.c",
    "lines": "241-248",
    "snippet": "static bool match_request_opcode_index(const void *a, const void *b)\n{\n\tconst struct mgmt_request *request = a;\n\tconst struct opcode_index *match = b;\n\n\treturn request->opcode == match->opcode &&\n\t\t\t\t\trequest->index == match->index;\n}",
    "includes": [
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"lib/hci.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"src/shared/mgmt.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"lib/hci.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic bool match_request_opcode_index(const void *a, const void *b)\n{\n\tconst struct mgmt_request *request = a;\n\tconst struct opcode_index *match = b;\n\n\treturn request->opcode == match->opcode &&\n\t\t\t\t\trequest->index == match->index;\n}"
  },
  {
    "function_name": "wakeup_writer",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mgmt.c",
    "lines": "219-234",
    "snippet": "static void wakeup_writer(struct mgmt *mgmt)\n{\n\tif (!queue_isempty(mgmt->pending_list)) {\n\t\t/* only queued reply commands trigger wakeup */\n\t\tif (queue_isempty(mgmt->reply_queue))\n\t\t\treturn;\n\t}\n\n\tif (mgmt->writer_active)\n\t\treturn;\n\n\tmgmt->writer_active = true;\n\n\tio_set_write_handler(mgmt->io, can_write_data, mgmt,\n\t\t\t\t\t\twrite_watch_destroy);\n}",
    "includes": [
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"lib/hci.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "io_set_write_handler",
          "args": [
            "mgmt->io",
            "can_write_data",
            "mgmt",
            "write_watch_destroy"
          ],
          "line": 232
        },
        "resolved": true,
        "details": {
          "function_name": "io_set_write_handler",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-glib.c",
          "lines": "254-258",
          "snippet": "bool io_set_write_handler(struct io *io, io_callback_func_t callback,\n\t\t\t\tvoid *user_data, io_destroy_func_t destroy)\n{\n\treturn io_set_handler(io, G_IO_OUT, callback, user_data, destroy);\n}",
          "includes": [
            "#include \"src/shared/io.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/io.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nbool io_set_write_handler(struct io *io, io_callback_func_t callback,\n\t\t\t\tvoid *user_data, io_destroy_func_t destroy)\n{\n\treturn io_set_handler(io, G_IO_OUT, callback, user_data, destroy);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_isempty",
          "args": [
            "mgmt->reply_queue"
          ],
          "line": 223
        },
        "resolved": true,
        "details": {
          "function_name": "queue_isempty",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "380-386",
          "snippet": "bool queue_isempty(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn true;\n\n\treturn queue->entries == 0;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_isempty(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn true;\n\n\treturn queue->entries == 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/mgmt.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"lib/hci.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void wakeup_writer(struct mgmt *mgmt)\n{\n\tif (!queue_isempty(mgmt->pending_list)) {\n\t\t/* only queued reply commands trigger wakeup */\n\t\tif (queue_isempty(mgmt->reply_queue))\n\t\t\treturn;\n\t}\n\n\tif (mgmt->writer_active)\n\t\treturn;\n\n\tmgmt->writer_active = true;\n\n\tio_set_write_handler(mgmt->io, can_write_data, mgmt,\n\t\t\t\t\t\twrite_watch_destroy);\n}"
  },
  {
    "function_name": "can_write_data",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mgmt.c",
    "lines": "191-217",
    "snippet": "static bool can_write_data(struct io *io, void *user_data)\n{\n\tstruct mgmt *mgmt = user_data;\n\tstruct mgmt_request *request;\n\tbool can_write;\n\n\trequest = queue_pop_head(mgmt->reply_queue);\n\tif (!request) {\n\t\t/* only reply commands can jump the queue */\n\t\tif (!queue_isempty(mgmt->pending_list))\n\t\t\treturn false;\n\n\t\trequest = queue_pop_head(mgmt->request_queue);\n\t\tif (!request)\n\t\t\treturn false;\n\n\t\tcan_write = false;\n\t} else {\n\t\t/* allow multiple replies to jump the queue */\n\t\tcan_write = !queue_isempty(mgmt->reply_queue);\n\t}\n\n\tif (!send_request(mgmt, request))\n\t\treturn true;\n\n\treturn can_write;\n}",
    "includes": [
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"lib/hci.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "send_request",
          "args": [
            "mgmt",
            "request"
          ],
          "line": 213
        },
        "resolved": true,
        "details": {
          "function_name": "send_request",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mgmt.c",
          "lines": "160-189",
          "snippet": "static bool send_request(struct mgmt *mgmt, struct mgmt_request *request)\n{\n\tstruct iovec iov;\n\tssize_t ret;\n\n\tiov.iov_base = request->buf;\n\tiov.iov_len = request->len;\n\n\tret = io_send(mgmt->io, &iov, 1);\n\tif (ret < 0) {\n\t\tutil_debug(mgmt->debug_callback, mgmt->debug_data,\n\t\t\t\t\"write failed: %s\", strerror(-ret));\n\t\tif (request->callback)\n\t\t\trequest->callback(MGMT_STATUS_FAILED, 0, NULL,\n\t\t\t\t\t\t\trequest->user_data);\n\t\tdestroy_request(request);\n\t\treturn false;\n\t}\n\n\tutil_debug(mgmt->debug_callback, mgmt->debug_data,\n\t\t\t\t\"[0x%04x] command 0x%04x\",\n\t\t\t\trequest->index, request->opcode);\n\n\tutil_hexdump('<', request->buf, ret, mgmt->debug_callback,\n\t\t\t\t\t\t\tmgmt->debug_data);\n\n\tqueue_push_tail(mgmt->pending_list, request);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/mgmt.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/mgmt.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"lib/hci.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic bool send_request(struct mgmt *mgmt, struct mgmt_request *request)\n{\n\tstruct iovec iov;\n\tssize_t ret;\n\n\tiov.iov_base = request->buf;\n\tiov.iov_len = request->len;\n\n\tret = io_send(mgmt->io, &iov, 1);\n\tif (ret < 0) {\n\t\tutil_debug(mgmt->debug_callback, mgmt->debug_data,\n\t\t\t\t\"write failed: %s\", strerror(-ret));\n\t\tif (request->callback)\n\t\t\trequest->callback(MGMT_STATUS_FAILED, 0, NULL,\n\t\t\t\t\t\t\trequest->user_data);\n\t\tdestroy_request(request);\n\t\treturn false;\n\t}\n\n\tutil_debug(mgmt->debug_callback, mgmt->debug_data,\n\t\t\t\t\"[0x%04x] command 0x%04x\",\n\t\t\t\trequest->index, request->opcode);\n\n\tutil_hexdump('<', request->buf, ret, mgmt->debug_callback,\n\t\t\t\t\t\t\tmgmt->debug_data);\n\n\tqueue_push_tail(mgmt->pending_list, request);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_isempty",
          "args": [
            "mgmt->reply_queue"
          ],
          "line": 210
        },
        "resolved": true,
        "details": {
          "function_name": "queue_isempty",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "380-386",
          "snippet": "bool queue_isempty(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn true;\n\n\treturn queue->entries == 0;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_isempty(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn true;\n\n\treturn queue->entries == 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_pop_head",
          "args": [
            "mgmt->request_queue"
          ],
          "line": 203
        },
        "resolved": true,
        "details": {
          "function_name": "queue_pop_head",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "163-185",
          "snippet": "void *queue_pop_head(struct queue *queue)\n{\n\tstruct queue_entry *entry;\n\tvoid *data;\n\n\tif (!queue || !queue->head)\n\t\treturn NULL;\n\n\tentry = queue->head;\n\n\tif (!queue->head->next) {\n\t\tqueue->head = NULL;\n\t\tqueue->tail = NULL;\n\t} else\n\t\tqueue->head = queue->head->next;\n\n\tdata = entry->data;\n\n\tfree(entry);\n\tqueue->entries--;\n\n\treturn data;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid *queue_pop_head(struct queue *queue)\n{\n\tstruct queue_entry *entry;\n\tvoid *data;\n\n\tif (!queue || !queue->head)\n\t\treturn NULL;\n\n\tentry = queue->head;\n\n\tif (!queue->head->next) {\n\t\tqueue->head = NULL;\n\t\tqueue->tail = NULL;\n\t} else\n\t\tqueue->head = queue->head->next;\n\n\tdata = entry->data;\n\n\tfree(entry);\n\tqueue->entries--;\n\n\treturn data;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/mgmt.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"lib/hci.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic bool can_write_data(struct io *io, void *user_data)\n{\n\tstruct mgmt *mgmt = user_data;\n\tstruct mgmt_request *request;\n\tbool can_write;\n\n\trequest = queue_pop_head(mgmt->reply_queue);\n\tif (!request) {\n\t\t/* only reply commands can jump the queue */\n\t\tif (!queue_isempty(mgmt->pending_list))\n\t\t\treturn false;\n\n\t\trequest = queue_pop_head(mgmt->request_queue);\n\t\tif (!request)\n\t\t\treturn false;\n\n\t\tcan_write = false;\n\t} else {\n\t\t/* allow multiple replies to jump the queue */\n\t\tcan_write = !queue_isempty(mgmt->reply_queue);\n\t}\n\n\tif (!send_request(mgmt, request))\n\t\treturn true;\n\n\treturn can_write;\n}"
  },
  {
    "function_name": "send_request",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mgmt.c",
    "lines": "160-189",
    "snippet": "static bool send_request(struct mgmt *mgmt, struct mgmt_request *request)\n{\n\tstruct iovec iov;\n\tssize_t ret;\n\n\tiov.iov_base = request->buf;\n\tiov.iov_len = request->len;\n\n\tret = io_send(mgmt->io, &iov, 1);\n\tif (ret < 0) {\n\t\tutil_debug(mgmt->debug_callback, mgmt->debug_data,\n\t\t\t\t\"write failed: %s\", strerror(-ret));\n\t\tif (request->callback)\n\t\t\trequest->callback(MGMT_STATUS_FAILED, 0, NULL,\n\t\t\t\t\t\t\trequest->user_data);\n\t\tdestroy_request(request);\n\t\treturn false;\n\t}\n\n\tutil_debug(mgmt->debug_callback, mgmt->debug_data,\n\t\t\t\t\"[0x%04x] command 0x%04x\",\n\t\t\t\trequest->index, request->opcode);\n\n\tutil_hexdump('<', request->buf, ret, mgmt->debug_callback,\n\t\t\t\t\t\t\tmgmt->debug_data);\n\n\tqueue_push_tail(mgmt->pending_list, request);\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"lib/hci.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_push_tail",
          "args": [
            "mgmt->pending_list",
            "request"
          ],
          "line": 186
        },
        "resolved": true,
        "details": {
          "function_name": "queue_push_tail",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "88-108",
          "snippet": "bool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "util_hexdump",
          "args": [
            "'<'",
            "request->buf",
            "ret",
            "mgmt->debug_callback",
            "mgmt->debug_data"
          ],
          "line": 183
        },
        "resolved": true,
        "details": {
          "function_name": "util_hexdump",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/util.c",
          "lines": "73-113",
          "snippet": "void util_hexdump(const char dir, const unsigned char *buf, size_t len,\n\t\t\t\tutil_debug_func_t function, void *user_data)\n{\n\tstatic const char hexdigits[] = \"0123456789abcdef\";\n\tchar str[68];\n\tsize_t i;\n\n\tif (!function || !len)\n\t\treturn;\n\n\tstr[0] = dir;\n\n\tfor (i = 0; i < len; i++) {\n\t\tstr[((i % 16) * 3) + 1] = ' ';\n\t\tstr[((i % 16) * 3) + 2] = hexdigits[buf[i] >> 4];\n\t\tstr[((i % 16) * 3) + 3] = hexdigits[buf[i] & 0xf];\n\t\tstr[(i % 16) + 51] = isprint(buf[i]) ? buf[i] : '.';\n\n\t\tif ((i + 1) % 16 == 0) {\n\t\t\tstr[49] = ' ';\n\t\t\tstr[50] = ' ';\n\t\t\tstr[67] = '\\0';\n\t\t\tfunction(str, user_data);\n\t\t\tstr[0] = ' ';\n\t\t}\n\t}\n\n\tif (i % 16 > 0) {\n\t\tsize_t j;\n\t\tfor (j = (i % 16); j < 16; j++) {\n\t\t\tstr[(j * 3) + 1] = ' ';\n\t\t\tstr[(j * 3) + 2] = ' ';\n\t\t\tstr[(j * 3) + 3] = ' ';\n\t\t\tstr[j + 51] = ' ';\n\t\t}\n\t\tstr[49] = ' ';\n\t\tstr[50] = ' ';\n\t\tstr[67] = '\\0';\n\t\tfunction(str, user_data);\n\t}\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include <string.h>",
            "#include <limits.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include <string.h>\n#include <limits.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid util_hexdump(const char dir, const unsigned char *buf, size_t len,\n\t\t\t\tutil_debug_func_t function, void *user_data)\n{\n\tstatic const char hexdigits[] = \"0123456789abcdef\";\n\tchar str[68];\n\tsize_t i;\n\n\tif (!function || !len)\n\t\treturn;\n\n\tstr[0] = dir;\n\n\tfor (i = 0; i < len; i++) {\n\t\tstr[((i % 16) * 3) + 1] = ' ';\n\t\tstr[((i % 16) * 3) + 2] = hexdigits[buf[i] >> 4];\n\t\tstr[((i % 16) * 3) + 3] = hexdigits[buf[i] & 0xf];\n\t\tstr[(i % 16) + 51] = isprint(buf[i]) ? buf[i] : '.';\n\n\t\tif ((i + 1) % 16 == 0) {\n\t\t\tstr[49] = ' ';\n\t\t\tstr[50] = ' ';\n\t\t\tstr[67] = '\\0';\n\t\t\tfunction(str, user_data);\n\t\t\tstr[0] = ' ';\n\t\t}\n\t}\n\n\tif (i % 16 > 0) {\n\t\tsize_t j;\n\t\tfor (j = (i % 16); j < 16; j++) {\n\t\t\tstr[(j * 3) + 1] = ' ';\n\t\t\tstr[(j * 3) + 2] = ' ';\n\t\t\tstr[(j * 3) + 3] = ' ';\n\t\t\tstr[j + 51] = ' ';\n\t\t}\n\t\tstr[49] = ' ';\n\t\tstr[50] = ' ';\n\t\tstr[67] = '\\0';\n\t\tfunction(str, user_data);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "util_debug",
          "args": [
            "mgmt->debug_callback",
            "mgmt->debug_data",
            "\"[0x%04x] command 0x%04x\"",
            "request->index",
            "request->opcode"
          ],
          "line": 179
        },
        "resolved": true,
        "details": {
          "function_name": "util_debug",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/util.c",
          "lines": "57-71",
          "snippet": "void util_debug(util_debug_func_t function, void *user_data,\n\t\t\t\t\t\tconst char *format, ...)\n{\n\tchar str[78];\n\tva_list ap;\n\n\tif (!function || !format)\n\t\treturn;\n\n\tva_start(ap, format);\n\tvsnprintf(str, sizeof(str), format, ap);\n\tva_end(ap);\n\n\tfunction(str, user_data);\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include <string.h>",
            "#include <limits.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include <string.h>\n#include <limits.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid util_debug(util_debug_func_t function, void *user_data,\n\t\t\t\t\t\tconst char *format, ...)\n{\n\tchar str[78];\n\tva_list ap;\n\n\tif (!function || !format)\n\t\treturn;\n\n\tva_start(ap, format);\n\tvsnprintf(str, sizeof(str), format, ap);\n\tva_end(ap);\n\n\tfunction(str, user_data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "destroy_request",
          "args": [
            "request"
          ],
          "line": 175
        },
        "resolved": true,
        "details": {
          "function_name": "destroy_request",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mgmt.c",
          "lines": "84-93",
          "snippet": "static void destroy_request(void *data)\n{\n\tstruct mgmt_request *request = data;\n\n\tif (request->destroy)\n\t\trequest->destroy(request->user_data);\n\n\tfree(request->buf);\n\tfree(request);\n}",
          "includes": [
            "#include \"src/shared/mgmt.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/mgmt.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"lib/hci.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void destroy_request(void *data)\n{\n\tstruct mgmt_request *request = data;\n\n\tif (request->destroy)\n\t\trequest->destroy(request->user_data);\n\n\tfree(request->buf);\n\tfree(request);\n}"
        }
      },
      {
        "call_info": {
          "callee": "request->callback",
          "args": [
            "MGMT_STATUS_FAILED",
            "0",
            "NULL",
            "request->user_data"
          ],
          "line": 173
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strerror",
          "args": [
            "-ret"
          ],
          "line": 171
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "io_send",
          "args": [
            "mgmt->io",
            "&iov",
            "1"
          ],
          "line": 168
        },
        "resolved": true,
        "details": {
          "function_name": "io_send",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-glib.c",
          "lines": "266-284",
          "snippet": "ssize_t io_send(struct io *io, const struct iovec *iov, int iovcnt)\n{\n\tint fd;\n\tssize_t ret;\n\n\tif (!io || !io->channel)\n\t\treturn -ENOTCONN;\n\n\tfd = io_get_fd(io);\n\n\tdo {\n\t\tret = writev(fd, iov, iovcnt);\n\t} while (ret < 0 && errno == EINTR);\n\n\tif (ret < 0)\n\t\treturn -errno;\n\n\treturn ret;\n}",
          "includes": [
            "#include \"src/shared/io.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/io.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nssize_t io_send(struct io *io, const struct iovec *iov, int iovcnt)\n{\n\tint fd;\n\tssize_t ret;\n\n\tif (!io || !io->channel)\n\t\treturn -ENOTCONN;\n\n\tfd = io_get_fd(io);\n\n\tdo {\n\t\tret = writev(fd, iov, iovcnt);\n\t} while (ret < 0 && errno == EINTR);\n\n\tif (ret < 0)\n\t\treturn -errno;\n\n\treturn ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/mgmt.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"lib/hci.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic bool send_request(struct mgmt *mgmt, struct mgmt_request *request)\n{\n\tstruct iovec iov;\n\tssize_t ret;\n\n\tiov.iov_base = request->buf;\n\tiov.iov_len = request->len;\n\n\tret = io_send(mgmt->io, &iov, 1);\n\tif (ret < 0) {\n\t\tutil_debug(mgmt->debug_callback, mgmt->debug_data,\n\t\t\t\t\"write failed: %s\", strerror(-ret));\n\t\tif (request->callback)\n\t\t\trequest->callback(MGMT_STATUS_FAILED, 0, NULL,\n\t\t\t\t\t\t\trequest->user_data);\n\t\tdestroy_request(request);\n\t\treturn false;\n\t}\n\n\tutil_debug(mgmt->debug_callback, mgmt->debug_data,\n\t\t\t\t\"[0x%04x] command 0x%04x\",\n\t\t\t\trequest->index, request->opcode);\n\n\tutil_hexdump('<', request->buf, ret, mgmt->debug_callback,\n\t\t\t\t\t\t\tmgmt->debug_data);\n\n\tqueue_push_tail(mgmt->pending_list, request);\n\n\treturn true;\n}"
  },
  {
    "function_name": "write_watch_destroy",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mgmt.c",
    "lines": "153-158",
    "snippet": "static void write_watch_destroy(void *user_data)\n{\n\tstruct mgmt *mgmt = user_data;\n\n\tmgmt->writer_active = false;\n}",
    "includes": [
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"lib/hci.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"src/shared/mgmt.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"lib/hci.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void write_watch_destroy(void *user_data)\n{\n\tstruct mgmt *mgmt = user_data;\n\n\tmgmt->writer_active = false;\n}"
  },
  {
    "function_name": "mark_notify_removed",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mgmt.c",
    "lines": "144-151",
    "snippet": "static void mark_notify_removed(void *data , void *user_data)\n{\n\tstruct mgmt_notify *notify = data;\n\tuint16_t index = PTR_TO_UINT(user_data);\n\n\tif (notify->index == index || index == MGMT_INDEX_NONE)\n\t\tnotify->removed = true;\n}",
    "includes": [
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"lib/hci.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "PTR_TO_UINT",
          "args": [
            "user_data"
          ],
          "line": 147
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/mgmt.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"lib/hci.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void mark_notify_removed(void *data , void *user_data)\n{\n\tstruct mgmt_notify *notify = data;\n\tuint16_t index = PTR_TO_UINT(user_data);\n\n\tif (notify->index == index || index == MGMT_INDEX_NONE)\n\t\tnotify->removed = true;\n}"
  },
  {
    "function_name": "match_notify_removed",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mgmt.c",
    "lines": "137-142",
    "snippet": "static bool match_notify_removed(const void *a, const void *b)\n{\n\tconst struct mgmt_notify *notify = a;\n\n\treturn notify->removed;\n}",
    "includes": [
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"lib/hci.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"src/shared/mgmt.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"lib/hci.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic bool match_notify_removed(const void *a, const void *b)\n{\n\tconst struct mgmt_notify *notify = a;\n\n\treturn notify->removed;\n}"
  },
  {
    "function_name": "match_notify_index",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mgmt.c",
    "lines": "129-135",
    "snippet": "static bool match_notify_index(const void *a, const void *b)\n{\n\tconst struct mgmt_notify *notify = a;\n\tuint16_t index = PTR_TO_UINT(b);\n\n\treturn notify->index == index;\n}",
    "includes": [
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"lib/hci.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "PTR_TO_UINT",
          "args": [
            "b"
          ],
          "line": 132
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/mgmt.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"lib/hci.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic bool match_notify_index(const void *a, const void *b)\n{\n\tconst struct mgmt_notify *notify = a;\n\tuint16_t index = PTR_TO_UINT(b);\n\n\treturn notify->index == index;\n}"
  },
  {
    "function_name": "match_notify_id",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mgmt.c",
    "lines": "121-127",
    "snippet": "static bool match_notify_id(const void *a, const void *b)\n{\n\tconst struct mgmt_notify *notify = a;\n\tunsigned int id = PTR_TO_UINT(b);\n\n\treturn notify->id == id;\n}",
    "includes": [
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"lib/hci.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "PTR_TO_UINT",
          "args": [
            "b"
          ],
          "line": 124
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/mgmt.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"lib/hci.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic bool match_notify_id(const void *a, const void *b)\n{\n\tconst struct mgmt_notify *notify = a;\n\tunsigned int id = PTR_TO_UINT(b);\n\n\treturn notify->id == id;\n}"
  },
  {
    "function_name": "destroy_notify",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mgmt.c",
    "lines": "111-119",
    "snippet": "static void destroy_notify(void *data)\n{\n\tstruct mgmt_notify *notify = data;\n\n\tif (notify->destroy)\n\t\tnotify->destroy(notify->user_data);\n\n\tfree(notify);\n}",
    "includes": [
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"lib/hci.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "notify"
          ],
          "line": 118
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "956-985",
          "snippet": "static void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}"
        }
      },
      {
        "call_info": {
          "callee": "notify->destroy",
          "args": [
            "notify->user_data"
          ],
          "line": 116
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/mgmt.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"lib/hci.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void destroy_notify(void *data)\n{\n\tstruct mgmt_notify *notify = data;\n\n\tif (notify->destroy)\n\t\tnotify->destroy(notify->user_data);\n\n\tfree(notify);\n}"
  },
  {
    "function_name": "match_request_index",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mgmt.c",
    "lines": "103-109",
    "snippet": "static bool match_request_index(const void *a, const void *b)\n{\n\tconst struct mgmt_request *request = a;\n\tuint16_t index = PTR_TO_UINT(b);\n\n\treturn request->index == index;\n}",
    "includes": [
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"lib/hci.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "PTR_TO_UINT",
          "args": [
            "b"
          ],
          "line": 106
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/mgmt.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"lib/hci.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic bool match_request_index(const void *a, const void *b)\n{\n\tconst struct mgmt_request *request = a;\n\tuint16_t index = PTR_TO_UINT(b);\n\n\treturn request->index == index;\n}"
  },
  {
    "function_name": "match_request_id",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mgmt.c",
    "lines": "95-101",
    "snippet": "static bool match_request_id(const void *a, const void *b)\n{\n\tconst struct mgmt_request *request = a;\n\tunsigned int id = PTR_TO_UINT(b);\n\n\treturn request->id == id;\n}",
    "includes": [
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"lib/hci.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "PTR_TO_UINT",
          "args": [
            "b"
          ],
          "line": 98
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/mgmt.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"lib/hci.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic bool match_request_id(const void *a, const void *b)\n{\n\tconst struct mgmt_request *request = a;\n\tunsigned int id = PTR_TO_UINT(b);\n\n\treturn request->id == id;\n}"
  },
  {
    "function_name": "destroy_request",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mgmt.c",
    "lines": "84-93",
    "snippet": "static void destroy_request(void *data)\n{\n\tstruct mgmt_request *request = data;\n\n\tif (request->destroy)\n\t\trequest->destroy(request->user_data);\n\n\tfree(request->buf);\n\tfree(request);\n}",
    "includes": [
      "#include \"src/shared/mgmt.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"lib/hci.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "request"
          ],
          "line": 92
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "956-985",
          "snippet": "static void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}"
        }
      },
      {
        "call_info": {
          "callee": "request->destroy",
          "args": [
            "request->user_data"
          ],
          "line": 89
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/mgmt.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"lib/hci.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void destroy_request(void *data)\n{\n\tstruct mgmt_request *request = data;\n\n\tif (request->destroy)\n\t\trequest->destroy(request->user_data);\n\n\tfree(request->buf);\n\tfree(request);\n}"
  }
]