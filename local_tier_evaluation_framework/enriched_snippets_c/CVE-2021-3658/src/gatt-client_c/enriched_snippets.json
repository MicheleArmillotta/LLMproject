[
  {
    "function_name": "btd_gatt_client_foreach_service",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "2249-2262",
    "snippet": "void btd_gatt_client_foreach_service(struct btd_gatt_client *client,\n\t\t\t\t\tbtd_gatt_client_service_path_t func,\n\t\t\t\t\tvoid *user_data)\n{\n\tstruct foreach_service_data data;\n\n\tif (!client)\n\t\treturn;\n\n\tdata.func = func;\n\tdata.user_data = user_data;\n\n\tqueue_foreach(client->services, client_service_foreach, &data);\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_foreach",
          "args": [
            "client->services",
            "client_service_foreach",
            "&data"
          ],
          "line": 2261
        },
        "resolved": true,
        "details": {
          "function_name": "queue_foreach",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "203-224",
          "snippet": "void queue_foreach(struct queue *queue, queue_foreach_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue || !function)\n\t\treturn;\n\n\tentry = queue->head;\n\tif (!entry)\n\t\treturn;\n\n\tqueue_ref(queue);\n\twhile (entry && queue->head && queue->ref_count > 1) {\n\t\tstruct queue_entry *next;\n\n\t\tnext = entry->next;\n\t\tfunction(entry->data, user_data);\n\t\tentry = next;\n\t}\n\tqueue_unref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid queue_foreach(struct queue *queue, queue_foreach_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue || !function)\n\t\treturn;\n\n\tentry = queue->head;\n\tif (!entry)\n\t\treturn;\n\n\tqueue_ref(queue);\n\twhile (entry && queue->head && queue->ref_count > 1) {\n\t\tstruct queue_entry *next;\n\n\t\tnext = entry->next;\n\t\tfunction(entry->data, user_data);\n\t\tentry = next;\n\t}\n\tqueue_unref(queue);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nvoid btd_gatt_client_foreach_service(struct btd_gatt_client *client,\n\t\t\t\t\tbtd_gatt_client_service_path_t func,\n\t\t\t\t\tvoid *user_data)\n{\n\tstruct foreach_service_data data;\n\n\tif (!client)\n\t\treturn;\n\n\tdata.func = func;\n\tdata.user_data = user_data;\n\n\tqueue_foreach(client->services, client_service_foreach, &data);\n}"
  },
  {
    "function_name": "client_service_foreach",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "2241-2247",
    "snippet": "static void client_service_foreach(void *data, void *user_data)\n{\n\tstruct service *service = data;\n\tstruct foreach_service_data *foreach_data = user_data;\n\n\tforeach_data->func(service->path, foreach_data->user_data);\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "foreach_data->func",
          "args": [
            "service->path",
            "foreach_data->user_data"
          ],
          "line": 2246
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void client_service_foreach(void *data, void *user_data)\n{\n\tstruct service *service = data;\n\tstruct foreach_service_data *foreach_data = user_data;\n\n\tforeach_data->func(service->path, foreach_data->user_data);\n}"
  },
  {
    "function_name": "btd_gatt_client_disconnected",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "2216-2234",
    "snippet": "void btd_gatt_client_disconnected(struct btd_gatt_client *client)\n{\n\tif (!client || !client->gatt)\n\t\treturn;\n\n\tDBG(\"Device disconnected. Cleaning up.\");\n\n\tqueue_remove_all(client->ios, NULL, NULL, client_shutdown);\n\n\t/*\n\t * TODO: Once GATT over BR/EDR is properly supported, we should pass the\n\t * correct bdaddr_type based on the transport over which GATT is being\n\t * done.\n\t */\n\tqueue_foreach(client->all_notify_clients, clear_notify_id, NULL);\n\n\tbt_gatt_client_unref(client->gatt);\n\tclient->gatt = NULL;\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bt_gatt_client_unref",
          "args": [
            "client->gatt"
          ],
          "line": 2232
        },
        "resolved": true,
        "details": {
          "function_name": "bt_gatt_client_unref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-client.c",
          "lines": "2004-2013",
          "snippet": "void bt_gatt_client_unref(struct bt_gatt_client *client)\n{\n\tif (!client)\n\t\treturn;\n\n\tif (__sync_sub_and_fetch(&client->ref_count, 1))\n\t\treturn;\n\n\tbt_gatt_client_free(client);\n}",
          "includes": [
            "#include <sys/uio.h>",
            "#include <limits.h>",
            "#include <assert.h>",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-helpers.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/att.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/uio.h>\n#include <limits.h>\n#include <assert.h>\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-helpers.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/att.h\"\n#include <config.h>\n\nvoid bt_gatt_client_unref(struct bt_gatt_client *client)\n{\n\tif (!client)\n\t\treturn;\n\n\tif (__sync_sub_and_fetch(&client->ref_count, 1))\n\t\treturn;\n\n\tbt_gatt_client_free(client);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_foreach",
          "args": [
            "client->all_notify_clients",
            "clear_notify_id",
            "NULL"
          ],
          "line": 2230
        },
        "resolved": true,
        "details": {
          "function_name": "queue_foreach",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "203-224",
          "snippet": "void queue_foreach(struct queue *queue, queue_foreach_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue || !function)\n\t\treturn;\n\n\tentry = queue->head;\n\tif (!entry)\n\t\treturn;\n\n\tqueue_ref(queue);\n\twhile (entry && queue->head && queue->ref_count > 1) {\n\t\tstruct queue_entry *next;\n\n\t\tnext = entry->next;\n\t\tfunction(entry->data, user_data);\n\t\tentry = next;\n\t}\n\tqueue_unref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid queue_foreach(struct queue *queue, queue_foreach_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue || !function)\n\t\treturn;\n\n\tentry = queue->head;\n\tif (!entry)\n\t\treturn;\n\n\tqueue_ref(queue);\n\twhile (entry && queue->head && queue->ref_count > 1) {\n\t\tstruct queue_entry *next;\n\n\t\tnext = entry->next;\n\t\tfunction(entry->data, user_data);\n\t\tentry = next;\n\t}\n\tqueue_unref(queue);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_remove_all",
          "args": [
            "client->ios",
            "NULL",
            "NULL",
            "client_shutdown"
          ],
          "line": 2223
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_all",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "318-362",
          "snippet": "unsigned int queue_remove_all(struct queue *queue, queue_match_func_t function,\n\t\t\t\tvoid *user_data, queue_destroy_func_t destroy)\n{\n\tstruct queue_entry *entry;\n\tunsigned int count = 0;\n\n\tif (!queue)\n\t\treturn 0;\n\n\tentry = queue->head;\n\n\tif (function) {\n\t\twhile (entry) {\n\t\t\tvoid *data;\n\t\t\tunsigned int entries = queue->entries;\n\n\t\t\tdata = queue_remove_if(queue, function, user_data);\n\t\t\tif (entries == queue->entries)\n\t\t\t\tbreak;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(data);\n\n\t\t\tcount++;\n\t\t}\n\t} else {\n\t\tqueue->head = NULL;\n\t\tqueue->tail = NULL;\n\t\tqueue->entries = 0;\n\n\t\twhile (entry) {\n\t\t\tstruct queue_entry *tmp = entry;\n\n\t\t\tentry = entry->next;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(tmp->data);\n\n\t\t\tfree(tmp);\n\t\t\tcount++;\n\t\t}\n\t}\n\n\treturn count;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nunsigned int queue_remove_all(struct queue *queue, queue_match_func_t function,\n\t\t\t\tvoid *user_data, queue_destroy_func_t destroy)\n{\n\tstruct queue_entry *entry;\n\tunsigned int count = 0;\n\n\tif (!queue)\n\t\treturn 0;\n\n\tentry = queue->head;\n\n\tif (function) {\n\t\twhile (entry) {\n\t\t\tvoid *data;\n\t\t\tunsigned int entries = queue->entries;\n\n\t\t\tdata = queue_remove_if(queue, function, user_data);\n\t\t\tif (entries == queue->entries)\n\t\t\t\tbreak;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(data);\n\n\t\t\tcount++;\n\t\t}\n\t} else {\n\t\tqueue->head = NULL;\n\t\tqueue->tail = NULL;\n\t\tqueue->entries = 0;\n\n\t\twhile (entry) {\n\t\t\tstruct queue_entry *tmp = entry;\n\n\t\t\tentry = entry->next;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(tmp->data);\n\n\t\t\tfree(tmp);\n\t\t\tcount++;\n\t\t}\n\t}\n\n\treturn count;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Device disconnected. Cleaning up.\""
          ],
          "line": 2221
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nvoid btd_gatt_client_disconnected(struct btd_gatt_client *client)\n{\n\tif (!client || !client->gatt)\n\t\treturn;\n\n\tDBG(\"Device disconnected. Cleaning up.\");\n\n\tqueue_remove_all(client->ios, NULL, NULL, client_shutdown);\n\n\t/*\n\t * TODO: Once GATT over BR/EDR is properly supported, we should pass the\n\t * correct bdaddr_type based on the transport over which GATT is being\n\t * done.\n\t */\n\tqueue_foreach(client->all_notify_clients, clear_notify_id, NULL);\n\n\tbt_gatt_client_unref(client->gatt);\n\tclient->gatt = NULL;\n}"
  },
  {
    "function_name": "client_shutdown",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "2211-2214",
    "snippet": "static void client_shutdown(void *data)\n{\n\tio_shutdown(data);\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "io_shutdown",
          "args": [
            "data"
          ],
          "line": 2213
        },
        "resolved": true,
        "details": {
          "function_name": "io_shutdown",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-glib.c",
          "lines": "286-293",
          "snippet": "bool io_shutdown(struct io *io)\n{\n\tif (!io || !io->channel)\n\t\treturn false;\n\n\treturn g_io_channel_shutdown(io->channel, TRUE, NULL)\n\t\t\t\t\t\t\t== G_IO_STATUS_NORMAL;\n}",
          "includes": [
            "#include \"src/shared/io.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/io.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nbool io_shutdown(struct io *io)\n{\n\tif (!io || !io->channel)\n\t\treturn false;\n\n\treturn g_io_channel_shutdown(io->channel, TRUE, NULL)\n\t\t\t\t\t\t\t== G_IO_STATUS_NORMAL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void client_shutdown(void *data)\n{\n\tio_shutdown(data);\n}"
  },
  {
    "function_name": "clear_notify_id",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "2204-2209",
    "snippet": "static void clear_notify_id(void *data, void *user_data)\n{\n\tstruct notify_client *client = data;\n\n\tclient->notify_id = 0;\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void clear_notify_id(void *data, void *user_data)\n{\n\tstruct notify_client *client = data;\n\n\tclient->notify_id = 0;\n}"
  },
  {
    "function_name": "btd_gatt_client_service_removed",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "2186-2202",
    "snippet": "void btd_gatt_client_service_removed(struct btd_gatt_client *client,\n\t\t\t\t\tstruct gatt_db_attribute *attrib)\n{\n\tuint16_t start_handle, end_handle;\n\n\tif (!client || !attrib || !client->ready)\n\t\treturn;\n\n\tgatt_db_attribute_get_service_handles(attrib, &start_handle,\n\t\t\t\t\t\t\t\t&end_handle);\n\n\tDBG(\"GATT Services Removed - start: 0x%04x, end: 0x%04x\", start_handle,\n\t\t\t\t\t\t\t\tend_handle);\n\tqueue_remove_all(client->services, match_service_handle,\n\t\t\t\t\t\tUINT_TO_PTR(start_handle),\n\t\t\t\t\t\tunregister_service);\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_remove_all",
          "args": [
            "client->services",
            "match_service_handle",
            "UINT_TO_PTR(start_handle)",
            "unregister_service"
          ],
          "line": 2199
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_all",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "318-362",
          "snippet": "unsigned int queue_remove_all(struct queue *queue, queue_match_func_t function,\n\t\t\t\tvoid *user_data, queue_destroy_func_t destroy)\n{\n\tstruct queue_entry *entry;\n\tunsigned int count = 0;\n\n\tif (!queue)\n\t\treturn 0;\n\n\tentry = queue->head;\n\n\tif (function) {\n\t\twhile (entry) {\n\t\t\tvoid *data;\n\t\t\tunsigned int entries = queue->entries;\n\n\t\t\tdata = queue_remove_if(queue, function, user_data);\n\t\t\tif (entries == queue->entries)\n\t\t\t\tbreak;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(data);\n\n\t\t\tcount++;\n\t\t}\n\t} else {\n\t\tqueue->head = NULL;\n\t\tqueue->tail = NULL;\n\t\tqueue->entries = 0;\n\n\t\twhile (entry) {\n\t\t\tstruct queue_entry *tmp = entry;\n\n\t\t\tentry = entry->next;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(tmp->data);\n\n\t\t\tfree(tmp);\n\t\t\tcount++;\n\t\t}\n\t}\n\n\treturn count;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nunsigned int queue_remove_all(struct queue *queue, queue_match_func_t function,\n\t\t\t\tvoid *user_data, queue_destroy_func_t destroy)\n{\n\tstruct queue_entry *entry;\n\tunsigned int count = 0;\n\n\tif (!queue)\n\t\treturn 0;\n\n\tentry = queue->head;\n\n\tif (function) {\n\t\twhile (entry) {\n\t\t\tvoid *data;\n\t\t\tunsigned int entries = queue->entries;\n\n\t\t\tdata = queue_remove_if(queue, function, user_data);\n\t\t\tif (entries == queue->entries)\n\t\t\t\tbreak;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(data);\n\n\t\t\tcount++;\n\t\t}\n\t} else {\n\t\tqueue->head = NULL;\n\t\tqueue->tail = NULL;\n\t\tqueue->entries = 0;\n\n\t\twhile (entry) {\n\t\t\tstruct queue_entry *tmp = entry;\n\n\t\t\tentry = entry->next;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(tmp->data);\n\n\t\t\tfree(tmp);\n\t\t\tcount++;\n\t\t}\n\t}\n\n\treturn count;\n}"
        }
      },
      {
        "call_info": {
          "callee": "UINT_TO_PTR",
          "args": [
            "start_handle"
          ],
          "line": 2200
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"GATT Services Removed - start: 0x%04x, end: 0x%04x\"",
            "start_handle",
            "end_handle"
          ],
          "line": 2197
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gatt_db_attribute_get_service_handles",
          "args": [
            "attrib",
            "&start_handle",
            "&end_handle"
          ],
          "line": 2194
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_get_service_handles",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1521-1536",
          "snippet": "bool gatt_db_attribute_get_service_handles(\n\t\t\t\t\tconst struct gatt_db_attribute *attrib,\n\t\t\t\t\tuint16_t *start_handle,\n\t\t\t\t\tuint16_t *end_handle)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!attrib)\n\t\treturn false;\n\n\tservice = attrib->service;\n\n\tgatt_db_service_get_handles(service, start_handle, end_handle);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_attribute_get_service_handles(\n\t\t\t\t\tconst struct gatt_db_attribute *attrib,\n\t\t\t\t\tuint16_t *start_handle,\n\t\t\t\t\tuint16_t *end_handle)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!attrib)\n\t\treturn false;\n\n\tservice = attrib->service;\n\n\tgatt_db_service_get_handles(service, start_handle, end_handle);\n\n\treturn true;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nvoid btd_gatt_client_service_removed(struct btd_gatt_client *client,\n\t\t\t\t\tstruct gatt_db_attribute *attrib)\n{\n\tuint16_t start_handle, end_handle;\n\n\tif (!client || !attrib || !client->ready)\n\t\treturn;\n\n\tgatt_db_attribute_get_service_handles(attrib, &start_handle,\n\t\t\t\t\t\t\t\t&end_handle);\n\n\tDBG(\"GATT Services Removed - start: 0x%04x, end: 0x%04x\", start_handle,\n\t\t\t\t\t\t\t\tend_handle);\n\tqueue_remove_all(client->services, match_service_handle,\n\t\t\t\t\t\tUINT_TO_PTR(start_handle),\n\t\t\t\t\t\tunregister_service);\n}"
  },
  {
    "function_name": "btd_gatt_client_service_added",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "2175-2184",
    "snippet": "void btd_gatt_client_service_added(struct btd_gatt_client *client,\n\t\t\t\t\tstruct gatt_db_attribute *attrib)\n{\n\tif (!client || !attrib || !client->ready)\n\t\treturn;\n\n\texport_service(attrib, client);\n\n\tqueue_foreach(client->services, update_included_services, client);\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_foreach",
          "args": [
            "client->services",
            "update_included_services",
            "client"
          ],
          "line": 2183
        },
        "resolved": true,
        "details": {
          "function_name": "queue_foreach",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "203-224",
          "snippet": "void queue_foreach(struct queue *queue, queue_foreach_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue || !function)\n\t\treturn;\n\n\tentry = queue->head;\n\tif (!entry)\n\t\treturn;\n\n\tqueue_ref(queue);\n\twhile (entry && queue->head && queue->ref_count > 1) {\n\t\tstruct queue_entry *next;\n\n\t\tnext = entry->next;\n\t\tfunction(entry->data, user_data);\n\t\tentry = next;\n\t}\n\tqueue_unref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid queue_foreach(struct queue *queue, queue_foreach_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue || !function)\n\t\treturn;\n\n\tentry = queue->head;\n\tif (!entry)\n\t\treturn;\n\n\tqueue_ref(queue);\n\twhile (entry && queue->head && queue->ref_count > 1) {\n\t\tstruct queue_entry *next;\n\n\t\tnext = entry->next;\n\t\tfunction(entry->data, user_data);\n\t\tentry = next;\n\t}\n\tqueue_unref(queue);\n}"
        }
      },
      {
        "call_info": {
          "callee": "export_service",
          "args": [
            "attrib",
            "client"
          ],
          "line": 2181
        },
        "resolved": true,
        "details": {
          "function_name": "export_service",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "1977-1996",
          "snippet": "static void export_service(struct gatt_db_attribute *attr, void *user_data)\n{\n\tstruct btd_gatt_client *client = user_data;\n\tstruct service *service;\n\n\tif (gatt_db_service_get_claimed(attr))\n\t\treturn;\n\n\tservice = service_create(attr, client);\n\tif (!service)\n\t\treturn;\n\n\tif (!create_characteristics(attr, service)) {\n\t\terror(\"Exporting characteristics failed\");\n\t\tunregister_service(service);\n\t\treturn;\n\t}\n\n\tqueue_push_tail(client->services, service);\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void export_service(struct gatt_db_attribute *attr, void *user_data)\n{\n\tstruct btd_gatt_client *client = user_data;\n\tstruct service *service;\n\n\tif (gatt_db_service_get_claimed(attr))\n\t\treturn;\n\n\tservice = service_create(attr, client);\n\tif (!service)\n\t\treturn;\n\n\tif (!create_characteristics(attr, service)) {\n\t\terror(\"Exporting characteristics failed\");\n\t\tunregister_service(service);\n\t\treturn;\n\t}\n\n\tqueue_push_tail(client->services, service);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nvoid btd_gatt_client_service_added(struct btd_gatt_client *client,\n\t\t\t\t\tstruct gatt_db_attribute *attrib)\n{\n\tif (!client || !attrib || !client->ready)\n\t\treturn;\n\n\texport_service(attrib, client);\n\n\tqueue_foreach(client->services, update_included_services, client);\n}"
  },
  {
    "function_name": "btd_gatt_client_connected",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "2153-2173",
    "snippet": "void btd_gatt_client_connected(struct btd_gatt_client *client)\n{\n\tstruct bt_gatt_client *gatt;\n\n\tgatt = btd_device_get_gatt_client(client->device);\n\tif (!gatt) {\n\t\terror(\"GATT client not initialized\");\n\t\treturn;\n\t}\n\n\tDBG(\"Device connected.\");\n\n\tbt_gatt_client_unref(client->gatt);\n\tclient->gatt = bt_gatt_client_clone(gatt);\n\n\t/*\n\t * Services have already been created before. Re-enable notifications\n\t * for any pre-registered notification sessions.\n\t */\n\tqueue_foreach(client->all_notify_clients, register_notify, client);\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_foreach",
          "args": [
            "client->all_notify_clients",
            "register_notify",
            "client"
          ],
          "line": 2172
        },
        "resolved": true,
        "details": {
          "function_name": "queue_foreach",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "203-224",
          "snippet": "void queue_foreach(struct queue *queue, queue_foreach_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue || !function)\n\t\treturn;\n\n\tentry = queue->head;\n\tif (!entry)\n\t\treturn;\n\n\tqueue_ref(queue);\n\twhile (entry && queue->head && queue->ref_count > 1) {\n\t\tstruct queue_entry *next;\n\n\t\tnext = entry->next;\n\t\tfunction(entry->data, user_data);\n\t\tentry = next;\n\t}\n\tqueue_unref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid queue_foreach(struct queue *queue, queue_foreach_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue || !function)\n\t\treturn;\n\n\tentry = queue->head;\n\tif (!entry)\n\t\treturn;\n\n\tqueue_ref(queue);\n\twhile (entry && queue->head && queue->ref_count > 1) {\n\t\tstruct queue_entry *next;\n\n\t\tnext = entry->next;\n\t\tfunction(entry->data, user_data);\n\t\tentry = next;\n\t}\n\tqueue_unref(queue);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_gatt_client_clone",
          "args": [
            "gatt"
          ],
          "line": 2166
        },
        "resolved": true,
        "details": {
          "function_name": "bt_gatt_client_clone",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-client.c",
          "lines": "1971-1992",
          "snippet": "struct bt_gatt_client *bt_gatt_client_clone(struct bt_gatt_client *client)\n{\n\tstruct bt_gatt_client *clone;\n\n\tif (!client)\n\t\treturn NULL;\n\n\tclone = gatt_client_new(client->db, client->att);\n\tif (!clone)\n\t\treturn NULL;\n\n\tqueue_push_tail(client->clones, clone);\n\n\t/*\n\t * Reference the parent since the clones depend on it to propagate\n\t * service changed and ready callbacks.\n\t */\n\tclone->parent = bt_gatt_client_ref(client);\n\tclone->ready = client->ready;\n\n\treturn bt_gatt_client_ref(clone);\n}",
          "includes": [
            "#include <sys/uio.h>",
            "#include <limits.h>",
            "#include <assert.h>",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-helpers.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/att.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/uio.h>\n#include <limits.h>\n#include <assert.h>\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-helpers.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/att.h\"\n#include <config.h>\n\nstruct bt_gatt_client *bt_gatt_client_clone(struct bt_gatt_client *client)\n{\n\tstruct bt_gatt_client *clone;\n\n\tif (!client)\n\t\treturn NULL;\n\n\tclone = gatt_client_new(client->db, client->att);\n\tif (!clone)\n\t\treturn NULL;\n\n\tqueue_push_tail(client->clones, clone);\n\n\t/*\n\t * Reference the parent since the clones depend on it to propagate\n\t * service changed and ready callbacks.\n\t */\n\tclone->parent = bt_gatt_client_ref(client);\n\tclone->ready = client->ready;\n\n\treturn bt_gatt_client_ref(clone);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_gatt_client_unref",
          "args": [
            "client->gatt"
          ],
          "line": 2165
        },
        "resolved": true,
        "details": {
          "function_name": "bt_gatt_client_unref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-client.c",
          "lines": "2004-2013",
          "snippet": "void bt_gatt_client_unref(struct bt_gatt_client *client)\n{\n\tif (!client)\n\t\treturn;\n\n\tif (__sync_sub_and_fetch(&client->ref_count, 1))\n\t\treturn;\n\n\tbt_gatt_client_free(client);\n}",
          "includes": [
            "#include <sys/uio.h>",
            "#include <limits.h>",
            "#include <assert.h>",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-helpers.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/att.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/uio.h>\n#include <limits.h>\n#include <assert.h>\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-helpers.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/att.h\"\n#include <config.h>\n\nvoid bt_gatt_client_unref(struct bt_gatt_client *client)\n{\n\tif (!client)\n\t\treturn;\n\n\tif (__sync_sub_and_fetch(&client->ref_count, 1))\n\t\treturn;\n\n\tbt_gatt_client_free(client);\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Device connected.\""
          ],
          "line": 2163
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"GATT client not initialized\""
          ],
          "line": 2159
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_not_ready",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "118-122",
          "snippet": "DBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_device_get_gatt_client",
          "args": [
            "client->device"
          ],
          "line": 2157
        },
        "resolved": true,
        "details": {
          "function_name": "btd_device_get_gatt_client",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "6220-6226",
          "snippet": "struct bt_gatt_client *btd_device_get_gatt_client(struct btd_device *device)\n{\n\tif (!device)\n\t\treturn NULL;\n\n\treturn device->client;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstruct bt_gatt_client *btd_device_get_gatt_client(struct btd_device *device)\n{\n\tif (!device)\n\t\treturn NULL;\n\n\treturn device->client;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nvoid btd_gatt_client_connected(struct btd_gatt_client *client)\n{\n\tstruct bt_gatt_client *gatt;\n\n\tgatt = btd_device_get_gatt_client(client->device);\n\tif (!gatt) {\n\t\terror(\"GATT client not initialized\");\n\t\treturn;\n\t}\n\n\tDBG(\"Device connected.\");\n\n\tbt_gatt_client_unref(client->gatt);\n\tclient->gatt = bt_gatt_client_clone(gatt);\n\n\t/*\n\t * Services have already been created before. Re-enable notifications\n\t * for any pre-registered notification sessions.\n\t */\n\tqueue_foreach(client->all_notify_clients, register_notify, client);\n}"
  },
  {
    "function_name": "btd_gatt_client_ready",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "2130-2151",
    "snippet": "void btd_gatt_client_ready(struct btd_gatt_client *client)\n{\n\tif (!client)\n\t\treturn;\n\n\tif (!client->gatt) {\n\t\tstruct bt_gatt_client *gatt;\n\n\t\tgatt = btd_device_get_gatt_client(client->device);\n\t\tclient->gatt = bt_gatt_client_clone(gatt);\n\t\tif (!client->gatt) {\n\t\t\terror(\"GATT client not initialized\");\n\t\t\treturn;\n\t\t}\n\t}\n\n\tclient->ready = true;\n\n\tDBG(\"GATT client ready\");\n\n\tcreate_services(client);\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "create_services",
          "args": [
            "client"
          ],
          "line": 2150
        },
        "resolved": true,
        "details": {
          "function_name": "create_services",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "2056-2063",
          "snippet": "static void create_services(struct btd_gatt_client *client)\n{\n\tDBG(\"Exporting objects for GATT services: %s\", client->devaddr);\n\n\tgatt_db_foreach_service(client->db, NULL, export_service, client);\n\n\tqueue_foreach(client->services, update_included_services, client);\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void create_services(struct btd_gatt_client *client)\n{\n\tDBG(\"Exporting objects for GATT services: %s\", client->devaddr);\n\n\tgatt_db_foreach_service(client->db, NULL, export_service, client);\n\n\tqueue_foreach(client->services, update_included_services, client);\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"GATT client ready\""
          ],
          "line": 2148
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"GATT client not initialized\""
          ],
          "line": 2141
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_not_ready",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "118-122",
          "snippet": "DBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_gatt_client_clone",
          "args": [
            "gatt"
          ],
          "line": 2139
        },
        "resolved": true,
        "details": {
          "function_name": "bt_gatt_client_clone",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-client.c",
          "lines": "1971-1992",
          "snippet": "struct bt_gatt_client *bt_gatt_client_clone(struct bt_gatt_client *client)\n{\n\tstruct bt_gatt_client *clone;\n\n\tif (!client)\n\t\treturn NULL;\n\n\tclone = gatt_client_new(client->db, client->att);\n\tif (!clone)\n\t\treturn NULL;\n\n\tqueue_push_tail(client->clones, clone);\n\n\t/*\n\t * Reference the parent since the clones depend on it to propagate\n\t * service changed and ready callbacks.\n\t */\n\tclone->parent = bt_gatt_client_ref(client);\n\tclone->ready = client->ready;\n\n\treturn bt_gatt_client_ref(clone);\n}",
          "includes": [
            "#include <sys/uio.h>",
            "#include <limits.h>",
            "#include <assert.h>",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-helpers.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/att.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/uio.h>\n#include <limits.h>\n#include <assert.h>\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-helpers.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/att.h\"\n#include <config.h>\n\nstruct bt_gatt_client *bt_gatt_client_clone(struct bt_gatt_client *client)\n{\n\tstruct bt_gatt_client *clone;\n\n\tif (!client)\n\t\treturn NULL;\n\n\tclone = gatt_client_new(client->db, client->att);\n\tif (!clone)\n\t\treturn NULL;\n\n\tqueue_push_tail(client->clones, clone);\n\n\t/*\n\t * Reference the parent since the clones depend on it to propagate\n\t * service changed and ready callbacks.\n\t */\n\tclone->parent = bt_gatt_client_ref(client);\n\tclone->ready = client->ready;\n\n\treturn bt_gatt_client_ref(clone);\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_device_get_gatt_client",
          "args": [
            "client->device"
          ],
          "line": 2138
        },
        "resolved": true,
        "details": {
          "function_name": "btd_device_get_gatt_client",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "6220-6226",
          "snippet": "struct bt_gatt_client *btd_device_get_gatt_client(struct btd_device *device)\n{\n\tif (!device)\n\t\treturn NULL;\n\n\treturn device->client;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstruct bt_gatt_client *btd_device_get_gatt_client(struct btd_device *device)\n{\n\tif (!device)\n\t\treturn NULL;\n\n\treturn device->client;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nvoid btd_gatt_client_ready(struct btd_gatt_client *client)\n{\n\tif (!client)\n\t\treturn;\n\n\tif (!client->gatt) {\n\t\tstruct bt_gatt_client *gatt;\n\n\t\tgatt = btd_device_get_gatt_client(client->device);\n\t\tclient->gatt = bt_gatt_client_clone(gatt);\n\t\tif (!client->gatt) {\n\t\t\terror(\"GATT client not initialized\");\n\t\t\treturn;\n\t\t}\n\t}\n\n\tclient->ready = true;\n\n\tDBG(\"GATT client ready\");\n\n\tcreate_services(client);\n}"
  },
  {
    "function_name": "register_notify",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "2102-2128",
    "snippet": "static void register_notify(void *data, void *user_data)\n{\n\tstruct notify_client *notify_client = data;\n\tstruct btd_gatt_client *client = user_data;\n\tstruct async_dbus_op *op;\n\n\tDBG(\"Re-register subscribed notification client\");\n\n\top = new0(struct async_dbus_op, 1);\n\top->data = notify_client;\n\n\tnotify_client->notify_id = bt_gatt_client_register_notify(client->gatt,\n\t\t\t\t\tnotify_client->chrc->value_handle,\n\t\t\t\t\tregister_notify_cb, notify_cb,\n\t\t\t\t\top, async_dbus_op_free);\n\tif (notify_client->notify_id)\n\t\treturn;\n\n\tasync_dbus_op_free(op);\n\n\tDBG(\"Failed to re-register notification client\");\n\n\tqueue_remove(notify_client->chrc->notify_clients, notify_client);\n\tqueue_remove(client->all_notify_clients, notify_client);\n\n\tnotify_client_free(notify_client);\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "notify_client_free",
          "args": [
            "notify_client"
          ],
          "line": 2127
        },
        "resolved": true,
        "details": {
          "function_name": "notify_client_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "1256-1265",
          "snippet": "static void notify_client_free(struct notify_client *client)\n{\n\tDBG(\"owner %s\", client->owner);\n\n\tg_dbus_remove_watch(btd_get_dbus_connection(), client->watch);\n\tbt_gatt_client_unregister_notify(client->chrc->service->client->gatt,\n\t\t\t\t\t\t\tclient->notify_id);\n\tfree(client->owner);\n\tfree(client);\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void notify_client_free(struct notify_client *client)\n{\n\tDBG(\"owner %s\", client->owner);\n\n\tg_dbus_remove_watch(btd_get_dbus_connection(), client->watch);\n\tbt_gatt_client_unregister_notify(client->chrc->service->client->gatt,\n\t\t\t\t\t\t\tclient->notify_id);\n\tfree(client->owner);\n\tfree(client);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_remove",
          "args": [
            "client->all_notify_clients",
            "notify_client"
          ],
          "line": 2125
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_uuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "526-541",
          "snippet": "static bool queue_remove_uuid(struct queue *queue, bt_uuid_t *uuid)\n{\n\tbt_uuid_t *removed;\n\n\tif (!queue || !uuid)\n\t\treturn false;\n\n\tremoved = queue_remove_if(queue, uuid_match, uuid);\n\n\tif (removed) {\n\t\tfree(removed);\n\t\treturn true;\n\t}\n\n\treturn false;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic bool queue_remove_uuid(struct queue *queue, bt_uuid_t *uuid)\n{\n\tbt_uuid_t *removed;\n\n\tif (!queue || !uuid)\n\t\treturn false;\n\n\tremoved = queue_remove_if(queue, uuid_match, uuid);\n\n\tif (removed) {\n\t\tfree(removed);\n\t\treturn true;\n\t}\n\n\treturn false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Failed to re-register notification client\""
          ],
          "line": 2122
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "async_dbus_op_free",
          "args": [
            "op"
          ],
          "line": 2120
        },
        "resolved": true,
        "details": {
          "function_name": "async_dbus_op_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "235-242",
          "snippet": "static void async_dbus_op_free(void *data)\n{\n\tstruct async_dbus_op *op = data;\n\n\tqueue_destroy(op->msgs, (void *)dbus_message_unref);\n\n\tfree(op);\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void async_dbus_op_free(void *data)\n{\n\tstruct async_dbus_op *op = data;\n\n\tqueue_destroy(op->msgs, (void *)dbus_message_unref);\n\n\tfree(op);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_gatt_client_register_notify",
          "args": [
            "client->gatt",
            "notify_client->chrc->value_handle",
            "register_notify_cb",
            "notify_cb",
            "op",
            "async_dbus_op_free"
          ],
          "line": 2113
        },
        "resolved": true,
        "details": {
          "function_name": "bt_gatt_client_register_notify",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-client.c",
          "lines": "3237-3252",
          "snippet": "unsigned int bt_gatt_client_register_notify(struct bt_gatt_client *client,\n\t\t\t\tuint16_t chrc_value_handle,\n\t\t\t\tbt_gatt_client_register_callback_t callback,\n\t\t\t\tbt_gatt_client_notify_callback_t notify,\n\t\t\t\tvoid *user_data,\n\t\t\t\tbt_gatt_client_destroy_func_t destroy)\n{\n\tif (!client || !client->db || !chrc_value_handle || !callback)\n\t\treturn 0;\n\n\tif (client->in_svc_chngd)\n\t\treturn 0;\n\n\treturn register_notify(client, chrc_value_handle, callback, notify,\n\t\t\t\t\t\t\tuser_data, destroy);\n}",
          "includes": [
            "#include <sys/uio.h>",
            "#include <limits.h>",
            "#include <assert.h>",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-helpers.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/att.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void discover_chrcs_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\t\tstruct bt_gatt_result *result,\n\t\t\t\t\t\tvoid *user_data);",
            "static void discover_descs_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\t\tstruct bt_gatt_result *result,\n\t\t\t\t\t\tvoid *user_data);",
            "static void ext_prop_read_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\tconst uint8_t *value, uint16_t length,\n\t\t\t\t\tvoid *user_data);",
            "static void service_changed_cb(uint16_t value_handle, const uint8_t *value,\n\t\t\t\t\tuint16_t length, void *user_data);",
            "static void prepare_write_cb(uint8_t opcode, const void *pdu, uint16_t length,\n\t\t\t\t\t\t\tvoid *user_data);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <sys/uio.h>\n#include <limits.h>\n#include <assert.h>\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-helpers.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/att.h\"\n#include <config.h>\n\nstatic void discover_chrcs_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\t\tstruct bt_gatt_result *result,\n\t\t\t\t\t\tvoid *user_data);\nstatic void discover_descs_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\t\tstruct bt_gatt_result *result,\n\t\t\t\t\t\tvoid *user_data);\nstatic void ext_prop_read_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\tconst uint8_t *value, uint16_t length,\n\t\t\t\t\tvoid *user_data);\nstatic void service_changed_cb(uint16_t value_handle, const uint8_t *value,\n\t\t\t\t\tuint16_t length, void *user_data);\nstatic void prepare_write_cb(uint8_t opcode, const void *pdu, uint16_t length,\n\t\t\t\t\t\t\tvoid *user_data);\n\nunsigned int bt_gatt_client_register_notify(struct bt_gatt_client *client,\n\t\t\t\tuint16_t chrc_value_handle,\n\t\t\t\tbt_gatt_client_register_callback_t callback,\n\t\t\t\tbt_gatt_client_notify_callback_t notify,\n\t\t\t\tvoid *user_data,\n\t\t\t\tbt_gatt_client_destroy_func_t destroy)\n{\n\tif (!client || !client->db || !chrc_value_handle || !callback)\n\t\treturn 0;\n\n\tif (client->in_svc_chngd)\n\t\treturn 0;\n\n\treturn register_notify(client, chrc_value_handle, callback, notify,\n\t\t\t\t\t\t\tuser_data, destroy);\n}"
        }
      },
      {
        "call_info": {
          "callee": "new0",
          "args": [
            "structasync_dbus_op",
            "1"
          ],
          "line": 2110
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Re-register subscribed notification client\""
          ],
          "line": 2108
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void register_notify(void *data, void *user_data)\n{\n\tstruct notify_client *notify_client = data;\n\tstruct btd_gatt_client *client = user_data;\n\tstruct async_dbus_op *op;\n\n\tDBG(\"Re-register subscribed notification client\");\n\n\top = new0(struct async_dbus_op, 1);\n\top->data = notify_client;\n\n\tnotify_client->notify_id = bt_gatt_client_register_notify(client->gatt,\n\t\t\t\t\tnotify_client->chrc->value_handle,\n\t\t\t\t\tregister_notify_cb, notify_cb,\n\t\t\t\t\top, async_dbus_op_free);\n\tif (notify_client->notify_id)\n\t\treturn;\n\n\tasync_dbus_op_free(op);\n\n\tDBG(\"Failed to re-register notification client\");\n\n\tqueue_remove(notify_client->chrc->notify_clients, notify_client);\n\tqueue_remove(client->all_notify_clients, notify_client);\n\n\tnotify_client_free(notify_client);\n}"
  },
  {
    "function_name": "btd_gatt_client_destroy",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "2089-2100",
    "snippet": "void btd_gatt_client_destroy(struct btd_gatt_client *client)\n{\n\tif (!client)\n\t\treturn;\n\n\tqueue_destroy(client->services, unregister_service);\n\tqueue_destroy(client->all_notify_clients, NULL);\n\tqueue_destroy(client->ios, NULL);\n\tbt_gatt_client_unref(client->gatt);\n\tgatt_db_unref(client->db);\n\tfree(client);\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "client"
          ],
          "line": 2099
        },
        "resolved": true,
        "details": {
          "function_name": "service_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "1818-1826",
          "snippet": "static void service_free(void *data)\n{\n\tstruct service *service = data;\n\n\tqueue_destroy(service->chrcs, NULL);  /* List should be empty here */\n\tqueue_destroy(service->incl_services, NULL);\n\tg_free(service->path);\n\tfree(service);\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void service_free(void *data)\n{\n\tstruct service *service = data;\n\n\tqueue_destroy(service->chrcs, NULL);  /* List should be empty here */\n\tqueue_destroy(service->incl_services, NULL);\n\tg_free(service->path);\n\tfree(service);\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_unref",
          "args": [
            "client->db"
          ],
          "line": 2098
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_unref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "316-325",
          "snippet": "void gatt_db_unref(struct gatt_db *db)\n{\n\tif (!db)\n\t\treturn;\n\n\tif (__sync_sub_and_fetch(&db->ref_count, 1))\n\t\treturn;\n\n\tgatt_db_destroy(db);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nvoid gatt_db_unref(struct gatt_db *db)\n{\n\tif (!db)\n\t\treturn;\n\n\tif (__sync_sub_and_fetch(&db->ref_count, 1))\n\t\treturn;\n\n\tgatt_db_destroy(db);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_gatt_client_unref",
          "args": [
            "client->gatt"
          ],
          "line": 2097
        },
        "resolved": true,
        "details": {
          "function_name": "bt_gatt_client_unref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-client.c",
          "lines": "2004-2013",
          "snippet": "void bt_gatt_client_unref(struct bt_gatt_client *client)\n{\n\tif (!client)\n\t\treturn;\n\n\tif (__sync_sub_and_fetch(&client->ref_count, 1))\n\t\treturn;\n\n\tbt_gatt_client_free(client);\n}",
          "includes": [
            "#include <sys/uio.h>",
            "#include <limits.h>",
            "#include <assert.h>",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-helpers.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/att.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/uio.h>\n#include <limits.h>\n#include <assert.h>\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-helpers.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/att.h\"\n#include <config.h>\n\nvoid bt_gatt_client_unref(struct bt_gatt_client *client)\n{\n\tif (!client)\n\t\treturn;\n\n\tif (__sync_sub_and_fetch(&client->ref_count, 1))\n\t\treturn;\n\n\tbt_gatt_client_free(client);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_destroy",
          "args": [
            "client->ios",
            "NULL"
          ],
          "line": 2096
        },
        "resolved": true,
        "details": {
          "function_name": "queue_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "68-76",
          "snippet": "void queue_destroy(struct queue *queue, queue_destroy_func_t destroy)\n{\n\tif (!queue)\n\t\treturn;\n\n\tqueue_remove_all(queue, NULL, NULL, destroy);\n\n\tqueue_unref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid queue_destroy(struct queue *queue, queue_destroy_func_t destroy)\n{\n\tif (!queue)\n\t\treturn;\n\n\tqueue_remove_all(queue, NULL, NULL, destroy);\n\n\tqueue_unref(queue);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nvoid btd_gatt_client_destroy(struct btd_gatt_client *client)\n{\n\tif (!client)\n\t\treturn;\n\n\tqueue_destroy(client->services, unregister_service);\n\tqueue_destroy(client->all_notify_clients, NULL);\n\tqueue_destroy(client->ios, NULL);\n\tbt_gatt_client_unref(client->gatt);\n\tgatt_db_unref(client->db);\n\tfree(client);\n}"
  },
  {
    "function_name": "btd_gatt_client_new",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "2065-2087",
    "snippet": "struct btd_gatt_client *btd_gatt_client_new(struct btd_device *device)\n{\n\tstruct btd_gatt_client *client;\n\tstruct gatt_db *db;\n\n\tif (!device)\n\t\treturn NULL;\n\n\tdb = btd_device_get_gatt_db(device);\n\tif (!db)\n\t\treturn NULL;\n\n\tclient = new0(struct btd_gatt_client, 1);\n\tclient->services = queue_new();\n\tclient->all_notify_clients = queue_new();\n\tclient->ios = queue_new();\n\tclient->device = device;\n\tba2str(device_get_address(device), client->devaddr);\n\n\tclient->db = gatt_db_ref(db);\n\n\treturn client;\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "gatt_db_ref",
          "args": [
            "db"
          ],
          "line": 2084
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_ref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "210-218",
          "snippet": "struct gatt_db *gatt_db_ref(struct gatt_db *db)\n{\n\tif (!db)\n\t\treturn NULL;\n\n\t__sync_fetch_and_add(&db->ref_count, 1);\n\n\treturn db;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstruct gatt_db *gatt_db_ref(struct gatt_db *db)\n{\n\tif (!db)\n\t\treturn NULL;\n\n\t__sync_fetch_and_add(&db->ref_count, 1);\n\n\treturn db;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ba2str",
          "args": [
            "device_get_address(device)",
            "client->devaddr"
          ],
          "line": 2082
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device_get_address",
          "args": [
            "device"
          ],
          "line": 2082
        },
        "resolved": true,
        "details": {
          "function_name": "device_get_address",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5314-5317",
          "snippet": "const bdaddr_t *device_get_address(struct btd_device *device)\n{\n\treturn &device->bdaddr;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nconst bdaddr_t *device_get_address(struct btd_device *device)\n{\n\treturn &device->bdaddr;\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_new",
          "args": [],
          "line": 2080
        },
        "resolved": true,
        "details": {
          "function_name": "queue_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "56-66",
          "snippet": "struct queue *queue_new(void)\n{\n\tstruct queue *queue;\n\n\tqueue = new0(struct queue, 1);\n\tqueue->head = NULL;\n\tqueue->tail = NULL;\n\tqueue->entries = 0;\n\n\treturn queue_ref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nstruct queue *queue_new(void)\n{\n\tstruct queue *queue;\n\n\tqueue = new0(struct queue, 1);\n\tqueue->head = NULL;\n\tqueue->tail = NULL;\n\tqueue->entries = 0;\n\n\treturn queue_ref(queue);\n}"
        }
      },
      {
        "call_info": {
          "callee": "new0",
          "args": [
            "structbtd_gatt_client",
            "1"
          ],
          "line": 2077
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_device_get_gatt_db",
          "args": [
            "device"
          ],
          "line": 2073
        },
        "resolved": true,
        "details": {
          "function_name": "btd_device_get_gatt_db",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "6212-6218",
          "snippet": "struct gatt_db *btd_device_get_gatt_db(struct btd_device *device)\n{\n\tif (!device)\n\t\treturn NULL;\n\n\treturn device->db;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstruct gatt_db *btd_device_get_gatt_db(struct btd_device *device)\n{\n\tif (!device)\n\t\treturn NULL;\n\n\treturn device->db;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstruct btd_gatt_client *btd_gatt_client_new(struct btd_device *device)\n{\n\tstruct btd_gatt_client *client;\n\tstruct gatt_db *db;\n\n\tif (!device)\n\t\treturn NULL;\n\n\tdb = btd_device_get_gatt_db(device);\n\tif (!db)\n\t\treturn NULL;\n\n\tclient = new0(struct btd_gatt_client, 1);\n\tclient->services = queue_new();\n\tclient->all_notify_clients = queue_new();\n\tclient->ios = queue_new();\n\tclient->device = device;\n\tba2str(device_get_address(device), client->devaddr);\n\n\tclient->db = gatt_db_ref(db);\n\n\treturn client;\n}"
  },
  {
    "function_name": "create_services",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "2056-2063",
    "snippet": "static void create_services(struct btd_gatt_client *client)\n{\n\tDBG(\"Exporting objects for GATT services: %s\", client->devaddr);\n\n\tgatt_db_foreach_service(client->db, NULL, export_service, client);\n\n\tqueue_foreach(client->services, update_included_services, client);\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_foreach",
          "args": [
            "client->services",
            "update_included_services",
            "client"
          ],
          "line": 2062
        },
        "resolved": true,
        "details": {
          "function_name": "queue_foreach",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "203-224",
          "snippet": "void queue_foreach(struct queue *queue, queue_foreach_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue || !function)\n\t\treturn;\n\n\tentry = queue->head;\n\tif (!entry)\n\t\treturn;\n\n\tqueue_ref(queue);\n\twhile (entry && queue->head && queue->ref_count > 1) {\n\t\tstruct queue_entry *next;\n\n\t\tnext = entry->next;\n\t\tfunction(entry->data, user_data);\n\t\tentry = next;\n\t}\n\tqueue_unref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid queue_foreach(struct queue *queue, queue_foreach_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue || !function)\n\t\treturn;\n\n\tentry = queue->head;\n\tif (!entry)\n\t\treturn;\n\n\tqueue_ref(queue);\n\twhile (entry && queue->head && queue->ref_count > 1) {\n\t\tstruct queue_entry *next;\n\n\t\tnext = entry->next;\n\t\tfunction(entry->data, user_data);\n\t\tentry = next;\n\t}\n\tqueue_unref(queue);\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_foreach_service",
          "args": [
            "client->db",
            "NULL",
            "export_service",
            "client"
          ],
          "line": 2060
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_foreach_service",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1258-1264",
          "snippet": "void gatt_db_foreach_service(struct gatt_db *db, const bt_uuid_t *uuid,\n\t\t\t\t\t\tgatt_db_attribute_cb_t func,\n\t\t\t\t\t\tvoid *user_data)\n{\n\tgatt_db_foreach_service_in_range(db, uuid, func, user_data, 0x0001,\n\t\t\t\t\t\t\t\t\t0xffff);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nvoid gatt_db_foreach_service(struct gatt_db *db, const bt_uuid_t *uuid,\n\t\t\t\t\t\tgatt_db_attribute_cb_t func,\n\t\t\t\t\t\tvoid *user_data)\n{\n\tgatt_db_foreach_service_in_range(db, uuid, func, user_data, 0x0001,\n\t\t\t\t\t\t\t\t\t0xffff);\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Exporting objects for GATT services: %s\"",
            "client->devaddr"
          ],
          "line": 2058
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void create_services(struct btd_gatt_client *client)\n{\n\tDBG(\"Exporting objects for GATT services: %s\", client->devaddr);\n\n\tgatt_db_foreach_service(client->db, NULL, export_service, client);\n\n\tqueue_foreach(client->services, update_included_services, client);\n}"
  },
  {
    "function_name": "update_included_services",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "2036-2054",
    "snippet": "static void update_included_services(void *data, void *user_data)\n{\n\tstruct btd_gatt_client *client = user_data;\n\tstruct service *service = data;\n\tstruct gatt_db_attribute *attr;\n\tstruct update_incl_data inc_data = {\n\t\t.changed = false,\n\t\t.service = service,\n\t};\n\n\tattr = gatt_db_get_attribute(client->db, service->start_handle);\n\tgatt_db_service_foreach_incl(attr, update_included_service, &inc_data);\n\n\tif (inc_data.changed)\n\t\tg_dbus_emit_property_changed(btd_get_dbus_connection(),\n\t\t\t\t\t\t\tservice->path,\n\t\t\t\t\t\t\tGATT_SERVICE_IFACE,\n\t\t\t\t\t\t\t\"Includes\");\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define GATT_SERVICE_IFACE\t\t\"org.bluez.GattService1\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_dbus_emit_property_changed",
          "args": [
            "btd_get_dbus_connection()",
            "service->path",
            "GATT_SERVICE_IFACE",
            "\"Includes\""
          ],
          "line": 2050
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_get_dbus_connection",
          "args": [],
          "line": 2050
        },
        "resolved": true,
        "details": {
          "function_name": "btd_get_dbus_connection",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/dbus-common.c",
          "lines": "61-64",
          "snippet": "DBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *connection = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *connection = NULL;\n\nDBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_service_foreach_incl",
          "args": [
            "attr",
            "update_included_service",
            "&inc_data"
          ],
          "line": 2047
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_service_foreach_incl",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1388-1394",
          "snippet": "void gatt_db_service_foreach_incl(struct gatt_db_attribute *attrib,\n\t\t\t\t\t\tgatt_db_attribute_cb_t func,\n\t\t\t\t\t\tvoid *user_data)\n{\n\tgatt_db_service_foreach(attrib, &included_service_uuid, func,\n\t\t\t\t\t\t\t\tuser_data);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static const bt_uuid_t included_service_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_INCLUDE_UUID };"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic const bt_uuid_t included_service_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_INCLUDE_UUID };\n\nvoid gatt_db_service_foreach_incl(struct gatt_db_attribute *attrib,\n\t\t\t\t\t\tgatt_db_attribute_cb_t func,\n\t\t\t\t\t\tvoid *user_data)\n{\n\tgatt_db_service_foreach(attrib, &included_service_uuid, func,\n\t\t\t\t\t\t\t\tuser_data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_get_attribute",
          "args": [
            "client->db",
            "service->start_handle"
          ],
          "line": 2046
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_get_attribute",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1423-1445",
          "snippet": "struct gatt_db_attribute *gatt_db_get_attribute(struct gatt_db *db,\n\t\t\t\t\t\t\tuint16_t handle)\n{\n\tstruct gatt_db_attribute *attrib;\n\tstruct gatt_db_service *service;\n\tint i;\n\n\tattrib = gatt_db_get_service(db, handle);\n\tif (!attrib)\n\t\treturn NULL;\n\n\tservice = attrib->service;\n\n\tfor (i = 0; i < service->num_handles; i++) {\n\t\tif (!service->attributes[i])\n\t\t\tcontinue;\n\n\t\tif (service->attributes[i]->handle == handle)\n\t\t\treturn service->attributes[i];\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstruct gatt_db_attribute *gatt_db_get_attribute(struct gatt_db *db,\n\t\t\t\t\t\t\tuint16_t handle)\n{\n\tstruct gatt_db_attribute *attrib;\n\tstruct gatt_db_service *service;\n\tint i;\n\n\tattrib = gatt_db_get_service(db, handle);\n\tif (!attrib)\n\t\treturn NULL;\n\n\tservice = attrib->service;\n\n\tfor (i = 0; i < service->num_handles; i++) {\n\t\tif (!service->attributes[i])\n\t\t\tcontinue;\n\n\t\tif (service->attributes[i]->handle == handle)\n\t\t\treturn service->attributes[i];\n\t}\n\n\treturn NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\n#define GATT_SERVICE_IFACE\t\t\"org.bluez.GattService1\"\n\nstatic void update_included_services(void *data, void *user_data)\n{\n\tstruct btd_gatt_client *client = user_data;\n\tstruct service *service = data;\n\tstruct gatt_db_attribute *attr;\n\tstruct update_incl_data inc_data = {\n\t\t.changed = false,\n\t\t.service = service,\n\t};\n\n\tattr = gatt_db_get_attribute(client->db, service->start_handle);\n\tgatt_db_service_foreach_incl(attr, update_included_service, &inc_data);\n\n\tif (inc_data.changed)\n\t\tg_dbus_emit_property_changed(btd_get_dbus_connection(),\n\t\t\t\t\t\t\tservice->path,\n\t\t\t\t\t\t\tGATT_SERVICE_IFACE,\n\t\t\t\t\t\t\t\"Includes\");\n}"
  },
  {
    "function_name": "update_included_service",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "2011-2034",
    "snippet": "static void update_included_service(struct gatt_db_attribute *attrib,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct update_incl_data *update_data = user_data;\n\tstruct btd_gatt_client *client = update_data->service->client;\n\tstruct service *service = update_data->service;\n\tstruct service *incl_service;\n\tuint16_t start_handle;\n\n\tgatt_db_attribute_get_incl_data(attrib, NULL, &start_handle, NULL);\n\n\tincl_service = queue_find(client->services, match_service_handle,\n\t\t\t\t\t\tUINT_TO_PTR(start_handle));\n\n\tif (!incl_service)\n\t\treturn;\n\n\t/* Check if service is already on list */\n\tif (queue_find(service->incl_services, NULL, incl_service))\n\t\treturn;\n\n\tqueue_push_tail(service->incl_services, incl_service);\n\tupdate_data->changed = true;\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_push_tail",
          "args": [
            "service->incl_services",
            "incl_service"
          ],
          "line": 2032
        },
        "resolved": true,
        "details": {
          "function_name": "queue_push_tail",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "88-108",
          "snippet": "bool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_find",
          "args": [
            "service->incl_services",
            "NULL",
            "incl_service"
          ],
          "line": 2029
        },
        "resolved": true,
        "details": {
          "function_name": "queue_find",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "231-247",
          "snippet": "void *queue_find(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tconst void *match_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tfor (entry = queue->head; entry; entry = entry->next)\n\t\tif (function(entry->data, match_data))\n\t\t\treturn entry->data;\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid *queue_find(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tconst void *match_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tfor (entry = queue->head; entry; entry = entry->next)\n\t\tif (function(entry->data, match_data))\n\t\t\treturn entry->data;\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "UINT_TO_PTR",
          "args": [
            "start_handle"
          ],
          "line": 2023
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gatt_db_attribute_get_incl_data",
          "args": [
            "attrib",
            "NULL",
            "&start_handle",
            "NULL"
          ],
          "line": 2020
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_get_incl_data",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1666-1700",
          "snippet": "bool gatt_db_attribute_get_incl_data(const struct gatt_db_attribute *attrib,\n\t\t\t\t\t\t\tuint16_t *handle,\n\t\t\t\t\t\t\tuint16_t *start_handle,\n\t\t\t\t\t\t\tuint16_t *end_handle)\n{\n\tif (!attrib)\n\t\treturn false;\n\n\tif (bt_uuid_cmp(&included_service_uuid, &attrib->uuid))\n\t\treturn false;\n\n\t/*\n\t * Include definition value:\n\t * 2 octets: start handle of included service\n\t * 2 octets: end handle of included service\n\t * optional 2 octets: 16-bit Bluetooth UUID\n\t */\n\tif (!attrib->value || attrib->value_len < 4 || attrib->value_len > 6)\n\t\treturn false;\n\n\t/*\n\t * We only return the handles since the UUID can be easily obtained\n\t * from the corresponding attribute.\n\t */\n\tif (handle)\n\t\t*handle = attrib->handle;\n\n\tif (start_handle)\n\t\t*start_handle = get_le16(attrib->value);\n\n\tif (end_handle)\n\t\t*end_handle = get_le16(attrib->value + 2);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static const bt_uuid_t included_service_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_INCLUDE_UUID };"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic const bt_uuid_t included_service_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_INCLUDE_UUID };\n\nbool gatt_db_attribute_get_incl_data(const struct gatt_db_attribute *attrib,\n\t\t\t\t\t\t\tuint16_t *handle,\n\t\t\t\t\t\t\tuint16_t *start_handle,\n\t\t\t\t\t\t\tuint16_t *end_handle)\n{\n\tif (!attrib)\n\t\treturn false;\n\n\tif (bt_uuid_cmp(&included_service_uuid, &attrib->uuid))\n\t\treturn false;\n\n\t/*\n\t * Include definition value:\n\t * 2 octets: start handle of included service\n\t * 2 octets: end handle of included service\n\t * optional 2 octets: 16-bit Bluetooth UUID\n\t */\n\tif (!attrib->value || attrib->value_len < 4 || attrib->value_len > 6)\n\t\treturn false;\n\n\t/*\n\t * We only return the handles since the UUID can be easily obtained\n\t * from the corresponding attribute.\n\t */\n\tif (handle)\n\t\t*handle = attrib->handle;\n\n\tif (start_handle)\n\t\t*start_handle = get_le16(attrib->value);\n\n\tif (end_handle)\n\t\t*end_handle = get_le16(attrib->value + 2);\n\n\treturn true;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void update_included_service(struct gatt_db_attribute *attrib,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct update_incl_data *update_data = user_data;\n\tstruct btd_gatt_client *client = update_data->service->client;\n\tstruct service *service = update_data->service;\n\tstruct service *incl_service;\n\tuint16_t start_handle;\n\n\tgatt_db_attribute_get_incl_data(attrib, NULL, &start_handle, NULL);\n\n\tincl_service = queue_find(client->services, match_service_handle,\n\t\t\t\t\t\tUINT_TO_PTR(start_handle));\n\n\tif (!incl_service)\n\t\treturn;\n\n\t/* Check if service is already on list */\n\tif (queue_find(service->incl_services, NULL, incl_service))\n\t\treturn;\n\n\tqueue_push_tail(service->incl_services, incl_service);\n\tupdate_data->changed = true;\n}"
  },
  {
    "function_name": "match_service_handle",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "1998-2004",
    "snippet": "static bool match_service_handle(const void *a, const void *b)\n{\n\tconst struct service *service = a;\n\tuint16_t start_handle = PTR_TO_UINT(b);\n\n\treturn service->start_handle == start_handle;\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "PTR_TO_UINT",
          "args": [
            "b"
          ],
          "line": 2001
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic bool match_service_handle(const void *a, const void *b)\n{\n\tconst struct service *service = a;\n\tuint16_t start_handle = PTR_TO_UINT(b);\n\n\treturn service->start_handle == start_handle;\n}"
  },
  {
    "function_name": "export_service",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "1977-1996",
    "snippet": "static void export_service(struct gatt_db_attribute *attr, void *user_data)\n{\n\tstruct btd_gatt_client *client = user_data;\n\tstruct service *service;\n\n\tif (gatt_db_service_get_claimed(attr))\n\t\treturn;\n\n\tservice = service_create(attr, client);\n\tif (!service)\n\t\treturn;\n\n\tif (!create_characteristics(attr, service)) {\n\t\terror(\"Exporting characteristics failed\");\n\t\tunregister_service(service);\n\t\treturn;\n\t}\n\n\tqueue_push_tail(client->services, service);\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_push_tail",
          "args": [
            "client->services",
            "service"
          ],
          "line": 1995
        },
        "resolved": true,
        "details": {
          "function_name": "queue_push_tail",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "88-108",
          "snippet": "bool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "unregister_service",
          "args": [
            "service"
          ],
          "line": 1991
        },
        "resolved": true,
        "details": {
          "function_name": "unregister_service",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "1886-1900",
          "snippet": "static void unregister_service(void *data)\n{\n\tstruct service *service = data;\n\tstruct btd_gatt_client *client = service->client;\n\n\tDBG(\"Removing GATT service: %s\", service->path);\n\n\tqueue_remove_all(service->chrcs, NULL, NULL, unregister_characteristic);\n\tqueue_remove_all(service->incl_services, NULL, NULL, NULL);\n\n\tqueue_foreach(client->services, on_service_removed, service);\n\n\tg_dbus_unregister_interface(btd_get_dbus_connection(), service->path,\n\t\t\t\t\t\t\tGATT_SERVICE_IFACE);\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define GATT_SERVICE_IFACE\t\t\"org.bluez.GattService1\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\n#define GATT_SERVICE_IFACE\t\t\"org.bluez.GattService1\"\n\nstatic void unregister_service(void *data)\n{\n\tstruct service *service = data;\n\tstruct btd_gatt_client *client = service->client;\n\n\tDBG(\"Removing GATT service: %s\", service->path);\n\n\tqueue_remove_all(service->chrcs, NULL, NULL, unregister_characteristic);\n\tqueue_remove_all(service->incl_services, NULL, NULL, NULL);\n\n\tqueue_foreach(client->services, on_service_removed, service);\n\n\tg_dbus_unregister_interface(btd_get_dbus_connection(), service->path,\n\t\t\t\t\t\t\tGATT_SERVICE_IFACE);\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Exporting characteristics failed\""
          ],
          "line": 1990
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_not_ready",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "118-122",
          "snippet": "DBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "create_characteristics",
          "args": [
            "attr",
            "service"
          ],
          "line": 1989
        },
        "resolved": true,
        "details": {
          "function_name": "create_characteristics",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "1964-1975",
          "snippet": "static bool create_characteristics(struct gatt_db_attribute *attr,\n\t\t\t\t\t\tstruct service *service)\n{\n\tstruct export_data data;\n\n\tdata.root = service;\n\tdata.failed = false;\n\n\tgatt_db_service_foreach_char(attr, export_char, &data);\n\n\treturn !data.failed;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic bool create_characteristics(struct gatt_db_attribute *attr,\n\t\t\t\t\t\tstruct service *service)\n{\n\tstruct export_data data;\n\n\tdata.root = service;\n\tdata.failed = false;\n\n\tgatt_db_service_foreach_char(attr, export_char, &data);\n\n\treturn !data.failed;\n}"
        }
      },
      {
        "call_info": {
          "callee": "service_create",
          "args": [
            "attr",
            "client"
          ],
          "line": 1985
        },
        "resolved": true,
        "details": {
          "function_name": "service_create",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "1828-1872",
          "snippet": "static struct service *service_create(struct gatt_db_attribute *attr,\n\t\t\t\t\t\tstruct btd_gatt_client *client)\n{\n\tstruct service *service;\n\tconst char *device_path = device_get_path(client->device);\n\tbt_uuid_t uuid;\n\n\tservice = new0(struct service, 1);\n\tservice->chrcs = queue_new();\n\tservice->incl_services = queue_new();\n\tservice->client = client;\n\n\tgatt_db_attribute_get_service_data(attr, &service->start_handle,\n\t\t\t\t\t\t\t&service->end_handle,\n\t\t\t\t\t\t\t&service->primary,\n\t\t\t\t\t\t\t&uuid);\n\tbt_uuid_to_uuid128(&uuid, &service->uuid);\n\n\tservice->path = g_strdup_printf(\"%s/service%04x\", device_path,\n\t\t\t\t\t\t\tservice->start_handle);\n\n\tif (!g_dbus_register_interface(btd_get_dbus_connection(), service->path,\n\t\t\t\t\t\tGATT_SERVICE_IFACE,\n\t\t\t\t\t\tNULL, NULL,\n\t\t\t\t\t\tservice_properties,\n\t\t\t\t\t\tservice, service_free)) {\n\t\terror(\"Unable to register GATT service with handle 0x%04x for \"\n\t\t\t\t\t\t\t\"device %s\",\n\t\t\t\t\t\t\tservice->start_handle,\n\t\t\t\t\t\t\tclient->devaddr);\n\t\tservice_free(service);\n\n\t\treturn NULL;\n\t}\n\n\tDBG(\"Exported GATT service: %s\", service->path);\n\n\t/* Set service active so we can skip discovering next time */\n\tgatt_db_service_set_active(attr, true);\n\n\t/* Mark the service as claimed since it going to be exported */\n\tgatt_db_service_set_claimed(attr, true);\n\n\treturn service;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define GATT_SERVICE_IFACE\t\t\"org.bluez.GattService1\""
          ],
          "globals_used": [
            "static const GDBusPropertyTable service_properties[] = {\n\t{ \"UUID\", \"s\", service_get_uuid },\n\t{ \"Device\", \"o\", service_get_device },\n\t{ \"Primary\", \"b\", service_get_primary },\n\t{ \"Includes\", \"ao\", service_get_includes },\n\t{ }\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\n#define GATT_SERVICE_IFACE\t\t\"org.bluez.GattService1\"\n\nstatic const GDBusPropertyTable service_properties[] = {\n\t{ \"UUID\", \"s\", service_get_uuid },\n\t{ \"Device\", \"o\", service_get_device },\n\t{ \"Primary\", \"b\", service_get_primary },\n\t{ \"Includes\", \"ao\", service_get_includes },\n\t{ }\n};\n\nstatic struct service *service_create(struct gatt_db_attribute *attr,\n\t\t\t\t\t\tstruct btd_gatt_client *client)\n{\n\tstruct service *service;\n\tconst char *device_path = device_get_path(client->device);\n\tbt_uuid_t uuid;\n\n\tservice = new0(struct service, 1);\n\tservice->chrcs = queue_new();\n\tservice->incl_services = queue_new();\n\tservice->client = client;\n\n\tgatt_db_attribute_get_service_data(attr, &service->start_handle,\n\t\t\t\t\t\t\t&service->end_handle,\n\t\t\t\t\t\t\t&service->primary,\n\t\t\t\t\t\t\t&uuid);\n\tbt_uuid_to_uuid128(&uuid, &service->uuid);\n\n\tservice->path = g_strdup_printf(\"%s/service%04x\", device_path,\n\t\t\t\t\t\t\tservice->start_handle);\n\n\tif (!g_dbus_register_interface(btd_get_dbus_connection(), service->path,\n\t\t\t\t\t\tGATT_SERVICE_IFACE,\n\t\t\t\t\t\tNULL, NULL,\n\t\t\t\t\t\tservice_properties,\n\t\t\t\t\t\tservice, service_free)) {\n\t\terror(\"Unable to register GATT service with handle 0x%04x for \"\n\t\t\t\t\t\t\t\"device %s\",\n\t\t\t\t\t\t\tservice->start_handle,\n\t\t\t\t\t\t\tclient->devaddr);\n\t\tservice_free(service);\n\n\t\treturn NULL;\n\t}\n\n\tDBG(\"Exported GATT service: %s\", service->path);\n\n\t/* Set service active so we can skip discovering next time */\n\tgatt_db_service_set_active(attr, true);\n\n\t/* Mark the service as claimed since it going to be exported */\n\tgatt_db_service_set_claimed(attr, true);\n\n\treturn service;\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_service_get_claimed",
          "args": [
            "attr"
          ],
          "line": 1982
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_service_get_claimed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1013-1019",
          "snippet": "bool gatt_db_service_get_claimed(struct gatt_db_attribute *attrib)\n{\n\tif (!attrib)\n\t\treturn false;\n\n\treturn attrib->service->claimed;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_service_get_claimed(struct gatt_db_attribute *attrib)\n{\n\tif (!attrib)\n\t\treturn false;\n\n\treturn attrib->service->claimed;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void export_service(struct gatt_db_attribute *attr, void *user_data)\n{\n\tstruct btd_gatt_client *client = user_data;\n\tstruct service *service;\n\n\tif (gatt_db_service_get_claimed(attr))\n\t\treturn;\n\n\tservice = service_create(attr, client);\n\tif (!service)\n\t\treturn;\n\n\tif (!create_characteristics(attr, service)) {\n\t\terror(\"Exporting characteristics failed\");\n\t\tunregister_service(service);\n\t\treturn;\n\t}\n\n\tqueue_push_tail(client->services, service);\n}"
  },
  {
    "function_name": "create_characteristics",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "1964-1975",
    "snippet": "static bool create_characteristics(struct gatt_db_attribute *attr,\n\t\t\t\t\t\tstruct service *service)\n{\n\tstruct export_data data;\n\n\tdata.root = service;\n\tdata.failed = false;\n\n\tgatt_db_service_foreach_char(attr, export_char, &data);\n\n\treturn !data.failed;\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "gatt_db_service_foreach_char",
          "args": [
            "attr",
            "export_char",
            "&data"
          ],
          "line": 1972
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_service_foreach_char",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1342-1347",
          "snippet": "void gatt_db_service_foreach_char(struct gatt_db_attribute *attrib,\n\t\t\t\t\t\tgatt_db_attribute_cb_t func,\n\t\t\t\t\t\tvoid *user_data)\n{\n\tgatt_db_service_foreach(attrib, &characteristic_uuid, func, user_data);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static const bt_uuid_t characteristic_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_CHARAC_UUID };"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic const bt_uuid_t characteristic_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_CHARAC_UUID };\n\nvoid gatt_db_service_foreach_char(struct gatt_db_attribute *attrib,\n\t\t\t\t\t\tgatt_db_attribute_cb_t func,\n\t\t\t\t\t\tvoid *user_data)\n{\n\tgatt_db_service_foreach(attrib, &characteristic_uuid, func, user_data);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic bool create_characteristics(struct gatt_db_attribute *attr,\n\t\t\t\t\t\tstruct service *service)\n{\n\tstruct export_data data;\n\n\tdata.root = service;\n\tdata.failed = false;\n\n\tgatt_db_service_foreach_char(attr, export_char, &data);\n\n\treturn !data.failed;\n}"
  },
  {
    "function_name": "export_char",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "1938-1962",
    "snippet": "static void export_char(struct gatt_db_attribute *attr, void *user_data)\n{\n\tstruct characteristic *charac;\n\tstruct export_data *data = user_data;\n\tstruct service *service = data->root;\n\n\tif (data->failed)\n\t\treturn;\n\n\tcharac = characteristic_create(attr, service);\n\tif (!charac)\n\t\tgoto fail;\n\n\tif (!create_descriptors(attr, charac)) {\n\t\tunregister_characteristic(charac);\n\t\tgoto fail;\n\t}\n\n\tqueue_push_tail(service->chrcs, charac);\n\n\treturn;\n\nfail:\n\tdata->failed = true;\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_push_tail",
          "args": [
            "service->chrcs",
            "charac"
          ],
          "line": 1956
        },
        "resolved": true,
        "details": {
          "function_name": "queue_push_tail",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "88-108",
          "snippet": "bool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "unregister_characteristic",
          "args": [
            "charac"
          ],
          "line": 1952
        },
        "resolved": true,
        "details": {
          "function_name": "unregister_characteristic",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "1728-1746",
          "snippet": "static void unregister_characteristic(void *data)\n{\n\tstruct characteristic *chrc = data;\n\tstruct bt_gatt_client *gatt = chrc->service->client->gatt;\n\n\tDBG(\"Removing GATT characteristic: %s\", chrc->path);\n\n\tif (chrc->read_op)\n\t\tbt_gatt_client_cancel(gatt, chrc->read_op->id);\n\n\tif (chrc->write_op)\n\t\tbt_gatt_client_cancel(gatt, chrc->write_op->id);\n\n\tqueue_remove_all(chrc->notify_clients, NULL, NULL, remove_client);\n\tqueue_remove_all(chrc->descs, NULL, NULL, unregister_descriptor);\n\n\tg_dbus_unregister_interface(btd_get_dbus_connection(), chrc->path,\n\t\t\t\t\t\tGATT_CHARACTERISTIC_IFACE);\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define GATT_CHARACTERISTIC_IFACE\t\"org.bluez.GattCharacteristic1\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\n#define GATT_CHARACTERISTIC_IFACE\t\"org.bluez.GattCharacteristic1\"\n\nstatic void unregister_characteristic(void *data)\n{\n\tstruct characteristic *chrc = data;\n\tstruct bt_gatt_client *gatt = chrc->service->client->gatt;\n\n\tDBG(\"Removing GATT characteristic: %s\", chrc->path);\n\n\tif (chrc->read_op)\n\t\tbt_gatt_client_cancel(gatt, chrc->read_op->id);\n\n\tif (chrc->write_op)\n\t\tbt_gatt_client_cancel(gatt, chrc->write_op->id);\n\n\tqueue_remove_all(chrc->notify_clients, NULL, NULL, remove_client);\n\tqueue_remove_all(chrc->descs, NULL, NULL, unregister_descriptor);\n\n\tg_dbus_unregister_interface(btd_get_dbus_connection(), chrc->path,\n\t\t\t\t\t\tGATT_CHARACTERISTIC_IFACE);\n}"
        }
      },
      {
        "call_info": {
          "callee": "create_descriptors",
          "args": [
            "attr",
            "charac"
          ],
          "line": 1951
        },
        "resolved": true,
        "details": {
          "function_name": "create_descriptors",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "1925-1936",
          "snippet": "static bool create_descriptors(struct gatt_db_attribute *attr,\n\t\t\t\t\tstruct characteristic *charac)\n{\n\tstruct export_data data;\n\n\tdata.root = charac;\n\tdata.failed = false;\n\n\tgatt_db_service_foreach_desc(attr, export_desc, &data);\n\n\treturn !data.failed;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic bool create_descriptors(struct gatt_db_attribute *attr,\n\t\t\t\t\tstruct characteristic *charac)\n{\n\tstruct export_data data;\n\n\tdata.root = charac;\n\tdata.failed = false;\n\n\tgatt_db_service_foreach_desc(attr, export_desc, &data);\n\n\treturn !data.failed;\n}"
        }
      },
      {
        "call_info": {
          "callee": "characteristic_create",
          "args": [
            "attr",
            "service"
          ],
          "line": 1947
        },
        "resolved": true,
        "details": {
          "function_name": "characteristic_create",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "1670-1716",
          "snippet": "static struct characteristic *characteristic_create(\n\t\t\t\t\t\tstruct gatt_db_attribute *attr,\n\t\t\t\t\t\tstruct service *service)\n{\n\tstruct characteristic *chrc;\n\tbt_uuid_t uuid;\n\n\tchrc = new0(struct characteristic, 1);\n\tchrc->descs = queue_new();\n\tchrc->notify_clients = queue_new();\n\tchrc->service = service;\n\n\tgatt_db_attribute_get_char_data(attr, &chrc->handle,\n\t\t\t\t\t\t\t&chrc->value_handle,\n\t\t\t\t\t\t\t&chrc->props,\n\t\t\t\t\t\t\t&chrc->ext_props,\n\t\t\t\t\t\t\t&uuid);\n\n\tchrc->attr = gatt_db_get_attribute(service->client->db,\n\t\t\t\t\t\t\tchrc->value_handle);\n\tif (!chrc->attr) {\n\t\terror(\"Attribute 0x%04x not found\", chrc->value_handle);\n\t\tcharacteristic_free(chrc);\n\t\treturn NULL;\n\t}\n\n\tbt_uuid_to_uuid128(&uuid, &chrc->uuid);\n\n\tchrc->path = g_strdup_printf(\"%s/char%04x\", service->path,\n\t\t\t\t\t\t\t\tchrc->handle);\n\n\tif (!g_dbus_register_interface(btd_get_dbus_connection(), chrc->path,\n\t\t\t\t\t\tGATT_CHARACTERISTIC_IFACE,\n\t\t\t\t\t\tcharacteristic_methods, NULL,\n\t\t\t\t\t\tcharacteristic_properties,\n\t\t\t\t\t\tchrc, characteristic_free)) {\n\t\terror(\"Unable to register GATT characteristic with handle \"\n\t\t\t\t\t\t\t\"0x%04x\", chrc->handle);\n\t\tcharacteristic_free(chrc);\n\n\t\treturn NULL;\n\t}\n\n\tDBG(\"Exported GATT characteristic: %s\", chrc->path);\n\n\treturn chrc;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define GATT_CHARACTERISTIC_IFACE\t\"org.bluez.GattCharacteristic1\""
          ],
          "globals_used": [
            "static const GDBusPropertyTable characteristic_properties[] = {\n\t{ \"UUID\", \"s\", characteristic_get_uuid, NULL, NULL },\n\t{ \"Service\", \"o\", characteristic_get_service, NULL, NULL },\n\t{ \"Value\", \"ay\", characteristic_get_value, NULL,\n\t\t\t\t\tcharacteristic_value_exists },\n\t{ \"Notifying\", \"b\", characteristic_get_notifying, NULL,\n\t\t\t\t\tcharacteristic_notifying_exists },\n\t{ \"Flags\", \"as\", characteristic_get_flags, NULL, NULL },\n\t{ \"WriteAcquired\", \"b\", characteristic_get_write_acquired, NULL,\n\t\t\t\tcharacteristic_write_acquired_exists },\n\t{ \"NotifyAcquired\", \"b\", characteristic_get_notify_acquired, NULL,\n\t\t\t\tcharacteristic_notify_acquired_exists },\n\t{ }\n};",
            "static const GDBusMethodTable characteristic_methods[] = {\n\t{ GDBUS_ASYNC_METHOD(\"ReadValue\", GDBUS_ARGS({ \"options\", \"a{sv}\" }),\n\t\t\t\t\tGDBUS_ARGS({ \"value\", \"ay\" }),\n\t\t\t\t\tcharacteristic_read_value) },\n\t{ GDBUS_ASYNC_METHOD(\"WriteValue\", GDBUS_ARGS({ \"value\", \"ay\" },\n\t\t\t\t\t\t{ \"options\", \"a{sv}\" }),\n\t\t\t\t\tNULL,\n\t\t\t\t\tcharacteristic_write_value) },\n\t{ GDBUS_ASYNC_METHOD(\"AcquireWrite\",\n\t\t\t\t\tGDBUS_ARGS({ \"options\", \"a{sv}\" }),\n\t\t\t\t\tGDBUS_ARGS({ \"fd\", \"h\" },\n\t\t\t\t\t\t{ \"mtu\", \"q\" }),\n\t\t\t\t\tcharacteristic_acquire_write) },\n\t{ GDBUS_ASYNC_METHOD(\"AcquireNotify\",\n\t\t\t\t\tGDBUS_ARGS({ \"options\", \"a{sv}\" }),\n\t\t\t\t\tGDBUS_ARGS({ \"fd\", \"h\" },\n\t\t\t\t\t\t{ \"mtu\", \"q\" }),\n\t\t\t\t\tcharacteristic_acquire_notify) },\n\t{ GDBUS_ASYNC_METHOD(\"StartNotify\", NULL, NULL,\n\t\t\t\t\tcharacteristic_start_notify) },\n\t{ GDBUS_METHOD(\"StopNotify\", NULL, NULL,\n\t\t\t\t\tcharacteristic_stop_notify) },\n\t{ }\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\n#define GATT_CHARACTERISTIC_IFACE\t\"org.bluez.GattCharacteristic1\"\n\nstatic const GDBusPropertyTable characteristic_properties[] = {\n\t{ \"UUID\", \"s\", characteristic_get_uuid, NULL, NULL },\n\t{ \"Service\", \"o\", characteristic_get_service, NULL, NULL },\n\t{ \"Value\", \"ay\", characteristic_get_value, NULL,\n\t\t\t\t\tcharacteristic_value_exists },\n\t{ \"Notifying\", \"b\", characteristic_get_notifying, NULL,\n\t\t\t\t\tcharacteristic_notifying_exists },\n\t{ \"Flags\", \"as\", characteristic_get_flags, NULL, NULL },\n\t{ \"WriteAcquired\", \"b\", characteristic_get_write_acquired, NULL,\n\t\t\t\tcharacteristic_write_acquired_exists },\n\t{ \"NotifyAcquired\", \"b\", characteristic_get_notify_acquired, NULL,\n\t\t\t\tcharacteristic_notify_acquired_exists },\n\t{ }\n};\nstatic const GDBusMethodTable characteristic_methods[] = {\n\t{ GDBUS_ASYNC_METHOD(\"ReadValue\", GDBUS_ARGS({ \"options\", \"a{sv}\" }),\n\t\t\t\t\tGDBUS_ARGS({ \"value\", \"ay\" }),\n\t\t\t\t\tcharacteristic_read_value) },\n\t{ GDBUS_ASYNC_METHOD(\"WriteValue\", GDBUS_ARGS({ \"value\", \"ay\" },\n\t\t\t\t\t\t{ \"options\", \"a{sv}\" }),\n\t\t\t\t\tNULL,\n\t\t\t\t\tcharacteristic_write_value) },\n\t{ GDBUS_ASYNC_METHOD(\"AcquireWrite\",\n\t\t\t\t\tGDBUS_ARGS({ \"options\", \"a{sv}\" }),\n\t\t\t\t\tGDBUS_ARGS({ \"fd\", \"h\" },\n\t\t\t\t\t\t{ \"mtu\", \"q\" }),\n\t\t\t\t\tcharacteristic_acquire_write) },\n\t{ GDBUS_ASYNC_METHOD(\"AcquireNotify\",\n\t\t\t\t\tGDBUS_ARGS({ \"options\", \"a{sv}\" }),\n\t\t\t\t\tGDBUS_ARGS({ \"fd\", \"h\" },\n\t\t\t\t\t\t{ \"mtu\", \"q\" }),\n\t\t\t\t\tcharacteristic_acquire_notify) },\n\t{ GDBUS_ASYNC_METHOD(\"StartNotify\", NULL, NULL,\n\t\t\t\t\tcharacteristic_start_notify) },\n\t{ GDBUS_METHOD(\"StopNotify\", NULL, NULL,\n\t\t\t\t\tcharacteristic_stop_notify) },\n\t{ }\n};\n\nstatic struct characteristic *characteristic_create(\n\t\t\t\t\t\tstruct gatt_db_attribute *attr,\n\t\t\t\t\t\tstruct service *service)\n{\n\tstruct characteristic *chrc;\n\tbt_uuid_t uuid;\n\n\tchrc = new0(struct characteristic, 1);\n\tchrc->descs = queue_new();\n\tchrc->notify_clients = queue_new();\n\tchrc->service = service;\n\n\tgatt_db_attribute_get_char_data(attr, &chrc->handle,\n\t\t\t\t\t\t\t&chrc->value_handle,\n\t\t\t\t\t\t\t&chrc->props,\n\t\t\t\t\t\t\t&chrc->ext_props,\n\t\t\t\t\t\t\t&uuid);\n\n\tchrc->attr = gatt_db_get_attribute(service->client->db,\n\t\t\t\t\t\t\tchrc->value_handle);\n\tif (!chrc->attr) {\n\t\terror(\"Attribute 0x%04x not found\", chrc->value_handle);\n\t\tcharacteristic_free(chrc);\n\t\treturn NULL;\n\t}\n\n\tbt_uuid_to_uuid128(&uuid, &chrc->uuid);\n\n\tchrc->path = g_strdup_printf(\"%s/char%04x\", service->path,\n\t\t\t\t\t\t\t\tchrc->handle);\n\n\tif (!g_dbus_register_interface(btd_get_dbus_connection(), chrc->path,\n\t\t\t\t\t\tGATT_CHARACTERISTIC_IFACE,\n\t\t\t\t\t\tcharacteristic_methods, NULL,\n\t\t\t\t\t\tcharacteristic_properties,\n\t\t\t\t\t\tchrc, characteristic_free)) {\n\t\terror(\"Unable to register GATT characteristic with handle \"\n\t\t\t\t\t\t\t\"0x%04x\", chrc->handle);\n\t\tcharacteristic_free(chrc);\n\n\t\treturn NULL;\n\t}\n\n\tDBG(\"Exported GATT characteristic: %s\", chrc->path);\n\n\treturn chrc;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void export_char(struct gatt_db_attribute *attr, void *user_data)\n{\n\tstruct characteristic *charac;\n\tstruct export_data *data = user_data;\n\tstruct service *service = data->root;\n\n\tif (data->failed)\n\t\treturn;\n\n\tcharac = characteristic_create(attr, service);\n\tif (!charac)\n\t\tgoto fail;\n\n\tif (!create_descriptors(attr, charac)) {\n\t\tunregister_characteristic(charac);\n\t\tgoto fail;\n\t}\n\n\tqueue_push_tail(service->chrcs, charac);\n\n\treturn;\n\nfail:\n\tdata->failed = true;\n}"
  },
  {
    "function_name": "create_descriptors",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "1925-1936",
    "snippet": "static bool create_descriptors(struct gatt_db_attribute *attr,\n\t\t\t\t\tstruct characteristic *charac)\n{\n\tstruct export_data data;\n\n\tdata.root = charac;\n\tdata.failed = false;\n\n\tgatt_db_service_foreach_desc(attr, export_desc, &data);\n\n\treturn !data.failed;\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "gatt_db_service_foreach_desc",
          "args": [
            "attr",
            "export_desc",
            "&data"
          ],
          "line": 1933
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_service_foreach_desc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1349-1386",
          "snippet": "void gatt_db_service_foreach_desc(struct gatt_db_attribute *attrib,\n\t\t\t\t\t\tgatt_db_attribute_cb_t func,\n\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct gatt_db_service *service;\n\tstruct gatt_db_attribute *attr;\n\tuint16_t i;\n\n\tif (!attrib || !func)\n\t\treturn;\n\n\t/* Return if this attribute is not a characteristic declaration */\n\tif (bt_uuid_cmp(&characteristic_uuid, &attrib->uuid))\n\t\treturn;\n\n\tservice = attrib->service;\n\n\t/* Start from the attribute following the value handle */\n\tfor (i = 0; i < service->num_handles; i++) {\n\t\tif (service->attributes[i] == attrib) {\n\t\t\ti += 2;\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tfor (; i < service->num_handles; i++) {\n\t\tattr = service->attributes[i];\n\t\tif (!attr)\n\t\t\tcontinue;\n\n\t\t/* Return if we reached the end of this characteristic */\n\t\tif (!bt_uuid_cmp(&characteristic_uuid, &attr->uuid) ||\n\t\t\t!bt_uuid_cmp(&included_service_uuid, &attr->uuid))\n\t\t\treturn;\n\n\t\tfunc(attr, user_data);\n\t}\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static const bt_uuid_t characteristic_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_CHARAC_UUID };",
            "static const bt_uuid_t included_service_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_INCLUDE_UUID };"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic const bt_uuid_t characteristic_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_CHARAC_UUID };\nstatic const bt_uuid_t included_service_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_INCLUDE_UUID };\n\nvoid gatt_db_service_foreach_desc(struct gatt_db_attribute *attrib,\n\t\t\t\t\t\tgatt_db_attribute_cb_t func,\n\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct gatt_db_service *service;\n\tstruct gatt_db_attribute *attr;\n\tuint16_t i;\n\n\tif (!attrib || !func)\n\t\treturn;\n\n\t/* Return if this attribute is not a characteristic declaration */\n\tif (bt_uuid_cmp(&characteristic_uuid, &attrib->uuid))\n\t\treturn;\n\n\tservice = attrib->service;\n\n\t/* Start from the attribute following the value handle */\n\tfor (i = 0; i < service->num_handles; i++) {\n\t\tif (service->attributes[i] == attrib) {\n\t\t\ti += 2;\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tfor (; i < service->num_handles; i++) {\n\t\tattr = service->attributes[i];\n\t\tif (!attr)\n\t\t\tcontinue;\n\n\t\t/* Return if we reached the end of this characteristic */\n\t\tif (!bt_uuid_cmp(&characteristic_uuid, &attr->uuid) ||\n\t\t\t!bt_uuid_cmp(&included_service_uuid, &attr->uuid))\n\t\t\treturn;\n\n\t\tfunc(attr, user_data);\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic bool create_descriptors(struct gatt_db_attribute *attr,\n\t\t\t\t\tstruct characteristic *charac)\n{\n\tstruct export_data data;\n\n\tdata.root = charac;\n\tdata.failed = false;\n\n\tgatt_db_service_foreach_desc(attr, export_desc, &data);\n\n\treturn !data.failed;\n}"
  },
  {
    "function_name": "export_desc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "1907-1923",
    "snippet": "static void export_desc(struct gatt_db_attribute *attr, void *user_data)\n{\n\tstruct descriptor *desc;\n\tstruct export_data *data = user_data;\n\tstruct characteristic *charac = data->root;\n\n\tif (data->failed)\n\t\treturn;\n\n\tdesc = descriptor_create(attr, charac);\n\tif (!desc) {\n\t\tdata->failed = true;\n\t\treturn;\n\t}\n\n\tqueue_push_tail(charac->descs, desc);\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_push_tail",
          "args": [
            "charac->descs",
            "desc"
          ],
          "line": 1922
        },
        "resolved": true,
        "details": {
          "function_name": "queue_push_tail",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "88-108",
          "snippet": "bool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "descriptor_create",
          "args": [
            "attr",
            "charac"
          ],
          "line": 1916
        },
        "resolved": true,
        "details": {
          "function_name": "descriptor_create",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "659-691",
          "snippet": "static struct descriptor *descriptor_create(struct gatt_db_attribute *attr,\n\t\t\t\t\t\tstruct characteristic *chrc)\n{\n\tstruct descriptor *desc;\n\n\tdesc = new0(struct descriptor, 1);\n\tdesc->chrc = chrc;\n\tdesc->attr = attr;\n\tdesc->handle = gatt_db_attribute_get_handle(attr);\n\n\tbt_uuid_to_uuid128(gatt_db_attribute_get_type(attr), &desc->uuid);\n\n\tdesc->path = g_strdup_printf(\"%s/desc%04x\", chrc->path, desc->handle);\n\n\tif (!g_dbus_register_interface(btd_get_dbus_connection(), desc->path,\n\t\t\t\t\t\tGATT_DESCRIPTOR_IFACE,\n\t\t\t\t\t\tdescriptor_methods, NULL,\n\t\t\t\t\t\tdescriptor_properties,\n\t\t\t\t\t\tdesc, descriptor_free)) {\n\t\terror(\"Unable to register GATT descriptor with handle 0x%04x\",\n\t\t\t\t\t\t\t\tdesc->handle);\n\t\tdescriptor_free(desc);\n\n\t\treturn NULL;\n\t}\n\n\tDBG(\"Exported GATT characteristic descriptor: %s\", desc->path);\n\n\tif (uuid_cmp(&desc->uuid, GATT_CHARAC_EXT_PROPER_UUID))\n\t\tchrc->ext_props_handle = desc->handle;\n\n\treturn desc;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define GATT_DESCRIPTOR_IFACE\t\t\"org.bluez.GattDescriptor1\""
          ],
          "globals_used": [
            "static const GDBusPropertyTable descriptor_properties[] = {\n\t{ \"UUID\", \"s\", descriptor_get_uuid },\n\t{ \"Characteristic\", \"o\", descriptor_get_characteristic, },\n\t{ \"Value\", \"ay\", descriptor_get_value, NULL, descriptor_value_exists },\n\t{ }\n};",
            "static const GDBusMethodTable descriptor_methods[] = {\n\t{ GDBUS_ASYNC_METHOD(\"ReadValue\", GDBUS_ARGS({ \"options\", \"a{sv}\" }),\n\t\t\t\t\tGDBUS_ARGS({ \"value\", \"ay\" }),\n\t\t\t\t\tdescriptor_read_value) },\n\t{ GDBUS_ASYNC_METHOD(\"WriteValue\", GDBUS_ARGS({ \"value\", \"ay\" },\n\t\t\t\t\t\t{ \"options\", \"a{sv}\" }),\n\t\t\t\t\tNULL,\n\t\t\t\t\tdescriptor_write_value) },\n\t{ }\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\n#define GATT_DESCRIPTOR_IFACE\t\t\"org.bluez.GattDescriptor1\"\n\nstatic const GDBusPropertyTable descriptor_properties[] = {\n\t{ \"UUID\", \"s\", descriptor_get_uuid },\n\t{ \"Characteristic\", \"o\", descriptor_get_characteristic, },\n\t{ \"Value\", \"ay\", descriptor_get_value, NULL, descriptor_value_exists },\n\t{ }\n};\nstatic const GDBusMethodTable descriptor_methods[] = {\n\t{ GDBUS_ASYNC_METHOD(\"ReadValue\", GDBUS_ARGS({ \"options\", \"a{sv}\" }),\n\t\t\t\t\tGDBUS_ARGS({ \"value\", \"ay\" }),\n\t\t\t\t\tdescriptor_read_value) },\n\t{ GDBUS_ASYNC_METHOD(\"WriteValue\", GDBUS_ARGS({ \"value\", \"ay\" },\n\t\t\t\t\t\t{ \"options\", \"a{sv}\" }),\n\t\t\t\t\tNULL,\n\t\t\t\t\tdescriptor_write_value) },\n\t{ }\n};\n\nstatic struct descriptor *descriptor_create(struct gatt_db_attribute *attr,\n\t\t\t\t\t\tstruct characteristic *chrc)\n{\n\tstruct descriptor *desc;\n\n\tdesc = new0(struct descriptor, 1);\n\tdesc->chrc = chrc;\n\tdesc->attr = attr;\n\tdesc->handle = gatt_db_attribute_get_handle(attr);\n\n\tbt_uuid_to_uuid128(gatt_db_attribute_get_type(attr), &desc->uuid);\n\n\tdesc->path = g_strdup_printf(\"%s/desc%04x\", chrc->path, desc->handle);\n\n\tif (!g_dbus_register_interface(btd_get_dbus_connection(), desc->path,\n\t\t\t\t\t\tGATT_DESCRIPTOR_IFACE,\n\t\t\t\t\t\tdescriptor_methods, NULL,\n\t\t\t\t\t\tdescriptor_properties,\n\t\t\t\t\t\tdesc, descriptor_free)) {\n\t\terror(\"Unable to register GATT descriptor with handle 0x%04x\",\n\t\t\t\t\t\t\t\tdesc->handle);\n\t\tdescriptor_free(desc);\n\n\t\treturn NULL;\n\t}\n\n\tDBG(\"Exported GATT characteristic descriptor: %s\", desc->path);\n\n\tif (uuid_cmp(&desc->uuid, GATT_CHARAC_EXT_PROPER_UUID))\n\t\tchrc->ext_props_handle = desc->handle;\n\n\treturn desc;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void export_desc(struct gatt_db_attribute *attr, void *user_data)\n{\n\tstruct descriptor *desc;\n\tstruct export_data *data = user_data;\n\tstruct characteristic *charac = data->root;\n\n\tif (data->failed)\n\t\treturn;\n\n\tdesc = descriptor_create(attr, charac);\n\tif (!desc) {\n\t\tdata->failed = true;\n\t\treturn;\n\t}\n\n\tqueue_push_tail(charac->descs, desc);\n}"
  },
  {
    "function_name": "unregister_service",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "1886-1900",
    "snippet": "static void unregister_service(void *data)\n{\n\tstruct service *service = data;\n\tstruct btd_gatt_client *client = service->client;\n\n\tDBG(\"Removing GATT service: %s\", service->path);\n\n\tqueue_remove_all(service->chrcs, NULL, NULL, unregister_characteristic);\n\tqueue_remove_all(service->incl_services, NULL, NULL, NULL);\n\n\tqueue_foreach(client->services, on_service_removed, service);\n\n\tg_dbus_unregister_interface(btd_get_dbus_connection(), service->path,\n\t\t\t\t\t\t\tGATT_SERVICE_IFACE);\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define GATT_SERVICE_IFACE\t\t\"org.bluez.GattService1\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_dbus_unregister_interface",
          "args": [
            "btd_get_dbus_connection()",
            "service->path",
            "GATT_SERVICE_IFACE"
          ],
          "line": 1898
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_get_dbus_connection",
          "args": [],
          "line": 1898
        },
        "resolved": true,
        "details": {
          "function_name": "btd_get_dbus_connection",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/dbus-common.c",
          "lines": "61-64",
          "snippet": "DBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *connection = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *connection = NULL;\n\nDBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_foreach",
          "args": [
            "client->services",
            "on_service_removed",
            "service"
          ],
          "line": 1896
        },
        "resolved": true,
        "details": {
          "function_name": "queue_foreach",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "203-224",
          "snippet": "void queue_foreach(struct queue *queue, queue_foreach_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue || !function)\n\t\treturn;\n\n\tentry = queue->head;\n\tif (!entry)\n\t\treturn;\n\n\tqueue_ref(queue);\n\twhile (entry && queue->head && queue->ref_count > 1) {\n\t\tstruct queue_entry *next;\n\n\t\tnext = entry->next;\n\t\tfunction(entry->data, user_data);\n\t\tentry = next;\n\t}\n\tqueue_unref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid queue_foreach(struct queue *queue, queue_foreach_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue || !function)\n\t\treturn;\n\n\tentry = queue->head;\n\tif (!entry)\n\t\treturn;\n\n\tqueue_ref(queue);\n\twhile (entry && queue->head && queue->ref_count > 1) {\n\t\tstruct queue_entry *next;\n\n\t\tnext = entry->next;\n\t\tfunction(entry->data, user_data);\n\t\tentry = next;\n\t}\n\tqueue_unref(queue);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_remove_all",
          "args": [
            "service->incl_services",
            "NULL",
            "NULL",
            "NULL"
          ],
          "line": 1894
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_all",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "318-362",
          "snippet": "unsigned int queue_remove_all(struct queue *queue, queue_match_func_t function,\n\t\t\t\tvoid *user_data, queue_destroy_func_t destroy)\n{\n\tstruct queue_entry *entry;\n\tunsigned int count = 0;\n\n\tif (!queue)\n\t\treturn 0;\n\n\tentry = queue->head;\n\n\tif (function) {\n\t\twhile (entry) {\n\t\t\tvoid *data;\n\t\t\tunsigned int entries = queue->entries;\n\n\t\t\tdata = queue_remove_if(queue, function, user_data);\n\t\t\tif (entries == queue->entries)\n\t\t\t\tbreak;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(data);\n\n\t\t\tcount++;\n\t\t}\n\t} else {\n\t\tqueue->head = NULL;\n\t\tqueue->tail = NULL;\n\t\tqueue->entries = 0;\n\n\t\twhile (entry) {\n\t\t\tstruct queue_entry *tmp = entry;\n\n\t\t\tentry = entry->next;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(tmp->data);\n\n\t\t\tfree(tmp);\n\t\t\tcount++;\n\t\t}\n\t}\n\n\treturn count;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nunsigned int queue_remove_all(struct queue *queue, queue_match_func_t function,\n\t\t\t\tvoid *user_data, queue_destroy_func_t destroy)\n{\n\tstruct queue_entry *entry;\n\tunsigned int count = 0;\n\n\tif (!queue)\n\t\treturn 0;\n\n\tentry = queue->head;\n\n\tif (function) {\n\t\twhile (entry) {\n\t\t\tvoid *data;\n\t\t\tunsigned int entries = queue->entries;\n\n\t\t\tdata = queue_remove_if(queue, function, user_data);\n\t\t\tif (entries == queue->entries)\n\t\t\t\tbreak;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(data);\n\n\t\t\tcount++;\n\t\t}\n\t} else {\n\t\tqueue->head = NULL;\n\t\tqueue->tail = NULL;\n\t\tqueue->entries = 0;\n\n\t\twhile (entry) {\n\t\t\tstruct queue_entry *tmp = entry;\n\n\t\t\tentry = entry->next;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(tmp->data);\n\n\t\t\tfree(tmp);\n\t\t\tcount++;\n\t\t}\n\t}\n\n\treturn count;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Removing GATT service: %s\"",
            "service->path"
          ],
          "line": 1891
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\n#define GATT_SERVICE_IFACE\t\t\"org.bluez.GattService1\"\n\nstatic void unregister_service(void *data)\n{\n\tstruct service *service = data;\n\tstruct btd_gatt_client *client = service->client;\n\n\tDBG(\"Removing GATT service: %s\", service->path);\n\n\tqueue_remove_all(service->chrcs, NULL, NULL, unregister_characteristic);\n\tqueue_remove_all(service->incl_services, NULL, NULL, NULL);\n\n\tqueue_foreach(client->services, on_service_removed, service);\n\n\tg_dbus_unregister_interface(btd_get_dbus_connection(), service->path,\n\t\t\t\t\t\t\tGATT_SERVICE_IFACE);\n}"
  },
  {
    "function_name": "on_service_removed",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "1874-1884",
    "snippet": "static void on_service_removed(void *data, void *user_data)\n{\n\tstruct service *service = data;\n\tstruct service *removed_service = user_data;\n\n\tif (queue_remove(service->incl_services, removed_service))\n\t\tg_dbus_emit_property_changed(btd_get_dbus_connection(),\n\t\t\t\t\t\t\tservice->path,\n\t\t\t\t\t\t\tGATT_SERVICE_IFACE,\n\t\t\t\t\t\t\t\"Includes\");\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define GATT_SERVICE_IFACE\t\t\"org.bluez.GattService1\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_dbus_emit_property_changed",
          "args": [
            "btd_get_dbus_connection()",
            "service->path",
            "GATT_SERVICE_IFACE",
            "\"Includes\""
          ],
          "line": 1880
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_get_dbus_connection",
          "args": [],
          "line": 1880
        },
        "resolved": true,
        "details": {
          "function_name": "btd_get_dbus_connection",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/dbus-common.c",
          "lines": "61-64",
          "snippet": "DBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *connection = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *connection = NULL;\n\nDBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_remove",
          "args": [
            "service->incl_services",
            "removed_service"
          ],
          "line": 1879
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_uuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "526-541",
          "snippet": "static bool queue_remove_uuid(struct queue *queue, bt_uuid_t *uuid)\n{\n\tbt_uuid_t *removed;\n\n\tif (!queue || !uuid)\n\t\treturn false;\n\n\tremoved = queue_remove_if(queue, uuid_match, uuid);\n\n\tif (removed) {\n\t\tfree(removed);\n\t\treturn true;\n\t}\n\n\treturn false;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic bool queue_remove_uuid(struct queue *queue, bt_uuid_t *uuid)\n{\n\tbt_uuid_t *removed;\n\n\tif (!queue || !uuid)\n\t\treturn false;\n\n\tremoved = queue_remove_if(queue, uuid_match, uuid);\n\n\tif (removed) {\n\t\tfree(removed);\n\t\treturn true;\n\t}\n\n\treturn false;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\n#define GATT_SERVICE_IFACE\t\t\"org.bluez.GattService1\"\n\nstatic void on_service_removed(void *data, void *user_data)\n{\n\tstruct service *service = data;\n\tstruct service *removed_service = user_data;\n\n\tif (queue_remove(service->incl_services, removed_service))\n\t\tg_dbus_emit_property_changed(btd_get_dbus_connection(),\n\t\t\t\t\t\t\tservice->path,\n\t\t\t\t\t\t\tGATT_SERVICE_IFACE,\n\t\t\t\t\t\t\t\"Includes\");\n}"
  },
  {
    "function_name": "service_create",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "1828-1872",
    "snippet": "static struct service *service_create(struct gatt_db_attribute *attr,\n\t\t\t\t\t\tstruct btd_gatt_client *client)\n{\n\tstruct service *service;\n\tconst char *device_path = device_get_path(client->device);\n\tbt_uuid_t uuid;\n\n\tservice = new0(struct service, 1);\n\tservice->chrcs = queue_new();\n\tservice->incl_services = queue_new();\n\tservice->client = client;\n\n\tgatt_db_attribute_get_service_data(attr, &service->start_handle,\n\t\t\t\t\t\t\t&service->end_handle,\n\t\t\t\t\t\t\t&service->primary,\n\t\t\t\t\t\t\t&uuid);\n\tbt_uuid_to_uuid128(&uuid, &service->uuid);\n\n\tservice->path = g_strdup_printf(\"%s/service%04x\", device_path,\n\t\t\t\t\t\t\tservice->start_handle);\n\n\tif (!g_dbus_register_interface(btd_get_dbus_connection(), service->path,\n\t\t\t\t\t\tGATT_SERVICE_IFACE,\n\t\t\t\t\t\tNULL, NULL,\n\t\t\t\t\t\tservice_properties,\n\t\t\t\t\t\tservice, service_free)) {\n\t\terror(\"Unable to register GATT service with handle 0x%04x for \"\n\t\t\t\t\t\t\t\"device %s\",\n\t\t\t\t\t\t\tservice->start_handle,\n\t\t\t\t\t\t\tclient->devaddr);\n\t\tservice_free(service);\n\n\t\treturn NULL;\n\t}\n\n\tDBG(\"Exported GATT service: %s\", service->path);\n\n\t/* Set service active so we can skip discovering next time */\n\tgatt_db_service_set_active(attr, true);\n\n\t/* Mark the service as claimed since it going to be exported */\n\tgatt_db_service_set_claimed(attr, true);\n\n\treturn service;\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define GATT_SERVICE_IFACE\t\t\"org.bluez.GattService1\""
    ],
    "globals_used": [
      "static const GDBusPropertyTable service_properties[] = {\n\t{ \"UUID\", \"s\", service_get_uuid },\n\t{ \"Device\", \"o\", service_get_device },\n\t{ \"Primary\", \"b\", service_get_primary },\n\t{ \"Includes\", \"ao\", service_get_includes },\n\t{ }\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "gatt_db_service_set_claimed",
          "args": [
            "attr",
            "true"
          ],
          "line": 1869
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_service_set_claimed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1002-1011",
          "snippet": "bool gatt_db_service_set_claimed(struct gatt_db_attribute *attrib,\n\t\t\t\t\t\t\t\tbool claimed)\n{\n\tif (!attrib)\n\t\treturn false;\n\n\tattrib->service->claimed = claimed;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_service_set_claimed(struct gatt_db_attribute *attrib,\n\t\t\t\t\t\t\t\tbool claimed)\n{\n\tif (!attrib)\n\t\treturn false;\n\n\tattrib->service->claimed = claimed;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_service_set_active",
          "args": [
            "attr",
            "true"
          ],
          "line": 1866
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_service_set_active",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "975-992",
          "snippet": "bool gatt_db_service_set_active(struct gatt_db_attribute *attrib, bool active)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!attrib)\n\t\treturn false;\n\n\tservice = attrib->service;\n\n\tif (service->active == active)\n\t\treturn true;\n\n\tservice->active = active;\n\n\tnotify_service_changed(service->db, service, active);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_service_set_active(struct gatt_db_attribute *attrib, bool active)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!attrib)\n\t\treturn false;\n\n\tservice = attrib->service;\n\n\tif (service->active == active)\n\t\treturn true;\n\n\tservice->active = active;\n\n\tnotify_service_changed(service->db, service, active);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Exported GATT service: %s\"",
            "service->path"
          ],
          "line": 1863
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "service_free",
          "args": [
            "service"
          ],
          "line": 1858
        },
        "resolved": true,
        "details": {
          "function_name": "service_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "1818-1826",
          "snippet": "static void service_free(void *data)\n{\n\tstruct service *service = data;\n\n\tqueue_destroy(service->chrcs, NULL);  /* List should be empty here */\n\tqueue_destroy(service->incl_services, NULL);\n\tg_free(service->path);\n\tfree(service);\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void service_free(void *data)\n{\n\tstruct service *service = data;\n\n\tqueue_destroy(service->chrcs, NULL);  /* List should be empty here */\n\tqueue_destroy(service->incl_services, NULL);\n\tg_free(service->path);\n\tfree(service);\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Unable to register GATT service with handle 0x%04x for \"\n\t\t\t\t\t\t\t\"device %s\"",
            "service->start_handle",
            "client->devaddr"
          ],
          "line": 1854
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/log.c",
          "lines": "199-213",
          "snippet": "void btd_error(uint16_t index, const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_ERR, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(index, LOG_ERR, format, ap);\n\tva_end(ap);\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdarg.h>",
            "#include <syslog.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int logging_fd = -1;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"src/shared/util.h\"\n#include \"lib/hci.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int logging_fd = -1;\n\nvoid btd_error(uint16_t index, const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_ERR, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(index, LOG_ERR, format, ap);\n\tva_end(ap);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_register_interface",
          "args": [
            "btd_get_dbus_connection()",
            "service->path",
            "GATT_SERVICE_IFACE",
            "NULL",
            "NULL",
            "service_properties",
            "service",
            "service_free"
          ],
          "line": 1849
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_get_dbus_connection",
          "args": [],
          "line": 1849
        },
        "resolved": true,
        "details": {
          "function_name": "btd_get_dbus_connection",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/dbus-common.c",
          "lines": "61-64",
          "snippet": "DBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *connection = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *connection = NULL;\n\nDBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"%s/service%04x\"",
            "device_path",
            "service->start_handle"
          ],
          "line": 1846
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_uuid_to_uuid128",
          "args": [
            "&uuid",
            "&service->uuid"
          ],
          "line": 1844
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gatt_db_attribute_get_service_data",
          "args": [
            "attr",
            "&service->start_handle",
            "&service->end_handle",
            "&service->primary",
            "&uuid"
          ],
          "line": 1840
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_get_service_data",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1538-1566",
          "snippet": "bool gatt_db_attribute_get_service_data(const struct gatt_db_attribute *attrib,\n\t\t\t\t\t\t\tuint16_t *start_handle,\n\t\t\t\t\t\t\tuint16_t *end_handle,\n\t\t\t\t\t\t\tbool *primary,\n\t\t\t\t\t\t\tbt_uuid_t *uuid)\n{\n\tstruct gatt_db_service *service;\n\tstruct gatt_db_attribute *decl;\n\n\tif (!attrib)\n\t\treturn false;\n\n\tservice = attrib->service;\n\tdecl = service->attributes[0];\n\n\tgatt_db_service_get_handles(service, start_handle, end_handle);\n\n\tif (primary)\n\t\t*primary = bt_uuid_cmp(&decl->uuid, &secondary_service_uuid);\n\n\tif (!uuid)\n\t\treturn true;\n\n\t/*\n\t * The service declaration attribute value is the 16 or 128 bit service\n\t * UUID.\n\t */\n\treturn le_to_uuid(decl->value, decl->value_len, uuid);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static const bt_uuid_t secondary_service_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_SND_SVC_UUID };"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic const bt_uuid_t secondary_service_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_SND_SVC_UUID };\n\nbool gatt_db_attribute_get_service_data(const struct gatt_db_attribute *attrib,\n\t\t\t\t\t\t\tuint16_t *start_handle,\n\t\t\t\t\t\t\tuint16_t *end_handle,\n\t\t\t\t\t\t\tbool *primary,\n\t\t\t\t\t\t\tbt_uuid_t *uuid)\n{\n\tstruct gatt_db_service *service;\n\tstruct gatt_db_attribute *decl;\n\n\tif (!attrib)\n\t\treturn false;\n\n\tservice = attrib->service;\n\tdecl = service->attributes[0];\n\n\tgatt_db_service_get_handles(service, start_handle, end_handle);\n\n\tif (primary)\n\t\t*primary = bt_uuid_cmp(&decl->uuid, &secondary_service_uuid);\n\n\tif (!uuid)\n\t\treturn true;\n\n\t/*\n\t * The service declaration attribute value is the 16 or 128 bit service\n\t * UUID.\n\t */\n\treturn le_to_uuid(decl->value, decl->value_len, uuid);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_new",
          "args": [],
          "line": 1837
        },
        "resolved": true,
        "details": {
          "function_name": "queue_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "56-66",
          "snippet": "struct queue *queue_new(void)\n{\n\tstruct queue *queue;\n\n\tqueue = new0(struct queue, 1);\n\tqueue->head = NULL;\n\tqueue->tail = NULL;\n\tqueue->entries = 0;\n\n\treturn queue_ref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nstruct queue *queue_new(void)\n{\n\tstruct queue *queue;\n\n\tqueue = new0(struct queue, 1);\n\tqueue->head = NULL;\n\tqueue->tail = NULL;\n\tqueue->entries = 0;\n\n\treturn queue_ref(queue);\n}"
        }
      },
      {
        "call_info": {
          "callee": "new0",
          "args": [
            "structservice",
            "1"
          ],
          "line": 1835
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device_get_path",
          "args": [
            "client->device"
          ],
          "line": 1832
        },
        "resolved": true,
        "details": {
          "function_name": "device_get_path",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5323-5329",
          "snippet": "const char *device_get_path(const struct btd_device *device)\n{\n\tif (!device)\n\t\treturn NULL;\n\n\treturn device->path;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nconst char *device_get_path(const struct btd_device *device)\n{\n\tif (!device)\n\t\treturn NULL;\n\n\treturn device->path;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\n#define GATT_SERVICE_IFACE\t\t\"org.bluez.GattService1\"\n\nstatic const GDBusPropertyTable service_properties[] = {\n\t{ \"UUID\", \"s\", service_get_uuid },\n\t{ \"Device\", \"o\", service_get_device },\n\t{ \"Primary\", \"b\", service_get_primary },\n\t{ \"Includes\", \"ao\", service_get_includes },\n\t{ }\n};\n\nstatic struct service *service_create(struct gatt_db_attribute *attr,\n\t\t\t\t\t\tstruct btd_gatt_client *client)\n{\n\tstruct service *service;\n\tconst char *device_path = device_get_path(client->device);\n\tbt_uuid_t uuid;\n\n\tservice = new0(struct service, 1);\n\tservice->chrcs = queue_new();\n\tservice->incl_services = queue_new();\n\tservice->client = client;\n\n\tgatt_db_attribute_get_service_data(attr, &service->start_handle,\n\t\t\t\t\t\t\t&service->end_handle,\n\t\t\t\t\t\t\t&service->primary,\n\t\t\t\t\t\t\t&uuid);\n\tbt_uuid_to_uuid128(&uuid, &service->uuid);\n\n\tservice->path = g_strdup_printf(\"%s/service%04x\", device_path,\n\t\t\t\t\t\t\tservice->start_handle);\n\n\tif (!g_dbus_register_interface(btd_get_dbus_connection(), service->path,\n\t\t\t\t\t\tGATT_SERVICE_IFACE,\n\t\t\t\t\t\tNULL, NULL,\n\t\t\t\t\t\tservice_properties,\n\t\t\t\t\t\tservice, service_free)) {\n\t\terror(\"Unable to register GATT service with handle 0x%04x for \"\n\t\t\t\t\t\t\t\"device %s\",\n\t\t\t\t\t\t\tservice->start_handle,\n\t\t\t\t\t\t\tclient->devaddr);\n\t\tservice_free(service);\n\n\t\treturn NULL;\n\t}\n\n\tDBG(\"Exported GATT service: %s\", service->path);\n\n\t/* Set service active so we can skip discovering next time */\n\tgatt_db_service_set_active(attr, true);\n\n\t/* Mark the service as claimed since it going to be exported */\n\tgatt_db_service_set_claimed(attr, true);\n\n\treturn service;\n}"
  },
  {
    "function_name": "service_free",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "1818-1826",
    "snippet": "static void service_free(void *data)\n{\n\tstruct service *service = data;\n\n\tqueue_destroy(service->chrcs, NULL);  /* List should be empty here */\n\tqueue_destroy(service->incl_services, NULL);\n\tg_free(service->path);\n\tfree(service);\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "service"
          ],
          "line": 1825
        },
        "resolved": true,
        "details": {
          "function_name": "service_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "1818-1826",
          "snippet": "static void service_free(void *data)\n{\n\tstruct service *service = data;\n\n\tqueue_destroy(service->chrcs, NULL);  /* List should be empty here */\n\tqueue_destroy(service->incl_services, NULL);\n\tg_free(service->path);\n\tfree(service);\n}",
          "note": "cyclic_reference_detected"
        }
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "service->path"
          ],
          "line": 1824
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "queue_destroy",
          "args": [
            "service->incl_services",
            "NULL"
          ],
          "line": 1823
        },
        "resolved": true,
        "details": {
          "function_name": "queue_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "68-76",
          "snippet": "void queue_destroy(struct queue *queue, queue_destroy_func_t destroy)\n{\n\tif (!queue)\n\t\treturn;\n\n\tqueue_remove_all(queue, NULL, NULL, destroy);\n\n\tqueue_unref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid queue_destroy(struct queue *queue, queue_destroy_func_t destroy)\n{\n\tif (!queue)\n\t\treturn;\n\n\tqueue_remove_all(queue, NULL, NULL, destroy);\n\n\tqueue_unref(queue);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void service_free(void *data)\n{\n\tstruct service *service = data;\n\n\tqueue_destroy(service->chrcs, NULL);  /* List should be empty here */\n\tqueue_destroy(service->incl_services, NULL);\n\tg_free(service->path);\n\tfree(service);\n}"
  },
  {
    "function_name": "service_get_includes",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "1794-1808",
    "snippet": "static gboolean service_get_includes(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct service *service = data;\n\tDBusMessageIter array;\n\n\tdbus_message_iter_open_container(iter, DBUS_TYPE_ARRAY, \"{o}\", &array);\n\n\tqueue_foreach(service->incl_services, append_incl_service_path, &array);\n\n\tdbus_message_iter_close_container(iter, &array);\n\n\treturn TRUE;\n\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_iter_close_container",
          "args": [
            "iter",
            "&array"
          ],
          "line": 1804
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "queue_foreach",
          "args": [
            "service->incl_services",
            "append_incl_service_path",
            "&array"
          ],
          "line": 1802
        },
        "resolved": true,
        "details": {
          "function_name": "queue_foreach",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "203-224",
          "snippet": "void queue_foreach(struct queue *queue, queue_foreach_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue || !function)\n\t\treturn;\n\n\tentry = queue->head;\n\tif (!entry)\n\t\treturn;\n\n\tqueue_ref(queue);\n\twhile (entry && queue->head && queue->ref_count > 1) {\n\t\tstruct queue_entry *next;\n\n\t\tnext = entry->next;\n\t\tfunction(entry->data, user_data);\n\t\tentry = next;\n\t}\n\tqueue_unref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid queue_foreach(struct queue *queue, queue_foreach_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue || !function)\n\t\treturn;\n\n\tentry = queue->head;\n\tif (!entry)\n\t\treturn;\n\n\tqueue_ref(queue);\n\twhile (entry && queue->head && queue->ref_count > 1) {\n\t\tstruct queue_entry *next;\n\n\t\tnext = entry->next;\n\t\tfunction(entry->data, user_data);\n\t\tentry = next;\n\t}\n\tqueue_unref(queue);\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_open_container",
          "args": [
            "iter",
            "DBUS_TYPE_ARRAY",
            "\"{o}\"",
            "&array"
          ],
          "line": 1800
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic gboolean service_get_includes(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct service *service = data;\n\tDBusMessageIter array;\n\n\tdbus_message_iter_open_container(iter, DBUS_TYPE_ARRAY, \"{o}\", &array);\n\n\tqueue_foreach(service->incl_services, append_incl_service_path, &array);\n\n\tdbus_message_iter_close_container(iter, &array);\n\n\treturn TRUE;\n\n}"
  },
  {
    "function_name": "append_incl_service_path",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "1785-1792",
    "snippet": "static void append_incl_service_path(void *data, void *user_data)\n{\n\tstruct service *incl_service = data;\n\tDBusMessageIter *array = user_data;\n\n\tdbus_message_iter_append_basic(array, DBUS_TYPE_OBJECT_PATH,\n\t\t\t\t\t&incl_service->path);\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_iter_append_basic",
          "args": [
            "array",
            "DBUS_TYPE_OBJECT_PATH",
            "&incl_service->path"
          ],
          "line": 1790
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void append_incl_service_path(void *data, void *user_data)\n{\n\tstruct service *incl_service = data;\n\tDBusMessageIter *array = user_data;\n\n\tdbus_message_iter_append_basic(array, DBUS_TYPE_OBJECT_PATH,\n\t\t\t\t\t&incl_service->path);\n}"
  },
  {
    "function_name": "service_get_primary",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "1772-1783",
    "snippet": "static gboolean service_get_primary(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct service *service = data;\n\tdbus_bool_t primary;\n\n\tprimary = service->primary ? TRUE : FALSE;\n\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_BOOLEAN, &primary);\n\n\treturn TRUE;\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_iter_append_basic",
          "args": [
            "iter",
            "DBUS_TYPE_BOOLEAN",
            "&primary"
          ],
          "line": 1780
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic gboolean service_get_primary(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct service *service = data;\n\tdbus_bool_t primary;\n\n\tprimary = service->primary ? TRUE : FALSE;\n\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_BOOLEAN, &primary);\n\n\treturn TRUE;\n}"
  },
  {
    "function_name": "service_get_device",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "1761-1770",
    "snippet": "static gboolean service_get_device(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct service *service = data;\n\tconst char *str = device_get_path(service->client->device);\n\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_OBJECT_PATH, &str);\n\n\treturn TRUE;\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_iter_append_basic",
          "args": [
            "iter",
            "DBUS_TYPE_OBJECT_PATH",
            "&str"
          ],
          "line": 1767
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device_get_path",
          "args": [
            "service->client->device"
          ],
          "line": 1765
        },
        "resolved": true,
        "details": {
          "function_name": "device_get_path",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5323-5329",
          "snippet": "const char *device_get_path(const struct btd_device *device)\n{\n\tif (!device)\n\t\treturn NULL;\n\n\treturn device->path;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nconst char *device_get_path(const struct btd_device *device)\n{\n\tif (!device)\n\t\treturn NULL;\n\n\treturn device->path;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic gboolean service_get_device(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct service *service = data;\n\tconst char *str = device_get_path(service->client->device);\n\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_OBJECT_PATH, &str);\n\n\treturn TRUE;\n}"
  },
  {
    "function_name": "service_get_uuid",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "1748-1759",
    "snippet": "static gboolean service_get_uuid(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tchar uuid[MAX_LEN_UUID_STR + 1];\n\tconst char *ptr = uuid;\n\tstruct service *service = data;\n\n\tbt_uuid_to_string(&service->uuid, uuid, sizeof(uuid));\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_STRING, &ptr);\n\n\treturn TRUE;\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_iter_append_basic",
          "args": [
            "iter",
            "DBUS_TYPE_STRING",
            "&ptr"
          ],
          "line": 1756
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_uuid_to_string",
          "args": [
            "&service->uuid",
            "uuid",
            "sizeof(uuid)"
          ],
          "line": 1755
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic gboolean service_get_uuid(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tchar uuid[MAX_LEN_UUID_STR + 1];\n\tconst char *ptr = uuid;\n\tstruct service *service = data;\n\n\tbt_uuid_to_string(&service->uuid, uuid, sizeof(uuid));\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_STRING, &ptr);\n\n\treturn TRUE;\n}"
  },
  {
    "function_name": "unregister_characteristic",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "1728-1746",
    "snippet": "static void unregister_characteristic(void *data)\n{\n\tstruct characteristic *chrc = data;\n\tstruct bt_gatt_client *gatt = chrc->service->client->gatt;\n\n\tDBG(\"Removing GATT characteristic: %s\", chrc->path);\n\n\tif (chrc->read_op)\n\t\tbt_gatt_client_cancel(gatt, chrc->read_op->id);\n\n\tif (chrc->write_op)\n\t\tbt_gatt_client_cancel(gatt, chrc->write_op->id);\n\n\tqueue_remove_all(chrc->notify_clients, NULL, NULL, remove_client);\n\tqueue_remove_all(chrc->descs, NULL, NULL, unregister_descriptor);\n\n\tg_dbus_unregister_interface(btd_get_dbus_connection(), chrc->path,\n\t\t\t\t\t\tGATT_CHARACTERISTIC_IFACE);\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define GATT_CHARACTERISTIC_IFACE\t\"org.bluez.GattCharacteristic1\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_dbus_unregister_interface",
          "args": [
            "btd_get_dbus_connection()",
            "chrc->path",
            "GATT_CHARACTERISTIC_IFACE"
          ],
          "line": 1744
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_get_dbus_connection",
          "args": [],
          "line": 1744
        },
        "resolved": true,
        "details": {
          "function_name": "btd_get_dbus_connection",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/dbus-common.c",
          "lines": "61-64",
          "snippet": "DBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *connection = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *connection = NULL;\n\nDBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_remove_all",
          "args": [
            "chrc->descs",
            "NULL",
            "NULL",
            "unregister_descriptor"
          ],
          "line": 1742
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_all",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "318-362",
          "snippet": "unsigned int queue_remove_all(struct queue *queue, queue_match_func_t function,\n\t\t\t\tvoid *user_data, queue_destroy_func_t destroy)\n{\n\tstruct queue_entry *entry;\n\tunsigned int count = 0;\n\n\tif (!queue)\n\t\treturn 0;\n\n\tentry = queue->head;\n\n\tif (function) {\n\t\twhile (entry) {\n\t\t\tvoid *data;\n\t\t\tunsigned int entries = queue->entries;\n\n\t\t\tdata = queue_remove_if(queue, function, user_data);\n\t\t\tif (entries == queue->entries)\n\t\t\t\tbreak;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(data);\n\n\t\t\tcount++;\n\t\t}\n\t} else {\n\t\tqueue->head = NULL;\n\t\tqueue->tail = NULL;\n\t\tqueue->entries = 0;\n\n\t\twhile (entry) {\n\t\t\tstruct queue_entry *tmp = entry;\n\n\t\t\tentry = entry->next;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(tmp->data);\n\n\t\t\tfree(tmp);\n\t\t\tcount++;\n\t\t}\n\t}\n\n\treturn count;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nunsigned int queue_remove_all(struct queue *queue, queue_match_func_t function,\n\t\t\t\tvoid *user_data, queue_destroy_func_t destroy)\n{\n\tstruct queue_entry *entry;\n\tunsigned int count = 0;\n\n\tif (!queue)\n\t\treturn 0;\n\n\tentry = queue->head;\n\n\tif (function) {\n\t\twhile (entry) {\n\t\t\tvoid *data;\n\t\t\tunsigned int entries = queue->entries;\n\n\t\t\tdata = queue_remove_if(queue, function, user_data);\n\t\t\tif (entries == queue->entries)\n\t\t\t\tbreak;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(data);\n\n\t\t\tcount++;\n\t\t}\n\t} else {\n\t\tqueue->head = NULL;\n\t\tqueue->tail = NULL;\n\t\tqueue->entries = 0;\n\n\t\twhile (entry) {\n\t\t\tstruct queue_entry *tmp = entry;\n\n\t\t\tentry = entry->next;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(tmp->data);\n\n\t\t\tfree(tmp);\n\t\t\tcount++;\n\t\t}\n\t}\n\n\treturn count;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_gatt_client_cancel",
          "args": [
            "gatt",
            "chrc->write_op->id"
          ],
          "line": 1739
        },
        "resolved": true,
        "details": {
          "function_name": "bt_gatt_client_cancel",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-client.c",
          "lines": "2174-2187",
          "snippet": "bool bt_gatt_client_cancel(struct bt_gatt_client *client, unsigned int id)\n{\n\tstruct request *req;\n\n\tif (!client || !id || !client->att)\n\t\treturn false;\n\n\treq = queue_remove_if(client->pending_requests, match_req_id,\n\t\t\t\t\t\t\tUINT_TO_PTR(id));\n\tif (!req)\n\t\treturn false;\n\n\treturn cancel_request(req);\n}",
          "includes": [
            "#include <sys/uio.h>",
            "#include <limits.h>",
            "#include <assert.h>",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-helpers.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/att.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/uio.h>\n#include <limits.h>\n#include <assert.h>\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-helpers.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/att.h\"\n#include <config.h>\n\nbool bt_gatt_client_cancel(struct bt_gatt_client *client, unsigned int id)\n{\n\tstruct request *req;\n\n\tif (!client || !id || !client->att)\n\t\treturn false;\n\n\treq = queue_remove_if(client->pending_requests, match_req_id,\n\t\t\t\t\t\t\tUINT_TO_PTR(id));\n\tif (!req)\n\t\treturn false;\n\n\treturn cancel_request(req);\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Removing GATT characteristic: %s\"",
            "chrc->path"
          ],
          "line": 1733
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\n#define GATT_CHARACTERISTIC_IFACE\t\"org.bluez.GattCharacteristic1\"\n\nstatic void unregister_characteristic(void *data)\n{\n\tstruct characteristic *chrc = data;\n\tstruct bt_gatt_client *gatt = chrc->service->client->gatt;\n\n\tDBG(\"Removing GATT characteristic: %s\", chrc->path);\n\n\tif (chrc->read_op)\n\t\tbt_gatt_client_cancel(gatt, chrc->read_op->id);\n\n\tif (chrc->write_op)\n\t\tbt_gatt_client_cancel(gatt, chrc->write_op->id);\n\n\tqueue_remove_all(chrc->notify_clients, NULL, NULL, remove_client);\n\tqueue_remove_all(chrc->descs, NULL, NULL, unregister_descriptor);\n\n\tg_dbus_unregister_interface(btd_get_dbus_connection(), chrc->path,\n\t\t\t\t\t\tGATT_CHARACTERISTIC_IFACE);\n}"
  },
  {
    "function_name": "remove_client",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "1718-1726",
    "snippet": "static void remove_client(void *data)\n{\n\tstruct notify_client *ntfy_client = data;\n\tstruct btd_gatt_client *client = ntfy_client->chrc->service->client;\n\n\tqueue_remove(client->all_notify_clients, ntfy_client);\n\n\tnotify_client_unref(ntfy_client);\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "notify_client_unref",
          "args": [
            "ntfy_client"
          ],
          "line": 1725
        },
        "resolved": true,
        "details": {
          "function_name": "notify_client_unref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "1267-1277",
          "snippet": "static void notify_client_unref(void *data)\n{\n\tstruct notify_client *client = data;\n\n\tDBG(\"owner %s\", client->owner);\n\n\tif (__sync_sub_and_fetch(&client->ref_count, 1))\n\t\treturn;\n\n\tnotify_client_free(client);\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void notify_client_unref(void *data)\n{\n\tstruct notify_client *client = data;\n\n\tDBG(\"owner %s\", client->owner);\n\n\tif (__sync_sub_and_fetch(&client->ref_count, 1))\n\t\treturn;\n\n\tnotify_client_free(client);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_remove",
          "args": [
            "client->all_notify_clients",
            "ntfy_client"
          ],
          "line": 1723
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_uuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "526-541",
          "snippet": "static bool queue_remove_uuid(struct queue *queue, bt_uuid_t *uuid)\n{\n\tbt_uuid_t *removed;\n\n\tif (!queue || !uuid)\n\t\treturn false;\n\n\tremoved = queue_remove_if(queue, uuid_match, uuid);\n\n\tif (removed) {\n\t\tfree(removed);\n\t\treturn true;\n\t}\n\n\treturn false;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic bool queue_remove_uuid(struct queue *queue, bt_uuid_t *uuid)\n{\n\tbt_uuid_t *removed;\n\n\tif (!queue || !uuid)\n\t\treturn false;\n\n\tremoved = queue_remove_if(queue, uuid_match, uuid);\n\n\tif (removed) {\n\t\tfree(removed);\n\t\treturn true;\n\t}\n\n\treturn false;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void remove_client(void *data)\n{\n\tstruct notify_client *ntfy_client = data;\n\tstruct btd_gatt_client *client = ntfy_client->chrc->service->client;\n\n\tqueue_remove(client->all_notify_clients, ntfy_client);\n\n\tnotify_client_unref(ntfy_client);\n}"
  },
  {
    "function_name": "characteristic_create",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "1670-1716",
    "snippet": "static struct characteristic *characteristic_create(\n\t\t\t\t\t\tstruct gatt_db_attribute *attr,\n\t\t\t\t\t\tstruct service *service)\n{\n\tstruct characteristic *chrc;\n\tbt_uuid_t uuid;\n\n\tchrc = new0(struct characteristic, 1);\n\tchrc->descs = queue_new();\n\tchrc->notify_clients = queue_new();\n\tchrc->service = service;\n\n\tgatt_db_attribute_get_char_data(attr, &chrc->handle,\n\t\t\t\t\t\t\t&chrc->value_handle,\n\t\t\t\t\t\t\t&chrc->props,\n\t\t\t\t\t\t\t&chrc->ext_props,\n\t\t\t\t\t\t\t&uuid);\n\n\tchrc->attr = gatt_db_get_attribute(service->client->db,\n\t\t\t\t\t\t\tchrc->value_handle);\n\tif (!chrc->attr) {\n\t\terror(\"Attribute 0x%04x not found\", chrc->value_handle);\n\t\tcharacteristic_free(chrc);\n\t\treturn NULL;\n\t}\n\n\tbt_uuid_to_uuid128(&uuid, &chrc->uuid);\n\n\tchrc->path = g_strdup_printf(\"%s/char%04x\", service->path,\n\t\t\t\t\t\t\t\tchrc->handle);\n\n\tif (!g_dbus_register_interface(btd_get_dbus_connection(), chrc->path,\n\t\t\t\t\t\tGATT_CHARACTERISTIC_IFACE,\n\t\t\t\t\t\tcharacteristic_methods, NULL,\n\t\t\t\t\t\tcharacteristic_properties,\n\t\t\t\t\t\tchrc, characteristic_free)) {\n\t\terror(\"Unable to register GATT characteristic with handle \"\n\t\t\t\t\t\t\t\"0x%04x\", chrc->handle);\n\t\tcharacteristic_free(chrc);\n\n\t\treturn NULL;\n\t}\n\n\tDBG(\"Exported GATT characteristic: %s\", chrc->path);\n\n\treturn chrc;\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define GATT_CHARACTERISTIC_IFACE\t\"org.bluez.GattCharacteristic1\""
    ],
    "globals_used": [
      "static const GDBusPropertyTable characteristic_properties[] = {\n\t{ \"UUID\", \"s\", characteristic_get_uuid, NULL, NULL },\n\t{ \"Service\", \"o\", characteristic_get_service, NULL, NULL },\n\t{ \"Value\", \"ay\", characteristic_get_value, NULL,\n\t\t\t\t\tcharacteristic_value_exists },\n\t{ \"Notifying\", \"b\", characteristic_get_notifying, NULL,\n\t\t\t\t\tcharacteristic_notifying_exists },\n\t{ \"Flags\", \"as\", characteristic_get_flags, NULL, NULL },\n\t{ \"WriteAcquired\", \"b\", characteristic_get_write_acquired, NULL,\n\t\t\t\tcharacteristic_write_acquired_exists },\n\t{ \"NotifyAcquired\", \"b\", characteristic_get_notify_acquired, NULL,\n\t\t\t\tcharacteristic_notify_acquired_exists },\n\t{ }\n};",
      "static const GDBusMethodTable characteristic_methods[] = {\n\t{ GDBUS_ASYNC_METHOD(\"ReadValue\", GDBUS_ARGS({ \"options\", \"a{sv}\" }),\n\t\t\t\t\tGDBUS_ARGS({ \"value\", \"ay\" }),\n\t\t\t\t\tcharacteristic_read_value) },\n\t{ GDBUS_ASYNC_METHOD(\"WriteValue\", GDBUS_ARGS({ \"value\", \"ay\" },\n\t\t\t\t\t\t{ \"options\", \"a{sv}\" }),\n\t\t\t\t\tNULL,\n\t\t\t\t\tcharacteristic_write_value) },\n\t{ GDBUS_ASYNC_METHOD(\"AcquireWrite\",\n\t\t\t\t\tGDBUS_ARGS({ \"options\", \"a{sv}\" }),\n\t\t\t\t\tGDBUS_ARGS({ \"fd\", \"h\" },\n\t\t\t\t\t\t{ \"mtu\", \"q\" }),\n\t\t\t\t\tcharacteristic_acquire_write) },\n\t{ GDBUS_ASYNC_METHOD(\"AcquireNotify\",\n\t\t\t\t\tGDBUS_ARGS({ \"options\", \"a{sv}\" }),\n\t\t\t\t\tGDBUS_ARGS({ \"fd\", \"h\" },\n\t\t\t\t\t\t{ \"mtu\", \"q\" }),\n\t\t\t\t\tcharacteristic_acquire_notify) },\n\t{ GDBUS_ASYNC_METHOD(\"StartNotify\", NULL, NULL,\n\t\t\t\t\tcharacteristic_start_notify) },\n\t{ GDBUS_METHOD(\"StopNotify\", NULL, NULL,\n\t\t\t\t\tcharacteristic_stop_notify) },\n\t{ }\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Exported GATT characteristic: %s\"",
            "chrc->path"
          ],
          "line": 1713
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "characteristic_free",
          "args": [
            "chrc"
          ],
          "line": 1708
        },
        "resolved": true,
        "details": {
          "function_name": "characteristic_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "1648-1668",
          "snippet": "static void characteristic_free(void *data)\n{\n\tstruct characteristic *chrc = data;\n\n\t/* List should be empty here */\n\tqueue_destroy(chrc->descs, NULL);\n\tqueue_destroy(chrc->notify_clients, NULL);\n\n\tif (chrc->write_io) {\n\t\tqueue_remove(chrc->service->client->ios, chrc->write_io->io);\n\t\tpipe_io_destroy(chrc->write_io);\n\t}\n\n\tif (chrc->notify_io) {\n\t\tqueue_remove(chrc->service->client->ios, chrc->notify_io->io);\n\t\tpipe_io_destroy(chrc->notify_io);\n\t}\n\n\tg_free(chrc->path);\n\tfree(chrc);\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void characteristic_free(void *data)\n{\n\tstruct characteristic *chrc = data;\n\n\t/* List should be empty here */\n\tqueue_destroy(chrc->descs, NULL);\n\tqueue_destroy(chrc->notify_clients, NULL);\n\n\tif (chrc->write_io) {\n\t\tqueue_remove(chrc->service->client->ios, chrc->write_io->io);\n\t\tpipe_io_destroy(chrc->write_io);\n\t}\n\n\tif (chrc->notify_io) {\n\t\tqueue_remove(chrc->service->client->ios, chrc->notify_io->io);\n\t\tpipe_io_destroy(chrc->notify_io);\n\t}\n\n\tg_free(chrc->path);\n\tfree(chrc);\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Unable to register GATT characteristic with handle \"\n\t\t\t\t\t\t\t\"0x%04x\"",
            "chrc->handle"
          ],
          "line": 1706
        },
        "resolved": true,
        "details": {
          "function_name": "create_gatt_dbus_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "273-301",
          "snippet": "static DBusMessage *create_gatt_dbus_error(DBusMessage *msg, uint8_t att_ecode)\n{\n\tswitch (att_ecode) {\n\tcase BT_ATT_ERROR_READ_NOT_PERMITTED:\n\t\treturn btd_error_not_permitted(msg, \"Read not permitted\");\n\tcase BT_ATT_ERROR_WRITE_NOT_PERMITTED:\n\t\treturn btd_error_not_permitted(msg, \"Write not permitted\");\n\tcase BT_ATT_ERROR_AUTHENTICATION:\n\tcase BT_ATT_ERROR_INSUFFICIENT_ENCRYPTION:\n\tcase BT_ATT_ERROR_INSUFFICIENT_ENCRYPTION_KEY_SIZE:\n\t\treturn btd_error_not_permitted(msg, \"Not paired\");\n\tcase BT_ATT_ERROR_INVALID_OFFSET:\n\t\treturn btd_error_invalid_args_str(msg, \"Invalid offset\");\n\tcase BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN:\n\t\treturn btd_error_invalid_args_str(msg, \"Invalid Length\");\n\tcase BT_ATT_ERROR_AUTHORIZATION:\n\t\treturn btd_error_not_authorized(msg);\n\tcase BT_ATT_ERROR_REQUEST_NOT_SUPPORTED:\n\t\treturn btd_error_not_supported(msg);\n\tcase 0:\n\t\treturn btd_error_failed(msg, \"Operation failed\");\n\tdefault:\n\t\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".Failed\",\n\t\t\t\t\"Operation failed with ATT error: 0x%02x\",\n\t\t\t\tatt_ecode);\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic DBusMessage *create_gatt_dbus_error(DBusMessage *msg, uint8_t att_ecode)\n{\n\tswitch (att_ecode) {\n\tcase BT_ATT_ERROR_READ_NOT_PERMITTED:\n\t\treturn btd_error_not_permitted(msg, \"Read not permitted\");\n\tcase BT_ATT_ERROR_WRITE_NOT_PERMITTED:\n\t\treturn btd_error_not_permitted(msg, \"Write not permitted\");\n\tcase BT_ATT_ERROR_AUTHENTICATION:\n\tcase BT_ATT_ERROR_INSUFFICIENT_ENCRYPTION:\n\tcase BT_ATT_ERROR_INSUFFICIENT_ENCRYPTION_KEY_SIZE:\n\t\treturn btd_error_not_permitted(msg, \"Not paired\");\n\tcase BT_ATT_ERROR_INVALID_OFFSET:\n\t\treturn btd_error_invalid_args_str(msg, \"Invalid offset\");\n\tcase BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN:\n\t\treturn btd_error_invalid_args_str(msg, \"Invalid Length\");\n\tcase BT_ATT_ERROR_AUTHORIZATION:\n\t\treturn btd_error_not_authorized(msg);\n\tcase BT_ATT_ERROR_REQUEST_NOT_SUPPORTED:\n\t\treturn btd_error_not_supported(msg);\n\tcase 0:\n\t\treturn btd_error_failed(msg, \"Operation failed\");\n\tdefault:\n\t\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".Failed\",\n\t\t\t\t\"Operation failed with ATT error: 0x%02x\",\n\t\t\t\tatt_ecode);\n\t}\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_register_interface",
          "args": [
            "btd_get_dbus_connection()",
            "chrc->path",
            "GATT_CHARACTERISTIC_IFACE",
            "characteristic_methods",
            "NULL",
            "characteristic_properties",
            "chrc",
            "characteristic_free"
          ],
          "line": 1701
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_get_dbus_connection",
          "args": [],
          "line": 1701
        },
        "resolved": true,
        "details": {
          "function_name": "btd_get_dbus_connection",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/dbus-common.c",
          "lines": "61-64",
          "snippet": "DBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *connection = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *connection = NULL;\n\nDBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"%s/char%04x\"",
            "service->path",
            "chrc->handle"
          ],
          "line": 1698
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_uuid_to_uuid128",
          "args": [
            "&uuid",
            "&chrc->uuid"
          ],
          "line": 1696
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gatt_db_get_attribute",
          "args": [
            "service->client->db",
            "chrc->value_handle"
          ],
          "line": 1688
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_get_attribute",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1423-1445",
          "snippet": "struct gatt_db_attribute *gatt_db_get_attribute(struct gatt_db *db,\n\t\t\t\t\t\t\tuint16_t handle)\n{\n\tstruct gatt_db_attribute *attrib;\n\tstruct gatt_db_service *service;\n\tint i;\n\n\tattrib = gatt_db_get_service(db, handle);\n\tif (!attrib)\n\t\treturn NULL;\n\n\tservice = attrib->service;\n\n\tfor (i = 0; i < service->num_handles; i++) {\n\t\tif (!service->attributes[i])\n\t\t\tcontinue;\n\n\t\tif (service->attributes[i]->handle == handle)\n\t\t\treturn service->attributes[i];\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstruct gatt_db_attribute *gatt_db_get_attribute(struct gatt_db *db,\n\t\t\t\t\t\t\tuint16_t handle)\n{\n\tstruct gatt_db_attribute *attrib;\n\tstruct gatt_db_service *service;\n\tint i;\n\n\tattrib = gatt_db_get_service(db, handle);\n\tif (!attrib)\n\t\treturn NULL;\n\n\tservice = attrib->service;\n\n\tfor (i = 0; i < service->num_handles; i++) {\n\t\tif (!service->attributes[i])\n\t\t\tcontinue;\n\n\t\tif (service->attributes[i]->handle == handle)\n\t\t\treturn service->attributes[i];\n\t}\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_attribute_get_char_data",
          "args": [
            "attr",
            "&chrc->handle",
            "&chrc->value_handle",
            "&chrc->props",
            "&chrc->ext_props",
            "&uuid"
          ],
          "line": 1682
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_get_char_data",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1625-1664",
          "snippet": "bool gatt_db_attribute_get_char_data(const struct gatt_db_attribute *attrib,\n\t\t\t\t\t\t\tuint16_t *handle,\n\t\t\t\t\t\t\tuint16_t *value_handle,\n\t\t\t\t\t\t\tuint8_t *properties,\n\t\t\t\t\t\t\tuint16_t *ext_prop,\n\t\t\t\t\t\t\tbt_uuid_t *uuid)\n{\n\tif (!attrib)\n\t\treturn false;\n\n\tif (bt_uuid_cmp(&characteristic_uuid, &attrib->uuid))\n\t\treturn false;\n\n\t/*\n\t * Characteristic declaration value:\n\t * 1 octet: Characteristic properties\n\t * 2 octets: Characteristic value handle\n\t * 2 or 16 octets: characteristic UUID\n\t */\n\tif (!attrib->value || (attrib->value_len != 5 &&\n\t\t\t\t\t\tattrib->value_len != 19))\n\t\treturn false;\n\n\tif (handle)\n\t\t*handle = attrib->handle;\n\n\tif (properties)\n\t\t*properties = attrib->value[0];\n\n\tif (ext_prop)\n\t\t*ext_prop = get_char_extended_prop(attrib);\n\n\tif (value_handle)\n\t\t*value_handle = get_le16(attrib->value + 1);\n\n\tif (!uuid)\n\t\treturn true;\n\n\treturn le_to_uuid(attrib->value + 3, attrib->value_len - 3, uuid);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static const bt_uuid_t characteristic_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_CHARAC_UUID };"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic const bt_uuid_t characteristic_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_CHARAC_UUID };\n\nbool gatt_db_attribute_get_char_data(const struct gatt_db_attribute *attrib,\n\t\t\t\t\t\t\tuint16_t *handle,\n\t\t\t\t\t\t\tuint16_t *value_handle,\n\t\t\t\t\t\t\tuint8_t *properties,\n\t\t\t\t\t\t\tuint16_t *ext_prop,\n\t\t\t\t\t\t\tbt_uuid_t *uuid)\n{\n\tif (!attrib)\n\t\treturn false;\n\n\tif (bt_uuid_cmp(&characteristic_uuid, &attrib->uuid))\n\t\treturn false;\n\n\t/*\n\t * Characteristic declaration value:\n\t * 1 octet: Characteristic properties\n\t * 2 octets: Characteristic value handle\n\t * 2 or 16 octets: characteristic UUID\n\t */\n\tif (!attrib->value || (attrib->value_len != 5 &&\n\t\t\t\t\t\tattrib->value_len != 19))\n\t\treturn false;\n\n\tif (handle)\n\t\t*handle = attrib->handle;\n\n\tif (properties)\n\t\t*properties = attrib->value[0];\n\n\tif (ext_prop)\n\t\t*ext_prop = get_char_extended_prop(attrib);\n\n\tif (value_handle)\n\t\t*value_handle = get_le16(attrib->value + 1);\n\n\tif (!uuid)\n\t\treturn true;\n\n\treturn le_to_uuid(attrib->value + 3, attrib->value_len - 3, uuid);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_new",
          "args": [],
          "line": 1679
        },
        "resolved": true,
        "details": {
          "function_name": "queue_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "56-66",
          "snippet": "struct queue *queue_new(void)\n{\n\tstruct queue *queue;\n\n\tqueue = new0(struct queue, 1);\n\tqueue->head = NULL;\n\tqueue->tail = NULL;\n\tqueue->entries = 0;\n\n\treturn queue_ref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nstruct queue *queue_new(void)\n{\n\tstruct queue *queue;\n\n\tqueue = new0(struct queue, 1);\n\tqueue->head = NULL;\n\tqueue->tail = NULL;\n\tqueue->entries = 0;\n\n\treturn queue_ref(queue);\n}"
        }
      },
      {
        "call_info": {
          "callee": "new0",
          "args": [
            "structcharacteristic",
            "1"
          ],
          "line": 1677
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\n#define GATT_CHARACTERISTIC_IFACE\t\"org.bluez.GattCharacteristic1\"\n\nstatic const GDBusPropertyTable characteristic_properties[] = {\n\t{ \"UUID\", \"s\", characteristic_get_uuid, NULL, NULL },\n\t{ \"Service\", \"o\", characteristic_get_service, NULL, NULL },\n\t{ \"Value\", \"ay\", characteristic_get_value, NULL,\n\t\t\t\t\tcharacteristic_value_exists },\n\t{ \"Notifying\", \"b\", characteristic_get_notifying, NULL,\n\t\t\t\t\tcharacteristic_notifying_exists },\n\t{ \"Flags\", \"as\", characteristic_get_flags, NULL, NULL },\n\t{ \"WriteAcquired\", \"b\", characteristic_get_write_acquired, NULL,\n\t\t\t\tcharacteristic_write_acquired_exists },\n\t{ \"NotifyAcquired\", \"b\", characteristic_get_notify_acquired, NULL,\n\t\t\t\tcharacteristic_notify_acquired_exists },\n\t{ }\n};\nstatic const GDBusMethodTable characteristic_methods[] = {\n\t{ GDBUS_ASYNC_METHOD(\"ReadValue\", GDBUS_ARGS({ \"options\", \"a{sv}\" }),\n\t\t\t\t\tGDBUS_ARGS({ \"value\", \"ay\" }),\n\t\t\t\t\tcharacteristic_read_value) },\n\t{ GDBUS_ASYNC_METHOD(\"WriteValue\", GDBUS_ARGS({ \"value\", \"ay\" },\n\t\t\t\t\t\t{ \"options\", \"a{sv}\" }),\n\t\t\t\t\tNULL,\n\t\t\t\t\tcharacteristic_write_value) },\n\t{ GDBUS_ASYNC_METHOD(\"AcquireWrite\",\n\t\t\t\t\tGDBUS_ARGS({ \"options\", \"a{sv}\" }),\n\t\t\t\t\tGDBUS_ARGS({ \"fd\", \"h\" },\n\t\t\t\t\t\t{ \"mtu\", \"q\" }),\n\t\t\t\t\tcharacteristic_acquire_write) },\n\t{ GDBUS_ASYNC_METHOD(\"AcquireNotify\",\n\t\t\t\t\tGDBUS_ARGS({ \"options\", \"a{sv}\" }),\n\t\t\t\t\tGDBUS_ARGS({ \"fd\", \"h\" },\n\t\t\t\t\t\t{ \"mtu\", \"q\" }),\n\t\t\t\t\tcharacteristic_acquire_notify) },\n\t{ GDBUS_ASYNC_METHOD(\"StartNotify\", NULL, NULL,\n\t\t\t\t\tcharacteristic_start_notify) },\n\t{ GDBUS_METHOD(\"StopNotify\", NULL, NULL,\n\t\t\t\t\tcharacteristic_stop_notify) },\n\t{ }\n};\n\nstatic struct characteristic *characteristic_create(\n\t\t\t\t\t\tstruct gatt_db_attribute *attr,\n\t\t\t\t\t\tstruct service *service)\n{\n\tstruct characteristic *chrc;\n\tbt_uuid_t uuid;\n\n\tchrc = new0(struct characteristic, 1);\n\tchrc->descs = queue_new();\n\tchrc->notify_clients = queue_new();\n\tchrc->service = service;\n\n\tgatt_db_attribute_get_char_data(attr, &chrc->handle,\n\t\t\t\t\t\t\t&chrc->value_handle,\n\t\t\t\t\t\t\t&chrc->props,\n\t\t\t\t\t\t\t&chrc->ext_props,\n\t\t\t\t\t\t\t&uuid);\n\n\tchrc->attr = gatt_db_get_attribute(service->client->db,\n\t\t\t\t\t\t\tchrc->value_handle);\n\tif (!chrc->attr) {\n\t\terror(\"Attribute 0x%04x not found\", chrc->value_handle);\n\t\tcharacteristic_free(chrc);\n\t\treturn NULL;\n\t}\n\n\tbt_uuid_to_uuid128(&uuid, &chrc->uuid);\n\n\tchrc->path = g_strdup_printf(\"%s/char%04x\", service->path,\n\t\t\t\t\t\t\t\tchrc->handle);\n\n\tif (!g_dbus_register_interface(btd_get_dbus_connection(), chrc->path,\n\t\t\t\t\t\tGATT_CHARACTERISTIC_IFACE,\n\t\t\t\t\t\tcharacteristic_methods, NULL,\n\t\t\t\t\t\tcharacteristic_properties,\n\t\t\t\t\t\tchrc, characteristic_free)) {\n\t\terror(\"Unable to register GATT characteristic with handle \"\n\t\t\t\t\t\t\t\"0x%04x\", chrc->handle);\n\t\tcharacteristic_free(chrc);\n\n\t\treturn NULL;\n\t}\n\n\tDBG(\"Exported GATT characteristic: %s\", chrc->path);\n\n\treturn chrc;\n}"
  },
  {
    "function_name": "characteristic_free",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "1648-1668",
    "snippet": "static void characteristic_free(void *data)\n{\n\tstruct characteristic *chrc = data;\n\n\t/* List should be empty here */\n\tqueue_destroy(chrc->descs, NULL);\n\tqueue_destroy(chrc->notify_clients, NULL);\n\n\tif (chrc->write_io) {\n\t\tqueue_remove(chrc->service->client->ios, chrc->write_io->io);\n\t\tpipe_io_destroy(chrc->write_io);\n\t}\n\n\tif (chrc->notify_io) {\n\t\tqueue_remove(chrc->service->client->ios, chrc->notify_io->io);\n\t\tpipe_io_destroy(chrc->notify_io);\n\t}\n\n\tg_free(chrc->path);\n\tfree(chrc);\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "chrc"
          ],
          "line": 1667
        },
        "resolved": true,
        "details": {
          "function_name": "service_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "1818-1826",
          "snippet": "static void service_free(void *data)\n{\n\tstruct service *service = data;\n\n\tqueue_destroy(service->chrcs, NULL);  /* List should be empty here */\n\tqueue_destroy(service->incl_services, NULL);\n\tg_free(service->path);\n\tfree(service);\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void service_free(void *data)\n{\n\tstruct service *service = data;\n\n\tqueue_destroy(service->chrcs, NULL);  /* List should be empty here */\n\tqueue_destroy(service->incl_services, NULL);\n\tg_free(service->path);\n\tfree(service);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "chrc->path"
          ],
          "line": 1666
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pipe_io_destroy",
          "args": [
            "chrc->notify_io"
          ],
          "line": 1663
        },
        "resolved": true,
        "details": {
          "function_name": "pipe_io_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "1079-1089",
          "snippet": "static void pipe_io_destroy(struct pipe_io *io)\n{\n\tif (io->destroy)\n\t\tio->destroy(io->data);\n\n\tif (io->msg)\n\t\tdbus_message_unref(io->msg);\n\n\tio_destroy(io->io);\n\tfree(io);\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void pipe_io_destroy(struct pipe_io *io)\n{\n\tif (io->destroy)\n\t\tio->destroy(io->data);\n\n\tif (io->msg)\n\t\tdbus_message_unref(io->msg);\n\n\tio_destroy(io->io);\n\tfree(io);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_remove",
          "args": [
            "chrc->service->client->ios",
            "chrc->notify_io->io"
          ],
          "line": 1662
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_uuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "526-541",
          "snippet": "static bool queue_remove_uuid(struct queue *queue, bt_uuid_t *uuid)\n{\n\tbt_uuid_t *removed;\n\n\tif (!queue || !uuid)\n\t\treturn false;\n\n\tremoved = queue_remove_if(queue, uuid_match, uuid);\n\n\tif (removed) {\n\t\tfree(removed);\n\t\treturn true;\n\t}\n\n\treturn false;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic bool queue_remove_uuid(struct queue *queue, bt_uuid_t *uuid)\n{\n\tbt_uuid_t *removed;\n\n\tif (!queue || !uuid)\n\t\treturn false;\n\n\tremoved = queue_remove_if(queue, uuid_match, uuid);\n\n\tif (removed) {\n\t\tfree(removed);\n\t\treturn true;\n\t}\n\n\treturn false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_destroy",
          "args": [
            "chrc->notify_clients",
            "NULL"
          ],
          "line": 1654
        },
        "resolved": true,
        "details": {
          "function_name": "queue_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "68-76",
          "snippet": "void queue_destroy(struct queue *queue, queue_destroy_func_t destroy)\n{\n\tif (!queue)\n\t\treturn;\n\n\tqueue_remove_all(queue, NULL, NULL, destroy);\n\n\tqueue_unref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid queue_destroy(struct queue *queue, queue_destroy_func_t destroy)\n{\n\tif (!queue)\n\t\treturn;\n\n\tqueue_remove_all(queue, NULL, NULL, destroy);\n\n\tqueue_unref(queue);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void characteristic_free(void *data)\n{\n\tstruct characteristic *chrc = data;\n\n\t/* List should be empty here */\n\tqueue_destroy(chrc->descs, NULL);\n\tqueue_destroy(chrc->notify_clients, NULL);\n\n\tif (chrc->write_io) {\n\t\tqueue_remove(chrc->service->client->ios, chrc->write_io->io);\n\t\tpipe_io_destroy(chrc->write_io);\n\t}\n\n\tif (chrc->notify_io) {\n\t\tqueue_remove(chrc->service->client->ios, chrc->notify_io->io);\n\t\tpipe_io_destroy(chrc->notify_io);\n\t}\n\n\tg_free(chrc->path);\n\tfree(chrc);\n}"
  },
  {
    "function_name": "characteristic_stop_notify",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "1581-1606",
    "snippet": "static DBusMessage *characteristic_stop_notify(DBusConnection *conn,\n\t\t\t\t\tDBusMessage *msg, void *user_data)\n{\n\tstruct characteristic *chrc = user_data;\n\tstruct bt_gatt_client *gatt = chrc->service->client->gatt;\n\tconst char *sender = dbus_message_get_sender(msg);\n\tstruct notify_client *client;\n\n\tclient = queue_remove_if(chrc->notify_clients, match_notify_sender,\n\t\t\t\t\t\t\t(void *) sender);\n\tif (!client)\n\t\treturn btd_error_failed(msg, \"No notify session started\");\n\n\tif (chrc->notify_io) {\n\t\tcharacteristic_destroy_pipe(chrc, chrc->notify_io->io);\n\t\treturn dbus_message_new_method_return(msg);\n\t}\n\n\tqueue_remove(chrc->service->client->all_notify_clients, client);\n\tbt_gatt_client_unregister_notify(gatt, client->notify_id);\n\tupdate_notifying(chrc);\n\n\tnotify_client_unref(client);\n\n\treturn dbus_message_new_method_return(msg);\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_new_method_return",
          "args": [
            "msg"
          ],
          "line": 1605
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "notify_client_unref",
          "args": [
            "client"
          ],
          "line": 1603
        },
        "resolved": true,
        "details": {
          "function_name": "notify_client_unref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "1267-1277",
          "snippet": "static void notify_client_unref(void *data)\n{\n\tstruct notify_client *client = data;\n\n\tDBG(\"owner %s\", client->owner);\n\n\tif (__sync_sub_and_fetch(&client->ref_count, 1))\n\t\treturn;\n\n\tnotify_client_free(client);\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void notify_client_unref(void *data)\n{\n\tstruct notify_client *client = data;\n\n\tDBG(\"owner %s\", client->owner);\n\n\tif (__sync_sub_and_fetch(&client->ref_count, 1))\n\t\treturn;\n\n\tnotify_client_free(client);\n}"
        }
      },
      {
        "call_info": {
          "callee": "update_notifying",
          "args": [
            "chrc"
          ],
          "line": 1601
        },
        "resolved": true,
        "details": {
          "function_name": "update_notifying",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "1295-1308",
          "snippet": "static void update_notifying(struct characteristic *chrc)\n{\n\tif (!chrc->notifying)\n\t\treturn;\n\n\tif (queue_find(chrc->notify_clients, match_notifying, NULL))\n\t\treturn;\n\n\tchrc->notifying = false;\n\n\tg_dbus_emit_property_changed(btd_get_dbus_connection(), chrc->path,\n\t\t\t\t\t\tGATT_CHARACTERISTIC_IFACE,\n\t\t\t\t\t\t\"Notifying\");\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define GATT_CHARACTERISTIC_IFACE\t\"org.bluez.GattCharacteristic1\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\n#define GATT_CHARACTERISTIC_IFACE\t\"org.bluez.GattCharacteristic1\"\n\nstatic void update_notifying(struct characteristic *chrc)\n{\n\tif (!chrc->notifying)\n\t\treturn;\n\n\tif (queue_find(chrc->notify_clients, match_notifying, NULL))\n\t\treturn;\n\n\tchrc->notifying = false;\n\n\tg_dbus_emit_property_changed(btd_get_dbus_connection(), chrc->path,\n\t\t\t\t\t\tGATT_CHARACTERISTIC_IFACE,\n\t\t\t\t\t\t\"Notifying\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_gatt_client_unregister_notify",
          "args": [
            "gatt",
            "client->notify_id"
          ],
          "line": 1600
        },
        "resolved": true,
        "details": {
          "function_name": "bt_gatt_client_unregister_notify",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-client.c",
          "lines": "3254-3276",
          "snippet": "bool bt_gatt_client_unregister_notify(struct bt_gatt_client *client,\n\t\t\t\t\t\t\tunsigned int id)\n{\n\tstruct notify_data *notify_data;\n\n\tif (!client || !id)\n\t\treturn false;\n\n\tnotify_data = queue_remove_if(client->notify_list, match_notify_data_id,\n\t\t\t\t\t\t\tUINT_TO_PTR(id));\n\tif (!notify_data)\n\t\treturn false;\n\n\t/* Remove data if it has been queued */\n\tqueue_remove(notify_data->chrc->reg_notify_queue, notify_data);\n\n\t/* Reset callbacks */\n\tnotify_data->callback = NULL;\n\tnotify_data->notify = NULL;\n\n\tcomplete_unregister_notify(notify_data);\n\treturn true;\n}",
          "includes": [
            "#include <sys/uio.h>",
            "#include <limits.h>",
            "#include <assert.h>",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-helpers.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/att.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/uio.h>\n#include <limits.h>\n#include <assert.h>\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-helpers.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/att.h\"\n#include <config.h>\n\nbool bt_gatt_client_unregister_notify(struct bt_gatt_client *client,\n\t\t\t\t\t\t\tunsigned int id)\n{\n\tstruct notify_data *notify_data;\n\n\tif (!client || !id)\n\t\treturn false;\n\n\tnotify_data = queue_remove_if(client->notify_list, match_notify_data_id,\n\t\t\t\t\t\t\tUINT_TO_PTR(id));\n\tif (!notify_data)\n\t\treturn false;\n\n\t/* Remove data if it has been queued */\n\tqueue_remove(notify_data->chrc->reg_notify_queue, notify_data);\n\n\t/* Reset callbacks */\n\tnotify_data->callback = NULL;\n\tnotify_data->notify = NULL;\n\n\tcomplete_unregister_notify(notify_data);\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_remove",
          "args": [
            "chrc->service->client->all_notify_clients",
            "client"
          ],
          "line": 1599
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_uuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "526-541",
          "snippet": "static bool queue_remove_uuid(struct queue *queue, bt_uuid_t *uuid)\n{\n\tbt_uuid_t *removed;\n\n\tif (!queue || !uuid)\n\t\treturn false;\n\n\tremoved = queue_remove_if(queue, uuid_match, uuid);\n\n\tif (removed) {\n\t\tfree(removed);\n\t\treturn true;\n\t}\n\n\treturn false;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic bool queue_remove_uuid(struct queue *queue, bt_uuid_t *uuid)\n{\n\tbt_uuid_t *removed;\n\n\tif (!queue || !uuid)\n\t\treturn false;\n\n\tremoved = queue_remove_if(queue, uuid_match, uuid);\n\n\tif (removed) {\n\t\tfree(removed);\n\t\treturn true;\n\t}\n\n\treturn false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_new_method_return",
          "args": [
            "msg"
          ],
          "line": 1596
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "characteristic_destroy_pipe",
          "args": [
            "chrc",
            "chrc->notify_io->io"
          ],
          "line": 1595
        },
        "resolved": true,
        "details": {
          "function_name": "characteristic_destroy_pipe",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "1091-1111",
          "snippet": "static void characteristic_destroy_pipe(struct characteristic *chrc,\n\t\t\t\t\t\t\tstruct io *io)\n{\n\tqueue_remove(chrc->service->client->ios, io);\n\n\tif (chrc->write_io && io == chrc->write_io->io) {\n\t\tpipe_io_destroy(chrc->write_io);\n\t\tchrc->write_io = NULL;\n\t\tg_dbus_emit_property_changed(btd_get_dbus_connection(),\n\t\t\t\t\t\tchrc->path,\n\t\t\t\t\t\tGATT_CHARACTERISTIC_IFACE,\n\t\t\t\t\t\t\"WriteAcquired\");\n\t} else if (chrc->notify_io) {\n\t\tpipe_io_destroy(chrc->notify_io);\n\t\tchrc->notify_io = NULL;\n\t\tg_dbus_emit_property_changed(btd_get_dbus_connection(),\n\t\t\t\t\t\tchrc->path,\n\t\t\t\t\t\tGATT_CHARACTERISTIC_IFACE,\n\t\t\t\t\t\t\"NotifyAcquired\");\n\t}\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define GATT_CHARACTERISTIC_IFACE\t\"org.bluez.GattCharacteristic1\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\n#define GATT_CHARACTERISTIC_IFACE\t\"org.bluez.GattCharacteristic1\"\n\nstatic void characteristic_destroy_pipe(struct characteristic *chrc,\n\t\t\t\t\t\t\tstruct io *io)\n{\n\tqueue_remove(chrc->service->client->ios, io);\n\n\tif (chrc->write_io && io == chrc->write_io->io) {\n\t\tpipe_io_destroy(chrc->write_io);\n\t\tchrc->write_io = NULL;\n\t\tg_dbus_emit_property_changed(btd_get_dbus_connection(),\n\t\t\t\t\t\tchrc->path,\n\t\t\t\t\t\tGATT_CHARACTERISTIC_IFACE,\n\t\t\t\t\t\t\"WriteAcquired\");\n\t} else if (chrc->notify_io) {\n\t\tpipe_io_destroy(chrc->notify_io);\n\t\tchrc->notify_io = NULL;\n\t\tg_dbus_emit_property_changed(btd_get_dbus_connection(),\n\t\t\t\t\t\tchrc->path,\n\t\t\t\t\t\tGATT_CHARACTERISTIC_IFACE,\n\t\t\t\t\t\t\"NotifyAcquired\");\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_error_failed",
          "args": [
            "msg",
            "\"No notify session started\""
          ],
          "line": 1592
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "124-128",
          "snippet": "DBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_remove_if",
          "args": [
            "chrc->notify_clients",
            "match_notify_sender",
            "(void *) sender"
          ],
          "line": 1589
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_if",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "278-316",
          "snippet": "void *queue_remove_if(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry, *prev = NULL;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tentry = queue->head;\n\n\twhile (entry) {\n\t\tif (function(entry->data, user_data)) {\n\t\t\tvoid *data;\n\n\t\t\tif (prev)\n\t\t\t\tprev->next = entry->next;\n\t\t\telse\n\t\t\t\tqueue->head = entry->next;\n\n\t\t\tif (!entry->next)\n\t\t\t\tqueue->tail = prev;\n\n\t\t\tdata = entry->data;\n\n\t\t\tfree(entry);\n\t\t\tqueue->entries--;\n\n\t\t\treturn data;\n\t\t} else {\n\t\t\tprev = entry;\n\t\t\tentry = entry->next;\n\t\t}\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid *queue_remove_if(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry, *prev = NULL;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tentry = queue->head;\n\n\twhile (entry) {\n\t\tif (function(entry->data, user_data)) {\n\t\t\tvoid *data;\n\n\t\t\tif (prev)\n\t\t\t\tprev->next = entry->next;\n\t\t\telse\n\t\t\t\tqueue->head = entry->next;\n\n\t\t\tif (!entry->next)\n\t\t\t\tqueue->tail = prev;\n\n\t\t\tdata = entry->data;\n\n\t\t\tfree(entry);\n\t\t\tqueue->entries--;\n\n\t\t\treturn data;\n\t\t} else {\n\t\t\tprev = entry;\n\t\t\tentry = entry->next;\n\t\t}\n\t}\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_get_sender",
          "args": [
            "msg"
          ],
          "line": 1586
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic DBusMessage *characteristic_stop_notify(DBusConnection *conn,\n\t\t\t\t\tDBusMessage *msg, void *user_data)\n{\n\tstruct characteristic *chrc = user_data;\n\tstruct bt_gatt_client *gatt = chrc->service->client->gatt;\n\tconst char *sender = dbus_message_get_sender(msg);\n\tstruct notify_client *client;\n\n\tclient = queue_remove_if(chrc->notify_clients, match_notify_sender,\n\t\t\t\t\t\t\t(void *) sender);\n\tif (!client)\n\t\treturn btd_error_failed(msg, \"No notify session started\");\n\n\tif (chrc->notify_io) {\n\t\tcharacteristic_destroy_pipe(chrc, chrc->notify_io->io);\n\t\treturn dbus_message_new_method_return(msg);\n\t}\n\n\tqueue_remove(chrc->service->client->all_notify_clients, client);\n\tbt_gatt_client_unregister_notify(gatt, client->notify_id);\n\tupdate_notifying(chrc);\n\n\tnotify_client_unref(client);\n\n\treturn dbus_message_new_method_return(msg);\n}"
  },
  {
    "function_name": "characteristic_start_notify",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "1510-1579",
    "snippet": "static DBusMessage *characteristic_start_notify(DBusConnection *conn,\n\t\t\t\t\tDBusMessage *msg, void *user_data)\n{\n\tstruct characteristic *chrc = user_data;\n\tstruct bt_gatt_client *gatt = chrc->service->client->gatt;\n\tconst char *sender = dbus_message_get_sender(msg);\n\tstruct async_dbus_op *op;\n\tstruct notify_client *client;\n\n\tif (chrc->notify_io)\n\t\treturn btd_error_not_permitted(msg, \"Notify acquired\");\n\n\tif (!(chrc->props & BT_GATT_CHRC_PROP_NOTIFY ||\n\t\t\t\tchrc->props & BT_GATT_CHRC_PROP_INDICATE))\n\t\treturn btd_error_not_supported(msg);\n\n\t/* Each client can only have one active notify session. */\n\tclient = queue_find(chrc->notify_clients, match_notify_sender, sender);\n\tif (client)\n\t\treturn client->notify_id ?\n\t\t\t\tg_dbus_create_reply(msg, DBUS_TYPE_INVALID) :\n\t\t\t\tbtd_error_in_progress(msg);\n\n\tclient = notify_client_create(chrc, sender);\n\tif (!client)\n\t\treturn btd_error_failed(msg, \"Failed allocate notify session\");\n\n\tqueue_push_tail(chrc->notify_clients, client);\n\tqueue_push_tail(chrc->service->client->all_notify_clients, client);\n\n\t/*\n\t * If the device is currently not connected, return success. We will\n\t * automatically try and register all clients when a GATT client becomes\n\t * ready.\n\t */\n\tif (!gatt) {\n\t\tDBusMessage *reply;\n\n\t\treply = g_dbus_create_reply(msg, DBUS_TYPE_INVALID);\n\t\tif (reply)\n\t\t\treturn reply;\n\n\t\t/*\n\t\t * Clean up and respond with an error instead of timing out to\n\t\t * avoid any ambiguities.\n\t\t */\n\t\terror(\"Failed to construct D-Bus message reply\");\n\t\tgoto fail;\n\t}\n\n\top = async_dbus_op_new(msg, client);\n\n\tclient->notify_id = bt_gatt_client_register_notify(gatt,\n\t\t\t\t\t\tchrc->value_handle,\n\t\t\t\t\t\tregister_notify_cb, notify_cb,\n\t\t\t\t\t\top, async_dbus_op_free);\n\tif (client->notify_id)\n\t\treturn NULL;\n\n\tasync_dbus_op_free(op);\n\nfail:\n\tqueue_remove(chrc->notify_clients, client);\n\tqueue_remove(chrc->service->client->all_notify_clients, client);\n\n\t/* Directly free the client */\n\tnotify_client_free(client);\n\n\treturn btd_error_failed(msg, \"Failed to register notify session\");\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "btd_error_failed",
          "args": [
            "msg",
            "\"Failed to register notify session\""
          ],
          "line": 1578
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "124-128",
          "snippet": "DBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "notify_client_free",
          "args": [
            "client"
          ],
          "line": 1576
        },
        "resolved": true,
        "details": {
          "function_name": "notify_client_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "1256-1265",
          "snippet": "static void notify_client_free(struct notify_client *client)\n{\n\tDBG(\"owner %s\", client->owner);\n\n\tg_dbus_remove_watch(btd_get_dbus_connection(), client->watch);\n\tbt_gatt_client_unregister_notify(client->chrc->service->client->gatt,\n\t\t\t\t\t\t\tclient->notify_id);\n\tfree(client->owner);\n\tfree(client);\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void notify_client_free(struct notify_client *client)\n{\n\tDBG(\"owner %s\", client->owner);\n\n\tg_dbus_remove_watch(btd_get_dbus_connection(), client->watch);\n\tbt_gatt_client_unregister_notify(client->chrc->service->client->gatt,\n\t\t\t\t\t\t\tclient->notify_id);\n\tfree(client->owner);\n\tfree(client);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_remove",
          "args": [
            "chrc->service->client->all_notify_clients",
            "client"
          ],
          "line": 1573
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_uuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "526-541",
          "snippet": "static bool queue_remove_uuid(struct queue *queue, bt_uuid_t *uuid)\n{\n\tbt_uuid_t *removed;\n\n\tif (!queue || !uuid)\n\t\treturn false;\n\n\tremoved = queue_remove_if(queue, uuid_match, uuid);\n\n\tif (removed) {\n\t\tfree(removed);\n\t\treturn true;\n\t}\n\n\treturn false;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic bool queue_remove_uuid(struct queue *queue, bt_uuid_t *uuid)\n{\n\tbt_uuid_t *removed;\n\n\tif (!queue || !uuid)\n\t\treturn false;\n\n\tremoved = queue_remove_if(queue, uuid_match, uuid);\n\n\tif (removed) {\n\t\tfree(removed);\n\t\treturn true;\n\t}\n\n\treturn false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "async_dbus_op_free",
          "args": [
            "op"
          ],
          "line": 1569
        },
        "resolved": true,
        "details": {
          "function_name": "async_dbus_op_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "235-242",
          "snippet": "static void async_dbus_op_free(void *data)\n{\n\tstruct async_dbus_op *op = data;\n\n\tqueue_destroy(op->msgs, (void *)dbus_message_unref);\n\n\tfree(op);\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void async_dbus_op_free(void *data)\n{\n\tstruct async_dbus_op *op = data;\n\n\tqueue_destroy(op->msgs, (void *)dbus_message_unref);\n\n\tfree(op);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_gatt_client_register_notify",
          "args": [
            "gatt",
            "chrc->value_handle",
            "register_notify_cb",
            "notify_cb",
            "op",
            "async_dbus_op_free"
          ],
          "line": 1562
        },
        "resolved": true,
        "details": {
          "function_name": "bt_gatt_client_register_notify",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-client.c",
          "lines": "3237-3252",
          "snippet": "unsigned int bt_gatt_client_register_notify(struct bt_gatt_client *client,\n\t\t\t\tuint16_t chrc_value_handle,\n\t\t\t\tbt_gatt_client_register_callback_t callback,\n\t\t\t\tbt_gatt_client_notify_callback_t notify,\n\t\t\t\tvoid *user_data,\n\t\t\t\tbt_gatt_client_destroy_func_t destroy)\n{\n\tif (!client || !client->db || !chrc_value_handle || !callback)\n\t\treturn 0;\n\n\tif (client->in_svc_chngd)\n\t\treturn 0;\n\n\treturn register_notify(client, chrc_value_handle, callback, notify,\n\t\t\t\t\t\t\tuser_data, destroy);\n}",
          "includes": [
            "#include <sys/uio.h>",
            "#include <limits.h>",
            "#include <assert.h>",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-helpers.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/att.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void discover_chrcs_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\t\tstruct bt_gatt_result *result,\n\t\t\t\t\t\tvoid *user_data);",
            "static void discover_descs_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\t\tstruct bt_gatt_result *result,\n\t\t\t\t\t\tvoid *user_data);",
            "static void ext_prop_read_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\tconst uint8_t *value, uint16_t length,\n\t\t\t\t\tvoid *user_data);",
            "static void service_changed_cb(uint16_t value_handle, const uint8_t *value,\n\t\t\t\t\tuint16_t length, void *user_data);",
            "static void prepare_write_cb(uint8_t opcode, const void *pdu, uint16_t length,\n\t\t\t\t\t\t\tvoid *user_data);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <sys/uio.h>\n#include <limits.h>\n#include <assert.h>\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-helpers.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/att.h\"\n#include <config.h>\n\nstatic void discover_chrcs_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\t\tstruct bt_gatt_result *result,\n\t\t\t\t\t\tvoid *user_data);\nstatic void discover_descs_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\t\tstruct bt_gatt_result *result,\n\t\t\t\t\t\tvoid *user_data);\nstatic void ext_prop_read_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\tconst uint8_t *value, uint16_t length,\n\t\t\t\t\tvoid *user_data);\nstatic void service_changed_cb(uint16_t value_handle, const uint8_t *value,\n\t\t\t\t\tuint16_t length, void *user_data);\nstatic void prepare_write_cb(uint8_t opcode, const void *pdu, uint16_t length,\n\t\t\t\t\t\t\tvoid *user_data);\n\nunsigned int bt_gatt_client_register_notify(struct bt_gatt_client *client,\n\t\t\t\tuint16_t chrc_value_handle,\n\t\t\t\tbt_gatt_client_register_callback_t callback,\n\t\t\t\tbt_gatt_client_notify_callback_t notify,\n\t\t\t\tvoid *user_data,\n\t\t\t\tbt_gatt_client_destroy_func_t destroy)\n{\n\tif (!client || !client->db || !chrc_value_handle || !callback)\n\t\treturn 0;\n\n\tif (client->in_svc_chngd)\n\t\treturn 0;\n\n\treturn register_notify(client, chrc_value_handle, callback, notify,\n\t\t\t\t\t\t\tuser_data, destroy);\n}"
        }
      },
      {
        "call_info": {
          "callee": "async_dbus_op_new",
          "args": [
            "msg",
            "client"
          ],
          "line": 1560
        },
        "resolved": true,
        "details": {
          "function_name": "async_dbus_op_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "424-434",
          "snippet": "static struct async_dbus_op *async_dbus_op_new(DBusMessage *msg, void *data)\n{\n\tstruct async_dbus_op *op;\n\n\top = new0(struct async_dbus_op, 1);\n\top->msgs = queue_new();\n\tqueue_push_tail(op->msgs, dbus_message_ref(msg));\n\top->data = data;\n\n\treturn op;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic struct async_dbus_op *async_dbus_op_new(DBusMessage *msg, void *data)\n{\n\tstruct async_dbus_op *op;\n\n\top = new0(struct async_dbus_op, 1);\n\top->msgs = queue_new();\n\tqueue_push_tail(op->msgs, dbus_message_ref(msg));\n\top->data = data;\n\n\treturn op;\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Failed to construct D-Bus message reply\""
          ],
          "line": 1556
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_not_ready",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "118-122",
          "snippet": "DBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_create_reply",
          "args": [
            "msg",
            "DBUS_TYPE_INVALID"
          ],
          "line": 1548
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "queue_push_tail",
          "args": [
            "chrc->service->client->all_notify_clients",
            "client"
          ],
          "line": 1538
        },
        "resolved": true,
        "details": {
          "function_name": "queue_push_tail",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "88-108",
          "snippet": "bool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "notify_client_create",
          "args": [
            "chrc",
            "sender"
          ],
          "line": 1533
        },
        "resolved": true,
        "details": {
          "function_name": "notify_client_create",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "1325-1348",
          "snippet": "static struct notify_client *notify_client_create(struct characteristic *chrc,\n\t\t\t\t\t\t\tconst char *owner)\n{\n\tstruct notify_client *client;\n\n\tclient = new0(struct notify_client, 1);\n\tclient->chrc = chrc;\n\tclient->owner = strdup(owner);\n\tif (!client->owner) {\n\t\tfree(client);\n\t\treturn NULL;\n\t}\n\n\tclient->watch = g_dbus_add_disconnect_watch(btd_get_dbus_connection(),\n\t\t\t\t\t\towner, notify_client_disconnect,\n\t\t\t\t\t\tclient, NULL);\n\tif (!client->watch) {\n\t\tfree(client->owner);\n\t\tfree(client);\n\t\treturn NULL;\n\t}\n\n\treturn notify_client_ref(client);\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic struct notify_client *notify_client_create(struct characteristic *chrc,\n\t\t\t\t\t\t\tconst char *owner)\n{\n\tstruct notify_client *client;\n\n\tclient = new0(struct notify_client, 1);\n\tclient->chrc = chrc;\n\tclient->owner = strdup(owner);\n\tif (!client->owner) {\n\t\tfree(client);\n\t\treturn NULL;\n\t}\n\n\tclient->watch = g_dbus_add_disconnect_watch(btd_get_dbus_connection(),\n\t\t\t\t\t\towner, notify_client_disconnect,\n\t\t\t\t\t\tclient, NULL);\n\tif (!client->watch) {\n\t\tfree(client->owner);\n\t\tfree(client);\n\t\treturn NULL;\n\t}\n\n\treturn notify_client_ref(client);\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_error_in_progress",
          "args": [
            "msg"
          ],
          "line": 1531
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_in_progress",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "76-80",
          "snippet": "DBusMessage *btd_error_in_progress(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".InProgress\",\n\t\t\t\t\t\"In Progress\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_in_progress(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".InProgress\",\n\t\t\t\t\t\"In Progress\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_create_reply",
          "args": [
            "msg",
            "DBUS_TYPE_INVALID"
          ],
          "line": 1530
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "queue_find",
          "args": [
            "chrc->notify_clients",
            "match_notify_sender",
            "sender"
          ],
          "line": 1527
        },
        "resolved": true,
        "details": {
          "function_name": "queue_find",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "231-247",
          "snippet": "void *queue_find(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tconst void *match_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tfor (entry = queue->head; entry; entry = entry->next)\n\t\tif (function(entry->data, match_data))\n\t\t\treturn entry->data;\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid *queue_find(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tconst void *match_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tfor (entry = queue->head; entry; entry = entry->next)\n\t\tif (function(entry->data, match_data))\n\t\t\treturn entry->data;\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_error_not_supported",
          "args": [
            "msg"
          ],
          "line": 1524
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_not_supported",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "58-62",
          "snippet": "DBusMessage *btd_error_not_supported(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotSupported\",\n\t\t\t\t\t\"Operation is not supported\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_not_supported(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotSupported\",\n\t\t\t\t\t\"Operation is not supported\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_error_not_permitted",
          "args": [
            "msg",
            "\"Notify acquired\""
          ],
          "line": 1520
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_not_permitted",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "100-104",
          "snippet": "DBusMessage *btd_error_not_permitted(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotPermitted\",\n\t\t\t\t\t\"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_not_permitted(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotPermitted\",\n\t\t\t\t\t\"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_get_sender",
          "args": [
            "msg"
          ],
          "line": 1515
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic DBusMessage *characteristic_start_notify(DBusConnection *conn,\n\t\t\t\t\tDBusMessage *msg, void *user_data)\n{\n\tstruct characteristic *chrc = user_data;\n\tstruct bt_gatt_client *gatt = chrc->service->client->gatt;\n\tconst char *sender = dbus_message_get_sender(msg);\n\tstruct async_dbus_op *op;\n\tstruct notify_client *client;\n\n\tif (chrc->notify_io)\n\t\treturn btd_error_not_permitted(msg, \"Notify acquired\");\n\n\tif (!(chrc->props & BT_GATT_CHRC_PROP_NOTIFY ||\n\t\t\t\tchrc->props & BT_GATT_CHRC_PROP_INDICATE))\n\t\treturn btd_error_not_supported(msg);\n\n\t/* Each client can only have one active notify session. */\n\tclient = queue_find(chrc->notify_clients, match_notify_sender, sender);\n\tif (client)\n\t\treturn client->notify_id ?\n\t\t\t\tg_dbus_create_reply(msg, DBUS_TYPE_INVALID) :\n\t\t\t\tbtd_error_in_progress(msg);\n\n\tclient = notify_client_create(chrc, sender);\n\tif (!client)\n\t\treturn btd_error_failed(msg, \"Failed allocate notify session\");\n\n\tqueue_push_tail(chrc->notify_clients, client);\n\tqueue_push_tail(chrc->service->client->all_notify_clients, client);\n\n\t/*\n\t * If the device is currently not connected, return success. We will\n\t * automatically try and register all clients when a GATT client becomes\n\t * ready.\n\t */\n\tif (!gatt) {\n\t\tDBusMessage *reply;\n\n\t\treply = g_dbus_create_reply(msg, DBUS_TYPE_INVALID);\n\t\tif (reply)\n\t\t\treturn reply;\n\n\t\t/*\n\t\t * Clean up and respond with an error instead of timing out to\n\t\t * avoid any ambiguities.\n\t\t */\n\t\terror(\"Failed to construct D-Bus message reply\");\n\t\tgoto fail;\n\t}\n\n\top = async_dbus_op_new(msg, client);\n\n\tclient->notify_id = bt_gatt_client_register_notify(gatt,\n\t\t\t\t\t\tchrc->value_handle,\n\t\t\t\t\t\tregister_notify_cb, notify_cb,\n\t\t\t\t\t\top, async_dbus_op_free);\n\tif (client->notify_id)\n\t\treturn NULL;\n\n\tasync_dbus_op_free(op);\n\nfail:\n\tqueue_remove(chrc->notify_clients, client);\n\tqueue_remove(chrc->service->client->all_notify_clients, client);\n\n\t/* Directly free the client */\n\tnotify_client_free(client);\n\n\treturn btd_error_failed(msg, \"Failed to register notify session\");\n}"
  },
  {
    "function_name": "characteristic_acquire_notify",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "1465-1508",
    "snippet": "static DBusMessage *characteristic_acquire_notify(DBusConnection *conn,\n\t\t\t\t\tDBusMessage *msg, void *user_data)\n{\n\tstruct characteristic *chrc = user_data;\n\tstruct bt_gatt_client *gatt = chrc->service->client->gatt;\n\tconst char *sender = dbus_message_get_sender(msg);\n\tstruct notify_client *client;\n\n\tif (!gatt)\n\t\treturn btd_error_failed(msg, \"Not connected\");\n\n\tif (chrc->notify_io)\n\t\treturn btd_error_not_permitted(msg, \"Notify acquired\");\n\n\t/* Each client can only have one active notify session. */\n\tif (!queue_isempty(chrc->notify_clients))\n\t\treturn btd_error_in_progress(msg);\n\n\tif (!(chrc->props & BT_GATT_CHRC_PROP_NOTIFY))\n\t\treturn btd_error_not_supported(msg);\n\n\tclient = notify_client_create(chrc, sender);\n\tif (!client)\n\t\treturn btd_error_failed(msg, \"Failed allocate notify session\");\n\n\tclient->notify_id = bt_gatt_client_register_notify(gatt,\n\t\t\t\t\t\tchrc->value_handle,\n\t\t\t\t\t\tregister_notify_io_cb,\n\t\t\t\t\t\tnotify_io_cb,\n\t\t\t\t\t\tclient, NULL);\n\tif (!client->notify_id) {\n\t\tnotify_client_unref(client);\n\t\treturn btd_error_failed(msg, \"Failed to subscribe\");\n\t}\n\n\tqueue_push_tail(chrc->notify_clients, client);\n\n\tchrc->notify_io = new0(struct pipe_io, 1);\n\tchrc->notify_io->data = client;\n\tchrc->notify_io->msg = dbus_message_ref(msg);\n\tchrc->notify_io->destroy = notify_io_destroy;\n\n\treturn NULL;\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_ref",
          "args": [
            "msg"
          ],
          "line": 1504
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "new0",
          "args": [
            "structpipe_io",
            "1"
          ],
          "line": 1502
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "queue_push_tail",
          "args": [
            "chrc->notify_clients",
            "client"
          ],
          "line": 1500
        },
        "resolved": true,
        "details": {
          "function_name": "queue_push_tail",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "88-108",
          "snippet": "bool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_error_failed",
          "args": [
            "msg",
            "\"Failed to subscribe\""
          ],
          "line": 1497
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "124-128",
          "snippet": "DBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "notify_client_unref",
          "args": [
            "client"
          ],
          "line": 1496
        },
        "resolved": true,
        "details": {
          "function_name": "notify_client_unref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "1267-1277",
          "snippet": "static void notify_client_unref(void *data)\n{\n\tstruct notify_client *client = data;\n\n\tDBG(\"owner %s\", client->owner);\n\n\tif (__sync_sub_and_fetch(&client->ref_count, 1))\n\t\treturn;\n\n\tnotify_client_free(client);\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void notify_client_unref(void *data)\n{\n\tstruct notify_client *client = data;\n\n\tDBG(\"owner %s\", client->owner);\n\n\tif (__sync_sub_and_fetch(&client->ref_count, 1))\n\t\treturn;\n\n\tnotify_client_free(client);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_gatt_client_register_notify",
          "args": [
            "gatt",
            "chrc->value_handle",
            "register_notify_io_cb",
            "notify_io_cb",
            "client",
            "NULL"
          ],
          "line": 1490
        },
        "resolved": true,
        "details": {
          "function_name": "bt_gatt_client_register_notify",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-client.c",
          "lines": "3237-3252",
          "snippet": "unsigned int bt_gatt_client_register_notify(struct bt_gatt_client *client,\n\t\t\t\tuint16_t chrc_value_handle,\n\t\t\t\tbt_gatt_client_register_callback_t callback,\n\t\t\t\tbt_gatt_client_notify_callback_t notify,\n\t\t\t\tvoid *user_data,\n\t\t\t\tbt_gatt_client_destroy_func_t destroy)\n{\n\tif (!client || !client->db || !chrc_value_handle || !callback)\n\t\treturn 0;\n\n\tif (client->in_svc_chngd)\n\t\treturn 0;\n\n\treturn register_notify(client, chrc_value_handle, callback, notify,\n\t\t\t\t\t\t\tuser_data, destroy);\n}",
          "includes": [
            "#include <sys/uio.h>",
            "#include <limits.h>",
            "#include <assert.h>",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-helpers.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/att.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void discover_chrcs_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\t\tstruct bt_gatt_result *result,\n\t\t\t\t\t\tvoid *user_data);",
            "static void discover_descs_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\t\tstruct bt_gatt_result *result,\n\t\t\t\t\t\tvoid *user_data);",
            "static void ext_prop_read_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\tconst uint8_t *value, uint16_t length,\n\t\t\t\t\tvoid *user_data);",
            "static void service_changed_cb(uint16_t value_handle, const uint8_t *value,\n\t\t\t\t\tuint16_t length, void *user_data);",
            "static void prepare_write_cb(uint8_t opcode, const void *pdu, uint16_t length,\n\t\t\t\t\t\t\tvoid *user_data);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <sys/uio.h>\n#include <limits.h>\n#include <assert.h>\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-helpers.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/att.h\"\n#include <config.h>\n\nstatic void discover_chrcs_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\t\tstruct bt_gatt_result *result,\n\t\t\t\t\t\tvoid *user_data);\nstatic void discover_descs_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\t\tstruct bt_gatt_result *result,\n\t\t\t\t\t\tvoid *user_data);\nstatic void ext_prop_read_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\tconst uint8_t *value, uint16_t length,\n\t\t\t\t\tvoid *user_data);\nstatic void service_changed_cb(uint16_t value_handle, const uint8_t *value,\n\t\t\t\t\tuint16_t length, void *user_data);\nstatic void prepare_write_cb(uint8_t opcode, const void *pdu, uint16_t length,\n\t\t\t\t\t\t\tvoid *user_data);\n\nunsigned int bt_gatt_client_register_notify(struct bt_gatt_client *client,\n\t\t\t\tuint16_t chrc_value_handle,\n\t\t\t\tbt_gatt_client_register_callback_t callback,\n\t\t\t\tbt_gatt_client_notify_callback_t notify,\n\t\t\t\tvoid *user_data,\n\t\t\t\tbt_gatt_client_destroy_func_t destroy)\n{\n\tif (!client || !client->db || !chrc_value_handle || !callback)\n\t\treturn 0;\n\n\tif (client->in_svc_chngd)\n\t\treturn 0;\n\n\treturn register_notify(client, chrc_value_handle, callback, notify,\n\t\t\t\t\t\t\tuser_data, destroy);\n}"
        }
      },
      {
        "call_info": {
          "callee": "notify_client_create",
          "args": [
            "chrc",
            "sender"
          ],
          "line": 1486
        },
        "resolved": true,
        "details": {
          "function_name": "notify_client_create",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "1325-1348",
          "snippet": "static struct notify_client *notify_client_create(struct characteristic *chrc,\n\t\t\t\t\t\t\tconst char *owner)\n{\n\tstruct notify_client *client;\n\n\tclient = new0(struct notify_client, 1);\n\tclient->chrc = chrc;\n\tclient->owner = strdup(owner);\n\tif (!client->owner) {\n\t\tfree(client);\n\t\treturn NULL;\n\t}\n\n\tclient->watch = g_dbus_add_disconnect_watch(btd_get_dbus_connection(),\n\t\t\t\t\t\towner, notify_client_disconnect,\n\t\t\t\t\t\tclient, NULL);\n\tif (!client->watch) {\n\t\tfree(client->owner);\n\t\tfree(client);\n\t\treturn NULL;\n\t}\n\n\treturn notify_client_ref(client);\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic struct notify_client *notify_client_create(struct characteristic *chrc,\n\t\t\t\t\t\t\tconst char *owner)\n{\n\tstruct notify_client *client;\n\n\tclient = new0(struct notify_client, 1);\n\tclient->chrc = chrc;\n\tclient->owner = strdup(owner);\n\tif (!client->owner) {\n\t\tfree(client);\n\t\treturn NULL;\n\t}\n\n\tclient->watch = g_dbus_add_disconnect_watch(btd_get_dbus_connection(),\n\t\t\t\t\t\towner, notify_client_disconnect,\n\t\t\t\t\t\tclient, NULL);\n\tif (!client->watch) {\n\t\tfree(client->owner);\n\t\tfree(client);\n\t\treturn NULL;\n\t}\n\n\treturn notify_client_ref(client);\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_error_not_supported",
          "args": [
            "msg"
          ],
          "line": 1484
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_not_supported",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "58-62",
          "snippet": "DBusMessage *btd_error_not_supported(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotSupported\",\n\t\t\t\t\t\"Operation is not supported\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_not_supported(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotSupported\",\n\t\t\t\t\t\"Operation is not supported\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_error_in_progress",
          "args": [
            "msg"
          ],
          "line": 1481
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_in_progress",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "76-80",
          "snippet": "DBusMessage *btd_error_in_progress(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".InProgress\",\n\t\t\t\t\t\"In Progress\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_in_progress(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".InProgress\",\n\t\t\t\t\t\"In Progress\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_isempty",
          "args": [
            "chrc->notify_clients"
          ],
          "line": 1480
        },
        "resolved": true,
        "details": {
          "function_name": "queue_isempty",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "380-386",
          "snippet": "bool queue_isempty(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn true;\n\n\treturn queue->entries == 0;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_isempty(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn true;\n\n\treturn queue->entries == 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_error_not_permitted",
          "args": [
            "msg",
            "\"Notify acquired\""
          ],
          "line": 1477
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_not_permitted",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "100-104",
          "snippet": "DBusMessage *btd_error_not_permitted(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotPermitted\",\n\t\t\t\t\t\"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_not_permitted(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotPermitted\",\n\t\t\t\t\t\"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_get_sender",
          "args": [
            "msg"
          ],
          "line": 1470
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic DBusMessage *characteristic_acquire_notify(DBusConnection *conn,\n\t\t\t\t\tDBusMessage *msg, void *user_data)\n{\n\tstruct characteristic *chrc = user_data;\n\tstruct bt_gatt_client *gatt = chrc->service->client->gatt;\n\tconst char *sender = dbus_message_get_sender(msg);\n\tstruct notify_client *client;\n\n\tif (!gatt)\n\t\treturn btd_error_failed(msg, \"Not connected\");\n\n\tif (chrc->notify_io)\n\t\treturn btd_error_not_permitted(msg, \"Notify acquired\");\n\n\t/* Each client can only have one active notify session. */\n\tif (!queue_isempty(chrc->notify_clients))\n\t\treturn btd_error_in_progress(msg);\n\n\tif (!(chrc->props & BT_GATT_CHRC_PROP_NOTIFY))\n\t\treturn btd_error_not_supported(msg);\n\n\tclient = notify_client_create(chrc, sender);\n\tif (!client)\n\t\treturn btd_error_failed(msg, \"Failed allocate notify session\");\n\n\tclient->notify_id = bt_gatt_client_register_notify(gatt,\n\t\t\t\t\t\tchrc->value_handle,\n\t\t\t\t\t\tregister_notify_io_cb,\n\t\t\t\t\t\tnotify_io_cb,\n\t\t\t\t\t\tclient, NULL);\n\tif (!client->notify_id) {\n\t\tnotify_client_unref(client);\n\t\treturn btd_error_failed(msg, \"Failed to subscribe\");\n\t}\n\n\tqueue_push_tail(chrc->notify_clients, client);\n\n\tchrc->notify_io = new0(struct pipe_io, 1);\n\tchrc->notify_io->data = client;\n\tchrc->notify_io->msg = dbus_message_ref(msg);\n\tchrc->notify_io->destroy = notify_io_destroy;\n\n\treturn NULL;\n}"
  },
  {
    "function_name": "notify_io_destroy",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "1457-1463",
    "snippet": "static void notify_io_destroy(void *data)\n{\n\tstruct notify_client *client = data;\n\n\tif (queue_remove(client->chrc->notify_clients, client))\n\t\tnotify_client_unref(client);\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "notify_client_unref",
          "args": [
            "client"
          ],
          "line": 1462
        },
        "resolved": true,
        "details": {
          "function_name": "notify_client_unref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "1267-1277",
          "snippet": "static void notify_client_unref(void *data)\n{\n\tstruct notify_client *client = data;\n\n\tDBG(\"owner %s\", client->owner);\n\n\tif (__sync_sub_and_fetch(&client->ref_count, 1))\n\t\treturn;\n\n\tnotify_client_free(client);\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void notify_client_unref(void *data)\n{\n\tstruct notify_client *client = data;\n\n\tDBG(\"owner %s\", client->owner);\n\n\tif (__sync_sub_and_fetch(&client->ref_count, 1))\n\t\treturn;\n\n\tnotify_client_free(client);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_remove",
          "args": [
            "client->chrc->notify_clients",
            "client"
          ],
          "line": 1461
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_uuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "526-541",
          "snippet": "static bool queue_remove_uuid(struct queue *queue, bt_uuid_t *uuid)\n{\n\tbt_uuid_t *removed;\n\n\tif (!queue || !uuid)\n\t\treturn false;\n\n\tremoved = queue_remove_if(queue, uuid_match, uuid);\n\n\tif (removed) {\n\t\tfree(removed);\n\t\treturn true;\n\t}\n\n\treturn false;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic bool queue_remove_uuid(struct queue *queue, bt_uuid_t *uuid)\n{\n\tbt_uuid_t *removed;\n\n\tif (!queue || !uuid)\n\t\treturn false;\n\n\tremoved = queue_remove_if(queue, uuid_match, uuid);\n\n\tif (removed) {\n\t\tfree(removed);\n\t\treturn true;\n\t}\n\n\treturn false;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void notify_io_destroy(void *data)\n{\n\tstruct notify_client *client = data;\n\n\tif (queue_remove(client->chrc->notify_clients, client))\n\t\tnotify_client_unref(client);\n}"
  },
  {
    "function_name": "register_notify_io_cb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "1434-1455",
    "snippet": "static void register_notify_io_cb(uint16_t att_ecode, void *user_data)\n{\n\tstruct notify_client *client = user_data;\n\tstruct characteristic *chrc = client->chrc;\n\tstruct bt_gatt_client *gatt = chrc->service->client->gatt;\n\n\tif (att_ecode) {\n\t\tqueue_remove(chrc->notify_clients, client);\n\t\tnotify_client_free(client);\n\t\treturn;\n\t}\n\n\tif (!bt_gatt_client_is_ready(gatt)) {\n\t\tif (!chrc->ready_id)\n\t\t\tchrc->ready_id = bt_gatt_client_ready_register(gatt,\n\t\t\t\t\t\t\tcharacteristic_ready,\n\t\t\t\t\t\t\tchrc, NULL);\n\t\treturn;\n\t}\n\n\tcharacteristic_ready(true, 0, chrc);\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "characteristic_ready",
          "args": [
            "true",
            "0",
            "chrc"
          ],
          "line": 1454
        },
        "resolved": true,
        "details": {
          "function_name": "characteristic_ready",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "1192-1216",
          "snippet": "static void characteristic_ready(bool success, uint8_t ecode, void *user_data)\n{\n\tstruct characteristic *chrc = user_data;\n\tDBusMessage *reply;\n\n\tchrc->ready_id = 0;\n\n\tif (chrc->write_io && chrc->write_io->msg) {\n\t\treply = characteristic_create_pipe(chrc, chrc->write_io->msg);\n\n\t\tg_dbus_send_message(btd_get_dbus_connection(), reply);\n\n\t\tdbus_message_unref(chrc->write_io->msg);\n\t\tchrc->write_io->msg = NULL;\n\t}\n\n\tif (chrc->notify_io && chrc->notify_io->msg) {\n\t\treply = characteristic_create_pipe(chrc, chrc->notify_io->msg);\n\n\t\tg_dbus_send_message(btd_get_dbus_connection(), reply);\n\n\t\tdbus_message_unref(chrc->notify_io->msg);\n\t\tchrc->notify_io->msg = NULL;\n\t}\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void characteristic_ready(bool success, uint8_t ecode, void *user_data)\n{\n\tstruct characteristic *chrc = user_data;\n\tDBusMessage *reply;\n\n\tchrc->ready_id = 0;\n\n\tif (chrc->write_io && chrc->write_io->msg) {\n\t\treply = characteristic_create_pipe(chrc, chrc->write_io->msg);\n\n\t\tg_dbus_send_message(btd_get_dbus_connection(), reply);\n\n\t\tdbus_message_unref(chrc->write_io->msg);\n\t\tchrc->write_io->msg = NULL;\n\t}\n\n\tif (chrc->notify_io && chrc->notify_io->msg) {\n\t\treply = characteristic_create_pipe(chrc, chrc->notify_io->msg);\n\n\t\tg_dbus_send_message(btd_get_dbus_connection(), reply);\n\n\t\tdbus_message_unref(chrc->notify_io->msg);\n\t\tchrc->notify_io->msg = NULL;\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_gatt_client_ready_register",
          "args": [
            "gatt",
            "characteristic_ready",
            "chrc",
            "NULL"
          ],
          "line": 1448
        },
        "resolved": true,
        "details": {
          "function_name": "bt_gatt_client_ready_register",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-client.c",
          "lines": "2020-2038",
          "snippet": "unsigned int bt_gatt_client_ready_register(struct bt_gatt_client *client,\n\t\t\t\t\tbt_gatt_client_callback_t callback,\n\t\t\t\t\tvoid *user_data,\n\t\t\t\t\tbt_gatt_client_destroy_func_t destroy)\n{\n\tstruct ready_cb *ready;\n\n\tif (!client)\n\t\treturn 0;\n\n\tready = new0(struct ready_cb, 1);\n\tready->callback = callback;\n\tready->destroy = destroy;\n\tready->data = user_data;\n\n\tqueue_push_tail(client->ready_cbs, ready);\n\n\treturn PTR_TO_UINT(ready);\n}",
          "includes": [
            "#include <sys/uio.h>",
            "#include <limits.h>",
            "#include <assert.h>",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-helpers.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/att.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void discover_chrcs_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\t\tstruct bt_gatt_result *result,\n\t\t\t\t\t\tvoid *user_data);",
            "static void discover_descs_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\t\tstruct bt_gatt_result *result,\n\t\t\t\t\t\tvoid *user_data);",
            "static void ext_prop_read_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\tconst uint8_t *value, uint16_t length,\n\t\t\t\t\tvoid *user_data);",
            "static void service_changed_cb(uint16_t value_handle, const uint8_t *value,\n\t\t\t\t\tuint16_t length, void *user_data);",
            "static void prepare_write_cb(uint8_t opcode, const void *pdu, uint16_t length,\n\t\t\t\t\t\t\tvoid *user_data);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <sys/uio.h>\n#include <limits.h>\n#include <assert.h>\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-helpers.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/att.h\"\n#include <config.h>\n\nstatic void discover_chrcs_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\t\tstruct bt_gatt_result *result,\n\t\t\t\t\t\tvoid *user_data);\nstatic void discover_descs_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\t\tstruct bt_gatt_result *result,\n\t\t\t\t\t\tvoid *user_data);\nstatic void ext_prop_read_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\tconst uint8_t *value, uint16_t length,\n\t\t\t\t\tvoid *user_data);\nstatic void service_changed_cb(uint16_t value_handle, const uint8_t *value,\n\t\t\t\t\tuint16_t length, void *user_data);\nstatic void prepare_write_cb(uint8_t opcode, const void *pdu, uint16_t length,\n\t\t\t\t\t\t\tvoid *user_data);\n\nunsigned int bt_gatt_client_ready_register(struct bt_gatt_client *client,\n\t\t\t\t\tbt_gatt_client_callback_t callback,\n\t\t\t\t\tvoid *user_data,\n\t\t\t\t\tbt_gatt_client_destroy_func_t destroy)\n{\n\tstruct ready_cb *ready;\n\n\tif (!client)\n\t\treturn 0;\n\n\tready = new0(struct ready_cb, 1);\n\tready->callback = callback;\n\tready->destroy = destroy;\n\tready->data = user_data;\n\n\tqueue_push_tail(client->ready_cbs, ready);\n\n\treturn PTR_TO_UINT(ready);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_gatt_client_is_ready",
          "args": [
            "gatt"
          ],
          "line": 1446
        },
        "resolved": true,
        "details": {
          "function_name": "bt_gatt_client_is_ready",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-client.c",
          "lines": "2015-2018",
          "snippet": "bool bt_gatt_client_is_ready(struct bt_gatt_client *client)\n{\n\treturn (client && client->ready);\n}",
          "includes": [
            "#include <sys/uio.h>",
            "#include <limits.h>",
            "#include <assert.h>",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-helpers.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/att.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/uio.h>\n#include <limits.h>\n#include <assert.h>\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-helpers.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/att.h\"\n#include <config.h>\n\nbool bt_gatt_client_is_ready(struct bt_gatt_client *client)\n{\n\treturn (client && client->ready);\n}"
        }
      },
      {
        "call_info": {
          "callee": "notify_client_free",
          "args": [
            "client"
          ],
          "line": 1442
        },
        "resolved": true,
        "details": {
          "function_name": "notify_client_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "1256-1265",
          "snippet": "static void notify_client_free(struct notify_client *client)\n{\n\tDBG(\"owner %s\", client->owner);\n\n\tg_dbus_remove_watch(btd_get_dbus_connection(), client->watch);\n\tbt_gatt_client_unregister_notify(client->chrc->service->client->gatt,\n\t\t\t\t\t\t\tclient->notify_id);\n\tfree(client->owner);\n\tfree(client);\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void notify_client_free(struct notify_client *client)\n{\n\tDBG(\"owner %s\", client->owner);\n\n\tg_dbus_remove_watch(btd_get_dbus_connection(), client->watch);\n\tbt_gatt_client_unregister_notify(client->chrc->service->client->gatt,\n\t\t\t\t\t\t\tclient->notify_id);\n\tfree(client->owner);\n\tfree(client);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_remove",
          "args": [
            "chrc->notify_clients",
            "client"
          ],
          "line": 1441
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_uuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "526-541",
          "snippet": "static bool queue_remove_uuid(struct queue *queue, bt_uuid_t *uuid)\n{\n\tbt_uuid_t *removed;\n\n\tif (!queue || !uuid)\n\t\treturn false;\n\n\tremoved = queue_remove_if(queue, uuid_match, uuid);\n\n\tif (removed) {\n\t\tfree(removed);\n\t\treturn true;\n\t}\n\n\treturn false;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic bool queue_remove_uuid(struct queue *queue, bt_uuid_t *uuid)\n{\n\tbt_uuid_t *removed;\n\n\tif (!queue || !uuid)\n\t\treturn false;\n\n\tremoved = queue_remove_if(queue, uuid_match, uuid);\n\n\tif (removed) {\n\t\tfree(removed);\n\t\treturn true;\n\t}\n\n\treturn false;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void register_notify_io_cb(uint16_t att_ecode, void *user_data)\n{\n\tstruct notify_client *client = user_data;\n\tstruct characteristic *chrc = client->chrc;\n\tstruct bt_gatt_client *gatt = chrc->service->client->gatt;\n\n\tif (att_ecode) {\n\t\tqueue_remove(chrc->notify_clients, client);\n\t\tnotify_client_free(client);\n\t\treturn;\n\t}\n\n\tif (!bt_gatt_client_is_ready(gatt)) {\n\t\tif (!chrc->ready_id)\n\t\t\tchrc->ready_id = bt_gatt_client_ready_register(gatt,\n\t\t\t\t\t\t\tcharacteristic_ready,\n\t\t\t\t\t\t\tchrc, NULL);\n\t\treturn;\n\t}\n\n\tcharacteristic_ready(true, 0, chrc);\n}"
  },
  {
    "function_name": "notify_io_cb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "1414-1432",
    "snippet": "static void notify_io_cb(uint16_t value_handle, const uint8_t *value,\n\t\t\t\t\tuint16_t length, void *user_data)\n{\n\tstruct iovec iov;\n\tstruct notify_client *client = user_data;\n\tstruct characteristic *chrc = client->chrc;\n\tint err;\n\n\t/* Drop notification if the pipe is not ready */\n\tif (!chrc->notify_io->io)\n\t\treturn;\n\n\tiov.iov_base = (void *) value;\n\tiov.iov_len = length;\n\n\terr = io_send(chrc->notify_io->io, &iov, 1);\n\tif (err < 0)\n\t\terror(\"io_send: %s\", strerror(-err));\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"io_send: %s\"",
            "strerror(-err)"
          ],
          "line": 1431
        },
        "resolved": true,
        "details": {
          "function_name": "create_gatt_dbus_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "273-301",
          "snippet": "static DBusMessage *create_gatt_dbus_error(DBusMessage *msg, uint8_t att_ecode)\n{\n\tswitch (att_ecode) {\n\tcase BT_ATT_ERROR_READ_NOT_PERMITTED:\n\t\treturn btd_error_not_permitted(msg, \"Read not permitted\");\n\tcase BT_ATT_ERROR_WRITE_NOT_PERMITTED:\n\t\treturn btd_error_not_permitted(msg, \"Write not permitted\");\n\tcase BT_ATT_ERROR_AUTHENTICATION:\n\tcase BT_ATT_ERROR_INSUFFICIENT_ENCRYPTION:\n\tcase BT_ATT_ERROR_INSUFFICIENT_ENCRYPTION_KEY_SIZE:\n\t\treturn btd_error_not_permitted(msg, \"Not paired\");\n\tcase BT_ATT_ERROR_INVALID_OFFSET:\n\t\treturn btd_error_invalid_args_str(msg, \"Invalid offset\");\n\tcase BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN:\n\t\treturn btd_error_invalid_args_str(msg, \"Invalid Length\");\n\tcase BT_ATT_ERROR_AUTHORIZATION:\n\t\treturn btd_error_not_authorized(msg);\n\tcase BT_ATT_ERROR_REQUEST_NOT_SUPPORTED:\n\t\treturn btd_error_not_supported(msg);\n\tcase 0:\n\t\treturn btd_error_failed(msg, \"Operation failed\");\n\tdefault:\n\t\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".Failed\",\n\t\t\t\t\"Operation failed with ATT error: 0x%02x\",\n\t\t\t\tatt_ecode);\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic DBusMessage *create_gatt_dbus_error(DBusMessage *msg, uint8_t att_ecode)\n{\n\tswitch (att_ecode) {\n\tcase BT_ATT_ERROR_READ_NOT_PERMITTED:\n\t\treturn btd_error_not_permitted(msg, \"Read not permitted\");\n\tcase BT_ATT_ERROR_WRITE_NOT_PERMITTED:\n\t\treturn btd_error_not_permitted(msg, \"Write not permitted\");\n\tcase BT_ATT_ERROR_AUTHENTICATION:\n\tcase BT_ATT_ERROR_INSUFFICIENT_ENCRYPTION:\n\tcase BT_ATT_ERROR_INSUFFICIENT_ENCRYPTION_KEY_SIZE:\n\t\treturn btd_error_not_permitted(msg, \"Not paired\");\n\tcase BT_ATT_ERROR_INVALID_OFFSET:\n\t\treturn btd_error_invalid_args_str(msg, \"Invalid offset\");\n\tcase BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN:\n\t\treturn btd_error_invalid_args_str(msg, \"Invalid Length\");\n\tcase BT_ATT_ERROR_AUTHORIZATION:\n\t\treturn btd_error_not_authorized(msg);\n\tcase BT_ATT_ERROR_REQUEST_NOT_SUPPORTED:\n\t\treturn btd_error_not_supported(msg);\n\tcase 0:\n\t\treturn btd_error_failed(msg, \"Operation failed\");\n\tdefault:\n\t\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".Failed\",\n\t\t\t\t\"Operation failed with ATT error: 0x%02x\",\n\t\t\t\tatt_ecode);\n\t}\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strerror",
          "args": [
            "-err"
          ],
          "line": 1431
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "io_send",
          "args": [
            "chrc->notify_io->io",
            "&iov",
            "1"
          ],
          "line": 1429
        },
        "resolved": true,
        "details": {
          "function_name": "pipe_io_send",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "2189-2197",
          "snippet": "static int pipe_io_send(struct io *io, const void *data, size_t len)\n{\n\tstruct iovec iov;\n\n\tiov.iov_base = (void *) data;\n\tiov.iov_len = len;\n\n\treturn io_send(io, &iov, 1);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic int pipe_io_send(struct io *io, const void *data, size_t len)\n{\n\tstruct iovec iov;\n\n\tiov.iov_base = (void *) data;\n\tiov.iov_len = len;\n\n\treturn io_send(io, &iov, 1);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void notify_io_cb(uint16_t value_handle, const uint8_t *value,\n\t\t\t\t\tuint16_t length, void *user_data)\n{\n\tstruct iovec iov;\n\tstruct notify_client *client = user_data;\n\tstruct characteristic *chrc = client->chrc;\n\tint err;\n\n\t/* Drop notification if the pipe is not ready */\n\tif (!chrc->notify_io->io)\n\t\treturn;\n\n\tiov.iov_base = (void *) value;\n\tiov.iov_len = length;\n\n\terr = io_send(chrc->notify_io->io, &iov, 1);\n\tif (err < 0)\n\t\terror(\"io_send: %s\", strerror(-err));\n}"
  },
  {
    "function_name": "register_notify_cb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "1388-1412",
    "snippet": "static void register_notify_cb(uint16_t att_ecode, void *user_data)\n{\n\tstruct async_dbus_op *op = user_data;\n\tstruct notify_client *client = op->data;\n\tstruct characteristic *chrc = client->chrc;\n\n\tif (att_ecode) {\n\t\tqueue_remove(chrc->notify_clients, client);\n\t\tqueue_remove(chrc->service->client->all_notify_clients, client);\n\t\tnotify_client_free(client);\n\n\t\tcreate_notify_reply(op, false, att_ecode);\n\n\t\treturn;\n\t}\n\n\tif (!chrc->notifying) {\n\t\tchrc->notifying = true;\n\t\tg_dbus_emit_property_changed(btd_get_dbus_connection(),\n\t\t\t\t\tchrc->path, GATT_CHARACTERISTIC_IFACE,\n\t\t\t\t\t\"Notifying\");\n\t}\n\n\tcreate_notify_reply(op, true, 0);\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define GATT_CHARACTERISTIC_IFACE\t\"org.bluez.GattCharacteristic1\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "create_notify_reply",
          "args": [
            "op",
            "true",
            "0"
          ],
          "line": 1411
        },
        "resolved": true,
        "details": {
          "function_name": "create_notify_reply",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "1375-1386",
          "snippet": "static void create_notify_reply(struct async_dbus_op *op, bool success,\n\t\t\t\t\t\t\tuint8_t att_ecode)\n{\n\tint err;\n\n\tif (success)\n\t\terr = 0;\n\telse\n\t\terr = att_ecode ? att_ecode : -ENOENT;\n\n\tasync_dbus_op_reply(op, err, NULL, -1);\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void create_notify_reply(struct async_dbus_op *op, bool success,\n\t\t\t\t\t\t\tuint8_t att_ecode)\n{\n\tint err;\n\n\tif (success)\n\t\terr = 0;\n\telse\n\t\terr = att_ecode ? att_ecode : -ENOENT;\n\n\tasync_dbus_op_reply(op, err, NULL, -1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_emit_property_changed",
          "args": [
            "btd_get_dbus_connection()",
            "chrc->path",
            "GATT_CHARACTERISTIC_IFACE",
            "\"Notifying\""
          ],
          "line": 1406
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_get_dbus_connection",
          "args": [],
          "line": 1406
        },
        "resolved": true,
        "details": {
          "function_name": "btd_get_dbus_connection",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/dbus-common.c",
          "lines": "61-64",
          "snippet": "DBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *connection = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *connection = NULL;\n\nDBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}"
        }
      },
      {
        "call_info": {
          "callee": "notify_client_free",
          "args": [
            "client"
          ],
          "line": 1397
        },
        "resolved": true,
        "details": {
          "function_name": "notify_client_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "1256-1265",
          "snippet": "static void notify_client_free(struct notify_client *client)\n{\n\tDBG(\"owner %s\", client->owner);\n\n\tg_dbus_remove_watch(btd_get_dbus_connection(), client->watch);\n\tbt_gatt_client_unregister_notify(client->chrc->service->client->gatt,\n\t\t\t\t\t\t\tclient->notify_id);\n\tfree(client->owner);\n\tfree(client);\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void notify_client_free(struct notify_client *client)\n{\n\tDBG(\"owner %s\", client->owner);\n\n\tg_dbus_remove_watch(btd_get_dbus_connection(), client->watch);\n\tbt_gatt_client_unregister_notify(client->chrc->service->client->gatt,\n\t\t\t\t\t\t\tclient->notify_id);\n\tfree(client->owner);\n\tfree(client);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_remove",
          "args": [
            "chrc->service->client->all_notify_clients",
            "client"
          ],
          "line": 1396
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_uuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "526-541",
          "snippet": "static bool queue_remove_uuid(struct queue *queue, bt_uuid_t *uuid)\n{\n\tbt_uuid_t *removed;\n\n\tif (!queue || !uuid)\n\t\treturn false;\n\n\tremoved = queue_remove_if(queue, uuid_match, uuid);\n\n\tif (removed) {\n\t\tfree(removed);\n\t\treturn true;\n\t}\n\n\treturn false;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic bool queue_remove_uuid(struct queue *queue, bt_uuid_t *uuid)\n{\n\tbt_uuid_t *removed;\n\n\tif (!queue || !uuid)\n\t\treturn false;\n\n\tremoved = queue_remove_if(queue, uuid_match, uuid);\n\n\tif (removed) {\n\t\tfree(removed);\n\t\treturn true;\n\t}\n\n\treturn false;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\n#define GATT_CHARACTERISTIC_IFACE\t\"org.bluez.GattCharacteristic1\"\n\nstatic void register_notify_cb(uint16_t att_ecode, void *user_data)\n{\n\tstruct async_dbus_op *op = user_data;\n\tstruct notify_client *client = op->data;\n\tstruct characteristic *chrc = client->chrc;\n\n\tif (att_ecode) {\n\t\tqueue_remove(chrc->notify_clients, client);\n\t\tqueue_remove(chrc->service->client->all_notify_clients, client);\n\t\tnotify_client_free(client);\n\n\t\tcreate_notify_reply(op, false, att_ecode);\n\n\t\treturn;\n\t}\n\n\tif (!chrc->notifying) {\n\t\tchrc->notifying = true;\n\t\tg_dbus_emit_property_changed(btd_get_dbus_connection(),\n\t\t\t\t\tchrc->path, GATT_CHARACTERISTIC_IFACE,\n\t\t\t\t\t\"Notifying\");\n\t}\n\n\tcreate_notify_reply(op, true, 0);\n}"
  },
  {
    "function_name": "create_notify_reply",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "1375-1386",
    "snippet": "static void create_notify_reply(struct async_dbus_op *op, bool success,\n\t\t\t\t\t\t\tuint8_t att_ecode)\n{\n\tint err;\n\n\tif (success)\n\t\terr = 0;\n\telse\n\t\terr = att_ecode ? att_ecode : -ENOENT;\n\n\tasync_dbus_op_reply(op, err, NULL, -1);\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "async_dbus_op_reply",
          "args": [
            "op",
            "err",
            "NULL",
            "-1"
          ],
          "line": 1385
        },
        "resolved": true,
        "details": {
          "function_name": "async_dbus_op_reply",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "315-344",
          "snippet": "static void async_dbus_op_reply(struct async_dbus_op *op, int err,\n\t\t\t\tconst uint8_t *value, ssize_t length)\n{\n\tconst struct queue_entry *entry;\n\tDBusMessage *reply;\n\n\top->id = 0;\n\n\tfor (entry = queue_get_entries(op->msgs); entry; entry = entry->next) {\n\t\tDBusMessage *msg = entry->data;\n\n\t\tif (err) {\n\t\t\treply = err > 0 ? create_gatt_dbus_error(msg, err) :\n\t\t\t\tbtd_error_failed(msg, strerror(-err));\n\t\t\tgoto send_reply;\n\t\t}\n\n\t\treply = g_dbus_create_reply(msg, DBUS_TYPE_INVALID);\n\t\tif (!reply) {\n\t\t\terror(\"Failed to allocate D-Bus message reply\");\n\t\t\treturn;\n\t\t}\n\n\t\tif (length >= 0)\n\t\t\tmessage_append_byte_array(reply, value, length);\n\nsend_reply:\n\t\tg_dbus_send_message(btd_get_dbus_connection(), reply);\n\t}\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void async_dbus_op_reply(struct async_dbus_op *op, int err,\n\t\t\t\tconst uint8_t *value, ssize_t length)\n{\n\tconst struct queue_entry *entry;\n\tDBusMessage *reply;\n\n\top->id = 0;\n\n\tfor (entry = queue_get_entries(op->msgs); entry; entry = entry->next) {\n\t\tDBusMessage *msg = entry->data;\n\n\t\tif (err) {\n\t\t\treply = err > 0 ? create_gatt_dbus_error(msg, err) :\n\t\t\t\tbtd_error_failed(msg, strerror(-err));\n\t\t\tgoto send_reply;\n\t\t}\n\n\t\treply = g_dbus_create_reply(msg, DBUS_TYPE_INVALID);\n\t\tif (!reply) {\n\t\t\terror(\"Failed to allocate D-Bus message reply\");\n\t\t\treturn;\n\t\t}\n\n\t\tif (length >= 0)\n\t\t\tmessage_append_byte_array(reply, value, length);\n\nsend_reply:\n\t\tg_dbus_send_message(btd_get_dbus_connection(), reply);\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void create_notify_reply(struct async_dbus_op *op, bool success,\n\t\t\t\t\t\t\tuint8_t att_ecode)\n{\n\tint err;\n\n\tif (success)\n\t\terr = 0;\n\telse\n\t\terr = att_ecode ? att_ecode : -ENOENT;\n\n\tasync_dbus_op_reply(op, err, NULL, -1);\n}"
  },
  {
    "function_name": "notify_cb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "1358-1373",
    "snippet": "static void notify_cb(uint16_t value_handle, const uint8_t *value,\n\t\t\t\t\tuint16_t length, void *user_data)\n{\n\tstruct async_dbus_op *op = user_data;\n\tstruct notify_client *client = op->data;\n\tstruct characteristic *chrc = client->chrc;\n\n\t/*\n\t * Even if the value didn't change, we want to send a PropertiesChanged\n\t * signal so that we propagate the notification/indication to\n\t * applications.\n\t */\n\tgatt_db_attribute_reset(chrc->attr);\n\tgatt_db_attribute_write(chrc->attr, 0, value, length, 0, NULL,\n\t\t\t\t\t\twrite_characteristic_cb, chrc);\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "gatt_db_attribute_write",
          "args": [
            "chrc->attr",
            "0",
            "value",
            "length",
            "0",
            "NULL",
            "write_characteristic_cb",
            "chrc"
          ],
          "line": 1371
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_write",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1805-1860",
          "snippet": "bool gatt_db_attribute_write(struct gatt_db_attribute *attrib, uint16_t offset,\n\t\t\t\t\tconst uint8_t *value, size_t len,\n\t\t\t\t\tuint8_t opcode, struct bt_att *att,\n\t\t\t\t\tgatt_db_attribute_write_t func,\n\t\t\t\t\tvoid *user_data)\n{\n\tif (!attrib || !func)\n\t\treturn false;\n\n\tif (attrib->write_func) {\n\t\tstruct pending_write *p;\n\n\t\tp = new0(struct pending_write, 1);\n\t\tp->attrib = attrib;\n\t\tp->id = ++attrib->write_id;\n\t\tp->timeout_id = timeout_add(ATTRIBUTE_TIMEOUT, write_timeout,\n\t\t\t\t\t\t\t\tp, NULL);\n\t\tp->func = func;\n\t\tp->user_data = user_data;\n\n\t\tqueue_push_tail(attrib->pending_writes, p);\n\n\t\tattrib->write_func(attrib, p->id, offset, value, len, opcode,\n\t\t\t\t\t\t\tatt, attrib->user_data);\n\t\treturn true;\n\t}\n\n\t/* Nothing to write just skip */\n\tif (len == 0)\n\t\tgoto done;\n\n\t/* For values stored in db allocate on demand */\n\tif (!attrib->value || offset >= attrib->value_len ||\n\t\t\t\tlen > (unsigned) (attrib->value_len - offset)) {\n\t\tvoid *buf;\n\n\t\tbuf = realloc(attrib->value, len + offset);\n\t\tif (!buf)\n\t\t\treturn false;\n\n\t\tattrib->value = buf;\n\n\t\t/* Init data in the first allocation */\n\t\tif (!attrib->value_len)\n\t\t\tmemset(attrib->value, 0, offset);\n\n\t\tattrib->value_len = len + offset;\n\t}\n\n\tmemcpy(&attrib->value[offset], value, len);\n\ndone:\n\tfunc(attrib, 0, user_data);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define ATTRIBUTE_TIMEOUT 5000"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\n#define ATTRIBUTE_TIMEOUT 5000\n\nbool gatt_db_attribute_write(struct gatt_db_attribute *attrib, uint16_t offset,\n\t\t\t\t\tconst uint8_t *value, size_t len,\n\t\t\t\t\tuint8_t opcode, struct bt_att *att,\n\t\t\t\t\tgatt_db_attribute_write_t func,\n\t\t\t\t\tvoid *user_data)\n{\n\tif (!attrib || !func)\n\t\treturn false;\n\n\tif (attrib->write_func) {\n\t\tstruct pending_write *p;\n\n\t\tp = new0(struct pending_write, 1);\n\t\tp->attrib = attrib;\n\t\tp->id = ++attrib->write_id;\n\t\tp->timeout_id = timeout_add(ATTRIBUTE_TIMEOUT, write_timeout,\n\t\t\t\t\t\t\t\tp, NULL);\n\t\tp->func = func;\n\t\tp->user_data = user_data;\n\n\t\tqueue_push_tail(attrib->pending_writes, p);\n\n\t\tattrib->write_func(attrib, p->id, offset, value, len, opcode,\n\t\t\t\t\t\t\tatt, attrib->user_data);\n\t\treturn true;\n\t}\n\n\t/* Nothing to write just skip */\n\tif (len == 0)\n\t\tgoto done;\n\n\t/* For values stored in db allocate on demand */\n\tif (!attrib->value || offset >= attrib->value_len ||\n\t\t\t\tlen > (unsigned) (attrib->value_len - offset)) {\n\t\tvoid *buf;\n\n\t\tbuf = realloc(attrib->value, len + offset);\n\t\tif (!buf)\n\t\t\treturn false;\n\n\t\tattrib->value = buf;\n\n\t\t/* Init data in the first allocation */\n\t\tif (!attrib->value_len)\n\t\t\tmemset(attrib->value, 0, offset);\n\n\t\tattrib->value_len = len + offset;\n\t}\n\n\tmemcpy(&attrib->value[offset], value, len);\n\ndone:\n\tfunc(attrib, 0, user_data);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_attribute_reset",
          "args": [
            "chrc->attr"
          ],
          "line": 1370
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_reset",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1880-1893",
          "snippet": "bool gatt_db_attribute_reset(struct gatt_db_attribute *attrib)\n{\n\tif (!attrib)\n\t\treturn false;\n\n\tif (!attrib->value || !attrib->value_len)\n\t\treturn true;\n\n\tfree(attrib->value);\n\tattrib->value = NULL;\n\tattrib->value_len = 0;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_attribute_reset(struct gatt_db_attribute *attrib)\n{\n\tif (!attrib)\n\t\treturn false;\n\n\tif (!attrib->value || !attrib->value_len)\n\t\treturn true;\n\n\tfree(attrib->value);\n\tattrib->value = NULL;\n\tattrib->value_len = 0;\n\n\treturn true;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void notify_cb(uint16_t value_handle, const uint8_t *value,\n\t\t\t\t\tuint16_t length, void *user_data)\n{\n\tstruct async_dbus_op *op = user_data;\n\tstruct notify_client *client = op->data;\n\tstruct characteristic *chrc = client->chrc;\n\n\t/*\n\t * Even if the value didn't change, we want to send a PropertiesChanged\n\t * signal so that we propagate the notification/indication to\n\t * applications.\n\t */\n\tgatt_db_attribute_reset(chrc->attr);\n\tgatt_db_attribute_write(chrc->attr, 0, value, length, 0, NULL,\n\t\t\t\t\t\twrite_characteristic_cb, chrc);\n}"
  },
  {
    "function_name": "match_notify_sender",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "1350-1356",
    "snippet": "static bool match_notify_sender(const void *a, const void *b)\n{\n\tconst struct notify_client *client = a;\n\tconst char *sender = b;\n\n\treturn strcmp(client->owner, sender) == 0;\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "client->owner",
            "sender"
          ],
          "line": 1355
        },
        "resolved": true,
        "details": {
          "function_name": "g_strcmp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "1927-1930",
          "snippet": "static gint g_strcmp(gconstpointer a, gconstpointer b)\n{\n\treturn strcmp(a, b);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic gint g_strcmp(gconstpointer a, gconstpointer b)\n{\n\treturn strcmp(a, b);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic bool match_notify_sender(const void *a, const void *b)\n{\n\tconst struct notify_client *client = a;\n\tconst char *sender = b;\n\n\treturn strcmp(client->owner, sender) == 0;\n}"
  },
  {
    "function_name": "notify_client_create",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "1325-1348",
    "snippet": "static struct notify_client *notify_client_create(struct characteristic *chrc,\n\t\t\t\t\t\t\tconst char *owner)\n{\n\tstruct notify_client *client;\n\n\tclient = new0(struct notify_client, 1);\n\tclient->chrc = chrc;\n\tclient->owner = strdup(owner);\n\tif (!client->owner) {\n\t\tfree(client);\n\t\treturn NULL;\n\t}\n\n\tclient->watch = g_dbus_add_disconnect_watch(btd_get_dbus_connection(),\n\t\t\t\t\t\towner, notify_client_disconnect,\n\t\t\t\t\t\tclient, NULL);\n\tif (!client->watch) {\n\t\tfree(client->owner);\n\t\tfree(client);\n\t\treturn NULL;\n\t}\n\n\treturn notify_client_ref(client);\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "notify_client_ref",
          "args": [
            "client"
          ],
          "line": 1347
        },
        "resolved": true,
        "details": {
          "function_name": "notify_client_ref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "1279-1286",
          "snippet": "static struct notify_client *notify_client_ref(struct notify_client *client)\n{\n\tDBG(\"owner %s\", client->owner);\n\n\t__sync_fetch_and_add(&client->ref_count, 1);\n\n\treturn client;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic struct notify_client *notify_client_ref(struct notify_client *client)\n{\n\tDBG(\"owner %s\", client->owner);\n\n\t__sync_fetch_and_add(&client->ref_count, 1);\n\n\treturn client;\n}"
        }
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "client"
          ],
          "line": 1343
        },
        "resolved": true,
        "details": {
          "function_name": "service_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "1818-1826",
          "snippet": "static void service_free(void *data)\n{\n\tstruct service *service = data;\n\n\tqueue_destroy(service->chrcs, NULL);  /* List should be empty here */\n\tqueue_destroy(service->incl_services, NULL);\n\tg_free(service->path);\n\tfree(service);\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void service_free(void *data)\n{\n\tstruct service *service = data;\n\n\tqueue_destroy(service->chrcs, NULL);  /* List should be empty here */\n\tqueue_destroy(service->incl_services, NULL);\n\tg_free(service->path);\n\tfree(service);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_add_disconnect_watch",
          "args": [
            "btd_get_dbus_connection()",
            "owner",
            "notify_client_disconnect",
            "client",
            "NULL"
          ],
          "line": 1338
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_get_dbus_connection",
          "args": [],
          "line": 1338
        },
        "resolved": true,
        "details": {
          "function_name": "btd_get_dbus_connection",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/dbus-common.c",
          "lines": "61-64",
          "snippet": "DBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *connection = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *connection = NULL;\n\nDBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "owner"
          ],
          "line": 1332
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "new0",
          "args": [
            "structnotify_client",
            "1"
          ],
          "line": 1330
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic struct notify_client *notify_client_create(struct characteristic *chrc,\n\t\t\t\t\t\t\tconst char *owner)\n{\n\tstruct notify_client *client;\n\n\tclient = new0(struct notify_client, 1);\n\tclient->chrc = chrc;\n\tclient->owner = strdup(owner);\n\tif (!client->owner) {\n\t\tfree(client);\n\t\treturn NULL;\n\t}\n\n\tclient->watch = g_dbus_add_disconnect_watch(btd_get_dbus_connection(),\n\t\t\t\t\t\towner, notify_client_disconnect,\n\t\t\t\t\t\tclient, NULL);\n\tif (!client->watch) {\n\t\tfree(client->owner);\n\t\tfree(client);\n\t\treturn NULL;\n\t}\n\n\treturn notify_client_ref(client);\n}"
  },
  {
    "function_name": "notify_client_disconnect",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "1310-1323",
    "snippet": "static void notify_client_disconnect(DBusConnection *conn, void *user_data)\n{\n\tstruct notify_client *client = user_data;\n\tstruct characteristic *chrc = client->chrc;\n\n\tDBG(\"owner %s\", client->owner);\n\n\tqueue_remove(chrc->notify_clients, client);\n\tqueue_remove(chrc->service->client->all_notify_clients, client);\n\n\tupdate_notifying(chrc);\n\n\tnotify_client_unref(client);\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "notify_client_unref",
          "args": [
            "client"
          ],
          "line": 1322
        },
        "resolved": true,
        "details": {
          "function_name": "notify_client_unref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "1267-1277",
          "snippet": "static void notify_client_unref(void *data)\n{\n\tstruct notify_client *client = data;\n\n\tDBG(\"owner %s\", client->owner);\n\n\tif (__sync_sub_and_fetch(&client->ref_count, 1))\n\t\treturn;\n\n\tnotify_client_free(client);\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void notify_client_unref(void *data)\n{\n\tstruct notify_client *client = data;\n\n\tDBG(\"owner %s\", client->owner);\n\n\tif (__sync_sub_and_fetch(&client->ref_count, 1))\n\t\treturn;\n\n\tnotify_client_free(client);\n}"
        }
      },
      {
        "call_info": {
          "callee": "update_notifying",
          "args": [
            "chrc"
          ],
          "line": 1320
        },
        "resolved": true,
        "details": {
          "function_name": "update_notifying",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "1295-1308",
          "snippet": "static void update_notifying(struct characteristic *chrc)\n{\n\tif (!chrc->notifying)\n\t\treturn;\n\n\tif (queue_find(chrc->notify_clients, match_notifying, NULL))\n\t\treturn;\n\n\tchrc->notifying = false;\n\n\tg_dbus_emit_property_changed(btd_get_dbus_connection(), chrc->path,\n\t\t\t\t\t\tGATT_CHARACTERISTIC_IFACE,\n\t\t\t\t\t\t\"Notifying\");\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define GATT_CHARACTERISTIC_IFACE\t\"org.bluez.GattCharacteristic1\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\n#define GATT_CHARACTERISTIC_IFACE\t\"org.bluez.GattCharacteristic1\"\n\nstatic void update_notifying(struct characteristic *chrc)\n{\n\tif (!chrc->notifying)\n\t\treturn;\n\n\tif (queue_find(chrc->notify_clients, match_notifying, NULL))\n\t\treturn;\n\n\tchrc->notifying = false;\n\n\tg_dbus_emit_property_changed(btd_get_dbus_connection(), chrc->path,\n\t\t\t\t\t\tGATT_CHARACTERISTIC_IFACE,\n\t\t\t\t\t\t\"Notifying\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_remove",
          "args": [
            "chrc->service->client->all_notify_clients",
            "client"
          ],
          "line": 1318
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_uuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "526-541",
          "snippet": "static bool queue_remove_uuid(struct queue *queue, bt_uuid_t *uuid)\n{\n\tbt_uuid_t *removed;\n\n\tif (!queue || !uuid)\n\t\treturn false;\n\n\tremoved = queue_remove_if(queue, uuid_match, uuid);\n\n\tif (removed) {\n\t\tfree(removed);\n\t\treturn true;\n\t}\n\n\treturn false;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic bool queue_remove_uuid(struct queue *queue, bt_uuid_t *uuid)\n{\n\tbt_uuid_t *removed;\n\n\tif (!queue || !uuid)\n\t\treturn false;\n\n\tremoved = queue_remove_if(queue, uuid_match, uuid);\n\n\tif (removed) {\n\t\tfree(removed);\n\t\treturn true;\n\t}\n\n\treturn false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"owner %s\"",
            "client->owner"
          ],
          "line": 1315
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void notify_client_disconnect(DBusConnection *conn, void *user_data)\n{\n\tstruct notify_client *client = user_data;\n\tstruct characteristic *chrc = client->chrc;\n\n\tDBG(\"owner %s\", client->owner);\n\n\tqueue_remove(chrc->notify_clients, client);\n\tqueue_remove(chrc->service->client->all_notify_clients, client);\n\n\tupdate_notifying(chrc);\n\n\tnotify_client_unref(client);\n}"
  },
  {
    "function_name": "update_notifying",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "1295-1308",
    "snippet": "static void update_notifying(struct characteristic *chrc)\n{\n\tif (!chrc->notifying)\n\t\treturn;\n\n\tif (queue_find(chrc->notify_clients, match_notifying, NULL))\n\t\treturn;\n\n\tchrc->notifying = false;\n\n\tg_dbus_emit_property_changed(btd_get_dbus_connection(), chrc->path,\n\t\t\t\t\t\tGATT_CHARACTERISTIC_IFACE,\n\t\t\t\t\t\t\"Notifying\");\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define GATT_CHARACTERISTIC_IFACE\t\"org.bluez.GattCharacteristic1\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_dbus_emit_property_changed",
          "args": [
            "btd_get_dbus_connection()",
            "chrc->path",
            "GATT_CHARACTERISTIC_IFACE",
            "\"Notifying\""
          ],
          "line": 1305
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_get_dbus_connection",
          "args": [],
          "line": 1305
        },
        "resolved": true,
        "details": {
          "function_name": "btd_get_dbus_connection",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/dbus-common.c",
          "lines": "61-64",
          "snippet": "DBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *connection = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *connection = NULL;\n\nDBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_find",
          "args": [
            "chrc->notify_clients",
            "match_notifying",
            "NULL"
          ],
          "line": 1300
        },
        "resolved": true,
        "details": {
          "function_name": "queue_find",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "231-247",
          "snippet": "void *queue_find(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tconst void *match_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tfor (entry = queue->head; entry; entry = entry->next)\n\t\tif (function(entry->data, match_data))\n\t\t\treturn entry->data;\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid *queue_find(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tconst void *match_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tfor (entry = queue->head; entry; entry = entry->next)\n\t\tif (function(entry->data, match_data))\n\t\t\treturn entry->data;\n\n\treturn NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\n#define GATT_CHARACTERISTIC_IFACE\t\"org.bluez.GattCharacteristic1\"\n\nstatic void update_notifying(struct characteristic *chrc)\n{\n\tif (!chrc->notifying)\n\t\treturn;\n\n\tif (queue_find(chrc->notify_clients, match_notifying, NULL))\n\t\treturn;\n\n\tchrc->notifying = false;\n\n\tg_dbus_emit_property_changed(btd_get_dbus_connection(), chrc->path,\n\t\t\t\t\t\tGATT_CHARACTERISTIC_IFACE,\n\t\t\t\t\t\t\"Notifying\");\n}"
  },
  {
    "function_name": "match_notifying",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "1288-1293",
    "snippet": "static bool match_notifying(const void *a, const void *b)\n{\n\tconst struct notify_client *client = a;\n\n\treturn !!client->notify_id;\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic bool match_notifying(const void *a, const void *b)\n{\n\tconst struct notify_client *client = a;\n\n\treturn !!client->notify_id;\n}"
  },
  {
    "function_name": "notify_client_ref",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "1279-1286",
    "snippet": "static struct notify_client *notify_client_ref(struct notify_client *client)\n{\n\tDBG(\"owner %s\", client->owner);\n\n\t__sync_fetch_and_add(&client->ref_count, 1);\n\n\treturn client;\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "__sync_fetch_and_add",
          "args": [
            "&client->ref_count",
            "1"
          ],
          "line": 1283
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"owner %s\"",
            "client->owner"
          ],
          "line": 1281
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic struct notify_client *notify_client_ref(struct notify_client *client)\n{\n\tDBG(\"owner %s\", client->owner);\n\n\t__sync_fetch_and_add(&client->ref_count, 1);\n\n\treturn client;\n}"
  },
  {
    "function_name": "notify_client_unref",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "1267-1277",
    "snippet": "static void notify_client_unref(void *data)\n{\n\tstruct notify_client *client = data;\n\n\tDBG(\"owner %s\", client->owner);\n\n\tif (__sync_sub_and_fetch(&client->ref_count, 1))\n\t\treturn;\n\n\tnotify_client_free(client);\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "notify_client_free",
          "args": [
            "client"
          ],
          "line": 1276
        },
        "resolved": true,
        "details": {
          "function_name": "notify_client_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "1256-1265",
          "snippet": "static void notify_client_free(struct notify_client *client)\n{\n\tDBG(\"owner %s\", client->owner);\n\n\tg_dbus_remove_watch(btd_get_dbus_connection(), client->watch);\n\tbt_gatt_client_unregister_notify(client->chrc->service->client->gatt,\n\t\t\t\t\t\t\tclient->notify_id);\n\tfree(client->owner);\n\tfree(client);\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void notify_client_free(struct notify_client *client)\n{\n\tDBG(\"owner %s\", client->owner);\n\n\tg_dbus_remove_watch(btd_get_dbus_connection(), client->watch);\n\tbt_gatt_client_unregister_notify(client->chrc->service->client->gatt,\n\t\t\t\t\t\t\tclient->notify_id);\n\tfree(client->owner);\n\tfree(client);\n}"
        }
      },
      {
        "call_info": {
          "callee": "__sync_sub_and_fetch",
          "args": [
            "&client->ref_count",
            "1"
          ],
          "line": 1273
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"owner %s\"",
            "client->owner"
          ],
          "line": 1271
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void notify_client_unref(void *data)\n{\n\tstruct notify_client *client = data;\n\n\tDBG(\"owner %s\", client->owner);\n\n\tif (__sync_sub_and_fetch(&client->ref_count, 1))\n\t\treturn;\n\n\tnotify_client_free(client);\n}"
  },
  {
    "function_name": "notify_client_free",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "1256-1265",
    "snippet": "static void notify_client_free(struct notify_client *client)\n{\n\tDBG(\"owner %s\", client->owner);\n\n\tg_dbus_remove_watch(btd_get_dbus_connection(), client->watch);\n\tbt_gatt_client_unregister_notify(client->chrc->service->client->gatt,\n\t\t\t\t\t\t\tclient->notify_id);\n\tfree(client->owner);\n\tfree(client);\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "client"
          ],
          "line": 1264
        },
        "resolved": true,
        "details": {
          "function_name": "service_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "1818-1826",
          "snippet": "static void service_free(void *data)\n{\n\tstruct service *service = data;\n\n\tqueue_destroy(service->chrcs, NULL);  /* List should be empty here */\n\tqueue_destroy(service->incl_services, NULL);\n\tg_free(service->path);\n\tfree(service);\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void service_free(void *data)\n{\n\tstruct service *service = data;\n\n\tqueue_destroy(service->chrcs, NULL);  /* List should be empty here */\n\tqueue_destroy(service->incl_services, NULL);\n\tg_free(service->path);\n\tfree(service);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_gatt_client_unregister_notify",
          "args": [
            "client->chrc->service->client->gatt",
            "client->notify_id"
          ],
          "line": 1261
        },
        "resolved": true,
        "details": {
          "function_name": "bt_gatt_client_unregister_notify",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-client.c",
          "lines": "3254-3276",
          "snippet": "bool bt_gatt_client_unregister_notify(struct bt_gatt_client *client,\n\t\t\t\t\t\t\tunsigned int id)\n{\n\tstruct notify_data *notify_data;\n\n\tif (!client || !id)\n\t\treturn false;\n\n\tnotify_data = queue_remove_if(client->notify_list, match_notify_data_id,\n\t\t\t\t\t\t\tUINT_TO_PTR(id));\n\tif (!notify_data)\n\t\treturn false;\n\n\t/* Remove data if it has been queued */\n\tqueue_remove(notify_data->chrc->reg_notify_queue, notify_data);\n\n\t/* Reset callbacks */\n\tnotify_data->callback = NULL;\n\tnotify_data->notify = NULL;\n\n\tcomplete_unregister_notify(notify_data);\n\treturn true;\n}",
          "includes": [
            "#include <sys/uio.h>",
            "#include <limits.h>",
            "#include <assert.h>",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-helpers.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/att.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/uio.h>\n#include <limits.h>\n#include <assert.h>\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-helpers.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/att.h\"\n#include <config.h>\n\nbool bt_gatt_client_unregister_notify(struct bt_gatt_client *client,\n\t\t\t\t\t\t\tunsigned int id)\n{\n\tstruct notify_data *notify_data;\n\n\tif (!client || !id)\n\t\treturn false;\n\n\tnotify_data = queue_remove_if(client->notify_list, match_notify_data_id,\n\t\t\t\t\t\t\tUINT_TO_PTR(id));\n\tif (!notify_data)\n\t\treturn false;\n\n\t/* Remove data if it has been queued */\n\tqueue_remove(notify_data->chrc->reg_notify_queue, notify_data);\n\n\t/* Reset callbacks */\n\tnotify_data->callback = NULL;\n\tnotify_data->notify = NULL;\n\n\tcomplete_unregister_notify(notify_data);\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_remove_watch",
          "args": [
            "btd_get_dbus_connection()",
            "client->watch"
          ],
          "line": 1260
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_get_dbus_connection",
          "args": [],
          "line": 1260
        },
        "resolved": true,
        "details": {
          "function_name": "btd_get_dbus_connection",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/dbus-common.c",
          "lines": "61-64",
          "snippet": "DBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *connection = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *connection = NULL;\n\nDBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"owner %s\"",
            "client->owner"
          ],
          "line": 1258
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void notify_client_free(struct notify_client *client)\n{\n\tDBG(\"owner %s\", client->owner);\n\n\tg_dbus_remove_watch(btd_get_dbus_connection(), client->watch);\n\tbt_gatt_client_unregister_notify(client->chrc->service->client->gatt,\n\t\t\t\t\t\t\tclient->notify_id);\n\tfree(client->owner);\n\tfree(client);\n}"
  },
  {
    "function_name": "characteristic_acquire_write",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "1218-1246",
    "snippet": "static DBusMessage *characteristic_acquire_write(DBusConnection *conn,\n\t\t\t\t\tDBusMessage *msg, void *user_data)\n{\n\tstruct characteristic *chrc = user_data;\n\tstruct bt_gatt_client *gatt = chrc->service->client->gatt;\n\n\tif (!gatt)\n\t\treturn btd_error_failed(msg, \"Not connected\");\n\n\tif (chrc->write_io)\n\t\treturn btd_error_not_permitted(msg, \"Write acquired\");\n\n\tif (!(chrc->props & BT_GATT_CHRC_PROP_WRITE_WITHOUT_RESP))\n\t\treturn btd_error_not_supported(msg);\n\n\tchrc->write_io = new0(struct pipe_io, 1);\n\n\tif (!bt_gatt_client_is_ready(gatt)) {\n\t\t/* GATT not ready, wait until it becomes ready */\n\t\tif (!chrc->ready_id)\n\t\t\tchrc->ready_id = bt_gatt_client_ready_register(gatt,\n\t\t\t\t\t\t\tcharacteristic_ready,\n\t\t\t\t\t\t\tchrc, NULL);\n\t\tchrc->write_io->msg = dbus_message_ref(msg);\n\t\treturn NULL;\n\t}\n\n\treturn characteristic_create_pipe(chrc, msg);\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "characteristic_create_pipe",
          "args": [
            "chrc",
            "msg"
          ],
          "line": 1245
        },
        "resolved": true,
        "details": {
          "function_name": "characteristic_create_pipe",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "1124-1190",
          "snippet": "static DBusMessage *characteristic_create_pipe(struct characteristic *chrc,\n\t\t\t\t\t\tDBusMessage *msg)\n{\n\tstruct bt_gatt_client *gatt = chrc->service->client->gatt;\n\tint pipefd[2];\n\tstruct io *io;\n\tbool dir;\n\tuint16_t mtu;\n\tDBusMessage *reply;\n\n\tif (!gatt || !bt_gatt_client_is_ready(gatt))\n\t\treturn btd_error_failed(msg, \"Not connected\");\n\n\tif (pipe2(pipefd, O_DIRECT | O_NONBLOCK | O_CLOEXEC) < 0)\n\t\treturn btd_error_failed(msg, strerror(errno));\n\n\tdir = dbus_message_has_member(msg, \"AcquireWrite\");\n\n\tio = io_new(pipefd[!dir]);\n\tif (!io) {\n\t\tclose(pipefd[0]);\n\t\tclose(pipefd[1]);\n\t\treturn btd_error_failed(msg, strerror(EIO));\n\t}\n\n\tio_set_close_on_destroy(io, true);\n\n\tif (!io_set_read_handler(io, chrc_pipe_read, chrc, NULL))\n\t\tgoto fail;\n\n\tif (!io_set_disconnect_handler(io, characteristic_pipe_hup, chrc, NULL))\n\t\tgoto fail;\n\n\tmtu = bt_gatt_client_get_mtu(gatt);\n\n\treply = g_dbus_create_reply(msg, DBUS_TYPE_UNIX_FD, &pipefd[dir],\n\t\t\t\t\tDBUS_TYPE_UINT16, &mtu,\n\t\t\t\t\tDBUS_TYPE_INVALID);\n\n\tclose(pipefd[dir]);\n\n\tif (dir) {\n\t\tchrc->write_io->io = io;\n\t\tg_dbus_emit_property_changed(btd_get_dbus_connection(),\n\t\t\t\t\t\tchrc->path,\n\t\t\t\t\t\tGATT_CHARACTERISTIC_IFACE,\n\t\t\t\t\t\t\"WriteAcquired\");\n\t} else {\n\t\tchrc->notify_io->io = io;\n\t\tg_dbus_emit_property_changed(btd_get_dbus_connection(),\n\t\t\t\t\t\tchrc->path,\n\t\t\t\t\t\tGATT_CHARACTERISTIC_IFACE,\n\t\t\t\t\t\t\"NotifyAcquired\");\n\t}\n\n\tqueue_push_tail(chrc->service->client->ios, io);\n\n\tDBG(\"%s: sender %s io %p\", dbus_message_get_member(msg),\n\t\t\t\t\tdbus_message_get_sender(msg), io);\n\n\treturn reply;\n\nfail:\n\tio_destroy(io);\n\tclose(pipefd[dir]);\n\treturn btd_error_failed(msg, strerror(EIO));\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define GATT_CHARACTERISTIC_IFACE\t\"org.bluez.GattCharacteristic1\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\n#define GATT_CHARACTERISTIC_IFACE\t\"org.bluez.GattCharacteristic1\"\n\nstatic DBusMessage *characteristic_create_pipe(struct characteristic *chrc,\n\t\t\t\t\t\tDBusMessage *msg)\n{\n\tstruct bt_gatt_client *gatt = chrc->service->client->gatt;\n\tint pipefd[2];\n\tstruct io *io;\n\tbool dir;\n\tuint16_t mtu;\n\tDBusMessage *reply;\n\n\tif (!gatt || !bt_gatt_client_is_ready(gatt))\n\t\treturn btd_error_failed(msg, \"Not connected\");\n\n\tif (pipe2(pipefd, O_DIRECT | O_NONBLOCK | O_CLOEXEC) < 0)\n\t\treturn btd_error_failed(msg, strerror(errno));\n\n\tdir = dbus_message_has_member(msg, \"AcquireWrite\");\n\n\tio = io_new(pipefd[!dir]);\n\tif (!io) {\n\t\tclose(pipefd[0]);\n\t\tclose(pipefd[1]);\n\t\treturn btd_error_failed(msg, strerror(EIO));\n\t}\n\n\tio_set_close_on_destroy(io, true);\n\n\tif (!io_set_read_handler(io, chrc_pipe_read, chrc, NULL))\n\t\tgoto fail;\n\n\tif (!io_set_disconnect_handler(io, characteristic_pipe_hup, chrc, NULL))\n\t\tgoto fail;\n\n\tmtu = bt_gatt_client_get_mtu(gatt);\n\n\treply = g_dbus_create_reply(msg, DBUS_TYPE_UNIX_FD, &pipefd[dir],\n\t\t\t\t\tDBUS_TYPE_UINT16, &mtu,\n\t\t\t\t\tDBUS_TYPE_INVALID);\n\n\tclose(pipefd[dir]);\n\n\tif (dir) {\n\t\tchrc->write_io->io = io;\n\t\tg_dbus_emit_property_changed(btd_get_dbus_connection(),\n\t\t\t\t\t\tchrc->path,\n\t\t\t\t\t\tGATT_CHARACTERISTIC_IFACE,\n\t\t\t\t\t\t\"WriteAcquired\");\n\t} else {\n\t\tchrc->notify_io->io = io;\n\t\tg_dbus_emit_property_changed(btd_get_dbus_connection(),\n\t\t\t\t\t\tchrc->path,\n\t\t\t\t\t\tGATT_CHARACTERISTIC_IFACE,\n\t\t\t\t\t\t\"NotifyAcquired\");\n\t}\n\n\tqueue_push_tail(chrc->service->client->ios, io);\n\n\tDBG(\"%s: sender %s io %p\", dbus_message_get_member(msg),\n\t\t\t\t\tdbus_message_get_sender(msg), io);\n\n\treturn reply;\n\nfail:\n\tio_destroy(io);\n\tclose(pipefd[dir]);\n\treturn btd_error_failed(msg, strerror(EIO));\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_ref",
          "args": [
            "msg"
          ],
          "line": 1241
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_gatt_client_ready_register",
          "args": [
            "gatt",
            "characteristic_ready",
            "chrc",
            "NULL"
          ],
          "line": 1238
        },
        "resolved": true,
        "details": {
          "function_name": "bt_gatt_client_ready_register",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-client.c",
          "lines": "2020-2038",
          "snippet": "unsigned int bt_gatt_client_ready_register(struct bt_gatt_client *client,\n\t\t\t\t\tbt_gatt_client_callback_t callback,\n\t\t\t\t\tvoid *user_data,\n\t\t\t\t\tbt_gatt_client_destroy_func_t destroy)\n{\n\tstruct ready_cb *ready;\n\n\tif (!client)\n\t\treturn 0;\n\n\tready = new0(struct ready_cb, 1);\n\tready->callback = callback;\n\tready->destroy = destroy;\n\tready->data = user_data;\n\n\tqueue_push_tail(client->ready_cbs, ready);\n\n\treturn PTR_TO_UINT(ready);\n}",
          "includes": [
            "#include <sys/uio.h>",
            "#include <limits.h>",
            "#include <assert.h>",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-helpers.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/att.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void discover_chrcs_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\t\tstruct bt_gatt_result *result,\n\t\t\t\t\t\tvoid *user_data);",
            "static void discover_descs_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\t\tstruct bt_gatt_result *result,\n\t\t\t\t\t\tvoid *user_data);",
            "static void ext_prop_read_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\tconst uint8_t *value, uint16_t length,\n\t\t\t\t\tvoid *user_data);",
            "static void service_changed_cb(uint16_t value_handle, const uint8_t *value,\n\t\t\t\t\tuint16_t length, void *user_data);",
            "static void prepare_write_cb(uint8_t opcode, const void *pdu, uint16_t length,\n\t\t\t\t\t\t\tvoid *user_data);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <sys/uio.h>\n#include <limits.h>\n#include <assert.h>\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-helpers.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/att.h\"\n#include <config.h>\n\nstatic void discover_chrcs_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\t\tstruct bt_gatt_result *result,\n\t\t\t\t\t\tvoid *user_data);\nstatic void discover_descs_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\t\tstruct bt_gatt_result *result,\n\t\t\t\t\t\tvoid *user_data);\nstatic void ext_prop_read_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\tconst uint8_t *value, uint16_t length,\n\t\t\t\t\tvoid *user_data);\nstatic void service_changed_cb(uint16_t value_handle, const uint8_t *value,\n\t\t\t\t\tuint16_t length, void *user_data);\nstatic void prepare_write_cb(uint8_t opcode, const void *pdu, uint16_t length,\n\t\t\t\t\t\t\tvoid *user_data);\n\nunsigned int bt_gatt_client_ready_register(struct bt_gatt_client *client,\n\t\t\t\t\tbt_gatt_client_callback_t callback,\n\t\t\t\t\tvoid *user_data,\n\t\t\t\t\tbt_gatt_client_destroy_func_t destroy)\n{\n\tstruct ready_cb *ready;\n\n\tif (!client)\n\t\treturn 0;\n\n\tready = new0(struct ready_cb, 1);\n\tready->callback = callback;\n\tready->destroy = destroy;\n\tready->data = user_data;\n\n\tqueue_push_tail(client->ready_cbs, ready);\n\n\treturn PTR_TO_UINT(ready);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_gatt_client_is_ready",
          "args": [
            "gatt"
          ],
          "line": 1235
        },
        "resolved": true,
        "details": {
          "function_name": "bt_gatt_client_is_ready",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-client.c",
          "lines": "2015-2018",
          "snippet": "bool bt_gatt_client_is_ready(struct bt_gatt_client *client)\n{\n\treturn (client && client->ready);\n}",
          "includes": [
            "#include <sys/uio.h>",
            "#include <limits.h>",
            "#include <assert.h>",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-helpers.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/att.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/uio.h>\n#include <limits.h>\n#include <assert.h>\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-helpers.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/att.h\"\n#include <config.h>\n\nbool bt_gatt_client_is_ready(struct bt_gatt_client *client)\n{\n\treturn (client && client->ready);\n}"
        }
      },
      {
        "call_info": {
          "callee": "new0",
          "args": [
            "structpipe_io",
            "1"
          ],
          "line": 1233
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_error_not_supported",
          "args": [
            "msg"
          ],
          "line": 1231
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_not_supported",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "58-62",
          "snippet": "DBusMessage *btd_error_not_supported(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotSupported\",\n\t\t\t\t\t\"Operation is not supported\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_not_supported(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotSupported\",\n\t\t\t\t\t\"Operation is not supported\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_error_not_permitted",
          "args": [
            "msg",
            "\"Write acquired\""
          ],
          "line": 1228
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_not_permitted",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "100-104",
          "snippet": "DBusMessage *btd_error_not_permitted(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotPermitted\",\n\t\t\t\t\t\"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_not_permitted(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotPermitted\",\n\t\t\t\t\t\"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_error_failed",
          "args": [
            "msg",
            "\"Not connected\""
          ],
          "line": 1225
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "124-128",
          "snippet": "DBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic DBusMessage *characteristic_acquire_write(DBusConnection *conn,\n\t\t\t\t\tDBusMessage *msg, void *user_data)\n{\n\tstruct characteristic *chrc = user_data;\n\tstruct bt_gatt_client *gatt = chrc->service->client->gatt;\n\n\tif (!gatt)\n\t\treturn btd_error_failed(msg, \"Not connected\");\n\n\tif (chrc->write_io)\n\t\treturn btd_error_not_permitted(msg, \"Write acquired\");\n\n\tif (!(chrc->props & BT_GATT_CHRC_PROP_WRITE_WITHOUT_RESP))\n\t\treturn btd_error_not_supported(msg);\n\n\tchrc->write_io = new0(struct pipe_io, 1);\n\n\tif (!bt_gatt_client_is_ready(gatt)) {\n\t\t/* GATT not ready, wait until it becomes ready */\n\t\tif (!chrc->ready_id)\n\t\t\tchrc->ready_id = bt_gatt_client_ready_register(gatt,\n\t\t\t\t\t\t\tcharacteristic_ready,\n\t\t\t\t\t\t\tchrc, NULL);\n\t\tchrc->write_io->msg = dbus_message_ref(msg);\n\t\treturn NULL;\n\t}\n\n\treturn characteristic_create_pipe(chrc, msg);\n}"
  },
  {
    "function_name": "characteristic_ready",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "1192-1216",
    "snippet": "static void characteristic_ready(bool success, uint8_t ecode, void *user_data)\n{\n\tstruct characteristic *chrc = user_data;\n\tDBusMessage *reply;\n\n\tchrc->ready_id = 0;\n\n\tif (chrc->write_io && chrc->write_io->msg) {\n\t\treply = characteristic_create_pipe(chrc, chrc->write_io->msg);\n\n\t\tg_dbus_send_message(btd_get_dbus_connection(), reply);\n\n\t\tdbus_message_unref(chrc->write_io->msg);\n\t\tchrc->write_io->msg = NULL;\n\t}\n\n\tif (chrc->notify_io && chrc->notify_io->msg) {\n\t\treply = characteristic_create_pipe(chrc, chrc->notify_io->msg);\n\n\t\tg_dbus_send_message(btd_get_dbus_connection(), reply);\n\n\t\tdbus_message_unref(chrc->notify_io->msg);\n\t\tchrc->notify_io->msg = NULL;\n\t}\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_unref",
          "args": [
            "chrc->notify_io->msg"
          ],
          "line": 1213
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_send_message",
          "args": [
            "btd_get_dbus_connection()",
            "reply"
          ],
          "line": 1211
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_get_dbus_connection",
          "args": [],
          "line": 1211
        },
        "resolved": true,
        "details": {
          "function_name": "btd_get_dbus_connection",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/dbus-common.c",
          "lines": "61-64",
          "snippet": "DBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *connection = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *connection = NULL;\n\nDBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}"
        }
      },
      {
        "call_info": {
          "callee": "characteristic_create_pipe",
          "args": [
            "chrc",
            "chrc->notify_io->msg"
          ],
          "line": 1209
        },
        "resolved": true,
        "details": {
          "function_name": "characteristic_create_pipe",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "1124-1190",
          "snippet": "static DBusMessage *characteristic_create_pipe(struct characteristic *chrc,\n\t\t\t\t\t\tDBusMessage *msg)\n{\n\tstruct bt_gatt_client *gatt = chrc->service->client->gatt;\n\tint pipefd[2];\n\tstruct io *io;\n\tbool dir;\n\tuint16_t mtu;\n\tDBusMessage *reply;\n\n\tif (!gatt || !bt_gatt_client_is_ready(gatt))\n\t\treturn btd_error_failed(msg, \"Not connected\");\n\n\tif (pipe2(pipefd, O_DIRECT | O_NONBLOCK | O_CLOEXEC) < 0)\n\t\treturn btd_error_failed(msg, strerror(errno));\n\n\tdir = dbus_message_has_member(msg, \"AcquireWrite\");\n\n\tio = io_new(pipefd[!dir]);\n\tif (!io) {\n\t\tclose(pipefd[0]);\n\t\tclose(pipefd[1]);\n\t\treturn btd_error_failed(msg, strerror(EIO));\n\t}\n\n\tio_set_close_on_destroy(io, true);\n\n\tif (!io_set_read_handler(io, chrc_pipe_read, chrc, NULL))\n\t\tgoto fail;\n\n\tif (!io_set_disconnect_handler(io, characteristic_pipe_hup, chrc, NULL))\n\t\tgoto fail;\n\n\tmtu = bt_gatt_client_get_mtu(gatt);\n\n\treply = g_dbus_create_reply(msg, DBUS_TYPE_UNIX_FD, &pipefd[dir],\n\t\t\t\t\tDBUS_TYPE_UINT16, &mtu,\n\t\t\t\t\tDBUS_TYPE_INVALID);\n\n\tclose(pipefd[dir]);\n\n\tif (dir) {\n\t\tchrc->write_io->io = io;\n\t\tg_dbus_emit_property_changed(btd_get_dbus_connection(),\n\t\t\t\t\t\tchrc->path,\n\t\t\t\t\t\tGATT_CHARACTERISTIC_IFACE,\n\t\t\t\t\t\t\"WriteAcquired\");\n\t} else {\n\t\tchrc->notify_io->io = io;\n\t\tg_dbus_emit_property_changed(btd_get_dbus_connection(),\n\t\t\t\t\t\tchrc->path,\n\t\t\t\t\t\tGATT_CHARACTERISTIC_IFACE,\n\t\t\t\t\t\t\"NotifyAcquired\");\n\t}\n\n\tqueue_push_tail(chrc->service->client->ios, io);\n\n\tDBG(\"%s: sender %s io %p\", dbus_message_get_member(msg),\n\t\t\t\t\tdbus_message_get_sender(msg), io);\n\n\treturn reply;\n\nfail:\n\tio_destroy(io);\n\tclose(pipefd[dir]);\n\treturn btd_error_failed(msg, strerror(EIO));\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define GATT_CHARACTERISTIC_IFACE\t\"org.bluez.GattCharacteristic1\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\n#define GATT_CHARACTERISTIC_IFACE\t\"org.bluez.GattCharacteristic1\"\n\nstatic DBusMessage *characteristic_create_pipe(struct characteristic *chrc,\n\t\t\t\t\t\tDBusMessage *msg)\n{\n\tstruct bt_gatt_client *gatt = chrc->service->client->gatt;\n\tint pipefd[2];\n\tstruct io *io;\n\tbool dir;\n\tuint16_t mtu;\n\tDBusMessage *reply;\n\n\tif (!gatt || !bt_gatt_client_is_ready(gatt))\n\t\treturn btd_error_failed(msg, \"Not connected\");\n\n\tif (pipe2(pipefd, O_DIRECT | O_NONBLOCK | O_CLOEXEC) < 0)\n\t\treturn btd_error_failed(msg, strerror(errno));\n\n\tdir = dbus_message_has_member(msg, \"AcquireWrite\");\n\n\tio = io_new(pipefd[!dir]);\n\tif (!io) {\n\t\tclose(pipefd[0]);\n\t\tclose(pipefd[1]);\n\t\treturn btd_error_failed(msg, strerror(EIO));\n\t}\n\n\tio_set_close_on_destroy(io, true);\n\n\tif (!io_set_read_handler(io, chrc_pipe_read, chrc, NULL))\n\t\tgoto fail;\n\n\tif (!io_set_disconnect_handler(io, characteristic_pipe_hup, chrc, NULL))\n\t\tgoto fail;\n\n\tmtu = bt_gatt_client_get_mtu(gatt);\n\n\treply = g_dbus_create_reply(msg, DBUS_TYPE_UNIX_FD, &pipefd[dir],\n\t\t\t\t\tDBUS_TYPE_UINT16, &mtu,\n\t\t\t\t\tDBUS_TYPE_INVALID);\n\n\tclose(pipefd[dir]);\n\n\tif (dir) {\n\t\tchrc->write_io->io = io;\n\t\tg_dbus_emit_property_changed(btd_get_dbus_connection(),\n\t\t\t\t\t\tchrc->path,\n\t\t\t\t\t\tGATT_CHARACTERISTIC_IFACE,\n\t\t\t\t\t\t\"WriteAcquired\");\n\t} else {\n\t\tchrc->notify_io->io = io;\n\t\tg_dbus_emit_property_changed(btd_get_dbus_connection(),\n\t\t\t\t\t\tchrc->path,\n\t\t\t\t\t\tGATT_CHARACTERISTIC_IFACE,\n\t\t\t\t\t\t\"NotifyAcquired\");\n\t}\n\n\tqueue_push_tail(chrc->service->client->ios, io);\n\n\tDBG(\"%s: sender %s io %p\", dbus_message_get_member(msg),\n\t\t\t\t\tdbus_message_get_sender(msg), io);\n\n\treturn reply;\n\nfail:\n\tio_destroy(io);\n\tclose(pipefd[dir]);\n\treturn btd_error_failed(msg, strerror(EIO));\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_unref",
          "args": [
            "chrc->write_io->msg"
          ],
          "line": 1204
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_send_message",
          "args": [
            "btd_get_dbus_connection()",
            "reply"
          ],
          "line": 1202
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void characteristic_ready(bool success, uint8_t ecode, void *user_data)\n{\n\tstruct characteristic *chrc = user_data;\n\tDBusMessage *reply;\n\n\tchrc->ready_id = 0;\n\n\tif (chrc->write_io && chrc->write_io->msg) {\n\t\treply = characteristic_create_pipe(chrc, chrc->write_io->msg);\n\n\t\tg_dbus_send_message(btd_get_dbus_connection(), reply);\n\n\t\tdbus_message_unref(chrc->write_io->msg);\n\t\tchrc->write_io->msg = NULL;\n\t}\n\n\tif (chrc->notify_io && chrc->notify_io->msg) {\n\t\treply = characteristic_create_pipe(chrc, chrc->notify_io->msg);\n\n\t\tg_dbus_send_message(btd_get_dbus_connection(), reply);\n\n\t\tdbus_message_unref(chrc->notify_io->msg);\n\t\tchrc->notify_io->msg = NULL;\n\t}\n}"
  },
  {
    "function_name": "characteristic_create_pipe",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "1124-1190",
    "snippet": "static DBusMessage *characteristic_create_pipe(struct characteristic *chrc,\n\t\t\t\t\t\tDBusMessage *msg)\n{\n\tstruct bt_gatt_client *gatt = chrc->service->client->gatt;\n\tint pipefd[2];\n\tstruct io *io;\n\tbool dir;\n\tuint16_t mtu;\n\tDBusMessage *reply;\n\n\tif (!gatt || !bt_gatt_client_is_ready(gatt))\n\t\treturn btd_error_failed(msg, \"Not connected\");\n\n\tif (pipe2(pipefd, O_DIRECT | O_NONBLOCK | O_CLOEXEC) < 0)\n\t\treturn btd_error_failed(msg, strerror(errno));\n\n\tdir = dbus_message_has_member(msg, \"AcquireWrite\");\n\n\tio = io_new(pipefd[!dir]);\n\tif (!io) {\n\t\tclose(pipefd[0]);\n\t\tclose(pipefd[1]);\n\t\treturn btd_error_failed(msg, strerror(EIO));\n\t}\n\n\tio_set_close_on_destroy(io, true);\n\n\tif (!io_set_read_handler(io, chrc_pipe_read, chrc, NULL))\n\t\tgoto fail;\n\n\tif (!io_set_disconnect_handler(io, characteristic_pipe_hup, chrc, NULL))\n\t\tgoto fail;\n\n\tmtu = bt_gatt_client_get_mtu(gatt);\n\n\treply = g_dbus_create_reply(msg, DBUS_TYPE_UNIX_FD, &pipefd[dir],\n\t\t\t\t\tDBUS_TYPE_UINT16, &mtu,\n\t\t\t\t\tDBUS_TYPE_INVALID);\n\n\tclose(pipefd[dir]);\n\n\tif (dir) {\n\t\tchrc->write_io->io = io;\n\t\tg_dbus_emit_property_changed(btd_get_dbus_connection(),\n\t\t\t\t\t\tchrc->path,\n\t\t\t\t\t\tGATT_CHARACTERISTIC_IFACE,\n\t\t\t\t\t\t\"WriteAcquired\");\n\t} else {\n\t\tchrc->notify_io->io = io;\n\t\tg_dbus_emit_property_changed(btd_get_dbus_connection(),\n\t\t\t\t\t\tchrc->path,\n\t\t\t\t\t\tGATT_CHARACTERISTIC_IFACE,\n\t\t\t\t\t\t\"NotifyAcquired\");\n\t}\n\n\tqueue_push_tail(chrc->service->client->ios, io);\n\n\tDBG(\"%s: sender %s io %p\", dbus_message_get_member(msg),\n\t\t\t\t\tdbus_message_get_sender(msg), io);\n\n\treturn reply;\n\nfail:\n\tio_destroy(io);\n\tclose(pipefd[dir]);\n\treturn btd_error_failed(msg, strerror(EIO));\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define GATT_CHARACTERISTIC_IFACE\t\"org.bluez.GattCharacteristic1\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "btd_error_failed",
          "args": [
            "msg",
            "strerror(EIO)"
          ],
          "line": 1189
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "124-128",
          "snippet": "DBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "strerror",
          "args": [
            "EIO"
          ],
          "line": 1189
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "close",
          "args": [
            "pipefd[dir]"
          ],
          "line": 1188
        },
        "resolved": true,
        "details": {
          "function_name": "hfp_context_close_container",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
          "lines": "334-347",
          "snippet": "bool hfp_context_close_container(struct hfp_context *context)\n{\n\tskip_whitespace(context);\n\n\t/* The list shall be followed by a right parenthesis (\")\" V250 5.7.3.1*/\n\tif (context->data[context->offset] != ')')\n\t\treturn false;\n\n\tcontext->offset++;\n\n\tnext_field(context);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/hfp.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <ctype.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nbool hfp_context_close_container(struct hfp_context *context)\n{\n\tskip_whitespace(context);\n\n\t/* The list shall be followed by a right parenthesis (\")\" V250 5.7.3.1*/\n\tif (context->data[context->offset] != ')')\n\t\treturn false;\n\n\tcontext->offset++;\n\n\tnext_field(context);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "io_destroy",
          "args": [
            "io"
          ],
          "line": 1187
        },
        "resolved": true,
        "details": {
          "function_name": "notify_io_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "1457-1463",
          "snippet": "static void notify_io_destroy(void *data)\n{\n\tstruct notify_client *client = data;\n\n\tif (queue_remove(client->chrc->notify_clients, client))\n\t\tnotify_client_unref(client);\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void notify_io_destroy(void *data)\n{\n\tstruct notify_client *client = data;\n\n\tif (queue_remove(client->chrc->notify_clients, client))\n\t\tnotify_client_unref(client);\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"%s: sender %s io %p\"",
            "dbus_message_get_member(msg)",
            "dbus_message_get_sender(msg)",
            "io"
          ],
          "line": 1181
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_get_sender",
          "args": [
            "msg"
          ],
          "line": 1182
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_get_member",
          "args": [
            "msg"
          ],
          "line": 1181
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "queue_push_tail",
          "args": [
            "chrc->service->client->ios",
            "io"
          ],
          "line": 1179
        },
        "resolved": true,
        "details": {
          "function_name": "queue_push_tail",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "88-108",
          "snippet": "bool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_emit_property_changed",
          "args": [
            "btd_get_dbus_connection()",
            "chrc->path",
            "GATT_CHARACTERISTIC_IFACE",
            "\"NotifyAcquired\""
          ],
          "line": 1173
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_get_dbus_connection",
          "args": [],
          "line": 1173
        },
        "resolved": true,
        "details": {
          "function_name": "btd_get_dbus_connection",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/dbus-common.c",
          "lines": "61-64",
          "snippet": "DBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *connection = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *connection = NULL;\n\nDBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_emit_property_changed",
          "args": [
            "btd_get_dbus_connection()",
            "chrc->path",
            "GATT_CHARACTERISTIC_IFACE",
            "\"WriteAcquired\""
          ],
          "line": 1167
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_create_reply",
          "args": [
            "msg",
            "DBUS_TYPE_UNIX_FD",
            "&pipefd[dir]",
            "DBUS_TYPE_UINT16",
            "&mtu",
            "DBUS_TYPE_INVALID"
          ],
          "line": 1159
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_gatt_client_get_mtu",
          "args": [
            "gatt"
          ],
          "line": 1157
        },
        "resolved": true,
        "details": {
          "function_name": "bt_gatt_client_get_mtu",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-client.c",
          "lines": "2088-2094",
          "snippet": "uint16_t bt_gatt_client_get_mtu(struct bt_gatt_client *client)\n{\n\tif (!client || !client->att)\n\t\treturn 0;\n\n\treturn bt_att_get_mtu(client->att);\n}",
          "includes": [
            "#include <sys/uio.h>",
            "#include <limits.h>",
            "#include <assert.h>",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-helpers.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/att.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/uio.h>\n#include <limits.h>\n#include <assert.h>\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-helpers.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/att.h\"\n#include <config.h>\n\nuint16_t bt_gatt_client_get_mtu(struct bt_gatt_client *client)\n{\n\tif (!client || !client->att)\n\t\treturn 0;\n\n\treturn bt_att_get_mtu(client->att);\n}"
        }
      },
      {
        "call_info": {
          "callee": "io_set_disconnect_handler",
          "args": [
            "io",
            "characteristic_pipe_hup",
            "chrc",
            "NULL"
          ],
          "line": 1154
        },
        "resolved": true,
        "details": {
          "function_name": "io_set_disconnect_handler",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-glib.c",
          "lines": "260-264",
          "snippet": "bool io_set_disconnect_handler(struct io *io, io_callback_func_t callback,\n\t\t\t\tvoid *user_data, io_destroy_func_t destroy)\n{\n\treturn io_set_handler(io, G_IO_HUP, callback, user_data, destroy);\n}",
          "includes": [
            "#include \"src/shared/io.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/io.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nbool io_set_disconnect_handler(struct io *io, io_callback_func_t callback,\n\t\t\t\tvoid *user_data, io_destroy_func_t destroy)\n{\n\treturn io_set_handler(io, G_IO_HUP, callback, user_data, destroy);\n}"
        }
      },
      {
        "call_info": {
          "callee": "io_set_read_handler",
          "args": [
            "io",
            "chrc_pipe_read",
            "chrc",
            "NULL"
          ],
          "line": 1151
        },
        "resolved": true,
        "details": {
          "function_name": "io_set_read_handler",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-glib.c",
          "lines": "248-252",
          "snippet": "bool io_set_read_handler(struct io *io, io_callback_func_t callback,\n\t\t\t\tvoid *user_data, io_destroy_func_t destroy)\n{\n\treturn io_set_handler(io, G_IO_IN, callback, user_data, destroy);\n}",
          "includes": [
            "#include \"src/shared/io.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/io.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nbool io_set_read_handler(struct io *io, io_callback_func_t callback,\n\t\t\t\tvoid *user_data, io_destroy_func_t destroy)\n{\n\treturn io_set_handler(io, G_IO_IN, callback, user_data, destroy);\n}"
        }
      },
      {
        "call_info": {
          "callee": "io_set_close_on_destroy",
          "args": [
            "io",
            "true"
          ],
          "line": 1149
        },
        "resolved": true,
        "details": {
          "function_name": "io_set_close_on_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-glib.c",
          "lines": "145-156",
          "snippet": "bool io_set_close_on_destroy(struct io *io, bool do_close)\n{\n\tif (!io)\n\t\treturn false;\n\n\tif (do_close)\n\t\tg_io_channel_set_close_on_unref(io->channel, TRUE);\n\telse\n\t\tg_io_channel_set_close_on_unref(io->channel, FALSE);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/io.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/io.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nbool io_set_close_on_destroy(struct io *io, bool do_close)\n{\n\tif (!io)\n\t\treturn false;\n\n\tif (do_close)\n\t\tg_io_channel_set_close_on_unref(io->channel, TRUE);\n\telse\n\t\tg_io_channel_set_close_on_unref(io->channel, FALSE);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strerror",
          "args": [
            "EIO"
          ],
          "line": 1146
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "io_new",
          "args": [
            "pipefd[!dir]"
          ],
          "line": 1142
        },
        "resolved": true,
        "details": {
          "function_name": "io_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-glib.c",
          "lines": "71-90",
          "snippet": "struct io *io_new(int fd)\n{\n\tstruct io *io;\n\n\tif (fd < 0)\n\t\treturn NULL;\n\n\tio = g_try_new0(struct io, 1);\n\tif (!io)\n\t\treturn NULL;\n\n\tio->channel = g_io_channel_unix_new(fd);\n\n\tg_io_channel_set_encoding(io->channel, NULL, NULL);\n\tg_io_channel_set_buffered(io->channel, FALSE);\n\n\tg_io_channel_set_close_on_unref(io->channel, FALSE);\n\n\treturn io_ref(io);\n}",
          "includes": [
            "#include \"src/shared/io.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/io.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nstruct io *io_new(int fd)\n{\n\tstruct io *io;\n\n\tif (fd < 0)\n\t\treturn NULL;\n\n\tio = g_try_new0(struct io, 1);\n\tif (!io)\n\t\treturn NULL;\n\n\tio->channel = g_io_channel_unix_new(fd);\n\n\tg_io_channel_set_encoding(io->channel, NULL, NULL);\n\tg_io_channel_set_buffered(io->channel, FALSE);\n\n\tg_io_channel_set_close_on_unref(io->channel, FALSE);\n\n\treturn io_ref(io);\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_has_member",
          "args": [
            "msg",
            "\"AcquireWrite\""
          ],
          "line": 1140
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strerror",
          "args": [
            "errno"
          ],
          "line": 1138
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pipe2",
          "args": [
            "pipefd",
            "O_DIRECT | O_NONBLOCK | O_CLOEXEC"
          ],
          "line": 1137
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_gatt_client_is_ready",
          "args": [
            "gatt"
          ],
          "line": 1134
        },
        "resolved": true,
        "details": {
          "function_name": "bt_gatt_client_is_ready",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-client.c",
          "lines": "2015-2018",
          "snippet": "bool bt_gatt_client_is_ready(struct bt_gatt_client *client)\n{\n\treturn (client && client->ready);\n}",
          "includes": [
            "#include <sys/uio.h>",
            "#include <limits.h>",
            "#include <assert.h>",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-helpers.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/att.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/uio.h>\n#include <limits.h>\n#include <assert.h>\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-helpers.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/att.h\"\n#include <config.h>\n\nbool bt_gatt_client_is_ready(struct bt_gatt_client *client)\n{\n\treturn (client && client->ready);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\n#define GATT_CHARACTERISTIC_IFACE\t\"org.bluez.GattCharacteristic1\"\n\nstatic DBusMessage *characteristic_create_pipe(struct characteristic *chrc,\n\t\t\t\t\t\tDBusMessage *msg)\n{\n\tstruct bt_gatt_client *gatt = chrc->service->client->gatt;\n\tint pipefd[2];\n\tstruct io *io;\n\tbool dir;\n\tuint16_t mtu;\n\tDBusMessage *reply;\n\n\tif (!gatt || !bt_gatt_client_is_ready(gatt))\n\t\treturn btd_error_failed(msg, \"Not connected\");\n\n\tif (pipe2(pipefd, O_DIRECT | O_NONBLOCK | O_CLOEXEC) < 0)\n\t\treturn btd_error_failed(msg, strerror(errno));\n\n\tdir = dbus_message_has_member(msg, \"AcquireWrite\");\n\n\tio = io_new(pipefd[!dir]);\n\tif (!io) {\n\t\tclose(pipefd[0]);\n\t\tclose(pipefd[1]);\n\t\treturn btd_error_failed(msg, strerror(EIO));\n\t}\n\n\tio_set_close_on_destroy(io, true);\n\n\tif (!io_set_read_handler(io, chrc_pipe_read, chrc, NULL))\n\t\tgoto fail;\n\n\tif (!io_set_disconnect_handler(io, characteristic_pipe_hup, chrc, NULL))\n\t\tgoto fail;\n\n\tmtu = bt_gatt_client_get_mtu(gatt);\n\n\treply = g_dbus_create_reply(msg, DBUS_TYPE_UNIX_FD, &pipefd[dir],\n\t\t\t\t\tDBUS_TYPE_UINT16, &mtu,\n\t\t\t\t\tDBUS_TYPE_INVALID);\n\n\tclose(pipefd[dir]);\n\n\tif (dir) {\n\t\tchrc->write_io->io = io;\n\t\tg_dbus_emit_property_changed(btd_get_dbus_connection(),\n\t\t\t\t\t\tchrc->path,\n\t\t\t\t\t\tGATT_CHARACTERISTIC_IFACE,\n\t\t\t\t\t\t\"WriteAcquired\");\n\t} else {\n\t\tchrc->notify_io->io = io;\n\t\tg_dbus_emit_property_changed(btd_get_dbus_connection(),\n\t\t\t\t\t\tchrc->path,\n\t\t\t\t\t\tGATT_CHARACTERISTIC_IFACE,\n\t\t\t\t\t\t\"NotifyAcquired\");\n\t}\n\n\tqueue_push_tail(chrc->service->client->ios, io);\n\n\tDBG(\"%s: sender %s io %p\", dbus_message_get_member(msg),\n\t\t\t\t\tdbus_message_get_sender(msg), io);\n\n\treturn reply;\n\nfail:\n\tio_destroy(io);\n\tclose(pipefd[dir]);\n\treturn btd_error_failed(msg, strerror(EIO));\n}"
  },
  {
    "function_name": "characteristic_pipe_hup",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "1113-1122",
    "snippet": "static bool characteristic_pipe_hup(struct io *io, void *user_data)\n{\n\tstruct characteristic *chrc = user_data;\n\n\tDBG(\"%s: io %p\", chrc->path, io);\n\n\tcharacteristic_destroy_pipe(chrc, io);\n\n\treturn false;\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "characteristic_destroy_pipe",
          "args": [
            "chrc",
            "io"
          ],
          "line": 1119
        },
        "resolved": true,
        "details": {
          "function_name": "characteristic_destroy_pipe",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "1091-1111",
          "snippet": "static void characteristic_destroy_pipe(struct characteristic *chrc,\n\t\t\t\t\t\t\tstruct io *io)\n{\n\tqueue_remove(chrc->service->client->ios, io);\n\n\tif (chrc->write_io && io == chrc->write_io->io) {\n\t\tpipe_io_destroy(chrc->write_io);\n\t\tchrc->write_io = NULL;\n\t\tg_dbus_emit_property_changed(btd_get_dbus_connection(),\n\t\t\t\t\t\tchrc->path,\n\t\t\t\t\t\tGATT_CHARACTERISTIC_IFACE,\n\t\t\t\t\t\t\"WriteAcquired\");\n\t} else if (chrc->notify_io) {\n\t\tpipe_io_destroy(chrc->notify_io);\n\t\tchrc->notify_io = NULL;\n\t\tg_dbus_emit_property_changed(btd_get_dbus_connection(),\n\t\t\t\t\t\tchrc->path,\n\t\t\t\t\t\tGATT_CHARACTERISTIC_IFACE,\n\t\t\t\t\t\t\"NotifyAcquired\");\n\t}\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define GATT_CHARACTERISTIC_IFACE\t\"org.bluez.GattCharacteristic1\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\n#define GATT_CHARACTERISTIC_IFACE\t\"org.bluez.GattCharacteristic1\"\n\nstatic void characteristic_destroy_pipe(struct characteristic *chrc,\n\t\t\t\t\t\t\tstruct io *io)\n{\n\tqueue_remove(chrc->service->client->ios, io);\n\n\tif (chrc->write_io && io == chrc->write_io->io) {\n\t\tpipe_io_destroy(chrc->write_io);\n\t\tchrc->write_io = NULL;\n\t\tg_dbus_emit_property_changed(btd_get_dbus_connection(),\n\t\t\t\t\t\tchrc->path,\n\t\t\t\t\t\tGATT_CHARACTERISTIC_IFACE,\n\t\t\t\t\t\t\"WriteAcquired\");\n\t} else if (chrc->notify_io) {\n\t\tpipe_io_destroy(chrc->notify_io);\n\t\tchrc->notify_io = NULL;\n\t\tg_dbus_emit_property_changed(btd_get_dbus_connection(),\n\t\t\t\t\t\tchrc->path,\n\t\t\t\t\t\tGATT_CHARACTERISTIC_IFACE,\n\t\t\t\t\t\t\"NotifyAcquired\");\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"%s: io %p\"",
            "chrc->path",
            "io"
          ],
          "line": 1117
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic bool characteristic_pipe_hup(struct io *io, void *user_data)\n{\n\tstruct characteristic *chrc = user_data;\n\n\tDBG(\"%s: io %p\", chrc->path, io);\n\n\tcharacteristic_destroy_pipe(chrc, io);\n\n\treturn false;\n}"
  },
  {
    "function_name": "characteristic_destroy_pipe",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "1091-1111",
    "snippet": "static void characteristic_destroy_pipe(struct characteristic *chrc,\n\t\t\t\t\t\t\tstruct io *io)\n{\n\tqueue_remove(chrc->service->client->ios, io);\n\n\tif (chrc->write_io && io == chrc->write_io->io) {\n\t\tpipe_io_destroy(chrc->write_io);\n\t\tchrc->write_io = NULL;\n\t\tg_dbus_emit_property_changed(btd_get_dbus_connection(),\n\t\t\t\t\t\tchrc->path,\n\t\t\t\t\t\tGATT_CHARACTERISTIC_IFACE,\n\t\t\t\t\t\t\"WriteAcquired\");\n\t} else if (chrc->notify_io) {\n\t\tpipe_io_destroy(chrc->notify_io);\n\t\tchrc->notify_io = NULL;\n\t\tg_dbus_emit_property_changed(btd_get_dbus_connection(),\n\t\t\t\t\t\tchrc->path,\n\t\t\t\t\t\tGATT_CHARACTERISTIC_IFACE,\n\t\t\t\t\t\t\"NotifyAcquired\");\n\t}\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define GATT_CHARACTERISTIC_IFACE\t\"org.bluez.GattCharacteristic1\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_dbus_emit_property_changed",
          "args": [
            "btd_get_dbus_connection()",
            "chrc->path",
            "GATT_CHARACTERISTIC_IFACE",
            "\"NotifyAcquired\""
          ],
          "line": 1106
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_get_dbus_connection",
          "args": [],
          "line": 1106
        },
        "resolved": true,
        "details": {
          "function_name": "btd_get_dbus_connection",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/dbus-common.c",
          "lines": "61-64",
          "snippet": "DBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *connection = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *connection = NULL;\n\nDBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}"
        }
      },
      {
        "call_info": {
          "callee": "pipe_io_destroy",
          "args": [
            "chrc->notify_io"
          ],
          "line": 1104
        },
        "resolved": true,
        "details": {
          "function_name": "pipe_io_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "1079-1089",
          "snippet": "static void pipe_io_destroy(struct pipe_io *io)\n{\n\tif (io->destroy)\n\t\tio->destroy(io->data);\n\n\tif (io->msg)\n\t\tdbus_message_unref(io->msg);\n\n\tio_destroy(io->io);\n\tfree(io);\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void pipe_io_destroy(struct pipe_io *io)\n{\n\tif (io->destroy)\n\t\tio->destroy(io->data);\n\n\tif (io->msg)\n\t\tdbus_message_unref(io->msg);\n\n\tio_destroy(io->io);\n\tfree(io);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_emit_property_changed",
          "args": [
            "btd_get_dbus_connection()",
            "chrc->path",
            "GATT_CHARACTERISTIC_IFACE",
            "\"WriteAcquired\""
          ],
          "line": 1099
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "queue_remove",
          "args": [
            "chrc->service->client->ios",
            "io"
          ],
          "line": 1094
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_uuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "526-541",
          "snippet": "static bool queue_remove_uuid(struct queue *queue, bt_uuid_t *uuid)\n{\n\tbt_uuid_t *removed;\n\n\tif (!queue || !uuid)\n\t\treturn false;\n\n\tremoved = queue_remove_if(queue, uuid_match, uuid);\n\n\tif (removed) {\n\t\tfree(removed);\n\t\treturn true;\n\t}\n\n\treturn false;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic bool queue_remove_uuid(struct queue *queue, bt_uuid_t *uuid)\n{\n\tbt_uuid_t *removed;\n\n\tif (!queue || !uuid)\n\t\treturn false;\n\n\tremoved = queue_remove_if(queue, uuid_match, uuid);\n\n\tif (removed) {\n\t\tfree(removed);\n\t\treturn true;\n\t}\n\n\treturn false;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\n#define GATT_CHARACTERISTIC_IFACE\t\"org.bluez.GattCharacteristic1\"\n\nstatic void characteristic_destroy_pipe(struct characteristic *chrc,\n\t\t\t\t\t\t\tstruct io *io)\n{\n\tqueue_remove(chrc->service->client->ios, io);\n\n\tif (chrc->write_io && io == chrc->write_io->io) {\n\t\tpipe_io_destroy(chrc->write_io);\n\t\tchrc->write_io = NULL;\n\t\tg_dbus_emit_property_changed(btd_get_dbus_connection(),\n\t\t\t\t\t\tchrc->path,\n\t\t\t\t\t\tGATT_CHARACTERISTIC_IFACE,\n\t\t\t\t\t\t\"WriteAcquired\");\n\t} else if (chrc->notify_io) {\n\t\tpipe_io_destroy(chrc->notify_io);\n\t\tchrc->notify_io = NULL;\n\t\tg_dbus_emit_property_changed(btd_get_dbus_connection(),\n\t\t\t\t\t\tchrc->path,\n\t\t\t\t\t\tGATT_CHARACTERISTIC_IFACE,\n\t\t\t\t\t\t\"NotifyAcquired\");\n\t}\n}"
  },
  {
    "function_name": "pipe_io_destroy",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "1079-1089",
    "snippet": "static void pipe_io_destroy(struct pipe_io *io)\n{\n\tif (io->destroy)\n\t\tio->destroy(io->data);\n\n\tif (io->msg)\n\t\tdbus_message_unref(io->msg);\n\n\tio_destroy(io->io);\n\tfree(io);\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "io"
          ],
          "line": 1088
        },
        "resolved": true,
        "details": {
          "function_name": "service_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "1818-1826",
          "snippet": "static void service_free(void *data)\n{\n\tstruct service *service = data;\n\n\tqueue_destroy(service->chrcs, NULL);  /* List should be empty here */\n\tqueue_destroy(service->incl_services, NULL);\n\tg_free(service->path);\n\tfree(service);\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void service_free(void *data)\n{\n\tstruct service *service = data;\n\n\tqueue_destroy(service->chrcs, NULL);  /* List should be empty here */\n\tqueue_destroy(service->incl_services, NULL);\n\tg_free(service->path);\n\tfree(service);\n}"
        }
      },
      {
        "call_info": {
          "callee": "io_destroy",
          "args": [
            "io->io"
          ],
          "line": 1087
        },
        "resolved": true,
        "details": {
          "function_name": "notify_io_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "1457-1463",
          "snippet": "static void notify_io_destroy(void *data)\n{\n\tstruct notify_client *client = data;\n\n\tif (queue_remove(client->chrc->notify_clients, client))\n\t\tnotify_client_unref(client);\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void notify_io_destroy(void *data)\n{\n\tstruct notify_client *client = data;\n\n\tif (queue_remove(client->chrc->notify_clients, client))\n\t\tnotify_client_unref(client);\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_unref",
          "args": [
            "io->msg"
          ],
          "line": 1085
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "io->destroy",
          "args": [
            "io->data"
          ],
          "line": 1082
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void pipe_io_destroy(struct pipe_io *io)\n{\n\tif (io->destroy)\n\t\tio->destroy(io->data);\n\n\tif (io->msg)\n\t\tdbus_message_unref(io->msg);\n\n\tio_destroy(io->io);\n\tfree(io);\n}"
  },
  {
    "function_name": "chrc_pipe_read",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "1057-1077",
    "snippet": "static bool chrc_pipe_read(struct io *io, void *user_data)\n{\n\tstruct characteristic *chrc = user_data;\n\tstruct bt_gatt_client *gatt = chrc->service->client->gatt;\n\tuint8_t buf[512];\n\tint fd = io_get_fd(io);\n\tssize_t bytes_read;\n\n\tbytes_read = read(fd, buf, sizeof(buf));\n\tif (bytes_read < 0)\n\t\treturn false;\n\n\tif (!gatt)\n\t\treturn false;\n\n\tbt_gatt_client_write_without_response(gatt, chrc->value_handle,\n\t\t\t\t\tchrc->props & BT_GATT_CHRC_PROP_AUTH,\n\t\t\t\t\tbuf, bytes_read);\n\n\treturn true;\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bt_gatt_client_write_without_response",
          "args": [
            "gatt",
            "chrc->value_handle",
            "chrc->props & BT_GATT_CHRC_PROP_AUTH",
            "buf",
            "bytes_read"
          ],
          "line": 1072
        },
        "resolved": true,
        "details": {
          "function_name": "bt_gatt_client_write_without_response",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-client.c",
          "lines": "2556-2592",
          "snippet": "unsigned int bt_gatt_client_write_without_response(\n\t\t\t\t\tstruct bt_gatt_client *client,\n\t\t\t\t\tuint16_t value_handle,\n\t\t\t\t\tbool signed_write,\n\t\t\t\t\tconst uint8_t *value, uint16_t length) {\n\tuint8_t pdu[2 + length];\n\tstruct request *req;\n\tint security;\n\tuint8_t op;\n\n\tif (!client)\n\t\treturn 0;\n\n\treq = request_create(client);\n\tif (!req)\n\t\treturn 0;\n\n\t/* Only use signed write if unencrypted */\n\tif (signed_write) {\n\t\tsecurity = bt_att_get_security(client->att, NULL);\n\t\top = security > BT_SECURITY_LOW ?  BT_ATT_OP_WRITE_CMD :\n\t\t\t\t\t\tBT_ATT_OP_SIGNED_WRITE_CMD;\n\t} else\n\t\top = BT_ATT_OP_WRITE_CMD;\n\n\tput_le16(value_handle, pdu);\n\tmemcpy(pdu + 2, value, length);\n\n\treq->att_id = bt_att_send(client->att, op, pdu, sizeof(pdu), NULL, req,\n\t\t\t\t\t\t\t\trequest_unref);\n\tif (!req->att_id) {\n\t\trequest_unref(req);\n\t\treturn 0;\n\t}\n\n\treturn req->id;\n}",
          "includes": [
            "#include <sys/uio.h>",
            "#include <limits.h>",
            "#include <assert.h>",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-helpers.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/att.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/uio.h>\n#include <limits.h>\n#include <assert.h>\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-helpers.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/att.h\"\n#include <config.h>\n\nunsigned int bt_gatt_client_write_without_response(\n\t\t\t\t\tstruct bt_gatt_client *client,\n\t\t\t\t\tuint16_t value_handle,\n\t\t\t\t\tbool signed_write,\n\t\t\t\t\tconst uint8_t *value, uint16_t length) {\n\tuint8_t pdu[2 + length];\n\tstruct request *req;\n\tint security;\n\tuint8_t op;\n\n\tif (!client)\n\t\treturn 0;\n\n\treq = request_create(client);\n\tif (!req)\n\t\treturn 0;\n\n\t/* Only use signed write if unencrypted */\n\tif (signed_write) {\n\t\tsecurity = bt_att_get_security(client->att, NULL);\n\t\top = security > BT_SECURITY_LOW ?  BT_ATT_OP_WRITE_CMD :\n\t\t\t\t\t\tBT_ATT_OP_SIGNED_WRITE_CMD;\n\t} else\n\t\top = BT_ATT_OP_WRITE_CMD;\n\n\tput_le16(value_handle, pdu);\n\tmemcpy(pdu + 2, value, length);\n\n\treq->att_id = bt_att_send(client->att, op, pdu, sizeof(pdu), NULL, req,\n\t\t\t\t\t\t\t\trequest_unref);\n\tif (!req->att_id) {\n\t\trequest_unref(req);\n\t\treturn 0;\n\t}\n\n\treturn req->id;\n}"
        }
      },
      {
        "call_info": {
          "callee": "read",
          "args": [
            "fd",
            "buf",
            "sizeof(buf)"
          ],
          "line": 1065
        },
        "resolved": true,
        "details": {
          "function_name": "characteristic_ready",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "1192-1216",
          "snippet": "static void characteristic_ready(bool success, uint8_t ecode, void *user_data)\n{\n\tstruct characteristic *chrc = user_data;\n\tDBusMessage *reply;\n\n\tchrc->ready_id = 0;\n\n\tif (chrc->write_io && chrc->write_io->msg) {\n\t\treply = characteristic_create_pipe(chrc, chrc->write_io->msg);\n\n\t\tg_dbus_send_message(btd_get_dbus_connection(), reply);\n\n\t\tdbus_message_unref(chrc->write_io->msg);\n\t\tchrc->write_io->msg = NULL;\n\t}\n\n\tif (chrc->notify_io && chrc->notify_io->msg) {\n\t\treply = characteristic_create_pipe(chrc, chrc->notify_io->msg);\n\n\t\tg_dbus_send_message(btd_get_dbus_connection(), reply);\n\n\t\tdbus_message_unref(chrc->notify_io->msg);\n\t\tchrc->notify_io->msg = NULL;\n\t}\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void characteristic_ready(bool success, uint8_t ecode, void *user_data)\n{\n\tstruct characteristic *chrc = user_data;\n\tDBusMessage *reply;\n\n\tchrc->ready_id = 0;\n\n\tif (chrc->write_io && chrc->write_io->msg) {\n\t\treply = characteristic_create_pipe(chrc, chrc->write_io->msg);\n\n\t\tg_dbus_send_message(btd_get_dbus_connection(), reply);\n\n\t\tdbus_message_unref(chrc->write_io->msg);\n\t\tchrc->write_io->msg = NULL;\n\t}\n\n\tif (chrc->notify_io && chrc->notify_io->msg) {\n\t\treply = characteristic_create_pipe(chrc, chrc->notify_io->msg);\n\n\t\tg_dbus_send_message(btd_get_dbus_connection(), reply);\n\n\t\tdbus_message_unref(chrc->notify_io->msg);\n\t\tchrc->notify_io->msg = NULL;\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "io_get_fd",
          "args": [
            "io"
          ],
          "line": 1062
        },
        "resolved": true,
        "details": {
          "function_name": "io_get_fd",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-glib.c",
          "lines": "137-143",
          "snippet": "int io_get_fd(struct io *io)\n{\n\tif (!io)\n\t\treturn -ENOTCONN;\n\n\treturn g_io_channel_unix_get_fd(io->channel);\n}",
          "includes": [
            "#include \"src/shared/io.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/io.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nint io_get_fd(struct io *io)\n{\n\tif (!io)\n\t\treturn -ENOTCONN;\n\n\treturn g_io_channel_unix_get_fd(io->channel);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic bool chrc_pipe_read(struct io *io, void *user_data)\n{\n\tstruct characteristic *chrc = user_data;\n\tstruct bt_gatt_client *gatt = chrc->service->client->gatt;\n\tuint8_t buf[512];\n\tint fd = io_get_fd(io);\n\tssize_t bytes_read;\n\n\tbytes_read = read(fd, buf, sizeof(buf));\n\tif (bytes_read < 0)\n\t\treturn false;\n\n\tif (!gatt)\n\t\treturn false;\n\n\tbt_gatt_client_write_without_response(gatt, chrc->value_handle,\n\t\t\t\t\tchrc->props & BT_GATT_CHRC_PROP_AUTH,\n\t\t\t\t\tbuf, bytes_read);\n\n\treturn true;\n}"
  },
  {
    "function_name": "characteristic_write_value",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "966-1055",
    "snippet": "static DBusMessage *characteristic_write_value(DBusConnection *conn,\n\t\t\t\t\tDBusMessage *msg, void *user_data)\n{\n\tstruct characteristic *chrc = user_data;\n\tstruct bt_gatt_client *gatt = chrc->service->client->gatt;\n\tDBusMessageIter iter;\n\tuint8_t *value = NULL;\n\tint value_len = 0;\n\tbool supported = false;\n\tuint16_t offset = 0;\n\n\tif (!gatt)\n\t\treturn btd_error_failed(msg, \"Not connected\");\n\n\tif (chrc->write_io)\n\t\treturn btd_error_not_permitted(msg, \"Write acquired\");\n\n\tif (chrc->write_op)\n\t\treturn btd_error_in_progress(msg);\n\n\tdbus_message_iter_init(msg, &iter);\n\n\tif (parse_value_arg(&iter, &value, &value_len))\n\t\treturn btd_error_invalid_args(msg);\n\n\tdbus_message_iter_next(&iter);\n\n\tif (parse_options(&iter, &offset))\n\t\treturn btd_error_invalid_args(msg);\n\n\t/*\n\t * Decide which write to use based on characteristic properties. For now\n\t * we don't perform signed writes since gatt-client doesn't support them\n\t * and the user can always encrypt the through pairing. The procedure to\n\t * use is determined based on the following priority:\n\t *\n\t *   * \"reliable-write\" property set -> reliable long-write.\n\t *   * \"write\" property set -> write request.\n\t *     - If value is larger than MTU - 3: long-write\n\t *   * \"write-without-response\" property set -> write command.\n\t */\n\tif ((chrc->ext_props & BT_GATT_CHRC_EXT_PROP_RELIABLE_WRITE)) {\n\t\tsupported = true;\n\t\tchrc->write_op = start_long_write(msg, chrc->value_handle, gatt,\n\t\t\t\t\t\ttrue, value, value_len, offset,\n\t\t\t\t\t\tchrc, chrc_write_complete);\n\t\tif (chrc->write_op)\n\t\t\treturn NULL;\n\t}\n\n\tif (chrc->props & BT_GATT_CHRC_PROP_WRITE) {\n\t\tuint16_t mtu;\n\n\t\tsupported = true;\n\t\tmtu = bt_gatt_client_get_mtu(gatt);\n\t\tif (!mtu)\n\t\t\treturn btd_error_failed(msg, \"No ATT transport\");\n\n\t\tif (value_len <= mtu - 3 && !offset)\n\t\t\tchrc->write_op = start_write_request(msg,\n\t\t\t\t\t\tchrc->value_handle,\n\t\t\t\t\t\tgatt, value, value_len,\n\t\t\t\t\t\tchrc, chrc_write_complete);\n\t\telse\n\t\t\tchrc->write_op = start_long_write(msg,\n\t\t\t\t\t\tchrc->value_handle, gatt,\n\t\t\t\t\t\tfalse, value, value_len, offset,\n\t\t\t\t\t\tchrc, chrc_write_complete);\n\n\t\tif (chrc->write_op)\n\t\t\treturn NULL;\n\t}\n\n\tif (!(chrc->props & BT_GATT_CHRC_PROP_WRITE_WITHOUT_RESP))\n\t\tgoto fail;\n\n\tsupported = true;\n\n\tif (bt_gatt_client_write_without_response(gatt,\n\t\t\t\t\tchrc->value_handle,\n\t\t\t\t\tchrc->props & BT_GATT_CHRC_PROP_AUTH,\n\t\t\t\t\tvalue, value_len))\n\t\treturn dbus_message_new_method_return(msg);\n\nfail:\n\tif (supported)\n\t\treturn btd_error_failed(msg, \"Failed to initiate write\");\n\n\treturn btd_error_not_supported(msg);\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "btd_error_not_supported",
          "args": [
            "msg"
          ],
          "line": 1054
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_not_supported",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "58-62",
          "snippet": "DBusMessage *btd_error_not_supported(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotSupported\",\n\t\t\t\t\t\"Operation is not supported\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_not_supported(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotSupported\",\n\t\t\t\t\t\"Operation is not supported\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_error_failed",
          "args": [
            "msg",
            "\"Failed to initiate write\""
          ],
          "line": 1052
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "124-128",
          "snippet": "DBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_new_method_return",
          "args": [
            "msg"
          ],
          "line": 1048
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_gatt_client_write_without_response",
          "args": [
            "gatt",
            "chrc->value_handle",
            "chrc->props & BT_GATT_CHRC_PROP_AUTH",
            "value",
            "value_len"
          ],
          "line": 1044
        },
        "resolved": true,
        "details": {
          "function_name": "bt_gatt_client_write_without_response",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-client.c",
          "lines": "2556-2592",
          "snippet": "unsigned int bt_gatt_client_write_without_response(\n\t\t\t\t\tstruct bt_gatt_client *client,\n\t\t\t\t\tuint16_t value_handle,\n\t\t\t\t\tbool signed_write,\n\t\t\t\t\tconst uint8_t *value, uint16_t length) {\n\tuint8_t pdu[2 + length];\n\tstruct request *req;\n\tint security;\n\tuint8_t op;\n\n\tif (!client)\n\t\treturn 0;\n\n\treq = request_create(client);\n\tif (!req)\n\t\treturn 0;\n\n\t/* Only use signed write if unencrypted */\n\tif (signed_write) {\n\t\tsecurity = bt_att_get_security(client->att, NULL);\n\t\top = security > BT_SECURITY_LOW ?  BT_ATT_OP_WRITE_CMD :\n\t\t\t\t\t\tBT_ATT_OP_SIGNED_WRITE_CMD;\n\t} else\n\t\top = BT_ATT_OP_WRITE_CMD;\n\n\tput_le16(value_handle, pdu);\n\tmemcpy(pdu + 2, value, length);\n\n\treq->att_id = bt_att_send(client->att, op, pdu, sizeof(pdu), NULL, req,\n\t\t\t\t\t\t\t\trequest_unref);\n\tif (!req->att_id) {\n\t\trequest_unref(req);\n\t\treturn 0;\n\t}\n\n\treturn req->id;\n}",
          "includes": [
            "#include <sys/uio.h>",
            "#include <limits.h>",
            "#include <assert.h>",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-helpers.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/att.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/uio.h>\n#include <limits.h>\n#include <assert.h>\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-helpers.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/att.h\"\n#include <config.h>\n\nunsigned int bt_gatt_client_write_without_response(\n\t\t\t\t\tstruct bt_gatt_client *client,\n\t\t\t\t\tuint16_t value_handle,\n\t\t\t\t\tbool signed_write,\n\t\t\t\t\tconst uint8_t *value, uint16_t length) {\n\tuint8_t pdu[2 + length];\n\tstruct request *req;\n\tint security;\n\tuint8_t op;\n\n\tif (!client)\n\t\treturn 0;\n\n\treq = request_create(client);\n\tif (!req)\n\t\treturn 0;\n\n\t/* Only use signed write if unencrypted */\n\tif (signed_write) {\n\t\tsecurity = bt_att_get_security(client->att, NULL);\n\t\top = security > BT_SECURITY_LOW ?  BT_ATT_OP_WRITE_CMD :\n\t\t\t\t\t\tBT_ATT_OP_SIGNED_WRITE_CMD;\n\t} else\n\t\top = BT_ATT_OP_WRITE_CMD;\n\n\tput_le16(value_handle, pdu);\n\tmemcpy(pdu + 2, value, length);\n\n\treq->att_id = bt_att_send(client->att, op, pdu, sizeof(pdu), NULL, req,\n\t\t\t\t\t\t\t\trequest_unref);\n\tif (!req->att_id) {\n\t\trequest_unref(req);\n\t\treturn 0;\n\t}\n\n\treturn req->id;\n}"
        }
      },
      {
        "call_info": {
          "callee": "start_long_write",
          "args": [
            "msg",
            "chrc->value_handle",
            "gatt",
            "false",
            "value",
            "value_len",
            "offset",
            "chrc",
            "chrc_write_complete"
          ],
          "line": 1030
        },
        "resolved": true,
        "details": {
          "function_name": "start_long_write",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "516-540",
          "snippet": "static struct async_dbus_op *start_long_write(DBusMessage *msg, uint16_t handle,\n\t\t\t\t\tstruct bt_gatt_client *gatt,\n\t\t\t\t\tbool reliable, const uint8_t *value,\n\t\t\t\t\tsize_t value_len, uint16_t offset,\n\t\t\t\t\tvoid *data,\n\t\t\t\t\tasync_dbus_op_complete_t complete)\n{\n\tstruct async_dbus_op *op;\n\n\top = async_dbus_op_new(msg, data);\n\top->complete = complete;\n\top->offset = offset;\n\n\top->id = bt_gatt_client_write_long_value(gatt, reliable, handle, offset,\n\t\t\t\t\t\t\tvalue, value_len,\n\t\t\t\t\t\t\twrite_result_cb, op,\n\t\t\t\t\t\t\tasync_dbus_op_free);\n\n\tif (!op->id) {\n\t\tasync_dbus_op_free(op);\n\t\treturn NULL;\n\t}\n\n\treturn op;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic struct async_dbus_op *start_long_write(DBusMessage *msg, uint16_t handle,\n\t\t\t\t\tstruct bt_gatt_client *gatt,\n\t\t\t\t\tbool reliable, const uint8_t *value,\n\t\t\t\t\tsize_t value_len, uint16_t offset,\n\t\t\t\t\tvoid *data,\n\t\t\t\t\tasync_dbus_op_complete_t complete)\n{\n\tstruct async_dbus_op *op;\n\n\top = async_dbus_op_new(msg, data);\n\top->complete = complete;\n\top->offset = offset;\n\n\top->id = bt_gatt_client_write_long_value(gatt, reliable, handle, offset,\n\t\t\t\t\t\t\tvalue, value_len,\n\t\t\t\t\t\t\twrite_result_cb, op,\n\t\t\t\t\t\t\tasync_dbus_op_free);\n\n\tif (!op->id) {\n\t\tasync_dbus_op_free(op);\n\t\treturn NULL;\n\t}\n\n\treturn op;\n}"
        }
      },
      {
        "call_info": {
          "callee": "start_write_request",
          "args": [
            "msg",
            "chrc->value_handle",
            "gatt",
            "value",
            "value_len",
            "chrc",
            "chrc_write_complete"
          ],
          "line": 1025
        },
        "resolved": true,
        "details": {
          "function_name": "start_write_request",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "542-563",
          "snippet": "static struct async_dbus_op *start_write_request(DBusMessage *msg,\n\t\t\t\t\tuint16_t handle,\n\t\t\t\t\tstruct bt_gatt_client *gatt,\n\t\t\t\t\tconst uint8_t *value, size_t value_len,\n\t\t\t\t\tvoid *data,\n\t\t\t\t\tasync_dbus_op_complete_t complete)\n{\n\tstruct async_dbus_op *op;\n\n\top = async_dbus_op_new(msg, data);\n\top->complete = complete;\n\n\top->id = bt_gatt_client_write_value(gatt, handle, value, value_len,\n\t\t\t\t\t\t\twrite_cb, op,\n\t\t\t\t\t\t\tasync_dbus_op_free);\n\tif (!op->id) {\n\t\tasync_dbus_op_free(op);\n\t\treturn NULL;\n\t}\n\n\treturn op;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic struct async_dbus_op *start_write_request(DBusMessage *msg,\n\t\t\t\t\tuint16_t handle,\n\t\t\t\t\tstruct bt_gatt_client *gatt,\n\t\t\t\t\tconst uint8_t *value, size_t value_len,\n\t\t\t\t\tvoid *data,\n\t\t\t\t\tasync_dbus_op_complete_t complete)\n{\n\tstruct async_dbus_op *op;\n\n\top = async_dbus_op_new(msg, data);\n\top->complete = complete;\n\n\top->id = bt_gatt_client_write_value(gatt, handle, value, value_len,\n\t\t\t\t\t\t\twrite_cb, op,\n\t\t\t\t\t\t\tasync_dbus_op_free);\n\tif (!op->id) {\n\t\tasync_dbus_op_free(op);\n\t\treturn NULL;\n\t}\n\n\treturn op;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_gatt_client_get_mtu",
          "args": [
            "gatt"
          ],
          "line": 1020
        },
        "resolved": true,
        "details": {
          "function_name": "bt_gatt_client_get_mtu",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-client.c",
          "lines": "2088-2094",
          "snippet": "uint16_t bt_gatt_client_get_mtu(struct bt_gatt_client *client)\n{\n\tif (!client || !client->att)\n\t\treturn 0;\n\n\treturn bt_att_get_mtu(client->att);\n}",
          "includes": [
            "#include <sys/uio.h>",
            "#include <limits.h>",
            "#include <assert.h>",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-helpers.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/att.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/uio.h>\n#include <limits.h>\n#include <assert.h>\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-helpers.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/att.h\"\n#include <config.h>\n\nuint16_t bt_gatt_client_get_mtu(struct bt_gatt_client *client)\n{\n\tif (!client || !client->att)\n\t\treturn 0;\n\n\treturn bt_att_get_mtu(client->att);\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_error_invalid_args",
          "args": [
            "msg"
          ],
          "line": 994
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_invalid_args",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "34-38",
          "snippet": "DBusMessage *btd_error_invalid_args(DBusMessage *msg)\n{\n\treturn btd_error_invalid_args_str(msg,\n\t\t\t\t\t\"Invalid arguments in method call\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_invalid_args(DBusMessage *msg)\n{\n\treturn btd_error_invalid_args_str(msg,\n\t\t\t\t\t\"Invalid arguments in method call\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "parse_options",
          "args": [
            "&iter",
            "&offset"
          ],
          "line": 993
        },
        "resolved": true,
        "details": {
          "function_name": "parse_options",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "391-422",
          "snippet": "static int parse_options(DBusMessageIter *iter, uint16_t *offset)\n{\n\tDBusMessageIter dict;\n\n\tif (dbus_message_iter_get_arg_type(iter) != DBUS_TYPE_ARRAY)\n\t\treturn -EINVAL;\n\n\tdbus_message_iter_recurse(iter, &dict);\n\n\twhile (dbus_message_iter_get_arg_type(&dict) == DBUS_TYPE_DICT_ENTRY) {\n\t\tconst char *key;\n\t\tDBusMessageIter value, entry;\n\t\tint var;\n\n\t\tdbus_message_iter_recurse(&dict, &entry);\n\t\tdbus_message_iter_get_basic(&entry, &key);\n\n\t\tdbus_message_iter_next(&entry);\n\t\tdbus_message_iter_recurse(&entry, &value);\n\n\t\tvar = dbus_message_iter_get_arg_type(&value);\n\t\tif (strcasecmp(key, \"offset\") == 0) {\n\t\t\tif (var != DBUS_TYPE_UINT16)\n\t\t\t\treturn -EINVAL;\n\t\t\tdbus_message_iter_get_basic(&value, offset);\n\t\t}\n\n\t\tdbus_message_iter_next(&dict);\n\t}\n\n\treturn 0;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic int parse_options(DBusMessageIter *iter, uint16_t *offset)\n{\n\tDBusMessageIter dict;\n\n\tif (dbus_message_iter_get_arg_type(iter) != DBUS_TYPE_ARRAY)\n\t\treturn -EINVAL;\n\n\tdbus_message_iter_recurse(iter, &dict);\n\n\twhile (dbus_message_iter_get_arg_type(&dict) == DBUS_TYPE_DICT_ENTRY) {\n\t\tconst char *key;\n\t\tDBusMessageIter value, entry;\n\t\tint var;\n\n\t\tdbus_message_iter_recurse(&dict, &entry);\n\t\tdbus_message_iter_get_basic(&entry, &key);\n\n\t\tdbus_message_iter_next(&entry);\n\t\tdbus_message_iter_recurse(&entry, &value);\n\n\t\tvar = dbus_message_iter_get_arg_type(&value);\n\t\tif (strcasecmp(key, \"offset\") == 0) {\n\t\t\tif (var != DBUS_TYPE_UINT16)\n\t\t\t\treturn -EINVAL;\n\t\t\tdbus_message_iter_get_basic(&value, offset);\n\t\t}\n\n\t\tdbus_message_iter_next(&dict);\n\t}\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_next",
          "args": [
            "&iter"
          ],
          "line": 991
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "parse_value_arg",
          "args": [
            "&iter",
            "&value",
            "&value_len"
          ],
          "line": 988
        },
        "resolved": true,
        "details": {
          "function_name": "parse_value_arg",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "222-233",
          "snippet": "static int parse_value_arg(DBusMessageIter *iter, uint8_t **value, int *len)\n{\n\tDBusMessageIter array;\n\n\tif (dbus_message_iter_get_arg_type(iter) != DBUS_TYPE_ARRAY)\n\t\treturn -EINVAL;\n\n\tdbus_message_iter_recurse(iter, &array);\n\tdbus_message_iter_get_fixed_array(&array, value, len);\n\n\treturn 0;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic int parse_value_arg(DBusMessageIter *iter, uint8_t **value, int *len)\n{\n\tDBusMessageIter array;\n\n\tif (dbus_message_iter_get_arg_type(iter) != DBUS_TYPE_ARRAY)\n\t\treturn -EINVAL;\n\n\tdbus_message_iter_recurse(iter, &array);\n\tdbus_message_iter_get_fixed_array(&array, value, len);\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_init",
          "args": [
            "msg",
            "&iter"
          ],
          "line": 986
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_error_in_progress",
          "args": [
            "msg"
          ],
          "line": 984
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_in_progress",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "76-80",
          "snippet": "DBusMessage *btd_error_in_progress(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".InProgress\",\n\t\t\t\t\t\"In Progress\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_in_progress(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".InProgress\",\n\t\t\t\t\t\"In Progress\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_error_not_permitted",
          "args": [
            "msg",
            "\"Write acquired\""
          ],
          "line": 981
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_not_permitted",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "100-104",
          "snippet": "DBusMessage *btd_error_not_permitted(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotPermitted\",\n\t\t\t\t\t\"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_not_permitted(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotPermitted\",\n\t\t\t\t\t\"%s\", str);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic DBusMessage *characteristic_write_value(DBusConnection *conn,\n\t\t\t\t\tDBusMessage *msg, void *user_data)\n{\n\tstruct characteristic *chrc = user_data;\n\tstruct bt_gatt_client *gatt = chrc->service->client->gatt;\n\tDBusMessageIter iter;\n\tuint8_t *value = NULL;\n\tint value_len = 0;\n\tbool supported = false;\n\tuint16_t offset = 0;\n\n\tif (!gatt)\n\t\treturn btd_error_failed(msg, \"Not connected\");\n\n\tif (chrc->write_io)\n\t\treturn btd_error_not_permitted(msg, \"Write acquired\");\n\n\tif (chrc->write_op)\n\t\treturn btd_error_in_progress(msg);\n\n\tdbus_message_iter_init(msg, &iter);\n\n\tif (parse_value_arg(&iter, &value, &value_len))\n\t\treturn btd_error_invalid_args(msg);\n\n\tdbus_message_iter_next(&iter);\n\n\tif (parse_options(&iter, &offset))\n\t\treturn btd_error_invalid_args(msg);\n\n\t/*\n\t * Decide which write to use based on characteristic properties. For now\n\t * we don't perform signed writes since gatt-client doesn't support them\n\t * and the user can always encrypt the through pairing. The procedure to\n\t * use is determined based on the following priority:\n\t *\n\t *   * \"reliable-write\" property set -> reliable long-write.\n\t *   * \"write\" property set -> write request.\n\t *     - If value is larger than MTU - 3: long-write\n\t *   * \"write-without-response\" property set -> write command.\n\t */\n\tif ((chrc->ext_props & BT_GATT_CHRC_EXT_PROP_RELIABLE_WRITE)) {\n\t\tsupported = true;\n\t\tchrc->write_op = start_long_write(msg, chrc->value_handle, gatt,\n\t\t\t\t\t\ttrue, value, value_len, offset,\n\t\t\t\t\t\tchrc, chrc_write_complete);\n\t\tif (chrc->write_op)\n\t\t\treturn NULL;\n\t}\n\n\tif (chrc->props & BT_GATT_CHRC_PROP_WRITE) {\n\t\tuint16_t mtu;\n\n\t\tsupported = true;\n\t\tmtu = bt_gatt_client_get_mtu(gatt);\n\t\tif (!mtu)\n\t\t\treturn btd_error_failed(msg, \"No ATT transport\");\n\n\t\tif (value_len <= mtu - 3 && !offset)\n\t\t\tchrc->write_op = start_write_request(msg,\n\t\t\t\t\t\tchrc->value_handle,\n\t\t\t\t\t\tgatt, value, value_len,\n\t\t\t\t\t\tchrc, chrc_write_complete);\n\t\telse\n\t\t\tchrc->write_op = start_long_write(msg,\n\t\t\t\t\t\tchrc->value_handle, gatt,\n\t\t\t\t\t\tfalse, value, value_len, offset,\n\t\t\t\t\t\tchrc, chrc_write_complete);\n\n\t\tif (chrc->write_op)\n\t\t\treturn NULL;\n\t}\n\n\tif (!(chrc->props & BT_GATT_CHRC_PROP_WRITE_WITHOUT_RESP))\n\t\tgoto fail;\n\n\tsupported = true;\n\n\tif (bt_gatt_client_write_without_response(gatt,\n\t\t\t\t\tchrc->value_handle,\n\t\t\t\t\tchrc->props & BT_GATT_CHRC_PROP_AUTH,\n\t\t\t\t\tvalue, value_len))\n\t\treturn dbus_message_new_method_return(msg);\n\nfail:\n\tif (supported)\n\t\treturn btd_error_failed(msg, \"Failed to initiate write\");\n\n\treturn btd_error_not_supported(msg);\n}"
  },
  {
    "function_name": "chrc_write_complete",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "953-964",
    "snippet": "static bool chrc_write_complete(void *data)\n{\n\tstruct characteristic *chrc = data;\n\n\tchrc->write_op = NULL;\n\n\t/*\n\t * The characteristic might have been unregistered during the read.\n\t * Return failure.\n\t */\n\treturn !!chrc->service;\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic bool chrc_write_complete(void *data)\n{\n\tstruct characteristic *chrc = data;\n\n\tchrc->write_op = NULL;\n\n\t/*\n\t * The characteristic might have been unregistered during the read.\n\t * Return failure.\n\t */\n\treturn !!chrc->service;\n}"
  },
  {
    "function_name": "characteristic_read_value",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "922-951",
    "snippet": "static DBusMessage *characteristic_read_value(DBusConnection *conn,\n\t\t\t\t\tDBusMessage *msg, void *user_data)\n{\n\tstruct characteristic *chrc = user_data;\n\tstruct bt_gatt_client *gatt = chrc->service->client->gatt;\n\tDBusMessageIter iter;\n\tuint16_t offset = 0;\n\n\tif (!gatt)\n\t\treturn btd_error_failed(msg, \"Not connected\");\n\n\tdbus_message_iter_init(msg, &iter);\n\n\tif (parse_options(&iter, &offset))\n\t\treturn btd_error_invalid_args(msg);\n\n\tif (chrc->read_op) {\n\t\tif (chrc->read_op->offset != offset)\n\t\t\treturn btd_error_in_progress(msg);\n\t\tqueue_push_tail(chrc->read_op->msgs, dbus_message_ref(msg));\n\t\treturn NULL;\n\t}\n\n\tchrc->read_op = read_value(gatt, msg, chrc->value_handle, offset,\n\t\t\t\t\t\t\tchrc_read_cb, chrc);\n\tif (!chrc->read_op)\n\t\treturn btd_error_failed(msg, \"Failed to send read request\");\n\n\treturn NULL;\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "btd_error_failed",
          "args": [
            "msg",
            "\"Failed to send read request\""
          ],
          "line": 948
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "124-128",
          "snippet": "DBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "read_value",
          "args": [
            "gatt",
            "msg",
            "chrc->value_handle",
            "offset",
            "chrc_read_cb",
            "chrc"
          ],
          "line": 945
        },
        "resolved": true,
        "details": {
          "function_name": "read_value",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "436-456",
          "snippet": "static struct async_dbus_op *read_value(struct bt_gatt_client *gatt,\n\t\t\t\t\tDBusMessage *msg, uint16_t handle,\n\t\t\t\t\tuint16_t offset,\n\t\t\t\t\tbt_gatt_client_read_callback_t callback,\n\t\t\t\t\tvoid *data)\n{\n\tstruct async_dbus_op *op;\n\n\top = async_dbus_op_new(msg, data);\n\top->offset = offset;\n\n\top->id = bt_gatt_client_read_long_value(gatt, handle, offset, callback,\n\t\t\t\t\t\tasync_dbus_op_ref(op),\n\t\t\t\t\t\tasync_dbus_op_unref);\n\tif (op->id)\n\t\treturn op;\n\n\tasync_dbus_op_free(op);\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic struct async_dbus_op *read_value(struct bt_gatt_client *gatt,\n\t\t\t\t\tDBusMessage *msg, uint16_t handle,\n\t\t\t\t\tuint16_t offset,\n\t\t\t\t\tbt_gatt_client_read_callback_t callback,\n\t\t\t\t\tvoid *data)\n{\n\tstruct async_dbus_op *op;\n\n\top = async_dbus_op_new(msg, data);\n\top->offset = offset;\n\n\top->id = bt_gatt_client_read_long_value(gatt, handle, offset, callback,\n\t\t\t\t\t\tasync_dbus_op_ref(op),\n\t\t\t\t\t\tasync_dbus_op_unref);\n\tif (op->id)\n\t\treturn op;\n\n\tasync_dbus_op_free(op);\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_push_tail",
          "args": [
            "chrc->read_op->msgs",
            "dbus_message_ref(msg)"
          ],
          "line": 941
        },
        "resolved": true,
        "details": {
          "function_name": "queue_push_tail",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "88-108",
          "snippet": "bool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_ref",
          "args": [
            "msg"
          ],
          "line": 941
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_error_in_progress",
          "args": [
            "msg"
          ],
          "line": 940
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_in_progress",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "76-80",
          "snippet": "DBusMessage *btd_error_in_progress(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".InProgress\",\n\t\t\t\t\t\"In Progress\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_in_progress(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".InProgress\",\n\t\t\t\t\t\"In Progress\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_error_invalid_args",
          "args": [
            "msg"
          ],
          "line": 936
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_invalid_args",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "34-38",
          "snippet": "DBusMessage *btd_error_invalid_args(DBusMessage *msg)\n{\n\treturn btd_error_invalid_args_str(msg,\n\t\t\t\t\t\"Invalid arguments in method call\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_invalid_args(DBusMessage *msg)\n{\n\treturn btd_error_invalid_args_str(msg,\n\t\t\t\t\t\"Invalid arguments in method call\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "parse_options",
          "args": [
            "&iter",
            "&offset"
          ],
          "line": 935
        },
        "resolved": true,
        "details": {
          "function_name": "parse_options",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "391-422",
          "snippet": "static int parse_options(DBusMessageIter *iter, uint16_t *offset)\n{\n\tDBusMessageIter dict;\n\n\tif (dbus_message_iter_get_arg_type(iter) != DBUS_TYPE_ARRAY)\n\t\treturn -EINVAL;\n\n\tdbus_message_iter_recurse(iter, &dict);\n\n\twhile (dbus_message_iter_get_arg_type(&dict) == DBUS_TYPE_DICT_ENTRY) {\n\t\tconst char *key;\n\t\tDBusMessageIter value, entry;\n\t\tint var;\n\n\t\tdbus_message_iter_recurse(&dict, &entry);\n\t\tdbus_message_iter_get_basic(&entry, &key);\n\n\t\tdbus_message_iter_next(&entry);\n\t\tdbus_message_iter_recurse(&entry, &value);\n\n\t\tvar = dbus_message_iter_get_arg_type(&value);\n\t\tif (strcasecmp(key, \"offset\") == 0) {\n\t\t\tif (var != DBUS_TYPE_UINT16)\n\t\t\t\treturn -EINVAL;\n\t\t\tdbus_message_iter_get_basic(&value, offset);\n\t\t}\n\n\t\tdbus_message_iter_next(&dict);\n\t}\n\n\treturn 0;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic int parse_options(DBusMessageIter *iter, uint16_t *offset)\n{\n\tDBusMessageIter dict;\n\n\tif (dbus_message_iter_get_arg_type(iter) != DBUS_TYPE_ARRAY)\n\t\treturn -EINVAL;\n\n\tdbus_message_iter_recurse(iter, &dict);\n\n\twhile (dbus_message_iter_get_arg_type(&dict) == DBUS_TYPE_DICT_ENTRY) {\n\t\tconst char *key;\n\t\tDBusMessageIter value, entry;\n\t\tint var;\n\n\t\tdbus_message_iter_recurse(&dict, &entry);\n\t\tdbus_message_iter_get_basic(&entry, &key);\n\n\t\tdbus_message_iter_next(&entry);\n\t\tdbus_message_iter_recurse(&entry, &value);\n\n\t\tvar = dbus_message_iter_get_arg_type(&value);\n\t\tif (strcasecmp(key, \"offset\") == 0) {\n\t\t\tif (var != DBUS_TYPE_UINT16)\n\t\t\t\treturn -EINVAL;\n\t\t\tdbus_message_iter_get_basic(&value, offset);\n\t\t}\n\n\t\tdbus_message_iter_next(&dict);\n\t}\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_init",
          "args": [
            "msg",
            "&iter"
          ],
          "line": 933
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic DBusMessage *characteristic_read_value(DBusConnection *conn,\n\t\t\t\t\tDBusMessage *msg, void *user_data)\n{\n\tstruct characteristic *chrc = user_data;\n\tstruct bt_gatt_client *gatt = chrc->service->client->gatt;\n\tDBusMessageIter iter;\n\tuint16_t offset = 0;\n\n\tif (!gatt)\n\t\treturn btd_error_failed(msg, \"Not connected\");\n\n\tdbus_message_iter_init(msg, &iter);\n\n\tif (parse_options(&iter, &offset))\n\t\treturn btd_error_invalid_args(msg);\n\n\tif (chrc->read_op) {\n\t\tif (chrc->read_op->offset != offset)\n\t\t\treturn btd_error_in_progress(msg);\n\t\tqueue_push_tail(chrc->read_op->msgs, dbus_message_ref(msg));\n\t\treturn NULL;\n\t}\n\n\tchrc->read_op = read_value(gatt, msg, chrc->value_handle, offset,\n\t\t\t\t\t\t\tchrc_read_cb, chrc);\n\tif (!chrc->read_op)\n\t\treturn btd_error_failed(msg, \"Failed to send read request\");\n\n\treturn NULL;\n}"
  },
  {
    "function_name": "chrc_read_cb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "887-920",
    "snippet": "static void chrc_read_cb(bool success, uint8_t att_ecode, const uint8_t *value,\n\t\t\t\t\tuint16_t length, void *user_data)\n{\n\tstruct async_dbus_op *op = user_data;\n\tstruct characteristic *chrc = op->data;\n\n\tif (!success)\n\t\tgoto fail;\n\n\tif (!op->offset)\n\t\tgatt_db_attribute_reset(chrc->attr);\n\n\tif (!gatt_db_attribute_write(chrc->attr, op->offset, value, length, 0,\n\t\t\t\t\tNULL, write_characteristic_cb, chrc)) {\n\t\terror(\"Failed to store attribute\");\n\t\tatt_ecode = BT_ATT_ERROR_UNLIKELY;\n\t\tgoto fail;\n\t}\n\n\t/* Read the stored data from db */\n\tif (!gatt_db_attribute_read(chrc->attr, 0, 0, NULL, read_op_cb, op)) {\n\t\terror(\"Failed to read database\");\n\t\tatt_ecode = BT_ATT_ERROR_UNLIKELY;\n\t\tgoto fail;\n\t}\n\n\tchrc->read_op = NULL;\n\n\treturn;\n\nfail:\n\tasync_dbus_op_reply(op, att_ecode, NULL, 0);\n\tchrc->read_op = NULL;\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "async_dbus_op_reply",
          "args": [
            "op",
            "att_ecode",
            "NULL",
            "0"
          ],
          "line": 918
        },
        "resolved": true,
        "details": {
          "function_name": "async_dbus_op_reply",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "315-344",
          "snippet": "static void async_dbus_op_reply(struct async_dbus_op *op, int err,\n\t\t\t\tconst uint8_t *value, ssize_t length)\n{\n\tconst struct queue_entry *entry;\n\tDBusMessage *reply;\n\n\top->id = 0;\n\n\tfor (entry = queue_get_entries(op->msgs); entry; entry = entry->next) {\n\t\tDBusMessage *msg = entry->data;\n\n\t\tif (err) {\n\t\t\treply = err > 0 ? create_gatt_dbus_error(msg, err) :\n\t\t\t\tbtd_error_failed(msg, strerror(-err));\n\t\t\tgoto send_reply;\n\t\t}\n\n\t\treply = g_dbus_create_reply(msg, DBUS_TYPE_INVALID);\n\t\tif (!reply) {\n\t\t\terror(\"Failed to allocate D-Bus message reply\");\n\t\t\treturn;\n\t\t}\n\n\t\tif (length >= 0)\n\t\t\tmessage_append_byte_array(reply, value, length);\n\nsend_reply:\n\t\tg_dbus_send_message(btd_get_dbus_connection(), reply);\n\t}\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void async_dbus_op_reply(struct async_dbus_op *op, int err,\n\t\t\t\tconst uint8_t *value, ssize_t length)\n{\n\tconst struct queue_entry *entry;\n\tDBusMessage *reply;\n\n\top->id = 0;\n\n\tfor (entry = queue_get_entries(op->msgs); entry; entry = entry->next) {\n\t\tDBusMessage *msg = entry->data;\n\n\t\tif (err) {\n\t\t\treply = err > 0 ? create_gatt_dbus_error(msg, err) :\n\t\t\t\tbtd_error_failed(msg, strerror(-err));\n\t\t\tgoto send_reply;\n\t\t}\n\n\t\treply = g_dbus_create_reply(msg, DBUS_TYPE_INVALID);\n\t\tif (!reply) {\n\t\t\terror(\"Failed to allocate D-Bus message reply\");\n\t\t\treturn;\n\t\t}\n\n\t\tif (length >= 0)\n\t\t\tmessage_append_byte_array(reply, value, length);\n\nsend_reply:\n\t\tg_dbus_send_message(btd_get_dbus_connection(), reply);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Failed to read database\""
          ],
          "line": 908
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_not_ready",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "118-122",
          "snippet": "DBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_attribute_read",
          "args": [
            "chrc->attr",
            "0",
            "0",
            "NULL",
            "read_op_cb",
            "op"
          ],
          "line": 907
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_read",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1724-1763",
          "snippet": "bool gatt_db_attribute_read(struct gatt_db_attribute *attrib, uint16_t offset,\n\t\t\t\tuint8_t opcode, struct bt_att *att,\n\t\t\t\tgatt_db_attribute_read_t func, void *user_data)\n{\n\tuint8_t *value;\n\n\tif (!attrib || !func)\n\t\treturn false;\n\n\tif (attrib->read_func) {\n\t\tstruct pending_read *p;\n\n\t\tp = new0(struct pending_read, 1);\n\t\tp->attrib = attrib;\n\t\tp->id = ++attrib->read_id;\n\t\tp->timeout_id = timeout_add(ATTRIBUTE_TIMEOUT, read_timeout,\n\t\t\t\t\t\t\t\tp, NULL);\n\t\tp->func = func;\n\t\tp->user_data = user_data;\n\n\t\tqueue_push_tail(attrib->pending_reads, p);\n\n\t\tattrib->read_func(attrib, p->id, offset, opcode, att,\n\t\t\t\t\t\t\tattrib->user_data);\n\t\treturn true;\n\t}\n\n\t/* Check boundary if value is stored in the db */\n\tif (offset > attrib->value_len) {\n\t\tfunc(attrib, BT_ATT_ERROR_INVALID_OFFSET, NULL, 0, user_data);\n\t\treturn true;\n\t}\n\n\t/* Guard against invalid access if offset equals to value length */\n\tvalue = offset == attrib->value_len ? NULL : &attrib->value[offset];\n\n\tfunc(attrib, 0, value, attrib->value_len - offset, user_data);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define ATTRIBUTE_TIMEOUT 5000"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\n#define ATTRIBUTE_TIMEOUT 5000\n\nbool gatt_db_attribute_read(struct gatt_db_attribute *attrib, uint16_t offset,\n\t\t\t\tuint8_t opcode, struct bt_att *att,\n\t\t\t\tgatt_db_attribute_read_t func, void *user_data)\n{\n\tuint8_t *value;\n\n\tif (!attrib || !func)\n\t\treturn false;\n\n\tif (attrib->read_func) {\n\t\tstruct pending_read *p;\n\n\t\tp = new0(struct pending_read, 1);\n\t\tp->attrib = attrib;\n\t\tp->id = ++attrib->read_id;\n\t\tp->timeout_id = timeout_add(ATTRIBUTE_TIMEOUT, read_timeout,\n\t\t\t\t\t\t\t\tp, NULL);\n\t\tp->func = func;\n\t\tp->user_data = user_data;\n\n\t\tqueue_push_tail(attrib->pending_reads, p);\n\n\t\tattrib->read_func(attrib, p->id, offset, opcode, att,\n\t\t\t\t\t\t\tattrib->user_data);\n\t\treturn true;\n\t}\n\n\t/* Check boundary if value is stored in the db */\n\tif (offset > attrib->value_len) {\n\t\tfunc(attrib, BT_ATT_ERROR_INVALID_OFFSET, NULL, 0, user_data);\n\t\treturn true;\n\t}\n\n\t/* Guard against invalid access if offset equals to value length */\n\tvalue = offset == attrib->value_len ? NULL : &attrib->value[offset];\n\n\tfunc(attrib, 0, value, attrib->value_len - offset, user_data);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_attribute_write",
          "args": [
            "chrc->attr",
            "op->offset",
            "value",
            "length",
            "0",
            "NULL",
            "write_characteristic_cb",
            "chrc"
          ],
          "line": 899
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_write",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1805-1860",
          "snippet": "bool gatt_db_attribute_write(struct gatt_db_attribute *attrib, uint16_t offset,\n\t\t\t\t\tconst uint8_t *value, size_t len,\n\t\t\t\t\tuint8_t opcode, struct bt_att *att,\n\t\t\t\t\tgatt_db_attribute_write_t func,\n\t\t\t\t\tvoid *user_data)\n{\n\tif (!attrib || !func)\n\t\treturn false;\n\n\tif (attrib->write_func) {\n\t\tstruct pending_write *p;\n\n\t\tp = new0(struct pending_write, 1);\n\t\tp->attrib = attrib;\n\t\tp->id = ++attrib->write_id;\n\t\tp->timeout_id = timeout_add(ATTRIBUTE_TIMEOUT, write_timeout,\n\t\t\t\t\t\t\t\tp, NULL);\n\t\tp->func = func;\n\t\tp->user_data = user_data;\n\n\t\tqueue_push_tail(attrib->pending_writes, p);\n\n\t\tattrib->write_func(attrib, p->id, offset, value, len, opcode,\n\t\t\t\t\t\t\tatt, attrib->user_data);\n\t\treturn true;\n\t}\n\n\t/* Nothing to write just skip */\n\tif (len == 0)\n\t\tgoto done;\n\n\t/* For values stored in db allocate on demand */\n\tif (!attrib->value || offset >= attrib->value_len ||\n\t\t\t\tlen > (unsigned) (attrib->value_len - offset)) {\n\t\tvoid *buf;\n\n\t\tbuf = realloc(attrib->value, len + offset);\n\t\tif (!buf)\n\t\t\treturn false;\n\n\t\tattrib->value = buf;\n\n\t\t/* Init data in the first allocation */\n\t\tif (!attrib->value_len)\n\t\t\tmemset(attrib->value, 0, offset);\n\n\t\tattrib->value_len = len + offset;\n\t}\n\n\tmemcpy(&attrib->value[offset], value, len);\n\ndone:\n\tfunc(attrib, 0, user_data);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define ATTRIBUTE_TIMEOUT 5000"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\n#define ATTRIBUTE_TIMEOUT 5000\n\nbool gatt_db_attribute_write(struct gatt_db_attribute *attrib, uint16_t offset,\n\t\t\t\t\tconst uint8_t *value, size_t len,\n\t\t\t\t\tuint8_t opcode, struct bt_att *att,\n\t\t\t\t\tgatt_db_attribute_write_t func,\n\t\t\t\t\tvoid *user_data)\n{\n\tif (!attrib || !func)\n\t\treturn false;\n\n\tif (attrib->write_func) {\n\t\tstruct pending_write *p;\n\n\t\tp = new0(struct pending_write, 1);\n\t\tp->attrib = attrib;\n\t\tp->id = ++attrib->write_id;\n\t\tp->timeout_id = timeout_add(ATTRIBUTE_TIMEOUT, write_timeout,\n\t\t\t\t\t\t\t\tp, NULL);\n\t\tp->func = func;\n\t\tp->user_data = user_data;\n\n\t\tqueue_push_tail(attrib->pending_writes, p);\n\n\t\tattrib->write_func(attrib, p->id, offset, value, len, opcode,\n\t\t\t\t\t\t\tatt, attrib->user_data);\n\t\treturn true;\n\t}\n\n\t/* Nothing to write just skip */\n\tif (len == 0)\n\t\tgoto done;\n\n\t/* For values stored in db allocate on demand */\n\tif (!attrib->value || offset >= attrib->value_len ||\n\t\t\t\tlen > (unsigned) (attrib->value_len - offset)) {\n\t\tvoid *buf;\n\n\t\tbuf = realloc(attrib->value, len + offset);\n\t\tif (!buf)\n\t\t\treturn false;\n\n\t\tattrib->value = buf;\n\n\t\t/* Init data in the first allocation */\n\t\tif (!attrib->value_len)\n\t\t\tmemset(attrib->value, 0, offset);\n\n\t\tattrib->value_len = len + offset;\n\t}\n\n\tmemcpy(&attrib->value[offset], value, len);\n\ndone:\n\tfunc(attrib, 0, user_data);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_attribute_reset",
          "args": [
            "chrc->attr"
          ],
          "line": 897
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_reset",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1880-1893",
          "snippet": "bool gatt_db_attribute_reset(struct gatt_db_attribute *attrib)\n{\n\tif (!attrib)\n\t\treturn false;\n\n\tif (!attrib->value || !attrib->value_len)\n\t\treturn true;\n\n\tfree(attrib->value);\n\tattrib->value = NULL;\n\tattrib->value_len = 0;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_attribute_reset(struct gatt_db_attribute *attrib)\n{\n\tif (!attrib)\n\t\treturn false;\n\n\tif (!attrib->value || !attrib->value_len)\n\t\treturn true;\n\n\tfree(attrib->value);\n\tattrib->value = NULL;\n\tattrib->value_len = 0;\n\n\treturn true;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void chrc_read_cb(bool success, uint8_t att_ecode, const uint8_t *value,\n\t\t\t\t\tuint16_t length, void *user_data)\n{\n\tstruct async_dbus_op *op = user_data;\n\tstruct characteristic *chrc = op->data;\n\n\tif (!success)\n\t\tgoto fail;\n\n\tif (!op->offset)\n\t\tgatt_db_attribute_reset(chrc->attr);\n\n\tif (!gatt_db_attribute_write(chrc->attr, op->offset, value, length, 0,\n\t\t\t\t\tNULL, write_characteristic_cb, chrc)) {\n\t\terror(\"Failed to store attribute\");\n\t\tatt_ecode = BT_ATT_ERROR_UNLIKELY;\n\t\tgoto fail;\n\t}\n\n\t/* Read the stored data from db */\n\tif (!gatt_db_attribute_read(chrc->attr, 0, 0, NULL, read_op_cb, op)) {\n\t\terror(\"Failed to read database\");\n\t\tatt_ecode = BT_ATT_ERROR_UNLIKELY;\n\t\tgoto fail;\n\t}\n\n\tchrc->read_op = NULL;\n\n\treturn;\n\nfail:\n\tasync_dbus_op_reply(op, att_ecode, NULL, 0);\n\tchrc->read_op = NULL;\n}"
  },
  {
    "function_name": "write_characteristic_cb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "873-885",
    "snippet": "static void write_characteristic_cb(struct gatt_db_attribute *attr, int err,\n\t\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct characteristic *chrc = user_data;\n\n\tif (err)\n\t\treturn;\n\n\tg_dbus_emit_property_changed_full(btd_get_dbus_connection(),\n\t\t\t\tchrc->path, GATT_CHARACTERISTIC_IFACE,\n\t\t\t\t\"Value\", G_DBUS_PROPERTY_CHANGED_FLAG_FLUSH);\n\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define GATT_CHARACTERISTIC_IFACE\t\"org.bluez.GattCharacteristic1\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_dbus_emit_property_changed_full",
          "args": [
            "btd_get_dbus_connection()",
            "chrc->path",
            "GATT_CHARACTERISTIC_IFACE",
            "\"Value\"",
            "G_DBUS_PROPERTY_CHANGED_FLAG_FLUSH"
          ],
          "line": 881
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_get_dbus_connection",
          "args": [],
          "line": 881
        },
        "resolved": true,
        "details": {
          "function_name": "btd_get_dbus_connection",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/dbus-common.c",
          "lines": "61-64",
          "snippet": "DBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *connection = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *connection = NULL;\n\nDBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\n#define GATT_CHARACTERISTIC_IFACE\t\"org.bluez.GattCharacteristic1\"\n\nstatic void write_characteristic_cb(struct gatt_db_attribute *attr, int err,\n\t\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct characteristic *chrc = user_data;\n\n\tif (err)\n\t\treturn;\n\n\tg_dbus_emit_property_changed_full(btd_get_dbus_connection(),\n\t\t\t\tchrc->path, GATT_CHARACTERISTIC_IFACE,\n\t\t\t\t\"Value\", G_DBUS_PROPERTY_CHANGED_FLAG_FLUSH);\n\n}"
  },
  {
    "function_name": "characteristic_notify_acquired_exists",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "864-871",
    "snippet": "static gboolean\ncharacteristic_notify_acquired_exists(const GDBusPropertyTable *property,\n\t\t\t\t\t\t\t\tvoid *data)\n{\n\tstruct characteristic *chrc = data;\n\n\treturn (chrc->props & BT_GATT_CHRC_PROP_NOTIFY);\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic gboolean\ncharacteristic_notify_acquired_exists(const GDBusPropertyTable *property,\n\t\t\t\t\t\t\t\tvoid *data)\n{\n\tstruct characteristic *chrc = data;\n\n\treturn (chrc->props & BT_GATT_CHRC_PROP_NOTIFY);\n}"
  },
  {
    "function_name": "characteristic_get_notify_acquired",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "852-862",
    "snippet": "static gboolean\ncharacteristic_get_notify_acquired(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct characteristic *chrc = data;\n\tdbus_bool_t locked = chrc->notify_io ? TRUE : FALSE;\n\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_BOOLEAN, &locked);\n\n\treturn TRUE;\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_iter_append_basic",
          "args": [
            "iter",
            "DBUS_TYPE_BOOLEAN",
            "&locked"
          ],
          "line": 859
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic gboolean\ncharacteristic_get_notify_acquired(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct characteristic *chrc = data;\n\tdbus_bool_t locked = chrc->notify_io ? TRUE : FALSE;\n\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_BOOLEAN, &locked);\n\n\treturn TRUE;\n}"
  },
  {
    "function_name": "characteristic_write_acquired_exists",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "843-850",
    "snippet": "static gboolean\ncharacteristic_write_acquired_exists(const GDBusPropertyTable *property,\n\t\t\t\t\t\t\t\tvoid *data)\n{\n\tstruct characteristic *chrc = data;\n\n\treturn (chrc->props & BT_GATT_CHRC_PROP_WRITE_WITHOUT_RESP);\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic gboolean\ncharacteristic_write_acquired_exists(const GDBusPropertyTable *property,\n\t\t\t\t\t\t\t\tvoid *data)\n{\n\tstruct characteristic *chrc = data;\n\n\treturn (chrc->props & BT_GATT_CHRC_PROP_WRITE_WITHOUT_RESP);\n}"
  },
  {
    "function_name": "characteristic_get_write_acquired",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "831-841",
    "snippet": "static gboolean\ncharacteristic_get_write_acquired(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct characteristic *chrc = data;\n\tdbus_bool_t locked = chrc->write_io ? TRUE : FALSE;\n\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_BOOLEAN, &locked);\n\n\treturn TRUE;\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_iter_append_basic",
          "args": [
            "iter",
            "DBUS_TYPE_BOOLEAN",
            "&locked"
          ],
          "line": 838
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic gboolean\ncharacteristic_get_write_acquired(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct characteristic *chrc = data;\n\tdbus_bool_t locked = chrc->write_io ? TRUE : FALSE;\n\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_BOOLEAN, &locked);\n\n\treturn TRUE;\n}"
  },
  {
    "function_name": "characteristic_get_flags",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "805-829",
    "snippet": "static gboolean characteristic_get_flags(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct characteristic *chrc = data;\n\tDBusMessageIter array;\n\tunsigned i;\n\n\tdbus_message_iter_open_container(iter, DBUS_TYPE_ARRAY, \"s\", &array);\n\n\tfor (i = 0; i < NELEM(chrc_props); i++) {\n\t\tif (chrc->props & chrc_props[i].prop)\n\t\t\tdbus_message_iter_append_basic(&array, DBUS_TYPE_STRING,\n\t\t\t\t\t\t\t&chrc_props[i].str);\n\t}\n\n\tfor (i = 0; i < NELEM(chrc_ext_props); i++) {\n\t\tif (chrc->ext_props & chrc_ext_props[i].prop)\n\t\t\tdbus_message_iter_append_basic(&array, DBUS_TYPE_STRING,\n\t\t\t\t\t\t\t&chrc_ext_props[i].str);\n\t}\n\n\tdbus_message_iter_close_container(iter, &array);\n\n\treturn TRUE;\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static struct chrc_prop_data chrc_props[] = {\n\t/* Default Properties */\n\t{ BT_GATT_CHRC_PROP_BROADCAST,\t\t\"broadcast\" },\n\t{ BT_GATT_CHRC_PROP_READ,\t\t\"read\" },\n\t{ BT_GATT_CHRC_PROP_WRITE_WITHOUT_RESP,\t\"write-without-response\" },\n\t{ BT_GATT_CHRC_PROP_WRITE,\t\t\"write\" },\n\t{ BT_GATT_CHRC_PROP_NOTIFY,\t\t\"notify\" },\n\t{ BT_GATT_CHRC_PROP_INDICATE,\t\t\"indicate\" },\n\t{ BT_GATT_CHRC_PROP_AUTH,\t\t\"authenticated-signed-writes\" },\n\t{ BT_GATT_CHRC_PROP_EXT_PROP,\t\t\"extended-properties\" }\n};",
      "static struct chrc_prop_data chrc_ext_props[] = {\n\t/* Extended Properties */\n\t{ BT_GATT_CHRC_EXT_PROP_RELIABLE_WRITE,\t\"reliable-write\" },\n\t{ BT_GATT_CHRC_EXT_PROP_WRITABLE_AUX,\t\"writable-auxiliaries\" }\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_iter_close_container",
          "args": [
            "iter",
            "&array"
          ],
          "line": 826
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_append_basic",
          "args": [
            "&array",
            "DBUS_TYPE_STRING",
            "&chrc_ext_props[i].str"
          ],
          "line": 822
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "NELEM",
          "args": [
            "chrc_ext_props"
          ],
          "line": 820
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_append_basic",
          "args": [
            "&array",
            "DBUS_TYPE_STRING",
            "&chrc_props[i].str"
          ],
          "line": 816
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "NELEM",
          "args": [
            "chrc_props"
          ],
          "line": 814
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_open_container",
          "args": [
            "iter",
            "DBUS_TYPE_ARRAY",
            "\"s\"",
            "&array"
          ],
          "line": 812
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic struct chrc_prop_data chrc_props[] = {\n\t/* Default Properties */\n\t{ BT_GATT_CHRC_PROP_BROADCAST,\t\t\"broadcast\" },\n\t{ BT_GATT_CHRC_PROP_READ,\t\t\"read\" },\n\t{ BT_GATT_CHRC_PROP_WRITE_WITHOUT_RESP,\t\"write-without-response\" },\n\t{ BT_GATT_CHRC_PROP_WRITE,\t\t\"write\" },\n\t{ BT_GATT_CHRC_PROP_NOTIFY,\t\t\"notify\" },\n\t{ BT_GATT_CHRC_PROP_INDICATE,\t\t\"indicate\" },\n\t{ BT_GATT_CHRC_PROP_AUTH,\t\t\"authenticated-signed-writes\" },\n\t{ BT_GATT_CHRC_PROP_EXT_PROP,\t\t\"extended-properties\" }\n};\nstatic struct chrc_prop_data chrc_ext_props[] = {\n\t/* Extended Properties */\n\t{ BT_GATT_CHRC_EXT_PROP_RELIABLE_WRITE,\t\"reliable-write\" },\n\t{ BT_GATT_CHRC_EXT_PROP_WRITABLE_AUX,\t\"writable-auxiliaries\" }\n};\n\nstatic gboolean characteristic_get_flags(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct characteristic *chrc = data;\n\tDBusMessageIter array;\n\tunsigned i;\n\n\tdbus_message_iter_open_container(iter, DBUS_TYPE_ARRAY, \"s\", &array);\n\n\tfor (i = 0; i < NELEM(chrc_props); i++) {\n\t\tif (chrc->props & chrc_props[i].prop)\n\t\t\tdbus_message_iter_append_basic(&array, DBUS_TYPE_STRING,\n\t\t\t\t\t\t\t&chrc_props[i].str);\n\t}\n\n\tfor (i = 0; i < NELEM(chrc_ext_props); i++) {\n\t\tif (chrc->ext_props & chrc_ext_props[i].prop)\n\t\t\tdbus_message_iter_append_basic(&array, DBUS_TYPE_STRING,\n\t\t\t\t\t\t\t&chrc_ext_props[i].str);\n\t}\n\n\tdbus_message_iter_close_container(iter, &array);\n\n\treturn TRUE;\n}"
  },
  {
    "function_name": "characteristic_notifying_exists",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "773-780",
    "snippet": "static gboolean\ncharacteristic_notifying_exists(const GDBusPropertyTable *property, void *data)\n{\n\tstruct characteristic *chrc = data;\n\n\treturn (chrc->props & BT_GATT_CHRC_PROP_NOTIFY ||\n\t\t\t\tchrc->props & BT_GATT_CHRC_PROP_INDICATE);\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic gboolean\ncharacteristic_notifying_exists(const GDBusPropertyTable *property, void *data)\n{\n\tstruct characteristic *chrc = data;\n\n\treturn (chrc->props & BT_GATT_CHRC_PROP_NOTIFY ||\n\t\t\t\tchrc->props & BT_GATT_CHRC_PROP_INDICATE);\n}"
  },
  {
    "function_name": "characteristic_get_notifying",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "762-771",
    "snippet": "static gboolean characteristic_get_notifying(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct characteristic *chrc = data;\n\tdbus_bool_t notifying = chrc->notifying ? TRUE : FALSE;\n\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_BOOLEAN, &notifying);\n\n\treturn TRUE;\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_iter_append_basic",
          "args": [
            "iter",
            "DBUS_TYPE_BOOLEAN",
            "&notifying"
          ],
          "line": 768
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic gboolean characteristic_get_notifying(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct characteristic *chrc = data;\n\tdbus_bool_t notifying = chrc->notifying ? TRUE : FALSE;\n\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_BOOLEAN, &notifying);\n\n\treturn TRUE;\n}"
  },
  {
    "function_name": "characteristic_value_exists",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "751-760",
    "snippet": "static gboolean characteristic_value_exists(const GDBusPropertyTable *property,\n\t\t\t\t\t\t\t\tvoid *data)\n{\n\tstruct characteristic *chrc = data;\n\tgboolean ret;\n\n\tgatt_db_attribute_read(chrc->attr, 0, 0, NULL, read_check_cb, &ret);\n\n\treturn ret;\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "gatt_db_attribute_read",
          "args": [
            "chrc->attr",
            "0",
            "0",
            "NULL",
            "read_check_cb",
            "&ret"
          ],
          "line": 757
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_read",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1724-1763",
          "snippet": "bool gatt_db_attribute_read(struct gatt_db_attribute *attrib, uint16_t offset,\n\t\t\t\tuint8_t opcode, struct bt_att *att,\n\t\t\t\tgatt_db_attribute_read_t func, void *user_data)\n{\n\tuint8_t *value;\n\n\tif (!attrib || !func)\n\t\treturn false;\n\n\tif (attrib->read_func) {\n\t\tstruct pending_read *p;\n\n\t\tp = new0(struct pending_read, 1);\n\t\tp->attrib = attrib;\n\t\tp->id = ++attrib->read_id;\n\t\tp->timeout_id = timeout_add(ATTRIBUTE_TIMEOUT, read_timeout,\n\t\t\t\t\t\t\t\tp, NULL);\n\t\tp->func = func;\n\t\tp->user_data = user_data;\n\n\t\tqueue_push_tail(attrib->pending_reads, p);\n\n\t\tattrib->read_func(attrib, p->id, offset, opcode, att,\n\t\t\t\t\t\t\tattrib->user_data);\n\t\treturn true;\n\t}\n\n\t/* Check boundary if value is stored in the db */\n\tif (offset > attrib->value_len) {\n\t\tfunc(attrib, BT_ATT_ERROR_INVALID_OFFSET, NULL, 0, user_data);\n\t\treturn true;\n\t}\n\n\t/* Guard against invalid access if offset equals to value length */\n\tvalue = offset == attrib->value_len ? NULL : &attrib->value[offset];\n\n\tfunc(attrib, 0, value, attrib->value_len - offset, user_data);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define ATTRIBUTE_TIMEOUT 5000"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\n#define ATTRIBUTE_TIMEOUT 5000\n\nbool gatt_db_attribute_read(struct gatt_db_attribute *attrib, uint16_t offset,\n\t\t\t\tuint8_t opcode, struct bt_att *att,\n\t\t\t\tgatt_db_attribute_read_t func, void *user_data)\n{\n\tuint8_t *value;\n\n\tif (!attrib || !func)\n\t\treturn false;\n\n\tif (attrib->read_func) {\n\t\tstruct pending_read *p;\n\n\t\tp = new0(struct pending_read, 1);\n\t\tp->attrib = attrib;\n\t\tp->id = ++attrib->read_id;\n\t\tp->timeout_id = timeout_add(ATTRIBUTE_TIMEOUT, read_timeout,\n\t\t\t\t\t\t\t\tp, NULL);\n\t\tp->func = func;\n\t\tp->user_data = user_data;\n\n\t\tqueue_push_tail(attrib->pending_reads, p);\n\n\t\tattrib->read_func(attrib, p->id, offset, opcode, att,\n\t\t\t\t\t\t\tattrib->user_data);\n\t\treturn true;\n\t}\n\n\t/* Check boundary if value is stored in the db */\n\tif (offset > attrib->value_len) {\n\t\tfunc(attrib, BT_ATT_ERROR_INVALID_OFFSET, NULL, 0, user_data);\n\t\treturn true;\n\t}\n\n\t/* Guard against invalid access if offset equals to value length */\n\tvalue = offset == attrib->value_len ? NULL : &attrib->value[offset];\n\n\tfunc(attrib, 0, value, attrib->value_len - offset, user_data);\n\n\treturn true;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic gboolean characteristic_value_exists(const GDBusPropertyTable *property,\n\t\t\t\t\t\t\t\tvoid *data)\n{\n\tstruct characteristic *chrc = data;\n\tgboolean ret;\n\n\tgatt_db_attribute_read(chrc->attr, 0, 0, NULL, read_check_cb, &ret);\n\n\treturn ret;\n}"
  },
  {
    "function_name": "characteristic_get_value",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "736-749",
    "snippet": "static gboolean characteristic_get_value(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct characteristic *chrc = data;\n\tDBusMessageIter array;\n\n\tdbus_message_iter_open_container(iter, DBUS_TYPE_ARRAY, \"y\", &array);\n\n\tgatt_db_attribute_read(chrc->attr, 0, 0, NULL, read_cb, &array);\n\n\tdbus_message_iter_close_container(iter, &array);\n\n\treturn TRUE;\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_iter_close_container",
          "args": [
            "iter",
            "&array"
          ],
          "line": 746
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gatt_db_attribute_read",
          "args": [
            "chrc->attr",
            "0",
            "0",
            "NULL",
            "read_cb",
            "&array"
          ],
          "line": 744
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_read",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1724-1763",
          "snippet": "bool gatt_db_attribute_read(struct gatt_db_attribute *attrib, uint16_t offset,\n\t\t\t\tuint8_t opcode, struct bt_att *att,\n\t\t\t\tgatt_db_attribute_read_t func, void *user_data)\n{\n\tuint8_t *value;\n\n\tif (!attrib || !func)\n\t\treturn false;\n\n\tif (attrib->read_func) {\n\t\tstruct pending_read *p;\n\n\t\tp = new0(struct pending_read, 1);\n\t\tp->attrib = attrib;\n\t\tp->id = ++attrib->read_id;\n\t\tp->timeout_id = timeout_add(ATTRIBUTE_TIMEOUT, read_timeout,\n\t\t\t\t\t\t\t\tp, NULL);\n\t\tp->func = func;\n\t\tp->user_data = user_data;\n\n\t\tqueue_push_tail(attrib->pending_reads, p);\n\n\t\tattrib->read_func(attrib, p->id, offset, opcode, att,\n\t\t\t\t\t\t\tattrib->user_data);\n\t\treturn true;\n\t}\n\n\t/* Check boundary if value is stored in the db */\n\tif (offset > attrib->value_len) {\n\t\tfunc(attrib, BT_ATT_ERROR_INVALID_OFFSET, NULL, 0, user_data);\n\t\treturn true;\n\t}\n\n\t/* Guard against invalid access if offset equals to value length */\n\tvalue = offset == attrib->value_len ? NULL : &attrib->value[offset];\n\n\tfunc(attrib, 0, value, attrib->value_len - offset, user_data);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define ATTRIBUTE_TIMEOUT 5000"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\n#define ATTRIBUTE_TIMEOUT 5000\n\nbool gatt_db_attribute_read(struct gatt_db_attribute *attrib, uint16_t offset,\n\t\t\t\tuint8_t opcode, struct bt_att *att,\n\t\t\t\tgatt_db_attribute_read_t func, void *user_data)\n{\n\tuint8_t *value;\n\n\tif (!attrib || !func)\n\t\treturn false;\n\n\tif (attrib->read_func) {\n\t\tstruct pending_read *p;\n\n\t\tp = new0(struct pending_read, 1);\n\t\tp->attrib = attrib;\n\t\tp->id = ++attrib->read_id;\n\t\tp->timeout_id = timeout_add(ATTRIBUTE_TIMEOUT, read_timeout,\n\t\t\t\t\t\t\t\tp, NULL);\n\t\tp->func = func;\n\t\tp->user_data = user_data;\n\n\t\tqueue_push_tail(attrib->pending_reads, p);\n\n\t\tattrib->read_func(attrib, p->id, offset, opcode, att,\n\t\t\t\t\t\t\tattrib->user_data);\n\t\treturn true;\n\t}\n\n\t/* Check boundary if value is stored in the db */\n\tif (offset > attrib->value_len) {\n\t\tfunc(attrib, BT_ATT_ERROR_INVALID_OFFSET, NULL, 0, user_data);\n\t\treturn true;\n\t}\n\n\t/* Guard against invalid access if offset equals to value length */\n\tvalue = offset == attrib->value_len ? NULL : &attrib->value[offset];\n\n\tfunc(attrib, 0, value, attrib->value_len - offset, user_data);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_open_container",
          "args": [
            "iter",
            "DBUS_TYPE_ARRAY",
            "\"y\"",
            "&array"
          ],
          "line": 742
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic gboolean characteristic_get_value(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct characteristic *chrc = data;\n\tDBusMessageIter array;\n\n\tdbus_message_iter_open_container(iter, DBUS_TYPE_ARRAY, \"y\", &array);\n\n\tgatt_db_attribute_read(chrc->attr, 0, 0, NULL, read_cb, &array);\n\n\tdbus_message_iter_close_container(iter, &array);\n\n\treturn TRUE;\n}"
  },
  {
    "function_name": "characteristic_get_service",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "725-734",
    "snippet": "static gboolean characteristic_get_service(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct characteristic *chrc = data;\n\tconst char *str = chrc->service->path;\n\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_OBJECT_PATH, &str);\n\n\treturn TRUE;\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_iter_append_basic",
          "args": [
            "iter",
            "DBUS_TYPE_OBJECT_PATH",
            "&str"
          ],
          "line": 731
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic gboolean characteristic_get_service(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct characteristic *chrc = data;\n\tconst char *str = chrc->service->path;\n\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_OBJECT_PATH, &str);\n\n\treturn TRUE;\n}"
  },
  {
    "function_name": "characteristic_get_uuid",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "712-723",
    "snippet": "static gboolean characteristic_get_uuid(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tchar uuid[MAX_LEN_UUID_STR + 1];\n\tconst char *ptr = uuid;\n\tstruct characteristic *chrc = data;\n\n\tbt_uuid_to_string(&chrc->uuid, uuid, sizeof(uuid));\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_STRING, &ptr);\n\n\treturn TRUE;\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_iter_append_basic",
          "args": [
            "iter",
            "DBUS_TYPE_STRING",
            "&ptr"
          ],
          "line": 720
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_uuid_to_string",
          "args": [
            "&chrc->uuid",
            "uuid",
            "sizeof(uuid)"
          ],
          "line": 719
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic gboolean characteristic_get_uuid(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tchar uuid[MAX_LEN_UUID_STR + 1];\n\tconst char *ptr = uuid;\n\tstruct characteristic *chrc = data;\n\n\tbt_uuid_to_string(&chrc->uuid, uuid, sizeof(uuid));\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_STRING, &ptr);\n\n\treturn TRUE;\n}"
  },
  {
    "function_name": "unregister_descriptor",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "693-710",
    "snippet": "static void unregister_descriptor(void *data)\n{\n\tstruct descriptor *desc = data;\n\tstruct bt_gatt_client *gatt = desc->chrc->service->client->gatt;\n\n\tDBG(\"Removing GATT descriptor: %s\", desc->path);\n\n\tif (desc->read_op)\n\t\tbt_gatt_client_cancel(gatt, desc->read_op->id);\n\n\tif (desc->write_op)\n\t\tbt_gatt_client_cancel(gatt, desc->write_op->id);\n\n\tdesc->chrc = NULL;\n\n\tg_dbus_unregister_interface(btd_get_dbus_connection(), desc->path,\n\t\t\t\t\t\t\tGATT_DESCRIPTOR_IFACE);\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define GATT_DESCRIPTOR_IFACE\t\t\"org.bluez.GattDescriptor1\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_dbus_unregister_interface",
          "args": [
            "btd_get_dbus_connection()",
            "desc->path",
            "GATT_DESCRIPTOR_IFACE"
          ],
          "line": 708
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_get_dbus_connection",
          "args": [],
          "line": 708
        },
        "resolved": true,
        "details": {
          "function_name": "btd_get_dbus_connection",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/dbus-common.c",
          "lines": "61-64",
          "snippet": "DBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *connection = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *connection = NULL;\n\nDBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_gatt_client_cancel",
          "args": [
            "gatt",
            "desc->write_op->id"
          ],
          "line": 704
        },
        "resolved": true,
        "details": {
          "function_name": "bt_gatt_client_cancel",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-client.c",
          "lines": "2174-2187",
          "snippet": "bool bt_gatt_client_cancel(struct bt_gatt_client *client, unsigned int id)\n{\n\tstruct request *req;\n\n\tif (!client || !id || !client->att)\n\t\treturn false;\n\n\treq = queue_remove_if(client->pending_requests, match_req_id,\n\t\t\t\t\t\t\tUINT_TO_PTR(id));\n\tif (!req)\n\t\treturn false;\n\n\treturn cancel_request(req);\n}",
          "includes": [
            "#include <sys/uio.h>",
            "#include <limits.h>",
            "#include <assert.h>",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-helpers.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/att.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/uio.h>\n#include <limits.h>\n#include <assert.h>\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-helpers.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/att.h\"\n#include <config.h>\n\nbool bt_gatt_client_cancel(struct bt_gatt_client *client, unsigned int id)\n{\n\tstruct request *req;\n\n\tif (!client || !id || !client->att)\n\t\treturn false;\n\n\treq = queue_remove_if(client->pending_requests, match_req_id,\n\t\t\t\t\t\t\tUINT_TO_PTR(id));\n\tif (!req)\n\t\treturn false;\n\n\treturn cancel_request(req);\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Removing GATT descriptor: %s\"",
            "desc->path"
          ],
          "line": 698
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\n#define GATT_DESCRIPTOR_IFACE\t\t\"org.bluez.GattDescriptor1\"\n\nstatic void unregister_descriptor(void *data)\n{\n\tstruct descriptor *desc = data;\n\tstruct bt_gatt_client *gatt = desc->chrc->service->client->gatt;\n\n\tDBG(\"Removing GATT descriptor: %s\", desc->path);\n\n\tif (desc->read_op)\n\t\tbt_gatt_client_cancel(gatt, desc->read_op->id);\n\n\tif (desc->write_op)\n\t\tbt_gatt_client_cancel(gatt, desc->write_op->id);\n\n\tdesc->chrc = NULL;\n\n\tg_dbus_unregister_interface(btd_get_dbus_connection(), desc->path,\n\t\t\t\t\t\t\tGATT_DESCRIPTOR_IFACE);\n}"
  },
  {
    "function_name": "descriptor_create",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "659-691",
    "snippet": "static struct descriptor *descriptor_create(struct gatt_db_attribute *attr,\n\t\t\t\t\t\tstruct characteristic *chrc)\n{\n\tstruct descriptor *desc;\n\n\tdesc = new0(struct descriptor, 1);\n\tdesc->chrc = chrc;\n\tdesc->attr = attr;\n\tdesc->handle = gatt_db_attribute_get_handle(attr);\n\n\tbt_uuid_to_uuid128(gatt_db_attribute_get_type(attr), &desc->uuid);\n\n\tdesc->path = g_strdup_printf(\"%s/desc%04x\", chrc->path, desc->handle);\n\n\tif (!g_dbus_register_interface(btd_get_dbus_connection(), desc->path,\n\t\t\t\t\t\tGATT_DESCRIPTOR_IFACE,\n\t\t\t\t\t\tdescriptor_methods, NULL,\n\t\t\t\t\t\tdescriptor_properties,\n\t\t\t\t\t\tdesc, descriptor_free)) {\n\t\terror(\"Unable to register GATT descriptor with handle 0x%04x\",\n\t\t\t\t\t\t\t\tdesc->handle);\n\t\tdescriptor_free(desc);\n\n\t\treturn NULL;\n\t}\n\n\tDBG(\"Exported GATT characteristic descriptor: %s\", desc->path);\n\n\tif (uuid_cmp(&desc->uuid, GATT_CHARAC_EXT_PROPER_UUID))\n\t\tchrc->ext_props_handle = desc->handle;\n\n\treturn desc;\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define GATT_DESCRIPTOR_IFACE\t\t\"org.bluez.GattDescriptor1\""
    ],
    "globals_used": [
      "static const GDBusPropertyTable descriptor_properties[] = {\n\t{ \"UUID\", \"s\", descriptor_get_uuid },\n\t{ \"Characteristic\", \"o\", descriptor_get_characteristic, },\n\t{ \"Value\", \"ay\", descriptor_get_value, NULL, descriptor_value_exists },\n\t{ }\n};",
      "static const GDBusMethodTable descriptor_methods[] = {\n\t{ GDBUS_ASYNC_METHOD(\"ReadValue\", GDBUS_ARGS({ \"options\", \"a{sv}\" }),\n\t\t\t\t\tGDBUS_ARGS({ \"value\", \"ay\" }),\n\t\t\t\t\tdescriptor_read_value) },\n\t{ GDBUS_ASYNC_METHOD(\"WriteValue\", GDBUS_ARGS({ \"value\", \"ay\" },\n\t\t\t\t\t\t{ \"options\", \"a{sv}\" }),\n\t\t\t\t\tNULL,\n\t\t\t\t\tdescriptor_write_value) },\n\t{ }\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "uuid_cmp",
          "args": [
            "&desc->uuid",
            "GATT_CHARAC_EXT_PROPER_UUID"
          ],
          "line": 687
        },
        "resolved": true,
        "details": {
          "function_name": "uuid_cmp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "135-142",
          "snippet": "static bool uuid_cmp(const bt_uuid_t *uuid, uint16_t u16)\n{\n\tbt_uuid_t uuid16;\n\n\tbt_uuid16_create(&uuid16, u16);\n\n\treturn bt_uuid_cmp(uuid, &uuid16) == 0;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic bool uuid_cmp(const bt_uuid_t *uuid, uint16_t u16)\n{\n\tbt_uuid_t uuid16;\n\n\tbt_uuid16_create(&uuid16, u16);\n\n\treturn bt_uuid_cmp(uuid, &uuid16) == 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Exported GATT characteristic descriptor: %s\"",
            "desc->path"
          ],
          "line": 685
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "descriptor_free",
          "args": [
            "desc"
          ],
          "line": 680
        },
        "resolved": true,
        "details": {
          "function_name": "descriptor_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "651-657",
          "snippet": "static void descriptor_free(void *data)\n{\n\tstruct descriptor *desc = data;\n\n\tg_free(desc->path);\n\tfree(desc);\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void descriptor_free(void *data)\n{\n\tstruct descriptor *desc = data;\n\n\tg_free(desc->path);\n\tfree(desc);\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Unable to register GATT descriptor with handle 0x%04x\"",
            "desc->handle"
          ],
          "line": 678
        },
        "resolved": true,
        "details": {
          "function_name": "create_gatt_dbus_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "273-301",
          "snippet": "static DBusMessage *create_gatt_dbus_error(DBusMessage *msg, uint8_t att_ecode)\n{\n\tswitch (att_ecode) {\n\tcase BT_ATT_ERROR_READ_NOT_PERMITTED:\n\t\treturn btd_error_not_permitted(msg, \"Read not permitted\");\n\tcase BT_ATT_ERROR_WRITE_NOT_PERMITTED:\n\t\treturn btd_error_not_permitted(msg, \"Write not permitted\");\n\tcase BT_ATT_ERROR_AUTHENTICATION:\n\tcase BT_ATT_ERROR_INSUFFICIENT_ENCRYPTION:\n\tcase BT_ATT_ERROR_INSUFFICIENT_ENCRYPTION_KEY_SIZE:\n\t\treturn btd_error_not_permitted(msg, \"Not paired\");\n\tcase BT_ATT_ERROR_INVALID_OFFSET:\n\t\treturn btd_error_invalid_args_str(msg, \"Invalid offset\");\n\tcase BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN:\n\t\treturn btd_error_invalid_args_str(msg, \"Invalid Length\");\n\tcase BT_ATT_ERROR_AUTHORIZATION:\n\t\treturn btd_error_not_authorized(msg);\n\tcase BT_ATT_ERROR_REQUEST_NOT_SUPPORTED:\n\t\treturn btd_error_not_supported(msg);\n\tcase 0:\n\t\treturn btd_error_failed(msg, \"Operation failed\");\n\tdefault:\n\t\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".Failed\",\n\t\t\t\t\"Operation failed with ATT error: 0x%02x\",\n\t\t\t\tatt_ecode);\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic DBusMessage *create_gatt_dbus_error(DBusMessage *msg, uint8_t att_ecode)\n{\n\tswitch (att_ecode) {\n\tcase BT_ATT_ERROR_READ_NOT_PERMITTED:\n\t\treturn btd_error_not_permitted(msg, \"Read not permitted\");\n\tcase BT_ATT_ERROR_WRITE_NOT_PERMITTED:\n\t\treturn btd_error_not_permitted(msg, \"Write not permitted\");\n\tcase BT_ATT_ERROR_AUTHENTICATION:\n\tcase BT_ATT_ERROR_INSUFFICIENT_ENCRYPTION:\n\tcase BT_ATT_ERROR_INSUFFICIENT_ENCRYPTION_KEY_SIZE:\n\t\treturn btd_error_not_permitted(msg, \"Not paired\");\n\tcase BT_ATT_ERROR_INVALID_OFFSET:\n\t\treturn btd_error_invalid_args_str(msg, \"Invalid offset\");\n\tcase BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN:\n\t\treturn btd_error_invalid_args_str(msg, \"Invalid Length\");\n\tcase BT_ATT_ERROR_AUTHORIZATION:\n\t\treturn btd_error_not_authorized(msg);\n\tcase BT_ATT_ERROR_REQUEST_NOT_SUPPORTED:\n\t\treturn btd_error_not_supported(msg);\n\tcase 0:\n\t\treturn btd_error_failed(msg, \"Operation failed\");\n\tdefault:\n\t\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".Failed\",\n\t\t\t\t\"Operation failed with ATT error: 0x%02x\",\n\t\t\t\tatt_ecode);\n\t}\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_register_interface",
          "args": [
            "btd_get_dbus_connection()",
            "desc->path",
            "GATT_DESCRIPTOR_IFACE",
            "descriptor_methods",
            "NULL",
            "descriptor_properties",
            "desc",
            "descriptor_free"
          ],
          "line": 673
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_get_dbus_connection",
          "args": [],
          "line": 673
        },
        "resolved": true,
        "details": {
          "function_name": "btd_get_dbus_connection",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/dbus-common.c",
          "lines": "61-64",
          "snippet": "DBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *connection = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *connection = NULL;\n\nDBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"%s/desc%04x\"",
            "chrc->path",
            "desc->handle"
          ],
          "line": 671
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_uuid_to_uuid128",
          "args": [
            "gatt_db_attribute_get_type(attr)",
            "&desc->uuid"
          ],
          "line": 669
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gatt_db_attribute_get_type",
          "args": [
            "attr"
          ],
          "line": 669
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_get_type",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1473-1480",
          "snippet": "const bt_uuid_t *gatt_db_attribute_get_type(\n\t\t\t\t\tconst struct gatt_db_attribute *attrib)\n{\n\tif (!attrib)\n\t\treturn NULL;\n\n\treturn &attrib->uuid;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nconst bt_uuid_t *gatt_db_attribute_get_type(\n\t\t\t\t\tconst struct gatt_db_attribute *attrib)\n{\n\tif (!attrib)\n\t\treturn NULL;\n\n\treturn &attrib->uuid;\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_attribute_get_handle",
          "args": [
            "attr"
          ],
          "line": 667
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_get_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1482-1488",
          "snippet": "uint16_t gatt_db_attribute_get_handle(const struct gatt_db_attribute *attrib)\n{\n\tif (!attrib)\n\t\treturn 0;\n\n\treturn attrib->handle;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nuint16_t gatt_db_attribute_get_handle(const struct gatt_db_attribute *attrib)\n{\n\tif (!attrib)\n\t\treturn 0;\n\n\treturn attrib->handle;\n}"
        }
      },
      {
        "call_info": {
          "callee": "new0",
          "args": [
            "structdescriptor",
            "1"
          ],
          "line": 664
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\n#define GATT_DESCRIPTOR_IFACE\t\t\"org.bluez.GattDescriptor1\"\n\nstatic const GDBusPropertyTable descriptor_properties[] = {\n\t{ \"UUID\", \"s\", descriptor_get_uuid },\n\t{ \"Characteristic\", \"o\", descriptor_get_characteristic, },\n\t{ \"Value\", \"ay\", descriptor_get_value, NULL, descriptor_value_exists },\n\t{ }\n};\nstatic const GDBusMethodTable descriptor_methods[] = {\n\t{ GDBUS_ASYNC_METHOD(\"ReadValue\", GDBUS_ARGS({ \"options\", \"a{sv}\" }),\n\t\t\t\t\tGDBUS_ARGS({ \"value\", \"ay\" }),\n\t\t\t\t\tdescriptor_read_value) },\n\t{ GDBUS_ASYNC_METHOD(\"WriteValue\", GDBUS_ARGS({ \"value\", \"ay\" },\n\t\t\t\t\t\t{ \"options\", \"a{sv}\" }),\n\t\t\t\t\tNULL,\n\t\t\t\t\tdescriptor_write_value) },\n\t{ }\n};\n\nstatic struct descriptor *descriptor_create(struct gatt_db_attribute *attr,\n\t\t\t\t\t\tstruct characteristic *chrc)\n{\n\tstruct descriptor *desc;\n\n\tdesc = new0(struct descriptor, 1);\n\tdesc->chrc = chrc;\n\tdesc->attr = attr;\n\tdesc->handle = gatt_db_attribute_get_handle(attr);\n\n\tbt_uuid_to_uuid128(gatt_db_attribute_get_type(attr), &desc->uuid);\n\n\tdesc->path = g_strdup_printf(\"%s/desc%04x\", chrc->path, desc->handle);\n\n\tif (!g_dbus_register_interface(btd_get_dbus_connection(), desc->path,\n\t\t\t\t\t\tGATT_DESCRIPTOR_IFACE,\n\t\t\t\t\t\tdescriptor_methods, NULL,\n\t\t\t\t\t\tdescriptor_properties,\n\t\t\t\t\t\tdesc, descriptor_free)) {\n\t\terror(\"Unable to register GATT descriptor with handle 0x%04x\",\n\t\t\t\t\t\t\t\tdesc->handle);\n\t\tdescriptor_free(desc);\n\n\t\treturn NULL;\n\t}\n\n\tDBG(\"Exported GATT characteristic descriptor: %s\", desc->path);\n\n\tif (uuid_cmp(&desc->uuid, GATT_CHARAC_EXT_PROPER_UUID))\n\t\tchrc->ext_props_handle = desc->handle;\n\n\treturn desc;\n}"
  },
  {
    "function_name": "descriptor_free",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "651-657",
    "snippet": "static void descriptor_free(void *data)\n{\n\tstruct descriptor *desc = data;\n\n\tg_free(desc->path);\n\tfree(desc);\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "desc"
          ],
          "line": 656
        },
        "resolved": true,
        "details": {
          "function_name": "service_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "1818-1826",
          "snippet": "static void service_free(void *data)\n{\n\tstruct service *service = data;\n\n\tqueue_destroy(service->chrcs, NULL);  /* List should be empty here */\n\tqueue_destroy(service->incl_services, NULL);\n\tg_free(service->path);\n\tfree(service);\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void service_free(void *data)\n{\n\tstruct service *service = data;\n\n\tqueue_destroy(service->chrcs, NULL);  /* List should be empty here */\n\tqueue_destroy(service->incl_services, NULL);\n\tg_free(service->path);\n\tfree(service);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "desc->path"
          ],
          "line": 655
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void descriptor_free(void *data)\n{\n\tstruct descriptor *desc = data;\n\n\tg_free(desc->path);\n\tfree(desc);\n}"
  },
  {
    "function_name": "descriptor_write_value",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "578-631",
    "snippet": "static DBusMessage *descriptor_write_value(DBusConnection *conn,\n\t\t\t\t\tDBusMessage *msg, void *user_data)\n{\n\tstruct descriptor *desc = user_data;\n\tstruct bt_gatt_client *gatt = desc->chrc->service->client->gatt;\n\tDBusMessageIter iter;\n\tuint8_t *value = NULL;\n\tint value_len = 0;\n\tuint16_t offset = 0;\n\n\tif (!gatt)\n\t\treturn btd_error_failed(msg, \"Not connected\");\n\n\tif (desc->write_op)\n\t\treturn btd_error_in_progress(msg);\n\n\tdbus_message_iter_init(msg, &iter);\n\n\tif (parse_value_arg(&iter, &value, &value_len))\n\t\treturn btd_error_invalid_args(msg);\n\n\tdbus_message_iter_next(&iter);\n\n\tif (parse_options(&iter, &offset))\n\t\treturn btd_error_invalid_args(msg);\n\n\t/*\n\t * Don't allow writing to Client Characteristic Configuration\n\t * descriptors. We achieve this through the StartNotify and StopNotify\n\t * methods on GattCharacteristic1.\n\t */\n\tif (uuid_cmp(&desc->uuid, GATT_CLIENT_CHARAC_CFG_UUID))\n\t\treturn btd_error_not_permitted(msg, \"Write not permitted\");\n\n\t/*\n\t * Based on the value length and the MTU, either use a write or a long\n\t * write.\n\t */\n\tif (value_len <= bt_gatt_client_get_mtu(gatt) - 3 && !offset)\n\t\tdesc->write_op = start_write_request(msg, desc->handle,\n\t\t\t\t\t\t\tgatt, value,\n\t\t\t\t\t\t\tvalue_len, desc,\n\t\t\t\t\t\t\tdesc_write_complete);\n\telse\n\t\tdesc->write_op = start_long_write(msg, desc->handle, gatt,\n\t\t\t\t\t\t\tfalse, value,\n\t\t\t\t\t\t\tvalue_len, offset, desc,\n\t\t\t\t\t\t\tdesc_write_complete);\n\n\tif (!desc->write_op)\n\t\treturn btd_error_failed(msg, \"Failed to initiate write\");\n\n\treturn NULL;\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "btd_error_failed",
          "args": [
            "msg",
            "\"Failed to initiate write\""
          ],
          "line": 628
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "124-128",
          "snippet": "DBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "start_long_write",
          "args": [
            "msg",
            "desc->handle",
            "gatt",
            "false",
            "value",
            "value_len",
            "offset",
            "desc",
            "desc_write_complete"
          ],
          "line": 622
        },
        "resolved": true,
        "details": {
          "function_name": "start_long_write",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "516-540",
          "snippet": "static struct async_dbus_op *start_long_write(DBusMessage *msg, uint16_t handle,\n\t\t\t\t\tstruct bt_gatt_client *gatt,\n\t\t\t\t\tbool reliable, const uint8_t *value,\n\t\t\t\t\tsize_t value_len, uint16_t offset,\n\t\t\t\t\tvoid *data,\n\t\t\t\t\tasync_dbus_op_complete_t complete)\n{\n\tstruct async_dbus_op *op;\n\n\top = async_dbus_op_new(msg, data);\n\top->complete = complete;\n\top->offset = offset;\n\n\top->id = bt_gatt_client_write_long_value(gatt, reliable, handle, offset,\n\t\t\t\t\t\t\tvalue, value_len,\n\t\t\t\t\t\t\twrite_result_cb, op,\n\t\t\t\t\t\t\tasync_dbus_op_free);\n\n\tif (!op->id) {\n\t\tasync_dbus_op_free(op);\n\t\treturn NULL;\n\t}\n\n\treturn op;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic struct async_dbus_op *start_long_write(DBusMessage *msg, uint16_t handle,\n\t\t\t\t\tstruct bt_gatt_client *gatt,\n\t\t\t\t\tbool reliable, const uint8_t *value,\n\t\t\t\t\tsize_t value_len, uint16_t offset,\n\t\t\t\t\tvoid *data,\n\t\t\t\t\tasync_dbus_op_complete_t complete)\n{\n\tstruct async_dbus_op *op;\n\n\top = async_dbus_op_new(msg, data);\n\top->complete = complete;\n\top->offset = offset;\n\n\top->id = bt_gatt_client_write_long_value(gatt, reliable, handle, offset,\n\t\t\t\t\t\t\tvalue, value_len,\n\t\t\t\t\t\t\twrite_result_cb, op,\n\t\t\t\t\t\t\tasync_dbus_op_free);\n\n\tif (!op->id) {\n\t\tasync_dbus_op_free(op);\n\t\treturn NULL;\n\t}\n\n\treturn op;\n}"
        }
      },
      {
        "call_info": {
          "callee": "start_write_request",
          "args": [
            "msg",
            "desc->handle",
            "gatt",
            "value",
            "value_len",
            "desc",
            "desc_write_complete"
          ],
          "line": 617
        },
        "resolved": true,
        "details": {
          "function_name": "start_write_request",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "542-563",
          "snippet": "static struct async_dbus_op *start_write_request(DBusMessage *msg,\n\t\t\t\t\tuint16_t handle,\n\t\t\t\t\tstruct bt_gatt_client *gatt,\n\t\t\t\t\tconst uint8_t *value, size_t value_len,\n\t\t\t\t\tvoid *data,\n\t\t\t\t\tasync_dbus_op_complete_t complete)\n{\n\tstruct async_dbus_op *op;\n\n\top = async_dbus_op_new(msg, data);\n\top->complete = complete;\n\n\top->id = bt_gatt_client_write_value(gatt, handle, value, value_len,\n\t\t\t\t\t\t\twrite_cb, op,\n\t\t\t\t\t\t\tasync_dbus_op_free);\n\tif (!op->id) {\n\t\tasync_dbus_op_free(op);\n\t\treturn NULL;\n\t}\n\n\treturn op;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic struct async_dbus_op *start_write_request(DBusMessage *msg,\n\t\t\t\t\tuint16_t handle,\n\t\t\t\t\tstruct bt_gatt_client *gatt,\n\t\t\t\t\tconst uint8_t *value, size_t value_len,\n\t\t\t\t\tvoid *data,\n\t\t\t\t\tasync_dbus_op_complete_t complete)\n{\n\tstruct async_dbus_op *op;\n\n\top = async_dbus_op_new(msg, data);\n\top->complete = complete;\n\n\top->id = bt_gatt_client_write_value(gatt, handle, value, value_len,\n\t\t\t\t\t\t\twrite_cb, op,\n\t\t\t\t\t\t\tasync_dbus_op_free);\n\tif (!op->id) {\n\t\tasync_dbus_op_free(op);\n\t\treturn NULL;\n\t}\n\n\treturn op;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_gatt_client_get_mtu",
          "args": [
            "gatt"
          ],
          "line": 616
        },
        "resolved": true,
        "details": {
          "function_name": "bt_gatt_client_get_mtu",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-client.c",
          "lines": "2088-2094",
          "snippet": "uint16_t bt_gatt_client_get_mtu(struct bt_gatt_client *client)\n{\n\tif (!client || !client->att)\n\t\treturn 0;\n\n\treturn bt_att_get_mtu(client->att);\n}",
          "includes": [
            "#include <sys/uio.h>",
            "#include <limits.h>",
            "#include <assert.h>",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-helpers.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/att.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/uio.h>\n#include <limits.h>\n#include <assert.h>\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-helpers.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/att.h\"\n#include <config.h>\n\nuint16_t bt_gatt_client_get_mtu(struct bt_gatt_client *client)\n{\n\tif (!client || !client->att)\n\t\treturn 0;\n\n\treturn bt_att_get_mtu(client->att);\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_error_not_permitted",
          "args": [
            "msg",
            "\"Write not permitted\""
          ],
          "line": 610
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_not_permitted",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "100-104",
          "snippet": "DBusMessage *btd_error_not_permitted(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotPermitted\",\n\t\t\t\t\t\"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_not_permitted(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotPermitted\",\n\t\t\t\t\t\"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "uuid_cmp",
          "args": [
            "&desc->uuid",
            "GATT_CLIENT_CHARAC_CFG_UUID"
          ],
          "line": 609
        },
        "resolved": true,
        "details": {
          "function_name": "uuid_cmp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "135-142",
          "snippet": "static bool uuid_cmp(const bt_uuid_t *uuid, uint16_t u16)\n{\n\tbt_uuid_t uuid16;\n\n\tbt_uuid16_create(&uuid16, u16);\n\n\treturn bt_uuid_cmp(uuid, &uuid16) == 0;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic bool uuid_cmp(const bt_uuid_t *uuid, uint16_t u16)\n{\n\tbt_uuid_t uuid16;\n\n\tbt_uuid16_create(&uuid16, u16);\n\n\treturn bt_uuid_cmp(uuid, &uuid16) == 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_error_invalid_args",
          "args": [
            "msg"
          ],
          "line": 602
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_invalid_args",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "34-38",
          "snippet": "DBusMessage *btd_error_invalid_args(DBusMessage *msg)\n{\n\treturn btd_error_invalid_args_str(msg,\n\t\t\t\t\t\"Invalid arguments in method call\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_invalid_args(DBusMessage *msg)\n{\n\treturn btd_error_invalid_args_str(msg,\n\t\t\t\t\t\"Invalid arguments in method call\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "parse_options",
          "args": [
            "&iter",
            "&offset"
          ],
          "line": 601
        },
        "resolved": true,
        "details": {
          "function_name": "parse_options",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "391-422",
          "snippet": "static int parse_options(DBusMessageIter *iter, uint16_t *offset)\n{\n\tDBusMessageIter dict;\n\n\tif (dbus_message_iter_get_arg_type(iter) != DBUS_TYPE_ARRAY)\n\t\treturn -EINVAL;\n\n\tdbus_message_iter_recurse(iter, &dict);\n\n\twhile (dbus_message_iter_get_arg_type(&dict) == DBUS_TYPE_DICT_ENTRY) {\n\t\tconst char *key;\n\t\tDBusMessageIter value, entry;\n\t\tint var;\n\n\t\tdbus_message_iter_recurse(&dict, &entry);\n\t\tdbus_message_iter_get_basic(&entry, &key);\n\n\t\tdbus_message_iter_next(&entry);\n\t\tdbus_message_iter_recurse(&entry, &value);\n\n\t\tvar = dbus_message_iter_get_arg_type(&value);\n\t\tif (strcasecmp(key, \"offset\") == 0) {\n\t\t\tif (var != DBUS_TYPE_UINT16)\n\t\t\t\treturn -EINVAL;\n\t\t\tdbus_message_iter_get_basic(&value, offset);\n\t\t}\n\n\t\tdbus_message_iter_next(&dict);\n\t}\n\n\treturn 0;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic int parse_options(DBusMessageIter *iter, uint16_t *offset)\n{\n\tDBusMessageIter dict;\n\n\tif (dbus_message_iter_get_arg_type(iter) != DBUS_TYPE_ARRAY)\n\t\treturn -EINVAL;\n\n\tdbus_message_iter_recurse(iter, &dict);\n\n\twhile (dbus_message_iter_get_arg_type(&dict) == DBUS_TYPE_DICT_ENTRY) {\n\t\tconst char *key;\n\t\tDBusMessageIter value, entry;\n\t\tint var;\n\n\t\tdbus_message_iter_recurse(&dict, &entry);\n\t\tdbus_message_iter_get_basic(&entry, &key);\n\n\t\tdbus_message_iter_next(&entry);\n\t\tdbus_message_iter_recurse(&entry, &value);\n\n\t\tvar = dbus_message_iter_get_arg_type(&value);\n\t\tif (strcasecmp(key, \"offset\") == 0) {\n\t\t\tif (var != DBUS_TYPE_UINT16)\n\t\t\t\treturn -EINVAL;\n\t\t\tdbus_message_iter_get_basic(&value, offset);\n\t\t}\n\n\t\tdbus_message_iter_next(&dict);\n\t}\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_next",
          "args": [
            "&iter"
          ],
          "line": 599
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "parse_value_arg",
          "args": [
            "&iter",
            "&value",
            "&value_len"
          ],
          "line": 596
        },
        "resolved": true,
        "details": {
          "function_name": "parse_value_arg",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "222-233",
          "snippet": "static int parse_value_arg(DBusMessageIter *iter, uint8_t **value, int *len)\n{\n\tDBusMessageIter array;\n\n\tif (dbus_message_iter_get_arg_type(iter) != DBUS_TYPE_ARRAY)\n\t\treturn -EINVAL;\n\n\tdbus_message_iter_recurse(iter, &array);\n\tdbus_message_iter_get_fixed_array(&array, value, len);\n\n\treturn 0;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic int parse_value_arg(DBusMessageIter *iter, uint8_t **value, int *len)\n{\n\tDBusMessageIter array;\n\n\tif (dbus_message_iter_get_arg_type(iter) != DBUS_TYPE_ARRAY)\n\t\treturn -EINVAL;\n\n\tdbus_message_iter_recurse(iter, &array);\n\tdbus_message_iter_get_fixed_array(&array, value, len);\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_init",
          "args": [
            "msg",
            "&iter"
          ],
          "line": 594
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_error_in_progress",
          "args": [
            "msg"
          ],
          "line": 592
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_in_progress",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "76-80",
          "snippet": "DBusMessage *btd_error_in_progress(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".InProgress\",\n\t\t\t\t\t\"In Progress\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_in_progress(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".InProgress\",\n\t\t\t\t\t\"In Progress\");\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic DBusMessage *descriptor_write_value(DBusConnection *conn,\n\t\t\t\t\tDBusMessage *msg, void *user_data)\n{\n\tstruct descriptor *desc = user_data;\n\tstruct bt_gatt_client *gatt = desc->chrc->service->client->gatt;\n\tDBusMessageIter iter;\n\tuint8_t *value = NULL;\n\tint value_len = 0;\n\tuint16_t offset = 0;\n\n\tif (!gatt)\n\t\treturn btd_error_failed(msg, \"Not connected\");\n\n\tif (desc->write_op)\n\t\treturn btd_error_in_progress(msg);\n\n\tdbus_message_iter_init(msg, &iter);\n\n\tif (parse_value_arg(&iter, &value, &value_len))\n\t\treturn btd_error_invalid_args(msg);\n\n\tdbus_message_iter_next(&iter);\n\n\tif (parse_options(&iter, &offset))\n\t\treturn btd_error_invalid_args(msg);\n\n\t/*\n\t * Don't allow writing to Client Characteristic Configuration\n\t * descriptors. We achieve this through the StartNotify and StopNotify\n\t * methods on GattCharacteristic1.\n\t */\n\tif (uuid_cmp(&desc->uuid, GATT_CLIENT_CHARAC_CFG_UUID))\n\t\treturn btd_error_not_permitted(msg, \"Write not permitted\");\n\n\t/*\n\t * Based on the value length and the MTU, either use a write or a long\n\t * write.\n\t */\n\tif (value_len <= bt_gatt_client_get_mtu(gatt) - 3 && !offset)\n\t\tdesc->write_op = start_write_request(msg, desc->handle,\n\t\t\t\t\t\t\tgatt, value,\n\t\t\t\t\t\t\tvalue_len, desc,\n\t\t\t\t\t\t\tdesc_write_complete);\n\telse\n\t\tdesc->write_op = start_long_write(msg, desc->handle, gatt,\n\t\t\t\t\t\t\tfalse, value,\n\t\t\t\t\t\t\tvalue_len, offset, desc,\n\t\t\t\t\t\t\tdesc_write_complete);\n\n\tif (!desc->write_op)\n\t\treturn btd_error_failed(msg, \"Failed to initiate write\");\n\n\treturn NULL;\n}"
  },
  {
    "function_name": "desc_write_complete",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "565-576",
    "snippet": "static bool desc_write_complete(void *data)\n{\n\tstruct descriptor *desc = data;\n\n\tdesc->write_op = NULL;\n\n\t/*\n\t * The descriptor might have been unregistered during the read. Return\n\t * failure.\n\t */\n\treturn !!desc->chrc;\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic bool desc_write_complete(void *data)\n{\n\tstruct descriptor *desc = data;\n\n\tdesc->write_op = NULL;\n\n\t/*\n\t * The descriptor might have been unregistered during the read. Return\n\t * failure.\n\t */\n\treturn !!desc->chrc;\n}"
  },
  {
    "function_name": "start_write_request",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "542-563",
    "snippet": "static struct async_dbus_op *start_write_request(DBusMessage *msg,\n\t\t\t\t\tuint16_t handle,\n\t\t\t\t\tstruct bt_gatt_client *gatt,\n\t\t\t\t\tconst uint8_t *value, size_t value_len,\n\t\t\t\t\tvoid *data,\n\t\t\t\t\tasync_dbus_op_complete_t complete)\n{\n\tstruct async_dbus_op *op;\n\n\top = async_dbus_op_new(msg, data);\n\top->complete = complete;\n\n\top->id = bt_gatt_client_write_value(gatt, handle, value, value_len,\n\t\t\t\t\t\t\twrite_cb, op,\n\t\t\t\t\t\t\tasync_dbus_op_free);\n\tif (!op->id) {\n\t\tasync_dbus_op_free(op);\n\t\treturn NULL;\n\t}\n\n\treturn op;\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "async_dbus_op_free",
          "args": [
            "op"
          ],
          "line": 558
        },
        "resolved": true,
        "details": {
          "function_name": "async_dbus_op_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "235-242",
          "snippet": "static void async_dbus_op_free(void *data)\n{\n\tstruct async_dbus_op *op = data;\n\n\tqueue_destroy(op->msgs, (void *)dbus_message_unref);\n\n\tfree(op);\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void async_dbus_op_free(void *data)\n{\n\tstruct async_dbus_op *op = data;\n\n\tqueue_destroy(op->msgs, (void *)dbus_message_unref);\n\n\tfree(op);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_gatt_client_write_value",
          "args": [
            "gatt",
            "handle",
            "value",
            "value_len",
            "write_cb",
            "op",
            "async_dbus_op_free"
          ],
          "line": 554
        },
        "resolved": true,
        "details": {
          "function_name": "bt_gatt_client_write_value",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-client.c",
          "lines": "2633-2676",
          "snippet": "unsigned int bt_gatt_client_write_value(struct bt_gatt_client *client,\n\t\t\t\t\tuint16_t value_handle,\n\t\t\t\t\tconst uint8_t *value, uint16_t length,\n\t\t\t\t\tbt_gatt_client_callback_t callback,\n\t\t\t\t\tvoid *user_data,\n\t\t\t\t\tbt_gatt_client_destroy_func_t destroy)\n{\n\tstruct request *req;\n\tstruct write_op *op;\n\tuint8_t pdu[2 + length];\n\n\tif (!client)\n\t\treturn 0;\n\n\top = new0(struct write_op, 1);\n\n\treq = request_create(client);\n\tif (!req) {\n\t\tfree(op);\n\t\treturn 0;\n\t}\n\n\top->callback = callback;\n\top->user_data = user_data;\n\top->destroy = destroy;\n\n\treq->data = op;\n\treq->destroy = destroy_write_op;\n\n\tput_le16(value_handle, pdu);\n\tmemcpy(pdu + 2, value, length);\n\n\treq->att_id = bt_att_send(client->att, BT_ATT_OP_WRITE_REQ,\n\t\t\t\t\t\t\tpdu, sizeof(pdu),\n\t\t\t\t\t\t\twrite_cb, req,\n\t\t\t\t\t\t\trequest_unref);\n\tif (!req->att_id) {\n\t\top->destroy = NULL;\n\t\trequest_unref(req);\n\t\treturn 0;\n\t}\n\n\treturn req->id;\n}",
          "includes": [
            "#include <sys/uio.h>",
            "#include <limits.h>",
            "#include <assert.h>",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-helpers.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/att.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void discover_chrcs_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\t\tstruct bt_gatt_result *result,\n\t\t\t\t\t\tvoid *user_data);",
            "static void discover_descs_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\t\tstruct bt_gatt_result *result,\n\t\t\t\t\t\tvoid *user_data);",
            "static void ext_prop_read_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\tconst uint8_t *value, uint16_t length,\n\t\t\t\t\tvoid *user_data);",
            "static void service_changed_cb(uint16_t value_handle, const uint8_t *value,\n\t\t\t\t\tuint16_t length, void *user_data);",
            "static void prepare_write_cb(uint8_t opcode, const void *pdu, uint16_t length,\n\t\t\t\t\t\t\tvoid *user_data);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <sys/uio.h>\n#include <limits.h>\n#include <assert.h>\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-helpers.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/att.h\"\n#include <config.h>\n\nstatic void discover_chrcs_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\t\tstruct bt_gatt_result *result,\n\t\t\t\t\t\tvoid *user_data);\nstatic void discover_descs_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\t\tstruct bt_gatt_result *result,\n\t\t\t\t\t\tvoid *user_data);\nstatic void ext_prop_read_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\tconst uint8_t *value, uint16_t length,\n\t\t\t\t\tvoid *user_data);\nstatic void service_changed_cb(uint16_t value_handle, const uint8_t *value,\n\t\t\t\t\tuint16_t length, void *user_data);\nstatic void prepare_write_cb(uint8_t opcode, const void *pdu, uint16_t length,\n\t\t\t\t\t\t\tvoid *user_data);\n\nunsigned int bt_gatt_client_write_value(struct bt_gatt_client *client,\n\t\t\t\t\tuint16_t value_handle,\n\t\t\t\t\tconst uint8_t *value, uint16_t length,\n\t\t\t\t\tbt_gatt_client_callback_t callback,\n\t\t\t\t\tvoid *user_data,\n\t\t\t\t\tbt_gatt_client_destroy_func_t destroy)\n{\n\tstruct request *req;\n\tstruct write_op *op;\n\tuint8_t pdu[2 + length];\n\n\tif (!client)\n\t\treturn 0;\n\n\top = new0(struct write_op, 1);\n\n\treq = request_create(client);\n\tif (!req) {\n\t\tfree(op);\n\t\treturn 0;\n\t}\n\n\top->callback = callback;\n\top->user_data = user_data;\n\top->destroy = destroy;\n\n\treq->data = op;\n\treq->destroy = destroy_write_op;\n\n\tput_le16(value_handle, pdu);\n\tmemcpy(pdu + 2, value, length);\n\n\treq->att_id = bt_att_send(client->att, BT_ATT_OP_WRITE_REQ,\n\t\t\t\t\t\t\tpdu, sizeof(pdu),\n\t\t\t\t\t\t\twrite_cb, req,\n\t\t\t\t\t\t\trequest_unref);\n\tif (!req->att_id) {\n\t\top->destroy = NULL;\n\t\trequest_unref(req);\n\t\treturn 0;\n\t}\n\n\treturn req->id;\n}"
        }
      },
      {
        "call_info": {
          "callee": "async_dbus_op_new",
          "args": [
            "msg",
            "data"
          ],
          "line": 551
        },
        "resolved": true,
        "details": {
          "function_name": "async_dbus_op_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "424-434",
          "snippet": "static struct async_dbus_op *async_dbus_op_new(DBusMessage *msg, void *data)\n{\n\tstruct async_dbus_op *op;\n\n\top = new0(struct async_dbus_op, 1);\n\top->msgs = queue_new();\n\tqueue_push_tail(op->msgs, dbus_message_ref(msg));\n\top->data = data;\n\n\treturn op;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic struct async_dbus_op *async_dbus_op_new(DBusMessage *msg, void *data)\n{\n\tstruct async_dbus_op *op;\n\n\top = new0(struct async_dbus_op, 1);\n\top->msgs = queue_new();\n\tqueue_push_tail(op->msgs, dbus_message_ref(msg));\n\top->data = data;\n\n\treturn op;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic struct async_dbus_op *start_write_request(DBusMessage *msg,\n\t\t\t\t\tuint16_t handle,\n\t\t\t\t\tstruct bt_gatt_client *gatt,\n\t\t\t\t\tconst uint8_t *value, size_t value_len,\n\t\t\t\t\tvoid *data,\n\t\t\t\t\tasync_dbus_op_complete_t complete)\n{\n\tstruct async_dbus_op *op;\n\n\top = async_dbus_op_new(msg, data);\n\top->complete = complete;\n\n\top->id = bt_gatt_client_write_value(gatt, handle, value, value_len,\n\t\t\t\t\t\t\twrite_cb, op,\n\t\t\t\t\t\t\tasync_dbus_op_free);\n\tif (!op->id) {\n\t\tasync_dbus_op_free(op);\n\t\treturn NULL;\n\t}\n\n\treturn op;\n}"
  },
  {
    "function_name": "start_long_write",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "516-540",
    "snippet": "static struct async_dbus_op *start_long_write(DBusMessage *msg, uint16_t handle,\n\t\t\t\t\tstruct bt_gatt_client *gatt,\n\t\t\t\t\tbool reliable, const uint8_t *value,\n\t\t\t\t\tsize_t value_len, uint16_t offset,\n\t\t\t\t\tvoid *data,\n\t\t\t\t\tasync_dbus_op_complete_t complete)\n{\n\tstruct async_dbus_op *op;\n\n\top = async_dbus_op_new(msg, data);\n\top->complete = complete;\n\top->offset = offset;\n\n\top->id = bt_gatt_client_write_long_value(gatt, reliable, handle, offset,\n\t\t\t\t\t\t\tvalue, value_len,\n\t\t\t\t\t\t\twrite_result_cb, op,\n\t\t\t\t\t\t\tasync_dbus_op_free);\n\n\tif (!op->id) {\n\t\tasync_dbus_op_free(op);\n\t\treturn NULL;\n\t}\n\n\treturn op;\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "async_dbus_op_free",
          "args": [
            "op"
          ],
          "line": 535
        },
        "resolved": true,
        "details": {
          "function_name": "async_dbus_op_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "235-242",
          "snippet": "static void async_dbus_op_free(void *data)\n{\n\tstruct async_dbus_op *op = data;\n\n\tqueue_destroy(op->msgs, (void *)dbus_message_unref);\n\n\tfree(op);\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void async_dbus_op_free(void *data)\n{\n\tstruct async_dbus_op *op = data;\n\n\tqueue_destroy(op->msgs, (void *)dbus_message_unref);\n\n\tfree(op);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_gatt_client_write_long_value",
          "args": [
            "gatt",
            "reliable",
            "handle",
            "offset",
            "value",
            "value_len",
            "write_result_cb",
            "op",
            "async_dbus_op_free"
          ],
          "line": 529
        },
        "resolved": true,
        "details": {
          "function_name": "bt_gatt_client_write_long_value",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-client.c",
          "lines": "2896-2981",
          "snippet": "unsigned int bt_gatt_client_write_long_value(struct bt_gatt_client *client,\n\t\t\t\tbool reliable,\n\t\t\t\tuint16_t value_handle, uint16_t offset,\n\t\t\t\tconst uint8_t *value, uint16_t length,\n\t\t\t\tbt_gatt_client_write_long_callback_t callback,\n\t\t\t\tvoid *user_data,\n\t\t\t\tbt_gatt_client_destroy_func_t destroy)\n{\n\tstruct request *req;\n\tstruct long_write_op *op;\n\tuint8_t *pdu;\n\n\tif (!client)\n\t\treturn 0;\n\n\tif ((size_t)(length + offset) > UINT16_MAX)\n\t\treturn 0;\n\n\t/* Don't allow writing a 0-length value using this procedure. The\n\t * upper-layer should use bt_gatt_write_value for that instead.\n\t */\n\tif (!length || !value)\n\t\treturn 0;\n\n\top = new0(struct long_write_op, 1);\n\top->value = malloc(length);\n\tif (!op->value) {\n\t\tfree(op);\n\t\treturn 0;\n\t}\n\n\treq = request_create(client);\n\tif (!req) {\n\t\tfree(op->value);\n\t\tfree(op);\n\t\treturn 0;\n\t}\n\n\tmemcpy(op->value, value, length);\n\n\top->client = client;\n\top->reliable = reliable;\n\top->value_handle = value_handle;\n\top->length = length;\n\top->offset = offset;\n\top->cur_length = MIN(length, bt_att_get_mtu(client->att) - 5);\n\top->callback = callback;\n\top->user_data = user_data;\n\top->destroy = destroy;\n\n\treq->data = op;\n\treq->destroy = long_write_op_free;\n\treq->long_write = true;\n\n\tif (client->in_long_write || client->reliable_write_session_id > 0) {\n\t\tqueue_push_tail(client->long_write_queue, req);\n\t\treturn req->id;\n\t}\n\n\tpdu = malloc(op->cur_length + 4);\n\tif (!pdu) {\n\t\tfree(op->value);\n\t\tfree(op);\n\t\treturn 0;\n\t}\n\n\tput_le16(value_handle, pdu);\n\tput_le16(offset, pdu + 2);\n\tmemcpy(pdu + 4, op->value, op->cur_length);\n\n\treq->att_id = bt_att_send(client->att, BT_ATT_OP_PREP_WRITE_REQ,\n\t\t\t\t\t\t\tpdu, op->cur_length + 4,\n\t\t\t\t\t\t\tprepare_write_cb, req,\n\t\t\t\t\t\t\trequest_unref);\n\tfree(pdu);\n\n\tif (!req->att_id) {\n\t\top->destroy = NULL;\n\t\trequest_unref(req);\n\t\treturn 0;\n\t}\n\n\tclient->in_long_write = true;\n\n\treturn req->id;\n}",
          "includes": [
            "#include <sys/uio.h>",
            "#include <limits.h>",
            "#include <assert.h>",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-helpers.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/att.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void discover_chrcs_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\t\tstruct bt_gatt_result *result,\n\t\t\t\t\t\tvoid *user_data);",
            "static void discover_descs_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\t\tstruct bt_gatt_result *result,\n\t\t\t\t\t\tvoid *user_data);",
            "static void ext_prop_read_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\tconst uint8_t *value, uint16_t length,\n\t\t\t\t\tvoid *user_data);",
            "static void service_changed_cb(uint16_t value_handle, const uint8_t *value,\n\t\t\t\t\tuint16_t length, void *user_data);",
            "static void prepare_write_cb(uint8_t opcode, const void *pdu, uint16_t length,\n\t\t\t\t\t\t\tvoid *user_data);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <sys/uio.h>\n#include <limits.h>\n#include <assert.h>\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-helpers.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/att.h\"\n#include <config.h>\n\nstatic void discover_chrcs_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\t\tstruct bt_gatt_result *result,\n\t\t\t\t\t\tvoid *user_data);\nstatic void discover_descs_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\t\tstruct bt_gatt_result *result,\n\t\t\t\t\t\tvoid *user_data);\nstatic void ext_prop_read_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\tconst uint8_t *value, uint16_t length,\n\t\t\t\t\tvoid *user_data);\nstatic void service_changed_cb(uint16_t value_handle, const uint8_t *value,\n\t\t\t\t\tuint16_t length, void *user_data);\nstatic void prepare_write_cb(uint8_t opcode, const void *pdu, uint16_t length,\n\t\t\t\t\t\t\tvoid *user_data);\n\nunsigned int bt_gatt_client_write_long_value(struct bt_gatt_client *client,\n\t\t\t\tbool reliable,\n\t\t\t\tuint16_t value_handle, uint16_t offset,\n\t\t\t\tconst uint8_t *value, uint16_t length,\n\t\t\t\tbt_gatt_client_write_long_callback_t callback,\n\t\t\t\tvoid *user_data,\n\t\t\t\tbt_gatt_client_destroy_func_t destroy)\n{\n\tstruct request *req;\n\tstruct long_write_op *op;\n\tuint8_t *pdu;\n\n\tif (!client)\n\t\treturn 0;\n\n\tif ((size_t)(length + offset) > UINT16_MAX)\n\t\treturn 0;\n\n\t/* Don't allow writing a 0-length value using this procedure. The\n\t * upper-layer should use bt_gatt_write_value for that instead.\n\t */\n\tif (!length || !value)\n\t\treturn 0;\n\n\top = new0(struct long_write_op, 1);\n\top->value = malloc(length);\n\tif (!op->value) {\n\t\tfree(op);\n\t\treturn 0;\n\t}\n\n\treq = request_create(client);\n\tif (!req) {\n\t\tfree(op->value);\n\t\tfree(op);\n\t\treturn 0;\n\t}\n\n\tmemcpy(op->value, value, length);\n\n\top->client = client;\n\top->reliable = reliable;\n\top->value_handle = value_handle;\n\top->length = length;\n\top->offset = offset;\n\top->cur_length = MIN(length, bt_att_get_mtu(client->att) - 5);\n\top->callback = callback;\n\top->user_data = user_data;\n\top->destroy = destroy;\n\n\treq->data = op;\n\treq->destroy = long_write_op_free;\n\treq->long_write = true;\n\n\tif (client->in_long_write || client->reliable_write_session_id > 0) {\n\t\tqueue_push_tail(client->long_write_queue, req);\n\t\treturn req->id;\n\t}\n\n\tpdu = malloc(op->cur_length + 4);\n\tif (!pdu) {\n\t\tfree(op->value);\n\t\tfree(op);\n\t\treturn 0;\n\t}\n\n\tput_le16(value_handle, pdu);\n\tput_le16(offset, pdu + 2);\n\tmemcpy(pdu + 4, op->value, op->cur_length);\n\n\treq->att_id = bt_att_send(client->att, BT_ATT_OP_PREP_WRITE_REQ,\n\t\t\t\t\t\t\tpdu, op->cur_length + 4,\n\t\t\t\t\t\t\tprepare_write_cb, req,\n\t\t\t\t\t\t\trequest_unref);\n\tfree(pdu);\n\n\tif (!req->att_id) {\n\t\top->destroy = NULL;\n\t\trequest_unref(req);\n\t\treturn 0;\n\t}\n\n\tclient->in_long_write = true;\n\n\treturn req->id;\n}"
        }
      },
      {
        "call_info": {
          "callee": "async_dbus_op_new",
          "args": [
            "msg",
            "data"
          ],
          "line": 525
        },
        "resolved": true,
        "details": {
          "function_name": "async_dbus_op_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "424-434",
          "snippet": "static struct async_dbus_op *async_dbus_op_new(DBusMessage *msg, void *data)\n{\n\tstruct async_dbus_op *op;\n\n\top = new0(struct async_dbus_op, 1);\n\top->msgs = queue_new();\n\tqueue_push_tail(op->msgs, dbus_message_ref(msg));\n\top->data = data;\n\n\treturn op;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic struct async_dbus_op *async_dbus_op_new(DBusMessage *msg, void *data)\n{\n\tstruct async_dbus_op *op;\n\n\top = new0(struct async_dbus_op, 1);\n\top->msgs = queue_new();\n\tqueue_push_tail(op->msgs, dbus_message_ref(msg));\n\top->data = data;\n\n\treturn op;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic struct async_dbus_op *start_long_write(DBusMessage *msg, uint16_t handle,\n\t\t\t\t\tstruct bt_gatt_client *gatt,\n\t\t\t\t\tbool reliable, const uint8_t *value,\n\t\t\t\t\tsize_t value_len, uint16_t offset,\n\t\t\t\t\tvoid *data,\n\t\t\t\t\tasync_dbus_op_complete_t complete)\n{\n\tstruct async_dbus_op *op;\n\n\top = async_dbus_op_new(msg, data);\n\top->complete = complete;\n\top->offset = offset;\n\n\top->id = bt_gatt_client_write_long_value(gatt, reliable, handle, offset,\n\t\t\t\t\t\t\tvalue, value_len,\n\t\t\t\t\t\t\twrite_result_cb, op,\n\t\t\t\t\t\t\tasync_dbus_op_free);\n\n\tif (!op->id) {\n\t\tasync_dbus_op_free(op);\n\t\treturn NULL;\n\t}\n\n\treturn op;\n}"
  },
  {
    "function_name": "write_cb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "511-514",
    "snippet": "static void write_cb(bool success, uint8_t att_ecode, void *user_data)\n{\n\twrite_result_cb(success, false, att_ecode, user_data);\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "write_result_cb",
          "args": [
            "success",
            "false",
            "att_ecode",
            "user_data"
          ],
          "line": 513
        },
        "resolved": true,
        "details": {
          "function_name": "write_result_cb",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "489-509",
          "snippet": "static void write_result_cb(bool success, bool reliable_error,\n\t\t\t\t\tuint8_t att_ecode, void *user_data)\n{\n\tstruct async_dbus_op *op = user_data;\n\tint err = 0;\n\n\tif (op->complete && !op->complete(op->data)) {\n\t\terr = -EFAULT;\n\t\tgoto done;\n\t}\n\n\tif (!success) {\n\t\tif (reliable_error)\n\t\t\terr = -EFAULT;\n\t\telse\n\t\t\terr = att_ecode;\n\t}\n\ndone:\n\tasync_dbus_op_reply(op, err, NULL, -1);\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void write_result_cb(bool success, bool reliable_error,\n\t\t\t\t\tuint8_t att_ecode, void *user_data)\n{\n\tstruct async_dbus_op *op = user_data;\n\tint err = 0;\n\n\tif (op->complete && !op->complete(op->data)) {\n\t\terr = -EFAULT;\n\t\tgoto done;\n\t}\n\n\tif (!success) {\n\t\tif (reliable_error)\n\t\t\terr = -EFAULT;\n\t\telse\n\t\t\terr = att_ecode;\n\t}\n\ndone:\n\tasync_dbus_op_reply(op, err, NULL, -1);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void write_cb(bool success, uint8_t att_ecode, void *user_data)\n{\n\twrite_result_cb(success, false, att_ecode, user_data);\n}"
  },
  {
    "function_name": "write_result_cb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "489-509",
    "snippet": "static void write_result_cb(bool success, bool reliable_error,\n\t\t\t\t\tuint8_t att_ecode, void *user_data)\n{\n\tstruct async_dbus_op *op = user_data;\n\tint err = 0;\n\n\tif (op->complete && !op->complete(op->data)) {\n\t\terr = -EFAULT;\n\t\tgoto done;\n\t}\n\n\tif (!success) {\n\t\tif (reliable_error)\n\t\t\terr = -EFAULT;\n\t\telse\n\t\t\terr = att_ecode;\n\t}\n\ndone:\n\tasync_dbus_op_reply(op, err, NULL, -1);\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "async_dbus_op_reply",
          "args": [
            "op",
            "err",
            "NULL",
            "-1"
          ],
          "line": 508
        },
        "resolved": true,
        "details": {
          "function_name": "async_dbus_op_reply",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "315-344",
          "snippet": "static void async_dbus_op_reply(struct async_dbus_op *op, int err,\n\t\t\t\tconst uint8_t *value, ssize_t length)\n{\n\tconst struct queue_entry *entry;\n\tDBusMessage *reply;\n\n\top->id = 0;\n\n\tfor (entry = queue_get_entries(op->msgs); entry; entry = entry->next) {\n\t\tDBusMessage *msg = entry->data;\n\n\t\tif (err) {\n\t\t\treply = err > 0 ? create_gatt_dbus_error(msg, err) :\n\t\t\t\tbtd_error_failed(msg, strerror(-err));\n\t\t\tgoto send_reply;\n\t\t}\n\n\t\treply = g_dbus_create_reply(msg, DBUS_TYPE_INVALID);\n\t\tif (!reply) {\n\t\t\terror(\"Failed to allocate D-Bus message reply\");\n\t\t\treturn;\n\t\t}\n\n\t\tif (length >= 0)\n\t\t\tmessage_append_byte_array(reply, value, length);\n\nsend_reply:\n\t\tg_dbus_send_message(btd_get_dbus_connection(), reply);\n\t}\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void async_dbus_op_reply(struct async_dbus_op *op, int err,\n\t\t\t\tconst uint8_t *value, ssize_t length)\n{\n\tconst struct queue_entry *entry;\n\tDBusMessage *reply;\n\n\top->id = 0;\n\n\tfor (entry = queue_get_entries(op->msgs); entry; entry = entry->next) {\n\t\tDBusMessage *msg = entry->data;\n\n\t\tif (err) {\n\t\t\treply = err > 0 ? create_gatt_dbus_error(msg, err) :\n\t\t\t\tbtd_error_failed(msg, strerror(-err));\n\t\t\tgoto send_reply;\n\t\t}\n\n\t\treply = g_dbus_create_reply(msg, DBUS_TYPE_INVALID);\n\t\tif (!reply) {\n\t\t\terror(\"Failed to allocate D-Bus message reply\");\n\t\t\treturn;\n\t\t}\n\n\t\tif (length >= 0)\n\t\t\tmessage_append_byte_array(reply, value, length);\n\nsend_reply:\n\t\tg_dbus_send_message(btd_get_dbus_connection(), reply);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "op->complete",
          "args": [
            "op->data"
          ],
          "line": 495
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void write_result_cb(bool success, bool reliable_error,\n\t\t\t\t\tuint8_t att_ecode, void *user_data)\n{\n\tstruct async_dbus_op *op = user_data;\n\tint err = 0;\n\n\tif (op->complete && !op->complete(op->data)) {\n\t\terr = -EFAULT;\n\t\tgoto done;\n\t}\n\n\tif (!success) {\n\t\tif (reliable_error)\n\t\t\terr = -EFAULT;\n\t\telse\n\t\t\terr = att_ecode;\n\t}\n\ndone:\n\tasync_dbus_op_reply(op, err, NULL, -1);\n}"
  },
  {
    "function_name": "descriptor_read_value",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "458-487",
    "snippet": "static DBusMessage *descriptor_read_value(DBusConnection *conn,\n\t\t\t\t\tDBusMessage *msg, void *user_data)\n{\n\tstruct descriptor *desc = user_data;\n\tstruct bt_gatt_client *gatt = desc->chrc->service->client->gatt;\n\tDBusMessageIter iter;\n\tuint16_t offset = 0;\n\n\tif (!gatt)\n\t\treturn btd_error_failed(msg, \"Not connected\");\n\n\tdbus_message_iter_init(msg, &iter);\n\n\tif (parse_options(&iter, &offset))\n\t\treturn btd_error_invalid_args(msg);\n\n\tif (desc->read_op) {\n\t\tif (desc->read_op->offset != offset)\n\t\t\treturn btd_error_in_progress(msg);\n\t\tqueue_push_tail(desc->read_op->msgs, dbus_message_ref(msg));\n\t\treturn NULL;\n\t}\n\n\tdesc->read_op = read_value(gatt, msg, desc->handle, offset,\n\t\t\t\t\t\t\tdesc_read_cb, desc);\n\tif (!desc->read_op)\n\t\treturn btd_error_failed(msg, \"Failed to send read request\");\n\n\treturn NULL;\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "btd_error_failed",
          "args": [
            "msg",
            "\"Failed to send read request\""
          ],
          "line": 484
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "124-128",
          "snippet": "DBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "read_value",
          "args": [
            "gatt",
            "msg",
            "desc->handle",
            "offset",
            "desc_read_cb",
            "desc"
          ],
          "line": 481
        },
        "resolved": true,
        "details": {
          "function_name": "read_value",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "436-456",
          "snippet": "static struct async_dbus_op *read_value(struct bt_gatt_client *gatt,\n\t\t\t\t\tDBusMessage *msg, uint16_t handle,\n\t\t\t\t\tuint16_t offset,\n\t\t\t\t\tbt_gatt_client_read_callback_t callback,\n\t\t\t\t\tvoid *data)\n{\n\tstruct async_dbus_op *op;\n\n\top = async_dbus_op_new(msg, data);\n\top->offset = offset;\n\n\top->id = bt_gatt_client_read_long_value(gatt, handle, offset, callback,\n\t\t\t\t\t\tasync_dbus_op_ref(op),\n\t\t\t\t\t\tasync_dbus_op_unref);\n\tif (op->id)\n\t\treturn op;\n\n\tasync_dbus_op_free(op);\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic struct async_dbus_op *read_value(struct bt_gatt_client *gatt,\n\t\t\t\t\tDBusMessage *msg, uint16_t handle,\n\t\t\t\t\tuint16_t offset,\n\t\t\t\t\tbt_gatt_client_read_callback_t callback,\n\t\t\t\t\tvoid *data)\n{\n\tstruct async_dbus_op *op;\n\n\top = async_dbus_op_new(msg, data);\n\top->offset = offset;\n\n\top->id = bt_gatt_client_read_long_value(gatt, handle, offset, callback,\n\t\t\t\t\t\tasync_dbus_op_ref(op),\n\t\t\t\t\t\tasync_dbus_op_unref);\n\tif (op->id)\n\t\treturn op;\n\n\tasync_dbus_op_free(op);\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_push_tail",
          "args": [
            "desc->read_op->msgs",
            "dbus_message_ref(msg)"
          ],
          "line": 477
        },
        "resolved": true,
        "details": {
          "function_name": "queue_push_tail",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "88-108",
          "snippet": "bool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_ref",
          "args": [
            "msg"
          ],
          "line": 477
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_error_in_progress",
          "args": [
            "msg"
          ],
          "line": 476
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_in_progress",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "76-80",
          "snippet": "DBusMessage *btd_error_in_progress(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".InProgress\",\n\t\t\t\t\t\"In Progress\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_in_progress(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".InProgress\",\n\t\t\t\t\t\"In Progress\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_error_invalid_args",
          "args": [
            "msg"
          ],
          "line": 472
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_invalid_args",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "34-38",
          "snippet": "DBusMessage *btd_error_invalid_args(DBusMessage *msg)\n{\n\treturn btd_error_invalid_args_str(msg,\n\t\t\t\t\t\"Invalid arguments in method call\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_invalid_args(DBusMessage *msg)\n{\n\treturn btd_error_invalid_args_str(msg,\n\t\t\t\t\t\"Invalid arguments in method call\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "parse_options",
          "args": [
            "&iter",
            "&offset"
          ],
          "line": 471
        },
        "resolved": true,
        "details": {
          "function_name": "parse_options",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "391-422",
          "snippet": "static int parse_options(DBusMessageIter *iter, uint16_t *offset)\n{\n\tDBusMessageIter dict;\n\n\tif (dbus_message_iter_get_arg_type(iter) != DBUS_TYPE_ARRAY)\n\t\treturn -EINVAL;\n\n\tdbus_message_iter_recurse(iter, &dict);\n\n\twhile (dbus_message_iter_get_arg_type(&dict) == DBUS_TYPE_DICT_ENTRY) {\n\t\tconst char *key;\n\t\tDBusMessageIter value, entry;\n\t\tint var;\n\n\t\tdbus_message_iter_recurse(&dict, &entry);\n\t\tdbus_message_iter_get_basic(&entry, &key);\n\n\t\tdbus_message_iter_next(&entry);\n\t\tdbus_message_iter_recurse(&entry, &value);\n\n\t\tvar = dbus_message_iter_get_arg_type(&value);\n\t\tif (strcasecmp(key, \"offset\") == 0) {\n\t\t\tif (var != DBUS_TYPE_UINT16)\n\t\t\t\treturn -EINVAL;\n\t\t\tdbus_message_iter_get_basic(&value, offset);\n\t\t}\n\n\t\tdbus_message_iter_next(&dict);\n\t}\n\n\treturn 0;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic int parse_options(DBusMessageIter *iter, uint16_t *offset)\n{\n\tDBusMessageIter dict;\n\n\tif (dbus_message_iter_get_arg_type(iter) != DBUS_TYPE_ARRAY)\n\t\treturn -EINVAL;\n\n\tdbus_message_iter_recurse(iter, &dict);\n\n\twhile (dbus_message_iter_get_arg_type(&dict) == DBUS_TYPE_DICT_ENTRY) {\n\t\tconst char *key;\n\t\tDBusMessageIter value, entry;\n\t\tint var;\n\n\t\tdbus_message_iter_recurse(&dict, &entry);\n\t\tdbus_message_iter_get_basic(&entry, &key);\n\n\t\tdbus_message_iter_next(&entry);\n\t\tdbus_message_iter_recurse(&entry, &value);\n\n\t\tvar = dbus_message_iter_get_arg_type(&value);\n\t\tif (strcasecmp(key, \"offset\") == 0) {\n\t\t\tif (var != DBUS_TYPE_UINT16)\n\t\t\t\treturn -EINVAL;\n\t\t\tdbus_message_iter_get_basic(&value, offset);\n\t\t}\n\n\t\tdbus_message_iter_next(&dict);\n\t}\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_init",
          "args": [
            "msg",
            "&iter"
          ],
          "line": 469
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic DBusMessage *descriptor_read_value(DBusConnection *conn,\n\t\t\t\t\tDBusMessage *msg, void *user_data)\n{\n\tstruct descriptor *desc = user_data;\n\tstruct bt_gatt_client *gatt = desc->chrc->service->client->gatt;\n\tDBusMessageIter iter;\n\tuint16_t offset = 0;\n\n\tif (!gatt)\n\t\treturn btd_error_failed(msg, \"Not connected\");\n\n\tdbus_message_iter_init(msg, &iter);\n\n\tif (parse_options(&iter, &offset))\n\t\treturn btd_error_invalid_args(msg);\n\n\tif (desc->read_op) {\n\t\tif (desc->read_op->offset != offset)\n\t\t\treturn btd_error_in_progress(msg);\n\t\tqueue_push_tail(desc->read_op->msgs, dbus_message_ref(msg));\n\t\treturn NULL;\n\t}\n\n\tdesc->read_op = read_value(gatt, msg, desc->handle, offset,\n\t\t\t\t\t\t\tdesc_read_cb, desc);\n\tif (!desc->read_op)\n\t\treturn btd_error_failed(msg, \"Failed to send read request\");\n\n\treturn NULL;\n}"
  },
  {
    "function_name": "read_value",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "436-456",
    "snippet": "static struct async_dbus_op *read_value(struct bt_gatt_client *gatt,\n\t\t\t\t\tDBusMessage *msg, uint16_t handle,\n\t\t\t\t\tuint16_t offset,\n\t\t\t\t\tbt_gatt_client_read_callback_t callback,\n\t\t\t\t\tvoid *data)\n{\n\tstruct async_dbus_op *op;\n\n\top = async_dbus_op_new(msg, data);\n\top->offset = offset;\n\n\top->id = bt_gatt_client_read_long_value(gatt, handle, offset, callback,\n\t\t\t\t\t\tasync_dbus_op_ref(op),\n\t\t\t\t\t\tasync_dbus_op_unref);\n\tif (op->id)\n\t\treturn op;\n\n\tasync_dbus_op_free(op);\n\n\treturn NULL;\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "async_dbus_op_free",
          "args": [
            "op"
          ],
          "line": 453
        },
        "resolved": true,
        "details": {
          "function_name": "async_dbus_op_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "235-242",
          "snippet": "static void async_dbus_op_free(void *data)\n{\n\tstruct async_dbus_op *op = data;\n\n\tqueue_destroy(op->msgs, (void *)dbus_message_unref);\n\n\tfree(op);\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void async_dbus_op_free(void *data)\n{\n\tstruct async_dbus_op *op = data;\n\n\tqueue_destroy(op->msgs, (void *)dbus_message_unref);\n\n\tfree(op);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_gatt_client_read_long_value",
          "args": [
            "gatt",
            "handle",
            "offset",
            "callback",
            "async_dbus_op_ref(op)",
            "async_dbus_op_unref"
          ],
          "line": 447
        },
        "resolved": true,
        "details": {
          "function_name": "bt_gatt_client_read_long_value",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-client.c",
          "lines": "2487-2554",
          "snippet": "unsigned int bt_gatt_client_read_long_value(struct bt_gatt_client *client,\n\t\t\t\t\tuint16_t value_handle, uint16_t offset,\n\t\t\t\t\tbt_gatt_client_read_callback_t callback,\n\t\t\t\t\tvoid *user_data,\n\t\t\t\t\tbt_gatt_client_destroy_func_t destroy)\n{\n\tstruct request *req;\n\tstruct read_long_op *op;\n\tuint8_t att_op;\n\tuint8_t pdu[4];\n\tuint16_t pdu_len;\n\n\tif (!client)\n\t\treturn 0;\n\n\top = new0(struct read_long_op, 1);\n\n\treq = request_create(client);\n\tif (!req) {\n\t\tfree(op);\n\t\treturn 0;\n\t}\n\n\top->client = client;\n\top->value_handle = value_handle;\n\top->offset = offset;\n\top->callback = callback;\n\top->user_data = user_data;\n\top->destroy = destroy;\n\n\treq->data = op;\n\treq->destroy = destroy_read_long_op;\n\n\tput_le16(value_handle, pdu);\n\tpdu_len = sizeof(value_handle);\n\n\t/*\n\t * Core v4.2, part F, section 1.3.4.4.5:\n\t * If the attribute value has a fixed length that is less than or equal\n\t * to (ATT_MTU - 3) octets in length, then an Error Response can be sent\n\t * with the error code Attribute Not Long.\n\t *\n\t * To remove need for caller to handle \"Attribute Not Long\" error when\n\t * reading characteristics with short values, use Read Request for\n\t * reading first part of characteristics value instead of Read Blob\n\t * Request. Both are allowed in this case.\n\t */\n\n\tif (op->offset) {\n\t\tatt_op = BT_ATT_OP_READ_BLOB_REQ;\n\t\tpdu_len += sizeof(op->offset);\n\n\t\tput_le16(op->offset, pdu + 2);\n\t} else {\n\t\tatt_op = BT_ATT_OP_READ_REQ;\n\t}\n\n\treq->att_id = bt_att_send(client->att, att_op, pdu, pdu_len,\n\t\t\t\t\tread_long_cb, req, request_unref);\n\n\tif (!req->att_id) {\n\t\top->destroy = NULL;\n\t\trequest_unref(req);\n\t\treturn 0;\n\t}\n\n\treturn req->id;\n}",
          "includes": [
            "#include <sys/uio.h>",
            "#include <limits.h>",
            "#include <assert.h>",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-helpers.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/att.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void discover_chrcs_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\t\tstruct bt_gatt_result *result,\n\t\t\t\t\t\tvoid *user_data);",
            "static void discover_descs_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\t\tstruct bt_gatt_result *result,\n\t\t\t\t\t\tvoid *user_data);",
            "static void ext_prop_read_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\tconst uint8_t *value, uint16_t length,\n\t\t\t\t\tvoid *user_data);",
            "static void service_changed_cb(uint16_t value_handle, const uint8_t *value,\n\t\t\t\t\tuint16_t length, void *user_data);",
            "static void prepare_write_cb(uint8_t opcode, const void *pdu, uint16_t length,\n\t\t\t\t\t\t\tvoid *user_data);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <sys/uio.h>\n#include <limits.h>\n#include <assert.h>\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-helpers.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/att.h\"\n#include <config.h>\n\nstatic void discover_chrcs_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\t\tstruct bt_gatt_result *result,\n\t\t\t\t\t\tvoid *user_data);\nstatic void discover_descs_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\t\tstruct bt_gatt_result *result,\n\t\t\t\t\t\tvoid *user_data);\nstatic void ext_prop_read_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\tconst uint8_t *value, uint16_t length,\n\t\t\t\t\tvoid *user_data);\nstatic void service_changed_cb(uint16_t value_handle, const uint8_t *value,\n\t\t\t\t\tuint16_t length, void *user_data);\nstatic void prepare_write_cb(uint8_t opcode, const void *pdu, uint16_t length,\n\t\t\t\t\t\t\tvoid *user_data);\n\nunsigned int bt_gatt_client_read_long_value(struct bt_gatt_client *client,\n\t\t\t\t\tuint16_t value_handle, uint16_t offset,\n\t\t\t\t\tbt_gatt_client_read_callback_t callback,\n\t\t\t\t\tvoid *user_data,\n\t\t\t\t\tbt_gatt_client_destroy_func_t destroy)\n{\n\tstruct request *req;\n\tstruct read_long_op *op;\n\tuint8_t att_op;\n\tuint8_t pdu[4];\n\tuint16_t pdu_len;\n\n\tif (!client)\n\t\treturn 0;\n\n\top = new0(struct read_long_op, 1);\n\n\treq = request_create(client);\n\tif (!req) {\n\t\tfree(op);\n\t\treturn 0;\n\t}\n\n\top->client = client;\n\top->value_handle = value_handle;\n\top->offset = offset;\n\top->callback = callback;\n\top->user_data = user_data;\n\top->destroy = destroy;\n\n\treq->data = op;\n\treq->destroy = destroy_read_long_op;\n\n\tput_le16(value_handle, pdu);\n\tpdu_len = sizeof(value_handle);\n\n\t/*\n\t * Core v4.2, part F, section 1.3.4.4.5:\n\t * If the attribute value has a fixed length that is less than or equal\n\t * to (ATT_MTU - 3) octets in length, then an Error Response can be sent\n\t * with the error code Attribute Not Long.\n\t *\n\t * To remove need for caller to handle \"Attribute Not Long\" error when\n\t * reading characteristics with short values, use Read Request for\n\t * reading first part of characteristics value instead of Read Blob\n\t * Request. Both are allowed in this case.\n\t */\n\n\tif (op->offset) {\n\t\tatt_op = BT_ATT_OP_READ_BLOB_REQ;\n\t\tpdu_len += sizeof(op->offset);\n\n\t\tput_le16(op->offset, pdu + 2);\n\t} else {\n\t\tatt_op = BT_ATT_OP_READ_REQ;\n\t}\n\n\treq->att_id = bt_att_send(client->att, att_op, pdu, pdu_len,\n\t\t\t\t\tread_long_cb, req, request_unref);\n\n\tif (!req->att_id) {\n\t\top->destroy = NULL;\n\t\trequest_unref(req);\n\t\treturn 0;\n\t}\n\n\treturn req->id;\n}"
        }
      },
      {
        "call_info": {
          "callee": "async_dbus_op_ref",
          "args": [
            "op"
          ],
          "line": 448
        },
        "resolved": true,
        "details": {
          "function_name": "async_dbus_op_ref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "244-249",
          "snippet": "static struct async_dbus_op *async_dbus_op_ref(struct async_dbus_op *op)\n{\n\t__sync_fetch_and_add(&op->ref_count, 1);\n\n\treturn op;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic struct async_dbus_op *async_dbus_op_ref(struct async_dbus_op *op)\n{\n\t__sync_fetch_and_add(&op->ref_count, 1);\n\n\treturn op;\n}"
        }
      },
      {
        "call_info": {
          "callee": "async_dbus_op_new",
          "args": [
            "msg",
            "data"
          ],
          "line": 444
        },
        "resolved": true,
        "details": {
          "function_name": "async_dbus_op_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "424-434",
          "snippet": "static struct async_dbus_op *async_dbus_op_new(DBusMessage *msg, void *data)\n{\n\tstruct async_dbus_op *op;\n\n\top = new0(struct async_dbus_op, 1);\n\top->msgs = queue_new();\n\tqueue_push_tail(op->msgs, dbus_message_ref(msg));\n\top->data = data;\n\n\treturn op;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic struct async_dbus_op *async_dbus_op_new(DBusMessage *msg, void *data)\n{\n\tstruct async_dbus_op *op;\n\n\top = new0(struct async_dbus_op, 1);\n\top->msgs = queue_new();\n\tqueue_push_tail(op->msgs, dbus_message_ref(msg));\n\top->data = data;\n\n\treturn op;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic struct async_dbus_op *read_value(struct bt_gatt_client *gatt,\n\t\t\t\t\tDBusMessage *msg, uint16_t handle,\n\t\t\t\t\tuint16_t offset,\n\t\t\t\t\tbt_gatt_client_read_callback_t callback,\n\t\t\t\t\tvoid *data)\n{\n\tstruct async_dbus_op *op;\n\n\top = async_dbus_op_new(msg, data);\n\top->offset = offset;\n\n\top->id = bt_gatt_client_read_long_value(gatt, handle, offset, callback,\n\t\t\t\t\t\tasync_dbus_op_ref(op),\n\t\t\t\t\t\tasync_dbus_op_unref);\n\tif (op->id)\n\t\treturn op;\n\n\tasync_dbus_op_free(op);\n\n\treturn NULL;\n}"
  },
  {
    "function_name": "async_dbus_op_new",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "424-434",
    "snippet": "static struct async_dbus_op *async_dbus_op_new(DBusMessage *msg, void *data)\n{\n\tstruct async_dbus_op *op;\n\n\top = new0(struct async_dbus_op, 1);\n\top->msgs = queue_new();\n\tqueue_push_tail(op->msgs, dbus_message_ref(msg));\n\top->data = data;\n\n\treturn op;\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_push_tail",
          "args": [
            "op->msgs",
            "dbus_message_ref(msg)"
          ],
          "line": 430
        },
        "resolved": true,
        "details": {
          "function_name": "queue_push_tail",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "88-108",
          "snippet": "bool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_ref",
          "args": [
            "msg"
          ],
          "line": 430
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "queue_new",
          "args": [],
          "line": 429
        },
        "resolved": true,
        "details": {
          "function_name": "queue_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "56-66",
          "snippet": "struct queue *queue_new(void)\n{\n\tstruct queue *queue;\n\n\tqueue = new0(struct queue, 1);\n\tqueue->head = NULL;\n\tqueue->tail = NULL;\n\tqueue->entries = 0;\n\n\treturn queue_ref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nstruct queue *queue_new(void)\n{\n\tstruct queue *queue;\n\n\tqueue = new0(struct queue, 1);\n\tqueue->head = NULL;\n\tqueue->tail = NULL;\n\tqueue->entries = 0;\n\n\treturn queue_ref(queue);\n}"
        }
      },
      {
        "call_info": {
          "callee": "new0",
          "args": [
            "structasync_dbus_op",
            "1"
          ],
          "line": 428
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic struct async_dbus_op *async_dbus_op_new(DBusMessage *msg, void *data)\n{\n\tstruct async_dbus_op *op;\n\n\top = new0(struct async_dbus_op, 1);\n\top->msgs = queue_new();\n\tqueue_push_tail(op->msgs, dbus_message_ref(msg));\n\top->data = data;\n\n\treturn op;\n}"
  },
  {
    "function_name": "parse_options",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "391-422",
    "snippet": "static int parse_options(DBusMessageIter *iter, uint16_t *offset)\n{\n\tDBusMessageIter dict;\n\n\tif (dbus_message_iter_get_arg_type(iter) != DBUS_TYPE_ARRAY)\n\t\treturn -EINVAL;\n\n\tdbus_message_iter_recurse(iter, &dict);\n\n\twhile (dbus_message_iter_get_arg_type(&dict) == DBUS_TYPE_DICT_ENTRY) {\n\t\tconst char *key;\n\t\tDBusMessageIter value, entry;\n\t\tint var;\n\n\t\tdbus_message_iter_recurse(&dict, &entry);\n\t\tdbus_message_iter_get_basic(&entry, &key);\n\n\t\tdbus_message_iter_next(&entry);\n\t\tdbus_message_iter_recurse(&entry, &value);\n\n\t\tvar = dbus_message_iter_get_arg_type(&value);\n\t\tif (strcasecmp(key, \"offset\") == 0) {\n\t\t\tif (var != DBUS_TYPE_UINT16)\n\t\t\t\treturn -EINVAL;\n\t\t\tdbus_message_iter_get_basic(&value, offset);\n\t\t}\n\n\t\tdbus_message_iter_next(&dict);\n\t}\n\n\treturn 0;\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_iter_next",
          "args": [
            "&dict"
          ],
          "line": 418
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_basic",
          "args": [
            "&value",
            "offset"
          ],
          "line": 415
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcasecmp",
          "args": [
            "key",
            "\"offset\""
          ],
          "line": 412
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_arg_type",
          "args": [
            "&value"
          ],
          "line": 411
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_recurse",
          "args": [
            "&entry",
            "&value"
          ],
          "line": 409
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_next",
          "args": [
            "&entry"
          ],
          "line": 408
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_basic",
          "args": [
            "&entry",
            "&key"
          ],
          "line": 406
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_recurse",
          "args": [
            "&dict",
            "&entry"
          ],
          "line": 405
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_arg_type",
          "args": [
            "&dict"
          ],
          "line": 400
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_recurse",
          "args": [
            "iter",
            "&dict"
          ],
          "line": 398
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_arg_type",
          "args": [
            "iter"
          ],
          "line": 395
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic int parse_options(DBusMessageIter *iter, uint16_t *offset)\n{\n\tDBusMessageIter dict;\n\n\tif (dbus_message_iter_get_arg_type(iter) != DBUS_TYPE_ARRAY)\n\t\treturn -EINVAL;\n\n\tdbus_message_iter_recurse(iter, &dict);\n\n\twhile (dbus_message_iter_get_arg_type(&dict) == DBUS_TYPE_DICT_ENTRY) {\n\t\tconst char *key;\n\t\tDBusMessageIter value, entry;\n\t\tint var;\n\n\t\tdbus_message_iter_recurse(&dict, &entry);\n\t\tdbus_message_iter_get_basic(&entry, &key);\n\n\t\tdbus_message_iter_next(&entry);\n\t\tdbus_message_iter_recurse(&entry, &value);\n\n\t\tvar = dbus_message_iter_get_arg_type(&value);\n\t\tif (strcasecmp(key, \"offset\") == 0) {\n\t\t\tif (var != DBUS_TYPE_UINT16)\n\t\t\t\treturn -EINVAL;\n\t\t\tdbus_message_iter_get_basic(&value, offset);\n\t\t}\n\n\t\tdbus_message_iter_next(&dict);\n\t}\n\n\treturn 0;\n}"
  },
  {
    "function_name": "desc_read_cb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "355-389",
    "snippet": "static void desc_read_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\tconst uint8_t *value, uint16_t length,\n\t\t\t\t\tvoid *user_data)\n{\n\tstruct async_dbus_op *op = user_data;\n\tstruct descriptor *desc = op->data;\n\n\tif (!success)\n\t\tgoto fail;\n\n\tif (!op->offset)\n\t\tgatt_db_attribute_reset(desc->attr);\n\n\tif (!gatt_db_attribute_write(desc->attr, op->offset, value, length, 0,\n\t\t\t\t\tNULL, write_descriptor_cb, desc)) {\n\t\terror(\"Failed to store attribute\");\n\t\tatt_ecode = BT_ATT_ERROR_UNLIKELY;\n\t\tgoto fail;\n\t}\n\n\t/* Read the stored data from db */\n\tif (!gatt_db_attribute_read(desc->attr, 0, 0, NULL, read_op_cb, op)) {\n\t\terror(\"Failed to read database\");\n\t\tatt_ecode = BT_ATT_ERROR_UNLIKELY;\n\t\tgoto fail;\n\t}\n\n\tdesc->read_op = NULL;\n\n\treturn;\n\nfail:\n\tasync_dbus_op_reply(op, att_ecode, NULL, 0);\n\tdesc->read_op = NULL;\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "async_dbus_op_reply",
          "args": [
            "op",
            "att_ecode",
            "NULL",
            "0"
          ],
          "line": 387
        },
        "resolved": true,
        "details": {
          "function_name": "async_dbus_op_reply",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "315-344",
          "snippet": "static void async_dbus_op_reply(struct async_dbus_op *op, int err,\n\t\t\t\tconst uint8_t *value, ssize_t length)\n{\n\tconst struct queue_entry *entry;\n\tDBusMessage *reply;\n\n\top->id = 0;\n\n\tfor (entry = queue_get_entries(op->msgs); entry; entry = entry->next) {\n\t\tDBusMessage *msg = entry->data;\n\n\t\tif (err) {\n\t\t\treply = err > 0 ? create_gatt_dbus_error(msg, err) :\n\t\t\t\tbtd_error_failed(msg, strerror(-err));\n\t\t\tgoto send_reply;\n\t\t}\n\n\t\treply = g_dbus_create_reply(msg, DBUS_TYPE_INVALID);\n\t\tif (!reply) {\n\t\t\terror(\"Failed to allocate D-Bus message reply\");\n\t\t\treturn;\n\t\t}\n\n\t\tif (length >= 0)\n\t\t\tmessage_append_byte_array(reply, value, length);\n\nsend_reply:\n\t\tg_dbus_send_message(btd_get_dbus_connection(), reply);\n\t}\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void async_dbus_op_reply(struct async_dbus_op *op, int err,\n\t\t\t\tconst uint8_t *value, ssize_t length)\n{\n\tconst struct queue_entry *entry;\n\tDBusMessage *reply;\n\n\top->id = 0;\n\n\tfor (entry = queue_get_entries(op->msgs); entry; entry = entry->next) {\n\t\tDBusMessage *msg = entry->data;\n\n\t\tif (err) {\n\t\t\treply = err > 0 ? create_gatt_dbus_error(msg, err) :\n\t\t\t\tbtd_error_failed(msg, strerror(-err));\n\t\t\tgoto send_reply;\n\t\t}\n\n\t\treply = g_dbus_create_reply(msg, DBUS_TYPE_INVALID);\n\t\tif (!reply) {\n\t\t\terror(\"Failed to allocate D-Bus message reply\");\n\t\t\treturn;\n\t\t}\n\n\t\tif (length >= 0)\n\t\t\tmessage_append_byte_array(reply, value, length);\n\nsend_reply:\n\t\tg_dbus_send_message(btd_get_dbus_connection(), reply);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Failed to read database\""
          ],
          "line": 377
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_not_ready",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "118-122",
          "snippet": "DBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_attribute_read",
          "args": [
            "desc->attr",
            "0",
            "0",
            "NULL",
            "read_op_cb",
            "op"
          ],
          "line": 376
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_read",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1724-1763",
          "snippet": "bool gatt_db_attribute_read(struct gatt_db_attribute *attrib, uint16_t offset,\n\t\t\t\tuint8_t opcode, struct bt_att *att,\n\t\t\t\tgatt_db_attribute_read_t func, void *user_data)\n{\n\tuint8_t *value;\n\n\tif (!attrib || !func)\n\t\treturn false;\n\n\tif (attrib->read_func) {\n\t\tstruct pending_read *p;\n\n\t\tp = new0(struct pending_read, 1);\n\t\tp->attrib = attrib;\n\t\tp->id = ++attrib->read_id;\n\t\tp->timeout_id = timeout_add(ATTRIBUTE_TIMEOUT, read_timeout,\n\t\t\t\t\t\t\t\tp, NULL);\n\t\tp->func = func;\n\t\tp->user_data = user_data;\n\n\t\tqueue_push_tail(attrib->pending_reads, p);\n\n\t\tattrib->read_func(attrib, p->id, offset, opcode, att,\n\t\t\t\t\t\t\tattrib->user_data);\n\t\treturn true;\n\t}\n\n\t/* Check boundary if value is stored in the db */\n\tif (offset > attrib->value_len) {\n\t\tfunc(attrib, BT_ATT_ERROR_INVALID_OFFSET, NULL, 0, user_data);\n\t\treturn true;\n\t}\n\n\t/* Guard against invalid access if offset equals to value length */\n\tvalue = offset == attrib->value_len ? NULL : &attrib->value[offset];\n\n\tfunc(attrib, 0, value, attrib->value_len - offset, user_data);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define ATTRIBUTE_TIMEOUT 5000"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\n#define ATTRIBUTE_TIMEOUT 5000\n\nbool gatt_db_attribute_read(struct gatt_db_attribute *attrib, uint16_t offset,\n\t\t\t\tuint8_t opcode, struct bt_att *att,\n\t\t\t\tgatt_db_attribute_read_t func, void *user_data)\n{\n\tuint8_t *value;\n\n\tif (!attrib || !func)\n\t\treturn false;\n\n\tif (attrib->read_func) {\n\t\tstruct pending_read *p;\n\n\t\tp = new0(struct pending_read, 1);\n\t\tp->attrib = attrib;\n\t\tp->id = ++attrib->read_id;\n\t\tp->timeout_id = timeout_add(ATTRIBUTE_TIMEOUT, read_timeout,\n\t\t\t\t\t\t\t\tp, NULL);\n\t\tp->func = func;\n\t\tp->user_data = user_data;\n\n\t\tqueue_push_tail(attrib->pending_reads, p);\n\n\t\tattrib->read_func(attrib, p->id, offset, opcode, att,\n\t\t\t\t\t\t\tattrib->user_data);\n\t\treturn true;\n\t}\n\n\t/* Check boundary if value is stored in the db */\n\tif (offset > attrib->value_len) {\n\t\tfunc(attrib, BT_ATT_ERROR_INVALID_OFFSET, NULL, 0, user_data);\n\t\treturn true;\n\t}\n\n\t/* Guard against invalid access if offset equals to value length */\n\tvalue = offset == attrib->value_len ? NULL : &attrib->value[offset];\n\n\tfunc(attrib, 0, value, attrib->value_len - offset, user_data);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_attribute_write",
          "args": [
            "desc->attr",
            "op->offset",
            "value",
            "length",
            "0",
            "NULL",
            "write_descriptor_cb",
            "desc"
          ],
          "line": 368
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_write",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1805-1860",
          "snippet": "bool gatt_db_attribute_write(struct gatt_db_attribute *attrib, uint16_t offset,\n\t\t\t\t\tconst uint8_t *value, size_t len,\n\t\t\t\t\tuint8_t opcode, struct bt_att *att,\n\t\t\t\t\tgatt_db_attribute_write_t func,\n\t\t\t\t\tvoid *user_data)\n{\n\tif (!attrib || !func)\n\t\treturn false;\n\n\tif (attrib->write_func) {\n\t\tstruct pending_write *p;\n\n\t\tp = new0(struct pending_write, 1);\n\t\tp->attrib = attrib;\n\t\tp->id = ++attrib->write_id;\n\t\tp->timeout_id = timeout_add(ATTRIBUTE_TIMEOUT, write_timeout,\n\t\t\t\t\t\t\t\tp, NULL);\n\t\tp->func = func;\n\t\tp->user_data = user_data;\n\n\t\tqueue_push_tail(attrib->pending_writes, p);\n\n\t\tattrib->write_func(attrib, p->id, offset, value, len, opcode,\n\t\t\t\t\t\t\tatt, attrib->user_data);\n\t\treturn true;\n\t}\n\n\t/* Nothing to write just skip */\n\tif (len == 0)\n\t\tgoto done;\n\n\t/* For values stored in db allocate on demand */\n\tif (!attrib->value || offset >= attrib->value_len ||\n\t\t\t\tlen > (unsigned) (attrib->value_len - offset)) {\n\t\tvoid *buf;\n\n\t\tbuf = realloc(attrib->value, len + offset);\n\t\tif (!buf)\n\t\t\treturn false;\n\n\t\tattrib->value = buf;\n\n\t\t/* Init data in the first allocation */\n\t\tif (!attrib->value_len)\n\t\t\tmemset(attrib->value, 0, offset);\n\n\t\tattrib->value_len = len + offset;\n\t}\n\n\tmemcpy(&attrib->value[offset], value, len);\n\ndone:\n\tfunc(attrib, 0, user_data);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define ATTRIBUTE_TIMEOUT 5000"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\n#define ATTRIBUTE_TIMEOUT 5000\n\nbool gatt_db_attribute_write(struct gatt_db_attribute *attrib, uint16_t offset,\n\t\t\t\t\tconst uint8_t *value, size_t len,\n\t\t\t\t\tuint8_t opcode, struct bt_att *att,\n\t\t\t\t\tgatt_db_attribute_write_t func,\n\t\t\t\t\tvoid *user_data)\n{\n\tif (!attrib || !func)\n\t\treturn false;\n\n\tif (attrib->write_func) {\n\t\tstruct pending_write *p;\n\n\t\tp = new0(struct pending_write, 1);\n\t\tp->attrib = attrib;\n\t\tp->id = ++attrib->write_id;\n\t\tp->timeout_id = timeout_add(ATTRIBUTE_TIMEOUT, write_timeout,\n\t\t\t\t\t\t\t\tp, NULL);\n\t\tp->func = func;\n\t\tp->user_data = user_data;\n\n\t\tqueue_push_tail(attrib->pending_writes, p);\n\n\t\tattrib->write_func(attrib, p->id, offset, value, len, opcode,\n\t\t\t\t\t\t\tatt, attrib->user_data);\n\t\treturn true;\n\t}\n\n\t/* Nothing to write just skip */\n\tif (len == 0)\n\t\tgoto done;\n\n\t/* For values stored in db allocate on demand */\n\tif (!attrib->value || offset >= attrib->value_len ||\n\t\t\t\tlen > (unsigned) (attrib->value_len - offset)) {\n\t\tvoid *buf;\n\n\t\tbuf = realloc(attrib->value, len + offset);\n\t\tif (!buf)\n\t\t\treturn false;\n\n\t\tattrib->value = buf;\n\n\t\t/* Init data in the first allocation */\n\t\tif (!attrib->value_len)\n\t\t\tmemset(attrib->value, 0, offset);\n\n\t\tattrib->value_len = len + offset;\n\t}\n\n\tmemcpy(&attrib->value[offset], value, len);\n\ndone:\n\tfunc(attrib, 0, user_data);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_attribute_reset",
          "args": [
            "desc->attr"
          ],
          "line": 366
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_reset",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1880-1893",
          "snippet": "bool gatt_db_attribute_reset(struct gatt_db_attribute *attrib)\n{\n\tif (!attrib)\n\t\treturn false;\n\n\tif (!attrib->value || !attrib->value_len)\n\t\treturn true;\n\n\tfree(attrib->value);\n\tattrib->value = NULL;\n\tattrib->value_len = 0;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_attribute_reset(struct gatt_db_attribute *attrib)\n{\n\tif (!attrib)\n\t\treturn false;\n\n\tif (!attrib->value || !attrib->value_len)\n\t\treturn true;\n\n\tfree(attrib->value);\n\tattrib->value = NULL;\n\tattrib->value_len = 0;\n\n\treturn true;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void desc_read_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\tconst uint8_t *value, uint16_t length,\n\t\t\t\t\tvoid *user_data)\n{\n\tstruct async_dbus_op *op = user_data;\n\tstruct descriptor *desc = op->data;\n\n\tif (!success)\n\t\tgoto fail;\n\n\tif (!op->offset)\n\t\tgatt_db_attribute_reset(desc->attr);\n\n\tif (!gatt_db_attribute_write(desc->attr, op->offset, value, length, 0,\n\t\t\t\t\tNULL, write_descriptor_cb, desc)) {\n\t\terror(\"Failed to store attribute\");\n\t\tatt_ecode = BT_ATT_ERROR_UNLIKELY;\n\t\tgoto fail;\n\t}\n\n\t/* Read the stored data from db */\n\tif (!gatt_db_attribute_read(desc->attr, 0, 0, NULL, read_op_cb, op)) {\n\t\terror(\"Failed to read database\");\n\t\tatt_ecode = BT_ATT_ERROR_UNLIKELY;\n\t\tgoto fail;\n\t}\n\n\tdesc->read_op = NULL;\n\n\treturn;\n\nfail:\n\tasync_dbus_op_reply(op, att_ecode, NULL, 0);\n\tdesc->read_op = NULL;\n}"
  },
  {
    "function_name": "read_op_cb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "346-353",
    "snippet": "static void read_op_cb(struct gatt_db_attribute *attrib, int err,\n\t\t\t\tconst uint8_t *value, size_t length,\n\t\t\t\tvoid *user_data)\n{\n\tstruct async_dbus_op *op = user_data;\n\n\tasync_dbus_op_reply(op, err, value, length);\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "async_dbus_op_reply",
          "args": [
            "op",
            "err",
            "value",
            "length"
          ],
          "line": 352
        },
        "resolved": true,
        "details": {
          "function_name": "async_dbus_op_reply",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "315-344",
          "snippet": "static void async_dbus_op_reply(struct async_dbus_op *op, int err,\n\t\t\t\tconst uint8_t *value, ssize_t length)\n{\n\tconst struct queue_entry *entry;\n\tDBusMessage *reply;\n\n\top->id = 0;\n\n\tfor (entry = queue_get_entries(op->msgs); entry; entry = entry->next) {\n\t\tDBusMessage *msg = entry->data;\n\n\t\tif (err) {\n\t\t\treply = err > 0 ? create_gatt_dbus_error(msg, err) :\n\t\t\t\tbtd_error_failed(msg, strerror(-err));\n\t\t\tgoto send_reply;\n\t\t}\n\n\t\treply = g_dbus_create_reply(msg, DBUS_TYPE_INVALID);\n\t\tif (!reply) {\n\t\t\terror(\"Failed to allocate D-Bus message reply\");\n\t\t\treturn;\n\t\t}\n\n\t\tif (length >= 0)\n\t\t\tmessage_append_byte_array(reply, value, length);\n\nsend_reply:\n\t\tg_dbus_send_message(btd_get_dbus_connection(), reply);\n\t}\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void async_dbus_op_reply(struct async_dbus_op *op, int err,\n\t\t\t\tconst uint8_t *value, ssize_t length)\n{\n\tconst struct queue_entry *entry;\n\tDBusMessage *reply;\n\n\top->id = 0;\n\n\tfor (entry = queue_get_entries(op->msgs); entry; entry = entry->next) {\n\t\tDBusMessage *msg = entry->data;\n\n\t\tif (err) {\n\t\t\treply = err > 0 ? create_gatt_dbus_error(msg, err) :\n\t\t\t\tbtd_error_failed(msg, strerror(-err));\n\t\t\tgoto send_reply;\n\t\t}\n\n\t\treply = g_dbus_create_reply(msg, DBUS_TYPE_INVALID);\n\t\tif (!reply) {\n\t\t\terror(\"Failed to allocate D-Bus message reply\");\n\t\t\treturn;\n\t\t}\n\n\t\tif (length >= 0)\n\t\t\tmessage_append_byte_array(reply, value, length);\n\nsend_reply:\n\t\tg_dbus_send_message(btd_get_dbus_connection(), reply);\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void read_op_cb(struct gatt_db_attribute *attrib, int err,\n\t\t\t\tconst uint8_t *value, size_t length,\n\t\t\t\tvoid *user_data)\n{\n\tstruct async_dbus_op *op = user_data;\n\n\tasync_dbus_op_reply(op, err, value, length);\n}"
  },
  {
    "function_name": "async_dbus_op_reply",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "315-344",
    "snippet": "static void async_dbus_op_reply(struct async_dbus_op *op, int err,\n\t\t\t\tconst uint8_t *value, ssize_t length)\n{\n\tconst struct queue_entry *entry;\n\tDBusMessage *reply;\n\n\top->id = 0;\n\n\tfor (entry = queue_get_entries(op->msgs); entry; entry = entry->next) {\n\t\tDBusMessage *msg = entry->data;\n\n\t\tif (err) {\n\t\t\treply = err > 0 ? create_gatt_dbus_error(msg, err) :\n\t\t\t\tbtd_error_failed(msg, strerror(-err));\n\t\t\tgoto send_reply;\n\t\t}\n\n\t\treply = g_dbus_create_reply(msg, DBUS_TYPE_INVALID);\n\t\tif (!reply) {\n\t\t\terror(\"Failed to allocate D-Bus message reply\");\n\t\t\treturn;\n\t\t}\n\n\t\tif (length >= 0)\n\t\t\tmessage_append_byte_array(reply, value, length);\n\nsend_reply:\n\t\tg_dbus_send_message(btd_get_dbus_connection(), reply);\n\t}\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_dbus_send_message",
          "args": [
            "btd_get_dbus_connection()",
            "reply"
          ],
          "line": 342
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_get_dbus_connection",
          "args": [],
          "line": 342
        },
        "resolved": true,
        "details": {
          "function_name": "btd_get_dbus_connection",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/dbus-common.c",
          "lines": "61-64",
          "snippet": "DBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *connection = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *connection = NULL;\n\nDBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}"
        }
      },
      {
        "call_info": {
          "callee": "message_append_byte_array",
          "args": [
            "reply",
            "value",
            "length"
          ],
          "line": 339
        },
        "resolved": true,
        "details": {
          "function_name": "message_append_byte_array",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "261-271",
          "snippet": "static void message_append_byte_array(DBusMessage *msg, const uint8_t *bytes,\n\t\t\t\t\t\t\t\tsize_t len)\n{\n\tDBusMessageIter iter, array;\n\n\tdbus_message_iter_init_append(msg, &iter);\n\tdbus_message_iter_open_container(&iter, DBUS_TYPE_ARRAY, \"y\", &array);\n\tdbus_message_iter_append_fixed_array(&array, DBUS_TYPE_BYTE, &bytes,\n\t\t\t\t\t\t\t\t\tlen);\n\tdbus_message_iter_close_container(&iter, &array);\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void message_append_byte_array(DBusMessage *msg, const uint8_t *bytes,\n\t\t\t\t\t\t\t\tsize_t len)\n{\n\tDBusMessageIter iter, array;\n\n\tdbus_message_iter_init_append(msg, &iter);\n\tdbus_message_iter_open_container(&iter, DBUS_TYPE_ARRAY, \"y\", &array);\n\tdbus_message_iter_append_fixed_array(&array, DBUS_TYPE_BYTE, &bytes,\n\t\t\t\t\t\t\t\t\tlen);\n\tdbus_message_iter_close_container(&iter, &array);\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Failed to allocate D-Bus message reply\""
          ],
          "line": 334
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_not_ready",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "118-122",
          "snippet": "DBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_create_reply",
          "args": [
            "msg",
            "DBUS_TYPE_INVALID"
          ],
          "line": 332
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_error_failed",
          "args": [
            "msg",
            "strerror(-err)"
          ],
          "line": 328
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "124-128",
          "snippet": "DBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "strerror",
          "args": [
            "-err"
          ],
          "line": 328
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "create_gatt_dbus_error",
          "args": [
            "msg",
            "err"
          ],
          "line": 327
        },
        "resolved": true,
        "details": {
          "function_name": "create_gatt_dbus_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "273-301",
          "snippet": "static DBusMessage *create_gatt_dbus_error(DBusMessage *msg, uint8_t att_ecode)\n{\n\tswitch (att_ecode) {\n\tcase BT_ATT_ERROR_READ_NOT_PERMITTED:\n\t\treturn btd_error_not_permitted(msg, \"Read not permitted\");\n\tcase BT_ATT_ERROR_WRITE_NOT_PERMITTED:\n\t\treturn btd_error_not_permitted(msg, \"Write not permitted\");\n\tcase BT_ATT_ERROR_AUTHENTICATION:\n\tcase BT_ATT_ERROR_INSUFFICIENT_ENCRYPTION:\n\tcase BT_ATT_ERROR_INSUFFICIENT_ENCRYPTION_KEY_SIZE:\n\t\treturn btd_error_not_permitted(msg, \"Not paired\");\n\tcase BT_ATT_ERROR_INVALID_OFFSET:\n\t\treturn btd_error_invalid_args_str(msg, \"Invalid offset\");\n\tcase BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN:\n\t\treturn btd_error_invalid_args_str(msg, \"Invalid Length\");\n\tcase BT_ATT_ERROR_AUTHORIZATION:\n\t\treturn btd_error_not_authorized(msg);\n\tcase BT_ATT_ERROR_REQUEST_NOT_SUPPORTED:\n\t\treturn btd_error_not_supported(msg);\n\tcase 0:\n\t\treturn btd_error_failed(msg, \"Operation failed\");\n\tdefault:\n\t\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".Failed\",\n\t\t\t\t\"Operation failed with ATT error: 0x%02x\",\n\t\t\t\tatt_ecode);\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic DBusMessage *create_gatt_dbus_error(DBusMessage *msg, uint8_t att_ecode)\n{\n\tswitch (att_ecode) {\n\tcase BT_ATT_ERROR_READ_NOT_PERMITTED:\n\t\treturn btd_error_not_permitted(msg, \"Read not permitted\");\n\tcase BT_ATT_ERROR_WRITE_NOT_PERMITTED:\n\t\treturn btd_error_not_permitted(msg, \"Write not permitted\");\n\tcase BT_ATT_ERROR_AUTHENTICATION:\n\tcase BT_ATT_ERROR_INSUFFICIENT_ENCRYPTION:\n\tcase BT_ATT_ERROR_INSUFFICIENT_ENCRYPTION_KEY_SIZE:\n\t\treturn btd_error_not_permitted(msg, \"Not paired\");\n\tcase BT_ATT_ERROR_INVALID_OFFSET:\n\t\treturn btd_error_invalid_args_str(msg, \"Invalid offset\");\n\tcase BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN:\n\t\treturn btd_error_invalid_args_str(msg, \"Invalid Length\");\n\tcase BT_ATT_ERROR_AUTHORIZATION:\n\t\treturn btd_error_not_authorized(msg);\n\tcase BT_ATT_ERROR_REQUEST_NOT_SUPPORTED:\n\t\treturn btd_error_not_supported(msg);\n\tcase 0:\n\t\treturn btd_error_failed(msg, \"Operation failed\");\n\tdefault:\n\t\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".Failed\",\n\t\t\t\t\"Operation failed with ATT error: 0x%02x\",\n\t\t\t\tatt_ecode);\n\t}\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_get_entries",
          "args": [
            "op->msgs"
          ],
          "line": 323
        },
        "resolved": true,
        "details": {
          "function_name": "queue_get_entries",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "364-370",
          "snippet": "const struct queue_entry *queue_get_entries(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn NULL;\n\n\treturn queue->head;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nconst struct queue_entry *queue_get_entries(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn NULL;\n\n\treturn queue->head;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void async_dbus_op_reply(struct async_dbus_op *op, int err,\n\t\t\t\tconst uint8_t *value, ssize_t length)\n{\n\tconst struct queue_entry *entry;\n\tDBusMessage *reply;\n\n\top->id = 0;\n\n\tfor (entry = queue_get_entries(op->msgs); entry; entry = entry->next) {\n\t\tDBusMessage *msg = entry->data;\n\n\t\tif (err) {\n\t\t\treply = err > 0 ? create_gatt_dbus_error(msg, err) :\n\t\t\t\tbtd_error_failed(msg, strerror(-err));\n\t\t\tgoto send_reply;\n\t\t}\n\n\t\treply = g_dbus_create_reply(msg, DBUS_TYPE_INVALID);\n\t\tif (!reply) {\n\t\t\terror(\"Failed to allocate D-Bus message reply\");\n\t\t\treturn;\n\t\t}\n\n\t\tif (length >= 0)\n\t\t\tmessage_append_byte_array(reply, value, length);\n\nsend_reply:\n\t\tg_dbus_send_message(btd_get_dbus_connection(), reply);\n\t}\n}"
  },
  {
    "function_name": "write_descriptor_cb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "303-313",
    "snippet": "static void write_descriptor_cb(struct gatt_db_attribute *attr, int err,\n\t\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct descriptor *desc = user_data;\n\n\tif (err)\n\t\treturn;\n\n\tg_dbus_emit_property_changed(btd_get_dbus_connection(), desc->path,\n\t\t\t\t\tGATT_DESCRIPTOR_IFACE, \"Value\");\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define GATT_DESCRIPTOR_IFACE\t\t\"org.bluez.GattDescriptor1\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_dbus_emit_property_changed",
          "args": [
            "btd_get_dbus_connection()",
            "desc->path",
            "GATT_DESCRIPTOR_IFACE",
            "\"Value\""
          ],
          "line": 311
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_get_dbus_connection",
          "args": [],
          "line": 311
        },
        "resolved": true,
        "details": {
          "function_name": "btd_get_dbus_connection",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/dbus-common.c",
          "lines": "61-64",
          "snippet": "DBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *connection = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *connection = NULL;\n\nDBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\n#define GATT_DESCRIPTOR_IFACE\t\t\"org.bluez.GattDescriptor1\"\n\nstatic void write_descriptor_cb(struct gatt_db_attribute *attr, int err,\n\t\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct descriptor *desc = user_data;\n\n\tif (err)\n\t\treturn;\n\n\tg_dbus_emit_property_changed(btd_get_dbus_connection(), desc->path,\n\t\t\t\t\tGATT_DESCRIPTOR_IFACE, \"Value\");\n}"
  },
  {
    "function_name": "create_gatt_dbus_error",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "273-301",
    "snippet": "static DBusMessage *create_gatt_dbus_error(DBusMessage *msg, uint8_t att_ecode)\n{\n\tswitch (att_ecode) {\n\tcase BT_ATT_ERROR_READ_NOT_PERMITTED:\n\t\treturn btd_error_not_permitted(msg, \"Read not permitted\");\n\tcase BT_ATT_ERROR_WRITE_NOT_PERMITTED:\n\t\treturn btd_error_not_permitted(msg, \"Write not permitted\");\n\tcase BT_ATT_ERROR_AUTHENTICATION:\n\tcase BT_ATT_ERROR_INSUFFICIENT_ENCRYPTION:\n\tcase BT_ATT_ERROR_INSUFFICIENT_ENCRYPTION_KEY_SIZE:\n\t\treturn btd_error_not_permitted(msg, \"Not paired\");\n\tcase BT_ATT_ERROR_INVALID_OFFSET:\n\t\treturn btd_error_invalid_args_str(msg, \"Invalid offset\");\n\tcase BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN:\n\t\treturn btd_error_invalid_args_str(msg, \"Invalid Length\");\n\tcase BT_ATT_ERROR_AUTHORIZATION:\n\t\treturn btd_error_not_authorized(msg);\n\tcase BT_ATT_ERROR_REQUEST_NOT_SUPPORTED:\n\t\treturn btd_error_not_supported(msg);\n\tcase 0:\n\t\treturn btd_error_failed(msg, \"Operation failed\");\n\tdefault:\n\t\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".Failed\",\n\t\t\t\t\"Operation failed with ATT error: 0x%02x\",\n\t\t\t\tatt_ecode);\n\t}\n\n\treturn NULL;\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_dbus_create_error",
          "args": [
            "msg",
            "ERROR_INTERFACE \".Failed\"",
            "\"Operation failed with ATT error: 0x%02x\"",
            "att_ecode"
          ],
          "line": 295
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_error_failed",
          "args": [
            "msg",
            "\"Operation failed\""
          ],
          "line": 293
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "124-128",
          "snippet": "DBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_error_not_supported",
          "args": [
            "msg"
          ],
          "line": 291
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_not_supported",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "58-62",
          "snippet": "DBusMessage *btd_error_not_supported(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotSupported\",\n\t\t\t\t\t\"Operation is not supported\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_not_supported(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotSupported\",\n\t\t\t\t\t\"Operation is not supported\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_error_not_authorized",
          "args": [
            "msg"
          ],
          "line": 289
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_not_authorized",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "94-98",
          "snippet": "DBusMessage *btd_error_not_authorized(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotAuthorized\",\n\t\t\t\t\t\t\"Operation Not Authorized\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_not_authorized(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotAuthorized\",\n\t\t\t\t\t\t\"Operation Not Authorized\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_error_invalid_args_str",
          "args": [
            "msg",
            "\"Invalid Length\""
          ],
          "line": 287
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_invalid_args_str",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "40-44",
          "snippet": "DBusMessage *btd_error_invalid_args_str(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".InvalidArguments\",\n\t\t\t\t\t\"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_invalid_args_str(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".InvalidArguments\",\n\t\t\t\t\t\"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_error_not_permitted",
          "args": [
            "msg",
            "\"Not paired\""
          ],
          "line": 283
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_not_permitted",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "100-104",
          "snippet": "DBusMessage *btd_error_not_permitted(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotPermitted\",\n\t\t\t\t\t\"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_not_permitted(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotPermitted\",\n\t\t\t\t\t\"%s\", str);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic DBusMessage *create_gatt_dbus_error(DBusMessage *msg, uint8_t att_ecode)\n{\n\tswitch (att_ecode) {\n\tcase BT_ATT_ERROR_READ_NOT_PERMITTED:\n\t\treturn btd_error_not_permitted(msg, \"Read not permitted\");\n\tcase BT_ATT_ERROR_WRITE_NOT_PERMITTED:\n\t\treturn btd_error_not_permitted(msg, \"Write not permitted\");\n\tcase BT_ATT_ERROR_AUTHENTICATION:\n\tcase BT_ATT_ERROR_INSUFFICIENT_ENCRYPTION:\n\tcase BT_ATT_ERROR_INSUFFICIENT_ENCRYPTION_KEY_SIZE:\n\t\treturn btd_error_not_permitted(msg, \"Not paired\");\n\tcase BT_ATT_ERROR_INVALID_OFFSET:\n\t\treturn btd_error_invalid_args_str(msg, \"Invalid offset\");\n\tcase BT_ATT_ERROR_INVALID_ATTRIBUTE_VALUE_LEN:\n\t\treturn btd_error_invalid_args_str(msg, \"Invalid Length\");\n\tcase BT_ATT_ERROR_AUTHORIZATION:\n\t\treturn btd_error_not_authorized(msg);\n\tcase BT_ATT_ERROR_REQUEST_NOT_SUPPORTED:\n\t\treturn btd_error_not_supported(msg);\n\tcase 0:\n\t\treturn btd_error_failed(msg, \"Operation failed\");\n\tdefault:\n\t\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".Failed\",\n\t\t\t\t\"Operation failed with ATT error: 0x%02x\",\n\t\t\t\tatt_ecode);\n\t}\n\n\treturn NULL;\n}"
  },
  {
    "function_name": "message_append_byte_array",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "261-271",
    "snippet": "static void message_append_byte_array(DBusMessage *msg, const uint8_t *bytes,\n\t\t\t\t\t\t\t\tsize_t len)\n{\n\tDBusMessageIter iter, array;\n\n\tdbus_message_iter_init_append(msg, &iter);\n\tdbus_message_iter_open_container(&iter, DBUS_TYPE_ARRAY, \"y\", &array);\n\tdbus_message_iter_append_fixed_array(&array, DBUS_TYPE_BYTE, &bytes,\n\t\t\t\t\t\t\t\t\tlen);\n\tdbus_message_iter_close_container(&iter, &array);\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_iter_close_container",
          "args": [
            "&iter",
            "&array"
          ],
          "line": 270
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_append_fixed_array",
          "args": [
            "&array",
            "DBUS_TYPE_BYTE",
            "&bytes",
            "len"
          ],
          "line": 268
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_open_container",
          "args": [
            "&iter",
            "DBUS_TYPE_ARRAY",
            "\"y\"",
            "&array"
          ],
          "line": 267
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_init_append",
          "args": [
            "msg",
            "&iter"
          ],
          "line": 266
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void message_append_byte_array(DBusMessage *msg, const uint8_t *bytes,\n\t\t\t\t\t\t\t\tsize_t len)\n{\n\tDBusMessageIter iter, array;\n\n\tdbus_message_iter_init_append(msg, &iter);\n\tdbus_message_iter_open_container(&iter, DBUS_TYPE_ARRAY, \"y\", &array);\n\tdbus_message_iter_append_fixed_array(&array, DBUS_TYPE_BYTE, &bytes,\n\t\t\t\t\t\t\t\t\tlen);\n\tdbus_message_iter_close_container(&iter, &array);\n}"
  },
  {
    "function_name": "async_dbus_op_unref",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "251-259",
    "snippet": "static void async_dbus_op_unref(void *data)\n{\n\tstruct async_dbus_op *op = data;\n\n\tif (__sync_sub_and_fetch(&op->ref_count, 1))\n\t\treturn;\n\n\tasync_dbus_op_free(op);\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "async_dbus_op_free",
          "args": [
            "op"
          ],
          "line": 258
        },
        "resolved": true,
        "details": {
          "function_name": "async_dbus_op_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "235-242",
          "snippet": "static void async_dbus_op_free(void *data)\n{\n\tstruct async_dbus_op *op = data;\n\n\tqueue_destroy(op->msgs, (void *)dbus_message_unref);\n\n\tfree(op);\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void async_dbus_op_free(void *data)\n{\n\tstruct async_dbus_op *op = data;\n\n\tqueue_destroy(op->msgs, (void *)dbus_message_unref);\n\n\tfree(op);\n}"
        }
      },
      {
        "call_info": {
          "callee": "__sync_sub_and_fetch",
          "args": [
            "&op->ref_count",
            "1"
          ],
          "line": 255
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void async_dbus_op_unref(void *data)\n{\n\tstruct async_dbus_op *op = data;\n\n\tif (__sync_sub_and_fetch(&op->ref_count, 1))\n\t\treturn;\n\n\tasync_dbus_op_free(op);\n}"
  },
  {
    "function_name": "async_dbus_op_ref",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "244-249",
    "snippet": "static struct async_dbus_op *async_dbus_op_ref(struct async_dbus_op *op)\n{\n\t__sync_fetch_and_add(&op->ref_count, 1);\n\n\treturn op;\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "__sync_fetch_and_add",
          "args": [
            "&op->ref_count",
            "1"
          ],
          "line": 246
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic struct async_dbus_op *async_dbus_op_ref(struct async_dbus_op *op)\n{\n\t__sync_fetch_and_add(&op->ref_count, 1);\n\n\treturn op;\n}"
  },
  {
    "function_name": "async_dbus_op_free",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "235-242",
    "snippet": "static void async_dbus_op_free(void *data)\n{\n\tstruct async_dbus_op *op = data;\n\n\tqueue_destroy(op->msgs, (void *)dbus_message_unref);\n\n\tfree(op);\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "op"
          ],
          "line": 241
        },
        "resolved": true,
        "details": {
          "function_name": "service_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "1818-1826",
          "snippet": "static void service_free(void *data)\n{\n\tstruct service *service = data;\n\n\tqueue_destroy(service->chrcs, NULL);  /* List should be empty here */\n\tqueue_destroy(service->incl_services, NULL);\n\tg_free(service->path);\n\tfree(service);\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void service_free(void *data)\n{\n\tstruct service *service = data;\n\n\tqueue_destroy(service->chrcs, NULL);  /* List should be empty here */\n\tqueue_destroy(service->incl_services, NULL);\n\tg_free(service->path);\n\tfree(service);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_destroy",
          "args": [
            "op->msgs",
            "(void *)dbus_message_unref"
          ],
          "line": 239
        },
        "resolved": true,
        "details": {
          "function_name": "queue_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "68-76",
          "snippet": "void queue_destroy(struct queue *queue, queue_destroy_func_t destroy)\n{\n\tif (!queue)\n\t\treturn;\n\n\tqueue_remove_all(queue, NULL, NULL, destroy);\n\n\tqueue_unref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid queue_destroy(struct queue *queue, queue_destroy_func_t destroy)\n{\n\tif (!queue)\n\t\treturn;\n\n\tqueue_remove_all(queue, NULL, NULL, destroy);\n\n\tqueue_unref(queue);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void async_dbus_op_free(void *data)\n{\n\tstruct async_dbus_op *op = data;\n\n\tqueue_destroy(op->msgs, (void *)dbus_message_unref);\n\n\tfree(op);\n}"
  },
  {
    "function_name": "parse_value_arg",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "222-233",
    "snippet": "static int parse_value_arg(DBusMessageIter *iter, uint8_t **value, int *len)\n{\n\tDBusMessageIter array;\n\n\tif (dbus_message_iter_get_arg_type(iter) != DBUS_TYPE_ARRAY)\n\t\treturn -EINVAL;\n\n\tdbus_message_iter_recurse(iter, &array);\n\tdbus_message_iter_get_fixed_array(&array, value, len);\n\n\treturn 0;\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_iter_get_fixed_array",
          "args": [
            "&array",
            "value",
            "len"
          ],
          "line": 230
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_recurse",
          "args": [
            "iter",
            "&array"
          ],
          "line": 229
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_arg_type",
          "args": [
            "iter"
          ],
          "line": 226
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic int parse_value_arg(DBusMessageIter *iter, uint8_t **value, int *len)\n{\n\tDBusMessageIter array;\n\n\tif (dbus_message_iter_get_arg_type(iter) != DBUS_TYPE_ARRAY)\n\t\treturn -EINVAL;\n\n\tdbus_message_iter_recurse(iter, &array);\n\tdbus_message_iter_get_fixed_array(&array, value, len);\n\n\treturn 0;\n}"
  },
  {
    "function_name": "descriptor_value_exists",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "211-220",
    "snippet": "static gboolean descriptor_value_exists(const GDBusPropertyTable *property,\n\t\t\t\t\t\t\t\tvoid *data)\n{\n\tstruct descriptor *desc = data;\n\tgboolean ret;\n\n\tgatt_db_attribute_read(desc->attr, 0, 0, NULL, read_check_cb, &ret);\n\n\treturn ret;\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "gatt_db_attribute_read",
          "args": [
            "desc->attr",
            "0",
            "0",
            "NULL",
            "read_check_cb",
            "&ret"
          ],
          "line": 217
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_read",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1724-1763",
          "snippet": "bool gatt_db_attribute_read(struct gatt_db_attribute *attrib, uint16_t offset,\n\t\t\t\tuint8_t opcode, struct bt_att *att,\n\t\t\t\tgatt_db_attribute_read_t func, void *user_data)\n{\n\tuint8_t *value;\n\n\tif (!attrib || !func)\n\t\treturn false;\n\n\tif (attrib->read_func) {\n\t\tstruct pending_read *p;\n\n\t\tp = new0(struct pending_read, 1);\n\t\tp->attrib = attrib;\n\t\tp->id = ++attrib->read_id;\n\t\tp->timeout_id = timeout_add(ATTRIBUTE_TIMEOUT, read_timeout,\n\t\t\t\t\t\t\t\tp, NULL);\n\t\tp->func = func;\n\t\tp->user_data = user_data;\n\n\t\tqueue_push_tail(attrib->pending_reads, p);\n\n\t\tattrib->read_func(attrib, p->id, offset, opcode, att,\n\t\t\t\t\t\t\tattrib->user_data);\n\t\treturn true;\n\t}\n\n\t/* Check boundary if value is stored in the db */\n\tif (offset > attrib->value_len) {\n\t\tfunc(attrib, BT_ATT_ERROR_INVALID_OFFSET, NULL, 0, user_data);\n\t\treturn true;\n\t}\n\n\t/* Guard against invalid access if offset equals to value length */\n\tvalue = offset == attrib->value_len ? NULL : &attrib->value[offset];\n\n\tfunc(attrib, 0, value, attrib->value_len - offset, user_data);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define ATTRIBUTE_TIMEOUT 5000"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\n#define ATTRIBUTE_TIMEOUT 5000\n\nbool gatt_db_attribute_read(struct gatt_db_attribute *attrib, uint16_t offset,\n\t\t\t\tuint8_t opcode, struct bt_att *att,\n\t\t\t\tgatt_db_attribute_read_t func, void *user_data)\n{\n\tuint8_t *value;\n\n\tif (!attrib || !func)\n\t\treturn false;\n\n\tif (attrib->read_func) {\n\t\tstruct pending_read *p;\n\n\t\tp = new0(struct pending_read, 1);\n\t\tp->attrib = attrib;\n\t\tp->id = ++attrib->read_id;\n\t\tp->timeout_id = timeout_add(ATTRIBUTE_TIMEOUT, read_timeout,\n\t\t\t\t\t\t\t\tp, NULL);\n\t\tp->func = func;\n\t\tp->user_data = user_data;\n\n\t\tqueue_push_tail(attrib->pending_reads, p);\n\n\t\tattrib->read_func(attrib, p->id, offset, opcode, att,\n\t\t\t\t\t\t\tattrib->user_data);\n\t\treturn true;\n\t}\n\n\t/* Check boundary if value is stored in the db */\n\tif (offset > attrib->value_len) {\n\t\tfunc(attrib, BT_ATT_ERROR_INVALID_OFFSET, NULL, 0, user_data);\n\t\treturn true;\n\t}\n\n\t/* Guard against invalid access if offset equals to value length */\n\tvalue = offset == attrib->value_len ? NULL : &attrib->value[offset];\n\n\tfunc(attrib, 0, value, attrib->value_len - offset, user_data);\n\n\treturn true;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic gboolean descriptor_value_exists(const GDBusPropertyTable *property,\n\t\t\t\t\t\t\t\tvoid *data)\n{\n\tstruct descriptor *desc = data;\n\tgboolean ret;\n\n\tgatt_db_attribute_read(desc->attr, 0, 0, NULL, read_check_cb, &ret);\n\n\treturn ret;\n}"
  },
  {
    "function_name": "read_check_cb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "197-209",
    "snippet": "static void read_check_cb(struct gatt_db_attribute *attrib, int err,\n\t\t\t\tconst uint8_t *value, size_t length,\n\t\t\t\tvoid *user_data)\n{\n\tgboolean *ret = user_data;\n\n\tif (err) {\n\t\t*ret = FALSE;\n\t\treturn;\n\t}\n\n\t*ret = TRUE;\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void read_check_cb(struct gatt_db_attribute *attrib, int err,\n\t\t\t\tconst uint8_t *value, size_t length,\n\t\t\t\tvoid *user_data)\n{\n\tgboolean *ret = user_data;\n\n\tif (err) {\n\t\t*ret = FALSE;\n\t\treturn;\n\t}\n\n\t*ret = TRUE;\n}"
  },
  {
    "function_name": "descriptor_get_value",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "182-195",
    "snippet": "static gboolean descriptor_get_value(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct descriptor *desc = data;\n\tDBusMessageIter array;\n\n\tdbus_message_iter_open_container(iter, DBUS_TYPE_ARRAY, \"y\", &array);\n\n\tgatt_db_attribute_read(desc->attr, 0, 0, NULL, read_cb, &array);\n\n\tdbus_message_iter_close_container(iter, &array);\n\n\treturn TRUE;\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_iter_close_container",
          "args": [
            "iter",
            "&array"
          ],
          "line": 192
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gatt_db_attribute_read",
          "args": [
            "desc->attr",
            "0",
            "0",
            "NULL",
            "read_cb",
            "&array"
          ],
          "line": 190
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_read",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1724-1763",
          "snippet": "bool gatt_db_attribute_read(struct gatt_db_attribute *attrib, uint16_t offset,\n\t\t\t\tuint8_t opcode, struct bt_att *att,\n\t\t\t\tgatt_db_attribute_read_t func, void *user_data)\n{\n\tuint8_t *value;\n\n\tif (!attrib || !func)\n\t\treturn false;\n\n\tif (attrib->read_func) {\n\t\tstruct pending_read *p;\n\n\t\tp = new0(struct pending_read, 1);\n\t\tp->attrib = attrib;\n\t\tp->id = ++attrib->read_id;\n\t\tp->timeout_id = timeout_add(ATTRIBUTE_TIMEOUT, read_timeout,\n\t\t\t\t\t\t\t\tp, NULL);\n\t\tp->func = func;\n\t\tp->user_data = user_data;\n\n\t\tqueue_push_tail(attrib->pending_reads, p);\n\n\t\tattrib->read_func(attrib, p->id, offset, opcode, att,\n\t\t\t\t\t\t\tattrib->user_data);\n\t\treturn true;\n\t}\n\n\t/* Check boundary if value is stored in the db */\n\tif (offset > attrib->value_len) {\n\t\tfunc(attrib, BT_ATT_ERROR_INVALID_OFFSET, NULL, 0, user_data);\n\t\treturn true;\n\t}\n\n\t/* Guard against invalid access if offset equals to value length */\n\tvalue = offset == attrib->value_len ? NULL : &attrib->value[offset];\n\n\tfunc(attrib, 0, value, attrib->value_len - offset, user_data);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define ATTRIBUTE_TIMEOUT 5000"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\n#define ATTRIBUTE_TIMEOUT 5000\n\nbool gatt_db_attribute_read(struct gatt_db_attribute *attrib, uint16_t offset,\n\t\t\t\tuint8_t opcode, struct bt_att *att,\n\t\t\t\tgatt_db_attribute_read_t func, void *user_data)\n{\n\tuint8_t *value;\n\n\tif (!attrib || !func)\n\t\treturn false;\n\n\tif (attrib->read_func) {\n\t\tstruct pending_read *p;\n\n\t\tp = new0(struct pending_read, 1);\n\t\tp->attrib = attrib;\n\t\tp->id = ++attrib->read_id;\n\t\tp->timeout_id = timeout_add(ATTRIBUTE_TIMEOUT, read_timeout,\n\t\t\t\t\t\t\t\tp, NULL);\n\t\tp->func = func;\n\t\tp->user_data = user_data;\n\n\t\tqueue_push_tail(attrib->pending_reads, p);\n\n\t\tattrib->read_func(attrib, p->id, offset, opcode, att,\n\t\t\t\t\t\t\tattrib->user_data);\n\t\treturn true;\n\t}\n\n\t/* Check boundary if value is stored in the db */\n\tif (offset > attrib->value_len) {\n\t\tfunc(attrib, BT_ATT_ERROR_INVALID_OFFSET, NULL, 0, user_data);\n\t\treturn true;\n\t}\n\n\t/* Guard against invalid access if offset equals to value length */\n\tvalue = offset == attrib->value_len ? NULL : &attrib->value[offset];\n\n\tfunc(attrib, 0, value, attrib->value_len - offset, user_data);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_open_container",
          "args": [
            "iter",
            "DBUS_TYPE_ARRAY",
            "\"y\"",
            "&array"
          ],
          "line": 188
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic gboolean descriptor_get_value(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct descriptor *desc = data;\n\tDBusMessageIter array;\n\n\tdbus_message_iter_open_container(iter, DBUS_TYPE_ARRAY, \"y\", &array);\n\n\tgatt_db_attribute_read(desc->attr, 0, 0, NULL, read_cb, &array);\n\n\tdbus_message_iter_close_container(iter, &array);\n\n\treturn TRUE;\n}"
  },
  {
    "function_name": "read_cb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "169-180",
    "snippet": "static void read_cb(struct gatt_db_attribute *attrib, int err,\n\t\t\t\tconst uint8_t *value, size_t length,\n\t\t\t\tvoid *user_data)\n{\n\tDBusMessageIter *array = user_data;\n\n\tif (err)\n\t\treturn;\n\n\tdbus_message_iter_append_fixed_array(array, DBUS_TYPE_BYTE, &value,\n\t\t\t\t\t\t\t\tlength);\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_iter_append_fixed_array",
          "args": [
            "array",
            "DBUS_TYPE_BYTE",
            "&value",
            "length"
          ],
          "line": 178
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void read_cb(struct gatt_db_attribute *attrib, int err,\n\t\t\t\tconst uint8_t *value, size_t length,\n\t\t\t\tvoid *user_data)\n{\n\tDBusMessageIter *array = user_data;\n\n\tif (err)\n\t\treturn;\n\n\tdbus_message_iter_append_fixed_array(array, DBUS_TYPE_BYTE, &value,\n\t\t\t\t\t\t\t\tlength);\n}"
  },
  {
    "function_name": "descriptor_get_characteristic",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "157-167",
    "snippet": "static gboolean descriptor_get_characteristic(\n\t\t\t\t\tconst GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct descriptor *desc = data;\n\tconst char *str = desc->chrc->path;\n\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_OBJECT_PATH, &str);\n\n\treturn TRUE;\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_iter_append_basic",
          "args": [
            "iter",
            "DBUS_TYPE_OBJECT_PATH",
            "&str"
          ],
          "line": 164
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic gboolean descriptor_get_characteristic(\n\t\t\t\t\tconst GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct descriptor *desc = data;\n\tconst char *str = desc->chrc->path;\n\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_OBJECT_PATH, &str);\n\n\treturn TRUE;\n}"
  },
  {
    "function_name": "descriptor_get_uuid",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "144-155",
    "snippet": "static gboolean descriptor_get_uuid(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tchar uuid[MAX_LEN_UUID_STR + 1];\n\tconst char *ptr = uuid;\n\tstruct descriptor *desc = data;\n\n\tbt_uuid_to_string(&desc->uuid, uuid, sizeof(uuid));\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_STRING, &ptr);\n\n\treturn TRUE;\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_iter_append_basic",
          "args": [
            "iter",
            "DBUS_TYPE_STRING",
            "&ptr"
          ],
          "line": 152
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_uuid_to_string",
          "args": [
            "&desc->uuid",
            "uuid",
            "sizeof(uuid)"
          ],
          "line": 151
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic gboolean descriptor_get_uuid(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tchar uuid[MAX_LEN_UUID_STR + 1];\n\tconst char *ptr = uuid;\n\tstruct descriptor *desc = data;\n\n\tbt_uuid_to_string(&desc->uuid, uuid, sizeof(uuid));\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_STRING, &ptr);\n\n\treturn TRUE;\n}"
  },
  {
    "function_name": "uuid_cmp",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
    "lines": "135-142",
    "snippet": "static bool uuid_cmp(const bt_uuid_t *uuid, uint16_t u16)\n{\n\tbt_uuid_t uuid16;\n\n\tbt_uuid16_create(&uuid16, u16);\n\n\treturn bt_uuid_cmp(uuid, &uuid16) == 0;\n}",
    "includes": [
      "#include \"dbus-common.h\"",
      "#include \"gatt-client.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bt_uuid_cmp",
          "args": [
            "uuid",
            "&uuid16"
          ],
          "line": 141
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_uuid16_create",
          "args": [
            "&uuid16",
            "u16"
          ],
          "line": 139
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic bool uuid_cmp(const bt_uuid_t *uuid, uint16_t u16)\n{\n\tbt_uuid_t uuid16;\n\n\tbt_uuid16_create(&uuid16, u16);\n\n\treturn bt_uuid_cmp(uuid, &uuid16) == 0;\n}"
  }
]