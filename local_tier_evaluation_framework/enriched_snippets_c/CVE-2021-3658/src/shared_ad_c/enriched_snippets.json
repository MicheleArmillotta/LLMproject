[
  {
    "function_name": "bt_ad_clear_data",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
    "lines": "999-1005",
    "snippet": "void bt_ad_clear_data(struct bt_ad *ad)\n{\n\tif (!ad)\n\t\treturn;\n\n\tqueue_remove_all(ad->data, NULL, NULL, data_destroy);\n}",
    "includes": [
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/eir.h\"",
      "#include \"src/shared/ad.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_remove_all",
          "args": [
            "ad->data",
            "NULL",
            "NULL",
            "data_destroy"
          ],
          "line": 1004
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_all",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "318-362",
          "snippet": "unsigned int queue_remove_all(struct queue *queue, queue_match_func_t function,\n\t\t\t\tvoid *user_data, queue_destroy_func_t destroy)\n{\n\tstruct queue_entry *entry;\n\tunsigned int count = 0;\n\n\tif (!queue)\n\t\treturn 0;\n\n\tentry = queue->head;\n\n\tif (function) {\n\t\twhile (entry) {\n\t\t\tvoid *data;\n\t\t\tunsigned int entries = queue->entries;\n\n\t\t\tdata = queue_remove_if(queue, function, user_data);\n\t\t\tif (entries == queue->entries)\n\t\t\t\tbreak;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(data);\n\n\t\t\tcount++;\n\t\t}\n\t} else {\n\t\tqueue->head = NULL;\n\t\tqueue->tail = NULL;\n\t\tqueue->entries = 0;\n\n\t\twhile (entry) {\n\t\t\tstruct queue_entry *tmp = entry;\n\n\t\t\tentry = entry->next;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(tmp->data);\n\n\t\t\tfree(tmp);\n\t\t\tcount++;\n\t\t}\n\t}\n\n\treturn count;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nunsigned int queue_remove_all(struct queue *queue, queue_match_func_t function,\n\t\t\t\tvoid *user_data, queue_destroy_func_t destroy)\n{\n\tstruct queue_entry *entry;\n\tunsigned int count = 0;\n\n\tif (!queue)\n\t\treturn 0;\n\n\tentry = queue->head;\n\n\tif (function) {\n\t\twhile (entry) {\n\t\t\tvoid *data;\n\t\t\tunsigned int entries = queue->entries;\n\n\t\t\tdata = queue_remove_if(queue, function, user_data);\n\t\t\tif (entries == queue->entries)\n\t\t\t\tbreak;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(data);\n\n\t\t\tcount++;\n\t\t}\n\t} else {\n\t\tqueue->head = NULL;\n\t\tqueue->tail = NULL;\n\t\tqueue->entries = 0;\n\n\t\twhile (entry) {\n\t\t\tstruct queue_entry *tmp = entry;\n\n\t\t\tentry = entry->next;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(tmp->data);\n\n\t\t\tfree(tmp);\n\t\t\tcount++;\n\t\t}\n\t}\n\n\treturn count;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nvoid bt_ad_clear_data(struct bt_ad *ad)\n{\n\tif (!ad)\n\t\treturn;\n\n\tqueue_remove_all(ad->data, NULL, NULL, data_destroy);\n}"
  },
  {
    "function_name": "bt_ad_remove_data",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
    "lines": "983-997",
    "snippet": "bool bt_ad_remove_data(struct bt_ad *ad, uint8_t type)\n{\n\tstruct bt_ad_data *data;\n\n\tif (!ad)\n\t\treturn false;\n\n\tdata = queue_remove_if(ad->data, data_type_match, UINT_TO_PTR(type));\n\tif (!data)\n\t\treturn false;\n\n\tdata_destroy(data);\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/eir.h\"",
      "#include \"src/shared/ad.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "data_destroy",
          "args": [
            "data"
          ],
          "line": 994
        },
        "resolved": true,
        "details": {
          "function_name": "data_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "99-105",
          "snippet": "static void data_destroy(void *data)\n{\n\tstruct bt_ad_data *ad = data;\n\n\tfree(ad->data);\n\tfree(ad);\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic void data_destroy(void *data)\n{\n\tstruct bt_ad_data *ad = data;\n\n\tfree(ad->data);\n\tfree(ad);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_remove_if",
          "args": [
            "ad->data",
            "data_type_match",
            "UINT_TO_PTR(type)"
          ],
          "line": 990
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_if",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "278-316",
          "snippet": "void *queue_remove_if(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry, *prev = NULL;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tentry = queue->head;\n\n\twhile (entry) {\n\t\tif (function(entry->data, user_data)) {\n\t\t\tvoid *data;\n\n\t\t\tif (prev)\n\t\t\t\tprev->next = entry->next;\n\t\t\telse\n\t\t\t\tqueue->head = entry->next;\n\n\t\t\tif (!entry->next)\n\t\t\t\tqueue->tail = prev;\n\n\t\t\tdata = entry->data;\n\n\t\t\tfree(entry);\n\t\t\tqueue->entries--;\n\n\t\t\treturn data;\n\t\t} else {\n\t\t\tprev = entry;\n\t\t\tentry = entry->next;\n\t\t}\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid *queue_remove_if(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry, *prev = NULL;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tentry = queue->head;\n\n\twhile (entry) {\n\t\tif (function(entry->data, user_data)) {\n\t\t\tvoid *data;\n\n\t\t\tif (prev)\n\t\t\t\tprev->next = entry->next;\n\t\t\telse\n\t\t\t\tqueue->head = entry->next;\n\n\t\t\tif (!entry->next)\n\t\t\t\tqueue->tail = prev;\n\n\t\t\tdata = entry->data;\n\n\t\t\tfree(entry);\n\t\t\tqueue->entries--;\n\n\t\t\treturn data;\n\t\t} else {\n\t\t\tprev = entry;\n\t\t\tentry = entry->next;\n\t\t}\n\t}\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "UINT_TO_PTR",
          "args": [
            "type"
          ],
          "line": 990
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nbool bt_ad_remove_data(struct bt_ad *ad, uint8_t type)\n{\n\tstruct bt_ad_data *data;\n\n\tif (!ad)\n\t\treturn false;\n\n\tdata = queue_remove_if(ad->data, data_type_match, UINT_TO_PTR(type));\n\tif (!data)\n\t\treturn false;\n\n\tdata_destroy(data);\n\n\treturn true;\n}"
  },
  {
    "function_name": "bt_ad_foreach_data",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
    "lines": "975-981",
    "snippet": "void bt_ad_foreach_data(struct bt_ad *ad, bt_ad_func_t func, void *user_data)\n{\n\tif (!ad)\n\t\treturn;\n\n\tqueue_foreach(ad->data, func, user_data);\n}",
    "includes": [
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/eir.h\"",
      "#include \"src/shared/ad.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_foreach",
          "args": [
            "ad->data",
            "func",
            "user_data"
          ],
          "line": 980
        },
        "resolved": true,
        "details": {
          "function_name": "queue_foreach",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "203-224",
          "snippet": "void queue_foreach(struct queue *queue, queue_foreach_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue || !function)\n\t\treturn;\n\n\tentry = queue->head;\n\tif (!entry)\n\t\treturn;\n\n\tqueue_ref(queue);\n\twhile (entry && queue->head && queue->ref_count > 1) {\n\t\tstruct queue_entry *next;\n\n\t\tnext = entry->next;\n\t\tfunction(entry->data, user_data);\n\t\tentry = next;\n\t}\n\tqueue_unref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid queue_foreach(struct queue *queue, queue_foreach_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue || !function)\n\t\treturn;\n\n\tentry = queue->head;\n\tif (!entry)\n\t\treturn;\n\n\tqueue_ref(queue);\n\twhile (entry && queue->head && queue->ref_count > 1) {\n\t\tstruct queue_entry *next;\n\n\t\tnext = entry->next;\n\t\tfunction(entry->data, user_data);\n\t\tentry = next;\n\t}\n\tqueue_unref(queue);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nvoid bt_ad_foreach_data(struct bt_ad *ad, bt_ad_func_t func, void *user_data)\n{\n\tif (!ad)\n\t\treturn;\n\n\tqueue_foreach(ad->data, func, user_data);\n}"
  },
  {
    "function_name": "bt_ad_has_data",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
    "lines": "964-973",
    "snippet": "bool bt_ad_has_data(struct bt_ad *ad, const struct bt_ad_data *data)\n{\n\tif (!ad)\n\t\treturn false;\n\n\tif (!data)\n\t\treturn !queue_isempty(ad->data);\n\n\treturn queue_find(ad->data, data_match, data);\n}",
    "includes": [
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/eir.h\"",
      "#include \"src/shared/ad.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_find",
          "args": [
            "ad->data",
            "data_match",
            "data"
          ],
          "line": 972
        },
        "resolved": true,
        "details": {
          "function_name": "queue_find",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "231-247",
          "snippet": "void *queue_find(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tconst void *match_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tfor (entry = queue->head; entry; entry = entry->next)\n\t\tif (function(entry->data, match_data))\n\t\t\treturn entry->data;\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid *queue_find(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tconst void *match_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tfor (entry = queue->head; entry; entry = entry->next)\n\t\tif (function(entry->data, match_data))\n\t\t\treturn entry->data;\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_isempty",
          "args": [
            "ad->data"
          ],
          "line": 970
        },
        "resolved": true,
        "details": {
          "function_name": "queue_isempty",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "380-386",
          "snippet": "bool queue_isempty(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn true;\n\n\treturn queue->entries == 0;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_isempty(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn true;\n\n\treturn queue->entries == 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nbool bt_ad_has_data(struct bt_ad *ad, const struct bt_ad_data *data)\n{\n\tif (!ad)\n\t\treturn false;\n\n\tif (!data)\n\t\treturn !queue_isempty(ad->data);\n\n\treturn queue_find(ad->data, data_match, data);\n}"
  },
  {
    "function_name": "data_match",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
    "lines": "950-962",
    "snippet": "static bool data_match(const void *data, const void *user_data)\n{\n\tconst struct bt_ad_data *d1 = data;\n\tconst struct bt_ad_data *d2 = user_data;\n\n\tif (d1->type != d2->type)\n\t\treturn false;\n\n\tif (d1->len != d2->len)\n\t\treturn false;\n\n\treturn !memcmp(d1->data, d2->data, d1->len);\n}",
    "includes": [
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/eir.h\"",
      "#include \"src/shared/ad.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "memcmp",
          "args": [
            "d1->data",
            "d2->data",
            "d1->len"
          ],
          "line": 961
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic bool data_match(const void *data, const void *user_data)\n{\n\tconst struct bt_ad_data *d1 = data;\n\tconst struct bt_ad_data *d2 = user_data;\n\n\tif (d1->type != d2->type)\n\t\treturn false;\n\n\tif (d1->len != d2->len)\n\t\treturn false;\n\n\treturn !memcmp(d1->data, d2->data, d1->len);\n}"
  },
  {
    "function_name": "bt_ad_add_data",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
    "lines": "932-948",
    "snippet": "bool bt_ad_add_data(struct bt_ad *ad, uint8_t type, void *data, size_t len)\n{\n\tsize_t i;\n\n\tif (!ad)\n\t\treturn false;\n\n\tif (len > (MAX_ADV_DATA_LEN - 2))\n\t\treturn false;\n\n\tfor (i = 0; i < sizeof(type_blacklist); i++) {\n\t\tif (type == type_blacklist[i])\n\t\t\treturn false;\n\t}\n\n\treturn ad_replace_data(ad, type, data, len);\n}",
    "includes": [
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/eir.h\"",
      "#include \"src/shared/ad.h\""
    ],
    "macros_used": [
      "#define MAX_ADV_DATA_LEN 31"
    ],
    "globals_used": [
      "static uint8_t type_blacklist[] = {\n\tBT_AD_FLAGS,\n\tBT_AD_UUID16_SOME,\n\tBT_AD_UUID16_ALL,\n\tBT_AD_UUID32_SOME,\n\tBT_AD_UUID32_ALL,\n\tBT_AD_UUID128_SOME,\n\tBT_AD_UUID128_ALL,\n\tBT_AD_NAME_SHORT,\n\tBT_AD_NAME_COMPLETE,\n\tBT_AD_TX_POWER,\n\tBT_AD_CLASS_OF_DEV,\n\tBT_AD_SSP_HASH,\n\tBT_AD_SSP_RANDOMIZER,\n\tBT_AD_DEVICE_ID,\n\tBT_AD_SMP_TK,\n\tBT_AD_SMP_OOB_FLAGS,\n\tBT_AD_SLAVE_CONN_INTERVAL,\n\tBT_AD_SOLICIT16,\n\tBT_AD_SOLICIT128,\n\tBT_AD_SERVICE_DATA16,\n\tBT_AD_PUBLIC_ADDRESS,\n\tBT_AD_RANDOM_ADDRESS,\n\tBT_AD_GAP_APPEARANCE,\n\tBT_AD_ADVERTISING_INTERVAL,\n\tBT_AD_LE_DEVICE_ADDRESS,\n\tBT_AD_LE_ROLE,\n\tBT_AD_SSP_HASH_P256,\n\tBT_AD_SSP_RANDOMIZER_P256,\n\tBT_AD_SOLICIT32,\n\tBT_AD_SERVICE_DATA32,\n\tBT_AD_SERVICE_DATA128,\n\tBT_AD_LE_SC_CONFIRM_VALUE,\n\tBT_AD_LE_SC_RANDOM_VALUE,\n\tBT_AD_LE_SUPPORTED_FEATURES,\n\tBT_AD_CHANNEL_MAP_UPDATE_IND,\n\tBT_AD_MESH_PROV,\n\tBT_AD_MESH_DATA,\n\tBT_AD_MESH_BEACON,\n\tBT_AD_3D_INFO_DATA,\n\tBT_AD_MANUFACTURER_DATA,\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "ad_replace_data",
          "args": [
            "ad",
            "type",
            "data",
            "len"
          ],
          "line": 947
        },
        "resolved": true,
        "details": {
          "function_name": "ad_replace_data",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "138-170",
          "snippet": "static bool ad_replace_data(struct bt_ad *ad, uint8_t type, void *data,\n\t\t\t\t\t\t\tsize_t len)\n{\n\tstruct bt_ad_data *new_data;\n\n\tnew_data = queue_find(ad->data, data_type_match, UINT_TO_PTR(type));\n\tif (new_data) {\n\t\tif (new_data->len == len && !memcmp(new_data->data, data, len))\n\t\t\treturn false;\n\t\tnew_data->data = realloc(new_data->data, len);\n\t\tmemcpy(new_data->data, data, len);\n\t\tnew_data->len = len;\n\t\treturn true;\n\t}\n\n\tnew_data = new0(struct bt_ad_data, 1);\n\tnew_data->type = type;\n\tnew_data->data = malloc(len);\n\tif (!new_data->data) {\n\t\tfree(new_data);\n\t\treturn false;\n\t}\n\n\tmemcpy(new_data->data, data, len);\n\tnew_data->len = len;\n\n\tif (queue_push_tail(ad->data, new_data))\n\t\treturn true;\n\n\tdata_destroy(new_data);\n\n\treturn false;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic bool ad_replace_data(struct bt_ad *ad, uint8_t type, void *data,\n\t\t\t\t\t\t\tsize_t len)\n{\n\tstruct bt_ad_data *new_data;\n\n\tnew_data = queue_find(ad->data, data_type_match, UINT_TO_PTR(type));\n\tif (new_data) {\n\t\tif (new_data->len == len && !memcmp(new_data->data, data, len))\n\t\t\treturn false;\n\t\tnew_data->data = realloc(new_data->data, len);\n\t\tmemcpy(new_data->data, data, len);\n\t\tnew_data->len = len;\n\t\treturn true;\n\t}\n\n\tnew_data = new0(struct bt_ad_data, 1);\n\tnew_data->type = type;\n\tnew_data->data = malloc(len);\n\tif (!new_data->data) {\n\t\tfree(new_data);\n\t\treturn false;\n\t}\n\n\tmemcpy(new_data->data, data, len);\n\tnew_data->len = len;\n\n\tif (queue_push_tail(ad->data, new_data))\n\t\treturn true;\n\n\tdata_destroy(new_data);\n\n\treturn false;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\n#define MAX_ADV_DATA_LEN 31\n\nstatic uint8_t type_blacklist[] = {\n\tBT_AD_FLAGS,\n\tBT_AD_UUID16_SOME,\n\tBT_AD_UUID16_ALL,\n\tBT_AD_UUID32_SOME,\n\tBT_AD_UUID32_ALL,\n\tBT_AD_UUID128_SOME,\n\tBT_AD_UUID128_ALL,\n\tBT_AD_NAME_SHORT,\n\tBT_AD_NAME_COMPLETE,\n\tBT_AD_TX_POWER,\n\tBT_AD_CLASS_OF_DEV,\n\tBT_AD_SSP_HASH,\n\tBT_AD_SSP_RANDOMIZER,\n\tBT_AD_DEVICE_ID,\n\tBT_AD_SMP_TK,\n\tBT_AD_SMP_OOB_FLAGS,\n\tBT_AD_SLAVE_CONN_INTERVAL,\n\tBT_AD_SOLICIT16,\n\tBT_AD_SOLICIT128,\n\tBT_AD_SERVICE_DATA16,\n\tBT_AD_PUBLIC_ADDRESS,\n\tBT_AD_RANDOM_ADDRESS,\n\tBT_AD_GAP_APPEARANCE,\n\tBT_AD_ADVERTISING_INTERVAL,\n\tBT_AD_LE_DEVICE_ADDRESS,\n\tBT_AD_LE_ROLE,\n\tBT_AD_SSP_HASH_P256,\n\tBT_AD_SSP_RANDOMIZER_P256,\n\tBT_AD_SOLICIT32,\n\tBT_AD_SERVICE_DATA32,\n\tBT_AD_SERVICE_DATA128,\n\tBT_AD_LE_SC_CONFIRM_VALUE,\n\tBT_AD_LE_SC_RANDOM_VALUE,\n\tBT_AD_LE_SUPPORTED_FEATURES,\n\tBT_AD_CHANNEL_MAP_UPDATE_IND,\n\tBT_AD_MESH_PROV,\n\tBT_AD_MESH_DATA,\n\tBT_AD_MESH_BEACON,\n\tBT_AD_3D_INFO_DATA,\n\tBT_AD_MANUFACTURER_DATA,\n};\n\nbool bt_ad_add_data(struct bt_ad *ad, uint8_t type, void *data, size_t len)\n{\n\tsize_t i;\n\n\tif (!ad)\n\t\treturn false;\n\n\tif (len > (MAX_ADV_DATA_LEN - 2))\n\t\treturn false;\n\n\tfor (i = 0; i < sizeof(type_blacklist); i++) {\n\t\tif (type == type_blacklist[i])\n\t\t\treturn false;\n\t}\n\n\treturn ad_replace_data(ad, type, data, len);\n}"
  },
  {
    "function_name": "bt_ad_clear_flags",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
    "lines": "880-887",
    "snippet": "void bt_ad_clear_flags(struct bt_ad *ad)\n{\n\tif (!ad)\n\t\treturn;\n\n\tqueue_remove_all(ad->data, data_type_match, UINT_TO_PTR(BT_AD_FLAGS),\n\t\t\t\t\t\t\tdata_destroy);\n}",
    "includes": [
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/eir.h\"",
      "#include \"src/shared/ad.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_remove_all",
          "args": [
            "ad->data",
            "data_type_match",
            "UINT_TO_PTR(BT_AD_FLAGS)",
            "data_destroy"
          ],
          "line": 885
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_all",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "318-362",
          "snippet": "unsigned int queue_remove_all(struct queue *queue, queue_match_func_t function,\n\t\t\t\tvoid *user_data, queue_destroy_func_t destroy)\n{\n\tstruct queue_entry *entry;\n\tunsigned int count = 0;\n\n\tif (!queue)\n\t\treturn 0;\n\n\tentry = queue->head;\n\n\tif (function) {\n\t\twhile (entry) {\n\t\t\tvoid *data;\n\t\t\tunsigned int entries = queue->entries;\n\n\t\t\tdata = queue_remove_if(queue, function, user_data);\n\t\t\tif (entries == queue->entries)\n\t\t\t\tbreak;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(data);\n\n\t\t\tcount++;\n\t\t}\n\t} else {\n\t\tqueue->head = NULL;\n\t\tqueue->tail = NULL;\n\t\tqueue->entries = 0;\n\n\t\twhile (entry) {\n\t\t\tstruct queue_entry *tmp = entry;\n\n\t\t\tentry = entry->next;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(tmp->data);\n\n\t\t\tfree(tmp);\n\t\t\tcount++;\n\t\t}\n\t}\n\n\treturn count;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nunsigned int queue_remove_all(struct queue *queue, queue_match_func_t function,\n\t\t\t\tvoid *user_data, queue_destroy_func_t destroy)\n{\n\tstruct queue_entry *entry;\n\tunsigned int count = 0;\n\n\tif (!queue)\n\t\treturn 0;\n\n\tentry = queue->head;\n\n\tif (function) {\n\t\twhile (entry) {\n\t\t\tvoid *data;\n\t\t\tunsigned int entries = queue->entries;\n\n\t\t\tdata = queue_remove_if(queue, function, user_data);\n\t\t\tif (entries == queue->entries)\n\t\t\t\tbreak;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(data);\n\n\t\t\tcount++;\n\t\t}\n\t} else {\n\t\tqueue->head = NULL;\n\t\tqueue->tail = NULL;\n\t\tqueue->entries = 0;\n\n\t\twhile (entry) {\n\t\t\tstruct queue_entry *tmp = entry;\n\n\t\t\tentry = entry->next;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(tmp->data);\n\n\t\t\tfree(tmp);\n\t\t\tcount++;\n\t\t}\n\t}\n\n\treturn count;\n}"
        }
      },
      {
        "call_info": {
          "callee": "UINT_TO_PTR",
          "args": [
            "BT_AD_FLAGS"
          ],
          "line": 885
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nvoid bt_ad_clear_flags(struct bt_ad *ad)\n{\n\tif (!ad)\n\t\treturn;\n\n\tqueue_remove_all(ad->data, data_type_match, UINT_TO_PTR(BT_AD_FLAGS),\n\t\t\t\t\t\t\tdata_destroy);\n}"
  },
  {
    "function_name": "bt_ad_has_flags",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
    "lines": "866-878",
    "snippet": "bool bt_ad_has_flags(struct bt_ad *ad)\n{\n\tstruct bt_ad_data *data;\n\n\tif (!ad)\n\t\treturn false;\n\n\tdata = queue_find(ad->data, data_type_match, UINT_TO_PTR(BT_AD_FLAGS));\n\tif (!data)\n\t\treturn false;\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/eir.h\"",
      "#include \"src/shared/ad.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_find",
          "args": [
            "ad->data",
            "data_type_match",
            "UINT_TO_PTR(BT_AD_FLAGS)"
          ],
          "line": 873
        },
        "resolved": true,
        "details": {
          "function_name": "queue_find",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "231-247",
          "snippet": "void *queue_find(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tconst void *match_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tfor (entry = queue->head; entry; entry = entry->next)\n\t\tif (function(entry->data, match_data))\n\t\t\treturn entry->data;\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid *queue_find(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tconst void *match_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tfor (entry = queue->head; entry; entry = entry->next)\n\t\tif (function(entry->data, match_data))\n\t\t\treturn entry->data;\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "UINT_TO_PTR",
          "args": [
            "BT_AD_FLAGS"
          ],
          "line": 873
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nbool bt_ad_has_flags(struct bt_ad *ad)\n{\n\tstruct bt_ad_data *data;\n\n\tif (!ad)\n\t\treturn false;\n\n\tdata = queue_find(ad->data, data_type_match, UINT_TO_PTR(BT_AD_FLAGS));\n\tif (!data)\n\t\treturn false;\n\n\treturn true;\n}"
  },
  {
    "function_name": "bt_ad_add_flags",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
    "lines": "854-864",
    "snippet": "bool bt_ad_add_flags(struct bt_ad *ad, uint8_t *flags, size_t len)\n{\n\tif (!ad)\n\t\treturn false;\n\n\t/* TODO: Add table to check other flags */\n\tif (len > 1 || flags[0] & 0xe0)\n\t\treturn false;\n\n\treturn ad_replace_data(ad, BT_AD_FLAGS, flags, len);\n}",
    "includes": [
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/eir.h\"",
      "#include \"src/shared/ad.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ad_replace_data",
          "args": [
            "ad",
            "BT_AD_FLAGS",
            "flags",
            "len"
          ],
          "line": 863
        },
        "resolved": true,
        "details": {
          "function_name": "ad_replace_data",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "138-170",
          "snippet": "static bool ad_replace_data(struct bt_ad *ad, uint8_t type, void *data,\n\t\t\t\t\t\t\tsize_t len)\n{\n\tstruct bt_ad_data *new_data;\n\n\tnew_data = queue_find(ad->data, data_type_match, UINT_TO_PTR(type));\n\tif (new_data) {\n\t\tif (new_data->len == len && !memcmp(new_data->data, data, len))\n\t\t\treturn false;\n\t\tnew_data->data = realloc(new_data->data, len);\n\t\tmemcpy(new_data->data, data, len);\n\t\tnew_data->len = len;\n\t\treturn true;\n\t}\n\n\tnew_data = new0(struct bt_ad_data, 1);\n\tnew_data->type = type;\n\tnew_data->data = malloc(len);\n\tif (!new_data->data) {\n\t\tfree(new_data);\n\t\treturn false;\n\t}\n\n\tmemcpy(new_data->data, data, len);\n\tnew_data->len = len;\n\n\tif (queue_push_tail(ad->data, new_data))\n\t\treturn true;\n\n\tdata_destroy(new_data);\n\n\treturn false;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic bool ad_replace_data(struct bt_ad *ad, uint8_t type, void *data,\n\t\t\t\t\t\t\tsize_t len)\n{\n\tstruct bt_ad_data *new_data;\n\n\tnew_data = queue_find(ad->data, data_type_match, UINT_TO_PTR(type));\n\tif (new_data) {\n\t\tif (new_data->len == len && !memcmp(new_data->data, data, len))\n\t\t\treturn false;\n\t\tnew_data->data = realloc(new_data->data, len);\n\t\tmemcpy(new_data->data, data, len);\n\t\tnew_data->len = len;\n\t\treturn true;\n\t}\n\n\tnew_data = new0(struct bt_ad_data, 1);\n\tnew_data->type = type;\n\tnew_data->data = malloc(len);\n\tif (!new_data->data) {\n\t\tfree(new_data);\n\t\treturn false;\n\t}\n\n\tmemcpy(new_data->data, data, len);\n\tnew_data->len = len;\n\n\tif (queue_push_tail(ad->data, new_data))\n\t\treturn true;\n\n\tdata_destroy(new_data);\n\n\treturn false;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nbool bt_ad_add_flags(struct bt_ad *ad, uint8_t *flags, size_t len)\n{\n\tif (!ad)\n\t\treturn false;\n\n\t/* TODO: Add table to check other flags */\n\tif (len > 1 || flags[0] & 0xe0)\n\t\treturn false;\n\n\treturn ad_replace_data(ad, BT_AD_FLAGS, flags, len);\n}"
  },
  {
    "function_name": "bt_ad_clear_appearance",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
    "lines": "846-852",
    "snippet": "void bt_ad_clear_appearance(struct bt_ad *ad)\n{\n\tif (!ad)\n\t\treturn;\n\n\tad->appearance = UINT16_MAX;\n}",
    "includes": [
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/eir.h\"",
      "#include \"src/shared/ad.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nvoid bt_ad_clear_appearance(struct bt_ad *ad)\n{\n\tif (!ad)\n\t\treturn;\n\n\tad->appearance = UINT16_MAX;\n}"
  },
  {
    "function_name": "bt_ad_add_appearance",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
    "lines": "836-844",
    "snippet": "bool bt_ad_add_appearance(struct bt_ad *ad, uint16_t appearance)\n{\n\tif (!ad)\n\t\treturn false;\n\n\tad->appearance = appearance;\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/eir.h\"",
      "#include \"src/shared/ad.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nbool bt_ad_add_appearance(struct bt_ad *ad, uint16_t appearance)\n{\n\tif (!ad)\n\t\treturn false;\n\n\tad->appearance = appearance;\n\n\treturn true;\n}"
  },
  {
    "function_name": "bt_ad_clear_name",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
    "lines": "827-834",
    "snippet": "void bt_ad_clear_name(struct bt_ad *ad)\n{\n\tif (!ad)\n\t\treturn;\n\n\tfree(ad->name);\n\tad->name = NULL;\n}",
    "includes": [
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/eir.h\"",
      "#include \"src/shared/ad.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "ad->name"
          ],
          "line": 832
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "956-985",
          "snippet": "static void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nvoid bt_ad_clear_name(struct bt_ad *ad)\n{\n\tif (!ad)\n\t\treturn;\n\n\tfree(ad->name);\n\tad->name = NULL;\n}"
  },
  {
    "function_name": "bt_ad_add_name",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
    "lines": "815-825",
    "snippet": "bool bt_ad_add_name(struct bt_ad *ad, const char *name)\n{\n\tif (!ad)\n\t\treturn false;\n\n\tfree(ad->name);\n\n\tad->name = strdup(name);\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/eir.h\"",
      "#include \"src/shared/ad.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "name"
          ],
          "line": 822
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "ad->name"
          ],
          "line": 820
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "956-985",
          "snippet": "static void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nbool bt_ad_add_name(struct bt_ad *ad, const char *name)\n{\n\tif (!ad)\n\t\treturn false;\n\n\tfree(ad->name);\n\n\tad->name = strdup(name);\n\n\treturn true;\n}"
  },
  {
    "function_name": "bt_ad_clear_service_data",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
    "lines": "807-813",
    "snippet": "void bt_ad_clear_service_data(struct bt_ad *ad)\n{\n\tif (!ad)\n\t\treturn;\n\n\tqueue_remove_all(ad->service_data, NULL, NULL, uuid_destroy);\n}",
    "includes": [
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/eir.h\"",
      "#include \"src/shared/ad.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_remove_all",
          "args": [
            "ad->service_data",
            "NULL",
            "NULL",
            "uuid_destroy"
          ],
          "line": 812
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_all",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "318-362",
          "snippet": "unsigned int queue_remove_all(struct queue *queue, queue_match_func_t function,\n\t\t\t\tvoid *user_data, queue_destroy_func_t destroy)\n{\n\tstruct queue_entry *entry;\n\tunsigned int count = 0;\n\n\tif (!queue)\n\t\treturn 0;\n\n\tentry = queue->head;\n\n\tif (function) {\n\t\twhile (entry) {\n\t\t\tvoid *data;\n\t\t\tunsigned int entries = queue->entries;\n\n\t\t\tdata = queue_remove_if(queue, function, user_data);\n\t\t\tif (entries == queue->entries)\n\t\t\t\tbreak;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(data);\n\n\t\t\tcount++;\n\t\t}\n\t} else {\n\t\tqueue->head = NULL;\n\t\tqueue->tail = NULL;\n\t\tqueue->entries = 0;\n\n\t\twhile (entry) {\n\t\t\tstruct queue_entry *tmp = entry;\n\n\t\t\tentry = entry->next;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(tmp->data);\n\n\t\t\tfree(tmp);\n\t\t\tcount++;\n\t\t}\n\t}\n\n\treturn count;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nunsigned int queue_remove_all(struct queue *queue, queue_match_func_t function,\n\t\t\t\tvoid *user_data, queue_destroy_func_t destroy)\n{\n\tstruct queue_entry *entry;\n\tunsigned int count = 0;\n\n\tif (!queue)\n\t\treturn 0;\n\n\tentry = queue->head;\n\n\tif (function) {\n\t\twhile (entry) {\n\t\t\tvoid *data;\n\t\t\tunsigned int entries = queue->entries;\n\n\t\t\tdata = queue_remove_if(queue, function, user_data);\n\t\t\tif (entries == queue->entries)\n\t\t\t\tbreak;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(data);\n\n\t\t\tcount++;\n\t\t}\n\t} else {\n\t\tqueue->head = NULL;\n\t\tqueue->tail = NULL;\n\t\tqueue->entries = 0;\n\n\t\twhile (entry) {\n\t\t\tstruct queue_entry *tmp = entry;\n\n\t\t\tentry = entry->next;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(tmp->data);\n\n\t\t\tfree(tmp);\n\t\t\tcount++;\n\t\t}\n\t}\n\n\treturn count;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nvoid bt_ad_clear_service_data(struct bt_ad *ad)\n{\n\tif (!ad)\n\t\treturn;\n\n\tqueue_remove_all(ad->service_data, NULL, NULL, uuid_destroy);\n}"
  },
  {
    "function_name": "bt_ad_remove_service_data",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
    "lines": "790-805",
    "snippet": "bool bt_ad_remove_service_data(struct bt_ad *ad, bt_uuid_t *uuid)\n{\n\tstruct bt_ad_service_data *data;\n\n\tif (!ad)\n\t\treturn false;\n\n\tdata = queue_remove_if(ad->service_data, uuid_data_match, uuid);\n\n\tif (!data)\n\t\treturn false;\n\n\tuuid_destroy(data);\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/eir.h\"",
      "#include \"src/shared/ad.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "uuid_destroy",
          "args": [
            "data"
          ],
          "line": 802
        },
        "resolved": true,
        "details": {
          "function_name": "uuid_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "67-73",
          "snippet": "static void uuid_destroy(void *data)\n{\n\tstruct bt_ad_service_data *uuid_data = data;\n\n\tfree(uuid_data->data);\n\tfree(uuid_data);\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic void uuid_destroy(void *data)\n{\n\tstruct bt_ad_service_data *uuid_data = data;\n\n\tfree(uuid_data->data);\n\tfree(uuid_data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_remove_if",
          "args": [
            "ad->service_data",
            "uuid_data_match",
            "uuid"
          ],
          "line": 797
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_if",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "278-316",
          "snippet": "void *queue_remove_if(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry, *prev = NULL;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tentry = queue->head;\n\n\twhile (entry) {\n\t\tif (function(entry->data, user_data)) {\n\t\t\tvoid *data;\n\n\t\t\tif (prev)\n\t\t\t\tprev->next = entry->next;\n\t\t\telse\n\t\t\t\tqueue->head = entry->next;\n\n\t\t\tif (!entry->next)\n\t\t\t\tqueue->tail = prev;\n\n\t\t\tdata = entry->data;\n\n\t\t\tfree(entry);\n\t\t\tqueue->entries--;\n\n\t\t\treturn data;\n\t\t} else {\n\t\t\tprev = entry;\n\t\t\tentry = entry->next;\n\t\t}\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid *queue_remove_if(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry, *prev = NULL;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tentry = queue->head;\n\n\twhile (entry) {\n\t\tif (function(entry->data, user_data)) {\n\t\t\tvoid *data;\n\n\t\t\tif (prev)\n\t\t\t\tprev->next = entry->next;\n\t\t\telse\n\t\t\t\tqueue->head = entry->next;\n\n\t\t\tif (!entry->next)\n\t\t\t\tqueue->tail = prev;\n\n\t\t\tdata = entry->data;\n\n\t\t\tfree(entry);\n\t\t\tqueue->entries--;\n\n\t\t\treturn data;\n\t\t} else {\n\t\t\tprev = entry;\n\t\t\tentry = entry->next;\n\t\t}\n\t}\n\n\treturn NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nbool bt_ad_remove_service_data(struct bt_ad *ad, bt_uuid_t *uuid)\n{\n\tstruct bt_ad_service_data *data;\n\n\tif (!ad)\n\t\treturn false;\n\n\tdata = queue_remove_if(ad->service_data, uuid_data_match, uuid);\n\n\tif (!data)\n\t\treturn false;\n\n\tuuid_destroy(data);\n\n\treturn true;\n}"
  },
  {
    "function_name": "bt_ad_foreach_service_data",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
    "lines": "781-788",
    "snippet": "void bt_ad_foreach_service_data(struct bt_ad *ad, bt_ad_func_t func,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tif (!ad)\n\t\treturn;\n\n\tqueue_foreach(ad->service_data, func, user_data);\n}",
    "includes": [
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/eir.h\"",
      "#include \"src/shared/ad.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_foreach",
          "args": [
            "ad->service_data",
            "func",
            "user_data"
          ],
          "line": 787
        },
        "resolved": true,
        "details": {
          "function_name": "queue_foreach",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "203-224",
          "snippet": "void queue_foreach(struct queue *queue, queue_foreach_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue || !function)\n\t\treturn;\n\n\tentry = queue->head;\n\tif (!entry)\n\t\treturn;\n\n\tqueue_ref(queue);\n\twhile (entry && queue->head && queue->ref_count > 1) {\n\t\tstruct queue_entry *next;\n\n\t\tnext = entry->next;\n\t\tfunction(entry->data, user_data);\n\t\tentry = next;\n\t}\n\tqueue_unref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid queue_foreach(struct queue *queue, queue_foreach_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue || !function)\n\t\treturn;\n\n\tentry = queue->head;\n\tif (!entry)\n\t\treturn;\n\n\tqueue_ref(queue);\n\twhile (entry && queue->head && queue->ref_count > 1) {\n\t\tstruct queue_entry *next;\n\n\t\tnext = entry->next;\n\t\tfunction(entry->data, user_data);\n\t\tentry = next;\n\t}\n\tqueue_unref(queue);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nvoid bt_ad_foreach_service_data(struct bt_ad *ad, bt_ad_func_t func,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tif (!ad)\n\t\treturn;\n\n\tqueue_foreach(ad->service_data, func, user_data);\n}"
  },
  {
    "function_name": "bt_ad_has_service_data",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
    "lines": "769-779",
    "snippet": "bool bt_ad_has_service_data(struct bt_ad *ad,\n\t\t\t\t\tconst struct bt_ad_service_data *data)\n{\n\tif (!ad)\n\t\treturn false;\n\n\tif (!data)\n\t\treturn !queue_isempty(ad->service_data);\n\n\treturn queue_find(ad->service_data, service_data_match, data);\n}",
    "includes": [
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/eir.h\"",
      "#include \"src/shared/ad.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_find",
          "args": [
            "ad->service_data",
            "service_data_match",
            "data"
          ],
          "line": 778
        },
        "resolved": true,
        "details": {
          "function_name": "queue_find",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "231-247",
          "snippet": "void *queue_find(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tconst void *match_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tfor (entry = queue->head; entry; entry = entry->next)\n\t\tif (function(entry->data, match_data))\n\t\t\treturn entry->data;\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid *queue_find(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tconst void *match_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tfor (entry = queue->head; entry; entry = entry->next)\n\t\tif (function(entry->data, match_data))\n\t\t\treturn entry->data;\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_isempty",
          "args": [
            "ad->service_data"
          ],
          "line": 776
        },
        "resolved": true,
        "details": {
          "function_name": "queue_isempty",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "380-386",
          "snippet": "bool queue_isempty(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn true;\n\n\treturn queue->entries == 0;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_isempty(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn true;\n\n\treturn queue->entries == 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nbool bt_ad_has_service_data(struct bt_ad *ad,\n\t\t\t\t\tconst struct bt_ad_service_data *data)\n{\n\tif (!ad)\n\t\treturn false;\n\n\tif (!data)\n\t\treturn !queue_isempty(ad->service_data);\n\n\treturn queue_find(ad->service_data, service_data_match, data);\n}"
  },
  {
    "function_name": "service_data_match",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
    "lines": "755-767",
    "snippet": "static bool service_data_match(const void *data, const void *user_data)\n{\n\tconst struct bt_ad_service_data *s1 = data;\n\tconst struct bt_ad_service_data *s2 = user_data;\n\n\tif (bt_uuid_cmp(&s1->uuid, &s2->uuid))\n\t\treturn false;\n\n\tif (s1->len != s2->len)\n\t\treturn false;\n\n\treturn !memcmp(s1->data, s2->data, s1->len);\n}",
    "includes": [
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/eir.h\"",
      "#include \"src/shared/ad.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "memcmp",
          "args": [
            "s1->data",
            "s2->data",
            "s1->len"
          ],
          "line": 766
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_uuid_cmp",
          "args": [
            "&s1->uuid",
            "&s2->uuid"
          ],
          "line": 760
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic bool service_data_match(const void *data, const void *user_data)\n{\n\tconst struct bt_ad_service_data *s1 = data;\n\tconst struct bt_ad_service_data *s2 = user_data;\n\n\tif (bt_uuid_cmp(&s1->uuid, &s2->uuid))\n\t\treturn false;\n\n\tif (s1->len != s2->len)\n\t\treturn false;\n\n\treturn !memcmp(s1->data, s2->data, s1->len);\n}"
  },
  {
    "function_name": "bt_ad_add_service_data",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
    "lines": "712-753",
    "snippet": "bool bt_ad_add_service_data(struct bt_ad *ad, const bt_uuid_t *uuid, void *data,\n\t\t\t\t\t\t\t\tsize_t len)\n{\n\tstruct bt_ad_service_data *new_data;\n\n\tif (!ad)\n\t\treturn false;\n\n\tif (len > (MAX_ADV_DATA_LEN - 2 - (size_t)bt_uuid_len(uuid)))\n\t\treturn false;\n\n\tnew_data = queue_find(ad->service_data, service_uuid_match, uuid);\n\tif (new_data) {\n\t\tif (new_data->len == len && !memcmp(new_data->data, data, len))\n\t\t\treturn false;\n\t\tnew_data->data = realloc(new_data->data, len);\n\t\tmemcpy(new_data->data, data, len);\n\t\tnew_data->len = len;\n\t\treturn true;\n\t}\n\n\tnew_data = new0(struct bt_ad_service_data, 1);\n\n\tnew_data->uuid = *uuid;\n\n\tnew_data->data = malloc(len);\n\tif (!new_data->data) {\n\t\tfree(new_data);\n\t\treturn false;\n\t}\n\n\tmemcpy(new_data->data, data, len);\n\n\tnew_data->len = len;\n\n\tif (queue_push_tail(ad->service_data, new_data))\n\t\treturn true;\n\n\tuuid_destroy(new_data);\n\n\treturn false;\n}",
    "includes": [
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/eir.h\"",
      "#include \"src/shared/ad.h\""
    ],
    "macros_used": [
      "#define MAX_ADV_DATA_LEN 31"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "uuid_destroy",
          "args": [
            "new_data"
          ],
          "line": 750
        },
        "resolved": true,
        "details": {
          "function_name": "uuid_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "67-73",
          "snippet": "static void uuid_destroy(void *data)\n{\n\tstruct bt_ad_service_data *uuid_data = data;\n\n\tfree(uuid_data->data);\n\tfree(uuid_data);\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic void uuid_destroy(void *data)\n{\n\tstruct bt_ad_service_data *uuid_data = data;\n\n\tfree(uuid_data->data);\n\tfree(uuid_data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_push_tail",
          "args": [
            "ad->service_data",
            "new_data"
          ],
          "line": 747
        },
        "resolved": true,
        "details": {
          "function_name": "queue_push_tail",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "88-108",
          "snippet": "bool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "new_data->data",
            "data",
            "len"
          ],
          "line": 743
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "new_data"
          ],
          "line": 739
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "956-985",
          "snippet": "static void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}"
        }
      },
      {
        "call_info": {
          "callee": "malloc",
          "args": [
            "len"
          ],
          "line": 737
        },
        "resolved": true,
        "details": {
          "function_name": "btd_malloc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/util.c",
          "lines": "41-55",
          "snippet": "void *btd_malloc(size_t size)\n{\n\tif (__builtin_expect(!!size, 1)) {\n\t\tvoid *ptr;\n\n\t\tptr = malloc(size);\n\t\tif (ptr)\n\t\t\treturn ptr;\n\n\t\tfprintf(stderr, \"failed to allocate %zu bytes\\n\", size);\n\t\tabort();\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include <string.h>",
            "#include <limits.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include <string.h>\n#include <limits.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid *btd_malloc(size_t size)\n{\n\tif (__builtin_expect(!!size, 1)) {\n\t\tvoid *ptr;\n\n\t\tptr = malloc(size);\n\t\tif (ptr)\n\t\t\treturn ptr;\n\n\t\tfprintf(stderr, \"failed to allocate %zu bytes\\n\", size);\n\t\tabort();\n\t}\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "new0",
          "args": [
            "structbt_ad_service_data",
            "1"
          ],
          "line": 733
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "new_data->data",
            "data",
            "len"
          ],
          "line": 728
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "realloc",
          "args": [
            "new_data->data",
            "len"
          ],
          "line": 727
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcmp",
          "args": [
            "new_data->data",
            "data",
            "len"
          ],
          "line": 725
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "queue_find",
          "args": [
            "ad->service_data",
            "service_uuid_match",
            "uuid"
          ],
          "line": 723
        },
        "resolved": true,
        "details": {
          "function_name": "queue_find",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "231-247",
          "snippet": "void *queue_find(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tconst void *match_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tfor (entry = queue->head; entry; entry = entry->next)\n\t\tif (function(entry->data, match_data))\n\t\t\treturn entry->data;\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid *queue_find(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tconst void *match_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tfor (entry = queue->head; entry; entry = entry->next)\n\t\tif (function(entry->data, match_data))\n\t\t\treturn entry->data;\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_uuid_len",
          "args": [
            "uuid"
          ],
          "line": 720
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\n#define MAX_ADV_DATA_LEN 31\n\nbool bt_ad_add_service_data(struct bt_ad *ad, const bt_uuid_t *uuid, void *data,\n\t\t\t\t\t\t\t\tsize_t len)\n{\n\tstruct bt_ad_service_data *new_data;\n\n\tif (!ad)\n\t\treturn false;\n\n\tif (len > (MAX_ADV_DATA_LEN - 2 - (size_t)bt_uuid_len(uuid)))\n\t\treturn false;\n\n\tnew_data = queue_find(ad->service_data, service_uuid_match, uuid);\n\tif (new_data) {\n\t\tif (new_data->len == len && !memcmp(new_data->data, data, len))\n\t\t\treturn false;\n\t\tnew_data->data = realloc(new_data->data, len);\n\t\tmemcpy(new_data->data, data, len);\n\t\tnew_data->len = len;\n\t\treturn true;\n\t}\n\n\tnew_data = new0(struct bt_ad_service_data, 1);\n\n\tnew_data->uuid = *uuid;\n\n\tnew_data->data = malloc(len);\n\tif (!new_data->data) {\n\t\tfree(new_data);\n\t\treturn false;\n\t}\n\n\tmemcpy(new_data->data, data, len);\n\n\tnew_data->len = len;\n\n\tif (queue_push_tail(ad->service_data, new_data))\n\t\treturn true;\n\n\tuuid_destroy(new_data);\n\n\treturn false;\n}"
  },
  {
    "function_name": "service_uuid_match",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
    "lines": "704-710",
    "snippet": "static bool service_uuid_match(const void *data, const void *user_data)\n{\n\tconst struct bt_ad_service_data *s = data;\n\tconst bt_uuid_t *uuid = user_data;\n\n\treturn !bt_uuid_cmp(&s->uuid, uuid);\n}",
    "includes": [
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/eir.h\"",
      "#include \"src/shared/ad.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bt_uuid_cmp",
          "args": [
            "&s->uuid",
            "uuid"
          ],
          "line": 709
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic bool service_uuid_match(const void *data, const void *user_data)\n{\n\tconst struct bt_ad_service_data *s = data;\n\tconst bt_uuid_t *uuid = user_data;\n\n\treturn !bt_uuid_cmp(&s->uuid, uuid);\n}"
  },
  {
    "function_name": "bt_ad_clear_solicit_uuid",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
    "lines": "695-701",
    "snippet": "void bt_ad_clear_solicit_uuid(struct bt_ad *ad)\n{\n\tif (!ad)\n\t\treturn;\n\n\tqueue_remove_all(ad->solicit_uuids, NULL, NULL, free);\n}",
    "includes": [
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/eir.h\"",
      "#include \"src/shared/ad.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_remove_all",
          "args": [
            "ad->solicit_uuids",
            "NULL",
            "NULL",
            "free"
          ],
          "line": 700
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_all",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "318-362",
          "snippet": "unsigned int queue_remove_all(struct queue *queue, queue_match_func_t function,\n\t\t\t\tvoid *user_data, queue_destroy_func_t destroy)\n{\n\tstruct queue_entry *entry;\n\tunsigned int count = 0;\n\n\tif (!queue)\n\t\treturn 0;\n\n\tentry = queue->head;\n\n\tif (function) {\n\t\twhile (entry) {\n\t\t\tvoid *data;\n\t\t\tunsigned int entries = queue->entries;\n\n\t\t\tdata = queue_remove_if(queue, function, user_data);\n\t\t\tif (entries == queue->entries)\n\t\t\t\tbreak;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(data);\n\n\t\t\tcount++;\n\t\t}\n\t} else {\n\t\tqueue->head = NULL;\n\t\tqueue->tail = NULL;\n\t\tqueue->entries = 0;\n\n\t\twhile (entry) {\n\t\t\tstruct queue_entry *tmp = entry;\n\n\t\t\tentry = entry->next;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(tmp->data);\n\n\t\t\tfree(tmp);\n\t\t\tcount++;\n\t\t}\n\t}\n\n\treturn count;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nunsigned int queue_remove_all(struct queue *queue, queue_match_func_t function,\n\t\t\t\tvoid *user_data, queue_destroy_func_t destroy)\n{\n\tstruct queue_entry *entry;\n\tunsigned int count = 0;\n\n\tif (!queue)\n\t\treturn 0;\n\n\tentry = queue->head;\n\n\tif (function) {\n\t\twhile (entry) {\n\t\t\tvoid *data;\n\t\t\tunsigned int entries = queue->entries;\n\n\t\t\tdata = queue_remove_if(queue, function, user_data);\n\t\t\tif (entries == queue->entries)\n\t\t\t\tbreak;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(data);\n\n\t\t\tcount++;\n\t\t}\n\t} else {\n\t\tqueue->head = NULL;\n\t\tqueue->tail = NULL;\n\t\tqueue->entries = 0;\n\n\t\twhile (entry) {\n\t\t\tstruct queue_entry *tmp = entry;\n\n\t\t\tentry = entry->next;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(tmp->data);\n\n\t\t\tfree(tmp);\n\t\t\tcount++;\n\t\t}\n\t}\n\n\treturn count;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nvoid bt_ad_clear_solicit_uuid(struct bt_ad *ad)\n{\n\tif (!ad)\n\t\treturn;\n\n\tqueue_remove_all(ad->solicit_uuids, NULL, NULL, free);\n}"
  },
  {
    "function_name": "bt_ad_remove_solicit_uuid",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
    "lines": "687-693",
    "snippet": "bool bt_ad_remove_solicit_uuid(struct bt_ad *ad, bt_uuid_t *uuid)\n{\n\tif (!ad)\n\t\treturn false;\n\n\treturn queue_remove_uuid(ad->solicit_uuids, uuid);\n}",
    "includes": [
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/eir.h\"",
      "#include \"src/shared/ad.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_remove_uuid",
          "args": [
            "ad->solicit_uuids",
            "uuid"
          ],
          "line": 692
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_uuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "526-541",
          "snippet": "static bool queue_remove_uuid(struct queue *queue, bt_uuid_t *uuid)\n{\n\tbt_uuid_t *removed;\n\n\tif (!queue || !uuid)\n\t\treturn false;\n\n\tremoved = queue_remove_if(queue, uuid_match, uuid);\n\n\tif (removed) {\n\t\tfree(removed);\n\t\treturn true;\n\t}\n\n\treturn false;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic bool queue_remove_uuid(struct queue *queue, bt_uuid_t *uuid)\n{\n\tbt_uuid_t *removed;\n\n\tif (!queue || !uuid)\n\t\treturn false;\n\n\tremoved = queue_remove_if(queue, uuid_match, uuid);\n\n\tif (removed) {\n\t\tfree(removed);\n\t\treturn true;\n\t}\n\n\treturn false;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nbool bt_ad_remove_solicit_uuid(struct bt_ad *ad, bt_uuid_t *uuid)\n{\n\tif (!ad)\n\t\treturn false;\n\n\treturn queue_remove_uuid(ad->solicit_uuids, uuid);\n}"
  },
  {
    "function_name": "bt_ad_add_solicit_uuid",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
    "lines": "679-685",
    "snippet": "bool bt_ad_add_solicit_uuid(struct bt_ad *ad, const bt_uuid_t *uuid)\n{\n\tif (!ad)\n\t\treturn false;\n\n\treturn queue_add_uuid(ad->solicit_uuids, uuid);\n}",
    "includes": [
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/eir.h\"",
      "#include \"src/shared/ad.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_add_uuid",
          "args": [
            "ad->solicit_uuids",
            "uuid"
          ],
          "line": 684
        },
        "resolved": true,
        "details": {
          "function_name": "queue_add_uuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "499-516",
          "snippet": "static bool queue_add_uuid(struct queue *queue, const bt_uuid_t *uuid)\n{\n\tbt_uuid_t *new_uuid;\n\n\tif (!queue)\n\t\treturn false;\n\n\tnew_uuid = new0(bt_uuid_t, 1);\n\n\t*new_uuid = *uuid;\n\n\tif (queue_push_tail(queue, new_uuid))\n\t\treturn true;\n\n\tfree(new_uuid);\n\n\treturn false;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic bool queue_add_uuid(struct queue *queue, const bt_uuid_t *uuid)\n{\n\tbt_uuid_t *new_uuid;\n\n\tif (!queue)\n\t\treturn false;\n\n\tnew_uuid = new0(bt_uuid_t, 1);\n\n\t*new_uuid = *uuid;\n\n\tif (queue_push_tail(queue, new_uuid))\n\t\treturn true;\n\n\tfree(new_uuid);\n\n\treturn false;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nbool bt_ad_add_solicit_uuid(struct bt_ad *ad, const bt_uuid_t *uuid)\n{\n\tif (!ad)\n\t\treturn false;\n\n\treturn queue_add_uuid(ad->solicit_uuids, uuid);\n}"
  },
  {
    "function_name": "bt_ad_clear_manufacturer_data",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
    "lines": "671-677",
    "snippet": "void bt_ad_clear_manufacturer_data(struct bt_ad *ad)\n{\n\tif (!ad)\n\t\treturn;\n\n\tqueue_remove_all(ad->manufacturer_data, NULL, NULL, manuf_destroy);\n}",
    "includes": [
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/eir.h\"",
      "#include \"src/shared/ad.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_remove_all",
          "args": [
            "ad->manufacturer_data",
            "NULL",
            "NULL",
            "manuf_destroy"
          ],
          "line": 676
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_all",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "318-362",
          "snippet": "unsigned int queue_remove_all(struct queue *queue, queue_match_func_t function,\n\t\t\t\tvoid *user_data, queue_destroy_func_t destroy)\n{\n\tstruct queue_entry *entry;\n\tunsigned int count = 0;\n\n\tif (!queue)\n\t\treturn 0;\n\n\tentry = queue->head;\n\n\tif (function) {\n\t\twhile (entry) {\n\t\t\tvoid *data;\n\t\t\tunsigned int entries = queue->entries;\n\n\t\t\tdata = queue_remove_if(queue, function, user_data);\n\t\t\tif (entries == queue->entries)\n\t\t\t\tbreak;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(data);\n\n\t\t\tcount++;\n\t\t}\n\t} else {\n\t\tqueue->head = NULL;\n\t\tqueue->tail = NULL;\n\t\tqueue->entries = 0;\n\n\t\twhile (entry) {\n\t\t\tstruct queue_entry *tmp = entry;\n\n\t\t\tentry = entry->next;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(tmp->data);\n\n\t\t\tfree(tmp);\n\t\t\tcount++;\n\t\t}\n\t}\n\n\treturn count;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nunsigned int queue_remove_all(struct queue *queue, queue_match_func_t function,\n\t\t\t\tvoid *user_data, queue_destroy_func_t destroy)\n{\n\tstruct queue_entry *entry;\n\tunsigned int count = 0;\n\n\tif (!queue)\n\t\treturn 0;\n\n\tentry = queue->head;\n\n\tif (function) {\n\t\twhile (entry) {\n\t\t\tvoid *data;\n\t\t\tunsigned int entries = queue->entries;\n\n\t\t\tdata = queue_remove_if(queue, function, user_data);\n\t\t\tif (entries == queue->entries)\n\t\t\t\tbreak;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(data);\n\n\t\t\tcount++;\n\t\t}\n\t} else {\n\t\tqueue->head = NULL;\n\t\tqueue->tail = NULL;\n\t\tqueue->entries = 0;\n\n\t\twhile (entry) {\n\t\t\tstruct queue_entry *tmp = entry;\n\n\t\t\tentry = entry->next;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(tmp->data);\n\n\t\t\tfree(tmp);\n\t\t\tcount++;\n\t\t}\n\t}\n\n\treturn count;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nvoid bt_ad_clear_manufacturer_data(struct bt_ad *ad)\n{\n\tif (!ad)\n\t\treturn;\n\n\tqueue_remove_all(ad->manufacturer_data, NULL, NULL, manuf_destroy);\n}"
  },
  {
    "function_name": "bt_ad_remove_manufacturer_data",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
    "lines": "653-669",
    "snippet": "bool bt_ad_remove_manufacturer_data(struct bt_ad *ad, uint16_t manufacturer_id)\n{\n\tstruct bt_ad_manufacturer_data *data;\n\n\tif (!ad)\n\t\treturn false;\n\n\tdata = queue_remove_if(ad->manufacturer_data, manuf_match,\n\t\t\t\t\t\tUINT_TO_PTR(manufacturer_id));\n\n\tif (!data)\n\t\treturn false;\n\n\tmanuf_destroy(data);\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/eir.h\"",
      "#include \"src/shared/ad.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "manuf_destroy",
          "args": [
            "data"
          ],
          "line": 666
        },
        "resolved": true,
        "details": {
          "function_name": "manuf_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "83-89",
          "snippet": "static void manuf_destroy(void *data)\n{\n\tstruct bt_ad_manufacturer_data *manuf = data;\n\n\tfree(manuf->data);\n\tfree(manuf);\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic void manuf_destroy(void *data)\n{\n\tstruct bt_ad_manufacturer_data *manuf = data;\n\n\tfree(manuf->data);\n\tfree(manuf);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_remove_if",
          "args": [
            "ad->manufacturer_data",
            "manuf_match",
            "UINT_TO_PTR(manufacturer_id)"
          ],
          "line": 660
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_if",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "278-316",
          "snippet": "void *queue_remove_if(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry, *prev = NULL;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tentry = queue->head;\n\n\twhile (entry) {\n\t\tif (function(entry->data, user_data)) {\n\t\t\tvoid *data;\n\n\t\t\tif (prev)\n\t\t\t\tprev->next = entry->next;\n\t\t\telse\n\t\t\t\tqueue->head = entry->next;\n\n\t\t\tif (!entry->next)\n\t\t\t\tqueue->tail = prev;\n\n\t\t\tdata = entry->data;\n\n\t\t\tfree(entry);\n\t\t\tqueue->entries--;\n\n\t\t\treturn data;\n\t\t} else {\n\t\t\tprev = entry;\n\t\t\tentry = entry->next;\n\t\t}\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid *queue_remove_if(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry, *prev = NULL;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tentry = queue->head;\n\n\twhile (entry) {\n\t\tif (function(entry->data, user_data)) {\n\t\t\tvoid *data;\n\n\t\t\tif (prev)\n\t\t\t\tprev->next = entry->next;\n\t\t\telse\n\t\t\t\tqueue->head = entry->next;\n\n\t\t\tif (!entry->next)\n\t\t\t\tqueue->tail = prev;\n\n\t\t\tdata = entry->data;\n\n\t\t\tfree(entry);\n\t\t\tqueue->entries--;\n\n\t\t\treturn data;\n\t\t} else {\n\t\t\tprev = entry;\n\t\t\tentry = entry->next;\n\t\t}\n\t}\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "UINT_TO_PTR",
          "args": [
            "manufacturer_id"
          ],
          "line": 661
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nbool bt_ad_remove_manufacturer_data(struct bt_ad *ad, uint16_t manufacturer_id)\n{\n\tstruct bt_ad_manufacturer_data *data;\n\n\tif (!ad)\n\t\treturn false;\n\n\tdata = queue_remove_if(ad->manufacturer_data, manuf_match,\n\t\t\t\t\t\tUINT_TO_PTR(manufacturer_id));\n\n\tif (!data)\n\t\treturn false;\n\n\tmanuf_destroy(data);\n\n\treturn true;\n}"
  },
  {
    "function_name": "bt_ad_foreach_manufacturer_data",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
    "lines": "644-651",
    "snippet": "void bt_ad_foreach_manufacturer_data(struct bt_ad *ad, bt_ad_func_t func,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tif (!ad)\n\t\treturn;\n\n\tqueue_foreach(ad->manufacturer_data, func, user_data);\n}",
    "includes": [
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/eir.h\"",
      "#include \"src/shared/ad.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_foreach",
          "args": [
            "ad->manufacturer_data",
            "func",
            "user_data"
          ],
          "line": 650
        },
        "resolved": true,
        "details": {
          "function_name": "queue_foreach",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "203-224",
          "snippet": "void queue_foreach(struct queue *queue, queue_foreach_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue || !function)\n\t\treturn;\n\n\tentry = queue->head;\n\tif (!entry)\n\t\treturn;\n\n\tqueue_ref(queue);\n\twhile (entry && queue->head && queue->ref_count > 1) {\n\t\tstruct queue_entry *next;\n\n\t\tnext = entry->next;\n\t\tfunction(entry->data, user_data);\n\t\tentry = next;\n\t}\n\tqueue_unref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid queue_foreach(struct queue *queue, queue_foreach_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue || !function)\n\t\treturn;\n\n\tentry = queue->head;\n\tif (!entry)\n\t\treturn;\n\n\tqueue_ref(queue);\n\twhile (entry && queue->head && queue->ref_count > 1) {\n\t\tstruct queue_entry *next;\n\n\t\tnext = entry->next;\n\t\tfunction(entry->data, user_data);\n\t\tentry = next;\n\t}\n\tqueue_unref(queue);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nvoid bt_ad_foreach_manufacturer_data(struct bt_ad *ad, bt_ad_func_t func,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tif (!ad)\n\t\treturn;\n\n\tqueue_foreach(ad->manufacturer_data, func, user_data);\n}"
  },
  {
    "function_name": "bt_ad_has_manufacturer_data",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
    "lines": "632-642",
    "snippet": "bool bt_ad_has_manufacturer_data(struct bt_ad *ad,\n\t\t\t\tconst struct bt_ad_manufacturer_data *data)\n{\n\tif (!ad)\n\t\treturn false;\n\n\tif (!data)\n\t\treturn !queue_isempty(ad->manufacturer_data);\n\n\treturn queue_find(ad->manufacturer_data, manufacturer_data_match, data);\n}",
    "includes": [
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/eir.h\"",
      "#include \"src/shared/ad.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_find",
          "args": [
            "ad->manufacturer_data",
            "manufacturer_data_match",
            "data"
          ],
          "line": 641
        },
        "resolved": true,
        "details": {
          "function_name": "queue_find",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "231-247",
          "snippet": "void *queue_find(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tconst void *match_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tfor (entry = queue->head; entry; entry = entry->next)\n\t\tif (function(entry->data, match_data))\n\t\t\treturn entry->data;\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid *queue_find(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tconst void *match_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tfor (entry = queue->head; entry; entry = entry->next)\n\t\tif (function(entry->data, match_data))\n\t\t\treturn entry->data;\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_isempty",
          "args": [
            "ad->manufacturer_data"
          ],
          "line": 639
        },
        "resolved": true,
        "details": {
          "function_name": "queue_isempty",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "380-386",
          "snippet": "bool queue_isempty(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn true;\n\n\treturn queue->entries == 0;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_isempty(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn true;\n\n\treturn queue->entries == 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nbool bt_ad_has_manufacturer_data(struct bt_ad *ad,\n\t\t\t\tconst struct bt_ad_manufacturer_data *data)\n{\n\tif (!ad)\n\t\treturn false;\n\n\tif (!data)\n\t\treturn !queue_isempty(ad->manufacturer_data);\n\n\treturn queue_find(ad->manufacturer_data, manufacturer_data_match, data);\n}"
  },
  {
    "function_name": "manufacturer_data_match",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
    "lines": "618-630",
    "snippet": "static bool manufacturer_data_match(const void *data, const void *user_data)\n{\n\tconst struct bt_ad_manufacturer_data *m1 = data;\n\tconst struct bt_ad_manufacturer_data *m2 = user_data;\n\n\tif (m1->manufacturer_id != m2->manufacturer_id)\n\t\treturn false;\n\n\tif (m1->len != m2->len)\n\t\treturn false;\n\n\treturn !memcmp(m1->data, m2->data, m1->len);\n}",
    "includes": [
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/eir.h\"",
      "#include \"src/shared/ad.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "memcmp",
          "args": [
            "m1->data",
            "m2->data",
            "m1->len"
          ],
          "line": 629
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic bool manufacturer_data_match(const void *data, const void *user_data)\n{\n\tconst struct bt_ad_manufacturer_data *m1 = data;\n\tconst struct bt_ad_manufacturer_data *m2 = user_data;\n\n\tif (m1->manufacturer_id != m2->manufacturer_id)\n\t\treturn false;\n\n\tif (m1->len != m2->len)\n\t\treturn false;\n\n\treturn !memcmp(m1->data, m2->data, m1->len);\n}"
  },
  {
    "function_name": "bt_ad_add_manufacturer_data",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
    "lines": "575-616",
    "snippet": "bool bt_ad_add_manufacturer_data(struct bt_ad *ad, uint16_t manufacturer_id,\n\t\t\t\t\t\t\tvoid *data, size_t len)\n{\n\tstruct bt_ad_manufacturer_data *new_data;\n\n\tif (!ad)\n\t\treturn false;\n\n\tif (len > (MAX_ADV_DATA_LEN - 2 - sizeof(uint16_t)))\n\t\treturn false;\n\n\tnew_data = queue_find(ad->manufacturer_data, manufacturer_id_data_match,\n\t\t\t\t\t\tUINT_TO_PTR(manufacturer_id));\n\tif (new_data) {\n\t\tif (new_data->len == len && !memcmp(new_data->data, data, len))\n\t\t\treturn false;\n\t\tnew_data->data = realloc(new_data->data, len);\n\t\tmemcpy(new_data->data, data, len);\n\t\tnew_data->len = len;\n\t\treturn true;\n\t}\n\n\tnew_data = new0(struct bt_ad_manufacturer_data, 1);\n\tnew_data->manufacturer_id = manufacturer_id;\n\n\tnew_data->data = malloc(len);\n\tif (!new_data->data) {\n\t\tfree(new_data);\n\t\treturn false;\n\t}\n\n\tmemcpy(new_data->data, data, len);\n\n\tnew_data->len = len;\n\n\tif (queue_push_tail(ad->manufacturer_data, new_data))\n\t\treturn true;\n\n\tmanuf_destroy(new_data);\n\n\treturn false;\n}",
    "includes": [
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/eir.h\"",
      "#include \"src/shared/ad.h\""
    ],
    "macros_used": [
      "#define MAX_ADV_DATA_LEN 31"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "manuf_destroy",
          "args": [
            "new_data"
          ],
          "line": 613
        },
        "resolved": true,
        "details": {
          "function_name": "manuf_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "83-89",
          "snippet": "static void manuf_destroy(void *data)\n{\n\tstruct bt_ad_manufacturer_data *manuf = data;\n\n\tfree(manuf->data);\n\tfree(manuf);\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic void manuf_destroy(void *data)\n{\n\tstruct bt_ad_manufacturer_data *manuf = data;\n\n\tfree(manuf->data);\n\tfree(manuf);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_push_tail",
          "args": [
            "ad->manufacturer_data",
            "new_data"
          ],
          "line": 610
        },
        "resolved": true,
        "details": {
          "function_name": "queue_push_tail",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "88-108",
          "snippet": "bool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "new_data->data",
            "data",
            "len"
          ],
          "line": 606
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "new_data"
          ],
          "line": 602
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "956-985",
          "snippet": "static void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}"
        }
      },
      {
        "call_info": {
          "callee": "malloc",
          "args": [
            "len"
          ],
          "line": 600
        },
        "resolved": true,
        "details": {
          "function_name": "btd_malloc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/util.c",
          "lines": "41-55",
          "snippet": "void *btd_malloc(size_t size)\n{\n\tif (__builtin_expect(!!size, 1)) {\n\t\tvoid *ptr;\n\n\t\tptr = malloc(size);\n\t\tif (ptr)\n\t\t\treturn ptr;\n\n\t\tfprintf(stderr, \"failed to allocate %zu bytes\\n\", size);\n\t\tabort();\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include <string.h>",
            "#include <limits.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include <string.h>\n#include <limits.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid *btd_malloc(size_t size)\n{\n\tif (__builtin_expect(!!size, 1)) {\n\t\tvoid *ptr;\n\n\t\tptr = malloc(size);\n\t\tif (ptr)\n\t\t\treturn ptr;\n\n\t\tfprintf(stderr, \"failed to allocate %zu bytes\\n\", size);\n\t\tabort();\n\t}\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "new0",
          "args": [
            "structbt_ad_manufacturer_data",
            "1"
          ],
          "line": 597
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "new_data->data",
            "data",
            "len"
          ],
          "line": 592
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "realloc",
          "args": [
            "new_data->data",
            "len"
          ],
          "line": 591
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcmp",
          "args": [
            "new_data->data",
            "data",
            "len"
          ],
          "line": 589
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "queue_find",
          "args": [
            "ad->manufacturer_data",
            "manufacturer_id_data_match",
            "UINT_TO_PTR(manufacturer_id)"
          ],
          "line": 586
        },
        "resolved": true,
        "details": {
          "function_name": "queue_find",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "231-247",
          "snippet": "void *queue_find(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tconst void *match_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tfor (entry = queue->head; entry; entry = entry->next)\n\t\tif (function(entry->data, match_data))\n\t\t\treturn entry->data;\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid *queue_find(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tconst void *match_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tfor (entry = queue->head; entry; entry = entry->next)\n\t\tif (function(entry->data, match_data))\n\t\t\treturn entry->data;\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "UINT_TO_PTR",
          "args": [
            "manufacturer_id"
          ],
          "line": 587
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\n#define MAX_ADV_DATA_LEN 31\n\nbool bt_ad_add_manufacturer_data(struct bt_ad *ad, uint16_t manufacturer_id,\n\t\t\t\t\t\t\tvoid *data, size_t len)\n{\n\tstruct bt_ad_manufacturer_data *new_data;\n\n\tif (!ad)\n\t\treturn false;\n\n\tif (len > (MAX_ADV_DATA_LEN - 2 - sizeof(uint16_t)))\n\t\treturn false;\n\n\tnew_data = queue_find(ad->manufacturer_data, manufacturer_id_data_match,\n\t\t\t\t\t\tUINT_TO_PTR(manufacturer_id));\n\tif (new_data) {\n\t\tif (new_data->len == len && !memcmp(new_data->data, data, len))\n\t\t\treturn false;\n\t\tnew_data->data = realloc(new_data->data, len);\n\t\tmemcpy(new_data->data, data, len);\n\t\tnew_data->len = len;\n\t\treturn true;\n\t}\n\n\tnew_data = new0(struct bt_ad_manufacturer_data, 1);\n\tnew_data->manufacturer_id = manufacturer_id;\n\n\tnew_data->data = malloc(len);\n\tif (!new_data->data) {\n\t\tfree(new_data);\n\t\treturn false;\n\t}\n\n\tmemcpy(new_data->data, data, len);\n\n\tnew_data->len = len;\n\n\tif (queue_push_tail(ad->manufacturer_data, new_data))\n\t\treturn true;\n\n\tmanuf_destroy(new_data);\n\n\treturn false;\n}"
  },
  {
    "function_name": "manufacturer_id_data_match",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
    "lines": "567-573",
    "snippet": "static bool manufacturer_id_data_match(const void *data, const void *user_data)\n{\n\tconst struct bt_ad_manufacturer_data *m = data;\n\tuint16_t id = PTR_TO_UINT(user_data);\n\n\treturn m->manufacturer_id == id;\n}",
    "includes": [
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/eir.h\"",
      "#include \"src/shared/ad.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "PTR_TO_UINT",
          "args": [
            "user_data"
          ],
          "line": 570
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic bool manufacturer_id_data_match(const void *data, const void *user_data)\n{\n\tconst struct bt_ad_manufacturer_data *m = data;\n\tuint16_t id = PTR_TO_UINT(user_data);\n\n\treturn m->manufacturer_id == id;\n}"
  },
  {
    "function_name": "bt_ad_clear_service_uuid",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
    "lines": "559-565",
    "snippet": "void bt_ad_clear_service_uuid(struct bt_ad *ad)\n{\n\tif (!ad)\n\t\treturn;\n\n\tqueue_remove_all(ad->service_uuids, NULL, NULL, free);\n}",
    "includes": [
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/eir.h\"",
      "#include \"src/shared/ad.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_remove_all",
          "args": [
            "ad->service_uuids",
            "NULL",
            "NULL",
            "free"
          ],
          "line": 564
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_all",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "318-362",
          "snippet": "unsigned int queue_remove_all(struct queue *queue, queue_match_func_t function,\n\t\t\t\tvoid *user_data, queue_destroy_func_t destroy)\n{\n\tstruct queue_entry *entry;\n\tunsigned int count = 0;\n\n\tif (!queue)\n\t\treturn 0;\n\n\tentry = queue->head;\n\n\tif (function) {\n\t\twhile (entry) {\n\t\t\tvoid *data;\n\t\t\tunsigned int entries = queue->entries;\n\n\t\t\tdata = queue_remove_if(queue, function, user_data);\n\t\t\tif (entries == queue->entries)\n\t\t\t\tbreak;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(data);\n\n\t\t\tcount++;\n\t\t}\n\t} else {\n\t\tqueue->head = NULL;\n\t\tqueue->tail = NULL;\n\t\tqueue->entries = 0;\n\n\t\twhile (entry) {\n\t\t\tstruct queue_entry *tmp = entry;\n\n\t\t\tentry = entry->next;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(tmp->data);\n\n\t\t\tfree(tmp);\n\t\t\tcount++;\n\t\t}\n\t}\n\n\treturn count;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nunsigned int queue_remove_all(struct queue *queue, queue_match_func_t function,\n\t\t\t\tvoid *user_data, queue_destroy_func_t destroy)\n{\n\tstruct queue_entry *entry;\n\tunsigned int count = 0;\n\n\tif (!queue)\n\t\treturn 0;\n\n\tentry = queue->head;\n\n\tif (function) {\n\t\twhile (entry) {\n\t\t\tvoid *data;\n\t\t\tunsigned int entries = queue->entries;\n\n\t\t\tdata = queue_remove_if(queue, function, user_data);\n\t\t\tif (entries == queue->entries)\n\t\t\t\tbreak;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(data);\n\n\t\t\tcount++;\n\t\t}\n\t} else {\n\t\tqueue->head = NULL;\n\t\tqueue->tail = NULL;\n\t\tqueue->entries = 0;\n\n\t\twhile (entry) {\n\t\t\tstruct queue_entry *tmp = entry;\n\n\t\t\tentry = entry->next;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(tmp->data);\n\n\t\t\tfree(tmp);\n\t\t\tcount++;\n\t\t}\n\t}\n\n\treturn count;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nvoid bt_ad_clear_service_uuid(struct bt_ad *ad)\n{\n\tif (!ad)\n\t\treturn;\n\n\tqueue_remove_all(ad->service_uuids, NULL, NULL, free);\n}"
  },
  {
    "function_name": "bt_ad_remove_service_uuid",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
    "lines": "551-557",
    "snippet": "bool bt_ad_remove_service_uuid(struct bt_ad *ad, bt_uuid_t *uuid)\n{\n\tif (!ad)\n\t\treturn false;\n\n\treturn queue_remove_uuid(ad->service_uuids, uuid);\n}",
    "includes": [
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/eir.h\"",
      "#include \"src/shared/ad.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_remove_uuid",
          "args": [
            "ad->service_uuids",
            "uuid"
          ],
          "line": 556
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_uuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "526-541",
          "snippet": "static bool queue_remove_uuid(struct queue *queue, bt_uuid_t *uuid)\n{\n\tbt_uuid_t *removed;\n\n\tif (!queue || !uuid)\n\t\treturn false;\n\n\tremoved = queue_remove_if(queue, uuid_match, uuid);\n\n\tif (removed) {\n\t\tfree(removed);\n\t\treturn true;\n\t}\n\n\treturn false;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic bool queue_remove_uuid(struct queue *queue, bt_uuid_t *uuid)\n{\n\tbt_uuid_t *removed;\n\n\tif (!queue || !uuid)\n\t\treturn false;\n\n\tremoved = queue_remove_if(queue, uuid_match, uuid);\n\n\tif (removed) {\n\t\tfree(removed);\n\t\treturn true;\n\t}\n\n\treturn false;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nbool bt_ad_remove_service_uuid(struct bt_ad *ad, bt_uuid_t *uuid)\n{\n\tif (!ad)\n\t\treturn false;\n\n\treturn queue_remove_uuid(ad->service_uuids, uuid);\n}"
  },
  {
    "function_name": "bt_ad_add_service_uuid",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
    "lines": "543-549",
    "snippet": "bool bt_ad_add_service_uuid(struct bt_ad *ad, const bt_uuid_t *uuid)\n{\n\tif (!ad)\n\t\treturn false;\n\n\treturn queue_add_uuid(ad->service_uuids, uuid);\n}",
    "includes": [
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/eir.h\"",
      "#include \"src/shared/ad.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_add_uuid",
          "args": [
            "ad->service_uuids",
            "uuid"
          ],
          "line": 548
        },
        "resolved": true,
        "details": {
          "function_name": "queue_add_uuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "499-516",
          "snippet": "static bool queue_add_uuid(struct queue *queue, const bt_uuid_t *uuid)\n{\n\tbt_uuid_t *new_uuid;\n\n\tif (!queue)\n\t\treturn false;\n\n\tnew_uuid = new0(bt_uuid_t, 1);\n\n\t*new_uuid = *uuid;\n\n\tif (queue_push_tail(queue, new_uuid))\n\t\treturn true;\n\n\tfree(new_uuid);\n\n\treturn false;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic bool queue_add_uuid(struct queue *queue, const bt_uuid_t *uuid)\n{\n\tbt_uuid_t *new_uuid;\n\n\tif (!queue)\n\t\treturn false;\n\n\tnew_uuid = new0(bt_uuid_t, 1);\n\n\t*new_uuid = *uuid;\n\n\tif (queue_push_tail(queue, new_uuid))\n\t\treturn true;\n\n\tfree(new_uuid);\n\n\treturn false;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nbool bt_ad_add_service_uuid(struct bt_ad *ad, const bt_uuid_t *uuid)\n{\n\tif (!ad)\n\t\treturn false;\n\n\treturn queue_add_uuid(ad->service_uuids, uuid);\n}"
  },
  {
    "function_name": "queue_remove_uuid",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
    "lines": "526-541",
    "snippet": "static bool queue_remove_uuid(struct queue *queue, bt_uuid_t *uuid)\n{\n\tbt_uuid_t *removed;\n\n\tif (!queue || !uuid)\n\t\treturn false;\n\n\tremoved = queue_remove_if(queue, uuid_match, uuid);\n\n\tif (removed) {\n\t\tfree(removed);\n\t\treturn true;\n\t}\n\n\treturn false;\n}",
    "includes": [
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/eir.h\"",
      "#include \"src/shared/ad.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "removed"
          ],
          "line": 536
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "956-985",
          "snippet": "static void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_remove_if",
          "args": [
            "queue",
            "uuid_match",
            "uuid"
          ],
          "line": 533
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_if",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "278-316",
          "snippet": "void *queue_remove_if(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry, *prev = NULL;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tentry = queue->head;\n\n\twhile (entry) {\n\t\tif (function(entry->data, user_data)) {\n\t\t\tvoid *data;\n\n\t\t\tif (prev)\n\t\t\t\tprev->next = entry->next;\n\t\t\telse\n\t\t\t\tqueue->head = entry->next;\n\n\t\t\tif (!entry->next)\n\t\t\t\tqueue->tail = prev;\n\n\t\t\tdata = entry->data;\n\n\t\t\tfree(entry);\n\t\t\tqueue->entries--;\n\n\t\t\treturn data;\n\t\t} else {\n\t\t\tprev = entry;\n\t\t\tentry = entry->next;\n\t\t}\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid *queue_remove_if(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry, *prev = NULL;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tentry = queue->head;\n\n\twhile (entry) {\n\t\tif (function(entry->data, user_data)) {\n\t\t\tvoid *data;\n\n\t\t\tif (prev)\n\t\t\t\tprev->next = entry->next;\n\t\t\telse\n\t\t\t\tqueue->head = entry->next;\n\n\t\t\tif (!entry->next)\n\t\t\t\tqueue->tail = prev;\n\n\t\t\tdata = entry->data;\n\n\t\t\tfree(entry);\n\t\t\tqueue->entries--;\n\n\t\t\treturn data;\n\t\t} else {\n\t\t\tprev = entry;\n\t\t\tentry = entry->next;\n\t\t}\n\t}\n\n\treturn NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic bool queue_remove_uuid(struct queue *queue, bt_uuid_t *uuid)\n{\n\tbt_uuid_t *removed;\n\n\tif (!queue || !uuid)\n\t\treturn false;\n\n\tremoved = queue_remove_if(queue, uuid_match, uuid);\n\n\tif (removed) {\n\t\tfree(removed);\n\t\treturn true;\n\t}\n\n\treturn false;\n}"
  },
  {
    "function_name": "uuid_match",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
    "lines": "518-524",
    "snippet": "static bool uuid_match(const void *data, const void *elem)\n{\n\tconst bt_uuid_t *match_uuid = data;\n\tconst bt_uuid_t *uuid = elem;\n\n\treturn bt_uuid_cmp(match_uuid, uuid);\n}",
    "includes": [
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/eir.h\"",
      "#include \"src/shared/ad.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bt_uuid_cmp",
          "args": [
            "match_uuid",
            "uuid"
          ],
          "line": 523
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic bool uuid_match(const void *data, const void *elem)\n{\n\tconst bt_uuid_t *match_uuid = data;\n\tconst bt_uuid_t *uuid = elem;\n\n\treturn bt_uuid_cmp(match_uuid, uuid);\n}"
  },
  {
    "function_name": "queue_add_uuid",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
    "lines": "499-516",
    "snippet": "static bool queue_add_uuid(struct queue *queue, const bt_uuid_t *uuid)\n{\n\tbt_uuid_t *new_uuid;\n\n\tif (!queue)\n\t\treturn false;\n\n\tnew_uuid = new0(bt_uuid_t, 1);\n\n\t*new_uuid = *uuid;\n\n\tif (queue_push_tail(queue, new_uuid))\n\t\treturn true;\n\n\tfree(new_uuid);\n\n\treturn false;\n}",
    "includes": [
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/eir.h\"",
      "#include \"src/shared/ad.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "new_uuid"
          ],
          "line": 513
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "956-985",
          "snippet": "static void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_push_tail",
          "args": [
            "queue",
            "new_uuid"
          ],
          "line": 510
        },
        "resolved": true,
        "details": {
          "function_name": "queue_push_tail",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "88-108",
          "snippet": "bool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "new0",
          "args": [
            "bt_uuid_t",
            "1"
          ],
          "line": 506
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic bool queue_add_uuid(struct queue *queue, const bt_uuid_t *uuid)\n{\n\tbt_uuid_t *new_uuid;\n\n\tif (!queue)\n\t\treturn false;\n\n\tnew_uuid = new0(bt_uuid_t, 1);\n\n\t*new_uuid = *uuid;\n\n\tif (queue_push_tail(queue, new_uuid))\n\t\treturn true;\n\n\tfree(new_uuid);\n\n\treturn false;\n}"
  },
  {
    "function_name": "bt_ad_generate",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
    "lines": "465-497",
    "snippet": "uint8_t *bt_ad_generate(struct bt_ad *ad, size_t *length)\n{\n\tuint8_t *adv_data;\n\tuint8_t pos = 0;\n\n\tif (!ad)\n\t\treturn NULL;\n\n\t*length = calculate_length(ad);\n\n\tif (*length > MAX_ADV_DATA_LEN)\n\t\treturn NULL;\n\n\tadv_data = malloc0(*length);\n\tif (!adv_data)\n\t\treturn NULL;\n\n\tserialize_service_uuids(ad->service_uuids, adv_data, &pos);\n\n\tserialize_solicit_uuids(ad->solicit_uuids, adv_data, &pos);\n\n\tserialize_manuf_data(ad->manufacturer_data, adv_data, &pos);\n\n\tserialize_service_data(ad->service_data, adv_data, &pos);\n\n\tserialize_name(ad->name, adv_data, &pos);\n\n\tserialize_appearance(ad->appearance, adv_data, &pos);\n\n\tserialize_data(ad->data, adv_data, &pos);\n\n\treturn adv_data;\n}",
    "includes": [
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/eir.h\"",
      "#include \"src/shared/ad.h\""
    ],
    "macros_used": [
      "#define MAX_ADV_DATA_LEN 31"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "serialize_data",
          "args": [
            "ad->data",
            "adv_data",
            "&pos"
          ],
          "line": 494
        },
        "resolved": true,
        "details": {
          "function_name": "serialize_data",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "447-463",
          "snippet": "static void serialize_data(struct queue *queue, uint8_t *buf, uint8_t *pos)\n{\n\tconst struct queue_entry *entry = queue_get_entries(queue);\n\n\twhile (entry) {\n\t\tstruct bt_ad_data *data = entry->data;\n\n\t\tbuf[(*pos)++] = data->len + 1;\n\t\tbuf[(*pos)++] = data->type;\n\n\t\tmemcpy(buf + *pos, data->data, data->len);\n\n\t\t*pos += data->len;\n\n\t\tentry = entry->next;\n\t}\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic void serialize_data(struct queue *queue, uint8_t *buf, uint8_t *pos)\n{\n\tconst struct queue_entry *entry = queue_get_entries(queue);\n\n\twhile (entry) {\n\t\tstruct bt_ad_data *data = entry->data;\n\n\t\tbuf[(*pos)++] = data->len + 1;\n\t\tbuf[(*pos)++] = data->type;\n\n\t\tmemcpy(buf + *pos, data->data, data->len);\n\n\t\t*pos += data->len;\n\n\t\tentry = entry->next;\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "serialize_appearance",
          "args": [
            "ad->appearance",
            "adv_data",
            "&pos"
          ],
          "line": 492
        },
        "resolved": true,
        "details": {
          "function_name": "serialize_appearance",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "435-445",
          "snippet": "static void serialize_appearance(uint16_t value, uint8_t *buf, uint8_t *pos)\n{\n\tif (value == UINT16_MAX)\n\t\treturn;\n\n\tbuf[(*pos)++] = sizeof(value) + 1;\n\tbuf[(*pos)++] = BT_AD_GAP_APPEARANCE;\n\n\tbt_put_le16(value, buf + (*pos));\n\t*pos += 2;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic void serialize_appearance(uint16_t value, uint8_t *buf, uint8_t *pos)\n{\n\tif (value == UINT16_MAX)\n\t\treturn;\n\n\tbuf[(*pos)++] = sizeof(value) + 1;\n\tbuf[(*pos)++] = BT_AD_GAP_APPEARANCE;\n\n\tbt_put_le16(value, buf + (*pos));\n\t*pos += 2;\n}"
        }
      },
      {
        "call_info": {
          "callee": "serialize_name",
          "args": [
            "ad->name",
            "adv_data",
            "&pos"
          ],
          "line": 490
        },
        "resolved": true,
        "details": {
          "function_name": "serialize_name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "414-433",
          "snippet": "static void serialize_name(const char *name, uint8_t *buf, uint8_t *pos)\n{\n\tint len;\n\tuint8_t type = BT_AD_NAME_COMPLETE;\n\n\tif (!name)\n\t\treturn;\n\n\tlen = strlen(name);\n\tif (len > MAX_ADV_DATA_LEN - (*pos + 2)) {\n\t\ttype = BT_AD_NAME_SHORT;\n\t\tlen = MAX_ADV_DATA_LEN - (*pos + 2);\n\t}\n\n\tbuf[(*pos)++] = len + 1;\n\tbuf[(*pos)++] = type;\n\n\tmemcpy(buf + *pos, name, len);\n\t*pos += len;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [
            "#define MAX_ADV_DATA_LEN 31"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\n#define MAX_ADV_DATA_LEN 31\n\nstatic void serialize_name(const char *name, uint8_t *buf, uint8_t *pos)\n{\n\tint len;\n\tuint8_t type = BT_AD_NAME_COMPLETE;\n\n\tif (!name)\n\t\treturn;\n\n\tlen = strlen(name);\n\tif (len > MAX_ADV_DATA_LEN - (*pos + 2)) {\n\t\ttype = BT_AD_NAME_SHORT;\n\t\tlen = MAX_ADV_DATA_LEN - (*pos + 2);\n\t}\n\n\tbuf[(*pos)++] = len + 1;\n\tbuf[(*pos)++] = type;\n\n\tmemcpy(buf + *pos, name, len);\n\t*pos += len;\n}"
        }
      },
      {
        "call_info": {
          "callee": "serialize_service_data",
          "args": [
            "ad->service_data",
            "adv_data",
            "&pos"
          ],
          "line": 488
        },
        "resolved": true,
        "details": {
          "function_name": "serialize_service_data",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "376-412",
          "snippet": "static void serialize_service_data(struct queue *service_data, uint8_t *buf,\n\t\t\t\t\t\t\t\tuint8_t *pos)\n{\n\tconst struct queue_entry *entry = queue_get_entries(service_data);\n\n\twhile (entry) {\n\t\tstruct bt_ad_service_data *data = entry->data;\n\t\tint uuid_len = bt_uuid_len(&data->uuid);\n\n\t\tbuf[(*pos)++] =  uuid_len + data->len + 1;\n\n\t\tswitch (uuid_len) {\n\t\tcase 2:\n\t\t\tbuf[(*pos)++] = BT_AD_SERVICE_DATA16;\n\t\t\tbreak;\n\t\tcase 4:\n\t\t\tbuf[(*pos)++] = BT_AD_SERVICE_DATA32;\n\t\t\tbreak;\n\t\tcase 16:\n\t\t\tbuf[(*pos)++] = BT_AD_SERVICE_DATA128;\n\t\t\tbreak;\n\t\t}\n\n\t\tif (uuid_len != 4)\n\t\t\tbt_uuid_to_le(&data->uuid, buf + *pos);\n\t\telse\n\t\t\tbt_put_le32(data->uuid.value.u32, buf + *pos);\n\n\t\t*pos += uuid_len;\n\n\t\tmemcpy(buf + *pos, data->data, data->len);\n\n\t\t*pos += data->len;\n\n\t\tentry = entry->next;\n\t}\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic void serialize_service_data(struct queue *service_data, uint8_t *buf,\n\t\t\t\t\t\t\t\tuint8_t *pos)\n{\n\tconst struct queue_entry *entry = queue_get_entries(service_data);\n\n\twhile (entry) {\n\t\tstruct bt_ad_service_data *data = entry->data;\n\t\tint uuid_len = bt_uuid_len(&data->uuid);\n\n\t\tbuf[(*pos)++] =  uuid_len + data->len + 1;\n\n\t\tswitch (uuid_len) {\n\t\tcase 2:\n\t\t\tbuf[(*pos)++] = BT_AD_SERVICE_DATA16;\n\t\t\tbreak;\n\t\tcase 4:\n\t\t\tbuf[(*pos)++] = BT_AD_SERVICE_DATA32;\n\t\t\tbreak;\n\t\tcase 16:\n\t\t\tbuf[(*pos)++] = BT_AD_SERVICE_DATA128;\n\t\t\tbreak;\n\t\t}\n\n\t\tif (uuid_len != 4)\n\t\t\tbt_uuid_to_le(&data->uuid, buf + *pos);\n\t\telse\n\t\t\tbt_put_le32(data->uuid.value.u32, buf + *pos);\n\n\t\t*pos += uuid_len;\n\n\t\tmemcpy(buf + *pos, data->data, data->len);\n\n\t\t*pos += data->len;\n\n\t\tentry = entry->next;\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "serialize_manuf_data",
          "args": [
            "ad->manufacturer_data",
            "adv_data",
            "&pos"
          ],
          "line": 486
        },
        "resolved": true,
        "details": {
          "function_name": "serialize_manuf_data",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "352-374",
          "snippet": "static void serialize_manuf_data(struct queue *manuf_data, uint8_t *buf,\n\t\t\t\t\t\t\t\tuint8_t *pos)\n{\n\tconst struct queue_entry *entry = queue_get_entries(manuf_data);\n\n\twhile (entry) {\n\t\tstruct bt_ad_manufacturer_data *data = entry->data;\n\n\t\tbuf[(*pos)++] = data->len + 2 + 1;\n\n\t\tbuf[(*pos)++] = BT_AD_MANUFACTURER_DATA;\n\n\t\tbt_put_le16(data->manufacturer_id, buf + (*pos));\n\n\t\t*pos += 2;\n\n\t\tmemcpy(buf + *pos, data->data, data->len);\n\n\t\t*pos += data->len;\n\n\t\tentry = entry->next;\n\t}\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic void serialize_manuf_data(struct queue *manuf_data, uint8_t *buf,\n\t\t\t\t\t\t\t\tuint8_t *pos)\n{\n\tconst struct queue_entry *entry = queue_get_entries(manuf_data);\n\n\twhile (entry) {\n\t\tstruct bt_ad_manufacturer_data *data = entry->data;\n\n\t\tbuf[(*pos)++] = data->len + 2 + 1;\n\n\t\tbuf[(*pos)++] = BT_AD_MANUFACTURER_DATA;\n\n\t\tbt_put_le16(data->manufacturer_id, buf + (*pos));\n\n\t\t*pos += 2;\n\n\t\tmemcpy(buf + *pos, data->data, data->len);\n\n\t\t*pos += data->len;\n\n\t\tentry = entry->next;\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "serialize_solicit_uuids",
          "args": [
            "ad->solicit_uuids",
            "adv_data",
            "&pos"
          ],
          "line": 484
        },
        "resolved": true,
        "details": {
          "function_name": "serialize_solicit_uuids",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "342-350",
          "snippet": "static void serialize_solicit_uuids(struct queue *uuids, uint8_t *buf,\n\t\t\t\t\t\t\t\tuint8_t *pos)\n{\n\tserialize_uuids(uuids, BT_UUID16, BT_AD_SOLICIT16, buf, pos);\n\n\tserialize_uuids(uuids, BT_UUID32, BT_AD_SOLICIT32, buf, pos);\n\n\tserialize_uuids(uuids, BT_UUID128, BT_AD_SOLICIT128, buf, pos);\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic void serialize_solicit_uuids(struct queue *uuids, uint8_t *buf,\n\t\t\t\t\t\t\t\tuint8_t *pos)\n{\n\tserialize_uuids(uuids, BT_UUID16, BT_AD_SOLICIT16, buf, pos);\n\n\tserialize_uuids(uuids, BT_UUID32, BT_AD_SOLICIT32, buf, pos);\n\n\tserialize_uuids(uuids, BT_UUID128, BT_AD_SOLICIT128, buf, pos);\n}"
        }
      },
      {
        "call_info": {
          "callee": "serialize_service_uuids",
          "args": [
            "ad->service_uuids",
            "adv_data",
            "&pos"
          ],
          "line": 482
        },
        "resolved": true,
        "details": {
          "function_name": "serialize_service_uuids",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "332-340",
          "snippet": "static void serialize_service_uuids(struct queue *uuids, uint8_t *buf,\n\t\t\t\t\t\t\t\tuint8_t *pos)\n{\n\tserialize_uuids(uuids, BT_UUID16, BT_AD_UUID16_ALL, buf, pos);\n\n\tserialize_uuids(uuids, BT_UUID32, BT_AD_UUID32_ALL, buf, pos);\n\n\tserialize_uuids(uuids, BT_UUID128, BT_AD_UUID128_ALL, buf, pos);\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic void serialize_service_uuids(struct queue *uuids, uint8_t *buf,\n\t\t\t\t\t\t\t\tuint8_t *pos)\n{\n\tserialize_uuids(uuids, BT_UUID16, BT_AD_UUID16_ALL, buf, pos);\n\n\tserialize_uuids(uuids, BT_UUID32, BT_AD_UUID32_ALL, buf, pos);\n\n\tserialize_uuids(uuids, BT_UUID128, BT_AD_UUID128_ALL, buf, pos);\n}"
        }
      },
      {
        "call_info": {
          "callee": "malloc0",
          "args": [
            "*length"
          ],
          "line": 478
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "calculate_length",
          "args": [
            "ad"
          ],
          "line": 473
        },
        "resolved": true,
        "details": {
          "function_name": "calculate_length",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "278-297",
          "snippet": "static size_t calculate_length(struct bt_ad *ad)\n{\n\tsize_t length = 0;\n\n\tlength += uuid_list_length(ad->service_uuids);\n\n\tlength += uuid_list_length(ad->solicit_uuids);\n\n\tlength += mfg_data_length(ad->manufacturer_data);\n\n\tlength += uuid_data_length(ad->service_data);\n\n\tlength += name_length(ad->name, &length);\n\n\tlength += ad->appearance != UINT16_MAX ? 4 : 0;\n\n\tlength += data_length(ad->data);\n\n\treturn length;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic size_t calculate_length(struct bt_ad *ad)\n{\n\tsize_t length = 0;\n\n\tlength += uuid_list_length(ad->service_uuids);\n\n\tlength += uuid_list_length(ad->solicit_uuids);\n\n\tlength += mfg_data_length(ad->manufacturer_data);\n\n\tlength += uuid_data_length(ad->service_data);\n\n\tlength += name_length(ad->name, &length);\n\n\tlength += ad->appearance != UINT16_MAX ? 4 : 0;\n\n\tlength += data_length(ad->data);\n\n\treturn length;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\n#define MAX_ADV_DATA_LEN 31\n\nuint8_t *bt_ad_generate(struct bt_ad *ad, size_t *length)\n{\n\tuint8_t *adv_data;\n\tuint8_t pos = 0;\n\n\tif (!ad)\n\t\treturn NULL;\n\n\t*length = calculate_length(ad);\n\n\tif (*length > MAX_ADV_DATA_LEN)\n\t\treturn NULL;\n\n\tadv_data = malloc0(*length);\n\tif (!adv_data)\n\t\treturn NULL;\n\n\tserialize_service_uuids(ad->service_uuids, adv_data, &pos);\n\n\tserialize_solicit_uuids(ad->solicit_uuids, adv_data, &pos);\n\n\tserialize_manuf_data(ad->manufacturer_data, adv_data, &pos);\n\n\tserialize_service_data(ad->service_data, adv_data, &pos);\n\n\tserialize_name(ad->name, adv_data, &pos);\n\n\tserialize_appearance(ad->appearance, adv_data, &pos);\n\n\tserialize_data(ad->data, adv_data, &pos);\n\n\treturn adv_data;\n}"
  },
  {
    "function_name": "serialize_data",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
    "lines": "447-463",
    "snippet": "static void serialize_data(struct queue *queue, uint8_t *buf, uint8_t *pos)\n{\n\tconst struct queue_entry *entry = queue_get_entries(queue);\n\n\twhile (entry) {\n\t\tstruct bt_ad_data *data = entry->data;\n\n\t\tbuf[(*pos)++] = data->len + 1;\n\t\tbuf[(*pos)++] = data->type;\n\n\t\tmemcpy(buf + *pos, data->data, data->len);\n\n\t\t*pos += data->len;\n\n\t\tentry = entry->next;\n\t}\n}",
    "includes": [
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/eir.h\"",
      "#include \"src/shared/ad.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "buf + *pos",
            "data->data",
            "data->len"
          ],
          "line": 457
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "queue_get_entries",
          "args": [
            "queue"
          ],
          "line": 449
        },
        "resolved": true,
        "details": {
          "function_name": "queue_get_entries",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "364-370",
          "snippet": "const struct queue_entry *queue_get_entries(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn NULL;\n\n\treturn queue->head;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nconst struct queue_entry *queue_get_entries(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn NULL;\n\n\treturn queue->head;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic void serialize_data(struct queue *queue, uint8_t *buf, uint8_t *pos)\n{\n\tconst struct queue_entry *entry = queue_get_entries(queue);\n\n\twhile (entry) {\n\t\tstruct bt_ad_data *data = entry->data;\n\n\t\tbuf[(*pos)++] = data->len + 1;\n\t\tbuf[(*pos)++] = data->type;\n\n\t\tmemcpy(buf + *pos, data->data, data->len);\n\n\t\t*pos += data->len;\n\n\t\tentry = entry->next;\n\t}\n}"
  },
  {
    "function_name": "serialize_appearance",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
    "lines": "435-445",
    "snippet": "static void serialize_appearance(uint16_t value, uint8_t *buf, uint8_t *pos)\n{\n\tif (value == UINT16_MAX)\n\t\treturn;\n\n\tbuf[(*pos)++] = sizeof(value) + 1;\n\tbuf[(*pos)++] = BT_AD_GAP_APPEARANCE;\n\n\tbt_put_le16(value, buf + (*pos));\n\t*pos += 2;\n}",
    "includes": [
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/eir.h\"",
      "#include \"src/shared/ad.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bt_put_le16",
          "args": [
            "value",
            "buf + (*pos)"
          ],
          "line": 443
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic void serialize_appearance(uint16_t value, uint8_t *buf, uint8_t *pos)\n{\n\tif (value == UINT16_MAX)\n\t\treturn;\n\n\tbuf[(*pos)++] = sizeof(value) + 1;\n\tbuf[(*pos)++] = BT_AD_GAP_APPEARANCE;\n\n\tbt_put_le16(value, buf + (*pos));\n\t*pos += 2;\n}"
  },
  {
    "function_name": "serialize_name",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
    "lines": "414-433",
    "snippet": "static void serialize_name(const char *name, uint8_t *buf, uint8_t *pos)\n{\n\tint len;\n\tuint8_t type = BT_AD_NAME_COMPLETE;\n\n\tif (!name)\n\t\treturn;\n\n\tlen = strlen(name);\n\tif (len > MAX_ADV_DATA_LEN - (*pos + 2)) {\n\t\ttype = BT_AD_NAME_SHORT;\n\t\tlen = MAX_ADV_DATA_LEN - (*pos + 2);\n\t}\n\n\tbuf[(*pos)++] = len + 1;\n\tbuf[(*pos)++] = type;\n\n\tmemcpy(buf + *pos, name, len);\n\t*pos += len;\n}",
    "includes": [
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/eir.h\"",
      "#include \"src/shared/ad.h\""
    ],
    "macros_used": [
      "#define MAX_ADV_DATA_LEN 31"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "buf + *pos",
            "name",
            "len"
          ],
          "line": 431
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "name"
          ],
          "line": 422
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\n#define MAX_ADV_DATA_LEN 31\n\nstatic void serialize_name(const char *name, uint8_t *buf, uint8_t *pos)\n{\n\tint len;\n\tuint8_t type = BT_AD_NAME_COMPLETE;\n\n\tif (!name)\n\t\treturn;\n\n\tlen = strlen(name);\n\tif (len > MAX_ADV_DATA_LEN - (*pos + 2)) {\n\t\ttype = BT_AD_NAME_SHORT;\n\t\tlen = MAX_ADV_DATA_LEN - (*pos + 2);\n\t}\n\n\tbuf[(*pos)++] = len + 1;\n\tbuf[(*pos)++] = type;\n\n\tmemcpy(buf + *pos, name, len);\n\t*pos += len;\n}"
  },
  {
    "function_name": "serialize_service_data",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
    "lines": "376-412",
    "snippet": "static void serialize_service_data(struct queue *service_data, uint8_t *buf,\n\t\t\t\t\t\t\t\tuint8_t *pos)\n{\n\tconst struct queue_entry *entry = queue_get_entries(service_data);\n\n\twhile (entry) {\n\t\tstruct bt_ad_service_data *data = entry->data;\n\t\tint uuid_len = bt_uuid_len(&data->uuid);\n\n\t\tbuf[(*pos)++] =  uuid_len + data->len + 1;\n\n\t\tswitch (uuid_len) {\n\t\tcase 2:\n\t\t\tbuf[(*pos)++] = BT_AD_SERVICE_DATA16;\n\t\t\tbreak;\n\t\tcase 4:\n\t\t\tbuf[(*pos)++] = BT_AD_SERVICE_DATA32;\n\t\t\tbreak;\n\t\tcase 16:\n\t\t\tbuf[(*pos)++] = BT_AD_SERVICE_DATA128;\n\t\t\tbreak;\n\t\t}\n\n\t\tif (uuid_len != 4)\n\t\t\tbt_uuid_to_le(&data->uuid, buf + *pos);\n\t\telse\n\t\t\tbt_put_le32(data->uuid.value.u32, buf + *pos);\n\n\t\t*pos += uuid_len;\n\n\t\tmemcpy(buf + *pos, data->data, data->len);\n\n\t\t*pos += data->len;\n\n\t\tentry = entry->next;\n\t}\n}",
    "includes": [
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/eir.h\"",
      "#include \"src/shared/ad.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "buf + *pos",
            "data->data",
            "data->len"
          ],
          "line": 406
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_put_le32",
          "args": [
            "data->uuid.value.u32",
            "buf + *pos"
          ],
          "line": 402
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_uuid_to_le",
          "args": [
            "&data->uuid",
            "buf + *pos"
          ],
          "line": 400
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_uuid_len",
          "args": [
            "&data->uuid"
          ],
          "line": 383
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "queue_get_entries",
          "args": [
            "service_data"
          ],
          "line": 379
        },
        "resolved": true,
        "details": {
          "function_name": "queue_get_entries",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "364-370",
          "snippet": "const struct queue_entry *queue_get_entries(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn NULL;\n\n\treturn queue->head;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nconst struct queue_entry *queue_get_entries(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn NULL;\n\n\treturn queue->head;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic void serialize_service_data(struct queue *service_data, uint8_t *buf,\n\t\t\t\t\t\t\t\tuint8_t *pos)\n{\n\tconst struct queue_entry *entry = queue_get_entries(service_data);\n\n\twhile (entry) {\n\t\tstruct bt_ad_service_data *data = entry->data;\n\t\tint uuid_len = bt_uuid_len(&data->uuid);\n\n\t\tbuf[(*pos)++] =  uuid_len + data->len + 1;\n\n\t\tswitch (uuid_len) {\n\t\tcase 2:\n\t\t\tbuf[(*pos)++] = BT_AD_SERVICE_DATA16;\n\t\t\tbreak;\n\t\tcase 4:\n\t\t\tbuf[(*pos)++] = BT_AD_SERVICE_DATA32;\n\t\t\tbreak;\n\t\tcase 16:\n\t\t\tbuf[(*pos)++] = BT_AD_SERVICE_DATA128;\n\t\t\tbreak;\n\t\t}\n\n\t\tif (uuid_len != 4)\n\t\t\tbt_uuid_to_le(&data->uuid, buf + *pos);\n\t\telse\n\t\t\tbt_put_le32(data->uuid.value.u32, buf + *pos);\n\n\t\t*pos += uuid_len;\n\n\t\tmemcpy(buf + *pos, data->data, data->len);\n\n\t\t*pos += data->len;\n\n\t\tentry = entry->next;\n\t}\n}"
  },
  {
    "function_name": "serialize_manuf_data",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
    "lines": "352-374",
    "snippet": "static void serialize_manuf_data(struct queue *manuf_data, uint8_t *buf,\n\t\t\t\t\t\t\t\tuint8_t *pos)\n{\n\tconst struct queue_entry *entry = queue_get_entries(manuf_data);\n\n\twhile (entry) {\n\t\tstruct bt_ad_manufacturer_data *data = entry->data;\n\n\t\tbuf[(*pos)++] = data->len + 2 + 1;\n\n\t\tbuf[(*pos)++] = BT_AD_MANUFACTURER_DATA;\n\n\t\tbt_put_le16(data->manufacturer_id, buf + (*pos));\n\n\t\t*pos += 2;\n\n\t\tmemcpy(buf + *pos, data->data, data->len);\n\n\t\t*pos += data->len;\n\n\t\tentry = entry->next;\n\t}\n}",
    "includes": [
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/eir.h\"",
      "#include \"src/shared/ad.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "buf + *pos",
            "data->data",
            "data->len"
          ],
          "line": 368
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_put_le16",
          "args": [
            "data->manufacturer_id",
            "buf + (*pos)"
          ],
          "line": 364
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "queue_get_entries",
          "args": [
            "manuf_data"
          ],
          "line": 355
        },
        "resolved": true,
        "details": {
          "function_name": "queue_get_entries",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "364-370",
          "snippet": "const struct queue_entry *queue_get_entries(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn NULL;\n\n\treturn queue->head;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nconst struct queue_entry *queue_get_entries(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn NULL;\n\n\treturn queue->head;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic void serialize_manuf_data(struct queue *manuf_data, uint8_t *buf,\n\t\t\t\t\t\t\t\tuint8_t *pos)\n{\n\tconst struct queue_entry *entry = queue_get_entries(manuf_data);\n\n\twhile (entry) {\n\t\tstruct bt_ad_manufacturer_data *data = entry->data;\n\n\t\tbuf[(*pos)++] = data->len + 2 + 1;\n\n\t\tbuf[(*pos)++] = BT_AD_MANUFACTURER_DATA;\n\n\t\tbt_put_le16(data->manufacturer_id, buf + (*pos));\n\n\t\t*pos += 2;\n\n\t\tmemcpy(buf + *pos, data->data, data->len);\n\n\t\t*pos += data->len;\n\n\t\tentry = entry->next;\n\t}\n}"
  },
  {
    "function_name": "serialize_solicit_uuids",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
    "lines": "342-350",
    "snippet": "static void serialize_solicit_uuids(struct queue *uuids, uint8_t *buf,\n\t\t\t\t\t\t\t\tuint8_t *pos)\n{\n\tserialize_uuids(uuids, BT_UUID16, BT_AD_SOLICIT16, buf, pos);\n\n\tserialize_uuids(uuids, BT_UUID32, BT_AD_SOLICIT32, buf, pos);\n\n\tserialize_uuids(uuids, BT_UUID128, BT_AD_SOLICIT128, buf, pos);\n}",
    "includes": [
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/eir.h\"",
      "#include \"src/shared/ad.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "serialize_uuids",
          "args": [
            "uuids",
            "BT_UUID128",
            "BT_AD_SOLICIT128",
            "buf",
            "pos"
          ],
          "line": 349
        },
        "resolved": true,
        "details": {
          "function_name": "serialize_uuids",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "299-330",
          "snippet": "static void serialize_uuids(struct queue *uuids, uint8_t uuid_type,\n\t\t\t\t\t\tuint8_t ad_type, uint8_t *buf,\n\t\t\t\t\t\tuint8_t *pos)\n{\n\tconst struct queue_entry *entry = queue_get_entries(uuids);\n\tbool added = false;\n\tuint8_t length_pos = 0;\n\n\twhile (entry) {\n\t\tbt_uuid_t *uuid = entry->data;\n\n\t\tif (uuid->type == uuid_type) {\n\t\t\tif (!added) {\n\t\t\t\tlength_pos = (*pos)++;\n\t\t\t\tbuf[(*pos)++] = ad_type;\n\t\t\t\tadded = true;\n\t\t\t}\n\n\t\t\tif (uuid_type != BT_UUID32)\n\t\t\t\tbt_uuid_to_le(uuid, buf + *pos);\n\t\t\telse\n\t\t\t\tbt_put_le32(uuid->value.u32, buf + *pos);\n\n\t\t\t*pos += bt_uuid_len(uuid);\n\t\t}\n\n\t\tentry = entry->next;\n\t}\n\n\tif (added)\n\t\tbuf[length_pos] = *pos - length_pos - 1;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic void serialize_uuids(struct queue *uuids, uint8_t uuid_type,\n\t\t\t\t\t\tuint8_t ad_type, uint8_t *buf,\n\t\t\t\t\t\tuint8_t *pos)\n{\n\tconst struct queue_entry *entry = queue_get_entries(uuids);\n\tbool added = false;\n\tuint8_t length_pos = 0;\n\n\twhile (entry) {\n\t\tbt_uuid_t *uuid = entry->data;\n\n\t\tif (uuid->type == uuid_type) {\n\t\t\tif (!added) {\n\t\t\t\tlength_pos = (*pos)++;\n\t\t\t\tbuf[(*pos)++] = ad_type;\n\t\t\t\tadded = true;\n\t\t\t}\n\n\t\t\tif (uuid_type != BT_UUID32)\n\t\t\t\tbt_uuid_to_le(uuid, buf + *pos);\n\t\t\telse\n\t\t\t\tbt_put_le32(uuid->value.u32, buf + *pos);\n\n\t\t\t*pos += bt_uuid_len(uuid);\n\t\t}\n\n\t\tentry = entry->next;\n\t}\n\n\tif (added)\n\t\tbuf[length_pos] = *pos - length_pos - 1;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic void serialize_solicit_uuids(struct queue *uuids, uint8_t *buf,\n\t\t\t\t\t\t\t\tuint8_t *pos)\n{\n\tserialize_uuids(uuids, BT_UUID16, BT_AD_SOLICIT16, buf, pos);\n\n\tserialize_uuids(uuids, BT_UUID32, BT_AD_SOLICIT32, buf, pos);\n\n\tserialize_uuids(uuids, BT_UUID128, BT_AD_SOLICIT128, buf, pos);\n}"
  },
  {
    "function_name": "serialize_service_uuids",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
    "lines": "332-340",
    "snippet": "static void serialize_service_uuids(struct queue *uuids, uint8_t *buf,\n\t\t\t\t\t\t\t\tuint8_t *pos)\n{\n\tserialize_uuids(uuids, BT_UUID16, BT_AD_UUID16_ALL, buf, pos);\n\n\tserialize_uuids(uuids, BT_UUID32, BT_AD_UUID32_ALL, buf, pos);\n\n\tserialize_uuids(uuids, BT_UUID128, BT_AD_UUID128_ALL, buf, pos);\n}",
    "includes": [
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/eir.h\"",
      "#include \"src/shared/ad.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "serialize_uuids",
          "args": [
            "uuids",
            "BT_UUID128",
            "BT_AD_UUID128_ALL",
            "buf",
            "pos"
          ],
          "line": 339
        },
        "resolved": true,
        "details": {
          "function_name": "serialize_uuids",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "299-330",
          "snippet": "static void serialize_uuids(struct queue *uuids, uint8_t uuid_type,\n\t\t\t\t\t\tuint8_t ad_type, uint8_t *buf,\n\t\t\t\t\t\tuint8_t *pos)\n{\n\tconst struct queue_entry *entry = queue_get_entries(uuids);\n\tbool added = false;\n\tuint8_t length_pos = 0;\n\n\twhile (entry) {\n\t\tbt_uuid_t *uuid = entry->data;\n\n\t\tif (uuid->type == uuid_type) {\n\t\t\tif (!added) {\n\t\t\t\tlength_pos = (*pos)++;\n\t\t\t\tbuf[(*pos)++] = ad_type;\n\t\t\t\tadded = true;\n\t\t\t}\n\n\t\t\tif (uuid_type != BT_UUID32)\n\t\t\t\tbt_uuid_to_le(uuid, buf + *pos);\n\t\t\telse\n\t\t\t\tbt_put_le32(uuid->value.u32, buf + *pos);\n\n\t\t\t*pos += bt_uuid_len(uuid);\n\t\t}\n\n\t\tentry = entry->next;\n\t}\n\n\tif (added)\n\t\tbuf[length_pos] = *pos - length_pos - 1;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic void serialize_uuids(struct queue *uuids, uint8_t uuid_type,\n\t\t\t\t\t\tuint8_t ad_type, uint8_t *buf,\n\t\t\t\t\t\tuint8_t *pos)\n{\n\tconst struct queue_entry *entry = queue_get_entries(uuids);\n\tbool added = false;\n\tuint8_t length_pos = 0;\n\n\twhile (entry) {\n\t\tbt_uuid_t *uuid = entry->data;\n\n\t\tif (uuid->type == uuid_type) {\n\t\t\tif (!added) {\n\t\t\t\tlength_pos = (*pos)++;\n\t\t\t\tbuf[(*pos)++] = ad_type;\n\t\t\t\tadded = true;\n\t\t\t}\n\n\t\t\tif (uuid_type != BT_UUID32)\n\t\t\t\tbt_uuid_to_le(uuid, buf + *pos);\n\t\t\telse\n\t\t\t\tbt_put_le32(uuid->value.u32, buf + *pos);\n\n\t\t\t*pos += bt_uuid_len(uuid);\n\t\t}\n\n\t\tentry = entry->next;\n\t}\n\n\tif (added)\n\t\tbuf[length_pos] = *pos - length_pos - 1;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic void serialize_service_uuids(struct queue *uuids, uint8_t *buf,\n\t\t\t\t\t\t\t\tuint8_t *pos)\n{\n\tserialize_uuids(uuids, BT_UUID16, BT_AD_UUID16_ALL, buf, pos);\n\n\tserialize_uuids(uuids, BT_UUID32, BT_AD_UUID32_ALL, buf, pos);\n\n\tserialize_uuids(uuids, BT_UUID128, BT_AD_UUID128_ALL, buf, pos);\n}"
  },
  {
    "function_name": "serialize_uuids",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
    "lines": "299-330",
    "snippet": "static void serialize_uuids(struct queue *uuids, uint8_t uuid_type,\n\t\t\t\t\t\tuint8_t ad_type, uint8_t *buf,\n\t\t\t\t\t\tuint8_t *pos)\n{\n\tconst struct queue_entry *entry = queue_get_entries(uuids);\n\tbool added = false;\n\tuint8_t length_pos = 0;\n\n\twhile (entry) {\n\t\tbt_uuid_t *uuid = entry->data;\n\n\t\tif (uuid->type == uuid_type) {\n\t\t\tif (!added) {\n\t\t\t\tlength_pos = (*pos)++;\n\t\t\t\tbuf[(*pos)++] = ad_type;\n\t\t\t\tadded = true;\n\t\t\t}\n\n\t\t\tif (uuid_type != BT_UUID32)\n\t\t\t\tbt_uuid_to_le(uuid, buf + *pos);\n\t\t\telse\n\t\t\t\tbt_put_le32(uuid->value.u32, buf + *pos);\n\n\t\t\t*pos += bt_uuid_len(uuid);\n\t\t}\n\n\t\tentry = entry->next;\n\t}\n\n\tif (added)\n\t\tbuf[length_pos] = *pos - length_pos - 1;\n}",
    "includes": [
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/eir.h\"",
      "#include \"src/shared/ad.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bt_uuid_len",
          "args": [
            "uuid"
          ],
          "line": 322
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_put_le32",
          "args": [
            "uuid->value.u32",
            "buf + *pos"
          ],
          "line": 320
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_uuid_to_le",
          "args": [
            "uuid",
            "buf + *pos"
          ],
          "line": 318
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "queue_get_entries",
          "args": [
            "uuids"
          ],
          "line": 303
        },
        "resolved": true,
        "details": {
          "function_name": "queue_get_entries",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "364-370",
          "snippet": "const struct queue_entry *queue_get_entries(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn NULL;\n\n\treturn queue->head;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nconst struct queue_entry *queue_get_entries(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn NULL;\n\n\treturn queue->head;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic void serialize_uuids(struct queue *uuids, uint8_t uuid_type,\n\t\t\t\t\t\tuint8_t ad_type, uint8_t *buf,\n\t\t\t\t\t\tuint8_t *pos)\n{\n\tconst struct queue_entry *entry = queue_get_entries(uuids);\n\tbool added = false;\n\tuint8_t length_pos = 0;\n\n\twhile (entry) {\n\t\tbt_uuid_t *uuid = entry->data;\n\n\t\tif (uuid->type == uuid_type) {\n\t\t\tif (!added) {\n\t\t\t\tlength_pos = (*pos)++;\n\t\t\t\tbuf[(*pos)++] = ad_type;\n\t\t\t\tadded = true;\n\t\t\t}\n\n\t\t\tif (uuid_type != BT_UUID32)\n\t\t\t\tbt_uuid_to_le(uuid, buf + *pos);\n\t\t\telse\n\t\t\t\tbt_put_le32(uuid->value.u32, buf + *pos);\n\n\t\t\t*pos += bt_uuid_len(uuid);\n\t\t}\n\n\t\tentry = entry->next;\n\t}\n\n\tif (added)\n\t\tbuf[length_pos] = *pos - length_pos - 1;\n}"
  },
  {
    "function_name": "calculate_length",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
    "lines": "278-297",
    "snippet": "static size_t calculate_length(struct bt_ad *ad)\n{\n\tsize_t length = 0;\n\n\tlength += uuid_list_length(ad->service_uuids);\n\n\tlength += uuid_list_length(ad->solicit_uuids);\n\n\tlength += mfg_data_length(ad->manufacturer_data);\n\n\tlength += uuid_data_length(ad->service_data);\n\n\tlength += name_length(ad->name, &length);\n\n\tlength += ad->appearance != UINT16_MAX ? 4 : 0;\n\n\tlength += data_length(ad->data);\n\n\treturn length;\n}",
    "includes": [
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/eir.h\"",
      "#include \"src/shared/ad.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "data_length",
          "args": [
            "ad->data"
          ],
          "line": 294
        },
        "resolved": true,
        "details": {
          "function_name": "data_length",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "260-276",
          "snippet": "static size_t data_length(struct queue *queue)\n{\n\tsize_t length = 0;\n\tconst struct queue_entry *entry;\n\n\tentry = queue_get_entries(queue);\n\n\twhile (entry) {\n\t\tstruct bt_ad_data *data = entry->data;\n\n\t\tlength += 1 + 1 + data->len;\n\n\t\tentry = entry->next;\n\t}\n\n\treturn length;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic size_t data_length(struct queue *queue)\n{\n\tsize_t length = 0;\n\tconst struct queue_entry *entry;\n\n\tentry = queue_get_entries(queue);\n\n\twhile (entry) {\n\t\tstruct bt_ad_data *data = entry->data;\n\n\t\tlength += 1 + 1 + data->len;\n\n\t\tentry = entry->next;\n\t}\n\n\treturn length;\n}"
        }
      },
      {
        "call_info": {
          "callee": "name_length",
          "args": [
            "ad->name",
            "&length"
          ],
          "line": 290
        },
        "resolved": true,
        "details": {
          "function_name": "name_length",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "245-258",
          "snippet": "static size_t name_length(const char *name, size_t *pos)\n{\n\tsize_t len;\n\t\n\tif (!name)\n\t\treturn 0;\n\n\tlen = 2 + strlen(name);\n\n\tif (len > MAX_ADV_DATA_LEN - *pos)\n\t\tlen = MAX_ADV_DATA_LEN - *pos;\n\n\treturn len;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [
            "#define MAX_ADV_DATA_LEN 31"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\n#define MAX_ADV_DATA_LEN 31\n\nstatic size_t name_length(const char *name, size_t *pos)\n{\n\tsize_t len;\n\t\n\tif (!name)\n\t\treturn 0;\n\n\tlen = 2 + strlen(name);\n\n\tif (len > MAX_ADV_DATA_LEN - *pos)\n\t\tlen = MAX_ADV_DATA_LEN - *pos;\n\n\treturn len;\n}"
        }
      },
      {
        "call_info": {
          "callee": "uuid_data_length",
          "args": [
            "ad->service_data"
          ],
          "line": 288
        },
        "resolved": true,
        "details": {
          "function_name": "uuid_data_length",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "227-243",
          "snippet": "static size_t uuid_data_length(struct queue *uuid_data)\n{\n\tsize_t length = 0;\n\tconst struct queue_entry *entry;\n\n\tentry = queue_get_entries(uuid_data);\n\n\twhile (entry) {\n\t\tstruct bt_ad_service_data *data = entry->data;\n\n\t\tlength += 2 + bt_uuid_len(&data->uuid) + data->len;\n\n\t\tentry = entry->next;\n\t}\n\n\treturn length;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic size_t uuid_data_length(struct queue *uuid_data)\n{\n\tsize_t length = 0;\n\tconst struct queue_entry *entry;\n\n\tentry = queue_get_entries(uuid_data);\n\n\twhile (entry) {\n\t\tstruct bt_ad_service_data *data = entry->data;\n\n\t\tlength += 2 + bt_uuid_len(&data->uuid) + data->len;\n\n\t\tentry = entry->next;\n\t}\n\n\treturn length;\n}"
        }
      },
      {
        "call_info": {
          "callee": "mfg_data_length",
          "args": [
            "ad->manufacturer_data"
          ],
          "line": 286
        },
        "resolved": true,
        "details": {
          "function_name": "mfg_data_length",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "209-225",
          "snippet": "static size_t mfg_data_length(struct queue *manuf_data)\n{\n\tsize_t length = 0;\n\tconst struct queue_entry *entry;\n\n\tentry = queue_get_entries(manuf_data);\n\n\twhile (entry) {\n\t\tstruct bt_ad_manufacturer_data *data = entry->data;\n\n\t\tlength += 2 + sizeof(uint16_t) + data->len;\n\n\t\tentry = entry->next;\n\t}\n\n\treturn length;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic size_t mfg_data_length(struct queue *manuf_data)\n{\n\tsize_t length = 0;\n\tconst struct queue_entry *entry;\n\n\tentry = queue_get_entries(manuf_data);\n\n\twhile (entry) {\n\t\tstruct bt_ad_manufacturer_data *data = entry->data;\n\n\t\tlength += 2 + sizeof(uint16_t) + data->len;\n\n\t\tentry = entry->next;\n\t}\n\n\treturn length;\n}"
        }
      },
      {
        "call_info": {
          "callee": "uuid_list_length",
          "args": [
            "ad->solicit_uuids"
          ],
          "line": 284
        },
        "resolved": true,
        "details": {
          "function_name": "uuid_list_length",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "172-207",
          "snippet": "static size_t uuid_list_length(struct queue *uuid_queue)\n{\n\tbool uuid16_included = false;\n\tbool uuid32_included = false;\n\tbool uuid128_included = false;\n\tsize_t length = 0;\n\tconst struct queue_entry *entry;\n\n\tentry = queue_get_entries(uuid_queue);\n\n\twhile (entry) {\n\t\tbt_uuid_t *uuid = entry->data;\n\n\t\tlength += bt_uuid_len(uuid);\n\n\t\tif (uuid->type == BT_UUID16)\n\t\t\tuuid16_included = true;\n\t\telse if (uuid->type == BT_UUID32)\n\t\t\tuuid32_included = true;\n\t\telse\n\t\t\tuuid128_included = true;\n\n\t\tentry = entry->next;\n\t}\n\n\tif (uuid16_included)\n\t\tlength += 2;\n\n\tif (uuid32_included)\n\t\tlength += 2;\n\n\tif (uuid128_included)\n\t\tlength += 2;\n\n\treturn length;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic size_t uuid_list_length(struct queue *uuid_queue)\n{\n\tbool uuid16_included = false;\n\tbool uuid32_included = false;\n\tbool uuid128_included = false;\n\tsize_t length = 0;\n\tconst struct queue_entry *entry;\n\n\tentry = queue_get_entries(uuid_queue);\n\n\twhile (entry) {\n\t\tbt_uuid_t *uuid = entry->data;\n\n\t\tlength += bt_uuid_len(uuid);\n\n\t\tif (uuid->type == BT_UUID16)\n\t\t\tuuid16_included = true;\n\t\telse if (uuid->type == BT_UUID32)\n\t\t\tuuid32_included = true;\n\t\telse\n\t\t\tuuid128_included = true;\n\n\t\tentry = entry->next;\n\t}\n\n\tif (uuid16_included)\n\t\tlength += 2;\n\n\tif (uuid32_included)\n\t\tlength += 2;\n\n\tif (uuid128_included)\n\t\tlength += 2;\n\n\treturn length;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic size_t calculate_length(struct bt_ad *ad)\n{\n\tsize_t length = 0;\n\n\tlength += uuid_list_length(ad->service_uuids);\n\n\tlength += uuid_list_length(ad->solicit_uuids);\n\n\tlength += mfg_data_length(ad->manufacturer_data);\n\n\tlength += uuid_data_length(ad->service_data);\n\n\tlength += name_length(ad->name, &length);\n\n\tlength += ad->appearance != UINT16_MAX ? 4 : 0;\n\n\tlength += data_length(ad->data);\n\n\treturn length;\n}"
  },
  {
    "function_name": "data_length",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
    "lines": "260-276",
    "snippet": "static size_t data_length(struct queue *queue)\n{\n\tsize_t length = 0;\n\tconst struct queue_entry *entry;\n\n\tentry = queue_get_entries(queue);\n\n\twhile (entry) {\n\t\tstruct bt_ad_data *data = entry->data;\n\n\t\tlength += 1 + 1 + data->len;\n\n\t\tentry = entry->next;\n\t}\n\n\treturn length;\n}",
    "includes": [
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/eir.h\"",
      "#include \"src/shared/ad.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_get_entries",
          "args": [
            "queue"
          ],
          "line": 265
        },
        "resolved": true,
        "details": {
          "function_name": "queue_get_entries",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "364-370",
          "snippet": "const struct queue_entry *queue_get_entries(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn NULL;\n\n\treturn queue->head;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nconst struct queue_entry *queue_get_entries(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn NULL;\n\n\treturn queue->head;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic size_t data_length(struct queue *queue)\n{\n\tsize_t length = 0;\n\tconst struct queue_entry *entry;\n\n\tentry = queue_get_entries(queue);\n\n\twhile (entry) {\n\t\tstruct bt_ad_data *data = entry->data;\n\n\t\tlength += 1 + 1 + data->len;\n\n\t\tentry = entry->next;\n\t}\n\n\treturn length;\n}"
  },
  {
    "function_name": "name_length",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
    "lines": "245-258",
    "snippet": "static size_t name_length(const char *name, size_t *pos)\n{\n\tsize_t len;\n\t\n\tif (!name)\n\t\treturn 0;\n\n\tlen = 2 + strlen(name);\n\n\tif (len > MAX_ADV_DATA_LEN - *pos)\n\t\tlen = MAX_ADV_DATA_LEN - *pos;\n\n\treturn len;\n}",
    "includes": [
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/eir.h\"",
      "#include \"src/shared/ad.h\""
    ],
    "macros_used": [
      "#define MAX_ADV_DATA_LEN 31"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "name"
          ],
          "line": 252
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\n#define MAX_ADV_DATA_LEN 31\n\nstatic size_t name_length(const char *name, size_t *pos)\n{\n\tsize_t len;\n\t\n\tif (!name)\n\t\treturn 0;\n\n\tlen = 2 + strlen(name);\n\n\tif (len > MAX_ADV_DATA_LEN - *pos)\n\t\tlen = MAX_ADV_DATA_LEN - *pos;\n\n\treturn len;\n}"
  },
  {
    "function_name": "uuid_data_length",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
    "lines": "227-243",
    "snippet": "static size_t uuid_data_length(struct queue *uuid_data)\n{\n\tsize_t length = 0;\n\tconst struct queue_entry *entry;\n\n\tentry = queue_get_entries(uuid_data);\n\n\twhile (entry) {\n\t\tstruct bt_ad_service_data *data = entry->data;\n\n\t\tlength += 2 + bt_uuid_len(&data->uuid) + data->len;\n\n\t\tentry = entry->next;\n\t}\n\n\treturn length;\n}",
    "includes": [
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/eir.h\"",
      "#include \"src/shared/ad.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bt_uuid_len",
          "args": [
            "&data->uuid"
          ],
          "line": 237
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "queue_get_entries",
          "args": [
            "uuid_data"
          ],
          "line": 232
        },
        "resolved": true,
        "details": {
          "function_name": "queue_get_entries",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "364-370",
          "snippet": "const struct queue_entry *queue_get_entries(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn NULL;\n\n\treturn queue->head;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nconst struct queue_entry *queue_get_entries(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn NULL;\n\n\treturn queue->head;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic size_t uuid_data_length(struct queue *uuid_data)\n{\n\tsize_t length = 0;\n\tconst struct queue_entry *entry;\n\n\tentry = queue_get_entries(uuid_data);\n\n\twhile (entry) {\n\t\tstruct bt_ad_service_data *data = entry->data;\n\n\t\tlength += 2 + bt_uuid_len(&data->uuid) + data->len;\n\n\t\tentry = entry->next;\n\t}\n\n\treturn length;\n}"
  },
  {
    "function_name": "mfg_data_length",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
    "lines": "209-225",
    "snippet": "static size_t mfg_data_length(struct queue *manuf_data)\n{\n\tsize_t length = 0;\n\tconst struct queue_entry *entry;\n\n\tentry = queue_get_entries(manuf_data);\n\n\twhile (entry) {\n\t\tstruct bt_ad_manufacturer_data *data = entry->data;\n\n\t\tlength += 2 + sizeof(uint16_t) + data->len;\n\n\t\tentry = entry->next;\n\t}\n\n\treturn length;\n}",
    "includes": [
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/eir.h\"",
      "#include \"src/shared/ad.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_get_entries",
          "args": [
            "manuf_data"
          ],
          "line": 214
        },
        "resolved": true,
        "details": {
          "function_name": "queue_get_entries",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "364-370",
          "snippet": "const struct queue_entry *queue_get_entries(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn NULL;\n\n\treturn queue->head;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nconst struct queue_entry *queue_get_entries(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn NULL;\n\n\treturn queue->head;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic size_t mfg_data_length(struct queue *manuf_data)\n{\n\tsize_t length = 0;\n\tconst struct queue_entry *entry;\n\n\tentry = queue_get_entries(manuf_data);\n\n\twhile (entry) {\n\t\tstruct bt_ad_manufacturer_data *data = entry->data;\n\n\t\tlength += 2 + sizeof(uint16_t) + data->len;\n\n\t\tentry = entry->next;\n\t}\n\n\treturn length;\n}"
  },
  {
    "function_name": "uuid_list_length",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
    "lines": "172-207",
    "snippet": "static size_t uuid_list_length(struct queue *uuid_queue)\n{\n\tbool uuid16_included = false;\n\tbool uuid32_included = false;\n\tbool uuid128_included = false;\n\tsize_t length = 0;\n\tconst struct queue_entry *entry;\n\n\tentry = queue_get_entries(uuid_queue);\n\n\twhile (entry) {\n\t\tbt_uuid_t *uuid = entry->data;\n\n\t\tlength += bt_uuid_len(uuid);\n\n\t\tif (uuid->type == BT_UUID16)\n\t\t\tuuid16_included = true;\n\t\telse if (uuid->type == BT_UUID32)\n\t\t\tuuid32_included = true;\n\t\telse\n\t\t\tuuid128_included = true;\n\n\t\tentry = entry->next;\n\t}\n\n\tif (uuid16_included)\n\t\tlength += 2;\n\n\tif (uuid32_included)\n\t\tlength += 2;\n\n\tif (uuid128_included)\n\t\tlength += 2;\n\n\treturn length;\n}",
    "includes": [
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/eir.h\"",
      "#include \"src/shared/ad.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bt_uuid_len",
          "args": [
            "uuid"
          ],
          "line": 185
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "queue_get_entries",
          "args": [
            "uuid_queue"
          ],
          "line": 180
        },
        "resolved": true,
        "details": {
          "function_name": "queue_get_entries",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "364-370",
          "snippet": "const struct queue_entry *queue_get_entries(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn NULL;\n\n\treturn queue->head;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nconst struct queue_entry *queue_get_entries(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn NULL;\n\n\treturn queue->head;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic size_t uuid_list_length(struct queue *uuid_queue)\n{\n\tbool uuid16_included = false;\n\tbool uuid32_included = false;\n\tbool uuid128_included = false;\n\tsize_t length = 0;\n\tconst struct queue_entry *entry;\n\n\tentry = queue_get_entries(uuid_queue);\n\n\twhile (entry) {\n\t\tbt_uuid_t *uuid = entry->data;\n\n\t\tlength += bt_uuid_len(uuid);\n\n\t\tif (uuid->type == BT_UUID16)\n\t\t\tuuid16_included = true;\n\t\telse if (uuid->type == BT_UUID32)\n\t\t\tuuid32_included = true;\n\t\telse\n\t\t\tuuid128_included = true;\n\n\t\tentry = entry->next;\n\t}\n\n\tif (uuid16_included)\n\t\tlength += 2;\n\n\tif (uuid32_included)\n\t\tlength += 2;\n\n\tif (uuid128_included)\n\t\tlength += 2;\n\n\treturn length;\n}"
  },
  {
    "function_name": "ad_replace_data",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
    "lines": "138-170",
    "snippet": "static bool ad_replace_data(struct bt_ad *ad, uint8_t type, void *data,\n\t\t\t\t\t\t\tsize_t len)\n{\n\tstruct bt_ad_data *new_data;\n\n\tnew_data = queue_find(ad->data, data_type_match, UINT_TO_PTR(type));\n\tif (new_data) {\n\t\tif (new_data->len == len && !memcmp(new_data->data, data, len))\n\t\t\treturn false;\n\t\tnew_data->data = realloc(new_data->data, len);\n\t\tmemcpy(new_data->data, data, len);\n\t\tnew_data->len = len;\n\t\treturn true;\n\t}\n\n\tnew_data = new0(struct bt_ad_data, 1);\n\tnew_data->type = type;\n\tnew_data->data = malloc(len);\n\tif (!new_data->data) {\n\t\tfree(new_data);\n\t\treturn false;\n\t}\n\n\tmemcpy(new_data->data, data, len);\n\tnew_data->len = len;\n\n\tif (queue_push_tail(ad->data, new_data))\n\t\treturn true;\n\n\tdata_destroy(new_data);\n\n\treturn false;\n}",
    "includes": [
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/eir.h\"",
      "#include \"src/shared/ad.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "data_destroy",
          "args": [
            "new_data"
          ],
          "line": 167
        },
        "resolved": true,
        "details": {
          "function_name": "data_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "99-105",
          "snippet": "static void data_destroy(void *data)\n{\n\tstruct bt_ad_data *ad = data;\n\n\tfree(ad->data);\n\tfree(ad);\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic void data_destroy(void *data)\n{\n\tstruct bt_ad_data *ad = data;\n\n\tfree(ad->data);\n\tfree(ad);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_push_tail",
          "args": [
            "ad->data",
            "new_data"
          ],
          "line": 164
        },
        "resolved": true,
        "details": {
          "function_name": "queue_push_tail",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "88-108",
          "snippet": "bool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "new_data->data",
            "data",
            "len"
          ],
          "line": 161
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "new_data"
          ],
          "line": 157
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "956-985",
          "snippet": "static void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}"
        }
      },
      {
        "call_info": {
          "callee": "malloc",
          "args": [
            "len"
          ],
          "line": 155
        },
        "resolved": true,
        "details": {
          "function_name": "btd_malloc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/util.c",
          "lines": "41-55",
          "snippet": "void *btd_malloc(size_t size)\n{\n\tif (__builtin_expect(!!size, 1)) {\n\t\tvoid *ptr;\n\n\t\tptr = malloc(size);\n\t\tif (ptr)\n\t\t\treturn ptr;\n\n\t\tfprintf(stderr, \"failed to allocate %zu bytes\\n\", size);\n\t\tabort();\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include <string.h>",
            "#include <limits.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include <string.h>\n#include <limits.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid *btd_malloc(size_t size)\n{\n\tif (__builtin_expect(!!size, 1)) {\n\t\tvoid *ptr;\n\n\t\tptr = malloc(size);\n\t\tif (ptr)\n\t\t\treturn ptr;\n\n\t\tfprintf(stderr, \"failed to allocate %zu bytes\\n\", size);\n\t\tabort();\n\t}\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "new0",
          "args": [
            "structbt_ad_data",
            "1"
          ],
          "line": 153
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "new_data->data",
            "data",
            "len"
          ],
          "line": 148
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "realloc",
          "args": [
            "new_data->data",
            "len"
          ],
          "line": 147
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcmp",
          "args": [
            "new_data->data",
            "data",
            "len"
          ],
          "line": 145
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "queue_find",
          "args": [
            "ad->data",
            "data_type_match",
            "UINT_TO_PTR(type)"
          ],
          "line": 143
        },
        "resolved": true,
        "details": {
          "function_name": "queue_find",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "231-247",
          "snippet": "void *queue_find(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tconst void *match_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tfor (entry = queue->head; entry; entry = entry->next)\n\t\tif (function(entry->data, match_data))\n\t\t\treturn entry->data;\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid *queue_find(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tconst void *match_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tfor (entry = queue->head; entry; entry = entry->next)\n\t\tif (function(entry->data, match_data))\n\t\t\treturn entry->data;\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "UINT_TO_PTR",
          "args": [
            "type"
          ],
          "line": 143
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic bool ad_replace_data(struct bt_ad *ad, uint8_t type, void *data,\n\t\t\t\t\t\t\tsize_t len)\n{\n\tstruct bt_ad_data *new_data;\n\n\tnew_data = queue_find(ad->data, data_type_match, UINT_TO_PTR(type));\n\tif (new_data) {\n\t\tif (new_data->len == len && !memcmp(new_data->data, data, len))\n\t\t\treturn false;\n\t\tnew_data->data = realloc(new_data->data, len);\n\t\tmemcpy(new_data->data, data, len);\n\t\tnew_data->len = len;\n\t\treturn true;\n\t}\n\n\tnew_data = new0(struct bt_ad_data, 1);\n\tnew_data->type = type;\n\tnew_data->data = malloc(len);\n\tif (!new_data->data) {\n\t\tfree(new_data);\n\t\treturn false;\n\t}\n\n\tmemcpy(new_data->data, data, len);\n\tnew_data->len = len;\n\n\tif (queue_push_tail(ad->data, new_data))\n\t\treturn true;\n\n\tdata_destroy(new_data);\n\n\treturn false;\n}"
  },
  {
    "function_name": "data_type_match",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
    "lines": "130-136",
    "snippet": "static bool data_type_match(const void *data, const void *user_data)\n{\n\tconst struct bt_ad_data *a = data;\n\tconst uint8_t type = PTR_TO_UINT(user_data);\n\n\treturn a->type == type;\n}",
    "includes": [
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/eir.h\"",
      "#include \"src/shared/ad.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "PTR_TO_UINT",
          "args": [
            "user_data"
          ],
          "line": 133
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic bool data_type_match(const void *data, const void *user_data)\n{\n\tconst struct bt_ad_data *a = data;\n\tconst uint8_t type = PTR_TO_UINT(user_data);\n\n\treturn a->type == type;\n}"
  },
  {
    "function_name": "bt_ad_unref",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
    "lines": "107-128",
    "snippet": "void bt_ad_unref(struct bt_ad *ad)\n{\n\tif (!ad)\n\t\treturn;\n\n\tif (__sync_sub_and_fetch(&ad->ref_count, 1))\n\t\treturn;\n\n\tqueue_destroy(ad->service_uuids, free);\n\n\tqueue_destroy(ad->manufacturer_data, manuf_destroy);\n\n\tqueue_destroy(ad->solicit_uuids, free);\n\n\tqueue_destroy(ad->service_data, uuid_destroy);\n\n\tqueue_destroy(ad->data, data_destroy);\n\n\tfree(ad->name);\n\n\tfree(ad);\n}",
    "includes": [
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/eir.h\"",
      "#include \"src/shared/ad.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "ad"
          ],
          "line": 127
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "956-985",
          "snippet": "static void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_destroy",
          "args": [
            "ad->data",
            "data_destroy"
          ],
          "line": 123
        },
        "resolved": true,
        "details": {
          "function_name": "queue_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "68-76",
          "snippet": "void queue_destroy(struct queue *queue, queue_destroy_func_t destroy)\n{\n\tif (!queue)\n\t\treturn;\n\n\tqueue_remove_all(queue, NULL, NULL, destroy);\n\n\tqueue_unref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid queue_destroy(struct queue *queue, queue_destroy_func_t destroy)\n{\n\tif (!queue)\n\t\treturn;\n\n\tqueue_remove_all(queue, NULL, NULL, destroy);\n\n\tqueue_unref(queue);\n}"
        }
      },
      {
        "call_info": {
          "callee": "__sync_sub_and_fetch",
          "args": [
            "&ad->ref_count",
            "1"
          ],
          "line": 112
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nvoid bt_ad_unref(struct bt_ad *ad)\n{\n\tif (!ad)\n\t\treturn;\n\n\tif (__sync_sub_and_fetch(&ad->ref_count, 1))\n\t\treturn;\n\n\tqueue_destroy(ad->service_uuids, free);\n\n\tqueue_destroy(ad->manufacturer_data, manuf_destroy);\n\n\tqueue_destroy(ad->solicit_uuids, free);\n\n\tqueue_destroy(ad->service_data, uuid_destroy);\n\n\tqueue_destroy(ad->data, data_destroy);\n\n\tfree(ad->name);\n\n\tfree(ad);\n}"
  },
  {
    "function_name": "data_destroy",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
    "lines": "99-105",
    "snippet": "static void data_destroy(void *data)\n{\n\tstruct bt_ad_data *ad = data;\n\n\tfree(ad->data);\n\tfree(ad);\n}",
    "includes": [
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/eir.h\"",
      "#include \"src/shared/ad.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "ad"
          ],
          "line": 104
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "956-985",
          "snippet": "static void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic void data_destroy(void *data)\n{\n\tstruct bt_ad_data *ad = data;\n\n\tfree(ad->data);\n\tfree(ad);\n}"
  },
  {
    "function_name": "manuf_match",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
    "lines": "91-97",
    "snippet": "static bool manuf_match(const void *data, const void *elem)\n{\n\tconst struct bt_ad_manufacturer_data *manuf = elem;\n\tuint16_t manuf_id = PTR_TO_UINT(elem);\n\n\treturn manuf->manufacturer_id == manuf_id;\n}",
    "includes": [
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/eir.h\"",
      "#include \"src/shared/ad.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "PTR_TO_UINT",
          "args": [
            "elem"
          ],
          "line": 94
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic bool manuf_match(const void *data, const void *elem)\n{\n\tconst struct bt_ad_manufacturer_data *manuf = elem;\n\tuint16_t manuf_id = PTR_TO_UINT(elem);\n\n\treturn manuf->manufacturer_id == manuf_id;\n}"
  },
  {
    "function_name": "manuf_destroy",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
    "lines": "83-89",
    "snippet": "static void manuf_destroy(void *data)\n{\n\tstruct bt_ad_manufacturer_data *manuf = data;\n\n\tfree(manuf->data);\n\tfree(manuf);\n}",
    "includes": [
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/eir.h\"",
      "#include \"src/shared/ad.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "manuf"
          ],
          "line": 88
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "956-985",
          "snippet": "static void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic void manuf_destroy(void *data)\n{\n\tstruct bt_ad_manufacturer_data *manuf = data;\n\n\tfree(manuf->data);\n\tfree(manuf);\n}"
  },
  {
    "function_name": "uuid_data_match",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
    "lines": "75-81",
    "snippet": "static bool uuid_data_match(const void *data, const void *elem)\n{\n\tconst struct bt_ad_service_data *uuid_data = elem;\n\tconst bt_uuid_t *uuid = data;\n\n\treturn !bt_uuid_cmp(&uuid_data->uuid, uuid);\n}",
    "includes": [
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/eir.h\"",
      "#include \"src/shared/ad.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bt_uuid_cmp",
          "args": [
            "&uuid_data->uuid",
            "uuid"
          ],
          "line": 80
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic bool uuid_data_match(const void *data, const void *elem)\n{\n\tconst struct bt_ad_service_data *uuid_data = elem;\n\tconst bt_uuid_t *uuid = data;\n\n\treturn !bt_uuid_cmp(&uuid_data->uuid, uuid);\n}"
  },
  {
    "function_name": "uuid_destroy",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
    "lines": "67-73",
    "snippet": "static void uuid_destroy(void *data)\n{\n\tstruct bt_ad_service_data *uuid_data = data;\n\n\tfree(uuid_data->data);\n\tfree(uuid_data);\n}",
    "includes": [
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/eir.h\"",
      "#include \"src/shared/ad.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "uuid_data"
          ],
          "line": 72
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "956-985",
          "snippet": "static void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic void uuid_destroy(void *data)\n{\n\tstruct bt_ad_service_data *uuid_data = data;\n\n\tfree(uuid_data->data);\n\tfree(uuid_data);\n}"
  },
  {
    "function_name": "bt_ad_ref",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
    "lines": "58-65",
    "snippet": "struct bt_ad *bt_ad_ref(struct bt_ad *ad)\n{\n\tif (!ad)\n\t\treturn NULL;\n\n\tad->ref_count++;\n\treturn ad;\n}",
    "includes": [
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/eir.h\"",
      "#include \"src/shared/ad.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstruct bt_ad *bt_ad_ref(struct bt_ad *ad)\n{\n\tif (!ad)\n\t\treturn NULL;\n\n\tad->ref_count++;\n\treturn ad;\n}"
  },
  {
    "function_name": "bt_ad_new",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
    "lines": "43-56",
    "snippet": "struct bt_ad *bt_ad_new(void)\n{\n\tstruct bt_ad *ad;\n\n\tad = new0(struct bt_ad, 1);\n\tad->service_uuids = queue_new();\n\tad->manufacturer_data = queue_new();\n\tad->solicit_uuids = queue_new();\n\tad->service_data = queue_new();\n\tad->data = queue_new();\n\tad->appearance = UINT16_MAX;\n\n\treturn bt_ad_ref(ad);\n}",
    "includes": [
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/eir.h\"",
      "#include \"src/shared/ad.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bt_ad_ref",
          "args": [
            "ad"
          ],
          "line": 55
        },
        "resolved": true,
        "details": {
          "function_name": "bt_ad_ref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "58-65",
          "snippet": "struct bt_ad *bt_ad_ref(struct bt_ad *ad)\n{\n\tif (!ad)\n\t\treturn NULL;\n\n\tad->ref_count++;\n\treturn ad;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstruct bt_ad *bt_ad_ref(struct bt_ad *ad)\n{\n\tif (!ad)\n\t\treturn NULL;\n\n\tad->ref_count++;\n\treturn ad;\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_new",
          "args": [],
          "line": 52
        },
        "resolved": true,
        "details": {
          "function_name": "queue_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "56-66",
          "snippet": "struct queue *queue_new(void)\n{\n\tstruct queue *queue;\n\n\tqueue = new0(struct queue, 1);\n\tqueue->head = NULL;\n\tqueue->tail = NULL;\n\tqueue->entries = 0;\n\n\treturn queue_ref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nstruct queue *queue_new(void)\n{\n\tstruct queue *queue;\n\n\tqueue = new0(struct queue, 1);\n\tqueue->head = NULL;\n\tqueue->tail = NULL;\n\tqueue->entries = 0;\n\n\treturn queue_ref(queue);\n}"
        }
      },
      {
        "call_info": {
          "callee": "new0",
          "args": [
            "structbt_ad",
            "1"
          ],
          "line": 47
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstruct bt_ad *bt_ad_new(void)\n{\n\tstruct bt_ad *ad;\n\n\tad = new0(struct bt_ad, 1);\n\tad->service_uuids = queue_new();\n\tad->manufacturer_data = queue_new();\n\tad->solicit_uuids = queue_new();\n\tad->service_data = queue_new();\n\tad->data = queue_new();\n\tad->appearance = UINT16_MAX;\n\n\treturn bt_ad_ref(ad);\n}"
  }
]