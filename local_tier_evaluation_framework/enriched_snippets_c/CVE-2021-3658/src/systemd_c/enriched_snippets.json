[
  {
    "function_name": "sd_notify",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/systemd.c",
    "lines": "44-107",
    "snippet": "int sd_notify(int unset_environment, const char *state)\n{\n\tconst char *sock;\n\tstruct sockaddr_un addr;\n\tstruct msghdr msghdr;\n\tstruct iovec iovec;\n\tint fd, err;\n\n\tif (!state) {\n\t\terr = -EINVAL;\n\t\tgoto done;\n\t}\n\n\tsock = getenv(\"NOTIFY_SOCKET\");\n\tif (!sock)\n\t\treturn 0;\n\n\t/* check for abstract socket or absolute path */\n\tif (sock[0] != '@' && sock[0] != '/') {\n\t\terr = -EINVAL;\n\t\tgoto done;\n\t}\n\n\tfd = socket(AF_UNIX, SOCK_DGRAM | SOCK_CLOEXEC, 0);\n\tif (fd < 0) {\n\t\terr = -errno;\n\t\tgoto done;\n\t}\n\n\tmemset(&addr, 0, sizeof(addr));\n\taddr.sun_family = AF_UNIX;\n\tstrncpy(addr.sun_path, sock, sizeof(addr.sun_path) - 1);\n\n\tif (addr.sun_path[0] == '@')\n\t\taddr.sun_path[0] = '\\0';\n\n\tmemset(&iovec, 0, sizeof(iovec));\n\tiovec.iov_base = (char *) state;\n\tiovec.iov_len = strlen(state);\n\n\tmemset(&msghdr, 0, sizeof(msghdr));\n\tmsghdr.msg_name = &addr;\n\tmsghdr.msg_namelen = offsetof(struct sockaddr_un, sun_path) +\n\t\t\t\t\t\t\t\tstrlen(sock);\n\n\tif (msghdr.msg_namelen > sizeof(struct sockaddr_un))\n\t\tmsghdr.msg_namelen = sizeof(struct sockaddr_un);\n\n\tmsghdr.msg_iov = &iovec;\n\tmsghdr.msg_iovlen = 1;\n\n\tif (sendmsg(fd, &msghdr, MSG_NOSIGNAL) < 0)\n\t\terr = -errno;\n\telse\n\t\terr = 1;\n\n\tclose(fd);\n\ndone:\n\tif (unset_environment)\n\t\tunsetenv(\"NOTIFY_SOCKET\");\n\n\treturn err;\n}",
    "includes": [
      "#include \"systemd.h\"",
      "#include <sys/un.h>",
      "#include <sys/socket.h>",
      "#include <string.h>",
      "#include <stddef.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "unsetenv",
          "args": [
            "\"NOTIFY_SOCKET\""
          ],
          "line": 104
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "close",
          "args": [
            "fd"
          ],
          "line": 100
        },
        "resolved": true,
        "details": {
          "function_name": "hfp_context_close_container",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
          "lines": "334-347",
          "snippet": "bool hfp_context_close_container(struct hfp_context *context)\n{\n\tskip_whitespace(context);\n\n\t/* The list shall be followed by a right parenthesis (\")\" V250 5.7.3.1*/\n\tif (context->data[context->offset] != ')')\n\t\treturn false;\n\n\tcontext->offset++;\n\n\tnext_field(context);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/hfp.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <ctype.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nbool hfp_context_close_container(struct hfp_context *context)\n{\n\tskip_whitespace(context);\n\n\t/* The list shall be followed by a right parenthesis (\")\" V250 5.7.3.1*/\n\tif (context->data[context->offset] != ')')\n\t\treturn false;\n\n\tcontext->offset++;\n\n\tnext_field(context);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sendmsg",
          "args": [
            "fd",
            "&msghdr",
            "MSG_NOSIGNAL"
          ],
          "line": 95
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "sock"
          ],
          "line": 87
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&msghdr",
            "0",
            "sizeof(msghdr)"
          ],
          "line": 84
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "state"
          ],
          "line": 82
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&iovec",
            "0",
            "sizeof(iovec)"
          ],
          "line": 80
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strncpy",
          "args": [
            "addr.sun_path",
            "sock",
            "sizeof(addr.sun_path) - 1"
          ],
          "line": 75
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&addr",
            "0",
            "sizeof(addr)"
          ],
          "line": 73
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "socket",
          "args": [
            "AF_UNIX",
            "SOCK_DGRAM | SOCK_CLOEXEC",
            "0"
          ],
          "line": 67
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getenv",
          "args": [
            "\"NOTIFY_SOCKET\""
          ],
          "line": 57
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"systemd.h\"\n#include <sys/un.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <stddef.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nint sd_notify(int unset_environment, const char *state)\n{\n\tconst char *sock;\n\tstruct sockaddr_un addr;\n\tstruct msghdr msghdr;\n\tstruct iovec iovec;\n\tint fd, err;\n\n\tif (!state) {\n\t\terr = -EINVAL;\n\t\tgoto done;\n\t}\n\n\tsock = getenv(\"NOTIFY_SOCKET\");\n\tif (!sock)\n\t\treturn 0;\n\n\t/* check for abstract socket or absolute path */\n\tif (sock[0] != '@' && sock[0] != '/') {\n\t\terr = -EINVAL;\n\t\tgoto done;\n\t}\n\n\tfd = socket(AF_UNIX, SOCK_DGRAM | SOCK_CLOEXEC, 0);\n\tif (fd < 0) {\n\t\terr = -errno;\n\t\tgoto done;\n\t}\n\n\tmemset(&addr, 0, sizeof(addr));\n\taddr.sun_family = AF_UNIX;\n\tstrncpy(addr.sun_path, sock, sizeof(addr.sun_path) - 1);\n\n\tif (addr.sun_path[0] == '@')\n\t\taddr.sun_path[0] = '\\0';\n\n\tmemset(&iovec, 0, sizeof(iovec));\n\tiovec.iov_base = (char *) state;\n\tiovec.iov_len = strlen(state);\n\n\tmemset(&msghdr, 0, sizeof(msghdr));\n\tmsghdr.msg_name = &addr;\n\tmsghdr.msg_namelen = offsetof(struct sockaddr_un, sun_path) +\n\t\t\t\t\t\t\t\tstrlen(sock);\n\n\tif (msghdr.msg_namelen > sizeof(struct sockaddr_un))\n\t\tmsghdr.msg_namelen = sizeof(struct sockaddr_un);\n\n\tmsghdr.msg_iov = &iovec;\n\tmsghdr.msg_iovlen = 1;\n\n\tif (sendmsg(fd, &msghdr, MSG_NOSIGNAL) < 0)\n\t\terr = -errno;\n\telse\n\t\terr = 1;\n\n\tclose(fd);\n\ndone:\n\tif (unset_environment)\n\t\tunsetenv(\"NOTIFY_SOCKET\");\n\n\treturn err;\n}"
  },
  {
    "function_name": "sd_listen_fds",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/systemd.c",
    "lines": "39-42",
    "snippet": "int sd_listen_fds(int unset_environment)\n{\n\treturn 0;\n}",
    "includes": [
      "#include \"systemd.h\"",
      "#include <sys/un.h>",
      "#include <sys/socket.h>",
      "#include <string.h>",
      "#include <stddef.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"systemd.h\"\n#include <sys/un.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <stddef.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nint sd_listen_fds(int unset_environment)\n{\n\treturn 0;\n}"
  }
]