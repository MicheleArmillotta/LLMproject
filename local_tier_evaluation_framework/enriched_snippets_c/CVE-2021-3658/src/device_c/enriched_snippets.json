[
  {
    "function_name": "btd_device_cleanup",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "6471-6474",
    "snippet": "void btd_device_cleanup(void)\n{\n\tbtd_service_remove_state_cb(service_state_cb_id);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static unsigned service_state_cb_id;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "btd_service_remove_state_cb",
          "args": [
            "service_state_cb_id"
          ],
          "line": 6473
        },
        "resolved": true,
        "details": {
          "function_name": "btd_service_remove_state_cb",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
          "lines": "356-371",
          "snippet": "bool btd_service_remove_state_cb(unsigned int id)\n{\n\tGSList *l;\n\n\tfor (l = state_callbacks; l != NULL; l = g_slist_next(l)) {\n\t\tstruct service_state_callback *cb = l->data;\n\n\t\tif (cb && cb->id == id) {\n\t\t\tstate_callbacks = g_slist_remove(state_callbacks, cb);\n\t\t\tg_free(cb);\n\t\t\treturn true;\n\t\t}\n\t}\n\n\treturn false;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/stat.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static GSList *state_callbacks = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic GSList *state_callbacks = NULL;\n\nbool btd_service_remove_state_cb(unsigned int id)\n{\n\tGSList *l;\n\n\tfor (l = state_callbacks; l != NULL; l = g_slist_next(l)) {\n\t\tstruct service_state_callback *cb = l->data;\n\n\t\tif (cb && cb->id == id) {\n\t\t\tstate_callbacks = g_slist_remove(state_callbacks, cb);\n\t\t\tg_free(cb);\n\t\t\treturn true;\n\t\t}\n\t}\n\n\treturn false;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic unsigned service_state_cb_id;\n\nvoid btd_device_cleanup(void)\n{\n\tbtd_service_remove_state_cb(service_state_cb_id);\n}"
  },
  {
    "function_name": "btd_device_init",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "6464-6469",
    "snippet": "void btd_device_init(void)\n{\n\tdbus_conn = btd_get_dbus_connection();\n\tservice_state_cb_id = btd_service_add_state_cb(\n\t\t\t\t\t\tservice_state_changed, NULL);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static DBusConnection *dbus_conn = NULL;",
      "static unsigned service_state_cb_id;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "btd_service_add_state_cb",
          "args": [
            "service_state_changed",
            "NULL"
          ],
          "line": 6467
        },
        "resolved": true,
        "details": {
          "function_name": "btd_service_add_state_cb",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
          "lines": "341-354",
          "snippet": "unsigned int btd_service_add_state_cb(btd_service_state_cb cb, void *user_data)\n{\n\tstruct service_state_callback *state_cb;\n\tstatic unsigned int id = 0;\n\n\tstate_cb = g_new0(struct service_state_callback, 1);\n\tstate_cb->cb = cb;\n\tstate_cb->user_data = user_data;\n\tstate_cb->id = ++id;\n\n\tstate_callbacks = g_slist_append(state_callbacks, state_cb);\n\n\treturn state_cb->id;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/stat.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static GSList *state_callbacks = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic GSList *state_callbacks = NULL;\n\nunsigned int btd_service_add_state_cb(btd_service_state_cb cb, void *user_data)\n{\n\tstruct service_state_callback *state_cb;\n\tstatic unsigned int id = 0;\n\n\tstate_cb = g_new0(struct service_state_callback, 1);\n\tstate_cb->cb = cb;\n\tstate_cb->user_data = user_data;\n\tstate_cb->id = ++id;\n\n\tstate_callbacks = g_slist_append(state_callbacks, state_cb);\n\n\treturn state_cb->id;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_get_dbus_connection",
          "args": [],
          "line": 6466
        },
        "resolved": true,
        "details": {
          "function_name": "btd_get_dbus_connection",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/dbus-common.c",
          "lines": "61-64",
          "snippet": "DBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *connection = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *connection = NULL;\n\nDBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic unsigned service_state_cb_id;\n\nvoid btd_device_init(void)\n{\n\tdbus_conn = btd_get_dbus_connection();\n\tservice_state_cb_id = btd_service_add_state_cb(\n\t\t\t\t\t\tservice_state_changed, NULL);\n}"
  },
  {
    "function_name": "btd_device_get_service",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "6448-6462",
    "snippet": "struct btd_service *btd_device_get_service(struct btd_device *dev,\n\t\t\t\t\t\tconst char *remote_uuid)\n{\n\tGSList *l;\n\n\tfor (l = dev->services; l != NULL; l = g_slist_next(l)) {\n\t\tstruct btd_service *service = l->data;\n\t\tstruct btd_profile *p = btd_service_get_profile(service);\n\n\t\tif (g_str_equal(p->remote_uuid, remote_uuid))\n\t\t\treturn service;\n\t}\n\n\treturn NULL;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_str_equal",
          "args": [
            "p->remote_uuid",
            "remote_uuid"
          ],
          "line": 6457
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_service_get_profile",
          "args": [
            "service"
          ],
          "line": 6455
        },
        "resolved": true,
        "details": {
          "function_name": "btd_service_get_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
          "lines": "316-319",
          "snippet": "struct btd_profile *btd_service_get_profile(const struct btd_service *service)\n{\n\treturn service->profile;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/stat.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstruct btd_profile *btd_service_get_profile(const struct btd_service *service)\n{\n\treturn service->profile;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_slist_next",
          "args": [
            "l"
          ],
          "line": 6453
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstruct btd_service *btd_device_get_service(struct btd_device *dev,\n\t\t\t\t\t\tconst char *remote_uuid)\n{\n\tGSList *l;\n\n\tfor (l = dev->services; l != NULL; l = g_slist_next(l)) {\n\t\tstruct btd_service *service = l->data;\n\t\tstruct btd_profile *p = btd_service_get_profile(service);\n\n\t\tif (g_str_equal(p->remote_uuid, remote_uuid))\n\t\t\treturn service;\n\t}\n\n\treturn NULL;\n}"
  },
  {
    "function_name": "service_state_changed",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "6429-6446",
    "snippet": "static void service_state_changed(struct btd_service *service,\n\t\t\t\t\t\tbtd_service_state_t old_state,\n\t\t\t\t\t\tbtd_service_state_t new_state,\n\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct btd_profile *profile = btd_service_get_profile(service);\n\tstruct btd_device *device = btd_service_get_device(service);\n\tint err = btd_service_get_error(service);\n\n\tif (new_state == BTD_SERVICE_STATE_CONNECTING ||\n\t\t\t\tnew_state == BTD_SERVICE_STATE_DISCONNECTING)\n\t\treturn;\n\n\tif (old_state == BTD_SERVICE_STATE_CONNECTING)\n\t\tdevice_profile_connected(device, profile, err);\n\telse if (old_state == BTD_SERVICE_STATE_DISCONNECTING)\n\t\tdevice_profile_disconnected(device, profile, err);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "device_profile_disconnected",
          "args": [
            "device",
            "profile",
            "err"
          ],
          "line": 6445
        },
        "resolved": true,
        "details": {
          "function_name": "device_profile_disconnected",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "2005-2021",
          "snippet": "static void device_profile_disconnected(struct btd_device *dev,\n\t\t\t\t\tstruct btd_profile *profile, int err)\n{\n\tif (!dev->disconnect)\n\t\treturn;\n\n\tif (err)\n\t\tg_dbus_send_message(dbus_conn,\n\t\t\t\t\tbtd_error_failed(dev->disconnect,\n\t\t\t\t\t\t\tstrerror(-err)));\n\telse\n\t\tg_dbus_send_reply(dbus_conn, dev->disconnect,\n\t\t\t\t\t\t\tDBUS_TYPE_INVALID);\n\n\tdbus_message_unref(dev->disconnect);\n\tdev->disconnect = NULL;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *dbus_conn = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\n\nstatic void device_profile_disconnected(struct btd_device *dev,\n\t\t\t\t\tstruct btd_profile *profile, int err)\n{\n\tif (!dev->disconnect)\n\t\treturn;\n\n\tif (err)\n\t\tg_dbus_send_message(dbus_conn,\n\t\t\t\t\tbtd_error_failed(dev->disconnect,\n\t\t\t\t\t\t\tstrerror(-err)));\n\telse\n\t\tg_dbus_send_reply(dbus_conn, dev->disconnect,\n\t\t\t\t\t\t\tDBUS_TYPE_INVALID);\n\n\tdbus_message_unref(dev->disconnect);\n\tdev->disconnect = NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "device_profile_connected",
          "args": [
            "device",
            "profile",
            "err"
          ],
          "line": 6443
        },
        "resolved": true,
        "details": {
          "function_name": "device_profile_connected",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "1579-1652",
          "snippet": "static void device_profile_connected(struct btd_device *dev,\n\t\t\t\t\tstruct btd_profile *profile, int err)\n{\n\tstruct btd_service *pending;\n\tGSList *l;\n\n\tDBG(\"%s %s (%d)\", profile->name, strerror(-err), -err);\n\n\tif (!err)\n\t\tbtd_device_set_temporary(dev, false);\n\n\tif (dev->pending == NULL)\n\t\tgoto done;\n\n\tif (!btd_device_is_connected(dev)) {\n\t\tswitch (-err) {\n\t\tcase EHOSTDOWN: /* page timeout */\n\t\tcase EHOSTUNREACH: /* adapter not powered */\n\t\tcase ECONNABORTED: /* adapter powered down */\n\t\t\tgoto done;\n\t\t}\n\t}\n\n\n\tpending = dev->pending->data;\n\tl = find_service_with_profile(dev->pending, profile);\n\tif (l != NULL)\n\t\tdev->pending = g_slist_delete_link(dev->pending, l);\n\n\t/* Only continue connecting the next profile if it matches the first\n\t * pending, otherwise it will trigger another connect to the same\n\t * profile\n\t */\n\tif (profile != btd_service_get_profile(pending))\n\t\treturn;\n\n\tif (connect_next(dev) == 0)\n\t\treturn;\n\ndone:\n\tg_slist_free(dev->pending);\n\tdev->pending = NULL;\n\n\tif (!dev->connect)\n\t\treturn;\n\n\tif (!err && dbus_message_is_method_call(dev->connect, DEVICE_INTERFACE,\n\t\t\t\t\t\t\t\t\"Connect\"))\n\t\tdev->general_connect = TRUE;\n\n\tDBG(\"returning response to %s\", dbus_message_get_sender(dev->connect));\n\n\tl = find_service_with_state(dev->services, BTD_SERVICE_STATE_CONNECTED);\n\n\tif (err && l == NULL) {\n\t\t/* Fallback to LE bearer if supported */\n\t\tif (err == -EHOSTDOWN && dev->le && !dev->le_state.connected) {\n\t\t\terr = device_connect_le(dev);\n\t\t\tif (err == 0)\n\t\t\t\treturn;\n\t\t}\n\n\t\tg_dbus_send_message(dbus_conn,\n\t\t\t\tbtd_error_failed(dev->connect, strerror(-err)));\n\t} else {\n\t\t/* Start passive SDP discovery to update known services */\n\t\tif (dev->bredr && !dev->svc_refreshed)\n\t\t\tdevice_browse_sdp(dev, NULL);\n\t\tg_dbus_send_reply(dbus_conn, dev->connect, DBUS_TYPE_INVALID);\n\t}\n\n\tdbus_message_unref(dev->connect);\n\tdev->connect = NULL;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *dbus_conn = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\n\nstatic void device_profile_connected(struct btd_device *dev,\n\t\t\t\t\tstruct btd_profile *profile, int err)\n{\n\tstruct btd_service *pending;\n\tGSList *l;\n\n\tDBG(\"%s %s (%d)\", profile->name, strerror(-err), -err);\n\n\tif (!err)\n\t\tbtd_device_set_temporary(dev, false);\n\n\tif (dev->pending == NULL)\n\t\tgoto done;\n\n\tif (!btd_device_is_connected(dev)) {\n\t\tswitch (-err) {\n\t\tcase EHOSTDOWN: /* page timeout */\n\t\tcase EHOSTUNREACH: /* adapter not powered */\n\t\tcase ECONNABORTED: /* adapter powered down */\n\t\t\tgoto done;\n\t\t}\n\t}\n\n\n\tpending = dev->pending->data;\n\tl = find_service_with_profile(dev->pending, profile);\n\tif (l != NULL)\n\t\tdev->pending = g_slist_delete_link(dev->pending, l);\n\n\t/* Only continue connecting the next profile if it matches the first\n\t * pending, otherwise it will trigger another connect to the same\n\t * profile\n\t */\n\tif (profile != btd_service_get_profile(pending))\n\t\treturn;\n\n\tif (connect_next(dev) == 0)\n\t\treturn;\n\ndone:\n\tg_slist_free(dev->pending);\n\tdev->pending = NULL;\n\n\tif (!dev->connect)\n\t\treturn;\n\n\tif (!err && dbus_message_is_method_call(dev->connect, DEVICE_INTERFACE,\n\t\t\t\t\t\t\t\t\"Connect\"))\n\t\tdev->general_connect = TRUE;\n\n\tDBG(\"returning response to %s\", dbus_message_get_sender(dev->connect));\n\n\tl = find_service_with_state(dev->services, BTD_SERVICE_STATE_CONNECTED);\n\n\tif (err && l == NULL) {\n\t\t/* Fallback to LE bearer if supported */\n\t\tif (err == -EHOSTDOWN && dev->le && !dev->le_state.connected) {\n\t\t\terr = device_connect_le(dev);\n\t\t\tif (err == 0)\n\t\t\t\treturn;\n\t\t}\n\n\t\tg_dbus_send_message(dbus_conn,\n\t\t\t\tbtd_error_failed(dev->connect, strerror(-err)));\n\t} else {\n\t\t/* Start passive SDP discovery to update known services */\n\t\tif (dev->bredr && !dev->svc_refreshed)\n\t\t\tdevice_browse_sdp(dev, NULL);\n\t\tg_dbus_send_reply(dbus_conn, dev->connect, DBUS_TYPE_INVALID);\n\t}\n\n\tdbus_message_unref(dev->connect);\n\tdev->connect = NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_service_get_error",
          "args": [
            "service"
          ],
          "line": 6436
        },
        "resolved": true,
        "details": {
          "function_name": "btd_service_get_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
          "lines": "336-339",
          "snippet": "int btd_service_get_error(const struct btd_service *service)\n{\n\treturn service->err;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/stat.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nint btd_service_get_error(const struct btd_service *service)\n{\n\treturn service->err;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_service_get_device",
          "args": [
            "service"
          ],
          "line": 6435
        },
        "resolved": true,
        "details": {
          "function_name": "btd_service_get_device",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
          "lines": "311-314",
          "snippet": "struct btd_device *btd_service_get_device(const struct btd_service *service)\n{\n\treturn service->device;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/stat.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstruct btd_device *btd_service_get_device(const struct btd_service *service)\n{\n\treturn service->device;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_service_get_profile",
          "args": [
            "service"
          ],
          "line": 6434
        },
        "resolved": true,
        "details": {
          "function_name": "btd_service_get_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
          "lines": "316-319",
          "snippet": "struct btd_profile *btd_service_get_profile(const struct btd_service *service)\n{\n\treturn service->profile;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/stat.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstruct btd_profile *btd_service_get_profile(const struct btd_service *service)\n{\n\treturn service->profile;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void service_state_changed(struct btd_service *service,\n\t\t\t\t\t\tbtd_service_state_t old_state,\n\t\t\t\t\t\tbtd_service_state_t new_state,\n\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct btd_profile *profile = btd_service_get_profile(service);\n\tstruct btd_device *device = btd_service_get_device(service);\n\tint err = btd_service_get_error(service);\n\n\tif (new_state == BTD_SERVICE_STATE_CONNECTING ||\n\t\t\t\tnew_state == BTD_SERVICE_STATE_DISCONNECTING)\n\t\treturn;\n\n\tif (old_state == BTD_SERVICE_STATE_CONNECTING)\n\t\tdevice_profile_connected(device, profile, err);\n\telse if (old_state == BTD_SERVICE_STATE_DISCONNECTING)\n\t\tdevice_profile_disconnected(device, profile, err);\n}"
  },
  {
    "function_name": "btd_device_set_pnpid",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "6408-6427",
    "snippet": "void btd_device_set_pnpid(struct btd_device *device, uint16_t source,\n\t\t\tuint16_t vendor, uint16_t product, uint16_t version)\n{\n\tif (device->vendor_src == source && device->version == version &&\n\t\t\tdevice->vendor == vendor && device->product == product)\n\t\treturn;\n\n\tdevice->vendor_src = source;\n\tdevice->vendor = vendor;\n\tdevice->product = product;\n\tdevice->version = version;\n\n\tfree(device->modalias);\n\tdevice->modalias = bt_modalias(source, vendor, product, version);\n\n\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"Modalias\");\n\n\tstore_device_info(device);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static DBusConnection *dbus_conn = NULL;",
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "store_device_info",
          "args": [
            "device"
          ],
          "line": 6426
        },
        "resolved": true,
        "details": {
          "function_name": "store_device_info",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "475-487",
          "snippet": "static void store_device_info(struct btd_device *device)\n{\n\tif (device->temporary || device->store_id > 0)\n\t\treturn;\n\n\tif (device_address_is_private(device)) {\n\t\tDBG(\"Can't store info for private addressed device %s\",\n\t\t\t\t\t\t\t\tdevice->path);\n\t\treturn;\n\t}\n\n\tdevice->store_id = g_idle_add(store_device_info_cb, device);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void store_device_info(struct btd_device *device)\n{\n\tif (device->temporary || device->store_id > 0)\n\t\treturn;\n\n\tif (device_address_is_private(device)) {\n\t\tDBG(\"Can't store info for private addressed device %s\",\n\t\t\t\t\t\t\t\tdevice->path);\n\t\treturn;\n\t}\n\n\tdevice->store_id = g_idle_add(store_device_info_cb, device);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_emit_property_changed",
          "args": [
            "dbus_conn",
            "device->path",
            "DEVICE_INTERFACE",
            "\"Modalias\""
          ],
          "line": 6423
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_modalias",
          "args": [
            "source",
            "vendor",
            "product",
            "version"
          ],
          "line": 6421
        },
        "resolved": true,
        "details": {
          "function_name": "bt_modalias",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/uuid-helper.c",
          "lines": "40-63",
          "snippet": "char *bt_modalias(uint16_t source, uint16_t vendor,\n\t\t\t\t\tuint16_t product, uint16_t version)\n{\n\tchar *str;\n\tint err;\n\n\tswitch (source) {\n\tcase 0x0001:\n\t\terr = asprintf(&str, \"%s:v%04Xp%04Xd%04X\",\n\t\t\t\t\t\"bluetooth\", vendor, product, version);\n\t\tbreak;\n\tcase 0x0002:\n\t\terr = asprintf(&str, \"%s:v%04Xp%04Xd%04X\",\n\t\t\t\t\t\"usb\", vendor, product, version);\n\t\tbreak;\n\tdefault:\n\t\treturn NULL;\n\t}\n\n\tif (err < 0)\n\t\treturn NULL;\n\n\treturn str;\n}",
          "includes": [
            "#include \"uuid-helper.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <arpa/inet.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"uuid-helper.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <arpa/inet.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *bt_modalias(uint16_t source, uint16_t vendor,\n\t\t\t\t\tuint16_t product, uint16_t version)\n{\n\tchar *str;\n\tint err;\n\n\tswitch (source) {\n\tcase 0x0001:\n\t\terr = asprintf(&str, \"%s:v%04Xp%04Xd%04X\",\n\t\t\t\t\t\"bluetooth\", vendor, product, version);\n\t\tbreak;\n\tcase 0x0002:\n\t\terr = asprintf(&str, \"%s:v%04Xp%04Xd%04X\",\n\t\t\t\t\t\"usb\", vendor, product, version);\n\t\tbreak;\n\tdefault:\n\t\treturn NULL;\n\t}\n\n\tif (err < 0)\n\t\treturn NULL;\n\n\treturn str;\n}"
        }
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "device->modalias"
          ],
          "line": 6420
        },
        "resolved": true,
        "details": {
          "function_name": "device_auth_req_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5662-5676",
          "snippet": "static void device_auth_req_free(struct btd_device *device)\n{\n\tstruct authentication_req *authr = device->authr;\n\n\tif (!authr)\n\t\treturn;\n\n\tif (authr->agent)\n\t\tagent_unref(authr->agent);\n\n\tg_free(authr->pincode);\n\tg_free(authr);\n\n\tdevice->authr = NULL;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void device_auth_req_free(struct btd_device *device)\n{\n\tstruct authentication_req *authr = device->authr;\n\n\tif (!authr)\n\t\treturn;\n\n\tif (authr->agent)\n\t\tagent_unref(authr->agent);\n\n\tg_free(authr->pincode);\n\tg_free(authr);\n\n\tdevice->authr = NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid btd_device_set_pnpid(struct btd_device *device, uint16_t source,\n\t\t\tuint16_t vendor, uint16_t product, uint16_t version)\n{\n\tif (device->vendor_src == source && device->version == version &&\n\t\t\tdevice->vendor == vendor && device->product == product)\n\t\treturn;\n\n\tdevice->vendor_src = source;\n\tdevice->vendor = vendor;\n\tdevice->product = product;\n\tdevice->version = version;\n\n\tfree(device->modalias);\n\tdevice->modalias = bt_modalias(source, vendor, product, version);\n\n\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"Modalias\");\n\n\tstore_device_info(device);\n}"
  },
  {
    "function_name": "device_set_appearance",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "6390-6406",
    "snippet": "void device_set_appearance(struct btd_device *device, uint16_t value)\n{\n\tconst char *icon = gap_appearance_to_icon(value);\n\n\tif (device->appearance == value)\n\t\treturn;\n\n\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\tDEVICE_INTERFACE, \"Appearance\");\n\n\tif (icon)\n\t\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"Icon\");\n\n\tdevice->appearance = value;\n\tstore_device_info(device);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static DBusConnection *dbus_conn = NULL;",
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "store_device_info",
          "args": [
            "device"
          ],
          "line": 6405
        },
        "resolved": true,
        "details": {
          "function_name": "store_device_info",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "475-487",
          "snippet": "static void store_device_info(struct btd_device *device)\n{\n\tif (device->temporary || device->store_id > 0)\n\t\treturn;\n\n\tif (device_address_is_private(device)) {\n\t\tDBG(\"Can't store info for private addressed device %s\",\n\t\t\t\t\t\t\t\tdevice->path);\n\t\treturn;\n\t}\n\n\tdevice->store_id = g_idle_add(store_device_info_cb, device);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void store_device_info(struct btd_device *device)\n{\n\tif (device->temporary || device->store_id > 0)\n\t\treturn;\n\n\tif (device_address_is_private(device)) {\n\t\tDBG(\"Can't store info for private addressed device %s\",\n\t\t\t\t\t\t\t\tdevice->path);\n\t\treturn;\n\t}\n\n\tdevice->store_id = g_idle_add(store_device_info_cb, device);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_emit_property_changed",
          "args": [
            "dbus_conn",
            "device->path",
            "DEVICE_INTERFACE",
            "\"Icon\""
          ],
          "line": 6401
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_emit_property_changed",
          "args": [
            "dbus_conn",
            "device->path",
            "DEVICE_INTERFACE",
            "\"Appearance\""
          ],
          "line": 6397
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gap_appearance_to_icon",
          "args": [
            "value"
          ],
          "line": 6392
        },
        "resolved": true,
        "details": {
          "function_name": "gap_appearance_to_icon",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/dbus-common.c",
          "lines": "130-163",
          "snippet": "const char *gap_appearance_to_icon(uint16_t appearance)\n{\n\tswitch ((appearance & 0xffc0) >> 6) {\n\tcase 0x00:\n\t\treturn \"unknown\";\n\tcase 0x01:\n\t\treturn \"phone\";\n\tcase 0x02:\n\t\treturn \"computer\";\n\tcase 0x05:\n\t\treturn \"video-display\";\n\tcase 0x0a:\n\t\treturn \"multimedia-player\";\n\tcase 0x0b:\n\t\treturn \"scanner\";\n\tcase 0x0f: /* HID Generic */\n\t\tswitch (appearance & 0x3f) {\n\t\tcase 0x01:\n\t\t\treturn \"input-keyboard\";\n\t\tcase 0x02:\n\t\t\treturn \"input-mouse\";\n\t\tcase 0x03:\n\t\tcase 0x04:\n\t\t\treturn \"input-gaming\";\n\t\tcase 0x05:\n\t\t\treturn \"input-tablet\";\n\t\tcase 0x08:\n\t\t\treturn \"scanner\";\n\t\t}\n\t\tbreak;\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nconst char *gap_appearance_to_icon(uint16_t appearance)\n{\n\tswitch ((appearance & 0xffc0) >> 6) {\n\tcase 0x00:\n\t\treturn \"unknown\";\n\tcase 0x01:\n\t\treturn \"phone\";\n\tcase 0x02:\n\t\treturn \"computer\";\n\tcase 0x05:\n\t\treturn \"video-display\";\n\tcase 0x0a:\n\t\treturn \"multimedia-player\";\n\tcase 0x0b:\n\t\treturn \"scanner\";\n\tcase 0x0f: /* HID Generic */\n\t\tswitch (appearance & 0x3f) {\n\t\tcase 0x01:\n\t\t\treturn \"input-keyboard\";\n\t\tcase 0x02:\n\t\t\treturn \"input-mouse\";\n\t\tcase 0x03:\n\t\tcase 0x04:\n\t\t\treturn \"input-gaming\";\n\t\tcase 0x05:\n\t\t\treturn \"input-tablet\";\n\t\tcase 0x08:\n\t\t\treturn \"scanner\";\n\t\t}\n\t\tbreak;\n\t}\n\n\treturn NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid device_set_appearance(struct btd_device *device, uint16_t value)\n{\n\tconst char *icon = gap_appearance_to_icon(value);\n\n\tif (device->appearance == value)\n\t\treturn;\n\n\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\tDEVICE_INTERFACE, \"Appearance\");\n\n\tif (icon)\n\t\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"Icon\");\n\n\tdevice->appearance = value;\n\tstore_device_info(device);\n}"
  },
  {
    "function_name": "device_get_appearance",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "6379-6388",
    "snippet": "int device_get_appearance(struct btd_device *device, uint16_t *value)\n{\n\tif (device->appearance == 0)\n\t\treturn -1;\n\n\tif (value)\n\t\t*value = device->appearance;\n\n\treturn 0;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nint device_get_appearance(struct btd_device *device, uint16_t *value)\n{\n\tif (device->appearance == 0)\n\t\treturn -1;\n\n\tif (value)\n\t\t*value = device->appearance;\n\n\treturn 0;\n}"
  },
  {
    "function_name": "btd_device_unref",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "6364-6377",
    "snippet": "void btd_device_unref(struct btd_device *device)\n{\n\tif (__sync_sub_and_fetch(&device->ref_count, 1))\n\t\treturn;\n\n\tif (!device->path) {\n\t\terror(\"freeing device without an object path\");\n\t\treturn;\n\t}\n\n\tDBG(\"Freeing device %s\", device->path);\n\n\tg_dbus_unregister_interface(dbus_conn, device->path, DEVICE_INTERFACE);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static DBusConnection *dbus_conn = NULL;",
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_dbus_unregister_interface",
          "args": [
            "dbus_conn",
            "device->path",
            "DEVICE_INTERFACE"
          ],
          "line": 6376
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Freeing device %s\"",
            "device->path"
          ],
          "line": 6374
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"freeing device without an object path\""
          ],
          "line": 6370
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_not_ready",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "118-122",
          "snippet": "DBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "__sync_sub_and_fetch",
          "args": [
            "&device->ref_count",
            "1"
          ],
          "line": 6366
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid btd_device_unref(struct btd_device *device)\n{\n\tif (__sync_sub_and_fetch(&device->ref_count, 1))\n\t\treturn;\n\n\tif (!device->path) {\n\t\terror(\"freeing device without an object path\");\n\t\treturn;\n\t}\n\n\tDBG(\"Freeing device %s\", device->path);\n\n\tg_dbus_unregister_interface(dbus_conn, device->path, DEVICE_INTERFACE);\n}"
  },
  {
    "function_name": "btd_device_ref",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "6357-6362",
    "snippet": "struct btd_device *btd_device_ref(struct btd_device *device)\n{\n\t__sync_fetch_and_add(&device->ref_count, 1);\n\n\treturn device;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "__sync_fetch_and_add",
          "args": [
            "&device->ref_count",
            "1"
          ],
          "line": 6359
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstruct btd_device *btd_device_ref(struct btd_device *device)\n{\n\t__sync_fetch_and_add(&device->ref_count, 1);\n\n\treturn device;\n}"
  },
  {
    "function_name": "btd_device_get_record",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "6344-6355",
    "snippet": "const sdp_record_t *btd_device_get_record(struct btd_device *device,\n\t\t\t\t\t\t\tconst char *uuid)\n{\n\t/* Load records from storage if there is nothing in cache */\n\tif (!device->tmp_records) {\n\t\tdevice->tmp_records = read_device_records(device);\n\t\tif (!device->tmp_records)\n\t\t\treturn NULL;\n\t}\n\n\treturn find_record_in_list(device->tmp_records, uuid);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "find_record_in_list",
          "args": [
            "device->tmp_records",
            "uuid"
          ],
          "line": 6354
        },
        "resolved": true,
        "details": {
          "function_name": "find_record_in_list",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/storage.c",
          "lines": "169-198",
          "snippet": "sdp_record_t *find_record_in_list(sdp_list_t *recs, const char *uuid)\n{\n\tsdp_list_t *seq;\n\n\tfor (seq = recs; seq; seq = seq->next) {\n\t\tsdp_record_t *rec = (sdp_record_t *) seq->data;\n\t\tsdp_list_t *svcclass = NULL;\n\t\tchar *uuid_str;\n\n\t\tif (sdp_get_service_classes(rec, &svcclass) < 0)\n\t\t\tcontinue;\n\n\t\t/* Extract the uuid */\n\t\tuuid_str = bt_uuid2string(svcclass->data);\n\t\tif (!uuid_str) {\n\t\t\tsdp_list_free(svcclass, free);\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (!strcasecmp(uuid_str, uuid)) {\n\t\t\tsdp_list_free(svcclass, free);\n\t\t\tfree(uuid_str);\n\t\t\treturn rec;\n\t\t}\n\n\t\tsdp_list_free(svcclass, free);\n\t\tfree(uuid_str);\n\t}\n\treturn NULL;\n}",
          "includes": [
            "#include \"storage.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"textfile.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <time.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <ctype.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"storage.h\"\n#include \"uuid-helper.h\"\n#include \"textfile.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <time.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <ctype.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nsdp_record_t *find_record_in_list(sdp_list_t *recs, const char *uuid)\n{\n\tsdp_list_t *seq;\n\n\tfor (seq = recs; seq; seq = seq->next) {\n\t\tsdp_record_t *rec = (sdp_record_t *) seq->data;\n\t\tsdp_list_t *svcclass = NULL;\n\t\tchar *uuid_str;\n\n\t\tif (sdp_get_service_classes(rec, &svcclass) < 0)\n\t\t\tcontinue;\n\n\t\t/* Extract the uuid */\n\t\tuuid_str = bt_uuid2string(svcclass->data);\n\t\tif (!uuid_str) {\n\t\t\tsdp_list_free(svcclass, free);\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (!strcasecmp(uuid_str, uuid)) {\n\t\t\tsdp_list_free(svcclass, free);\n\t\t\tfree(uuid_str);\n\t\t\treturn rec;\n\t\t}\n\n\t\tsdp_list_free(svcclass, free);\n\t\tfree(uuid_str);\n\t}\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "read_device_records",
          "args": [
            "device"
          ],
          "line": 6349
        },
        "resolved": true,
        "details": {
          "function_name": "read_device_records",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "6275-6309",
          "snippet": "static sdp_list_t *read_device_records(struct btd_device *device)\n{\n\tchar local[18], peer[18];\n\tchar filename[PATH_MAX];\n\tGKeyFile *key_file;\n\tchar **keys, **handle;\n\tchar *str;\n\tsdp_list_t *recs = NULL;\n\tsdp_record_t *rec;\n\n\tba2str(btd_adapter_get_address(device->adapter), local);\n\tba2str(&device->bdaddr, peer);\n\n\tsnprintf(filename, PATH_MAX, STORAGEDIR \"/%s/cache/%s\", local, peer);\n\n\tkey_file = g_key_file_new();\n\tg_key_file_load_from_file(key_file, filename, 0, NULL);\n\tkeys = g_key_file_get_keys(key_file, \"ServiceRecords\", NULL, NULL);\n\n\tfor (handle = keys; handle && *handle; handle++) {\n\t\tstr = g_key_file_get_string(key_file, \"ServiceRecords\",\n\t\t\t\t\t\t*handle, NULL);\n\t\tif (!str)\n\t\t\tcontinue;\n\n\t\trec = record_from_string(str);\n\t\trecs = sdp_list_append(recs, rec);\n\t\tg_free(str);\n\t}\n\n\tg_strfreev(keys);\n\tg_key_file_free(key_file);\n\n\treturn recs;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic sdp_list_t *read_device_records(struct btd_device *device)\n{\n\tchar local[18], peer[18];\n\tchar filename[PATH_MAX];\n\tGKeyFile *key_file;\n\tchar **keys, **handle;\n\tchar *str;\n\tsdp_list_t *recs = NULL;\n\tsdp_record_t *rec;\n\n\tba2str(btd_adapter_get_address(device->adapter), local);\n\tba2str(&device->bdaddr, peer);\n\n\tsnprintf(filename, PATH_MAX, STORAGEDIR \"/%s/cache/%s\", local, peer);\n\n\tkey_file = g_key_file_new();\n\tg_key_file_load_from_file(key_file, filename, 0, NULL);\n\tkeys = g_key_file_get_keys(key_file, \"ServiceRecords\", NULL, NULL);\n\n\tfor (handle = keys; handle && *handle; handle++) {\n\t\tstr = g_key_file_get_string(key_file, \"ServiceRecords\",\n\t\t\t\t\t\t*handle, NULL);\n\t\tif (!str)\n\t\t\tcontinue;\n\n\t\trec = record_from_string(str);\n\t\trecs = sdp_list_append(recs, rec);\n\t\tg_free(str);\n\t}\n\n\tg_strfreev(keys);\n\tg_key_file_free(key_file);\n\n\treturn recs;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nconst sdp_record_t *btd_device_get_record(struct btd_device *device,\n\t\t\t\t\t\t\tconst char *uuid)\n{\n\t/* Load records from storage if there is nothing in cache */\n\tif (!device->tmp_records) {\n\t\tdevice->tmp_records = read_device_records(device);\n\t\tif (!device->tmp_records)\n\t\t\treturn NULL;\n\t}\n\n\treturn find_record_in_list(device->tmp_records, uuid);\n}"
  },
  {
    "function_name": "btd_device_set_record",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "6311-6342",
    "snippet": "void btd_device_set_record(struct btd_device *device, const char *uuid,\n\t\t\t\t\t\t\tconst char *record)\n{\n\t/* This API is only used for BR/EDR */\n\tstruct bearer_state *state = &device->bredr_state;\n\tstruct browse_req *req;\n\tsdp_list_t *recs = NULL;\n\tsdp_record_t *rec;\n\n\tif (!record)\n\t\treturn;\n\n\treq = browse_request_new(device, BROWSE_SDP, NULL);\n\tif (!req)\n\t\treturn;\n\n\trec = record_from_string(record);\n\trecs = sdp_list_append(recs, rec);\n\tupdate_bredr_services(req, recs);\n\tsdp_list_free(recs, NULL);\n\n\tdevice->svc_refreshed = true;\n\tstate->svc_resolved = true;\n\n\tdevice_probe_profiles(device, req->profiles_added);\n\n\t/* Propagate services changes */\n\tg_dbus_emit_property_changed(dbus_conn, req->device->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"UUIDs\");\n\n\tdevice_svc_resolved(device, BROWSE_SDP, device->bdaddr_type, 0);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static DBusConnection *dbus_conn = NULL;",
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "device_svc_resolved",
          "args": [
            "device",
            "BROWSE_SDP",
            "device->bdaddr_type",
            "0"
          ],
          "line": 6341
        },
        "resolved": true,
        "details": {
          "function_name": "device_svc_resolved",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "2378-2426",
          "snippet": "static void device_svc_resolved(struct btd_device *dev, uint8_t browse_type,\n\t\t\t\t\t\tuint8_t bdaddr_type, int err)\n{\n\tstruct bearer_state *state = get_state(dev, bdaddr_type);\n\tstruct browse_req *req = dev->browse;\n\n\tDBG(\"%s err %d\", dev->path, err);\n\n\tstate->svc_resolved = true;\n\n\t/* Disconnection notification can happen before this function\n\t * gets called, so don't set svc_refreshed for a disconnected\n\t * device.\n\t */\n\tif (state->connected)\n\t\tdevice_set_svc_refreshed(dev, true);\n\n\tg_slist_free_full(dev->eir_uuids, g_free);\n\tdev->eir_uuids = NULL;\n\n\tif (dev->pending_paired) {\n\t\tg_dbus_emit_property_changed(dbus_conn, dev->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"Paired\");\n\t\tdev->pending_paired = false;\n\t}\n\n\tif (!dev->temporary) {\n\t\tstore_device_info(dev);\n\n\t\tif (bdaddr_type != BDADDR_BREDR && err == 0)\n\t\t\tstore_services(dev);\n\t}\n\n\tif (req)\n\t\tbrowse_request_complete(req, browse_type, bdaddr_type, err);\n\n\twhile (dev->svc_callbacks) {\n\t\tstruct svc_callback *cb = dev->svc_callbacks->data;\n\n\t\tif (cb->idle_id > 0)\n\t\t\tg_source_remove(cb->idle_id);\n\n\t\tcb->func(dev, err, cb->user_data);\n\n\t\tdev->svc_callbacks = g_slist_delete_link(dev->svc_callbacks,\n\t\t\t\t\t\t\tdev->svc_callbacks);\n\t\tg_free(cb);\n\t}\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *dbus_conn = NULL;",
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void device_svc_resolved(struct btd_device *dev, uint8_t browse_type,\n\t\t\t\t\t\tuint8_t bdaddr_type, int err)\n{\n\tstruct bearer_state *state = get_state(dev, bdaddr_type);\n\tstruct browse_req *req = dev->browse;\n\n\tDBG(\"%s err %d\", dev->path, err);\n\n\tstate->svc_resolved = true;\n\n\t/* Disconnection notification can happen before this function\n\t * gets called, so don't set svc_refreshed for a disconnected\n\t * device.\n\t */\n\tif (state->connected)\n\t\tdevice_set_svc_refreshed(dev, true);\n\n\tg_slist_free_full(dev->eir_uuids, g_free);\n\tdev->eir_uuids = NULL;\n\n\tif (dev->pending_paired) {\n\t\tg_dbus_emit_property_changed(dbus_conn, dev->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"Paired\");\n\t\tdev->pending_paired = false;\n\t}\n\n\tif (!dev->temporary) {\n\t\tstore_device_info(dev);\n\n\t\tif (bdaddr_type != BDADDR_BREDR && err == 0)\n\t\t\tstore_services(dev);\n\t}\n\n\tif (req)\n\t\tbrowse_request_complete(req, browse_type, bdaddr_type, err);\n\n\twhile (dev->svc_callbacks) {\n\t\tstruct svc_callback *cb = dev->svc_callbacks->data;\n\n\t\tif (cb->idle_id > 0)\n\t\t\tg_source_remove(cb->idle_id);\n\n\t\tcb->func(dev, err, cb->user_data);\n\n\t\tdev->svc_callbacks = g_slist_delete_link(dev->svc_callbacks,\n\t\t\t\t\t\t\tdev->svc_callbacks);\n\t\tg_free(cb);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_emit_property_changed",
          "args": [
            "dbus_conn",
            "req->device->path",
            "DEVICE_INTERFACE",
            "\"UUIDs\""
          ],
          "line": 6338
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device_probe_profiles",
          "args": [
            "device",
            "req->profiles_added"
          ],
          "line": 6335
        },
        "resolved": true,
        "details": {
          "function_name": "device_probe_profiles",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "4360-4378",
          "snippet": "void device_probe_profiles(struct btd_device *device, GSList *uuids)\n{\n\tstruct probe_data d = { device, uuids };\n\tchar addr[18];\n\n\tba2str(&device->bdaddr, addr);\n\n\tif (device->blocked) {\n\t\tDBG(\"Skipping profiles for blocked device %s\", addr);\n\t\tgoto add_uuids;\n\t}\n\n\tDBG(\"Probing profiles for device %s\", addr);\n\n\tbtd_profile_foreach(dev_probe, &d);\n\nadd_uuids:\n\tdevice_add_uuids(device, uuids);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid device_probe_profiles(struct btd_device *device, GSList *uuids)\n{\n\tstruct probe_data d = { device, uuids };\n\tchar addr[18];\n\n\tba2str(&device->bdaddr, addr);\n\n\tif (device->blocked) {\n\t\tDBG(\"Skipping profiles for blocked device %s\", addr);\n\t\tgoto add_uuids;\n\t}\n\n\tDBG(\"Probing profiles for device %s\", addr);\n\n\tbtd_profile_foreach(dev_probe, &d);\n\nadd_uuids:\n\tdevice_add_uuids(device, uuids);\n}"
        }
      },
      {
        "call_info": {
          "callee": "sdp_list_free",
          "args": [
            "recs",
            "NULL"
          ],
          "line": 6330
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "update_bredr_services",
          "args": [
            "req",
            "recs"
          ],
          "line": 6329
        },
        "resolved": true,
        "details": {
          "function_name": "update_bredr_services",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "4486-4593",
          "snippet": "static void update_bredr_services(struct browse_req *req, sdp_list_t *recs)\n{\n\tstruct btd_device *device = req->device;\n\tsdp_list_t *seq;\n\tchar srcaddr[18], dstaddr[18];\n\tchar sdp_file[PATH_MAX];\n\tchar att_file[PATH_MAX];\n\tGKeyFile *sdp_key_file;\n\tGKeyFile *att_key_file;\n\tchar *data;\n\tgsize length = 0;\n\n\tba2str(btd_adapter_get_address(device->adapter), srcaddr);\n\tba2str(&device->bdaddr, dstaddr);\n\n\tsnprintf(sdp_file, PATH_MAX, STORAGEDIR \"/%s/cache/%s\", srcaddr,\n\t\t\t\t\t\t\t\tdstaddr);\n\n\tsdp_key_file = g_key_file_new();\n\tg_key_file_load_from_file(sdp_key_file, sdp_file, 0, NULL);\n\n\tsnprintf(att_file, PATH_MAX, STORAGEDIR \"/%s/%s/attributes\", srcaddr,\n\t\t\t\t\t\t\t\tdstaddr);\n\n\tatt_key_file = g_key_file_new();\n\tg_key_file_load_from_file(att_key_file, att_file, 0, NULL);\n\n\tfor (seq = recs; seq; seq = seq->next) {\n\t\tsdp_record_t *rec = (sdp_record_t *) seq->data;\n\t\tsdp_list_t *svcclass = NULL;\n\t\tchar *profile_uuid;\n\n\t\tif (!rec)\n\t\t\tbreak;\n\n\t\tif (sdp_get_service_classes(rec, &svcclass) < 0)\n\t\t\tcontinue;\n\n\t\t/* Check for empty service classes list */\n\t\tif (svcclass == NULL) {\n\t\t\tDBG(\"Skipping record with no service classes\");\n\t\t\tcontinue;\n\t\t}\n\n\t\t/* Extract the first element and skip the remainning */\n\t\tprofile_uuid = bt_uuid2string(svcclass->data);\n\t\tif (!profile_uuid) {\n\t\t\tsdp_list_free(svcclass, free);\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (bt_uuid_strcmp(profile_uuid, PNP_UUID) == 0) {\n\t\t\tuint16_t source, vendor, product, version;\n\t\t\tsdp_data_t *pdlist;\n\n\t\t\tpdlist = sdp_data_get(rec, SDP_ATTR_VENDOR_ID_SOURCE);\n\t\t\tsource = pdlist ? pdlist->val.uint16 : 0x0000;\n\n\t\t\tpdlist = sdp_data_get(rec, SDP_ATTR_VENDOR_ID);\n\t\t\tvendor = pdlist ? pdlist->val.uint16 : 0x0000;\n\n\t\t\tpdlist = sdp_data_get(rec, SDP_ATTR_PRODUCT_ID);\n\t\t\tproduct = pdlist ? pdlist->val.uint16 : 0x0000;\n\n\t\t\tpdlist = sdp_data_get(rec, SDP_ATTR_VERSION);\n\t\t\tversion = pdlist ? pdlist->val.uint16 : 0x0000;\n\n\t\t\tif (source || vendor || product || version)\n\t\t\t\tbtd_device_set_pnpid(device, source, vendor,\n\t\t\t\t\t\t\tproduct, version);\n\t\t}\n\n\t\tif (update_record(req, profile_uuid, rec) < 0)\n\t\t\tgoto next;\n\n\t\tif (sdp_key_file)\n\t\t\tstore_sdp_record(sdp_key_file, rec);\n\n\t\tif (att_key_file)\n\t\t\tstore_primaries_from_sdp_record(att_key_file, rec);\n\nnext:\n\t\tfree(profile_uuid);\n\t\tsdp_list_free(svcclass, free);\n\t}\n\n\tif (sdp_key_file) {\n\t\tdata = g_key_file_to_data(sdp_key_file, &length, NULL);\n\t\tif (length > 0) {\n\t\t\tcreate_file(sdp_file, S_IRUSR | S_IWUSR);\n\t\t\tg_file_set_contents(sdp_file, data, length, NULL);\n\t\t}\n\n\t\tg_free(data);\n\t\tg_key_file_free(sdp_key_file);\n\t}\n\n\tif (att_key_file) {\n\t\tdata = g_key_file_to_data(att_key_file, &length, NULL);\n\t\tif (length > 0) {\n\t\t\tcreate_file(att_file, S_IRUSR | S_IWUSR);\n\t\t\tg_file_set_contents(att_file, data, length, NULL);\n\t\t}\n\n\t\tg_free(data);\n\t\tg_key_file_free(att_key_file);\n\t}\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void update_bredr_services(struct browse_req *req, sdp_list_t *recs)\n{\n\tstruct btd_device *device = req->device;\n\tsdp_list_t *seq;\n\tchar srcaddr[18], dstaddr[18];\n\tchar sdp_file[PATH_MAX];\n\tchar att_file[PATH_MAX];\n\tGKeyFile *sdp_key_file;\n\tGKeyFile *att_key_file;\n\tchar *data;\n\tgsize length = 0;\n\n\tba2str(btd_adapter_get_address(device->adapter), srcaddr);\n\tba2str(&device->bdaddr, dstaddr);\n\n\tsnprintf(sdp_file, PATH_MAX, STORAGEDIR \"/%s/cache/%s\", srcaddr,\n\t\t\t\t\t\t\t\tdstaddr);\n\n\tsdp_key_file = g_key_file_new();\n\tg_key_file_load_from_file(sdp_key_file, sdp_file, 0, NULL);\n\n\tsnprintf(att_file, PATH_MAX, STORAGEDIR \"/%s/%s/attributes\", srcaddr,\n\t\t\t\t\t\t\t\tdstaddr);\n\n\tatt_key_file = g_key_file_new();\n\tg_key_file_load_from_file(att_key_file, att_file, 0, NULL);\n\n\tfor (seq = recs; seq; seq = seq->next) {\n\t\tsdp_record_t *rec = (sdp_record_t *) seq->data;\n\t\tsdp_list_t *svcclass = NULL;\n\t\tchar *profile_uuid;\n\n\t\tif (!rec)\n\t\t\tbreak;\n\n\t\tif (sdp_get_service_classes(rec, &svcclass) < 0)\n\t\t\tcontinue;\n\n\t\t/* Check for empty service classes list */\n\t\tif (svcclass == NULL) {\n\t\t\tDBG(\"Skipping record with no service classes\");\n\t\t\tcontinue;\n\t\t}\n\n\t\t/* Extract the first element and skip the remainning */\n\t\tprofile_uuid = bt_uuid2string(svcclass->data);\n\t\tif (!profile_uuid) {\n\t\t\tsdp_list_free(svcclass, free);\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (bt_uuid_strcmp(profile_uuid, PNP_UUID) == 0) {\n\t\t\tuint16_t source, vendor, product, version;\n\t\t\tsdp_data_t *pdlist;\n\n\t\t\tpdlist = sdp_data_get(rec, SDP_ATTR_VENDOR_ID_SOURCE);\n\t\t\tsource = pdlist ? pdlist->val.uint16 : 0x0000;\n\n\t\t\tpdlist = sdp_data_get(rec, SDP_ATTR_VENDOR_ID);\n\t\t\tvendor = pdlist ? pdlist->val.uint16 : 0x0000;\n\n\t\t\tpdlist = sdp_data_get(rec, SDP_ATTR_PRODUCT_ID);\n\t\t\tproduct = pdlist ? pdlist->val.uint16 : 0x0000;\n\n\t\t\tpdlist = sdp_data_get(rec, SDP_ATTR_VERSION);\n\t\t\tversion = pdlist ? pdlist->val.uint16 : 0x0000;\n\n\t\t\tif (source || vendor || product || version)\n\t\t\t\tbtd_device_set_pnpid(device, source, vendor,\n\t\t\t\t\t\t\tproduct, version);\n\t\t}\n\n\t\tif (update_record(req, profile_uuid, rec) < 0)\n\t\t\tgoto next;\n\n\t\tif (sdp_key_file)\n\t\t\tstore_sdp_record(sdp_key_file, rec);\n\n\t\tif (att_key_file)\n\t\t\tstore_primaries_from_sdp_record(att_key_file, rec);\n\nnext:\n\t\tfree(profile_uuid);\n\t\tsdp_list_free(svcclass, free);\n\t}\n\n\tif (sdp_key_file) {\n\t\tdata = g_key_file_to_data(sdp_key_file, &length, NULL);\n\t\tif (length > 0) {\n\t\t\tcreate_file(sdp_file, S_IRUSR | S_IWUSR);\n\t\t\tg_file_set_contents(sdp_file, data, length, NULL);\n\t\t}\n\n\t\tg_free(data);\n\t\tg_key_file_free(sdp_key_file);\n\t}\n\n\tif (att_key_file) {\n\t\tdata = g_key_file_to_data(att_key_file, &length, NULL);\n\t\tif (length > 0) {\n\t\t\tcreate_file(att_file, S_IRUSR | S_IWUSR);\n\t\t\tg_file_set_contents(att_file, data, length, NULL);\n\t\t}\n\n\t\tg_free(data);\n\t\tg_key_file_free(att_key_file);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "sdp_list_append",
          "args": [
            "recs",
            "rec"
          ],
          "line": 6328
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "record_from_string",
          "args": [
            "record"
          ],
          "line": 6327
        },
        "resolved": true,
        "details": {
          "function_name": "record_from_string",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/storage.c",
          "lines": "147-167",
          "snippet": "sdp_record_t *record_from_string(const char *str)\n{\n\tsdp_record_t *rec;\n\tint size, i, len;\n\tuint8_t *pdata;\n\tchar tmp[3];\n\n\tsize = strlen(str)/2;\n\tpdata = g_malloc0(size);\n\n\ttmp[2] = 0;\n\tfor (i = 0; i < size; i++) {\n\t\tmemcpy(tmp, str + (i * 2), 2);\n\t\tpdata[i] = (uint8_t) strtol(tmp, NULL, 16);\n\t}\n\n\trec = sdp_extract_pdu(pdata, size, &len);\n\tg_free(pdata);\n\n\treturn rec;\n}",
          "includes": [
            "#include \"storage.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"textfile.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <time.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <ctype.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"storage.h\"\n#include \"uuid-helper.h\"\n#include \"textfile.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <time.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <ctype.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nsdp_record_t *record_from_string(const char *str)\n{\n\tsdp_record_t *rec;\n\tint size, i, len;\n\tuint8_t *pdata;\n\tchar tmp[3];\n\n\tsize = strlen(str)/2;\n\tpdata = g_malloc0(size);\n\n\ttmp[2] = 0;\n\tfor (i = 0; i < size; i++) {\n\t\tmemcpy(tmp, str + (i * 2), 2);\n\t\tpdata[i] = (uint8_t) strtol(tmp, NULL, 16);\n\t}\n\n\trec = sdp_extract_pdu(pdata, size, &len);\n\tg_free(pdata);\n\n\treturn rec;\n}"
        }
      },
      {
        "call_info": {
          "callee": "browse_request_new",
          "args": [
            "device",
            "BROWSE_SDP",
            "NULL"
          ],
          "line": 6323
        },
        "resolved": true,
        "details": {
          "function_name": "browse_request_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5160-5190",
          "snippet": "static struct browse_req *browse_request_new(struct btd_device *device,\n\t\t\t\t\t\t\tuint8_t type,\n\t\t\t\t\t\t\tDBusMessage *msg)\n{\n\tstruct browse_req *req;\n\n\tif (device->browse)\n\t\treturn NULL;\n\n\treq = g_new0(struct browse_req, 1);\n\treq->device = device;\n\treq->type = type;\n\n\tdevice->browse = req;\n\n\tif (!msg)\n\t\treturn req;\n\n\treq->msg = dbus_message_ref(msg);\n\n\t/*\n\t * Track the request owner to cancel it automatically if the owner\n\t * exits\n\t */\n\treq->listener_id = g_dbus_add_disconnect_watch(dbus_conn,\n\t\t\t\t\t\tdbus_message_get_sender(msg),\n\t\t\t\t\t\tbrowse_request_exit,\n\t\t\t\t\t\treq, NULL);\n\n\treturn req;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *dbus_conn = NULL;",
            "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
            "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);",
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic struct browse_req *browse_request_new(struct btd_device *device,\n\t\t\t\t\t\t\tuint8_t type,\n\t\t\t\t\t\t\tDBusMessage *msg)\n{\n\tstruct browse_req *req;\n\n\tif (device->browse)\n\t\treturn NULL;\n\n\treq = g_new0(struct browse_req, 1);\n\treq->device = device;\n\treq->type = type;\n\n\tdevice->browse = req;\n\n\tif (!msg)\n\t\treturn req;\n\n\treq->msg = dbus_message_ref(msg);\n\n\t/*\n\t * Track the request owner to cancel it automatically if the owner\n\t * exits\n\t */\n\treq->listener_id = g_dbus_add_disconnect_watch(dbus_conn,\n\t\t\t\t\t\tdbus_message_get_sender(msg),\n\t\t\t\t\t\tbrowse_request_exit,\n\t\t\t\t\t\treq, NULL);\n\n\treturn req;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid btd_device_set_record(struct btd_device *device, const char *uuid,\n\t\t\t\t\t\t\tconst char *record)\n{\n\t/* This API is only used for BR/EDR */\n\tstruct bearer_state *state = &device->bredr_state;\n\tstruct browse_req *req;\n\tsdp_list_t *recs = NULL;\n\tsdp_record_t *rec;\n\n\tif (!record)\n\t\treturn;\n\n\treq = browse_request_new(device, BROWSE_SDP, NULL);\n\tif (!req)\n\t\treturn;\n\n\trec = record_from_string(record);\n\trecs = sdp_list_append(recs, rec);\n\tupdate_bredr_services(req, recs);\n\tsdp_list_free(recs, NULL);\n\n\tdevice->svc_refreshed = true;\n\tstate->svc_resolved = true;\n\n\tdevice_probe_profiles(device, req->profiles_added);\n\n\t/* Propagate services changes */\n\tg_dbus_emit_property_changed(dbus_conn, req->device->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"UUIDs\");\n\n\tdevice_svc_resolved(device, BROWSE_SDP, device->bdaddr_type, 0);\n}"
  },
  {
    "function_name": "read_device_records",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "6275-6309",
    "snippet": "static sdp_list_t *read_device_records(struct btd_device *device)\n{\n\tchar local[18], peer[18];\n\tchar filename[PATH_MAX];\n\tGKeyFile *key_file;\n\tchar **keys, **handle;\n\tchar *str;\n\tsdp_list_t *recs = NULL;\n\tsdp_record_t *rec;\n\n\tba2str(btd_adapter_get_address(device->adapter), local);\n\tba2str(&device->bdaddr, peer);\n\n\tsnprintf(filename, PATH_MAX, STORAGEDIR \"/%s/cache/%s\", local, peer);\n\n\tkey_file = g_key_file_new();\n\tg_key_file_load_from_file(key_file, filename, 0, NULL);\n\tkeys = g_key_file_get_keys(key_file, \"ServiceRecords\", NULL, NULL);\n\n\tfor (handle = keys; handle && *handle; handle++) {\n\t\tstr = g_key_file_get_string(key_file, \"ServiceRecords\",\n\t\t\t\t\t\t*handle, NULL);\n\t\tif (!str)\n\t\t\tcontinue;\n\n\t\trec = record_from_string(str);\n\t\trecs = sdp_list_append(recs, rec);\n\t\tg_free(str);\n\t}\n\n\tg_strfreev(keys);\n\tg_key_file_free(key_file);\n\n\treturn recs;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_key_file_free",
          "args": [
            "key_file"
          ],
          "line": 6306
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strfreev",
          "args": [
            "keys"
          ],
          "line": 6305
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "str"
          ],
          "line": 6302
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_append",
          "args": [
            "recs",
            "rec"
          ],
          "line": 6301
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "record_from_string",
          "args": [
            "str"
          ],
          "line": 6300
        },
        "resolved": true,
        "details": {
          "function_name": "record_from_string",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/storage.c",
          "lines": "147-167",
          "snippet": "sdp_record_t *record_from_string(const char *str)\n{\n\tsdp_record_t *rec;\n\tint size, i, len;\n\tuint8_t *pdata;\n\tchar tmp[3];\n\n\tsize = strlen(str)/2;\n\tpdata = g_malloc0(size);\n\n\ttmp[2] = 0;\n\tfor (i = 0; i < size; i++) {\n\t\tmemcpy(tmp, str + (i * 2), 2);\n\t\tpdata[i] = (uint8_t) strtol(tmp, NULL, 16);\n\t}\n\n\trec = sdp_extract_pdu(pdata, size, &len);\n\tg_free(pdata);\n\n\treturn rec;\n}",
          "includes": [
            "#include \"storage.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"textfile.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <time.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <ctype.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"storage.h\"\n#include \"uuid-helper.h\"\n#include \"textfile.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <time.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <ctype.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nsdp_record_t *record_from_string(const char *str)\n{\n\tsdp_record_t *rec;\n\tint size, i, len;\n\tuint8_t *pdata;\n\tchar tmp[3];\n\n\tsize = strlen(str)/2;\n\tpdata = g_malloc0(size);\n\n\ttmp[2] = 0;\n\tfor (i = 0; i < size; i++) {\n\t\tmemcpy(tmp, str + (i * 2), 2);\n\t\tpdata[i] = (uint8_t) strtol(tmp, NULL, 16);\n\t}\n\n\trec = sdp_extract_pdu(pdata, size, &len);\n\tg_free(pdata);\n\n\treturn rec;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_key_file_get_string",
          "args": [
            "key_file",
            "\"ServiceRecords\"",
            "*handle",
            "NULL"
          ],
          "line": 6295
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_get_keys",
          "args": [
            "key_file",
            "\"ServiceRecords\"",
            "NULL",
            "NULL"
          ],
          "line": 6292
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_load_from_file",
          "args": [
            "key_file",
            "filename",
            "0",
            "NULL"
          ],
          "line": 6291
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_new",
          "args": [],
          "line": 6290
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "filename",
            "PATH_MAX",
            "STORAGEDIR \"/%s/cache/%s\"",
            "local",
            "peer"
          ],
          "line": 6288
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ba2str",
          "args": [
            "&device->bdaddr",
            "peer"
          ],
          "line": 6286
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ba2str",
          "args": [
            "btd_adapter_get_address(device->adapter)",
            "local"
          ],
          "line": 6285
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_adapter_get_address",
          "args": [
            "device->adapter"
          ],
          "line": 6285
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_get_address",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "5881-5884",
          "snippet": "const bdaddr_t *btd_adapter_get_address(struct btd_adapter *adapter)\n{\n\treturn &adapter->bdaddr;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nconst bdaddr_t *btd_adapter_get_address(struct btd_adapter *adapter)\n{\n\treturn &adapter->bdaddr;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic sdp_list_t *read_device_records(struct btd_device *device)\n{\n\tchar local[18], peer[18];\n\tchar filename[PATH_MAX];\n\tGKeyFile *key_file;\n\tchar **keys, **handle;\n\tchar *str;\n\tsdp_list_t *recs = NULL;\n\tsdp_record_t *rec;\n\n\tba2str(btd_adapter_get_address(device->adapter), local);\n\tba2str(&device->bdaddr, peer);\n\n\tsnprintf(filename, PATH_MAX, STORAGEDIR \"/%s/cache/%s\", local, peer);\n\n\tkey_file = g_key_file_new();\n\tg_key_file_load_from_file(key_file, filename, 0, NULL);\n\tkeys = g_key_file_get_keys(key_file, \"ServiceRecords\", NULL, NULL);\n\n\tfor (handle = keys; handle && *handle; handle++) {\n\t\tstr = g_key_file_get_string(key_file, \"ServiceRecords\",\n\t\t\t\t\t\t*handle, NULL);\n\t\tif (!str)\n\t\t\tcontinue;\n\n\t\trec = record_from_string(str);\n\t\trecs = sdp_list_append(recs, rec);\n\t\tg_free(str);\n\t}\n\n\tg_strfreev(keys);\n\tg_key_file_free(key_file);\n\n\treturn recs;\n}"
  },
  {
    "function_name": "btd_device_add_uuid",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "6253-6273",
    "snippet": "void btd_device_add_uuid(struct btd_device *device, const char *uuid)\n{\n\tGSList *uuid_list;\n\tchar *new_uuid;\n\n\tif (g_slist_find_custom(device->uuids, uuid, bt_uuid_strcmp))\n\t\treturn;\n\n\tnew_uuid = g_strdup(uuid);\n\tuuid_list = g_slist_append(NULL, new_uuid);\n\n\tdevice_probe_profiles(device, uuid_list);\n\n\tg_free(new_uuid);\n\tg_slist_free(uuid_list);\n\n\tstore_device_info(device);\n\n\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"UUIDs\");\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static DBusConnection *dbus_conn = NULL;",
      "static const uint16_t uuid_list[] = {\n\tL2CAP_UUID,\n\tPNP_INFO_SVCLASS_ID,\n\tPUBLIC_BROWSE_GROUP,\n\t0\n};",
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_dbus_emit_property_changed",
          "args": [
            "dbus_conn",
            "device->path",
            "DEVICE_INTERFACE",
            "\"UUIDs\""
          ],
          "line": 6271
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "store_device_info",
          "args": [
            "device"
          ],
          "line": 6269
        },
        "resolved": true,
        "details": {
          "function_name": "store_device_info",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "475-487",
          "snippet": "static void store_device_info(struct btd_device *device)\n{\n\tif (device->temporary || device->store_id > 0)\n\t\treturn;\n\n\tif (device_address_is_private(device)) {\n\t\tDBG(\"Can't store info for private addressed device %s\",\n\t\t\t\t\t\t\t\tdevice->path);\n\t\treturn;\n\t}\n\n\tdevice->store_id = g_idle_add(store_device_info_cb, device);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void store_device_info(struct btd_device *device)\n{\n\tif (device->temporary || device->store_id > 0)\n\t\treturn;\n\n\tif (device_address_is_private(device)) {\n\t\tDBG(\"Can't store info for private addressed device %s\",\n\t\t\t\t\t\t\t\tdevice->path);\n\t\treturn;\n\t}\n\n\tdevice->store_id = g_idle_add(store_device_info_cb, device);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_slist_free",
          "args": [
            "uuid_list"
          ],
          "line": 6267
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "new_uuid"
          ],
          "line": 6266
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device_probe_profiles",
          "args": [
            "device",
            "uuid_list"
          ],
          "line": 6264
        },
        "resolved": true,
        "details": {
          "function_name": "device_probe_profiles",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "4360-4378",
          "snippet": "void device_probe_profiles(struct btd_device *device, GSList *uuids)\n{\n\tstruct probe_data d = { device, uuids };\n\tchar addr[18];\n\n\tba2str(&device->bdaddr, addr);\n\n\tif (device->blocked) {\n\t\tDBG(\"Skipping profiles for blocked device %s\", addr);\n\t\tgoto add_uuids;\n\t}\n\n\tDBG(\"Probing profiles for device %s\", addr);\n\n\tbtd_profile_foreach(dev_probe, &d);\n\nadd_uuids:\n\tdevice_add_uuids(device, uuids);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid device_probe_profiles(struct btd_device *device, GSList *uuids)\n{\n\tstruct probe_data d = { device, uuids };\n\tchar addr[18];\n\n\tba2str(&device->bdaddr, addr);\n\n\tif (device->blocked) {\n\t\tDBG(\"Skipping profiles for blocked device %s\", addr);\n\t\tgoto add_uuids;\n\t}\n\n\tDBG(\"Probing profiles for device %s\", addr);\n\n\tbtd_profile_foreach(dev_probe, &d);\n\nadd_uuids:\n\tdevice_add_uuids(device, uuids);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_slist_append",
          "args": [
            "NULL",
            "new_uuid"
          ],
          "line": 6262
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "uuid"
          ],
          "line": 6261
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_find_custom",
          "args": [
            "device->uuids",
            "uuid",
            "bt_uuid_strcmp"
          ],
          "line": 6258
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic const uint16_t uuid_list[] = {\n\tL2CAP_UUID,\n\tPNP_INFO_SVCLASS_ID,\n\tPUBLIC_BROWSE_GROUP,\n\t0\n};\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid btd_device_add_uuid(struct btd_device *device, const char *uuid)\n{\n\tGSList *uuid_list;\n\tchar *new_uuid;\n\n\tif (g_slist_find_custom(device->uuids, uuid, bt_uuid_strcmp))\n\t\treturn;\n\n\tnew_uuid = g_strdup(uuid);\n\tuuid_list = g_slist_append(NULL, new_uuid);\n\n\tdevice_probe_profiles(device, uuid_list);\n\n\tg_free(new_uuid);\n\tg_slist_free(uuid_list);\n\n\tstore_device_info(device);\n\n\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"UUIDs\");\n}"
  },
  {
    "function_name": "btd_device_gatt_set_service_changed",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "6244-6251",
    "snippet": "void btd_device_gatt_set_service_changed(struct btd_device *device,\n\t\t\t\t\t\tuint16_t start, uint16_t end)\n{\n\t/*\n\t * TODO: Remove this function and handle service changed via\n\t * gatt-client.\n\t */\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid btd_device_gatt_set_service_changed(struct btd_device *device,\n\t\t\t\t\t\tuint16_t start, uint16_t end)\n{\n\t/*\n\t * TODO: Remove this function and handle service changed via\n\t * gatt-client.\n\t */\n}"
  },
  {
    "function_name": "btd_device_get_gatt_server",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "6236-6242",
    "snippet": "struct bt_gatt_server *btd_device_get_gatt_server(struct btd_device *device)\n{\n\tif (!device)\n\t\treturn NULL;\n\n\treturn device->server;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstruct bt_gatt_server *btd_device_get_gatt_server(struct btd_device *device)\n{\n\tif (!device)\n\t\treturn NULL;\n\n\treturn device->server;\n}"
  },
  {
    "function_name": "btd_device_get_attrib",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "6228-6234",
    "snippet": "void *btd_device_get_attrib(struct btd_device *device)\n{\n\tif (!device)\n\t\treturn NULL;\n\n\treturn device->attrib;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid *btd_device_get_attrib(struct btd_device *device)\n{\n\tif (!device)\n\t\treturn NULL;\n\n\treturn device->attrib;\n}"
  },
  {
    "function_name": "btd_device_get_gatt_client",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "6220-6226",
    "snippet": "struct bt_gatt_client *btd_device_get_gatt_client(struct btd_device *device)\n{\n\tif (!device)\n\t\treturn NULL;\n\n\treturn device->client;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstruct bt_gatt_client *btd_device_get_gatt_client(struct btd_device *device)\n{\n\tif (!device)\n\t\treturn NULL;\n\n\treturn device->client;\n}"
  },
  {
    "function_name": "btd_device_get_gatt_db",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "6212-6218",
    "snippet": "struct gatt_db *btd_device_get_gatt_db(struct btd_device *device)\n{\n\tif (!device)\n\t\treturn NULL;\n\n\treturn device->db;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstruct gatt_db *btd_device_get_gatt_db(struct btd_device *device)\n{\n\tif (!device)\n\t\treturn NULL;\n\n\treturn device->db;\n}"
  },
  {
    "function_name": "btd_device_get_primaries",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "6207-6210",
    "snippet": "GSList *btd_device_get_primaries(struct btd_device *device)\n{\n\treturn device->primaries;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nGSList *btd_device_get_primaries(struct btd_device *device)\n{\n\treturn device->primaries;\n}"
  },
  {
    "function_name": "btd_device_get_primary",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "6195-6205",
    "snippet": "struct gatt_primary *btd_device_get_primary(struct btd_device *device,\n\t\t\t\t\t\t\tconst char *uuid)\n{\n\tGSList *match;\n\n\tmatch = g_slist_find_custom(device->primaries, uuid, bt_uuid_strcmp);\n\tif (match)\n\t\treturn match->data;\n\n\treturn NULL;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_slist_find_custom",
          "args": [
            "device->primaries",
            "uuid",
            "bt_uuid_strcmp"
          ],
          "line": 6200
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstruct gatt_primary *btd_device_get_primary(struct btd_device *device,\n\t\t\t\t\t\t\tconst char *uuid)\n{\n\tGSList *match;\n\n\tmatch = g_slist_find_custom(device->primaries, uuid, bt_uuid_strcmp);\n\tif (match)\n\t\treturn match->data;\n\n\treturn NULL;\n}"
  },
  {
    "function_name": "device_is_authenticating",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "6190-6193",
    "snippet": "gboolean device_is_authenticating(struct btd_device *device)\n{\n\treturn (device->authr != NULL);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\ngboolean device_is_authenticating(struct btd_device *device)\n{\n\treturn (device->authr != NULL);\n}"
  },
  {
    "function_name": "device_cancel_authentication",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "6170-6188",
    "snippet": "void device_cancel_authentication(struct btd_device *device, gboolean aborted)\n{\n\tstruct authentication_req *auth = device->authr;\n\tchar addr[18];\n\n\tif (!auth)\n\t\treturn;\n\n\tba2str(&device->bdaddr, addr);\n\tDBG(\"Canceling authentication request for %s\", addr);\n\n\tif (auth->agent)\n\t\tagent_cancel(auth->agent);\n\n\tif (!aborted)\n\t\tcancel_authentication(auth);\n\n\tdevice_auth_req_free(device);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "device_auth_req_free",
          "args": [
            "device"
          ],
          "line": 6187
        },
        "resolved": true,
        "details": {
          "function_name": "device_auth_req_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5662-5676",
          "snippet": "static void device_auth_req_free(struct btd_device *device)\n{\n\tstruct authentication_req *authr = device->authr;\n\n\tif (!authr)\n\t\treturn;\n\n\tif (authr->agent)\n\t\tagent_unref(authr->agent);\n\n\tg_free(authr->pincode);\n\tg_free(authr);\n\n\tdevice->authr = NULL;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void device_auth_req_free(struct btd_device *device)\n{\n\tstruct authentication_req *authr = device->authr;\n\n\tif (!authr)\n\t\treturn;\n\n\tif (authr->agent)\n\t\tagent_unref(authr->agent);\n\n\tg_free(authr->pincode);\n\tg_free(authr);\n\n\tdevice->authr = NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "cancel_authentication",
          "args": [
            "auth"
          ],
          "line": 6185
        },
        "resolved": true,
        "details": {
          "function_name": "cancel_authentication",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "6135-6168",
          "snippet": "static void cancel_authentication(struct authentication_req *auth)\n{\n\tstruct agent *agent;\n\tDBusError err;\n\n\tif (!auth || !auth->agent)\n\t\treturn;\n\n\tagent = auth->agent;\n\tauth->agent = NULL;\n\n\tdbus_error_init(&err);\n\tdbus_set_error_const(&err, ERROR_INTERFACE \".Canceled\", NULL);\n\n\tswitch (auth->type) {\n\tcase AUTH_TYPE_PINCODE:\n\t\tpincode_cb(agent, &err, NULL, auth);\n\t\tbreak;\n\tcase AUTH_TYPE_CONFIRM:\n\t\tconfirm_cb(agent, &err, auth);\n\t\tbreak;\n\tcase AUTH_TYPE_PASSKEY:\n\t\tpasskey_cb(agent, &err, 0, auth);\n\t\tbreak;\n\tcase AUTH_TYPE_NOTIFY_PASSKEY:\n\t\t/* User Notify doesn't require any reply */\n\t\tbreak;\n\tcase AUTH_TYPE_NOTIFY_PINCODE:\n\t\tpincode_cb(agent, &err, NULL, auth);\n\t\tbreak;\n\t}\n\n\tdbus_error_free(&err);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void cancel_authentication(struct authentication_req *auth)\n{\n\tstruct agent *agent;\n\tDBusError err;\n\n\tif (!auth || !auth->agent)\n\t\treturn;\n\n\tagent = auth->agent;\n\tauth->agent = NULL;\n\n\tdbus_error_init(&err);\n\tdbus_set_error_const(&err, ERROR_INTERFACE \".Canceled\", NULL);\n\n\tswitch (auth->type) {\n\tcase AUTH_TYPE_PINCODE:\n\t\tpincode_cb(agent, &err, NULL, auth);\n\t\tbreak;\n\tcase AUTH_TYPE_CONFIRM:\n\t\tconfirm_cb(agent, &err, auth);\n\t\tbreak;\n\tcase AUTH_TYPE_PASSKEY:\n\t\tpasskey_cb(agent, &err, 0, auth);\n\t\tbreak;\n\tcase AUTH_TYPE_NOTIFY_PASSKEY:\n\t\t/* User Notify doesn't require any reply */\n\t\tbreak;\n\tcase AUTH_TYPE_NOTIFY_PINCODE:\n\t\tpincode_cb(agent, &err, NULL, auth);\n\t\tbreak;\n\t}\n\n\tdbus_error_free(&err);\n}"
        }
      },
      {
        "call_info": {
          "callee": "agent_cancel",
          "args": [
            "auth->agent"
          ],
          "line": 6182
        },
        "resolved": true,
        "details": {
          "function_name": "agent_cancel",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "317-331",
          "snippet": "int agent_cancel(struct agent *agent)\n{\n\tif (!agent->request)\n\t\treturn -EINVAL;\n\n\tif (agent->request->call) {\n\t\tdbus_pending_call_cancel(agent->request->call);\n\t\tsend_cancel_request(agent->request);\n\t}\n\n\tagent_request_free(agent->request, TRUE);\n\tagent->request = NULL;\n\n\treturn 0;\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nint agent_cancel(struct agent *agent)\n{\n\tif (!agent->request)\n\t\treturn -EINVAL;\n\n\tif (agent->request->call) {\n\t\tdbus_pending_call_cancel(agent->request->call);\n\t\tsend_cancel_request(agent->request);\n\t}\n\n\tagent_request_free(agent->request, TRUE);\n\tagent->request = NULL;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Canceling authentication request for %s\"",
            "addr"
          ],
          "line": 6179
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ba2str",
          "args": [
            "&device->bdaddr",
            "addr"
          ],
          "line": 6178
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid device_cancel_authentication(struct btd_device *device, gboolean aborted)\n{\n\tstruct authentication_req *auth = device->authr;\n\tchar addr[18];\n\n\tif (!auth)\n\t\treturn;\n\n\tba2str(&device->bdaddr, addr);\n\tDBG(\"Canceling authentication request for %s\", addr);\n\n\tif (auth->agent)\n\t\tagent_cancel(auth->agent);\n\n\tif (!aborted)\n\t\tcancel_authentication(auth);\n\n\tdevice_auth_req_free(device);\n}"
  },
  {
    "function_name": "cancel_authentication",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "6135-6168",
    "snippet": "static void cancel_authentication(struct authentication_req *auth)\n{\n\tstruct agent *agent;\n\tDBusError err;\n\n\tif (!auth || !auth->agent)\n\t\treturn;\n\n\tagent = auth->agent;\n\tauth->agent = NULL;\n\n\tdbus_error_init(&err);\n\tdbus_set_error_const(&err, ERROR_INTERFACE \".Canceled\", NULL);\n\n\tswitch (auth->type) {\n\tcase AUTH_TYPE_PINCODE:\n\t\tpincode_cb(agent, &err, NULL, auth);\n\t\tbreak;\n\tcase AUTH_TYPE_CONFIRM:\n\t\tconfirm_cb(agent, &err, auth);\n\t\tbreak;\n\tcase AUTH_TYPE_PASSKEY:\n\t\tpasskey_cb(agent, &err, 0, auth);\n\t\tbreak;\n\tcase AUTH_TYPE_NOTIFY_PASSKEY:\n\t\t/* User Notify doesn't require any reply */\n\t\tbreak;\n\tcase AUTH_TYPE_NOTIFY_PINCODE:\n\t\tpincode_cb(agent, &err, NULL, auth);\n\t\tbreak;\n\t}\n\n\tdbus_error_free(&err);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_error_free",
          "args": [
            "&err"
          ],
          "line": 6167
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pincode_cb",
          "args": [
            "agent",
            "&err",
            "NULL",
            "auth"
          ],
          "line": 6163
        },
        "resolved": true,
        "details": {
          "function_name": "pincode_cb",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5920-5935",
          "snippet": "static void pincode_cb(struct agent *agent, DBusError *err, const char *pin,\n\t\t\t\t\t\t\t\tvoid *data)\n{\n\tstruct authentication_req *auth = data;\n\tstruct btd_device *device = auth->device;\n\n\t/* No need to reply anything if the authentication already failed */\n\tif (auth->agent == NULL)\n\t\treturn;\n\n\tbtd_adapter_pincode_reply(device->adapter, &device->bdaddr,\n\t\t\t\t\t\tpin, pin ? strlen(pin) : 0);\n\n\tagent_unref(device->authr->agent);\n\tdevice->authr->agent = NULL;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void pincode_cb(struct agent *agent, DBusError *err, const char *pin,\n\t\t\t\t\t\t\t\tvoid *data)\n{\n\tstruct authentication_req *auth = data;\n\tstruct btd_device *device = auth->device;\n\n\t/* No need to reply anything if the authentication already failed */\n\tif (auth->agent == NULL)\n\t\treturn;\n\n\tbtd_adapter_pincode_reply(device->adapter, &device->bdaddr,\n\t\t\t\t\t\tpin, pin ? strlen(pin) : 0);\n\n\tagent_unref(device->authr->agent);\n\tdevice->authr->agent = NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "passkey_cb",
          "args": [
            "agent",
            "&err",
            "0",
            "auth"
          ],
          "line": 6157
        },
        "resolved": true,
        "details": {
          "function_name": "passkey_cb",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5954-5972",
          "snippet": "static void passkey_cb(struct agent *agent, DBusError *err,\n\t\t\t\t\t\tuint32_t passkey, void *data)\n{\n\tstruct authentication_req *auth = data;\n\tstruct btd_device *device = auth->device;\n\n\t/* No need to reply anything if the authentication already failed */\n\tif (auth->agent == NULL)\n\t\treturn;\n\n\tif (err)\n\t\tpasskey = INVALID_PASSKEY;\n\n\tbtd_adapter_passkey_reply(device->adapter, &device->bdaddr,\n\t\t\t\t\t\tauth->addr_type, passkey);\n\n\tagent_unref(device->authr->agent);\n\tdevice->authr->agent = NULL;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void passkey_cb(struct agent *agent, DBusError *err,\n\t\t\t\t\t\tuint32_t passkey, void *data)\n{\n\tstruct authentication_req *auth = data;\n\tstruct btd_device *device = auth->device;\n\n\t/* No need to reply anything if the authentication already failed */\n\tif (auth->agent == NULL)\n\t\treturn;\n\n\tif (err)\n\t\tpasskey = INVALID_PASSKEY;\n\n\tbtd_adapter_passkey_reply(device->adapter, &device->bdaddr,\n\t\t\t\t\t\tauth->addr_type, passkey);\n\n\tagent_unref(device->authr->agent);\n\tdevice->authr->agent = NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "confirm_cb",
          "args": [
            "agent",
            "&err",
            "auth"
          ],
          "line": 6154
        },
        "resolved": true,
        "details": {
          "function_name": "confirm_cb",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5937-5952",
          "snippet": "static void confirm_cb(struct agent *agent, DBusError *err, void *data)\n{\n\tstruct authentication_req *auth = data;\n\tstruct btd_device *device = auth->device;\n\n\t/* No need to reply anything if the authentication already failed */\n\tif (auth->agent == NULL)\n\t\treturn;\n\n\tbtd_adapter_confirm_reply(device->adapter, &device->bdaddr,\n\t\t\t\t\t\t\tauth->addr_type,\n\t\t\t\t\t\t\terr ? FALSE : TRUE);\n\n\tagent_unref(device->authr->agent);\n\tdevice->authr->agent = NULL;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void confirm_cb(struct agent *agent, DBusError *err, void *data)\n{\n\tstruct authentication_req *auth = data;\n\tstruct btd_device *device = auth->device;\n\n\t/* No need to reply anything if the authentication already failed */\n\tif (auth->agent == NULL)\n\t\treturn;\n\n\tbtd_adapter_confirm_reply(device->adapter, &device->bdaddr,\n\t\t\t\t\t\t\tauth->addr_type,\n\t\t\t\t\t\t\terr ? FALSE : TRUE);\n\n\tagent_unref(device->authr->agent);\n\tdevice->authr->agent = NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_set_error_const",
          "args": [
            "&err",
            "ERROR_INTERFACE \".Canceled\"",
            "NULL"
          ],
          "line": 6147
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_error_init",
          "args": [
            "&err"
          ],
          "line": 6146
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void cancel_authentication(struct authentication_req *auth)\n{\n\tstruct agent *agent;\n\tDBusError err;\n\n\tif (!auth || !auth->agent)\n\t\treturn;\n\n\tagent = auth->agent;\n\tauth->agent = NULL;\n\n\tdbus_error_init(&err);\n\tdbus_set_error_const(&err, ERROR_INTERFACE \".Canceled\", NULL);\n\n\tswitch (auth->type) {\n\tcase AUTH_TYPE_PINCODE:\n\t\tpincode_cb(agent, &err, NULL, auth);\n\t\tbreak;\n\tcase AUTH_TYPE_CONFIRM:\n\t\tconfirm_cb(agent, &err, auth);\n\t\tbreak;\n\tcase AUTH_TYPE_PASSKEY:\n\t\tpasskey_cb(agent, &err, 0, auth);\n\t\tbreak;\n\tcase AUTH_TYPE_NOTIFY_PASSKEY:\n\t\t/* User Notify doesn't require any reply */\n\t\tbreak;\n\tcase AUTH_TYPE_NOTIFY_PINCODE:\n\t\tpincode_cb(agent, &err, NULL, auth);\n\t\tbreak;\n\t}\n\n\tdbus_error_free(&err);\n}"
  },
  {
    "function_name": "device_notify_pincode",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "6113-6133",
    "snippet": "int device_notify_pincode(struct btd_device *device, gboolean secure,\n\t\t\t\t\t\t\tconst char *pincode)\n{\n\tstruct authentication_req *auth;\n\tint err;\n\n\tauth = new_auth(device, BDADDR_BREDR, AUTH_TYPE_NOTIFY_PINCODE, secure);\n\tif (!auth)\n\t\treturn -EPERM;\n\n\tauth->pincode = g_strdup(pincode);\n\n\terr = agent_display_pincode(auth->agent, device, pincode,\n\t\t\t\t\tdisplay_pincode_cb, auth, NULL);\n\tif (err < 0) {\n\t\terror(\"Failed requesting authentication\");\n\t\tdevice_auth_req_free(device);\n\t}\n\n\treturn err;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "device_auth_req_free",
          "args": [
            "device"
          ],
          "line": 6129
        },
        "resolved": true,
        "details": {
          "function_name": "device_auth_req_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5662-5676",
          "snippet": "static void device_auth_req_free(struct btd_device *device)\n{\n\tstruct authentication_req *authr = device->authr;\n\n\tif (!authr)\n\t\treturn;\n\n\tif (authr->agent)\n\t\tagent_unref(authr->agent);\n\n\tg_free(authr->pincode);\n\tg_free(authr);\n\n\tdevice->authr = NULL;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void device_auth_req_free(struct btd_device *device)\n{\n\tstruct authentication_req *authr = device->authr;\n\n\tif (!authr)\n\t\treturn;\n\n\tif (authr->agent)\n\t\tagent_unref(authr->agent);\n\n\tg_free(authr->pincode);\n\tg_free(authr);\n\n\tdevice->authr = NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Failed requesting authentication\""
          ],
          "line": 6128
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_not_ready",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "118-122",
          "snippet": "DBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "agent_display_pincode",
          "args": [
            "auth->agent",
            "device",
            "pincode",
            "display_pincode_cb",
            "auth",
            "NULL"
          ],
          "line": 6125
        },
        "resolved": true,
        "details": {
          "function_name": "agent_display_pincode",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "870-898",
          "snippet": "int agent_display_pincode(struct agent *agent, struct btd_device *device,\n\t\t\t\tconst char *pincode, agent_cb cb,\n\t\t\t\tvoid *user_data, GDestroyNotify destroy)\n{\n\tstruct agent_request *req;\n\tconst char *dev_path = device_get_path(device);\n\tint err;\n\n\tif (agent->request)\n\t\treturn -EBUSY;\n\n\tDBG(\"Calling Agent.DisplayPinCode: name=%s, path=%s, pincode=%s\",\n\t\t\t\t\tagent->owner, agent->path, pincode);\n\n\treq = agent_request_new(agent, AGENT_REQUEST_DISPLAY_PINCODE, cb,\n\t\t\t\t\t\t\tuser_data, destroy);\n\n\terr = display_pincode_request_new(req, dev_path, pincode);\n\tif (err < 0)\n\t\tgoto failed;\n\n\tagent->request = req;\n\n\treturn 0;\n\nfailed:\n\tagent_request_free(req, FALSE);\n\treturn err;\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nint agent_display_pincode(struct agent *agent, struct btd_device *device,\n\t\t\t\tconst char *pincode, agent_cb cb,\n\t\t\t\tvoid *user_data, GDestroyNotify destroy)\n{\n\tstruct agent_request *req;\n\tconst char *dev_path = device_get_path(device);\n\tint err;\n\n\tif (agent->request)\n\t\treturn -EBUSY;\n\n\tDBG(\"Calling Agent.DisplayPinCode: name=%s, path=%s, pincode=%s\",\n\t\t\t\t\tagent->owner, agent->path, pincode);\n\n\treq = agent_request_new(agent, AGENT_REQUEST_DISPLAY_PINCODE, cb,\n\t\t\t\t\t\t\tuser_data, destroy);\n\n\terr = display_pincode_request_new(req, dev_path, pincode);\n\tif (err < 0)\n\t\tgoto failed;\n\n\tagent->request = req;\n\n\treturn 0;\n\nfailed:\n\tagent_request_free(req, FALSE);\n\treturn err;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "pincode"
          ],
          "line": 6123
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "new_auth",
          "args": [
            "device",
            "BDADDR_BREDR",
            "AUTH_TYPE_NOTIFY_PINCODE",
            "secure"
          ],
          "line": 6119
        },
        "resolved": true,
        "details": {
          "function_name": "new_auth",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5985-6021",
          "snippet": "static struct authentication_req *new_auth(struct btd_device *device,\n\t\t\t\t\t\tuint8_t addr_type,\n\t\t\t\t\t\tauth_type_t type,\n\t\t\t\t\t\tgboolean secure)\n{\n\tstruct authentication_req *auth;\n\tstruct agent *agent;\n\tchar addr[18];\n\n\tba2str(&device->bdaddr, addr);\n\tDBG(\"Requesting agent authentication for %s\", addr);\n\n\tif (device->authr) {\n\t\terror(\"Authentication already requested for %s\", addr);\n\t\treturn NULL;\n\t}\n\n\tif (device->bonding && device->bonding->agent)\n\t\tagent = agent_ref(device->bonding->agent);\n\telse\n\t\tagent = agent_get(NULL);\n\n\tif (!agent) {\n\t\terror(\"No agent available for request type %d\", type);\n\t\treturn NULL;\n\t}\n\n\tauth = g_new0(struct authentication_req, 1);\n\tauth->agent = agent;\n\tauth->device = device;\n\tauth->type = type;\n\tauth->addr_type = addr_type;\n\tauth->secure = secure;\n\tdevice->authr = auth;\n\n\treturn auth;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic struct authentication_req *new_auth(struct btd_device *device,\n\t\t\t\t\t\tuint8_t addr_type,\n\t\t\t\t\t\tauth_type_t type,\n\t\t\t\t\t\tgboolean secure)\n{\n\tstruct authentication_req *auth;\n\tstruct agent *agent;\n\tchar addr[18];\n\n\tba2str(&device->bdaddr, addr);\n\tDBG(\"Requesting agent authentication for %s\", addr);\n\n\tif (device->authr) {\n\t\terror(\"Authentication already requested for %s\", addr);\n\t\treturn NULL;\n\t}\n\n\tif (device->bonding && device->bonding->agent)\n\t\tagent = agent_ref(device->bonding->agent);\n\telse\n\t\tagent = agent_get(NULL);\n\n\tif (!agent) {\n\t\terror(\"No agent available for request type %d\", type);\n\t\treturn NULL;\n\t}\n\n\tauth = g_new0(struct authentication_req, 1);\n\tauth->agent = agent;\n\tauth->device = device;\n\tauth->type = type;\n\tauth->addr_type = addr_type;\n\tauth->secure = secure;\n\tdevice->authr = auth;\n\n\treturn auth;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nint device_notify_pincode(struct btd_device *device, gboolean secure,\n\t\t\t\t\t\t\tconst char *pincode)\n{\n\tstruct authentication_req *auth;\n\tint err;\n\n\tauth = new_auth(device, BDADDR_BREDR, AUTH_TYPE_NOTIFY_PINCODE, secure);\n\tif (!auth)\n\t\treturn -EPERM;\n\n\tauth->pincode = g_strdup(pincode);\n\n\terr = agent_display_pincode(auth->agent, device, pincode,\n\t\t\t\t\tdisplay_pincode_cb, auth, NULL);\n\tif (err < 0) {\n\t\terror(\"Failed requesting authentication\");\n\t\tdevice_auth_req_free(device);\n\t}\n\n\treturn err;\n}"
  },
  {
    "function_name": "device_notify_passkey",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "6088-6111",
    "snippet": "int device_notify_passkey(struct btd_device *device, uint8_t type,\n\t\t\t\t\tuint32_t passkey, uint8_t entered)\n{\n\tstruct authentication_req *auth;\n\tint err;\n\n\tif (device->authr) {\n\t\tauth = device->authr;\n\t\tif (auth->type != AUTH_TYPE_NOTIFY_PASSKEY)\n\t\t\treturn -EPERM;\n\t} else {\n\t\tauth = new_auth(device, type, AUTH_TYPE_NOTIFY_PASSKEY, FALSE);\n\t\tif (!auth)\n\t\t\treturn -EPERM;\n\t}\n\n\terr = agent_display_passkey(auth->agent, device, passkey, entered);\n\tif (err < 0) {\n\t\terror(\"Failed requesting authentication\");\n\t\tdevice_auth_req_free(device);\n\t}\n\n\treturn err;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "device_auth_req_free",
          "args": [
            "device"
          ],
          "line": 6107
        },
        "resolved": true,
        "details": {
          "function_name": "device_auth_req_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5662-5676",
          "snippet": "static void device_auth_req_free(struct btd_device *device)\n{\n\tstruct authentication_req *authr = device->authr;\n\n\tif (!authr)\n\t\treturn;\n\n\tif (authr->agent)\n\t\tagent_unref(authr->agent);\n\n\tg_free(authr->pincode);\n\tg_free(authr);\n\n\tdevice->authr = NULL;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void device_auth_req_free(struct btd_device *device)\n{\n\tstruct authentication_req *authr = device->authr;\n\n\tif (!authr)\n\t\treturn;\n\n\tif (authr->agent)\n\t\tagent_unref(authr->agent);\n\n\tg_free(authr->pincode);\n\tg_free(authr);\n\n\tdevice->authr = NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Failed requesting authentication\""
          ],
          "line": 6106
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_not_ready",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "118-122",
          "snippet": "DBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "agent_display_passkey",
          "args": [
            "auth->agent",
            "device",
            "passkey",
            "entered"
          ],
          "line": 6104
        },
        "resolved": true,
        "details": {
          "function_name": "agent_display_passkey",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "765-790",
          "snippet": "int agent_display_passkey(struct agent *agent, struct btd_device *device,\n\t\t\t\tuint32_t passkey, uint16_t entered)\n{\n\tDBusMessage *message;\n\tconst char *dev_path = device_get_path(device);\n\n\tmessage = dbus_message_new_method_call(agent->owner, agent->path,\n\t\t\t\t\tAGENT_INTERFACE, \"DisplayPasskey\");\n\tif (!message) {\n\t\terror(\"Couldn't allocate D-Bus message\");\n\t\treturn -1;\n\t}\n\n\tdbus_message_append_args(message,\n\t\t\t\tDBUS_TYPE_OBJECT_PATH, &dev_path,\n\t\t\t\tDBUS_TYPE_UINT32, &passkey,\n\t\t\t\tDBUS_TYPE_UINT16, &entered,\n\t\t\t\tDBUS_TYPE_INVALID);\n\n\tif (!g_dbus_send_message(btd_get_dbus_connection(), message)) {\n\t\terror(\"D-Bus send failed\");\n\t\treturn -1;\n\t}\n\n\treturn 0;\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define AGENT_INTERFACE \"org.bluez.Agent1\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\n#define AGENT_INTERFACE \"org.bluez.Agent1\"\n\nint agent_display_passkey(struct agent *agent, struct btd_device *device,\n\t\t\t\tuint32_t passkey, uint16_t entered)\n{\n\tDBusMessage *message;\n\tconst char *dev_path = device_get_path(device);\n\n\tmessage = dbus_message_new_method_call(agent->owner, agent->path,\n\t\t\t\t\tAGENT_INTERFACE, \"DisplayPasskey\");\n\tif (!message) {\n\t\terror(\"Couldn't allocate D-Bus message\");\n\t\treturn -1;\n\t}\n\n\tdbus_message_append_args(message,\n\t\t\t\tDBUS_TYPE_OBJECT_PATH, &dev_path,\n\t\t\t\tDBUS_TYPE_UINT32, &passkey,\n\t\t\t\tDBUS_TYPE_UINT16, &entered,\n\t\t\t\tDBUS_TYPE_INVALID);\n\n\tif (!g_dbus_send_message(btd_get_dbus_connection(), message)) {\n\t\terror(\"D-Bus send failed\");\n\t\treturn -1;\n\t}\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "new_auth",
          "args": [
            "device",
            "type",
            "AUTH_TYPE_NOTIFY_PASSKEY",
            "FALSE"
          ],
          "line": 6099
        },
        "resolved": true,
        "details": {
          "function_name": "new_auth",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5985-6021",
          "snippet": "static struct authentication_req *new_auth(struct btd_device *device,\n\t\t\t\t\t\tuint8_t addr_type,\n\t\t\t\t\t\tauth_type_t type,\n\t\t\t\t\t\tgboolean secure)\n{\n\tstruct authentication_req *auth;\n\tstruct agent *agent;\n\tchar addr[18];\n\n\tba2str(&device->bdaddr, addr);\n\tDBG(\"Requesting agent authentication for %s\", addr);\n\n\tif (device->authr) {\n\t\terror(\"Authentication already requested for %s\", addr);\n\t\treturn NULL;\n\t}\n\n\tif (device->bonding && device->bonding->agent)\n\t\tagent = agent_ref(device->bonding->agent);\n\telse\n\t\tagent = agent_get(NULL);\n\n\tif (!agent) {\n\t\terror(\"No agent available for request type %d\", type);\n\t\treturn NULL;\n\t}\n\n\tauth = g_new0(struct authentication_req, 1);\n\tauth->agent = agent;\n\tauth->device = device;\n\tauth->type = type;\n\tauth->addr_type = addr_type;\n\tauth->secure = secure;\n\tdevice->authr = auth;\n\n\treturn auth;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic struct authentication_req *new_auth(struct btd_device *device,\n\t\t\t\t\t\tuint8_t addr_type,\n\t\t\t\t\t\tauth_type_t type,\n\t\t\t\t\t\tgboolean secure)\n{\n\tstruct authentication_req *auth;\n\tstruct agent *agent;\n\tchar addr[18];\n\n\tba2str(&device->bdaddr, addr);\n\tDBG(\"Requesting agent authentication for %s\", addr);\n\n\tif (device->authr) {\n\t\terror(\"Authentication already requested for %s\", addr);\n\t\treturn NULL;\n\t}\n\n\tif (device->bonding && device->bonding->agent)\n\t\tagent = agent_ref(device->bonding->agent);\n\telse\n\t\tagent = agent_get(NULL);\n\n\tif (!agent) {\n\t\terror(\"No agent available for request type %d\", type);\n\t\treturn NULL;\n\t}\n\n\tauth = g_new0(struct authentication_req, 1);\n\tauth->agent = agent;\n\tauth->device = device;\n\tauth->type = type;\n\tauth->addr_type = addr_type;\n\tauth->secure = secure;\n\tdevice->authr = auth;\n\n\treturn auth;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nint device_notify_passkey(struct btd_device *device, uint8_t type,\n\t\t\t\t\tuint32_t passkey, uint8_t entered)\n{\n\tstruct authentication_req *auth;\n\tint err;\n\n\tif (device->authr) {\n\t\tauth = device->authr;\n\t\tif (auth->type != AUTH_TYPE_NOTIFY_PASSKEY)\n\t\t\treturn -EPERM;\n\t} else {\n\t\tauth = new_auth(device, type, AUTH_TYPE_NOTIFY_PASSKEY, FALSE);\n\t\tif (!auth)\n\t\t\treturn -EPERM;\n\t}\n\n\terr = agent_display_passkey(auth->agent, device, passkey, entered);\n\tif (err < 0) {\n\t\terror(\"Failed requesting authentication\");\n\t\tdevice_auth_req_free(device);\n\t}\n\n\treturn err;\n}"
  },
  {
    "function_name": "device_confirm_passkey",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "6061-6086",
    "snippet": "int device_confirm_passkey(struct btd_device *device, uint8_t type,\n\t\t\t\t\tint32_t passkey, uint8_t confirm_hint)\n{\n\tstruct authentication_req *auth;\n\tint err;\n\n\tauth = new_auth(device, type, AUTH_TYPE_CONFIRM, FALSE);\n\tif (!auth)\n\t\treturn -EPERM;\n\n\tauth->passkey = passkey;\n\n\tif (confirm_hint)\n\t\terr = agent_request_authorization(auth->agent, device,\n\t\t\t\t\t\tconfirm_cb, auth, NULL);\n\telse\n\t\terr = agent_request_confirmation(auth->agent, device, passkey,\n\t\t\t\t\t\tconfirm_cb, auth, NULL);\n\n\tif (err < 0) {\n\t\terror(\"Failed requesting authentication\");\n\t\tdevice_auth_req_free(device);\n\t}\n\n\treturn err;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "device_auth_req_free",
          "args": [
            "device"
          ],
          "line": 6082
        },
        "resolved": true,
        "details": {
          "function_name": "device_auth_req_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5662-5676",
          "snippet": "static void device_auth_req_free(struct btd_device *device)\n{\n\tstruct authentication_req *authr = device->authr;\n\n\tif (!authr)\n\t\treturn;\n\n\tif (authr->agent)\n\t\tagent_unref(authr->agent);\n\n\tg_free(authr->pincode);\n\tg_free(authr);\n\n\tdevice->authr = NULL;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void device_auth_req_free(struct btd_device *device)\n{\n\tstruct authentication_req *authr = device->authr;\n\n\tif (!authr)\n\t\treturn;\n\n\tif (authr->agent)\n\t\tagent_unref(authr->agent);\n\n\tg_free(authr->pincode);\n\tg_free(authr);\n\n\tdevice->authr = NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Failed requesting authentication\""
          ],
          "line": 6081
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_not_ready",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "118-122",
          "snippet": "DBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "agent_request_confirmation",
          "args": [
            "auth->agent",
            "device",
            "passkey",
            "confirm_cb",
            "auth",
            "NULL"
          ],
          "line": 6077
        },
        "resolved": true,
        "details": {
          "function_name": "agent_request_confirmation",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "678-706",
          "snippet": "int agent_request_confirmation(struct agent *agent, struct btd_device *device,\n\t\t\t\tuint32_t passkey, agent_cb cb,\n\t\t\t\tvoid *user_data, GDestroyNotify destroy)\n{\n\tstruct agent_request *req;\n\tconst char *dev_path = device_get_path(device);\n\tint err;\n\n\tif (agent->request)\n\t\treturn -EBUSY;\n\n\tDBG(\"Calling Agent.RequestConfirmation: name=%s, path=%s, passkey=%06u\",\n\t\t\tagent->owner, agent->path, passkey);\n\n\treq = agent_request_new(agent, AGENT_REQUEST_CONFIRMATION, cb,\n\t\t\t\tuser_data, destroy);\n\n\terr = confirmation_request_new(req, dev_path, passkey);\n\tif (err < 0)\n\t\tgoto failed;\n\n\tagent->request = req;\n\n\treturn 0;\n\nfailed:\n\tagent_request_free(req, FALSE);\n\treturn err;\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nint agent_request_confirmation(struct agent *agent, struct btd_device *device,\n\t\t\t\tuint32_t passkey, agent_cb cb,\n\t\t\t\tvoid *user_data, GDestroyNotify destroy)\n{\n\tstruct agent_request *req;\n\tconst char *dev_path = device_get_path(device);\n\tint err;\n\n\tif (agent->request)\n\t\treturn -EBUSY;\n\n\tDBG(\"Calling Agent.RequestConfirmation: name=%s, path=%s, passkey=%06u\",\n\t\t\tagent->owner, agent->path, passkey);\n\n\treq = agent_request_new(agent, AGENT_REQUEST_CONFIRMATION, cb,\n\t\t\t\tuser_data, destroy);\n\n\terr = confirmation_request_new(req, dev_path, passkey);\n\tif (err < 0)\n\t\tgoto failed;\n\n\tagent->request = req;\n\n\treturn 0;\n\nfailed:\n\tagent_request_free(req, FALSE);\n\treturn err;\n}"
        }
      },
      {
        "call_info": {
          "callee": "agent_request_authorization",
          "args": [
            "auth->agent",
            "device",
            "confirm_cb",
            "auth",
            "NULL"
          ],
          "line": 6074
        },
        "resolved": true,
        "details": {
          "function_name": "agent_request_authorization",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "735-763",
          "snippet": "int agent_request_authorization(struct agent *agent, struct btd_device *device,\n\t\t\t\t\t\tagent_cb cb, void *user_data,\n\t\t\t\t\t\tGDestroyNotify destroy)\n{\n\tstruct agent_request *req;\n\tconst char *dev_path = device_get_path(device);\n\tint err;\n\n\tif (agent->request)\n\t\treturn -EBUSY;\n\n\tDBG(\"Calling Agent.RequestAuthorization: name=%s, path=%s\",\n\t\t\t\t\t\tagent->owner, agent->path);\n\n\treq = agent_request_new(agent, AGENT_REQUEST_AUTHORIZATION, cb,\n\t\t\t\tuser_data, destroy);\n\n\terr = authorization_request_new(req, dev_path);\n\tif (err < 0)\n\t\tgoto failed;\n\n\tagent->request = req;\n\n\treturn 0;\n\nfailed:\n\tagent_request_free(req, FALSE);\n\treturn err;\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nint agent_request_authorization(struct agent *agent, struct btd_device *device,\n\t\t\t\t\t\tagent_cb cb, void *user_data,\n\t\t\t\t\t\tGDestroyNotify destroy)\n{\n\tstruct agent_request *req;\n\tconst char *dev_path = device_get_path(device);\n\tint err;\n\n\tif (agent->request)\n\t\treturn -EBUSY;\n\n\tDBG(\"Calling Agent.RequestAuthorization: name=%s, path=%s\",\n\t\t\t\t\t\tagent->owner, agent->path);\n\n\treq = agent_request_new(agent, AGENT_REQUEST_AUTHORIZATION, cb,\n\t\t\t\tuser_data, destroy);\n\n\terr = authorization_request_new(req, dev_path);\n\tif (err < 0)\n\t\tgoto failed;\n\n\tagent->request = req;\n\n\treturn 0;\n\nfailed:\n\tagent_request_free(req, FALSE);\n\treturn err;\n}"
        }
      },
      {
        "call_info": {
          "callee": "new_auth",
          "args": [
            "device",
            "type",
            "AUTH_TYPE_CONFIRM",
            "FALSE"
          ],
          "line": 6067
        },
        "resolved": true,
        "details": {
          "function_name": "new_auth",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5985-6021",
          "snippet": "static struct authentication_req *new_auth(struct btd_device *device,\n\t\t\t\t\t\tuint8_t addr_type,\n\t\t\t\t\t\tauth_type_t type,\n\t\t\t\t\t\tgboolean secure)\n{\n\tstruct authentication_req *auth;\n\tstruct agent *agent;\n\tchar addr[18];\n\n\tba2str(&device->bdaddr, addr);\n\tDBG(\"Requesting agent authentication for %s\", addr);\n\n\tif (device->authr) {\n\t\terror(\"Authentication already requested for %s\", addr);\n\t\treturn NULL;\n\t}\n\n\tif (device->bonding && device->bonding->agent)\n\t\tagent = agent_ref(device->bonding->agent);\n\telse\n\t\tagent = agent_get(NULL);\n\n\tif (!agent) {\n\t\terror(\"No agent available for request type %d\", type);\n\t\treturn NULL;\n\t}\n\n\tauth = g_new0(struct authentication_req, 1);\n\tauth->agent = agent;\n\tauth->device = device;\n\tauth->type = type;\n\tauth->addr_type = addr_type;\n\tauth->secure = secure;\n\tdevice->authr = auth;\n\n\treturn auth;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic struct authentication_req *new_auth(struct btd_device *device,\n\t\t\t\t\t\tuint8_t addr_type,\n\t\t\t\t\t\tauth_type_t type,\n\t\t\t\t\t\tgboolean secure)\n{\n\tstruct authentication_req *auth;\n\tstruct agent *agent;\n\tchar addr[18];\n\n\tba2str(&device->bdaddr, addr);\n\tDBG(\"Requesting agent authentication for %s\", addr);\n\n\tif (device->authr) {\n\t\terror(\"Authentication already requested for %s\", addr);\n\t\treturn NULL;\n\t}\n\n\tif (device->bonding && device->bonding->agent)\n\t\tagent = agent_ref(device->bonding->agent);\n\telse\n\t\tagent = agent_get(NULL);\n\n\tif (!agent) {\n\t\terror(\"No agent available for request type %d\", type);\n\t\treturn NULL;\n\t}\n\n\tauth = g_new0(struct authentication_req, 1);\n\tauth->agent = agent;\n\tauth->device = device;\n\tauth->type = type;\n\tauth->addr_type = addr_type;\n\tauth->secure = secure;\n\tdevice->authr = auth;\n\n\treturn auth;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nint device_confirm_passkey(struct btd_device *device, uint8_t type,\n\t\t\t\t\tint32_t passkey, uint8_t confirm_hint)\n{\n\tstruct authentication_req *auth;\n\tint err;\n\n\tauth = new_auth(device, type, AUTH_TYPE_CONFIRM, FALSE);\n\tif (!auth)\n\t\treturn -EPERM;\n\n\tauth->passkey = passkey;\n\n\tif (confirm_hint)\n\t\terr = agent_request_authorization(auth->agent, device,\n\t\t\t\t\t\tconfirm_cb, auth, NULL);\n\telse\n\t\terr = agent_request_confirmation(auth->agent, device, passkey,\n\t\t\t\t\t\tconfirm_cb, auth, NULL);\n\n\tif (err < 0) {\n\t\terror(\"Failed requesting authentication\");\n\t\tdevice_auth_req_free(device);\n\t}\n\n\treturn err;\n}"
  },
  {
    "function_name": "device_request_passkey",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "6042-6059",
    "snippet": "int device_request_passkey(struct btd_device *device, uint8_t type)\n{\n\tstruct authentication_req *auth;\n\tint err;\n\n\tauth = new_auth(device, type, AUTH_TYPE_PASSKEY, FALSE);\n\tif (!auth)\n\t\treturn -EPERM;\n\n\terr = agent_request_passkey(auth->agent, device, passkey_cb, auth,\n\t\t\t\t\t\t\t\t\tNULL);\n\tif (err < 0) {\n\t\terror(\"Failed requesting authentication\");\n\t\tdevice_auth_req_free(device);\n\t}\n\n\treturn err;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "device_auth_req_free",
          "args": [
            "device"
          ],
          "line": 6055
        },
        "resolved": true,
        "details": {
          "function_name": "device_auth_req_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5662-5676",
          "snippet": "static void device_auth_req_free(struct btd_device *device)\n{\n\tstruct authentication_req *authr = device->authr;\n\n\tif (!authr)\n\t\treturn;\n\n\tif (authr->agent)\n\t\tagent_unref(authr->agent);\n\n\tg_free(authr->pincode);\n\tg_free(authr);\n\n\tdevice->authr = NULL;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void device_auth_req_free(struct btd_device *device)\n{\n\tstruct authentication_req *authr = device->authr;\n\n\tif (!authr)\n\t\treturn;\n\n\tif (authr->agent)\n\t\tagent_unref(authr->agent);\n\n\tg_free(authr->pincode);\n\tg_free(authr);\n\n\tdevice->authr = NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Failed requesting authentication\""
          ],
          "line": 6054
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_not_ready",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "118-122",
          "snippet": "DBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "agent_request_passkey",
          "args": [
            "auth->agent",
            "device",
            "passkey_cb",
            "auth",
            "NULL"
          ],
          "line": 6051
        },
        "resolved": true,
        "details": {
          "function_name": "agent_request_passkey",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "619-647",
          "snippet": "int agent_request_passkey(struct agent *agent, struct btd_device *device,\n\t\t\t\tagent_passkey_cb cb, void *user_data,\n\t\t\t\tGDestroyNotify destroy)\n{\n\tstruct agent_request *req;\n\tconst char *dev_path = device_get_path(device);\n\tint err;\n\n\tif (agent->request)\n\t\treturn -EBUSY;\n\n\tDBG(\"Calling Agent.RequestPasskey: name=%s, path=%s\",\n\t\t\tagent->owner, agent->path);\n\n\treq = agent_request_new(agent, AGENT_REQUEST_PASSKEY, cb,\n\t\t\t\t\t\t\tuser_data, destroy);\n\n\terr = passkey_request_new(req, dev_path);\n\tif (err < 0)\n\t\tgoto failed;\n\n\tagent->request = req;\n\n\treturn 0;\n\nfailed:\n\tagent_request_free(req, FALSE);\n\treturn err;\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nint agent_request_passkey(struct agent *agent, struct btd_device *device,\n\t\t\t\tagent_passkey_cb cb, void *user_data,\n\t\t\t\tGDestroyNotify destroy)\n{\n\tstruct agent_request *req;\n\tconst char *dev_path = device_get_path(device);\n\tint err;\n\n\tif (agent->request)\n\t\treturn -EBUSY;\n\n\tDBG(\"Calling Agent.RequestPasskey: name=%s, path=%s\",\n\t\t\tagent->owner, agent->path);\n\n\treq = agent_request_new(agent, AGENT_REQUEST_PASSKEY, cb,\n\t\t\t\t\t\t\tuser_data, destroy);\n\n\terr = passkey_request_new(req, dev_path);\n\tif (err < 0)\n\t\tgoto failed;\n\n\tagent->request = req;\n\n\treturn 0;\n\nfailed:\n\tagent_request_free(req, FALSE);\n\treturn err;\n}"
        }
      },
      {
        "call_info": {
          "callee": "new_auth",
          "args": [
            "device",
            "type",
            "AUTH_TYPE_PASSKEY",
            "FALSE"
          ],
          "line": 6047
        },
        "resolved": true,
        "details": {
          "function_name": "new_auth",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5985-6021",
          "snippet": "static struct authentication_req *new_auth(struct btd_device *device,\n\t\t\t\t\t\tuint8_t addr_type,\n\t\t\t\t\t\tauth_type_t type,\n\t\t\t\t\t\tgboolean secure)\n{\n\tstruct authentication_req *auth;\n\tstruct agent *agent;\n\tchar addr[18];\n\n\tba2str(&device->bdaddr, addr);\n\tDBG(\"Requesting agent authentication for %s\", addr);\n\n\tif (device->authr) {\n\t\terror(\"Authentication already requested for %s\", addr);\n\t\treturn NULL;\n\t}\n\n\tif (device->bonding && device->bonding->agent)\n\t\tagent = agent_ref(device->bonding->agent);\n\telse\n\t\tagent = agent_get(NULL);\n\n\tif (!agent) {\n\t\terror(\"No agent available for request type %d\", type);\n\t\treturn NULL;\n\t}\n\n\tauth = g_new0(struct authentication_req, 1);\n\tauth->agent = agent;\n\tauth->device = device;\n\tauth->type = type;\n\tauth->addr_type = addr_type;\n\tauth->secure = secure;\n\tdevice->authr = auth;\n\n\treturn auth;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic struct authentication_req *new_auth(struct btd_device *device,\n\t\t\t\t\t\tuint8_t addr_type,\n\t\t\t\t\t\tauth_type_t type,\n\t\t\t\t\t\tgboolean secure)\n{\n\tstruct authentication_req *auth;\n\tstruct agent *agent;\n\tchar addr[18];\n\n\tba2str(&device->bdaddr, addr);\n\tDBG(\"Requesting agent authentication for %s\", addr);\n\n\tif (device->authr) {\n\t\terror(\"Authentication already requested for %s\", addr);\n\t\treturn NULL;\n\t}\n\n\tif (device->bonding && device->bonding->agent)\n\t\tagent = agent_ref(device->bonding->agent);\n\telse\n\t\tagent = agent_get(NULL);\n\n\tif (!agent) {\n\t\terror(\"No agent available for request type %d\", type);\n\t\treturn NULL;\n\t}\n\n\tauth = g_new0(struct authentication_req, 1);\n\tauth->agent = agent;\n\tauth->device = device;\n\tauth->type = type;\n\tauth->addr_type = addr_type;\n\tauth->secure = secure;\n\tdevice->authr = auth;\n\n\treturn auth;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nint device_request_passkey(struct btd_device *device, uint8_t type)\n{\n\tstruct authentication_req *auth;\n\tint err;\n\n\tauth = new_auth(device, type, AUTH_TYPE_PASSKEY, FALSE);\n\tif (!auth)\n\t\treturn -EPERM;\n\n\terr = agent_request_passkey(auth->agent, device, passkey_cb, auth,\n\t\t\t\t\t\t\t\t\tNULL);\n\tif (err < 0) {\n\t\terror(\"Failed requesting authentication\");\n\t\tdevice_auth_req_free(device);\n\t}\n\n\treturn err;\n}"
  },
  {
    "function_name": "device_request_pincode",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "6023-6040",
    "snippet": "int device_request_pincode(struct btd_device *device, gboolean secure)\n{\n\tstruct authentication_req *auth;\n\tint err;\n\n\tauth = new_auth(device, BDADDR_BREDR, AUTH_TYPE_PINCODE, secure);\n\tif (!auth)\n\t\treturn -EPERM;\n\n\terr = agent_request_pincode(auth->agent, device, pincode_cb, secure,\n\t\t\t\t\t\t\t\tauth, NULL);\n\tif (err < 0) {\n\t\terror(\"Failed requesting authentication\");\n\t\tdevice_auth_req_free(device);\n\t}\n\n\treturn err;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "device_auth_req_free",
          "args": [
            "device"
          ],
          "line": 6036
        },
        "resolved": true,
        "details": {
          "function_name": "device_auth_req_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5662-5676",
          "snippet": "static void device_auth_req_free(struct btd_device *device)\n{\n\tstruct authentication_req *authr = device->authr;\n\n\tif (!authr)\n\t\treturn;\n\n\tif (authr->agent)\n\t\tagent_unref(authr->agent);\n\n\tg_free(authr->pincode);\n\tg_free(authr);\n\n\tdevice->authr = NULL;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void device_auth_req_free(struct btd_device *device)\n{\n\tstruct authentication_req *authr = device->authr;\n\n\tif (!authr)\n\t\treturn;\n\n\tif (authr->agent)\n\t\tagent_unref(authr->agent);\n\n\tg_free(authr->pincode);\n\tg_free(authr);\n\n\tdevice->authr = NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Failed requesting authentication\""
          ],
          "line": 6035
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_not_ready",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "118-122",
          "snippet": "DBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "agent_request_pincode",
          "args": [
            "auth->agent",
            "device",
            "pincode_cb",
            "secure",
            "auth",
            "NULL"
          ],
          "line": 6032
        },
        "resolved": true,
        "details": {
          "function_name": "agent_request_pincode",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "525-550",
          "snippet": "int agent_request_pincode(struct agent *agent, struct btd_device *device,\n\t\t\t\tagent_pincode_cb cb, gboolean secure,\n\t\t\t\tvoid *user_data, GDestroyNotify destroy)\n{\n\tstruct agent_request *req;\n\tconst char *dev_path = device_get_path(device);\n\tint err;\n\n\tif (agent->request)\n\t\treturn -EBUSY;\n\n\treq = agent_request_new(agent, AGENT_REQUEST_PINCODE, cb,\n\t\t\t\t\t\t\tuser_data, destroy);\n\n\terr = pincode_request_new(req, dev_path, secure);\n\tif (err < 0)\n\t\tgoto failed;\n\n\tagent->request = req;\n\n\treturn 0;\n\nfailed:\n\tagent_request_free(req, FALSE);\n\treturn err;\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nint agent_request_pincode(struct agent *agent, struct btd_device *device,\n\t\t\t\tagent_pincode_cb cb, gboolean secure,\n\t\t\t\tvoid *user_data, GDestroyNotify destroy)\n{\n\tstruct agent_request *req;\n\tconst char *dev_path = device_get_path(device);\n\tint err;\n\n\tif (agent->request)\n\t\treturn -EBUSY;\n\n\treq = agent_request_new(agent, AGENT_REQUEST_PINCODE, cb,\n\t\t\t\t\t\t\tuser_data, destroy);\n\n\terr = pincode_request_new(req, dev_path, secure);\n\tif (err < 0)\n\t\tgoto failed;\n\n\tagent->request = req;\n\n\treturn 0;\n\nfailed:\n\tagent_request_free(req, FALSE);\n\treturn err;\n}"
        }
      },
      {
        "call_info": {
          "callee": "new_auth",
          "args": [
            "device",
            "BDADDR_BREDR",
            "AUTH_TYPE_PINCODE",
            "secure"
          ],
          "line": 6028
        },
        "resolved": true,
        "details": {
          "function_name": "new_auth",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5985-6021",
          "snippet": "static struct authentication_req *new_auth(struct btd_device *device,\n\t\t\t\t\t\tuint8_t addr_type,\n\t\t\t\t\t\tauth_type_t type,\n\t\t\t\t\t\tgboolean secure)\n{\n\tstruct authentication_req *auth;\n\tstruct agent *agent;\n\tchar addr[18];\n\n\tba2str(&device->bdaddr, addr);\n\tDBG(\"Requesting agent authentication for %s\", addr);\n\n\tif (device->authr) {\n\t\terror(\"Authentication already requested for %s\", addr);\n\t\treturn NULL;\n\t}\n\n\tif (device->bonding && device->bonding->agent)\n\t\tagent = agent_ref(device->bonding->agent);\n\telse\n\t\tagent = agent_get(NULL);\n\n\tif (!agent) {\n\t\terror(\"No agent available for request type %d\", type);\n\t\treturn NULL;\n\t}\n\n\tauth = g_new0(struct authentication_req, 1);\n\tauth->agent = agent;\n\tauth->device = device;\n\tauth->type = type;\n\tauth->addr_type = addr_type;\n\tauth->secure = secure;\n\tdevice->authr = auth;\n\n\treturn auth;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic struct authentication_req *new_auth(struct btd_device *device,\n\t\t\t\t\t\tuint8_t addr_type,\n\t\t\t\t\t\tauth_type_t type,\n\t\t\t\t\t\tgboolean secure)\n{\n\tstruct authentication_req *auth;\n\tstruct agent *agent;\n\tchar addr[18];\n\n\tba2str(&device->bdaddr, addr);\n\tDBG(\"Requesting agent authentication for %s\", addr);\n\n\tif (device->authr) {\n\t\terror(\"Authentication already requested for %s\", addr);\n\t\treturn NULL;\n\t}\n\n\tif (device->bonding && device->bonding->agent)\n\t\tagent = agent_ref(device->bonding->agent);\n\telse\n\t\tagent = agent_get(NULL);\n\n\tif (!agent) {\n\t\terror(\"No agent available for request type %d\", type);\n\t\treturn NULL;\n\t}\n\n\tauth = g_new0(struct authentication_req, 1);\n\tauth->agent = agent;\n\tauth->device = device;\n\tauth->type = type;\n\tauth->addr_type = addr_type;\n\tauth->secure = secure;\n\tdevice->authr = auth;\n\n\treturn auth;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nint device_request_pincode(struct btd_device *device, gboolean secure)\n{\n\tstruct authentication_req *auth;\n\tint err;\n\n\tauth = new_auth(device, BDADDR_BREDR, AUTH_TYPE_PINCODE, secure);\n\tif (!auth)\n\t\treturn -EPERM;\n\n\terr = agent_request_pincode(auth->agent, device, pincode_cb, secure,\n\t\t\t\t\t\t\t\tauth, NULL);\n\tif (err < 0) {\n\t\terror(\"Failed requesting authentication\");\n\t\tdevice_auth_req_free(device);\n\t}\n\n\treturn err;\n}"
  },
  {
    "function_name": "new_auth",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "5985-6021",
    "snippet": "static struct authentication_req *new_auth(struct btd_device *device,\n\t\t\t\t\t\tuint8_t addr_type,\n\t\t\t\t\t\tauth_type_t type,\n\t\t\t\t\t\tgboolean secure)\n{\n\tstruct authentication_req *auth;\n\tstruct agent *agent;\n\tchar addr[18];\n\n\tba2str(&device->bdaddr, addr);\n\tDBG(\"Requesting agent authentication for %s\", addr);\n\n\tif (device->authr) {\n\t\terror(\"Authentication already requested for %s\", addr);\n\t\treturn NULL;\n\t}\n\n\tif (device->bonding && device->bonding->agent)\n\t\tagent = agent_ref(device->bonding->agent);\n\telse\n\t\tagent = agent_get(NULL);\n\n\tif (!agent) {\n\t\terror(\"No agent available for request type %d\", type);\n\t\treturn NULL;\n\t}\n\n\tauth = g_new0(struct authentication_req, 1);\n\tauth->agent = agent;\n\tauth->device = device;\n\tauth->type = type;\n\tauth->addr_type = addr_type;\n\tauth->secure = secure;\n\tdevice->authr = auth;\n\n\treturn auth;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_new0",
          "args": [
            "structauthentication_req",
            "1"
          ],
          "line": 6012
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"No agent available for request type %d\"",
            "type"
          ],
          "line": 6008
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "124-128",
          "snippet": "DBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "agent_get",
          "args": [
            "NULL"
          ],
          "line": 6005
        },
        "resolved": true,
        "details": {
          "function_name": "agent_get_io_capability",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "900-903",
          "snippet": "uint8_t agent_get_io_capability(struct agent *agent)\n{\n\treturn agent->capability;\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nuint8_t agent_get_io_capability(struct agent *agent)\n{\n\treturn agent->capability;\n}"
        }
      },
      {
        "call_info": {
          "callee": "agent_ref",
          "args": [
            "device->bonding->agent"
          ],
          "line": 6003
        },
        "resolved": true,
        "details": {
          "function_name": "agent_ref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "202-209",
          "snippet": "struct agent *agent_ref(struct agent *agent)\n{\n\tagent->ref++;\n\n\tDBG(\"%p: ref=%d\", agent, agent->ref);\n\n\treturn agent;\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstruct agent *agent_ref(struct agent *agent)\n{\n\tagent->ref++;\n\n\tDBG(\"%p: ref=%d\", agent, agent->ref);\n\n\treturn agent;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Requesting agent authentication for %s\"",
            "addr"
          ],
          "line": 5995
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ba2str",
          "args": [
            "&device->bdaddr",
            "addr"
          ],
          "line": 5994
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic struct authentication_req *new_auth(struct btd_device *device,\n\t\t\t\t\t\tuint8_t addr_type,\n\t\t\t\t\t\tauth_type_t type,\n\t\t\t\t\t\tgboolean secure)\n{\n\tstruct authentication_req *auth;\n\tstruct agent *agent;\n\tchar addr[18];\n\n\tba2str(&device->bdaddr, addr);\n\tDBG(\"Requesting agent authentication for %s\", addr);\n\n\tif (device->authr) {\n\t\terror(\"Authentication already requested for %s\", addr);\n\t\treturn NULL;\n\t}\n\n\tif (device->bonding && device->bonding->agent)\n\t\tagent = agent_ref(device->bonding->agent);\n\telse\n\t\tagent = agent_get(NULL);\n\n\tif (!agent) {\n\t\terror(\"No agent available for request type %d\", type);\n\t\treturn NULL;\n\t}\n\n\tauth = g_new0(struct authentication_req, 1);\n\tauth->agent = agent;\n\tauth->device = device;\n\tauth->type = type;\n\tauth->addr_type = addr_type;\n\tauth->secure = secure;\n\tdevice->authr = auth;\n\n\treturn auth;\n}"
  },
  {
    "function_name": "display_pincode_cb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "5974-5983",
    "snippet": "static void display_pincode_cb(struct agent *agent, DBusError *err, void *data)\n{\n\tstruct authentication_req *auth = data;\n\tstruct btd_device *device = auth->device;\n\n\tpincode_cb(agent, err, auth->pincode, auth);\n\n\tg_free(device->authr->pincode);\n\tdevice->authr->pincode = NULL;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "device->authr->pincode"
          ],
          "line": 5981
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pincode_cb",
          "args": [
            "agent",
            "err",
            "auth->pincode",
            "auth"
          ],
          "line": 5979
        },
        "resolved": true,
        "details": {
          "function_name": "pincode_cb",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5920-5935",
          "snippet": "static void pincode_cb(struct agent *agent, DBusError *err, const char *pin,\n\t\t\t\t\t\t\t\tvoid *data)\n{\n\tstruct authentication_req *auth = data;\n\tstruct btd_device *device = auth->device;\n\n\t/* No need to reply anything if the authentication already failed */\n\tif (auth->agent == NULL)\n\t\treturn;\n\n\tbtd_adapter_pincode_reply(device->adapter, &device->bdaddr,\n\t\t\t\t\t\tpin, pin ? strlen(pin) : 0);\n\n\tagent_unref(device->authr->agent);\n\tdevice->authr->agent = NULL;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void pincode_cb(struct agent *agent, DBusError *err, const char *pin,\n\t\t\t\t\t\t\t\tvoid *data)\n{\n\tstruct authentication_req *auth = data;\n\tstruct btd_device *device = auth->device;\n\n\t/* No need to reply anything if the authentication already failed */\n\tif (auth->agent == NULL)\n\t\treturn;\n\n\tbtd_adapter_pincode_reply(device->adapter, &device->bdaddr,\n\t\t\t\t\t\tpin, pin ? strlen(pin) : 0);\n\n\tagent_unref(device->authr->agent);\n\tdevice->authr->agent = NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void display_pincode_cb(struct agent *agent, DBusError *err, void *data)\n{\n\tstruct authentication_req *auth = data;\n\tstruct btd_device *device = auth->device;\n\n\tpincode_cb(agent, err, auth->pincode, auth);\n\n\tg_free(device->authr->pincode);\n\tdevice->authr->pincode = NULL;\n}"
  },
  {
    "function_name": "passkey_cb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "5954-5972",
    "snippet": "static void passkey_cb(struct agent *agent, DBusError *err,\n\t\t\t\t\t\tuint32_t passkey, void *data)\n{\n\tstruct authentication_req *auth = data;\n\tstruct btd_device *device = auth->device;\n\n\t/* No need to reply anything if the authentication already failed */\n\tif (auth->agent == NULL)\n\t\treturn;\n\n\tif (err)\n\t\tpasskey = INVALID_PASSKEY;\n\n\tbtd_adapter_passkey_reply(device->adapter, &device->bdaddr,\n\t\t\t\t\t\tauth->addr_type, passkey);\n\n\tagent_unref(device->authr->agent);\n\tdevice->authr->agent = NULL;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "agent_unref",
          "args": [
            "device->authr->agent"
          ],
          "line": 5970
        },
        "resolved": true,
        "details": {
          "function_name": "agent_unref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "211-257",
          "snippet": "void agent_unref(struct agent *agent)\n{\n\tagent->ref--;\n\n\tDBG(\"%p: ref=%d\", agent, agent->ref);\n\n\tif (agent->ref > 0)\n\t\treturn;\n\n\tif (agent->request) {\n\t\tDBusError err;\n\t\tagent_pincode_cb pincode_cb;\n\t\tagent_passkey_cb passkey_cb;\n\t\tagent_cb cb;\n\n\t\tdbus_error_init(&err);\n\t\tdbus_set_error_const(&err, ERROR_INTERFACE \".Failed\",\n\t\t\t\t\t\t\t\t\"Canceled\");\n\n\t\tswitch (agent->request->type) {\n\t\tcase AGENT_REQUEST_PINCODE:\n\t\t\tpincode_cb = agent->request->cb;\n\t\t\tpincode_cb(agent, &err, NULL, agent->request->user_data);\n\t\t\tbreak;\n\t\tcase AGENT_REQUEST_PASSKEY:\n\t\t\tpasskey_cb = agent->request->cb;\n\t\t\tpasskey_cb(agent, &err, 0, agent->request->user_data);\n\t\t\tbreak;\n\t\tcase AGENT_REQUEST_CONFIRMATION:\n\t\tcase AGENT_REQUEST_AUTHORIZATION:\n\t\tcase AGENT_REQUEST_AUTHORIZE_SERVICE:\n\t\tcase AGENT_REQUEST_DISPLAY_PINCODE:\n\t\tdefault:\n\t\t\tcb = agent->request->cb;\n\t\t\tcb(agent, &err, agent->request->user_data);\n\t\t}\n\n\t\tdbus_error_free(&err);\n\n\t\tagent_cancel(agent);\n\t}\n\n\tg_free(agent->owner);\n\tg_free(agent->path);\n\n\tg_free(agent);\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid agent_unref(struct agent *agent)\n{\n\tagent->ref--;\n\n\tDBG(\"%p: ref=%d\", agent, agent->ref);\n\n\tif (agent->ref > 0)\n\t\treturn;\n\n\tif (agent->request) {\n\t\tDBusError err;\n\t\tagent_pincode_cb pincode_cb;\n\t\tagent_passkey_cb passkey_cb;\n\t\tagent_cb cb;\n\n\t\tdbus_error_init(&err);\n\t\tdbus_set_error_const(&err, ERROR_INTERFACE \".Failed\",\n\t\t\t\t\t\t\t\t\"Canceled\");\n\n\t\tswitch (agent->request->type) {\n\t\tcase AGENT_REQUEST_PINCODE:\n\t\t\tpincode_cb = agent->request->cb;\n\t\t\tpincode_cb(agent, &err, NULL, agent->request->user_data);\n\t\t\tbreak;\n\t\tcase AGENT_REQUEST_PASSKEY:\n\t\t\tpasskey_cb = agent->request->cb;\n\t\t\tpasskey_cb(agent, &err, 0, agent->request->user_data);\n\t\t\tbreak;\n\t\tcase AGENT_REQUEST_CONFIRMATION:\n\t\tcase AGENT_REQUEST_AUTHORIZATION:\n\t\tcase AGENT_REQUEST_AUTHORIZE_SERVICE:\n\t\tcase AGENT_REQUEST_DISPLAY_PINCODE:\n\t\tdefault:\n\t\t\tcb = agent->request->cb;\n\t\t\tcb(agent, &err, agent->request->user_data);\n\t\t}\n\n\t\tdbus_error_free(&err);\n\n\t\tagent_cancel(agent);\n\t}\n\n\tg_free(agent->owner);\n\tg_free(agent->path);\n\n\tg_free(agent);\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_adapter_passkey_reply",
          "args": [
            "device->adapter",
            "&device->bdaddr",
            "auth->addr_type",
            "passkey"
          ],
          "line": 5967
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_passkey_reply",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "6838-6875",
          "snippet": "int btd_adapter_passkey_reply(struct btd_adapter *adapter,\n\t\t\t\tconst bdaddr_t *bdaddr, uint8_t bdaddr_type,\n\t\t\t\tuint32_t passkey)\n{\n\tunsigned int id;\n\tchar addr[18];\n\n\tba2str(bdaddr, addr);\n\tDBG(\"hci%u addr %s passkey %06u\", adapter->dev_id, addr, passkey);\n\n\tif (passkey == INVALID_PASSKEY) {\n\t\tstruct mgmt_cp_user_passkey_neg_reply cp;\n\n\t\tmemset(&cp, 0, sizeof(cp));\n\t\tbacpy(&cp.addr.bdaddr, bdaddr);\n\t\tcp.addr.type = bdaddr_type;\n\n\t\tid = mgmt_reply(adapter->mgmt, MGMT_OP_USER_PASSKEY_NEG_REPLY,\n\t\t\t\t\tadapter->dev_id, sizeof(cp), &cp,\n\t\t\t\t\tNULL, NULL, NULL);\n\t} else {\n\t\tstruct mgmt_cp_user_passkey_reply cp;\n\n\t\tmemset(&cp, 0, sizeof(cp));\n\t\tbacpy(&cp.addr.bdaddr, bdaddr);\n\t\tcp.addr.type = bdaddr_type;\n\t\tcp.passkey = htobl(passkey);\n\n\t\tid = mgmt_reply(adapter->mgmt, MGMT_OP_USER_PASSKEY_REPLY,\n\t\t\t\t\tadapter->dev_id, sizeof(cp), &cp,\n\t\t\t\t\tNULL, NULL, NULL);\n\t}\n\n\tif (id == 0)\n\t\treturn -EIO;\n\n\treturn 0;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nint btd_adapter_passkey_reply(struct btd_adapter *adapter,\n\t\t\t\tconst bdaddr_t *bdaddr, uint8_t bdaddr_type,\n\t\t\t\tuint32_t passkey)\n{\n\tunsigned int id;\n\tchar addr[18];\n\n\tba2str(bdaddr, addr);\n\tDBG(\"hci%u addr %s passkey %06u\", adapter->dev_id, addr, passkey);\n\n\tif (passkey == INVALID_PASSKEY) {\n\t\tstruct mgmt_cp_user_passkey_neg_reply cp;\n\n\t\tmemset(&cp, 0, sizeof(cp));\n\t\tbacpy(&cp.addr.bdaddr, bdaddr);\n\t\tcp.addr.type = bdaddr_type;\n\n\t\tid = mgmt_reply(adapter->mgmt, MGMT_OP_USER_PASSKEY_NEG_REPLY,\n\t\t\t\t\tadapter->dev_id, sizeof(cp), &cp,\n\t\t\t\t\tNULL, NULL, NULL);\n\t} else {\n\t\tstruct mgmt_cp_user_passkey_reply cp;\n\n\t\tmemset(&cp, 0, sizeof(cp));\n\t\tbacpy(&cp.addr.bdaddr, bdaddr);\n\t\tcp.addr.type = bdaddr_type;\n\t\tcp.passkey = htobl(passkey);\n\n\t\tid = mgmt_reply(adapter->mgmt, MGMT_OP_USER_PASSKEY_REPLY,\n\t\t\t\t\tadapter->dev_id, sizeof(cp), &cp,\n\t\t\t\t\tNULL, NULL, NULL);\n\t}\n\n\tif (id == 0)\n\t\treturn -EIO;\n\n\treturn 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void passkey_cb(struct agent *agent, DBusError *err,\n\t\t\t\t\t\tuint32_t passkey, void *data)\n{\n\tstruct authentication_req *auth = data;\n\tstruct btd_device *device = auth->device;\n\n\t/* No need to reply anything if the authentication already failed */\n\tif (auth->agent == NULL)\n\t\treturn;\n\n\tif (err)\n\t\tpasskey = INVALID_PASSKEY;\n\n\tbtd_adapter_passkey_reply(device->adapter, &device->bdaddr,\n\t\t\t\t\t\tauth->addr_type, passkey);\n\n\tagent_unref(device->authr->agent);\n\tdevice->authr->agent = NULL;\n}"
  },
  {
    "function_name": "confirm_cb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "5937-5952",
    "snippet": "static void confirm_cb(struct agent *agent, DBusError *err, void *data)\n{\n\tstruct authentication_req *auth = data;\n\tstruct btd_device *device = auth->device;\n\n\t/* No need to reply anything if the authentication already failed */\n\tif (auth->agent == NULL)\n\t\treturn;\n\n\tbtd_adapter_confirm_reply(device->adapter, &device->bdaddr,\n\t\t\t\t\t\t\tauth->addr_type,\n\t\t\t\t\t\t\terr ? FALSE : TRUE);\n\n\tagent_unref(device->authr->agent);\n\tdevice->authr->agent = NULL;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "agent_unref",
          "args": [
            "device->authr->agent"
          ],
          "line": 5950
        },
        "resolved": true,
        "details": {
          "function_name": "agent_unref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "211-257",
          "snippet": "void agent_unref(struct agent *agent)\n{\n\tagent->ref--;\n\n\tDBG(\"%p: ref=%d\", agent, agent->ref);\n\n\tif (agent->ref > 0)\n\t\treturn;\n\n\tif (agent->request) {\n\t\tDBusError err;\n\t\tagent_pincode_cb pincode_cb;\n\t\tagent_passkey_cb passkey_cb;\n\t\tagent_cb cb;\n\n\t\tdbus_error_init(&err);\n\t\tdbus_set_error_const(&err, ERROR_INTERFACE \".Failed\",\n\t\t\t\t\t\t\t\t\"Canceled\");\n\n\t\tswitch (agent->request->type) {\n\t\tcase AGENT_REQUEST_PINCODE:\n\t\t\tpincode_cb = agent->request->cb;\n\t\t\tpincode_cb(agent, &err, NULL, agent->request->user_data);\n\t\t\tbreak;\n\t\tcase AGENT_REQUEST_PASSKEY:\n\t\t\tpasskey_cb = agent->request->cb;\n\t\t\tpasskey_cb(agent, &err, 0, agent->request->user_data);\n\t\t\tbreak;\n\t\tcase AGENT_REQUEST_CONFIRMATION:\n\t\tcase AGENT_REQUEST_AUTHORIZATION:\n\t\tcase AGENT_REQUEST_AUTHORIZE_SERVICE:\n\t\tcase AGENT_REQUEST_DISPLAY_PINCODE:\n\t\tdefault:\n\t\t\tcb = agent->request->cb;\n\t\t\tcb(agent, &err, agent->request->user_data);\n\t\t}\n\n\t\tdbus_error_free(&err);\n\n\t\tagent_cancel(agent);\n\t}\n\n\tg_free(agent->owner);\n\tg_free(agent->path);\n\n\tg_free(agent);\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid agent_unref(struct agent *agent)\n{\n\tagent->ref--;\n\n\tDBG(\"%p: ref=%d\", agent, agent->ref);\n\n\tif (agent->ref > 0)\n\t\treturn;\n\n\tif (agent->request) {\n\t\tDBusError err;\n\t\tagent_pincode_cb pincode_cb;\n\t\tagent_passkey_cb passkey_cb;\n\t\tagent_cb cb;\n\n\t\tdbus_error_init(&err);\n\t\tdbus_set_error_const(&err, ERROR_INTERFACE \".Failed\",\n\t\t\t\t\t\t\t\t\"Canceled\");\n\n\t\tswitch (agent->request->type) {\n\t\tcase AGENT_REQUEST_PINCODE:\n\t\t\tpincode_cb = agent->request->cb;\n\t\t\tpincode_cb(agent, &err, NULL, agent->request->user_data);\n\t\t\tbreak;\n\t\tcase AGENT_REQUEST_PASSKEY:\n\t\t\tpasskey_cb = agent->request->cb;\n\t\t\tpasskey_cb(agent, &err, 0, agent->request->user_data);\n\t\t\tbreak;\n\t\tcase AGENT_REQUEST_CONFIRMATION:\n\t\tcase AGENT_REQUEST_AUTHORIZATION:\n\t\tcase AGENT_REQUEST_AUTHORIZE_SERVICE:\n\t\tcase AGENT_REQUEST_DISPLAY_PINCODE:\n\t\tdefault:\n\t\t\tcb = agent->request->cb;\n\t\t\tcb(agent, &err, agent->request->user_data);\n\t\t}\n\n\t\tdbus_error_free(&err);\n\n\t\tagent_cancel(agent);\n\t}\n\n\tg_free(agent->owner);\n\tg_free(agent->path);\n\n\tg_free(agent);\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_adapter_confirm_reply",
          "args": [
            "device->adapter",
            "&device->bdaddr",
            "auth->addr_type",
            "err ? FALSE : TRUE"
          ],
          "line": 5946
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_confirm_reply",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "6775-6800",
          "snippet": "int btd_adapter_confirm_reply(struct btd_adapter *adapter,\n\t\t\t\tconst bdaddr_t *bdaddr, uint8_t bdaddr_type,\n\t\t\t\tgboolean success)\n{\n\tstruct mgmt_cp_user_confirm_reply cp;\n\tuint16_t opcode;\n\tchar addr[18];\n\n\tba2str(bdaddr, addr);\n\tDBG(\"hci%u addr %s success %d\", adapter->dev_id, addr, success);\n\n\tif (success)\n\t\topcode = MGMT_OP_USER_CONFIRM_REPLY;\n\telse\n\t\topcode = MGMT_OP_USER_CONFIRM_NEG_REPLY;\n\n\tmemset(&cp, 0, sizeof(cp));\n\tbacpy(&cp.addr.bdaddr, bdaddr);\n\tcp.addr.type = bdaddr_type;\n\n\tif (mgmt_reply(adapter->mgmt, opcode, adapter->dev_id, sizeof(cp), &cp,\n\t\t\t\t\t\t\tNULL, NULL, NULL) > 0)\n\t\treturn 0;\n\n\treturn -EIO;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nint btd_adapter_confirm_reply(struct btd_adapter *adapter,\n\t\t\t\tconst bdaddr_t *bdaddr, uint8_t bdaddr_type,\n\t\t\t\tgboolean success)\n{\n\tstruct mgmt_cp_user_confirm_reply cp;\n\tuint16_t opcode;\n\tchar addr[18];\n\n\tba2str(bdaddr, addr);\n\tDBG(\"hci%u addr %s success %d\", adapter->dev_id, addr, success);\n\n\tif (success)\n\t\topcode = MGMT_OP_USER_CONFIRM_REPLY;\n\telse\n\t\topcode = MGMT_OP_USER_CONFIRM_NEG_REPLY;\n\n\tmemset(&cp, 0, sizeof(cp));\n\tbacpy(&cp.addr.bdaddr, bdaddr);\n\tcp.addr.type = bdaddr_type;\n\n\tif (mgmt_reply(adapter->mgmt, opcode, adapter->dev_id, sizeof(cp), &cp,\n\t\t\t\t\t\t\tNULL, NULL, NULL) > 0)\n\t\treturn 0;\n\n\treturn -EIO;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void confirm_cb(struct agent *agent, DBusError *err, void *data)\n{\n\tstruct authentication_req *auth = data;\n\tstruct btd_device *device = auth->device;\n\n\t/* No need to reply anything if the authentication already failed */\n\tif (auth->agent == NULL)\n\t\treturn;\n\n\tbtd_adapter_confirm_reply(device->adapter, &device->bdaddr,\n\t\t\t\t\t\t\tauth->addr_type,\n\t\t\t\t\t\t\terr ? FALSE : TRUE);\n\n\tagent_unref(device->authr->agent);\n\tdevice->authr->agent = NULL;\n}"
  },
  {
    "function_name": "pincode_cb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "5920-5935",
    "snippet": "static void pincode_cb(struct agent *agent, DBusError *err, const char *pin,\n\t\t\t\t\t\t\t\tvoid *data)\n{\n\tstruct authentication_req *auth = data;\n\tstruct btd_device *device = auth->device;\n\n\t/* No need to reply anything if the authentication already failed */\n\tif (auth->agent == NULL)\n\t\treturn;\n\n\tbtd_adapter_pincode_reply(device->adapter, &device->bdaddr,\n\t\t\t\t\t\tpin, pin ? strlen(pin) : 0);\n\n\tagent_unref(device->authr->agent);\n\tdevice->authr->agent = NULL;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "agent_unref",
          "args": [
            "device->authr->agent"
          ],
          "line": 5933
        },
        "resolved": true,
        "details": {
          "function_name": "agent_unref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "211-257",
          "snippet": "void agent_unref(struct agent *agent)\n{\n\tagent->ref--;\n\n\tDBG(\"%p: ref=%d\", agent, agent->ref);\n\n\tif (agent->ref > 0)\n\t\treturn;\n\n\tif (agent->request) {\n\t\tDBusError err;\n\t\tagent_pincode_cb pincode_cb;\n\t\tagent_passkey_cb passkey_cb;\n\t\tagent_cb cb;\n\n\t\tdbus_error_init(&err);\n\t\tdbus_set_error_const(&err, ERROR_INTERFACE \".Failed\",\n\t\t\t\t\t\t\t\t\"Canceled\");\n\n\t\tswitch (agent->request->type) {\n\t\tcase AGENT_REQUEST_PINCODE:\n\t\t\tpincode_cb = agent->request->cb;\n\t\t\tpincode_cb(agent, &err, NULL, agent->request->user_data);\n\t\t\tbreak;\n\t\tcase AGENT_REQUEST_PASSKEY:\n\t\t\tpasskey_cb = agent->request->cb;\n\t\t\tpasskey_cb(agent, &err, 0, agent->request->user_data);\n\t\t\tbreak;\n\t\tcase AGENT_REQUEST_CONFIRMATION:\n\t\tcase AGENT_REQUEST_AUTHORIZATION:\n\t\tcase AGENT_REQUEST_AUTHORIZE_SERVICE:\n\t\tcase AGENT_REQUEST_DISPLAY_PINCODE:\n\t\tdefault:\n\t\t\tcb = agent->request->cb;\n\t\t\tcb(agent, &err, agent->request->user_data);\n\t\t}\n\n\t\tdbus_error_free(&err);\n\n\t\tagent_cancel(agent);\n\t}\n\n\tg_free(agent->owner);\n\tg_free(agent->path);\n\n\tg_free(agent);\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid agent_unref(struct agent *agent)\n{\n\tagent->ref--;\n\n\tDBG(\"%p: ref=%d\", agent, agent->ref);\n\n\tif (agent->ref > 0)\n\t\treturn;\n\n\tif (agent->request) {\n\t\tDBusError err;\n\t\tagent_pincode_cb pincode_cb;\n\t\tagent_passkey_cb passkey_cb;\n\t\tagent_cb cb;\n\n\t\tdbus_error_init(&err);\n\t\tdbus_set_error_const(&err, ERROR_INTERFACE \".Failed\",\n\t\t\t\t\t\t\t\t\"Canceled\");\n\n\t\tswitch (agent->request->type) {\n\t\tcase AGENT_REQUEST_PINCODE:\n\t\t\tpincode_cb = agent->request->cb;\n\t\t\tpincode_cb(agent, &err, NULL, agent->request->user_data);\n\t\t\tbreak;\n\t\tcase AGENT_REQUEST_PASSKEY:\n\t\t\tpasskey_cb = agent->request->cb;\n\t\t\tpasskey_cb(agent, &err, 0, agent->request->user_data);\n\t\t\tbreak;\n\t\tcase AGENT_REQUEST_CONFIRMATION:\n\t\tcase AGENT_REQUEST_AUTHORIZATION:\n\t\tcase AGENT_REQUEST_AUTHORIZE_SERVICE:\n\t\tcase AGENT_REQUEST_DISPLAY_PINCODE:\n\t\tdefault:\n\t\t\tcb = agent->request->cb;\n\t\t\tcb(agent, &err, agent->request->user_data);\n\t\t}\n\n\t\tdbus_error_free(&err);\n\n\t\tagent_cancel(agent);\n\t}\n\n\tg_free(agent->owner);\n\tg_free(agent->path);\n\n\tg_free(agent);\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_adapter_pincode_reply",
          "args": [
            "device->adapter",
            "&device->bdaddr",
            "pin",
            "pin ? strlen(pin) : 0"
          ],
          "line": 5930
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_pincode_reply",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "6726-6773",
          "snippet": "int btd_adapter_pincode_reply(struct btd_adapter *adapter,\n\t\t\t\t\tconst bdaddr_t *bdaddr,\n\t\t\t\t\tconst char *pin, size_t pin_len)\n{\n\tstruct btd_device *device;\n\tunsigned int id;\n\tchar addr[18];\n\n\tba2str(bdaddr, addr);\n\tDBG(\"hci%u addr %s pinlen %zu\", adapter->dev_id, addr, pin_len);\n\n\tif (pin == NULL) {\n\t\tstruct mgmt_cp_pin_code_neg_reply cp;\n\n\t\tmemset(&cp, 0, sizeof(cp));\n\t\tbacpy(&cp.addr.bdaddr, bdaddr);\n\t\tcp.addr.type = BDADDR_BREDR;\n\n\t\tid = mgmt_reply(adapter->mgmt, MGMT_OP_PIN_CODE_NEG_REPLY,\n\t\t\t\t\tadapter->dev_id, sizeof(cp), &cp,\n\t\t\t\t\tNULL, NULL, NULL);\n\t} else {\n\t\tstruct mgmt_cp_pin_code_reply cp;\n\n\t\tif (pin_len > 16)\n\t\t\treturn -EINVAL;\n\n\t\tmemset(&cp, 0, sizeof(cp));\n\t\tbacpy(&cp.addr.bdaddr, bdaddr);\n\t\tcp.addr.type = BDADDR_BREDR;\n\t\tcp.pin_len = pin_len;\n\t\tmemcpy(cp.pin_code, pin, pin_len);\n\n\t\t/* Since a pincode was requested, update the starting time to\n\t\t * the point where the pincode is provided. */\n\t\tdevice = btd_adapter_find_device(adapter, bdaddr, BDADDR_BREDR);\n\t\tdevice_bonding_restart_timer(device);\n\n\t\tid = mgmt_reply(adapter->mgmt, MGMT_OP_PIN_CODE_REPLY,\n\t\t\t\t\tadapter->dev_id, sizeof(cp), &cp,\n\t\t\t\t\tpincode_reply_complete, device, NULL);\n\t}\n\n\tif (id == 0)\n\t\treturn -EIO;\n\n\treturn 0;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nint btd_adapter_pincode_reply(struct btd_adapter *adapter,\n\t\t\t\t\tconst bdaddr_t *bdaddr,\n\t\t\t\t\tconst char *pin, size_t pin_len)\n{\n\tstruct btd_device *device;\n\tunsigned int id;\n\tchar addr[18];\n\n\tba2str(bdaddr, addr);\n\tDBG(\"hci%u addr %s pinlen %zu\", adapter->dev_id, addr, pin_len);\n\n\tif (pin == NULL) {\n\t\tstruct mgmt_cp_pin_code_neg_reply cp;\n\n\t\tmemset(&cp, 0, sizeof(cp));\n\t\tbacpy(&cp.addr.bdaddr, bdaddr);\n\t\tcp.addr.type = BDADDR_BREDR;\n\n\t\tid = mgmt_reply(adapter->mgmt, MGMT_OP_PIN_CODE_NEG_REPLY,\n\t\t\t\t\tadapter->dev_id, sizeof(cp), &cp,\n\t\t\t\t\tNULL, NULL, NULL);\n\t} else {\n\t\tstruct mgmt_cp_pin_code_reply cp;\n\n\t\tif (pin_len > 16)\n\t\t\treturn -EINVAL;\n\n\t\tmemset(&cp, 0, sizeof(cp));\n\t\tbacpy(&cp.addr.bdaddr, bdaddr);\n\t\tcp.addr.type = BDADDR_BREDR;\n\t\tcp.pin_len = pin_len;\n\t\tmemcpy(cp.pin_code, pin, pin_len);\n\n\t\t/* Since a pincode was requested, update the starting time to\n\t\t * the point where the pincode is provided. */\n\t\tdevice = btd_adapter_find_device(adapter, bdaddr, BDADDR_BREDR);\n\t\tdevice_bonding_restart_timer(device);\n\n\t\tid = mgmt_reply(adapter->mgmt, MGMT_OP_PIN_CODE_REPLY,\n\t\t\t\t\tadapter->dev_id, sizeof(cp), &cp,\n\t\t\t\t\tpincode_reply_complete, device, NULL);\n\t}\n\n\tif (id == 0)\n\t\treturn -EIO;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "pin"
          ],
          "line": 5931
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void pincode_cb(struct agent *agent, DBusError *err, const char *pin,\n\t\t\t\t\t\t\t\tvoid *data)\n{\n\tstruct authentication_req *auth = data;\n\tstruct btd_device *device = auth->device;\n\n\t/* No need to reply anything if the authentication already failed */\n\tif (auth->agent == NULL)\n\t\treturn;\n\n\tbtd_adapter_pincode_reply(device->adapter, &device->bdaddr,\n\t\t\t\t\t\tpin, pin ? strlen(pin) : 0);\n\n\tagent_unref(device->authr->agent);\n\tdevice->authr->agent = NULL;\n}"
  },
  {
    "function_name": "device_bonding_iter",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "5912-5918",
    "snippet": "struct btd_adapter_pin_cb_iter *device_bonding_iter(struct btd_device *device)\n{\n\tif (device->bonding == NULL)\n\t\treturn NULL;\n\n\treturn device->bonding->cb_iter;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstruct btd_adapter_pin_cb_iter *device_bonding_iter(struct btd_device *device)\n{\n\tif (device->bonding == NULL)\n\t\treturn NULL;\n\n\treturn device->bonding->cb_iter;\n}"
  },
  {
    "function_name": "device_bonding_failed",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "5893-5910",
    "snippet": "void device_bonding_failed(struct btd_device *device, uint8_t status)\n{\n\tstruct bonding_req *bonding = device->bonding;\n\tDBusMessage *reply;\n\n\tDBG(\"status %u\", status);\n\n\tif (!bonding)\n\t\treturn;\n\n\tif (device->authr)\n\t\tdevice_cancel_authentication(device, FALSE);\n\n\treply = new_authentication_return(bonding->msg, status);\n\tg_dbus_send_message(dbus_conn, reply);\n\n\tbonding_request_free(bonding);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static DBusConnection *dbus_conn = NULL;",
      "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
      "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);",
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "bonding_request_free",
          "args": [
            "bonding"
          ],
          "line": 5909
        },
        "resolved": true,
        "details": {
          "function_name": "bonding_request_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "2513-2540",
          "snippet": "static void bonding_request_free(struct bonding_req *bonding)\n{\n\tif (!bonding)\n\t\treturn;\n\n\tif (bonding->listener_id)\n\t\tg_dbus_remove_watch(dbus_conn, bonding->listener_id);\n\n\tif (bonding->msg)\n\t\tdbus_message_unref(bonding->msg);\n\n\tif (bonding->cb_iter)\n\t\tg_free(bonding->cb_iter);\n\n\tif (bonding->agent) {\n\t\tagent_cancel(bonding->agent);\n\t\tagent_unref(bonding->agent);\n\t\tbonding->agent = NULL;\n\t}\n\n\tif (bonding->retry_timer)\n\t\tg_source_remove(bonding->retry_timer);\n\n\tif (bonding->device)\n\t\tbonding->device->bonding = NULL;\n\n\tg_free(bonding);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *dbus_conn = NULL;",
            "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
            "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);",
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void bonding_request_free(struct bonding_req *bonding)\n{\n\tif (!bonding)\n\t\treturn;\n\n\tif (bonding->listener_id)\n\t\tg_dbus_remove_watch(dbus_conn, bonding->listener_id);\n\n\tif (bonding->msg)\n\t\tdbus_message_unref(bonding->msg);\n\n\tif (bonding->cb_iter)\n\t\tg_free(bonding->cb_iter);\n\n\tif (bonding->agent) {\n\t\tagent_cancel(bonding->agent);\n\t\tagent_unref(bonding->agent);\n\t\tbonding->agent = NULL;\n\t}\n\n\tif (bonding->retry_timer)\n\t\tg_source_remove(bonding->retry_timer);\n\n\tif (bonding->device)\n\t\tbonding->device->bonding = NULL;\n\n\tg_free(bonding);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_send_message",
          "args": [
            "dbus_conn",
            "reply"
          ],
          "line": 5907
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "new_authentication_return",
          "args": [
            "bonding->msg",
            "status"
          ],
          "line": 5906
        },
        "resolved": true,
        "details": {
          "function_name": "new_authentication_return",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "2620-2654",
          "snippet": "static DBusMessage *new_authentication_return(DBusMessage *msg, uint8_t status)\n{\n\tswitch (status) {\n\tcase MGMT_STATUS_SUCCESS:\n\t\treturn dbus_message_new_method_return(msg);\n\n\tcase MGMT_STATUS_CONNECT_FAILED:\n\t\treturn dbus_message_new_error(msg,\n\t\t\t\tERROR_INTERFACE \".ConnectionAttemptFailed\",\n\t\t\t\t\"Page Timeout\");\n\tcase MGMT_STATUS_TIMEOUT:\n\t\treturn dbus_message_new_error(msg,\n\t\t\t\tERROR_INTERFACE \".AuthenticationTimeout\",\n\t\t\t\t\"Authentication Timeout\");\n\tcase MGMT_STATUS_BUSY:\n\tcase MGMT_STATUS_REJECTED:\n\t\treturn dbus_message_new_error(msg,\n\t\t\t\tERROR_INTERFACE \".AuthenticationRejected\",\n\t\t\t\t\"Authentication Rejected\");\n\tcase MGMT_STATUS_CANCELLED:\n\tcase MGMT_STATUS_NO_RESOURCES:\n\tcase MGMT_STATUS_DISCONNECTED:\n\t\treturn dbus_message_new_error(msg,\n\t\t\t\tERROR_INTERFACE \".AuthenticationCanceled\",\n\t\t\t\t\"Authentication Canceled\");\n\tcase MGMT_STATUS_ALREADY_PAIRED:\n\t\treturn dbus_message_new_error(msg,\n\t\t\t\tERROR_INTERFACE \".AlreadyExists\",\n\t\t\t\t\"Already Paired\");\n\tdefault:\n\t\treturn dbus_message_new_error(msg,\n\t\t\t\tERROR_INTERFACE \".AuthenticationFailed\",\n\t\t\t\t\"Authentication Failed\");\n\t}\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
            "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\n\nstatic DBusMessage *new_authentication_return(DBusMessage *msg, uint8_t status)\n{\n\tswitch (status) {\n\tcase MGMT_STATUS_SUCCESS:\n\t\treturn dbus_message_new_method_return(msg);\n\n\tcase MGMT_STATUS_CONNECT_FAILED:\n\t\treturn dbus_message_new_error(msg,\n\t\t\t\tERROR_INTERFACE \".ConnectionAttemptFailed\",\n\t\t\t\t\"Page Timeout\");\n\tcase MGMT_STATUS_TIMEOUT:\n\t\treturn dbus_message_new_error(msg,\n\t\t\t\tERROR_INTERFACE \".AuthenticationTimeout\",\n\t\t\t\t\"Authentication Timeout\");\n\tcase MGMT_STATUS_BUSY:\n\tcase MGMT_STATUS_REJECTED:\n\t\treturn dbus_message_new_error(msg,\n\t\t\t\tERROR_INTERFACE \".AuthenticationRejected\",\n\t\t\t\t\"Authentication Rejected\");\n\tcase MGMT_STATUS_CANCELLED:\n\tcase MGMT_STATUS_NO_RESOURCES:\n\tcase MGMT_STATUS_DISCONNECTED:\n\t\treturn dbus_message_new_error(msg,\n\t\t\t\tERROR_INTERFACE \".AuthenticationCanceled\",\n\t\t\t\t\"Authentication Canceled\");\n\tcase MGMT_STATUS_ALREADY_PAIRED:\n\t\treturn dbus_message_new_error(msg,\n\t\t\t\tERROR_INTERFACE \".AlreadyExists\",\n\t\t\t\t\"Already Paired\");\n\tdefault:\n\t\treturn dbus_message_new_error(msg,\n\t\t\t\tERROR_INTERFACE \".AuthenticationFailed\",\n\t\t\t\t\"Authentication Failed\");\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "device_cancel_authentication",
          "args": [
            "device",
            "FALSE"
          ],
          "line": 5904
        },
        "resolved": true,
        "details": {
          "function_name": "device_cancel_authentication",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "6170-6188",
          "snippet": "void device_cancel_authentication(struct btd_device *device, gboolean aborted)\n{\n\tstruct authentication_req *auth = device->authr;\n\tchar addr[18];\n\n\tif (!auth)\n\t\treturn;\n\n\tba2str(&device->bdaddr, addr);\n\tDBG(\"Canceling authentication request for %s\", addr);\n\n\tif (auth->agent)\n\t\tagent_cancel(auth->agent);\n\n\tif (!aborted)\n\t\tcancel_authentication(auth);\n\n\tdevice_auth_req_free(device);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid device_cancel_authentication(struct btd_device *device, gboolean aborted)\n{\n\tstruct authentication_req *auth = device->authr;\n\tchar addr[18];\n\n\tif (!auth)\n\t\treturn;\n\n\tba2str(&device->bdaddr, addr);\n\tDBG(\"Canceling authentication request for %s\", addr);\n\n\tif (auth->agent)\n\t\tagent_cancel(auth->agent);\n\n\tif (!aborted)\n\t\tcancel_authentication(auth);\n\n\tdevice_auth_req_free(device);\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"status %u\"",
            "status"
          ],
          "line": 5898
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid device_bonding_failed(struct btd_device *device, uint8_t status)\n{\n\tstruct bonding_req *bonding = device->bonding;\n\tDBusMessage *reply;\n\n\tDBG(\"status %u\", status);\n\n\tif (!bonding)\n\t\treturn;\n\n\tif (device->authr)\n\t\tdevice_cancel_authentication(device, FALSE);\n\n\treply = new_authentication_return(bonding->msg, status);\n\tg_dbus_send_message(dbus_conn, reply);\n\n\tbonding_request_free(bonding);\n}"
  },
  {
    "function_name": "device_bonding_attempt_retry",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "5869-5891",
    "snippet": "int device_bonding_attempt_retry(struct btd_device *device)\n{\n\tstruct bonding_req *bonding = device->bonding;\n\n\t/* Ignore other failure events while retrying */\n\tif (device_is_retrying(device))\n\t\treturn 0;\n\n\tif (!bonding)\n\t\treturn -EINVAL;\n\n\t/* Mark the end of a bonding attempt to compute the delta for the\n\t * retry. */\n\tbonding_request_stop_timer(bonding);\n\n\tif (btd_adapter_pin_cb_iter_end(bonding->cb_iter))\n\t\treturn -EINVAL;\n\n\tDBG(\"scheduling retry\");\n\tbonding->retry_timer = g_timeout_add(3000,\n\t\t\t\t\t\tdevice_bonding_retry, device);\n\treturn 0;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_timeout_add",
          "args": [
            "3000",
            "device_bonding_retry",
            "device"
          ],
          "line": 5888
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"scheduling retry\""
          ],
          "line": 5887
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_adapter_pin_cb_iter_end",
          "args": [
            "bonding->cb_iter"
          ],
          "line": 5884
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_pin_cb_iter_end",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "6965-6968",
          "snippet": "bool btd_adapter_pin_cb_iter_end(struct btd_adapter_pin_cb_iter *iter)\n{\n\treturn iter->it == NULL && iter->attempt == 0;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nbool btd_adapter_pin_cb_iter_end(struct btd_adapter_pin_cb_iter *iter)\n{\n\treturn iter->it == NULL && iter->attempt == 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bonding_request_stop_timer",
          "args": [
            "bonding"
          ],
          "line": 5882
        },
        "resolved": true,
        "details": {
          "function_name": "bonding_request_stop_timer",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "2465-2476",
          "snippet": "static void bonding_request_stop_timer(struct bonding_req *bonding)\n{\n\tstruct timespec current;\n\n\tclock_gettime(CLOCK_MONOTONIC, &current);\n\n\t/* Compute the time difference in ms. */\n\tbonding->last_attempt_duration_ms =\n\t\t(current.tv_sec - bonding->attempt_start_time.tv_sec) * 1000L +\n\t\t(current.tv_nsec - bonding->attempt_start_time.tv_nsec)\n\t\t\t\t\t\t\t\t/ 1000000L;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void bonding_request_stop_timer(struct bonding_req *bonding)\n{\n\tstruct timespec current;\n\n\tclock_gettime(CLOCK_MONOTONIC, &current);\n\n\t/* Compute the time difference in ms. */\n\tbonding->last_attempt_duration_ms =\n\t\t(current.tv_sec - bonding->attempt_start_time.tv_sec) * 1000L +\n\t\t(current.tv_nsec - bonding->attempt_start_time.tv_nsec)\n\t\t\t\t\t\t\t\t/ 1000000L;\n}"
        }
      },
      {
        "call_info": {
          "callee": "device_is_retrying",
          "args": [
            "device"
          ],
          "line": 5874
        },
        "resolved": true,
        "details": {
          "function_name": "device_is_retrying",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5678-5683",
          "snippet": "bool device_is_retrying(struct btd_device *device)\n{\n\tstruct bonding_req *bonding = device->bonding;\n\n\treturn bonding && bonding->retry_timer > 0;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nbool device_is_retrying(struct btd_device *device)\n{\n\tstruct bonding_req *bonding = device->bonding;\n\n\treturn bonding && bonding->retry_timer > 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nint device_bonding_attempt_retry(struct btd_device *device)\n{\n\tstruct bonding_req *bonding = device->bonding;\n\n\t/* Ignore other failure events while retrying */\n\tif (device_is_retrying(device))\n\t\treturn 0;\n\n\tif (!bonding)\n\t\treturn -EINVAL;\n\n\t/* Mark the end of a bonding attempt to compute the delta for the\n\t * retry. */\n\tbonding_request_stop_timer(bonding);\n\n\tif (btd_adapter_pin_cb_iter_end(bonding->cb_iter))\n\t\treturn -EINVAL;\n\n\tDBG(\"scheduling retry\");\n\tbonding->retry_timer = g_timeout_add(3000,\n\t\t\t\t\t\tdevice_bonding_retry, device);\n\treturn 0;\n}"
  },
  {
    "function_name": "device_bonding_retry",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "5835-5867",
    "snippet": "static gboolean device_bonding_retry(gpointer data)\n{\n\tstruct btd_device *device = data;\n\tstruct btd_adapter *adapter = device_get_adapter(device);\n\tstruct bonding_req *bonding = device->bonding;\n\tuint8_t io_cap;\n\tint err;\n\n\tif (!bonding)\n\t\treturn FALSE;\n\n\tDBG(\"retrying bonding\");\n\tbonding->retry_timer = 0;\n\n\t/* Restart the bonding timer to the begining of the pairing. If not\n\t * pincode request/reply occurs during this retry,\n\t * device_bonding_last_duration() will return a consistent value from\n\t * this point. */\n\tdevice_bonding_restart_timer(device);\n\n\tif (bonding->agent)\n\t\tio_cap = agent_get_io_capability(bonding->agent);\n\telse\n\t\tio_cap = IO_CAPABILITY_NOINPUTNOOUTPUT;\n\n\terr = adapter_bonding_attempt(adapter, &device->bdaddr,\n\t\t\t\tdevice->bdaddr_type, io_cap);\n\tif (err < 0)\n\t\tdevice_bonding_complete(device, bonding->bdaddr_type,\n\t\t\t\t\t\t\tbonding->status);\n\n\treturn FALSE;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "device_bonding_complete",
          "args": [
            "device",
            "bonding->bdaddr_type",
            "bonding->status"
          ],
          "line": 5863
        },
        "resolved": true,
        "details": {
          "function_name": "device_bonding_complete",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5685-5756",
          "snippet": "void device_bonding_complete(struct btd_device *device, uint8_t bdaddr_type,\n\t\t\t\t\t\t\t\tuint8_t status)\n{\n\tstruct bonding_req *bonding = device->bonding;\n\tstruct authentication_req *auth = device->authr;\n\tstruct bearer_state *state = get_state(device, bdaddr_type);\n\n\tDBG(\"bonding %p status 0x%02x\", bonding, status);\n\n\tif (auth && auth->agent)\n\t\tagent_cancel(auth->agent);\n\n\tif (status) {\n\t\tdevice_cancel_authentication(device, TRUE);\n\t\tdevice_bonding_failed(device, status);\n\t\treturn;\n\t}\n\n\tdevice_auth_req_free(device);\n\n\t/* If we're already paired nothing more is needed */\n\tif (state->paired)\n\t\treturn;\n\n\tdevice_set_paired(device, bdaddr_type);\n\n\t/* If services are already resolved just reply to the pairing\n\t * request\n\t */\n\tif (state->svc_resolved && bonding) {\n\t\t/* Attept to store services for this device failed because it\n\t\t * was not paired. Now that we're paired retry. */\n\t\tstore_gatt_db(device);\n\n\t\tg_dbus_send_reply(dbus_conn, bonding->msg, DBUS_TYPE_INVALID);\n\t\tbonding_request_free(bonding);\n\t\treturn;\n\t}\n\n\t/* If we were initiators start service discovery immediately.\n\t * However if the other end was the initator wait a few seconds\n\t * before SDP. This is due to potential IOP issues if the other\n\t * end starts doing SDP at the same time as us */\n\tif (bonding) {\n\t\tDBG(\"Proceeding with service discovery\");\n\t\t/* If we are initiators remove any discovery timer and just\n\t\t * start discovering services directly */\n\t\tif (device->discov_timer) {\n\t\t\tg_source_remove(device->discov_timer);\n\t\t\tdevice->discov_timer = 0;\n\t\t}\n\n\t\tif (bdaddr_type == BDADDR_BREDR)\n\t\t\tdevice_browse_sdp(device, bonding->msg);\n\t\telse\n\t\t\tdevice_browse_gatt(device, bonding->msg);\n\n\t\tbonding_request_free(bonding);\n\t} else if (!state->svc_resolved) {\n\t\tif (!device->browse && !device->discov_timer &&\n\t\t\t\tmain_opts.reverse_sdp) {\n\t\t\t/* If we are not initiators and there is no currently\n\t\t\t * active discovery or discovery timer, set discovery\n\t\t\t * timer */\n\t\t\tDBG(\"setting timer for reverse service discovery\");\n\t\t\tdevice->discov_timer = g_timeout_add_seconds(\n\t\t\t\t\t\t\tDISCOVERY_TIMER,\n\t\t\t\t\t\t\tstart_discovery,\n\t\t\t\t\t\t\tdevice);\n\t\t}\n\t}\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define DISCOVERY_TIMER\t\t1"
          ],
          "globals_used": [
            "static DBusConnection *dbus_conn = NULL;",
            "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
            "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);",
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\n#define DISCOVERY_TIMER\t\t1\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid device_bonding_complete(struct btd_device *device, uint8_t bdaddr_type,\n\t\t\t\t\t\t\t\tuint8_t status)\n{\n\tstruct bonding_req *bonding = device->bonding;\n\tstruct authentication_req *auth = device->authr;\n\tstruct bearer_state *state = get_state(device, bdaddr_type);\n\n\tDBG(\"bonding %p status 0x%02x\", bonding, status);\n\n\tif (auth && auth->agent)\n\t\tagent_cancel(auth->agent);\n\n\tif (status) {\n\t\tdevice_cancel_authentication(device, TRUE);\n\t\tdevice_bonding_failed(device, status);\n\t\treturn;\n\t}\n\n\tdevice_auth_req_free(device);\n\n\t/* If we're already paired nothing more is needed */\n\tif (state->paired)\n\t\treturn;\n\n\tdevice_set_paired(device, bdaddr_type);\n\n\t/* If services are already resolved just reply to the pairing\n\t * request\n\t */\n\tif (state->svc_resolved && bonding) {\n\t\t/* Attept to store services for this device failed because it\n\t\t * was not paired. Now that we're paired retry. */\n\t\tstore_gatt_db(device);\n\n\t\tg_dbus_send_reply(dbus_conn, bonding->msg, DBUS_TYPE_INVALID);\n\t\tbonding_request_free(bonding);\n\t\treturn;\n\t}\n\n\t/* If we were initiators start service discovery immediately.\n\t * However if the other end was the initator wait a few seconds\n\t * before SDP. This is due to potential IOP issues if the other\n\t * end starts doing SDP at the same time as us */\n\tif (bonding) {\n\t\tDBG(\"Proceeding with service discovery\");\n\t\t/* If we are initiators remove any discovery timer and just\n\t\t * start discovering services directly */\n\t\tif (device->discov_timer) {\n\t\t\tg_source_remove(device->discov_timer);\n\t\t\tdevice->discov_timer = 0;\n\t\t}\n\n\t\tif (bdaddr_type == BDADDR_BREDR)\n\t\t\tdevice_browse_sdp(device, bonding->msg);\n\t\telse\n\t\t\tdevice_browse_gatt(device, bonding->msg);\n\n\t\tbonding_request_free(bonding);\n\t} else if (!state->svc_resolved) {\n\t\tif (!device->browse && !device->discov_timer &&\n\t\t\t\tmain_opts.reverse_sdp) {\n\t\t\t/* If we are not initiators and there is no currently\n\t\t\t * active discovery or discovery timer, set discovery\n\t\t\t * timer */\n\t\t\tDBG(\"setting timer for reverse service discovery\");\n\t\t\tdevice->discov_timer = g_timeout_add_seconds(\n\t\t\t\t\t\t\tDISCOVERY_TIMER,\n\t\t\t\t\t\t\tstart_discovery,\n\t\t\t\t\t\t\tdevice);\n\t\t}\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "adapter_bonding_attempt",
          "args": [
            "adapter",
            "&device->bdaddr",
            "device->bdaddr_type",
            "io_cap"
          ],
          "line": 5860
        },
        "resolved": true,
        "details": {
          "function_name": "adapter_bonding_attempt",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "7236-7283",
          "snippet": "int adapter_bonding_attempt(struct btd_adapter *adapter, const bdaddr_t *bdaddr,\n\t\t\t\t\tuint8_t addr_type, uint8_t io_cap)\n{\n\tstruct mgmt_cp_pair_device cp;\n\tchar addr[18];\n\tstruct pair_device_data *data;\n\tunsigned int id;\n\n\tba2str(bdaddr, addr);\n\tDBG(\"hci%u bdaddr %s type %d io_cap 0x%02x\",\n\t\t\t\tadapter->dev_id, addr, addr_type, io_cap);\n\n\t/* Reset the pincode_requested flag for a new bonding attempt. */\n\tadapter->pincode_requested = false;\n\n\tmemset(&cp, 0, sizeof(cp));\n\tbacpy(&cp.addr.bdaddr, bdaddr);\n\tcp.addr.type = addr_type;\n\tcp.io_cap = io_cap;\n\n\tdata = g_new0(struct pair_device_data, 1);\n\tdata->adapter = adapter;\n\tbacpy(&data->bdaddr, bdaddr);\n\tdata->addr_type = addr_type;\n\n\tid = mgmt_send(adapter->mgmt, MGMT_OP_PAIR_DEVICE,\n\t\t\t\tadapter->dev_id, sizeof(cp), &cp,\n\t\t\t\tpair_device_complete, data,\n\t\t\t\tfree_pair_device_data);\n\n\tif (id == 0) {\n\t\tbtd_error(adapter->dev_id, \"Failed to pair %s for hci%u\",\n\t\t\t\t\t\t\taddr, adapter->dev_id);\n\t\tfree_pair_device_data(data);\n\t\treturn -EIO;\n\t}\n\n\tadapter->pair_device_id = id;\n\n\t/* Due to a bug in the kernel it is possible that a LE pairing\n\t * request never times out. Therefore, add a timer to clean up\n\t * if no response arrives\n\t */\n\tadapter->pair_device_timeout = g_timeout_add_seconds(BONDING_TIMEOUT,\n\t\t\t\t\t\tpair_device_timeout, data);\n\n\treturn 0;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define BONDING_TIMEOUT (2 * 60)"
          ],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\n#define BONDING_TIMEOUT (2 * 60)\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nint adapter_bonding_attempt(struct btd_adapter *adapter, const bdaddr_t *bdaddr,\n\t\t\t\t\tuint8_t addr_type, uint8_t io_cap)\n{\n\tstruct mgmt_cp_pair_device cp;\n\tchar addr[18];\n\tstruct pair_device_data *data;\n\tunsigned int id;\n\n\tba2str(bdaddr, addr);\n\tDBG(\"hci%u bdaddr %s type %d io_cap 0x%02x\",\n\t\t\t\tadapter->dev_id, addr, addr_type, io_cap);\n\n\t/* Reset the pincode_requested flag for a new bonding attempt. */\n\tadapter->pincode_requested = false;\n\n\tmemset(&cp, 0, sizeof(cp));\n\tbacpy(&cp.addr.bdaddr, bdaddr);\n\tcp.addr.type = addr_type;\n\tcp.io_cap = io_cap;\n\n\tdata = g_new0(struct pair_device_data, 1);\n\tdata->adapter = adapter;\n\tbacpy(&data->bdaddr, bdaddr);\n\tdata->addr_type = addr_type;\n\n\tid = mgmt_send(adapter->mgmt, MGMT_OP_PAIR_DEVICE,\n\t\t\t\tadapter->dev_id, sizeof(cp), &cp,\n\t\t\t\tpair_device_complete, data,\n\t\t\t\tfree_pair_device_data);\n\n\tif (id == 0) {\n\t\tbtd_error(adapter->dev_id, \"Failed to pair %s for hci%u\",\n\t\t\t\t\t\t\taddr, adapter->dev_id);\n\t\tfree_pair_device_data(data);\n\t\treturn -EIO;\n\t}\n\n\tadapter->pair_device_id = id;\n\n\t/* Due to a bug in the kernel it is possible that a LE pairing\n\t * request never times out. Therefore, add a timer to clean up\n\t * if no response arrives\n\t */\n\tadapter->pair_device_timeout = g_timeout_add_seconds(BONDING_TIMEOUT,\n\t\t\t\t\t\tpair_device_timeout, data);\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "agent_get_io_capability",
          "args": [
            "bonding->agent"
          ],
          "line": 5856
        },
        "resolved": true,
        "details": {
          "function_name": "agent_get_io_capability",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "900-903",
          "snippet": "uint8_t agent_get_io_capability(struct agent *agent)\n{\n\treturn agent->capability;\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nuint8_t agent_get_io_capability(struct agent *agent)\n{\n\treturn agent->capability;\n}"
        }
      },
      {
        "call_info": {
          "callee": "device_bonding_restart_timer",
          "args": [
            "device"
          ],
          "line": 5853
        },
        "resolved": true,
        "details": {
          "function_name": "device_bonding_restart_timer",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "2457-2463",
          "snippet": "void device_bonding_restart_timer(struct btd_device *device)\n{\n\tif (!device || !device->bonding)\n\t\treturn;\n\n\tclock_gettime(CLOCK_MONOTONIC, &device->bonding->attempt_start_time);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid device_bonding_restart_timer(struct btd_device *device)\n{\n\tif (!device || !device->bonding)\n\t\treturn;\n\n\tclock_gettime(CLOCK_MONOTONIC, &device->bonding->attempt_start_time);\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"retrying bonding\""
          ],
          "line": 5846
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device_get_adapter",
          "args": [
            "device"
          ],
          "line": 5838
        },
        "resolved": true,
        "details": {
          "function_name": "device_get_adapter",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5306-5312",
          "snippet": "struct btd_adapter *device_get_adapter(struct btd_device *device)\n{\n\tif (!device)\n\t\treturn NULL;\n\n\treturn device->adapter;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstruct btd_adapter *device_get_adapter(struct btd_device *device)\n{\n\tif (!device)\n\t\treturn NULL;\n\n\treturn device->adapter;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic gboolean device_bonding_retry(gpointer data)\n{\n\tstruct btd_device *device = data;\n\tstruct btd_adapter *adapter = device_get_adapter(device);\n\tstruct bonding_req *bonding = device->bonding;\n\tuint8_t io_cap;\n\tint err;\n\n\tif (!bonding)\n\t\treturn FALSE;\n\n\tDBG(\"retrying bonding\");\n\tbonding->retry_timer = 0;\n\n\t/* Restart the bonding timer to the begining of the pairing. If not\n\t * pincode request/reply occurs during this retry,\n\t * device_bonding_last_duration() will return a consistent value from\n\t * this point. */\n\tdevice_bonding_restart_timer(device);\n\n\tif (bonding->agent)\n\t\tio_cap = agent_get_io_capability(bonding->agent);\n\telse\n\t\tio_cap = IO_CAPABILITY_NOINPUTNOOUTPUT;\n\n\terr = adapter_bonding_attempt(adapter, &device->bdaddr,\n\t\t\t\tdevice->bdaddr_type, io_cap);\n\tif (err < 0)\n\t\tdevice_bonding_complete(device, bonding->bdaddr_type,\n\t\t\t\t\t\t\tbonding->status);\n\n\treturn FALSE;\n}"
  },
  {
    "function_name": "device_is_bonding",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "5822-5833",
    "snippet": "gboolean device_is_bonding(struct btd_device *device, const char *sender)\n{\n\tstruct bonding_req *bonding = device->bonding;\n\n\tif (!device->bonding)\n\t\treturn FALSE;\n\n\tif (!sender)\n\t\treturn TRUE;\n\n\treturn g_str_equal(sender, dbus_message_get_sender(bonding->msg));\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
      "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);",
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_str_equal",
          "args": [
            "sender",
            "dbus_message_get_sender(bonding->msg)"
          ],
          "line": 5832
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_get_sender",
          "args": [
            "bonding->msg"
          ],
          "line": 5832
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\nstatic void gatt_client_init(struct btd_device *device);\n\ngboolean device_is_bonding(struct btd_device *device, const char *sender)\n{\n\tstruct bonding_req *bonding = device->bonding;\n\n\tif (!device->bonding)\n\t\treturn FALSE;\n\n\tif (!sender)\n\t\treturn TRUE;\n\n\treturn g_str_equal(sender, dbus_message_get_sender(bonding->msg));\n}"
  },
  {
    "function_name": "device_remove_svc_complete_callback",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "5799-5820",
    "snippet": "bool device_remove_svc_complete_callback(struct btd_device *dev,\n\t\t\t\t\t\t\tunsigned int id)\n{\n\tGSList *l;\n\n\tfor (l = dev->svc_callbacks; l != NULL; l = g_slist_next(l)) {\n\t\tstruct svc_callback *cb = l->data;\n\n\t\tif (cb->id != id)\n\t\t\tcontinue;\n\n\t\tif (cb->idle_id > 0)\n\t\t\tg_source_remove(cb->idle_id);\n\n\t\tdev->svc_callbacks = g_slist_remove(dev->svc_callbacks, cb);\n\t\tg_free(cb);\n\n\t\treturn true;\n\t}\n\n\treturn false;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "cb"
          ],
          "line": 5814
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_remove",
          "args": [
            "dev->svc_callbacks",
            "cb"
          ],
          "line": 5813
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_source_remove",
          "args": [
            "cb->idle_id"
          ],
          "line": 5811
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_next",
          "args": [
            "l"
          ],
          "line": 5804
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nbool device_remove_svc_complete_callback(struct btd_device *dev,\n\t\t\t\t\t\t\tunsigned int id)\n{\n\tGSList *l;\n\n\tfor (l = dev->svc_callbacks; l != NULL; l = g_slist_next(l)) {\n\t\tstruct svc_callback *cb = l->data;\n\n\t\tif (cb->id != id)\n\t\t\tcontinue;\n\n\t\tif (cb->idle_id > 0)\n\t\t\tg_source_remove(cb->idle_id);\n\n\t\tdev->svc_callbacks = g_slist_remove(dev->svc_callbacks, cb);\n\t\tg_free(cb);\n\n\t\treturn true;\n\t}\n\n\treturn false;\n}"
  },
  {
    "function_name": "device_wait_for_svc_complete",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "5772-5797",
    "snippet": "unsigned int device_wait_for_svc_complete(struct btd_device *dev,\n\t\t\t\t\t\t\tdevice_svc_cb_t func,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\t/* This API is only used for BR/EDR (for now) */\n\tstruct bearer_state *state = &dev->bredr_state;\n\tstatic unsigned int id = 0;\n\tstruct svc_callback *cb;\n\n\tcb = g_new0(struct svc_callback, 1);\n\tcb->func = func;\n\tcb->user_data = user_data;\n\tcb->dev = dev;\n\tcb->id = ++id;\n\n\tdev->svc_callbacks = g_slist_prepend(dev->svc_callbacks, cb);\n\n\tif (state->svc_resolved || !main_opts.reverse_sdp)\n\t\tcb->idle_id = g_idle_add(svc_idle_cb, cb);\n\telse if (dev->discov_timer > 0) {\n\t\tg_source_remove(dev->discov_timer);\n\t\tdev->discov_timer = g_idle_add(start_discovery, dev);\n\t}\n\n\treturn cb->id;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_idle_add",
          "args": [
            "start_discovery",
            "dev"
          ],
          "line": 5793
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_source_remove",
          "args": [
            "dev->discov_timer"
          ],
          "line": 5792
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_idle_add",
          "args": [
            "svc_idle_cb",
            "cb"
          ],
          "line": 5790
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_prepend",
          "args": [
            "dev->svc_callbacks",
            "cb"
          ],
          "line": 5787
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_new0",
          "args": [
            "structsvc_callback",
            "1"
          ],
          "line": 5781
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nunsigned int device_wait_for_svc_complete(struct btd_device *dev,\n\t\t\t\t\t\t\tdevice_svc_cb_t func,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\t/* This API is only used for BR/EDR (for now) */\n\tstruct bearer_state *state = &dev->bredr_state;\n\tstatic unsigned int id = 0;\n\tstruct svc_callback *cb;\n\n\tcb = g_new0(struct svc_callback, 1);\n\tcb->func = func;\n\tcb->user_data = user_data;\n\tcb->dev = dev;\n\tcb->id = ++id;\n\n\tdev->svc_callbacks = g_slist_prepend(dev->svc_callbacks, cb);\n\n\tif (state->svc_resolved || !main_opts.reverse_sdp)\n\t\tcb->idle_id = g_idle_add(svc_idle_cb, cb);\n\telse if (dev->discov_timer > 0) {\n\t\tg_source_remove(dev->discov_timer);\n\t\tdev->discov_timer = g_idle_add(start_discovery, dev);\n\t}\n\n\treturn cb->id;\n}"
  },
  {
    "function_name": "svc_idle_cb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "5758-5770",
    "snippet": "static gboolean svc_idle_cb(gpointer user_data)\n{\n\tstruct svc_callback *cb = user_data;\n\tstruct btd_device *dev = cb->dev;\n\n\tdev->svc_callbacks = g_slist_remove(dev->svc_callbacks, cb);\n\n\tcb->func(cb->dev, 0, cb->user_data);\n\n\tg_free(cb);\n\n\treturn FALSE;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "cb"
          ],
          "line": 5767
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "cb->func",
          "args": [
            "cb->dev",
            "0",
            "cb->user_data"
          ],
          "line": 5765
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_remove",
          "args": [
            "dev->svc_callbacks",
            "cb"
          ],
          "line": 5763
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic gboolean svc_idle_cb(gpointer user_data)\n{\n\tstruct svc_callback *cb = user_data;\n\tstruct btd_device *dev = cb->dev;\n\n\tdev->svc_callbacks = g_slist_remove(dev->svc_callbacks, cb);\n\n\tcb->func(cb->dev, 0, cb->user_data);\n\n\tg_free(cb);\n\n\treturn FALSE;\n}"
  },
  {
    "function_name": "device_bonding_complete",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "5685-5756",
    "snippet": "void device_bonding_complete(struct btd_device *device, uint8_t bdaddr_type,\n\t\t\t\t\t\t\t\tuint8_t status)\n{\n\tstruct bonding_req *bonding = device->bonding;\n\tstruct authentication_req *auth = device->authr;\n\tstruct bearer_state *state = get_state(device, bdaddr_type);\n\n\tDBG(\"bonding %p status 0x%02x\", bonding, status);\n\n\tif (auth && auth->agent)\n\t\tagent_cancel(auth->agent);\n\n\tif (status) {\n\t\tdevice_cancel_authentication(device, TRUE);\n\t\tdevice_bonding_failed(device, status);\n\t\treturn;\n\t}\n\n\tdevice_auth_req_free(device);\n\n\t/* If we're already paired nothing more is needed */\n\tif (state->paired)\n\t\treturn;\n\n\tdevice_set_paired(device, bdaddr_type);\n\n\t/* If services are already resolved just reply to the pairing\n\t * request\n\t */\n\tif (state->svc_resolved && bonding) {\n\t\t/* Attept to store services for this device failed because it\n\t\t * was not paired. Now that we're paired retry. */\n\t\tstore_gatt_db(device);\n\n\t\tg_dbus_send_reply(dbus_conn, bonding->msg, DBUS_TYPE_INVALID);\n\t\tbonding_request_free(bonding);\n\t\treturn;\n\t}\n\n\t/* If we were initiators start service discovery immediately.\n\t * However if the other end was the initator wait a few seconds\n\t * before SDP. This is due to potential IOP issues if the other\n\t * end starts doing SDP at the same time as us */\n\tif (bonding) {\n\t\tDBG(\"Proceeding with service discovery\");\n\t\t/* If we are initiators remove any discovery timer and just\n\t\t * start discovering services directly */\n\t\tif (device->discov_timer) {\n\t\t\tg_source_remove(device->discov_timer);\n\t\t\tdevice->discov_timer = 0;\n\t\t}\n\n\t\tif (bdaddr_type == BDADDR_BREDR)\n\t\t\tdevice_browse_sdp(device, bonding->msg);\n\t\telse\n\t\t\tdevice_browse_gatt(device, bonding->msg);\n\n\t\tbonding_request_free(bonding);\n\t} else if (!state->svc_resolved) {\n\t\tif (!device->browse && !device->discov_timer &&\n\t\t\t\tmain_opts.reverse_sdp) {\n\t\t\t/* If we are not initiators and there is no currently\n\t\t\t * active discovery or discovery timer, set discovery\n\t\t\t * timer */\n\t\t\tDBG(\"setting timer for reverse service discovery\");\n\t\t\tdevice->discov_timer = g_timeout_add_seconds(\n\t\t\t\t\t\t\tDISCOVERY_TIMER,\n\t\t\t\t\t\t\tstart_discovery,\n\t\t\t\t\t\t\tdevice);\n\t\t}\n\t}\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define DISCOVERY_TIMER\t\t1"
    ],
    "globals_used": [
      "static DBusConnection *dbus_conn = NULL;",
      "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
      "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);",
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_timeout_add_seconds",
          "args": [
            "DISCOVERY_TIMER",
            "start_discovery",
            "device"
          ],
          "line": 5750
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"setting timer for reverse service discovery\""
          ],
          "line": 5749
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bonding_request_free",
          "args": [
            "bonding"
          ],
          "line": 5742
        },
        "resolved": true,
        "details": {
          "function_name": "bonding_request_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "2513-2540",
          "snippet": "static void bonding_request_free(struct bonding_req *bonding)\n{\n\tif (!bonding)\n\t\treturn;\n\n\tif (bonding->listener_id)\n\t\tg_dbus_remove_watch(dbus_conn, bonding->listener_id);\n\n\tif (bonding->msg)\n\t\tdbus_message_unref(bonding->msg);\n\n\tif (bonding->cb_iter)\n\t\tg_free(bonding->cb_iter);\n\n\tif (bonding->agent) {\n\t\tagent_cancel(bonding->agent);\n\t\tagent_unref(bonding->agent);\n\t\tbonding->agent = NULL;\n\t}\n\n\tif (bonding->retry_timer)\n\t\tg_source_remove(bonding->retry_timer);\n\n\tif (bonding->device)\n\t\tbonding->device->bonding = NULL;\n\n\tg_free(bonding);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *dbus_conn = NULL;",
            "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
            "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);",
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void bonding_request_free(struct bonding_req *bonding)\n{\n\tif (!bonding)\n\t\treturn;\n\n\tif (bonding->listener_id)\n\t\tg_dbus_remove_watch(dbus_conn, bonding->listener_id);\n\n\tif (bonding->msg)\n\t\tdbus_message_unref(bonding->msg);\n\n\tif (bonding->cb_iter)\n\t\tg_free(bonding->cb_iter);\n\n\tif (bonding->agent) {\n\t\tagent_cancel(bonding->agent);\n\t\tagent_unref(bonding->agent);\n\t\tbonding->agent = NULL;\n\t}\n\n\tif (bonding->retry_timer)\n\t\tg_source_remove(bonding->retry_timer);\n\n\tif (bonding->device)\n\t\tbonding->device->bonding = NULL;\n\n\tg_free(bonding);\n}"
        }
      },
      {
        "call_info": {
          "callee": "device_browse_gatt",
          "args": [
            "device",
            "bonding->msg"
          ],
          "line": 5740
        },
        "resolved": true,
        "details": {
          "function_name": "device_browse_gatt",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5192-5236",
          "snippet": "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg)\n{\n\tstruct btd_adapter *adapter = device->adapter;\n\tstruct browse_req *req;\n\n\treq = browse_request_new(device, BROWSE_GATT, msg);\n\tif (!req)\n\t\treturn -EBUSY;\n\n\tif (device->client) {\n\t\t/*\n\t\t * If discovery has not yet completed, then wait for gatt-client\n\t\t * to become ready.\n\t\t */\n\t\tif (!bt_gatt_client_is_ready(device->client))\n\t\t\treturn 0;\n\n\t\t/*\n\t\t * Services have already been discovered, so signal this browse\n\t\t * request as resolved.\n\t\t */\n\t\tdevice_svc_resolved(device, BROWSE_GATT, device->bdaddr_type,\n\t\t\t\t\t\t\t\t\t0);\n\t\treturn 0;\n\t}\n\n\tdevice->att_io = bt_io_connect(att_connect_cb,\n\t\t\t\tdevice, NULL, NULL,\n\t\t\t\tBT_IO_OPT_SOURCE_BDADDR,\n\t\t\t\tbtd_adapter_get_address(adapter),\n\t\t\t\tBT_IO_OPT_SOURCE_TYPE,\n\t\t\t\tbtd_adapter_get_address_type(adapter),\n\t\t\t\tBT_IO_OPT_DEST_BDADDR, &device->bdaddr,\n\t\t\t\tBT_IO_OPT_DEST_TYPE, device->bdaddr_type,\n\t\t\t\tBT_IO_OPT_CID, ATT_CID,\n\t\t\t\tBT_IO_OPT_SEC_LEVEL, BT_IO_SEC_LOW,\n\t\t\t\tBT_IO_OPT_INVALID);\n\n\tif (device->att_io == NULL) {\n\t\tbrowse_request_free(req);\n\t\treturn -EIO;\n\t}\n\n\treturn 0;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
            "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);",
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg)\n{\n\tstruct btd_adapter *adapter = device->adapter;\n\tstruct browse_req *req;\n\n\treq = browse_request_new(device, BROWSE_GATT, msg);\n\tif (!req)\n\t\treturn -EBUSY;\n\n\tif (device->client) {\n\t\t/*\n\t\t * If discovery has not yet completed, then wait for gatt-client\n\t\t * to become ready.\n\t\t */\n\t\tif (!bt_gatt_client_is_ready(device->client))\n\t\t\treturn 0;\n\n\t\t/*\n\t\t * Services have already been discovered, so signal this browse\n\t\t * request as resolved.\n\t\t */\n\t\tdevice_svc_resolved(device, BROWSE_GATT, device->bdaddr_type,\n\t\t\t\t\t\t\t\t\t0);\n\t\treturn 0;\n\t}\n\n\tdevice->att_io = bt_io_connect(att_connect_cb,\n\t\t\t\tdevice, NULL, NULL,\n\t\t\t\tBT_IO_OPT_SOURCE_BDADDR,\n\t\t\t\tbtd_adapter_get_address(adapter),\n\t\t\t\tBT_IO_OPT_SOURCE_TYPE,\n\t\t\t\tbtd_adapter_get_address_type(adapter),\n\t\t\t\tBT_IO_OPT_DEST_BDADDR, &device->bdaddr,\n\t\t\t\tBT_IO_OPT_DEST_TYPE, device->bdaddr_type,\n\t\t\t\tBT_IO_OPT_CID, ATT_CID,\n\t\t\t\tBT_IO_OPT_SEC_LEVEL, BT_IO_SEC_LOW,\n\t\t\t\tBT_IO_OPT_INVALID);\n\n\tif (device->att_io == NULL) {\n\t\tbrowse_request_free(req);\n\t\treturn -EIO;\n\t}\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "device_browse_sdp",
          "args": [
            "device",
            "bonding->msg"
          ],
          "line": 5738
        },
        "resolved": true,
        "details": {
          "function_name": "device_browse_sdp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5263-5287",
          "snippet": "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg)\n{\n\tstruct btd_adapter *adapter = device->adapter;\n\tstruct browse_req *req;\n\tuuid_t uuid;\n\tint err;\n\n\treq = browse_request_new(device, BROWSE_SDP, msg);\n\tif (!req)\n\t\treturn -EBUSY;\n\n\tsdp_uuid16_create(&uuid, uuid_list[req->search_uuid++]);\n\n\treq->sdp_flags = get_sdp_flags(device);\n\n\terr = bt_search_service(btd_adapter_get_address(adapter),\n\t\t\t\t&device->bdaddr, &uuid, browse_cb, req, NULL,\n\t\t\t\treq->sdp_flags);\n\tif (err < 0) {\n\t\tbrowse_request_free(req);\n\t\treturn err;\n\t}\n\n\treturn err;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static const uint16_t uuid_list[] = {\n\tL2CAP_UUID,\n\tPNP_INFO_SVCLASS_ID,\n\tPUBLIC_BROWSE_GROUP,\n\t0\n};",
            "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
            "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);",
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic const uint16_t uuid_list[] = {\n\tL2CAP_UUID,\n\tPNP_INFO_SVCLASS_ID,\n\tPUBLIC_BROWSE_GROUP,\n\t0\n};\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg)\n{\n\tstruct btd_adapter *adapter = device->adapter;\n\tstruct browse_req *req;\n\tuuid_t uuid;\n\tint err;\n\n\treq = browse_request_new(device, BROWSE_SDP, msg);\n\tif (!req)\n\t\treturn -EBUSY;\n\n\tsdp_uuid16_create(&uuid, uuid_list[req->search_uuid++]);\n\n\treq->sdp_flags = get_sdp_flags(device);\n\n\terr = bt_search_service(btd_adapter_get_address(adapter),\n\t\t\t\t&device->bdaddr, &uuid, browse_cb, req, NULL,\n\t\t\t\treq->sdp_flags);\n\tif (err < 0) {\n\t\tbrowse_request_free(req);\n\t\treturn err;\n\t}\n\n\treturn err;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_source_remove",
          "args": [
            "device->discov_timer"
          ],
          "line": 5733
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Proceeding with service discovery\""
          ],
          "line": 5729
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_send_reply",
          "args": [
            "dbus_conn",
            "bonding->msg",
            "DBUS_TYPE_INVALID"
          ],
          "line": 5719
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "store_gatt_db",
          "args": [
            "device"
          ],
          "line": 5717
        },
        "resolved": true,
        "details": {
          "function_name": "store_gatt_db",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "2254-2295",
          "snippet": "static void store_gatt_db(struct btd_device *device)\n{\n\tchar filename[PATH_MAX];\n\tchar dst_addr[18];\n\tGKeyFile *key_file;\n\tchar *data;\n\tgsize length = 0;\n\tstruct gatt_saver saver;\n\n\tif (device_address_is_private(device)) {\n\t\tDBG(\"Can't store GATT db for private addressed device %s\",\n\t\t\t\t\t\t\t\tdevice->path);\n\t\treturn;\n\t}\n\n\tif (!gatt_cache_is_enabled(device))\n\t\treturn;\n\n\tba2str(&device->bdaddr, dst_addr);\n\n\tsnprintf(filename, PATH_MAX, STORAGEDIR \"/%s/cache/%s\",\n\t\t\t\tbtd_adapter_get_storage_dir(device->adapter),\n\t\t\t\tdst_addr);\n\tcreate_file(filename, S_IRUSR | S_IWUSR);\n\n\tkey_file = g_key_file_new();\n\tg_key_file_load_from_file(key_file, filename, 0, NULL);\n\n\t/* Remove current attributes since it might have changed */\n\tg_key_file_remove_group(key_file, \"Attributes\", NULL);\n\n\tsaver.key_file = key_file;\n\tsaver.device = device;\n\n\tgatt_db_foreach_service(device->db, NULL, store_service, &saver);\n\n\tdata = g_key_file_to_data(key_file, &length, NULL);\n\tg_file_set_contents(filename, data, length, NULL);\n\n\tg_free(data);\n\tg_key_file_free(key_file);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void store_gatt_db(struct btd_device *device)\n{\n\tchar filename[PATH_MAX];\n\tchar dst_addr[18];\n\tGKeyFile *key_file;\n\tchar *data;\n\tgsize length = 0;\n\tstruct gatt_saver saver;\n\n\tif (device_address_is_private(device)) {\n\t\tDBG(\"Can't store GATT db for private addressed device %s\",\n\t\t\t\t\t\t\t\tdevice->path);\n\t\treturn;\n\t}\n\n\tif (!gatt_cache_is_enabled(device))\n\t\treturn;\n\n\tba2str(&device->bdaddr, dst_addr);\n\n\tsnprintf(filename, PATH_MAX, STORAGEDIR \"/%s/cache/%s\",\n\t\t\t\tbtd_adapter_get_storage_dir(device->adapter),\n\t\t\t\tdst_addr);\n\tcreate_file(filename, S_IRUSR | S_IWUSR);\n\n\tkey_file = g_key_file_new();\n\tg_key_file_load_from_file(key_file, filename, 0, NULL);\n\n\t/* Remove current attributes since it might have changed */\n\tg_key_file_remove_group(key_file, \"Attributes\", NULL);\n\n\tsaver.key_file = key_file;\n\tsaver.device = device;\n\n\tgatt_db_foreach_service(device->db, NULL, store_service, &saver);\n\n\tdata = g_key_file_to_data(key_file, &length, NULL);\n\tg_file_set_contents(filename, data, length, NULL);\n\n\tg_free(data);\n\tg_key_file_free(key_file);\n}"
        }
      },
      {
        "call_info": {
          "callee": "device_set_paired",
          "args": [
            "device",
            "bdaddr_type"
          ],
          "line": 5709
        },
        "resolved": true,
        "details": {
          "function_name": "device_set_paired",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5606-5628",
          "snippet": "void device_set_paired(struct btd_device *dev, uint8_t bdaddr_type)\n{\n\tstruct bearer_state *state = get_state(dev, bdaddr_type);\n\n\tif (state->paired)\n\t\treturn;\n\n\tstate->paired = true;\n\n\t/* If the other bearer state was already true we don't need to\n\t * send any property signals.\n\t */\n\tif (dev->bredr_state.paired == dev->le_state.paired)\n\t\treturn;\n\n\tif (!state->svc_resolved) {\n\t\tdev->pending_paired = true;\n\t\treturn;\n\t}\n\n\tg_dbus_emit_property_changed(dbus_conn, dev->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"Paired\");\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *dbus_conn = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\n\nvoid device_set_paired(struct btd_device *dev, uint8_t bdaddr_type)\n{\n\tstruct bearer_state *state = get_state(dev, bdaddr_type);\n\n\tif (state->paired)\n\t\treturn;\n\n\tstate->paired = true;\n\n\t/* If the other bearer state was already true we don't need to\n\t * send any property signals.\n\t */\n\tif (dev->bredr_state.paired == dev->le_state.paired)\n\t\treturn;\n\n\tif (!state->svc_resolved) {\n\t\tdev->pending_paired = true;\n\t\treturn;\n\t}\n\n\tg_dbus_emit_property_changed(dbus_conn, dev->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"Paired\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "device_auth_req_free",
          "args": [
            "device"
          ],
          "line": 5703
        },
        "resolved": true,
        "details": {
          "function_name": "device_auth_req_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5662-5676",
          "snippet": "static void device_auth_req_free(struct btd_device *device)\n{\n\tstruct authentication_req *authr = device->authr;\n\n\tif (!authr)\n\t\treturn;\n\n\tif (authr->agent)\n\t\tagent_unref(authr->agent);\n\n\tg_free(authr->pincode);\n\tg_free(authr);\n\n\tdevice->authr = NULL;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void device_auth_req_free(struct btd_device *device)\n{\n\tstruct authentication_req *authr = device->authr;\n\n\tif (!authr)\n\t\treturn;\n\n\tif (authr->agent)\n\t\tagent_unref(authr->agent);\n\n\tg_free(authr->pincode);\n\tg_free(authr);\n\n\tdevice->authr = NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "device_bonding_failed",
          "args": [
            "device",
            "status"
          ],
          "line": 5699
        },
        "resolved": true,
        "details": {
          "function_name": "device_bonding_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5893-5910",
          "snippet": "void device_bonding_failed(struct btd_device *device, uint8_t status)\n{\n\tstruct bonding_req *bonding = device->bonding;\n\tDBusMessage *reply;\n\n\tDBG(\"status %u\", status);\n\n\tif (!bonding)\n\t\treturn;\n\n\tif (device->authr)\n\t\tdevice_cancel_authentication(device, FALSE);\n\n\treply = new_authentication_return(bonding->msg, status);\n\tg_dbus_send_message(dbus_conn, reply);\n\n\tbonding_request_free(bonding);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *dbus_conn = NULL;",
            "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
            "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);",
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid device_bonding_failed(struct btd_device *device, uint8_t status)\n{\n\tstruct bonding_req *bonding = device->bonding;\n\tDBusMessage *reply;\n\n\tDBG(\"status %u\", status);\n\n\tif (!bonding)\n\t\treturn;\n\n\tif (device->authr)\n\t\tdevice_cancel_authentication(device, FALSE);\n\n\treply = new_authentication_return(bonding->msg, status);\n\tg_dbus_send_message(dbus_conn, reply);\n\n\tbonding_request_free(bonding);\n}"
        }
      },
      {
        "call_info": {
          "callee": "device_cancel_authentication",
          "args": [
            "device",
            "TRUE"
          ],
          "line": 5698
        },
        "resolved": true,
        "details": {
          "function_name": "device_cancel_authentication",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "6170-6188",
          "snippet": "void device_cancel_authentication(struct btd_device *device, gboolean aborted)\n{\n\tstruct authentication_req *auth = device->authr;\n\tchar addr[18];\n\n\tif (!auth)\n\t\treturn;\n\n\tba2str(&device->bdaddr, addr);\n\tDBG(\"Canceling authentication request for %s\", addr);\n\n\tif (auth->agent)\n\t\tagent_cancel(auth->agent);\n\n\tif (!aborted)\n\t\tcancel_authentication(auth);\n\n\tdevice_auth_req_free(device);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid device_cancel_authentication(struct btd_device *device, gboolean aborted)\n{\n\tstruct authentication_req *auth = device->authr;\n\tchar addr[18];\n\n\tif (!auth)\n\t\treturn;\n\n\tba2str(&device->bdaddr, addr);\n\tDBG(\"Canceling authentication request for %s\", addr);\n\n\tif (auth->agent)\n\t\tagent_cancel(auth->agent);\n\n\tif (!aborted)\n\t\tcancel_authentication(auth);\n\n\tdevice_auth_req_free(device);\n}"
        }
      },
      {
        "call_info": {
          "callee": "agent_cancel",
          "args": [
            "auth->agent"
          ],
          "line": 5695
        },
        "resolved": true,
        "details": {
          "function_name": "agent_cancel",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "317-331",
          "snippet": "int agent_cancel(struct agent *agent)\n{\n\tif (!agent->request)\n\t\treturn -EINVAL;\n\n\tif (agent->request->call) {\n\t\tdbus_pending_call_cancel(agent->request->call);\n\t\tsend_cancel_request(agent->request);\n\t}\n\n\tagent_request_free(agent->request, TRUE);\n\tagent->request = NULL;\n\n\treturn 0;\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nint agent_cancel(struct agent *agent)\n{\n\tif (!agent->request)\n\t\treturn -EINVAL;\n\n\tif (agent->request->call) {\n\t\tdbus_pending_call_cancel(agent->request->call);\n\t\tsend_cancel_request(agent->request);\n\t}\n\n\tagent_request_free(agent->request, TRUE);\n\tagent->request = NULL;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"bonding %p status 0x%02x\"",
            "bonding",
            "status"
          ],
          "line": 5692
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_state",
          "args": [
            "device",
            "bdaddr_type"
          ],
          "line": 5690
        },
        "resolved": true,
        "details": {
          "function_name": "get_state",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "275-282",
          "snippet": "static struct bearer_state *get_state(struct btd_device *dev,\n\t\t\t\t\t\t\tuint8_t bdaddr_type)\n{\n\tif (bdaddr_type == BDADDR_BREDR)\n\t\treturn &dev->bredr_state;\n\telse\n\t\treturn &dev->le_state;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic struct bearer_state *get_state(struct btd_device *dev,\n\t\t\t\t\t\t\tuint8_t bdaddr_type)\n{\n\tif (bdaddr_type == BDADDR_BREDR)\n\t\treturn &dev->bredr_state;\n\telse\n\t\treturn &dev->le_state;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\n#define DISCOVERY_TIMER\t\t1\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid device_bonding_complete(struct btd_device *device, uint8_t bdaddr_type,\n\t\t\t\t\t\t\t\tuint8_t status)\n{\n\tstruct bonding_req *bonding = device->bonding;\n\tstruct authentication_req *auth = device->authr;\n\tstruct bearer_state *state = get_state(device, bdaddr_type);\n\n\tDBG(\"bonding %p status 0x%02x\", bonding, status);\n\n\tif (auth && auth->agent)\n\t\tagent_cancel(auth->agent);\n\n\tif (status) {\n\t\tdevice_cancel_authentication(device, TRUE);\n\t\tdevice_bonding_failed(device, status);\n\t\treturn;\n\t}\n\n\tdevice_auth_req_free(device);\n\n\t/* If we're already paired nothing more is needed */\n\tif (state->paired)\n\t\treturn;\n\n\tdevice_set_paired(device, bdaddr_type);\n\n\t/* If services are already resolved just reply to the pairing\n\t * request\n\t */\n\tif (state->svc_resolved && bonding) {\n\t\t/* Attept to store services for this device failed because it\n\t\t * was not paired. Now that we're paired retry. */\n\t\tstore_gatt_db(device);\n\n\t\tg_dbus_send_reply(dbus_conn, bonding->msg, DBUS_TYPE_INVALID);\n\t\tbonding_request_free(bonding);\n\t\treturn;\n\t}\n\n\t/* If we were initiators start service discovery immediately.\n\t * However if the other end was the initator wait a few seconds\n\t * before SDP. This is due to potential IOP issues if the other\n\t * end starts doing SDP at the same time as us */\n\tif (bonding) {\n\t\tDBG(\"Proceeding with service discovery\");\n\t\t/* If we are initiators remove any discovery timer and just\n\t\t * start discovering services directly */\n\t\tif (device->discov_timer) {\n\t\t\tg_source_remove(device->discov_timer);\n\t\t\tdevice->discov_timer = 0;\n\t\t}\n\n\t\tif (bdaddr_type == BDADDR_BREDR)\n\t\t\tdevice_browse_sdp(device, bonding->msg);\n\t\telse\n\t\t\tdevice_browse_gatt(device, bonding->msg);\n\n\t\tbonding_request_free(bonding);\n\t} else if (!state->svc_resolved) {\n\t\tif (!device->browse && !device->discov_timer &&\n\t\t\t\tmain_opts.reverse_sdp) {\n\t\t\t/* If we are not initiators and there is no currently\n\t\t\t * active discovery or discovery timer, set discovery\n\t\t\t * timer */\n\t\t\tDBG(\"setting timer for reverse service discovery\");\n\t\t\tdevice->discov_timer = g_timeout_add_seconds(\n\t\t\t\t\t\t\tDISCOVERY_TIMER,\n\t\t\t\t\t\t\tstart_discovery,\n\t\t\t\t\t\t\tdevice);\n\t\t}\n\t}\n}"
  },
  {
    "function_name": "device_is_retrying",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "5678-5683",
    "snippet": "bool device_is_retrying(struct btd_device *device)\n{\n\tstruct bonding_req *bonding = device->bonding;\n\n\treturn bonding && bonding->retry_timer > 0;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nbool device_is_retrying(struct btd_device *device)\n{\n\tstruct bonding_req *bonding = device->bonding;\n\n\treturn bonding && bonding->retry_timer > 0;\n}"
  },
  {
    "function_name": "device_auth_req_free",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "5662-5676",
    "snippet": "static void device_auth_req_free(struct btd_device *device)\n{\n\tstruct authentication_req *authr = device->authr;\n\n\tif (!authr)\n\t\treturn;\n\n\tif (authr->agent)\n\t\tagent_unref(authr->agent);\n\n\tg_free(authr->pincode);\n\tg_free(authr);\n\n\tdevice->authr = NULL;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "authr"
          ],
          "line": 5673
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "authr->pincode"
          ],
          "line": 5672
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "agent_unref",
          "args": [
            "authr->agent"
          ],
          "line": 5670
        },
        "resolved": true,
        "details": {
          "function_name": "agent_unref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "211-257",
          "snippet": "void agent_unref(struct agent *agent)\n{\n\tagent->ref--;\n\n\tDBG(\"%p: ref=%d\", agent, agent->ref);\n\n\tif (agent->ref > 0)\n\t\treturn;\n\n\tif (agent->request) {\n\t\tDBusError err;\n\t\tagent_pincode_cb pincode_cb;\n\t\tagent_passkey_cb passkey_cb;\n\t\tagent_cb cb;\n\n\t\tdbus_error_init(&err);\n\t\tdbus_set_error_const(&err, ERROR_INTERFACE \".Failed\",\n\t\t\t\t\t\t\t\t\"Canceled\");\n\n\t\tswitch (agent->request->type) {\n\t\tcase AGENT_REQUEST_PINCODE:\n\t\t\tpincode_cb = agent->request->cb;\n\t\t\tpincode_cb(agent, &err, NULL, agent->request->user_data);\n\t\t\tbreak;\n\t\tcase AGENT_REQUEST_PASSKEY:\n\t\t\tpasskey_cb = agent->request->cb;\n\t\t\tpasskey_cb(agent, &err, 0, agent->request->user_data);\n\t\t\tbreak;\n\t\tcase AGENT_REQUEST_CONFIRMATION:\n\t\tcase AGENT_REQUEST_AUTHORIZATION:\n\t\tcase AGENT_REQUEST_AUTHORIZE_SERVICE:\n\t\tcase AGENT_REQUEST_DISPLAY_PINCODE:\n\t\tdefault:\n\t\t\tcb = agent->request->cb;\n\t\t\tcb(agent, &err, agent->request->user_data);\n\t\t}\n\n\t\tdbus_error_free(&err);\n\n\t\tagent_cancel(agent);\n\t}\n\n\tg_free(agent->owner);\n\tg_free(agent->path);\n\n\tg_free(agent);\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid agent_unref(struct agent *agent)\n{\n\tagent->ref--;\n\n\tDBG(\"%p: ref=%d\", agent, agent->ref);\n\n\tif (agent->ref > 0)\n\t\treturn;\n\n\tif (agent->request) {\n\t\tDBusError err;\n\t\tagent_pincode_cb pincode_cb;\n\t\tagent_passkey_cb passkey_cb;\n\t\tagent_cb cb;\n\n\t\tdbus_error_init(&err);\n\t\tdbus_set_error_const(&err, ERROR_INTERFACE \".Failed\",\n\t\t\t\t\t\t\t\t\"Canceled\");\n\n\t\tswitch (agent->request->type) {\n\t\tcase AGENT_REQUEST_PINCODE:\n\t\t\tpincode_cb = agent->request->cb;\n\t\t\tpincode_cb(agent, &err, NULL, agent->request->user_data);\n\t\t\tbreak;\n\t\tcase AGENT_REQUEST_PASSKEY:\n\t\t\tpasskey_cb = agent->request->cb;\n\t\t\tpasskey_cb(agent, &err, 0, agent->request->user_data);\n\t\t\tbreak;\n\t\tcase AGENT_REQUEST_CONFIRMATION:\n\t\tcase AGENT_REQUEST_AUTHORIZATION:\n\t\tcase AGENT_REQUEST_AUTHORIZE_SERVICE:\n\t\tcase AGENT_REQUEST_DISPLAY_PINCODE:\n\t\tdefault:\n\t\t\tcb = agent->request->cb;\n\t\t\tcb(agent, &err, agent->request->user_data);\n\t\t}\n\n\t\tdbus_error_free(&err);\n\n\t\tagent_cancel(agent);\n\t}\n\n\tg_free(agent->owner);\n\tg_free(agent->path);\n\n\tg_free(agent);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void device_auth_req_free(struct btd_device *device)\n{\n\tstruct authentication_req *authr = device->authr;\n\n\tif (!authr)\n\t\treturn;\n\n\tif (authr->agent)\n\t\tagent_unref(authr->agent);\n\n\tg_free(authr->pincode);\n\tg_free(authr);\n\n\tdevice->authr = NULL;\n}"
  },
  {
    "function_name": "device_set_unpaired",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "5630-5660",
    "snippet": "void device_set_unpaired(struct btd_device *dev, uint8_t bdaddr_type)\n{\n\tstruct bearer_state *state = get_state(dev, bdaddr_type);\n\n\tif (!state->paired)\n\t\treturn;\n\n\tstate->paired = false;\n\n\t/*\n\t * If the other bearer state is still true we don't need to\n\t * send any property signals or remove device.\n\t */\n\tif (dev->bredr_state.paired != dev->le_state.paired) {\n\t\t/* TODO disconnect only unpaired bearer */\n\t\tif (state->connected)\n\t\t\tdevice_request_disconnect(dev, NULL);\n\n\t\treturn;\n\t}\n\n\tg_dbus_emit_property_changed(dbus_conn, dev->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"Paired\");\n\n\tbtd_device_set_temporary(dev, true);\n\n\tif (btd_device_is_connected(dev))\n\t\tdevice_request_disconnect(dev, NULL);\n\telse\n\t\tbtd_adapter_remove_device(dev->adapter, dev);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static DBusConnection *dbus_conn = NULL;",
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "btd_adapter_remove_device",
          "args": [
            "dev->adapter",
            "dev"
          ],
          "line": 5659
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_remove_device",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "1199-1233",
          "snippet": "void btd_adapter_remove_device(struct btd_adapter *adapter,\n\t\t\t\tstruct btd_device *dev)\n{\n\tGList *l;\n\n\tadapter->connect_list = g_slist_remove(adapter->connect_list, dev);\n\n\tadapter->devices = g_slist_remove(adapter->devices, dev);\n\n\tadapter->discovery_found = g_slist_remove(adapter->discovery_found,\n\t\t\t\t\t\t\t\t\tdev);\n\n\tadapter->connections = g_slist_remove(adapter->connections, dev);\n\n\tif (adapter->connect_le == dev)\n\t\tadapter->connect_le = NULL;\n\n\tl = adapter->auths->head;\n\twhile (l != NULL) {\n\t\tstruct service_auth *auth = l->data;\n\t\tGList *next = g_list_next(l);\n\n\t\tif (auth->device != dev) {\n\t\t\tl = next;\n\t\t\tcontinue;\n\t\t}\n\n\t\tg_queue_delete_link(adapter->auths, l);\n\t\tl = next;\n\n\t\tservice_auth_cancel(auth);\n\t}\n\n\tdevice_remove(dev, TRUE);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nvoid btd_adapter_remove_device(struct btd_adapter *adapter,\n\t\t\t\tstruct btd_device *dev)\n{\n\tGList *l;\n\n\tadapter->connect_list = g_slist_remove(adapter->connect_list, dev);\n\n\tadapter->devices = g_slist_remove(adapter->devices, dev);\n\n\tadapter->discovery_found = g_slist_remove(adapter->discovery_found,\n\t\t\t\t\t\t\t\t\tdev);\n\n\tadapter->connections = g_slist_remove(adapter->connections, dev);\n\n\tif (adapter->connect_le == dev)\n\t\tadapter->connect_le = NULL;\n\n\tl = adapter->auths->head;\n\twhile (l != NULL) {\n\t\tstruct service_auth *auth = l->data;\n\t\tGList *next = g_list_next(l);\n\n\t\tif (auth->device != dev) {\n\t\t\tl = next;\n\t\t\tcontinue;\n\t\t}\n\n\t\tg_queue_delete_link(adapter->auths, l);\n\t\tl = next;\n\n\t\tservice_auth_cancel(auth);\n\t}\n\n\tdevice_remove(dev, TRUE);\n}"
        }
      },
      {
        "call_info": {
          "callee": "device_request_disconnect",
          "args": [
            "dev",
            "NULL"
          ],
          "line": 5657
        },
        "resolved": true,
        "details": {
          "function_name": "device_request_disconnect",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "1436-1495",
          "snippet": "void device_request_disconnect(struct btd_device *device, DBusMessage *msg)\n{\n\tif (device->bonding)\n\t\tbonding_request_cancel(device->bonding);\n\n\tif (device->browse)\n\t\tbrowse_request_cancel(device->browse);\n\n\tif (device->att_io) {\n\t\tg_io_channel_shutdown(device->att_io, FALSE, NULL);\n\t\tg_io_channel_unref(device->att_io);\n\t\tdevice->att_io = NULL;\n\t}\n\n\tif (device->connect) {\n\t\tDBusMessage *reply = btd_error_failed(device->connect,\n\t\t\t\t\t\t\t\t\"Cancelled\");\n\t\tg_dbus_send_message(dbus_conn, reply);\n\t\tdbus_message_unref(device->connect);\n\t\tdevice->connect = NULL;\n\t}\n\n\tif (btd_device_is_connected(device) && msg)\n\t\tdevice->disconnects = g_slist_append(device->disconnects,\n\t\t\t\t\t\tdbus_message_ref(msg));\n\n\tif (device->disconn_timer)\n\t\treturn;\n\n\tg_slist_foreach(device->services, dev_disconn_service, NULL);\n\n\tg_slist_free(device->pending);\n\tdevice->pending = NULL;\n\n\twhile (device->watches) {\n\t\tstruct btd_disconnect_data *data = device->watches->data;\n\n\t\tif (data->watch)\n\t\t\t/* temporary is set if device is going to be removed */\n\t\t\tdata->watch(device, device->temporary,\n\t\t\t\t\t\t\tdata->user_data);\n\n\t\t/* Check if the watch has been removed by callback function */\n\t\tif (!g_slist_find(device->watches, data))\n\t\t\tcontinue;\n\n\t\tdevice->watches = g_slist_remove(device->watches, data);\n\t\tg_free(data);\n\t}\n\n\tif (!btd_device_is_connected(device)) {\n\t\tif (msg)\n\t\t\tg_dbus_send_reply(dbus_conn, msg, DBUS_TYPE_INVALID);\n\t\treturn;\n\t}\n\n\tdevice->disconn_timer = g_timeout_add_seconds(DISCONNECT_TIMER,\n\t\t\t\t\t\t\tdisconnect_all,\n\t\t\t\t\t\t\tdevice);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define DISCONNECT_TIMER\t2"
          ],
          "globals_used": [
            "static DBusConnection *dbus_conn = NULL;",
            "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
            "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);",
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\n#define DISCONNECT_TIMER\t2\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid device_request_disconnect(struct btd_device *device, DBusMessage *msg)\n{\n\tif (device->bonding)\n\t\tbonding_request_cancel(device->bonding);\n\n\tif (device->browse)\n\t\tbrowse_request_cancel(device->browse);\n\n\tif (device->att_io) {\n\t\tg_io_channel_shutdown(device->att_io, FALSE, NULL);\n\t\tg_io_channel_unref(device->att_io);\n\t\tdevice->att_io = NULL;\n\t}\n\n\tif (device->connect) {\n\t\tDBusMessage *reply = btd_error_failed(device->connect,\n\t\t\t\t\t\t\t\t\"Cancelled\");\n\t\tg_dbus_send_message(dbus_conn, reply);\n\t\tdbus_message_unref(device->connect);\n\t\tdevice->connect = NULL;\n\t}\n\n\tif (btd_device_is_connected(device) && msg)\n\t\tdevice->disconnects = g_slist_append(device->disconnects,\n\t\t\t\t\t\tdbus_message_ref(msg));\n\n\tif (device->disconn_timer)\n\t\treturn;\n\n\tg_slist_foreach(device->services, dev_disconn_service, NULL);\n\n\tg_slist_free(device->pending);\n\tdevice->pending = NULL;\n\n\twhile (device->watches) {\n\t\tstruct btd_disconnect_data *data = device->watches->data;\n\n\t\tif (data->watch)\n\t\t\t/* temporary is set if device is going to be removed */\n\t\t\tdata->watch(device, device->temporary,\n\t\t\t\t\t\t\tdata->user_data);\n\n\t\t/* Check if the watch has been removed by callback function */\n\t\tif (!g_slist_find(device->watches, data))\n\t\t\tcontinue;\n\n\t\tdevice->watches = g_slist_remove(device->watches, data);\n\t\tg_free(data);\n\t}\n\n\tif (!btd_device_is_connected(device)) {\n\t\tif (msg)\n\t\t\tg_dbus_send_reply(dbus_conn, msg, DBUS_TYPE_INVALID);\n\t\treturn;\n\t}\n\n\tdevice->disconn_timer = g_timeout_add_seconds(DISCONNECT_TIMER,\n\t\t\t\t\t\t\tdisconnect_all,\n\t\t\t\t\t\t\tdevice);\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_device_is_connected",
          "args": [
            "dev"
          ],
          "line": 5656
        },
        "resolved": true,
        "details": {
          "function_name": "btd_device_is_connected",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "2748-2751",
          "snippet": "bool btd_device_is_connected(struct btd_device *dev)\n{\n\treturn dev->bredr_state.connected || dev->le_state.connected;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nbool btd_device_is_connected(struct btd_device *dev)\n{\n\treturn dev->bredr_state.connected || dev->le_state.connected;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_device_set_temporary",
          "args": [
            "dev",
            "true"
          ],
          "line": 5654
        },
        "resolved": true,
        "details": {
          "function_name": "btd_device_set_temporary",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5336-5368",
          "snippet": "void btd_device_set_temporary(struct btd_device *device, bool temporary)\n{\n\tif (!device)\n\t\treturn;\n\n\tif (device->temporary == temporary)\n\t\treturn;\n\n\tif (device_address_is_private(device))\n\t\treturn;\n\n\tDBG(\"temporary %d\", temporary);\n\n\tdevice->temporary = temporary;\n\n\tif (temporary) {\n\t\tif (device->bredr)\n\t\t\tadapter_whitelist_remove(device->adapter, device);\n\t\tadapter_connect_list_remove(device->adapter, device);\n\t\treturn;\n\t}\n\n\tif (device->bredr)\n\t\tadapter_whitelist_add(device->adapter, device);\n\n\tstore_device_info(device);\n\n\t/* attributes were not stored when resolved if device was temporary */\n\tif (device->bdaddr_type != BDADDR_BREDR &&\n\t\t\tdevice->le_state.svc_resolved &&\n\t\t\tg_slist_length(device->primaries) != 0)\n\t\tstore_services(device);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid btd_device_set_temporary(struct btd_device *device, bool temporary)\n{\n\tif (!device)\n\t\treturn;\n\n\tif (device->temporary == temporary)\n\t\treturn;\n\n\tif (device_address_is_private(device))\n\t\treturn;\n\n\tDBG(\"temporary %d\", temporary);\n\n\tdevice->temporary = temporary;\n\n\tif (temporary) {\n\t\tif (device->bredr)\n\t\t\tadapter_whitelist_remove(device->adapter, device);\n\t\tadapter_connect_list_remove(device->adapter, device);\n\t\treturn;\n\t}\n\n\tif (device->bredr)\n\t\tadapter_whitelist_add(device->adapter, device);\n\n\tstore_device_info(device);\n\n\t/* attributes were not stored when resolved if device was temporary */\n\tif (device->bdaddr_type != BDADDR_BREDR &&\n\t\t\tdevice->le_state.svc_resolved &&\n\t\t\tg_slist_length(device->primaries) != 0)\n\t\tstore_services(device);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_emit_property_changed",
          "args": [
            "dbus_conn",
            "dev->path",
            "DEVICE_INTERFACE",
            "\"Paired\""
          ],
          "line": 5651
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_state",
          "args": [
            "dev",
            "bdaddr_type"
          ],
          "line": 5632
        },
        "resolved": true,
        "details": {
          "function_name": "get_state",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "275-282",
          "snippet": "static struct bearer_state *get_state(struct btd_device *dev,\n\t\t\t\t\t\t\tuint8_t bdaddr_type)\n{\n\tif (bdaddr_type == BDADDR_BREDR)\n\t\treturn &dev->bredr_state;\n\telse\n\t\treturn &dev->le_state;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic struct bearer_state *get_state(struct btd_device *dev,\n\t\t\t\t\t\t\tuint8_t bdaddr_type)\n{\n\tif (bdaddr_type == BDADDR_BREDR)\n\t\treturn &dev->bredr_state;\n\telse\n\t\treturn &dev->le_state;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid device_set_unpaired(struct btd_device *dev, uint8_t bdaddr_type)\n{\n\tstruct bearer_state *state = get_state(dev, bdaddr_type);\n\n\tif (!state->paired)\n\t\treturn;\n\n\tstate->paired = false;\n\n\t/*\n\t * If the other bearer state is still true we don't need to\n\t * send any property signals or remove device.\n\t */\n\tif (dev->bredr_state.paired != dev->le_state.paired) {\n\t\t/* TODO disconnect only unpaired bearer */\n\t\tif (state->connected)\n\t\t\tdevice_request_disconnect(dev, NULL);\n\n\t\treturn;\n\t}\n\n\tg_dbus_emit_property_changed(dbus_conn, dev->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"Paired\");\n\n\tbtd_device_set_temporary(dev, true);\n\n\tif (btd_device_is_connected(dev))\n\t\tdevice_request_disconnect(dev, NULL);\n\telse\n\t\tbtd_adapter_remove_device(dev->adapter, dev);\n}"
  },
  {
    "function_name": "device_set_paired",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "5606-5628",
    "snippet": "void device_set_paired(struct btd_device *dev, uint8_t bdaddr_type)\n{\n\tstruct bearer_state *state = get_state(dev, bdaddr_type);\n\n\tif (state->paired)\n\t\treturn;\n\n\tstate->paired = true;\n\n\t/* If the other bearer state was already true we don't need to\n\t * send any property signals.\n\t */\n\tif (dev->bredr_state.paired == dev->le_state.paired)\n\t\treturn;\n\n\tif (!state->svc_resolved) {\n\t\tdev->pending_paired = true;\n\t\treturn;\n\t}\n\n\tg_dbus_emit_property_changed(dbus_conn, dev->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"Paired\");\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static DBusConnection *dbus_conn = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_dbus_emit_property_changed",
          "args": [
            "dbus_conn",
            "dev->path",
            "DEVICE_INTERFACE",
            "\"Paired\""
          ],
          "line": 5626
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_state",
          "args": [
            "dev",
            "bdaddr_type"
          ],
          "line": 5608
        },
        "resolved": true,
        "details": {
          "function_name": "get_state",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "275-282",
          "snippet": "static struct bearer_state *get_state(struct btd_device *dev,\n\t\t\t\t\t\t\tuint8_t bdaddr_type)\n{\n\tif (bdaddr_type == BDADDR_BREDR)\n\t\treturn &dev->bredr_state;\n\telse\n\t\treturn &dev->le_state;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic struct bearer_state *get_state(struct btd_device *dev,\n\t\t\t\t\t\t\tuint8_t bdaddr_type)\n{\n\tif (bdaddr_type == BDADDR_BREDR)\n\t\treturn &dev->bredr_state;\n\telse\n\t\treturn &dev->le_state;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\n\nvoid device_set_paired(struct btd_device *dev, uint8_t bdaddr_type)\n{\n\tstruct bearer_state *state = get_state(dev, bdaddr_type);\n\n\tif (state->paired)\n\t\treturn;\n\n\tstate->paired = true;\n\n\t/* If the other bearer state was already true we don't need to\n\t * send any property signals.\n\t */\n\tif (dev->bredr_state.paired == dev->le_state.paired)\n\t\treturn;\n\n\tif (!state->svc_resolved) {\n\t\tdev->pending_paired = true;\n\t\treturn;\n\t}\n\n\tg_dbus_emit_property_changed(dbus_conn, dev->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"Paired\");\n}"
  },
  {
    "function_name": "start_discovery",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "5592-5604",
    "snippet": "static gboolean start_discovery(gpointer user_data)\n{\n\tstruct btd_device *device = user_data;\n\n\tif (device->bredr)\n\t\tdevice_browse_sdp(device, NULL);\n\telse\n\t\tdevice_browse_gatt(device, NULL);\n\n\tdevice->discov_timer = 0;\n\n\treturn FALSE;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "device_browse_gatt",
          "args": [
            "device",
            "NULL"
          ],
          "line": 5599
        },
        "resolved": true,
        "details": {
          "function_name": "device_browse_gatt",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5192-5236",
          "snippet": "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg)\n{\n\tstruct btd_adapter *adapter = device->adapter;\n\tstruct browse_req *req;\n\n\treq = browse_request_new(device, BROWSE_GATT, msg);\n\tif (!req)\n\t\treturn -EBUSY;\n\n\tif (device->client) {\n\t\t/*\n\t\t * If discovery has not yet completed, then wait for gatt-client\n\t\t * to become ready.\n\t\t */\n\t\tif (!bt_gatt_client_is_ready(device->client))\n\t\t\treturn 0;\n\n\t\t/*\n\t\t * Services have already been discovered, so signal this browse\n\t\t * request as resolved.\n\t\t */\n\t\tdevice_svc_resolved(device, BROWSE_GATT, device->bdaddr_type,\n\t\t\t\t\t\t\t\t\t0);\n\t\treturn 0;\n\t}\n\n\tdevice->att_io = bt_io_connect(att_connect_cb,\n\t\t\t\tdevice, NULL, NULL,\n\t\t\t\tBT_IO_OPT_SOURCE_BDADDR,\n\t\t\t\tbtd_adapter_get_address(adapter),\n\t\t\t\tBT_IO_OPT_SOURCE_TYPE,\n\t\t\t\tbtd_adapter_get_address_type(adapter),\n\t\t\t\tBT_IO_OPT_DEST_BDADDR, &device->bdaddr,\n\t\t\t\tBT_IO_OPT_DEST_TYPE, device->bdaddr_type,\n\t\t\t\tBT_IO_OPT_CID, ATT_CID,\n\t\t\t\tBT_IO_OPT_SEC_LEVEL, BT_IO_SEC_LOW,\n\t\t\t\tBT_IO_OPT_INVALID);\n\n\tif (device->att_io == NULL) {\n\t\tbrowse_request_free(req);\n\t\treturn -EIO;\n\t}\n\n\treturn 0;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
            "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);",
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg)\n{\n\tstruct btd_adapter *adapter = device->adapter;\n\tstruct browse_req *req;\n\n\treq = browse_request_new(device, BROWSE_GATT, msg);\n\tif (!req)\n\t\treturn -EBUSY;\n\n\tif (device->client) {\n\t\t/*\n\t\t * If discovery has not yet completed, then wait for gatt-client\n\t\t * to become ready.\n\t\t */\n\t\tif (!bt_gatt_client_is_ready(device->client))\n\t\t\treturn 0;\n\n\t\t/*\n\t\t * Services have already been discovered, so signal this browse\n\t\t * request as resolved.\n\t\t */\n\t\tdevice_svc_resolved(device, BROWSE_GATT, device->bdaddr_type,\n\t\t\t\t\t\t\t\t\t0);\n\t\treturn 0;\n\t}\n\n\tdevice->att_io = bt_io_connect(att_connect_cb,\n\t\t\t\tdevice, NULL, NULL,\n\t\t\t\tBT_IO_OPT_SOURCE_BDADDR,\n\t\t\t\tbtd_adapter_get_address(adapter),\n\t\t\t\tBT_IO_OPT_SOURCE_TYPE,\n\t\t\t\tbtd_adapter_get_address_type(adapter),\n\t\t\t\tBT_IO_OPT_DEST_BDADDR, &device->bdaddr,\n\t\t\t\tBT_IO_OPT_DEST_TYPE, device->bdaddr_type,\n\t\t\t\tBT_IO_OPT_CID, ATT_CID,\n\t\t\t\tBT_IO_OPT_SEC_LEVEL, BT_IO_SEC_LOW,\n\t\t\t\tBT_IO_OPT_INVALID);\n\n\tif (device->att_io == NULL) {\n\t\tbrowse_request_free(req);\n\t\treturn -EIO;\n\t}\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "device_browse_sdp",
          "args": [
            "device",
            "NULL"
          ],
          "line": 5597
        },
        "resolved": true,
        "details": {
          "function_name": "device_browse_sdp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5263-5287",
          "snippet": "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg)\n{\n\tstruct btd_adapter *adapter = device->adapter;\n\tstruct browse_req *req;\n\tuuid_t uuid;\n\tint err;\n\n\treq = browse_request_new(device, BROWSE_SDP, msg);\n\tif (!req)\n\t\treturn -EBUSY;\n\n\tsdp_uuid16_create(&uuid, uuid_list[req->search_uuid++]);\n\n\treq->sdp_flags = get_sdp_flags(device);\n\n\terr = bt_search_service(btd_adapter_get_address(adapter),\n\t\t\t\t&device->bdaddr, &uuid, browse_cb, req, NULL,\n\t\t\t\treq->sdp_flags);\n\tif (err < 0) {\n\t\tbrowse_request_free(req);\n\t\treturn err;\n\t}\n\n\treturn err;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static const uint16_t uuid_list[] = {\n\tL2CAP_UUID,\n\tPNP_INFO_SVCLASS_ID,\n\tPUBLIC_BROWSE_GROUP,\n\t0\n};",
            "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
            "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);",
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic const uint16_t uuid_list[] = {\n\tL2CAP_UUID,\n\tPNP_INFO_SVCLASS_ID,\n\tPUBLIC_BROWSE_GROUP,\n\t0\n};\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg)\n{\n\tstruct btd_adapter *adapter = device->adapter;\n\tstruct browse_req *req;\n\tuuid_t uuid;\n\tint err;\n\n\treq = browse_request_new(device, BROWSE_SDP, msg);\n\tif (!req)\n\t\treturn -EBUSY;\n\n\tsdp_uuid16_create(&uuid, uuid_list[req->search_uuid++]);\n\n\treq->sdp_flags = get_sdp_flags(device);\n\n\terr = bt_search_service(btd_adapter_get_address(adapter),\n\t\t\t\t&device->bdaddr, &uuid, browse_cb, req, NULL,\n\t\t\t\treq->sdp_flags);\n\tif (err < 0) {\n\t\tbrowse_request_free(req);\n\t\treturn err;\n\t}\n\n\treturn err;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic gboolean start_discovery(gpointer user_data)\n{\n\tstruct btd_device *device = user_data;\n\n\tif (device->bredr)\n\t\tdevice_browse_sdp(device, NULL);\n\telse\n\t\tdevice_browse_gatt(device, NULL);\n\n\tdevice->discov_timer = 0;\n\n\treturn FALSE;\n}"
  },
  {
    "function_name": "device_is_connectable",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "5580-5590",
    "snippet": "bool device_is_connectable(struct btd_device *device)\n{\n\tif (!device)\n\t\treturn false;\n\n\tif (device->bredr)\n\t\treturn true;\n\n\t/* Check if either Limited or General discoverable are set */\n\treturn (device->ad_flags[0] & 0x03);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nbool device_is_connectable(struct btd_device *device)\n{\n\tif (!device)\n\t\treturn false;\n\n\tif (device->bredr)\n\t\treturn true;\n\n\t/* Check if either Limited or General discoverable are set */\n\treturn (device->ad_flags[0] & 0x03);\n}"
  },
  {
    "function_name": "device_set_flags",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "5564-5578",
    "snippet": "void device_set_flags(struct btd_device *device, uint8_t flags)\n{\n\tif (!device)\n\t\treturn;\n\n\tDBG(\"flags %d\", flags);\n\n\tif (device->ad_flags[0] == flags)\n\t\treturn;\n\n\tdevice->ad_flags[0] = flags;\n\n\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\tDEVICE_INTERFACE, \"AdvertisingFlags\");\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static DBusConnection *dbus_conn = NULL;",
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_dbus_emit_property_changed",
          "args": [
            "dbus_conn",
            "device->path",
            "DEVICE_INTERFACE",
            "\"AdvertisingFlags\""
          ],
          "line": 5576
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"flags %d\"",
            "flags"
          ],
          "line": 5569
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid device_set_flags(struct btd_device *device, uint8_t flags)\n{\n\tif (!device)\n\t\treturn;\n\n\tDBG(\"flags %d\", flags);\n\n\tif (device->ad_flags[0] == flags)\n\t\treturn;\n\n\tdevice->ad_flags[0] = flags;\n\n\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\tDEVICE_INTERFACE, \"AdvertisingFlags\");\n}"
  },
  {
    "function_name": "device_set_tx_power",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "5548-5562",
    "snippet": "void device_set_tx_power(struct btd_device *device, int8_t tx_power)\n{\n\tif (!device)\n\t\treturn;\n\n\tif (device->tx_power == tx_power)\n\t\treturn;\n\n\tDBG(\"tx_power %d\", tx_power);\n\n\tdevice->tx_power = tx_power;\n\n\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"TxPower\");\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static DBusConnection *dbus_conn = NULL;",
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_dbus_emit_property_changed",
          "args": [
            "dbus_conn",
            "device->path",
            "DEVICE_INTERFACE",
            "\"TxPower\""
          ],
          "line": 5560
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"tx_power %d\"",
            "tx_power"
          ],
          "line": 5556
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid device_set_tx_power(struct btd_device *device, int8_t tx_power)\n{\n\tif (!device)\n\t\treturn;\n\n\tif (device->tx_power == tx_power)\n\t\treturn;\n\n\tDBG(\"tx_power %d\", tx_power);\n\n\tdevice->tx_power = tx_power;\n\n\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"TxPower\");\n}"
  },
  {
    "function_name": "device_set_rssi",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "5543-5546",
    "snippet": "void device_set_rssi(struct btd_device *device, int8_t rssi)\n{\n\tdevice_set_rssi_with_delta(device, rssi, RSSI_THRESHOLD);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define RSSI_THRESHOLD\t\t8"
    ],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "device_set_rssi_with_delta",
          "args": [
            "device",
            "rssi",
            "RSSI_THRESHOLD"
          ],
          "line": 5545
        },
        "resolved": true,
        "details": {
          "function_name": "device_set_rssi_with_delta",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5509-5541",
          "snippet": "void device_set_rssi_with_delta(struct btd_device *device, int8_t rssi,\n\t\t\t\t\t\t\tint8_t delta_threshold)\n{\n\tif (!device)\n\t\treturn;\n\n\tif (rssi == 0 || device->rssi == 0) {\n\t\tif (device->rssi == rssi)\n\t\t\treturn;\n\n\t\tDBG(\"rssi %d\", rssi);\n\n\t\tdevice->rssi = rssi;\n\t} else {\n\t\tint delta;\n\n\t\tif (device->rssi > rssi)\n\t\t\tdelta = device->rssi - rssi;\n\t\telse\n\t\t\tdelta = rssi - device->rssi;\n\n\t\t/* only report changes of delta_threshold dBm or more */\n\t\tif (delta < delta_threshold)\n\t\t\treturn;\n\n\t\tDBG(\"rssi %d delta %d\", rssi, delta);\n\n\t\tdevice->rssi = rssi;\n\t}\n\n\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"RSSI\");\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *dbus_conn = NULL;",
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid device_set_rssi_with_delta(struct btd_device *device, int8_t rssi,\n\t\t\t\t\t\t\tint8_t delta_threshold)\n{\n\tif (!device)\n\t\treturn;\n\n\tif (rssi == 0 || device->rssi == 0) {\n\t\tif (device->rssi == rssi)\n\t\t\treturn;\n\n\t\tDBG(\"rssi %d\", rssi);\n\n\t\tdevice->rssi = rssi;\n\t} else {\n\t\tint delta;\n\n\t\tif (device->rssi > rssi)\n\t\t\tdelta = device->rssi - rssi;\n\t\telse\n\t\t\tdelta = rssi - device->rssi;\n\n\t\t/* only report changes of delta_threshold dBm or more */\n\t\tif (delta < delta_threshold)\n\t\t\treturn;\n\n\t\tDBG(\"rssi %d delta %d\", rssi, delta);\n\n\t\tdevice->rssi = rssi;\n\t}\n\n\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"RSSI\");\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\n#define RSSI_THRESHOLD\t\t8\n\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid device_set_rssi(struct btd_device *device, int8_t rssi)\n{\n\tdevice_set_rssi_with_delta(device, rssi, RSSI_THRESHOLD);\n}"
  },
  {
    "function_name": "device_set_rssi_with_delta",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "5509-5541",
    "snippet": "void device_set_rssi_with_delta(struct btd_device *device, int8_t rssi,\n\t\t\t\t\t\t\tint8_t delta_threshold)\n{\n\tif (!device)\n\t\treturn;\n\n\tif (rssi == 0 || device->rssi == 0) {\n\t\tif (device->rssi == rssi)\n\t\t\treturn;\n\n\t\tDBG(\"rssi %d\", rssi);\n\n\t\tdevice->rssi = rssi;\n\t} else {\n\t\tint delta;\n\n\t\tif (device->rssi > rssi)\n\t\t\tdelta = device->rssi - rssi;\n\t\telse\n\t\t\tdelta = rssi - device->rssi;\n\n\t\t/* only report changes of delta_threshold dBm or more */\n\t\tif (delta < delta_threshold)\n\t\t\treturn;\n\n\t\tDBG(\"rssi %d delta %d\", rssi, delta);\n\n\t\tdevice->rssi = rssi;\n\t}\n\n\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"RSSI\");\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static DBusConnection *dbus_conn = NULL;",
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_dbus_emit_property_changed",
          "args": [
            "dbus_conn",
            "device->path",
            "DEVICE_INTERFACE",
            "\"RSSI\""
          ],
          "line": 5539
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"rssi %d delta %d\"",
            "rssi",
            "delta"
          ],
          "line": 5534
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"rssi %d\"",
            "rssi"
          ],
          "line": 5519
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid device_set_rssi_with_delta(struct btd_device *device, int8_t rssi,\n\t\t\t\t\t\t\tint8_t delta_threshold)\n{\n\tif (!device)\n\t\treturn;\n\n\tif (rssi == 0 || device->rssi == 0) {\n\t\tif (device->rssi == rssi)\n\t\t\treturn;\n\n\t\tDBG(\"rssi %d\", rssi);\n\n\t\tdevice->rssi = rssi;\n\t} else {\n\t\tint delta;\n\n\t\tif (device->rssi > rssi)\n\t\t\tdelta = device->rssi - rssi;\n\t\telse\n\t\t\tdelta = rssi - device->rssi;\n\n\t\t/* only report changes of delta_threshold dBm or more */\n\t\tif (delta < delta_threshold)\n\t\t\treturn;\n\n\t\tDBG(\"rssi %d delta %d\", rssi, delta);\n\n\t\tdevice->rssi = rssi;\n\t}\n\n\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"RSSI\");\n}"
  },
  {
    "function_name": "device_load_svc_chng_ccc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "5467-5507",
    "snippet": "void device_load_svc_chng_ccc(struct btd_device *device, uint16_t *ccc_le,\n\t\t\t\t\t\t\tuint16_t *ccc_bredr)\n{\n\tchar filename[PATH_MAX];\n\tchar device_addr[18];\n\tGKeyFile *key_file;\n\n\tba2str(&device->bdaddr, device_addr);\n\tsnprintf(filename, PATH_MAX, STORAGEDIR \"/%s/%s/info\",\n\t\t\t\tbtd_adapter_get_storage_dir(device->adapter),\n\t\t\t\tdevice_addr);\n\n\tkey_file = g_key_file_new();\n\tg_key_file_load_from_file(key_file, filename, 0, NULL);\n\n\t/*\n\t * If there is no \"ServiceChanged\" section we may be loading data from\n\t * old version which did not persist Service Changed CCC values. Let's\n\t * check if we are bonded and assume indications were enabled by peer\n\t * in such case - it should have done this anyway.\n\t */\n\tif (!g_key_file_has_group(key_file, \"ServiceChanged\")) {\n\t\tif (ccc_le)\n\t\t\t*ccc_le = device->le_state.bonded ? 0x0002 : 0x0000;\n\t\tif (ccc_bredr)\n\t\t\t*ccc_bredr = device->bredr_state.bonded ?\n\t\t\t\t\t\t\t0x0002 : 0x0000;\n\t\tg_key_file_free(key_file);\n\t\treturn;\n\t}\n\n\tif (ccc_le)\n\t\t*ccc_le = g_key_file_get_integer(key_file, \"ServiceChanged\",\n\t\t\t\t\t\t\t\"CCC_LE\", NULL);\n\n\tif (ccc_bredr)\n\t\t*ccc_bredr = g_key_file_get_integer(key_file, \"ServiceChanged\",\n\t\t\t\t\t\t\t\"CCC_BR/EDR\", NULL);\n\n\tg_key_file_free(key_file);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_key_file_free",
          "args": [
            "key_file"
          ],
          "line": 5506
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_get_integer",
          "args": [
            "key_file",
            "\"ServiceChanged\"",
            "\"CCC_BR/EDR\"",
            "NULL"
          ],
          "line": 5503
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_get_integer",
          "args": [
            "key_file",
            "\"ServiceChanged\"",
            "\"CCC_LE\"",
            "NULL"
          ],
          "line": 5499
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_free",
          "args": [
            "key_file"
          ],
          "line": 5494
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_has_group",
          "args": [
            "key_file",
            "\"ServiceChanged\""
          ],
          "line": 5488
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_load_from_file",
          "args": [
            "key_file",
            "filename",
            "0",
            "NULL"
          ],
          "line": 5480
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_new",
          "args": [],
          "line": 5479
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "filename",
            "PATH_MAX",
            "STORAGEDIR \"/%s/%s/info\"",
            "btd_adapter_get_storage_dir(device->adapter)",
            "device_addr"
          ],
          "line": 5475
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_adapter_get_storage_dir",
          "args": [
            "device->adapter"
          ],
          "line": 5476
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_get_storage_dir",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "438-450",
          "snippet": "const char *btd_adapter_get_storage_dir(struct btd_adapter *adapter)\n{\n\tstatic char dir[25];\n\n\tif (adapter->bdaddr_type == BDADDR_LE_RANDOM) {\n\t\tstrcpy(dir, \"static-\");\n\t\tba2str(&adapter->bdaddr, dir + 7);\n\t} else {\n\t\tba2str(&adapter->bdaddr, dir);\n\t}\n\n\treturn dir;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nconst char *btd_adapter_get_storage_dir(struct btd_adapter *adapter)\n{\n\tstatic char dir[25];\n\n\tif (adapter->bdaddr_type == BDADDR_LE_RANDOM) {\n\t\tstrcpy(dir, \"static-\");\n\t\tba2str(&adapter->bdaddr, dir + 7);\n\t} else {\n\t\tba2str(&adapter->bdaddr, dir);\n\t}\n\n\treturn dir;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ba2str",
          "args": [
            "&device->bdaddr",
            "device_addr"
          ],
          "line": 5474
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid device_load_svc_chng_ccc(struct btd_device *device, uint16_t *ccc_le,\n\t\t\t\t\t\t\tuint16_t *ccc_bredr)\n{\n\tchar filename[PATH_MAX];\n\tchar device_addr[18];\n\tGKeyFile *key_file;\n\n\tba2str(&device->bdaddr, device_addr);\n\tsnprintf(filename, PATH_MAX, STORAGEDIR \"/%s/%s/info\",\n\t\t\t\tbtd_adapter_get_storage_dir(device->adapter),\n\t\t\t\tdevice_addr);\n\n\tkey_file = g_key_file_new();\n\tg_key_file_load_from_file(key_file, filename, 0, NULL);\n\n\t/*\n\t * If there is no \"ServiceChanged\" section we may be loading data from\n\t * old version which did not persist Service Changed CCC values. Let's\n\t * check if we are bonded and assume indications were enabled by peer\n\t * in such case - it should have done this anyway.\n\t */\n\tif (!g_key_file_has_group(key_file, \"ServiceChanged\")) {\n\t\tif (ccc_le)\n\t\t\t*ccc_le = device->le_state.bonded ? 0x0002 : 0x0000;\n\t\tif (ccc_bredr)\n\t\t\t*ccc_bredr = device->bredr_state.bonded ?\n\t\t\t\t\t\t\t0x0002 : 0x0000;\n\t\tg_key_file_free(key_file);\n\t\treturn;\n\t}\n\n\tif (ccc_le)\n\t\t*ccc_le = g_key_file_get_integer(key_file, \"ServiceChanged\",\n\t\t\t\t\t\t\t\"CCC_LE\", NULL);\n\n\tif (ccc_bredr)\n\t\t*ccc_bredr = g_key_file_get_integer(key_file, \"ServiceChanged\",\n\t\t\t\t\t\t\t\"CCC_BR/EDR\", NULL);\n\n\tg_key_file_free(key_file);\n}"
  },
  {
    "function_name": "device_store_svc_chng_ccc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "5419-5466",
    "snippet": "void device_store_svc_chng_ccc(struct btd_device *device, uint8_t bdaddr_type,\n\t\t\t\t\t\t\t\tuint16_t value)\n{\n\tchar filename[PATH_MAX];\n\tchar device_addr[18];\n\tGKeyFile *key_file;\n\tuint16_t old_value;\n\tgsize length = 0;\n\tchar *str;\n\n\tba2str(&device->bdaddr, device_addr);\n\tsnprintf(filename, PATH_MAX, STORAGEDIR \"/%s/%s/info\",\n\t\t\t\tbtd_adapter_get_storage_dir(device->adapter),\n\t\t\t\tdevice_addr);\n\n\tkey_file = g_key_file_new();\n\tg_key_file_load_from_file(key_file, filename, 0, NULL);\n\n\t/* for bonded devices this is done on every connection so limit writes\n\t * to storage if no change needed\n\t */\n\tif (bdaddr_type == BDADDR_BREDR) {\n\t\told_value = g_key_file_get_integer(key_file, \"ServiceChanged\",\n\t\t\t\t\t\t\t\"CCC_BR/EDR\", NULL);\n\t\tif (old_value == value)\n\t\t\tgoto done;\n\n\t\tg_key_file_set_integer(key_file, \"ServiceChanged\", \"CCC_BR/EDR\",\n\t\t\t\t\t\t\t\t\tvalue);\n\t} else {\n\t\told_value = g_key_file_get_integer(key_file, \"ServiceChanged\",\n\t\t\t\t\t\t\t\"CCC_LE\", NULL);\n\t\tif (old_value == value)\n\t\t\tgoto done;\n\n\t\tg_key_file_set_integer(key_file, \"ServiceChanged\", \"CCC_LE\",\n\t\t\t\t\t\t\t\t\tvalue);\n\t}\n\n\tcreate_file(filename, S_IRUSR | S_IWUSR);\n\n\tstr = g_key_file_to_data(key_file, &length, NULL);\n\tg_file_set_contents(filename, str, length, NULL);\n\tg_free(str);\n\ndone:\n\tg_key_file_free(key_file);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_key_file_free",
          "args": [
            "key_file"
          ],
          "line": 5465
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "str"
          ],
          "line": 5462
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_file_set_contents",
          "args": [
            "filename",
            "str",
            "length",
            "NULL"
          ],
          "line": 5461
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_to_data",
          "args": [
            "key_file",
            "&length",
            "NULL"
          ],
          "line": 5460
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "create_file",
          "args": [
            "filename",
            "S_IRUSR | S_IWUSR"
          ],
          "line": 5458
        },
        "resolved": true,
        "details": {
          "function_name": "create_file",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/textfile.c",
          "lines": "76-89",
          "snippet": "int create_file(const char *filename, const mode_t mode)\n{\n\tint fd;\n\n\tcreate_dirs(filename, S_IRUSR | S_IWUSR | S_IXUSR);\n\n\tfd = open(filename, O_RDWR | O_CREAT, mode);\n\tif (fd < 0)\n\t\treturn fd;\n\n\tclose(fd);\n\n\treturn 0;\n}",
          "includes": [
            "#include \"textfile.h\"",
            "#include <sys/param.h>",
            "#include <sys/mman.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <ctype.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"textfile.h\"\n#include <sys/param.h>\n#include <sys/mman.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <ctype.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nint create_file(const char *filename, const mode_t mode)\n{\n\tint fd;\n\n\tcreate_dirs(filename, S_IRUSR | S_IWUSR | S_IXUSR);\n\n\tfd = open(filename, O_RDWR | O_CREAT, mode);\n\tif (fd < 0)\n\t\treturn fd;\n\n\tclose(fd);\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_key_file_set_integer",
          "args": [
            "key_file",
            "\"ServiceChanged\"",
            "\"CCC_LE\"",
            "value"
          ],
          "line": 5454
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_get_integer",
          "args": [
            "key_file",
            "\"ServiceChanged\"",
            "\"CCC_LE\"",
            "NULL"
          ],
          "line": 5449
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_set_integer",
          "args": [
            "key_file",
            "\"ServiceChanged\"",
            "\"CCC_BR/EDR\"",
            "value"
          ],
          "line": 5446
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_get_integer",
          "args": [
            "key_file",
            "\"ServiceChanged\"",
            "\"CCC_BR/EDR\"",
            "NULL"
          ],
          "line": 5441
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_load_from_file",
          "args": [
            "key_file",
            "filename",
            "0",
            "NULL"
          ],
          "line": 5435
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_new",
          "args": [],
          "line": 5434
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "filename",
            "PATH_MAX",
            "STORAGEDIR \"/%s/%s/info\"",
            "btd_adapter_get_storage_dir(device->adapter)",
            "device_addr"
          ],
          "line": 5430
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_adapter_get_storage_dir",
          "args": [
            "device->adapter"
          ],
          "line": 5431
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_get_storage_dir",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "438-450",
          "snippet": "const char *btd_adapter_get_storage_dir(struct btd_adapter *adapter)\n{\n\tstatic char dir[25];\n\n\tif (adapter->bdaddr_type == BDADDR_LE_RANDOM) {\n\t\tstrcpy(dir, \"static-\");\n\t\tba2str(&adapter->bdaddr, dir + 7);\n\t} else {\n\t\tba2str(&adapter->bdaddr, dir);\n\t}\n\n\treturn dir;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nconst char *btd_adapter_get_storage_dir(struct btd_adapter *adapter)\n{\n\tstatic char dir[25];\n\n\tif (adapter->bdaddr_type == BDADDR_LE_RANDOM) {\n\t\tstrcpy(dir, \"static-\");\n\t\tba2str(&adapter->bdaddr, dir + 7);\n\t} else {\n\t\tba2str(&adapter->bdaddr, dir);\n\t}\n\n\treturn dir;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ba2str",
          "args": [
            "&device->bdaddr",
            "device_addr"
          ],
          "line": 5429
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid device_store_svc_chng_ccc(struct btd_device *device, uint8_t bdaddr_type,\n\t\t\t\t\t\t\t\tuint16_t value)\n{\n\tchar filename[PATH_MAX];\n\tchar device_addr[18];\n\tGKeyFile *key_file;\n\tuint16_t old_value;\n\tgsize length = 0;\n\tchar *str;\n\n\tba2str(&device->bdaddr, device_addr);\n\tsnprintf(filename, PATH_MAX, STORAGEDIR \"/%s/%s/info\",\n\t\t\t\tbtd_adapter_get_storage_dir(device->adapter),\n\t\t\t\tdevice_addr);\n\n\tkey_file = g_key_file_new();\n\tg_key_file_load_from_file(key_file, filename, 0, NULL);\n\n\t/* for bonded devices this is done on every connection so limit writes\n\t * to storage if no change needed\n\t */\n\tif (bdaddr_type == BDADDR_BREDR) {\n\t\told_value = g_key_file_get_integer(key_file, \"ServiceChanged\",\n\t\t\t\t\t\t\t\"CCC_BR/EDR\", NULL);\n\t\tif (old_value == value)\n\t\t\tgoto done;\n\n\t\tg_key_file_set_integer(key_file, \"ServiceChanged\", \"CCC_BR/EDR\",\n\t\t\t\t\t\t\t\t\tvalue);\n\t} else {\n\t\told_value = g_key_file_get_integer(key_file, \"ServiceChanged\",\n\t\t\t\t\t\t\t\"CCC_LE\", NULL);\n\t\tif (old_value == value)\n\t\t\tgoto done;\n\n\t\tg_key_file_set_integer(key_file, \"ServiceChanged\", \"CCC_LE\",\n\t\t\t\t\t\t\t\t\tvalue);\n\t}\n\n\tcreate_file(filename, S_IRUSR | S_IWUSR);\n\n\tstr = g_key_file_to_data(key_file, &length, NULL);\n\tg_file_set_contents(filename, str, length, NULL);\n\tg_free(str);\n\ndone:\n\tg_key_file_free(key_file);\n}"
  },
  {
    "function_name": "device_set_legacy",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "5403-5417",
    "snippet": "void device_set_legacy(struct btd_device *device, bool legacy)\n{\n\tif (!device)\n\t\treturn;\n\n\tDBG(\"legacy %d\", legacy);\n\n\tif (device->legacy == legacy)\n\t\treturn;\n\n\tdevice->legacy = legacy;\n\n\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\tDEVICE_INTERFACE, \"LegacyPairing\");\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static DBusConnection *dbus_conn = NULL;",
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_dbus_emit_property_changed",
          "args": [
            "dbus_conn",
            "device->path",
            "DEVICE_INTERFACE",
            "\"LegacyPairing\""
          ],
          "line": 5415
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"legacy %d\"",
            "legacy"
          ],
          "line": 5408
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid device_set_legacy(struct btd_device *device, bool legacy)\n{\n\tif (!device)\n\t\treturn;\n\n\tDBG(\"legacy %d\", legacy);\n\n\tif (device->legacy == legacy)\n\t\treturn;\n\n\tdevice->legacy = legacy;\n\n\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\tDEVICE_INTERFACE, \"LegacyPairing\");\n}"
  },
  {
    "function_name": "device_set_bonded",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "5388-5401",
    "snippet": "void device_set_bonded(struct btd_device *device, uint8_t bdaddr_type)\n{\n\tif (!device)\n\t\treturn;\n\n\tDBG(\"\");\n\n\tif (bdaddr_type == BDADDR_BREDR)\n\t\tdevice->bredr_state.bonded = true;\n\telse\n\t\tdevice->le_state.bonded = true;\n\n\tbtd_device_set_temporary(device, false);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "btd_device_set_temporary",
          "args": [
            "device",
            "false"
          ],
          "line": 5400
        },
        "resolved": true,
        "details": {
          "function_name": "btd_device_set_temporary",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5336-5368",
          "snippet": "void btd_device_set_temporary(struct btd_device *device, bool temporary)\n{\n\tif (!device)\n\t\treturn;\n\n\tif (device->temporary == temporary)\n\t\treturn;\n\n\tif (device_address_is_private(device))\n\t\treturn;\n\n\tDBG(\"temporary %d\", temporary);\n\n\tdevice->temporary = temporary;\n\n\tif (temporary) {\n\t\tif (device->bredr)\n\t\t\tadapter_whitelist_remove(device->adapter, device);\n\t\tadapter_connect_list_remove(device->adapter, device);\n\t\treturn;\n\t}\n\n\tif (device->bredr)\n\t\tadapter_whitelist_add(device->adapter, device);\n\n\tstore_device_info(device);\n\n\t/* attributes were not stored when resolved if device was temporary */\n\tif (device->bdaddr_type != BDADDR_BREDR &&\n\t\t\tdevice->le_state.svc_resolved &&\n\t\t\tg_slist_length(device->primaries) != 0)\n\t\tstore_services(device);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid btd_device_set_temporary(struct btd_device *device, bool temporary)\n{\n\tif (!device)\n\t\treturn;\n\n\tif (device->temporary == temporary)\n\t\treturn;\n\n\tif (device_address_is_private(device))\n\t\treturn;\n\n\tDBG(\"temporary %d\", temporary);\n\n\tdevice->temporary = temporary;\n\n\tif (temporary) {\n\t\tif (device->bredr)\n\t\t\tadapter_whitelist_remove(device->adapter, device);\n\t\tadapter_connect_list_remove(device->adapter, device);\n\t\treturn;\n\t}\n\n\tif (device->bredr)\n\t\tadapter_whitelist_add(device->adapter, device);\n\n\tstore_device_info(device);\n\n\t/* attributes were not stored when resolved if device was temporary */\n\tif (device->bdaddr_type != BDADDR_BREDR &&\n\t\t\tdevice->le_state.svc_resolved &&\n\t\t\tg_slist_length(device->primaries) != 0)\n\t\tstore_services(device);\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"\""
          ],
          "line": 5393
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid device_set_bonded(struct btd_device *device, uint8_t bdaddr_type)\n{\n\tif (!device)\n\t\treturn;\n\n\tDBG(\"\");\n\n\tif (bdaddr_type == BDADDR_BREDR)\n\t\tdevice->bredr_state.bonded = true;\n\telse\n\t\tdevice->le_state.bonded = true;\n\n\tbtd_device_set_temporary(device, false);\n}"
  },
  {
    "function_name": "btd_device_set_trusted",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "5370-5386",
    "snippet": "void btd_device_set_trusted(struct btd_device *device, gboolean trusted)\n{\n\tif (!device)\n\t\treturn;\n\n\tif (device->trusted == trusted)\n\t\treturn;\n\n\tDBG(\"trusted %d\", trusted);\n\n\tdevice->trusted = trusted;\n\n\tstore_device_info(device);\n\n\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\tDEVICE_INTERFACE, \"Trusted\");\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static DBusConnection *dbus_conn = NULL;",
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_dbus_emit_property_changed",
          "args": [
            "dbus_conn",
            "device->path",
            "DEVICE_INTERFACE",
            "\"Trusted\""
          ],
          "line": 5384
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "store_device_info",
          "args": [
            "device"
          ],
          "line": 5382
        },
        "resolved": true,
        "details": {
          "function_name": "store_device_info",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "475-487",
          "snippet": "static void store_device_info(struct btd_device *device)\n{\n\tif (device->temporary || device->store_id > 0)\n\t\treturn;\n\n\tif (device_address_is_private(device)) {\n\t\tDBG(\"Can't store info for private addressed device %s\",\n\t\t\t\t\t\t\t\tdevice->path);\n\t\treturn;\n\t}\n\n\tdevice->store_id = g_idle_add(store_device_info_cb, device);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void store_device_info(struct btd_device *device)\n{\n\tif (device->temporary || device->store_id > 0)\n\t\treturn;\n\n\tif (device_address_is_private(device)) {\n\t\tDBG(\"Can't store info for private addressed device %s\",\n\t\t\t\t\t\t\t\tdevice->path);\n\t\treturn;\n\t}\n\n\tdevice->store_id = g_idle_add(store_device_info_cb, device);\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"trusted %d\"",
            "trusted"
          ],
          "line": 5378
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid btd_device_set_trusted(struct btd_device *device, gboolean trusted)\n{\n\tif (!device)\n\t\treturn;\n\n\tif (device->trusted == trusted)\n\t\treturn;\n\n\tDBG(\"trusted %d\", trusted);\n\n\tdevice->trusted = trusted;\n\n\tstore_device_info(device);\n\n\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\tDEVICE_INTERFACE, \"Trusted\");\n}"
  },
  {
    "function_name": "btd_device_set_temporary",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "5336-5368",
    "snippet": "void btd_device_set_temporary(struct btd_device *device, bool temporary)\n{\n\tif (!device)\n\t\treturn;\n\n\tif (device->temporary == temporary)\n\t\treturn;\n\n\tif (device_address_is_private(device))\n\t\treturn;\n\n\tDBG(\"temporary %d\", temporary);\n\n\tdevice->temporary = temporary;\n\n\tif (temporary) {\n\t\tif (device->bredr)\n\t\t\tadapter_whitelist_remove(device->adapter, device);\n\t\tadapter_connect_list_remove(device->adapter, device);\n\t\treturn;\n\t}\n\n\tif (device->bredr)\n\t\tadapter_whitelist_add(device->adapter, device);\n\n\tstore_device_info(device);\n\n\t/* attributes were not stored when resolved if device was temporary */\n\tif (device->bdaddr_type != BDADDR_BREDR &&\n\t\t\tdevice->le_state.svc_resolved &&\n\t\t\tg_slist_length(device->primaries) != 0)\n\t\tstore_services(device);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "store_services",
          "args": [
            "device"
          ],
          "line": 5367
        },
        "resolved": true,
        "details": {
          "function_name": "store_services",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "2064-2134",
          "snippet": "static void store_services(struct btd_device *device)\n{\n\tchar filename[PATH_MAX];\n\tchar dst_addr[18];\n\tuuid_t uuid;\n\tchar *prim_uuid;\n\tGKeyFile *key_file;\n\tGSList *l;\n\tchar *data;\n\tgsize length = 0;\n\n\tif (device_address_is_private(device)) {\n\t\tDBG(\"Can't store services for private addressed device %s\",\n\t\t\t\t\t\t\t\tdevice->path);\n\t\treturn;\n\t}\n\n\tsdp_uuid16_create(&uuid, GATT_PRIM_SVC_UUID);\n\tprim_uuid = bt_uuid2string(&uuid);\n\tif (prim_uuid == NULL)\n\t\treturn;\n\n\tba2str(&device->bdaddr, dst_addr);\n\n\tsnprintf(filename, PATH_MAX, STORAGEDIR \"/%s/%s/attributes\",\n\t\t\t\tbtd_adapter_get_storage_dir(device->adapter),\n\t\t\t\tdst_addr);\n\tkey_file = g_key_file_new();\n\n\tfor (l = device->primaries; l; l = l->next) {\n\t\tstruct gatt_primary *primary = l->data;\n\t\tchar handle[6], uuid_str[33];\n\t\tint i;\n\n\t\tsprintf(handle, \"%hu\", primary->range.start);\n\n\t\tbt_string2uuid(&uuid, primary->uuid);\n\t\tsdp_uuid128_to_uuid(&uuid);\n\n\t\tswitch (uuid.type) {\n\t\tcase SDP_UUID16:\n\t\t\tsprintf(uuid_str, \"%4.4X\", uuid.value.uuid16);\n\t\t\tbreak;\n\t\tcase SDP_UUID32:\n\t\t\tsprintf(uuid_str, \"%8.8X\", uuid.value.uuid32);\n\t\t\tbreak;\n\t\tcase SDP_UUID128:\n\t\t\tfor (i = 0; i < 16; i++)\n\t\t\t\tsprintf(uuid_str + (i * 2), \"%2.2X\",\n\t\t\t\t\t\tuuid.value.uuid128.data[i]);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tuuid_str[0] = '\\0';\n\t\t}\n\n\t\tg_key_file_set_string(key_file, handle, \"UUID\", prim_uuid);\n\t\tg_key_file_set_string(key_file, handle, \"Value\", uuid_str);\n\t\tg_key_file_set_integer(key_file, handle, \"EndGroupHandle\",\n\t\t\t\t\tprimary->range.end);\n\t}\n\n\tdata = g_key_file_to_data(key_file, &length, NULL);\n\tif (length > 0) {\n\t\tcreate_file(filename, S_IRUSR | S_IWUSR);\n\t\tg_file_set_contents(filename, data, length, NULL);\n\t}\n\n\tfree(prim_uuid);\n\tg_free(data);\n\tg_key_file_free(key_file);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void store_services(struct btd_device *device)\n{\n\tchar filename[PATH_MAX];\n\tchar dst_addr[18];\n\tuuid_t uuid;\n\tchar *prim_uuid;\n\tGKeyFile *key_file;\n\tGSList *l;\n\tchar *data;\n\tgsize length = 0;\n\n\tif (device_address_is_private(device)) {\n\t\tDBG(\"Can't store services for private addressed device %s\",\n\t\t\t\t\t\t\t\tdevice->path);\n\t\treturn;\n\t}\n\n\tsdp_uuid16_create(&uuid, GATT_PRIM_SVC_UUID);\n\tprim_uuid = bt_uuid2string(&uuid);\n\tif (prim_uuid == NULL)\n\t\treturn;\n\n\tba2str(&device->bdaddr, dst_addr);\n\n\tsnprintf(filename, PATH_MAX, STORAGEDIR \"/%s/%s/attributes\",\n\t\t\t\tbtd_adapter_get_storage_dir(device->adapter),\n\t\t\t\tdst_addr);\n\tkey_file = g_key_file_new();\n\n\tfor (l = device->primaries; l; l = l->next) {\n\t\tstruct gatt_primary *primary = l->data;\n\t\tchar handle[6], uuid_str[33];\n\t\tint i;\n\n\t\tsprintf(handle, \"%hu\", primary->range.start);\n\n\t\tbt_string2uuid(&uuid, primary->uuid);\n\t\tsdp_uuid128_to_uuid(&uuid);\n\n\t\tswitch (uuid.type) {\n\t\tcase SDP_UUID16:\n\t\t\tsprintf(uuid_str, \"%4.4X\", uuid.value.uuid16);\n\t\t\tbreak;\n\t\tcase SDP_UUID32:\n\t\t\tsprintf(uuid_str, \"%8.8X\", uuid.value.uuid32);\n\t\t\tbreak;\n\t\tcase SDP_UUID128:\n\t\t\tfor (i = 0; i < 16; i++)\n\t\t\t\tsprintf(uuid_str + (i * 2), \"%2.2X\",\n\t\t\t\t\t\tuuid.value.uuid128.data[i]);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tuuid_str[0] = '\\0';\n\t\t}\n\n\t\tg_key_file_set_string(key_file, handle, \"UUID\", prim_uuid);\n\t\tg_key_file_set_string(key_file, handle, \"Value\", uuid_str);\n\t\tg_key_file_set_integer(key_file, handle, \"EndGroupHandle\",\n\t\t\t\t\tprimary->range.end);\n\t}\n\n\tdata = g_key_file_to_data(key_file, &length, NULL);\n\tif (length > 0) {\n\t\tcreate_file(filename, S_IRUSR | S_IWUSR);\n\t\tg_file_set_contents(filename, data, length, NULL);\n\t}\n\n\tfree(prim_uuid);\n\tg_free(data);\n\tg_key_file_free(key_file);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_slist_length",
          "args": [
            "device->primaries"
          ],
          "line": 5366
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "store_device_info",
          "args": [
            "device"
          ],
          "line": 5361
        },
        "resolved": true,
        "details": {
          "function_name": "store_device_info",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "475-487",
          "snippet": "static void store_device_info(struct btd_device *device)\n{\n\tif (device->temporary || device->store_id > 0)\n\t\treturn;\n\n\tif (device_address_is_private(device)) {\n\t\tDBG(\"Can't store info for private addressed device %s\",\n\t\t\t\t\t\t\t\tdevice->path);\n\t\treturn;\n\t}\n\n\tdevice->store_id = g_idle_add(store_device_info_cb, device);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void store_device_info(struct btd_device *device)\n{\n\tif (device->temporary || device->store_id > 0)\n\t\treturn;\n\n\tif (device_address_is_private(device)) {\n\t\tDBG(\"Can't store info for private addressed device %s\",\n\t\t\t\t\t\t\t\tdevice->path);\n\t\treturn;\n\t}\n\n\tdevice->store_id = g_idle_add(store_device_info_cb, device);\n}"
        }
      },
      {
        "call_info": {
          "callee": "adapter_whitelist_add",
          "args": [
            "device->adapter",
            "device"
          ],
          "line": 5359
        },
        "resolved": true,
        "details": {
          "function_name": "adapter_whitelist_add",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "4584-4599",
          "snippet": "void adapter_whitelist_add(struct btd_adapter *adapter, struct btd_device *dev)\n{\n\tstruct mgmt_cp_add_device cp;\n\n\tif (!kernel_conn_control)\n\t\treturn;\n\n\tmemset(&cp, 0, sizeof(cp));\n\tbacpy(&cp.addr.bdaddr, device_get_address(dev));\n\tcp.addr.type = BDADDR_BREDR;\n\tcp.action = 0x01;\n\n\tmgmt_send(adapter->mgmt, MGMT_OP_ADD_DEVICE,\n\t\t\t\tadapter->dev_id, sizeof(cp), &cp,\n\t\t\t\tadd_whitelist_complete, adapter, NULL);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static bool kernel_conn_control = false;",
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic bool kernel_conn_control = false;\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nvoid adapter_whitelist_add(struct btd_adapter *adapter, struct btd_device *dev)\n{\n\tstruct mgmt_cp_add_device cp;\n\n\tif (!kernel_conn_control)\n\t\treturn;\n\n\tmemset(&cp, 0, sizeof(cp));\n\tbacpy(&cp.addr.bdaddr, device_get_address(dev));\n\tcp.addr.type = BDADDR_BREDR;\n\tcp.action = 0x01;\n\n\tmgmt_send(adapter->mgmt, MGMT_OP_ADD_DEVICE,\n\t\t\t\tadapter->dev_id, sizeof(cp), &cp,\n\t\t\t\tadd_whitelist_complete, adapter, NULL);\n}"
        }
      },
      {
        "call_info": {
          "callee": "adapter_connect_list_remove",
          "args": [
            "device->adapter",
            "device"
          ],
          "line": 5354
        },
        "resolved": true,
        "details": {
          "function_name": "adapter_connect_list_remove",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "4515-4548",
          "snippet": "void adapter_connect_list_remove(struct btd_adapter *adapter,\n\t\t\t\t\tstruct btd_device *device)\n{\n\t/*\n\t * If the adapter->connect_le device is being removed from the\n\t * connect list it means the connection was successful and hence\n\t * the pointer should be cleared\n\t */\n\tif (device == adapter->connect_le)\n\t\tadapter->connect_le = NULL;\n\n\tif (kernel_conn_control)\n\t\treturn;\n\n\tif (!g_slist_find(adapter->connect_list, device)) {\n\t\tDBG(\"device %s is not on the list, ignoring\",\n\t\t\t\t\t\tdevice_get_path(device));\n\t\treturn;\n\t}\n\n\tadapter->connect_list = g_slist_remove(adapter->connect_list, device);\n\tDBG(\"%s removed from %s's connect_list\", device_get_path(device),\n\t\t\t\t\t\t\tadapter->system_name);\n\n\tif (!adapter->connect_list) {\n\t\tstop_passive_scanning(adapter);\n\t\treturn;\n\t}\n\n\tif (!(adapter->current_settings & MGMT_SETTING_POWERED))\n\t\treturn;\n\n\ttrigger_passive_scanning(adapter);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static bool kernel_conn_control = false;",
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic bool kernel_conn_control = false;\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nvoid adapter_connect_list_remove(struct btd_adapter *adapter,\n\t\t\t\t\tstruct btd_device *device)\n{\n\t/*\n\t * If the adapter->connect_le device is being removed from the\n\t * connect list it means the connection was successful and hence\n\t * the pointer should be cleared\n\t */\n\tif (device == adapter->connect_le)\n\t\tadapter->connect_le = NULL;\n\n\tif (kernel_conn_control)\n\t\treturn;\n\n\tif (!g_slist_find(adapter->connect_list, device)) {\n\t\tDBG(\"device %s is not on the list, ignoring\",\n\t\t\t\t\t\tdevice_get_path(device));\n\t\treturn;\n\t}\n\n\tadapter->connect_list = g_slist_remove(adapter->connect_list, device);\n\tDBG(\"%s removed from %s's connect_list\", device_get_path(device),\n\t\t\t\t\t\t\tadapter->system_name);\n\n\tif (!adapter->connect_list) {\n\t\tstop_passive_scanning(adapter);\n\t\treturn;\n\t}\n\n\tif (!(adapter->current_settings & MGMT_SETTING_POWERED))\n\t\treturn;\n\n\ttrigger_passive_scanning(adapter);\n}"
        }
      },
      {
        "call_info": {
          "callee": "adapter_whitelist_remove",
          "args": [
            "device->adapter",
            "device"
          ],
          "line": 5353
        },
        "resolved": true,
        "details": {
          "function_name": "adapter_whitelist_remove",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "4623-4637",
          "snippet": "void adapter_whitelist_remove(struct btd_adapter *adapter, struct btd_device *dev)\n{\n\tstruct mgmt_cp_remove_device cp;\n\n\tif (!kernel_conn_control)\n\t\treturn;\n\n\tmemset(&cp, 0, sizeof(cp));\n\tbacpy(&cp.addr.bdaddr, device_get_address(dev));\n\tcp.addr.type = BDADDR_BREDR;\n\n\tmgmt_send(adapter->mgmt, MGMT_OP_REMOVE_DEVICE,\n\t\t\t\tadapter->dev_id, sizeof(cp), &cp,\n\t\t\t\tremove_whitelist_complete, adapter, NULL);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static bool kernel_conn_control = false;",
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic bool kernel_conn_control = false;\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nvoid adapter_whitelist_remove(struct btd_adapter *adapter, struct btd_device *dev)\n{\n\tstruct mgmt_cp_remove_device cp;\n\n\tif (!kernel_conn_control)\n\t\treturn;\n\n\tmemset(&cp, 0, sizeof(cp));\n\tbacpy(&cp.addr.bdaddr, device_get_address(dev));\n\tcp.addr.type = BDADDR_BREDR;\n\n\tmgmt_send(adapter->mgmt, MGMT_OP_REMOVE_DEVICE,\n\t\t\t\tadapter->dev_id, sizeof(cp), &cp,\n\t\t\t\tremove_whitelist_complete, adapter, NULL);\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"temporary %d\"",
            "temporary"
          ],
          "line": 5347
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device_address_is_private",
          "args": [
            "device"
          ],
          "line": 5344
        },
        "resolved": true,
        "details": {
          "function_name": "device_address_is_private",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "461-473",
          "snippet": "static bool device_address_is_private(struct btd_device *dev)\n{\n\tif (dev->bdaddr_type != BDADDR_LE_RANDOM)\n\t\treturn false;\n\n\tswitch (dev->bdaddr.b[5] >> 6) {\n\tcase 0x00:\t/* Private non-resolvable */\n\tcase 0x01:\t/* Private resolvable */\n\t\treturn true;\n\tdefault:\n\t\treturn false;\n\t}\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic bool device_address_is_private(struct btd_device *dev)\n{\n\tif (dev->bdaddr_type != BDADDR_LE_RANDOM)\n\t\treturn false;\n\n\tswitch (dev->bdaddr.b[5] >> 6) {\n\tcase 0x00:\t/* Private non-resolvable */\n\tcase 0x01:\t/* Private resolvable */\n\t\treturn true;\n\tdefault:\n\t\treturn false;\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid btd_device_set_temporary(struct btd_device *device, bool temporary)\n{\n\tif (!device)\n\t\treturn;\n\n\tif (device->temporary == temporary)\n\t\treturn;\n\n\tif (device_address_is_private(device))\n\t\treturn;\n\n\tDBG(\"temporary %d\", temporary);\n\n\tdevice->temporary = temporary;\n\n\tif (temporary) {\n\t\tif (device->bredr)\n\t\t\tadapter_whitelist_remove(device->adapter, device);\n\t\tadapter_connect_list_remove(device->adapter, device);\n\t\treturn;\n\t}\n\n\tif (device->bredr)\n\t\tadapter_whitelist_add(device->adapter, device);\n\n\tstore_device_info(device);\n\n\t/* attributes were not stored when resolved if device was temporary */\n\tif (device->bdaddr_type != BDADDR_BREDR &&\n\t\t\tdevice->le_state.svc_resolved &&\n\t\t\tg_slist_length(device->primaries) != 0)\n\t\tstore_services(device);\n}"
  },
  {
    "function_name": "device_is_temporary",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "5331-5334",
    "snippet": "gboolean device_is_temporary(struct btd_device *device)\n{\n\treturn device->temporary;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\ngboolean device_is_temporary(struct btd_device *device)\n{\n\treturn device->temporary;\n}"
  },
  {
    "function_name": "device_get_path",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "5323-5329",
    "snippet": "const char *device_get_path(const struct btd_device *device)\n{\n\tif (!device)\n\t\treturn NULL;\n\n\treturn device->path;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nconst char *device_get_path(const struct btd_device *device)\n{\n\tif (!device)\n\t\treturn NULL;\n\n\treturn device->path;\n}"
  },
  {
    "function_name": "device_get_le_address_type",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "5318-5321",
    "snippet": "uint8_t device_get_le_address_type(struct btd_device *device)\n{\n\treturn device->bdaddr_type;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nuint8_t device_get_le_address_type(struct btd_device *device)\n{\n\treturn device->bdaddr_type;\n}"
  },
  {
    "function_name": "device_get_address",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "5314-5317",
    "snippet": "const bdaddr_t *device_get_address(struct btd_device *device)\n{\n\treturn &device->bdaddr;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nconst bdaddr_t *device_get_address(struct btd_device *device)\n{\n\treturn &device->bdaddr;\n}"
  },
  {
    "function_name": "device_get_adapter",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "5306-5312",
    "snippet": "struct btd_adapter *device_get_adapter(struct btd_device *device)\n{\n\tif (!device)\n\t\treturn NULL;\n\n\treturn device->adapter;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstruct btd_adapter *device_get_adapter(struct btd_device *device)\n{\n\tif (!device)\n\t\treturn NULL;\n\n\treturn device->adapter;\n}"
  },
  {
    "function_name": "device_discover_services",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "5289-5304",
    "snippet": "int device_discover_services(struct btd_device *device)\n{\n\tint err;\n\n\tif (device->bredr)\n\t\terr = device_browse_sdp(device, NULL);\n\telse\n\t\terr = device_browse_gatt(device, NULL);\n\n\tif (err == 0 && device->discov_timer) {\n\t\tg_source_remove(device->discov_timer);\n\t\tdevice->discov_timer = 0;\n\t}\n\n\treturn err;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_source_remove",
          "args": [
            "device->discov_timer"
          ],
          "line": 5299
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device_browse_gatt",
          "args": [
            "device",
            "NULL"
          ],
          "line": 5296
        },
        "resolved": true,
        "details": {
          "function_name": "device_browse_gatt",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5192-5236",
          "snippet": "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg)\n{\n\tstruct btd_adapter *adapter = device->adapter;\n\tstruct browse_req *req;\n\n\treq = browse_request_new(device, BROWSE_GATT, msg);\n\tif (!req)\n\t\treturn -EBUSY;\n\n\tif (device->client) {\n\t\t/*\n\t\t * If discovery has not yet completed, then wait for gatt-client\n\t\t * to become ready.\n\t\t */\n\t\tif (!bt_gatt_client_is_ready(device->client))\n\t\t\treturn 0;\n\n\t\t/*\n\t\t * Services have already been discovered, so signal this browse\n\t\t * request as resolved.\n\t\t */\n\t\tdevice_svc_resolved(device, BROWSE_GATT, device->bdaddr_type,\n\t\t\t\t\t\t\t\t\t0);\n\t\treturn 0;\n\t}\n\n\tdevice->att_io = bt_io_connect(att_connect_cb,\n\t\t\t\tdevice, NULL, NULL,\n\t\t\t\tBT_IO_OPT_SOURCE_BDADDR,\n\t\t\t\tbtd_adapter_get_address(adapter),\n\t\t\t\tBT_IO_OPT_SOURCE_TYPE,\n\t\t\t\tbtd_adapter_get_address_type(adapter),\n\t\t\t\tBT_IO_OPT_DEST_BDADDR, &device->bdaddr,\n\t\t\t\tBT_IO_OPT_DEST_TYPE, device->bdaddr_type,\n\t\t\t\tBT_IO_OPT_CID, ATT_CID,\n\t\t\t\tBT_IO_OPT_SEC_LEVEL, BT_IO_SEC_LOW,\n\t\t\t\tBT_IO_OPT_INVALID);\n\n\tif (device->att_io == NULL) {\n\t\tbrowse_request_free(req);\n\t\treturn -EIO;\n\t}\n\n\treturn 0;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
            "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);",
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg)\n{\n\tstruct btd_adapter *adapter = device->adapter;\n\tstruct browse_req *req;\n\n\treq = browse_request_new(device, BROWSE_GATT, msg);\n\tif (!req)\n\t\treturn -EBUSY;\n\n\tif (device->client) {\n\t\t/*\n\t\t * If discovery has not yet completed, then wait for gatt-client\n\t\t * to become ready.\n\t\t */\n\t\tif (!bt_gatt_client_is_ready(device->client))\n\t\t\treturn 0;\n\n\t\t/*\n\t\t * Services have already been discovered, so signal this browse\n\t\t * request as resolved.\n\t\t */\n\t\tdevice_svc_resolved(device, BROWSE_GATT, device->bdaddr_type,\n\t\t\t\t\t\t\t\t\t0);\n\t\treturn 0;\n\t}\n\n\tdevice->att_io = bt_io_connect(att_connect_cb,\n\t\t\t\tdevice, NULL, NULL,\n\t\t\t\tBT_IO_OPT_SOURCE_BDADDR,\n\t\t\t\tbtd_adapter_get_address(adapter),\n\t\t\t\tBT_IO_OPT_SOURCE_TYPE,\n\t\t\t\tbtd_adapter_get_address_type(adapter),\n\t\t\t\tBT_IO_OPT_DEST_BDADDR, &device->bdaddr,\n\t\t\t\tBT_IO_OPT_DEST_TYPE, device->bdaddr_type,\n\t\t\t\tBT_IO_OPT_CID, ATT_CID,\n\t\t\t\tBT_IO_OPT_SEC_LEVEL, BT_IO_SEC_LOW,\n\t\t\t\tBT_IO_OPT_INVALID);\n\n\tif (device->att_io == NULL) {\n\t\tbrowse_request_free(req);\n\t\treturn -EIO;\n\t}\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "device_browse_sdp",
          "args": [
            "device",
            "NULL"
          ],
          "line": 5294
        },
        "resolved": true,
        "details": {
          "function_name": "device_browse_sdp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5263-5287",
          "snippet": "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg)\n{\n\tstruct btd_adapter *adapter = device->adapter;\n\tstruct browse_req *req;\n\tuuid_t uuid;\n\tint err;\n\n\treq = browse_request_new(device, BROWSE_SDP, msg);\n\tif (!req)\n\t\treturn -EBUSY;\n\n\tsdp_uuid16_create(&uuid, uuid_list[req->search_uuid++]);\n\n\treq->sdp_flags = get_sdp_flags(device);\n\n\terr = bt_search_service(btd_adapter_get_address(adapter),\n\t\t\t\t&device->bdaddr, &uuid, browse_cb, req, NULL,\n\t\t\t\treq->sdp_flags);\n\tif (err < 0) {\n\t\tbrowse_request_free(req);\n\t\treturn err;\n\t}\n\n\treturn err;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static const uint16_t uuid_list[] = {\n\tL2CAP_UUID,\n\tPNP_INFO_SVCLASS_ID,\n\tPUBLIC_BROWSE_GROUP,\n\t0\n};",
            "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
            "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);",
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic const uint16_t uuid_list[] = {\n\tL2CAP_UUID,\n\tPNP_INFO_SVCLASS_ID,\n\tPUBLIC_BROWSE_GROUP,\n\t0\n};\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg)\n{\n\tstruct btd_adapter *adapter = device->adapter;\n\tstruct browse_req *req;\n\tuuid_t uuid;\n\tint err;\n\n\treq = browse_request_new(device, BROWSE_SDP, msg);\n\tif (!req)\n\t\treturn -EBUSY;\n\n\tsdp_uuid16_create(&uuid, uuid_list[req->search_uuid++]);\n\n\treq->sdp_flags = get_sdp_flags(device);\n\n\terr = bt_search_service(btd_adapter_get_address(adapter),\n\t\t\t\t&device->bdaddr, &uuid, browse_cb, req, NULL,\n\t\t\t\treq->sdp_flags);\n\tif (err < 0) {\n\t\tbrowse_request_free(req);\n\t\treturn err;\n\t}\n\n\treturn err;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nint device_discover_services(struct btd_device *device)\n{\n\tint err;\n\n\tif (device->bredr)\n\t\terr = device_browse_sdp(device, NULL);\n\telse\n\t\terr = device_browse_gatt(device, NULL);\n\n\tif (err == 0 && device->discov_timer) {\n\t\tg_source_remove(device->discov_timer);\n\t\tdevice->discov_timer = 0;\n\t}\n\n\treturn err;\n}"
  },
  {
    "function_name": "device_browse_sdp",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "5263-5287",
    "snippet": "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg)\n{\n\tstruct btd_adapter *adapter = device->adapter;\n\tstruct browse_req *req;\n\tuuid_t uuid;\n\tint err;\n\n\treq = browse_request_new(device, BROWSE_SDP, msg);\n\tif (!req)\n\t\treturn -EBUSY;\n\n\tsdp_uuid16_create(&uuid, uuid_list[req->search_uuid++]);\n\n\treq->sdp_flags = get_sdp_flags(device);\n\n\terr = bt_search_service(btd_adapter_get_address(adapter),\n\t\t\t\t&device->bdaddr, &uuid, browse_cb, req, NULL,\n\t\t\t\treq->sdp_flags);\n\tif (err < 0) {\n\t\tbrowse_request_free(req);\n\t\treturn err;\n\t}\n\n\treturn err;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static const uint16_t uuid_list[] = {\n\tL2CAP_UUID,\n\tPNP_INFO_SVCLASS_ID,\n\tPUBLIC_BROWSE_GROUP,\n\t0\n};",
      "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
      "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);",
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "browse_request_free",
          "args": [
            "req"
          ],
          "line": 5282
        },
        "resolved": true,
        "details": {
          "function_name": "browse_request_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "519-535",
          "snippet": "static void browse_request_free(struct browse_req *req)\n{\n\tstruct btd_device *device = req->device;\n\n\tif (device->browse == req)\n\t\tdevice->browse = NULL;\n\n\tif (req->listener_id)\n\t\tg_dbus_remove_watch(dbus_conn, req->listener_id);\n\tif (req->msg)\n\t\tdbus_message_unref(req->msg);\n\tg_slist_free_full(req->profiles_added, g_free);\n\tif (req->records)\n\t\tsdp_list_free(req->records, (sdp_free_func_t) sdp_record_free);\n\n\tg_free(req);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *dbus_conn = NULL;",
            "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
            "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);",
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void browse_request_free(struct browse_req *req)\n{\n\tstruct btd_device *device = req->device;\n\n\tif (device->browse == req)\n\t\tdevice->browse = NULL;\n\n\tif (req->listener_id)\n\t\tg_dbus_remove_watch(dbus_conn, req->listener_id);\n\tif (req->msg)\n\t\tdbus_message_unref(req->msg);\n\tg_slist_free_full(req->profiles_added, g_free);\n\tif (req->records)\n\t\tsdp_list_free(req->records, (sdp_free_func_t) sdp_record_free);\n\n\tg_free(req);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_search_service",
          "args": [
            "btd_adapter_get_address(adapter)",
            "&device->bdaddr",
            "&uuid",
            "browse_cb",
            "req",
            "NULL",
            "req->sdp_flags"
          ],
          "line": 5278
        },
        "resolved": true,
        "details": {
          "function_name": "bt_search_service",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdp-client.c",
          "lines": "341-362",
          "snippet": "int bt_search_service(const bdaddr_t *src, const bdaddr_t *dst,\n\t\t\tuuid_t *uuid, bt_callback_t cb, void *user_data,\n\t\t\tbt_destroy_t destroy, uint16_t flags)\n{\n\tstruct search_context *ctxt = NULL;\n\tint err;\n\n\tif (!cb)\n\t\treturn -EINVAL;\n\n\terr = create_search_context(&ctxt, src, dst, uuid, flags);\n\tif (err < 0)\n\t\treturn err;\n\n\tctxt->cb\t= cb;\n\tctxt->destroy\t= destroy;\n\tctxt->user_data\t= user_data;\n\n\tcontext_list = g_slist_append(context_list, ctxt);\n\n\treturn 0;\n}",
          "includes": [
            "#include \"sdp-client.h\"",
            "#include \"log.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static GSList *context_list = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"sdp-client.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nstatic GSList *context_list = NULL;\n\nint bt_search_service(const bdaddr_t *src, const bdaddr_t *dst,\n\t\t\tuuid_t *uuid, bt_callback_t cb, void *user_data,\n\t\t\tbt_destroy_t destroy, uint16_t flags)\n{\n\tstruct search_context *ctxt = NULL;\n\tint err;\n\n\tif (!cb)\n\t\treturn -EINVAL;\n\n\terr = create_search_context(&ctxt, src, dst, uuid, flags);\n\tif (err < 0)\n\t\treturn err;\n\n\tctxt->cb\t= cb;\n\tctxt->destroy\t= destroy;\n\tctxt->user_data\t= user_data;\n\n\tcontext_list = g_slist_append(context_list, ctxt);\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_adapter_get_address",
          "args": [
            "adapter"
          ],
          "line": 5278
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_get_address",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "5881-5884",
          "snippet": "const bdaddr_t *btd_adapter_get_address(struct btd_adapter *adapter)\n{\n\treturn &adapter->bdaddr;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nconst bdaddr_t *btd_adapter_get_address(struct btd_adapter *adapter)\n{\n\treturn &adapter->bdaddr;\n}"
        }
      },
      {
        "call_info": {
          "callee": "get_sdp_flags",
          "args": [
            "device"
          ],
          "line": 5276
        },
        "resolved": true,
        "details": {
          "function_name": "get_sdp_flags",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5238-5261",
          "snippet": "static uint16_t get_sdp_flags(struct btd_device *device)\n{\n\tuint16_t vid, pid;\n\n\tvid = btd_device_get_vendor(device);\n\tpid = btd_device_get_product(device);\n\n\t/* Sony DualShock 4 is not respecting negotiated L2CAP MTU. This might\n\t * results in SDP response being dropped by kernel. Workaround this by\n\t * forcing SDP code to use bigger MTU while connecting.\n\t */\n\tif (vid == 0x054c && pid == 0x05c4)\n\t\treturn SDP_LARGE_MTU;\n\n\tif (btd_adapter_ssp_enabled(device->adapter))\n\t\treturn 0;\n\n\t/* if no EIR try matching Sony DualShock 4 with name and class */\n\tif (!strncmp(device->name, \"Wireless Controller\", MAX_NAME_LENGTH) &&\n\t\t\tdevice->class == 0x2508)\n\t\treturn SDP_LARGE_MTU;\n\n\treturn 0;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic uint16_t get_sdp_flags(struct btd_device *device)\n{\n\tuint16_t vid, pid;\n\n\tvid = btd_device_get_vendor(device);\n\tpid = btd_device_get_product(device);\n\n\t/* Sony DualShock 4 is not respecting negotiated L2CAP MTU. This might\n\t * results in SDP response being dropped by kernel. Workaround this by\n\t * forcing SDP code to use bigger MTU while connecting.\n\t */\n\tif (vid == 0x054c && pid == 0x05c4)\n\t\treturn SDP_LARGE_MTU;\n\n\tif (btd_adapter_ssp_enabled(device->adapter))\n\t\treturn 0;\n\n\t/* if no EIR try matching Sony DualShock 4 with name and class */\n\tif (!strncmp(device->name, \"Wireless Controller\", MAX_NAME_LENGTH) &&\n\t\t\tdevice->class == 0x2508)\n\t\treturn SDP_LARGE_MTU;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sdp_uuid16_create",
          "args": [
            "&uuid",
            "uuid_list[req->search_uuid++]"
          ],
          "line": 5274
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "browse_request_new",
          "args": [
            "device",
            "BROWSE_SDP",
            "msg"
          ],
          "line": 5270
        },
        "resolved": true,
        "details": {
          "function_name": "browse_request_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5160-5190",
          "snippet": "static struct browse_req *browse_request_new(struct btd_device *device,\n\t\t\t\t\t\t\tuint8_t type,\n\t\t\t\t\t\t\tDBusMessage *msg)\n{\n\tstruct browse_req *req;\n\n\tif (device->browse)\n\t\treturn NULL;\n\n\treq = g_new0(struct browse_req, 1);\n\treq->device = device;\n\treq->type = type;\n\n\tdevice->browse = req;\n\n\tif (!msg)\n\t\treturn req;\n\n\treq->msg = dbus_message_ref(msg);\n\n\t/*\n\t * Track the request owner to cancel it automatically if the owner\n\t * exits\n\t */\n\treq->listener_id = g_dbus_add_disconnect_watch(dbus_conn,\n\t\t\t\t\t\tdbus_message_get_sender(msg),\n\t\t\t\t\t\tbrowse_request_exit,\n\t\t\t\t\t\treq, NULL);\n\n\treturn req;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *dbus_conn = NULL;",
            "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
            "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);",
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic struct browse_req *browse_request_new(struct btd_device *device,\n\t\t\t\t\t\t\tuint8_t type,\n\t\t\t\t\t\t\tDBusMessage *msg)\n{\n\tstruct browse_req *req;\n\n\tif (device->browse)\n\t\treturn NULL;\n\n\treq = g_new0(struct browse_req, 1);\n\treq->device = device;\n\treq->type = type;\n\n\tdevice->browse = req;\n\n\tif (!msg)\n\t\treturn req;\n\n\treq->msg = dbus_message_ref(msg);\n\n\t/*\n\t * Track the request owner to cancel it automatically if the owner\n\t * exits\n\t */\n\treq->listener_id = g_dbus_add_disconnect_watch(dbus_conn,\n\t\t\t\t\t\tdbus_message_get_sender(msg),\n\t\t\t\t\t\tbrowse_request_exit,\n\t\t\t\t\t\treq, NULL);\n\n\treturn req;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic const uint16_t uuid_list[] = {\n\tL2CAP_UUID,\n\tPNP_INFO_SVCLASS_ID,\n\tPUBLIC_BROWSE_GROUP,\n\t0\n};\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg)\n{\n\tstruct btd_adapter *adapter = device->adapter;\n\tstruct browse_req *req;\n\tuuid_t uuid;\n\tint err;\n\n\treq = browse_request_new(device, BROWSE_SDP, msg);\n\tif (!req)\n\t\treturn -EBUSY;\n\n\tsdp_uuid16_create(&uuid, uuid_list[req->search_uuid++]);\n\n\treq->sdp_flags = get_sdp_flags(device);\n\n\terr = bt_search_service(btd_adapter_get_address(adapter),\n\t\t\t\t&device->bdaddr, &uuid, browse_cb, req, NULL,\n\t\t\t\treq->sdp_flags);\n\tif (err < 0) {\n\t\tbrowse_request_free(req);\n\t\treturn err;\n\t}\n\n\treturn err;\n}"
  },
  {
    "function_name": "get_sdp_flags",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "5238-5261",
    "snippet": "static uint16_t get_sdp_flags(struct btd_device *device)\n{\n\tuint16_t vid, pid;\n\n\tvid = btd_device_get_vendor(device);\n\tpid = btd_device_get_product(device);\n\n\t/* Sony DualShock 4 is not respecting negotiated L2CAP MTU. This might\n\t * results in SDP response being dropped by kernel. Workaround this by\n\t * forcing SDP code to use bigger MTU while connecting.\n\t */\n\tif (vid == 0x054c && pid == 0x05c4)\n\t\treturn SDP_LARGE_MTU;\n\n\tif (btd_adapter_ssp_enabled(device->adapter))\n\t\treturn 0;\n\n\t/* if no EIR try matching Sony DualShock 4 with name and class */\n\tif (!strncmp(device->name, \"Wireless Controller\", MAX_NAME_LENGTH) &&\n\t\t\tdevice->class == 0x2508)\n\t\treturn SDP_LARGE_MTU;\n\n\treturn 0;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "strncmp",
          "args": [
            "device->name",
            "\"Wireless Controller\"",
            "MAX_NAME_LENGTH"
          ],
          "line": 5256
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_adapter_ssp_enabled",
          "args": [
            "device->adapter"
          ],
          "line": 5252
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_ssp_enabled",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "7916-7922",
          "snippet": "bool btd_adapter_ssp_enabled(struct btd_adapter *adapter)\n{\n\tif (adapter->current_settings & MGMT_SETTING_SSP)\n\t\treturn true;\n\n\treturn false;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nbool btd_adapter_ssp_enabled(struct btd_adapter *adapter)\n{\n\tif (adapter->current_settings & MGMT_SETTING_SSP)\n\t\treturn true;\n\n\treturn false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_device_get_product",
          "args": [
            "device"
          ],
          "line": 5243
        },
        "resolved": true,
        "details": {
          "function_name": "btd_device_get_product",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "4042-4045",
          "snippet": "uint16_t btd_device_get_product(struct btd_device *device)\n{\n\treturn device->product;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nuint16_t btd_device_get_product(struct btd_device *device)\n{\n\treturn device->product;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_device_get_vendor",
          "args": [
            "device"
          ],
          "line": 5242
        },
        "resolved": true,
        "details": {
          "function_name": "btd_device_get_vendor_src",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "4037-4040",
          "snippet": "uint16_t btd_device_get_vendor_src(struct btd_device *device)\n{\n\treturn device->vendor_src;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nuint16_t btd_device_get_vendor_src(struct btd_device *device)\n{\n\treturn device->vendor_src;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic uint16_t get_sdp_flags(struct btd_device *device)\n{\n\tuint16_t vid, pid;\n\n\tvid = btd_device_get_vendor(device);\n\tpid = btd_device_get_product(device);\n\n\t/* Sony DualShock 4 is not respecting negotiated L2CAP MTU. This might\n\t * results in SDP response being dropped by kernel. Workaround this by\n\t * forcing SDP code to use bigger MTU while connecting.\n\t */\n\tif (vid == 0x054c && pid == 0x05c4)\n\t\treturn SDP_LARGE_MTU;\n\n\tif (btd_adapter_ssp_enabled(device->adapter))\n\t\treturn 0;\n\n\t/* if no EIR try matching Sony DualShock 4 with name and class */\n\tif (!strncmp(device->name, \"Wireless Controller\", MAX_NAME_LENGTH) &&\n\t\t\tdevice->class == 0x2508)\n\t\treturn SDP_LARGE_MTU;\n\n\treturn 0;\n}"
  },
  {
    "function_name": "device_browse_gatt",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "5192-5236",
    "snippet": "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg)\n{\n\tstruct btd_adapter *adapter = device->adapter;\n\tstruct browse_req *req;\n\n\treq = browse_request_new(device, BROWSE_GATT, msg);\n\tif (!req)\n\t\treturn -EBUSY;\n\n\tif (device->client) {\n\t\t/*\n\t\t * If discovery has not yet completed, then wait for gatt-client\n\t\t * to become ready.\n\t\t */\n\t\tif (!bt_gatt_client_is_ready(device->client))\n\t\t\treturn 0;\n\n\t\t/*\n\t\t * Services have already been discovered, so signal this browse\n\t\t * request as resolved.\n\t\t */\n\t\tdevice_svc_resolved(device, BROWSE_GATT, device->bdaddr_type,\n\t\t\t\t\t\t\t\t\t0);\n\t\treturn 0;\n\t}\n\n\tdevice->att_io = bt_io_connect(att_connect_cb,\n\t\t\t\tdevice, NULL, NULL,\n\t\t\t\tBT_IO_OPT_SOURCE_BDADDR,\n\t\t\t\tbtd_adapter_get_address(adapter),\n\t\t\t\tBT_IO_OPT_SOURCE_TYPE,\n\t\t\t\tbtd_adapter_get_address_type(adapter),\n\t\t\t\tBT_IO_OPT_DEST_BDADDR, &device->bdaddr,\n\t\t\t\tBT_IO_OPT_DEST_TYPE, device->bdaddr_type,\n\t\t\t\tBT_IO_OPT_CID, ATT_CID,\n\t\t\t\tBT_IO_OPT_SEC_LEVEL, BT_IO_SEC_LOW,\n\t\t\t\tBT_IO_OPT_INVALID);\n\n\tif (device->att_io == NULL) {\n\t\tbrowse_request_free(req);\n\t\treturn -EIO;\n\t}\n\n\treturn 0;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
      "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);",
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "browse_request_free",
          "args": [
            "req"
          ],
          "line": 5231
        },
        "resolved": true,
        "details": {
          "function_name": "browse_request_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "519-535",
          "snippet": "static void browse_request_free(struct browse_req *req)\n{\n\tstruct btd_device *device = req->device;\n\n\tif (device->browse == req)\n\t\tdevice->browse = NULL;\n\n\tif (req->listener_id)\n\t\tg_dbus_remove_watch(dbus_conn, req->listener_id);\n\tif (req->msg)\n\t\tdbus_message_unref(req->msg);\n\tg_slist_free_full(req->profiles_added, g_free);\n\tif (req->records)\n\t\tsdp_list_free(req->records, (sdp_free_func_t) sdp_record_free);\n\n\tg_free(req);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *dbus_conn = NULL;",
            "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
            "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);",
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void browse_request_free(struct browse_req *req)\n{\n\tstruct btd_device *device = req->device;\n\n\tif (device->browse == req)\n\t\tdevice->browse = NULL;\n\n\tif (req->listener_id)\n\t\tg_dbus_remove_watch(dbus_conn, req->listener_id);\n\tif (req->msg)\n\t\tdbus_message_unref(req->msg);\n\tg_slist_free_full(req->profiles_added, g_free);\n\tif (req->records)\n\t\tsdp_list_free(req->records, (sdp_free_func_t) sdp_record_free);\n\n\tg_free(req);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_io_connect",
          "args": [
            "att_connect_cb",
            "device",
            "NULL",
            "NULL",
            "BT_IO_OPT_SOURCE_BDADDR",
            "btd_adapter_get_address(adapter)",
            "BT_IO_OPT_SOURCE_TYPE",
            "btd_adapter_get_address_type(adapter)",
            "BT_IO_OPT_DEST_BDADDR",
            "&device->bdaddr",
            "BT_IO_OPT_DEST_TYPE",
            "device->bdaddr_type",
            "BT_IO_OPT_CID",
            "ATT_CID",
            "BT_IO_OPT_SEC_LEVEL",
            "BT_IO_SEC_LOW",
            "BT_IO_OPT_INVALID"
          ],
          "line": 5218
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_adapter_get_address_type",
          "args": [
            "adapter"
          ],
          "line": 5223
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_get_address_type",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "452-455",
          "snippet": "uint8_t btd_adapter_get_address_type(struct btd_adapter *adapter)\n{\n\treturn adapter->bdaddr_type;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nuint8_t btd_adapter_get_address_type(struct btd_adapter *adapter)\n{\n\treturn adapter->bdaddr_type;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_adapter_get_address",
          "args": [
            "adapter"
          ],
          "line": 5221
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_get_address",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "5881-5884",
          "snippet": "const bdaddr_t *btd_adapter_get_address(struct btd_adapter *adapter)\n{\n\treturn &adapter->bdaddr;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nconst bdaddr_t *btd_adapter_get_address(struct btd_adapter *adapter)\n{\n\treturn &adapter->bdaddr;\n}"
        }
      },
      {
        "call_info": {
          "callee": "device_svc_resolved",
          "args": [
            "device",
            "BROWSE_GATT",
            "device->bdaddr_type",
            "0"
          ],
          "line": 5213
        },
        "resolved": true,
        "details": {
          "function_name": "device_svc_resolved",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "2378-2426",
          "snippet": "static void device_svc_resolved(struct btd_device *dev, uint8_t browse_type,\n\t\t\t\t\t\tuint8_t bdaddr_type, int err)\n{\n\tstruct bearer_state *state = get_state(dev, bdaddr_type);\n\tstruct browse_req *req = dev->browse;\n\n\tDBG(\"%s err %d\", dev->path, err);\n\n\tstate->svc_resolved = true;\n\n\t/* Disconnection notification can happen before this function\n\t * gets called, so don't set svc_refreshed for a disconnected\n\t * device.\n\t */\n\tif (state->connected)\n\t\tdevice_set_svc_refreshed(dev, true);\n\n\tg_slist_free_full(dev->eir_uuids, g_free);\n\tdev->eir_uuids = NULL;\n\n\tif (dev->pending_paired) {\n\t\tg_dbus_emit_property_changed(dbus_conn, dev->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"Paired\");\n\t\tdev->pending_paired = false;\n\t}\n\n\tif (!dev->temporary) {\n\t\tstore_device_info(dev);\n\n\t\tif (bdaddr_type != BDADDR_BREDR && err == 0)\n\t\t\tstore_services(dev);\n\t}\n\n\tif (req)\n\t\tbrowse_request_complete(req, browse_type, bdaddr_type, err);\n\n\twhile (dev->svc_callbacks) {\n\t\tstruct svc_callback *cb = dev->svc_callbacks->data;\n\n\t\tif (cb->idle_id > 0)\n\t\t\tg_source_remove(cb->idle_id);\n\n\t\tcb->func(dev, err, cb->user_data);\n\n\t\tdev->svc_callbacks = g_slist_delete_link(dev->svc_callbacks,\n\t\t\t\t\t\t\tdev->svc_callbacks);\n\t\tg_free(cb);\n\t}\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *dbus_conn = NULL;",
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void device_svc_resolved(struct btd_device *dev, uint8_t browse_type,\n\t\t\t\t\t\tuint8_t bdaddr_type, int err)\n{\n\tstruct bearer_state *state = get_state(dev, bdaddr_type);\n\tstruct browse_req *req = dev->browse;\n\n\tDBG(\"%s err %d\", dev->path, err);\n\n\tstate->svc_resolved = true;\n\n\t/* Disconnection notification can happen before this function\n\t * gets called, so don't set svc_refreshed for a disconnected\n\t * device.\n\t */\n\tif (state->connected)\n\t\tdevice_set_svc_refreshed(dev, true);\n\n\tg_slist_free_full(dev->eir_uuids, g_free);\n\tdev->eir_uuids = NULL;\n\n\tif (dev->pending_paired) {\n\t\tg_dbus_emit_property_changed(dbus_conn, dev->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"Paired\");\n\t\tdev->pending_paired = false;\n\t}\n\n\tif (!dev->temporary) {\n\t\tstore_device_info(dev);\n\n\t\tif (bdaddr_type != BDADDR_BREDR && err == 0)\n\t\t\tstore_services(dev);\n\t}\n\n\tif (req)\n\t\tbrowse_request_complete(req, browse_type, bdaddr_type, err);\n\n\twhile (dev->svc_callbacks) {\n\t\tstruct svc_callback *cb = dev->svc_callbacks->data;\n\n\t\tif (cb->idle_id > 0)\n\t\t\tg_source_remove(cb->idle_id);\n\n\t\tcb->func(dev, err, cb->user_data);\n\n\t\tdev->svc_callbacks = g_slist_delete_link(dev->svc_callbacks,\n\t\t\t\t\t\t\tdev->svc_callbacks);\n\t\tg_free(cb);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_gatt_client_is_ready",
          "args": [
            "device->client"
          ],
          "line": 5206
        },
        "resolved": true,
        "details": {
          "function_name": "bt_gatt_client_is_ready",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-client.c",
          "lines": "2015-2018",
          "snippet": "bool bt_gatt_client_is_ready(struct bt_gatt_client *client)\n{\n\treturn (client && client->ready);\n}",
          "includes": [
            "#include <sys/uio.h>",
            "#include <limits.h>",
            "#include <assert.h>",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-helpers.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/att.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/uio.h>\n#include <limits.h>\n#include <assert.h>\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-helpers.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/att.h\"\n#include <config.h>\n\nbool bt_gatt_client_is_ready(struct bt_gatt_client *client)\n{\n\treturn (client && client->ready);\n}"
        }
      },
      {
        "call_info": {
          "callee": "browse_request_new",
          "args": [
            "device",
            "BROWSE_GATT",
            "msg"
          ],
          "line": 5197
        },
        "resolved": true,
        "details": {
          "function_name": "browse_request_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5160-5190",
          "snippet": "static struct browse_req *browse_request_new(struct btd_device *device,\n\t\t\t\t\t\t\tuint8_t type,\n\t\t\t\t\t\t\tDBusMessage *msg)\n{\n\tstruct browse_req *req;\n\n\tif (device->browse)\n\t\treturn NULL;\n\n\treq = g_new0(struct browse_req, 1);\n\treq->device = device;\n\treq->type = type;\n\n\tdevice->browse = req;\n\n\tif (!msg)\n\t\treturn req;\n\n\treq->msg = dbus_message_ref(msg);\n\n\t/*\n\t * Track the request owner to cancel it automatically if the owner\n\t * exits\n\t */\n\treq->listener_id = g_dbus_add_disconnect_watch(dbus_conn,\n\t\t\t\t\t\tdbus_message_get_sender(msg),\n\t\t\t\t\t\tbrowse_request_exit,\n\t\t\t\t\t\treq, NULL);\n\n\treturn req;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *dbus_conn = NULL;",
            "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
            "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);",
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic struct browse_req *browse_request_new(struct btd_device *device,\n\t\t\t\t\t\t\tuint8_t type,\n\t\t\t\t\t\t\tDBusMessage *msg)\n{\n\tstruct browse_req *req;\n\n\tif (device->browse)\n\t\treturn NULL;\n\n\treq = g_new0(struct browse_req, 1);\n\treq->device = device;\n\treq->type = type;\n\n\tdevice->browse = req;\n\n\tif (!msg)\n\t\treturn req;\n\n\treq->msg = dbus_message_ref(msg);\n\n\t/*\n\t * Track the request owner to cancel it automatically if the owner\n\t * exits\n\t */\n\treq->listener_id = g_dbus_add_disconnect_watch(dbus_conn,\n\t\t\t\t\t\tdbus_message_get_sender(msg),\n\t\t\t\t\t\tbrowse_request_exit,\n\t\t\t\t\t\treq, NULL);\n\n\treturn req;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg)\n{\n\tstruct btd_adapter *adapter = device->adapter;\n\tstruct browse_req *req;\n\n\treq = browse_request_new(device, BROWSE_GATT, msg);\n\tif (!req)\n\t\treturn -EBUSY;\n\n\tif (device->client) {\n\t\t/*\n\t\t * If discovery has not yet completed, then wait for gatt-client\n\t\t * to become ready.\n\t\t */\n\t\tif (!bt_gatt_client_is_ready(device->client))\n\t\t\treturn 0;\n\n\t\t/*\n\t\t * Services have already been discovered, so signal this browse\n\t\t * request as resolved.\n\t\t */\n\t\tdevice_svc_resolved(device, BROWSE_GATT, device->bdaddr_type,\n\t\t\t\t\t\t\t\t\t0);\n\t\treturn 0;\n\t}\n\n\tdevice->att_io = bt_io_connect(att_connect_cb,\n\t\t\t\tdevice, NULL, NULL,\n\t\t\t\tBT_IO_OPT_SOURCE_BDADDR,\n\t\t\t\tbtd_adapter_get_address(adapter),\n\t\t\t\tBT_IO_OPT_SOURCE_TYPE,\n\t\t\t\tbtd_adapter_get_address_type(adapter),\n\t\t\t\tBT_IO_OPT_DEST_BDADDR, &device->bdaddr,\n\t\t\t\tBT_IO_OPT_DEST_TYPE, device->bdaddr_type,\n\t\t\t\tBT_IO_OPT_CID, ATT_CID,\n\t\t\t\tBT_IO_OPT_SEC_LEVEL, BT_IO_SEC_LOW,\n\t\t\t\tBT_IO_OPT_INVALID);\n\n\tif (device->att_io == NULL) {\n\t\tbrowse_request_free(req);\n\t\treturn -EIO;\n\t}\n\n\treturn 0;\n}"
  },
  {
    "function_name": "browse_request_new",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "5160-5190",
    "snippet": "static struct browse_req *browse_request_new(struct btd_device *device,\n\t\t\t\t\t\t\tuint8_t type,\n\t\t\t\t\t\t\tDBusMessage *msg)\n{\n\tstruct browse_req *req;\n\n\tif (device->browse)\n\t\treturn NULL;\n\n\treq = g_new0(struct browse_req, 1);\n\treq->device = device;\n\treq->type = type;\n\n\tdevice->browse = req;\n\n\tif (!msg)\n\t\treturn req;\n\n\treq->msg = dbus_message_ref(msg);\n\n\t/*\n\t * Track the request owner to cancel it automatically if the owner\n\t * exits\n\t */\n\treq->listener_id = g_dbus_add_disconnect_watch(dbus_conn,\n\t\t\t\t\t\tdbus_message_get_sender(msg),\n\t\t\t\t\t\tbrowse_request_exit,\n\t\t\t\t\t\treq, NULL);\n\n\treturn req;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static DBusConnection *dbus_conn = NULL;",
      "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
      "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);",
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_dbus_add_disconnect_watch",
          "args": [
            "dbus_conn",
            "dbus_message_get_sender(msg)",
            "browse_request_exit",
            "req",
            "NULL"
          ],
          "line": 5184
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_get_sender",
          "args": [
            "msg"
          ],
          "line": 5185
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_ref",
          "args": [
            "msg"
          ],
          "line": 5178
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_new0",
          "args": [
            "structbrowse_req",
            "1"
          ],
          "line": 5169
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic struct browse_req *browse_request_new(struct btd_device *device,\n\t\t\t\t\t\t\tuint8_t type,\n\t\t\t\t\t\t\tDBusMessage *msg)\n{\n\tstruct browse_req *req;\n\n\tif (device->browse)\n\t\treturn NULL;\n\n\treq = g_new0(struct browse_req, 1);\n\treq->device = device;\n\treq->type = type;\n\n\tdevice->browse = req;\n\n\tif (!msg)\n\t\treturn req;\n\n\treq->msg = dbus_message_ref(msg);\n\n\t/*\n\t * Track the request owner to cancel it automatically if the owner\n\t * exits\n\t */\n\treq->listener_id = g_dbus_add_disconnect_watch(dbus_conn,\n\t\t\t\t\t\tdbus_message_get_sender(msg),\n\t\t\t\t\t\tbrowse_request_exit,\n\t\t\t\t\t\treq, NULL);\n\n\treturn req;\n}"
  },
  {
    "function_name": "device_connect_le",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "5103-5158",
    "snippet": "int device_connect_le(struct btd_device *dev)\n{\n\tstruct btd_adapter *adapter = dev->adapter;\n\tBtIOSecLevel sec_level;\n\tGIOChannel *io;\n\tGError *gerr = NULL;\n\tchar addr[18];\n\n\t/* There is one connection attempt going on */\n\tif (dev->att_io)\n\t\treturn -EALREADY;\n\n\tba2str(&dev->bdaddr, addr);\n\n\tDBG(\"Connection attempt to: %s\", addr);\n\n\tif (dev->le_state.paired)\n\t\tsec_level = BT_IO_SEC_MEDIUM;\n\telse\n\t\tsec_level = BT_IO_SEC_LOW;\n\n\t/*\n\t * This connection will help us catch any PDUs that comes before\n\t * pairing finishes\n\t */\n\tio = bt_io_connect(att_connect_cb, dev, NULL, &gerr,\n\t\t\tBT_IO_OPT_SOURCE_BDADDR,\n\t\t\tbtd_adapter_get_address(adapter),\n\t\t\tBT_IO_OPT_SOURCE_TYPE,\n\t\t\tbtd_adapter_get_address_type(adapter),\n\t\t\tBT_IO_OPT_DEST_BDADDR, &dev->bdaddr,\n\t\t\tBT_IO_OPT_DEST_TYPE, dev->bdaddr_type,\n\t\t\tBT_IO_OPT_CID, ATT_CID,\n\t\t\tBT_IO_OPT_SEC_LEVEL, sec_level,\n\t\t\tBT_IO_OPT_INVALID);\n\n\tif (io == NULL) {\n\t\tif (dev->bonding) {\n\t\t\tDBusMessage *reply = btd_error_failed(\n\t\t\t\t\tdev->bonding->msg, gerr->message);\n\n\t\t\tg_dbus_send_message(dbus_conn, reply);\n\t\t\tbonding_request_cancel(dev->bonding);\n\t\t\tbonding_request_free(dev->bonding);\n\t\t}\n\n\t\terror(\"ATT bt_io_connect(%s): %s\", addr, gerr->message);\n\t\tg_error_free(gerr);\n\t\treturn -EIO;\n\t}\n\n\t/* Keep this, so we can cancel the connection */\n\tdev->att_io = io;\n\n\treturn 0;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static DBusConnection *dbus_conn = NULL;",
      "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
      "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_error_free",
          "args": [
            "gerr"
          ],
          "line": 5150
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"ATT bt_io_connect(%s): %s\"",
            "addr",
            "gerr->message"
          ],
          "line": 5149
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/log.c",
          "lines": "199-213",
          "snippet": "void btd_error(uint16_t index, const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_ERR, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(index, LOG_ERR, format, ap);\n\tva_end(ap);\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdarg.h>",
            "#include <syslog.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int logging_fd = -1;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"src/shared/util.h\"\n#include \"lib/hci.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int logging_fd = -1;\n\nvoid btd_error(uint16_t index, const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_ERR, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(index, LOG_ERR, format, ap);\n\tva_end(ap);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bonding_request_free",
          "args": [
            "dev->bonding"
          ],
          "line": 5146
        },
        "resolved": true,
        "details": {
          "function_name": "bonding_request_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "2513-2540",
          "snippet": "static void bonding_request_free(struct bonding_req *bonding)\n{\n\tif (!bonding)\n\t\treturn;\n\n\tif (bonding->listener_id)\n\t\tg_dbus_remove_watch(dbus_conn, bonding->listener_id);\n\n\tif (bonding->msg)\n\t\tdbus_message_unref(bonding->msg);\n\n\tif (bonding->cb_iter)\n\t\tg_free(bonding->cb_iter);\n\n\tif (bonding->agent) {\n\t\tagent_cancel(bonding->agent);\n\t\tagent_unref(bonding->agent);\n\t\tbonding->agent = NULL;\n\t}\n\n\tif (bonding->retry_timer)\n\t\tg_source_remove(bonding->retry_timer);\n\n\tif (bonding->device)\n\t\tbonding->device->bonding = NULL;\n\n\tg_free(bonding);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *dbus_conn = NULL;",
            "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
            "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);",
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void bonding_request_free(struct bonding_req *bonding)\n{\n\tif (!bonding)\n\t\treturn;\n\n\tif (bonding->listener_id)\n\t\tg_dbus_remove_watch(dbus_conn, bonding->listener_id);\n\n\tif (bonding->msg)\n\t\tdbus_message_unref(bonding->msg);\n\n\tif (bonding->cb_iter)\n\t\tg_free(bonding->cb_iter);\n\n\tif (bonding->agent) {\n\t\tagent_cancel(bonding->agent);\n\t\tagent_unref(bonding->agent);\n\t\tbonding->agent = NULL;\n\t}\n\n\tif (bonding->retry_timer)\n\t\tg_source_remove(bonding->retry_timer);\n\n\tif (bonding->device)\n\t\tbonding->device->bonding = NULL;\n\n\tg_free(bonding);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bonding_request_cancel",
          "args": [
            "dev->bonding"
          ],
          "line": 5145
        },
        "resolved": true,
        "details": {
          "function_name": "bonding_request_cancel",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "1423-1429",
          "snippet": "static void bonding_request_cancel(struct bonding_req *bonding)\n{\n\tstruct btd_device *device = bonding->device;\n\tstruct btd_adapter *adapter = device->adapter;\n\n\tadapter_cancel_bonding(adapter, &device->bdaddr, device->bdaddr_type);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void bonding_request_cancel(struct bonding_req *bonding)\n{\n\tstruct btd_device *device = bonding->device;\n\tstruct btd_adapter *adapter = device->adapter;\n\n\tadapter_cancel_bonding(adapter, &device->bdaddr, device->bdaddr_type);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_send_message",
          "args": [
            "dbus_conn",
            "reply"
          ],
          "line": 5144
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_error_failed",
          "args": [
            "dev->bonding->msg",
            "gerr->message"
          ],
          "line": 5141
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "124-128",
          "snippet": "DBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_io_connect",
          "args": [
            "att_connect_cb",
            "dev",
            "NULL",
            "&gerr",
            "BT_IO_OPT_SOURCE_BDADDR",
            "btd_adapter_get_address(adapter)",
            "BT_IO_OPT_SOURCE_TYPE",
            "btd_adapter_get_address_type(adapter)",
            "BT_IO_OPT_DEST_BDADDR",
            "&dev->bdaddr",
            "BT_IO_OPT_DEST_TYPE",
            "dev->bdaddr_type",
            "BT_IO_OPT_CID",
            "ATT_CID",
            "BT_IO_OPT_SEC_LEVEL",
            "sec_level",
            "BT_IO_OPT_INVALID"
          ],
          "line": 5128
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_adapter_get_address_type",
          "args": [
            "adapter"
          ],
          "line": 5132
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_get_address_type",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "452-455",
          "snippet": "uint8_t btd_adapter_get_address_type(struct btd_adapter *adapter)\n{\n\treturn adapter->bdaddr_type;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nuint8_t btd_adapter_get_address_type(struct btd_adapter *adapter)\n{\n\treturn adapter->bdaddr_type;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_adapter_get_address",
          "args": [
            "adapter"
          ],
          "line": 5130
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_get_address",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "5881-5884",
          "snippet": "const bdaddr_t *btd_adapter_get_address(struct btd_adapter *adapter)\n{\n\treturn &adapter->bdaddr;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nconst bdaddr_t *btd_adapter_get_address(struct btd_adapter *adapter)\n{\n\treturn &adapter->bdaddr;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Connection attempt to: %s\"",
            "addr"
          ],
          "line": 5117
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ba2str",
          "args": [
            "&dev->bdaddr",
            "addr"
          ],
          "line": 5115
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\n\nint device_connect_le(struct btd_device *dev)\n{\n\tstruct btd_adapter *adapter = dev->adapter;\n\tBtIOSecLevel sec_level;\n\tGIOChannel *io;\n\tGError *gerr = NULL;\n\tchar addr[18];\n\n\t/* There is one connection attempt going on */\n\tif (dev->att_io)\n\t\treturn -EALREADY;\n\n\tba2str(&dev->bdaddr, addr);\n\n\tDBG(\"Connection attempt to: %s\", addr);\n\n\tif (dev->le_state.paired)\n\t\tsec_level = BT_IO_SEC_MEDIUM;\n\telse\n\t\tsec_level = BT_IO_SEC_LOW;\n\n\t/*\n\t * This connection will help us catch any PDUs that comes before\n\t * pairing finishes\n\t */\n\tio = bt_io_connect(att_connect_cb, dev, NULL, &gerr,\n\t\t\tBT_IO_OPT_SOURCE_BDADDR,\n\t\t\tbtd_adapter_get_address(adapter),\n\t\t\tBT_IO_OPT_SOURCE_TYPE,\n\t\t\tbtd_adapter_get_address_type(adapter),\n\t\t\tBT_IO_OPT_DEST_BDADDR, &dev->bdaddr,\n\t\t\tBT_IO_OPT_DEST_TYPE, dev->bdaddr_type,\n\t\t\tBT_IO_OPT_CID, ATT_CID,\n\t\t\tBT_IO_OPT_SEC_LEVEL, sec_level,\n\t\t\tBT_IO_OPT_INVALID);\n\n\tif (io == NULL) {\n\t\tif (dev->bonding) {\n\t\t\tDBusMessage *reply = btd_error_failed(\n\t\t\t\t\tdev->bonding->msg, gerr->message);\n\n\t\t\tg_dbus_send_message(dbus_conn, reply);\n\t\t\tbonding_request_cancel(dev->bonding);\n\t\t\tbonding_request_free(dev->bonding);\n\t\t}\n\n\t\terror(\"ATT bt_io_connect(%s): %s\", addr, gerr->message);\n\t\tg_error_free(gerr);\n\t\treturn -EIO;\n\t}\n\n\t/* Keep this, so we can cancel the connection */\n\tdev->att_io = io;\n\n\treturn 0;\n}"
  },
  {
    "function_name": "att_connect_cb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "5035-5101",
    "snippet": "static void att_connect_cb(GIOChannel *io, GError *gerr, gpointer user_data)\n{\n\tstruct btd_device *device = user_data;\n\tDBusMessage *reply;\n\tuint8_t io_cap;\n\tint err = 0;\n\n\tg_io_channel_unref(device->att_io);\n\tdevice->att_io = NULL;\n\n\tif (gerr) {\n\t\tDBG(\"%s\", gerr->message);\n\n\t\tif (g_error_matches(gerr, BT_IO_ERROR, ECONNABORTED))\n\t\t\tgoto done;\n\n\t\tif (device_get_auto_connect(device)) {\n\t\t\tDBG(\"Enabling automatic connections\");\n\t\t\tadapter_connect_list_add(device->adapter, device);\n\t\t}\n\n\t\tif (device->browse)\n\t\t\tbrowse_request_complete(device->browse,\n\t\t\t\t\t\tBROWSE_GATT,\n\t\t\t\t\t\tdevice->bdaddr_type,\n\t\t\t\t\t\t-ECONNABORTED);\n\n\t\terr = -ECONNABORTED;\n\t\tgoto done;\n\t}\n\n\tif (!device_attach_att(device, io))\n\t\tgoto done;\n\n\tif (!device->bonding)\n\t\tgoto done;\n\n\tif (device->bonding->agent)\n\t\tio_cap = agent_get_io_capability(device->bonding->agent);\n\telse\n\t\tio_cap = IO_CAPABILITY_NOINPUTNOOUTPUT;\n\n\terr = adapter_create_bonding(device->adapter, &device->bdaddr,\n\t\t\t\t\tdevice->bdaddr_type, io_cap);\ndone:\n\tif (device->bonding && err < 0) {\n\t\treply = btd_error_failed(device->bonding->msg, strerror(-err));\n\t\tg_dbus_send_message(dbus_conn, reply);\n\t\tbonding_request_cancel(device->bonding);\n\t\tbonding_request_free(device->bonding);\n\t}\n\n\tif (!err)\n\t\tdevice_browse_gatt(device, NULL);\n\n\tif (device->connect) {\n\t\tif (err < 0)\n\t\t\treply = btd_error_failed(device->connect,\n\t\t\t\t\t\t\tstrerror(-err));\n\t\telse\n\t\t\treply = dbus_message_new_method_return(device->connect);\n\n\t\tg_dbus_send_message(dbus_conn, reply);\n\t\tdbus_message_unref(device->connect);\n\t\tdevice->connect = NULL;\n\t}\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static DBusConnection *dbus_conn = NULL;",
      "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
      "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);",
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_unref",
          "args": [
            "device->connect"
          ],
          "line": 5098
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_send_message",
          "args": [
            "dbus_conn",
            "reply"
          ],
          "line": 5097
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_new_method_return",
          "args": [
            "device->connect"
          ],
          "line": 5095
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_error_failed",
          "args": [
            "device->connect",
            "strerror(-err)"
          ],
          "line": 5092
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "124-128",
          "snippet": "DBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "strerror",
          "args": [
            "-err"
          ],
          "line": 5093
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device_browse_gatt",
          "args": [
            "device",
            "NULL"
          ],
          "line": 5088
        },
        "resolved": true,
        "details": {
          "function_name": "device_browse_gatt",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5192-5236",
          "snippet": "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg)\n{\n\tstruct btd_adapter *adapter = device->adapter;\n\tstruct browse_req *req;\n\n\treq = browse_request_new(device, BROWSE_GATT, msg);\n\tif (!req)\n\t\treturn -EBUSY;\n\n\tif (device->client) {\n\t\t/*\n\t\t * If discovery has not yet completed, then wait for gatt-client\n\t\t * to become ready.\n\t\t */\n\t\tif (!bt_gatt_client_is_ready(device->client))\n\t\t\treturn 0;\n\n\t\t/*\n\t\t * Services have already been discovered, so signal this browse\n\t\t * request as resolved.\n\t\t */\n\t\tdevice_svc_resolved(device, BROWSE_GATT, device->bdaddr_type,\n\t\t\t\t\t\t\t\t\t0);\n\t\treturn 0;\n\t}\n\n\tdevice->att_io = bt_io_connect(att_connect_cb,\n\t\t\t\tdevice, NULL, NULL,\n\t\t\t\tBT_IO_OPT_SOURCE_BDADDR,\n\t\t\t\tbtd_adapter_get_address(adapter),\n\t\t\t\tBT_IO_OPT_SOURCE_TYPE,\n\t\t\t\tbtd_adapter_get_address_type(adapter),\n\t\t\t\tBT_IO_OPT_DEST_BDADDR, &device->bdaddr,\n\t\t\t\tBT_IO_OPT_DEST_TYPE, device->bdaddr_type,\n\t\t\t\tBT_IO_OPT_CID, ATT_CID,\n\t\t\t\tBT_IO_OPT_SEC_LEVEL, BT_IO_SEC_LOW,\n\t\t\t\tBT_IO_OPT_INVALID);\n\n\tif (device->att_io == NULL) {\n\t\tbrowse_request_free(req);\n\t\treturn -EIO;\n\t}\n\n\treturn 0;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
            "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);",
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg)\n{\n\tstruct btd_adapter *adapter = device->adapter;\n\tstruct browse_req *req;\n\n\treq = browse_request_new(device, BROWSE_GATT, msg);\n\tif (!req)\n\t\treturn -EBUSY;\n\n\tif (device->client) {\n\t\t/*\n\t\t * If discovery has not yet completed, then wait for gatt-client\n\t\t * to become ready.\n\t\t */\n\t\tif (!bt_gatt_client_is_ready(device->client))\n\t\t\treturn 0;\n\n\t\t/*\n\t\t * Services have already been discovered, so signal this browse\n\t\t * request as resolved.\n\t\t */\n\t\tdevice_svc_resolved(device, BROWSE_GATT, device->bdaddr_type,\n\t\t\t\t\t\t\t\t\t0);\n\t\treturn 0;\n\t}\n\n\tdevice->att_io = bt_io_connect(att_connect_cb,\n\t\t\t\tdevice, NULL, NULL,\n\t\t\t\tBT_IO_OPT_SOURCE_BDADDR,\n\t\t\t\tbtd_adapter_get_address(adapter),\n\t\t\t\tBT_IO_OPT_SOURCE_TYPE,\n\t\t\t\tbtd_adapter_get_address_type(adapter),\n\t\t\t\tBT_IO_OPT_DEST_BDADDR, &device->bdaddr,\n\t\t\t\tBT_IO_OPT_DEST_TYPE, device->bdaddr_type,\n\t\t\t\tBT_IO_OPT_CID, ATT_CID,\n\t\t\t\tBT_IO_OPT_SEC_LEVEL, BT_IO_SEC_LOW,\n\t\t\t\tBT_IO_OPT_INVALID);\n\n\tif (device->att_io == NULL) {\n\t\tbrowse_request_free(req);\n\t\treturn -EIO;\n\t}\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bonding_request_free",
          "args": [
            "device->bonding"
          ],
          "line": 5084
        },
        "resolved": true,
        "details": {
          "function_name": "bonding_request_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "2513-2540",
          "snippet": "static void bonding_request_free(struct bonding_req *bonding)\n{\n\tif (!bonding)\n\t\treturn;\n\n\tif (bonding->listener_id)\n\t\tg_dbus_remove_watch(dbus_conn, bonding->listener_id);\n\n\tif (bonding->msg)\n\t\tdbus_message_unref(bonding->msg);\n\n\tif (bonding->cb_iter)\n\t\tg_free(bonding->cb_iter);\n\n\tif (bonding->agent) {\n\t\tagent_cancel(bonding->agent);\n\t\tagent_unref(bonding->agent);\n\t\tbonding->agent = NULL;\n\t}\n\n\tif (bonding->retry_timer)\n\t\tg_source_remove(bonding->retry_timer);\n\n\tif (bonding->device)\n\t\tbonding->device->bonding = NULL;\n\n\tg_free(bonding);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *dbus_conn = NULL;",
            "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
            "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);",
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void bonding_request_free(struct bonding_req *bonding)\n{\n\tif (!bonding)\n\t\treturn;\n\n\tif (bonding->listener_id)\n\t\tg_dbus_remove_watch(dbus_conn, bonding->listener_id);\n\n\tif (bonding->msg)\n\t\tdbus_message_unref(bonding->msg);\n\n\tif (bonding->cb_iter)\n\t\tg_free(bonding->cb_iter);\n\n\tif (bonding->agent) {\n\t\tagent_cancel(bonding->agent);\n\t\tagent_unref(bonding->agent);\n\t\tbonding->agent = NULL;\n\t}\n\n\tif (bonding->retry_timer)\n\t\tg_source_remove(bonding->retry_timer);\n\n\tif (bonding->device)\n\t\tbonding->device->bonding = NULL;\n\n\tg_free(bonding);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bonding_request_cancel",
          "args": [
            "device->bonding"
          ],
          "line": 5083
        },
        "resolved": true,
        "details": {
          "function_name": "bonding_request_cancel",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "1423-1429",
          "snippet": "static void bonding_request_cancel(struct bonding_req *bonding)\n{\n\tstruct btd_device *device = bonding->device;\n\tstruct btd_adapter *adapter = device->adapter;\n\n\tadapter_cancel_bonding(adapter, &device->bdaddr, device->bdaddr_type);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void bonding_request_cancel(struct bonding_req *bonding)\n{\n\tstruct btd_device *device = bonding->device;\n\tstruct btd_adapter *adapter = device->adapter;\n\n\tadapter_cancel_bonding(adapter, &device->bdaddr, device->bdaddr_type);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_send_message",
          "args": [
            "dbus_conn",
            "reply"
          ],
          "line": 5082
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strerror",
          "args": [
            "-err"
          ],
          "line": 5081
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "adapter_create_bonding",
          "args": [
            "device->adapter",
            "&device->bdaddr",
            "device->bdaddr_type",
            "io_cap"
          ],
          "line": 5077
        },
        "resolved": true,
        "details": {
          "function_name": "adapter_create_bonding",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "7221-7233",
          "snippet": "int adapter_create_bonding(struct btd_adapter *adapter, const bdaddr_t *bdaddr,\n\t\t\t\t\tuint8_t addr_type, uint8_t io_cap)\n{\n\tif (adapter->pair_device_id > 0) {\n\t\tbtd_error(adapter->dev_id,\n\t\t\t\"Unable pair since another pairing is in progress\");\n\t\treturn -EBUSY;\n\t}\n\n\tsuspend_discovery(adapter);\n\n\treturn adapter_bonding_attempt(adapter, bdaddr, addr_type, io_cap);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nint adapter_create_bonding(struct btd_adapter *adapter, const bdaddr_t *bdaddr,\n\t\t\t\t\tuint8_t addr_type, uint8_t io_cap)\n{\n\tif (adapter->pair_device_id > 0) {\n\t\tbtd_error(adapter->dev_id,\n\t\t\t\"Unable pair since another pairing is in progress\");\n\t\treturn -EBUSY;\n\t}\n\n\tsuspend_discovery(adapter);\n\n\treturn adapter_bonding_attempt(adapter, bdaddr, addr_type, io_cap);\n}"
        }
      },
      {
        "call_info": {
          "callee": "agent_get_io_capability",
          "args": [
            "device->bonding->agent"
          ],
          "line": 5073
        },
        "resolved": true,
        "details": {
          "function_name": "agent_get_io_capability",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "900-903",
          "snippet": "uint8_t agent_get_io_capability(struct agent *agent)\n{\n\treturn agent->capability;\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nuint8_t agent_get_io_capability(struct agent *agent)\n{\n\treturn agent->capability;\n}"
        }
      },
      {
        "call_info": {
          "callee": "device_attach_att",
          "args": [
            "device",
            "io"
          ],
          "line": 5066
        },
        "resolved": true,
        "details": {
          "function_name": "device_attach_att",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "4952-5033",
          "snippet": "bool device_attach_att(struct btd_device *dev, GIOChannel *io)\n{\n\tGError *gerr = NULL;\n\tGAttrib *attrib;\n\tBtIOSecLevel sec_level;\n\tuint16_t mtu;\n\tuint16_t cid;\n\tstruct btd_gatt_database *database;\n\tconst bdaddr_t *dst;\n\tchar dstaddr[18];\n\n\tbt_io_get(io, &gerr, BT_IO_OPT_SEC_LEVEL, &sec_level,\n\t\t\t\t\t\tBT_IO_OPT_IMTU, &mtu,\n\t\t\t\t\t\tBT_IO_OPT_CID, &cid,\n\t\t\t\t\t\tBT_IO_OPT_INVALID);\n\n\tif (gerr) {\n\t\terror(\"bt_io_get: %s\", gerr->message);\n\t\tg_error_free(gerr);\n\t\treturn false;\n\t}\n\n\tif (sec_level == BT_IO_SEC_LOW && dev->le_state.paired) {\n\t\tDBG(\"Elevating security level since LTK is available\");\n\n\t\tsec_level = BT_IO_SEC_MEDIUM;\n\t\tbt_io_set(io, &gerr, BT_IO_OPT_SEC_LEVEL, sec_level,\n\t\t\t\t\t\t\tBT_IO_OPT_INVALID);\n\t\tif (gerr) {\n\t\t\terror(\"bt_io_set: %s\", gerr->message);\n\t\t\tg_error_free(gerr);\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tdev->att_mtu = MIN(mtu, main_opts.gatt_mtu);\n\tattrib = g_attrib_new(io,\n\t\t\tcid == ATT_CID ? BT_ATT_DEFAULT_LE_MTU : dev->att_mtu,\n\t\t\tfalse);\n\tif (!attrib) {\n\t\terror(\"Unable to create new GAttrib instance\");\n\t\treturn false;\n\t}\n\n\tdev->attrib = attrib;\n\tdev->att = g_attrib_get_att(attrib);\n\n\tbt_att_ref(dev->att);\n\n\tdev->att_disconn_id = bt_att_register_disconnect(dev->att,\n\t\t\t\t\t\tatt_disconnected_cb, dev, NULL);\n\tbt_att_set_close_on_unref(dev->att, true);\n\n\tif (dev->local_csrk)\n\t\tbt_att_set_local_key(dev->att, dev->local_csrk->key,\n\t\t\t\t\t\t\tlocal_counter, dev);\n\n\tif (dev->remote_csrk)\n\t\tbt_att_set_remote_key(dev->att, dev->remote_csrk->key,\n\t\t\t\t\t\t\tremote_counter, dev);\n\n\tdatabase = btd_adapter_get_database(dev->adapter);\n\n\tdst = device_get_address(dev);\n\tba2str(dst, dstaddr);\n\n\tif (gatt_db_isempty(dev->db))\n\t\tload_gatt_db(dev, btd_adapter_get_storage_dir(dev->adapter),\n\t\t\t\t\t\t\t\tdstaddr);\n\n\tgatt_client_init(dev);\n\tgatt_server_init(dev, database);\n\n\t/*\n\t * Remove the device from the connect_list and give the passive\n\t * scanning another chance to be restarted in case there are\n\t * other devices in the connect_list.\n\t */\n\tadapter_connect_list_remove(dev->adapter, dev);\n\n\treturn true;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nbool device_attach_att(struct btd_device *dev, GIOChannel *io)\n{\n\tGError *gerr = NULL;\n\tGAttrib *attrib;\n\tBtIOSecLevel sec_level;\n\tuint16_t mtu;\n\tuint16_t cid;\n\tstruct btd_gatt_database *database;\n\tconst bdaddr_t *dst;\n\tchar dstaddr[18];\n\n\tbt_io_get(io, &gerr, BT_IO_OPT_SEC_LEVEL, &sec_level,\n\t\t\t\t\t\tBT_IO_OPT_IMTU, &mtu,\n\t\t\t\t\t\tBT_IO_OPT_CID, &cid,\n\t\t\t\t\t\tBT_IO_OPT_INVALID);\n\n\tif (gerr) {\n\t\terror(\"bt_io_get: %s\", gerr->message);\n\t\tg_error_free(gerr);\n\t\treturn false;\n\t}\n\n\tif (sec_level == BT_IO_SEC_LOW && dev->le_state.paired) {\n\t\tDBG(\"Elevating security level since LTK is available\");\n\n\t\tsec_level = BT_IO_SEC_MEDIUM;\n\t\tbt_io_set(io, &gerr, BT_IO_OPT_SEC_LEVEL, sec_level,\n\t\t\t\t\t\t\tBT_IO_OPT_INVALID);\n\t\tif (gerr) {\n\t\t\terror(\"bt_io_set: %s\", gerr->message);\n\t\t\tg_error_free(gerr);\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tdev->att_mtu = MIN(mtu, main_opts.gatt_mtu);\n\tattrib = g_attrib_new(io,\n\t\t\tcid == ATT_CID ? BT_ATT_DEFAULT_LE_MTU : dev->att_mtu,\n\t\t\tfalse);\n\tif (!attrib) {\n\t\terror(\"Unable to create new GAttrib instance\");\n\t\treturn false;\n\t}\n\n\tdev->attrib = attrib;\n\tdev->att = g_attrib_get_att(attrib);\n\n\tbt_att_ref(dev->att);\n\n\tdev->att_disconn_id = bt_att_register_disconnect(dev->att,\n\t\t\t\t\t\tatt_disconnected_cb, dev, NULL);\n\tbt_att_set_close_on_unref(dev->att, true);\n\n\tif (dev->local_csrk)\n\t\tbt_att_set_local_key(dev->att, dev->local_csrk->key,\n\t\t\t\t\t\t\tlocal_counter, dev);\n\n\tif (dev->remote_csrk)\n\t\tbt_att_set_remote_key(dev->att, dev->remote_csrk->key,\n\t\t\t\t\t\t\tremote_counter, dev);\n\n\tdatabase = btd_adapter_get_database(dev->adapter);\n\n\tdst = device_get_address(dev);\n\tba2str(dst, dstaddr);\n\n\tif (gatt_db_isempty(dev->db))\n\t\tload_gatt_db(dev, btd_adapter_get_storage_dir(dev->adapter),\n\t\t\t\t\t\t\t\tdstaddr);\n\n\tgatt_client_init(dev);\n\tgatt_server_init(dev, database);\n\n\t/*\n\t * Remove the device from the connect_list and give the passive\n\t * scanning another chance to be restarted in case there are\n\t * other devices in the connect_list.\n\t */\n\tadapter_connect_list_remove(dev->adapter, dev);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "browse_request_complete",
          "args": [
            "device->browse",
            "BROWSE_GATT",
            "device->bdaddr_type",
            "-ECONNABORTED"
          ],
          "line": 5057
        },
        "resolved": true,
        "details": {
          "function_name": "browse_request_complete",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "2298-2365",
          "snippet": "static void browse_request_complete(struct browse_req *req, uint8_t type,\n\t\t\t\t\t\tuint8_t bdaddr_type, int err)\n{\n\tstruct btd_device *dev = req->device;\n\tDBusMessage *reply = NULL;\n\tDBusMessage *msg;\n\n\tif (req->type != type)\n\t\treturn;\n\n\tif (!req->msg)\n\t\tgoto done;\n\n\tif (dbus_message_is_method_call(req->msg, DEVICE_INTERFACE, \"Pair\")) {\n\t\tif (!device_is_paired(dev, bdaddr_type)) {\n\t\t\treply = btd_error_failed(req->msg, \"Not paired\");\n\t\t\tgoto done;\n\t\t}\n\n\t\tif (dev->pending_paired) {\n\t\t\tg_dbus_emit_property_changed(dbus_conn, dev->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"Paired\");\n\t\t\tdev->pending_paired = false;\n\t\t}\n\n\t\t/* Disregard browse errors in case of Pair */\n\t\treply = g_dbus_create_reply(req->msg, DBUS_TYPE_INVALID);\n\t\tgoto done;\n\t}\n\n\tif (err) {\n\t\t/* Fallback to LE bearer if supported */\n\t\tif (err == -EHOSTDOWN && bdaddr_type == BDADDR_BREDR &&\n\t\t\t\tdev->le && !dev->le_state.connected) {\n\t\t\terr = device_connect_le(dev);\n\t\t\tif (err == 0)\n\t\t\t\tgoto done;\n\t\t}\n\t\treply = btd_error_failed(req->msg, strerror(-err));\n\t\tgoto done;\n\t}\n\n\t/* if successfully resolved services we need to free browsing request\n\t * before passing message back to connect functions, otherwise\n\t * device->browse is set and \"InProgress\" error is returned instead\n\t * of actually connecting services\n\t */\n\tmsg = dbus_message_ref(req->msg);\n\tbrowse_request_free(req);\n\treq = NULL;\n\n\tif (dbus_message_is_method_call(msg, DEVICE_INTERFACE, \"Connect\"))\n\t\treply = dev_connect(dbus_conn, msg, dev);\n\telse if (dbus_message_is_method_call(msg, DEVICE_INTERFACE,\n\t\t\t\t\t\t\t\"ConnectProfile\"))\n\t\treply = connect_profile(dbus_conn, msg, dev);\n\telse\n\t\treply = g_dbus_create_reply(msg, DBUS_TYPE_INVALID);\n\n\tdbus_message_unref(msg);\n\ndone:\n\tif (reply)\n\t\tg_dbus_send_message(dbus_conn, reply);\n\n\tif (req)\n\t\tbrowse_request_free(req);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *dbus_conn = NULL;",
            "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
            "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);",
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void browse_request_complete(struct browse_req *req, uint8_t type,\n\t\t\t\t\t\tuint8_t bdaddr_type, int err)\n{\n\tstruct btd_device *dev = req->device;\n\tDBusMessage *reply = NULL;\n\tDBusMessage *msg;\n\n\tif (req->type != type)\n\t\treturn;\n\n\tif (!req->msg)\n\t\tgoto done;\n\n\tif (dbus_message_is_method_call(req->msg, DEVICE_INTERFACE, \"Pair\")) {\n\t\tif (!device_is_paired(dev, bdaddr_type)) {\n\t\t\treply = btd_error_failed(req->msg, \"Not paired\");\n\t\t\tgoto done;\n\t\t}\n\n\t\tif (dev->pending_paired) {\n\t\t\tg_dbus_emit_property_changed(dbus_conn, dev->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"Paired\");\n\t\t\tdev->pending_paired = false;\n\t\t}\n\n\t\t/* Disregard browse errors in case of Pair */\n\t\treply = g_dbus_create_reply(req->msg, DBUS_TYPE_INVALID);\n\t\tgoto done;\n\t}\n\n\tif (err) {\n\t\t/* Fallback to LE bearer if supported */\n\t\tif (err == -EHOSTDOWN && bdaddr_type == BDADDR_BREDR &&\n\t\t\t\tdev->le && !dev->le_state.connected) {\n\t\t\terr = device_connect_le(dev);\n\t\t\tif (err == 0)\n\t\t\t\tgoto done;\n\t\t}\n\t\treply = btd_error_failed(req->msg, strerror(-err));\n\t\tgoto done;\n\t}\n\n\t/* if successfully resolved services we need to free browsing request\n\t * before passing message back to connect functions, otherwise\n\t * device->browse is set and \"InProgress\" error is returned instead\n\t * of actually connecting services\n\t */\n\tmsg = dbus_message_ref(req->msg);\n\tbrowse_request_free(req);\n\treq = NULL;\n\n\tif (dbus_message_is_method_call(msg, DEVICE_INTERFACE, \"Connect\"))\n\t\treply = dev_connect(dbus_conn, msg, dev);\n\telse if (dbus_message_is_method_call(msg, DEVICE_INTERFACE,\n\t\t\t\t\t\t\t\"ConnectProfile\"))\n\t\treply = connect_profile(dbus_conn, msg, dev);\n\telse\n\t\treply = g_dbus_create_reply(msg, DBUS_TYPE_INVALID);\n\n\tdbus_message_unref(msg);\n\ndone:\n\tif (reply)\n\t\tg_dbus_send_message(dbus_conn, reply);\n\n\tif (req)\n\t\tbrowse_request_free(req);\n}"
        }
      },
      {
        "call_info": {
          "callee": "adapter_connect_list_add",
          "args": [
            "device->adapter",
            "device"
          ],
          "line": 5053
        },
        "resolved": true,
        "details": {
          "function_name": "adapter_connect_list_add",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "4470-4513",
          "snippet": "int adapter_connect_list_add(struct btd_adapter *adapter,\n\t\t\t\t\tstruct btd_device *device)\n{\n\t/*\n\t * If the adapter->connect_le device is getting added back to\n\t * the connect list it probably means that the connect attempt\n\t * failed and hence we should clear this pointer\n\t */\n\tif (device == adapter->connect_le)\n\t\tadapter->connect_le = NULL;\n\n\t/*\n\t * If kernel background scanning is supported then the\n\t * adapter_auto_connect_add() function is used to maintain what to\n\t * connect.\n\t */\n\tif (kernel_conn_control)\n\t\treturn 0;\n\n\tif (g_slist_find(adapter->connect_list, device)) {\n\t\tDBG(\"ignoring already added device %s\",\n\t\t\t\t\t\tdevice_get_path(device));\n\t\tgoto done;\n\t}\n\n\tif (!(adapter->supported_settings & MGMT_SETTING_LE)) {\n\t\tbtd_error(adapter->dev_id,\n\t\t\t\"Can't add %s to non-LE capable adapter connect list\",\n\t\t\t\t\t\tdevice_get_path(device));\n\t\treturn -ENOTSUP;\n\t}\n\n\tadapter->connect_list = g_slist_append(adapter->connect_list, device);\n\tDBG(\"%s added to %s's connect_list\", device_get_path(device),\n\t\t\t\t\t\t\tadapter->system_name);\n\ndone:\n\tif (!(adapter->current_settings & MGMT_SETTING_POWERED))\n\t\treturn 0;\n\n\ttrigger_passive_scanning(adapter);\n\n\treturn 0;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static bool kernel_conn_control = false;",
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic bool kernel_conn_control = false;\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nint adapter_connect_list_add(struct btd_adapter *adapter,\n\t\t\t\t\tstruct btd_device *device)\n{\n\t/*\n\t * If the adapter->connect_le device is getting added back to\n\t * the connect list it probably means that the connect attempt\n\t * failed and hence we should clear this pointer\n\t */\n\tif (device == adapter->connect_le)\n\t\tadapter->connect_le = NULL;\n\n\t/*\n\t * If kernel background scanning is supported then the\n\t * adapter_auto_connect_add() function is used to maintain what to\n\t * connect.\n\t */\n\tif (kernel_conn_control)\n\t\treturn 0;\n\n\tif (g_slist_find(adapter->connect_list, device)) {\n\t\tDBG(\"ignoring already added device %s\",\n\t\t\t\t\t\tdevice_get_path(device));\n\t\tgoto done;\n\t}\n\n\tif (!(adapter->supported_settings & MGMT_SETTING_LE)) {\n\t\tbtd_error(adapter->dev_id,\n\t\t\t\"Can't add %s to non-LE capable adapter connect list\",\n\t\t\t\t\t\tdevice_get_path(device));\n\t\treturn -ENOTSUP;\n\t}\n\n\tadapter->connect_list = g_slist_append(adapter->connect_list, device);\n\tDBG(\"%s added to %s's connect_list\", device_get_path(device),\n\t\t\t\t\t\t\tadapter->system_name);\n\ndone:\n\tif (!(adapter->current_settings & MGMT_SETTING_POWERED))\n\t\treturn 0;\n\n\ttrigger_passive_scanning(adapter);\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Enabling automatic connections\""
          ],
          "line": 5052
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device_get_auto_connect",
          "args": [
            "device"
          ],
          "line": 5051
        },
        "resolved": true,
        "details": {
          "function_name": "device_get_auto_connect",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "4745-4751",
          "snippet": "static bool device_get_auto_connect(struct btd_device *device)\n{\n\tif (device->disable_auto_connect)\n\t\treturn false;\n\n\treturn device->auto_connect;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic bool device_get_auto_connect(struct btd_device *device)\n{\n\tif (device->disable_auto_connect)\n\t\treturn false;\n\n\treturn device->auto_connect;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_error_matches",
          "args": [
            "gerr",
            "BT_IO_ERROR",
            "ECONNABORTED"
          ],
          "line": 5048
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"%s\"",
            "gerr->message"
          ],
          "line": 5046
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_io_channel_unref",
          "args": [
            "device->att_io"
          ],
          "line": 5042
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void att_connect_cb(GIOChannel *io, GError *gerr, gpointer user_data)\n{\n\tstruct btd_device *device = user_data;\n\tDBusMessage *reply;\n\tuint8_t io_cap;\n\tint err = 0;\n\n\tg_io_channel_unref(device->att_io);\n\tdevice->att_io = NULL;\n\n\tif (gerr) {\n\t\tDBG(\"%s\", gerr->message);\n\n\t\tif (g_error_matches(gerr, BT_IO_ERROR, ECONNABORTED))\n\t\t\tgoto done;\n\n\t\tif (device_get_auto_connect(device)) {\n\t\t\tDBG(\"Enabling automatic connections\");\n\t\t\tadapter_connect_list_add(device->adapter, device);\n\t\t}\n\n\t\tif (device->browse)\n\t\t\tbrowse_request_complete(device->browse,\n\t\t\t\t\t\tBROWSE_GATT,\n\t\t\t\t\t\tdevice->bdaddr_type,\n\t\t\t\t\t\t-ECONNABORTED);\n\n\t\terr = -ECONNABORTED;\n\t\tgoto done;\n\t}\n\n\tif (!device_attach_att(device, io))\n\t\tgoto done;\n\n\tif (!device->bonding)\n\t\tgoto done;\n\n\tif (device->bonding->agent)\n\t\tio_cap = agent_get_io_capability(device->bonding->agent);\n\telse\n\t\tio_cap = IO_CAPABILITY_NOINPUTNOOUTPUT;\n\n\terr = adapter_create_bonding(device->adapter, &device->bdaddr,\n\t\t\t\t\tdevice->bdaddr_type, io_cap);\ndone:\n\tif (device->bonding && err < 0) {\n\t\treply = btd_error_failed(device->bonding->msg, strerror(-err));\n\t\tg_dbus_send_message(dbus_conn, reply);\n\t\tbonding_request_cancel(device->bonding);\n\t\tbonding_request_free(device->bonding);\n\t}\n\n\tif (!err)\n\t\tdevice_browse_gatt(device, NULL);\n\n\tif (device->connect) {\n\t\tif (err < 0)\n\t\t\treply = btd_error_failed(device->connect,\n\t\t\t\t\t\t\tstrerror(-err));\n\t\telse\n\t\t\treply = dbus_message_new_method_return(device->connect);\n\n\t\tg_dbus_send_message(dbus_conn, reply);\n\t\tdbus_message_unref(device->connect);\n\t\tdevice->connect = NULL;\n\t}\n}"
  },
  {
    "function_name": "device_attach_att",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "4952-5033",
    "snippet": "bool device_attach_att(struct btd_device *dev, GIOChannel *io)\n{\n\tGError *gerr = NULL;\n\tGAttrib *attrib;\n\tBtIOSecLevel sec_level;\n\tuint16_t mtu;\n\tuint16_t cid;\n\tstruct btd_gatt_database *database;\n\tconst bdaddr_t *dst;\n\tchar dstaddr[18];\n\n\tbt_io_get(io, &gerr, BT_IO_OPT_SEC_LEVEL, &sec_level,\n\t\t\t\t\t\tBT_IO_OPT_IMTU, &mtu,\n\t\t\t\t\t\tBT_IO_OPT_CID, &cid,\n\t\t\t\t\t\tBT_IO_OPT_INVALID);\n\n\tif (gerr) {\n\t\terror(\"bt_io_get: %s\", gerr->message);\n\t\tg_error_free(gerr);\n\t\treturn false;\n\t}\n\n\tif (sec_level == BT_IO_SEC_LOW && dev->le_state.paired) {\n\t\tDBG(\"Elevating security level since LTK is available\");\n\n\t\tsec_level = BT_IO_SEC_MEDIUM;\n\t\tbt_io_set(io, &gerr, BT_IO_OPT_SEC_LEVEL, sec_level,\n\t\t\t\t\t\t\tBT_IO_OPT_INVALID);\n\t\tif (gerr) {\n\t\t\terror(\"bt_io_set: %s\", gerr->message);\n\t\t\tg_error_free(gerr);\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tdev->att_mtu = MIN(mtu, main_opts.gatt_mtu);\n\tattrib = g_attrib_new(io,\n\t\t\tcid == ATT_CID ? BT_ATT_DEFAULT_LE_MTU : dev->att_mtu,\n\t\t\tfalse);\n\tif (!attrib) {\n\t\terror(\"Unable to create new GAttrib instance\");\n\t\treturn false;\n\t}\n\n\tdev->attrib = attrib;\n\tdev->att = g_attrib_get_att(attrib);\n\n\tbt_att_ref(dev->att);\n\n\tdev->att_disconn_id = bt_att_register_disconnect(dev->att,\n\t\t\t\t\t\tatt_disconnected_cb, dev, NULL);\n\tbt_att_set_close_on_unref(dev->att, true);\n\n\tif (dev->local_csrk)\n\t\tbt_att_set_local_key(dev->att, dev->local_csrk->key,\n\t\t\t\t\t\t\tlocal_counter, dev);\n\n\tif (dev->remote_csrk)\n\t\tbt_att_set_remote_key(dev->att, dev->remote_csrk->key,\n\t\t\t\t\t\t\tremote_counter, dev);\n\n\tdatabase = btd_adapter_get_database(dev->adapter);\n\n\tdst = device_get_address(dev);\n\tba2str(dst, dstaddr);\n\n\tif (gatt_db_isempty(dev->db))\n\t\tload_gatt_db(dev, btd_adapter_get_storage_dir(dev->adapter),\n\t\t\t\t\t\t\t\tdstaddr);\n\n\tgatt_client_init(dev);\n\tgatt_server_init(dev, database);\n\n\t/*\n\t * Remove the device from the connect_list and give the passive\n\t * scanning another chance to be restarted in case there are\n\t * other devices in the connect_list.\n\t */\n\tadapter_connect_list_remove(dev->adapter, dev);\n\n\treturn true;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "adapter_connect_list_remove",
          "args": [
            "dev->adapter",
            "dev"
          ],
          "line": 5030
        },
        "resolved": true,
        "details": {
          "function_name": "adapter_connect_list_remove",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "4515-4548",
          "snippet": "void adapter_connect_list_remove(struct btd_adapter *adapter,\n\t\t\t\t\tstruct btd_device *device)\n{\n\t/*\n\t * If the adapter->connect_le device is being removed from the\n\t * connect list it means the connection was successful and hence\n\t * the pointer should be cleared\n\t */\n\tif (device == adapter->connect_le)\n\t\tadapter->connect_le = NULL;\n\n\tif (kernel_conn_control)\n\t\treturn;\n\n\tif (!g_slist_find(adapter->connect_list, device)) {\n\t\tDBG(\"device %s is not on the list, ignoring\",\n\t\t\t\t\t\tdevice_get_path(device));\n\t\treturn;\n\t}\n\n\tadapter->connect_list = g_slist_remove(adapter->connect_list, device);\n\tDBG(\"%s removed from %s's connect_list\", device_get_path(device),\n\t\t\t\t\t\t\tadapter->system_name);\n\n\tif (!adapter->connect_list) {\n\t\tstop_passive_scanning(adapter);\n\t\treturn;\n\t}\n\n\tif (!(adapter->current_settings & MGMT_SETTING_POWERED))\n\t\treturn;\n\n\ttrigger_passive_scanning(adapter);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static bool kernel_conn_control = false;",
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic bool kernel_conn_control = false;\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nvoid adapter_connect_list_remove(struct btd_adapter *adapter,\n\t\t\t\t\tstruct btd_device *device)\n{\n\t/*\n\t * If the adapter->connect_le device is being removed from the\n\t * connect list it means the connection was successful and hence\n\t * the pointer should be cleared\n\t */\n\tif (device == adapter->connect_le)\n\t\tadapter->connect_le = NULL;\n\n\tif (kernel_conn_control)\n\t\treturn;\n\n\tif (!g_slist_find(adapter->connect_list, device)) {\n\t\tDBG(\"device %s is not on the list, ignoring\",\n\t\t\t\t\t\tdevice_get_path(device));\n\t\treturn;\n\t}\n\n\tadapter->connect_list = g_slist_remove(adapter->connect_list, device);\n\tDBG(\"%s removed from %s's connect_list\", device_get_path(device),\n\t\t\t\t\t\t\tadapter->system_name);\n\n\tif (!adapter->connect_list) {\n\t\tstop_passive_scanning(adapter);\n\t\treturn;\n\t}\n\n\tif (!(adapter->current_settings & MGMT_SETTING_POWERED))\n\t\treturn;\n\n\ttrigger_passive_scanning(adapter);\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_server_init",
          "args": [
            "dev",
            "database"
          ],
          "line": 5023
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_server_init",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "4899-4922",
          "snippet": "static void gatt_server_init(struct btd_device *device,\n\t\t\t\tstruct btd_gatt_database *database)\n{\n\tstruct gatt_db *db = btd_gatt_database_get_db(database);\n\n\tif (!db) {\n\t\terror(\"No local GATT database exists for this adapter\");\n\t\treturn;\n\t}\n\n\tgatt_server_cleanup(device);\n\n\tdevice->server = bt_gatt_server_new(db, device->att, device->att_mtu,\n\t\t\t\t\t\tmain_opts.key_size);\n\tif (!device->server) {\n\t\terror(\"Failed to initialize bt_gatt_server\");\n\t\treturn;\n\t}\n\n\tbt_att_set_enc_key_size(device->att, device->ltk_enc_size);\n\tbt_gatt_server_set_debug(device->server, gatt_debug, NULL, NULL);\n\n\tbtd_gatt_database_att_connected(database, device->att);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void gatt_server_init(struct btd_device *device,\n\t\t\t\tstruct btd_gatt_database *database)\n{\n\tstruct gatt_db *db = btd_gatt_database_get_db(database);\n\n\tif (!db) {\n\t\terror(\"No local GATT database exists for this adapter\");\n\t\treturn;\n\t}\n\n\tgatt_server_cleanup(device);\n\n\tdevice->server = bt_gatt_server_new(db, device->att, device->att_mtu,\n\t\t\t\t\t\tmain_opts.key_size);\n\tif (!device->server) {\n\t\terror(\"Failed to initialize bt_gatt_server\");\n\t\treturn;\n\t}\n\n\tbt_att_set_enc_key_size(device->att, device->ltk_enc_size);\n\tbt_gatt_server_set_debug(device->server, gatt_debug, NULL, NULL);\n\n\tbtd_gatt_database_att_connected(database, device->att);\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_client_init",
          "args": [
            "dev"
          ],
          "line": 5022
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_client_init",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "4860-4897",
          "snippet": "static void gatt_client_init(struct btd_device *device)\n{\n\tgatt_client_cleanup(device);\n\n\tdevice->client = bt_gatt_client_new(device->db, device->att,\n\t\t\t\t\t\t\tdevice->att_mtu);\n\tif (!device->client) {\n\t\tDBG(\"Failed to initialize\");\n\t\treturn;\n\t}\n\n\tbt_gatt_client_set_debug(device->client, gatt_debug, NULL, NULL);\n\n\t/*\n\t * Notify notify existing service about the new connection so they can\n\t * react to notifications while discovering services\n\t */\n\tdevice_accept_gatt_profiles(device);\n\n\tdevice->gatt_ready_id = bt_gatt_client_ready_register(device->client,\n\t\t\t\t\t\t\tgatt_client_ready_cb,\n\t\t\t\t\t\t\tdevice, NULL);\n\tif (!device->gatt_ready_id) {\n\t\tDBG(\"Failed to register GATT ready callback\");\n\t\tgatt_client_cleanup(device);\n\t\treturn;\n\t}\n\n\tif (!bt_gatt_client_set_service_changed(device->client,\n\t\t\t\t\t\tgatt_client_service_changed,\n\t\t\t\t\t\tdevice, NULL)) {\n\t\tDBG(\"Failed to set service changed handler\");\n\t\tgatt_client_cleanup(device);\n\t\treturn;\n\t}\n\n\tbtd_gatt_client_connected(device->client_dbus);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void gatt_client_init(struct btd_device *device)\n{\n\tgatt_client_cleanup(device);\n\n\tdevice->client = bt_gatt_client_new(device->db, device->att,\n\t\t\t\t\t\t\tdevice->att_mtu);\n\tif (!device->client) {\n\t\tDBG(\"Failed to initialize\");\n\t\treturn;\n\t}\n\n\tbt_gatt_client_set_debug(device->client, gatt_debug, NULL, NULL);\n\n\t/*\n\t * Notify notify existing service about the new connection so they can\n\t * react to notifications while discovering services\n\t */\n\tdevice_accept_gatt_profiles(device);\n\n\tdevice->gatt_ready_id = bt_gatt_client_ready_register(device->client,\n\t\t\t\t\t\t\tgatt_client_ready_cb,\n\t\t\t\t\t\t\tdevice, NULL);\n\tif (!device->gatt_ready_id) {\n\t\tDBG(\"Failed to register GATT ready callback\");\n\t\tgatt_client_cleanup(device);\n\t\treturn;\n\t}\n\n\tif (!bt_gatt_client_set_service_changed(device->client,\n\t\t\t\t\t\tgatt_client_service_changed,\n\t\t\t\t\t\tdevice, NULL)) {\n\t\tDBG(\"Failed to set service changed handler\");\n\t\tgatt_client_cleanup(device);\n\t\treturn;\n\t}\n\n\tbtd_gatt_client_connected(device->client_dbus);\n}"
        }
      },
      {
        "call_info": {
          "callee": "load_gatt_db",
          "args": [
            "dev",
            "btd_adapter_get_storage_dir(dev->adapter)",
            "dstaddr"
          ],
          "line": 5019
        },
        "resolved": true,
        "details": {
          "function_name": "load_gatt_db",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "3466-3499",
          "snippet": "static void load_gatt_db(struct btd_device *device, const char *local,\n\t\t\t\t\t\t\tconst char *peer)\n{\n\tchar **keys, filename[PATH_MAX];\n\tGKeyFile *key_file;\n\n\tif (!gatt_cache_is_enabled(device))\n\t\treturn;\n\n\tDBG(\"Restoring %s gatt database from file\", peer);\n\n\tsnprintf(filename, PATH_MAX, STORAGEDIR \"/%s/cache/%s\", local, peer);\n\n\tkey_file = g_key_file_new();\n\tg_key_file_load_from_file(key_file, filename, 0, NULL);\n\tkeys = g_key_file_get_keys(key_file, \"Attributes\", NULL, NULL);\n\n\tif (!keys) {\n\t\twarn(\"No cache for %s\", peer);\n\t\tg_key_file_free(key_file);\n\t\treturn;\n\t}\n\n\tif (load_gatt_db_impl(key_file, keys, device->db))\n\t\twarn(\"Unable to load gatt db from file for %s\", peer);\n\n\tg_strfreev(keys);\n\tg_key_file_free(key_file);\n\n\tg_slist_free_full(device->primaries, g_free);\n\tdevice->primaries = NULL;\n\tgatt_db_foreach_service(device->db, NULL, add_primary,\n\t\t\t\t\t\t\t&device->primaries);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void load_gatt_db(struct btd_device *device, const char *local,\n\t\t\t\t\t\t\tconst char *peer)\n{\n\tchar **keys, filename[PATH_MAX];\n\tGKeyFile *key_file;\n\n\tif (!gatt_cache_is_enabled(device))\n\t\treturn;\n\n\tDBG(\"Restoring %s gatt database from file\", peer);\n\n\tsnprintf(filename, PATH_MAX, STORAGEDIR \"/%s/cache/%s\", local, peer);\n\n\tkey_file = g_key_file_new();\n\tg_key_file_load_from_file(key_file, filename, 0, NULL);\n\tkeys = g_key_file_get_keys(key_file, \"Attributes\", NULL, NULL);\n\n\tif (!keys) {\n\t\twarn(\"No cache for %s\", peer);\n\t\tg_key_file_free(key_file);\n\t\treturn;\n\t}\n\n\tif (load_gatt_db_impl(key_file, keys, device->db))\n\t\twarn(\"Unable to load gatt db from file for %s\", peer);\n\n\tg_strfreev(keys);\n\tg_key_file_free(key_file);\n\n\tg_slist_free_full(device->primaries, g_free);\n\tdevice->primaries = NULL;\n\tgatt_db_foreach_service(device->db, NULL, add_primary,\n\t\t\t\t\t\t\t&device->primaries);\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_adapter_get_storage_dir",
          "args": [
            "dev->adapter"
          ],
          "line": 5019
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_get_storage_dir",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "438-450",
          "snippet": "const char *btd_adapter_get_storage_dir(struct btd_adapter *adapter)\n{\n\tstatic char dir[25];\n\n\tif (adapter->bdaddr_type == BDADDR_LE_RANDOM) {\n\t\tstrcpy(dir, \"static-\");\n\t\tba2str(&adapter->bdaddr, dir + 7);\n\t} else {\n\t\tba2str(&adapter->bdaddr, dir);\n\t}\n\n\treturn dir;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nconst char *btd_adapter_get_storage_dir(struct btd_adapter *adapter)\n{\n\tstatic char dir[25];\n\n\tif (adapter->bdaddr_type == BDADDR_LE_RANDOM) {\n\t\tstrcpy(dir, \"static-\");\n\t\tba2str(&adapter->bdaddr, dir + 7);\n\t} else {\n\t\tba2str(&adapter->bdaddr, dir);\n\t}\n\n\treturn dir;\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_isempty",
          "args": [
            "dev->db"
          ],
          "line": 5018
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_isempty",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "327-333",
          "snippet": "bool gatt_db_isempty(struct gatt_db *db)\n{\n\tif (!db)\n\t\treturn true;\n\n\treturn queue_isempty(db->services);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_isempty(struct gatt_db *db)\n{\n\tif (!db)\n\t\treturn true;\n\n\treturn queue_isempty(db->services);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ba2str",
          "args": [
            "dst",
            "dstaddr"
          ],
          "line": 5016
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device_get_address",
          "args": [
            "dev"
          ],
          "line": 5015
        },
        "resolved": true,
        "details": {
          "function_name": "device_get_address",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5314-5317",
          "snippet": "const bdaddr_t *device_get_address(struct btd_device *device)\n{\n\treturn &device->bdaddr;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nconst bdaddr_t *device_get_address(struct btd_device *device)\n{\n\treturn &device->bdaddr;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_adapter_get_database",
          "args": [
            "dev->adapter"
          ],
          "line": 5013
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_get_database",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "4446-4452",
          "snippet": "struct btd_gatt_database *btd_adapter_get_database(struct btd_adapter *adapter)\n{\n\tif (!adapter)\n\t\treturn NULL;\n\n\treturn adapter->database;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nstruct btd_gatt_database *btd_adapter_get_database(struct btd_adapter *adapter)\n{\n\tif (!adapter)\n\t\treturn NULL;\n\n\treturn adapter->database;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_att_set_remote_key",
          "args": [
            "dev->att",
            "dev->remote_csrk->key",
            "remote_counter",
            "dev"
          ],
          "line": 5010
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_set_remote_key",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "1537-1544",
          "snippet": "bool bt_att_set_remote_key(struct bt_att *att, uint8_t sign_key[16],\n\t\t\t\tbt_att_counter_func_t func, void *user_data)\n{\n\tif (!att)\n\t\treturn false;\n\n\treturn sign_set_key(&att->remote_sign, sign_key, func, user_data);\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nbool bt_att_set_remote_key(struct bt_att *att, uint8_t sign_key[16],\n\t\t\t\tbt_att_counter_func_t func, void *user_data)\n{\n\tif (!att)\n\t\treturn false;\n\n\treturn sign_set_key(&att->remote_sign, sign_key, func, user_data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_att_set_local_key",
          "args": [
            "dev->att",
            "dev->local_csrk->key",
            "local_counter",
            "dev"
          ],
          "line": 5006
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_set_local_key",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "1528-1535",
          "snippet": "bool bt_att_set_local_key(struct bt_att *att, uint8_t sign_key[16],\n\t\t\t\tbt_att_counter_func_t func, void *user_data)\n{\n\tif (!att)\n\t\treturn false;\n\n\treturn sign_set_key(&att->local_sign, sign_key, func, user_data);\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nbool bt_att_set_local_key(struct bt_att *att, uint8_t sign_key[16],\n\t\t\t\tbt_att_counter_func_t func, void *user_data)\n{\n\tif (!att)\n\t\treturn false;\n\n\treturn sign_set_key(&att->local_sign, sign_key, func, user_data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_att_set_close_on_unref",
          "args": [
            "dev->att",
            "true"
          ],
          "line": 5003
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_set_close_on_unref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "1077-1083",
          "snippet": "bool bt_att_set_close_on_unref(struct bt_att *att, bool do_close)\n{\n\tif (!att || !att->io)\n\t\treturn false;\n\n\treturn io_set_close_on_destroy(att->io, do_close);\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nbool bt_att_set_close_on_unref(struct bt_att *att, bool do_close)\n{\n\tif (!att || !att->io)\n\t\treturn false;\n\n\treturn io_set_close_on_destroy(att->io, do_close);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_att_register_disconnect",
          "args": [
            "dev->att",
            "att_disconnected_cb",
            "dev",
            "NULL"
          ],
          "line": 5001
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_register_disconnect",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "1178-1204",
          "snippet": "unsigned int bt_att_register_disconnect(struct bt_att *att,\n\t\t\t\t\tbt_att_disconnect_func_t callback,\n\t\t\t\t\tvoid *user_data,\n\t\t\t\t\tbt_att_destroy_func_t destroy)\n{\n\tstruct att_disconn *disconn;\n\n\tif (!att || !att->io)\n\t\treturn 0;\n\n\tdisconn = new0(struct att_disconn, 1);\n\tdisconn->callback = callback;\n\tdisconn->destroy = destroy;\n\tdisconn->user_data = user_data;\n\n\tif (att->next_reg_id < 1)\n\t\tatt->next_reg_id = 1;\n\n\tdisconn->id = att->next_reg_id++;\n\n\tif (!queue_push_tail(att->disconn_list, disconn)) {\n\t\tfree(disconn);\n\t\treturn 0;\n\t}\n\n\treturn disconn->id;\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nunsigned int bt_att_register_disconnect(struct bt_att *att,\n\t\t\t\t\tbt_att_disconnect_func_t callback,\n\t\t\t\t\tvoid *user_data,\n\t\t\t\t\tbt_att_destroy_func_t destroy)\n{\n\tstruct att_disconn *disconn;\n\n\tif (!att || !att->io)\n\t\treturn 0;\n\n\tdisconn = new0(struct att_disconn, 1);\n\tdisconn->callback = callback;\n\tdisconn->destroy = destroy;\n\tdisconn->user_data = user_data;\n\n\tif (att->next_reg_id < 1)\n\t\tatt->next_reg_id = 1;\n\n\tdisconn->id = att->next_reg_id++;\n\n\tif (!queue_push_tail(att->disconn_list, disconn)) {\n\t\tfree(disconn);\n\t\treturn 0;\n\t}\n\n\treturn disconn->id;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_att_ref",
          "args": [
            "dev->att"
          ],
          "line": 4999
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_ref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "1053-1061",
          "snippet": "struct bt_att *bt_att_ref(struct bt_att *att)\n{\n\tif (!att)\n\t\treturn NULL;\n\n\t__sync_fetch_and_add(&att->ref_count, 1);\n\n\treturn att;\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nstruct bt_att *bt_att_ref(struct bt_att *att)\n{\n\tif (!att)\n\t\treturn NULL;\n\n\t__sync_fetch_and_add(&att->ref_count, 1);\n\n\treturn att;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_attrib_get_att",
          "args": [
            "attrib"
          ],
          "line": 4997
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Unable to create new GAttrib instance\""
          ],
          "line": 4992
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_not_ready",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "118-122",
          "snippet": "DBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_attrib_new",
          "args": [
            "io",
            "cid == ATT_CID ? BT_ATT_DEFAULT_LE_MTU : dev->att_mtu",
            "false"
          ],
          "line": 4988
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "MIN",
          "args": [
            "mtu",
            "main_opts.gatt_mtu"
          ],
          "line": 4987
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_error_free",
          "args": [
            "gerr"
          ],
          "line": 4982
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"bt_io_set: %s\"",
            "gerr->message"
          ],
          "line": 4981
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "124-128",
          "snippet": "DBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_io_set",
          "args": [
            "io",
            "&gerr",
            "BT_IO_OPT_SEC_LEVEL",
            "sec_level",
            "BT_IO_OPT_INVALID"
          ],
          "line": 4978
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Elevating security level since LTK is available\""
          ],
          "line": 4975
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_error_free",
          "args": [
            "gerr"
          ],
          "line": 4970
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_io_get",
          "args": [
            "io",
            "&gerr",
            "BT_IO_OPT_SEC_LEVEL",
            "&sec_level",
            "BT_IO_OPT_IMTU",
            "&mtu",
            "BT_IO_OPT_CID",
            "&cid",
            "BT_IO_OPT_INVALID"
          ],
          "line": 4963
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nbool device_attach_att(struct btd_device *dev, GIOChannel *io)\n{\n\tGError *gerr = NULL;\n\tGAttrib *attrib;\n\tBtIOSecLevel sec_level;\n\tuint16_t mtu;\n\tuint16_t cid;\n\tstruct btd_gatt_database *database;\n\tconst bdaddr_t *dst;\n\tchar dstaddr[18];\n\n\tbt_io_get(io, &gerr, BT_IO_OPT_SEC_LEVEL, &sec_level,\n\t\t\t\t\t\tBT_IO_OPT_IMTU, &mtu,\n\t\t\t\t\t\tBT_IO_OPT_CID, &cid,\n\t\t\t\t\t\tBT_IO_OPT_INVALID);\n\n\tif (gerr) {\n\t\terror(\"bt_io_get: %s\", gerr->message);\n\t\tg_error_free(gerr);\n\t\treturn false;\n\t}\n\n\tif (sec_level == BT_IO_SEC_LOW && dev->le_state.paired) {\n\t\tDBG(\"Elevating security level since LTK is available\");\n\n\t\tsec_level = BT_IO_SEC_MEDIUM;\n\t\tbt_io_set(io, &gerr, BT_IO_OPT_SEC_LEVEL, sec_level,\n\t\t\t\t\t\t\tBT_IO_OPT_INVALID);\n\t\tif (gerr) {\n\t\t\terror(\"bt_io_set: %s\", gerr->message);\n\t\t\tg_error_free(gerr);\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tdev->att_mtu = MIN(mtu, main_opts.gatt_mtu);\n\tattrib = g_attrib_new(io,\n\t\t\tcid == ATT_CID ? BT_ATT_DEFAULT_LE_MTU : dev->att_mtu,\n\t\t\tfalse);\n\tif (!attrib) {\n\t\terror(\"Unable to create new GAttrib instance\");\n\t\treturn false;\n\t}\n\n\tdev->attrib = attrib;\n\tdev->att = g_attrib_get_att(attrib);\n\n\tbt_att_ref(dev->att);\n\n\tdev->att_disconn_id = bt_att_register_disconnect(dev->att,\n\t\t\t\t\t\tatt_disconnected_cb, dev, NULL);\n\tbt_att_set_close_on_unref(dev->att, true);\n\n\tif (dev->local_csrk)\n\t\tbt_att_set_local_key(dev->att, dev->local_csrk->key,\n\t\t\t\t\t\t\tlocal_counter, dev);\n\n\tif (dev->remote_csrk)\n\t\tbt_att_set_remote_key(dev->att, dev->remote_csrk->key,\n\t\t\t\t\t\t\tremote_counter, dev);\n\n\tdatabase = btd_adapter_get_database(dev->adapter);\n\n\tdst = device_get_address(dev);\n\tba2str(dst, dstaddr);\n\n\tif (gatt_db_isempty(dev->db))\n\t\tload_gatt_db(dev, btd_adapter_get_storage_dir(dev->adapter),\n\t\t\t\t\t\t\t\tdstaddr);\n\n\tgatt_client_init(dev);\n\tgatt_server_init(dev, database);\n\n\t/*\n\t * Remove the device from the connect_list and give the passive\n\t * scanning another chance to be restarted in case there are\n\t * other devices in the connect_list.\n\t */\n\tadapter_connect_list_remove(dev->adapter, dev);\n\n\treturn true;\n}"
  },
  {
    "function_name": "remote_counter",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "4938-4950",
    "snippet": "static bool remote_counter(uint32_t *sign_cnt, void *user_data)\n{\n\tstruct btd_device *dev = user_data;\n\n\tif (!dev->remote_csrk || *sign_cnt < dev->remote_csrk->counter)\n\t\treturn false;\n\n\tdev->remote_csrk->counter = *sign_cnt;\n\n\tstore_device_info(dev);\n\n\treturn true;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "store_device_info",
          "args": [
            "dev"
          ],
          "line": 4947
        },
        "resolved": true,
        "details": {
          "function_name": "store_device_info",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "475-487",
          "snippet": "static void store_device_info(struct btd_device *device)\n{\n\tif (device->temporary || device->store_id > 0)\n\t\treturn;\n\n\tif (device_address_is_private(device)) {\n\t\tDBG(\"Can't store info for private addressed device %s\",\n\t\t\t\t\t\t\t\tdevice->path);\n\t\treturn;\n\t}\n\n\tdevice->store_id = g_idle_add(store_device_info_cb, device);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void store_device_info(struct btd_device *device)\n{\n\tif (device->temporary || device->store_id > 0)\n\t\treturn;\n\n\tif (device_address_is_private(device)) {\n\t\tDBG(\"Can't store info for private addressed device %s\",\n\t\t\t\t\t\t\t\tdevice->path);\n\t\treturn;\n\t}\n\n\tdevice->store_id = g_idle_add(store_device_info_cb, device);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic bool remote_counter(uint32_t *sign_cnt, void *user_data)\n{\n\tstruct btd_device *dev = user_data;\n\n\tif (!dev->remote_csrk || *sign_cnt < dev->remote_csrk->counter)\n\t\treturn false;\n\n\tdev->remote_csrk->counter = *sign_cnt;\n\n\tstore_device_info(dev);\n\n\treturn true;\n}"
  },
  {
    "function_name": "local_counter",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "4924-4936",
    "snippet": "static bool local_counter(uint32_t *sign_cnt, void *user_data)\n{\n\tstruct btd_device *dev = user_data;\n\n\tif (!dev->local_csrk)\n\t\treturn false;\n\n\t*sign_cnt = dev->local_csrk->counter++;\n\n\tstore_device_info(dev);\n\n\treturn true;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "store_device_info",
          "args": [
            "dev"
          ],
          "line": 4933
        },
        "resolved": true,
        "details": {
          "function_name": "store_device_info",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "475-487",
          "snippet": "static void store_device_info(struct btd_device *device)\n{\n\tif (device->temporary || device->store_id > 0)\n\t\treturn;\n\n\tif (device_address_is_private(device)) {\n\t\tDBG(\"Can't store info for private addressed device %s\",\n\t\t\t\t\t\t\t\tdevice->path);\n\t\treturn;\n\t}\n\n\tdevice->store_id = g_idle_add(store_device_info_cb, device);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void store_device_info(struct btd_device *device)\n{\n\tif (device->temporary || device->store_id > 0)\n\t\treturn;\n\n\tif (device_address_is_private(device)) {\n\t\tDBG(\"Can't store info for private addressed device %s\",\n\t\t\t\t\t\t\t\tdevice->path);\n\t\treturn;\n\t}\n\n\tdevice->store_id = g_idle_add(store_device_info_cb, device);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic bool local_counter(uint32_t *sign_cnt, void *user_data)\n{\n\tstruct btd_device *dev = user_data;\n\n\tif (!dev->local_csrk)\n\t\treturn false;\n\n\t*sign_cnt = dev->local_csrk->counter++;\n\n\tstore_device_info(dev);\n\n\treturn true;\n}"
  },
  {
    "function_name": "gatt_server_init",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "4899-4922",
    "snippet": "static void gatt_server_init(struct btd_device *device,\n\t\t\t\tstruct btd_gatt_database *database)\n{\n\tstruct gatt_db *db = btd_gatt_database_get_db(database);\n\n\tif (!db) {\n\t\terror(\"No local GATT database exists for this adapter\");\n\t\treturn;\n\t}\n\n\tgatt_server_cleanup(device);\n\n\tdevice->server = bt_gatt_server_new(db, device->att, device->att_mtu,\n\t\t\t\t\t\tmain_opts.key_size);\n\tif (!device->server) {\n\t\terror(\"Failed to initialize bt_gatt_server\");\n\t\treturn;\n\t}\n\n\tbt_att_set_enc_key_size(device->att, device->ltk_enc_size);\n\tbt_gatt_server_set_debug(device->server, gatt_debug, NULL, NULL);\n\n\tbtd_gatt_database_att_connected(database, device->att);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "btd_gatt_database_att_connected",
          "args": [
            "database",
            "device->att"
          ],
          "line": 4921
        },
        "resolved": true,
        "details": {
          "function_name": "btd_gatt_database_att_connected",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "3331-3350",
          "snippet": "void btd_gatt_database_att_connected(struct btd_gatt_database *database,\n\t\t\t\t\t\tstruct bt_att *att)\n{\n\tstruct device_state *state;\n\tbdaddr_t bdaddr;\n\tuint8_t bdaddr_type;\n\n\tif (!get_dst_info(att, &bdaddr, &bdaddr_type))\n\t\treturn;\n\n\tstate = find_device_state(database, &bdaddr, bdaddr_type);\n\tif (!state || !state->pending)\n\t\treturn;\n\n\tsend_notification_to_device(state, state->pending);\n\n\tfree(state->pending->value);\n\tfree(state->pending);\n\tstate->pending = NULL;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nvoid btd_gatt_database_att_connected(struct btd_gatt_database *database,\n\t\t\t\t\t\tstruct bt_att *att)\n{\n\tstruct device_state *state;\n\tbdaddr_t bdaddr;\n\tuint8_t bdaddr_type;\n\n\tif (!get_dst_info(att, &bdaddr, &bdaddr_type))\n\t\treturn;\n\n\tstate = find_device_state(database, &bdaddr, bdaddr_type);\n\tif (!state || !state->pending)\n\t\treturn;\n\n\tsend_notification_to_device(state, state->pending);\n\n\tfree(state->pending->value);\n\tfree(state->pending);\n\tstate->pending = NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_gatt_server_set_debug",
          "args": [
            "device->server",
            "gatt_debug",
            "NULL",
            "NULL"
          ],
          "line": 4919
        },
        "resolved": true,
        "details": {
          "function_name": "bt_gatt_server_set_debug",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-server.c",
          "lines": "1612-1628",
          "snippet": "bool bt_gatt_server_set_debug(struct bt_gatt_server *server,\n\t\t\t\t\tbt_gatt_server_debug_func_t callback,\n\t\t\t\t\tvoid *user_data,\n\t\t\t\t\tbt_gatt_server_destroy_func_t destroy)\n{\n\tif (!server)\n\t\treturn false;\n\n\tif (server->debug_destroy)\n\t\tserver->debug_destroy(server->debug_data);\n\n\tserver->debug_callback = callback;\n\tserver->debug_destroy = destroy;\n\tserver->debug_data = user_data;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-helpers.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/att.h\"",
            "#include <errno.h>",
            "#include <sys/uio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/gatt-helpers.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/att.h\"\n#include <errno.h>\n#include <sys/uio.h>\n#include <config.h>\n\nbool bt_gatt_server_set_debug(struct bt_gatt_server *server,\n\t\t\t\t\tbt_gatt_server_debug_func_t callback,\n\t\t\t\t\tvoid *user_data,\n\t\t\t\t\tbt_gatt_server_destroy_func_t destroy)\n{\n\tif (!server)\n\t\treturn false;\n\n\tif (server->debug_destroy)\n\t\tserver->debug_destroy(server->debug_data);\n\n\tserver->debug_callback = callback;\n\tserver->debug_destroy = destroy;\n\tserver->debug_data = user_data;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_att_set_enc_key_size",
          "args": [
            "device->att",
            "device->ltk_enc_size"
          ],
          "line": 4918
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_set_enc_key_size",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "1507-1513",
          "snippet": "void bt_att_set_enc_key_size(struct bt_att *att, uint8_t enc_size)\n{\n\tif (!att)\n\t\treturn;\n\n\tatt->enc_size = enc_size;\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nvoid bt_att_set_enc_key_size(struct bt_att *att, uint8_t enc_size)\n{\n\tif (!att)\n\t\treturn;\n\n\tatt->enc_size = enc_size;\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Failed to initialize bt_gatt_server\""
          ],
          "line": 4914
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_not_ready",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "118-122",
          "snippet": "DBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_gatt_server_new",
          "args": [
            "db",
            "device->att",
            "device->att_mtu",
            "main_opts.key_size"
          ],
          "line": 4911
        },
        "resolved": true,
        "details": {
          "function_name": "bt_gatt_server_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-server.c",
          "lines": "1558-1581",
          "snippet": "struct bt_gatt_server *bt_gatt_server_new(struct gatt_db *db,\n\t\t\t\t\tstruct bt_att *att, uint16_t mtu,\n\t\t\t\t\tuint8_t min_enc_size)\n{\n\tstruct bt_gatt_server *server;\n\n\tif (!att || !db)\n\t\treturn NULL;\n\n\tserver = new0(struct bt_gatt_server, 1);\n\tserver->db = gatt_db_ref(db);\n\tserver->att = bt_att_ref(att);\n\tserver->mtu = MAX(mtu, BT_ATT_DEFAULT_LE_MTU);\n\tserver->max_prep_queue_len = DEFAULT_MAX_PREP_QUEUE_LEN;\n\tserver->prep_queue = queue_new();\n\tserver->min_enc_size = min_enc_size;\n\n\tif (!gatt_server_register_att_handlers(server)) {\n\t\tbt_gatt_server_free(server);\n\t\treturn NULL;\n\t}\n\n\treturn bt_gatt_server_ref(server);\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-helpers.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/att.h\"",
            "#include <errno.h>",
            "#include <sys/uio.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define DEFAULT_MAX_PREP_QUEUE_LEN 30"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/gatt-helpers.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/att.h\"\n#include <errno.h>\n#include <sys/uio.h>\n#include <config.h>\n\n#define DEFAULT_MAX_PREP_QUEUE_LEN 30\n\nstruct bt_gatt_server *bt_gatt_server_new(struct gatt_db *db,\n\t\t\t\t\tstruct bt_att *att, uint16_t mtu,\n\t\t\t\t\tuint8_t min_enc_size)\n{\n\tstruct bt_gatt_server *server;\n\n\tif (!att || !db)\n\t\treturn NULL;\n\n\tserver = new0(struct bt_gatt_server, 1);\n\tserver->db = gatt_db_ref(db);\n\tserver->att = bt_att_ref(att);\n\tserver->mtu = MAX(mtu, BT_ATT_DEFAULT_LE_MTU);\n\tserver->max_prep_queue_len = DEFAULT_MAX_PREP_QUEUE_LEN;\n\tserver->prep_queue = queue_new();\n\tserver->min_enc_size = min_enc_size;\n\n\tif (!gatt_server_register_att_handlers(server)) {\n\t\tbt_gatt_server_free(server);\n\t\treturn NULL;\n\t}\n\n\treturn bt_gatt_server_ref(server);\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_server_cleanup",
          "args": [
            "device"
          ],
          "line": 4909
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_server_cleanup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "576-583",
          "snippet": "static void gatt_server_cleanup(struct btd_device *device)\n{\n\tif (!device->server)\n\t\treturn;\n\n\tbt_gatt_server_unref(device->server);\n\tdevice->server = NULL;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void gatt_server_cleanup(struct btd_device *device)\n{\n\tif (!device->server)\n\t\treturn;\n\n\tbt_gatt_server_unref(device->server);\n\tdevice->server = NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_gatt_database_get_db",
          "args": [
            "database"
          ],
          "line": 4902
        },
        "resolved": true,
        "details": {
          "function_name": "btd_gatt_database_get_db",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-database.c",
          "lines": "3323-3329",
          "snippet": "struct gatt_db *btd_gatt_database_get_db(struct btd_gatt_database *database)\n{\n\tif (!database)\n\t\treturn NULL;\n\n\treturn database->db;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"dbus-common.h\"",
            "#include \"gatt-database.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"dbus-common.h\"\n#include \"gatt-database.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"gdbus/gdbus.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <unistd.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <config.h>\n\nstruct gatt_db *btd_gatt_database_get_db(struct btd_gatt_database *database)\n{\n\tif (!database)\n\t\treturn NULL;\n\n\treturn database->db;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void gatt_server_init(struct btd_device *device,\n\t\t\t\tstruct btd_gatt_database *database)\n{\n\tstruct gatt_db *db = btd_gatt_database_get_db(database);\n\n\tif (!db) {\n\t\terror(\"No local GATT database exists for this adapter\");\n\t\treturn;\n\t}\n\n\tgatt_server_cleanup(device);\n\n\tdevice->server = bt_gatt_server_new(db, device->att, device->att_mtu,\n\t\t\t\t\t\tmain_opts.key_size);\n\tif (!device->server) {\n\t\terror(\"Failed to initialize bt_gatt_server\");\n\t\treturn;\n\t}\n\n\tbt_att_set_enc_key_size(device->att, device->ltk_enc_size);\n\tbt_gatt_server_set_debug(device->server, gatt_debug, NULL, NULL);\n\n\tbtd_gatt_database_att_connected(database, device->att);\n}"
  },
  {
    "function_name": "gatt_client_init",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "4860-4897",
    "snippet": "static void gatt_client_init(struct btd_device *device)\n{\n\tgatt_client_cleanup(device);\n\n\tdevice->client = bt_gatt_client_new(device->db, device->att,\n\t\t\t\t\t\t\tdevice->att_mtu);\n\tif (!device->client) {\n\t\tDBG(\"Failed to initialize\");\n\t\treturn;\n\t}\n\n\tbt_gatt_client_set_debug(device->client, gatt_debug, NULL, NULL);\n\n\t/*\n\t * Notify notify existing service about the new connection so they can\n\t * react to notifications while discovering services\n\t */\n\tdevice_accept_gatt_profiles(device);\n\n\tdevice->gatt_ready_id = bt_gatt_client_ready_register(device->client,\n\t\t\t\t\t\t\tgatt_client_ready_cb,\n\t\t\t\t\t\t\tdevice, NULL);\n\tif (!device->gatt_ready_id) {\n\t\tDBG(\"Failed to register GATT ready callback\");\n\t\tgatt_client_cleanup(device);\n\t\treturn;\n\t}\n\n\tif (!bt_gatt_client_set_service_changed(device->client,\n\t\t\t\t\t\tgatt_client_service_changed,\n\t\t\t\t\t\tdevice, NULL)) {\n\t\tDBG(\"Failed to set service changed handler\");\n\t\tgatt_client_cleanup(device);\n\t\treturn;\n\t}\n\n\tbtd_gatt_client_connected(device->client_dbus);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "btd_gatt_client_connected",
          "args": [
            "device->client_dbus"
          ],
          "line": 4896
        },
        "resolved": true,
        "details": {
          "function_name": "btd_gatt_client_connected",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "2153-2173",
          "snippet": "void btd_gatt_client_connected(struct btd_gatt_client *client)\n{\n\tstruct bt_gatt_client *gatt;\n\n\tgatt = btd_device_get_gatt_client(client->device);\n\tif (!gatt) {\n\t\terror(\"GATT client not initialized\");\n\t\treturn;\n\t}\n\n\tDBG(\"Device connected.\");\n\n\tbt_gatt_client_unref(client->gatt);\n\tclient->gatt = bt_gatt_client_clone(gatt);\n\n\t/*\n\t * Services have already been created before. Re-enable notifications\n\t * for any pre-registered notification sessions.\n\t */\n\tqueue_foreach(client->all_notify_clients, register_notify, client);\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nvoid btd_gatt_client_connected(struct btd_gatt_client *client)\n{\n\tstruct bt_gatt_client *gatt;\n\n\tgatt = btd_device_get_gatt_client(client->device);\n\tif (!gatt) {\n\t\terror(\"GATT client not initialized\");\n\t\treturn;\n\t}\n\n\tDBG(\"Device connected.\");\n\n\tbt_gatt_client_unref(client->gatt);\n\tclient->gatt = bt_gatt_client_clone(gatt);\n\n\t/*\n\t * Services have already been created before. Re-enable notifications\n\t * for any pre-registered notification sessions.\n\t */\n\tqueue_foreach(client->all_notify_clients, register_notify, client);\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_client_cleanup",
          "args": [
            "device"
          ],
          "line": 4892
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_client_cleanup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "558-574",
          "snippet": "static void gatt_client_cleanup(struct btd_device *device)\n{\n\tif (!device->client)\n\t\treturn;\n\n\tgatt_cache_cleanup(device);\n\tbt_gatt_client_set_service_changed(device->client, NULL, NULL, NULL);\n\n\tif (device->gatt_ready_id > 0) {\n\t\tbt_gatt_client_ready_unregister(device->client,\n\t\t\t\t\t\tdevice->gatt_ready_id);\n\t\tdevice->gatt_ready_id = 0;\n\t}\n\n\tbt_gatt_client_unref(device->client);\n\tdevice->client = NULL;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void gatt_client_cleanup(struct btd_device *device)\n{\n\tif (!device->client)\n\t\treturn;\n\n\tgatt_cache_cleanup(device);\n\tbt_gatt_client_set_service_changed(device->client, NULL, NULL, NULL);\n\n\tif (device->gatt_ready_id > 0) {\n\t\tbt_gatt_client_ready_unregister(device->client,\n\t\t\t\t\t\tdevice->gatt_ready_id);\n\t\tdevice->gatt_ready_id = 0;\n\t}\n\n\tbt_gatt_client_unref(device->client);\n\tdevice->client = NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Failed to set service changed handler\""
          ],
          "line": 4891
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_gatt_client_set_service_changed",
          "args": [
            "device->client",
            "gatt_client_service_changed",
            "device",
            "NULL"
          ],
          "line": 4888
        },
        "resolved": true,
        "details": {
          "function_name": "bt_gatt_client_set_service_changed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-client.c",
          "lines": "2053-2069",
          "snippet": "bool bt_gatt_client_set_service_changed(struct bt_gatt_client *client,\n\t\t\tbt_gatt_client_service_changed_callback_t callback,\n\t\t\tvoid *user_data,\n\t\t\tbt_gatt_client_destroy_func_t destroy)\n{\n\tif (!client)\n\t\treturn false;\n\n\tif (client->svc_chngd_destroy)\n\t\tclient->svc_chngd_destroy(client->svc_chngd_data);\n\n\tclient->svc_chngd_callback = callback;\n\tclient->svc_chngd_destroy = destroy;\n\tclient->svc_chngd_data = user_data;\n\n\treturn true;\n}",
          "includes": [
            "#include <sys/uio.h>",
            "#include <limits.h>",
            "#include <assert.h>",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-helpers.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/att.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void discover_chrcs_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\t\tstruct bt_gatt_result *result,\n\t\t\t\t\t\tvoid *user_data);",
            "static void discover_descs_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\t\tstruct bt_gatt_result *result,\n\t\t\t\t\t\tvoid *user_data);",
            "static void ext_prop_read_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\tconst uint8_t *value, uint16_t length,\n\t\t\t\t\tvoid *user_data);",
            "static void service_changed_cb(uint16_t value_handle, const uint8_t *value,\n\t\t\t\t\tuint16_t length, void *user_data);",
            "static void prepare_write_cb(uint8_t opcode, const void *pdu, uint16_t length,\n\t\t\t\t\t\t\tvoid *user_data);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <sys/uio.h>\n#include <limits.h>\n#include <assert.h>\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-helpers.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/att.h\"\n#include <config.h>\n\nstatic void discover_chrcs_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\t\tstruct bt_gatt_result *result,\n\t\t\t\t\t\tvoid *user_data);\nstatic void discover_descs_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\t\tstruct bt_gatt_result *result,\n\t\t\t\t\t\tvoid *user_data);\nstatic void ext_prop_read_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\tconst uint8_t *value, uint16_t length,\n\t\t\t\t\tvoid *user_data);\nstatic void service_changed_cb(uint16_t value_handle, const uint8_t *value,\n\t\t\t\t\tuint16_t length, void *user_data);\nstatic void prepare_write_cb(uint8_t opcode, const void *pdu, uint16_t length,\n\t\t\t\t\t\t\tvoid *user_data);\n\nbool bt_gatt_client_set_service_changed(struct bt_gatt_client *client,\n\t\t\tbt_gatt_client_service_changed_callback_t callback,\n\t\t\tvoid *user_data,\n\t\t\tbt_gatt_client_destroy_func_t destroy)\n{\n\tif (!client)\n\t\treturn false;\n\n\tif (client->svc_chngd_destroy)\n\t\tclient->svc_chngd_destroy(client->svc_chngd_data);\n\n\tclient->svc_chngd_callback = callback;\n\tclient->svc_chngd_destroy = destroy;\n\tclient->svc_chngd_data = user_data;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Failed to register GATT ready callback\""
          ],
          "line": 4883
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_gatt_client_ready_register",
          "args": [
            "device->client",
            "gatt_client_ready_cb",
            "device",
            "NULL"
          ],
          "line": 4879
        },
        "resolved": true,
        "details": {
          "function_name": "bt_gatt_client_ready_register",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-client.c",
          "lines": "2020-2038",
          "snippet": "unsigned int bt_gatt_client_ready_register(struct bt_gatt_client *client,\n\t\t\t\t\tbt_gatt_client_callback_t callback,\n\t\t\t\t\tvoid *user_data,\n\t\t\t\t\tbt_gatt_client_destroy_func_t destroy)\n{\n\tstruct ready_cb *ready;\n\n\tif (!client)\n\t\treturn 0;\n\n\tready = new0(struct ready_cb, 1);\n\tready->callback = callback;\n\tready->destroy = destroy;\n\tready->data = user_data;\n\n\tqueue_push_tail(client->ready_cbs, ready);\n\n\treturn PTR_TO_UINT(ready);\n}",
          "includes": [
            "#include <sys/uio.h>",
            "#include <limits.h>",
            "#include <assert.h>",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-helpers.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/att.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void discover_chrcs_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\t\tstruct bt_gatt_result *result,\n\t\t\t\t\t\tvoid *user_data);",
            "static void discover_descs_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\t\tstruct bt_gatt_result *result,\n\t\t\t\t\t\tvoid *user_data);",
            "static void ext_prop_read_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\tconst uint8_t *value, uint16_t length,\n\t\t\t\t\tvoid *user_data);",
            "static void service_changed_cb(uint16_t value_handle, const uint8_t *value,\n\t\t\t\t\tuint16_t length, void *user_data);",
            "static void prepare_write_cb(uint8_t opcode, const void *pdu, uint16_t length,\n\t\t\t\t\t\t\tvoid *user_data);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <sys/uio.h>\n#include <limits.h>\n#include <assert.h>\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-helpers.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/att.h\"\n#include <config.h>\n\nstatic void discover_chrcs_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\t\tstruct bt_gatt_result *result,\n\t\t\t\t\t\tvoid *user_data);\nstatic void discover_descs_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\t\tstruct bt_gatt_result *result,\n\t\t\t\t\t\tvoid *user_data);\nstatic void ext_prop_read_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\tconst uint8_t *value, uint16_t length,\n\t\t\t\t\tvoid *user_data);\nstatic void service_changed_cb(uint16_t value_handle, const uint8_t *value,\n\t\t\t\t\tuint16_t length, void *user_data);\nstatic void prepare_write_cb(uint8_t opcode, const void *pdu, uint16_t length,\n\t\t\t\t\t\t\tvoid *user_data);\n\nunsigned int bt_gatt_client_ready_register(struct bt_gatt_client *client,\n\t\t\t\t\tbt_gatt_client_callback_t callback,\n\t\t\t\t\tvoid *user_data,\n\t\t\t\t\tbt_gatt_client_destroy_func_t destroy)\n{\n\tstruct ready_cb *ready;\n\n\tif (!client)\n\t\treturn 0;\n\n\tready = new0(struct ready_cb, 1);\n\tready->callback = callback;\n\tready->destroy = destroy;\n\tready->data = user_data;\n\n\tqueue_push_tail(client->ready_cbs, ready);\n\n\treturn PTR_TO_UINT(ready);\n}"
        }
      },
      {
        "call_info": {
          "callee": "device_accept_gatt_profiles",
          "args": [
            "device"
          ],
          "line": 4877
        },
        "resolved": true,
        "details": {
          "function_name": "device_accept_gatt_profiles",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "3593-3599",
          "snippet": "static void device_accept_gatt_profiles(struct btd_device *device)\n{\n\tGSList *l;\n\n\tfor (l = device->services; l != NULL; l = g_slist_next(l))\n\t\tservice_accept(l->data);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void device_accept_gatt_profiles(struct btd_device *device)\n{\n\tGSList *l;\n\n\tfor (l = device->services; l != NULL; l = g_slist_next(l))\n\t\tservice_accept(l->data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_gatt_client_set_debug",
          "args": [
            "device->client",
            "gatt_debug",
            "NULL",
            "NULL"
          ],
          "line": 4871
        },
        "resolved": true,
        "details": {
          "function_name": "bt_gatt_client_set_debug",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-client.c",
          "lines": "2071-2086",
          "snippet": "bool bt_gatt_client_set_debug(struct bt_gatt_client *client,\n\t\t\t\t\tbt_gatt_client_debug_func_t callback,\n\t\t\t\t\tvoid *user_data,\n\t\t\t\t\tbt_gatt_client_destroy_func_t destroy) {\n\tif (!client)\n\t\treturn false;\n\n\tif (client->debug_destroy)\n\t\tclient->debug_destroy(client->debug_data);\n\n\tclient->debug_callback = callback;\n\tclient->debug_destroy = destroy;\n\tclient->debug_data = user_data;\n\n\treturn true;\n}",
          "includes": [
            "#include <sys/uio.h>",
            "#include <limits.h>",
            "#include <assert.h>",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-helpers.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/att.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void discover_chrcs_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\t\tstruct bt_gatt_result *result,\n\t\t\t\t\t\tvoid *user_data);",
            "static void discover_descs_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\t\tstruct bt_gatt_result *result,\n\t\t\t\t\t\tvoid *user_data);",
            "static void ext_prop_read_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\tconst uint8_t *value, uint16_t length,\n\t\t\t\t\tvoid *user_data);",
            "static void service_changed_cb(uint16_t value_handle, const uint8_t *value,\n\t\t\t\t\tuint16_t length, void *user_data);",
            "static void prepare_write_cb(uint8_t opcode, const void *pdu, uint16_t length,\n\t\t\t\t\t\t\tvoid *user_data);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <sys/uio.h>\n#include <limits.h>\n#include <assert.h>\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-helpers.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/att.h\"\n#include <config.h>\n\nstatic void discover_chrcs_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\t\tstruct bt_gatt_result *result,\n\t\t\t\t\t\tvoid *user_data);\nstatic void discover_descs_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\t\tstruct bt_gatt_result *result,\n\t\t\t\t\t\tvoid *user_data);\nstatic void ext_prop_read_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\tconst uint8_t *value, uint16_t length,\n\t\t\t\t\tvoid *user_data);\nstatic void service_changed_cb(uint16_t value_handle, const uint8_t *value,\n\t\t\t\t\tuint16_t length, void *user_data);\nstatic void prepare_write_cb(uint8_t opcode, const void *pdu, uint16_t length,\n\t\t\t\t\t\t\tvoid *user_data);\n\nbool bt_gatt_client_set_debug(struct bt_gatt_client *client,\n\t\t\t\t\tbt_gatt_client_debug_func_t callback,\n\t\t\t\t\tvoid *user_data,\n\t\t\t\t\tbt_gatt_client_destroy_func_t destroy) {\n\tif (!client)\n\t\treturn false;\n\n\tif (client->debug_destroy)\n\t\tclient->debug_destroy(client->debug_data);\n\n\tclient->debug_callback = callback;\n\tclient->debug_destroy = destroy;\n\tclient->debug_data = user_data;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Failed to initialize\""
          ],
          "line": 4867
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_gatt_client_new",
          "args": [
            "device->db",
            "device->att",
            "device->att_mtu"
          ],
          "line": 4864
        },
        "resolved": true,
        "details": {
          "function_name": "bt_gatt_client_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-client.c",
          "lines": "1950-1969",
          "snippet": "struct bt_gatt_client *bt_gatt_client_new(struct gatt_db *db,\n\t\t\t\t\t\t\tstruct bt_att *att,\n\t\t\t\t\t\t\tuint16_t mtu)\n{\n\tstruct bt_gatt_client *client;\n\n\tif (!att || !db)\n\t\treturn NULL;\n\n\tclient = gatt_client_new(db, att);\n\tif (!client)\n\t\treturn NULL;\n\n\tif (!gatt_client_init(client, mtu)) {\n\t\tbt_gatt_client_free(client);\n\t\treturn NULL;\n\t}\n\n\treturn bt_gatt_client_ref(client);\n}",
          "includes": [
            "#include <sys/uio.h>",
            "#include <limits.h>",
            "#include <assert.h>",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-helpers.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/att.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/uio.h>\n#include <limits.h>\n#include <assert.h>\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-helpers.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/att.h\"\n#include <config.h>\n\nstruct bt_gatt_client *bt_gatt_client_new(struct gatt_db *db,\n\t\t\t\t\t\t\tstruct bt_att *att,\n\t\t\t\t\t\t\tuint16_t mtu)\n{\n\tstruct bt_gatt_client *client;\n\n\tif (!att || !db)\n\t\treturn NULL;\n\n\tclient = gatt_client_new(db, att);\n\tif (!client)\n\t\treturn NULL;\n\n\tif (!gatt_client_init(client, mtu)) {\n\t\tbt_gatt_client_free(client);\n\t\treturn NULL;\n\t}\n\n\treturn bt_gatt_client_ref(client);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void gatt_client_init(struct btd_device *device)\n{\n\tgatt_client_cleanup(device);\n\n\tdevice->client = bt_gatt_client_new(device->db, device->att,\n\t\t\t\t\t\t\tdevice->att_mtu);\n\tif (!device->client) {\n\t\tDBG(\"Failed to initialize\");\n\t\treturn;\n\t}\n\n\tbt_gatt_client_set_debug(device->client, gatt_debug, NULL, NULL);\n\n\t/*\n\t * Notify notify existing service about the new connection so they can\n\t * react to notifications while discovering services\n\t */\n\tdevice_accept_gatt_profiles(device);\n\n\tdevice->gatt_ready_id = bt_gatt_client_ready_register(device->client,\n\t\t\t\t\t\t\tgatt_client_ready_cb,\n\t\t\t\t\t\t\tdevice, NULL);\n\tif (!device->gatt_ready_id) {\n\t\tDBG(\"Failed to register GATT ready callback\");\n\t\tgatt_client_cleanup(device);\n\t\treturn;\n\t}\n\n\tif (!bt_gatt_client_set_service_changed(device->client,\n\t\t\t\t\t\tgatt_client_service_changed,\n\t\t\t\t\t\tdevice, NULL)) {\n\t\tDBG(\"Failed to set service changed handler\");\n\t\tgatt_client_cleanup(device);\n\t\treturn;\n\t}\n\n\tbtd_gatt_client_connected(device->client_dbus);\n}"
  },
  {
    "function_name": "gatt_debug",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "4855-4858",
    "snippet": "static void gatt_debug(const char *str, void *user_data)\n{\n\tDBG(\"%s\", str);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"%s\"",
            "str"
          ],
          "line": 4857
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_debug(const char *str, void *user_data)\n{\n\tDBG(\"%s\", str);\n}"
  },
  {
    "function_name": "gatt_client_service_changed",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "4848-4853",
    "snippet": "static void gatt_client_service_changed(uint16_t start_handle,\n\t\t\t\t\t\t\tuint16_t end_handle,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tDBG(\"start 0x%04x, end: 0x%04x\", start_handle, end_handle);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"start 0x%04x, end: 0x%04x\"",
            "start_handle",
            "end_handle"
          ],
          "line": 4852
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_service_changed(uint16_t start_handle,\n\t\t\t\t\t\t\tuint16_t end_handle,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tDBG(\"start 0x%04x, end: 0x%04x\", start_handle, end_handle);\n}"
  },
  {
    "function_name": "gatt_client_ready_cb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "4826-4846",
    "snippet": "static void gatt_client_ready_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct btd_device *device = user_data;\n\n\tDBG(\"status: %s, error: %u\", success ? \"success\" : \"failed\", att_ecode);\n\n\tif (!success) {\n\t\tdevice_svc_resolved(device, BROWSE_GATT, device->bdaddr_type,\n\t\t\t\t\t\t\t\t\t-EIO);\n\t\treturn;\n\t}\n\n\tregister_gatt_services(device);\n\n\tbtd_gatt_client_ready(device->client_dbus);\n\n\tdevice_svc_resolved(device, BROWSE_GATT, device->bdaddr_type, 0);\n\n\tstore_gatt_db(device);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "store_gatt_db",
          "args": [
            "device"
          ],
          "line": 4845
        },
        "resolved": true,
        "details": {
          "function_name": "store_gatt_db",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "2254-2295",
          "snippet": "static void store_gatt_db(struct btd_device *device)\n{\n\tchar filename[PATH_MAX];\n\tchar dst_addr[18];\n\tGKeyFile *key_file;\n\tchar *data;\n\tgsize length = 0;\n\tstruct gatt_saver saver;\n\n\tif (device_address_is_private(device)) {\n\t\tDBG(\"Can't store GATT db for private addressed device %s\",\n\t\t\t\t\t\t\t\tdevice->path);\n\t\treturn;\n\t}\n\n\tif (!gatt_cache_is_enabled(device))\n\t\treturn;\n\n\tba2str(&device->bdaddr, dst_addr);\n\n\tsnprintf(filename, PATH_MAX, STORAGEDIR \"/%s/cache/%s\",\n\t\t\t\tbtd_adapter_get_storage_dir(device->adapter),\n\t\t\t\tdst_addr);\n\tcreate_file(filename, S_IRUSR | S_IWUSR);\n\n\tkey_file = g_key_file_new();\n\tg_key_file_load_from_file(key_file, filename, 0, NULL);\n\n\t/* Remove current attributes since it might have changed */\n\tg_key_file_remove_group(key_file, \"Attributes\", NULL);\n\n\tsaver.key_file = key_file;\n\tsaver.device = device;\n\n\tgatt_db_foreach_service(device->db, NULL, store_service, &saver);\n\n\tdata = g_key_file_to_data(key_file, &length, NULL);\n\tg_file_set_contents(filename, data, length, NULL);\n\n\tg_free(data);\n\tg_key_file_free(key_file);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void store_gatt_db(struct btd_device *device)\n{\n\tchar filename[PATH_MAX];\n\tchar dst_addr[18];\n\tGKeyFile *key_file;\n\tchar *data;\n\tgsize length = 0;\n\tstruct gatt_saver saver;\n\n\tif (device_address_is_private(device)) {\n\t\tDBG(\"Can't store GATT db for private addressed device %s\",\n\t\t\t\t\t\t\t\tdevice->path);\n\t\treturn;\n\t}\n\n\tif (!gatt_cache_is_enabled(device))\n\t\treturn;\n\n\tba2str(&device->bdaddr, dst_addr);\n\n\tsnprintf(filename, PATH_MAX, STORAGEDIR \"/%s/cache/%s\",\n\t\t\t\tbtd_adapter_get_storage_dir(device->adapter),\n\t\t\t\tdst_addr);\n\tcreate_file(filename, S_IRUSR | S_IWUSR);\n\n\tkey_file = g_key_file_new();\n\tg_key_file_load_from_file(key_file, filename, 0, NULL);\n\n\t/* Remove current attributes since it might have changed */\n\tg_key_file_remove_group(key_file, \"Attributes\", NULL);\n\n\tsaver.key_file = key_file;\n\tsaver.device = device;\n\n\tgatt_db_foreach_service(device->db, NULL, store_service, &saver);\n\n\tdata = g_key_file_to_data(key_file, &length, NULL);\n\tg_file_set_contents(filename, data, length, NULL);\n\n\tg_free(data);\n\tg_key_file_free(key_file);\n}"
        }
      },
      {
        "call_info": {
          "callee": "device_svc_resolved",
          "args": [
            "device",
            "BROWSE_GATT",
            "device->bdaddr_type",
            "0"
          ],
          "line": 4843
        },
        "resolved": true,
        "details": {
          "function_name": "device_svc_resolved",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "2378-2426",
          "snippet": "static void device_svc_resolved(struct btd_device *dev, uint8_t browse_type,\n\t\t\t\t\t\tuint8_t bdaddr_type, int err)\n{\n\tstruct bearer_state *state = get_state(dev, bdaddr_type);\n\tstruct browse_req *req = dev->browse;\n\n\tDBG(\"%s err %d\", dev->path, err);\n\n\tstate->svc_resolved = true;\n\n\t/* Disconnection notification can happen before this function\n\t * gets called, so don't set svc_refreshed for a disconnected\n\t * device.\n\t */\n\tif (state->connected)\n\t\tdevice_set_svc_refreshed(dev, true);\n\n\tg_slist_free_full(dev->eir_uuids, g_free);\n\tdev->eir_uuids = NULL;\n\n\tif (dev->pending_paired) {\n\t\tg_dbus_emit_property_changed(dbus_conn, dev->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"Paired\");\n\t\tdev->pending_paired = false;\n\t}\n\n\tif (!dev->temporary) {\n\t\tstore_device_info(dev);\n\n\t\tif (bdaddr_type != BDADDR_BREDR && err == 0)\n\t\t\tstore_services(dev);\n\t}\n\n\tif (req)\n\t\tbrowse_request_complete(req, browse_type, bdaddr_type, err);\n\n\twhile (dev->svc_callbacks) {\n\t\tstruct svc_callback *cb = dev->svc_callbacks->data;\n\n\t\tif (cb->idle_id > 0)\n\t\t\tg_source_remove(cb->idle_id);\n\n\t\tcb->func(dev, err, cb->user_data);\n\n\t\tdev->svc_callbacks = g_slist_delete_link(dev->svc_callbacks,\n\t\t\t\t\t\t\tdev->svc_callbacks);\n\t\tg_free(cb);\n\t}\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *dbus_conn = NULL;",
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void device_svc_resolved(struct btd_device *dev, uint8_t browse_type,\n\t\t\t\t\t\tuint8_t bdaddr_type, int err)\n{\n\tstruct bearer_state *state = get_state(dev, bdaddr_type);\n\tstruct browse_req *req = dev->browse;\n\n\tDBG(\"%s err %d\", dev->path, err);\n\n\tstate->svc_resolved = true;\n\n\t/* Disconnection notification can happen before this function\n\t * gets called, so don't set svc_refreshed for a disconnected\n\t * device.\n\t */\n\tif (state->connected)\n\t\tdevice_set_svc_refreshed(dev, true);\n\n\tg_slist_free_full(dev->eir_uuids, g_free);\n\tdev->eir_uuids = NULL;\n\n\tif (dev->pending_paired) {\n\t\tg_dbus_emit_property_changed(dbus_conn, dev->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"Paired\");\n\t\tdev->pending_paired = false;\n\t}\n\n\tif (!dev->temporary) {\n\t\tstore_device_info(dev);\n\n\t\tif (bdaddr_type != BDADDR_BREDR && err == 0)\n\t\t\tstore_services(dev);\n\t}\n\n\tif (req)\n\t\tbrowse_request_complete(req, browse_type, bdaddr_type, err);\n\n\twhile (dev->svc_callbacks) {\n\t\tstruct svc_callback *cb = dev->svc_callbacks->data;\n\n\t\tif (cb->idle_id > 0)\n\t\t\tg_source_remove(cb->idle_id);\n\n\t\tcb->func(dev, err, cb->user_data);\n\n\t\tdev->svc_callbacks = g_slist_delete_link(dev->svc_callbacks,\n\t\t\t\t\t\t\tdev->svc_callbacks);\n\t\tg_free(cb);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_gatt_client_ready",
          "args": [
            "device->client_dbus"
          ],
          "line": 4841
        },
        "resolved": true,
        "details": {
          "function_name": "btd_gatt_client_ready",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "2130-2151",
          "snippet": "void btd_gatt_client_ready(struct btd_gatt_client *client)\n{\n\tif (!client)\n\t\treturn;\n\n\tif (!client->gatt) {\n\t\tstruct bt_gatt_client *gatt;\n\n\t\tgatt = btd_device_get_gatt_client(client->device);\n\t\tclient->gatt = bt_gatt_client_clone(gatt);\n\t\tif (!client->gatt) {\n\t\t\terror(\"GATT client not initialized\");\n\t\t\treturn;\n\t\t}\n\t}\n\n\tclient->ready = true;\n\n\tDBG(\"GATT client ready\");\n\n\tcreate_services(client);\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nvoid btd_gatt_client_ready(struct btd_gatt_client *client)\n{\n\tif (!client)\n\t\treturn;\n\n\tif (!client->gatt) {\n\t\tstruct bt_gatt_client *gatt;\n\n\t\tgatt = btd_device_get_gatt_client(client->device);\n\t\tclient->gatt = bt_gatt_client_clone(gatt);\n\t\tif (!client->gatt) {\n\t\t\terror(\"GATT client not initialized\");\n\t\t\treturn;\n\t\t}\n\t}\n\n\tclient->ready = true;\n\n\tDBG(\"GATT client ready\");\n\n\tcreate_services(client);\n}"
        }
      },
      {
        "call_info": {
          "callee": "register_gatt_services",
          "args": [
            "device"
          ],
          "line": 4839
        },
        "resolved": true,
        "details": {
          "function_name": "register_gatt_services",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "4797-4822",
          "snippet": "static void register_gatt_services(struct btd_device *device)\n{\n\tstruct browse_req *req = device->browse;\n\tGSList *services = NULL;\n\n\tif (!bt_gatt_client_is_ready(device->client))\n\t\treturn;\n\n\t/*\n\t * TODO: Remove the primaries list entirely once all profiles use\n\t * shared/gatt.\n\t */\n\tgatt_db_foreach_service(device->db, NULL, add_primary, &services);\n\n\tbtd_device_set_temporary(device, false);\n\n\tif (req)\n\t\tupdate_gatt_uuids(req, device->primaries, services);\n\n\tg_slist_free_full(device->primaries, g_free);\n\tdevice->primaries = NULL;\n\n\tdevice_register_primaries(device, services, -1);\n\n\tdevice_add_gatt_services(device);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void register_gatt_services(struct btd_device *device)\n{\n\tstruct browse_req *req = device->browse;\n\tGSList *services = NULL;\n\n\tif (!bt_gatt_client_is_ready(device->client))\n\t\treturn;\n\n\t/*\n\t * TODO: Remove the primaries list entirely once all profiles use\n\t * shared/gatt.\n\t */\n\tgatt_db_foreach_service(device->db, NULL, add_primary, &services);\n\n\tbtd_device_set_temporary(device, false);\n\n\tif (req)\n\t\tupdate_gatt_uuids(req, device->primaries, services);\n\n\tg_slist_free_full(device->primaries, g_free);\n\tdevice->primaries = NULL;\n\n\tdevice_register_primaries(device, services, -1);\n\n\tdevice_add_gatt_services(device);\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"status: %s, error: %u\"",
            "success ? \"success\" : \"failed\"",
            "att_ecode"
          ],
          "line": 4831
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void gatt_client_ready_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct btd_device *device = user_data;\n\n\tDBG(\"status: %s, error: %u\", success ? \"success\" : \"failed\", att_ecode);\n\n\tif (!success) {\n\t\tdevice_svc_resolved(device, BROWSE_GATT, device->bdaddr_type,\n\t\t\t\t\t\t\t\t\t-EIO);\n\t\treturn;\n\t}\n\n\tregister_gatt_services(device);\n\n\tbtd_gatt_client_ready(device->client_dbus);\n\n\tdevice_svc_resolved(device, BROWSE_GATT, device->bdaddr_type, 0);\n\n\tstore_gatt_db(device);\n}"
  },
  {
    "function_name": "register_gatt_services",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "4797-4822",
    "snippet": "static void register_gatt_services(struct btd_device *device)\n{\n\tstruct browse_req *req = device->browse;\n\tGSList *services = NULL;\n\n\tif (!bt_gatt_client_is_ready(device->client))\n\t\treturn;\n\n\t/*\n\t * TODO: Remove the primaries list entirely once all profiles use\n\t * shared/gatt.\n\t */\n\tgatt_db_foreach_service(device->db, NULL, add_primary, &services);\n\n\tbtd_device_set_temporary(device, false);\n\n\tif (req)\n\t\tupdate_gatt_uuids(req, device->primaries, services);\n\n\tg_slist_free_full(device->primaries, g_free);\n\tdevice->primaries = NULL;\n\n\tdevice_register_primaries(device, services, -1);\n\n\tdevice_add_gatt_services(device);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "device_add_gatt_services",
          "args": [
            "device"
          ],
          "line": 4821
        },
        "resolved": true,
        "details": {
          "function_name": "device_add_gatt_services",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "3579-3591",
          "snippet": "static void device_add_gatt_services(struct btd_device *device)\n{\n\tchar addr[18];\n\n\tba2str(&device->bdaddr, addr);\n\n\tif (device->blocked) {\n\t\tDBG(\"Skipping profiles for blocked device %s\", addr);\n\t\treturn;\n\t}\n\n\tgatt_db_foreach_service(device->db, NULL, add_gatt_service, device);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void device_add_gatt_services(struct btd_device *device)\n{\n\tchar addr[18];\n\n\tba2str(&device->bdaddr, addr);\n\n\tif (device->blocked) {\n\t\tDBG(\"Skipping profiles for blocked device %s\", addr);\n\t\treturn;\n\t}\n\n\tgatt_db_foreach_service(device->db, NULL, add_gatt_service, device);\n}"
        }
      },
      {
        "call_info": {
          "callee": "device_register_primaries",
          "args": [
            "device",
            "services",
            "-1"
          ],
          "line": 4819
        },
        "resolved": true,
        "details": {
          "function_name": "device_register_primaries",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "3194-3198",
          "snippet": "static void device_register_primaries(struct btd_device *device,\n\t\t\t\t\t\tGSList *prim_list, int psm)\n{\n\tdevice->primaries = g_slist_concat(device->primaries, prim_list);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void device_register_primaries(struct btd_device *device,\n\t\t\t\t\t\tGSList *prim_list, int psm)\n{\n\tdevice->primaries = g_slist_concat(device->primaries, prim_list);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_slist_free_full",
          "args": [
            "device->primaries",
            "g_free"
          ],
          "line": 4816
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "update_gatt_uuids",
          "args": [
            "req",
            "device->primaries",
            "services"
          ],
          "line": 4814
        },
        "resolved": true,
        "details": {
          "function_name": "update_gatt_uuids",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "4600-4620",
          "snippet": "static void update_gatt_uuids(struct browse_req *req, GSList *current,\n\t\t\t\t\t\t\t\tGSList *found)\n{\n\tGSList *l, *lmatch;\n\n\t/* Added Profiles */\n\tfor (l = found; l; l = g_slist_next(l)) {\n\t\tstruct gatt_primary *prim = l->data;\n\n\t\t/* Entry found ? */\n\t\tlmatch = g_slist_find_custom(current, prim, primary_cmp);\n\t\tif (lmatch)\n\t\t\tcontinue;\n\n\t\t/* New entry */\n\t\treq->profiles_added = g_slist_append(req->profiles_added,\n\t\t\t\t\t\t\tg_strdup(prim->uuid));\n\n\t\tDBG(\"UUID Added: %s\", prim->uuid);\n\t}\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void update_gatt_uuids(struct browse_req *req, GSList *current,\n\t\t\t\t\t\t\t\tGSList *found)\n{\n\tGSList *l, *lmatch;\n\n\t/* Added Profiles */\n\tfor (l = found; l; l = g_slist_next(l)) {\n\t\tstruct gatt_primary *prim = l->data;\n\n\t\t/* Entry found ? */\n\t\tlmatch = g_slist_find_custom(current, prim, primary_cmp);\n\t\tif (lmatch)\n\t\t\tcontinue;\n\n\t\t/* New entry */\n\t\treq->profiles_added = g_slist_append(req->profiles_added,\n\t\t\t\t\t\t\tg_strdup(prim->uuid));\n\n\t\tDBG(\"UUID Added: %s\", prim->uuid);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_device_set_temporary",
          "args": [
            "device",
            "false"
          ],
          "line": 4811
        },
        "resolved": true,
        "details": {
          "function_name": "btd_device_set_temporary",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5336-5368",
          "snippet": "void btd_device_set_temporary(struct btd_device *device, bool temporary)\n{\n\tif (!device)\n\t\treturn;\n\n\tif (device->temporary == temporary)\n\t\treturn;\n\n\tif (device_address_is_private(device))\n\t\treturn;\n\n\tDBG(\"temporary %d\", temporary);\n\n\tdevice->temporary = temporary;\n\n\tif (temporary) {\n\t\tif (device->bredr)\n\t\t\tadapter_whitelist_remove(device->adapter, device);\n\t\tadapter_connect_list_remove(device->adapter, device);\n\t\treturn;\n\t}\n\n\tif (device->bredr)\n\t\tadapter_whitelist_add(device->adapter, device);\n\n\tstore_device_info(device);\n\n\t/* attributes were not stored when resolved if device was temporary */\n\tif (device->bdaddr_type != BDADDR_BREDR &&\n\t\t\tdevice->le_state.svc_resolved &&\n\t\t\tg_slist_length(device->primaries) != 0)\n\t\tstore_services(device);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid btd_device_set_temporary(struct btd_device *device, bool temporary)\n{\n\tif (!device)\n\t\treturn;\n\n\tif (device->temporary == temporary)\n\t\treturn;\n\n\tif (device_address_is_private(device))\n\t\treturn;\n\n\tDBG(\"temporary %d\", temporary);\n\n\tdevice->temporary = temporary;\n\n\tif (temporary) {\n\t\tif (device->bredr)\n\t\t\tadapter_whitelist_remove(device->adapter, device);\n\t\tadapter_connect_list_remove(device->adapter, device);\n\t\treturn;\n\t}\n\n\tif (device->bredr)\n\t\tadapter_whitelist_add(device->adapter, device);\n\n\tstore_device_info(device);\n\n\t/* attributes were not stored when resolved if device was temporary */\n\tif (device->bdaddr_type != BDADDR_BREDR &&\n\t\t\tdevice->le_state.svc_resolved &&\n\t\t\tg_slist_length(device->primaries) != 0)\n\t\tstore_services(device);\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_foreach_service",
          "args": [
            "device->db",
            "NULL",
            "add_primary",
            "&services"
          ],
          "line": 4809
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_foreach_service",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1258-1264",
          "snippet": "void gatt_db_foreach_service(struct gatt_db *db, const bt_uuid_t *uuid,\n\t\t\t\t\t\tgatt_db_attribute_cb_t func,\n\t\t\t\t\t\tvoid *user_data)\n{\n\tgatt_db_foreach_service_in_range(db, uuid, func, user_data, 0x0001,\n\t\t\t\t\t\t\t\t\t0xffff);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nvoid gatt_db_foreach_service(struct gatt_db *db, const bt_uuid_t *uuid,\n\t\t\t\t\t\tgatt_db_attribute_cb_t func,\n\t\t\t\t\t\tvoid *user_data)\n{\n\tgatt_db_foreach_service_in_range(db, uuid, func, user_data, 0x0001,\n\t\t\t\t\t\t\t\t\t0xffff);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_gatt_client_is_ready",
          "args": [
            "device->client"
          ],
          "line": 4802
        },
        "resolved": true,
        "details": {
          "function_name": "bt_gatt_client_is_ready",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-client.c",
          "lines": "2015-2018",
          "snippet": "bool bt_gatt_client_is_ready(struct bt_gatt_client *client)\n{\n\treturn (client && client->ready);\n}",
          "includes": [
            "#include <sys/uio.h>",
            "#include <limits.h>",
            "#include <assert.h>",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-helpers.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/att.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/uio.h>\n#include <limits.h>\n#include <assert.h>\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-helpers.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/att.h\"\n#include <config.h>\n\nbool bt_gatt_client_is_ready(struct bt_gatt_client *client)\n{\n\treturn (client && client->ready);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void register_gatt_services(struct btd_device *device)\n{\n\tstruct browse_req *req = device->browse;\n\tGSList *services = NULL;\n\n\tif (!bt_gatt_client_is_ready(device->client))\n\t\treturn;\n\n\t/*\n\t * TODO: Remove the primaries list entirely once all profiles use\n\t * shared/gatt.\n\t */\n\tgatt_db_foreach_service(device->db, NULL, add_primary, &services);\n\n\tbtd_device_set_temporary(device, false);\n\n\tif (req)\n\t\tupdate_gatt_uuids(req, device->primaries, services);\n\n\tg_slist_free_full(device->primaries, g_free);\n\tdevice->primaries = NULL;\n\n\tdevice_register_primaries(device, services, -1);\n\n\tdevice_add_gatt_services(device);\n}"
  },
  {
    "function_name": "att_disconnected_cb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "4765-4795",
    "snippet": "static void att_disconnected_cb(int err, void *user_data)\n{\n\tstruct btd_device *device = user_data;\n\n\tDBG(\"\");\n\n\tif (device->browse)\n\t\tgoto done;\n\n\tDBG(\"%s (%d)\", strerror(err), err);\n\n\tg_slist_foreach(device->services, disconnect_gatt_service, NULL);\n\n\tbtd_gatt_client_disconnected(device->client_dbus);\n\n\tif (!device_get_auto_connect(device)) {\n\t\tDBG(\"Automatic connection disabled\");\n\t\tgoto done;\n\t}\n\n\t/*\n\t * Keep scanning/re-connection active if disconnection reason\n\t * is connection timeout, remote user terminated connection or local\n\t * initiated disconnection.\n\t */\n\tif (err == ETIMEDOUT || err == ECONNRESET || err == ECONNABORTED)\n\t\tadapter_connect_list_add(device->adapter, device);\n\ndone:\n\tattio_cleanup(device);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "attio_cleanup",
          "args": [
            "device"
          ],
          "line": 4794
        },
        "resolved": true,
        "details": {
          "function_name": "attio_cleanup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "585-612",
          "snippet": "static void attio_cleanup(struct btd_device *device)\n{\n\tif (device->att_disconn_id)\n\t\tbt_att_unregister_disconnect(device->att,\n\t\t\t\t\t\t\tdevice->att_disconn_id);\n\n\tif (device->att_io) {\n\t\tg_io_channel_shutdown(device->att_io, FALSE, NULL);\n\t\tg_io_channel_unref(device->att_io);\n\t\tdevice->att_io = NULL;\n\t}\n\n\tgatt_client_cleanup(device);\n\tgatt_server_cleanup(device);\n\n\tif (device->att) {\n\t\tbt_att_unref(device->att);\n\t\tdevice->att = NULL;\n\t}\n\n\tif (device->attrib) {\n\t\tGAttrib *attrib = device->attrib;\n\n\t\tdevice->attrib = NULL;\n\t\tg_attrib_cancel_all(attrib);\n\t\tg_attrib_unref(attrib);\n\t}\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void attio_cleanup(struct btd_device *device)\n{\n\tif (device->att_disconn_id)\n\t\tbt_att_unregister_disconnect(device->att,\n\t\t\t\t\t\t\tdevice->att_disconn_id);\n\n\tif (device->att_io) {\n\t\tg_io_channel_shutdown(device->att_io, FALSE, NULL);\n\t\tg_io_channel_unref(device->att_io);\n\t\tdevice->att_io = NULL;\n\t}\n\n\tgatt_client_cleanup(device);\n\tgatt_server_cleanup(device);\n\n\tif (device->att) {\n\t\tbt_att_unref(device->att);\n\t\tdevice->att = NULL;\n\t}\n\n\tif (device->attrib) {\n\t\tGAttrib *attrib = device->attrib;\n\n\t\tdevice->attrib = NULL;\n\t\tg_attrib_cancel_all(attrib);\n\t\tg_attrib_unref(attrib);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "adapter_connect_list_add",
          "args": [
            "device->adapter",
            "device"
          ],
          "line": 4791
        },
        "resolved": true,
        "details": {
          "function_name": "adapter_connect_list_add",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "4470-4513",
          "snippet": "int adapter_connect_list_add(struct btd_adapter *adapter,\n\t\t\t\t\tstruct btd_device *device)\n{\n\t/*\n\t * If the adapter->connect_le device is getting added back to\n\t * the connect list it probably means that the connect attempt\n\t * failed and hence we should clear this pointer\n\t */\n\tif (device == adapter->connect_le)\n\t\tadapter->connect_le = NULL;\n\n\t/*\n\t * If kernel background scanning is supported then the\n\t * adapter_auto_connect_add() function is used to maintain what to\n\t * connect.\n\t */\n\tif (kernel_conn_control)\n\t\treturn 0;\n\n\tif (g_slist_find(adapter->connect_list, device)) {\n\t\tDBG(\"ignoring already added device %s\",\n\t\t\t\t\t\tdevice_get_path(device));\n\t\tgoto done;\n\t}\n\n\tif (!(adapter->supported_settings & MGMT_SETTING_LE)) {\n\t\tbtd_error(adapter->dev_id,\n\t\t\t\"Can't add %s to non-LE capable adapter connect list\",\n\t\t\t\t\t\tdevice_get_path(device));\n\t\treturn -ENOTSUP;\n\t}\n\n\tadapter->connect_list = g_slist_append(adapter->connect_list, device);\n\tDBG(\"%s added to %s's connect_list\", device_get_path(device),\n\t\t\t\t\t\t\tadapter->system_name);\n\ndone:\n\tif (!(adapter->current_settings & MGMT_SETTING_POWERED))\n\t\treturn 0;\n\n\ttrigger_passive_scanning(adapter);\n\n\treturn 0;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static bool kernel_conn_control = false;",
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic bool kernel_conn_control = false;\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nint adapter_connect_list_add(struct btd_adapter *adapter,\n\t\t\t\t\tstruct btd_device *device)\n{\n\t/*\n\t * If the adapter->connect_le device is getting added back to\n\t * the connect list it probably means that the connect attempt\n\t * failed and hence we should clear this pointer\n\t */\n\tif (device == adapter->connect_le)\n\t\tadapter->connect_le = NULL;\n\n\t/*\n\t * If kernel background scanning is supported then the\n\t * adapter_auto_connect_add() function is used to maintain what to\n\t * connect.\n\t */\n\tif (kernel_conn_control)\n\t\treturn 0;\n\n\tif (g_slist_find(adapter->connect_list, device)) {\n\t\tDBG(\"ignoring already added device %s\",\n\t\t\t\t\t\tdevice_get_path(device));\n\t\tgoto done;\n\t}\n\n\tif (!(adapter->supported_settings & MGMT_SETTING_LE)) {\n\t\tbtd_error(adapter->dev_id,\n\t\t\t\"Can't add %s to non-LE capable adapter connect list\",\n\t\t\t\t\t\tdevice_get_path(device));\n\t\treturn -ENOTSUP;\n\t}\n\n\tadapter->connect_list = g_slist_append(adapter->connect_list, device);\n\tDBG(\"%s added to %s's connect_list\", device_get_path(device),\n\t\t\t\t\t\t\tadapter->system_name);\n\ndone:\n\tif (!(adapter->current_settings & MGMT_SETTING_POWERED))\n\t\treturn 0;\n\n\ttrigger_passive_scanning(adapter);\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Automatic connection disabled\""
          ],
          "line": 4781
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device_get_auto_connect",
          "args": [
            "device"
          ],
          "line": 4780
        },
        "resolved": true,
        "details": {
          "function_name": "device_get_auto_connect",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "4745-4751",
          "snippet": "static bool device_get_auto_connect(struct btd_device *device)\n{\n\tif (device->disable_auto_connect)\n\t\treturn false;\n\n\treturn device->auto_connect;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic bool device_get_auto_connect(struct btd_device *device)\n{\n\tif (device->disable_auto_connect)\n\t\treturn false;\n\n\treturn device->auto_connect;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_gatt_client_disconnected",
          "args": [
            "device->client_dbus"
          ],
          "line": 4778
        },
        "resolved": true,
        "details": {
          "function_name": "btd_gatt_client_disconnected",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "2216-2234",
          "snippet": "void btd_gatt_client_disconnected(struct btd_gatt_client *client)\n{\n\tif (!client || !client->gatt)\n\t\treturn;\n\n\tDBG(\"Device disconnected. Cleaning up.\");\n\n\tqueue_remove_all(client->ios, NULL, NULL, client_shutdown);\n\n\t/*\n\t * TODO: Once GATT over BR/EDR is properly supported, we should pass the\n\t * correct bdaddr_type based on the transport over which GATT is being\n\t * done.\n\t */\n\tqueue_foreach(client->all_notify_clients, clear_notify_id, NULL);\n\n\tbt_gatt_client_unref(client->gatt);\n\tclient->gatt = NULL;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nvoid btd_gatt_client_disconnected(struct btd_gatt_client *client)\n{\n\tif (!client || !client->gatt)\n\t\treturn;\n\n\tDBG(\"Device disconnected. Cleaning up.\");\n\n\tqueue_remove_all(client->ios, NULL, NULL, client_shutdown);\n\n\t/*\n\t * TODO: Once GATT over BR/EDR is properly supported, we should pass the\n\t * correct bdaddr_type based on the transport over which GATT is being\n\t * done.\n\t */\n\tqueue_foreach(client->all_notify_clients, clear_notify_id, NULL);\n\n\tbt_gatt_client_unref(client->gatt);\n\tclient->gatt = NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_slist_foreach",
          "args": [
            "device->services",
            "disconnect_gatt_service",
            "NULL"
          ],
          "line": 4776
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"%s (%d)\"",
            "strerror(err)",
            "err"
          ],
          "line": 4774
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strerror",
          "args": [
            "err"
          ],
          "line": 4774
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"\""
          ],
          "line": 4769
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void att_disconnected_cb(int err, void *user_data)\n{\n\tstruct btd_device *device = user_data;\n\n\tDBG(\"\");\n\n\tif (device->browse)\n\t\tgoto done;\n\n\tDBG(\"%s (%d)\", strerror(err), err);\n\n\tg_slist_foreach(device->services, disconnect_gatt_service, NULL);\n\n\tbtd_gatt_client_disconnected(device->client_dbus);\n\n\tif (!device_get_auto_connect(device)) {\n\t\tDBG(\"Automatic connection disabled\");\n\t\tgoto done;\n\t}\n\n\t/*\n\t * Keep scanning/re-connection active if disconnection reason\n\t * is connection timeout, remote user terminated connection or local\n\t * initiated disconnection.\n\t */\n\tif (err == ETIMEDOUT || err == ECONNRESET || err == ECONNABORTED)\n\t\tadapter_connect_list_add(device->adapter, device);\n\ndone:\n\tattio_cleanup(device);\n}"
  },
  {
    "function_name": "disconnect_gatt_service",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "4753-4763",
    "snippet": "static void disconnect_gatt_service(gpointer data, gpointer user_data)\n{\n\tstruct btd_service *service = data;\n\tstruct btd_profile *profile = btd_service_get_profile(service);\n\n\t/* Ignore if profile cannot accept connections */\n\tif (!profile->accept)\n\t\treturn;\n\n\tbtd_service_disconnect(service);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "btd_service_disconnect",
          "args": [
            "service"
          ],
          "line": 4762
        },
        "resolved": true,
        "details": {
          "function_name": "btd_service_disconnect",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
          "lines": "271-309",
          "snippet": "int btd_service_disconnect(struct btd_service *service)\n{\n\tstruct btd_profile *profile = service->profile;\n\tchar addr[18];\n\tint err;\n\n\tif (!profile->disconnect)\n\t\treturn -ENOTSUP;\n\n\tswitch (service->state) {\n\tcase BTD_SERVICE_STATE_UNAVAILABLE:\n\t\treturn -EINVAL;\n\tcase BTD_SERVICE_STATE_DISCONNECTED:\n\tcase BTD_SERVICE_STATE_DISCONNECTING:\n\t\treturn -EALREADY;\n\tcase BTD_SERVICE_STATE_CONNECTING:\n\tcase BTD_SERVICE_STATE_CONNECTED:\n\t\tbreak;\n\t}\n\n\tchange_state(service, BTD_SERVICE_STATE_DISCONNECTING, 0);\n\n\terr = profile->disconnect(service);\n\tif (err == 0)\n\t\treturn 0;\n\n\tif (err == -ENOTCONN) {\n\t\tbtd_service_disconnecting_complete(service, 0);\n\t\treturn 0;\n\t}\n\n\tba2str(device_get_address(service->device), addr);\n\terror(\"%s profile disconnect failed for %s: %s\", profile->name, addr,\n\t\t\t\t\t\t\t\tstrerror(-err));\n\n\tbtd_service_disconnecting_complete(service, err);\n\n\treturn err;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/stat.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nint btd_service_disconnect(struct btd_service *service)\n{\n\tstruct btd_profile *profile = service->profile;\n\tchar addr[18];\n\tint err;\n\n\tif (!profile->disconnect)\n\t\treturn -ENOTSUP;\n\n\tswitch (service->state) {\n\tcase BTD_SERVICE_STATE_UNAVAILABLE:\n\t\treturn -EINVAL;\n\tcase BTD_SERVICE_STATE_DISCONNECTED:\n\tcase BTD_SERVICE_STATE_DISCONNECTING:\n\t\treturn -EALREADY;\n\tcase BTD_SERVICE_STATE_CONNECTING:\n\tcase BTD_SERVICE_STATE_CONNECTED:\n\t\tbreak;\n\t}\n\n\tchange_state(service, BTD_SERVICE_STATE_DISCONNECTING, 0);\n\n\terr = profile->disconnect(service);\n\tif (err == 0)\n\t\treturn 0;\n\n\tif (err == -ENOTCONN) {\n\t\tbtd_service_disconnecting_complete(service, 0);\n\t\treturn 0;\n\t}\n\n\tba2str(device_get_address(service->device), addr);\n\terror(\"%s profile disconnect failed for %s: %s\", profile->name, addr,\n\t\t\t\t\t\t\t\tstrerror(-err));\n\n\tbtd_service_disconnecting_complete(service, err);\n\n\treturn err;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_service_get_profile",
          "args": [
            "service"
          ],
          "line": 4756
        },
        "resolved": true,
        "details": {
          "function_name": "btd_service_get_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
          "lines": "316-319",
          "snippet": "struct btd_profile *btd_service_get_profile(const struct btd_service *service)\n{\n\treturn service->profile;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/stat.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstruct btd_profile *btd_service_get_profile(const struct btd_service *service)\n{\n\treturn service->profile;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void disconnect_gatt_service(gpointer data, gpointer user_data)\n{\n\tstruct btd_service *service = data;\n\tstruct btd_profile *profile = btd_service_get_profile(service);\n\n\t/* Ignore if profile cannot accept connections */\n\tif (!profile->accept)\n\t\treturn;\n\n\tbtd_service_disconnect(service);\n}"
  },
  {
    "function_name": "device_get_auto_connect",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "4745-4751",
    "snippet": "static bool device_get_auto_connect(struct btd_device *device)\n{\n\tif (device->disable_auto_connect)\n\t\treturn false;\n\n\treturn device->auto_connect;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic bool device_get_auto_connect(struct btd_device *device)\n{\n\tif (device->disable_auto_connect)\n\t\treturn false;\n\n\treturn device->auto_connect;\n}"
  },
  {
    "function_name": "browse_cb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "4712-4743",
    "snippet": "static void browse_cb(sdp_list_t *recs, int err, gpointer user_data)\n{\n\tstruct browse_req *req = user_data;\n\tstruct btd_device *device = req->device;\n\tstruct btd_adapter *adapter = device->adapter;\n\tuuid_t uuid;\n\n\t/* If we have a valid response and req->search_uuid == 2, then L2CAP\n\t * UUID & PNP searching was successful -- we are done */\n\tif (err < 0 || (req->search_uuid == 2 && req->records)) {\n\t\tif (err == -ECONNRESET && req->reconnect_attempt < 1) {\n\t\t\treq->search_uuid--;\n\t\t\treq->reconnect_attempt++;\n\t\t} else\n\t\t\tgoto done;\n\t}\n\n\tupdate_bredr_services(req, recs);\n\n\t/* Search for mandatory uuids */\n\tif (uuid_list[req->search_uuid]) {\n\t\tsdp_uuid16_create(&uuid, uuid_list[req->search_uuid++]);\n\t\tbt_search_service(btd_adapter_get_address(adapter),\n\t\t\t\t\t\t&device->bdaddr, &uuid,\n\t\t\t\t\t\tbrowse_cb, user_data, NULL,\n\t\t\t\t\t\treq->sdp_flags);\n\t\treturn;\n\t}\n\ndone:\n\tsearch_cb(recs, err, user_data);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static const uint16_t uuid_list[] = {\n\tL2CAP_UUID,\n\tPNP_INFO_SVCLASS_ID,\n\tPUBLIC_BROWSE_GROUP,\n\t0\n};",
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "search_cb",
          "args": [
            "recs",
            "err",
            "user_data"
          ],
          "line": 4742
        },
        "resolved": true,
        "details": {
          "function_name": "search_cb",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "4662-4710",
          "snippet": "static void search_cb(sdp_list_t *recs, int err, gpointer user_data)\n{\n\tstruct browse_req *req = user_data;\n\tstruct btd_device *device = req->device;\n\tGSList *primaries;\n\tchar addr[18];\n\n\tba2str(&device->bdaddr, addr);\n\n\tif (err < 0) {\n\t\terror(\"%s: error updating services: %s (%d)\",\n\t\t\t\taddr, strerror(-err), -err);\n\t\tgoto send_reply;\n\t}\n\n\tupdate_bredr_services(req, recs);\n\n\tif (device->tmp_records)\n\t\tsdp_list_free(device->tmp_records,\n\t\t\t\t\t(sdp_free_func_t) sdp_record_free);\n\n\tdevice->tmp_records = req->records;\n\treq->records = NULL;\n\n\tif (!req->profiles_added) {\n\t\tDBG(\"%s: No service update\", addr);\n\t\tgoto send_reply;\n\t}\n\n\tprimaries = device_services_from_record(device, req->profiles_added);\n\tif (primaries)\n\t\tdevice_register_primaries(device, primaries, ATT_PSM);\n\n\t/*\n\t * TODO: The btd_service instances for GATT services need to be\n\t * initialized with the service handles. Eventually this code should\n\t * perform ATT protocol service discovery over the ATT PSM to obtain\n\t * the full list of services and populate a client-role gatt_db over\n\t * BR/EDR.\n\t */\n\tdevice_probe_profiles(device, req->profiles_added);\n\n\t/* Propagate services changes */\n\tg_dbus_emit_property_changed(dbus_conn, req->device->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"UUIDs\");\n\nsend_reply:\n\tdevice_svc_resolved(device, BROWSE_SDP, BDADDR_BREDR, err);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *dbus_conn = NULL;",
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void search_cb(sdp_list_t *recs, int err, gpointer user_data)\n{\n\tstruct browse_req *req = user_data;\n\tstruct btd_device *device = req->device;\n\tGSList *primaries;\n\tchar addr[18];\n\n\tba2str(&device->bdaddr, addr);\n\n\tif (err < 0) {\n\t\terror(\"%s: error updating services: %s (%d)\",\n\t\t\t\taddr, strerror(-err), -err);\n\t\tgoto send_reply;\n\t}\n\n\tupdate_bredr_services(req, recs);\n\n\tif (device->tmp_records)\n\t\tsdp_list_free(device->tmp_records,\n\t\t\t\t\t(sdp_free_func_t) sdp_record_free);\n\n\tdevice->tmp_records = req->records;\n\treq->records = NULL;\n\n\tif (!req->profiles_added) {\n\t\tDBG(\"%s: No service update\", addr);\n\t\tgoto send_reply;\n\t}\n\n\tprimaries = device_services_from_record(device, req->profiles_added);\n\tif (primaries)\n\t\tdevice_register_primaries(device, primaries, ATT_PSM);\n\n\t/*\n\t * TODO: The btd_service instances for GATT services need to be\n\t * initialized with the service handles. Eventually this code should\n\t * perform ATT protocol service discovery over the ATT PSM to obtain\n\t * the full list of services and populate a client-role gatt_db over\n\t * BR/EDR.\n\t */\n\tdevice_probe_profiles(device, req->profiles_added);\n\n\t/* Propagate services changes */\n\tg_dbus_emit_property_changed(dbus_conn, req->device->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"UUIDs\");\n\nsend_reply:\n\tdevice_svc_resolved(device, BROWSE_SDP, BDADDR_BREDR, err);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_search_service",
          "args": [
            "btd_adapter_get_address(adapter)",
            "&device->bdaddr",
            "&uuid",
            "browse_cb",
            "user_data",
            "NULL",
            "req->sdp_flags"
          ],
          "line": 4734
        },
        "resolved": true,
        "details": {
          "function_name": "bt_search_service",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdp-client.c",
          "lines": "341-362",
          "snippet": "int bt_search_service(const bdaddr_t *src, const bdaddr_t *dst,\n\t\t\tuuid_t *uuid, bt_callback_t cb, void *user_data,\n\t\t\tbt_destroy_t destroy, uint16_t flags)\n{\n\tstruct search_context *ctxt = NULL;\n\tint err;\n\n\tif (!cb)\n\t\treturn -EINVAL;\n\n\terr = create_search_context(&ctxt, src, dst, uuid, flags);\n\tif (err < 0)\n\t\treturn err;\n\n\tctxt->cb\t= cb;\n\tctxt->destroy\t= destroy;\n\tctxt->user_data\t= user_data;\n\n\tcontext_list = g_slist_append(context_list, ctxt);\n\n\treturn 0;\n}",
          "includes": [
            "#include \"sdp-client.h\"",
            "#include \"log.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static GSList *context_list = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"sdp-client.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nstatic GSList *context_list = NULL;\n\nint bt_search_service(const bdaddr_t *src, const bdaddr_t *dst,\n\t\t\tuuid_t *uuid, bt_callback_t cb, void *user_data,\n\t\t\tbt_destroy_t destroy, uint16_t flags)\n{\n\tstruct search_context *ctxt = NULL;\n\tint err;\n\n\tif (!cb)\n\t\treturn -EINVAL;\n\n\terr = create_search_context(&ctxt, src, dst, uuid, flags);\n\tif (err < 0)\n\t\treturn err;\n\n\tctxt->cb\t= cb;\n\tctxt->destroy\t= destroy;\n\tctxt->user_data\t= user_data;\n\n\tcontext_list = g_slist_append(context_list, ctxt);\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_adapter_get_address",
          "args": [
            "adapter"
          ],
          "line": 4734
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_get_address",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "5881-5884",
          "snippet": "const bdaddr_t *btd_adapter_get_address(struct btd_adapter *adapter)\n{\n\treturn &adapter->bdaddr;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nconst bdaddr_t *btd_adapter_get_address(struct btd_adapter *adapter)\n{\n\treturn &adapter->bdaddr;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sdp_uuid16_create",
          "args": [
            "&uuid",
            "uuid_list[req->search_uuid++]"
          ],
          "line": 4733
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "update_bredr_services",
          "args": [
            "req",
            "recs"
          ],
          "line": 4729
        },
        "resolved": true,
        "details": {
          "function_name": "update_bredr_services",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "4486-4593",
          "snippet": "static void update_bredr_services(struct browse_req *req, sdp_list_t *recs)\n{\n\tstruct btd_device *device = req->device;\n\tsdp_list_t *seq;\n\tchar srcaddr[18], dstaddr[18];\n\tchar sdp_file[PATH_MAX];\n\tchar att_file[PATH_MAX];\n\tGKeyFile *sdp_key_file;\n\tGKeyFile *att_key_file;\n\tchar *data;\n\tgsize length = 0;\n\n\tba2str(btd_adapter_get_address(device->adapter), srcaddr);\n\tba2str(&device->bdaddr, dstaddr);\n\n\tsnprintf(sdp_file, PATH_MAX, STORAGEDIR \"/%s/cache/%s\", srcaddr,\n\t\t\t\t\t\t\t\tdstaddr);\n\n\tsdp_key_file = g_key_file_new();\n\tg_key_file_load_from_file(sdp_key_file, sdp_file, 0, NULL);\n\n\tsnprintf(att_file, PATH_MAX, STORAGEDIR \"/%s/%s/attributes\", srcaddr,\n\t\t\t\t\t\t\t\tdstaddr);\n\n\tatt_key_file = g_key_file_new();\n\tg_key_file_load_from_file(att_key_file, att_file, 0, NULL);\n\n\tfor (seq = recs; seq; seq = seq->next) {\n\t\tsdp_record_t *rec = (sdp_record_t *) seq->data;\n\t\tsdp_list_t *svcclass = NULL;\n\t\tchar *profile_uuid;\n\n\t\tif (!rec)\n\t\t\tbreak;\n\n\t\tif (sdp_get_service_classes(rec, &svcclass) < 0)\n\t\t\tcontinue;\n\n\t\t/* Check for empty service classes list */\n\t\tif (svcclass == NULL) {\n\t\t\tDBG(\"Skipping record with no service classes\");\n\t\t\tcontinue;\n\t\t}\n\n\t\t/* Extract the first element and skip the remainning */\n\t\tprofile_uuid = bt_uuid2string(svcclass->data);\n\t\tif (!profile_uuid) {\n\t\t\tsdp_list_free(svcclass, free);\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (bt_uuid_strcmp(profile_uuid, PNP_UUID) == 0) {\n\t\t\tuint16_t source, vendor, product, version;\n\t\t\tsdp_data_t *pdlist;\n\n\t\t\tpdlist = sdp_data_get(rec, SDP_ATTR_VENDOR_ID_SOURCE);\n\t\t\tsource = pdlist ? pdlist->val.uint16 : 0x0000;\n\n\t\t\tpdlist = sdp_data_get(rec, SDP_ATTR_VENDOR_ID);\n\t\t\tvendor = pdlist ? pdlist->val.uint16 : 0x0000;\n\n\t\t\tpdlist = sdp_data_get(rec, SDP_ATTR_PRODUCT_ID);\n\t\t\tproduct = pdlist ? pdlist->val.uint16 : 0x0000;\n\n\t\t\tpdlist = sdp_data_get(rec, SDP_ATTR_VERSION);\n\t\t\tversion = pdlist ? pdlist->val.uint16 : 0x0000;\n\n\t\t\tif (source || vendor || product || version)\n\t\t\t\tbtd_device_set_pnpid(device, source, vendor,\n\t\t\t\t\t\t\tproduct, version);\n\t\t}\n\n\t\tif (update_record(req, profile_uuid, rec) < 0)\n\t\t\tgoto next;\n\n\t\tif (sdp_key_file)\n\t\t\tstore_sdp_record(sdp_key_file, rec);\n\n\t\tif (att_key_file)\n\t\t\tstore_primaries_from_sdp_record(att_key_file, rec);\n\nnext:\n\t\tfree(profile_uuid);\n\t\tsdp_list_free(svcclass, free);\n\t}\n\n\tif (sdp_key_file) {\n\t\tdata = g_key_file_to_data(sdp_key_file, &length, NULL);\n\t\tif (length > 0) {\n\t\t\tcreate_file(sdp_file, S_IRUSR | S_IWUSR);\n\t\t\tg_file_set_contents(sdp_file, data, length, NULL);\n\t\t}\n\n\t\tg_free(data);\n\t\tg_key_file_free(sdp_key_file);\n\t}\n\n\tif (att_key_file) {\n\t\tdata = g_key_file_to_data(att_key_file, &length, NULL);\n\t\tif (length > 0) {\n\t\t\tcreate_file(att_file, S_IRUSR | S_IWUSR);\n\t\t\tg_file_set_contents(att_file, data, length, NULL);\n\t\t}\n\n\t\tg_free(data);\n\t\tg_key_file_free(att_key_file);\n\t}\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void update_bredr_services(struct browse_req *req, sdp_list_t *recs)\n{\n\tstruct btd_device *device = req->device;\n\tsdp_list_t *seq;\n\tchar srcaddr[18], dstaddr[18];\n\tchar sdp_file[PATH_MAX];\n\tchar att_file[PATH_MAX];\n\tGKeyFile *sdp_key_file;\n\tGKeyFile *att_key_file;\n\tchar *data;\n\tgsize length = 0;\n\n\tba2str(btd_adapter_get_address(device->adapter), srcaddr);\n\tba2str(&device->bdaddr, dstaddr);\n\n\tsnprintf(sdp_file, PATH_MAX, STORAGEDIR \"/%s/cache/%s\", srcaddr,\n\t\t\t\t\t\t\t\tdstaddr);\n\n\tsdp_key_file = g_key_file_new();\n\tg_key_file_load_from_file(sdp_key_file, sdp_file, 0, NULL);\n\n\tsnprintf(att_file, PATH_MAX, STORAGEDIR \"/%s/%s/attributes\", srcaddr,\n\t\t\t\t\t\t\t\tdstaddr);\n\n\tatt_key_file = g_key_file_new();\n\tg_key_file_load_from_file(att_key_file, att_file, 0, NULL);\n\n\tfor (seq = recs; seq; seq = seq->next) {\n\t\tsdp_record_t *rec = (sdp_record_t *) seq->data;\n\t\tsdp_list_t *svcclass = NULL;\n\t\tchar *profile_uuid;\n\n\t\tif (!rec)\n\t\t\tbreak;\n\n\t\tif (sdp_get_service_classes(rec, &svcclass) < 0)\n\t\t\tcontinue;\n\n\t\t/* Check for empty service classes list */\n\t\tif (svcclass == NULL) {\n\t\t\tDBG(\"Skipping record with no service classes\");\n\t\t\tcontinue;\n\t\t}\n\n\t\t/* Extract the first element and skip the remainning */\n\t\tprofile_uuid = bt_uuid2string(svcclass->data);\n\t\tif (!profile_uuid) {\n\t\t\tsdp_list_free(svcclass, free);\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (bt_uuid_strcmp(profile_uuid, PNP_UUID) == 0) {\n\t\t\tuint16_t source, vendor, product, version;\n\t\t\tsdp_data_t *pdlist;\n\n\t\t\tpdlist = sdp_data_get(rec, SDP_ATTR_VENDOR_ID_SOURCE);\n\t\t\tsource = pdlist ? pdlist->val.uint16 : 0x0000;\n\n\t\t\tpdlist = sdp_data_get(rec, SDP_ATTR_VENDOR_ID);\n\t\t\tvendor = pdlist ? pdlist->val.uint16 : 0x0000;\n\n\t\t\tpdlist = sdp_data_get(rec, SDP_ATTR_PRODUCT_ID);\n\t\t\tproduct = pdlist ? pdlist->val.uint16 : 0x0000;\n\n\t\t\tpdlist = sdp_data_get(rec, SDP_ATTR_VERSION);\n\t\t\tversion = pdlist ? pdlist->val.uint16 : 0x0000;\n\n\t\t\tif (source || vendor || product || version)\n\t\t\t\tbtd_device_set_pnpid(device, source, vendor,\n\t\t\t\t\t\t\tproduct, version);\n\t\t}\n\n\t\tif (update_record(req, profile_uuid, rec) < 0)\n\t\t\tgoto next;\n\n\t\tif (sdp_key_file)\n\t\t\tstore_sdp_record(sdp_key_file, rec);\n\n\t\tif (att_key_file)\n\t\t\tstore_primaries_from_sdp_record(att_key_file, rec);\n\nnext:\n\t\tfree(profile_uuid);\n\t\tsdp_list_free(svcclass, free);\n\t}\n\n\tif (sdp_key_file) {\n\t\tdata = g_key_file_to_data(sdp_key_file, &length, NULL);\n\t\tif (length > 0) {\n\t\t\tcreate_file(sdp_file, S_IRUSR | S_IWUSR);\n\t\t\tg_file_set_contents(sdp_file, data, length, NULL);\n\t\t}\n\n\t\tg_free(data);\n\t\tg_key_file_free(sdp_key_file);\n\t}\n\n\tif (att_key_file) {\n\t\tdata = g_key_file_to_data(att_key_file, &length, NULL);\n\t\tif (length > 0) {\n\t\t\tcreate_file(att_file, S_IRUSR | S_IWUSR);\n\t\t\tg_file_set_contents(att_file, data, length, NULL);\n\t\t}\n\n\t\tg_free(data);\n\t\tg_key_file_free(att_key_file);\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic const uint16_t uuid_list[] = {\n\tL2CAP_UUID,\n\tPNP_INFO_SVCLASS_ID,\n\tPUBLIC_BROWSE_GROUP,\n\t0\n};\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void browse_cb(sdp_list_t *recs, int err, gpointer user_data)\n{\n\tstruct browse_req *req = user_data;\n\tstruct btd_device *device = req->device;\n\tstruct btd_adapter *adapter = device->adapter;\n\tuuid_t uuid;\n\n\t/* If we have a valid response and req->search_uuid == 2, then L2CAP\n\t * UUID & PNP searching was successful -- we are done */\n\tif (err < 0 || (req->search_uuid == 2 && req->records)) {\n\t\tif (err == -ECONNRESET && req->reconnect_attempt < 1) {\n\t\t\treq->search_uuid--;\n\t\t\treq->reconnect_attempt++;\n\t\t} else\n\t\t\tgoto done;\n\t}\n\n\tupdate_bredr_services(req, recs);\n\n\t/* Search for mandatory uuids */\n\tif (uuid_list[req->search_uuid]) {\n\t\tsdp_uuid16_create(&uuid, uuid_list[req->search_uuid++]);\n\t\tbt_search_service(btd_adapter_get_address(adapter),\n\t\t\t\t\t\t&device->bdaddr, &uuid,\n\t\t\t\t\t\tbrowse_cb, user_data, NULL,\n\t\t\t\t\t\treq->sdp_flags);\n\t\treturn;\n\t}\n\ndone:\n\tsearch_cb(recs, err, user_data);\n}"
  },
  {
    "function_name": "search_cb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "4662-4710",
    "snippet": "static void search_cb(sdp_list_t *recs, int err, gpointer user_data)\n{\n\tstruct browse_req *req = user_data;\n\tstruct btd_device *device = req->device;\n\tGSList *primaries;\n\tchar addr[18];\n\n\tba2str(&device->bdaddr, addr);\n\n\tif (err < 0) {\n\t\terror(\"%s: error updating services: %s (%d)\",\n\t\t\t\taddr, strerror(-err), -err);\n\t\tgoto send_reply;\n\t}\n\n\tupdate_bredr_services(req, recs);\n\n\tif (device->tmp_records)\n\t\tsdp_list_free(device->tmp_records,\n\t\t\t\t\t(sdp_free_func_t) sdp_record_free);\n\n\tdevice->tmp_records = req->records;\n\treq->records = NULL;\n\n\tif (!req->profiles_added) {\n\t\tDBG(\"%s: No service update\", addr);\n\t\tgoto send_reply;\n\t}\n\n\tprimaries = device_services_from_record(device, req->profiles_added);\n\tif (primaries)\n\t\tdevice_register_primaries(device, primaries, ATT_PSM);\n\n\t/*\n\t * TODO: The btd_service instances for GATT services need to be\n\t * initialized with the service handles. Eventually this code should\n\t * perform ATT protocol service discovery over the ATT PSM to obtain\n\t * the full list of services and populate a client-role gatt_db over\n\t * BR/EDR.\n\t */\n\tdevice_probe_profiles(device, req->profiles_added);\n\n\t/* Propagate services changes */\n\tg_dbus_emit_property_changed(dbus_conn, req->device->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"UUIDs\");\n\nsend_reply:\n\tdevice_svc_resolved(device, BROWSE_SDP, BDADDR_BREDR, err);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static DBusConnection *dbus_conn = NULL;",
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "device_svc_resolved",
          "args": [
            "device",
            "BROWSE_SDP",
            "BDADDR_BREDR",
            "err"
          ],
          "line": 4709
        },
        "resolved": true,
        "details": {
          "function_name": "device_svc_resolved",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "2378-2426",
          "snippet": "static void device_svc_resolved(struct btd_device *dev, uint8_t browse_type,\n\t\t\t\t\t\tuint8_t bdaddr_type, int err)\n{\n\tstruct bearer_state *state = get_state(dev, bdaddr_type);\n\tstruct browse_req *req = dev->browse;\n\n\tDBG(\"%s err %d\", dev->path, err);\n\n\tstate->svc_resolved = true;\n\n\t/* Disconnection notification can happen before this function\n\t * gets called, so don't set svc_refreshed for a disconnected\n\t * device.\n\t */\n\tif (state->connected)\n\t\tdevice_set_svc_refreshed(dev, true);\n\n\tg_slist_free_full(dev->eir_uuids, g_free);\n\tdev->eir_uuids = NULL;\n\n\tif (dev->pending_paired) {\n\t\tg_dbus_emit_property_changed(dbus_conn, dev->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"Paired\");\n\t\tdev->pending_paired = false;\n\t}\n\n\tif (!dev->temporary) {\n\t\tstore_device_info(dev);\n\n\t\tif (bdaddr_type != BDADDR_BREDR && err == 0)\n\t\t\tstore_services(dev);\n\t}\n\n\tif (req)\n\t\tbrowse_request_complete(req, browse_type, bdaddr_type, err);\n\n\twhile (dev->svc_callbacks) {\n\t\tstruct svc_callback *cb = dev->svc_callbacks->data;\n\n\t\tif (cb->idle_id > 0)\n\t\t\tg_source_remove(cb->idle_id);\n\n\t\tcb->func(dev, err, cb->user_data);\n\n\t\tdev->svc_callbacks = g_slist_delete_link(dev->svc_callbacks,\n\t\t\t\t\t\t\tdev->svc_callbacks);\n\t\tg_free(cb);\n\t}\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *dbus_conn = NULL;",
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void device_svc_resolved(struct btd_device *dev, uint8_t browse_type,\n\t\t\t\t\t\tuint8_t bdaddr_type, int err)\n{\n\tstruct bearer_state *state = get_state(dev, bdaddr_type);\n\tstruct browse_req *req = dev->browse;\n\n\tDBG(\"%s err %d\", dev->path, err);\n\n\tstate->svc_resolved = true;\n\n\t/* Disconnection notification can happen before this function\n\t * gets called, so don't set svc_refreshed for a disconnected\n\t * device.\n\t */\n\tif (state->connected)\n\t\tdevice_set_svc_refreshed(dev, true);\n\n\tg_slist_free_full(dev->eir_uuids, g_free);\n\tdev->eir_uuids = NULL;\n\n\tif (dev->pending_paired) {\n\t\tg_dbus_emit_property_changed(dbus_conn, dev->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"Paired\");\n\t\tdev->pending_paired = false;\n\t}\n\n\tif (!dev->temporary) {\n\t\tstore_device_info(dev);\n\n\t\tif (bdaddr_type != BDADDR_BREDR && err == 0)\n\t\t\tstore_services(dev);\n\t}\n\n\tif (req)\n\t\tbrowse_request_complete(req, browse_type, bdaddr_type, err);\n\n\twhile (dev->svc_callbacks) {\n\t\tstruct svc_callback *cb = dev->svc_callbacks->data;\n\n\t\tif (cb->idle_id > 0)\n\t\t\tg_source_remove(cb->idle_id);\n\n\t\tcb->func(dev, err, cb->user_data);\n\n\t\tdev->svc_callbacks = g_slist_delete_link(dev->svc_callbacks,\n\t\t\t\t\t\t\tdev->svc_callbacks);\n\t\tg_free(cb);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_emit_property_changed",
          "args": [
            "dbus_conn",
            "req->device->path",
            "DEVICE_INTERFACE",
            "\"UUIDs\""
          ],
          "line": 4705
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device_probe_profiles",
          "args": [
            "device",
            "req->profiles_added"
          ],
          "line": 4702
        },
        "resolved": true,
        "details": {
          "function_name": "device_probe_profiles",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "4360-4378",
          "snippet": "void device_probe_profiles(struct btd_device *device, GSList *uuids)\n{\n\tstruct probe_data d = { device, uuids };\n\tchar addr[18];\n\n\tba2str(&device->bdaddr, addr);\n\n\tif (device->blocked) {\n\t\tDBG(\"Skipping profiles for blocked device %s\", addr);\n\t\tgoto add_uuids;\n\t}\n\n\tDBG(\"Probing profiles for device %s\", addr);\n\n\tbtd_profile_foreach(dev_probe, &d);\n\nadd_uuids:\n\tdevice_add_uuids(device, uuids);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid device_probe_profiles(struct btd_device *device, GSList *uuids)\n{\n\tstruct probe_data d = { device, uuids };\n\tchar addr[18];\n\n\tba2str(&device->bdaddr, addr);\n\n\tif (device->blocked) {\n\t\tDBG(\"Skipping profiles for blocked device %s\", addr);\n\t\tgoto add_uuids;\n\t}\n\n\tDBG(\"Probing profiles for device %s\", addr);\n\n\tbtd_profile_foreach(dev_probe, &d);\n\nadd_uuids:\n\tdevice_add_uuids(device, uuids);\n}"
        }
      },
      {
        "call_info": {
          "callee": "device_register_primaries",
          "args": [
            "device",
            "primaries",
            "ATT_PSM"
          ],
          "line": 4693
        },
        "resolved": true,
        "details": {
          "function_name": "device_register_primaries",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "3194-3198",
          "snippet": "static void device_register_primaries(struct btd_device *device,\n\t\t\t\t\t\tGSList *prim_list, int psm)\n{\n\tdevice->primaries = g_slist_concat(device->primaries, prim_list);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void device_register_primaries(struct btd_device *device,\n\t\t\t\t\t\tGSList *prim_list, int psm)\n{\n\tdevice->primaries = g_slist_concat(device->primaries, prim_list);\n}"
        }
      },
      {
        "call_info": {
          "callee": "device_services_from_record",
          "args": [
            "device",
            "req->profiles_added"
          ],
          "line": 4691
        },
        "resolved": true,
        "details": {
          "function_name": "device_services_from_record",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "4622-4660",
          "snippet": "static GSList *device_services_from_record(struct btd_device *device,\n\t\t\t\t\t\t\tGSList *profiles)\n{\n\tGSList *l, *prim_list = NULL;\n\tchar *att_uuid;\n\tuuid_t proto_uuid;\n\n\tsdp_uuid16_create(&proto_uuid, ATT_UUID);\n\tatt_uuid = bt_uuid2string(&proto_uuid);\n\n\tfor (l = profiles; l; l = l->next) {\n\t\tconst char *profile_uuid = l->data;\n\t\tconst sdp_record_t *rec;\n\t\tstruct gatt_primary *prim;\n\t\tuint16_t start = 0, end = 0, psm = 0;\n\t\tuuid_t prim_uuid;\n\n\t\trec = btd_device_get_record(device, profile_uuid);\n\t\tif (!rec)\n\t\t\tcontinue;\n\n\t\tif (!record_has_uuid(rec, att_uuid))\n\t\t\tcontinue;\n\n\t\tif (!gatt_parse_record(rec, &prim_uuid, &psm, &start, &end))\n\t\t\tcontinue;\n\n\t\tprim = g_new0(struct gatt_primary, 1);\n\t\tprim->range.start = start;\n\t\tprim->range.end = end;\n\t\tsdp_uuid2strn(&prim_uuid, prim->uuid, sizeof(prim->uuid));\n\n\t\tprim_list = g_slist_append(prim_list, prim);\n\t}\n\n\tfree(att_uuid);\n\n\treturn prim_list;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic GSList *device_services_from_record(struct btd_device *device,\n\t\t\t\t\t\t\tGSList *profiles)\n{\n\tGSList *l, *prim_list = NULL;\n\tchar *att_uuid;\n\tuuid_t proto_uuid;\n\n\tsdp_uuid16_create(&proto_uuid, ATT_UUID);\n\tatt_uuid = bt_uuid2string(&proto_uuid);\n\n\tfor (l = profiles; l; l = l->next) {\n\t\tconst char *profile_uuid = l->data;\n\t\tconst sdp_record_t *rec;\n\t\tstruct gatt_primary *prim;\n\t\tuint16_t start = 0, end = 0, psm = 0;\n\t\tuuid_t prim_uuid;\n\n\t\trec = btd_device_get_record(device, profile_uuid);\n\t\tif (!rec)\n\t\t\tcontinue;\n\n\t\tif (!record_has_uuid(rec, att_uuid))\n\t\t\tcontinue;\n\n\t\tif (!gatt_parse_record(rec, &prim_uuid, &psm, &start, &end))\n\t\t\tcontinue;\n\n\t\tprim = g_new0(struct gatt_primary, 1);\n\t\tprim->range.start = start;\n\t\tprim->range.end = end;\n\t\tsdp_uuid2strn(&prim_uuid, prim->uuid, sizeof(prim->uuid));\n\n\t\tprim_list = g_slist_append(prim_list, prim);\n\t}\n\n\tfree(att_uuid);\n\n\treturn prim_list;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"%s: No service update\"",
            "addr"
          ],
          "line": 4687
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_free",
          "args": [
            "device->tmp_records",
            "(sdp_free_func_t) sdp_record_free"
          ],
          "line": 4680
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "update_bredr_services",
          "args": [
            "req",
            "recs"
          ],
          "line": 4677
        },
        "resolved": true,
        "details": {
          "function_name": "update_bredr_services",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "4486-4593",
          "snippet": "static void update_bredr_services(struct browse_req *req, sdp_list_t *recs)\n{\n\tstruct btd_device *device = req->device;\n\tsdp_list_t *seq;\n\tchar srcaddr[18], dstaddr[18];\n\tchar sdp_file[PATH_MAX];\n\tchar att_file[PATH_MAX];\n\tGKeyFile *sdp_key_file;\n\tGKeyFile *att_key_file;\n\tchar *data;\n\tgsize length = 0;\n\n\tba2str(btd_adapter_get_address(device->adapter), srcaddr);\n\tba2str(&device->bdaddr, dstaddr);\n\n\tsnprintf(sdp_file, PATH_MAX, STORAGEDIR \"/%s/cache/%s\", srcaddr,\n\t\t\t\t\t\t\t\tdstaddr);\n\n\tsdp_key_file = g_key_file_new();\n\tg_key_file_load_from_file(sdp_key_file, sdp_file, 0, NULL);\n\n\tsnprintf(att_file, PATH_MAX, STORAGEDIR \"/%s/%s/attributes\", srcaddr,\n\t\t\t\t\t\t\t\tdstaddr);\n\n\tatt_key_file = g_key_file_new();\n\tg_key_file_load_from_file(att_key_file, att_file, 0, NULL);\n\n\tfor (seq = recs; seq; seq = seq->next) {\n\t\tsdp_record_t *rec = (sdp_record_t *) seq->data;\n\t\tsdp_list_t *svcclass = NULL;\n\t\tchar *profile_uuid;\n\n\t\tif (!rec)\n\t\t\tbreak;\n\n\t\tif (sdp_get_service_classes(rec, &svcclass) < 0)\n\t\t\tcontinue;\n\n\t\t/* Check for empty service classes list */\n\t\tif (svcclass == NULL) {\n\t\t\tDBG(\"Skipping record with no service classes\");\n\t\t\tcontinue;\n\t\t}\n\n\t\t/* Extract the first element and skip the remainning */\n\t\tprofile_uuid = bt_uuid2string(svcclass->data);\n\t\tif (!profile_uuid) {\n\t\t\tsdp_list_free(svcclass, free);\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (bt_uuid_strcmp(profile_uuid, PNP_UUID) == 0) {\n\t\t\tuint16_t source, vendor, product, version;\n\t\t\tsdp_data_t *pdlist;\n\n\t\t\tpdlist = sdp_data_get(rec, SDP_ATTR_VENDOR_ID_SOURCE);\n\t\t\tsource = pdlist ? pdlist->val.uint16 : 0x0000;\n\n\t\t\tpdlist = sdp_data_get(rec, SDP_ATTR_VENDOR_ID);\n\t\t\tvendor = pdlist ? pdlist->val.uint16 : 0x0000;\n\n\t\t\tpdlist = sdp_data_get(rec, SDP_ATTR_PRODUCT_ID);\n\t\t\tproduct = pdlist ? pdlist->val.uint16 : 0x0000;\n\n\t\t\tpdlist = sdp_data_get(rec, SDP_ATTR_VERSION);\n\t\t\tversion = pdlist ? pdlist->val.uint16 : 0x0000;\n\n\t\t\tif (source || vendor || product || version)\n\t\t\t\tbtd_device_set_pnpid(device, source, vendor,\n\t\t\t\t\t\t\tproduct, version);\n\t\t}\n\n\t\tif (update_record(req, profile_uuid, rec) < 0)\n\t\t\tgoto next;\n\n\t\tif (sdp_key_file)\n\t\t\tstore_sdp_record(sdp_key_file, rec);\n\n\t\tif (att_key_file)\n\t\t\tstore_primaries_from_sdp_record(att_key_file, rec);\n\nnext:\n\t\tfree(profile_uuid);\n\t\tsdp_list_free(svcclass, free);\n\t}\n\n\tif (sdp_key_file) {\n\t\tdata = g_key_file_to_data(sdp_key_file, &length, NULL);\n\t\tif (length > 0) {\n\t\t\tcreate_file(sdp_file, S_IRUSR | S_IWUSR);\n\t\t\tg_file_set_contents(sdp_file, data, length, NULL);\n\t\t}\n\n\t\tg_free(data);\n\t\tg_key_file_free(sdp_key_file);\n\t}\n\n\tif (att_key_file) {\n\t\tdata = g_key_file_to_data(att_key_file, &length, NULL);\n\t\tif (length > 0) {\n\t\t\tcreate_file(att_file, S_IRUSR | S_IWUSR);\n\t\t\tg_file_set_contents(att_file, data, length, NULL);\n\t\t}\n\n\t\tg_free(data);\n\t\tg_key_file_free(att_key_file);\n\t}\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void update_bredr_services(struct browse_req *req, sdp_list_t *recs)\n{\n\tstruct btd_device *device = req->device;\n\tsdp_list_t *seq;\n\tchar srcaddr[18], dstaddr[18];\n\tchar sdp_file[PATH_MAX];\n\tchar att_file[PATH_MAX];\n\tGKeyFile *sdp_key_file;\n\tGKeyFile *att_key_file;\n\tchar *data;\n\tgsize length = 0;\n\n\tba2str(btd_adapter_get_address(device->adapter), srcaddr);\n\tba2str(&device->bdaddr, dstaddr);\n\n\tsnprintf(sdp_file, PATH_MAX, STORAGEDIR \"/%s/cache/%s\", srcaddr,\n\t\t\t\t\t\t\t\tdstaddr);\n\n\tsdp_key_file = g_key_file_new();\n\tg_key_file_load_from_file(sdp_key_file, sdp_file, 0, NULL);\n\n\tsnprintf(att_file, PATH_MAX, STORAGEDIR \"/%s/%s/attributes\", srcaddr,\n\t\t\t\t\t\t\t\tdstaddr);\n\n\tatt_key_file = g_key_file_new();\n\tg_key_file_load_from_file(att_key_file, att_file, 0, NULL);\n\n\tfor (seq = recs; seq; seq = seq->next) {\n\t\tsdp_record_t *rec = (sdp_record_t *) seq->data;\n\t\tsdp_list_t *svcclass = NULL;\n\t\tchar *profile_uuid;\n\n\t\tif (!rec)\n\t\t\tbreak;\n\n\t\tif (sdp_get_service_classes(rec, &svcclass) < 0)\n\t\t\tcontinue;\n\n\t\t/* Check for empty service classes list */\n\t\tif (svcclass == NULL) {\n\t\t\tDBG(\"Skipping record with no service classes\");\n\t\t\tcontinue;\n\t\t}\n\n\t\t/* Extract the first element and skip the remainning */\n\t\tprofile_uuid = bt_uuid2string(svcclass->data);\n\t\tif (!profile_uuid) {\n\t\t\tsdp_list_free(svcclass, free);\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (bt_uuid_strcmp(profile_uuid, PNP_UUID) == 0) {\n\t\t\tuint16_t source, vendor, product, version;\n\t\t\tsdp_data_t *pdlist;\n\n\t\t\tpdlist = sdp_data_get(rec, SDP_ATTR_VENDOR_ID_SOURCE);\n\t\t\tsource = pdlist ? pdlist->val.uint16 : 0x0000;\n\n\t\t\tpdlist = sdp_data_get(rec, SDP_ATTR_VENDOR_ID);\n\t\t\tvendor = pdlist ? pdlist->val.uint16 : 0x0000;\n\n\t\t\tpdlist = sdp_data_get(rec, SDP_ATTR_PRODUCT_ID);\n\t\t\tproduct = pdlist ? pdlist->val.uint16 : 0x0000;\n\n\t\t\tpdlist = sdp_data_get(rec, SDP_ATTR_VERSION);\n\t\t\tversion = pdlist ? pdlist->val.uint16 : 0x0000;\n\n\t\t\tif (source || vendor || product || version)\n\t\t\t\tbtd_device_set_pnpid(device, source, vendor,\n\t\t\t\t\t\t\tproduct, version);\n\t\t}\n\n\t\tif (update_record(req, profile_uuid, rec) < 0)\n\t\t\tgoto next;\n\n\t\tif (sdp_key_file)\n\t\t\tstore_sdp_record(sdp_key_file, rec);\n\n\t\tif (att_key_file)\n\t\t\tstore_primaries_from_sdp_record(att_key_file, rec);\n\nnext:\n\t\tfree(profile_uuid);\n\t\tsdp_list_free(svcclass, free);\n\t}\n\n\tif (sdp_key_file) {\n\t\tdata = g_key_file_to_data(sdp_key_file, &length, NULL);\n\t\tif (length > 0) {\n\t\t\tcreate_file(sdp_file, S_IRUSR | S_IWUSR);\n\t\t\tg_file_set_contents(sdp_file, data, length, NULL);\n\t\t}\n\n\t\tg_free(data);\n\t\tg_key_file_free(sdp_key_file);\n\t}\n\n\tif (att_key_file) {\n\t\tdata = g_key_file_to_data(att_key_file, &length, NULL);\n\t\tif (length > 0) {\n\t\t\tcreate_file(att_file, S_IRUSR | S_IWUSR);\n\t\t\tg_file_set_contents(att_file, data, length, NULL);\n\t\t}\n\n\t\tg_free(data);\n\t\tg_key_file_free(att_key_file);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"%s: error updating services: %s (%d)\"",
            "addr",
            "strerror(-err)",
            "-err"
          ],
          "line": 4672
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/log.c",
          "lines": "199-213",
          "snippet": "void btd_error(uint16_t index, const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_ERR, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(index, LOG_ERR, format, ap);\n\tva_end(ap);\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdarg.h>",
            "#include <syslog.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int logging_fd = -1;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"src/shared/util.h\"\n#include \"lib/hci.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int logging_fd = -1;\n\nvoid btd_error(uint16_t index, const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_ERR, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(index, LOG_ERR, format, ap);\n\tva_end(ap);\n}"
        }
      },
      {
        "call_info": {
          "callee": "strerror",
          "args": [
            "-err"
          ],
          "line": 4673
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ba2str",
          "args": [
            "&device->bdaddr",
            "addr"
          ],
          "line": 4669
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void search_cb(sdp_list_t *recs, int err, gpointer user_data)\n{\n\tstruct browse_req *req = user_data;\n\tstruct btd_device *device = req->device;\n\tGSList *primaries;\n\tchar addr[18];\n\n\tba2str(&device->bdaddr, addr);\n\n\tif (err < 0) {\n\t\terror(\"%s: error updating services: %s (%d)\",\n\t\t\t\taddr, strerror(-err), -err);\n\t\tgoto send_reply;\n\t}\n\n\tupdate_bredr_services(req, recs);\n\n\tif (device->tmp_records)\n\t\tsdp_list_free(device->tmp_records,\n\t\t\t\t\t(sdp_free_func_t) sdp_record_free);\n\n\tdevice->tmp_records = req->records;\n\treq->records = NULL;\n\n\tif (!req->profiles_added) {\n\t\tDBG(\"%s: No service update\", addr);\n\t\tgoto send_reply;\n\t}\n\n\tprimaries = device_services_from_record(device, req->profiles_added);\n\tif (primaries)\n\t\tdevice_register_primaries(device, primaries, ATT_PSM);\n\n\t/*\n\t * TODO: The btd_service instances for GATT services need to be\n\t * initialized with the service handles. Eventually this code should\n\t * perform ATT protocol service discovery over the ATT PSM to obtain\n\t * the full list of services and populate a client-role gatt_db over\n\t * BR/EDR.\n\t */\n\tdevice_probe_profiles(device, req->profiles_added);\n\n\t/* Propagate services changes */\n\tg_dbus_emit_property_changed(dbus_conn, req->device->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"UUIDs\");\n\nsend_reply:\n\tdevice_svc_resolved(device, BROWSE_SDP, BDADDR_BREDR, err);\n}"
  },
  {
    "function_name": "device_services_from_record",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "4622-4660",
    "snippet": "static GSList *device_services_from_record(struct btd_device *device,\n\t\t\t\t\t\t\tGSList *profiles)\n{\n\tGSList *l, *prim_list = NULL;\n\tchar *att_uuid;\n\tuuid_t proto_uuid;\n\n\tsdp_uuid16_create(&proto_uuid, ATT_UUID);\n\tatt_uuid = bt_uuid2string(&proto_uuid);\n\n\tfor (l = profiles; l; l = l->next) {\n\t\tconst char *profile_uuid = l->data;\n\t\tconst sdp_record_t *rec;\n\t\tstruct gatt_primary *prim;\n\t\tuint16_t start = 0, end = 0, psm = 0;\n\t\tuuid_t prim_uuid;\n\n\t\trec = btd_device_get_record(device, profile_uuid);\n\t\tif (!rec)\n\t\t\tcontinue;\n\n\t\tif (!record_has_uuid(rec, att_uuid))\n\t\t\tcontinue;\n\n\t\tif (!gatt_parse_record(rec, &prim_uuid, &psm, &start, &end))\n\t\t\tcontinue;\n\n\t\tprim = g_new0(struct gatt_primary, 1);\n\t\tprim->range.start = start;\n\t\tprim->range.end = end;\n\t\tsdp_uuid2strn(&prim_uuid, prim->uuid, sizeof(prim->uuid));\n\n\t\tprim_list = g_slist_append(prim_list, prim);\n\t}\n\n\tfree(att_uuid);\n\n\treturn prim_list;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "att_uuid"
          ],
          "line": 4657
        },
        "resolved": true,
        "details": {
          "function_name": "device_auth_req_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5662-5676",
          "snippet": "static void device_auth_req_free(struct btd_device *device)\n{\n\tstruct authentication_req *authr = device->authr;\n\n\tif (!authr)\n\t\treturn;\n\n\tif (authr->agent)\n\t\tagent_unref(authr->agent);\n\n\tg_free(authr->pincode);\n\tg_free(authr);\n\n\tdevice->authr = NULL;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void device_auth_req_free(struct btd_device *device)\n{\n\tstruct authentication_req *authr = device->authr;\n\n\tif (!authr)\n\t\treturn;\n\n\tif (authr->agent)\n\t\tagent_unref(authr->agent);\n\n\tg_free(authr->pincode);\n\tg_free(authr);\n\n\tdevice->authr = NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_slist_append",
          "args": [
            "prim_list",
            "prim"
          ],
          "line": 4654
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_uuid2strn",
          "args": [
            "&prim_uuid",
            "prim->uuid",
            "sizeof(prim->uuid)"
          ],
          "line": 4652
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_new0",
          "args": [
            "structgatt_primary",
            "1"
          ],
          "line": 4649
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gatt_parse_record",
          "args": [
            "rec",
            "&prim_uuid",
            "&psm",
            "&start",
            "&end"
          ],
          "line": 4646
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "record_has_uuid",
          "args": [
            "rec",
            "att_uuid"
          ],
          "line": 4643
        },
        "resolved": true,
        "details": {
          "function_name": "record_has_uuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "4243-4265",
          "snippet": "static gboolean record_has_uuid(const sdp_record_t *rec,\n\t\t\t\tconst char *profile_uuid)\n{\n\tsdp_list_t *pat;\n\n\tfor (pat = rec->pattern; pat != NULL; pat = pat->next) {\n\t\tchar *uuid;\n\t\tint ret;\n\n\t\tuuid = bt_uuid2string(pat->data);\n\t\tif (!uuid)\n\t\t\tcontinue;\n\n\t\tret = strcasecmp(uuid, profile_uuid);\n\n\t\tfree(uuid);\n\n\t\tif (ret == 0)\n\t\t\treturn TRUE;\n\t}\n\n\treturn FALSE;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic gboolean record_has_uuid(const sdp_record_t *rec,\n\t\t\t\tconst char *profile_uuid)\n{\n\tsdp_list_t *pat;\n\n\tfor (pat = rec->pattern; pat != NULL; pat = pat->next) {\n\t\tchar *uuid;\n\t\tint ret;\n\n\t\tuuid = bt_uuid2string(pat->data);\n\t\tif (!uuid)\n\t\t\tcontinue;\n\n\t\tret = strcasecmp(uuid, profile_uuid);\n\n\t\tfree(uuid);\n\n\t\tif (ret == 0)\n\t\t\treturn TRUE;\n\t}\n\n\treturn FALSE;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_device_get_record",
          "args": [
            "device",
            "profile_uuid"
          ],
          "line": 4639
        },
        "resolved": true,
        "details": {
          "function_name": "btd_device_get_record",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "6344-6355",
          "snippet": "const sdp_record_t *btd_device_get_record(struct btd_device *device,\n\t\t\t\t\t\t\tconst char *uuid)\n{\n\t/* Load records from storage if there is nothing in cache */\n\tif (!device->tmp_records) {\n\t\tdevice->tmp_records = read_device_records(device);\n\t\tif (!device->tmp_records)\n\t\t\treturn NULL;\n\t}\n\n\treturn find_record_in_list(device->tmp_records, uuid);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nconst sdp_record_t *btd_device_get_record(struct btd_device *device,\n\t\t\t\t\t\t\tconst char *uuid)\n{\n\t/* Load records from storage if there is nothing in cache */\n\tif (!device->tmp_records) {\n\t\tdevice->tmp_records = read_device_records(device);\n\t\tif (!device->tmp_records)\n\t\t\treturn NULL;\n\t}\n\n\treturn find_record_in_list(device->tmp_records, uuid);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_uuid2string",
          "args": [
            "&proto_uuid"
          ],
          "line": 4630
        },
        "resolved": true,
        "details": {
          "function_name": "bt_uuid2string",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/uuid-helper.c",
          "lines": "65-110",
          "snippet": "char *bt_uuid2string(uuid_t *uuid)\n{\n\tchar *str;\n\tuuid_t uuid128;\n\tunsigned int data0;\n\tunsigned short data1;\n\tunsigned short data2;\n\tunsigned short data3;\n\tunsigned int data4;\n\tunsigned short data5;\n\tint err;\n\n\tif (!uuid)\n\t\treturn NULL;\n\n\tswitch (uuid->type) {\n\tcase SDP_UUID16:\n\t\tsdp_uuid16_to_uuid128(&uuid128, uuid);\n\t\tbreak;\n\tcase SDP_UUID32:\n\t\tsdp_uuid32_to_uuid128(&uuid128, uuid);\n\t\tbreak;\n\tcase SDP_UUID128:\n\t\tmemcpy(&uuid128, uuid, sizeof(uuid_t));\n\t\tbreak;\n\tdefault:\n\t\t/* Type of UUID unknown */\n\t\treturn NULL;\n\t}\n\n\tmemcpy(&data0, &uuid128.value.uuid128.data[0], 4);\n\tmemcpy(&data1, &uuid128.value.uuid128.data[4], 2);\n\tmemcpy(&data2, &uuid128.value.uuid128.data[6], 2);\n\tmemcpy(&data3, &uuid128.value.uuid128.data[8], 2);\n\tmemcpy(&data4, &uuid128.value.uuid128.data[10], 4);\n\tmemcpy(&data5, &uuid128.value.uuid128.data[14], 2);\n\n\terr = asprintf(&str, \"%.8x-%.4x-%.4x-%.4x-%.8x%.4x\",\n\t\t\tntohl(data0), ntohs(data1),\n\t\t\tntohs(data2), ntohs(data3),\n\t\t\tntohl(data4), ntohs(data5));\n\tif (err < 0)\n\t\treturn NULL;\n\n\treturn str;\n}",
          "includes": [
            "#include \"uuid-helper.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <arpa/inet.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"uuid-helper.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <arpa/inet.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *bt_uuid2string(uuid_t *uuid)\n{\n\tchar *str;\n\tuuid_t uuid128;\n\tunsigned int data0;\n\tunsigned short data1;\n\tunsigned short data2;\n\tunsigned short data3;\n\tunsigned int data4;\n\tunsigned short data5;\n\tint err;\n\n\tif (!uuid)\n\t\treturn NULL;\n\n\tswitch (uuid->type) {\n\tcase SDP_UUID16:\n\t\tsdp_uuid16_to_uuid128(&uuid128, uuid);\n\t\tbreak;\n\tcase SDP_UUID32:\n\t\tsdp_uuid32_to_uuid128(&uuid128, uuid);\n\t\tbreak;\n\tcase SDP_UUID128:\n\t\tmemcpy(&uuid128, uuid, sizeof(uuid_t));\n\t\tbreak;\n\tdefault:\n\t\t/* Type of UUID unknown */\n\t\treturn NULL;\n\t}\n\n\tmemcpy(&data0, &uuid128.value.uuid128.data[0], 4);\n\tmemcpy(&data1, &uuid128.value.uuid128.data[4], 2);\n\tmemcpy(&data2, &uuid128.value.uuid128.data[6], 2);\n\tmemcpy(&data3, &uuid128.value.uuid128.data[8], 2);\n\tmemcpy(&data4, &uuid128.value.uuid128.data[10], 4);\n\tmemcpy(&data5, &uuid128.value.uuid128.data[14], 2);\n\n\terr = asprintf(&str, \"%.8x-%.4x-%.4x-%.4x-%.8x%.4x\",\n\t\t\tntohl(data0), ntohs(data1),\n\t\t\tntohs(data2), ntohs(data3),\n\t\t\tntohl(data4), ntohs(data5));\n\tif (err < 0)\n\t\treturn NULL;\n\n\treturn str;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sdp_uuid16_create",
          "args": [
            "&proto_uuid",
            "ATT_UUID"
          ],
          "line": 4629
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic GSList *device_services_from_record(struct btd_device *device,\n\t\t\t\t\t\t\tGSList *profiles)\n{\n\tGSList *l, *prim_list = NULL;\n\tchar *att_uuid;\n\tuuid_t proto_uuid;\n\n\tsdp_uuid16_create(&proto_uuid, ATT_UUID);\n\tatt_uuid = bt_uuid2string(&proto_uuid);\n\n\tfor (l = profiles; l; l = l->next) {\n\t\tconst char *profile_uuid = l->data;\n\t\tconst sdp_record_t *rec;\n\t\tstruct gatt_primary *prim;\n\t\tuint16_t start = 0, end = 0, psm = 0;\n\t\tuuid_t prim_uuid;\n\n\t\trec = btd_device_get_record(device, profile_uuid);\n\t\tif (!rec)\n\t\t\tcontinue;\n\n\t\tif (!record_has_uuid(rec, att_uuid))\n\t\t\tcontinue;\n\n\t\tif (!gatt_parse_record(rec, &prim_uuid, &psm, &start, &end))\n\t\t\tcontinue;\n\n\t\tprim = g_new0(struct gatt_primary, 1);\n\t\tprim->range.start = start;\n\t\tprim->range.end = end;\n\t\tsdp_uuid2strn(&prim_uuid, prim->uuid, sizeof(prim->uuid));\n\n\t\tprim_list = g_slist_append(prim_list, prim);\n\t}\n\n\tfree(att_uuid);\n\n\treturn prim_list;\n}"
  },
  {
    "function_name": "update_gatt_uuids",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "4600-4620",
    "snippet": "static void update_gatt_uuids(struct browse_req *req, GSList *current,\n\t\t\t\t\t\t\t\tGSList *found)\n{\n\tGSList *l, *lmatch;\n\n\t/* Added Profiles */\n\tfor (l = found; l; l = g_slist_next(l)) {\n\t\tstruct gatt_primary *prim = l->data;\n\n\t\t/* Entry found ? */\n\t\tlmatch = g_slist_find_custom(current, prim, primary_cmp);\n\t\tif (lmatch)\n\t\t\tcontinue;\n\n\t\t/* New entry */\n\t\treq->profiles_added = g_slist_append(req->profiles_added,\n\t\t\t\t\t\t\tg_strdup(prim->uuid));\n\n\t\tDBG(\"UUID Added: %s\", prim->uuid);\n\t}\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"UUID Added: %s\"",
            "prim->uuid"
          ],
          "line": 4618
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_append",
          "args": [
            "req->profiles_added",
            "g_strdup(prim->uuid)"
          ],
          "line": 4615
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "prim->uuid"
          ],
          "line": 4616
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_find_custom",
          "args": [
            "current",
            "prim",
            "primary_cmp"
          ],
          "line": 4610
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_next",
          "args": [
            "l"
          ],
          "line": 4606
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void update_gatt_uuids(struct browse_req *req, GSList *current,\n\t\t\t\t\t\t\t\tGSList *found)\n{\n\tGSList *l, *lmatch;\n\n\t/* Added Profiles */\n\tfor (l = found; l; l = g_slist_next(l)) {\n\t\tstruct gatt_primary *prim = l->data;\n\n\t\t/* Entry found ? */\n\t\tlmatch = g_slist_find_custom(current, prim, primary_cmp);\n\t\tif (lmatch)\n\t\t\tcontinue;\n\n\t\t/* New entry */\n\t\treq->profiles_added = g_slist_append(req->profiles_added,\n\t\t\t\t\t\t\tg_strdup(prim->uuid));\n\n\t\tDBG(\"UUID Added: %s\", prim->uuid);\n\t}\n}"
  },
  {
    "function_name": "primary_cmp",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "4595-4598",
    "snippet": "static int primary_cmp(gconstpointer a, gconstpointer b)\n{\n\treturn memcmp(a, b, sizeof(struct gatt_primary));\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "memcmp",
          "args": [
            "a",
            "b",
            "sizeof(struct gatt_primary)"
          ],
          "line": 4597
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int primary_cmp(gconstpointer a, gconstpointer b)\n{\n\treturn memcmp(a, b, sizeof(struct gatt_primary));\n}"
  },
  {
    "function_name": "update_bredr_services",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "4486-4593",
    "snippet": "static void update_bredr_services(struct browse_req *req, sdp_list_t *recs)\n{\n\tstruct btd_device *device = req->device;\n\tsdp_list_t *seq;\n\tchar srcaddr[18], dstaddr[18];\n\tchar sdp_file[PATH_MAX];\n\tchar att_file[PATH_MAX];\n\tGKeyFile *sdp_key_file;\n\tGKeyFile *att_key_file;\n\tchar *data;\n\tgsize length = 0;\n\n\tba2str(btd_adapter_get_address(device->adapter), srcaddr);\n\tba2str(&device->bdaddr, dstaddr);\n\n\tsnprintf(sdp_file, PATH_MAX, STORAGEDIR \"/%s/cache/%s\", srcaddr,\n\t\t\t\t\t\t\t\tdstaddr);\n\n\tsdp_key_file = g_key_file_new();\n\tg_key_file_load_from_file(sdp_key_file, sdp_file, 0, NULL);\n\n\tsnprintf(att_file, PATH_MAX, STORAGEDIR \"/%s/%s/attributes\", srcaddr,\n\t\t\t\t\t\t\t\tdstaddr);\n\n\tatt_key_file = g_key_file_new();\n\tg_key_file_load_from_file(att_key_file, att_file, 0, NULL);\n\n\tfor (seq = recs; seq; seq = seq->next) {\n\t\tsdp_record_t *rec = (sdp_record_t *) seq->data;\n\t\tsdp_list_t *svcclass = NULL;\n\t\tchar *profile_uuid;\n\n\t\tif (!rec)\n\t\t\tbreak;\n\n\t\tif (sdp_get_service_classes(rec, &svcclass) < 0)\n\t\t\tcontinue;\n\n\t\t/* Check for empty service classes list */\n\t\tif (svcclass == NULL) {\n\t\t\tDBG(\"Skipping record with no service classes\");\n\t\t\tcontinue;\n\t\t}\n\n\t\t/* Extract the first element and skip the remainning */\n\t\tprofile_uuid = bt_uuid2string(svcclass->data);\n\t\tif (!profile_uuid) {\n\t\t\tsdp_list_free(svcclass, free);\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (bt_uuid_strcmp(profile_uuid, PNP_UUID) == 0) {\n\t\t\tuint16_t source, vendor, product, version;\n\t\t\tsdp_data_t *pdlist;\n\n\t\t\tpdlist = sdp_data_get(rec, SDP_ATTR_VENDOR_ID_SOURCE);\n\t\t\tsource = pdlist ? pdlist->val.uint16 : 0x0000;\n\n\t\t\tpdlist = sdp_data_get(rec, SDP_ATTR_VENDOR_ID);\n\t\t\tvendor = pdlist ? pdlist->val.uint16 : 0x0000;\n\n\t\t\tpdlist = sdp_data_get(rec, SDP_ATTR_PRODUCT_ID);\n\t\t\tproduct = pdlist ? pdlist->val.uint16 : 0x0000;\n\n\t\t\tpdlist = sdp_data_get(rec, SDP_ATTR_VERSION);\n\t\t\tversion = pdlist ? pdlist->val.uint16 : 0x0000;\n\n\t\t\tif (source || vendor || product || version)\n\t\t\t\tbtd_device_set_pnpid(device, source, vendor,\n\t\t\t\t\t\t\tproduct, version);\n\t\t}\n\n\t\tif (update_record(req, profile_uuid, rec) < 0)\n\t\t\tgoto next;\n\n\t\tif (sdp_key_file)\n\t\t\tstore_sdp_record(sdp_key_file, rec);\n\n\t\tif (att_key_file)\n\t\t\tstore_primaries_from_sdp_record(att_key_file, rec);\n\nnext:\n\t\tfree(profile_uuid);\n\t\tsdp_list_free(svcclass, free);\n\t}\n\n\tif (sdp_key_file) {\n\t\tdata = g_key_file_to_data(sdp_key_file, &length, NULL);\n\t\tif (length > 0) {\n\t\t\tcreate_file(sdp_file, S_IRUSR | S_IWUSR);\n\t\t\tg_file_set_contents(sdp_file, data, length, NULL);\n\t\t}\n\n\t\tg_free(data);\n\t\tg_key_file_free(sdp_key_file);\n\t}\n\n\tif (att_key_file) {\n\t\tdata = g_key_file_to_data(att_key_file, &length, NULL);\n\t\tif (length > 0) {\n\t\t\tcreate_file(att_file, S_IRUSR | S_IWUSR);\n\t\t\tg_file_set_contents(att_file, data, length, NULL);\n\t\t}\n\n\t\tg_free(data);\n\t\tg_key_file_free(att_key_file);\n\t}\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_key_file_free",
          "args": [
            "att_key_file"
          ],
          "line": 4591
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "data"
          ],
          "line": 4590
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_file_set_contents",
          "args": [
            "att_file",
            "data",
            "length",
            "NULL"
          ],
          "line": 4587
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "create_file",
          "args": [
            "att_file",
            "S_IRUSR | S_IWUSR"
          ],
          "line": 4586
        },
        "resolved": true,
        "details": {
          "function_name": "create_file",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/textfile.c",
          "lines": "76-89",
          "snippet": "int create_file(const char *filename, const mode_t mode)\n{\n\tint fd;\n\n\tcreate_dirs(filename, S_IRUSR | S_IWUSR | S_IXUSR);\n\n\tfd = open(filename, O_RDWR | O_CREAT, mode);\n\tif (fd < 0)\n\t\treturn fd;\n\n\tclose(fd);\n\n\treturn 0;\n}",
          "includes": [
            "#include \"textfile.h\"",
            "#include <sys/param.h>",
            "#include <sys/mman.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <ctype.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"textfile.h\"\n#include <sys/param.h>\n#include <sys/mman.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <ctype.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nint create_file(const char *filename, const mode_t mode)\n{\n\tint fd;\n\n\tcreate_dirs(filename, S_IRUSR | S_IWUSR | S_IXUSR);\n\n\tfd = open(filename, O_RDWR | O_CREAT, mode);\n\tif (fd < 0)\n\t\treturn fd;\n\n\tclose(fd);\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_key_file_to_data",
          "args": [
            "att_key_file",
            "&length",
            "NULL"
          ],
          "line": 4584
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_free",
          "args": [
            "sdp_key_file"
          ],
          "line": 4580
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "data"
          ],
          "line": 4579
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_file_set_contents",
          "args": [
            "sdp_file",
            "data",
            "length",
            "NULL"
          ],
          "line": 4576
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_to_data",
          "args": [
            "sdp_key_file",
            "&length",
            "NULL"
          ],
          "line": 4573
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_free",
          "args": [
            "svcclass",
            "free"
          ],
          "line": 4569
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "profile_uuid"
          ],
          "line": 4568
        },
        "resolved": true,
        "details": {
          "function_name": "device_auth_req_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5662-5676",
          "snippet": "static void device_auth_req_free(struct btd_device *device)\n{\n\tstruct authentication_req *authr = device->authr;\n\n\tif (!authr)\n\t\treturn;\n\n\tif (authr->agent)\n\t\tagent_unref(authr->agent);\n\n\tg_free(authr->pincode);\n\tg_free(authr);\n\n\tdevice->authr = NULL;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void device_auth_req_free(struct btd_device *device)\n{\n\tstruct authentication_req *authr = device->authr;\n\n\tif (!authr)\n\t\treturn;\n\n\tif (authr->agent)\n\t\tagent_unref(authr->agent);\n\n\tg_free(authr->pincode);\n\tg_free(authr);\n\n\tdevice->authr = NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "store_primaries_from_sdp_record",
          "args": [
            "att_key_file",
            "rec"
          ],
          "line": 4565
        },
        "resolved": true,
        "details": {
          "function_name": "store_primaries_from_sdp_record",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "4405-4450",
          "snippet": "static void store_primaries_from_sdp_record(GKeyFile *key_file,\n\t\t\t\t\t\tsdp_record_t *rec)\n{\n\tuuid_t uuid;\n\tchar *att_uuid, *prim_uuid;\n\tuint16_t start = 0, end = 0, psm = 0;\n\tchar handle[6], uuid_str[33];\n\tint i;\n\n\tsdp_uuid16_create(&uuid, ATT_UUID);\n\tatt_uuid = bt_uuid2string(&uuid);\n\n\tsdp_uuid16_create(&uuid, GATT_PRIM_SVC_UUID);\n\tprim_uuid = bt_uuid2string(&uuid);\n\n\tif (!record_has_uuid(rec, att_uuid))\n\t\tgoto done;\n\n\tif (!gatt_parse_record(rec, &uuid, &psm, &start, &end))\n\t\tgoto done;\n\n\tsprintf(handle, \"%hu\", start);\n\tswitch (uuid.type) {\n\tcase SDP_UUID16:\n\t\tsprintf(uuid_str, \"%4.4X\", uuid.value.uuid16);\n\t\tbreak;\n\tcase SDP_UUID32:\n\t\tsprintf(uuid_str, \"%8.8X\", uuid.value.uuid32);\n\t\tbreak;\n\tcase SDP_UUID128:\n\t\tfor (i = 0; i < 16; i++)\n\t\t\tsprintf(uuid_str + (i * 2), \"%2.2X\",\n\t\t\t\t\tuuid.value.uuid128.data[i]);\n\t\tbreak;\n\tdefault:\n\t\tuuid_str[0] = '\\0';\n\t}\n\n\tg_key_file_set_string(key_file, handle, \"UUID\", prim_uuid);\n\tg_key_file_set_string(key_file, handle, \"Value\", uuid_str);\n\tg_key_file_set_integer(key_file, handle, \"EndGroupHandle\", end);\n\ndone:\n\tfree(prim_uuid);\n\tfree(att_uuid);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void store_primaries_from_sdp_record(GKeyFile *key_file,\n\t\t\t\t\t\tsdp_record_t *rec)\n{\n\tuuid_t uuid;\n\tchar *att_uuid, *prim_uuid;\n\tuint16_t start = 0, end = 0, psm = 0;\n\tchar handle[6], uuid_str[33];\n\tint i;\n\n\tsdp_uuid16_create(&uuid, ATT_UUID);\n\tatt_uuid = bt_uuid2string(&uuid);\n\n\tsdp_uuid16_create(&uuid, GATT_PRIM_SVC_UUID);\n\tprim_uuid = bt_uuid2string(&uuid);\n\n\tif (!record_has_uuid(rec, att_uuid))\n\t\tgoto done;\n\n\tif (!gatt_parse_record(rec, &uuid, &psm, &start, &end))\n\t\tgoto done;\n\n\tsprintf(handle, \"%hu\", start);\n\tswitch (uuid.type) {\n\tcase SDP_UUID16:\n\t\tsprintf(uuid_str, \"%4.4X\", uuid.value.uuid16);\n\t\tbreak;\n\tcase SDP_UUID32:\n\t\tsprintf(uuid_str, \"%8.8X\", uuid.value.uuid32);\n\t\tbreak;\n\tcase SDP_UUID128:\n\t\tfor (i = 0; i < 16; i++)\n\t\t\tsprintf(uuid_str + (i * 2), \"%2.2X\",\n\t\t\t\t\tuuid.value.uuid128.data[i]);\n\t\tbreak;\n\tdefault:\n\t\tuuid_str[0] = '\\0';\n\t}\n\n\tg_key_file_set_string(key_file, handle, \"UUID\", prim_uuid);\n\tg_key_file_set_string(key_file, handle, \"Value\", uuid_str);\n\tg_key_file_set_integer(key_file, handle, \"EndGroupHandle\", end);\n\ndone:\n\tfree(prim_uuid);\n\tfree(att_uuid);\n}"
        }
      },
      {
        "call_info": {
          "callee": "store_sdp_record",
          "args": [
            "sdp_key_file",
            "rec"
          ],
          "line": 4562
        },
        "resolved": true,
        "details": {
          "function_name": "store_sdp_record",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "4380-4403",
          "snippet": "static void store_sdp_record(GKeyFile *key_file, sdp_record_t *rec)\n{\n\tchar handle_str[11];\n\tsdp_buf_t buf;\n\tint size, i;\n\tchar *str;\n\n\tsprintf(handle_str, \"0x%8.8X\", rec->handle);\n\n\tif (sdp_gen_record_pdu(rec, &buf) < 0)\n\t\treturn;\n\n\tsize = buf.data_size;\n\n\tstr = g_malloc0(size*2+1);\n\n\tfor (i = 0; i < size; i++)\n\t\tsprintf(str + (i * 2), \"%02X\", buf.data[i]);\n\n\tg_key_file_set_string(key_file, \"ServiceRecords\", handle_str, str);\n\n\tfree(buf.data);\n\tg_free(str);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void store_sdp_record(GKeyFile *key_file, sdp_record_t *rec)\n{\n\tchar handle_str[11];\n\tsdp_buf_t buf;\n\tint size, i;\n\tchar *str;\n\n\tsprintf(handle_str, \"0x%8.8X\", rec->handle);\n\n\tif (sdp_gen_record_pdu(rec, &buf) < 0)\n\t\treturn;\n\n\tsize = buf.data_size;\n\n\tstr = g_malloc0(size*2+1);\n\n\tfor (i = 0; i < size; i++)\n\t\tsprintf(str + (i * 2), \"%02X\", buf.data[i]);\n\n\tg_key_file_set_string(key_file, \"ServiceRecords\", handle_str, str);\n\n\tfree(buf.data);\n\tg_free(str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "update_record",
          "args": [
            "req",
            "profile_uuid",
            "rec"
          ],
          "line": 4558
        },
        "resolved": true,
        "details": {
          "function_name": "update_record",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "4460-4484",
          "snippet": "static int update_record(struct browse_req *req, const char *uuid,\n\t\t\t\t\t\t\tsdp_record_t *rec)\n{\n\tGSList *l;\n\n\t/* Check for duplicates */\n\tif (sdp_list_find(req->records, rec, rec_cmp))\n\t\treturn -EALREADY;\n\n\t/* Copy record */\n\treq->records = sdp_list_append(req->records, sdp_copy_record(rec));\n\n\t/* Check if UUID is duplicated */\n\tl = g_slist_find_custom(req->device->uuids, uuid, bt_uuid_strcmp);\n\tif (l == NULL) {\n\t\tl = g_slist_find_custom(req->profiles_added, uuid,\n\t\t\t\t\t\t\tbt_uuid_strcmp);\n\t\tif (l != NULL)\n\t\t\treturn 0;\n\t\treq->profiles_added = g_slist_append(req->profiles_added,\n\t\t\t\t\t\t\tg_strdup(uuid));\n\t}\n\n\treturn 0;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic int update_record(struct browse_req *req, const char *uuid,\n\t\t\t\t\t\t\tsdp_record_t *rec)\n{\n\tGSList *l;\n\n\t/* Check for duplicates */\n\tif (sdp_list_find(req->records, rec, rec_cmp))\n\t\treturn -EALREADY;\n\n\t/* Copy record */\n\treq->records = sdp_list_append(req->records, sdp_copy_record(rec));\n\n\t/* Check if UUID is duplicated */\n\tl = g_slist_find_custom(req->device->uuids, uuid, bt_uuid_strcmp);\n\tif (l == NULL) {\n\t\tl = g_slist_find_custom(req->profiles_added, uuid,\n\t\t\t\t\t\t\tbt_uuid_strcmp);\n\t\tif (l != NULL)\n\t\t\treturn 0;\n\t\treq->profiles_added = g_slist_append(req->profiles_added,\n\t\t\t\t\t\t\tg_strdup(uuid));\n\t}\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_device_set_pnpid",
          "args": [
            "device",
            "source",
            "vendor",
            "product",
            "version"
          ],
          "line": 4554
        },
        "resolved": true,
        "details": {
          "function_name": "btd_device_set_pnpid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "6408-6427",
          "snippet": "void btd_device_set_pnpid(struct btd_device *device, uint16_t source,\n\t\t\tuint16_t vendor, uint16_t product, uint16_t version)\n{\n\tif (device->vendor_src == source && device->version == version &&\n\t\t\tdevice->vendor == vendor && device->product == product)\n\t\treturn;\n\n\tdevice->vendor_src = source;\n\tdevice->vendor = vendor;\n\tdevice->product = product;\n\tdevice->version = version;\n\n\tfree(device->modalias);\n\tdevice->modalias = bt_modalias(source, vendor, product, version);\n\n\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"Modalias\");\n\n\tstore_device_info(device);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *dbus_conn = NULL;",
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid btd_device_set_pnpid(struct btd_device *device, uint16_t source,\n\t\t\tuint16_t vendor, uint16_t product, uint16_t version)\n{\n\tif (device->vendor_src == source && device->version == version &&\n\t\t\tdevice->vendor == vendor && device->product == product)\n\t\treturn;\n\n\tdevice->vendor_src = source;\n\tdevice->vendor = vendor;\n\tdevice->product = product;\n\tdevice->version = version;\n\n\tfree(device->modalias);\n\tdevice->modalias = bt_modalias(source, vendor, product, version);\n\n\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"Modalias\");\n\n\tstore_device_info(device);\n}"
        }
      },
      {
        "call_info": {
          "callee": "sdp_data_get",
          "args": [
            "rec",
            "SDP_ATTR_VERSION"
          ],
          "line": 4550
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_data_get",
          "args": [
            "rec",
            "SDP_ATTR_PRODUCT_ID"
          ],
          "line": 4547
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_data_get",
          "args": [
            "rec",
            "SDP_ATTR_VENDOR_ID"
          ],
          "line": 4544
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_data_get",
          "args": [
            "rec",
            "SDP_ATTR_VENDOR_ID_SOURCE"
          ],
          "line": 4541
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_uuid_strcmp",
          "args": [
            "profile_uuid",
            "PNP_UUID"
          ],
          "line": 4537
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_free",
          "args": [
            "svcclass",
            "free"
          ],
          "line": 4533
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_uuid2string",
          "args": [
            "svcclass->data"
          ],
          "line": 4531
        },
        "resolved": true,
        "details": {
          "function_name": "bt_uuid2string",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/uuid-helper.c",
          "lines": "65-110",
          "snippet": "char *bt_uuid2string(uuid_t *uuid)\n{\n\tchar *str;\n\tuuid_t uuid128;\n\tunsigned int data0;\n\tunsigned short data1;\n\tunsigned short data2;\n\tunsigned short data3;\n\tunsigned int data4;\n\tunsigned short data5;\n\tint err;\n\n\tif (!uuid)\n\t\treturn NULL;\n\n\tswitch (uuid->type) {\n\tcase SDP_UUID16:\n\t\tsdp_uuid16_to_uuid128(&uuid128, uuid);\n\t\tbreak;\n\tcase SDP_UUID32:\n\t\tsdp_uuid32_to_uuid128(&uuid128, uuid);\n\t\tbreak;\n\tcase SDP_UUID128:\n\t\tmemcpy(&uuid128, uuid, sizeof(uuid_t));\n\t\tbreak;\n\tdefault:\n\t\t/* Type of UUID unknown */\n\t\treturn NULL;\n\t}\n\n\tmemcpy(&data0, &uuid128.value.uuid128.data[0], 4);\n\tmemcpy(&data1, &uuid128.value.uuid128.data[4], 2);\n\tmemcpy(&data2, &uuid128.value.uuid128.data[6], 2);\n\tmemcpy(&data3, &uuid128.value.uuid128.data[8], 2);\n\tmemcpy(&data4, &uuid128.value.uuid128.data[10], 4);\n\tmemcpy(&data5, &uuid128.value.uuid128.data[14], 2);\n\n\terr = asprintf(&str, \"%.8x-%.4x-%.4x-%.4x-%.8x%.4x\",\n\t\t\tntohl(data0), ntohs(data1),\n\t\t\tntohs(data2), ntohs(data3),\n\t\t\tntohl(data4), ntohs(data5));\n\tif (err < 0)\n\t\treturn NULL;\n\n\treturn str;\n}",
          "includes": [
            "#include \"uuid-helper.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <arpa/inet.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"uuid-helper.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <arpa/inet.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *bt_uuid2string(uuid_t *uuid)\n{\n\tchar *str;\n\tuuid_t uuid128;\n\tunsigned int data0;\n\tunsigned short data1;\n\tunsigned short data2;\n\tunsigned short data3;\n\tunsigned int data4;\n\tunsigned short data5;\n\tint err;\n\n\tif (!uuid)\n\t\treturn NULL;\n\n\tswitch (uuid->type) {\n\tcase SDP_UUID16:\n\t\tsdp_uuid16_to_uuid128(&uuid128, uuid);\n\t\tbreak;\n\tcase SDP_UUID32:\n\t\tsdp_uuid32_to_uuid128(&uuid128, uuid);\n\t\tbreak;\n\tcase SDP_UUID128:\n\t\tmemcpy(&uuid128, uuid, sizeof(uuid_t));\n\t\tbreak;\n\tdefault:\n\t\t/* Type of UUID unknown */\n\t\treturn NULL;\n\t}\n\n\tmemcpy(&data0, &uuid128.value.uuid128.data[0], 4);\n\tmemcpy(&data1, &uuid128.value.uuid128.data[4], 2);\n\tmemcpy(&data2, &uuid128.value.uuid128.data[6], 2);\n\tmemcpy(&data3, &uuid128.value.uuid128.data[8], 2);\n\tmemcpy(&data4, &uuid128.value.uuid128.data[10], 4);\n\tmemcpy(&data5, &uuid128.value.uuid128.data[14], 2);\n\n\terr = asprintf(&str, \"%.8x-%.4x-%.4x-%.4x-%.8x%.4x\",\n\t\t\tntohl(data0), ntohs(data1),\n\t\t\tntohs(data2), ntohs(data3),\n\t\t\tntohl(data4), ntohs(data5));\n\tif (err < 0)\n\t\treturn NULL;\n\n\treturn str;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Skipping record with no service classes\""
          ],
          "line": 4526
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_get_service_classes",
          "args": [
            "rec",
            "&svcclass"
          ],
          "line": 4521
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_load_from_file",
          "args": [
            "att_key_file",
            "att_file",
            "0",
            "NULL"
          ],
          "line": 4511
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_new",
          "args": [],
          "line": 4510
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "att_file",
            "PATH_MAX",
            "STORAGEDIR \"/%s/%s/attributes\"",
            "srcaddr",
            "dstaddr"
          ],
          "line": 4507
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_load_from_file",
          "args": [
            "sdp_key_file",
            "sdp_file",
            "0",
            "NULL"
          ],
          "line": 4505
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_new",
          "args": [],
          "line": 4504
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "sdp_file",
            "PATH_MAX",
            "STORAGEDIR \"/%s/cache/%s\"",
            "srcaddr",
            "dstaddr"
          ],
          "line": 4501
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ba2str",
          "args": [
            "&device->bdaddr",
            "dstaddr"
          ],
          "line": 4499
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ba2str",
          "args": [
            "btd_adapter_get_address(device->adapter)",
            "srcaddr"
          ],
          "line": 4498
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_adapter_get_address",
          "args": [
            "device->adapter"
          ],
          "line": 4498
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_get_address",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "5881-5884",
          "snippet": "const bdaddr_t *btd_adapter_get_address(struct btd_adapter *adapter)\n{\n\treturn &adapter->bdaddr;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nconst bdaddr_t *btd_adapter_get_address(struct btd_adapter *adapter)\n{\n\treturn &adapter->bdaddr;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void update_bredr_services(struct browse_req *req, sdp_list_t *recs)\n{\n\tstruct btd_device *device = req->device;\n\tsdp_list_t *seq;\n\tchar srcaddr[18], dstaddr[18];\n\tchar sdp_file[PATH_MAX];\n\tchar att_file[PATH_MAX];\n\tGKeyFile *sdp_key_file;\n\tGKeyFile *att_key_file;\n\tchar *data;\n\tgsize length = 0;\n\n\tba2str(btd_adapter_get_address(device->adapter), srcaddr);\n\tba2str(&device->bdaddr, dstaddr);\n\n\tsnprintf(sdp_file, PATH_MAX, STORAGEDIR \"/%s/cache/%s\", srcaddr,\n\t\t\t\t\t\t\t\tdstaddr);\n\n\tsdp_key_file = g_key_file_new();\n\tg_key_file_load_from_file(sdp_key_file, sdp_file, 0, NULL);\n\n\tsnprintf(att_file, PATH_MAX, STORAGEDIR \"/%s/%s/attributes\", srcaddr,\n\t\t\t\t\t\t\t\tdstaddr);\n\n\tatt_key_file = g_key_file_new();\n\tg_key_file_load_from_file(att_key_file, att_file, 0, NULL);\n\n\tfor (seq = recs; seq; seq = seq->next) {\n\t\tsdp_record_t *rec = (sdp_record_t *) seq->data;\n\t\tsdp_list_t *svcclass = NULL;\n\t\tchar *profile_uuid;\n\n\t\tif (!rec)\n\t\t\tbreak;\n\n\t\tif (sdp_get_service_classes(rec, &svcclass) < 0)\n\t\t\tcontinue;\n\n\t\t/* Check for empty service classes list */\n\t\tif (svcclass == NULL) {\n\t\t\tDBG(\"Skipping record with no service classes\");\n\t\t\tcontinue;\n\t\t}\n\n\t\t/* Extract the first element and skip the remainning */\n\t\tprofile_uuid = bt_uuid2string(svcclass->data);\n\t\tif (!profile_uuid) {\n\t\t\tsdp_list_free(svcclass, free);\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (bt_uuid_strcmp(profile_uuid, PNP_UUID) == 0) {\n\t\t\tuint16_t source, vendor, product, version;\n\t\t\tsdp_data_t *pdlist;\n\n\t\t\tpdlist = sdp_data_get(rec, SDP_ATTR_VENDOR_ID_SOURCE);\n\t\t\tsource = pdlist ? pdlist->val.uint16 : 0x0000;\n\n\t\t\tpdlist = sdp_data_get(rec, SDP_ATTR_VENDOR_ID);\n\t\t\tvendor = pdlist ? pdlist->val.uint16 : 0x0000;\n\n\t\t\tpdlist = sdp_data_get(rec, SDP_ATTR_PRODUCT_ID);\n\t\t\tproduct = pdlist ? pdlist->val.uint16 : 0x0000;\n\n\t\t\tpdlist = sdp_data_get(rec, SDP_ATTR_VERSION);\n\t\t\tversion = pdlist ? pdlist->val.uint16 : 0x0000;\n\n\t\t\tif (source || vendor || product || version)\n\t\t\t\tbtd_device_set_pnpid(device, source, vendor,\n\t\t\t\t\t\t\tproduct, version);\n\t\t}\n\n\t\tif (update_record(req, profile_uuid, rec) < 0)\n\t\t\tgoto next;\n\n\t\tif (sdp_key_file)\n\t\t\tstore_sdp_record(sdp_key_file, rec);\n\n\t\tif (att_key_file)\n\t\t\tstore_primaries_from_sdp_record(att_key_file, rec);\n\nnext:\n\t\tfree(profile_uuid);\n\t\tsdp_list_free(svcclass, free);\n\t}\n\n\tif (sdp_key_file) {\n\t\tdata = g_key_file_to_data(sdp_key_file, &length, NULL);\n\t\tif (length > 0) {\n\t\t\tcreate_file(sdp_file, S_IRUSR | S_IWUSR);\n\t\t\tg_file_set_contents(sdp_file, data, length, NULL);\n\t\t}\n\n\t\tg_free(data);\n\t\tg_key_file_free(sdp_key_file);\n\t}\n\n\tif (att_key_file) {\n\t\tdata = g_key_file_to_data(att_key_file, &length, NULL);\n\t\tif (length > 0) {\n\t\t\tcreate_file(att_file, S_IRUSR | S_IWUSR);\n\t\t\tg_file_set_contents(att_file, data, length, NULL);\n\t\t}\n\n\t\tg_free(data);\n\t\tg_key_file_free(att_key_file);\n\t}\n}"
  },
  {
    "function_name": "update_record",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "4460-4484",
    "snippet": "static int update_record(struct browse_req *req, const char *uuid,\n\t\t\t\t\t\t\tsdp_record_t *rec)\n{\n\tGSList *l;\n\n\t/* Check for duplicates */\n\tif (sdp_list_find(req->records, rec, rec_cmp))\n\t\treturn -EALREADY;\n\n\t/* Copy record */\n\treq->records = sdp_list_append(req->records, sdp_copy_record(rec));\n\n\t/* Check if UUID is duplicated */\n\tl = g_slist_find_custom(req->device->uuids, uuid, bt_uuid_strcmp);\n\tif (l == NULL) {\n\t\tl = g_slist_find_custom(req->profiles_added, uuid,\n\t\t\t\t\t\t\tbt_uuid_strcmp);\n\t\tif (l != NULL)\n\t\t\treturn 0;\n\t\treq->profiles_added = g_slist_append(req->profiles_added,\n\t\t\t\t\t\t\tg_strdup(uuid));\n\t}\n\n\treturn 0;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_slist_append",
          "args": [
            "req->profiles_added",
            "g_strdup(uuid)"
          ],
          "line": 4479
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "uuid"
          ],
          "line": 4480
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_find_custom",
          "args": [
            "req->profiles_added",
            "uuid",
            "bt_uuid_strcmp"
          ],
          "line": 4475
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_find_custom",
          "args": [
            "req->device->uuids",
            "uuid",
            "bt_uuid_strcmp"
          ],
          "line": 4473
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_append",
          "args": [
            "req->records",
            "sdp_copy_record(rec)"
          ],
          "line": 4470
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_copy_record",
          "args": [
            "rec"
          ],
          "line": 4470
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_find",
          "args": [
            "req->records",
            "rec",
            "rec_cmp"
          ],
          "line": 4466
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic int update_record(struct browse_req *req, const char *uuid,\n\t\t\t\t\t\t\tsdp_record_t *rec)\n{\n\tGSList *l;\n\n\t/* Check for duplicates */\n\tif (sdp_list_find(req->records, rec, rec_cmp))\n\t\treturn -EALREADY;\n\n\t/* Copy record */\n\treq->records = sdp_list_append(req->records, sdp_copy_record(rec));\n\n\t/* Check if UUID is duplicated */\n\tl = g_slist_find_custom(req->device->uuids, uuid, bt_uuid_strcmp);\n\tif (l == NULL) {\n\t\tl = g_slist_find_custom(req->profiles_added, uuid,\n\t\t\t\t\t\t\tbt_uuid_strcmp);\n\t\tif (l != NULL)\n\t\t\treturn 0;\n\t\treq->profiles_added = g_slist_append(req->profiles_added,\n\t\t\t\t\t\t\tg_strdup(uuid));\n\t}\n\n\treturn 0;\n}"
  },
  {
    "function_name": "rec_cmp",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "4452-4458",
    "snippet": "static int rec_cmp(const void *a, const void *b)\n{\n\tconst sdp_record_t *r1 = a;\n\tconst sdp_record_t *r2 = b;\n\n\treturn r1->handle - r2->handle;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int rec_cmp(const void *a, const void *b)\n{\n\tconst sdp_record_t *r1 = a;\n\tconst sdp_record_t *r2 = b;\n\n\treturn r1->handle - r2->handle;\n}"
  },
  {
    "function_name": "store_primaries_from_sdp_record",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "4405-4450",
    "snippet": "static void store_primaries_from_sdp_record(GKeyFile *key_file,\n\t\t\t\t\t\tsdp_record_t *rec)\n{\n\tuuid_t uuid;\n\tchar *att_uuid, *prim_uuid;\n\tuint16_t start = 0, end = 0, psm = 0;\n\tchar handle[6], uuid_str[33];\n\tint i;\n\n\tsdp_uuid16_create(&uuid, ATT_UUID);\n\tatt_uuid = bt_uuid2string(&uuid);\n\n\tsdp_uuid16_create(&uuid, GATT_PRIM_SVC_UUID);\n\tprim_uuid = bt_uuid2string(&uuid);\n\n\tif (!record_has_uuid(rec, att_uuid))\n\t\tgoto done;\n\n\tif (!gatt_parse_record(rec, &uuid, &psm, &start, &end))\n\t\tgoto done;\n\n\tsprintf(handle, \"%hu\", start);\n\tswitch (uuid.type) {\n\tcase SDP_UUID16:\n\t\tsprintf(uuid_str, \"%4.4X\", uuid.value.uuid16);\n\t\tbreak;\n\tcase SDP_UUID32:\n\t\tsprintf(uuid_str, \"%8.8X\", uuid.value.uuid32);\n\t\tbreak;\n\tcase SDP_UUID128:\n\t\tfor (i = 0; i < 16; i++)\n\t\t\tsprintf(uuid_str + (i * 2), \"%2.2X\",\n\t\t\t\t\tuuid.value.uuid128.data[i]);\n\t\tbreak;\n\tdefault:\n\t\tuuid_str[0] = '\\0';\n\t}\n\n\tg_key_file_set_string(key_file, handle, \"UUID\", prim_uuid);\n\tg_key_file_set_string(key_file, handle, \"Value\", uuid_str);\n\tg_key_file_set_integer(key_file, handle, \"EndGroupHandle\", end);\n\ndone:\n\tfree(prim_uuid);\n\tfree(att_uuid);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "att_uuid"
          ],
          "line": 4449
        },
        "resolved": true,
        "details": {
          "function_name": "device_auth_req_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5662-5676",
          "snippet": "static void device_auth_req_free(struct btd_device *device)\n{\n\tstruct authentication_req *authr = device->authr;\n\n\tif (!authr)\n\t\treturn;\n\n\tif (authr->agent)\n\t\tagent_unref(authr->agent);\n\n\tg_free(authr->pincode);\n\tg_free(authr);\n\n\tdevice->authr = NULL;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void device_auth_req_free(struct btd_device *device)\n{\n\tstruct authentication_req *authr = device->authr;\n\n\tif (!authr)\n\t\treturn;\n\n\tif (authr->agent)\n\t\tagent_unref(authr->agent);\n\n\tg_free(authr->pincode);\n\tg_free(authr);\n\n\tdevice->authr = NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_key_file_set_integer",
          "args": [
            "key_file",
            "handle",
            "\"EndGroupHandle\"",
            "end"
          ],
          "line": 4445
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_set_string",
          "args": [
            "key_file",
            "handle",
            "\"Value\"",
            "uuid_str"
          ],
          "line": 4444
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_set_string",
          "args": [
            "key_file",
            "handle",
            "\"UUID\"",
            "prim_uuid"
          ],
          "line": 4443
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            "uuid_str + (i * 2)",
            "\"%2.2X\"",
            "uuid.value.uuid128.data[i]"
          ],
          "line": 4436
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            "uuid_str",
            "\"%8.8X\"",
            "uuid.value.uuid32"
          ],
          "line": 4432
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            "uuid_str",
            "\"%4.4X\"",
            "uuid.value.uuid16"
          ],
          "line": 4429
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            "handle",
            "\"%hu\"",
            "start"
          ],
          "line": 4426
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gatt_parse_record",
          "args": [
            "rec",
            "&uuid",
            "&psm",
            "&start",
            "&end"
          ],
          "line": 4423
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "record_has_uuid",
          "args": [
            "rec",
            "att_uuid"
          ],
          "line": 4420
        },
        "resolved": true,
        "details": {
          "function_name": "record_has_uuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "4243-4265",
          "snippet": "static gboolean record_has_uuid(const sdp_record_t *rec,\n\t\t\t\tconst char *profile_uuid)\n{\n\tsdp_list_t *pat;\n\n\tfor (pat = rec->pattern; pat != NULL; pat = pat->next) {\n\t\tchar *uuid;\n\t\tint ret;\n\n\t\tuuid = bt_uuid2string(pat->data);\n\t\tif (!uuid)\n\t\t\tcontinue;\n\n\t\tret = strcasecmp(uuid, profile_uuid);\n\n\t\tfree(uuid);\n\n\t\tif (ret == 0)\n\t\t\treturn TRUE;\n\t}\n\n\treturn FALSE;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic gboolean record_has_uuid(const sdp_record_t *rec,\n\t\t\t\tconst char *profile_uuid)\n{\n\tsdp_list_t *pat;\n\n\tfor (pat = rec->pattern; pat != NULL; pat = pat->next) {\n\t\tchar *uuid;\n\t\tint ret;\n\n\t\tuuid = bt_uuid2string(pat->data);\n\t\tif (!uuid)\n\t\t\tcontinue;\n\n\t\tret = strcasecmp(uuid, profile_uuid);\n\n\t\tfree(uuid);\n\n\t\tif (ret == 0)\n\t\t\treturn TRUE;\n\t}\n\n\treturn FALSE;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_uuid2string",
          "args": [
            "&uuid"
          ],
          "line": 4418
        },
        "resolved": true,
        "details": {
          "function_name": "bt_uuid2string",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/uuid-helper.c",
          "lines": "65-110",
          "snippet": "char *bt_uuid2string(uuid_t *uuid)\n{\n\tchar *str;\n\tuuid_t uuid128;\n\tunsigned int data0;\n\tunsigned short data1;\n\tunsigned short data2;\n\tunsigned short data3;\n\tunsigned int data4;\n\tunsigned short data5;\n\tint err;\n\n\tif (!uuid)\n\t\treturn NULL;\n\n\tswitch (uuid->type) {\n\tcase SDP_UUID16:\n\t\tsdp_uuid16_to_uuid128(&uuid128, uuid);\n\t\tbreak;\n\tcase SDP_UUID32:\n\t\tsdp_uuid32_to_uuid128(&uuid128, uuid);\n\t\tbreak;\n\tcase SDP_UUID128:\n\t\tmemcpy(&uuid128, uuid, sizeof(uuid_t));\n\t\tbreak;\n\tdefault:\n\t\t/* Type of UUID unknown */\n\t\treturn NULL;\n\t}\n\n\tmemcpy(&data0, &uuid128.value.uuid128.data[0], 4);\n\tmemcpy(&data1, &uuid128.value.uuid128.data[4], 2);\n\tmemcpy(&data2, &uuid128.value.uuid128.data[6], 2);\n\tmemcpy(&data3, &uuid128.value.uuid128.data[8], 2);\n\tmemcpy(&data4, &uuid128.value.uuid128.data[10], 4);\n\tmemcpy(&data5, &uuid128.value.uuid128.data[14], 2);\n\n\terr = asprintf(&str, \"%.8x-%.4x-%.4x-%.4x-%.8x%.4x\",\n\t\t\tntohl(data0), ntohs(data1),\n\t\t\tntohs(data2), ntohs(data3),\n\t\t\tntohl(data4), ntohs(data5));\n\tif (err < 0)\n\t\treturn NULL;\n\n\treturn str;\n}",
          "includes": [
            "#include \"uuid-helper.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <arpa/inet.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"uuid-helper.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <arpa/inet.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *bt_uuid2string(uuid_t *uuid)\n{\n\tchar *str;\n\tuuid_t uuid128;\n\tunsigned int data0;\n\tunsigned short data1;\n\tunsigned short data2;\n\tunsigned short data3;\n\tunsigned int data4;\n\tunsigned short data5;\n\tint err;\n\n\tif (!uuid)\n\t\treturn NULL;\n\n\tswitch (uuid->type) {\n\tcase SDP_UUID16:\n\t\tsdp_uuid16_to_uuid128(&uuid128, uuid);\n\t\tbreak;\n\tcase SDP_UUID32:\n\t\tsdp_uuid32_to_uuid128(&uuid128, uuid);\n\t\tbreak;\n\tcase SDP_UUID128:\n\t\tmemcpy(&uuid128, uuid, sizeof(uuid_t));\n\t\tbreak;\n\tdefault:\n\t\t/* Type of UUID unknown */\n\t\treturn NULL;\n\t}\n\n\tmemcpy(&data0, &uuid128.value.uuid128.data[0], 4);\n\tmemcpy(&data1, &uuid128.value.uuid128.data[4], 2);\n\tmemcpy(&data2, &uuid128.value.uuid128.data[6], 2);\n\tmemcpy(&data3, &uuid128.value.uuid128.data[8], 2);\n\tmemcpy(&data4, &uuid128.value.uuid128.data[10], 4);\n\tmemcpy(&data5, &uuid128.value.uuid128.data[14], 2);\n\n\terr = asprintf(&str, \"%.8x-%.4x-%.4x-%.4x-%.8x%.4x\",\n\t\t\tntohl(data0), ntohs(data1),\n\t\t\tntohs(data2), ntohs(data3),\n\t\t\tntohl(data4), ntohs(data5));\n\tif (err < 0)\n\t\treturn NULL;\n\n\treturn str;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sdp_uuid16_create",
          "args": [
            "&uuid",
            "GATT_PRIM_SVC_UUID"
          ],
          "line": 4417
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_uuid16_create",
          "args": [
            "&uuid",
            "ATT_UUID"
          ],
          "line": 4414
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void store_primaries_from_sdp_record(GKeyFile *key_file,\n\t\t\t\t\t\tsdp_record_t *rec)\n{\n\tuuid_t uuid;\n\tchar *att_uuid, *prim_uuid;\n\tuint16_t start = 0, end = 0, psm = 0;\n\tchar handle[6], uuid_str[33];\n\tint i;\n\n\tsdp_uuid16_create(&uuid, ATT_UUID);\n\tatt_uuid = bt_uuid2string(&uuid);\n\n\tsdp_uuid16_create(&uuid, GATT_PRIM_SVC_UUID);\n\tprim_uuid = bt_uuid2string(&uuid);\n\n\tif (!record_has_uuid(rec, att_uuid))\n\t\tgoto done;\n\n\tif (!gatt_parse_record(rec, &uuid, &psm, &start, &end))\n\t\tgoto done;\n\n\tsprintf(handle, \"%hu\", start);\n\tswitch (uuid.type) {\n\tcase SDP_UUID16:\n\t\tsprintf(uuid_str, \"%4.4X\", uuid.value.uuid16);\n\t\tbreak;\n\tcase SDP_UUID32:\n\t\tsprintf(uuid_str, \"%8.8X\", uuid.value.uuid32);\n\t\tbreak;\n\tcase SDP_UUID128:\n\t\tfor (i = 0; i < 16; i++)\n\t\t\tsprintf(uuid_str + (i * 2), \"%2.2X\",\n\t\t\t\t\tuuid.value.uuid128.data[i]);\n\t\tbreak;\n\tdefault:\n\t\tuuid_str[0] = '\\0';\n\t}\n\n\tg_key_file_set_string(key_file, handle, \"UUID\", prim_uuid);\n\tg_key_file_set_string(key_file, handle, \"Value\", uuid_str);\n\tg_key_file_set_integer(key_file, handle, \"EndGroupHandle\", end);\n\ndone:\n\tfree(prim_uuid);\n\tfree(att_uuid);\n}"
  },
  {
    "function_name": "store_sdp_record",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "4380-4403",
    "snippet": "static void store_sdp_record(GKeyFile *key_file, sdp_record_t *rec)\n{\n\tchar handle_str[11];\n\tsdp_buf_t buf;\n\tint size, i;\n\tchar *str;\n\n\tsprintf(handle_str, \"0x%8.8X\", rec->handle);\n\n\tif (sdp_gen_record_pdu(rec, &buf) < 0)\n\t\treturn;\n\n\tsize = buf.data_size;\n\n\tstr = g_malloc0(size*2+1);\n\n\tfor (i = 0; i < size; i++)\n\t\tsprintf(str + (i * 2), \"%02X\", buf.data[i]);\n\n\tg_key_file_set_string(key_file, \"ServiceRecords\", handle_str, str);\n\n\tfree(buf.data);\n\tg_free(str);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "str"
          ],
          "line": 4402
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "buf.data"
          ],
          "line": 4401
        },
        "resolved": true,
        "details": {
          "function_name": "device_auth_req_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5662-5676",
          "snippet": "static void device_auth_req_free(struct btd_device *device)\n{\n\tstruct authentication_req *authr = device->authr;\n\n\tif (!authr)\n\t\treturn;\n\n\tif (authr->agent)\n\t\tagent_unref(authr->agent);\n\n\tg_free(authr->pincode);\n\tg_free(authr);\n\n\tdevice->authr = NULL;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void device_auth_req_free(struct btd_device *device)\n{\n\tstruct authentication_req *authr = device->authr;\n\n\tif (!authr)\n\t\treturn;\n\n\tif (authr->agent)\n\t\tagent_unref(authr->agent);\n\n\tg_free(authr->pincode);\n\tg_free(authr);\n\n\tdevice->authr = NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_key_file_set_string",
          "args": [
            "key_file",
            "\"ServiceRecords\"",
            "handle_str",
            "str"
          ],
          "line": 4399
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            "str + (i * 2)",
            "\"%02X\"",
            "buf.data[i]"
          ],
          "line": 4397
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_malloc0",
          "args": [
            "size*2+1"
          ],
          "line": 4394
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_gen_record_pdu",
          "args": [
            "rec",
            "&buf"
          ],
          "line": 4389
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            "handle_str",
            "\"0x%8.8X\"",
            "rec->handle"
          ],
          "line": 4387
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void store_sdp_record(GKeyFile *key_file, sdp_record_t *rec)\n{\n\tchar handle_str[11];\n\tsdp_buf_t buf;\n\tint size, i;\n\tchar *str;\n\n\tsprintf(handle_str, \"0x%8.8X\", rec->handle);\n\n\tif (sdp_gen_record_pdu(rec, &buf) < 0)\n\t\treturn;\n\n\tsize = buf.data_size;\n\n\tstr = g_malloc0(size*2+1);\n\n\tfor (i = 0; i < size; i++)\n\t\tsprintf(str + (i * 2), \"%02X\", buf.data[i]);\n\n\tg_key_file_set_string(key_file, \"ServiceRecords\", handle_str, str);\n\n\tfree(buf.data);\n\tg_free(str);\n}"
  },
  {
    "function_name": "device_probe_profiles",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "4360-4378",
    "snippet": "void device_probe_profiles(struct btd_device *device, GSList *uuids)\n{\n\tstruct probe_data d = { device, uuids };\n\tchar addr[18];\n\n\tba2str(&device->bdaddr, addr);\n\n\tif (device->blocked) {\n\t\tDBG(\"Skipping profiles for blocked device %s\", addr);\n\t\tgoto add_uuids;\n\t}\n\n\tDBG(\"Probing profiles for device %s\", addr);\n\n\tbtd_profile_foreach(dev_probe, &d);\n\nadd_uuids:\n\tdevice_add_uuids(device, uuids);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "device_add_uuids",
          "args": [
            "device",
            "uuids"
          ],
          "line": 4377
        },
        "resolved": true,
        "details": {
          "function_name": "device_add_uuids",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "3501-3521",
          "snippet": "static void device_add_uuids(struct btd_device *device, GSList *uuids)\n{\n\tGSList *l;\n\tbool changed = false;\n\n\tfor (l = uuids; l != NULL; l = g_slist_next(l)) {\n\t\tGSList *match = g_slist_find_custom(device->uuids, l->data,\n\t\t\t\t\t\t\tbt_uuid_strcmp);\n\t\tif (match)\n\t\t\tcontinue;\n\n\t\tchanged = true;\n\t\tdevice->uuids = g_slist_insert_sorted(device->uuids,\n\t\t\t\t\t\tg_strdup(l->data),\n\t\t\t\t\t\tbt_uuid_strcmp);\n\t}\n\n\tif (changed)\n\t\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"UUIDs\");\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *dbus_conn = NULL;",
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void device_add_uuids(struct btd_device *device, GSList *uuids)\n{\n\tGSList *l;\n\tbool changed = false;\n\n\tfor (l = uuids; l != NULL; l = g_slist_next(l)) {\n\t\tGSList *match = g_slist_find_custom(device->uuids, l->data,\n\t\t\t\t\t\t\tbt_uuid_strcmp);\n\t\tif (match)\n\t\t\tcontinue;\n\n\t\tchanged = true;\n\t\tdevice->uuids = g_slist_insert_sorted(device->uuids,\n\t\t\t\t\t\tg_strdup(l->data),\n\t\t\t\t\t\tbt_uuid_strcmp);\n\t}\n\n\tif (changed)\n\t\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"UUIDs\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_profile_foreach",
          "args": [
            "dev_probe",
            "&d"
          ],
          "line": 4374
        },
        "resolved": true,
        "details": {
          "function_name": "btd_profile_foreach",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
          "lines": "698-718",
          "snippet": "void btd_profile_foreach(void (*func)(struct btd_profile *p, void *data),\n\t\t\t\t\t\t\t\tvoid *data)\n{\n\tGSList *l, *next;\n\n\tfor (l = profiles; l != NULL; l = next) {\n\t\tstruct btd_profile *profile = l->data;\n\n\t\tnext = g_slist_next(l);\n\n\t\tfunc(profile, data);\n\t}\n\n\tfor (l = ext_profiles; l != NULL; l = next) {\n\t\tstruct ext_profile *profile = l->data;\n\n\t\tnext = g_slist_next(l);\n\n\t\tfunc(&profile->p, data);\n\t}\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdp-xml.h\"",
            "#include \"sdp-client.h\"",
            "#include \"dbus-common.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"btio/btio.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static GSList *profiles = NULL;",
            "static GSList *ext_profiles = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic GSList *profiles = NULL;\nstatic GSList *ext_profiles = NULL;\n\nvoid btd_profile_foreach(void (*func)(struct btd_profile *p, void *data),\n\t\t\t\t\t\t\t\tvoid *data)\n{\n\tGSList *l, *next;\n\n\tfor (l = profiles; l != NULL; l = next) {\n\t\tstruct btd_profile *profile = l->data;\n\n\t\tnext = g_slist_next(l);\n\n\t\tfunc(profile, data);\n\t}\n\n\tfor (l = ext_profiles; l != NULL; l = next) {\n\t\tstruct ext_profile *profile = l->data;\n\n\t\tnext = g_slist_next(l);\n\n\t\tfunc(&profile->p, data);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Probing profiles for device %s\"",
            "addr"
          ],
          "line": 4372
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Skipping profiles for blocked device %s\"",
            "addr"
          ],
          "line": 4368
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ba2str",
          "args": [
            "&device->bdaddr",
            "addr"
          ],
          "line": 4365
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid device_probe_profiles(struct btd_device *device, GSList *uuids)\n{\n\tstruct probe_data d = { device, uuids };\n\tchar addr[18];\n\n\tba2str(&device->bdaddr, addr);\n\n\tif (device->blocked) {\n\t\tDBG(\"Skipping profiles for blocked device %s\", addr);\n\t\tgoto add_uuids;\n\t}\n\n\tDBG(\"Probing profiles for device %s\", addr);\n\n\tbtd_profile_foreach(dev_probe, &d);\n\nadd_uuids:\n\tdevice_add_uuids(device, uuids);\n}"
  },
  {
    "function_name": "device_remove_profile",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "4343-4358",
    "snippet": "void device_remove_profile(gpointer a, gpointer b)\n{\n\tstruct btd_device *device = a;\n\tstruct btd_profile *profile = b;\n\tstruct btd_service *service;\n\tGSList *l;\n\n\tl = find_service_with_profile(device->services, profile);\n\tif (l == NULL)\n\t\treturn;\n\n\tservice = l->data;\n\tdevice->services = g_slist_delete_link(device->services, l);\n\tdevice->pending = g_slist_remove(device->pending, service);\n\tservice_remove(service);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "service_remove",
          "args": [
            "service"
          ],
          "line": 4357
        },
        "resolved": true,
        "details": {
          "function_name": "btd_service_remove_state_cb",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
          "lines": "356-371",
          "snippet": "bool btd_service_remove_state_cb(unsigned int id)\n{\n\tGSList *l;\n\n\tfor (l = state_callbacks; l != NULL; l = g_slist_next(l)) {\n\t\tstruct service_state_callback *cb = l->data;\n\n\t\tif (cb && cb->id == id) {\n\t\t\tstate_callbacks = g_slist_remove(state_callbacks, cb);\n\t\t\tg_free(cb);\n\t\t\treturn true;\n\t\t}\n\t}\n\n\treturn false;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/stat.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static GSList *state_callbacks = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic GSList *state_callbacks = NULL;\n\nbool btd_service_remove_state_cb(unsigned int id)\n{\n\tGSList *l;\n\n\tfor (l = state_callbacks; l != NULL; l = g_slist_next(l)) {\n\t\tstruct service_state_callback *cb = l->data;\n\n\t\tif (cb && cb->id == id) {\n\t\t\tstate_callbacks = g_slist_remove(state_callbacks, cb);\n\t\t\tg_free(cb);\n\t\t\treturn true;\n\t\t}\n\t}\n\n\treturn false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_slist_remove",
          "args": [
            "device->pending",
            "service"
          ],
          "line": 4356
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_delete_link",
          "args": [
            "device->services",
            "l"
          ],
          "line": 4355
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "find_service_with_profile",
          "args": [
            "device->services",
            "profile"
          ],
          "line": 4350
        },
        "resolved": true,
        "details": {
          "function_name": "find_service_with_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "284-296",
          "snippet": "static GSList *find_service_with_profile(GSList *list, struct btd_profile *p)\n{\n\tGSList *l;\n\n\tfor (l = list; l != NULL; l = g_slist_next(l)) {\n\t\tstruct btd_service *service = l->data;\n\n\t\tif (btd_service_get_profile(service) == p)\n\t\t\treturn l;\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic GSList *find_service_with_profile(GSList *list, struct btd_profile *p)\n{\n\tGSList *l;\n\n\tfor (l = list; l != NULL; l = g_slist_next(l)) {\n\t\tstruct btd_service *service = l->data;\n\n\t\tif (btd_service_get_profile(service) == p)\n\t\t\treturn l;\n\t}\n\n\treturn NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid device_remove_profile(gpointer a, gpointer b)\n{\n\tstruct btd_device *device = a;\n\tstruct btd_profile *profile = b;\n\tstruct btd_service *service;\n\tGSList *l;\n\n\tl = find_service_with_profile(device->services, profile);\n\tif (l == NULL)\n\t\treturn;\n\n\tservice = l->data;\n\tdevice->services = g_slist_delete_link(device->services, l);\n\tdevice->pending = g_slist_remove(device->pending, service);\n\tservice_remove(service);\n}"
  },
  {
    "function_name": "device_probe_profile",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "4322-4341",
    "snippet": "void device_probe_profile(gpointer a, gpointer b)\n{\n\tstruct btd_device *device = a;\n\tstruct btd_profile *profile = b;\n\tstruct btd_service *service;\n\n\tservice = probe_service(device, profile, device->uuids);\n\tif (!service)\n\t\treturn;\n\n\tdevice->services = g_slist_append(device->services, service);\n\n\tif (!profile->auto_connect || !device->general_connect)\n\t\treturn;\n\n\tdevice->pending = g_slist_append(device->pending, service);\n\n\tif (g_slist_length(device->pending) == 1)\n\t\tconnect_next(device);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "connect_next",
          "args": [
            "device"
          ],
          "line": 4340
        },
        "resolved": true,
        "details": {
          "function_name": "connect_next",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "1561-1577",
          "snippet": "static int connect_next(struct btd_device *dev)\n{\n\tstruct btd_service *service;\n\tint err = -ENOENT;\n\n\twhile (dev->pending) {\n\t\tservice = dev->pending->data;\n\n\t\terr = btd_service_connect(service);\n\t\tif (!err)\n\t\t\treturn 0;\n\n\t\tdev->pending = g_slist_delete_link(dev->pending, dev->pending);\n\t}\n\n\treturn err;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int connect_next(struct btd_device *dev)\n{\n\tstruct btd_service *service;\n\tint err = -ENOENT;\n\n\twhile (dev->pending) {\n\t\tservice = dev->pending->data;\n\n\t\terr = btd_service_connect(service);\n\t\tif (!err)\n\t\t\treturn 0;\n\n\t\tdev->pending = g_slist_delete_link(dev->pending, dev->pending);\n\t}\n\n\treturn err;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_slist_length",
          "args": [
            "device->pending"
          ],
          "line": 4339
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_append",
          "args": [
            "device->pending",
            "service"
          ],
          "line": 4337
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_append",
          "args": [
            "device->services",
            "service"
          ],
          "line": 4332
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "probe_service",
          "args": [
            "device",
            "profile",
            "device->uuids"
          ],
          "line": 4328
        },
        "resolved": true,
        "details": {
          "function_name": "probe_service",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "4277-4308",
          "snippet": "static struct btd_service *probe_service(struct btd_device *device,\n\t\t\t\t\t\tstruct btd_profile *profile,\n\t\t\t\t\t\tGSList *uuids)\n{\n\tGSList *l;\n\tstruct btd_service *service;\n\n\tif (profile->device_probe == NULL)\n\t\treturn NULL;\n\n\tif (!device_match_profile(device, profile, uuids))\n\t\treturn NULL;\n\n\tl = find_service_with_profile(device->services, profile);\n\tif (l)\n\t\treturn l->data;\n\n\tservice = service_create(device, profile);\n\n\tif (service_probe(service)) {\n\t\tbtd_service_unref(service);\n\t\treturn NULL;\n\t}\n\n\t/* Only set auto connect if profile has set the flag and can really\n\t * accept connections.\n\t */\n\tif (profile->auto_connect && profile->accept)\n\t\tdevice_set_auto_connect(device, TRUE);\n\n\treturn service;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic struct btd_service *probe_service(struct btd_device *device,\n\t\t\t\t\t\tstruct btd_profile *profile,\n\t\t\t\t\t\tGSList *uuids)\n{\n\tGSList *l;\n\tstruct btd_service *service;\n\n\tif (profile->device_probe == NULL)\n\t\treturn NULL;\n\n\tif (!device_match_profile(device, profile, uuids))\n\t\treturn NULL;\n\n\tl = find_service_with_profile(device->services, profile);\n\tif (l)\n\t\treturn l->data;\n\n\tservice = service_create(device, profile);\n\n\tif (service_probe(service)) {\n\t\tbtd_service_unref(service);\n\t\treturn NULL;\n\t}\n\n\t/* Only set auto connect if profile has set the flag and can really\n\t * accept connections.\n\t */\n\tif (profile->auto_connect && profile->accept)\n\t\tdevice_set_auto_connect(device, TRUE);\n\n\treturn service;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid device_probe_profile(gpointer a, gpointer b)\n{\n\tstruct btd_device *device = a;\n\tstruct btd_profile *profile = b;\n\tstruct btd_service *service;\n\n\tservice = probe_service(device, profile, device->uuids);\n\tif (!service)\n\t\treturn;\n\n\tdevice->services = g_slist_append(device->services, service);\n\n\tif (!profile->auto_connect || !device->general_connect)\n\t\treturn;\n\n\tdevice->pending = g_slist_append(device->pending, service);\n\n\tif (g_slist_length(device->pending) == 1)\n\t\tconnect_next(device);\n}"
  },
  {
    "function_name": "dev_probe",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "4310-4320",
    "snippet": "static void dev_probe(struct btd_profile *p, void *user_data)\n{\n\tstruct probe_data *d = user_data;\n\tstruct btd_service *service;\n\n\tservice = probe_service(d->dev, p, d->uuids);\n\tif (!service)\n\t\treturn;\n\n\td->dev->services = g_slist_append(d->dev->services, service);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_slist_append",
          "args": [
            "d->dev->services",
            "service"
          ],
          "line": 4319
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "probe_service",
          "args": [
            "d->dev",
            "p",
            "d->uuids"
          ],
          "line": 4315
        },
        "resolved": true,
        "details": {
          "function_name": "probe_service",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "4277-4308",
          "snippet": "static struct btd_service *probe_service(struct btd_device *device,\n\t\t\t\t\t\tstruct btd_profile *profile,\n\t\t\t\t\t\tGSList *uuids)\n{\n\tGSList *l;\n\tstruct btd_service *service;\n\n\tif (profile->device_probe == NULL)\n\t\treturn NULL;\n\n\tif (!device_match_profile(device, profile, uuids))\n\t\treturn NULL;\n\n\tl = find_service_with_profile(device->services, profile);\n\tif (l)\n\t\treturn l->data;\n\n\tservice = service_create(device, profile);\n\n\tif (service_probe(service)) {\n\t\tbtd_service_unref(service);\n\t\treturn NULL;\n\t}\n\n\t/* Only set auto connect if profile has set the flag and can really\n\t * accept connections.\n\t */\n\tif (profile->auto_connect && profile->accept)\n\t\tdevice_set_auto_connect(device, TRUE);\n\n\treturn service;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic struct btd_service *probe_service(struct btd_device *device,\n\t\t\t\t\t\tstruct btd_profile *profile,\n\t\t\t\t\t\tGSList *uuids)\n{\n\tGSList *l;\n\tstruct btd_service *service;\n\n\tif (profile->device_probe == NULL)\n\t\treturn NULL;\n\n\tif (!device_match_profile(device, profile, uuids))\n\t\treturn NULL;\n\n\tl = find_service_with_profile(device->services, profile);\n\tif (l)\n\t\treturn l->data;\n\n\tservice = service_create(device, profile);\n\n\tif (service_probe(service)) {\n\t\tbtd_service_unref(service);\n\t\treturn NULL;\n\t}\n\n\t/* Only set auto connect if profile has set the flag and can really\n\t * accept connections.\n\t */\n\tif (profile->auto_connect && profile->accept)\n\t\tdevice_set_auto_connect(device, TRUE);\n\n\treturn service;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void dev_probe(struct btd_profile *p, void *user_data)\n{\n\tstruct probe_data *d = user_data;\n\tstruct btd_service *service;\n\n\tservice = probe_service(d->dev, p, d->uuids);\n\tif (!service)\n\t\treturn;\n\n\td->dev->services = g_slist_append(d->dev->services, service);\n}"
  },
  {
    "function_name": "probe_service",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "4277-4308",
    "snippet": "static struct btd_service *probe_service(struct btd_device *device,\n\t\t\t\t\t\tstruct btd_profile *profile,\n\t\t\t\t\t\tGSList *uuids)\n{\n\tGSList *l;\n\tstruct btd_service *service;\n\n\tif (profile->device_probe == NULL)\n\t\treturn NULL;\n\n\tif (!device_match_profile(device, profile, uuids))\n\t\treturn NULL;\n\n\tl = find_service_with_profile(device->services, profile);\n\tif (l)\n\t\treturn l->data;\n\n\tservice = service_create(device, profile);\n\n\tif (service_probe(service)) {\n\t\tbtd_service_unref(service);\n\t\treturn NULL;\n\t}\n\n\t/* Only set auto connect if profile has set the flag and can really\n\t * accept connections.\n\t */\n\tif (profile->auto_connect && profile->accept)\n\t\tdevice_set_auto_connect(device, TRUE);\n\n\treturn service;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "device_set_auto_connect",
          "args": [
            "device",
            "TRUE"
          ],
          "line": 4305
        },
        "resolved": true,
        "details": {
          "function_name": "device_set_auto_connect",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "1508-1540",
          "snippet": "static void device_set_auto_connect(struct btd_device *device, gboolean enable)\n{\n\tchar addr[18];\n\n\tif (!device || !device->le)\n\t\treturn;\n\n\tba2str(&device->bdaddr, addr);\n\n\tDBG(\"%s auto connect: %d\", addr, enable);\n\n\tif (device->auto_connect == enable)\n\t\treturn;\n\n\tdevice->auto_connect = enable;\n\n\t/* Disabling auto connect */\n\tif (enable == FALSE) {\n\t\tadapter_connect_list_remove(device->adapter, device);\n\t\tadapter_auto_connect_remove(device->adapter, device);\n\t\treturn;\n\t}\n\n\t/* Enabling auto connect */\n\tadapter_auto_connect_add(device->adapter, device);\n\n\tif (device->attrib) {\n\t\tDBG(\"Already connected\");\n\t\treturn;\n\t}\n\n\tadapter_connect_list_add(device->adapter, device);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void device_set_auto_connect(struct btd_device *device, gboolean enable)\n{\n\tchar addr[18];\n\n\tif (!device || !device->le)\n\t\treturn;\n\n\tba2str(&device->bdaddr, addr);\n\n\tDBG(\"%s auto connect: %d\", addr, enable);\n\n\tif (device->auto_connect == enable)\n\t\treturn;\n\n\tdevice->auto_connect = enable;\n\n\t/* Disabling auto connect */\n\tif (enable == FALSE) {\n\t\tadapter_connect_list_remove(device->adapter, device);\n\t\tadapter_auto_connect_remove(device->adapter, device);\n\t\treturn;\n\t}\n\n\t/* Enabling auto connect */\n\tadapter_auto_connect_add(device->adapter, device);\n\n\tif (device->attrib) {\n\t\tDBG(\"Already connected\");\n\t\treturn;\n\t}\n\n\tadapter_connect_list_add(device->adapter, device);\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_service_unref",
          "args": [
            "service"
          ],
          "line": 4297
        },
        "resolved": true,
        "details": {
          "function_name": "btd_service_unref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
          "lines": "122-132",
          "snippet": "void btd_service_unref(struct btd_service *service)\n{\n\tservice->ref--;\n\n\tDBG(\"%p: ref=%d\", service, service->ref);\n\n\tif (service->ref > 0)\n\t\treturn;\n\n\tg_free(service);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/stat.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid btd_service_unref(struct btd_service *service)\n{\n\tservice->ref--;\n\n\tDBG(\"%p: ref=%d\", service, service->ref);\n\n\tif (service->ref > 0)\n\t\treturn;\n\n\tg_free(service);\n}"
        }
      },
      {
        "call_info": {
          "callee": "service_probe",
          "args": [
            "service"
          ],
          "line": 4296
        },
        "resolved": true,
        "details": {
          "function_name": "service_probe",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
          "lines": "153-170",
          "snippet": "int service_probe(struct btd_service *service)\n{\n\tchar addr[18];\n\tint err;\n\n\tbtd_assert(service->state == BTD_SERVICE_STATE_UNAVAILABLE);\n\n\terr = service->profile->device_probe(service);\n\tif (err == 0) {\n\t\tchange_state(service, BTD_SERVICE_STATE_DISCONNECTED, 0);\n\t\treturn 0;\n\t}\n\n\tba2str(device_get_address(service->device), addr);\n\terror(\"%s profile probe failed for %s\", service->profile->name, addr);\n\n\treturn err;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/stat.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nint service_probe(struct btd_service *service)\n{\n\tchar addr[18];\n\tint err;\n\n\tbtd_assert(service->state == BTD_SERVICE_STATE_UNAVAILABLE);\n\n\terr = service->profile->device_probe(service);\n\tif (err == 0) {\n\t\tchange_state(service, BTD_SERVICE_STATE_DISCONNECTED, 0);\n\t\treturn 0;\n\t}\n\n\tba2str(device_get_address(service->device), addr);\n\terror(\"%s profile probe failed for %s\", service->profile->name, addr);\n\n\treturn err;\n}"
        }
      },
      {
        "call_info": {
          "callee": "service_create",
          "args": [
            "device",
            "profile"
          ],
          "line": 4294
        },
        "resolved": true,
        "details": {
          "function_name": "service_create",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "1828-1872",
          "snippet": "static struct service *service_create(struct gatt_db_attribute *attr,\n\t\t\t\t\t\tstruct btd_gatt_client *client)\n{\n\tstruct service *service;\n\tconst char *device_path = device_get_path(client->device);\n\tbt_uuid_t uuid;\n\n\tservice = new0(struct service, 1);\n\tservice->chrcs = queue_new();\n\tservice->incl_services = queue_new();\n\tservice->client = client;\n\n\tgatt_db_attribute_get_service_data(attr, &service->start_handle,\n\t\t\t\t\t\t\t&service->end_handle,\n\t\t\t\t\t\t\t&service->primary,\n\t\t\t\t\t\t\t&uuid);\n\tbt_uuid_to_uuid128(&uuid, &service->uuid);\n\n\tservice->path = g_strdup_printf(\"%s/service%04x\", device_path,\n\t\t\t\t\t\t\tservice->start_handle);\n\n\tif (!g_dbus_register_interface(btd_get_dbus_connection(), service->path,\n\t\t\t\t\t\tGATT_SERVICE_IFACE,\n\t\t\t\t\t\tNULL, NULL,\n\t\t\t\t\t\tservice_properties,\n\t\t\t\t\t\tservice, service_free)) {\n\t\terror(\"Unable to register GATT service with handle 0x%04x for \"\n\t\t\t\t\t\t\t\"device %s\",\n\t\t\t\t\t\t\tservice->start_handle,\n\t\t\t\t\t\t\tclient->devaddr);\n\t\tservice_free(service);\n\n\t\treturn NULL;\n\t}\n\n\tDBG(\"Exported GATT service: %s\", service->path);\n\n\t/* Set service active so we can skip discovering next time */\n\tgatt_db_service_set_active(attr, true);\n\n\t/* Mark the service as claimed since it going to be exported */\n\tgatt_db_service_set_claimed(attr, true);\n\n\treturn service;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define GATT_SERVICE_IFACE\t\t\"org.bluez.GattService1\""
          ],
          "globals_used": [
            "static const GDBusPropertyTable service_properties[] = {\n\t{ \"UUID\", \"s\", service_get_uuid },\n\t{ \"Device\", \"o\", service_get_device },\n\t{ \"Primary\", \"b\", service_get_primary },\n\t{ \"Includes\", \"ao\", service_get_includes },\n\t{ }\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\n#define GATT_SERVICE_IFACE\t\t\"org.bluez.GattService1\"\n\nstatic const GDBusPropertyTable service_properties[] = {\n\t{ \"UUID\", \"s\", service_get_uuid },\n\t{ \"Device\", \"o\", service_get_device },\n\t{ \"Primary\", \"b\", service_get_primary },\n\t{ \"Includes\", \"ao\", service_get_includes },\n\t{ }\n};\n\nstatic struct service *service_create(struct gatt_db_attribute *attr,\n\t\t\t\t\t\tstruct btd_gatt_client *client)\n{\n\tstruct service *service;\n\tconst char *device_path = device_get_path(client->device);\n\tbt_uuid_t uuid;\n\n\tservice = new0(struct service, 1);\n\tservice->chrcs = queue_new();\n\tservice->incl_services = queue_new();\n\tservice->client = client;\n\n\tgatt_db_attribute_get_service_data(attr, &service->start_handle,\n\t\t\t\t\t\t\t&service->end_handle,\n\t\t\t\t\t\t\t&service->primary,\n\t\t\t\t\t\t\t&uuid);\n\tbt_uuid_to_uuid128(&uuid, &service->uuid);\n\n\tservice->path = g_strdup_printf(\"%s/service%04x\", device_path,\n\t\t\t\t\t\t\tservice->start_handle);\n\n\tif (!g_dbus_register_interface(btd_get_dbus_connection(), service->path,\n\t\t\t\t\t\tGATT_SERVICE_IFACE,\n\t\t\t\t\t\tNULL, NULL,\n\t\t\t\t\t\tservice_properties,\n\t\t\t\t\t\tservice, service_free)) {\n\t\terror(\"Unable to register GATT service with handle 0x%04x for \"\n\t\t\t\t\t\t\t\"device %s\",\n\t\t\t\t\t\t\tservice->start_handle,\n\t\t\t\t\t\t\tclient->devaddr);\n\t\tservice_free(service);\n\n\t\treturn NULL;\n\t}\n\n\tDBG(\"Exported GATT service: %s\", service->path);\n\n\t/* Set service active so we can skip discovering next time */\n\tgatt_db_service_set_active(attr, true);\n\n\t/* Mark the service as claimed since it going to be exported */\n\tgatt_db_service_set_claimed(attr, true);\n\n\treturn service;\n}"
        }
      },
      {
        "call_info": {
          "callee": "find_service_with_profile",
          "args": [
            "device->services",
            "profile"
          ],
          "line": 4290
        },
        "resolved": true,
        "details": {
          "function_name": "find_service_with_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "284-296",
          "snippet": "static GSList *find_service_with_profile(GSList *list, struct btd_profile *p)\n{\n\tGSList *l;\n\n\tfor (l = list; l != NULL; l = g_slist_next(l)) {\n\t\tstruct btd_service *service = l->data;\n\n\t\tif (btd_service_get_profile(service) == p)\n\t\t\treturn l;\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic GSList *find_service_with_profile(GSList *list, struct btd_profile *p)\n{\n\tGSList *l;\n\n\tfor (l = list; l != NULL; l = g_slist_next(l)) {\n\t\tstruct btd_service *service = l->data;\n\n\t\tif (btd_service_get_profile(service) == p)\n\t\t\treturn l;\n\t}\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "device_match_profile",
          "args": [
            "device",
            "profile",
            "uuids"
          ],
          "line": 4287
        },
        "resolved": true,
        "details": {
          "function_name": "device_match_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "3523-3535",
          "snippet": "static bool device_match_profile(struct btd_device *device,\n\t\t\t\t\tstruct btd_profile *profile,\n\t\t\t\t\tGSList *uuids)\n{\n\tif (profile->remote_uuid == NULL)\n\t\treturn false;\n\n\tif (g_slist_find_custom(uuids, profile->remote_uuid,\n\t\t\t\t\t\t\tbt_uuid_strcmp) == NULL)\n\t\treturn false;\n\n\treturn true;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic bool device_match_profile(struct btd_device *device,\n\t\t\t\t\tstruct btd_profile *profile,\n\t\t\t\t\tGSList *uuids)\n{\n\tif (profile->remote_uuid == NULL)\n\t\treturn false;\n\n\tif (g_slist_find_custom(uuids, profile->remote_uuid,\n\t\t\t\t\t\t\tbt_uuid_strcmp) == NULL)\n\t\treturn false;\n\n\treturn true;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic struct btd_service *probe_service(struct btd_device *device,\n\t\t\t\t\t\tstruct btd_profile *profile,\n\t\t\t\t\t\tGSList *uuids)\n{\n\tGSList *l;\n\tstruct btd_service *service;\n\n\tif (profile->device_probe == NULL)\n\t\treturn NULL;\n\n\tif (!device_match_profile(device, profile, uuids))\n\t\treturn NULL;\n\n\tl = find_service_with_profile(device->services, profile);\n\tif (l)\n\t\treturn l->data;\n\n\tservice = service_create(device, profile);\n\n\tif (service_probe(service)) {\n\t\tbtd_service_unref(service);\n\t\treturn NULL;\n\t}\n\n\t/* Only set auto connect if profile has set the flag and can really\n\t * accept connections.\n\t */\n\tif (profile->auto_connect && profile->accept)\n\t\tdevice_set_auto_connect(device, TRUE);\n\n\treturn service;\n}"
  },
  {
    "function_name": "btd_device_get_uuids",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "4267-4270",
    "snippet": "GSList *btd_device_get_uuids(struct btd_device *device)\n{\n\treturn device->uuids;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nGSList *btd_device_get_uuids(struct btd_device *device)\n{\n\treturn device->uuids;\n}"
  },
  {
    "function_name": "record_has_uuid",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "4243-4265",
    "snippet": "static gboolean record_has_uuid(const sdp_record_t *rec,\n\t\t\t\tconst char *profile_uuid)\n{\n\tsdp_list_t *pat;\n\n\tfor (pat = rec->pattern; pat != NULL; pat = pat->next) {\n\t\tchar *uuid;\n\t\tint ret;\n\n\t\tuuid = bt_uuid2string(pat->data);\n\t\tif (!uuid)\n\t\t\tcontinue;\n\n\t\tret = strcasecmp(uuid, profile_uuid);\n\n\t\tfree(uuid);\n\n\t\tif (ret == 0)\n\t\t\treturn TRUE;\n\t}\n\n\treturn FALSE;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "uuid"
          ],
          "line": 4258
        },
        "resolved": true,
        "details": {
          "function_name": "device_auth_req_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5662-5676",
          "snippet": "static void device_auth_req_free(struct btd_device *device)\n{\n\tstruct authentication_req *authr = device->authr;\n\n\tif (!authr)\n\t\treturn;\n\n\tif (authr->agent)\n\t\tagent_unref(authr->agent);\n\n\tg_free(authr->pincode);\n\tg_free(authr);\n\n\tdevice->authr = NULL;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void device_auth_req_free(struct btd_device *device)\n{\n\tstruct authentication_req *authr = device->authr;\n\n\tif (!authr)\n\t\treturn;\n\n\tif (authr->agent)\n\t\tagent_unref(authr->agent);\n\n\tg_free(authr->pincode);\n\tg_free(authr);\n\n\tdevice->authr = NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strcasecmp",
          "args": [
            "uuid",
            "profile_uuid"
          ],
          "line": 4256
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_uuid2string",
          "args": [
            "pat->data"
          ],
          "line": 4252
        },
        "resolved": true,
        "details": {
          "function_name": "bt_uuid2string",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/uuid-helper.c",
          "lines": "65-110",
          "snippet": "char *bt_uuid2string(uuid_t *uuid)\n{\n\tchar *str;\n\tuuid_t uuid128;\n\tunsigned int data0;\n\tunsigned short data1;\n\tunsigned short data2;\n\tunsigned short data3;\n\tunsigned int data4;\n\tunsigned short data5;\n\tint err;\n\n\tif (!uuid)\n\t\treturn NULL;\n\n\tswitch (uuid->type) {\n\tcase SDP_UUID16:\n\t\tsdp_uuid16_to_uuid128(&uuid128, uuid);\n\t\tbreak;\n\tcase SDP_UUID32:\n\t\tsdp_uuid32_to_uuid128(&uuid128, uuid);\n\t\tbreak;\n\tcase SDP_UUID128:\n\t\tmemcpy(&uuid128, uuid, sizeof(uuid_t));\n\t\tbreak;\n\tdefault:\n\t\t/* Type of UUID unknown */\n\t\treturn NULL;\n\t}\n\n\tmemcpy(&data0, &uuid128.value.uuid128.data[0], 4);\n\tmemcpy(&data1, &uuid128.value.uuid128.data[4], 2);\n\tmemcpy(&data2, &uuid128.value.uuid128.data[6], 2);\n\tmemcpy(&data3, &uuid128.value.uuid128.data[8], 2);\n\tmemcpy(&data4, &uuid128.value.uuid128.data[10], 4);\n\tmemcpy(&data5, &uuid128.value.uuid128.data[14], 2);\n\n\terr = asprintf(&str, \"%.8x-%.4x-%.4x-%.4x-%.8x%.4x\",\n\t\t\tntohl(data0), ntohs(data1),\n\t\t\tntohs(data2), ntohs(data3),\n\t\t\tntohl(data4), ntohs(data5));\n\tif (err < 0)\n\t\treturn NULL;\n\n\treturn str;\n}",
          "includes": [
            "#include \"uuid-helper.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <arpa/inet.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"uuid-helper.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <arpa/inet.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *bt_uuid2string(uuid_t *uuid)\n{\n\tchar *str;\n\tuuid_t uuid128;\n\tunsigned int data0;\n\tunsigned short data1;\n\tunsigned short data2;\n\tunsigned short data3;\n\tunsigned int data4;\n\tunsigned short data5;\n\tint err;\n\n\tif (!uuid)\n\t\treturn NULL;\n\n\tswitch (uuid->type) {\n\tcase SDP_UUID16:\n\t\tsdp_uuid16_to_uuid128(&uuid128, uuid);\n\t\tbreak;\n\tcase SDP_UUID32:\n\t\tsdp_uuid32_to_uuid128(&uuid128, uuid);\n\t\tbreak;\n\tcase SDP_UUID128:\n\t\tmemcpy(&uuid128, uuid, sizeof(uuid_t));\n\t\tbreak;\n\tdefault:\n\t\t/* Type of UUID unknown */\n\t\treturn NULL;\n\t}\n\n\tmemcpy(&data0, &uuid128.value.uuid128.data[0], 4);\n\tmemcpy(&data1, &uuid128.value.uuid128.data[4], 2);\n\tmemcpy(&data2, &uuid128.value.uuid128.data[6], 2);\n\tmemcpy(&data3, &uuid128.value.uuid128.data[8], 2);\n\tmemcpy(&data4, &uuid128.value.uuid128.data[10], 4);\n\tmemcpy(&data5, &uuid128.value.uuid128.data[14], 2);\n\n\terr = asprintf(&str, \"%.8x-%.4x-%.4x-%.4x-%.8x%.4x\",\n\t\t\tntohl(data0), ntohs(data1),\n\t\t\tntohs(data2), ntohs(data3),\n\t\t\tntohl(data4), ntohs(data5));\n\tif (err < 0)\n\t\treturn NULL;\n\n\treturn str;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic gboolean record_has_uuid(const sdp_record_t *rec,\n\t\t\t\tconst char *profile_uuid)\n{\n\tsdp_list_t *pat;\n\n\tfor (pat = rec->pattern; pat != NULL; pat = pat->next) {\n\t\tchar *uuid;\n\t\tint ret;\n\n\t\tuuid = bt_uuid2string(pat->data);\n\t\tif (!uuid)\n\t\t\tcontinue;\n\n\t\tret = strcasecmp(uuid, profile_uuid);\n\n\t\tfree(uuid);\n\n\t\tif (ret == 0)\n\t\t\treturn TRUE;\n\t}\n\n\treturn FALSE;\n}"
  },
  {
    "function_name": "device_addr_type_cmp",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "4207-4241",
    "snippet": "int device_addr_type_cmp(gconstpointer a, gconstpointer b)\n{\n\tconst struct btd_device *dev = a;\n\tconst struct device_addr_type *addr = b;\n\tint cmp;\n\n\tcmp = bacmp(&dev->bdaddr, &addr->bdaddr);\n\n\t/*\n\t * Address matches and both old and new are public addresses\n\t * (doesn't matter whether LE or BR/EDR, then consider this a\n\t * match.\n\t */\n\tif (!cmp && addr_is_public(addr->bdaddr_type) &&\n\t\t\t\t\taddr_is_public(dev->bdaddr_type))\n\t\treturn 0;\n\n\tif (addr->bdaddr_type == BDADDR_BREDR) {\n\t\tif (!dev->bredr)\n\t\t\treturn -1;\n\n\t\treturn cmp;\n\t}\n\n\tif (!dev->le)\n\t\treturn -1;\n\n\tif (addr->bdaddr_type != dev->bdaddr_type) {\n\t\tif (addr->bdaddr_type == dev->conn_bdaddr_type)\n\t\t\treturn bacmp(&dev->conn_bdaddr, &addr->bdaddr);\n\t\treturn -1;\n\t}\n\n\treturn cmp;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bacmp",
          "args": [
            "&dev->conn_bdaddr",
            "&addr->bdaddr"
          ],
          "line": 4236
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "addr_is_public",
          "args": [
            "dev->bdaddr_type"
          ],
          "line": 4221
        },
        "resolved": true,
        "details": {
          "function_name": "addr_is_public",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "4199-4205",
          "snippet": "static bool addr_is_public(uint8_t addr_type)\n{\n\tif (addr_type == BDADDR_BREDR || addr_type == BDADDR_LE_PUBLIC)\n\t\treturn true;\n\n\treturn false;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic bool addr_is_public(uint8_t addr_type)\n{\n\tif (addr_type == BDADDR_BREDR || addr_type == BDADDR_LE_PUBLIC)\n\t\treturn true;\n\n\treturn false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bacmp",
          "args": [
            "&dev->bdaddr",
            "&addr->bdaddr"
          ],
          "line": 4213
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nint device_addr_type_cmp(gconstpointer a, gconstpointer b)\n{\n\tconst struct btd_device *dev = a;\n\tconst struct device_addr_type *addr = b;\n\tint cmp;\n\n\tcmp = bacmp(&dev->bdaddr, &addr->bdaddr);\n\n\t/*\n\t * Address matches and both old and new are public addresses\n\t * (doesn't matter whether LE or BR/EDR, then consider this a\n\t * match.\n\t */\n\tif (!cmp && addr_is_public(addr->bdaddr_type) &&\n\t\t\t\t\taddr_is_public(dev->bdaddr_type))\n\t\treturn 0;\n\n\tif (addr->bdaddr_type == BDADDR_BREDR) {\n\t\tif (!dev->bredr)\n\t\t\treturn -1;\n\n\t\treturn cmp;\n\t}\n\n\tif (!dev->le)\n\t\treturn -1;\n\n\tif (addr->bdaddr_type != dev->bdaddr_type) {\n\t\tif (addr->bdaddr_type == dev->conn_bdaddr_type)\n\t\t\treturn bacmp(&dev->conn_bdaddr, &addr->bdaddr);\n\t\treturn -1;\n\t}\n\n\treturn cmp;\n}"
  },
  {
    "function_name": "addr_is_public",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "4199-4205",
    "snippet": "static bool addr_is_public(uint8_t addr_type)\n{\n\tif (addr_type == BDADDR_BREDR || addr_type == BDADDR_LE_PUBLIC)\n\t\treturn true;\n\n\treturn false;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic bool addr_is_public(uint8_t addr_type)\n{\n\tif (addr_type == BDADDR_BREDR || addr_type == BDADDR_LE_PUBLIC)\n\t\treturn true;\n\n\treturn false;\n}"
  },
  {
    "function_name": "device_bdaddr_cmp",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "4191-4197",
    "snippet": "int device_bdaddr_cmp(gconstpointer a, gconstpointer b)\n{\n\tconst struct btd_device *device = a;\n\tconst bdaddr_t *bdaddr = b;\n\n\treturn bacmp(&device->bdaddr, bdaddr);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "bacmp",
          "args": [
            "&device->bdaddr",
            "bdaddr"
          ],
          "line": 4196
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nint device_bdaddr_cmp(gconstpointer a, gconstpointer b)\n{\n\tconst struct btd_device *device = a;\n\tconst bdaddr_t *bdaddr = b;\n\n\treturn bacmp(&device->bdaddr, bdaddr);\n}"
  },
  {
    "function_name": "device_address_cmp",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "4181-4189",
    "snippet": "int device_address_cmp(gconstpointer a, gconstpointer b)\n{\n\tconst struct btd_device *device = a;\n\tconst char *address = b;\n\tchar addr[18];\n\n\tba2str(&device->bdaddr, addr);\n\treturn strcasecmp(addr, address);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "strcasecmp",
          "args": [
            "addr",
            "address"
          ],
          "line": 4188
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ba2str",
          "args": [
            "&device->bdaddr",
            "addr"
          ],
          "line": 4187
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nint device_address_cmp(gconstpointer a, gconstpointer b)\n{\n\tconst struct btd_device *device = a;\n\tconst char *address = b;\n\tchar addr[18];\n\n\tba2str(&device->bdaddr, addr);\n\treturn strcasecmp(addr, address);\n}"
  },
  {
    "function_name": "device_remove",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "4133-4179",
    "snippet": "void device_remove(struct btd_device *device, gboolean remove_stored)\n{\n\tDBG(\"Removing device %s\", device->path);\n\n\tif (device->bonding) {\n\t\tuint8_t status;\n\n\t\tif (device->bredr_state.connected)\n\t\t\tstatus = MGMT_STATUS_DISCONNECTED;\n\t\telse\n\t\t\tstatus = MGMT_STATUS_CONNECT_FAILED;\n\n\t\tdevice_cancel_bonding(device, status);\n\t}\n\n\tif (device->browse)\n\t\tbrowse_request_cancel(device->browse);\n\n\twhile (device->services != NULL) {\n\t\tstruct btd_service *service = device->services->data;\n\n\t\tdevice->services = g_slist_remove(device->services, service);\n\t\tservice_remove(service);\n\t}\n\n\tg_slist_free(device->pending);\n\tdevice->pending = NULL;\n\n\tif (btd_device_is_connected(device)) {\n\t\tif (device->disconn_timer > 0)\n\t\t\tg_source_remove(device->disconn_timer);\n\t\tdisconnect_all(device);\n\t}\n\n\tif (device->store_id > 0) {\n\t\tg_source_remove(device->store_id);\n\t\tdevice->store_id = 0;\n\n\t\tif (!remove_stored)\n\t\t\tstore_device_info_cb(device);\n\t}\n\n\tif (remove_stored)\n\t\tdevice_remove_stored(device);\n\n\tbtd_device_unref(device);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "btd_device_unref",
          "args": [
            "device"
          ],
          "line": 4178
        },
        "resolved": true,
        "details": {
          "function_name": "btd_device_unref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "6364-6377",
          "snippet": "void btd_device_unref(struct btd_device *device)\n{\n\tif (__sync_sub_and_fetch(&device->ref_count, 1))\n\t\treturn;\n\n\tif (!device->path) {\n\t\terror(\"freeing device without an object path\");\n\t\treturn;\n\t}\n\n\tDBG(\"Freeing device %s\", device->path);\n\n\tg_dbus_unregister_interface(dbus_conn, device->path, DEVICE_INTERFACE);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *dbus_conn = NULL;",
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid btd_device_unref(struct btd_device *device)\n{\n\tif (__sync_sub_and_fetch(&device->ref_count, 1))\n\t\treturn;\n\n\tif (!device->path) {\n\t\terror(\"freeing device without an object path\");\n\t\treturn;\n\t}\n\n\tDBG(\"Freeing device %s\", device->path);\n\n\tg_dbus_unregister_interface(dbus_conn, device->path, DEVICE_INTERFACE);\n}"
        }
      },
      {
        "call_info": {
          "callee": "device_remove_stored",
          "args": [
            "device"
          ],
          "line": 4176
        },
        "resolved": true,
        "details": {
          "function_name": "device_remove_stored",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "4082-4131",
          "snippet": "static void device_remove_stored(struct btd_device *device)\n{\n\tchar device_addr[18];\n\tchar filename[PATH_MAX];\n\tGKeyFile *key_file;\n\tchar *data;\n\tgsize length = 0;\n\n\tif (device->bredr_state.bonded) {\n\t\tdevice->bredr_state.bonded = false;\n\t\tbtd_adapter_remove_bonding(device->adapter, &device->bdaddr,\n\t\t\t\t\t\t\t\tBDADDR_BREDR);\n\t}\n\n\tif (device->le_state.bonded) {\n\t\tdevice->le_state.bonded = false;\n\t\tbtd_adapter_remove_bonding(device->adapter, &device->bdaddr,\n\t\t\t\t\t\t\tdevice->bdaddr_type);\n\t}\n\n\tdevice->bredr_state.paired = false;\n\tdevice->le_state.paired = false;\n\n\tif (device->blocked)\n\t\tdevice_unblock(device, TRUE, FALSE);\n\n\tba2str(&device->bdaddr, device_addr);\n\n\tsnprintf(filename, PATH_MAX, STORAGEDIR \"/%s/%s\",\n\t\t\t\tbtd_adapter_get_storage_dir(device->adapter),\n\t\t\t\tdevice_addr);\n\tdelete_folder_tree(filename);\n\n\tsnprintf(filename, PATH_MAX, STORAGEDIR \"/%s/cache/%s\",\n\t\t\t\tbtd_adapter_get_storage_dir(device->adapter),\n\t\t\t\tdevice_addr);\n\n\tkey_file = g_key_file_new();\n\tg_key_file_load_from_file(key_file, filename, 0, NULL);\n\tg_key_file_remove_group(key_file, \"ServiceRecords\", NULL);\n\n\tdata = g_key_file_to_data(key_file, &length, NULL);\n\tif (length > 0) {\n\t\tcreate_file(filename, S_IRUSR | S_IWUSR);\n\t\tg_file_set_contents(filename, data, length, NULL);\n\t}\n\n\tg_free(data);\n\tg_key_file_free(key_file);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void device_remove_stored(struct btd_device *device)\n{\n\tchar device_addr[18];\n\tchar filename[PATH_MAX];\n\tGKeyFile *key_file;\n\tchar *data;\n\tgsize length = 0;\n\n\tif (device->bredr_state.bonded) {\n\t\tdevice->bredr_state.bonded = false;\n\t\tbtd_adapter_remove_bonding(device->adapter, &device->bdaddr,\n\t\t\t\t\t\t\t\tBDADDR_BREDR);\n\t}\n\n\tif (device->le_state.bonded) {\n\t\tdevice->le_state.bonded = false;\n\t\tbtd_adapter_remove_bonding(device->adapter, &device->bdaddr,\n\t\t\t\t\t\t\tdevice->bdaddr_type);\n\t}\n\n\tdevice->bredr_state.paired = false;\n\tdevice->le_state.paired = false;\n\n\tif (device->blocked)\n\t\tdevice_unblock(device, TRUE, FALSE);\n\n\tba2str(&device->bdaddr, device_addr);\n\n\tsnprintf(filename, PATH_MAX, STORAGEDIR \"/%s/%s\",\n\t\t\t\tbtd_adapter_get_storage_dir(device->adapter),\n\t\t\t\tdevice_addr);\n\tdelete_folder_tree(filename);\n\n\tsnprintf(filename, PATH_MAX, STORAGEDIR \"/%s/cache/%s\",\n\t\t\t\tbtd_adapter_get_storage_dir(device->adapter),\n\t\t\t\tdevice_addr);\n\n\tkey_file = g_key_file_new();\n\tg_key_file_load_from_file(key_file, filename, 0, NULL);\n\tg_key_file_remove_group(key_file, \"ServiceRecords\", NULL);\n\n\tdata = g_key_file_to_data(key_file, &length, NULL);\n\tif (length > 0) {\n\t\tcreate_file(filename, S_IRUSR | S_IWUSR);\n\t\tg_file_set_contents(filename, data, length, NULL);\n\t}\n\n\tg_free(data);\n\tg_key_file_free(key_file);\n}"
        }
      },
      {
        "call_info": {
          "callee": "store_device_info_cb",
          "args": [
            "device"
          ],
          "line": 4172
        },
        "resolved": true,
        "details": {
          "function_name": "store_device_info_cb",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "366-459",
          "snippet": "static gboolean store_device_info_cb(gpointer user_data)\n{\n\tstruct btd_device *device = user_data;\n\tGKeyFile *key_file;\n\tchar filename[PATH_MAX];\n\tchar device_addr[18];\n\tchar *str;\n\tchar class[9];\n\tchar **uuids = NULL;\n\tgsize length = 0;\n\n\tdevice->store_id = 0;\n\n\tba2str(&device->bdaddr, device_addr);\n\tsnprintf(filename, PATH_MAX, STORAGEDIR \"/%s/%s/info\",\n\t\t\t\tbtd_adapter_get_storage_dir(device->adapter),\n\t\t\t\tdevice_addr);\n\n\tkey_file = g_key_file_new();\n\tg_key_file_load_from_file(key_file, filename, 0, NULL);\n\n\tg_key_file_set_string(key_file, \"General\", \"Name\", device->name);\n\n\tif (device->alias != NULL)\n\t\tg_key_file_set_string(key_file, \"General\", \"Alias\",\n\t\t\t\t\t\t\t\tdevice->alias);\n\telse\n\t\tg_key_file_remove_key(key_file, \"General\", \"Alias\", NULL);\n\n\tif (device->class) {\n\t\tsprintf(class, \"0x%6.6x\", device->class);\n\t\tg_key_file_set_string(key_file, \"General\", \"Class\", class);\n\t} else {\n\t\tg_key_file_remove_key(key_file, \"General\", \"Class\", NULL);\n\t}\n\n\tif (device->appearance) {\n\t\tsprintf(class, \"0x%4.4x\", device->appearance);\n\t\tg_key_file_set_string(key_file, \"General\", \"Appearance\", class);\n\t} else {\n\t\tg_key_file_remove_key(key_file, \"General\", \"Appearance\", NULL);\n\t}\n\n\tupdate_technologies(key_file, device);\n\n\tg_key_file_set_boolean(key_file, \"General\", \"Trusted\",\n\t\t\t\t\t\t\tdevice->trusted);\n\n\tg_key_file_set_boolean(key_file, \"General\", \"Blocked\",\n\t\t\t\t\t\t\tdevice->blocked);\n\n\tif (device->uuids) {\n\t\tGSList *l;\n\t\tint i;\n\n\t\tuuids = g_new0(char *, g_slist_length(device->uuids) + 1);\n\t\tfor (i = 0, l = device->uuids; l; l = g_slist_next(l), i++)\n\t\t\tuuids[i] = l->data;\n\t\tg_key_file_set_string_list(key_file, \"General\", \"Services\",\n\t\t\t\t\t\t(const char **)uuids, i);\n\t} else {\n\t\tg_key_file_remove_key(key_file, \"General\", \"Services\", NULL);\n\t}\n\n\tif (device->vendor_src) {\n\t\tg_key_file_set_integer(key_file, \"DeviceID\", \"Source\",\n\t\t\t\t\tdevice->vendor_src);\n\t\tg_key_file_set_integer(key_file, \"DeviceID\", \"Vendor\",\n\t\t\t\t\tdevice->vendor);\n\t\tg_key_file_set_integer(key_file, \"DeviceID\", \"Product\",\n\t\t\t\t\tdevice->product);\n\t\tg_key_file_set_integer(key_file, \"DeviceID\", \"Version\",\n\t\t\t\t\tdevice->version);\n\t} else {\n\t\tg_key_file_remove_group(key_file, \"DeviceID\", NULL);\n\t}\n\n\tif (device->local_csrk)\n\t\tstore_csrk(device->local_csrk, key_file, \"LocalSignatureKey\");\n\n\tif (device->remote_csrk)\n\t\tstore_csrk(device->remote_csrk, key_file, \"RemoteSignatureKey\");\n\n\tcreate_file(filename, S_IRUSR | S_IWUSR);\n\n\tstr = g_key_file_to_data(key_file, &length, NULL);\n\tg_file_set_contents(filename, str, length, NULL);\n\tg_free(str);\n\n\tg_key_file_free(key_file);\n\tg_free(uuids);\n\n\treturn FALSE;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic gboolean store_device_info_cb(gpointer user_data)\n{\n\tstruct btd_device *device = user_data;\n\tGKeyFile *key_file;\n\tchar filename[PATH_MAX];\n\tchar device_addr[18];\n\tchar *str;\n\tchar class[9];\n\tchar **uuids = NULL;\n\tgsize length = 0;\n\n\tdevice->store_id = 0;\n\n\tba2str(&device->bdaddr, device_addr);\n\tsnprintf(filename, PATH_MAX, STORAGEDIR \"/%s/%s/info\",\n\t\t\t\tbtd_adapter_get_storage_dir(device->adapter),\n\t\t\t\tdevice_addr);\n\n\tkey_file = g_key_file_new();\n\tg_key_file_load_from_file(key_file, filename, 0, NULL);\n\n\tg_key_file_set_string(key_file, \"General\", \"Name\", device->name);\n\n\tif (device->alias != NULL)\n\t\tg_key_file_set_string(key_file, \"General\", \"Alias\",\n\t\t\t\t\t\t\t\tdevice->alias);\n\telse\n\t\tg_key_file_remove_key(key_file, \"General\", \"Alias\", NULL);\n\n\tif (device->class) {\n\t\tsprintf(class, \"0x%6.6x\", device->class);\n\t\tg_key_file_set_string(key_file, \"General\", \"Class\", class);\n\t} else {\n\t\tg_key_file_remove_key(key_file, \"General\", \"Class\", NULL);\n\t}\n\n\tif (device->appearance) {\n\t\tsprintf(class, \"0x%4.4x\", device->appearance);\n\t\tg_key_file_set_string(key_file, \"General\", \"Appearance\", class);\n\t} else {\n\t\tg_key_file_remove_key(key_file, \"General\", \"Appearance\", NULL);\n\t}\n\n\tupdate_technologies(key_file, device);\n\n\tg_key_file_set_boolean(key_file, \"General\", \"Trusted\",\n\t\t\t\t\t\t\tdevice->trusted);\n\n\tg_key_file_set_boolean(key_file, \"General\", \"Blocked\",\n\t\t\t\t\t\t\tdevice->blocked);\n\n\tif (device->uuids) {\n\t\tGSList *l;\n\t\tint i;\n\n\t\tuuids = g_new0(char *, g_slist_length(device->uuids) + 1);\n\t\tfor (i = 0, l = device->uuids; l; l = g_slist_next(l), i++)\n\t\t\tuuids[i] = l->data;\n\t\tg_key_file_set_string_list(key_file, \"General\", \"Services\",\n\t\t\t\t\t\t(const char **)uuids, i);\n\t} else {\n\t\tg_key_file_remove_key(key_file, \"General\", \"Services\", NULL);\n\t}\n\n\tif (device->vendor_src) {\n\t\tg_key_file_set_integer(key_file, \"DeviceID\", \"Source\",\n\t\t\t\t\tdevice->vendor_src);\n\t\tg_key_file_set_integer(key_file, \"DeviceID\", \"Vendor\",\n\t\t\t\t\tdevice->vendor);\n\t\tg_key_file_set_integer(key_file, \"DeviceID\", \"Product\",\n\t\t\t\t\tdevice->product);\n\t\tg_key_file_set_integer(key_file, \"DeviceID\", \"Version\",\n\t\t\t\t\tdevice->version);\n\t} else {\n\t\tg_key_file_remove_group(key_file, \"DeviceID\", NULL);\n\t}\n\n\tif (device->local_csrk)\n\t\tstore_csrk(device->local_csrk, key_file, \"LocalSignatureKey\");\n\n\tif (device->remote_csrk)\n\t\tstore_csrk(device->remote_csrk, key_file, \"RemoteSignatureKey\");\n\n\tcreate_file(filename, S_IRUSR | S_IWUSR);\n\n\tstr = g_key_file_to_data(key_file, &length, NULL);\n\tg_file_set_contents(filename, str, length, NULL);\n\tg_free(str);\n\n\tg_key_file_free(key_file);\n\tg_free(uuids);\n\n\treturn FALSE;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_source_remove",
          "args": [
            "device->store_id"
          ],
          "line": 4168
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "disconnect_all",
          "args": [
            "device"
          ],
          "line": 4164
        },
        "resolved": true,
        "details": {
          "function_name": "disconnect_all",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "1317-1332",
          "snippet": "static gboolean disconnect_all(gpointer user_data)\n{\n\tstruct btd_device *device = user_data;\n\n\tdevice->disconn_timer = 0;\n\n\tif (device->bredr_state.connected)\n\t\tbtd_adapter_disconnect_device(device->adapter, &device->bdaddr,\n\t\t\t\t\t\t\t\tBDADDR_BREDR);\n\n\tif (device->le_state.connected)\n\t\tbtd_adapter_disconnect_device(device->adapter, &device->bdaddr,\n\t\t\t\t\t\t\tdevice->bdaddr_type);\n\n\treturn FALSE;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic gboolean disconnect_all(gpointer user_data)\n{\n\tstruct btd_device *device = user_data;\n\n\tdevice->disconn_timer = 0;\n\n\tif (device->bredr_state.connected)\n\t\tbtd_adapter_disconnect_device(device->adapter, &device->bdaddr,\n\t\t\t\t\t\t\t\tBDADDR_BREDR);\n\n\tif (device->le_state.connected)\n\t\tbtd_adapter_disconnect_device(device->adapter, &device->bdaddr,\n\t\t\t\t\t\t\tdevice->bdaddr_type);\n\n\treturn FALSE;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_source_remove",
          "args": [
            "device->disconn_timer"
          ],
          "line": 4163
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_device_is_connected",
          "args": [
            "device"
          ],
          "line": 4161
        },
        "resolved": true,
        "details": {
          "function_name": "btd_device_is_connected",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "2748-2751",
          "snippet": "bool btd_device_is_connected(struct btd_device *dev)\n{\n\treturn dev->bredr_state.connected || dev->le_state.connected;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nbool btd_device_is_connected(struct btd_device *dev)\n{\n\treturn dev->bredr_state.connected || dev->le_state.connected;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_slist_free",
          "args": [
            "device->pending"
          ],
          "line": 4158
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "service_remove",
          "args": [
            "service"
          ],
          "line": 4155
        },
        "resolved": true,
        "details": {
          "function_name": "btd_service_remove_state_cb",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
          "lines": "356-371",
          "snippet": "bool btd_service_remove_state_cb(unsigned int id)\n{\n\tGSList *l;\n\n\tfor (l = state_callbacks; l != NULL; l = g_slist_next(l)) {\n\t\tstruct service_state_callback *cb = l->data;\n\n\t\tif (cb && cb->id == id) {\n\t\t\tstate_callbacks = g_slist_remove(state_callbacks, cb);\n\t\t\tg_free(cb);\n\t\t\treturn true;\n\t\t}\n\t}\n\n\treturn false;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/stat.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static GSList *state_callbacks = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic GSList *state_callbacks = NULL;\n\nbool btd_service_remove_state_cb(unsigned int id)\n{\n\tGSList *l;\n\n\tfor (l = state_callbacks; l != NULL; l = g_slist_next(l)) {\n\t\tstruct service_state_callback *cb = l->data;\n\n\t\tif (cb && cb->id == id) {\n\t\t\tstate_callbacks = g_slist_remove(state_callbacks, cb);\n\t\t\tg_free(cb);\n\t\t\treturn true;\n\t\t}\n\t}\n\n\treturn false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_slist_remove",
          "args": [
            "device->services",
            "service"
          ],
          "line": 4154
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "browse_request_cancel",
          "args": [
            "device->browse"
          ],
          "line": 4149
        },
        "resolved": true,
        "details": {
          "function_name": "browse_request_cancel",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "614-626",
          "snippet": "static void browse_request_cancel(struct browse_req *req)\n{\n\tstruct btd_device *device = req->device;\n\tstruct btd_adapter *adapter = device->adapter;\n\n\tDBG(\"\");\n\n\tbt_cancel_discovery(btd_adapter_get_address(adapter), &device->bdaddr);\n\n\tattio_cleanup(device);\n\n\tbrowse_request_free(req);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void browse_request_cancel(struct browse_req *req)\n{\n\tstruct btd_device *device = req->device;\n\tstruct btd_adapter *adapter = device->adapter;\n\n\tDBG(\"\");\n\n\tbt_cancel_discovery(btd_adapter_get_address(adapter), &device->bdaddr);\n\n\tattio_cleanup(device);\n\n\tbrowse_request_free(req);\n}"
        }
      },
      {
        "call_info": {
          "callee": "device_cancel_bonding",
          "args": [
            "device",
            "status"
          ],
          "line": 4145
        },
        "resolved": true,
        "details": {
          "function_name": "device_cancel_bonding",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "2656-2676",
          "snippet": "static void device_cancel_bonding(struct btd_device *device, uint8_t status)\n{\n\tstruct bonding_req *bonding = device->bonding;\n\tDBusMessage *reply;\n\tchar addr[18];\n\n\tif (!bonding)\n\t\treturn;\n\n\tba2str(&device->bdaddr, addr);\n\tDBG(\"Canceling bonding request for %s\", addr);\n\n\tif (device->authr)\n\t\tdevice_cancel_authentication(device, FALSE);\n\n\treply = new_authentication_return(bonding->msg, status);\n\tg_dbus_send_message(dbus_conn, reply);\n\n\tbonding_request_cancel(bonding);\n\tbonding_request_free(bonding);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *dbus_conn = NULL;",
            "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
            "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);",
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void device_cancel_bonding(struct btd_device *device, uint8_t status)\n{\n\tstruct bonding_req *bonding = device->bonding;\n\tDBusMessage *reply;\n\tchar addr[18];\n\n\tif (!bonding)\n\t\treturn;\n\n\tba2str(&device->bdaddr, addr);\n\tDBG(\"Canceling bonding request for %s\", addr);\n\n\tif (device->authr)\n\t\tdevice_cancel_authentication(device, FALSE);\n\n\treply = new_authentication_return(bonding->msg, status);\n\tg_dbus_send_message(dbus_conn, reply);\n\n\tbonding_request_cancel(bonding);\n\tbonding_request_free(bonding);\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Removing device %s\"",
            "device->path"
          ],
          "line": 4135
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid device_remove(struct btd_device *device, gboolean remove_stored)\n{\n\tDBG(\"Removing device %s\", device->path);\n\n\tif (device->bonding) {\n\t\tuint8_t status;\n\n\t\tif (device->bredr_state.connected)\n\t\t\tstatus = MGMT_STATUS_DISCONNECTED;\n\t\telse\n\t\t\tstatus = MGMT_STATUS_CONNECT_FAILED;\n\n\t\tdevice_cancel_bonding(device, status);\n\t}\n\n\tif (device->browse)\n\t\tbrowse_request_cancel(device->browse);\n\n\twhile (device->services != NULL) {\n\t\tstruct btd_service *service = device->services->data;\n\n\t\tdevice->services = g_slist_remove(device->services, service);\n\t\tservice_remove(service);\n\t}\n\n\tg_slist_free(device->pending);\n\tdevice->pending = NULL;\n\n\tif (btd_device_is_connected(device)) {\n\t\tif (device->disconn_timer > 0)\n\t\t\tg_source_remove(device->disconn_timer);\n\t\tdisconnect_all(device);\n\t}\n\n\tif (device->store_id > 0) {\n\t\tg_source_remove(device->store_id);\n\t\tdevice->store_id = 0;\n\n\t\tif (!remove_stored)\n\t\t\tstore_device_info_cb(device);\n\t}\n\n\tif (remove_stored)\n\t\tdevice_remove_stored(device);\n\n\tbtd_device_unref(device);\n}"
  },
  {
    "function_name": "device_remove_stored",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "4082-4131",
    "snippet": "static void device_remove_stored(struct btd_device *device)\n{\n\tchar device_addr[18];\n\tchar filename[PATH_MAX];\n\tGKeyFile *key_file;\n\tchar *data;\n\tgsize length = 0;\n\n\tif (device->bredr_state.bonded) {\n\t\tdevice->bredr_state.bonded = false;\n\t\tbtd_adapter_remove_bonding(device->adapter, &device->bdaddr,\n\t\t\t\t\t\t\t\tBDADDR_BREDR);\n\t}\n\n\tif (device->le_state.bonded) {\n\t\tdevice->le_state.bonded = false;\n\t\tbtd_adapter_remove_bonding(device->adapter, &device->bdaddr,\n\t\t\t\t\t\t\tdevice->bdaddr_type);\n\t}\n\n\tdevice->bredr_state.paired = false;\n\tdevice->le_state.paired = false;\n\n\tif (device->blocked)\n\t\tdevice_unblock(device, TRUE, FALSE);\n\n\tba2str(&device->bdaddr, device_addr);\n\n\tsnprintf(filename, PATH_MAX, STORAGEDIR \"/%s/%s\",\n\t\t\t\tbtd_adapter_get_storage_dir(device->adapter),\n\t\t\t\tdevice_addr);\n\tdelete_folder_tree(filename);\n\n\tsnprintf(filename, PATH_MAX, STORAGEDIR \"/%s/cache/%s\",\n\t\t\t\tbtd_adapter_get_storage_dir(device->adapter),\n\t\t\t\tdevice_addr);\n\n\tkey_file = g_key_file_new();\n\tg_key_file_load_from_file(key_file, filename, 0, NULL);\n\tg_key_file_remove_group(key_file, \"ServiceRecords\", NULL);\n\n\tdata = g_key_file_to_data(key_file, &length, NULL);\n\tif (length > 0) {\n\t\tcreate_file(filename, S_IRUSR | S_IWUSR);\n\t\tg_file_set_contents(filename, data, length, NULL);\n\t}\n\n\tg_free(data);\n\tg_key_file_free(key_file);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_key_file_free",
          "args": [
            "key_file"
          ],
          "line": 4130
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "data"
          ],
          "line": 4129
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_file_set_contents",
          "args": [
            "filename",
            "data",
            "length",
            "NULL"
          ],
          "line": 4126
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "create_file",
          "args": [
            "filename",
            "S_IRUSR | S_IWUSR"
          ],
          "line": 4125
        },
        "resolved": true,
        "details": {
          "function_name": "create_file",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/textfile.c",
          "lines": "76-89",
          "snippet": "int create_file(const char *filename, const mode_t mode)\n{\n\tint fd;\n\n\tcreate_dirs(filename, S_IRUSR | S_IWUSR | S_IXUSR);\n\n\tfd = open(filename, O_RDWR | O_CREAT, mode);\n\tif (fd < 0)\n\t\treturn fd;\n\n\tclose(fd);\n\n\treturn 0;\n}",
          "includes": [
            "#include \"textfile.h\"",
            "#include <sys/param.h>",
            "#include <sys/mman.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <ctype.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"textfile.h\"\n#include <sys/param.h>\n#include <sys/mman.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <ctype.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nint create_file(const char *filename, const mode_t mode)\n{\n\tint fd;\n\n\tcreate_dirs(filename, S_IRUSR | S_IWUSR | S_IXUSR);\n\n\tfd = open(filename, O_RDWR | O_CREAT, mode);\n\tif (fd < 0)\n\t\treturn fd;\n\n\tclose(fd);\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_key_file_to_data",
          "args": [
            "key_file",
            "&length",
            "NULL"
          ],
          "line": 4123
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_remove_group",
          "args": [
            "key_file",
            "\"ServiceRecords\"",
            "NULL"
          ],
          "line": 4121
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_load_from_file",
          "args": [
            "key_file",
            "filename",
            "0",
            "NULL"
          ],
          "line": 4120
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_new",
          "args": [],
          "line": 4119
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "filename",
            "PATH_MAX",
            "STORAGEDIR \"/%s/cache/%s\"",
            "btd_adapter_get_storage_dir(device->adapter)",
            "device_addr"
          ],
          "line": 4115
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_adapter_get_storage_dir",
          "args": [
            "device->adapter"
          ],
          "line": 4116
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_get_storage_dir",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "438-450",
          "snippet": "const char *btd_adapter_get_storage_dir(struct btd_adapter *adapter)\n{\n\tstatic char dir[25];\n\n\tif (adapter->bdaddr_type == BDADDR_LE_RANDOM) {\n\t\tstrcpy(dir, \"static-\");\n\t\tba2str(&adapter->bdaddr, dir + 7);\n\t} else {\n\t\tba2str(&adapter->bdaddr, dir);\n\t}\n\n\treturn dir;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nconst char *btd_adapter_get_storage_dir(struct btd_adapter *adapter)\n{\n\tstatic char dir[25];\n\n\tif (adapter->bdaddr_type == BDADDR_LE_RANDOM) {\n\t\tstrcpy(dir, \"static-\");\n\t\tba2str(&adapter->bdaddr, dir + 7);\n\t} else {\n\t\tba2str(&adapter->bdaddr, dir);\n\t}\n\n\treturn dir;\n}"
        }
      },
      {
        "call_info": {
          "callee": "delete_folder_tree",
          "args": [
            "filename"
          ],
          "line": 4113
        },
        "resolved": true,
        "details": {
          "function_name": "delete_folder_tree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "4052-4080",
          "snippet": "static void delete_folder_tree(const char *dirname)\n{\n\tDIR *dir;\n\tstruct dirent *entry;\n\tchar filename[PATH_MAX];\n\n\tdir = opendir(dirname);\n\tif (dir == NULL)\n\t\treturn;\n\n\twhile ((entry = readdir(dir)) != NULL) {\n\t\tif (g_str_equal(entry->d_name, \".\") ||\n\t\t\t\tg_str_equal(entry->d_name, \"..\"))\n\t\t\tcontinue;\n\n\t\tif (entry->d_type == DT_UNKNOWN)\n\t\t\tentry->d_type = util_get_dt(dirname, entry->d_name);\n\n\t\tsnprintf(filename, PATH_MAX, \"%s/%s\", dirname, entry->d_name);\n\n\t\tif (entry->d_type == DT_DIR)\n\t\t\tdelete_folder_tree(filename);\n\t\telse\n\t\t\tunlink(filename);\n\t}\n\tclosedir(dir);\n\n\trmdir(dirname);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void delete_folder_tree(const char *dirname)\n{\n\tDIR *dir;\n\tstruct dirent *entry;\n\tchar filename[PATH_MAX];\n\n\tdir = opendir(dirname);\n\tif (dir == NULL)\n\t\treturn;\n\n\twhile ((entry = readdir(dir)) != NULL) {\n\t\tif (g_str_equal(entry->d_name, \".\") ||\n\t\t\t\tg_str_equal(entry->d_name, \"..\"))\n\t\t\tcontinue;\n\n\t\tif (entry->d_type == DT_UNKNOWN)\n\t\t\tentry->d_type = util_get_dt(dirname, entry->d_name);\n\n\t\tsnprintf(filename, PATH_MAX, \"%s/%s\", dirname, entry->d_name);\n\n\t\tif (entry->d_type == DT_DIR)\n\t\t\tdelete_folder_tree(filename);\n\t\telse\n\t\t\tunlink(filename);\n\t}\n\tclosedir(dir);\n\n\trmdir(dirname);\n}"
        }
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "filename",
            "PATH_MAX",
            "STORAGEDIR \"/%s/%s\"",
            "btd_adapter_get_storage_dir(device->adapter)",
            "device_addr"
          ],
          "line": 4110
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ba2str",
          "args": [
            "&device->bdaddr",
            "device_addr"
          ],
          "line": 4108
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device_unblock",
          "args": [
            "device",
            "TRUE",
            "FALSE"
          ],
          "line": 4106
        },
        "resolved": true,
        "details": {
          "function_name": "device_unblock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "1379-1412",
          "snippet": "int device_unblock(struct btd_device *device, gboolean silent,\n\t\t\t\t\t\t\tgboolean update_only)\n{\n\tint err = 0;\n\n\tif (!device->blocked)\n\t\treturn 0;\n\n\tif (!update_only) {\n\t\tif (device->le)\n\t\t\terr = btd_adapter_unblock_address(device->adapter,\n\t\t\t\t\t\t\t&device->bdaddr,\n\t\t\t\t\t\t\tdevice->bdaddr_type);\n\t\tif (!err && device->bredr)\n\t\t\terr = btd_adapter_unblock_address(device->adapter,\n\t\t\t\t\t\t\t&device->bdaddr,\n\t\t\t\t\t\t\tBDADDR_BREDR);\n\t}\n\n\tif (err < 0)\n\t\treturn err;\n\n\tdevice->blocked = FALSE;\n\n\tstore_device_info(device);\n\n\tif (!silent) {\n\t\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"Blocked\");\n\t\tdevice_probe_profiles(device, device->uuids);\n\t}\n\n\treturn 0;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *dbus_conn = NULL;",
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic void gatt_client_init(struct btd_device *device);\n\nint device_unblock(struct btd_device *device, gboolean silent,\n\t\t\t\t\t\t\tgboolean update_only)\n{\n\tint err = 0;\n\n\tif (!device->blocked)\n\t\treturn 0;\n\n\tif (!update_only) {\n\t\tif (device->le)\n\t\t\terr = btd_adapter_unblock_address(device->adapter,\n\t\t\t\t\t\t\t&device->bdaddr,\n\t\t\t\t\t\t\tdevice->bdaddr_type);\n\t\tif (!err && device->bredr)\n\t\t\terr = btd_adapter_unblock_address(device->adapter,\n\t\t\t\t\t\t\t&device->bdaddr,\n\t\t\t\t\t\t\tBDADDR_BREDR);\n\t}\n\n\tif (err < 0)\n\t\treturn err;\n\n\tdevice->blocked = FALSE;\n\n\tstore_device_info(device);\n\n\tif (!silent) {\n\t\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"Blocked\");\n\t\tdevice_probe_profiles(device, device->uuids);\n\t}\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_adapter_remove_bonding",
          "args": [
            "device->adapter",
            "&device->bdaddr",
            "device->bdaddr_type"
          ],
          "line": 4098
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_remove_bonding",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "6697-6713",
          "snippet": "int btd_adapter_remove_bonding(struct btd_adapter *adapter,\n\t\t\t\tconst bdaddr_t *bdaddr, uint8_t bdaddr_type)\n{\n\tstruct mgmt_cp_unpair_device cp;\n\n\tmemset(&cp, 0, sizeof(cp));\n\tbacpy(&cp.addr.bdaddr, bdaddr);\n\tcp.addr.type = bdaddr_type;\n\tcp.disconnect = 1;\n\n\tif (mgmt_send(adapter->mgmt, MGMT_OP_UNPAIR_DEVICE,\n\t\t\t\tadapter->dev_id, sizeof(cp), &cp,\n\t\t\t\tNULL, NULL, NULL) > 0)\n\t\treturn 0;\n\n\treturn -EIO;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nint btd_adapter_remove_bonding(struct btd_adapter *adapter,\n\t\t\t\tconst bdaddr_t *bdaddr, uint8_t bdaddr_type)\n{\n\tstruct mgmt_cp_unpair_device cp;\n\n\tmemset(&cp, 0, sizeof(cp));\n\tbacpy(&cp.addr.bdaddr, bdaddr);\n\tcp.addr.type = bdaddr_type;\n\tcp.disconnect = 1;\n\n\tif (mgmt_send(adapter->mgmt, MGMT_OP_UNPAIR_DEVICE,\n\t\t\t\tadapter->dev_id, sizeof(cp), &cp,\n\t\t\t\tNULL, NULL, NULL) > 0)\n\t\treturn 0;\n\n\treturn -EIO;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void device_remove_stored(struct btd_device *device)\n{\n\tchar device_addr[18];\n\tchar filename[PATH_MAX];\n\tGKeyFile *key_file;\n\tchar *data;\n\tgsize length = 0;\n\n\tif (device->bredr_state.bonded) {\n\t\tdevice->bredr_state.bonded = false;\n\t\tbtd_adapter_remove_bonding(device->adapter, &device->bdaddr,\n\t\t\t\t\t\t\t\tBDADDR_BREDR);\n\t}\n\n\tif (device->le_state.bonded) {\n\t\tdevice->le_state.bonded = false;\n\t\tbtd_adapter_remove_bonding(device->adapter, &device->bdaddr,\n\t\t\t\t\t\t\tdevice->bdaddr_type);\n\t}\n\n\tdevice->bredr_state.paired = false;\n\tdevice->le_state.paired = false;\n\n\tif (device->blocked)\n\t\tdevice_unblock(device, TRUE, FALSE);\n\n\tba2str(&device->bdaddr, device_addr);\n\n\tsnprintf(filename, PATH_MAX, STORAGEDIR \"/%s/%s\",\n\t\t\t\tbtd_adapter_get_storage_dir(device->adapter),\n\t\t\t\tdevice_addr);\n\tdelete_folder_tree(filename);\n\n\tsnprintf(filename, PATH_MAX, STORAGEDIR \"/%s/cache/%s\",\n\t\t\t\tbtd_adapter_get_storage_dir(device->adapter),\n\t\t\t\tdevice_addr);\n\n\tkey_file = g_key_file_new();\n\tg_key_file_load_from_file(key_file, filename, 0, NULL);\n\tg_key_file_remove_group(key_file, \"ServiceRecords\", NULL);\n\n\tdata = g_key_file_to_data(key_file, &length, NULL);\n\tif (length > 0) {\n\t\tcreate_file(filename, S_IRUSR | S_IWUSR);\n\t\tg_file_set_contents(filename, data, length, NULL);\n\t}\n\n\tg_free(data);\n\tg_key_file_free(key_file);\n}"
  },
  {
    "function_name": "delete_folder_tree",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "4052-4080",
    "snippet": "static void delete_folder_tree(const char *dirname)\n{\n\tDIR *dir;\n\tstruct dirent *entry;\n\tchar filename[PATH_MAX];\n\n\tdir = opendir(dirname);\n\tif (dir == NULL)\n\t\treturn;\n\n\twhile ((entry = readdir(dir)) != NULL) {\n\t\tif (g_str_equal(entry->d_name, \".\") ||\n\t\t\t\tg_str_equal(entry->d_name, \"..\"))\n\t\t\tcontinue;\n\n\t\tif (entry->d_type == DT_UNKNOWN)\n\t\t\tentry->d_type = util_get_dt(dirname, entry->d_name);\n\n\t\tsnprintf(filename, PATH_MAX, \"%s/%s\", dirname, entry->d_name);\n\n\t\tif (entry->d_type == DT_DIR)\n\t\t\tdelete_folder_tree(filename);\n\t\telse\n\t\t\tunlink(filename);\n\t}\n\tclosedir(dir);\n\n\trmdir(dirname);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "rmdir",
          "args": [
            "dirname"
          ],
          "line": 4079
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "closedir",
          "args": [
            "dir"
          ],
          "line": 4077
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "unlink",
          "args": [
            "filename"
          ],
          "line": 4075
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "delete_folder_tree",
          "args": [
            "filename"
          ],
          "line": 4073
        },
        "resolved": true,
        "details": {
          "function_name": "delete_folder_tree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "4052-4080",
          "snippet": "static void delete_folder_tree(const char *dirname)\n{\n\tDIR *dir;\n\tstruct dirent *entry;\n\tchar filename[PATH_MAX];\n\n\tdir = opendir(dirname);\n\tif (dir == NULL)\n\t\treturn;\n\n\twhile ((entry = readdir(dir)) != NULL) {\n\t\tif (g_str_equal(entry->d_name, \".\") ||\n\t\t\t\tg_str_equal(entry->d_name, \"..\"))\n\t\t\tcontinue;\n\n\t\tif (entry->d_type == DT_UNKNOWN)\n\t\t\tentry->d_type = util_get_dt(dirname, entry->d_name);\n\n\t\tsnprintf(filename, PATH_MAX, \"%s/%s\", dirname, entry->d_name);\n\n\t\tif (entry->d_type == DT_DIR)\n\t\t\tdelete_folder_tree(filename);\n\t\telse\n\t\t\tunlink(filename);\n\t}\n\tclosedir(dir);\n\n\trmdir(dirname);\n}",
          "note": "cyclic_reference_detected"
        }
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "filename",
            "PATH_MAX",
            "\"%s/%s\"",
            "dirname",
            "entry->d_name"
          ],
          "line": 4070
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "util_get_dt",
          "args": [
            "dirname",
            "entry->d_name"
          ],
          "line": 4068
        },
        "resolved": true,
        "details": {
          "function_name": "util_get_dt",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/util.c",
          "lines": "116-126",
          "snippet": "unsigned char util_get_dt(const char *parent, const char *name)\n{\n\tchar filename[PATH_MAX];\n\tstruct stat st;\n\n\tsnprintf(filename, PATH_MAX, \"%s/%s\", parent, name);\n\tif (lstat(filename, &st) == 0 && S_ISDIR(st.st_mode))\n\t\treturn DT_DIR;\n\n\treturn DT_UNKNOWN;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include <string.h>",
            "#include <limits.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include <string.h>\n#include <limits.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <config.h>\n\nunsigned char util_get_dt(const char *parent, const char *name)\n{\n\tchar filename[PATH_MAX];\n\tstruct stat st;\n\n\tsnprintf(filename, PATH_MAX, \"%s/%s\", parent, name);\n\tif (lstat(filename, &st) == 0 && S_ISDIR(st.st_mode))\n\t\treturn DT_DIR;\n\n\treturn DT_UNKNOWN;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_str_equal",
          "args": [
            "entry->d_name",
            "\"..\""
          ],
          "line": 4064
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_str_equal",
          "args": [
            "entry->d_name",
            "\".\""
          ],
          "line": 4063
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "readdir",
          "args": [
            "dir"
          ],
          "line": 4062
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "opendir",
          "args": [
            "dirname"
          ],
          "line": 4058
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void delete_folder_tree(const char *dirname)\n{\n\tDIR *dir;\n\tstruct dirent *entry;\n\tchar filename[PATH_MAX];\n\n\tdir = opendir(dirname);\n\tif (dir == NULL)\n\t\treturn;\n\n\twhile ((entry = readdir(dir)) != NULL) {\n\t\tif (g_str_equal(entry->d_name, \".\") ||\n\t\t\t\tg_str_equal(entry->d_name, \"..\"))\n\t\t\tcontinue;\n\n\t\tif (entry->d_type == DT_UNKNOWN)\n\t\t\tentry->d_type = util_get_dt(dirname, entry->d_name);\n\n\t\tsnprintf(filename, PATH_MAX, \"%s/%s\", dirname, entry->d_name);\n\n\t\tif (entry->d_type == DT_DIR)\n\t\t\tdelete_folder_tree(filename);\n\t\telse\n\t\t\tunlink(filename);\n\t}\n\tclosedir(dir);\n\n\trmdir(dirname);\n}"
  },
  {
    "function_name": "btd_device_get_version",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "4047-4050",
    "snippet": "uint16_t btd_device_get_version(struct btd_device *device)\n{\n\treturn device->version;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nuint16_t btd_device_get_version(struct btd_device *device)\n{\n\treturn device->version;\n}"
  },
  {
    "function_name": "btd_device_get_product",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "4042-4045",
    "snippet": "uint16_t btd_device_get_product(struct btd_device *device)\n{\n\treturn device->product;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nuint16_t btd_device_get_product(struct btd_device *device)\n{\n\treturn device->product;\n}"
  },
  {
    "function_name": "btd_device_get_vendor_src",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "4037-4040",
    "snippet": "uint16_t btd_device_get_vendor_src(struct btd_device *device)\n{\n\treturn device->vendor_src;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nuint16_t btd_device_get_vendor_src(struct btd_device *device)\n{\n\treturn device->vendor_src;\n}"
  },
  {
    "function_name": "btd_device_get_vendor",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "4032-4035",
    "snippet": "uint16_t btd_device_get_vendor(struct btd_device *device)\n{\n\treturn device->vendor;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nuint16_t btd_device_get_vendor(struct btd_device *device)\n{\n\treturn device->vendor;\n}"
  },
  {
    "function_name": "btd_device_get_class",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "4027-4030",
    "snippet": "uint32_t btd_device_get_class(struct btd_device *device)\n{\n\treturn device->class;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nuint32_t btd_device_get_class(struct btd_device *device)\n{\n\treturn device->class;\n}"
  },
  {
    "function_name": "device_merge_duplicate",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "3999-4025",
    "snippet": "void device_merge_duplicate(struct btd_device *dev, struct btd_device *dup)\n{\n\tGSList *l;\n\n\tDBG(\"\");\n\n\tdev->bredr = dup->bredr;\n\n\tdev->trusted = dup->trusted;\n\tdev->blocked = dup->blocked;\n\n\tfor (l = dup->uuids; l; l = g_slist_next(l))\n\t\tdev->uuids = g_slist_append(dev->uuids, g_strdup(l->data));\n\n\tif (dev->name[0] == '\\0')\n\t\tstrcpy(dev->name, dup->name);\n\n\tif (!dev->alias)\n\t\tdev->alias = g_strdup(dup->alias);\n\n\tdev->class = dup->class;\n\n\tdev->vendor_src = dup->vendor_src;\n\tdev->vendor = dup->vendor;\n\tdev->product = dup->product;\n\tdev->version = dup->version;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "dup->alias"
          ],
          "line": 4017
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "dev->name",
            "dup->name"
          ],
          "line": 4014
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_append",
          "args": [
            "dev->uuids",
            "g_strdup(l->data)"
          ],
          "line": 4011
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "l->data"
          ],
          "line": 4011
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_next",
          "args": [
            "l"
          ],
          "line": 4010
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"\""
          ],
          "line": 4003
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid device_merge_duplicate(struct btd_device *dev, struct btd_device *dup)\n{\n\tGSList *l;\n\n\tDBG(\"\");\n\n\tdev->bredr = dup->bredr;\n\n\tdev->trusted = dup->trusted;\n\tdev->blocked = dup->blocked;\n\n\tfor (l = dup->uuids; l; l = g_slist_next(l))\n\t\tdev->uuids = g_slist_append(dev->uuids, g_strdup(l->data));\n\n\tif (dev->name[0] == '\\0')\n\t\tstrcpy(dev->name, dup->name);\n\n\tif (!dev->alias)\n\t\tdev->alias = g_strdup(dup->alias);\n\n\tdev->class = dup->class;\n\n\tdev->vendor_src = dup->vendor_src;\n\tdev->vendor = dup->vendor;\n\tdev->product = dup->product;\n\tdev->version = dup->version;\n}"
  },
  {
    "function_name": "device_update_last_seen",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "3984-3990",
    "snippet": "void device_update_last_seen(struct btd_device *device, uint8_t bdaddr_type)\n{\n\tif (bdaddr_type == BDADDR_BREDR)\n\t\tdevice->bredr_seen = time(NULL);\n\telse\n\t\tdevice->le_seen = time(NULL);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "time",
          "args": [
            "NULL"
          ],
          "line": 3989
        },
        "resolved": true,
        "details": {
          "function_name": "bonding_request_stop_timer",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "2465-2476",
          "snippet": "static void bonding_request_stop_timer(struct bonding_req *bonding)\n{\n\tstruct timespec current;\n\n\tclock_gettime(CLOCK_MONOTONIC, &current);\n\n\t/* Compute the time difference in ms. */\n\tbonding->last_attempt_duration_ms =\n\t\t(current.tv_sec - bonding->attempt_start_time.tv_sec) * 1000L +\n\t\t(current.tv_nsec - bonding->attempt_start_time.tv_nsec)\n\t\t\t\t\t\t\t\t/ 1000000L;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void bonding_request_stop_timer(struct bonding_req *bonding)\n{\n\tstruct timespec current;\n\n\tclock_gettime(CLOCK_MONOTONIC, &current);\n\n\t/* Compute the time difference in ms. */\n\tbonding->last_attempt_duration_ms =\n\t\t(current.tv_sec - bonding->attempt_start_time.tv_sec) * 1000L +\n\t\t(current.tv_nsec - bonding->attempt_start_time.tv_nsec)\n\t\t\t\t\t\t\t\t/ 1000000L;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid device_update_last_seen(struct btd_device *device, uint8_t bdaddr_type)\n{\n\tif (bdaddr_type == BDADDR_BREDR)\n\t\tdevice->bredr_seen = time(NULL);\n\telse\n\t\tdevice->le_seen = time(NULL);\n}"
  },
  {
    "function_name": "device_set_le_support",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "3973-3982",
    "snippet": "void device_set_le_support(struct btd_device *device, uint8_t bdaddr_type)\n{\n\tif (device->le)\n\t\treturn;\n\n\tdevice->le = true;\n\tdevice->bdaddr_type = bdaddr_type;\n\n\tstore_device_info(device);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "store_device_info",
          "args": [
            "device"
          ],
          "line": 3981
        },
        "resolved": true,
        "details": {
          "function_name": "store_device_info",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "475-487",
          "snippet": "static void store_device_info(struct btd_device *device)\n{\n\tif (device->temporary || device->store_id > 0)\n\t\treturn;\n\n\tif (device_address_is_private(device)) {\n\t\tDBG(\"Can't store info for private addressed device %s\",\n\t\t\t\t\t\t\t\tdevice->path);\n\t\treturn;\n\t}\n\n\tdevice->store_id = g_idle_add(store_device_info_cb, device);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void store_device_info(struct btd_device *device)\n{\n\tif (device->temporary || device->store_id > 0)\n\t\treturn;\n\n\tif (device_address_is_private(device)) {\n\t\tDBG(\"Can't store info for private addressed device %s\",\n\t\t\t\t\t\t\t\tdevice->path);\n\t\treturn;\n\t}\n\n\tdevice->store_id = g_idle_add(store_device_info_cb, device);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid device_set_le_support(struct btd_device *device, uint8_t bdaddr_type)\n{\n\tif (device->le)\n\t\treturn;\n\n\tdevice->le = true;\n\tdevice->bdaddr_type = bdaddr_type;\n\n\tstore_device_info(device);\n}"
  },
  {
    "function_name": "device_set_bredr_support",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "3964-3971",
    "snippet": "void device_set_bredr_support(struct btd_device *device)\n{\n\tif (device->bredr)\n\t\treturn;\n\n\tdevice->bredr = true;\n\tstore_device_info(device);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "store_device_info",
          "args": [
            "device"
          ],
          "line": 3970
        },
        "resolved": true,
        "details": {
          "function_name": "store_device_info",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "475-487",
          "snippet": "static void store_device_info(struct btd_device *device)\n{\n\tif (device->temporary || device->store_id > 0)\n\t\treturn;\n\n\tif (device_address_is_private(device)) {\n\t\tDBG(\"Can't store info for private addressed device %s\",\n\t\t\t\t\t\t\t\tdevice->path);\n\t\treturn;\n\t}\n\n\tdevice->store_id = g_idle_add(store_device_info_cb, device);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void store_device_info(struct btd_device *device)\n{\n\tif (device->temporary || device->store_id > 0)\n\t\treturn;\n\n\tif (device_address_is_private(device)) {\n\t\tDBG(\"Can't store info for private addressed device %s\",\n\t\t\t\t\t\t\t\tdevice->path);\n\t\treturn;\n\t}\n\n\tdevice->store_id = g_idle_add(store_device_info_cb, device);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid device_set_bredr_support(struct btd_device *device)\n{\n\tif (device->bredr)\n\t\treturn;\n\n\tdevice->bredr = true;\n\tstore_device_info(device);\n}"
  },
  {
    "function_name": "device_update_addr",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "3941-3962",
    "snippet": "void device_update_addr(struct btd_device *device, const bdaddr_t *bdaddr,\n\t\t\t\t\t\t\tuint8_t bdaddr_type)\n{\n\tif (!bacmp(bdaddr, &device->bdaddr) &&\n\t\t\t\t\tbdaddr_type == device->bdaddr_type)\n\t\treturn;\n\n\t/* Since this function is only used for LE SMP Identity\n\t * Resolving purposes we can now assume LE is supported.\n\t */\n\tdevice->le = true;\n\n\tbacpy(&device->bdaddr, bdaddr);\n\tdevice->bdaddr_type = bdaddr_type;\n\n\tstore_device_info(device);\n\n\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"Address\");\n\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\tDEVICE_INTERFACE, \"AddressType\");\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static DBusConnection *dbus_conn = NULL;",
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_dbus_emit_property_changed",
          "args": [
            "dbus_conn",
            "device->path",
            "DEVICE_INTERFACE",
            "\"AddressType\""
          ],
          "line": 3960
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_emit_property_changed",
          "args": [
            "dbus_conn",
            "device->path",
            "DEVICE_INTERFACE",
            "\"Address\""
          ],
          "line": 3958
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "store_device_info",
          "args": [
            "device"
          ],
          "line": 3956
        },
        "resolved": true,
        "details": {
          "function_name": "store_device_info",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "475-487",
          "snippet": "static void store_device_info(struct btd_device *device)\n{\n\tif (device->temporary || device->store_id > 0)\n\t\treturn;\n\n\tif (device_address_is_private(device)) {\n\t\tDBG(\"Can't store info for private addressed device %s\",\n\t\t\t\t\t\t\t\tdevice->path);\n\t\treturn;\n\t}\n\n\tdevice->store_id = g_idle_add(store_device_info_cb, device);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void store_device_info(struct btd_device *device)\n{\n\tif (device->temporary || device->store_id > 0)\n\t\treturn;\n\n\tif (device_address_is_private(device)) {\n\t\tDBG(\"Can't store info for private addressed device %s\",\n\t\t\t\t\t\t\t\tdevice->path);\n\t\treturn;\n\t}\n\n\tdevice->store_id = g_idle_add(store_device_info_cb, device);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bacpy",
          "args": [
            "&device->bdaddr",
            "bdaddr"
          ],
          "line": 3953
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bacmp",
          "args": [
            "bdaddr",
            "&device->bdaddr"
          ],
          "line": 3944
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid device_update_addr(struct btd_device *device, const bdaddr_t *bdaddr,\n\t\t\t\t\t\t\tuint8_t bdaddr_type)\n{\n\tif (!bacmp(bdaddr, &device->bdaddr) &&\n\t\t\t\t\tbdaddr_type == device->bdaddr_type)\n\t\treturn;\n\n\t/* Since this function is only used for LE SMP Identity\n\t * Resolving purposes we can now assume LE is supported.\n\t */\n\tdevice->le = true;\n\n\tbacpy(&device->bdaddr, bdaddr);\n\tdevice->bdaddr_type = bdaddr_type;\n\n\tstore_device_info(device);\n\n\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"Address\");\n\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\tDEVICE_INTERFACE, \"AddressType\");\n}"
  },
  {
    "function_name": "device_set_class",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "3924-3939",
    "snippet": "void device_set_class(struct btd_device *device, uint32_t class)\n{\n\tif (device->class == class)\n\t\treturn;\n\n\tDBG(\"%s 0x%06X\", device->path, class);\n\n\tdevice->class = class;\n\n\tstore_device_info(device);\n\n\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"Class\");\n\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"Icon\");\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static DBusConnection *dbus_conn = NULL;",
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_dbus_emit_property_changed",
          "args": [
            "dbus_conn",
            "device->path",
            "DEVICE_INTERFACE",
            "\"Icon\""
          ],
          "line": 3937
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_emit_property_changed",
          "args": [
            "dbus_conn",
            "device->path",
            "DEVICE_INTERFACE",
            "\"Class\""
          ],
          "line": 3935
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "store_device_info",
          "args": [
            "device"
          ],
          "line": 3933
        },
        "resolved": true,
        "details": {
          "function_name": "store_device_info",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "475-487",
          "snippet": "static void store_device_info(struct btd_device *device)\n{\n\tif (device->temporary || device->store_id > 0)\n\t\treturn;\n\n\tif (device_address_is_private(device)) {\n\t\tDBG(\"Can't store info for private addressed device %s\",\n\t\t\t\t\t\t\t\tdevice->path);\n\t\treturn;\n\t}\n\n\tdevice->store_id = g_idle_add(store_device_info_cb, device);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void store_device_info(struct btd_device *device)\n{\n\tif (device->temporary || device->store_id > 0)\n\t\treturn;\n\n\tif (device_address_is_private(device)) {\n\t\tDBG(\"Can't store info for private addressed device %s\",\n\t\t\t\t\t\t\t\tdevice->path);\n\t\treturn;\n\t}\n\n\tdevice->store_id = g_idle_add(store_device_info_cb, device);\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"%s 0x%06X\"",
            "device->path",
            "class"
          ],
          "line": 3929
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid device_set_class(struct btd_device *device, uint32_t class)\n{\n\tif (device->class == class)\n\t\treturn;\n\n\tDBG(\"%s 0x%06X\", device->path, class);\n\n\tdevice->class = class;\n\n\tstore_device_info(device);\n\n\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"Class\");\n\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"Icon\");\n}"
  },
  {
    "function_name": "device_name_known",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "3919-3922",
    "snippet": "bool device_name_known(struct btd_device *device)\n{\n\treturn device->name[0] != '\\0';\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nbool device_name_known(struct btd_device *device)\n{\n\treturn device->name[0] != '\\0';\n}"
  },
  {
    "function_name": "device_get_name",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "3911-3917",
    "snippet": "void device_get_name(struct btd_device *device, char *name, size_t len)\n{\n\tif (name != NULL && len > 0) {\n\t\tstrncpy(name, device->name, len - 1);\n\t\tname[len - 1] = '\\0';\n\t}\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "strncpy",
          "args": [
            "name",
            "device->name",
            "len - 1"
          ],
          "line": 3914
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid device_get_name(struct btd_device *device, char *name, size_t len)\n{\n\tif (name != NULL && len > 0) {\n\t\tstrncpy(name, device->name, len - 1);\n\t\tname[len - 1] = '\\0';\n\t}\n}"
  },
  {
    "function_name": "btd_device_device_set_name",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "3890-3909",
    "snippet": "void btd_device_device_set_name(struct btd_device *device, const char *name)\n{\n\tif (strncmp(name, device->name, MAX_NAME_LENGTH) == 0)\n\t\treturn;\n\n\tDBG(\"%s %s\", device->path, name);\n\n\tstrncpy(device->name, name, MAX_NAME_LENGTH);\n\n\tstore_device_info(device);\n\n\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"Name\");\n\n\tif (device->alias != NULL)\n\t\treturn;\n\n\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"Alias\");\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static DBusConnection *dbus_conn = NULL;",
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_dbus_emit_property_changed",
          "args": [
            "dbus_conn",
            "device->path",
            "DEVICE_INTERFACE",
            "\"Alias\""
          ],
          "line": 3907
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_emit_property_changed",
          "args": [
            "dbus_conn",
            "device->path",
            "DEVICE_INTERFACE",
            "\"Name\""
          ],
          "line": 3901
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "store_device_info",
          "args": [
            "device"
          ],
          "line": 3899
        },
        "resolved": true,
        "details": {
          "function_name": "store_device_info",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "475-487",
          "snippet": "static void store_device_info(struct btd_device *device)\n{\n\tif (device->temporary || device->store_id > 0)\n\t\treturn;\n\n\tif (device_address_is_private(device)) {\n\t\tDBG(\"Can't store info for private addressed device %s\",\n\t\t\t\t\t\t\t\tdevice->path);\n\t\treturn;\n\t}\n\n\tdevice->store_id = g_idle_add(store_device_info_cb, device);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void store_device_info(struct btd_device *device)\n{\n\tif (device->temporary || device->store_id > 0)\n\t\treturn;\n\n\tif (device_address_is_private(device)) {\n\t\tDBG(\"Can't store info for private addressed device %s\",\n\t\t\t\t\t\t\t\tdevice->path);\n\t\treturn;\n\t}\n\n\tdevice->store_id = g_idle_add(store_device_info_cb, device);\n}"
        }
      },
      {
        "call_info": {
          "callee": "strncpy",
          "args": [
            "device->name",
            "name",
            "MAX_NAME_LENGTH"
          ],
          "line": 3897
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"%s %s\"",
            "device->path",
            "name"
          ],
          "line": 3895
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strncmp",
          "args": [
            "name",
            "device->name",
            "MAX_NAME_LENGTH"
          ],
          "line": 3892
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid btd_device_device_set_name(struct btd_device *device, const char *name)\n{\n\tif (strncmp(name, device->name, MAX_NAME_LENGTH) == 0)\n\t\treturn;\n\n\tDBG(\"%s %s\", device->path, name);\n\n\tstrncpy(device->name, name, MAX_NAME_LENGTH);\n\n\tstore_device_info(device);\n\n\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"Name\");\n\n\tif (device->alias != NULL)\n\t\treturn;\n\n\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"Alias\");\n}"
  },
  {
    "function_name": "btd_device_get_storage_path",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "3867-3888",
    "snippet": "char *btd_device_get_storage_path(struct btd_device *device,\n\t\t\t\tconst char *filename)\n{\n\tchar dstaddr[18];\n\n\tif (device_address_is_private(device)) {\n\t\twarn(\"Refusing storage path for private addressed device %s\",\n\t\t\t\t\t\t\t\tdevice->path);\n\t\treturn NULL;\n\t}\n\n\tba2str(&device->bdaddr, dstaddr);\n\n\tif (!filename)\n\t\treturn g_strdup_printf(STORAGEDIR \"/%s/%s\",\n\t\t\t\tbtd_adapter_get_storage_dir(device->adapter),\n\t\t\t\tdstaddr);\n\n\treturn g_strdup_printf(STORAGEDIR \"/%s/%s/%s\",\n\t\t\t\tbtd_adapter_get_storage_dir(device->adapter),\n\t\t\t\tdstaddr, filename);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "STORAGEDIR \"/%s/%s/%s\"",
            "btd_adapter_get_storage_dir(device->adapter)",
            "dstaddr",
            "filename"
          ],
          "line": 3885
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_adapter_get_storage_dir",
          "args": [
            "device->adapter"
          ],
          "line": 3886
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_get_storage_dir",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "438-450",
          "snippet": "const char *btd_adapter_get_storage_dir(struct btd_adapter *adapter)\n{\n\tstatic char dir[25];\n\n\tif (adapter->bdaddr_type == BDADDR_LE_RANDOM) {\n\t\tstrcpy(dir, \"static-\");\n\t\tba2str(&adapter->bdaddr, dir + 7);\n\t} else {\n\t\tba2str(&adapter->bdaddr, dir);\n\t}\n\n\treturn dir;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nconst char *btd_adapter_get_storage_dir(struct btd_adapter *adapter)\n{\n\tstatic char dir[25];\n\n\tif (adapter->bdaddr_type == BDADDR_LE_RANDOM) {\n\t\tstrcpy(dir, \"static-\");\n\t\tba2str(&adapter->bdaddr, dir + 7);\n\t} else {\n\t\tba2str(&adapter->bdaddr, dir);\n\t}\n\n\treturn dir;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "STORAGEDIR \"/%s/%s\"",
            "btd_adapter_get_storage_dir(device->adapter)",
            "dstaddr"
          ],
          "line": 3881
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ba2str",
          "args": [
            "&device->bdaddr",
            "dstaddr"
          ],
          "line": 3878
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "warn",
          "args": [
            "\"Refusing storage path for private addressed device %s\"",
            "device->path"
          ],
          "line": 3873
        },
        "resolved": true,
        "details": {
          "function_name": "btd_warn",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/log.c",
          "lines": "215-229",
          "snippet": "void btd_warn(uint16_t index, const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_WARNING, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(index, LOG_WARNING, format, ap);\n\tva_end(ap);\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdarg.h>",
            "#include <syslog.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int logging_fd = -1;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"src/shared/util.h\"\n#include \"lib/hci.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int logging_fd = -1;\n\nvoid btd_warn(uint16_t index, const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_WARNING, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(index, LOG_WARNING, format, ap);\n\tva_end(ap);\n}"
        }
      },
      {
        "call_info": {
          "callee": "device_address_is_private",
          "args": [
            "device"
          ],
          "line": 3872
        },
        "resolved": true,
        "details": {
          "function_name": "device_address_is_private",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "461-473",
          "snippet": "static bool device_address_is_private(struct btd_device *dev)\n{\n\tif (dev->bdaddr_type != BDADDR_LE_RANDOM)\n\t\treturn false;\n\n\tswitch (dev->bdaddr.b[5] >> 6) {\n\tcase 0x00:\t/* Private non-resolvable */\n\tcase 0x01:\t/* Private resolvable */\n\t\treturn true;\n\tdefault:\n\t\treturn false;\n\t}\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic bool device_address_is_private(struct btd_device *dev)\n{\n\tif (dev->bdaddr_type != BDADDR_LE_RANDOM)\n\t\treturn false;\n\n\tswitch (dev->bdaddr.b[5] >> 6) {\n\tcase 0x00:\t/* Private non-resolvable */\n\tcase 0x01:\t/* Private resolvable */\n\t\treturn true;\n\tdefault:\n\t\treturn false;\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nchar *btd_device_get_storage_path(struct btd_device *device,\n\t\t\t\tconst char *filename)\n{\n\tchar dstaddr[18];\n\n\tif (device_address_is_private(device)) {\n\t\twarn(\"Refusing storage path for private addressed device %s\",\n\t\t\t\t\t\t\t\tdevice->path);\n\t\treturn NULL;\n\t}\n\n\tba2str(&device->bdaddr, dstaddr);\n\n\tif (!filename)\n\t\treturn g_strdup_printf(STORAGEDIR \"/%s/%s\",\n\t\t\t\tbtd_adapter_get_storage_dir(device->adapter),\n\t\t\t\tdstaddr);\n\n\treturn g_strdup_printf(STORAGEDIR \"/%s/%s/%s\",\n\t\t\t\tbtd_adapter_get_storage_dir(device->adapter),\n\t\t\t\tdstaddr, filename);\n}"
  },
  {
    "function_name": "device_create",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "3836-3865",
    "snippet": "struct btd_device *device_create(struct btd_adapter *adapter,\n\t\t\t\tconst bdaddr_t *bdaddr, uint8_t bdaddr_type)\n{\n\tstruct btd_device *device;\n\tchar dst[18];\n\tchar *str;\n\n\tba2str(bdaddr, dst);\n\tDBG(\"dst %s\", dst);\n\n\tdevice = device_new(adapter, dst);\n\tif (device == NULL)\n\t\treturn NULL;\n\n\tdevice->bdaddr_type = bdaddr_type;\n\n\tif (bdaddr_type == BDADDR_BREDR)\n\t\tdevice->bredr = true;\n\telse\n\t\tdevice->le = true;\n\n\tstr = load_cached_name(device, btd_adapter_get_storage_dir(adapter),\n\t\t\t\t\t\t\t\t\tdst);\n\tif (str) {\n\t\tstrcpy(device->name, str);\n\t\tg_free(str);\n\t}\n\n\treturn device;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "str"
          ],
          "line": 3861
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "device->name",
            "str"
          ],
          "line": 3860
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "load_cached_name",
          "args": [
            "device",
            "btd_adapter_get_storage_dir(adapter)",
            "dst"
          ],
          "line": 3857
        },
        "resolved": true,
        "details": {
          "function_name": "load_cached_name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "2865-2894",
          "snippet": "static char *load_cached_name(struct btd_device *device, const char *local,\n\t\t\t\tconst char *peer)\n{\n\tchar filename[PATH_MAX];\n\tGKeyFile *key_file;\n\tchar *str = NULL;\n\tint len;\n\n\tif (device_address_is_private(device))\n\t\treturn NULL;\n\n\tsnprintf(filename, PATH_MAX, STORAGEDIR \"/%s/cache/%s\", local, peer);\n\n\tkey_file = g_key_file_new();\n\n\tif (!g_key_file_load_from_file(key_file, filename, 0, NULL))\n\t\tgoto failed;\n\n\tstr = g_key_file_get_string(key_file, \"General\", \"Name\", NULL);\n\tif (str) {\n\t\tlen = strlen(str);\n\t\tif (len > HCI_MAX_NAME_LENGTH)\n\t\t\tstr[HCI_MAX_NAME_LENGTH] = '\\0';\n\t}\n\nfailed:\n\tg_key_file_free(key_file);\n\n\treturn str;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic char *load_cached_name(struct btd_device *device, const char *local,\n\t\t\t\tconst char *peer)\n{\n\tchar filename[PATH_MAX];\n\tGKeyFile *key_file;\n\tchar *str = NULL;\n\tint len;\n\n\tif (device_address_is_private(device))\n\t\treturn NULL;\n\n\tsnprintf(filename, PATH_MAX, STORAGEDIR \"/%s/cache/%s\", local, peer);\n\n\tkey_file = g_key_file_new();\n\n\tif (!g_key_file_load_from_file(key_file, filename, 0, NULL))\n\t\tgoto failed;\n\n\tstr = g_key_file_get_string(key_file, \"General\", \"Name\", NULL);\n\tif (str) {\n\t\tlen = strlen(str);\n\t\tif (len > HCI_MAX_NAME_LENGTH)\n\t\t\tstr[HCI_MAX_NAME_LENGTH] = '\\0';\n\t}\n\nfailed:\n\tg_key_file_free(key_file);\n\n\treturn str;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_adapter_get_storage_dir",
          "args": [
            "adapter"
          ],
          "line": 3857
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_get_storage_dir",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "438-450",
          "snippet": "const char *btd_adapter_get_storage_dir(struct btd_adapter *adapter)\n{\n\tstatic char dir[25];\n\n\tif (adapter->bdaddr_type == BDADDR_LE_RANDOM) {\n\t\tstrcpy(dir, \"static-\");\n\t\tba2str(&adapter->bdaddr, dir + 7);\n\t} else {\n\t\tba2str(&adapter->bdaddr, dir);\n\t}\n\n\treturn dir;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nconst char *btd_adapter_get_storage_dir(struct btd_adapter *adapter)\n{\n\tstatic char dir[25];\n\n\tif (adapter->bdaddr_type == BDADDR_LE_RANDOM) {\n\t\tstrcpy(dir, \"static-\");\n\t\tba2str(&adapter->bdaddr, dir + 7);\n\t} else {\n\t\tba2str(&adapter->bdaddr, dir);\n\t}\n\n\treturn dir;\n}"
        }
      },
      {
        "call_info": {
          "callee": "device_new",
          "args": [
            "adapter",
            "dst"
          ],
          "line": 3846
        },
        "resolved": true,
        "details": {
          "function_name": "device_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "3750-3812",
          "snippet": "static struct btd_device *device_new(struct btd_adapter *adapter,\n\t\t\t\tconst char *address)\n{\n\tchar *address_up;\n\tstruct btd_device *device;\n\tconst char *adapter_path = adapter_get_path(adapter);\n\n\tDBG(\"address %s\", address);\n\n\tdevice = g_try_malloc0(sizeof(struct btd_device));\n\tif (device == NULL)\n\t\treturn NULL;\n\n\tdevice->tx_power = 127;\n\n\tdevice->db = gatt_db_new();\n\tif (!device->db) {\n\t\tg_free(device);\n\t\treturn NULL;\n\t}\n\n\tmemset(device->ad_flags, INVALID_FLAGS, sizeof(device->ad_flags));\n\n\tdevice->ad = bt_ad_new();\n\tif (!device->ad) {\n\t\tdevice_free(device);\n\t\treturn NULL;\n\t}\n\n\taddress_up = g_ascii_strup(address, -1);\n\tdevice->path = g_strdup_printf(\"%s/dev_%s\", adapter_path, address_up);\n\tg_strdelimit(device->path, \":\", '_');\n\tg_free(address_up);\n\n\tstr2ba(address, &device->bdaddr);\n\n\tdevice->client_dbus = btd_gatt_client_new(device);\n\tif (!device->client_dbus) {\n\t\terror(\"Failed to create btd_gatt_client\");\n\t\tdevice_free(device);\n\t\treturn NULL;\n\t}\n\n\tDBG(\"Creating device %s\", device->path);\n\n\tif (g_dbus_register_interface(dbus_conn,\n\t\t\t\t\tdevice->path, DEVICE_INTERFACE,\n\t\t\t\t\tdevice_methods, NULL,\n\t\t\t\t\tdevice_properties, device,\n\t\t\t\t\tdevice_free) == FALSE) {\n\t\terror(\"Unable to register device interface for %s\", address);\n\t\tdevice_free(device);\n\t\treturn NULL;\n\t}\n\n\tdevice->adapter = adapter;\n\tdevice->temporary = true;\n\n\tdevice->db_id = gatt_db_register(device->db, gatt_service_added,\n\t\t\t\t\tgatt_service_removed, device, NULL);\n\n\treturn btd_device_ref(device);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define INVALID_FLAGS\t\t0xff"
          ],
          "globals_used": [
            "static DBusConnection *dbus_conn = NULL;",
            "static const GDBusMethodTable device_methods[] = {\n\t{ GDBUS_ASYNC_METHOD(\"Disconnect\", NULL, NULL, dev_disconnect) },\n\t{ GDBUS_ASYNC_METHOD(\"Connect\", NULL, NULL, dev_connect) },\n\t{ GDBUS_ASYNC_METHOD(\"ConnectProfile\", GDBUS_ARGS({ \"UUID\", \"s\" }),\n\t\t\t\t\t\tNULL, connect_profile) },\n\t{ GDBUS_ASYNC_METHOD(\"DisconnectProfile\", GDBUS_ARGS({ \"UUID\", \"s\" }),\n\t\t\t\t\t\tNULL, disconnect_profile) },\n\t{ GDBUS_ASYNC_METHOD(\"Pair\", NULL, NULL, pair_device) },\n\t{ GDBUS_METHOD(\"CancelPairing\", NULL, NULL, cancel_pairing) },\n\t{ }\n};",
            "static const GDBusPropertyTable device_properties[] = {\n\t{ \"Address\", \"s\", dev_property_get_address },\n\t{ \"AddressType\", \"s\", property_get_address_type },\n\t{ \"Name\", \"s\", dev_property_get_name, NULL, dev_property_exists_name },\n\t{ \"Alias\", \"s\", dev_property_get_alias, dev_property_set_alias },\n\t{ \"Class\", \"u\", dev_property_get_class, NULL,\n\t\t\t\t\tdev_property_exists_class },\n\t{ \"Appearance\", \"q\", dev_property_get_appearance, NULL,\n\t\t\t\t\tdev_property_exists_appearance },\n\t{ \"Icon\", \"s\", dev_property_get_icon, NULL,\n\t\t\t\t\tdev_property_exists_icon },\n\t{ \"Paired\", \"b\", dev_property_get_paired },\n\t{ \"Trusted\", \"b\", dev_property_get_trusted, dev_property_set_trusted },\n\t{ \"Blocked\", \"b\", dev_property_get_blocked, dev_property_set_blocked },\n\t{ \"LegacyPairing\", \"b\", dev_property_get_legacy },\n\t{ \"RSSI\", \"n\", dev_property_get_rssi, NULL, dev_property_exists_rssi },\n\t{ \"Connected\", \"b\", dev_property_get_connected },\n\t{ \"UUIDs\", \"as\", dev_property_get_uuids },\n\t{ \"Modalias\", \"s\", dev_property_get_modalias, NULL,\n\t\t\t\t\t\tdev_property_exists_modalias },\n\t{ \"Adapter\", \"o\", dev_property_get_adapter },\n\t{ \"ManufacturerData\", \"a{qv}\", dev_property_get_manufacturer_data,\n\t\t\t\tNULL, dev_property_manufacturer_data_exist },\n\t{ \"ServiceData\", \"a{sv}\", dev_property_get_service_data,\n\t\t\t\tNULL, dev_property_service_data_exist },\n\t{ \"TxPower\", \"n\", dev_property_get_tx_power, NULL,\n\t\t\t\t\tdev_property_exists_tx_power },\n\t{ \"ServicesResolved\", \"b\", dev_property_get_svc_resolved, NULL, NULL },\n\t{ \"AdvertisingFlags\", \"ay\", dev_property_get_flags, NULL,\n\t\t\t\t\tdev_property_flags_exist,\n\t\t\t\t\tG_DBUS_PROPERTY_FLAG_EXPERIMENTAL},\n\t{ \"AdvertisingData\", \"a{yv}\", dev_property_get_advertising_data,\n\t\t\t\tNULL, dev_property_advertising_data_exist,\n\t\t\t\tG_DBUS_PROPERTY_FLAG_EXPERIMENTAL },\n\t{ }\n};",
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\n#define INVALID_FLAGS\t\t0xff\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic const GDBusMethodTable device_methods[] = {\n\t{ GDBUS_ASYNC_METHOD(\"Disconnect\", NULL, NULL, dev_disconnect) },\n\t{ GDBUS_ASYNC_METHOD(\"Connect\", NULL, NULL, dev_connect) },\n\t{ GDBUS_ASYNC_METHOD(\"ConnectProfile\", GDBUS_ARGS({ \"UUID\", \"s\" }),\n\t\t\t\t\t\tNULL, connect_profile) },\n\t{ GDBUS_ASYNC_METHOD(\"DisconnectProfile\", GDBUS_ARGS({ \"UUID\", \"s\" }),\n\t\t\t\t\t\tNULL, disconnect_profile) },\n\t{ GDBUS_ASYNC_METHOD(\"Pair\", NULL, NULL, pair_device) },\n\t{ GDBUS_METHOD(\"CancelPairing\", NULL, NULL, cancel_pairing) },\n\t{ }\n};\nstatic const GDBusPropertyTable device_properties[] = {\n\t{ \"Address\", \"s\", dev_property_get_address },\n\t{ \"AddressType\", \"s\", property_get_address_type },\n\t{ \"Name\", \"s\", dev_property_get_name, NULL, dev_property_exists_name },\n\t{ \"Alias\", \"s\", dev_property_get_alias, dev_property_set_alias },\n\t{ \"Class\", \"u\", dev_property_get_class, NULL,\n\t\t\t\t\tdev_property_exists_class },\n\t{ \"Appearance\", \"q\", dev_property_get_appearance, NULL,\n\t\t\t\t\tdev_property_exists_appearance },\n\t{ \"Icon\", \"s\", dev_property_get_icon, NULL,\n\t\t\t\t\tdev_property_exists_icon },\n\t{ \"Paired\", \"b\", dev_property_get_paired },\n\t{ \"Trusted\", \"b\", dev_property_get_trusted, dev_property_set_trusted },\n\t{ \"Blocked\", \"b\", dev_property_get_blocked, dev_property_set_blocked },\n\t{ \"LegacyPairing\", \"b\", dev_property_get_legacy },\n\t{ \"RSSI\", \"n\", dev_property_get_rssi, NULL, dev_property_exists_rssi },\n\t{ \"Connected\", \"b\", dev_property_get_connected },\n\t{ \"UUIDs\", \"as\", dev_property_get_uuids },\n\t{ \"Modalias\", \"s\", dev_property_get_modalias, NULL,\n\t\t\t\t\t\tdev_property_exists_modalias },\n\t{ \"Adapter\", \"o\", dev_property_get_adapter },\n\t{ \"ManufacturerData\", \"a{qv}\", dev_property_get_manufacturer_data,\n\t\t\t\tNULL, dev_property_manufacturer_data_exist },\n\t{ \"ServiceData\", \"a{sv}\", dev_property_get_service_data,\n\t\t\t\tNULL, dev_property_service_data_exist },\n\t{ \"TxPower\", \"n\", dev_property_get_tx_power, NULL,\n\t\t\t\t\tdev_property_exists_tx_power },\n\t{ \"ServicesResolved\", \"b\", dev_property_get_svc_resolved, NULL, NULL },\n\t{ \"AdvertisingFlags\", \"ay\", dev_property_get_flags, NULL,\n\t\t\t\t\tdev_property_flags_exist,\n\t\t\t\t\tG_DBUS_PROPERTY_FLAG_EXPERIMENTAL},\n\t{ \"AdvertisingData\", \"a{yv}\", dev_property_get_advertising_data,\n\t\t\t\tNULL, dev_property_advertising_data_exist,\n\t\t\t\tG_DBUS_PROPERTY_FLAG_EXPERIMENTAL },\n\t{ }\n};\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic struct btd_device *device_new(struct btd_adapter *adapter,\n\t\t\t\tconst char *address)\n{\n\tchar *address_up;\n\tstruct btd_device *device;\n\tconst char *adapter_path = adapter_get_path(adapter);\n\n\tDBG(\"address %s\", address);\n\n\tdevice = g_try_malloc0(sizeof(struct btd_device));\n\tif (device == NULL)\n\t\treturn NULL;\n\n\tdevice->tx_power = 127;\n\n\tdevice->db = gatt_db_new();\n\tif (!device->db) {\n\t\tg_free(device);\n\t\treturn NULL;\n\t}\n\n\tmemset(device->ad_flags, INVALID_FLAGS, sizeof(device->ad_flags));\n\n\tdevice->ad = bt_ad_new();\n\tif (!device->ad) {\n\t\tdevice_free(device);\n\t\treturn NULL;\n\t}\n\n\taddress_up = g_ascii_strup(address, -1);\n\tdevice->path = g_strdup_printf(\"%s/dev_%s\", adapter_path, address_up);\n\tg_strdelimit(device->path, \":\", '_');\n\tg_free(address_up);\n\n\tstr2ba(address, &device->bdaddr);\n\n\tdevice->client_dbus = btd_gatt_client_new(device);\n\tif (!device->client_dbus) {\n\t\terror(\"Failed to create btd_gatt_client\");\n\t\tdevice_free(device);\n\t\treturn NULL;\n\t}\n\n\tDBG(\"Creating device %s\", device->path);\n\n\tif (g_dbus_register_interface(dbus_conn,\n\t\t\t\t\tdevice->path, DEVICE_INTERFACE,\n\t\t\t\t\tdevice_methods, NULL,\n\t\t\t\t\tdevice_properties, device,\n\t\t\t\t\tdevice_free) == FALSE) {\n\t\terror(\"Unable to register device interface for %s\", address);\n\t\tdevice_free(device);\n\t\treturn NULL;\n\t}\n\n\tdevice->adapter = adapter;\n\tdevice->temporary = true;\n\n\tdevice->db_id = gatt_db_register(device->db, gatt_service_added,\n\t\t\t\t\tgatt_service_removed, device, NULL);\n\n\treturn btd_device_ref(device);\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"dst %s\"",
            "dst"
          ],
          "line": 3844
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ba2str",
          "args": [
            "bdaddr",
            "dst"
          ],
          "line": 3843
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstruct btd_device *device_create(struct btd_adapter *adapter,\n\t\t\t\tconst bdaddr_t *bdaddr, uint8_t bdaddr_type)\n{\n\tstruct btd_device *device;\n\tchar dst[18];\n\tchar *str;\n\n\tba2str(bdaddr, dst);\n\tDBG(\"dst %s\", dst);\n\n\tdevice = device_new(adapter, dst);\n\tif (device == NULL)\n\t\treturn NULL;\n\n\tdevice->bdaddr_type = bdaddr_type;\n\n\tif (bdaddr_type == BDADDR_BREDR)\n\t\tdevice->bredr = true;\n\telse\n\t\tdevice->le = true;\n\n\tstr = load_cached_name(device, btd_adapter_get_storage_dir(adapter),\n\t\t\t\t\t\t\t\t\tdst);\n\tif (str) {\n\t\tstrcpy(device->name, str);\n\t\tg_free(str);\n\t}\n\n\treturn device;\n}"
  },
  {
    "function_name": "device_create_from_storage",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "3814-3834",
    "snippet": "struct btd_device *device_create_from_storage(struct btd_adapter *adapter,\n\t\t\t\tconst char *address, GKeyFile *key_file)\n{\n\tstruct btd_device *device;\n\tconst char *src_dir;\n\n\tDBG(\"address %s\", address);\n\n\tdevice = device_new(adapter, address);\n\tif (device == NULL)\n\t\treturn NULL;\n\n\tconvert_info(device, key_file);\n\n\tsrc_dir = btd_adapter_get_storage_dir(adapter);\n\n\tload_info(device, src_dir, address, key_file);\n\tload_att_info(device, src_dir, address);\n\n\treturn device;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "load_att_info",
          "args": [
            "device",
            "src_dir",
            "address"
          ],
          "line": 3831
        },
        "resolved": true,
        "details": {
          "function_name": "load_att_info",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "3106-3192",
          "snippet": "static void load_att_info(struct btd_device *device, const char *local,\n\t\t\t\tconst char *peer)\n{\n\tchar filename[PATH_MAX];\n\tGKeyFile *key_file;\n\tchar *prim_uuid, *str;\n\tchar **groups, **handle, *service_uuid;\n\tstruct gatt_primary *prim;\n\tuuid_t uuid;\n\tchar tmp[3];\n\tint i;\n\n\tsdp_uuid16_create(&uuid, GATT_PRIM_SVC_UUID);\n\tprim_uuid = bt_uuid2string(&uuid);\n\n\tsnprintf(filename, PATH_MAX, STORAGEDIR \"/%s/%s/attributes\", local,\n\t\t\tpeer);\n\n\tkey_file = g_key_file_new();\n\tg_key_file_load_from_file(key_file, filename, 0, NULL);\n\tgroups = g_key_file_get_groups(key_file, NULL);\n\n\tfor (handle = groups; *handle; handle++) {\n\t\tgboolean uuid_ok;\n\t\tint end;\n\n\t\tstr = g_key_file_get_string(key_file, *handle, \"UUID\", NULL);\n\t\tif (!str)\n\t\t\tcontinue;\n\n\t\tuuid_ok = g_str_equal(str, prim_uuid);\n\t\tg_free(str);\n\n\t\tif (!uuid_ok)\n\t\t\tcontinue;\n\n\t\tstr = g_key_file_get_string(key_file, *handle, \"Value\", NULL);\n\t\tif (!str)\n\t\t\tcontinue;\n\n\t\tend = g_key_file_get_integer(key_file, *handle,\n\t\t\t\t\t\t\"EndGroupHandle\", NULL);\n\t\tif (end == 0) {\n\t\t\tg_free(str);\n\t\t\tcontinue;\n\t\t}\n\n\t\tprim = g_new0(struct gatt_primary, 1);\n\t\tprim->range.start = atoi(*handle);\n\t\tprim->range.end = end;\n\n\t\tswitch (strlen(str)) {\n\t\tcase 4:\n\t\t\tuuid.type = SDP_UUID16;\n\t\t\tsscanf(str, \"%04hx\", &uuid.value.uuid16);\n\t\tbreak;\n\t\tcase 8:\n\t\t\tuuid.type = SDP_UUID32;\n\t\t\tsscanf(str, \"%08x\", &uuid.value.uuid32);\n\t\t\tbreak;\n\t\tcase 32:\n\t\t\tuuid.type = SDP_UUID128;\n\t\t\tmemset(tmp, 0, sizeof(tmp));\n\t\t\tfor (i = 0; i < 16; i++) {\n\t\t\t\tmemcpy(tmp, str + (i * 2), 2);\n\t\t\t\tuuid.value.uuid128.data[i] =\n\t\t\t\t\t\t(uint8_t) strtol(tmp, NULL, 16);\n\t\t\t}\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tg_free(str);\n\t\t\tg_free(prim);\n\t\t\tcontinue;\n\t\t}\n\n\t\tservice_uuid = bt_uuid2string(&uuid);\n\t\tmemcpy(prim->uuid, service_uuid, MAX_LEN_UUID_STR);\n\t\tfree(service_uuid);\n\t\tg_free(str);\n\n\t\tdevice->primaries = g_slist_append(device->primaries, prim);\n\t}\n\n\tg_strfreev(groups);\n\tg_key_file_free(key_file);\n\tfree(prim_uuid);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void load_att_info(struct btd_device *device, const char *local,\n\t\t\t\tconst char *peer)\n{\n\tchar filename[PATH_MAX];\n\tGKeyFile *key_file;\n\tchar *prim_uuid, *str;\n\tchar **groups, **handle, *service_uuid;\n\tstruct gatt_primary *prim;\n\tuuid_t uuid;\n\tchar tmp[3];\n\tint i;\n\n\tsdp_uuid16_create(&uuid, GATT_PRIM_SVC_UUID);\n\tprim_uuid = bt_uuid2string(&uuid);\n\n\tsnprintf(filename, PATH_MAX, STORAGEDIR \"/%s/%s/attributes\", local,\n\t\t\tpeer);\n\n\tkey_file = g_key_file_new();\n\tg_key_file_load_from_file(key_file, filename, 0, NULL);\n\tgroups = g_key_file_get_groups(key_file, NULL);\n\n\tfor (handle = groups; *handle; handle++) {\n\t\tgboolean uuid_ok;\n\t\tint end;\n\n\t\tstr = g_key_file_get_string(key_file, *handle, \"UUID\", NULL);\n\t\tif (!str)\n\t\t\tcontinue;\n\n\t\tuuid_ok = g_str_equal(str, prim_uuid);\n\t\tg_free(str);\n\n\t\tif (!uuid_ok)\n\t\t\tcontinue;\n\n\t\tstr = g_key_file_get_string(key_file, *handle, \"Value\", NULL);\n\t\tif (!str)\n\t\t\tcontinue;\n\n\t\tend = g_key_file_get_integer(key_file, *handle,\n\t\t\t\t\t\t\"EndGroupHandle\", NULL);\n\t\tif (end == 0) {\n\t\t\tg_free(str);\n\t\t\tcontinue;\n\t\t}\n\n\t\tprim = g_new0(struct gatt_primary, 1);\n\t\tprim->range.start = atoi(*handle);\n\t\tprim->range.end = end;\n\n\t\tswitch (strlen(str)) {\n\t\tcase 4:\n\t\t\tuuid.type = SDP_UUID16;\n\t\t\tsscanf(str, \"%04hx\", &uuid.value.uuid16);\n\t\tbreak;\n\t\tcase 8:\n\t\t\tuuid.type = SDP_UUID32;\n\t\t\tsscanf(str, \"%08x\", &uuid.value.uuid32);\n\t\t\tbreak;\n\t\tcase 32:\n\t\t\tuuid.type = SDP_UUID128;\n\t\t\tmemset(tmp, 0, sizeof(tmp));\n\t\t\tfor (i = 0; i < 16; i++) {\n\t\t\t\tmemcpy(tmp, str + (i * 2), 2);\n\t\t\t\tuuid.value.uuid128.data[i] =\n\t\t\t\t\t\t(uint8_t) strtol(tmp, NULL, 16);\n\t\t\t}\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tg_free(str);\n\t\t\tg_free(prim);\n\t\t\tcontinue;\n\t\t}\n\n\t\tservice_uuid = bt_uuid2string(&uuid);\n\t\tmemcpy(prim->uuid, service_uuid, MAX_LEN_UUID_STR);\n\t\tfree(service_uuid);\n\t\tg_free(str);\n\n\t\tdevice->primaries = g_slist_append(device->primaries, prim);\n\t}\n\n\tg_strfreev(groups);\n\tg_key_file_free(key_file);\n\tfree(prim_uuid);\n}"
        }
      },
      {
        "call_info": {
          "callee": "load_info",
          "args": [
            "device",
            "src_dir",
            "address",
            "key_file"
          ],
          "line": 3830
        },
        "resolved": true,
        "details": {
          "function_name": "load_info",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "2985-3104",
          "snippet": "static void load_info(struct btd_device *device, const char *local,\n\t\t\tconst char *peer, GKeyFile *key_file)\n{\n\tchar *str;\n\tgboolean store_needed = FALSE;\n\tgboolean blocked;\n\tchar **uuids;\n\tint source, vendor, product, version;\n\tchar **techno, **t;\n\n\t/* Load device name from storage info file, if that fails fall back to\n\t * the cache.\n\t */\n\tstr = g_key_file_get_string(key_file, \"General\", \"Name\", NULL);\n\tif (str == NULL) {\n\t\tstr = load_cached_name(device, local, peer);\n\t\tif (str)\n\t\t\tstore_needed = TRUE;\n\t}\n\n\tif (str) {\n\t\tstrcpy(device->name, str);\n\t\tg_free(str);\n\t}\n\n\t/* Load alias */\n\tdevice->alias = g_key_file_get_string(key_file, \"General\", \"Alias\",\n\t\t\t\t\t\t\t\t\tNULL);\n\n\t/* Load class */\n\tstr = g_key_file_get_string(key_file, \"General\", \"Class\", NULL);\n\tif (str) {\n\t\tuint32_t class;\n\n\t\tif (sscanf(str, \"%x\", &class) == 1)\n\t\t\tdevice->class = class;\n\t\tg_free(str);\n\t}\n\n\t/* Load appearance */\n\tstr = g_key_file_get_string(key_file, \"General\", \"Appearance\", NULL);\n\tif (str) {\n\t\tdevice->appearance = strtol(str, NULL, 16);\n\t\tg_free(str);\n\t}\n\n\t/* Load device technology */\n\ttechno = g_key_file_get_string_list(key_file, \"General\",\n\t\t\t\t\t\"SupportedTechnologies\", NULL, NULL);\n\tif (!techno)\n\t\tgoto next;\n\n\tfor (t = techno; *t; t++) {\n\t\tif (g_str_equal(*t, \"BR/EDR\"))\n\t\t\tdevice->bredr = true;\n\t\telse if (g_str_equal(*t, \"LE\"))\n\t\t\tdevice->le = true;\n\t\telse\n\t\t\terror(\"Unknown device technology\");\n\t}\n\n\tif (!device->le) {\n\t\tdevice->bdaddr_type = BDADDR_BREDR;\n\t} else {\n\t\tstr = g_key_file_get_string(key_file, \"General\",\n\t\t\t\t\t\t\"AddressType\", NULL);\n\n\t\tif (str && g_str_equal(str, \"public\"))\n\t\t\tdevice->bdaddr_type = BDADDR_LE_PUBLIC;\n\t\telse if (str && g_str_equal(str, \"static\"))\n\t\t\tdevice->bdaddr_type = BDADDR_LE_RANDOM;\n\t\telse\n\t\t\terror(\"Unknown LE device technology\");\n\n\t\tg_free(str);\n\n\t\tdevice->local_csrk = load_csrk(key_file, \"LocalSignatureKey\");\n\t\tdevice->remote_csrk = load_csrk(key_file, \"RemoteSignatureKey\");\n\t}\n\n\tg_strfreev(techno);\n\nnext:\n\t/* Load trust */\n\tdevice->trusted = g_key_file_get_boolean(key_file, \"General\",\n\t\t\t\t\t\t\t\"Trusted\", NULL);\n\n\t/* Load device blocked */\n\tblocked = g_key_file_get_boolean(key_file, \"General\", \"Blocked\", NULL);\n\tif (blocked)\n\t\tdevice_block(device, FALSE);\n\n\t/* Load device profile list */\n\tuuids = g_key_file_get_string_list(key_file, \"General\", \"Services\",\n\t\t\t\t\t\tNULL, NULL);\n\tif (uuids) {\n\t\tload_services(device, uuids);\n\n\t\t/* Discovered services restored from storage */\n\t\tdevice->bredr_state.svc_resolved = true;\n\t}\n\n\t/* Load device id */\n\tsource = g_key_file_get_integer(key_file, \"DeviceID\", \"Source\", NULL);\n\tif (source) {\n\t\tvendor = g_key_file_get_integer(key_file, \"DeviceID\",\n\t\t\t\t\t\t\t\"Vendor\", NULL);\n\n\t\tproduct = g_key_file_get_integer(key_file, \"DeviceID\",\n\t\t\t\t\t\t\t\"Product\", NULL);\n\n\t\tversion = g_key_file_get_integer(key_file, \"DeviceID\",\n\t\t\t\t\t\t\t\"Version\", NULL);\n\n\t\tbtd_device_set_pnpid(device, source, vendor, product, version);\n\t}\n\n\tif (store_needed)\n\t\tstore_device_info(device);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void load_info(struct btd_device *device, const char *local,\n\t\t\tconst char *peer, GKeyFile *key_file)\n{\n\tchar *str;\n\tgboolean store_needed = FALSE;\n\tgboolean blocked;\n\tchar **uuids;\n\tint source, vendor, product, version;\n\tchar **techno, **t;\n\n\t/* Load device name from storage info file, if that fails fall back to\n\t * the cache.\n\t */\n\tstr = g_key_file_get_string(key_file, \"General\", \"Name\", NULL);\n\tif (str == NULL) {\n\t\tstr = load_cached_name(device, local, peer);\n\t\tif (str)\n\t\t\tstore_needed = TRUE;\n\t}\n\n\tif (str) {\n\t\tstrcpy(device->name, str);\n\t\tg_free(str);\n\t}\n\n\t/* Load alias */\n\tdevice->alias = g_key_file_get_string(key_file, \"General\", \"Alias\",\n\t\t\t\t\t\t\t\t\tNULL);\n\n\t/* Load class */\n\tstr = g_key_file_get_string(key_file, \"General\", \"Class\", NULL);\n\tif (str) {\n\t\tuint32_t class;\n\n\t\tif (sscanf(str, \"%x\", &class) == 1)\n\t\t\tdevice->class = class;\n\t\tg_free(str);\n\t}\n\n\t/* Load appearance */\n\tstr = g_key_file_get_string(key_file, \"General\", \"Appearance\", NULL);\n\tif (str) {\n\t\tdevice->appearance = strtol(str, NULL, 16);\n\t\tg_free(str);\n\t}\n\n\t/* Load device technology */\n\ttechno = g_key_file_get_string_list(key_file, \"General\",\n\t\t\t\t\t\"SupportedTechnologies\", NULL, NULL);\n\tif (!techno)\n\t\tgoto next;\n\n\tfor (t = techno; *t; t++) {\n\t\tif (g_str_equal(*t, \"BR/EDR\"))\n\t\t\tdevice->bredr = true;\n\t\telse if (g_str_equal(*t, \"LE\"))\n\t\t\tdevice->le = true;\n\t\telse\n\t\t\terror(\"Unknown device technology\");\n\t}\n\n\tif (!device->le) {\n\t\tdevice->bdaddr_type = BDADDR_BREDR;\n\t} else {\n\t\tstr = g_key_file_get_string(key_file, \"General\",\n\t\t\t\t\t\t\"AddressType\", NULL);\n\n\t\tif (str && g_str_equal(str, \"public\"))\n\t\t\tdevice->bdaddr_type = BDADDR_LE_PUBLIC;\n\t\telse if (str && g_str_equal(str, \"static\"))\n\t\t\tdevice->bdaddr_type = BDADDR_LE_RANDOM;\n\t\telse\n\t\t\terror(\"Unknown LE device technology\");\n\n\t\tg_free(str);\n\n\t\tdevice->local_csrk = load_csrk(key_file, \"LocalSignatureKey\");\n\t\tdevice->remote_csrk = load_csrk(key_file, \"RemoteSignatureKey\");\n\t}\n\n\tg_strfreev(techno);\n\nnext:\n\t/* Load trust */\n\tdevice->trusted = g_key_file_get_boolean(key_file, \"General\",\n\t\t\t\t\t\t\t\"Trusted\", NULL);\n\n\t/* Load device blocked */\n\tblocked = g_key_file_get_boolean(key_file, \"General\", \"Blocked\", NULL);\n\tif (blocked)\n\t\tdevice_block(device, FALSE);\n\n\t/* Load device profile list */\n\tuuids = g_key_file_get_string_list(key_file, \"General\", \"Services\",\n\t\t\t\t\t\tNULL, NULL);\n\tif (uuids) {\n\t\tload_services(device, uuids);\n\n\t\t/* Discovered services restored from storage */\n\t\tdevice->bredr_state.svc_resolved = true;\n\t}\n\n\t/* Load device id */\n\tsource = g_key_file_get_integer(key_file, \"DeviceID\", \"Source\", NULL);\n\tif (source) {\n\t\tvendor = g_key_file_get_integer(key_file, \"DeviceID\",\n\t\t\t\t\t\t\t\"Vendor\", NULL);\n\n\t\tproduct = g_key_file_get_integer(key_file, \"DeviceID\",\n\t\t\t\t\t\t\t\"Product\", NULL);\n\n\t\tversion = g_key_file_get_integer(key_file, \"DeviceID\",\n\t\t\t\t\t\t\t\"Version\", NULL);\n\n\t\tbtd_device_set_pnpid(device, source, vendor, product, version);\n\t}\n\n\tif (store_needed)\n\t\tstore_device_info(device);\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_adapter_get_storage_dir",
          "args": [
            "adapter"
          ],
          "line": 3828
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_get_storage_dir",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "438-450",
          "snippet": "const char *btd_adapter_get_storage_dir(struct btd_adapter *adapter)\n{\n\tstatic char dir[25];\n\n\tif (adapter->bdaddr_type == BDADDR_LE_RANDOM) {\n\t\tstrcpy(dir, \"static-\");\n\t\tba2str(&adapter->bdaddr, dir + 7);\n\t} else {\n\t\tba2str(&adapter->bdaddr, dir);\n\t}\n\n\treturn dir;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nconst char *btd_adapter_get_storage_dir(struct btd_adapter *adapter)\n{\n\tstatic char dir[25];\n\n\tif (adapter->bdaddr_type == BDADDR_LE_RANDOM) {\n\t\tstrcpy(dir, \"static-\");\n\t\tba2str(&adapter->bdaddr, dir + 7);\n\t} else {\n\t\tba2str(&adapter->bdaddr, dir);\n\t}\n\n\treturn dir;\n}"
        }
      },
      {
        "call_info": {
          "callee": "convert_info",
          "args": [
            "device",
            "key_file"
          ],
          "line": 3826
        },
        "resolved": true,
        "details": {
          "function_name": "convert_info",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "2946-2983",
          "snippet": "static void convert_info(struct btd_device *device, GKeyFile *key_file)\n{\n\tchar filename[PATH_MAX];\n\tchar adapter_addr[18];\n\tchar device_addr[18];\n\tchar **uuids;\n\tchar *str;\n\tgsize length = 0;\n\n\t/* Load device profile list from legacy properties */\n\tuuids = g_key_file_get_string_list(key_file, \"General\", \"SDPServices\",\n\t\t\t\t\t\t\t\tNULL, NULL);\n\tif (uuids)\n\t\tload_services(device, uuids);\n\n\tuuids = g_key_file_get_string_list(key_file, \"General\", \"GATTServices\",\n\t\t\t\t\t\t\t\tNULL, NULL);\n\tif (uuids)\n\t\tload_services(device, uuids);\n\n\tif (!device->uuids)\n\t\treturn;\n\n\t/* Remove old entries so they are not loaded again */\n\tg_key_file_remove_key(key_file, \"General\", \"SDPServices\", NULL);\n\tg_key_file_remove_key(key_file, \"General\", \"GATTServices\", NULL);\n\n\tba2str(btd_adapter_get_address(device->adapter), adapter_addr);\n\tba2str(&device->bdaddr, device_addr);\n\tsnprintf(filename, PATH_MAX, STORAGEDIR \"/%s/%s/info\", adapter_addr,\n\t\t\tdevice_addr);\n\n\tstr = g_key_file_to_data(key_file, &length, NULL);\n\tg_file_set_contents(filename, str, length, NULL);\n\tg_free(str);\n\n\tstore_device_info(device);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void convert_info(struct btd_device *device, GKeyFile *key_file)\n{\n\tchar filename[PATH_MAX];\n\tchar adapter_addr[18];\n\tchar device_addr[18];\n\tchar **uuids;\n\tchar *str;\n\tgsize length = 0;\n\n\t/* Load device profile list from legacy properties */\n\tuuids = g_key_file_get_string_list(key_file, \"General\", \"SDPServices\",\n\t\t\t\t\t\t\t\tNULL, NULL);\n\tif (uuids)\n\t\tload_services(device, uuids);\n\n\tuuids = g_key_file_get_string_list(key_file, \"General\", \"GATTServices\",\n\t\t\t\t\t\t\t\tNULL, NULL);\n\tif (uuids)\n\t\tload_services(device, uuids);\n\n\tif (!device->uuids)\n\t\treturn;\n\n\t/* Remove old entries so they are not loaded again */\n\tg_key_file_remove_key(key_file, \"General\", \"SDPServices\", NULL);\n\tg_key_file_remove_key(key_file, \"General\", \"GATTServices\", NULL);\n\n\tba2str(btd_adapter_get_address(device->adapter), adapter_addr);\n\tba2str(&device->bdaddr, device_addr);\n\tsnprintf(filename, PATH_MAX, STORAGEDIR \"/%s/%s/info\", adapter_addr,\n\t\t\tdevice_addr);\n\n\tstr = g_key_file_to_data(key_file, &length, NULL);\n\tg_file_set_contents(filename, str, length, NULL);\n\tg_free(str);\n\n\tstore_device_info(device);\n}"
        }
      },
      {
        "call_info": {
          "callee": "device_new",
          "args": [
            "adapter",
            "address"
          ],
          "line": 3822
        },
        "resolved": true,
        "details": {
          "function_name": "device_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "3750-3812",
          "snippet": "static struct btd_device *device_new(struct btd_adapter *adapter,\n\t\t\t\tconst char *address)\n{\n\tchar *address_up;\n\tstruct btd_device *device;\n\tconst char *adapter_path = adapter_get_path(adapter);\n\n\tDBG(\"address %s\", address);\n\n\tdevice = g_try_malloc0(sizeof(struct btd_device));\n\tif (device == NULL)\n\t\treturn NULL;\n\n\tdevice->tx_power = 127;\n\n\tdevice->db = gatt_db_new();\n\tif (!device->db) {\n\t\tg_free(device);\n\t\treturn NULL;\n\t}\n\n\tmemset(device->ad_flags, INVALID_FLAGS, sizeof(device->ad_flags));\n\n\tdevice->ad = bt_ad_new();\n\tif (!device->ad) {\n\t\tdevice_free(device);\n\t\treturn NULL;\n\t}\n\n\taddress_up = g_ascii_strup(address, -1);\n\tdevice->path = g_strdup_printf(\"%s/dev_%s\", adapter_path, address_up);\n\tg_strdelimit(device->path, \":\", '_');\n\tg_free(address_up);\n\n\tstr2ba(address, &device->bdaddr);\n\n\tdevice->client_dbus = btd_gatt_client_new(device);\n\tif (!device->client_dbus) {\n\t\terror(\"Failed to create btd_gatt_client\");\n\t\tdevice_free(device);\n\t\treturn NULL;\n\t}\n\n\tDBG(\"Creating device %s\", device->path);\n\n\tif (g_dbus_register_interface(dbus_conn,\n\t\t\t\t\tdevice->path, DEVICE_INTERFACE,\n\t\t\t\t\tdevice_methods, NULL,\n\t\t\t\t\tdevice_properties, device,\n\t\t\t\t\tdevice_free) == FALSE) {\n\t\terror(\"Unable to register device interface for %s\", address);\n\t\tdevice_free(device);\n\t\treturn NULL;\n\t}\n\n\tdevice->adapter = adapter;\n\tdevice->temporary = true;\n\n\tdevice->db_id = gatt_db_register(device->db, gatt_service_added,\n\t\t\t\t\tgatt_service_removed, device, NULL);\n\n\treturn btd_device_ref(device);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define INVALID_FLAGS\t\t0xff"
          ],
          "globals_used": [
            "static DBusConnection *dbus_conn = NULL;",
            "static const GDBusMethodTable device_methods[] = {\n\t{ GDBUS_ASYNC_METHOD(\"Disconnect\", NULL, NULL, dev_disconnect) },\n\t{ GDBUS_ASYNC_METHOD(\"Connect\", NULL, NULL, dev_connect) },\n\t{ GDBUS_ASYNC_METHOD(\"ConnectProfile\", GDBUS_ARGS({ \"UUID\", \"s\" }),\n\t\t\t\t\t\tNULL, connect_profile) },\n\t{ GDBUS_ASYNC_METHOD(\"DisconnectProfile\", GDBUS_ARGS({ \"UUID\", \"s\" }),\n\t\t\t\t\t\tNULL, disconnect_profile) },\n\t{ GDBUS_ASYNC_METHOD(\"Pair\", NULL, NULL, pair_device) },\n\t{ GDBUS_METHOD(\"CancelPairing\", NULL, NULL, cancel_pairing) },\n\t{ }\n};",
            "static const GDBusPropertyTable device_properties[] = {\n\t{ \"Address\", \"s\", dev_property_get_address },\n\t{ \"AddressType\", \"s\", property_get_address_type },\n\t{ \"Name\", \"s\", dev_property_get_name, NULL, dev_property_exists_name },\n\t{ \"Alias\", \"s\", dev_property_get_alias, dev_property_set_alias },\n\t{ \"Class\", \"u\", dev_property_get_class, NULL,\n\t\t\t\t\tdev_property_exists_class },\n\t{ \"Appearance\", \"q\", dev_property_get_appearance, NULL,\n\t\t\t\t\tdev_property_exists_appearance },\n\t{ \"Icon\", \"s\", dev_property_get_icon, NULL,\n\t\t\t\t\tdev_property_exists_icon },\n\t{ \"Paired\", \"b\", dev_property_get_paired },\n\t{ \"Trusted\", \"b\", dev_property_get_trusted, dev_property_set_trusted },\n\t{ \"Blocked\", \"b\", dev_property_get_blocked, dev_property_set_blocked },\n\t{ \"LegacyPairing\", \"b\", dev_property_get_legacy },\n\t{ \"RSSI\", \"n\", dev_property_get_rssi, NULL, dev_property_exists_rssi },\n\t{ \"Connected\", \"b\", dev_property_get_connected },\n\t{ \"UUIDs\", \"as\", dev_property_get_uuids },\n\t{ \"Modalias\", \"s\", dev_property_get_modalias, NULL,\n\t\t\t\t\t\tdev_property_exists_modalias },\n\t{ \"Adapter\", \"o\", dev_property_get_adapter },\n\t{ \"ManufacturerData\", \"a{qv}\", dev_property_get_manufacturer_data,\n\t\t\t\tNULL, dev_property_manufacturer_data_exist },\n\t{ \"ServiceData\", \"a{sv}\", dev_property_get_service_data,\n\t\t\t\tNULL, dev_property_service_data_exist },\n\t{ \"TxPower\", \"n\", dev_property_get_tx_power, NULL,\n\t\t\t\t\tdev_property_exists_tx_power },\n\t{ \"ServicesResolved\", \"b\", dev_property_get_svc_resolved, NULL, NULL },\n\t{ \"AdvertisingFlags\", \"ay\", dev_property_get_flags, NULL,\n\t\t\t\t\tdev_property_flags_exist,\n\t\t\t\t\tG_DBUS_PROPERTY_FLAG_EXPERIMENTAL},\n\t{ \"AdvertisingData\", \"a{yv}\", dev_property_get_advertising_data,\n\t\t\t\tNULL, dev_property_advertising_data_exist,\n\t\t\t\tG_DBUS_PROPERTY_FLAG_EXPERIMENTAL },\n\t{ }\n};",
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\n#define INVALID_FLAGS\t\t0xff\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic const GDBusMethodTable device_methods[] = {\n\t{ GDBUS_ASYNC_METHOD(\"Disconnect\", NULL, NULL, dev_disconnect) },\n\t{ GDBUS_ASYNC_METHOD(\"Connect\", NULL, NULL, dev_connect) },\n\t{ GDBUS_ASYNC_METHOD(\"ConnectProfile\", GDBUS_ARGS({ \"UUID\", \"s\" }),\n\t\t\t\t\t\tNULL, connect_profile) },\n\t{ GDBUS_ASYNC_METHOD(\"DisconnectProfile\", GDBUS_ARGS({ \"UUID\", \"s\" }),\n\t\t\t\t\t\tNULL, disconnect_profile) },\n\t{ GDBUS_ASYNC_METHOD(\"Pair\", NULL, NULL, pair_device) },\n\t{ GDBUS_METHOD(\"CancelPairing\", NULL, NULL, cancel_pairing) },\n\t{ }\n};\nstatic const GDBusPropertyTable device_properties[] = {\n\t{ \"Address\", \"s\", dev_property_get_address },\n\t{ \"AddressType\", \"s\", property_get_address_type },\n\t{ \"Name\", \"s\", dev_property_get_name, NULL, dev_property_exists_name },\n\t{ \"Alias\", \"s\", dev_property_get_alias, dev_property_set_alias },\n\t{ \"Class\", \"u\", dev_property_get_class, NULL,\n\t\t\t\t\tdev_property_exists_class },\n\t{ \"Appearance\", \"q\", dev_property_get_appearance, NULL,\n\t\t\t\t\tdev_property_exists_appearance },\n\t{ \"Icon\", \"s\", dev_property_get_icon, NULL,\n\t\t\t\t\tdev_property_exists_icon },\n\t{ \"Paired\", \"b\", dev_property_get_paired },\n\t{ \"Trusted\", \"b\", dev_property_get_trusted, dev_property_set_trusted },\n\t{ \"Blocked\", \"b\", dev_property_get_blocked, dev_property_set_blocked },\n\t{ \"LegacyPairing\", \"b\", dev_property_get_legacy },\n\t{ \"RSSI\", \"n\", dev_property_get_rssi, NULL, dev_property_exists_rssi },\n\t{ \"Connected\", \"b\", dev_property_get_connected },\n\t{ \"UUIDs\", \"as\", dev_property_get_uuids },\n\t{ \"Modalias\", \"s\", dev_property_get_modalias, NULL,\n\t\t\t\t\t\tdev_property_exists_modalias },\n\t{ \"Adapter\", \"o\", dev_property_get_adapter },\n\t{ \"ManufacturerData\", \"a{qv}\", dev_property_get_manufacturer_data,\n\t\t\t\tNULL, dev_property_manufacturer_data_exist },\n\t{ \"ServiceData\", \"a{sv}\", dev_property_get_service_data,\n\t\t\t\tNULL, dev_property_service_data_exist },\n\t{ \"TxPower\", \"n\", dev_property_get_tx_power, NULL,\n\t\t\t\t\tdev_property_exists_tx_power },\n\t{ \"ServicesResolved\", \"b\", dev_property_get_svc_resolved, NULL, NULL },\n\t{ \"AdvertisingFlags\", \"ay\", dev_property_get_flags, NULL,\n\t\t\t\t\tdev_property_flags_exist,\n\t\t\t\t\tG_DBUS_PROPERTY_FLAG_EXPERIMENTAL},\n\t{ \"AdvertisingData\", \"a{yv}\", dev_property_get_advertising_data,\n\t\t\t\tNULL, dev_property_advertising_data_exist,\n\t\t\t\tG_DBUS_PROPERTY_FLAG_EXPERIMENTAL },\n\t{ }\n};\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic struct btd_device *device_new(struct btd_adapter *adapter,\n\t\t\t\tconst char *address)\n{\n\tchar *address_up;\n\tstruct btd_device *device;\n\tconst char *adapter_path = adapter_get_path(adapter);\n\n\tDBG(\"address %s\", address);\n\n\tdevice = g_try_malloc0(sizeof(struct btd_device));\n\tif (device == NULL)\n\t\treturn NULL;\n\n\tdevice->tx_power = 127;\n\n\tdevice->db = gatt_db_new();\n\tif (!device->db) {\n\t\tg_free(device);\n\t\treturn NULL;\n\t}\n\n\tmemset(device->ad_flags, INVALID_FLAGS, sizeof(device->ad_flags));\n\n\tdevice->ad = bt_ad_new();\n\tif (!device->ad) {\n\t\tdevice_free(device);\n\t\treturn NULL;\n\t}\n\n\taddress_up = g_ascii_strup(address, -1);\n\tdevice->path = g_strdup_printf(\"%s/dev_%s\", adapter_path, address_up);\n\tg_strdelimit(device->path, \":\", '_');\n\tg_free(address_up);\n\n\tstr2ba(address, &device->bdaddr);\n\n\tdevice->client_dbus = btd_gatt_client_new(device);\n\tif (!device->client_dbus) {\n\t\terror(\"Failed to create btd_gatt_client\");\n\t\tdevice_free(device);\n\t\treturn NULL;\n\t}\n\n\tDBG(\"Creating device %s\", device->path);\n\n\tif (g_dbus_register_interface(dbus_conn,\n\t\t\t\t\tdevice->path, DEVICE_INTERFACE,\n\t\t\t\t\tdevice_methods, NULL,\n\t\t\t\t\tdevice_properties, device,\n\t\t\t\t\tdevice_free) == FALSE) {\n\t\terror(\"Unable to register device interface for %s\", address);\n\t\tdevice_free(device);\n\t\treturn NULL;\n\t}\n\n\tdevice->adapter = adapter;\n\tdevice->temporary = true;\n\n\tdevice->db_id = gatt_db_register(device->db, gatt_service_added,\n\t\t\t\t\tgatt_service_removed, device, NULL);\n\n\treturn btd_device_ref(device);\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"address %s\"",
            "address"
          ],
          "line": 3820
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstruct btd_device *device_create_from_storage(struct btd_adapter *adapter,\n\t\t\t\tconst char *address, GKeyFile *key_file)\n{\n\tstruct btd_device *device;\n\tconst char *src_dir;\n\n\tDBG(\"address %s\", address);\n\n\tdevice = device_new(adapter, address);\n\tif (device == NULL)\n\t\treturn NULL;\n\n\tconvert_info(device, key_file);\n\n\tsrc_dir = btd_adapter_get_storage_dir(adapter);\n\n\tload_info(device, src_dir, address, key_file);\n\tload_att_info(device, src_dir, address);\n\n\treturn device;\n}"
  },
  {
    "function_name": "device_new",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "3750-3812",
    "snippet": "static struct btd_device *device_new(struct btd_adapter *adapter,\n\t\t\t\tconst char *address)\n{\n\tchar *address_up;\n\tstruct btd_device *device;\n\tconst char *adapter_path = adapter_get_path(adapter);\n\n\tDBG(\"address %s\", address);\n\n\tdevice = g_try_malloc0(sizeof(struct btd_device));\n\tif (device == NULL)\n\t\treturn NULL;\n\n\tdevice->tx_power = 127;\n\n\tdevice->db = gatt_db_new();\n\tif (!device->db) {\n\t\tg_free(device);\n\t\treturn NULL;\n\t}\n\n\tmemset(device->ad_flags, INVALID_FLAGS, sizeof(device->ad_flags));\n\n\tdevice->ad = bt_ad_new();\n\tif (!device->ad) {\n\t\tdevice_free(device);\n\t\treturn NULL;\n\t}\n\n\taddress_up = g_ascii_strup(address, -1);\n\tdevice->path = g_strdup_printf(\"%s/dev_%s\", adapter_path, address_up);\n\tg_strdelimit(device->path, \":\", '_');\n\tg_free(address_up);\n\n\tstr2ba(address, &device->bdaddr);\n\n\tdevice->client_dbus = btd_gatt_client_new(device);\n\tif (!device->client_dbus) {\n\t\terror(\"Failed to create btd_gatt_client\");\n\t\tdevice_free(device);\n\t\treturn NULL;\n\t}\n\n\tDBG(\"Creating device %s\", device->path);\n\n\tif (g_dbus_register_interface(dbus_conn,\n\t\t\t\t\tdevice->path, DEVICE_INTERFACE,\n\t\t\t\t\tdevice_methods, NULL,\n\t\t\t\t\tdevice_properties, device,\n\t\t\t\t\tdevice_free) == FALSE) {\n\t\terror(\"Unable to register device interface for %s\", address);\n\t\tdevice_free(device);\n\t\treturn NULL;\n\t}\n\n\tdevice->adapter = adapter;\n\tdevice->temporary = true;\n\n\tdevice->db_id = gatt_db_register(device->db, gatt_service_added,\n\t\t\t\t\tgatt_service_removed, device, NULL);\n\n\treturn btd_device_ref(device);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define INVALID_FLAGS\t\t0xff"
    ],
    "globals_used": [
      "static DBusConnection *dbus_conn = NULL;",
      "static const GDBusMethodTable device_methods[] = {\n\t{ GDBUS_ASYNC_METHOD(\"Disconnect\", NULL, NULL, dev_disconnect) },\n\t{ GDBUS_ASYNC_METHOD(\"Connect\", NULL, NULL, dev_connect) },\n\t{ GDBUS_ASYNC_METHOD(\"ConnectProfile\", GDBUS_ARGS({ \"UUID\", \"s\" }),\n\t\t\t\t\t\tNULL, connect_profile) },\n\t{ GDBUS_ASYNC_METHOD(\"DisconnectProfile\", GDBUS_ARGS({ \"UUID\", \"s\" }),\n\t\t\t\t\t\tNULL, disconnect_profile) },\n\t{ GDBUS_ASYNC_METHOD(\"Pair\", NULL, NULL, pair_device) },\n\t{ GDBUS_METHOD(\"CancelPairing\", NULL, NULL, cancel_pairing) },\n\t{ }\n};",
      "static const GDBusPropertyTable device_properties[] = {\n\t{ \"Address\", \"s\", dev_property_get_address },\n\t{ \"AddressType\", \"s\", property_get_address_type },\n\t{ \"Name\", \"s\", dev_property_get_name, NULL, dev_property_exists_name },\n\t{ \"Alias\", \"s\", dev_property_get_alias, dev_property_set_alias },\n\t{ \"Class\", \"u\", dev_property_get_class, NULL,\n\t\t\t\t\tdev_property_exists_class },\n\t{ \"Appearance\", \"q\", dev_property_get_appearance, NULL,\n\t\t\t\t\tdev_property_exists_appearance },\n\t{ \"Icon\", \"s\", dev_property_get_icon, NULL,\n\t\t\t\t\tdev_property_exists_icon },\n\t{ \"Paired\", \"b\", dev_property_get_paired },\n\t{ \"Trusted\", \"b\", dev_property_get_trusted, dev_property_set_trusted },\n\t{ \"Blocked\", \"b\", dev_property_get_blocked, dev_property_set_blocked },\n\t{ \"LegacyPairing\", \"b\", dev_property_get_legacy },\n\t{ \"RSSI\", \"n\", dev_property_get_rssi, NULL, dev_property_exists_rssi },\n\t{ \"Connected\", \"b\", dev_property_get_connected },\n\t{ \"UUIDs\", \"as\", dev_property_get_uuids },\n\t{ \"Modalias\", \"s\", dev_property_get_modalias, NULL,\n\t\t\t\t\t\tdev_property_exists_modalias },\n\t{ \"Adapter\", \"o\", dev_property_get_adapter },\n\t{ \"ManufacturerData\", \"a{qv}\", dev_property_get_manufacturer_data,\n\t\t\t\tNULL, dev_property_manufacturer_data_exist },\n\t{ \"ServiceData\", \"a{sv}\", dev_property_get_service_data,\n\t\t\t\tNULL, dev_property_service_data_exist },\n\t{ \"TxPower\", \"n\", dev_property_get_tx_power, NULL,\n\t\t\t\t\tdev_property_exists_tx_power },\n\t{ \"ServicesResolved\", \"b\", dev_property_get_svc_resolved, NULL, NULL },\n\t{ \"AdvertisingFlags\", \"ay\", dev_property_get_flags, NULL,\n\t\t\t\t\tdev_property_flags_exist,\n\t\t\t\t\tG_DBUS_PROPERTY_FLAG_EXPERIMENTAL},\n\t{ \"AdvertisingData\", \"a{yv}\", dev_property_get_advertising_data,\n\t\t\t\tNULL, dev_property_advertising_data_exist,\n\t\t\t\tG_DBUS_PROPERTY_FLAG_EXPERIMENTAL },\n\t{ }\n};",
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "btd_device_ref",
          "args": [
            "device"
          ],
          "line": 3811
        },
        "resolved": true,
        "details": {
          "function_name": "btd_device_ref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "6357-6362",
          "snippet": "struct btd_device *btd_device_ref(struct btd_device *device)\n{\n\t__sync_fetch_and_add(&device->ref_count, 1);\n\n\treturn device;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstruct btd_device *btd_device_ref(struct btd_device *device)\n{\n\t__sync_fetch_and_add(&device->ref_count, 1);\n\n\treturn device;\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_register",
          "args": [
            "device->db",
            "gatt_service_added",
            "gatt_service_removed",
            "device",
            "NULL"
          ],
          "line": 3808
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_register",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "592-620",
          "snippet": "unsigned int gatt_db_register(struct gatt_db *db,\n\t\t\t\t\tgatt_db_attribute_cb_t service_added,\n\t\t\t\t\tgatt_db_attribute_cb_t service_removed,\n\t\t\t\t\tvoid *user_data,\n\t\t\t\t\tgatt_db_destroy_func_t destroy)\n{\n\tstruct notify *notify;\n\n\tif (!db || !(service_added || service_removed))\n\t\treturn 0;\n\n\tnotify = new0(struct notify, 1);\n\tnotify->service_added = service_added;\n\tnotify->service_removed = service_removed;\n\tnotify->destroy = destroy;\n\tnotify->user_data = user_data;\n\n\tif (db->next_notify_id < 1)\n\t\tdb->next_notify_id = 1;\n\n\tnotify->id = db->next_notify_id++;\n\n\tif (!queue_push_tail(db->notify_list, notify)) {\n\t\tfree(notify);\n\t\treturn 0;\n\t}\n\n\treturn notify->id;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nunsigned int gatt_db_register(struct gatt_db *db,\n\t\t\t\t\tgatt_db_attribute_cb_t service_added,\n\t\t\t\t\tgatt_db_attribute_cb_t service_removed,\n\t\t\t\t\tvoid *user_data,\n\t\t\t\t\tgatt_db_destroy_func_t destroy)\n{\n\tstruct notify *notify;\n\n\tif (!db || !(service_added || service_removed))\n\t\treturn 0;\n\n\tnotify = new0(struct notify, 1);\n\tnotify->service_added = service_added;\n\tnotify->service_removed = service_removed;\n\tnotify->destroy = destroy;\n\tnotify->user_data = user_data;\n\n\tif (db->next_notify_id < 1)\n\t\tdb->next_notify_id = 1;\n\n\tnotify->id = db->next_notify_id++;\n\n\tif (!queue_push_tail(db->notify_list, notify)) {\n\t\tfree(notify);\n\t\treturn 0;\n\t}\n\n\treturn notify->id;\n}"
        }
      },
      {
        "call_info": {
          "callee": "device_free",
          "args": [
            "device"
          ],
          "line": 3801
        },
        "resolved": true,
        "details": {
          "function_name": "device_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "640-694",
          "snippet": "static void device_free(gpointer user_data)\n{\n\tstruct btd_device *device = user_data;\n\n\tbtd_gatt_client_destroy(device->client_dbus);\n\tdevice->client_dbus = NULL;\n\n\tg_slist_free_full(device->uuids, g_free);\n\tg_slist_free_full(device->primaries, g_free);\n\tg_slist_free_full(device->svc_callbacks, svc_dev_remove);\n\n\t/* Reset callbacks since the device is going to be freed */\n\tgatt_db_unregister(device->db, device->db_id);\n\n\tattio_cleanup(device);\n\n\tgatt_db_unref(device->db);\n\n\tbt_ad_unref(device->ad);\n\n\tif (device->tmp_records)\n\t\tsdp_list_free(device->tmp_records,\n\t\t\t\t\t(sdp_free_func_t) sdp_record_free);\n\n\tif (device->disconn_timer)\n\t\tg_source_remove(device->disconn_timer);\n\n\tif (device->discov_timer)\n\t\tg_source_remove(device->discov_timer);\n\n\tif (device->connect)\n\t\tdbus_message_unref(device->connect);\n\n\tif (device->disconnect)\n\t\tdbus_message_unref(device->disconnect);\n\n\tDBG(\"%p\", device);\n\n\tif (device->authr) {\n\t\tif (device->authr->agent)\n\t\t\tagent_unref(device->authr->agent);\n\t\tg_free(device->authr->pincode);\n\t\tg_free(device->authr);\n\t}\n\n\tif (device->eir_uuids)\n\t\tg_slist_free_full(device->eir_uuids, g_free);\n\n\tg_free(device->local_csrk);\n\tg_free(device->remote_csrk);\n\tg_free(device->path);\n\tg_free(device->alias);\n\tfree(device->modalias);\n\tg_free(device);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void device_free(gpointer user_data)\n{\n\tstruct btd_device *device = user_data;\n\n\tbtd_gatt_client_destroy(device->client_dbus);\n\tdevice->client_dbus = NULL;\n\n\tg_slist_free_full(device->uuids, g_free);\n\tg_slist_free_full(device->primaries, g_free);\n\tg_slist_free_full(device->svc_callbacks, svc_dev_remove);\n\n\t/* Reset callbacks since the device is going to be freed */\n\tgatt_db_unregister(device->db, device->db_id);\n\n\tattio_cleanup(device);\n\n\tgatt_db_unref(device->db);\n\n\tbt_ad_unref(device->ad);\n\n\tif (device->tmp_records)\n\t\tsdp_list_free(device->tmp_records,\n\t\t\t\t\t(sdp_free_func_t) sdp_record_free);\n\n\tif (device->disconn_timer)\n\t\tg_source_remove(device->disconn_timer);\n\n\tif (device->discov_timer)\n\t\tg_source_remove(device->discov_timer);\n\n\tif (device->connect)\n\t\tdbus_message_unref(device->connect);\n\n\tif (device->disconnect)\n\t\tdbus_message_unref(device->disconnect);\n\n\tDBG(\"%p\", device);\n\n\tif (device->authr) {\n\t\tif (device->authr->agent)\n\t\t\tagent_unref(device->authr->agent);\n\t\tg_free(device->authr->pincode);\n\t\tg_free(device->authr);\n\t}\n\n\tif (device->eir_uuids)\n\t\tg_slist_free_full(device->eir_uuids, g_free);\n\n\tg_free(device->local_csrk);\n\tg_free(device->remote_csrk);\n\tg_free(device->path);\n\tg_free(device->alias);\n\tfree(device->modalias);\n\tg_free(device);\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Unable to register device interface for %s\"",
            "address"
          ],
          "line": 3800
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "124-128",
          "snippet": "DBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_register_interface",
          "args": [
            "dbus_conn",
            "device->path",
            "DEVICE_INTERFACE",
            "device_methods",
            "NULL",
            "device_properties",
            "device",
            "device_free"
          ],
          "line": 3795
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Creating device %s\"",
            "device->path"
          ],
          "line": 3793
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Failed to create btd_gatt_client\""
          ],
          "line": 3788
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_not_ready",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "118-122",
          "snippet": "DBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_gatt_client_new",
          "args": [
            "device"
          ],
          "line": 3786
        },
        "resolved": true,
        "details": {
          "function_name": "btd_gatt_client_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "2065-2087",
          "snippet": "struct btd_gatt_client *btd_gatt_client_new(struct btd_device *device)\n{\n\tstruct btd_gatt_client *client;\n\tstruct gatt_db *db;\n\n\tif (!device)\n\t\treturn NULL;\n\n\tdb = btd_device_get_gatt_db(device);\n\tif (!db)\n\t\treturn NULL;\n\n\tclient = new0(struct btd_gatt_client, 1);\n\tclient->services = queue_new();\n\tclient->all_notify_clients = queue_new();\n\tclient->ios = queue_new();\n\tclient->device = device;\n\tba2str(device_get_address(device), client->devaddr);\n\n\tclient->db = gatt_db_ref(db);\n\n\treturn client;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstruct btd_gatt_client *btd_gatt_client_new(struct btd_device *device)\n{\n\tstruct btd_gatt_client *client;\n\tstruct gatt_db *db;\n\n\tif (!device)\n\t\treturn NULL;\n\n\tdb = btd_device_get_gatt_db(device);\n\tif (!db)\n\t\treturn NULL;\n\n\tclient = new0(struct btd_gatt_client, 1);\n\tclient->services = queue_new();\n\tclient->all_notify_clients = queue_new();\n\tclient->ios = queue_new();\n\tclient->device = device;\n\tba2str(device_get_address(device), client->devaddr);\n\n\tclient->db = gatt_db_ref(db);\n\n\treturn client;\n}"
        }
      },
      {
        "call_info": {
          "callee": "str2ba",
          "args": [
            "address",
            "&device->bdaddr"
          ],
          "line": 3784
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "address_up"
          ],
          "line": 3782
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdelimit",
          "args": [
            "device->path",
            "\":\"",
            "'_'"
          ],
          "line": 3781
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"%s/dev_%s\"",
            "adapter_path",
            "address_up"
          ],
          "line": 3780
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_ascii_strup",
          "args": [
            "address",
            "-1"
          ],
          "line": 3779
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_ad_new",
          "args": [],
          "line": 3773
        },
        "resolved": true,
        "details": {
          "function_name": "bt_ad_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "43-56",
          "snippet": "struct bt_ad *bt_ad_new(void)\n{\n\tstruct bt_ad *ad;\n\n\tad = new0(struct bt_ad, 1);\n\tad->service_uuids = queue_new();\n\tad->manufacturer_data = queue_new();\n\tad->solicit_uuids = queue_new();\n\tad->service_data = queue_new();\n\tad->data = queue_new();\n\tad->appearance = UINT16_MAX;\n\n\treturn bt_ad_ref(ad);\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstruct bt_ad *bt_ad_new(void)\n{\n\tstruct bt_ad *ad;\n\n\tad = new0(struct bt_ad, 1);\n\tad->service_uuids = queue_new();\n\tad->manufacturer_data = queue_new();\n\tad->solicit_uuids = queue_new();\n\tad->service_data = queue_new();\n\tad->data = queue_new();\n\tad->appearance = UINT16_MAX;\n\n\treturn bt_ad_ref(ad);\n}"
        }
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "device->ad_flags",
            "INVALID_FLAGS",
            "sizeof(device->ad_flags)"
          ],
          "line": 3771
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "device"
          ],
          "line": 3767
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gatt_db_new",
          "args": [],
          "line": 3765
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "220-230",
          "snippet": "struct gatt_db *gatt_db_new(void)\n{\n\tstruct gatt_db *db;\n\n\tdb = new0(struct gatt_db, 1);\n\tdb->services = queue_new();\n\tdb->notify_list = queue_new();\n\tdb->next_handle = 0x0001;\n\n\treturn gatt_db_ref(db);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstruct gatt_db *gatt_db_new(void)\n{\n\tstruct gatt_db *db;\n\n\tdb = new0(struct gatt_db, 1);\n\tdb->services = queue_new();\n\tdb->notify_list = queue_new();\n\tdb->next_handle = 0x0001;\n\n\treturn gatt_db_ref(db);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_try_malloc0",
          "args": [
            "sizeof(struct btd_device)"
          ],
          "line": 3759
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"address %s\"",
            "address"
          ],
          "line": 3757
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "adapter_get_path",
          "args": [
            "adapter"
          ],
          "line": 3755
        },
        "resolved": true,
        "details": {
          "function_name": "adapter_get_path",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "5873-5879",
          "snippet": "const char *adapter_get_path(struct btd_adapter *adapter)\n{\n\tif (!adapter)\n\t\treturn NULL;\n\n\treturn adapter->path;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nconst char *adapter_get_path(struct btd_adapter *adapter)\n{\n\tif (!adapter)\n\t\treturn NULL;\n\n\treturn adapter->path;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\n#define INVALID_FLAGS\t\t0xff\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic const GDBusMethodTable device_methods[] = {\n\t{ GDBUS_ASYNC_METHOD(\"Disconnect\", NULL, NULL, dev_disconnect) },\n\t{ GDBUS_ASYNC_METHOD(\"Connect\", NULL, NULL, dev_connect) },\n\t{ GDBUS_ASYNC_METHOD(\"ConnectProfile\", GDBUS_ARGS({ \"UUID\", \"s\" }),\n\t\t\t\t\t\tNULL, connect_profile) },\n\t{ GDBUS_ASYNC_METHOD(\"DisconnectProfile\", GDBUS_ARGS({ \"UUID\", \"s\" }),\n\t\t\t\t\t\tNULL, disconnect_profile) },\n\t{ GDBUS_ASYNC_METHOD(\"Pair\", NULL, NULL, pair_device) },\n\t{ GDBUS_METHOD(\"CancelPairing\", NULL, NULL, cancel_pairing) },\n\t{ }\n};\nstatic const GDBusPropertyTable device_properties[] = {\n\t{ \"Address\", \"s\", dev_property_get_address },\n\t{ \"AddressType\", \"s\", property_get_address_type },\n\t{ \"Name\", \"s\", dev_property_get_name, NULL, dev_property_exists_name },\n\t{ \"Alias\", \"s\", dev_property_get_alias, dev_property_set_alias },\n\t{ \"Class\", \"u\", dev_property_get_class, NULL,\n\t\t\t\t\tdev_property_exists_class },\n\t{ \"Appearance\", \"q\", dev_property_get_appearance, NULL,\n\t\t\t\t\tdev_property_exists_appearance },\n\t{ \"Icon\", \"s\", dev_property_get_icon, NULL,\n\t\t\t\t\tdev_property_exists_icon },\n\t{ \"Paired\", \"b\", dev_property_get_paired },\n\t{ \"Trusted\", \"b\", dev_property_get_trusted, dev_property_set_trusted },\n\t{ \"Blocked\", \"b\", dev_property_get_blocked, dev_property_set_blocked },\n\t{ \"LegacyPairing\", \"b\", dev_property_get_legacy },\n\t{ \"RSSI\", \"n\", dev_property_get_rssi, NULL, dev_property_exists_rssi },\n\t{ \"Connected\", \"b\", dev_property_get_connected },\n\t{ \"UUIDs\", \"as\", dev_property_get_uuids },\n\t{ \"Modalias\", \"s\", dev_property_get_modalias, NULL,\n\t\t\t\t\t\tdev_property_exists_modalias },\n\t{ \"Adapter\", \"o\", dev_property_get_adapter },\n\t{ \"ManufacturerData\", \"a{qv}\", dev_property_get_manufacturer_data,\n\t\t\t\tNULL, dev_property_manufacturer_data_exist },\n\t{ \"ServiceData\", \"a{sv}\", dev_property_get_service_data,\n\t\t\t\tNULL, dev_property_service_data_exist },\n\t{ \"TxPower\", \"n\", dev_property_get_tx_power, NULL,\n\t\t\t\t\tdev_property_exists_tx_power },\n\t{ \"ServicesResolved\", \"b\", dev_property_get_svc_resolved, NULL, NULL },\n\t{ \"AdvertisingFlags\", \"ay\", dev_property_get_flags, NULL,\n\t\t\t\t\tdev_property_flags_exist,\n\t\t\t\t\tG_DBUS_PROPERTY_FLAG_EXPERIMENTAL},\n\t{ \"AdvertisingData\", \"a{yv}\", dev_property_get_advertising_data,\n\t\t\t\tNULL, dev_property_advertising_data_exist,\n\t\t\t\tG_DBUS_PROPERTY_FLAG_EXPERIMENTAL },\n\t{ }\n};\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic struct btd_device *device_new(struct btd_adapter *adapter,\n\t\t\t\tconst char *address)\n{\n\tchar *address_up;\n\tstruct btd_device *device;\n\tconst char *adapter_path = adapter_get_path(adapter);\n\n\tDBG(\"address %s\", address);\n\n\tdevice = g_try_malloc0(sizeof(struct btd_device));\n\tif (device == NULL)\n\t\treturn NULL;\n\n\tdevice->tx_power = 127;\n\n\tdevice->db = gatt_db_new();\n\tif (!device->db) {\n\t\tg_free(device);\n\t\treturn NULL;\n\t}\n\n\tmemset(device->ad_flags, INVALID_FLAGS, sizeof(device->ad_flags));\n\n\tdevice->ad = bt_ad_new();\n\tif (!device->ad) {\n\t\tdevice_free(device);\n\t\treturn NULL;\n\t}\n\n\taddress_up = g_ascii_strup(address, -1);\n\tdevice->path = g_strdup_printf(\"%s/dev_%s\", adapter_path, address_up);\n\tg_strdelimit(device->path, \":\", '_');\n\tg_free(address_up);\n\n\tstr2ba(address, &device->bdaddr);\n\n\tdevice->client_dbus = btd_gatt_client_new(device);\n\tif (!device->client_dbus) {\n\t\terror(\"Failed to create btd_gatt_client\");\n\t\tdevice_free(device);\n\t\treturn NULL;\n\t}\n\n\tDBG(\"Creating device %s\", device->path);\n\n\tif (g_dbus_register_interface(dbus_conn,\n\t\t\t\t\tdevice->path, DEVICE_INTERFACE,\n\t\t\t\t\tdevice_methods, NULL,\n\t\t\t\t\tdevice_properties, device,\n\t\t\t\t\tdevice_free) == FALSE) {\n\t\terror(\"Unable to register device interface for %s\", address);\n\t\tdevice_free(device);\n\t\treturn NULL;\n\t}\n\n\tdevice->adapter = adapter;\n\tdevice->temporary = true;\n\n\tdevice->db_id = gatt_db_register(device->db, gatt_service_added,\n\t\t\t\t\tgatt_service_removed, device, NULL);\n\n\treturn btd_device_ref(device);\n}"
  },
  {
    "function_name": "gatt_service_removed",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "3680-3748",
    "snippet": "static void gatt_service_removed(struct gatt_db_attribute *attr,\n\t\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct btd_device *device = user_data;\n\tGSList *l;\n\tstruct gatt_primary *prim;\n\tuint16_t start, end;\n\n\t/*\n\t * NOTE: shared/gatt-client clears the database in case of failure. This\n\t * triggers the service_removed callback for all affected services.\n\t * Hence, this function will be called in the following cases:\n\t *\n\t *    1. When a GATT service gets removed due to \"Service Changed\".\n\t *\n\t *    2. When a GATT service gets removed when the database get cleared\n\t *       upon disconnection with a non-bonded device.\n\t *\n\t *    3. When a GATT service gets removed when the database get cleared\n\t *       by shared/gatt-client when its initialization procedure fails,\n\t *       e.g. due to an ATT protocol error or an unexpected disconnect.\n\t *       In this case the gatt-client will not be ready.\n\t */\n\n\tgatt_db_attribute_get_service_handles(attr, &start, &end);\n\n\tDBG(\"start: 0x%04x, end: 0x%04x\", start, end);\n\n\t/* Remove the corresponding gatt_primary */\n\tl = g_slist_find_custom(device->primaries, attr, prim_attr_cmp);\n\tif (!l)\n\t\treturn;\n\n\tprim = l->data;\n\tdevice->primaries = g_slist_delete_link(device->primaries, l);\n\n\t/*\n\t * Remove the corresponding UUIDs entry and profile, only if this is\n\t * the last service with this UUID.\n\t */\n\tl = g_slist_find_custom(device->uuids, prim->uuid, bt_uuid_strcmp);\n\n\tif (l && !g_slist_find_custom(device->primaries, prim->uuid,\n\t\t\t\t\t\t\tprim_uuid_cmp)) {\n\t\t/*\n\t\t * If this happend since the db was cleared for a non-bonded\n\t\t * device, then don't remove the btd_service just yet. We do\n\t\t * this so that we can avoid re-probing the profile if the same\n\t\t * GATT service is found on the device on re-connection.\n\t\t * However, if the device is marked as temporary, then we\n\t\t * remove it anyway.\n\t\t */\n\t\tif (device->client || device->temporary == TRUE)\n\t\t\tdevice_remove_gatt_service(device, attr);\n\n\t\tg_free(l->data);\n\t\tdevice->uuids = g_slist_delete_link(device->uuids, l);\n\t\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"UUIDs\");\n\t}\n\n\tg_free(prim);\n\n\tstore_device_info(device);\n\n\tbtd_gatt_client_service_removed(device->client_dbus, attr);\n\n\tgatt_services_changed(device);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static DBusConnection *dbus_conn = NULL;",
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "gatt_services_changed",
          "args": [
            "device"
          ],
          "line": 3747
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_services_changed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "3622-3629",
          "snippet": "static gboolean gatt_services_changed(gpointer user_data)\n{\n\tstruct btd_device *device = user_data;\n\n\tstore_gatt_db(device);\n\n\treturn FALSE;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic gboolean gatt_services_changed(gpointer user_data)\n{\n\tstruct btd_device *device = user_data;\n\n\tstore_gatt_db(device);\n\n\treturn FALSE;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_gatt_client_service_removed",
          "args": [
            "device->client_dbus",
            "attr"
          ],
          "line": 3745
        },
        "resolved": true,
        "details": {
          "function_name": "btd_gatt_client_service_removed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "2186-2202",
          "snippet": "void btd_gatt_client_service_removed(struct btd_gatt_client *client,\n\t\t\t\t\tstruct gatt_db_attribute *attrib)\n{\n\tuint16_t start_handle, end_handle;\n\n\tif (!client || !attrib || !client->ready)\n\t\treturn;\n\n\tgatt_db_attribute_get_service_handles(attrib, &start_handle,\n\t\t\t\t\t\t\t\t&end_handle);\n\n\tDBG(\"GATT Services Removed - start: 0x%04x, end: 0x%04x\", start_handle,\n\t\t\t\t\t\t\t\tend_handle);\n\tqueue_remove_all(client->services, match_service_handle,\n\t\t\t\t\t\tUINT_TO_PTR(start_handle),\n\t\t\t\t\t\tunregister_service);\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nvoid btd_gatt_client_service_removed(struct btd_gatt_client *client,\n\t\t\t\t\tstruct gatt_db_attribute *attrib)\n{\n\tuint16_t start_handle, end_handle;\n\n\tif (!client || !attrib || !client->ready)\n\t\treturn;\n\n\tgatt_db_attribute_get_service_handles(attrib, &start_handle,\n\t\t\t\t\t\t\t\t&end_handle);\n\n\tDBG(\"GATT Services Removed - start: 0x%04x, end: 0x%04x\", start_handle,\n\t\t\t\t\t\t\t\tend_handle);\n\tqueue_remove_all(client->services, match_service_handle,\n\t\t\t\t\t\tUINT_TO_PTR(start_handle),\n\t\t\t\t\t\tunregister_service);\n}"
        }
      },
      {
        "call_info": {
          "callee": "store_device_info",
          "args": [
            "device"
          ],
          "line": 3743
        },
        "resolved": true,
        "details": {
          "function_name": "store_device_info",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "475-487",
          "snippet": "static void store_device_info(struct btd_device *device)\n{\n\tif (device->temporary || device->store_id > 0)\n\t\treturn;\n\n\tif (device_address_is_private(device)) {\n\t\tDBG(\"Can't store info for private addressed device %s\",\n\t\t\t\t\t\t\t\tdevice->path);\n\t\treturn;\n\t}\n\n\tdevice->store_id = g_idle_add(store_device_info_cb, device);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void store_device_info(struct btd_device *device)\n{\n\tif (device->temporary || device->store_id > 0)\n\t\treturn;\n\n\tif (device_address_is_private(device)) {\n\t\tDBG(\"Can't store info for private addressed device %s\",\n\t\t\t\t\t\t\t\tdevice->path);\n\t\treturn;\n\t}\n\n\tdevice->store_id = g_idle_add(store_device_info_cb, device);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "prim"
          ],
          "line": 3741
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_emit_property_changed",
          "args": [
            "dbus_conn",
            "device->path",
            "DEVICE_INTERFACE",
            "\"UUIDs\""
          ],
          "line": 3737
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_delete_link",
          "args": [
            "device->uuids",
            "l"
          ],
          "line": 3736
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "l->data"
          ],
          "line": 3735
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device_remove_gatt_service",
          "args": [
            "device",
            "attr"
          ],
          "line": 3733
        },
        "resolved": true,
        "details": {
          "function_name": "device_remove_gatt_service",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "3601-3620",
          "snippet": "static void device_remove_gatt_service(struct btd_device *device,\n\t\t\t\t\t\tstruct gatt_db_attribute *attr)\n{\n\tstruct btd_service *service;\n\tbt_uuid_t uuid;\n\tchar uuid_str[MAX_LEN_UUID_STR];\n\tGSList *l;\n\n\tgatt_db_attribute_get_service_uuid(attr, &uuid);\n\tbt_uuid_to_string(&uuid, uuid_str, sizeof(uuid_str));\n\n\tl = find_service_with_uuid(device->services, uuid_str);\n\tif (!l)\n\t\treturn;\n\n\tservice = l->data;\n\tdevice->services = g_slist_delete_link(device->services, l);\n\tdevice->pending = g_slist_remove(device->pending, service);\n\tservice_remove(service);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void device_remove_gatt_service(struct btd_device *device,\n\t\t\t\t\t\tstruct gatt_db_attribute *attr)\n{\n\tstruct btd_service *service;\n\tbt_uuid_t uuid;\n\tchar uuid_str[MAX_LEN_UUID_STR];\n\tGSList *l;\n\n\tgatt_db_attribute_get_service_uuid(attr, &uuid);\n\tbt_uuid_to_string(&uuid, uuid_str, sizeof(uuid_str));\n\n\tl = find_service_with_uuid(device->services, uuid_str);\n\tif (!l)\n\t\treturn;\n\n\tservice = l->data;\n\tdevice->services = g_slist_delete_link(device->services, l);\n\tdevice->pending = g_slist_remove(device->pending, service);\n\tservice_remove(service);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_slist_find_custom",
          "args": [
            "device->primaries",
            "prim->uuid",
            "prim_uuid_cmp"
          ],
          "line": 3722
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_find_custom",
          "args": [
            "device->uuids",
            "prim->uuid",
            "bt_uuid_strcmp"
          ],
          "line": 3720
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_delete_link",
          "args": [
            "device->primaries",
            "l"
          ],
          "line": 3714
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_find_custom",
          "args": [
            "device->primaries",
            "attr",
            "prim_attr_cmp"
          ],
          "line": 3709
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"start: 0x%04x, end: 0x%04x\"",
            "start",
            "end"
          ],
          "line": 3706
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gatt_db_attribute_get_service_handles",
          "args": [
            "attr",
            "&start",
            "&end"
          ],
          "line": 3704
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_get_service_handles",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1521-1536",
          "snippet": "bool gatt_db_attribute_get_service_handles(\n\t\t\t\t\tconst struct gatt_db_attribute *attrib,\n\t\t\t\t\tuint16_t *start_handle,\n\t\t\t\t\tuint16_t *end_handle)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!attrib)\n\t\treturn false;\n\n\tservice = attrib->service;\n\n\tgatt_db_service_get_handles(service, start_handle, end_handle);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_attribute_get_service_handles(\n\t\t\t\t\tconst struct gatt_db_attribute *attrib,\n\t\t\t\t\tuint16_t *start_handle,\n\t\t\t\t\tuint16_t *end_handle)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!attrib)\n\t\treturn false;\n\n\tservice = attrib->service;\n\n\tgatt_db_service_get_handles(service, start_handle, end_handle);\n\n\treturn true;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void gatt_service_removed(struct gatt_db_attribute *attr,\n\t\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct btd_device *device = user_data;\n\tGSList *l;\n\tstruct gatt_primary *prim;\n\tuint16_t start, end;\n\n\t/*\n\t * NOTE: shared/gatt-client clears the database in case of failure. This\n\t * triggers the service_removed callback for all affected services.\n\t * Hence, this function will be called in the following cases:\n\t *\n\t *    1. When a GATT service gets removed due to \"Service Changed\".\n\t *\n\t *    2. When a GATT service gets removed when the database get cleared\n\t *       upon disconnection with a non-bonded device.\n\t *\n\t *    3. When a GATT service gets removed when the database get cleared\n\t *       by shared/gatt-client when its initialization procedure fails,\n\t *       e.g. due to an ATT protocol error or an unexpected disconnect.\n\t *       In this case the gatt-client will not be ready.\n\t */\n\n\tgatt_db_attribute_get_service_handles(attr, &start, &end);\n\n\tDBG(\"start: 0x%04x, end: 0x%04x\", start, end);\n\n\t/* Remove the corresponding gatt_primary */\n\tl = g_slist_find_custom(device->primaries, attr, prim_attr_cmp);\n\tif (!l)\n\t\treturn;\n\n\tprim = l->data;\n\tdevice->primaries = g_slist_delete_link(device->primaries, l);\n\n\t/*\n\t * Remove the corresponding UUIDs entry and profile, only if this is\n\t * the last service with this UUID.\n\t */\n\tl = g_slist_find_custom(device->uuids, prim->uuid, bt_uuid_strcmp);\n\n\tif (l && !g_slist_find_custom(device->primaries, prim->uuid,\n\t\t\t\t\t\t\tprim_uuid_cmp)) {\n\t\t/*\n\t\t * If this happend since the db was cleared for a non-bonded\n\t\t * device, then don't remove the btd_service just yet. We do\n\t\t * this so that we can avoid re-probing the profile if the same\n\t\t * GATT service is found on the device on re-connection.\n\t\t * However, if the device is marked as temporary, then we\n\t\t * remove it anyway.\n\t\t */\n\t\tif (device->client || device->temporary == TRUE)\n\t\t\tdevice_remove_gatt_service(device, attr);\n\n\t\tg_free(l->data);\n\t\tdevice->uuids = g_slist_delete_link(device->uuids, l);\n\t\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"UUIDs\");\n\t}\n\n\tg_free(prim);\n\n\tstore_device_info(device);\n\n\tbtd_gatt_client_service_removed(device->client_dbus, attr);\n\n\tgatt_services_changed(device);\n}"
  },
  {
    "function_name": "prim_uuid_cmp",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "3672-3678",
    "snippet": "static gint prim_uuid_cmp(gconstpointer a, gconstpointer b)\n{\n\tconst struct gatt_primary *prim = a;\n\tconst char *uuid = b;\n\n\treturn bt_uuid_strcmp(prim->uuid, uuid);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bt_uuid_strcmp",
          "args": [
            "prim->uuid",
            "uuid"
          ],
          "line": 3677
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic gint prim_uuid_cmp(gconstpointer a, gconstpointer b)\n{\n\tconst struct gatt_primary *prim = a;\n\tconst char *uuid = b;\n\n\treturn bt_uuid_strcmp(prim->uuid, uuid);\n}"
  },
  {
    "function_name": "prim_attr_cmp",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "3661-3670",
    "snippet": "static gint prim_attr_cmp(gconstpointer a, gconstpointer b)\n{\n\tconst struct gatt_primary *prim = a;\n\tconst struct gatt_db_attribute *attr = b;\n\tuint16_t start, end;\n\n\tgatt_db_attribute_get_service_handles(attr, &start, &end);\n\n\treturn !(prim->range.start == start && prim->range.end == end);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "gatt_db_attribute_get_service_handles",
          "args": [
            "attr",
            "&start",
            "&end"
          ],
          "line": 3667
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_get_service_handles",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1521-1536",
          "snippet": "bool gatt_db_attribute_get_service_handles(\n\t\t\t\t\tconst struct gatt_db_attribute *attrib,\n\t\t\t\t\tuint16_t *start_handle,\n\t\t\t\t\tuint16_t *end_handle)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!attrib)\n\t\treturn false;\n\n\tservice = attrib->service;\n\n\tgatt_db_service_get_handles(service, start_handle, end_handle);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_attribute_get_service_handles(\n\t\t\t\t\tconst struct gatt_db_attribute *attrib,\n\t\t\t\t\tuint16_t *start_handle,\n\t\t\t\t\tuint16_t *end_handle)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!attrib)\n\t\treturn false;\n\n\tservice = attrib->service;\n\n\tgatt_db_service_get_handles(service, start_handle, end_handle);\n\n\treturn true;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic gint prim_attr_cmp(gconstpointer a, gconstpointer b)\n{\n\tconst struct gatt_primary *prim = a;\n\tconst struct gatt_db_attribute *attr = b;\n\tuint16_t start, end;\n\n\tgatt_db_attribute_get_service_handles(attr, &start, &end);\n\n\treturn !(prim->range.start == start && prim->range.end == end);\n}"
  },
  {
    "function_name": "gatt_service_added",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "3631-3659",
    "snippet": "static void gatt_service_added(struct gatt_db_attribute *attr, void *user_data)\n{\n\tstruct btd_device *device = user_data;\n\tGSList *new_service = NULL;\n\tuint16_t start, end;\n\n\tif (!bt_gatt_client_is_ready(device->client))\n\t\treturn;\n\n\tgatt_db_attribute_get_service_data(attr, &start, &end, NULL, NULL);\n\n\tDBG(\"start: 0x%04x, end: 0x%04x\", start, end);\n\n\t/*\n\t * TODO: Remove the primaries list entirely once all profiles use\n\t * shared/gatt.\n\t */\n\tadd_primary(attr, &new_service);\n\tif (!new_service)\n\t\treturn;\n\n\tdevice_register_primaries(device, new_service, -1);\n\n\tadd_gatt_service(attr, device);\n\n\tbtd_gatt_client_service_added(device->client_dbus, attr);\n\n\tgatt_services_changed(device);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "gatt_services_changed",
          "args": [
            "device"
          ],
          "line": 3658
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_services_changed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "3622-3629",
          "snippet": "static gboolean gatt_services_changed(gpointer user_data)\n{\n\tstruct btd_device *device = user_data;\n\n\tstore_gatt_db(device);\n\n\treturn FALSE;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic gboolean gatt_services_changed(gpointer user_data)\n{\n\tstruct btd_device *device = user_data;\n\n\tstore_gatt_db(device);\n\n\treturn FALSE;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_gatt_client_service_added",
          "args": [
            "device->client_dbus",
            "attr"
          ],
          "line": 3656
        },
        "resolved": true,
        "details": {
          "function_name": "btd_gatt_client_service_added",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "2175-2184",
          "snippet": "void btd_gatt_client_service_added(struct btd_gatt_client *client,\n\t\t\t\t\tstruct gatt_db_attribute *attrib)\n{\n\tif (!client || !attrib || !client->ready)\n\t\treturn;\n\n\texport_service(attrib, client);\n\n\tqueue_foreach(client->services, update_included_services, client);\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nvoid btd_gatt_client_service_added(struct btd_gatt_client *client,\n\t\t\t\t\tstruct gatt_db_attribute *attrib)\n{\n\tif (!client || !attrib || !client->ready)\n\t\treturn;\n\n\texport_service(attrib, client);\n\n\tqueue_foreach(client->services, update_included_services, client);\n}"
        }
      },
      {
        "call_info": {
          "callee": "add_gatt_service",
          "args": [
            "attr",
            "device"
          ],
          "line": 3654
        },
        "resolved": true,
        "details": {
          "function_name": "add_gatt_service",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "3537-3577",
          "snippet": "static void add_gatt_service(struct gatt_db_attribute *attr, void *user_data)\n{\n\tstruct btd_device *device = user_data;\n\tstruct btd_service *service;\n\tstruct btd_profile *profile;\n\tbt_uuid_t uuid;\n\tchar uuid_str[MAX_LEN_UUID_STR];\n\tGSList *l;\n\n\tgatt_db_attribute_get_service_uuid(attr, &uuid);\n\tbt_uuid_to_string(&uuid, uuid_str, sizeof(uuid_str));\n\n\t/* Check if service was already probed */\n\tl = find_service_with_uuid(device->services, uuid_str);\n\tif (l)\n\t\tgoto done;\n\n\t/* Add UUID and probe service */\n\tbtd_device_add_uuid(device, uuid_str);\n\n\t/* Check if service was probed */\n\tl = find_service_with_uuid(device->services, uuid_str);\n\tif (!l)\n\t\treturn;\n\ndone:\n\t/* Mark service as active to skip discovering it again */\n\tgatt_db_service_set_active(attr, true);\n\n\tservice = l->data;\n\tprofile = btd_service_get_profile(service);\n\n\t/* Claim attributes of internal profiles */\n\tif (!profile->external) {\n\t\t/* Mark the service as claimed by the existing profile. */\n\t\tgatt_db_service_set_claimed(attr, true);\n\t}\n\n\t/* Notify driver about the new connection */\n\tservice_accept(service);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void add_gatt_service(struct gatt_db_attribute *attr, void *user_data)\n{\n\tstruct btd_device *device = user_data;\n\tstruct btd_service *service;\n\tstruct btd_profile *profile;\n\tbt_uuid_t uuid;\n\tchar uuid_str[MAX_LEN_UUID_STR];\n\tGSList *l;\n\n\tgatt_db_attribute_get_service_uuid(attr, &uuid);\n\tbt_uuid_to_string(&uuid, uuid_str, sizeof(uuid_str));\n\n\t/* Check if service was already probed */\n\tl = find_service_with_uuid(device->services, uuid_str);\n\tif (l)\n\t\tgoto done;\n\n\t/* Add UUID and probe service */\n\tbtd_device_add_uuid(device, uuid_str);\n\n\t/* Check if service was probed */\n\tl = find_service_with_uuid(device->services, uuid_str);\n\tif (!l)\n\t\treturn;\n\ndone:\n\t/* Mark service as active to skip discovering it again */\n\tgatt_db_service_set_active(attr, true);\n\n\tservice = l->data;\n\tprofile = btd_service_get_profile(service);\n\n\t/* Claim attributes of internal profiles */\n\tif (!profile->external) {\n\t\t/* Mark the service as claimed by the existing profile. */\n\t\tgatt_db_service_set_claimed(attr, true);\n\t}\n\n\t/* Notify driver about the new connection */\n\tservice_accept(service);\n}"
        }
      },
      {
        "call_info": {
          "callee": "device_register_primaries",
          "args": [
            "device",
            "new_service",
            "-1"
          ],
          "line": 3652
        },
        "resolved": true,
        "details": {
          "function_name": "device_register_primaries",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "3194-3198",
          "snippet": "static void device_register_primaries(struct btd_device *device,\n\t\t\t\t\t\tGSList *prim_list, int psm)\n{\n\tdevice->primaries = g_slist_concat(device->primaries, prim_list);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void device_register_primaries(struct btd_device *device,\n\t\t\t\t\t\tGSList *prim_list, int psm)\n{\n\tdevice->primaries = g_slist_concat(device->primaries, prim_list);\n}"
        }
      },
      {
        "call_info": {
          "callee": "add_primary",
          "args": [
            "attr",
            "&new_service"
          ],
          "line": 3648
        },
        "resolved": true,
        "details": {
          "function_name": "add_primary",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "3200-3218",
          "snippet": "static void add_primary(struct gatt_db_attribute *attr, void *user_data)\n{\n\tGSList **new_services = user_data;\n\tstruct gatt_primary *prim;\n\tbt_uuid_t uuid;\n\n\tprim = g_new0(struct gatt_primary, 1);\n\tif (!prim) {\n\t\tDBG(\"Failed to allocate gatt_primary structure\");\n\t\treturn;\n\t}\n\n\tgatt_db_attribute_get_service_handles(attr, &prim->range.start,\n\t\t\t\t\t\t\t&prim->range.end);\n\tgatt_db_attribute_get_service_uuid(attr, &uuid);\n\tbt_uuid_to_string(&uuid, prim->uuid, sizeof(prim->uuid));\n\n\t*new_services = g_slist_append(*new_services, prim);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void add_primary(struct gatt_db_attribute *attr, void *user_data)\n{\n\tGSList **new_services = user_data;\n\tstruct gatt_primary *prim;\n\tbt_uuid_t uuid;\n\n\tprim = g_new0(struct gatt_primary, 1);\n\tif (!prim) {\n\t\tDBG(\"Failed to allocate gatt_primary structure\");\n\t\treturn;\n\t}\n\n\tgatt_db_attribute_get_service_handles(attr, &prim->range.start,\n\t\t\t\t\t\t\t&prim->range.end);\n\tgatt_db_attribute_get_service_uuid(attr, &uuid);\n\tbt_uuid_to_string(&uuid, prim->uuid, sizeof(prim->uuid));\n\n\t*new_services = g_slist_append(*new_services, prim);\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"start: 0x%04x, end: 0x%04x\"",
            "start",
            "end"
          ],
          "line": 3642
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gatt_db_attribute_get_service_data",
          "args": [
            "attr",
            "&start",
            "&end",
            "NULL",
            "NULL"
          ],
          "line": 3640
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_get_service_data",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1538-1566",
          "snippet": "bool gatt_db_attribute_get_service_data(const struct gatt_db_attribute *attrib,\n\t\t\t\t\t\t\tuint16_t *start_handle,\n\t\t\t\t\t\t\tuint16_t *end_handle,\n\t\t\t\t\t\t\tbool *primary,\n\t\t\t\t\t\t\tbt_uuid_t *uuid)\n{\n\tstruct gatt_db_service *service;\n\tstruct gatt_db_attribute *decl;\n\n\tif (!attrib)\n\t\treturn false;\n\n\tservice = attrib->service;\n\tdecl = service->attributes[0];\n\n\tgatt_db_service_get_handles(service, start_handle, end_handle);\n\n\tif (primary)\n\t\t*primary = bt_uuid_cmp(&decl->uuid, &secondary_service_uuid);\n\n\tif (!uuid)\n\t\treturn true;\n\n\t/*\n\t * The service declaration attribute value is the 16 or 128 bit service\n\t * UUID.\n\t */\n\treturn le_to_uuid(decl->value, decl->value_len, uuid);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static const bt_uuid_t secondary_service_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_SND_SVC_UUID };"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic const bt_uuid_t secondary_service_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_SND_SVC_UUID };\n\nbool gatt_db_attribute_get_service_data(const struct gatt_db_attribute *attrib,\n\t\t\t\t\t\t\tuint16_t *start_handle,\n\t\t\t\t\t\t\tuint16_t *end_handle,\n\t\t\t\t\t\t\tbool *primary,\n\t\t\t\t\t\t\tbt_uuid_t *uuid)\n{\n\tstruct gatt_db_service *service;\n\tstruct gatt_db_attribute *decl;\n\n\tif (!attrib)\n\t\treturn false;\n\n\tservice = attrib->service;\n\tdecl = service->attributes[0];\n\n\tgatt_db_service_get_handles(service, start_handle, end_handle);\n\n\tif (primary)\n\t\t*primary = bt_uuid_cmp(&decl->uuid, &secondary_service_uuid);\n\n\tif (!uuid)\n\t\treturn true;\n\n\t/*\n\t * The service declaration attribute value is the 16 or 128 bit service\n\t * UUID.\n\t */\n\treturn le_to_uuid(decl->value, decl->value_len, uuid);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_gatt_client_is_ready",
          "args": [
            "device->client"
          ],
          "line": 3637
        },
        "resolved": true,
        "details": {
          "function_name": "bt_gatt_client_is_ready",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-client.c",
          "lines": "2015-2018",
          "snippet": "bool bt_gatt_client_is_ready(struct bt_gatt_client *client)\n{\n\treturn (client && client->ready);\n}",
          "includes": [
            "#include <sys/uio.h>",
            "#include <limits.h>",
            "#include <assert.h>",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-helpers.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/att.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/uio.h>\n#include <limits.h>\n#include <assert.h>\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-helpers.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/att.h\"\n#include <config.h>\n\nbool bt_gatt_client_is_ready(struct bt_gatt_client *client)\n{\n\treturn (client && client->ready);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void gatt_service_added(struct gatt_db_attribute *attr, void *user_data)\n{\n\tstruct btd_device *device = user_data;\n\tGSList *new_service = NULL;\n\tuint16_t start, end;\n\n\tif (!bt_gatt_client_is_ready(device->client))\n\t\treturn;\n\n\tgatt_db_attribute_get_service_data(attr, &start, &end, NULL, NULL);\n\n\tDBG(\"start: 0x%04x, end: 0x%04x\", start, end);\n\n\t/*\n\t * TODO: Remove the primaries list entirely once all profiles use\n\t * shared/gatt.\n\t */\n\tadd_primary(attr, &new_service);\n\tif (!new_service)\n\t\treturn;\n\n\tdevice_register_primaries(device, new_service, -1);\n\n\tadd_gatt_service(attr, device);\n\n\tbtd_gatt_client_service_added(device->client_dbus, attr);\n\n\tgatt_services_changed(device);\n}"
  },
  {
    "function_name": "gatt_services_changed",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "3622-3629",
    "snippet": "static gboolean gatt_services_changed(gpointer user_data)\n{\n\tstruct btd_device *device = user_data;\n\n\tstore_gatt_db(device);\n\n\treturn FALSE;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "store_gatt_db",
          "args": [
            "device"
          ],
          "line": 3626
        },
        "resolved": true,
        "details": {
          "function_name": "store_gatt_db",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "2254-2295",
          "snippet": "static void store_gatt_db(struct btd_device *device)\n{\n\tchar filename[PATH_MAX];\n\tchar dst_addr[18];\n\tGKeyFile *key_file;\n\tchar *data;\n\tgsize length = 0;\n\tstruct gatt_saver saver;\n\n\tif (device_address_is_private(device)) {\n\t\tDBG(\"Can't store GATT db for private addressed device %s\",\n\t\t\t\t\t\t\t\tdevice->path);\n\t\treturn;\n\t}\n\n\tif (!gatt_cache_is_enabled(device))\n\t\treturn;\n\n\tba2str(&device->bdaddr, dst_addr);\n\n\tsnprintf(filename, PATH_MAX, STORAGEDIR \"/%s/cache/%s\",\n\t\t\t\tbtd_adapter_get_storage_dir(device->adapter),\n\t\t\t\tdst_addr);\n\tcreate_file(filename, S_IRUSR | S_IWUSR);\n\n\tkey_file = g_key_file_new();\n\tg_key_file_load_from_file(key_file, filename, 0, NULL);\n\n\t/* Remove current attributes since it might have changed */\n\tg_key_file_remove_group(key_file, \"Attributes\", NULL);\n\n\tsaver.key_file = key_file;\n\tsaver.device = device;\n\n\tgatt_db_foreach_service(device->db, NULL, store_service, &saver);\n\n\tdata = g_key_file_to_data(key_file, &length, NULL);\n\tg_file_set_contents(filename, data, length, NULL);\n\n\tg_free(data);\n\tg_key_file_free(key_file);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void store_gatt_db(struct btd_device *device)\n{\n\tchar filename[PATH_MAX];\n\tchar dst_addr[18];\n\tGKeyFile *key_file;\n\tchar *data;\n\tgsize length = 0;\n\tstruct gatt_saver saver;\n\n\tif (device_address_is_private(device)) {\n\t\tDBG(\"Can't store GATT db for private addressed device %s\",\n\t\t\t\t\t\t\t\tdevice->path);\n\t\treturn;\n\t}\n\n\tif (!gatt_cache_is_enabled(device))\n\t\treturn;\n\n\tba2str(&device->bdaddr, dst_addr);\n\n\tsnprintf(filename, PATH_MAX, STORAGEDIR \"/%s/cache/%s\",\n\t\t\t\tbtd_adapter_get_storage_dir(device->adapter),\n\t\t\t\tdst_addr);\n\tcreate_file(filename, S_IRUSR | S_IWUSR);\n\n\tkey_file = g_key_file_new();\n\tg_key_file_load_from_file(key_file, filename, 0, NULL);\n\n\t/* Remove current attributes since it might have changed */\n\tg_key_file_remove_group(key_file, \"Attributes\", NULL);\n\n\tsaver.key_file = key_file;\n\tsaver.device = device;\n\n\tgatt_db_foreach_service(device->db, NULL, store_service, &saver);\n\n\tdata = g_key_file_to_data(key_file, &length, NULL);\n\tg_file_set_contents(filename, data, length, NULL);\n\n\tg_free(data);\n\tg_key_file_free(key_file);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic gboolean gatt_services_changed(gpointer user_data)\n{\n\tstruct btd_device *device = user_data;\n\n\tstore_gatt_db(device);\n\n\treturn FALSE;\n}"
  },
  {
    "function_name": "device_remove_gatt_service",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "3601-3620",
    "snippet": "static void device_remove_gatt_service(struct btd_device *device,\n\t\t\t\t\t\tstruct gatt_db_attribute *attr)\n{\n\tstruct btd_service *service;\n\tbt_uuid_t uuid;\n\tchar uuid_str[MAX_LEN_UUID_STR];\n\tGSList *l;\n\n\tgatt_db_attribute_get_service_uuid(attr, &uuid);\n\tbt_uuid_to_string(&uuid, uuid_str, sizeof(uuid_str));\n\n\tl = find_service_with_uuid(device->services, uuid_str);\n\tif (!l)\n\t\treturn;\n\n\tservice = l->data;\n\tdevice->services = g_slist_delete_link(device->services, l);\n\tdevice->pending = g_slist_remove(device->pending, service);\n\tservice_remove(service);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "service_remove",
          "args": [
            "service"
          ],
          "line": 3619
        },
        "resolved": true,
        "details": {
          "function_name": "btd_service_remove_state_cb",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
          "lines": "356-371",
          "snippet": "bool btd_service_remove_state_cb(unsigned int id)\n{\n\tGSList *l;\n\n\tfor (l = state_callbacks; l != NULL; l = g_slist_next(l)) {\n\t\tstruct service_state_callback *cb = l->data;\n\n\t\tif (cb && cb->id == id) {\n\t\t\tstate_callbacks = g_slist_remove(state_callbacks, cb);\n\t\t\tg_free(cb);\n\t\t\treturn true;\n\t\t}\n\t}\n\n\treturn false;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/stat.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static GSList *state_callbacks = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic GSList *state_callbacks = NULL;\n\nbool btd_service_remove_state_cb(unsigned int id)\n{\n\tGSList *l;\n\n\tfor (l = state_callbacks; l != NULL; l = g_slist_next(l)) {\n\t\tstruct service_state_callback *cb = l->data;\n\n\t\tif (cb && cb->id == id) {\n\t\t\tstate_callbacks = g_slist_remove(state_callbacks, cb);\n\t\t\tg_free(cb);\n\t\t\treturn true;\n\t\t}\n\t}\n\n\treturn false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_slist_remove",
          "args": [
            "device->pending",
            "service"
          ],
          "line": 3618
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_delete_link",
          "args": [
            "device->services",
            "l"
          ],
          "line": 3617
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "find_service_with_uuid",
          "args": [
            "device->services",
            "uuid_str"
          ],
          "line": 3612
        },
        "resolved": true,
        "details": {
          "function_name": "find_service_with_uuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "313-326",
          "snippet": "static GSList *find_service_with_uuid(GSList *list, char *uuid)\n{\n\tGSList *l;\n\n\tfor (l = list; l != NULL; l = g_slist_next(l)) {\n\t\tstruct btd_service *service = l->data;\n\t\tstruct btd_profile *profile = btd_service_get_profile(service);\n\n\t\tif (bt_uuid_strcmp(profile->remote_uuid, uuid) == 0)\n\t\t\treturn l;\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic GSList *find_service_with_uuid(GSList *list, char *uuid)\n{\n\tGSList *l;\n\n\tfor (l = list; l != NULL; l = g_slist_next(l)) {\n\t\tstruct btd_service *service = l->data;\n\t\tstruct btd_profile *profile = btd_service_get_profile(service);\n\n\t\tif (bt_uuid_strcmp(profile->remote_uuid, uuid) == 0)\n\t\t\treturn l;\n\t}\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_uuid_to_string",
          "args": [
            "&uuid",
            "uuid_str",
            "sizeof(uuid_str)"
          ],
          "line": 3610
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gatt_db_attribute_get_service_uuid",
          "args": [
            "attr",
            "&uuid"
          ],
          "line": 3609
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_get_service_uuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1490-1519",
          "snippet": "bool gatt_db_attribute_get_service_uuid(const struct gatt_db_attribute *attrib,\n\t\t\t\t\t\t\tbt_uuid_t *uuid)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!attrib || !uuid)\n\t\treturn false;\n\n\tservice = attrib->service;\n\n\tif (service->attributes[0]->value_len == sizeof(uint16_t)) {\n\t\tuint16_t value;\n\n\t\tvalue = get_le16(service->attributes[0]->value);\n\t\tbt_uuid16_create(uuid, value);\n\n\t\treturn true;\n\t}\n\n\tif (service->attributes[0]->value_len == sizeof(uint128_t)) {\n\t\tuint128_t value;\n\n\t\tbswap_128(service->attributes[0]->value, &value);\n\t\tbt_uuid128_create(uuid, value);\n\n\t\treturn true;\n\t}\n\n\treturn false;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_attribute_get_service_uuid(const struct gatt_db_attribute *attrib,\n\t\t\t\t\t\t\tbt_uuid_t *uuid)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!attrib || !uuid)\n\t\treturn false;\n\n\tservice = attrib->service;\n\n\tif (service->attributes[0]->value_len == sizeof(uint16_t)) {\n\t\tuint16_t value;\n\n\t\tvalue = get_le16(service->attributes[0]->value);\n\t\tbt_uuid16_create(uuid, value);\n\n\t\treturn true;\n\t}\n\n\tif (service->attributes[0]->value_len == sizeof(uint128_t)) {\n\t\tuint128_t value;\n\n\t\tbswap_128(service->attributes[0]->value, &value);\n\t\tbt_uuid128_create(uuid, value);\n\n\t\treturn true;\n\t}\n\n\treturn false;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void device_remove_gatt_service(struct btd_device *device,\n\t\t\t\t\t\tstruct gatt_db_attribute *attr)\n{\n\tstruct btd_service *service;\n\tbt_uuid_t uuid;\n\tchar uuid_str[MAX_LEN_UUID_STR];\n\tGSList *l;\n\n\tgatt_db_attribute_get_service_uuid(attr, &uuid);\n\tbt_uuid_to_string(&uuid, uuid_str, sizeof(uuid_str));\n\n\tl = find_service_with_uuid(device->services, uuid_str);\n\tif (!l)\n\t\treturn;\n\n\tservice = l->data;\n\tdevice->services = g_slist_delete_link(device->services, l);\n\tdevice->pending = g_slist_remove(device->pending, service);\n\tservice_remove(service);\n}"
  },
  {
    "function_name": "device_accept_gatt_profiles",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "3593-3599",
    "snippet": "static void device_accept_gatt_profiles(struct btd_device *device)\n{\n\tGSList *l;\n\n\tfor (l = device->services; l != NULL; l = g_slist_next(l))\n\t\tservice_accept(l->data);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "service_accept",
          "args": [
            "l->data"
          ],
          "line": 3598
        },
        "resolved": true,
        "details": {
          "function_name": "service_accept",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
          "lines": "182-215",
          "snippet": "int service_accept(struct btd_service *service)\n{\n\tchar addr[18];\n\tint err;\n\n\tswitch (service->state) {\n\tcase BTD_SERVICE_STATE_UNAVAILABLE:\n\t\treturn -EINVAL;\n\tcase BTD_SERVICE_STATE_DISCONNECTED:\n\t\tbreak;\n\tcase BTD_SERVICE_STATE_CONNECTING:\n\tcase BTD_SERVICE_STATE_CONNECTED:\n\t\treturn 0;\n\tcase BTD_SERVICE_STATE_DISCONNECTING:\n\t\treturn -EBUSY;\n\t}\n\n\tif (!service->profile->accept)\n\t\treturn -ENOSYS;\n\n\terr = service->profile->accept(service);\n\tif (!err)\n\t\tgoto done;\n\n\tba2str(device_get_address(service->device), addr);\n\terror(\"%s profile accept failed for %s\", service->profile->name, addr);\n\n\treturn err;\n\ndone:\n\tif (service->state == BTD_SERVICE_STATE_DISCONNECTED)\n\t\tchange_state(service, BTD_SERVICE_STATE_CONNECTING, 0);\n\treturn 0;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/stat.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nint service_accept(struct btd_service *service)\n{\n\tchar addr[18];\n\tint err;\n\n\tswitch (service->state) {\n\tcase BTD_SERVICE_STATE_UNAVAILABLE:\n\t\treturn -EINVAL;\n\tcase BTD_SERVICE_STATE_DISCONNECTED:\n\t\tbreak;\n\tcase BTD_SERVICE_STATE_CONNECTING:\n\tcase BTD_SERVICE_STATE_CONNECTED:\n\t\treturn 0;\n\tcase BTD_SERVICE_STATE_DISCONNECTING:\n\t\treturn -EBUSY;\n\t}\n\n\tif (!service->profile->accept)\n\t\treturn -ENOSYS;\n\n\terr = service->profile->accept(service);\n\tif (!err)\n\t\tgoto done;\n\n\tba2str(device_get_address(service->device), addr);\n\terror(\"%s profile accept failed for %s\", service->profile->name, addr);\n\n\treturn err;\n\ndone:\n\tif (service->state == BTD_SERVICE_STATE_DISCONNECTED)\n\t\tchange_state(service, BTD_SERVICE_STATE_CONNECTING, 0);\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_slist_next",
          "args": [
            "l"
          ],
          "line": 3597
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void device_accept_gatt_profiles(struct btd_device *device)\n{\n\tGSList *l;\n\n\tfor (l = device->services; l != NULL; l = g_slist_next(l))\n\t\tservice_accept(l->data);\n}"
  },
  {
    "function_name": "device_add_gatt_services",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "3579-3591",
    "snippet": "static void device_add_gatt_services(struct btd_device *device)\n{\n\tchar addr[18];\n\n\tba2str(&device->bdaddr, addr);\n\n\tif (device->blocked) {\n\t\tDBG(\"Skipping profiles for blocked device %s\", addr);\n\t\treturn;\n\t}\n\n\tgatt_db_foreach_service(device->db, NULL, add_gatt_service, device);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "gatt_db_foreach_service",
          "args": [
            "device->db",
            "NULL",
            "add_gatt_service",
            "device"
          ],
          "line": 3590
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_foreach_service",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1258-1264",
          "snippet": "void gatt_db_foreach_service(struct gatt_db *db, const bt_uuid_t *uuid,\n\t\t\t\t\t\tgatt_db_attribute_cb_t func,\n\t\t\t\t\t\tvoid *user_data)\n{\n\tgatt_db_foreach_service_in_range(db, uuid, func, user_data, 0x0001,\n\t\t\t\t\t\t\t\t\t0xffff);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nvoid gatt_db_foreach_service(struct gatt_db *db, const bt_uuid_t *uuid,\n\t\t\t\t\t\tgatt_db_attribute_cb_t func,\n\t\t\t\t\t\tvoid *user_data)\n{\n\tgatt_db_foreach_service_in_range(db, uuid, func, user_data, 0x0001,\n\t\t\t\t\t\t\t\t\t0xffff);\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Skipping profiles for blocked device %s\"",
            "addr"
          ],
          "line": 3586
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ba2str",
          "args": [
            "&device->bdaddr",
            "addr"
          ],
          "line": 3583
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void device_add_gatt_services(struct btd_device *device)\n{\n\tchar addr[18];\n\n\tba2str(&device->bdaddr, addr);\n\n\tif (device->blocked) {\n\t\tDBG(\"Skipping profiles for blocked device %s\", addr);\n\t\treturn;\n\t}\n\n\tgatt_db_foreach_service(device->db, NULL, add_gatt_service, device);\n}"
  },
  {
    "function_name": "add_gatt_service",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "3537-3577",
    "snippet": "static void add_gatt_service(struct gatt_db_attribute *attr, void *user_data)\n{\n\tstruct btd_device *device = user_data;\n\tstruct btd_service *service;\n\tstruct btd_profile *profile;\n\tbt_uuid_t uuid;\n\tchar uuid_str[MAX_LEN_UUID_STR];\n\tGSList *l;\n\n\tgatt_db_attribute_get_service_uuid(attr, &uuid);\n\tbt_uuid_to_string(&uuid, uuid_str, sizeof(uuid_str));\n\n\t/* Check if service was already probed */\n\tl = find_service_with_uuid(device->services, uuid_str);\n\tif (l)\n\t\tgoto done;\n\n\t/* Add UUID and probe service */\n\tbtd_device_add_uuid(device, uuid_str);\n\n\t/* Check if service was probed */\n\tl = find_service_with_uuid(device->services, uuid_str);\n\tif (!l)\n\t\treturn;\n\ndone:\n\t/* Mark service as active to skip discovering it again */\n\tgatt_db_service_set_active(attr, true);\n\n\tservice = l->data;\n\tprofile = btd_service_get_profile(service);\n\n\t/* Claim attributes of internal profiles */\n\tif (!profile->external) {\n\t\t/* Mark the service as claimed by the existing profile. */\n\t\tgatt_db_service_set_claimed(attr, true);\n\t}\n\n\t/* Notify driver about the new connection */\n\tservice_accept(service);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "service_accept",
          "args": [
            "service"
          ],
          "line": 3576
        },
        "resolved": true,
        "details": {
          "function_name": "service_accept",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
          "lines": "182-215",
          "snippet": "int service_accept(struct btd_service *service)\n{\n\tchar addr[18];\n\tint err;\n\n\tswitch (service->state) {\n\tcase BTD_SERVICE_STATE_UNAVAILABLE:\n\t\treturn -EINVAL;\n\tcase BTD_SERVICE_STATE_DISCONNECTED:\n\t\tbreak;\n\tcase BTD_SERVICE_STATE_CONNECTING:\n\tcase BTD_SERVICE_STATE_CONNECTED:\n\t\treturn 0;\n\tcase BTD_SERVICE_STATE_DISCONNECTING:\n\t\treturn -EBUSY;\n\t}\n\n\tif (!service->profile->accept)\n\t\treturn -ENOSYS;\n\n\terr = service->profile->accept(service);\n\tif (!err)\n\t\tgoto done;\n\n\tba2str(device_get_address(service->device), addr);\n\terror(\"%s profile accept failed for %s\", service->profile->name, addr);\n\n\treturn err;\n\ndone:\n\tif (service->state == BTD_SERVICE_STATE_DISCONNECTED)\n\t\tchange_state(service, BTD_SERVICE_STATE_CONNECTING, 0);\n\treturn 0;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/stat.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nint service_accept(struct btd_service *service)\n{\n\tchar addr[18];\n\tint err;\n\n\tswitch (service->state) {\n\tcase BTD_SERVICE_STATE_UNAVAILABLE:\n\t\treturn -EINVAL;\n\tcase BTD_SERVICE_STATE_DISCONNECTED:\n\t\tbreak;\n\tcase BTD_SERVICE_STATE_CONNECTING:\n\tcase BTD_SERVICE_STATE_CONNECTED:\n\t\treturn 0;\n\tcase BTD_SERVICE_STATE_DISCONNECTING:\n\t\treturn -EBUSY;\n\t}\n\n\tif (!service->profile->accept)\n\t\treturn -ENOSYS;\n\n\terr = service->profile->accept(service);\n\tif (!err)\n\t\tgoto done;\n\n\tba2str(device_get_address(service->device), addr);\n\terror(\"%s profile accept failed for %s\", service->profile->name, addr);\n\n\treturn err;\n\ndone:\n\tif (service->state == BTD_SERVICE_STATE_DISCONNECTED)\n\t\tchange_state(service, BTD_SERVICE_STATE_CONNECTING, 0);\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_service_set_claimed",
          "args": [
            "attr",
            "true"
          ],
          "line": 3572
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_service_set_claimed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1002-1011",
          "snippet": "bool gatt_db_service_set_claimed(struct gatt_db_attribute *attrib,\n\t\t\t\t\t\t\t\tbool claimed)\n{\n\tif (!attrib)\n\t\treturn false;\n\n\tattrib->service->claimed = claimed;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_service_set_claimed(struct gatt_db_attribute *attrib,\n\t\t\t\t\t\t\t\tbool claimed)\n{\n\tif (!attrib)\n\t\treturn false;\n\n\tattrib->service->claimed = claimed;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_service_get_profile",
          "args": [
            "service"
          ],
          "line": 3567
        },
        "resolved": true,
        "details": {
          "function_name": "btd_service_get_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
          "lines": "316-319",
          "snippet": "struct btd_profile *btd_service_get_profile(const struct btd_service *service)\n{\n\treturn service->profile;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/stat.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstruct btd_profile *btd_service_get_profile(const struct btd_service *service)\n{\n\treturn service->profile;\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_service_set_active",
          "args": [
            "attr",
            "true"
          ],
          "line": 3564
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_service_set_active",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "975-992",
          "snippet": "bool gatt_db_service_set_active(struct gatt_db_attribute *attrib, bool active)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!attrib)\n\t\treturn false;\n\n\tservice = attrib->service;\n\n\tif (service->active == active)\n\t\treturn true;\n\n\tservice->active = active;\n\n\tnotify_service_changed(service->db, service, active);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_service_set_active(struct gatt_db_attribute *attrib, bool active)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!attrib)\n\t\treturn false;\n\n\tservice = attrib->service;\n\n\tif (service->active == active)\n\t\treturn true;\n\n\tservice->active = active;\n\n\tnotify_service_changed(service->db, service, active);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "find_service_with_uuid",
          "args": [
            "device->services",
            "uuid_str"
          ],
          "line": 3558
        },
        "resolved": true,
        "details": {
          "function_name": "find_service_with_uuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "313-326",
          "snippet": "static GSList *find_service_with_uuid(GSList *list, char *uuid)\n{\n\tGSList *l;\n\n\tfor (l = list; l != NULL; l = g_slist_next(l)) {\n\t\tstruct btd_service *service = l->data;\n\t\tstruct btd_profile *profile = btd_service_get_profile(service);\n\n\t\tif (bt_uuid_strcmp(profile->remote_uuid, uuid) == 0)\n\t\t\treturn l;\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic GSList *find_service_with_uuid(GSList *list, char *uuid)\n{\n\tGSList *l;\n\n\tfor (l = list; l != NULL; l = g_slist_next(l)) {\n\t\tstruct btd_service *service = l->data;\n\t\tstruct btd_profile *profile = btd_service_get_profile(service);\n\n\t\tif (bt_uuid_strcmp(profile->remote_uuid, uuid) == 0)\n\t\t\treturn l;\n\t}\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_device_add_uuid",
          "args": [
            "device",
            "uuid_str"
          ],
          "line": 3555
        },
        "resolved": true,
        "details": {
          "function_name": "btd_device_add_uuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "6253-6273",
          "snippet": "void btd_device_add_uuid(struct btd_device *device, const char *uuid)\n{\n\tGSList *uuid_list;\n\tchar *new_uuid;\n\n\tif (g_slist_find_custom(device->uuids, uuid, bt_uuid_strcmp))\n\t\treturn;\n\n\tnew_uuid = g_strdup(uuid);\n\tuuid_list = g_slist_append(NULL, new_uuid);\n\n\tdevice_probe_profiles(device, uuid_list);\n\n\tg_free(new_uuid);\n\tg_slist_free(uuid_list);\n\n\tstore_device_info(device);\n\n\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"UUIDs\");\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *dbus_conn = NULL;",
            "static const uint16_t uuid_list[] = {\n\tL2CAP_UUID,\n\tPNP_INFO_SVCLASS_ID,\n\tPUBLIC_BROWSE_GROUP,\n\t0\n};",
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic const uint16_t uuid_list[] = {\n\tL2CAP_UUID,\n\tPNP_INFO_SVCLASS_ID,\n\tPUBLIC_BROWSE_GROUP,\n\t0\n};\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid btd_device_add_uuid(struct btd_device *device, const char *uuid)\n{\n\tGSList *uuid_list;\n\tchar *new_uuid;\n\n\tif (g_slist_find_custom(device->uuids, uuid, bt_uuid_strcmp))\n\t\treturn;\n\n\tnew_uuid = g_strdup(uuid);\n\tuuid_list = g_slist_append(NULL, new_uuid);\n\n\tdevice_probe_profiles(device, uuid_list);\n\n\tg_free(new_uuid);\n\tg_slist_free(uuid_list);\n\n\tstore_device_info(device);\n\n\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"UUIDs\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_uuid_to_string",
          "args": [
            "&uuid",
            "uuid_str",
            "sizeof(uuid_str)"
          ],
          "line": 3547
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gatt_db_attribute_get_service_uuid",
          "args": [
            "attr",
            "&uuid"
          ],
          "line": 3546
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_get_service_uuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1490-1519",
          "snippet": "bool gatt_db_attribute_get_service_uuid(const struct gatt_db_attribute *attrib,\n\t\t\t\t\t\t\tbt_uuid_t *uuid)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!attrib || !uuid)\n\t\treturn false;\n\n\tservice = attrib->service;\n\n\tif (service->attributes[0]->value_len == sizeof(uint16_t)) {\n\t\tuint16_t value;\n\n\t\tvalue = get_le16(service->attributes[0]->value);\n\t\tbt_uuid16_create(uuid, value);\n\n\t\treturn true;\n\t}\n\n\tif (service->attributes[0]->value_len == sizeof(uint128_t)) {\n\t\tuint128_t value;\n\n\t\tbswap_128(service->attributes[0]->value, &value);\n\t\tbt_uuid128_create(uuid, value);\n\n\t\treturn true;\n\t}\n\n\treturn false;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_attribute_get_service_uuid(const struct gatt_db_attribute *attrib,\n\t\t\t\t\t\t\tbt_uuid_t *uuid)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!attrib || !uuid)\n\t\treturn false;\n\n\tservice = attrib->service;\n\n\tif (service->attributes[0]->value_len == sizeof(uint16_t)) {\n\t\tuint16_t value;\n\n\t\tvalue = get_le16(service->attributes[0]->value);\n\t\tbt_uuid16_create(uuid, value);\n\n\t\treturn true;\n\t}\n\n\tif (service->attributes[0]->value_len == sizeof(uint128_t)) {\n\t\tuint128_t value;\n\n\t\tbswap_128(service->attributes[0]->value, &value);\n\t\tbt_uuid128_create(uuid, value);\n\n\t\treturn true;\n\t}\n\n\treturn false;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void add_gatt_service(struct gatt_db_attribute *attr, void *user_data)\n{\n\tstruct btd_device *device = user_data;\n\tstruct btd_service *service;\n\tstruct btd_profile *profile;\n\tbt_uuid_t uuid;\n\tchar uuid_str[MAX_LEN_UUID_STR];\n\tGSList *l;\n\n\tgatt_db_attribute_get_service_uuid(attr, &uuid);\n\tbt_uuid_to_string(&uuid, uuid_str, sizeof(uuid_str));\n\n\t/* Check if service was already probed */\n\tl = find_service_with_uuid(device->services, uuid_str);\n\tif (l)\n\t\tgoto done;\n\n\t/* Add UUID and probe service */\n\tbtd_device_add_uuid(device, uuid_str);\n\n\t/* Check if service was probed */\n\tl = find_service_with_uuid(device->services, uuid_str);\n\tif (!l)\n\t\treturn;\n\ndone:\n\t/* Mark service as active to skip discovering it again */\n\tgatt_db_service_set_active(attr, true);\n\n\tservice = l->data;\n\tprofile = btd_service_get_profile(service);\n\n\t/* Claim attributes of internal profiles */\n\tif (!profile->external) {\n\t\t/* Mark the service as claimed by the existing profile. */\n\t\tgatt_db_service_set_claimed(attr, true);\n\t}\n\n\t/* Notify driver about the new connection */\n\tservice_accept(service);\n}"
  },
  {
    "function_name": "device_match_profile",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "3523-3535",
    "snippet": "static bool device_match_profile(struct btd_device *device,\n\t\t\t\t\tstruct btd_profile *profile,\n\t\t\t\t\tGSList *uuids)\n{\n\tif (profile->remote_uuid == NULL)\n\t\treturn false;\n\n\tif (g_slist_find_custom(uuids, profile->remote_uuid,\n\t\t\t\t\t\t\tbt_uuid_strcmp) == NULL)\n\t\treturn false;\n\n\treturn true;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_slist_find_custom",
          "args": [
            "uuids",
            "profile->remote_uuid",
            "bt_uuid_strcmp"
          ],
          "line": 3530
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic bool device_match_profile(struct btd_device *device,\n\t\t\t\t\tstruct btd_profile *profile,\n\t\t\t\t\tGSList *uuids)\n{\n\tif (profile->remote_uuid == NULL)\n\t\treturn false;\n\n\tif (g_slist_find_custom(uuids, profile->remote_uuid,\n\t\t\t\t\t\t\tbt_uuid_strcmp) == NULL)\n\t\treturn false;\n\n\treturn true;\n}"
  },
  {
    "function_name": "device_add_uuids",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "3501-3521",
    "snippet": "static void device_add_uuids(struct btd_device *device, GSList *uuids)\n{\n\tGSList *l;\n\tbool changed = false;\n\n\tfor (l = uuids; l != NULL; l = g_slist_next(l)) {\n\t\tGSList *match = g_slist_find_custom(device->uuids, l->data,\n\t\t\t\t\t\t\tbt_uuid_strcmp);\n\t\tif (match)\n\t\t\tcontinue;\n\n\t\tchanged = true;\n\t\tdevice->uuids = g_slist_insert_sorted(device->uuids,\n\t\t\t\t\t\tg_strdup(l->data),\n\t\t\t\t\t\tbt_uuid_strcmp);\n\t}\n\n\tif (changed)\n\t\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"UUIDs\");\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static DBusConnection *dbus_conn = NULL;",
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_dbus_emit_property_changed",
          "args": [
            "dbus_conn",
            "device->path",
            "DEVICE_INTERFACE",
            "\"UUIDs\""
          ],
          "line": 3519
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_insert_sorted",
          "args": [
            "device->uuids",
            "g_strdup(l->data)",
            "bt_uuid_strcmp"
          ],
          "line": 3513
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "l->data"
          ],
          "line": 3514
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_find_custom",
          "args": [
            "device->uuids",
            "l->data",
            "bt_uuid_strcmp"
          ],
          "line": 3507
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_next",
          "args": [
            "l"
          ],
          "line": 3506
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void device_add_uuids(struct btd_device *device, GSList *uuids)\n{\n\tGSList *l;\n\tbool changed = false;\n\n\tfor (l = uuids; l != NULL; l = g_slist_next(l)) {\n\t\tGSList *match = g_slist_find_custom(device->uuids, l->data,\n\t\t\t\t\t\t\tbt_uuid_strcmp);\n\t\tif (match)\n\t\t\tcontinue;\n\n\t\tchanged = true;\n\t\tdevice->uuids = g_slist_insert_sorted(device->uuids,\n\t\t\t\t\t\tg_strdup(l->data),\n\t\t\t\t\t\tbt_uuid_strcmp);\n\t}\n\n\tif (changed)\n\t\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"UUIDs\");\n}"
  },
  {
    "function_name": "load_gatt_db",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "3466-3499",
    "snippet": "static void load_gatt_db(struct btd_device *device, const char *local,\n\t\t\t\t\t\t\tconst char *peer)\n{\n\tchar **keys, filename[PATH_MAX];\n\tGKeyFile *key_file;\n\n\tif (!gatt_cache_is_enabled(device))\n\t\treturn;\n\n\tDBG(\"Restoring %s gatt database from file\", peer);\n\n\tsnprintf(filename, PATH_MAX, STORAGEDIR \"/%s/cache/%s\", local, peer);\n\n\tkey_file = g_key_file_new();\n\tg_key_file_load_from_file(key_file, filename, 0, NULL);\n\tkeys = g_key_file_get_keys(key_file, \"Attributes\", NULL, NULL);\n\n\tif (!keys) {\n\t\twarn(\"No cache for %s\", peer);\n\t\tg_key_file_free(key_file);\n\t\treturn;\n\t}\n\n\tif (load_gatt_db_impl(key_file, keys, device->db))\n\t\twarn(\"Unable to load gatt db from file for %s\", peer);\n\n\tg_strfreev(keys);\n\tg_key_file_free(key_file);\n\n\tg_slist_free_full(device->primaries, g_free);\n\tdevice->primaries = NULL;\n\tgatt_db_foreach_service(device->db, NULL, add_primary,\n\t\t\t\t\t\t\t&device->primaries);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "gatt_db_foreach_service",
          "args": [
            "device->db",
            "NULL",
            "add_primary",
            "&device->primaries"
          ],
          "line": 3497
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_foreach_service",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1258-1264",
          "snippet": "void gatt_db_foreach_service(struct gatt_db *db, const bt_uuid_t *uuid,\n\t\t\t\t\t\tgatt_db_attribute_cb_t func,\n\t\t\t\t\t\tvoid *user_data)\n{\n\tgatt_db_foreach_service_in_range(db, uuid, func, user_data, 0x0001,\n\t\t\t\t\t\t\t\t\t0xffff);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nvoid gatt_db_foreach_service(struct gatt_db *db, const bt_uuid_t *uuid,\n\t\t\t\t\t\tgatt_db_attribute_cb_t func,\n\t\t\t\t\t\tvoid *user_data)\n{\n\tgatt_db_foreach_service_in_range(db, uuid, func, user_data, 0x0001,\n\t\t\t\t\t\t\t\t\t0xffff);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_slist_free_full",
          "args": [
            "device->primaries",
            "g_free"
          ],
          "line": 3495
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_free",
          "args": [
            "key_file"
          ],
          "line": 3493
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strfreev",
          "args": [
            "keys"
          ],
          "line": 3492
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "warn",
          "args": [
            "\"Unable to load gatt db from file for %s\"",
            "peer"
          ],
          "line": 3490
        },
        "resolved": true,
        "details": {
          "function_name": "btd_warn",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/log.c",
          "lines": "215-229",
          "snippet": "void btd_warn(uint16_t index, const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_WARNING, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(index, LOG_WARNING, format, ap);\n\tva_end(ap);\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdarg.h>",
            "#include <syslog.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int logging_fd = -1;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"src/shared/util.h\"\n#include \"lib/hci.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int logging_fd = -1;\n\nvoid btd_warn(uint16_t index, const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_WARNING, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(index, LOG_WARNING, format, ap);\n\tva_end(ap);\n}"
        }
      },
      {
        "call_info": {
          "callee": "load_gatt_db_impl",
          "args": [
            "key_file",
            "keys",
            "device->db"
          ],
          "line": 3489
        },
        "resolved": true,
        "details": {
          "function_name": "load_gatt_db_impl",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "3378-3464",
          "snippet": "static int load_gatt_db_impl(GKeyFile *key_file, char **keys,\n\t\t\t\t\t\t\tstruct gatt_db *db)\n{\n\tstruct gatt_db_attribute *current_service;\n\tchar **handle, *value, type[MAX_LEN_UUID_STR];\n\tint ret;\n\n\t/* first load service definitions */\n\tfor (handle = keys; *handle; handle++) {\n\t\tvalue = g_key_file_get_string(key_file, \"Attributes\", *handle,\n\t\t\t\t\t\t\t\t\tNULL);\n\n\t\tif (sscanf(value, \"%[^:]:\", type) != 1) {\n\t\t\twarn(\"Missing Type in attribute definition\");\n\t\t\tg_free(value);\n\t\t\treturn -EIO;\n\t\t}\n\n\t\tif (g_str_equal(type, GATT_PRIM_SVC_UUID_STR) ||\n\t\t\t\tg_str_equal(type, GATT_SND_SVC_UUID_STR)) {\n\t\t\tret = load_service(db, *handle, value);\n\t\t\tif (ret) {\n\t\t\t\tg_free(value);\n\t\t\t\treturn ret;\n\t\t\t}\n\t\t}\n\n\t\tg_free(value);\n\t}\n\n\tcurrent_service = NULL;\n\t/* then fill them with data*/\n\tfor (handle = keys; *handle; handle++) {\n\t\tvalue = g_key_file_get_string(key_file, \"Attributes\", *handle,\n\t\t\t\t\t\t\t\t\tNULL);\n\n\t\tif (sscanf(value, \"%[^:]:\", type) != 1) {\n\t\t\twarn(\"Missing Type in attribute definition\");\n\t\t\tg_free(value);\n\t\t\treturn -EIO;\n\t\t}\n\n\t\tif (g_str_equal(type, GATT_PRIM_SVC_UUID_STR) ||\n\t\t\t\tg_str_equal(type, GATT_SND_SVC_UUID_STR)) {\n\t\t\tuint16_t tmp;\n\t\t\tuint16_t start, end;\n\t\t\tbool primary;\n\t\t\tbt_uuid_t uuid;\n\t\t\tchar uuid_str[MAX_LEN_UUID_STR];\n\n\t\t\tif (sscanf(*handle, \"%04hx\", &tmp) != 1) {\n\t\t\t\twarn(\"Unable to parse attribute handle\");\n\t\t\t\tg_free(value);\n\t\t\t\treturn -EIO;\n\t\t\t}\n\n\t\t\tif (current_service)\n\t\t\t\tgatt_db_service_set_active(current_service,\n\t\t\t\t\t\t\t\t\ttrue);\n\n\t\t\tcurrent_service = gatt_db_get_attribute(db, tmp);\n\n\t\t\tgatt_db_attribute_get_service_data(current_service,\n\t\t\t\t\t\t\t&start, &end,\n\t\t\t\t\t\t\t&primary, &uuid);\n\n\t\t\tbt_uuid_to_string(&uuid, uuid_str, sizeof(uuid_str));\n\t\t} else if (g_str_equal(type, GATT_INCLUDE_UUID_STR)) {\n\t\t\tret = load_incl(db, *handle, value, current_service);\n\t\t} else if (g_str_equal(type, GATT_CHARAC_UUID_STR)) {\n\t\t\tret = load_chrc(*handle, value, current_service);\n\t\t} else {\n\t\t\tret = load_desc(*handle, value, current_service);\n\t\t}\n\n\t\tg_free(value);\n\t\tif (ret) {\n\t\t\tgatt_db_clear(db);\n\t\t\treturn ret;\n\t\t}\n\t}\n\n\tif (current_service)\n\t\tgatt_db_service_set_active(current_service, true);\n\n\treturn 0;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define GATT_CHARAC_UUID_STR \"2803\"",
            "#define GATT_INCLUDE_UUID_STR \"2802\"",
            "#define GATT_SND_SVC_UUID_STR  \"2801\"",
            "#define GATT_PRIM_SVC_UUID_STR \"2800\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\n#define GATT_CHARAC_UUID_STR \"2803\"\n#define GATT_INCLUDE_UUID_STR \"2802\"\n#define GATT_SND_SVC_UUID_STR  \"2801\"\n#define GATT_PRIM_SVC_UUID_STR \"2800\"\n\nstatic int load_gatt_db_impl(GKeyFile *key_file, char **keys,\n\t\t\t\t\t\t\tstruct gatt_db *db)\n{\n\tstruct gatt_db_attribute *current_service;\n\tchar **handle, *value, type[MAX_LEN_UUID_STR];\n\tint ret;\n\n\t/* first load service definitions */\n\tfor (handle = keys; *handle; handle++) {\n\t\tvalue = g_key_file_get_string(key_file, \"Attributes\", *handle,\n\t\t\t\t\t\t\t\t\tNULL);\n\n\t\tif (sscanf(value, \"%[^:]:\", type) != 1) {\n\t\t\twarn(\"Missing Type in attribute definition\");\n\t\t\tg_free(value);\n\t\t\treturn -EIO;\n\t\t}\n\n\t\tif (g_str_equal(type, GATT_PRIM_SVC_UUID_STR) ||\n\t\t\t\tg_str_equal(type, GATT_SND_SVC_UUID_STR)) {\n\t\t\tret = load_service(db, *handle, value);\n\t\t\tif (ret) {\n\t\t\t\tg_free(value);\n\t\t\t\treturn ret;\n\t\t\t}\n\t\t}\n\n\t\tg_free(value);\n\t}\n\n\tcurrent_service = NULL;\n\t/* then fill them with data*/\n\tfor (handle = keys; *handle; handle++) {\n\t\tvalue = g_key_file_get_string(key_file, \"Attributes\", *handle,\n\t\t\t\t\t\t\t\t\tNULL);\n\n\t\tif (sscanf(value, \"%[^:]:\", type) != 1) {\n\t\t\twarn(\"Missing Type in attribute definition\");\n\t\t\tg_free(value);\n\t\t\treturn -EIO;\n\t\t}\n\n\t\tif (g_str_equal(type, GATT_PRIM_SVC_UUID_STR) ||\n\t\t\t\tg_str_equal(type, GATT_SND_SVC_UUID_STR)) {\n\t\t\tuint16_t tmp;\n\t\t\tuint16_t start, end;\n\t\t\tbool primary;\n\t\t\tbt_uuid_t uuid;\n\t\t\tchar uuid_str[MAX_LEN_UUID_STR];\n\n\t\t\tif (sscanf(*handle, \"%04hx\", &tmp) != 1) {\n\t\t\t\twarn(\"Unable to parse attribute handle\");\n\t\t\t\tg_free(value);\n\t\t\t\treturn -EIO;\n\t\t\t}\n\n\t\t\tif (current_service)\n\t\t\t\tgatt_db_service_set_active(current_service,\n\t\t\t\t\t\t\t\t\ttrue);\n\n\t\t\tcurrent_service = gatt_db_get_attribute(db, tmp);\n\n\t\t\tgatt_db_attribute_get_service_data(current_service,\n\t\t\t\t\t\t\t&start, &end,\n\t\t\t\t\t\t\t&primary, &uuid);\n\n\t\t\tbt_uuid_to_string(&uuid, uuid_str, sizeof(uuid_str));\n\t\t} else if (g_str_equal(type, GATT_INCLUDE_UUID_STR)) {\n\t\t\tret = load_incl(db, *handle, value, current_service);\n\t\t} else if (g_str_equal(type, GATT_CHARAC_UUID_STR)) {\n\t\t\tret = load_chrc(*handle, value, current_service);\n\t\t} else {\n\t\t\tret = load_desc(*handle, value, current_service);\n\t\t}\n\n\t\tg_free(value);\n\t\tif (ret) {\n\t\t\tgatt_db_clear(db);\n\t\t\treturn ret;\n\t\t}\n\t}\n\n\tif (current_service)\n\t\tgatt_db_service_set_active(current_service, true);\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_key_file_free",
          "args": [
            "key_file"
          ],
          "line": 3485
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_get_keys",
          "args": [
            "key_file",
            "\"Attributes\"",
            "NULL",
            "NULL"
          ],
          "line": 3481
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_load_from_file",
          "args": [
            "key_file",
            "filename",
            "0",
            "NULL"
          ],
          "line": 3480
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_new",
          "args": [],
          "line": 3479
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "filename",
            "PATH_MAX",
            "STORAGEDIR \"/%s/cache/%s\"",
            "local",
            "peer"
          ],
          "line": 3477
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Restoring %s gatt database from file\"",
            "peer"
          ],
          "line": 3475
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gatt_cache_is_enabled",
          "args": [
            "device"
          ],
          "line": 3472
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_cache_is_enabled",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "537-548",
          "snippet": "static bool gatt_cache_is_enabled(struct btd_device *device)\n{\n\tswitch (main_opts.gatt_cache) {\n\tcase BT_GATT_CACHE_YES:\n\t\treturn device_is_paired(device, device->bdaddr_type);\n\tcase BT_GATT_CACHE_NO:\n\t\treturn false;\n\tcase BT_GATT_CACHE_ALWAYS:\n\tdefault:\n\t\treturn true;\n\t}\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic bool gatt_cache_is_enabled(struct btd_device *device)\n{\n\tswitch (main_opts.gatt_cache) {\n\tcase BT_GATT_CACHE_YES:\n\t\treturn device_is_paired(device, device->bdaddr_type);\n\tcase BT_GATT_CACHE_NO:\n\t\treturn false;\n\tcase BT_GATT_CACHE_ALWAYS:\n\tdefault:\n\t\treturn true;\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void load_gatt_db(struct btd_device *device, const char *local,\n\t\t\t\t\t\t\tconst char *peer)\n{\n\tchar **keys, filename[PATH_MAX];\n\tGKeyFile *key_file;\n\n\tif (!gatt_cache_is_enabled(device))\n\t\treturn;\n\n\tDBG(\"Restoring %s gatt database from file\", peer);\n\n\tsnprintf(filename, PATH_MAX, STORAGEDIR \"/%s/cache/%s\", local, peer);\n\n\tkey_file = g_key_file_new();\n\tg_key_file_load_from_file(key_file, filename, 0, NULL);\n\tkeys = g_key_file_get_keys(key_file, \"Attributes\", NULL, NULL);\n\n\tif (!keys) {\n\t\twarn(\"No cache for %s\", peer);\n\t\tg_key_file_free(key_file);\n\t\treturn;\n\t}\n\n\tif (load_gatt_db_impl(key_file, keys, device->db))\n\t\twarn(\"Unable to load gatt db from file for %s\", peer);\n\n\tg_strfreev(keys);\n\tg_key_file_free(key_file);\n\n\tg_slist_free_full(device->primaries, g_free);\n\tdevice->primaries = NULL;\n\tgatt_db_foreach_service(device->db, NULL, add_primary,\n\t\t\t\t\t\t\t&device->primaries);\n}"
  },
  {
    "function_name": "load_gatt_db_impl",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "3378-3464",
    "snippet": "static int load_gatt_db_impl(GKeyFile *key_file, char **keys,\n\t\t\t\t\t\t\tstruct gatt_db *db)\n{\n\tstruct gatt_db_attribute *current_service;\n\tchar **handle, *value, type[MAX_LEN_UUID_STR];\n\tint ret;\n\n\t/* first load service definitions */\n\tfor (handle = keys; *handle; handle++) {\n\t\tvalue = g_key_file_get_string(key_file, \"Attributes\", *handle,\n\t\t\t\t\t\t\t\t\tNULL);\n\n\t\tif (sscanf(value, \"%[^:]:\", type) != 1) {\n\t\t\twarn(\"Missing Type in attribute definition\");\n\t\t\tg_free(value);\n\t\t\treturn -EIO;\n\t\t}\n\n\t\tif (g_str_equal(type, GATT_PRIM_SVC_UUID_STR) ||\n\t\t\t\tg_str_equal(type, GATT_SND_SVC_UUID_STR)) {\n\t\t\tret = load_service(db, *handle, value);\n\t\t\tif (ret) {\n\t\t\t\tg_free(value);\n\t\t\t\treturn ret;\n\t\t\t}\n\t\t}\n\n\t\tg_free(value);\n\t}\n\n\tcurrent_service = NULL;\n\t/* then fill them with data*/\n\tfor (handle = keys; *handle; handle++) {\n\t\tvalue = g_key_file_get_string(key_file, \"Attributes\", *handle,\n\t\t\t\t\t\t\t\t\tNULL);\n\n\t\tif (sscanf(value, \"%[^:]:\", type) != 1) {\n\t\t\twarn(\"Missing Type in attribute definition\");\n\t\t\tg_free(value);\n\t\t\treturn -EIO;\n\t\t}\n\n\t\tif (g_str_equal(type, GATT_PRIM_SVC_UUID_STR) ||\n\t\t\t\tg_str_equal(type, GATT_SND_SVC_UUID_STR)) {\n\t\t\tuint16_t tmp;\n\t\t\tuint16_t start, end;\n\t\t\tbool primary;\n\t\t\tbt_uuid_t uuid;\n\t\t\tchar uuid_str[MAX_LEN_UUID_STR];\n\n\t\t\tif (sscanf(*handle, \"%04hx\", &tmp) != 1) {\n\t\t\t\twarn(\"Unable to parse attribute handle\");\n\t\t\t\tg_free(value);\n\t\t\t\treturn -EIO;\n\t\t\t}\n\n\t\t\tif (current_service)\n\t\t\t\tgatt_db_service_set_active(current_service,\n\t\t\t\t\t\t\t\t\ttrue);\n\n\t\t\tcurrent_service = gatt_db_get_attribute(db, tmp);\n\n\t\t\tgatt_db_attribute_get_service_data(current_service,\n\t\t\t\t\t\t\t&start, &end,\n\t\t\t\t\t\t\t&primary, &uuid);\n\n\t\t\tbt_uuid_to_string(&uuid, uuid_str, sizeof(uuid_str));\n\t\t} else if (g_str_equal(type, GATT_INCLUDE_UUID_STR)) {\n\t\t\tret = load_incl(db, *handle, value, current_service);\n\t\t} else if (g_str_equal(type, GATT_CHARAC_UUID_STR)) {\n\t\t\tret = load_chrc(*handle, value, current_service);\n\t\t} else {\n\t\t\tret = load_desc(*handle, value, current_service);\n\t\t}\n\n\t\tg_free(value);\n\t\tif (ret) {\n\t\t\tgatt_db_clear(db);\n\t\t\treturn ret;\n\t\t}\n\t}\n\n\tif (current_service)\n\t\tgatt_db_service_set_active(current_service, true);\n\n\treturn 0;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define GATT_CHARAC_UUID_STR \"2803\"",
      "#define GATT_INCLUDE_UUID_STR \"2802\"",
      "#define GATT_SND_SVC_UUID_STR  \"2801\"",
      "#define GATT_PRIM_SVC_UUID_STR \"2800\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "gatt_db_service_set_active",
          "args": [
            "current_service",
            "true"
          ],
          "line": 3461
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_service_set_active",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "975-992",
          "snippet": "bool gatt_db_service_set_active(struct gatt_db_attribute *attrib, bool active)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!attrib)\n\t\treturn false;\n\n\tservice = attrib->service;\n\n\tif (service->active == active)\n\t\treturn true;\n\n\tservice->active = active;\n\n\tnotify_service_changed(service->db, service, active);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_service_set_active(struct gatt_db_attribute *attrib, bool active)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!attrib)\n\t\treturn false;\n\n\tservice = attrib->service;\n\n\tif (service->active == active)\n\t\treturn true;\n\n\tservice->active = active;\n\n\tnotify_service_changed(service->db, service, active);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_clear",
          "args": [
            "db"
          ],
          "line": 3455
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_clear",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "425-428",
          "snippet": "bool gatt_db_clear(struct gatt_db *db)\n{\n\treturn gatt_db_clear_range(db, 1, UINT16_MAX);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_clear(struct gatt_db *db)\n{\n\treturn gatt_db_clear_range(db, 1, UINT16_MAX);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "value"
          ],
          "line": 3453
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "load_desc",
          "args": [
            "*handle",
            "value",
            "current_service"
          ],
          "line": 3450
        },
        "resolved": true,
        "details": {
          "function_name": "load_desc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "3227-3273",
          "snippet": "static int load_desc(char *handle, char *value,\n\t\t\t\t\tstruct gatt_db_attribute *service)\n{\n\tchar uuid_str[MAX_LEN_UUID_STR];\n\tstruct gatt_db_attribute *att;\n\tuint16_t handle_int;\n\tuint16_t val;\n\tbt_uuid_t uuid, ext_uuid;\n\n\tif (sscanf(handle, \"%04hx\", &handle_int) != 1)\n\t\treturn -EIO;\n\n\t/* Check if there is any value stored, otherwise it is just the UUID */\n\tif (sscanf(value, \"%04hx:%s\", &val, uuid_str) != 2) {\n\t\tif (sscanf(value, \"%s\", uuid_str) != 1)\n\t\t\treturn -EIO;\n\t\tval = 0;\n\t}\n\n\tDBG(\"loading descriptor handle: 0x%04x, value: 0x%04x, uuid: %s\",\n\t\t\t\thandle_int, val, uuid_str);\n\n\tbt_string_to_uuid(&uuid, uuid_str);\n\tbt_uuid16_create(&ext_uuid, GATT_CHARAC_EXT_PROPER_UUID);\n\n\t/* If it is CEP then it must contain the value */\n\tif (!bt_uuid_cmp(&uuid, &ext_uuid) && !val) {\n\t\twarn(\"cannot load CEP descriptor without value\");\n\t\treturn -EIO;\n\t}\n\n\tatt = gatt_db_service_insert_descriptor(service, handle_int, &uuid,\n\t\t\t\t\t\t\t0, NULL, NULL, NULL);\n\tif (!att || gatt_db_attribute_get_handle(att) != handle_int) {\n\t\twarn(\"loading descriptor to db failed\");\n\t\treturn -EIO;\n\t}\n\n\tif (val) {\n\t\tif (!gatt_db_attribute_write(att, 0, (uint8_t *)&val,\n\t\t\t\t\t\tsizeof(val), 0, NULL,\n\t\t\t\t\t\tload_desc_value, NULL))\n\t\t\treturn -EIO;\n\t}\n\n\treturn 0;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int load_desc(char *handle, char *value,\n\t\t\t\t\tstruct gatt_db_attribute *service)\n{\n\tchar uuid_str[MAX_LEN_UUID_STR];\n\tstruct gatt_db_attribute *att;\n\tuint16_t handle_int;\n\tuint16_t val;\n\tbt_uuid_t uuid, ext_uuid;\n\n\tif (sscanf(handle, \"%04hx\", &handle_int) != 1)\n\t\treturn -EIO;\n\n\t/* Check if there is any value stored, otherwise it is just the UUID */\n\tif (sscanf(value, \"%04hx:%s\", &val, uuid_str) != 2) {\n\t\tif (sscanf(value, \"%s\", uuid_str) != 1)\n\t\t\treturn -EIO;\n\t\tval = 0;\n\t}\n\n\tDBG(\"loading descriptor handle: 0x%04x, value: 0x%04x, uuid: %s\",\n\t\t\t\thandle_int, val, uuid_str);\n\n\tbt_string_to_uuid(&uuid, uuid_str);\n\tbt_uuid16_create(&ext_uuid, GATT_CHARAC_EXT_PROPER_UUID);\n\n\t/* If it is CEP then it must contain the value */\n\tif (!bt_uuid_cmp(&uuid, &ext_uuid) && !val) {\n\t\twarn(\"cannot load CEP descriptor without value\");\n\t\treturn -EIO;\n\t}\n\n\tatt = gatt_db_service_insert_descriptor(service, handle_int, &uuid,\n\t\t\t\t\t\t\t0, NULL, NULL, NULL);\n\tif (!att || gatt_db_attribute_get_handle(att) != handle_int) {\n\t\twarn(\"loading descriptor to db failed\");\n\t\treturn -EIO;\n\t}\n\n\tif (val) {\n\t\tif (!gatt_db_attribute_write(att, 0, (uint8_t *)&val,\n\t\t\t\t\t\tsizeof(val), 0, NULL,\n\t\t\t\t\t\tload_desc_value, NULL))\n\t\t\treturn -EIO;\n\t}\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "load_chrc",
          "args": [
            "*handle",
            "value",
            "current_service"
          ],
          "line": 3448
        },
        "resolved": true,
        "details": {
          "function_name": "load_chrc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "3275-3306",
          "snippet": "static int load_chrc(char *handle, char *value,\n\t\t\t\t\tstruct gatt_db_attribute *service)\n{\n\tuint16_t properties, value_handle, handle_int;\n\tchar uuid_str[MAX_LEN_UUID_STR];\n\tstruct gatt_db_attribute *att;\n\tbt_uuid_t uuid;\n\n\tif (sscanf(handle, \"%04hx\", &handle_int) != 1)\n\t\treturn -EIO;\n\n\tif (sscanf(value, GATT_CHARAC_UUID_STR \":%04hx:%02hx:%s\", &value_handle,\n\t\t\t\t\t\t&properties, uuid_str) != 3)\n\t\treturn -EIO;\n\n\tbt_string_to_uuid(&uuid, uuid_str);\n\n\t/* Log debug message. */\n\tDBG(\"loading characteristic handle: 0x%04x, value handle: 0x%04x,\"\n\t\t\t\t\" properties 0x%04x uuid: %s\", handle_int,\n\t\t\t\tvalue_handle, properties, uuid_str);\n\n\tatt = gatt_db_service_insert_characteristic(service, value_handle,\n\t\t\t\t\t\t\t&uuid, 0, properties,\n\t\t\t\t\t\t\tNULL, NULL, NULL);\n\tif (!att || gatt_db_attribute_get_handle(att) != value_handle) {\n\t\twarn(\"loading characteristic to db failed\");\n\t\treturn -EIO;\n\t}\n\n\treturn 0;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define GATT_CHARAC_UUID_STR \"2803\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\n#define GATT_CHARAC_UUID_STR \"2803\"\n\nstatic int load_chrc(char *handle, char *value,\n\t\t\t\t\tstruct gatt_db_attribute *service)\n{\n\tuint16_t properties, value_handle, handle_int;\n\tchar uuid_str[MAX_LEN_UUID_STR];\n\tstruct gatt_db_attribute *att;\n\tbt_uuid_t uuid;\n\n\tif (sscanf(handle, \"%04hx\", &handle_int) != 1)\n\t\treturn -EIO;\n\n\tif (sscanf(value, GATT_CHARAC_UUID_STR \":%04hx:%02hx:%s\", &value_handle,\n\t\t\t\t\t\t&properties, uuid_str) != 3)\n\t\treturn -EIO;\n\n\tbt_string_to_uuid(&uuid, uuid_str);\n\n\t/* Log debug message. */\n\tDBG(\"loading characteristic handle: 0x%04x, value handle: 0x%04x,\"\n\t\t\t\t\" properties 0x%04x uuid: %s\", handle_int,\n\t\t\t\tvalue_handle, properties, uuid_str);\n\n\tatt = gatt_db_service_insert_characteristic(service, value_handle,\n\t\t\t\t\t\t\t&uuid, 0, properties,\n\t\t\t\t\t\t\tNULL, NULL, NULL);\n\tif (!att || gatt_db_attribute_get_handle(att) != value_handle) {\n\t\twarn(\"loading characteristic to db failed\");\n\t\treturn -EIO;\n\t}\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_str_equal",
          "args": [
            "type",
            "GATT_CHARAC_UUID_STR"
          ],
          "line": 3447
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "load_incl",
          "args": [
            "db",
            "*handle",
            "value",
            "current_service"
          ],
          "line": 3446
        },
        "resolved": true,
        "details": {
          "function_name": "load_incl",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "3308-3339",
          "snippet": "static int load_incl(struct gatt_db *db, char *handle, char *value,\n\t\t\t\t\tstruct gatt_db_attribute *service)\n{\n\tchar uuid_str[MAX_LEN_UUID_STR];\n\tstruct gatt_db_attribute *att;\n\tuint16_t start, end;\n\n\tif (sscanf(handle, \"%04hx\", &start) != 1)\n\t\treturn -EIO;\n\n\tif (sscanf(value, GATT_INCLUDE_UUID_STR \":%04hx:%04hx:%s\", &start, &end,\n\t\t\t\t\t\t\t\tuuid_str) != 3)\n\t\treturn -EIO;\n\n\t/* Log debug message. */\n\tDBG(\"loading included service: 0x%04x, end: 0x%04x, uuid: %s\", start,\n\t\t\t\t\t\t\t\tend, uuid_str);\n\n\tatt = gatt_db_get_attribute(db, start);\n\tif (!att) {\n\t\twarn(\"loading included service to db failed - no such service\");\n\t\treturn -EIO;\n\t}\n\n\tatt = gatt_db_service_add_included(service, att);\n\tif (!att) {\n\t\twarn(\"loading included service to db failed\");\n\t\treturn -EIO;\n\t}\n\n\treturn 0;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define GATT_INCLUDE_UUID_STR \"2802\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\n#define GATT_INCLUDE_UUID_STR \"2802\"\n\nstatic int load_incl(struct gatt_db *db, char *handle, char *value,\n\t\t\t\t\tstruct gatt_db_attribute *service)\n{\n\tchar uuid_str[MAX_LEN_UUID_STR];\n\tstruct gatt_db_attribute *att;\n\tuint16_t start, end;\n\n\tif (sscanf(handle, \"%04hx\", &start) != 1)\n\t\treturn -EIO;\n\n\tif (sscanf(value, GATT_INCLUDE_UUID_STR \":%04hx:%04hx:%s\", &start, &end,\n\t\t\t\t\t\t\t\tuuid_str) != 3)\n\t\treturn -EIO;\n\n\t/* Log debug message. */\n\tDBG(\"loading included service: 0x%04x, end: 0x%04x, uuid: %s\", start,\n\t\t\t\t\t\t\t\tend, uuid_str);\n\n\tatt = gatt_db_get_attribute(db, start);\n\tif (!att) {\n\t\twarn(\"loading included service to db failed - no such service\");\n\t\treturn -EIO;\n\t}\n\n\tatt = gatt_db_service_add_included(service, att);\n\tif (!att) {\n\t\twarn(\"loading included service to db failed\");\n\t\treturn -EIO;\n\t}\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_str_equal",
          "args": [
            "type",
            "GATT_INCLUDE_UUID_STR"
          ],
          "line": 3445
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_uuid_to_string",
          "args": [
            "&uuid",
            "uuid_str",
            "sizeof(uuid_str)"
          ],
          "line": 3444
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gatt_db_attribute_get_service_data",
          "args": [
            "current_service",
            "&start",
            "&end",
            "&primary",
            "&uuid"
          ],
          "line": 3440
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_get_service_data",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1538-1566",
          "snippet": "bool gatt_db_attribute_get_service_data(const struct gatt_db_attribute *attrib,\n\t\t\t\t\t\t\tuint16_t *start_handle,\n\t\t\t\t\t\t\tuint16_t *end_handle,\n\t\t\t\t\t\t\tbool *primary,\n\t\t\t\t\t\t\tbt_uuid_t *uuid)\n{\n\tstruct gatt_db_service *service;\n\tstruct gatt_db_attribute *decl;\n\n\tif (!attrib)\n\t\treturn false;\n\n\tservice = attrib->service;\n\tdecl = service->attributes[0];\n\n\tgatt_db_service_get_handles(service, start_handle, end_handle);\n\n\tif (primary)\n\t\t*primary = bt_uuid_cmp(&decl->uuid, &secondary_service_uuid);\n\n\tif (!uuid)\n\t\treturn true;\n\n\t/*\n\t * The service declaration attribute value is the 16 or 128 bit service\n\t * UUID.\n\t */\n\treturn le_to_uuid(decl->value, decl->value_len, uuid);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static const bt_uuid_t secondary_service_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_SND_SVC_UUID };"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic const bt_uuid_t secondary_service_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_SND_SVC_UUID };\n\nbool gatt_db_attribute_get_service_data(const struct gatt_db_attribute *attrib,\n\t\t\t\t\t\t\tuint16_t *start_handle,\n\t\t\t\t\t\t\tuint16_t *end_handle,\n\t\t\t\t\t\t\tbool *primary,\n\t\t\t\t\t\t\tbt_uuid_t *uuid)\n{\n\tstruct gatt_db_service *service;\n\tstruct gatt_db_attribute *decl;\n\n\tif (!attrib)\n\t\treturn false;\n\n\tservice = attrib->service;\n\tdecl = service->attributes[0];\n\n\tgatt_db_service_get_handles(service, start_handle, end_handle);\n\n\tif (primary)\n\t\t*primary = bt_uuid_cmp(&decl->uuid, &secondary_service_uuid);\n\n\tif (!uuid)\n\t\treturn true;\n\n\t/*\n\t * The service declaration attribute value is the 16 or 128 bit service\n\t * UUID.\n\t */\n\treturn le_to_uuid(decl->value, decl->value_len, uuid);\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_get_attribute",
          "args": [
            "db",
            "tmp"
          ],
          "line": 3438
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_get_attribute",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1423-1445",
          "snippet": "struct gatt_db_attribute *gatt_db_get_attribute(struct gatt_db *db,\n\t\t\t\t\t\t\tuint16_t handle)\n{\n\tstruct gatt_db_attribute *attrib;\n\tstruct gatt_db_service *service;\n\tint i;\n\n\tattrib = gatt_db_get_service(db, handle);\n\tif (!attrib)\n\t\treturn NULL;\n\n\tservice = attrib->service;\n\n\tfor (i = 0; i < service->num_handles; i++) {\n\t\tif (!service->attributes[i])\n\t\t\tcontinue;\n\n\t\tif (service->attributes[i]->handle == handle)\n\t\t\treturn service->attributes[i];\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstruct gatt_db_attribute *gatt_db_get_attribute(struct gatt_db *db,\n\t\t\t\t\t\t\tuint16_t handle)\n{\n\tstruct gatt_db_attribute *attrib;\n\tstruct gatt_db_service *service;\n\tint i;\n\n\tattrib = gatt_db_get_service(db, handle);\n\tif (!attrib)\n\t\treturn NULL;\n\n\tservice = attrib->service;\n\n\tfor (i = 0; i < service->num_handles; i++) {\n\t\tif (!service->attributes[i])\n\t\t\tcontinue;\n\n\t\tif (service->attributes[i]->handle == handle)\n\t\t\treturn service->attributes[i];\n\t}\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "value"
          ],
          "line": 3430
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "warn",
          "args": [
            "\"Unable to parse attribute handle\""
          ],
          "line": 3429
        },
        "resolved": true,
        "details": {
          "function_name": "warn",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/log.c",
          "lines": "151-165",
          "snippet": "void warn(const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_WARNING, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(HCI_DEV_NONE, LOG_WARNING, format, ap);\n\tva_end(ap);\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdarg.h>",
            "#include <syslog.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int logging_fd = -1;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"src/shared/util.h\"\n#include \"lib/hci.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int logging_fd = -1;\n\nvoid warn(const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_WARNING, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(HCI_DEV_NONE, LOG_WARNING, format, ap);\n\tva_end(ap);\n}"
        }
      },
      {
        "call_info": {
          "callee": "sscanf",
          "args": [
            "*handle",
            "\"%04hx\"",
            "&tmp"
          ],
          "line": 3428
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_str_equal",
          "args": [
            "type",
            "GATT_SND_SVC_UUID_STR"
          ],
          "line": 3421
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_str_equal",
          "args": [
            "type",
            "GATT_PRIM_SVC_UUID_STR"
          ],
          "line": 3420
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "value"
          ],
          "line": 3416
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sscanf",
          "args": [
            "value",
            "\"%[^:]:\"",
            "type"
          ],
          "line": 3414
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_get_string",
          "args": [
            "key_file",
            "\"Attributes\"",
            "*handle",
            "NULL"
          ],
          "line": 3411
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "value"
          ],
          "line": 3405
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "value"
          ],
          "line": 3400
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "load_service",
          "args": [
            "db",
            "*handle",
            "value"
          ],
          "line": 3398
        },
        "resolved": true,
        "details": {
          "function_name": "load_service",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "3341-3376",
          "snippet": "static int load_service(struct gatt_db *db, char *handle, char *value)\n{\n\tstruct gatt_db_attribute *att;\n\tuint16_t start, end;\n\tchar type[MAX_LEN_UUID_STR], uuid_str[MAX_LEN_UUID_STR];\n\tbt_uuid_t uuid;\n\tbool primary;\n\n\tif (sscanf(handle, \"%04hx\", &start) != 1)\n\t\treturn -EIO;\n\n\tif (sscanf(value, \"%[^:]:%04hx:%s\", type, &end, uuid_str) != 3)\n\t\treturn -EIO;\n\n\tif (g_str_equal(type, GATT_PRIM_SVC_UUID_STR))\n\t\tprimary = true;\n\telse if (g_str_equal(type, GATT_SND_SVC_UUID_STR))\n\t\tprimary = false;\n\telse\n\t\treturn -EIO;\n\n\tbt_string_to_uuid(&uuid, uuid_str);\n\n\t/* Log debug message. */\n\tDBG(\"loading service: 0x%04x, end: 0x%04x, uuid: %s\",\n\t\t\t\t\t\t\tstart, end, uuid_str);\n\n\tatt = gatt_db_insert_service(db, start, &uuid, primary,\n\t\t\t\t\t\t\tend - start + 1);\n\tif (!att) {\n\t\terror(\"Unable load service into db!\");\n\t\treturn -EIO;\n\t}\n\n\treturn 0;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define GATT_SND_SVC_UUID_STR  \"2801\"",
            "#define GATT_PRIM_SVC_UUID_STR \"2800\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\n#define GATT_SND_SVC_UUID_STR  \"2801\"\n#define GATT_PRIM_SVC_UUID_STR \"2800\"\n\nstatic int load_service(struct gatt_db *db, char *handle, char *value)\n{\n\tstruct gatt_db_attribute *att;\n\tuint16_t start, end;\n\tchar type[MAX_LEN_UUID_STR], uuid_str[MAX_LEN_UUID_STR];\n\tbt_uuid_t uuid;\n\tbool primary;\n\n\tif (sscanf(handle, \"%04hx\", &start) != 1)\n\t\treturn -EIO;\n\n\tif (sscanf(value, \"%[^:]:%04hx:%s\", type, &end, uuid_str) != 3)\n\t\treturn -EIO;\n\n\tif (g_str_equal(type, GATT_PRIM_SVC_UUID_STR))\n\t\tprimary = true;\n\telse if (g_str_equal(type, GATT_SND_SVC_UUID_STR))\n\t\tprimary = false;\n\telse\n\t\treturn -EIO;\n\n\tbt_string_to_uuid(&uuid, uuid_str);\n\n\t/* Log debug message. */\n\tDBG(\"loading service: 0x%04x, end: 0x%04x, uuid: %s\",\n\t\t\t\t\t\t\tstart, end, uuid_str);\n\n\tatt = gatt_db_insert_service(db, start, &uuid, primary,\n\t\t\t\t\t\t\tend - start + 1);\n\tif (!att) {\n\t\terror(\"Unable load service into db!\");\n\t\treturn -EIO;\n\t}\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_str_equal",
          "args": [
            "type",
            "GATT_SND_SVC_UUID_STR"
          ],
          "line": 3397
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_str_equal",
          "args": [
            "type",
            "GATT_PRIM_SVC_UUID_STR"
          ],
          "line": 3396
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "value"
          ],
          "line": 3392
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sscanf",
          "args": [
            "value",
            "\"%[^:]:\"",
            "type"
          ],
          "line": 3390
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_get_string",
          "args": [
            "key_file",
            "\"Attributes\"",
            "*handle",
            "NULL"
          ],
          "line": 3387
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\n#define GATT_CHARAC_UUID_STR \"2803\"\n#define GATT_INCLUDE_UUID_STR \"2802\"\n#define GATT_SND_SVC_UUID_STR  \"2801\"\n#define GATT_PRIM_SVC_UUID_STR \"2800\"\n\nstatic int load_gatt_db_impl(GKeyFile *key_file, char **keys,\n\t\t\t\t\t\t\tstruct gatt_db *db)\n{\n\tstruct gatt_db_attribute *current_service;\n\tchar **handle, *value, type[MAX_LEN_UUID_STR];\n\tint ret;\n\n\t/* first load service definitions */\n\tfor (handle = keys; *handle; handle++) {\n\t\tvalue = g_key_file_get_string(key_file, \"Attributes\", *handle,\n\t\t\t\t\t\t\t\t\tNULL);\n\n\t\tif (sscanf(value, \"%[^:]:\", type) != 1) {\n\t\t\twarn(\"Missing Type in attribute definition\");\n\t\t\tg_free(value);\n\t\t\treturn -EIO;\n\t\t}\n\n\t\tif (g_str_equal(type, GATT_PRIM_SVC_UUID_STR) ||\n\t\t\t\tg_str_equal(type, GATT_SND_SVC_UUID_STR)) {\n\t\t\tret = load_service(db, *handle, value);\n\t\t\tif (ret) {\n\t\t\t\tg_free(value);\n\t\t\t\treturn ret;\n\t\t\t}\n\t\t}\n\n\t\tg_free(value);\n\t}\n\n\tcurrent_service = NULL;\n\t/* then fill them with data*/\n\tfor (handle = keys; *handle; handle++) {\n\t\tvalue = g_key_file_get_string(key_file, \"Attributes\", *handle,\n\t\t\t\t\t\t\t\t\tNULL);\n\n\t\tif (sscanf(value, \"%[^:]:\", type) != 1) {\n\t\t\twarn(\"Missing Type in attribute definition\");\n\t\t\tg_free(value);\n\t\t\treturn -EIO;\n\t\t}\n\n\t\tif (g_str_equal(type, GATT_PRIM_SVC_UUID_STR) ||\n\t\t\t\tg_str_equal(type, GATT_SND_SVC_UUID_STR)) {\n\t\t\tuint16_t tmp;\n\t\t\tuint16_t start, end;\n\t\t\tbool primary;\n\t\t\tbt_uuid_t uuid;\n\t\t\tchar uuid_str[MAX_LEN_UUID_STR];\n\n\t\t\tif (sscanf(*handle, \"%04hx\", &tmp) != 1) {\n\t\t\t\twarn(\"Unable to parse attribute handle\");\n\t\t\t\tg_free(value);\n\t\t\t\treturn -EIO;\n\t\t\t}\n\n\t\t\tif (current_service)\n\t\t\t\tgatt_db_service_set_active(current_service,\n\t\t\t\t\t\t\t\t\ttrue);\n\n\t\t\tcurrent_service = gatt_db_get_attribute(db, tmp);\n\n\t\t\tgatt_db_attribute_get_service_data(current_service,\n\t\t\t\t\t\t\t&start, &end,\n\t\t\t\t\t\t\t&primary, &uuid);\n\n\t\t\tbt_uuid_to_string(&uuid, uuid_str, sizeof(uuid_str));\n\t\t} else if (g_str_equal(type, GATT_INCLUDE_UUID_STR)) {\n\t\t\tret = load_incl(db, *handle, value, current_service);\n\t\t} else if (g_str_equal(type, GATT_CHARAC_UUID_STR)) {\n\t\t\tret = load_chrc(*handle, value, current_service);\n\t\t} else {\n\t\t\tret = load_desc(*handle, value, current_service);\n\t\t}\n\n\t\tg_free(value);\n\t\tif (ret) {\n\t\t\tgatt_db_clear(db);\n\t\t\treturn ret;\n\t\t}\n\t}\n\n\tif (current_service)\n\t\tgatt_db_service_set_active(current_service, true);\n\n\treturn 0;\n}"
  },
  {
    "function_name": "load_service",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "3341-3376",
    "snippet": "static int load_service(struct gatt_db *db, char *handle, char *value)\n{\n\tstruct gatt_db_attribute *att;\n\tuint16_t start, end;\n\tchar type[MAX_LEN_UUID_STR], uuid_str[MAX_LEN_UUID_STR];\n\tbt_uuid_t uuid;\n\tbool primary;\n\n\tif (sscanf(handle, \"%04hx\", &start) != 1)\n\t\treturn -EIO;\n\n\tif (sscanf(value, \"%[^:]:%04hx:%s\", type, &end, uuid_str) != 3)\n\t\treturn -EIO;\n\n\tif (g_str_equal(type, GATT_PRIM_SVC_UUID_STR))\n\t\tprimary = true;\n\telse if (g_str_equal(type, GATT_SND_SVC_UUID_STR))\n\t\tprimary = false;\n\telse\n\t\treturn -EIO;\n\n\tbt_string_to_uuid(&uuid, uuid_str);\n\n\t/* Log debug message. */\n\tDBG(\"loading service: 0x%04x, end: 0x%04x, uuid: %s\",\n\t\t\t\t\t\t\tstart, end, uuid_str);\n\n\tatt = gatt_db_insert_service(db, start, &uuid, primary,\n\t\t\t\t\t\t\tend - start + 1);\n\tif (!att) {\n\t\terror(\"Unable load service into db!\");\n\t\treturn -EIO;\n\t}\n\n\treturn 0;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define GATT_SND_SVC_UUID_STR  \"2801\"",
      "#define GATT_PRIM_SVC_UUID_STR \"2800\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Unable load service into db!\""
          ],
          "line": 3371
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_not_ready",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "118-122",
          "snippet": "DBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_insert_service",
          "args": [
            "db",
            "start",
            "&uuid",
            "primary",
            "end - start + 1"
          ],
          "line": 3368
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_insert_service",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "518-581",
          "snippet": "struct gatt_db_attribute *gatt_db_insert_service(struct gatt_db *db,\n\t\t\t\t\t\t\tuint16_t handle,\n\t\t\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\t\t\tbool primary,\n\t\t\t\t\t\t\tuint16_t num_handles)\n{\n\tstruct gatt_db_service *service, *after;\n\n\tafter = NULL;\n\n\tif (!db || handle < 1)\n\t\treturn NULL;\n\n\tif (num_handles < 1 || (handle + num_handles - 1) > UINT16_MAX)\n\t\treturn NULL;\n\n\tservice = find_insert_loc(db, handle, handle + num_handles - 1, &after);\n\tif (service) {\n\t\tconst bt_uuid_t *type;\n\t\tbt_uuid_t value;\n\n\t\tif (primary)\n\t\t\ttype = &primary_service_uuid;\n\t\telse\n\t\t\ttype = &secondary_service_uuid;\n\n\t\tgatt_db_attribute_get_service_uuid(service->attributes[0],\n\t\t\t\t\t\t\t\t\t&value);\n\n\t\t/* Check if service match */\n\t\tif (!bt_uuid_cmp(&service->attributes[0]->uuid, type) &&\n\t\t\t\t!bt_uuid_cmp(&value, uuid) &&\n\t\t\t\tservice->num_handles == num_handles &&\n\t\t\t\tservice->attributes[0]->handle == handle)\n\t\t\treturn service->attributes[0];\n\n\t\treturn NULL;\n\t}\n\n\tservice = gatt_db_service_create(uuid, handle, primary, num_handles);\n\n\tif (!service)\n\t\treturn NULL;\n\n\tif (after) {\n\t\tif (!queue_push_after(db->services, after, service))\n\t\t\tgoto fail;\n\t} else if (!queue_push_head(db->services, service)) {\n\t\tgoto fail;\n\t}\n\n\tservice->db = db;\n\tservice->attributes[0]->handle = handle;\n\tservice->num_handles = num_handles;\n\n\t/* Fast-forward next_handle if the new service was added to the end */\n\tdb->next_handle = MAX(handle + num_handles, db->next_handle);\n\n\treturn service->attributes[0];\n\nfail:\n\tgatt_db_service_destroy(service);\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static const bt_uuid_t primary_service_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_PRIM_SVC_UUID };",
            "static const bt_uuid_t secondary_service_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_SND_SVC_UUID };"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic const bt_uuid_t primary_service_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_PRIM_SVC_UUID };\nstatic const bt_uuid_t secondary_service_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_SND_SVC_UUID };\n\nstruct gatt_db_attribute *gatt_db_insert_service(struct gatt_db *db,\n\t\t\t\t\t\t\tuint16_t handle,\n\t\t\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\t\t\tbool primary,\n\t\t\t\t\t\t\tuint16_t num_handles)\n{\n\tstruct gatt_db_service *service, *after;\n\n\tafter = NULL;\n\n\tif (!db || handle < 1)\n\t\treturn NULL;\n\n\tif (num_handles < 1 || (handle + num_handles - 1) > UINT16_MAX)\n\t\treturn NULL;\n\n\tservice = find_insert_loc(db, handle, handle + num_handles - 1, &after);\n\tif (service) {\n\t\tconst bt_uuid_t *type;\n\t\tbt_uuid_t value;\n\n\t\tif (primary)\n\t\t\ttype = &primary_service_uuid;\n\t\telse\n\t\t\ttype = &secondary_service_uuid;\n\n\t\tgatt_db_attribute_get_service_uuid(service->attributes[0],\n\t\t\t\t\t\t\t\t\t&value);\n\n\t\t/* Check if service match */\n\t\tif (!bt_uuid_cmp(&service->attributes[0]->uuid, type) &&\n\t\t\t\t!bt_uuid_cmp(&value, uuid) &&\n\t\t\t\tservice->num_handles == num_handles &&\n\t\t\t\tservice->attributes[0]->handle == handle)\n\t\t\treturn service->attributes[0];\n\n\t\treturn NULL;\n\t}\n\n\tservice = gatt_db_service_create(uuid, handle, primary, num_handles);\n\n\tif (!service)\n\t\treturn NULL;\n\n\tif (after) {\n\t\tif (!queue_push_after(db->services, after, service))\n\t\t\tgoto fail;\n\t} else if (!queue_push_head(db->services, service)) {\n\t\tgoto fail;\n\t}\n\n\tservice->db = db;\n\tservice->attributes[0]->handle = handle;\n\tservice->num_handles = num_handles;\n\n\t/* Fast-forward next_handle if the new service was added to the end */\n\tdb->next_handle = MAX(handle + num_handles, db->next_handle);\n\n\treturn service->attributes[0];\n\nfail:\n\tgatt_db_service_destroy(service);\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"loading service: 0x%04x, end: 0x%04x, uuid: %s\"",
            "start",
            "end",
            "uuid_str"
          ],
          "line": 3365
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_string_to_uuid",
          "args": [
            "&uuid",
            "uuid_str"
          ],
          "line": 3362
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_str_equal",
          "args": [
            "type",
            "GATT_SND_SVC_UUID_STR"
          ],
          "line": 3357
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_str_equal",
          "args": [
            "type",
            "GATT_PRIM_SVC_UUID_STR"
          ],
          "line": 3355
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sscanf",
          "args": [
            "value",
            "\"%[^:]:%04hx:%s\"",
            "type",
            "&end",
            "uuid_str"
          ],
          "line": 3352
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sscanf",
          "args": [
            "handle",
            "\"%04hx\"",
            "&start"
          ],
          "line": 3349
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\n#define GATT_SND_SVC_UUID_STR  \"2801\"\n#define GATT_PRIM_SVC_UUID_STR \"2800\"\n\nstatic int load_service(struct gatt_db *db, char *handle, char *value)\n{\n\tstruct gatt_db_attribute *att;\n\tuint16_t start, end;\n\tchar type[MAX_LEN_UUID_STR], uuid_str[MAX_LEN_UUID_STR];\n\tbt_uuid_t uuid;\n\tbool primary;\n\n\tif (sscanf(handle, \"%04hx\", &start) != 1)\n\t\treturn -EIO;\n\n\tif (sscanf(value, \"%[^:]:%04hx:%s\", type, &end, uuid_str) != 3)\n\t\treturn -EIO;\n\n\tif (g_str_equal(type, GATT_PRIM_SVC_UUID_STR))\n\t\tprimary = true;\n\telse if (g_str_equal(type, GATT_SND_SVC_UUID_STR))\n\t\tprimary = false;\n\telse\n\t\treturn -EIO;\n\n\tbt_string_to_uuid(&uuid, uuid_str);\n\n\t/* Log debug message. */\n\tDBG(\"loading service: 0x%04x, end: 0x%04x, uuid: %s\",\n\t\t\t\t\t\t\tstart, end, uuid_str);\n\n\tatt = gatt_db_insert_service(db, start, &uuid, primary,\n\t\t\t\t\t\t\tend - start + 1);\n\tif (!att) {\n\t\terror(\"Unable load service into db!\");\n\t\treturn -EIO;\n\t}\n\n\treturn 0;\n}"
  },
  {
    "function_name": "load_incl",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "3308-3339",
    "snippet": "static int load_incl(struct gatt_db *db, char *handle, char *value,\n\t\t\t\t\tstruct gatt_db_attribute *service)\n{\n\tchar uuid_str[MAX_LEN_UUID_STR];\n\tstruct gatt_db_attribute *att;\n\tuint16_t start, end;\n\n\tif (sscanf(handle, \"%04hx\", &start) != 1)\n\t\treturn -EIO;\n\n\tif (sscanf(value, GATT_INCLUDE_UUID_STR \":%04hx:%04hx:%s\", &start, &end,\n\t\t\t\t\t\t\t\tuuid_str) != 3)\n\t\treturn -EIO;\n\n\t/* Log debug message. */\n\tDBG(\"loading included service: 0x%04x, end: 0x%04x, uuid: %s\", start,\n\t\t\t\t\t\t\t\tend, uuid_str);\n\n\tatt = gatt_db_get_attribute(db, start);\n\tif (!att) {\n\t\twarn(\"loading included service to db failed - no such service\");\n\t\treturn -EIO;\n\t}\n\n\tatt = gatt_db_service_add_included(service, att);\n\tif (!att) {\n\t\twarn(\"loading included service to db failed\");\n\t\treturn -EIO;\n\t}\n\n\treturn 0;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define GATT_INCLUDE_UUID_STR \"2802\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "warn",
          "args": [
            "\"loading included service to db failed\""
          ],
          "line": 3334
        },
        "resolved": true,
        "details": {
          "function_name": "warn",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/log.c",
          "lines": "151-165",
          "snippet": "void warn(const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_WARNING, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(HCI_DEV_NONE, LOG_WARNING, format, ap);\n\tva_end(ap);\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdarg.h>",
            "#include <syslog.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int logging_fd = -1;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"src/shared/util.h\"\n#include \"lib/hci.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int logging_fd = -1;\n\nvoid warn(const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_WARNING, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(HCI_DEV_NONE, LOG_WARNING, format, ap);\n\tva_end(ap);\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_service_add_included",
          "args": [
            "service",
            "att"
          ],
          "line": 3332
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_service_add_included",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "941-949",
          "snippet": "struct gatt_db_attribute *\ngatt_db_service_add_included(struct gatt_db_attribute *attrib,\n\t\t\t\t\tstruct gatt_db_attribute *include)\n{\n\tif (!attrib || !include)\n\t\treturn NULL;\n\n\treturn service_insert_included(attrib->service, 0, include);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstruct gatt_db_attribute *\ngatt_db_service_add_included(struct gatt_db_attribute *attrib,\n\t\t\t\t\tstruct gatt_db_attribute *include)\n{\n\tif (!attrib || !include)\n\t\treturn NULL;\n\n\treturn service_insert_included(attrib->service, 0, include);\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_get_attribute",
          "args": [
            "db",
            "start"
          ],
          "line": 3326
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_get_attribute",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1423-1445",
          "snippet": "struct gatt_db_attribute *gatt_db_get_attribute(struct gatt_db *db,\n\t\t\t\t\t\t\tuint16_t handle)\n{\n\tstruct gatt_db_attribute *attrib;\n\tstruct gatt_db_service *service;\n\tint i;\n\n\tattrib = gatt_db_get_service(db, handle);\n\tif (!attrib)\n\t\treturn NULL;\n\n\tservice = attrib->service;\n\n\tfor (i = 0; i < service->num_handles; i++) {\n\t\tif (!service->attributes[i])\n\t\t\tcontinue;\n\n\t\tif (service->attributes[i]->handle == handle)\n\t\t\treturn service->attributes[i];\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstruct gatt_db_attribute *gatt_db_get_attribute(struct gatt_db *db,\n\t\t\t\t\t\t\tuint16_t handle)\n{\n\tstruct gatt_db_attribute *attrib;\n\tstruct gatt_db_service *service;\n\tint i;\n\n\tattrib = gatt_db_get_service(db, handle);\n\tif (!attrib)\n\t\treturn NULL;\n\n\tservice = attrib->service;\n\n\tfor (i = 0; i < service->num_handles; i++) {\n\t\tif (!service->attributes[i])\n\t\t\tcontinue;\n\n\t\tif (service->attributes[i]->handle == handle)\n\t\t\treturn service->attributes[i];\n\t}\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"loading included service: 0x%04x, end: 0x%04x, uuid: %s\"",
            "start",
            "end",
            "uuid_str"
          ],
          "line": 3323
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sscanf",
          "args": [
            "value",
            "GATT_INCLUDE_UUID_STR \":%04hx:%04hx:%s\"",
            "&start",
            "&end",
            "uuid_str"
          ],
          "line": 3318
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sscanf",
          "args": [
            "handle",
            "\"%04hx\"",
            "&start"
          ],
          "line": 3315
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\n#define GATT_INCLUDE_UUID_STR \"2802\"\n\nstatic int load_incl(struct gatt_db *db, char *handle, char *value,\n\t\t\t\t\tstruct gatt_db_attribute *service)\n{\n\tchar uuid_str[MAX_LEN_UUID_STR];\n\tstruct gatt_db_attribute *att;\n\tuint16_t start, end;\n\n\tif (sscanf(handle, \"%04hx\", &start) != 1)\n\t\treturn -EIO;\n\n\tif (sscanf(value, GATT_INCLUDE_UUID_STR \":%04hx:%04hx:%s\", &start, &end,\n\t\t\t\t\t\t\t\tuuid_str) != 3)\n\t\treturn -EIO;\n\n\t/* Log debug message. */\n\tDBG(\"loading included service: 0x%04x, end: 0x%04x, uuid: %s\", start,\n\t\t\t\t\t\t\t\tend, uuid_str);\n\n\tatt = gatt_db_get_attribute(db, start);\n\tif (!att) {\n\t\twarn(\"loading included service to db failed - no such service\");\n\t\treturn -EIO;\n\t}\n\n\tatt = gatt_db_service_add_included(service, att);\n\tif (!att) {\n\t\twarn(\"loading included service to db failed\");\n\t\treturn -EIO;\n\t}\n\n\treturn 0;\n}"
  },
  {
    "function_name": "load_chrc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "3275-3306",
    "snippet": "static int load_chrc(char *handle, char *value,\n\t\t\t\t\tstruct gatt_db_attribute *service)\n{\n\tuint16_t properties, value_handle, handle_int;\n\tchar uuid_str[MAX_LEN_UUID_STR];\n\tstruct gatt_db_attribute *att;\n\tbt_uuid_t uuid;\n\n\tif (sscanf(handle, \"%04hx\", &handle_int) != 1)\n\t\treturn -EIO;\n\n\tif (sscanf(value, GATT_CHARAC_UUID_STR \":%04hx:%02hx:%s\", &value_handle,\n\t\t\t\t\t\t&properties, uuid_str) != 3)\n\t\treturn -EIO;\n\n\tbt_string_to_uuid(&uuid, uuid_str);\n\n\t/* Log debug message. */\n\tDBG(\"loading characteristic handle: 0x%04x, value handle: 0x%04x,\"\n\t\t\t\t\" properties 0x%04x uuid: %s\", handle_int,\n\t\t\t\tvalue_handle, properties, uuid_str);\n\n\tatt = gatt_db_service_insert_characteristic(service, value_handle,\n\t\t\t\t\t\t\t&uuid, 0, properties,\n\t\t\t\t\t\t\tNULL, NULL, NULL);\n\tif (!att || gatt_db_attribute_get_handle(att) != value_handle) {\n\t\twarn(\"loading characteristic to db failed\");\n\t\treturn -EIO;\n\t}\n\n\treturn 0;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define GATT_CHARAC_UUID_STR \"2803\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "warn",
          "args": [
            "\"loading characteristic to db failed\""
          ],
          "line": 3301
        },
        "resolved": true,
        "details": {
          "function_name": "warn",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/log.c",
          "lines": "151-165",
          "snippet": "void warn(const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_WARNING, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(HCI_DEV_NONE, LOG_WARNING, format, ap);\n\tva_end(ap);\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdarg.h>",
            "#include <syslog.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int logging_fd = -1;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"src/shared/util.h\"\n#include \"lib/hci.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int logging_fd = -1;\n\nvoid warn(const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_WARNING, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(HCI_DEV_NONE, LOG_WARNING, format, ap);\n\tva_end(ap);\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_attribute_get_handle",
          "args": [
            "att"
          ],
          "line": 3300
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_get_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1482-1488",
          "snippet": "uint16_t gatt_db_attribute_get_handle(const struct gatt_db_attribute *attrib)\n{\n\tif (!attrib)\n\t\treturn 0;\n\n\treturn attrib->handle;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nuint16_t gatt_db_attribute_get_handle(const struct gatt_db_attribute *attrib)\n{\n\tif (!attrib)\n\t\treturn 0;\n\n\treturn attrib->handle;\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_service_insert_characteristic",
          "args": [
            "service",
            "value_handle",
            "&uuid",
            "0",
            "properties",
            "NULL",
            "NULL",
            "NULL"
          ],
          "line": 3297
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_service_insert_characteristic",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "761-778",
          "snippet": "struct gatt_db_attribute *\ngatt_db_service_insert_characteristic(struct gatt_db_attribute *attrib,\n\t\t\t\t\tuint16_t handle,\n\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\tuint32_t permissions,\n\t\t\t\t\tuint8_t properties,\n\t\t\t\t\tgatt_db_read_t read_func,\n\t\t\t\t\tgatt_db_write_t write_func,\n\t\t\t\t\tvoid *user_data)\n{\n\tif (!attrib || !handle)\n\t\treturn NULL;\n\n\treturn service_insert_characteristic(attrib->service, handle, uuid,\n\t\t\t\t\t\tpermissions, properties,\n\t\t\t\t\t\tread_func, write_func,\n\t\t\t\t\t\tuser_data);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstruct gatt_db_attribute *\ngatt_db_service_insert_characteristic(struct gatt_db_attribute *attrib,\n\t\t\t\t\tuint16_t handle,\n\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\tuint32_t permissions,\n\t\t\t\t\tuint8_t properties,\n\t\t\t\t\tgatt_db_read_t read_func,\n\t\t\t\t\tgatt_db_write_t write_func,\n\t\t\t\t\tvoid *user_data)\n{\n\tif (!attrib || !handle)\n\t\treturn NULL;\n\n\treturn service_insert_characteristic(attrib->service, handle, uuid,\n\t\t\t\t\t\tpermissions, properties,\n\t\t\t\t\t\tread_func, write_func,\n\t\t\t\t\t\tuser_data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"loading characteristic handle: 0x%04x, value handle: 0x%04x,\"\n\t\t\t\t\" properties 0x%04x uuid: %s\"",
            "handle_int",
            "value_handle",
            "properties",
            "uuid_str"
          ],
          "line": 3293
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_string_to_uuid",
          "args": [
            "&uuid",
            "uuid_str"
          ],
          "line": 3290
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sscanf",
          "args": [
            "value",
            "GATT_CHARAC_UUID_STR \":%04hx:%02hx:%s\"",
            "&value_handle",
            "&properties",
            "uuid_str"
          ],
          "line": 3286
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sscanf",
          "args": [
            "handle",
            "\"%04hx\"",
            "&handle_int"
          ],
          "line": 3283
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\n#define GATT_CHARAC_UUID_STR \"2803\"\n\nstatic int load_chrc(char *handle, char *value,\n\t\t\t\t\tstruct gatt_db_attribute *service)\n{\n\tuint16_t properties, value_handle, handle_int;\n\tchar uuid_str[MAX_LEN_UUID_STR];\n\tstruct gatt_db_attribute *att;\n\tbt_uuid_t uuid;\n\n\tif (sscanf(handle, \"%04hx\", &handle_int) != 1)\n\t\treturn -EIO;\n\n\tif (sscanf(value, GATT_CHARAC_UUID_STR \":%04hx:%02hx:%s\", &value_handle,\n\t\t\t\t\t\t&properties, uuid_str) != 3)\n\t\treturn -EIO;\n\n\tbt_string_to_uuid(&uuid, uuid_str);\n\n\t/* Log debug message. */\n\tDBG(\"loading characteristic handle: 0x%04x, value handle: 0x%04x,\"\n\t\t\t\t\" properties 0x%04x uuid: %s\", handle_int,\n\t\t\t\tvalue_handle, properties, uuid_str);\n\n\tatt = gatt_db_service_insert_characteristic(service, value_handle,\n\t\t\t\t\t\t\t&uuid, 0, properties,\n\t\t\t\t\t\t\tNULL, NULL, NULL);\n\tif (!att || gatt_db_attribute_get_handle(att) != value_handle) {\n\t\twarn(\"loading characteristic to db failed\");\n\t\treturn -EIO;\n\t}\n\n\treturn 0;\n}"
  },
  {
    "function_name": "load_desc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "3227-3273",
    "snippet": "static int load_desc(char *handle, char *value,\n\t\t\t\t\tstruct gatt_db_attribute *service)\n{\n\tchar uuid_str[MAX_LEN_UUID_STR];\n\tstruct gatt_db_attribute *att;\n\tuint16_t handle_int;\n\tuint16_t val;\n\tbt_uuid_t uuid, ext_uuid;\n\n\tif (sscanf(handle, \"%04hx\", &handle_int) != 1)\n\t\treturn -EIO;\n\n\t/* Check if there is any value stored, otherwise it is just the UUID */\n\tif (sscanf(value, \"%04hx:%s\", &val, uuid_str) != 2) {\n\t\tif (sscanf(value, \"%s\", uuid_str) != 1)\n\t\t\treturn -EIO;\n\t\tval = 0;\n\t}\n\n\tDBG(\"loading descriptor handle: 0x%04x, value: 0x%04x, uuid: %s\",\n\t\t\t\thandle_int, val, uuid_str);\n\n\tbt_string_to_uuid(&uuid, uuid_str);\n\tbt_uuid16_create(&ext_uuid, GATT_CHARAC_EXT_PROPER_UUID);\n\n\t/* If it is CEP then it must contain the value */\n\tif (!bt_uuid_cmp(&uuid, &ext_uuid) && !val) {\n\t\twarn(\"cannot load CEP descriptor without value\");\n\t\treturn -EIO;\n\t}\n\n\tatt = gatt_db_service_insert_descriptor(service, handle_int, &uuid,\n\t\t\t\t\t\t\t0, NULL, NULL, NULL);\n\tif (!att || gatt_db_attribute_get_handle(att) != handle_int) {\n\t\twarn(\"loading descriptor to db failed\");\n\t\treturn -EIO;\n\t}\n\n\tif (val) {\n\t\tif (!gatt_db_attribute_write(att, 0, (uint8_t *)&val,\n\t\t\t\t\t\tsizeof(val), 0, NULL,\n\t\t\t\t\t\tload_desc_value, NULL))\n\t\t\treturn -EIO;\n\t}\n\n\treturn 0;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "gatt_db_attribute_write",
          "args": [
            "att",
            "0",
            "(uint8_t *)&val",
            "sizeof(val)",
            "0",
            "NULL",
            "load_desc_value",
            "NULL"
          ],
          "line": 3266
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_write",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1805-1860",
          "snippet": "bool gatt_db_attribute_write(struct gatt_db_attribute *attrib, uint16_t offset,\n\t\t\t\t\tconst uint8_t *value, size_t len,\n\t\t\t\t\tuint8_t opcode, struct bt_att *att,\n\t\t\t\t\tgatt_db_attribute_write_t func,\n\t\t\t\t\tvoid *user_data)\n{\n\tif (!attrib || !func)\n\t\treturn false;\n\n\tif (attrib->write_func) {\n\t\tstruct pending_write *p;\n\n\t\tp = new0(struct pending_write, 1);\n\t\tp->attrib = attrib;\n\t\tp->id = ++attrib->write_id;\n\t\tp->timeout_id = timeout_add(ATTRIBUTE_TIMEOUT, write_timeout,\n\t\t\t\t\t\t\t\tp, NULL);\n\t\tp->func = func;\n\t\tp->user_data = user_data;\n\n\t\tqueue_push_tail(attrib->pending_writes, p);\n\n\t\tattrib->write_func(attrib, p->id, offset, value, len, opcode,\n\t\t\t\t\t\t\tatt, attrib->user_data);\n\t\treturn true;\n\t}\n\n\t/* Nothing to write just skip */\n\tif (len == 0)\n\t\tgoto done;\n\n\t/* For values stored in db allocate on demand */\n\tif (!attrib->value || offset >= attrib->value_len ||\n\t\t\t\tlen > (unsigned) (attrib->value_len - offset)) {\n\t\tvoid *buf;\n\n\t\tbuf = realloc(attrib->value, len + offset);\n\t\tif (!buf)\n\t\t\treturn false;\n\n\t\tattrib->value = buf;\n\n\t\t/* Init data in the first allocation */\n\t\tif (!attrib->value_len)\n\t\t\tmemset(attrib->value, 0, offset);\n\n\t\tattrib->value_len = len + offset;\n\t}\n\n\tmemcpy(&attrib->value[offset], value, len);\n\ndone:\n\tfunc(attrib, 0, user_data);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define ATTRIBUTE_TIMEOUT 5000"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\n#define ATTRIBUTE_TIMEOUT 5000\n\nbool gatt_db_attribute_write(struct gatt_db_attribute *attrib, uint16_t offset,\n\t\t\t\t\tconst uint8_t *value, size_t len,\n\t\t\t\t\tuint8_t opcode, struct bt_att *att,\n\t\t\t\t\tgatt_db_attribute_write_t func,\n\t\t\t\t\tvoid *user_data)\n{\n\tif (!attrib || !func)\n\t\treturn false;\n\n\tif (attrib->write_func) {\n\t\tstruct pending_write *p;\n\n\t\tp = new0(struct pending_write, 1);\n\t\tp->attrib = attrib;\n\t\tp->id = ++attrib->write_id;\n\t\tp->timeout_id = timeout_add(ATTRIBUTE_TIMEOUT, write_timeout,\n\t\t\t\t\t\t\t\tp, NULL);\n\t\tp->func = func;\n\t\tp->user_data = user_data;\n\n\t\tqueue_push_tail(attrib->pending_writes, p);\n\n\t\tattrib->write_func(attrib, p->id, offset, value, len, opcode,\n\t\t\t\t\t\t\tatt, attrib->user_data);\n\t\treturn true;\n\t}\n\n\t/* Nothing to write just skip */\n\tif (len == 0)\n\t\tgoto done;\n\n\t/* For values stored in db allocate on demand */\n\tif (!attrib->value || offset >= attrib->value_len ||\n\t\t\t\tlen > (unsigned) (attrib->value_len - offset)) {\n\t\tvoid *buf;\n\n\t\tbuf = realloc(attrib->value, len + offset);\n\t\tif (!buf)\n\t\t\treturn false;\n\n\t\tattrib->value = buf;\n\n\t\t/* Init data in the first allocation */\n\t\tif (!attrib->value_len)\n\t\t\tmemset(attrib->value, 0, offset);\n\n\t\tattrib->value_len = len + offset;\n\t}\n\n\tmemcpy(&attrib->value[offset], value, len);\n\ndone:\n\tfunc(attrib, 0, user_data);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "warn",
          "args": [
            "\"loading descriptor to db failed\""
          ],
          "line": 3261
        },
        "resolved": true,
        "details": {
          "function_name": "warn",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/log.c",
          "lines": "151-165",
          "snippet": "void warn(const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_WARNING, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(HCI_DEV_NONE, LOG_WARNING, format, ap);\n\tva_end(ap);\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdarg.h>",
            "#include <syslog.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int logging_fd = -1;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"src/shared/util.h\"\n#include \"lib/hci.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int logging_fd = -1;\n\nvoid warn(const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_WARNING, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(HCI_DEV_NONE, LOG_WARNING, format, ap);\n\tva_end(ap);\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_attribute_get_handle",
          "args": [
            "att"
          ],
          "line": 3260
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_get_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1482-1488",
          "snippet": "uint16_t gatt_db_attribute_get_handle(const struct gatt_db_attribute *attrib)\n{\n\tif (!attrib)\n\t\treturn 0;\n\n\treturn attrib->handle;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nuint16_t gatt_db_attribute_get_handle(const struct gatt_db_attribute *attrib)\n{\n\tif (!attrib)\n\t\treturn 0;\n\n\treturn attrib->handle;\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_service_insert_descriptor",
          "args": [
            "service",
            "handle_int",
            "&uuid",
            "0",
            "NULL",
            "NULL",
            "NULL"
          ],
          "line": 3258
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_service_insert_descriptor",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "850-865",
          "snippet": "struct gatt_db_attribute *\ngatt_db_service_insert_descriptor(struct gatt_db_attribute *attrib,\n\t\t\t\t\tuint16_t handle,\n\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\tuint32_t permissions,\n\t\t\t\t\tgatt_db_read_t read_func,\n\t\t\t\t\tgatt_db_write_t write_func,\n\t\t\t\t\tvoid *user_data)\n{\n\tif (!attrib || !handle)\n\t\treturn NULL;\n\n\treturn service_insert_descriptor(attrib->service, handle, uuid,\n\t\t\t\t\tpermissions, read_func, write_func,\n\t\t\t\t\tuser_data);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstruct gatt_db_attribute *\ngatt_db_service_insert_descriptor(struct gatt_db_attribute *attrib,\n\t\t\t\t\tuint16_t handle,\n\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\tuint32_t permissions,\n\t\t\t\t\tgatt_db_read_t read_func,\n\t\t\t\t\tgatt_db_write_t write_func,\n\t\t\t\t\tvoid *user_data)\n{\n\tif (!attrib || !handle)\n\t\treturn NULL;\n\n\treturn service_insert_descriptor(attrib->service, handle, uuid,\n\t\t\t\t\tpermissions, read_func, write_func,\n\t\t\t\t\tuser_data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_uuid_cmp",
          "args": [
            "&uuid",
            "&ext_uuid"
          ],
          "line": 3253
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_uuid16_create",
          "args": [
            "&ext_uuid",
            "GATT_CHARAC_EXT_PROPER_UUID"
          ],
          "line": 3250
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_string_to_uuid",
          "args": [
            "&uuid",
            "uuid_str"
          ],
          "line": 3249
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"loading descriptor handle: 0x%04x, value: 0x%04x, uuid: %s\"",
            "handle_int",
            "val",
            "uuid_str"
          ],
          "line": 3246
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sscanf",
          "args": [
            "value",
            "\"%s\"",
            "uuid_str"
          ],
          "line": 3241
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sscanf",
          "args": [
            "value",
            "\"%04hx:%s\"",
            "&val",
            "uuid_str"
          ],
          "line": 3240
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sscanf",
          "args": [
            "handle",
            "\"%04hx\"",
            "&handle_int"
          ],
          "line": 3236
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int load_desc(char *handle, char *value,\n\t\t\t\t\tstruct gatt_db_attribute *service)\n{\n\tchar uuid_str[MAX_LEN_UUID_STR];\n\tstruct gatt_db_attribute *att;\n\tuint16_t handle_int;\n\tuint16_t val;\n\tbt_uuid_t uuid, ext_uuid;\n\n\tif (sscanf(handle, \"%04hx\", &handle_int) != 1)\n\t\treturn -EIO;\n\n\t/* Check if there is any value stored, otherwise it is just the UUID */\n\tif (sscanf(value, \"%04hx:%s\", &val, uuid_str) != 2) {\n\t\tif (sscanf(value, \"%s\", uuid_str) != 1)\n\t\t\treturn -EIO;\n\t\tval = 0;\n\t}\n\n\tDBG(\"loading descriptor handle: 0x%04x, value: 0x%04x, uuid: %s\",\n\t\t\t\thandle_int, val, uuid_str);\n\n\tbt_string_to_uuid(&uuid, uuid_str);\n\tbt_uuid16_create(&ext_uuid, GATT_CHARAC_EXT_PROPER_UUID);\n\n\t/* If it is CEP then it must contain the value */\n\tif (!bt_uuid_cmp(&uuid, &ext_uuid) && !val) {\n\t\twarn(\"cannot load CEP descriptor without value\");\n\t\treturn -EIO;\n\t}\n\n\tatt = gatt_db_service_insert_descriptor(service, handle_int, &uuid,\n\t\t\t\t\t\t\t0, NULL, NULL, NULL);\n\tif (!att || gatt_db_attribute_get_handle(att) != handle_int) {\n\t\twarn(\"loading descriptor to db failed\");\n\t\treturn -EIO;\n\t}\n\n\tif (val) {\n\t\tif (!gatt_db_attribute_write(att, 0, (uint8_t *)&val,\n\t\t\t\t\t\tsizeof(val), 0, NULL,\n\t\t\t\t\t\tload_desc_value, NULL))\n\t\t\treturn -EIO;\n\t}\n\n\treturn 0;\n}"
  },
  {
    "function_name": "load_desc_value",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "3220-3225",
    "snippet": "static void load_desc_value(struct gatt_db_attribute *attrib,\n\t\t\t\t\t\tint err, void *user_data)\n{\n\tif (err)\n\t\twarn(\"loading descriptor value to db failed\");\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "warn",
          "args": [
            "\"loading descriptor value to db failed\""
          ],
          "line": 3224
        },
        "resolved": true,
        "details": {
          "function_name": "warn",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/log.c",
          "lines": "151-165",
          "snippet": "void warn(const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_WARNING, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(HCI_DEV_NONE, LOG_WARNING, format, ap);\n\tva_end(ap);\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdarg.h>",
            "#include <syslog.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int logging_fd = -1;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"src/shared/util.h\"\n#include \"lib/hci.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int logging_fd = -1;\n\nvoid warn(const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_WARNING, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(HCI_DEV_NONE, LOG_WARNING, format, ap);\n\tva_end(ap);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void load_desc_value(struct gatt_db_attribute *attrib,\n\t\t\t\t\t\tint err, void *user_data)\n{\n\tif (err)\n\t\twarn(\"loading descriptor value to db failed\");\n}"
  },
  {
    "function_name": "add_primary",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "3200-3218",
    "snippet": "static void add_primary(struct gatt_db_attribute *attr, void *user_data)\n{\n\tGSList **new_services = user_data;\n\tstruct gatt_primary *prim;\n\tbt_uuid_t uuid;\n\n\tprim = g_new0(struct gatt_primary, 1);\n\tif (!prim) {\n\t\tDBG(\"Failed to allocate gatt_primary structure\");\n\t\treturn;\n\t}\n\n\tgatt_db_attribute_get_service_handles(attr, &prim->range.start,\n\t\t\t\t\t\t\t&prim->range.end);\n\tgatt_db_attribute_get_service_uuid(attr, &uuid);\n\tbt_uuid_to_string(&uuid, prim->uuid, sizeof(prim->uuid));\n\n\t*new_services = g_slist_append(*new_services, prim);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_slist_append",
          "args": [
            "*new_services",
            "prim"
          ],
          "line": 3217
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_uuid_to_string",
          "args": [
            "&uuid",
            "prim->uuid",
            "sizeof(prim->uuid)"
          ],
          "line": 3215
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gatt_db_attribute_get_service_uuid",
          "args": [
            "attr",
            "&uuid"
          ],
          "line": 3214
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_get_service_uuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1490-1519",
          "snippet": "bool gatt_db_attribute_get_service_uuid(const struct gatt_db_attribute *attrib,\n\t\t\t\t\t\t\tbt_uuid_t *uuid)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!attrib || !uuid)\n\t\treturn false;\n\n\tservice = attrib->service;\n\n\tif (service->attributes[0]->value_len == sizeof(uint16_t)) {\n\t\tuint16_t value;\n\n\t\tvalue = get_le16(service->attributes[0]->value);\n\t\tbt_uuid16_create(uuid, value);\n\n\t\treturn true;\n\t}\n\n\tif (service->attributes[0]->value_len == sizeof(uint128_t)) {\n\t\tuint128_t value;\n\n\t\tbswap_128(service->attributes[0]->value, &value);\n\t\tbt_uuid128_create(uuid, value);\n\n\t\treturn true;\n\t}\n\n\treturn false;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_attribute_get_service_uuid(const struct gatt_db_attribute *attrib,\n\t\t\t\t\t\t\tbt_uuid_t *uuid)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!attrib || !uuid)\n\t\treturn false;\n\n\tservice = attrib->service;\n\n\tif (service->attributes[0]->value_len == sizeof(uint16_t)) {\n\t\tuint16_t value;\n\n\t\tvalue = get_le16(service->attributes[0]->value);\n\t\tbt_uuid16_create(uuid, value);\n\n\t\treturn true;\n\t}\n\n\tif (service->attributes[0]->value_len == sizeof(uint128_t)) {\n\t\tuint128_t value;\n\n\t\tbswap_128(service->attributes[0]->value, &value);\n\t\tbt_uuid128_create(uuid, value);\n\n\t\treturn true;\n\t}\n\n\treturn false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_attribute_get_service_handles",
          "args": [
            "attr",
            "&prim->range.start",
            "&prim->range.end"
          ],
          "line": 3212
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_get_service_handles",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1521-1536",
          "snippet": "bool gatt_db_attribute_get_service_handles(\n\t\t\t\t\tconst struct gatt_db_attribute *attrib,\n\t\t\t\t\tuint16_t *start_handle,\n\t\t\t\t\tuint16_t *end_handle)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!attrib)\n\t\treturn false;\n\n\tservice = attrib->service;\n\n\tgatt_db_service_get_handles(service, start_handle, end_handle);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_attribute_get_service_handles(\n\t\t\t\t\tconst struct gatt_db_attribute *attrib,\n\t\t\t\t\tuint16_t *start_handle,\n\t\t\t\t\tuint16_t *end_handle)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!attrib)\n\t\treturn false;\n\n\tservice = attrib->service;\n\n\tgatt_db_service_get_handles(service, start_handle, end_handle);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Failed to allocate gatt_primary structure\""
          ],
          "line": 3208
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_new0",
          "args": [
            "structgatt_primary",
            "1"
          ],
          "line": 3206
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void add_primary(struct gatt_db_attribute *attr, void *user_data)\n{\n\tGSList **new_services = user_data;\n\tstruct gatt_primary *prim;\n\tbt_uuid_t uuid;\n\n\tprim = g_new0(struct gatt_primary, 1);\n\tif (!prim) {\n\t\tDBG(\"Failed to allocate gatt_primary structure\");\n\t\treturn;\n\t}\n\n\tgatt_db_attribute_get_service_handles(attr, &prim->range.start,\n\t\t\t\t\t\t\t&prim->range.end);\n\tgatt_db_attribute_get_service_uuid(attr, &uuid);\n\tbt_uuid_to_string(&uuid, prim->uuid, sizeof(prim->uuid));\n\n\t*new_services = g_slist_append(*new_services, prim);\n}"
  },
  {
    "function_name": "device_register_primaries",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "3194-3198",
    "snippet": "static void device_register_primaries(struct btd_device *device,\n\t\t\t\t\t\tGSList *prim_list, int psm)\n{\n\tdevice->primaries = g_slist_concat(device->primaries, prim_list);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_slist_concat",
          "args": [
            "device->primaries",
            "prim_list"
          ],
          "line": 3197
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void device_register_primaries(struct btd_device *device,\n\t\t\t\t\t\tGSList *prim_list, int psm)\n{\n\tdevice->primaries = g_slist_concat(device->primaries, prim_list);\n}"
  },
  {
    "function_name": "load_att_info",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "3106-3192",
    "snippet": "static void load_att_info(struct btd_device *device, const char *local,\n\t\t\t\tconst char *peer)\n{\n\tchar filename[PATH_MAX];\n\tGKeyFile *key_file;\n\tchar *prim_uuid, *str;\n\tchar **groups, **handle, *service_uuid;\n\tstruct gatt_primary *prim;\n\tuuid_t uuid;\n\tchar tmp[3];\n\tint i;\n\n\tsdp_uuid16_create(&uuid, GATT_PRIM_SVC_UUID);\n\tprim_uuid = bt_uuid2string(&uuid);\n\n\tsnprintf(filename, PATH_MAX, STORAGEDIR \"/%s/%s/attributes\", local,\n\t\t\tpeer);\n\n\tkey_file = g_key_file_new();\n\tg_key_file_load_from_file(key_file, filename, 0, NULL);\n\tgroups = g_key_file_get_groups(key_file, NULL);\n\n\tfor (handle = groups; *handle; handle++) {\n\t\tgboolean uuid_ok;\n\t\tint end;\n\n\t\tstr = g_key_file_get_string(key_file, *handle, \"UUID\", NULL);\n\t\tif (!str)\n\t\t\tcontinue;\n\n\t\tuuid_ok = g_str_equal(str, prim_uuid);\n\t\tg_free(str);\n\n\t\tif (!uuid_ok)\n\t\t\tcontinue;\n\n\t\tstr = g_key_file_get_string(key_file, *handle, \"Value\", NULL);\n\t\tif (!str)\n\t\t\tcontinue;\n\n\t\tend = g_key_file_get_integer(key_file, *handle,\n\t\t\t\t\t\t\"EndGroupHandle\", NULL);\n\t\tif (end == 0) {\n\t\t\tg_free(str);\n\t\t\tcontinue;\n\t\t}\n\n\t\tprim = g_new0(struct gatt_primary, 1);\n\t\tprim->range.start = atoi(*handle);\n\t\tprim->range.end = end;\n\n\t\tswitch (strlen(str)) {\n\t\tcase 4:\n\t\t\tuuid.type = SDP_UUID16;\n\t\t\tsscanf(str, \"%04hx\", &uuid.value.uuid16);\n\t\tbreak;\n\t\tcase 8:\n\t\t\tuuid.type = SDP_UUID32;\n\t\t\tsscanf(str, \"%08x\", &uuid.value.uuid32);\n\t\t\tbreak;\n\t\tcase 32:\n\t\t\tuuid.type = SDP_UUID128;\n\t\t\tmemset(tmp, 0, sizeof(tmp));\n\t\t\tfor (i = 0; i < 16; i++) {\n\t\t\t\tmemcpy(tmp, str + (i * 2), 2);\n\t\t\t\tuuid.value.uuid128.data[i] =\n\t\t\t\t\t\t(uint8_t) strtol(tmp, NULL, 16);\n\t\t\t}\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tg_free(str);\n\t\t\tg_free(prim);\n\t\t\tcontinue;\n\t\t}\n\n\t\tservice_uuid = bt_uuid2string(&uuid);\n\t\tmemcpy(prim->uuid, service_uuid, MAX_LEN_UUID_STR);\n\t\tfree(service_uuid);\n\t\tg_free(str);\n\n\t\tdevice->primaries = g_slist_append(device->primaries, prim);\n\t}\n\n\tg_strfreev(groups);\n\tg_key_file_free(key_file);\n\tfree(prim_uuid);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "prim_uuid"
          ],
          "line": 3191
        },
        "resolved": true,
        "details": {
          "function_name": "device_auth_req_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5662-5676",
          "snippet": "static void device_auth_req_free(struct btd_device *device)\n{\n\tstruct authentication_req *authr = device->authr;\n\n\tif (!authr)\n\t\treturn;\n\n\tif (authr->agent)\n\t\tagent_unref(authr->agent);\n\n\tg_free(authr->pincode);\n\tg_free(authr);\n\n\tdevice->authr = NULL;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void device_auth_req_free(struct btd_device *device)\n{\n\tstruct authentication_req *authr = device->authr;\n\n\tif (!authr)\n\t\treturn;\n\n\tif (authr->agent)\n\t\tagent_unref(authr->agent);\n\n\tg_free(authr->pincode);\n\tg_free(authr);\n\n\tdevice->authr = NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_key_file_free",
          "args": [
            "key_file"
          ],
          "line": 3190
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strfreev",
          "args": [
            "groups"
          ],
          "line": 3189
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_append",
          "args": [
            "device->primaries",
            "prim"
          ],
          "line": 3186
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "str"
          ],
          "line": 3184
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "prim->uuid",
            "service_uuid",
            "MAX_LEN_UUID_STR"
          ],
          "line": 3182
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_uuid2string",
          "args": [
            "&uuid"
          ],
          "line": 3181
        },
        "resolved": true,
        "details": {
          "function_name": "bt_uuid2string",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/uuid-helper.c",
          "lines": "65-110",
          "snippet": "char *bt_uuid2string(uuid_t *uuid)\n{\n\tchar *str;\n\tuuid_t uuid128;\n\tunsigned int data0;\n\tunsigned short data1;\n\tunsigned short data2;\n\tunsigned short data3;\n\tunsigned int data4;\n\tunsigned short data5;\n\tint err;\n\n\tif (!uuid)\n\t\treturn NULL;\n\n\tswitch (uuid->type) {\n\tcase SDP_UUID16:\n\t\tsdp_uuid16_to_uuid128(&uuid128, uuid);\n\t\tbreak;\n\tcase SDP_UUID32:\n\t\tsdp_uuid32_to_uuid128(&uuid128, uuid);\n\t\tbreak;\n\tcase SDP_UUID128:\n\t\tmemcpy(&uuid128, uuid, sizeof(uuid_t));\n\t\tbreak;\n\tdefault:\n\t\t/* Type of UUID unknown */\n\t\treturn NULL;\n\t}\n\n\tmemcpy(&data0, &uuid128.value.uuid128.data[0], 4);\n\tmemcpy(&data1, &uuid128.value.uuid128.data[4], 2);\n\tmemcpy(&data2, &uuid128.value.uuid128.data[6], 2);\n\tmemcpy(&data3, &uuid128.value.uuid128.data[8], 2);\n\tmemcpy(&data4, &uuid128.value.uuid128.data[10], 4);\n\tmemcpy(&data5, &uuid128.value.uuid128.data[14], 2);\n\n\terr = asprintf(&str, \"%.8x-%.4x-%.4x-%.4x-%.8x%.4x\",\n\t\t\tntohl(data0), ntohs(data1),\n\t\t\tntohs(data2), ntohs(data3),\n\t\t\tntohl(data4), ntohs(data5));\n\tif (err < 0)\n\t\treturn NULL;\n\n\treturn str;\n}",
          "includes": [
            "#include \"uuid-helper.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <arpa/inet.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"uuid-helper.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <arpa/inet.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *bt_uuid2string(uuid_t *uuid)\n{\n\tchar *str;\n\tuuid_t uuid128;\n\tunsigned int data0;\n\tunsigned short data1;\n\tunsigned short data2;\n\tunsigned short data3;\n\tunsigned int data4;\n\tunsigned short data5;\n\tint err;\n\n\tif (!uuid)\n\t\treturn NULL;\n\n\tswitch (uuid->type) {\n\tcase SDP_UUID16:\n\t\tsdp_uuid16_to_uuid128(&uuid128, uuid);\n\t\tbreak;\n\tcase SDP_UUID32:\n\t\tsdp_uuid32_to_uuid128(&uuid128, uuid);\n\t\tbreak;\n\tcase SDP_UUID128:\n\t\tmemcpy(&uuid128, uuid, sizeof(uuid_t));\n\t\tbreak;\n\tdefault:\n\t\t/* Type of UUID unknown */\n\t\treturn NULL;\n\t}\n\n\tmemcpy(&data0, &uuid128.value.uuid128.data[0], 4);\n\tmemcpy(&data1, &uuid128.value.uuid128.data[4], 2);\n\tmemcpy(&data2, &uuid128.value.uuid128.data[6], 2);\n\tmemcpy(&data3, &uuid128.value.uuid128.data[8], 2);\n\tmemcpy(&data4, &uuid128.value.uuid128.data[10], 4);\n\tmemcpy(&data5, &uuid128.value.uuid128.data[14], 2);\n\n\terr = asprintf(&str, \"%.8x-%.4x-%.4x-%.4x-%.8x%.4x\",\n\t\t\tntohl(data0), ntohs(data1),\n\t\t\tntohs(data2), ntohs(data3),\n\t\t\tntohl(data4), ntohs(data5));\n\tif (err < 0)\n\t\treturn NULL;\n\n\treturn str;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "prim"
          ],
          "line": 3177
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "str"
          ],
          "line": 3176
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strtol",
          "args": [
            "tmp",
            "NULL",
            "16"
          ],
          "line": 3172
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "tmp",
            "str + (i * 2)",
            "2"
          ],
          "line": 3170
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "tmp",
            "0",
            "sizeof(tmp)"
          ],
          "line": 3168
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sscanf",
          "args": [
            "str",
            "\"%08x\"",
            "&uuid.value.uuid32"
          ],
          "line": 3164
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sscanf",
          "args": [
            "str",
            "\"%04hx\"",
            "&uuid.value.uuid16"
          ],
          "line": 3160
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "str"
          ],
          "line": 3157
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "atoi",
          "args": [
            "*handle"
          ],
          "line": 3154
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_new0",
          "args": [
            "structgatt_primary",
            "1"
          ],
          "line": 3153
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "str"
          ],
          "line": 3149
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_get_integer",
          "args": [
            "key_file",
            "*handle",
            "\"EndGroupHandle\"",
            "NULL"
          ],
          "line": 3146
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_get_string",
          "args": [
            "key_file",
            "*handle",
            "\"Value\"",
            "NULL"
          ],
          "line": 3142
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "str"
          ],
          "line": 3137
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_str_equal",
          "args": [
            "str",
            "prim_uuid"
          ],
          "line": 3136
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_get_string",
          "args": [
            "key_file",
            "*handle",
            "\"UUID\"",
            "NULL"
          ],
          "line": 3132
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_get_groups",
          "args": [
            "key_file",
            "NULL"
          ],
          "line": 3126
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_load_from_file",
          "args": [
            "key_file",
            "filename",
            "0",
            "NULL"
          ],
          "line": 3125
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_new",
          "args": [],
          "line": 3124
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "filename",
            "PATH_MAX",
            "STORAGEDIR \"/%s/%s/attributes\"",
            "local",
            "peer"
          ],
          "line": 3121
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_uuid16_create",
          "args": [
            "&uuid",
            "GATT_PRIM_SVC_UUID"
          ],
          "line": 3118
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void load_att_info(struct btd_device *device, const char *local,\n\t\t\t\tconst char *peer)\n{\n\tchar filename[PATH_MAX];\n\tGKeyFile *key_file;\n\tchar *prim_uuid, *str;\n\tchar **groups, **handle, *service_uuid;\n\tstruct gatt_primary *prim;\n\tuuid_t uuid;\n\tchar tmp[3];\n\tint i;\n\n\tsdp_uuid16_create(&uuid, GATT_PRIM_SVC_UUID);\n\tprim_uuid = bt_uuid2string(&uuid);\n\n\tsnprintf(filename, PATH_MAX, STORAGEDIR \"/%s/%s/attributes\", local,\n\t\t\tpeer);\n\n\tkey_file = g_key_file_new();\n\tg_key_file_load_from_file(key_file, filename, 0, NULL);\n\tgroups = g_key_file_get_groups(key_file, NULL);\n\n\tfor (handle = groups; *handle; handle++) {\n\t\tgboolean uuid_ok;\n\t\tint end;\n\n\t\tstr = g_key_file_get_string(key_file, *handle, \"UUID\", NULL);\n\t\tif (!str)\n\t\t\tcontinue;\n\n\t\tuuid_ok = g_str_equal(str, prim_uuid);\n\t\tg_free(str);\n\n\t\tif (!uuid_ok)\n\t\t\tcontinue;\n\n\t\tstr = g_key_file_get_string(key_file, *handle, \"Value\", NULL);\n\t\tif (!str)\n\t\t\tcontinue;\n\n\t\tend = g_key_file_get_integer(key_file, *handle,\n\t\t\t\t\t\t\"EndGroupHandle\", NULL);\n\t\tif (end == 0) {\n\t\t\tg_free(str);\n\t\t\tcontinue;\n\t\t}\n\n\t\tprim = g_new0(struct gatt_primary, 1);\n\t\tprim->range.start = atoi(*handle);\n\t\tprim->range.end = end;\n\n\t\tswitch (strlen(str)) {\n\t\tcase 4:\n\t\t\tuuid.type = SDP_UUID16;\n\t\t\tsscanf(str, \"%04hx\", &uuid.value.uuid16);\n\t\tbreak;\n\t\tcase 8:\n\t\t\tuuid.type = SDP_UUID32;\n\t\t\tsscanf(str, \"%08x\", &uuid.value.uuid32);\n\t\t\tbreak;\n\t\tcase 32:\n\t\t\tuuid.type = SDP_UUID128;\n\t\t\tmemset(tmp, 0, sizeof(tmp));\n\t\t\tfor (i = 0; i < 16; i++) {\n\t\t\t\tmemcpy(tmp, str + (i * 2), 2);\n\t\t\t\tuuid.value.uuid128.data[i] =\n\t\t\t\t\t\t(uint8_t) strtol(tmp, NULL, 16);\n\t\t\t}\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tg_free(str);\n\t\t\tg_free(prim);\n\t\t\tcontinue;\n\t\t}\n\n\t\tservice_uuid = bt_uuid2string(&uuid);\n\t\tmemcpy(prim->uuid, service_uuid, MAX_LEN_UUID_STR);\n\t\tfree(service_uuid);\n\t\tg_free(str);\n\n\t\tdevice->primaries = g_slist_append(device->primaries, prim);\n\t}\n\n\tg_strfreev(groups);\n\tg_key_file_free(key_file);\n\tfree(prim_uuid);\n}"
  },
  {
    "function_name": "load_info",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "2985-3104",
    "snippet": "static void load_info(struct btd_device *device, const char *local,\n\t\t\tconst char *peer, GKeyFile *key_file)\n{\n\tchar *str;\n\tgboolean store_needed = FALSE;\n\tgboolean blocked;\n\tchar **uuids;\n\tint source, vendor, product, version;\n\tchar **techno, **t;\n\n\t/* Load device name from storage info file, if that fails fall back to\n\t * the cache.\n\t */\n\tstr = g_key_file_get_string(key_file, \"General\", \"Name\", NULL);\n\tif (str == NULL) {\n\t\tstr = load_cached_name(device, local, peer);\n\t\tif (str)\n\t\t\tstore_needed = TRUE;\n\t}\n\n\tif (str) {\n\t\tstrcpy(device->name, str);\n\t\tg_free(str);\n\t}\n\n\t/* Load alias */\n\tdevice->alias = g_key_file_get_string(key_file, \"General\", \"Alias\",\n\t\t\t\t\t\t\t\t\tNULL);\n\n\t/* Load class */\n\tstr = g_key_file_get_string(key_file, \"General\", \"Class\", NULL);\n\tif (str) {\n\t\tuint32_t class;\n\n\t\tif (sscanf(str, \"%x\", &class) == 1)\n\t\t\tdevice->class = class;\n\t\tg_free(str);\n\t}\n\n\t/* Load appearance */\n\tstr = g_key_file_get_string(key_file, \"General\", \"Appearance\", NULL);\n\tif (str) {\n\t\tdevice->appearance = strtol(str, NULL, 16);\n\t\tg_free(str);\n\t}\n\n\t/* Load device technology */\n\ttechno = g_key_file_get_string_list(key_file, \"General\",\n\t\t\t\t\t\"SupportedTechnologies\", NULL, NULL);\n\tif (!techno)\n\t\tgoto next;\n\n\tfor (t = techno; *t; t++) {\n\t\tif (g_str_equal(*t, \"BR/EDR\"))\n\t\t\tdevice->bredr = true;\n\t\telse if (g_str_equal(*t, \"LE\"))\n\t\t\tdevice->le = true;\n\t\telse\n\t\t\terror(\"Unknown device technology\");\n\t}\n\n\tif (!device->le) {\n\t\tdevice->bdaddr_type = BDADDR_BREDR;\n\t} else {\n\t\tstr = g_key_file_get_string(key_file, \"General\",\n\t\t\t\t\t\t\"AddressType\", NULL);\n\n\t\tif (str && g_str_equal(str, \"public\"))\n\t\t\tdevice->bdaddr_type = BDADDR_LE_PUBLIC;\n\t\telse if (str && g_str_equal(str, \"static\"))\n\t\t\tdevice->bdaddr_type = BDADDR_LE_RANDOM;\n\t\telse\n\t\t\terror(\"Unknown LE device technology\");\n\n\t\tg_free(str);\n\n\t\tdevice->local_csrk = load_csrk(key_file, \"LocalSignatureKey\");\n\t\tdevice->remote_csrk = load_csrk(key_file, \"RemoteSignatureKey\");\n\t}\n\n\tg_strfreev(techno);\n\nnext:\n\t/* Load trust */\n\tdevice->trusted = g_key_file_get_boolean(key_file, \"General\",\n\t\t\t\t\t\t\t\"Trusted\", NULL);\n\n\t/* Load device blocked */\n\tblocked = g_key_file_get_boolean(key_file, \"General\", \"Blocked\", NULL);\n\tif (blocked)\n\t\tdevice_block(device, FALSE);\n\n\t/* Load device profile list */\n\tuuids = g_key_file_get_string_list(key_file, \"General\", \"Services\",\n\t\t\t\t\t\tNULL, NULL);\n\tif (uuids) {\n\t\tload_services(device, uuids);\n\n\t\t/* Discovered services restored from storage */\n\t\tdevice->bredr_state.svc_resolved = true;\n\t}\n\n\t/* Load device id */\n\tsource = g_key_file_get_integer(key_file, \"DeviceID\", \"Source\", NULL);\n\tif (source) {\n\t\tvendor = g_key_file_get_integer(key_file, \"DeviceID\",\n\t\t\t\t\t\t\t\"Vendor\", NULL);\n\n\t\tproduct = g_key_file_get_integer(key_file, \"DeviceID\",\n\t\t\t\t\t\t\t\"Product\", NULL);\n\n\t\tversion = g_key_file_get_integer(key_file, \"DeviceID\",\n\t\t\t\t\t\t\t\"Version\", NULL);\n\n\t\tbtd_device_set_pnpid(device, source, vendor, product, version);\n\t}\n\n\tif (store_needed)\n\t\tstore_device_info(device);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "store_device_info",
          "args": [
            "device"
          ],
          "line": 3103
        },
        "resolved": true,
        "details": {
          "function_name": "store_device_info",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "475-487",
          "snippet": "static void store_device_info(struct btd_device *device)\n{\n\tif (device->temporary || device->store_id > 0)\n\t\treturn;\n\n\tif (device_address_is_private(device)) {\n\t\tDBG(\"Can't store info for private addressed device %s\",\n\t\t\t\t\t\t\t\tdevice->path);\n\t\treturn;\n\t}\n\n\tdevice->store_id = g_idle_add(store_device_info_cb, device);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void store_device_info(struct btd_device *device)\n{\n\tif (device->temporary || device->store_id > 0)\n\t\treturn;\n\n\tif (device_address_is_private(device)) {\n\t\tDBG(\"Can't store info for private addressed device %s\",\n\t\t\t\t\t\t\t\tdevice->path);\n\t\treturn;\n\t}\n\n\tdevice->store_id = g_idle_add(store_device_info_cb, device);\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_device_set_pnpid",
          "args": [
            "device",
            "source",
            "vendor",
            "product",
            "version"
          ],
          "line": 3099
        },
        "resolved": true,
        "details": {
          "function_name": "btd_device_set_pnpid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "6408-6427",
          "snippet": "void btd_device_set_pnpid(struct btd_device *device, uint16_t source,\n\t\t\tuint16_t vendor, uint16_t product, uint16_t version)\n{\n\tif (device->vendor_src == source && device->version == version &&\n\t\t\tdevice->vendor == vendor && device->product == product)\n\t\treturn;\n\n\tdevice->vendor_src = source;\n\tdevice->vendor = vendor;\n\tdevice->product = product;\n\tdevice->version = version;\n\n\tfree(device->modalias);\n\tdevice->modalias = bt_modalias(source, vendor, product, version);\n\n\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"Modalias\");\n\n\tstore_device_info(device);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *dbus_conn = NULL;",
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid btd_device_set_pnpid(struct btd_device *device, uint16_t source,\n\t\t\tuint16_t vendor, uint16_t product, uint16_t version)\n{\n\tif (device->vendor_src == source && device->version == version &&\n\t\t\tdevice->vendor == vendor && device->product == product)\n\t\treturn;\n\n\tdevice->vendor_src = source;\n\tdevice->vendor = vendor;\n\tdevice->product = product;\n\tdevice->version = version;\n\n\tfree(device->modalias);\n\tdevice->modalias = bt_modalias(source, vendor, product, version);\n\n\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"Modalias\");\n\n\tstore_device_info(device);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_key_file_get_integer",
          "args": [
            "key_file",
            "\"DeviceID\"",
            "\"Version\"",
            "NULL"
          ],
          "line": 3096
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_get_integer",
          "args": [
            "key_file",
            "\"DeviceID\"",
            "\"Product\"",
            "NULL"
          ],
          "line": 3093
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_get_integer",
          "args": [
            "key_file",
            "\"DeviceID\"",
            "\"Vendor\"",
            "NULL"
          ],
          "line": 3090
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_get_integer",
          "args": [
            "key_file",
            "\"DeviceID\"",
            "\"Source\"",
            "NULL"
          ],
          "line": 3088
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "load_services",
          "args": [
            "device",
            "uuids"
          ],
          "line": 3081
        },
        "resolved": true,
        "details": {
          "function_name": "load_services",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "2930-2944",
          "snippet": "static void load_services(struct btd_device *device, char **uuids)\n{\n\tchar **uuid;\n\n\tfor (uuid = uuids; *uuid; uuid++) {\n\t\tif (g_slist_find_custom(device->uuids, *uuid, bt_uuid_strcmp))\n\t\t\tcontinue;\n\n\t\tdevice->uuids = g_slist_insert_sorted(device->uuids,\n\t\t\t\t\t\t\tg_strdup(*uuid),\n\t\t\t\t\t\t\tbt_uuid_strcmp);\n\t}\n\n\tg_strfreev(uuids);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void load_services(struct btd_device *device, char **uuids)\n{\n\tchar **uuid;\n\n\tfor (uuid = uuids; *uuid; uuid++) {\n\t\tif (g_slist_find_custom(device->uuids, *uuid, bt_uuid_strcmp))\n\t\t\tcontinue;\n\n\t\tdevice->uuids = g_slist_insert_sorted(device->uuids,\n\t\t\t\t\t\t\tg_strdup(*uuid),\n\t\t\t\t\t\t\tbt_uuid_strcmp);\n\t}\n\n\tg_strfreev(uuids);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_key_file_get_string_list",
          "args": [
            "key_file",
            "\"General\"",
            "\"Services\"",
            "NULL",
            "NULL"
          ],
          "line": 3078
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device_block",
          "args": [
            "device",
            "FALSE"
          ],
          "line": 3075
        },
        "resolved": true,
        "details": {
          "function_name": "device_block",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "1334-1377",
          "snippet": "int device_block(struct btd_device *device, gboolean update_only)\n{\n\tint err = 0;\n\n\tif (device->blocked)\n\t\treturn 0;\n\n\tif (device->disconn_timer > 0)\n\t\tg_source_remove(device->disconn_timer);\n\n\tdisconnect_all(device);\n\n\twhile (device->services != NULL) {\n\t\tstruct btd_service *service = device->services->data;\n\n\t\tdevice->services = g_slist_remove(device->services, service);\n\t\tservice_remove(service);\n\t}\n\n\tif (!update_only) {\n\t\tif (device->le)\n\t\t\terr = btd_adapter_block_address(device->adapter,\n\t\t\t\t\t\t\t&device->bdaddr,\n\t\t\t\t\t\t\tdevice->bdaddr_type);\n\t\tif (!err && device->bredr)\n\t\t\terr = btd_adapter_block_address(device->adapter,\n\t\t\t\t\t\t\t&device->bdaddr,\n\t\t\t\t\t\t\tBDADDR_BREDR);\n\t}\n\n\tif (err < 0)\n\t\treturn err;\n\n\tdevice->blocked = TRUE;\n\n\tstore_device_info(device);\n\n\tbtd_device_set_temporary(device, false);\n\n\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"Blocked\");\n\n\treturn 0;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *dbus_conn = NULL;",
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic void gatt_client_init(struct btd_device *device);\n\nint device_block(struct btd_device *device, gboolean update_only)\n{\n\tint err = 0;\n\n\tif (device->blocked)\n\t\treturn 0;\n\n\tif (device->disconn_timer > 0)\n\t\tg_source_remove(device->disconn_timer);\n\n\tdisconnect_all(device);\n\n\twhile (device->services != NULL) {\n\t\tstruct btd_service *service = device->services->data;\n\n\t\tdevice->services = g_slist_remove(device->services, service);\n\t\tservice_remove(service);\n\t}\n\n\tif (!update_only) {\n\t\tif (device->le)\n\t\t\terr = btd_adapter_block_address(device->adapter,\n\t\t\t\t\t\t\t&device->bdaddr,\n\t\t\t\t\t\t\tdevice->bdaddr_type);\n\t\tif (!err && device->bredr)\n\t\t\terr = btd_adapter_block_address(device->adapter,\n\t\t\t\t\t\t\t&device->bdaddr,\n\t\t\t\t\t\t\tBDADDR_BREDR);\n\t}\n\n\tif (err < 0)\n\t\treturn err;\n\n\tdevice->blocked = TRUE;\n\n\tstore_device_info(device);\n\n\tbtd_device_set_temporary(device, false);\n\n\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"Blocked\");\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_key_file_get_boolean",
          "args": [
            "key_file",
            "\"General\"",
            "\"Blocked\"",
            "NULL"
          ],
          "line": 3073
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_get_boolean",
          "args": [
            "key_file",
            "\"General\"",
            "\"Trusted\"",
            "NULL"
          ],
          "line": 3069
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strfreev",
          "args": [
            "techno"
          ],
          "line": 3065
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "load_csrk",
          "args": [
            "key_file",
            "\"RemoteSignatureKey\""
          ],
          "line": 3062
        },
        "resolved": true,
        "details": {
          "function_name": "load_csrk",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "2896-2928",
          "snippet": "static struct csrk_info *load_csrk(GKeyFile *key_file, const char *group)\n{\n\tstruct csrk_info *csrk;\n\tchar *str;\n\tint i;\n\n\tstr = g_key_file_get_string(key_file, group, \"Key\", NULL);\n\tif (!str)\n\t\treturn NULL;\n\n\tcsrk = g_new0(struct csrk_info, 1);\n\n\tfor (i = 0; i < 16; i++) {\n\t\tif (sscanf(str + (i * 2), \"%2hhx\", &csrk->key[i]) != 1)\n\t\t\tgoto fail;\n\t}\n\n\t/*\n\t * In case of older storage this will return 0 which is fine since it\n\t * didn't support signing at that point the counter should never have\n\t * been used.\n\t */\n\tcsrk->counter = g_key_file_get_integer(key_file, group, \"Counter\",\n\t\t\t\t\t\t\t\t\tNULL);\n\tg_free(str);\n\n\treturn csrk;\n\nfail:\n\tg_free(str);\n\tg_free(csrk);\n\treturn NULL;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic struct csrk_info *load_csrk(GKeyFile *key_file, const char *group)\n{\n\tstruct csrk_info *csrk;\n\tchar *str;\n\tint i;\n\n\tstr = g_key_file_get_string(key_file, group, \"Key\", NULL);\n\tif (!str)\n\t\treturn NULL;\n\n\tcsrk = g_new0(struct csrk_info, 1);\n\n\tfor (i = 0; i < 16; i++) {\n\t\tif (sscanf(str + (i * 2), \"%2hhx\", &csrk->key[i]) != 1)\n\t\t\tgoto fail;\n\t}\n\n\t/*\n\t * In case of older storage this will return 0 which is fine since it\n\t * didn't support signing at that point the counter should never have\n\t * been used.\n\t */\n\tcsrk->counter = g_key_file_get_integer(key_file, group, \"Counter\",\n\t\t\t\t\t\t\t\t\tNULL);\n\tg_free(str);\n\n\treturn csrk;\n\nfail:\n\tg_free(str);\n\tg_free(csrk);\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "str"
          ],
          "line": 3059
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Unknown LE device technology\""
          ],
          "line": 3057
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_not_ready",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "118-122",
          "snippet": "DBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_str_equal",
          "args": [
            "str",
            "\"static\""
          ],
          "line": 3054
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_str_equal",
          "args": [
            "str",
            "\"public\""
          ],
          "line": 3052
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_get_string",
          "args": [
            "key_file",
            "\"General\"",
            "\"AddressType\"",
            "NULL"
          ],
          "line": 3049
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_str_equal",
          "args": [
            "*t",
            "\"LE\""
          ],
          "line": 3040
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_str_equal",
          "args": [
            "*t",
            "\"BR/EDR\""
          ],
          "line": 3038
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_get_string_list",
          "args": [
            "key_file",
            "\"General\"",
            "\"SupportedTechnologies\"",
            "NULL",
            "NULL"
          ],
          "line": 3032
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "str"
          ],
          "line": 3028
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strtol",
          "args": [
            "str",
            "NULL",
            "16"
          ],
          "line": 3027
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_get_string",
          "args": [
            "key_file",
            "\"General\"",
            "\"Appearance\"",
            "NULL"
          ],
          "line": 3025
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "str"
          ],
          "line": 3021
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sscanf",
          "args": [
            "str",
            "\"%x\"",
            "&class"
          ],
          "line": 3019
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_get_string",
          "args": [
            "key_file",
            "\"General\"",
            "\"Class\"",
            "NULL"
          ],
          "line": 3015
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_get_string",
          "args": [
            "key_file",
            "\"General\"",
            "\"Alias\"",
            "NULL"
          ],
          "line": 3011
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "str"
          ],
          "line": 3007
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "device->name",
            "str"
          ],
          "line": 3006
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "load_cached_name",
          "args": [
            "device",
            "local",
            "peer"
          ],
          "line": 3000
        },
        "resolved": true,
        "details": {
          "function_name": "load_cached_name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "2865-2894",
          "snippet": "static char *load_cached_name(struct btd_device *device, const char *local,\n\t\t\t\tconst char *peer)\n{\n\tchar filename[PATH_MAX];\n\tGKeyFile *key_file;\n\tchar *str = NULL;\n\tint len;\n\n\tif (device_address_is_private(device))\n\t\treturn NULL;\n\n\tsnprintf(filename, PATH_MAX, STORAGEDIR \"/%s/cache/%s\", local, peer);\n\n\tkey_file = g_key_file_new();\n\n\tif (!g_key_file_load_from_file(key_file, filename, 0, NULL))\n\t\tgoto failed;\n\n\tstr = g_key_file_get_string(key_file, \"General\", \"Name\", NULL);\n\tif (str) {\n\t\tlen = strlen(str);\n\t\tif (len > HCI_MAX_NAME_LENGTH)\n\t\t\tstr[HCI_MAX_NAME_LENGTH] = '\\0';\n\t}\n\nfailed:\n\tg_key_file_free(key_file);\n\n\treturn str;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic char *load_cached_name(struct btd_device *device, const char *local,\n\t\t\t\tconst char *peer)\n{\n\tchar filename[PATH_MAX];\n\tGKeyFile *key_file;\n\tchar *str = NULL;\n\tint len;\n\n\tif (device_address_is_private(device))\n\t\treturn NULL;\n\n\tsnprintf(filename, PATH_MAX, STORAGEDIR \"/%s/cache/%s\", local, peer);\n\n\tkey_file = g_key_file_new();\n\n\tif (!g_key_file_load_from_file(key_file, filename, 0, NULL))\n\t\tgoto failed;\n\n\tstr = g_key_file_get_string(key_file, \"General\", \"Name\", NULL);\n\tif (str) {\n\t\tlen = strlen(str);\n\t\tif (len > HCI_MAX_NAME_LENGTH)\n\t\t\tstr[HCI_MAX_NAME_LENGTH] = '\\0';\n\t}\n\nfailed:\n\tg_key_file_free(key_file);\n\n\treturn str;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_key_file_get_string",
          "args": [
            "key_file",
            "\"General\"",
            "\"Name\"",
            "NULL"
          ],
          "line": 2998
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void load_info(struct btd_device *device, const char *local,\n\t\t\tconst char *peer, GKeyFile *key_file)\n{\n\tchar *str;\n\tgboolean store_needed = FALSE;\n\tgboolean blocked;\n\tchar **uuids;\n\tint source, vendor, product, version;\n\tchar **techno, **t;\n\n\t/* Load device name from storage info file, if that fails fall back to\n\t * the cache.\n\t */\n\tstr = g_key_file_get_string(key_file, \"General\", \"Name\", NULL);\n\tif (str == NULL) {\n\t\tstr = load_cached_name(device, local, peer);\n\t\tif (str)\n\t\t\tstore_needed = TRUE;\n\t}\n\n\tif (str) {\n\t\tstrcpy(device->name, str);\n\t\tg_free(str);\n\t}\n\n\t/* Load alias */\n\tdevice->alias = g_key_file_get_string(key_file, \"General\", \"Alias\",\n\t\t\t\t\t\t\t\t\tNULL);\n\n\t/* Load class */\n\tstr = g_key_file_get_string(key_file, \"General\", \"Class\", NULL);\n\tif (str) {\n\t\tuint32_t class;\n\n\t\tif (sscanf(str, \"%x\", &class) == 1)\n\t\t\tdevice->class = class;\n\t\tg_free(str);\n\t}\n\n\t/* Load appearance */\n\tstr = g_key_file_get_string(key_file, \"General\", \"Appearance\", NULL);\n\tif (str) {\n\t\tdevice->appearance = strtol(str, NULL, 16);\n\t\tg_free(str);\n\t}\n\n\t/* Load device technology */\n\ttechno = g_key_file_get_string_list(key_file, \"General\",\n\t\t\t\t\t\"SupportedTechnologies\", NULL, NULL);\n\tif (!techno)\n\t\tgoto next;\n\n\tfor (t = techno; *t; t++) {\n\t\tif (g_str_equal(*t, \"BR/EDR\"))\n\t\t\tdevice->bredr = true;\n\t\telse if (g_str_equal(*t, \"LE\"))\n\t\t\tdevice->le = true;\n\t\telse\n\t\t\terror(\"Unknown device technology\");\n\t}\n\n\tif (!device->le) {\n\t\tdevice->bdaddr_type = BDADDR_BREDR;\n\t} else {\n\t\tstr = g_key_file_get_string(key_file, \"General\",\n\t\t\t\t\t\t\"AddressType\", NULL);\n\n\t\tif (str && g_str_equal(str, \"public\"))\n\t\t\tdevice->bdaddr_type = BDADDR_LE_PUBLIC;\n\t\telse if (str && g_str_equal(str, \"static\"))\n\t\t\tdevice->bdaddr_type = BDADDR_LE_RANDOM;\n\t\telse\n\t\t\terror(\"Unknown LE device technology\");\n\n\t\tg_free(str);\n\n\t\tdevice->local_csrk = load_csrk(key_file, \"LocalSignatureKey\");\n\t\tdevice->remote_csrk = load_csrk(key_file, \"RemoteSignatureKey\");\n\t}\n\n\tg_strfreev(techno);\n\nnext:\n\t/* Load trust */\n\tdevice->trusted = g_key_file_get_boolean(key_file, \"General\",\n\t\t\t\t\t\t\t\"Trusted\", NULL);\n\n\t/* Load device blocked */\n\tblocked = g_key_file_get_boolean(key_file, \"General\", \"Blocked\", NULL);\n\tif (blocked)\n\t\tdevice_block(device, FALSE);\n\n\t/* Load device profile list */\n\tuuids = g_key_file_get_string_list(key_file, \"General\", \"Services\",\n\t\t\t\t\t\tNULL, NULL);\n\tif (uuids) {\n\t\tload_services(device, uuids);\n\n\t\t/* Discovered services restored from storage */\n\t\tdevice->bredr_state.svc_resolved = true;\n\t}\n\n\t/* Load device id */\n\tsource = g_key_file_get_integer(key_file, \"DeviceID\", \"Source\", NULL);\n\tif (source) {\n\t\tvendor = g_key_file_get_integer(key_file, \"DeviceID\",\n\t\t\t\t\t\t\t\"Vendor\", NULL);\n\n\t\tproduct = g_key_file_get_integer(key_file, \"DeviceID\",\n\t\t\t\t\t\t\t\"Product\", NULL);\n\n\t\tversion = g_key_file_get_integer(key_file, \"DeviceID\",\n\t\t\t\t\t\t\t\"Version\", NULL);\n\n\t\tbtd_device_set_pnpid(device, source, vendor, product, version);\n\t}\n\n\tif (store_needed)\n\t\tstore_device_info(device);\n}"
  },
  {
    "function_name": "convert_info",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "2946-2983",
    "snippet": "static void convert_info(struct btd_device *device, GKeyFile *key_file)\n{\n\tchar filename[PATH_MAX];\n\tchar adapter_addr[18];\n\tchar device_addr[18];\n\tchar **uuids;\n\tchar *str;\n\tgsize length = 0;\n\n\t/* Load device profile list from legacy properties */\n\tuuids = g_key_file_get_string_list(key_file, \"General\", \"SDPServices\",\n\t\t\t\t\t\t\t\tNULL, NULL);\n\tif (uuids)\n\t\tload_services(device, uuids);\n\n\tuuids = g_key_file_get_string_list(key_file, \"General\", \"GATTServices\",\n\t\t\t\t\t\t\t\tNULL, NULL);\n\tif (uuids)\n\t\tload_services(device, uuids);\n\n\tif (!device->uuids)\n\t\treturn;\n\n\t/* Remove old entries so they are not loaded again */\n\tg_key_file_remove_key(key_file, \"General\", \"SDPServices\", NULL);\n\tg_key_file_remove_key(key_file, \"General\", \"GATTServices\", NULL);\n\n\tba2str(btd_adapter_get_address(device->adapter), adapter_addr);\n\tba2str(&device->bdaddr, device_addr);\n\tsnprintf(filename, PATH_MAX, STORAGEDIR \"/%s/%s/info\", adapter_addr,\n\t\t\tdevice_addr);\n\n\tstr = g_key_file_to_data(key_file, &length, NULL);\n\tg_file_set_contents(filename, str, length, NULL);\n\tg_free(str);\n\n\tstore_device_info(device);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "store_device_info",
          "args": [
            "device"
          ],
          "line": 2982
        },
        "resolved": true,
        "details": {
          "function_name": "store_device_info",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "475-487",
          "snippet": "static void store_device_info(struct btd_device *device)\n{\n\tif (device->temporary || device->store_id > 0)\n\t\treturn;\n\n\tif (device_address_is_private(device)) {\n\t\tDBG(\"Can't store info for private addressed device %s\",\n\t\t\t\t\t\t\t\tdevice->path);\n\t\treturn;\n\t}\n\n\tdevice->store_id = g_idle_add(store_device_info_cb, device);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void store_device_info(struct btd_device *device)\n{\n\tif (device->temporary || device->store_id > 0)\n\t\treturn;\n\n\tif (device_address_is_private(device)) {\n\t\tDBG(\"Can't store info for private addressed device %s\",\n\t\t\t\t\t\t\t\tdevice->path);\n\t\treturn;\n\t}\n\n\tdevice->store_id = g_idle_add(store_device_info_cb, device);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "str"
          ],
          "line": 2980
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_file_set_contents",
          "args": [
            "filename",
            "str",
            "length",
            "NULL"
          ],
          "line": 2979
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_to_data",
          "args": [
            "key_file",
            "&length",
            "NULL"
          ],
          "line": 2978
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "filename",
            "PATH_MAX",
            "STORAGEDIR \"/%s/%s/info\"",
            "adapter_addr",
            "device_addr"
          ],
          "line": 2975
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ba2str",
          "args": [
            "&device->bdaddr",
            "device_addr"
          ],
          "line": 2974
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ba2str",
          "args": [
            "btd_adapter_get_address(device->adapter)",
            "adapter_addr"
          ],
          "line": 2973
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_adapter_get_address",
          "args": [
            "device->adapter"
          ],
          "line": 2973
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_get_address",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "5881-5884",
          "snippet": "const bdaddr_t *btd_adapter_get_address(struct btd_adapter *adapter)\n{\n\treturn &adapter->bdaddr;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nconst bdaddr_t *btd_adapter_get_address(struct btd_adapter *adapter)\n{\n\treturn &adapter->bdaddr;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_key_file_remove_key",
          "args": [
            "key_file",
            "\"General\"",
            "\"GATTServices\"",
            "NULL"
          ],
          "line": 2971
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_remove_key",
          "args": [
            "key_file",
            "\"General\"",
            "\"SDPServices\"",
            "NULL"
          ],
          "line": 2970
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "load_services",
          "args": [
            "device",
            "uuids"
          ],
          "line": 2964
        },
        "resolved": true,
        "details": {
          "function_name": "load_services",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "2930-2944",
          "snippet": "static void load_services(struct btd_device *device, char **uuids)\n{\n\tchar **uuid;\n\n\tfor (uuid = uuids; *uuid; uuid++) {\n\t\tif (g_slist_find_custom(device->uuids, *uuid, bt_uuid_strcmp))\n\t\t\tcontinue;\n\n\t\tdevice->uuids = g_slist_insert_sorted(device->uuids,\n\t\t\t\t\t\t\tg_strdup(*uuid),\n\t\t\t\t\t\t\tbt_uuid_strcmp);\n\t}\n\n\tg_strfreev(uuids);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void load_services(struct btd_device *device, char **uuids)\n{\n\tchar **uuid;\n\n\tfor (uuid = uuids; *uuid; uuid++) {\n\t\tif (g_slist_find_custom(device->uuids, *uuid, bt_uuid_strcmp))\n\t\t\tcontinue;\n\n\t\tdevice->uuids = g_slist_insert_sorted(device->uuids,\n\t\t\t\t\t\t\tg_strdup(*uuid),\n\t\t\t\t\t\t\tbt_uuid_strcmp);\n\t}\n\n\tg_strfreev(uuids);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_key_file_get_string_list",
          "args": [
            "key_file",
            "\"General\"",
            "\"GATTServices\"",
            "NULL",
            "NULL"
          ],
          "line": 2961
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_get_string_list",
          "args": [
            "key_file",
            "\"General\"",
            "\"SDPServices\"",
            "NULL",
            "NULL"
          ],
          "line": 2956
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void convert_info(struct btd_device *device, GKeyFile *key_file)\n{\n\tchar filename[PATH_MAX];\n\tchar adapter_addr[18];\n\tchar device_addr[18];\n\tchar **uuids;\n\tchar *str;\n\tgsize length = 0;\n\n\t/* Load device profile list from legacy properties */\n\tuuids = g_key_file_get_string_list(key_file, \"General\", \"SDPServices\",\n\t\t\t\t\t\t\t\tNULL, NULL);\n\tif (uuids)\n\t\tload_services(device, uuids);\n\n\tuuids = g_key_file_get_string_list(key_file, \"General\", \"GATTServices\",\n\t\t\t\t\t\t\t\tNULL, NULL);\n\tif (uuids)\n\t\tload_services(device, uuids);\n\n\tif (!device->uuids)\n\t\treturn;\n\n\t/* Remove old entries so they are not loaded again */\n\tg_key_file_remove_key(key_file, \"General\", \"SDPServices\", NULL);\n\tg_key_file_remove_key(key_file, \"General\", \"GATTServices\", NULL);\n\n\tba2str(btd_adapter_get_address(device->adapter), adapter_addr);\n\tba2str(&device->bdaddr, device_addr);\n\tsnprintf(filename, PATH_MAX, STORAGEDIR \"/%s/%s/info\", adapter_addr,\n\t\t\tdevice_addr);\n\n\tstr = g_key_file_to_data(key_file, &length, NULL);\n\tg_file_set_contents(filename, str, length, NULL);\n\tg_free(str);\n\n\tstore_device_info(device);\n}"
  },
  {
    "function_name": "load_services",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "2930-2944",
    "snippet": "static void load_services(struct btd_device *device, char **uuids)\n{\n\tchar **uuid;\n\n\tfor (uuid = uuids; *uuid; uuid++) {\n\t\tif (g_slist_find_custom(device->uuids, *uuid, bt_uuid_strcmp))\n\t\t\tcontinue;\n\n\t\tdevice->uuids = g_slist_insert_sorted(device->uuids,\n\t\t\t\t\t\t\tg_strdup(*uuid),\n\t\t\t\t\t\t\tbt_uuid_strcmp);\n\t}\n\n\tg_strfreev(uuids);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_strfreev",
          "args": [
            "uuids"
          ],
          "line": 2943
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_insert_sorted",
          "args": [
            "device->uuids",
            "g_strdup(*uuid)",
            "bt_uuid_strcmp"
          ],
          "line": 2938
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "*uuid"
          ],
          "line": 2939
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_find_custom",
          "args": [
            "device->uuids",
            "*uuid",
            "bt_uuid_strcmp"
          ],
          "line": 2935
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void load_services(struct btd_device *device, char **uuids)\n{\n\tchar **uuid;\n\n\tfor (uuid = uuids; *uuid; uuid++) {\n\t\tif (g_slist_find_custom(device->uuids, *uuid, bt_uuid_strcmp))\n\t\t\tcontinue;\n\n\t\tdevice->uuids = g_slist_insert_sorted(device->uuids,\n\t\t\t\t\t\t\tg_strdup(*uuid),\n\t\t\t\t\t\t\tbt_uuid_strcmp);\n\t}\n\n\tg_strfreev(uuids);\n}"
  },
  {
    "function_name": "load_csrk",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "2896-2928",
    "snippet": "static struct csrk_info *load_csrk(GKeyFile *key_file, const char *group)\n{\n\tstruct csrk_info *csrk;\n\tchar *str;\n\tint i;\n\n\tstr = g_key_file_get_string(key_file, group, \"Key\", NULL);\n\tif (!str)\n\t\treturn NULL;\n\n\tcsrk = g_new0(struct csrk_info, 1);\n\n\tfor (i = 0; i < 16; i++) {\n\t\tif (sscanf(str + (i * 2), \"%2hhx\", &csrk->key[i]) != 1)\n\t\t\tgoto fail;\n\t}\n\n\t/*\n\t * In case of older storage this will return 0 which is fine since it\n\t * didn't support signing at that point the counter should never have\n\t * been used.\n\t */\n\tcsrk->counter = g_key_file_get_integer(key_file, group, \"Counter\",\n\t\t\t\t\t\t\t\t\tNULL);\n\tg_free(str);\n\n\treturn csrk;\n\nfail:\n\tg_free(str);\n\tg_free(csrk);\n\treturn NULL;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "csrk"
          ],
          "line": 2926
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "str"
          ],
          "line": 2925
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "str"
          ],
          "line": 2920
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_get_integer",
          "args": [
            "key_file",
            "group",
            "\"Counter\"",
            "NULL"
          ],
          "line": 2918
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sscanf",
          "args": [
            "str + (i * 2)",
            "\"%2hhx\"",
            "&csrk->key[i]"
          ],
          "line": 2909
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_new0",
          "args": [
            "structcsrk_info",
            "1"
          ],
          "line": 2906
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_get_string",
          "args": [
            "key_file",
            "group",
            "\"Key\"",
            "NULL"
          ],
          "line": 2902
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic struct csrk_info *load_csrk(GKeyFile *key_file, const char *group)\n{\n\tstruct csrk_info *csrk;\n\tchar *str;\n\tint i;\n\n\tstr = g_key_file_get_string(key_file, group, \"Key\", NULL);\n\tif (!str)\n\t\treturn NULL;\n\n\tcsrk = g_new0(struct csrk_info, 1);\n\n\tfor (i = 0; i < 16; i++) {\n\t\tif (sscanf(str + (i * 2), \"%2hhx\", &csrk->key[i]) != 1)\n\t\t\tgoto fail;\n\t}\n\n\t/*\n\t * In case of older storage this will return 0 which is fine since it\n\t * didn't support signing at that point the counter should never have\n\t * been used.\n\t */\n\tcsrk->counter = g_key_file_get_integer(key_file, group, \"Counter\",\n\t\t\t\t\t\t\t\t\tNULL);\n\tg_free(str);\n\n\treturn csrk;\n\nfail:\n\tg_free(str);\n\tg_free(csrk);\n\treturn NULL;\n}"
  },
  {
    "function_name": "load_cached_name",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "2865-2894",
    "snippet": "static char *load_cached_name(struct btd_device *device, const char *local,\n\t\t\t\tconst char *peer)\n{\n\tchar filename[PATH_MAX];\n\tGKeyFile *key_file;\n\tchar *str = NULL;\n\tint len;\n\n\tif (device_address_is_private(device))\n\t\treturn NULL;\n\n\tsnprintf(filename, PATH_MAX, STORAGEDIR \"/%s/cache/%s\", local, peer);\n\n\tkey_file = g_key_file_new();\n\n\tif (!g_key_file_load_from_file(key_file, filename, 0, NULL))\n\t\tgoto failed;\n\n\tstr = g_key_file_get_string(key_file, \"General\", \"Name\", NULL);\n\tif (str) {\n\t\tlen = strlen(str);\n\t\tif (len > HCI_MAX_NAME_LENGTH)\n\t\t\tstr[HCI_MAX_NAME_LENGTH] = '\\0';\n\t}\n\nfailed:\n\tg_key_file_free(key_file);\n\n\treturn str;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_key_file_free",
          "args": [
            "key_file"
          ],
          "line": 2891
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "str"
          ],
          "line": 2885
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_get_string",
          "args": [
            "key_file",
            "\"General\"",
            "\"Name\"",
            "NULL"
          ],
          "line": 2883
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_load_from_file",
          "args": [
            "key_file",
            "filename",
            "0",
            "NULL"
          ],
          "line": 2880
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_new",
          "args": [],
          "line": 2878
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "filename",
            "PATH_MAX",
            "STORAGEDIR \"/%s/cache/%s\"",
            "local",
            "peer"
          ],
          "line": 2876
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device_address_is_private",
          "args": [
            "device"
          ],
          "line": 2873
        },
        "resolved": true,
        "details": {
          "function_name": "device_address_is_private",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "461-473",
          "snippet": "static bool device_address_is_private(struct btd_device *dev)\n{\n\tif (dev->bdaddr_type != BDADDR_LE_RANDOM)\n\t\treturn false;\n\n\tswitch (dev->bdaddr.b[5] >> 6) {\n\tcase 0x00:\t/* Private non-resolvable */\n\tcase 0x01:\t/* Private resolvable */\n\t\treturn true;\n\tdefault:\n\t\treturn false;\n\t}\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic bool device_address_is_private(struct btd_device *dev)\n{\n\tif (dev->bdaddr_type != BDADDR_LE_RANDOM)\n\t\treturn false;\n\n\tswitch (dev->bdaddr.b[5] >> 6) {\n\tcase 0x00:\t/* Private non-resolvable */\n\tcase 0x01:\t/* Private resolvable */\n\t\treturn true;\n\tdefault:\n\t\treturn false;\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic char *load_cached_name(struct btd_device *device, const char *local,\n\t\t\t\tconst char *peer)\n{\n\tchar filename[PATH_MAX];\n\tGKeyFile *key_file;\n\tchar *str = NULL;\n\tint len;\n\n\tif (device_address_is_private(device))\n\t\treturn NULL;\n\n\tsnprintf(filename, PATH_MAX, STORAGEDIR \"/%s/cache/%s\", local, peer);\n\n\tkey_file = g_key_file_new();\n\n\tif (!g_key_file_load_from_file(key_file, filename, 0, NULL))\n\t\tgoto failed;\n\n\tstr = g_key_file_get_string(key_file, \"General\", \"Name\", NULL);\n\tif (str) {\n\t\tlen = strlen(str);\n\t\tif (len > HCI_MAX_NAME_LENGTH)\n\t\t\tstr[HCI_MAX_NAME_LENGTH] = '\\0';\n\t}\n\nfailed:\n\tg_key_file_free(key_file);\n\n\treturn str;\n}"
  },
  {
    "function_name": "device_remove_disconnect_watch",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "2847-2863",
    "snippet": "void device_remove_disconnect_watch(struct btd_device *device, guint id)\n{\n\tGSList *l;\n\n\tfor (l = device->watches; l; l = l->next) {\n\t\tstruct btd_disconnect_data *data = l->data;\n\n\t\tif (data->id == id) {\n\t\t\tdevice->watches = g_slist_remove(device->watches,\n\t\t\t\t\t\t\tdata);\n\t\t\tif (data->destroy)\n\t\t\t\tdata->destroy(data->user_data);\n\t\t\tg_free(data);\n\t\t\treturn;\n\t\t}\n\t}\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "data"
          ],
          "line": 2859
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "data->destroy",
          "args": [
            "data->user_data"
          ],
          "line": 2858
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_remove",
          "args": [
            "device->watches",
            "data"
          ],
          "line": 2855
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid device_remove_disconnect_watch(struct btd_device *device, guint id)\n{\n\tGSList *l;\n\n\tfor (l = device->watches; l; l = l->next) {\n\t\tstruct btd_disconnect_data *data = l->data;\n\n\t\tif (data->id == id) {\n\t\t\tdevice->watches = g_slist_remove(device->watches,\n\t\t\t\t\t\t\tdata);\n\t\t\tif (data->destroy)\n\t\t\t\tdata->destroy(data->user_data);\n\t\t\tg_free(data);\n\t\t\treturn;\n\t\t}\n\t}\n}"
  },
  {
    "function_name": "device_add_disconnect_watch",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "2829-2845",
    "snippet": "guint device_add_disconnect_watch(struct btd_device *device,\n\t\t\t\tdisconnect_watch watch, void *user_data,\n\t\t\t\tGDestroyNotify destroy)\n{\n\tstruct btd_disconnect_data *data;\n\tstatic guint id = 0;\n\n\tdata = g_new0(struct btd_disconnect_data, 1);\n\tdata->id = ++id;\n\tdata->watch = watch;\n\tdata->user_data = user_data;\n\tdata->destroy = destroy;\n\n\tdevice->watches = g_slist_append(device->watches, data);\n\n\treturn data->id;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_slist_append",
          "args": [
            "device->watches",
            "data"
          ],
          "line": 2842
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_new0",
          "args": [
            "structbtd_disconnect_data",
            "1"
          ],
          "line": 2836
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nguint device_add_disconnect_watch(struct btd_device *device,\n\t\t\t\tdisconnect_watch watch, void *user_data,\n\t\t\t\tGDestroyNotify destroy)\n{\n\tstruct btd_disconnect_data *data;\n\tstatic guint id = 0;\n\n\tdata = g_new0(struct btd_disconnect_data, 1);\n\tdata->id = ++id;\n\tdata->watch = watch;\n\tdata->user_data = user_data;\n\tdata->destroy = destroy;\n\n\tdevice->watches = g_slist_append(device->watches, data);\n\n\treturn data->id;\n}"
  },
  {
    "function_name": "device_remove_connection",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "2784-2827",
    "snippet": "void device_remove_connection(struct btd_device *device, uint8_t bdaddr_type)\n{\n\tstruct bearer_state *state = get_state(device, bdaddr_type);\n\n\tif (!state->connected)\n\t\treturn;\n\n\tstate->connected = false;\n\tdevice->general_connect = FALSE;\n\n\tdevice_set_svc_refreshed(device, false);\n\n\tif (device->disconn_timer > 0) {\n\t\tg_source_remove(device->disconn_timer);\n\t\tdevice->disconn_timer = 0;\n\t}\n\n\twhile (device->disconnects) {\n\t\tDBusMessage *msg = device->disconnects->data;\n\n\t\tg_dbus_send_reply(dbus_conn, msg, DBUS_TYPE_INVALID);\n\t\tdevice->disconnects = g_slist_remove(device->disconnects, msg);\n\t\tdbus_message_unref(msg);\n\t}\n\n\tif (state->paired && !state->bonded) {\n\t\tbtd_adapter_remove_bonding(device->adapter, &device->bdaddr,\n\t\t\t\t\t\t\t\tbdaddr_type);\n\n\t\tstate->paired = false;\n\n\t\t/* report change only if both bearers are unpaired */\n\t\tif (!device->bredr_state.paired && !device->le_state.paired)\n\t\t\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\t\t\tDEVICE_INTERFACE,\n\t\t\t\t\t\t\t\"Paired\");\n\t}\n\n\tif (device->bredr_state.connected || device->le_state.connected)\n\t\treturn;\n\n\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"Connected\");\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static DBusConnection *dbus_conn = NULL;",
      "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
      "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);",
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_dbus_emit_property_changed",
          "args": [
            "dbus_conn",
            "device->path",
            "DEVICE_INTERFACE",
            "\"Connected\""
          ],
          "line": 2825
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_emit_property_changed",
          "args": [
            "dbus_conn",
            "device->path",
            "DEVICE_INTERFACE",
            "\"Paired\""
          ],
          "line": 2817
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_adapter_remove_bonding",
          "args": [
            "device->adapter",
            "&device->bdaddr",
            "bdaddr_type"
          ],
          "line": 2810
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_remove_bonding",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "6697-6713",
          "snippet": "int btd_adapter_remove_bonding(struct btd_adapter *adapter,\n\t\t\t\tconst bdaddr_t *bdaddr, uint8_t bdaddr_type)\n{\n\tstruct mgmt_cp_unpair_device cp;\n\n\tmemset(&cp, 0, sizeof(cp));\n\tbacpy(&cp.addr.bdaddr, bdaddr);\n\tcp.addr.type = bdaddr_type;\n\tcp.disconnect = 1;\n\n\tif (mgmt_send(adapter->mgmt, MGMT_OP_UNPAIR_DEVICE,\n\t\t\t\tadapter->dev_id, sizeof(cp), &cp,\n\t\t\t\tNULL, NULL, NULL) > 0)\n\t\treturn 0;\n\n\treturn -EIO;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nint btd_adapter_remove_bonding(struct btd_adapter *adapter,\n\t\t\t\tconst bdaddr_t *bdaddr, uint8_t bdaddr_type)\n{\n\tstruct mgmt_cp_unpair_device cp;\n\n\tmemset(&cp, 0, sizeof(cp));\n\tbacpy(&cp.addr.bdaddr, bdaddr);\n\tcp.addr.type = bdaddr_type;\n\tcp.disconnect = 1;\n\n\tif (mgmt_send(adapter->mgmt, MGMT_OP_UNPAIR_DEVICE,\n\t\t\t\tadapter->dev_id, sizeof(cp), &cp,\n\t\t\t\tNULL, NULL, NULL) > 0)\n\t\treturn 0;\n\n\treturn -EIO;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_unref",
          "args": [
            "msg"
          ],
          "line": 2806
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_remove",
          "args": [
            "device->disconnects",
            "msg"
          ],
          "line": 2805
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_send_reply",
          "args": [
            "dbus_conn",
            "msg",
            "DBUS_TYPE_INVALID"
          ],
          "line": 2804
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_source_remove",
          "args": [
            "device->disconn_timer"
          ],
          "line": 2797
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device_set_svc_refreshed",
          "args": [
            "device",
            "false"
          ],
          "line": 2794
        },
        "resolved": true,
        "details": {
          "function_name": "device_set_svc_refreshed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "2367-2376",
          "snippet": "static void device_set_svc_refreshed(struct btd_device *device, bool value)\n{\n\tif (device->svc_refreshed == value)\n\t\treturn;\n\n\tdevice->svc_refreshed = value;\n\n\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\tDEVICE_INTERFACE, \"ServicesResolved\");\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *dbus_conn = NULL;",
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void device_set_svc_refreshed(struct btd_device *device, bool value)\n{\n\tif (device->svc_refreshed == value)\n\t\treturn;\n\n\tdevice->svc_refreshed = value;\n\n\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\tDEVICE_INTERFACE, \"ServicesResolved\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "get_state",
          "args": [
            "device",
            "bdaddr_type"
          ],
          "line": 2786
        },
        "resolved": true,
        "details": {
          "function_name": "get_state",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "275-282",
          "snippet": "static struct bearer_state *get_state(struct btd_device *dev,\n\t\t\t\t\t\t\tuint8_t bdaddr_type)\n{\n\tif (bdaddr_type == BDADDR_BREDR)\n\t\treturn &dev->bredr_state;\n\telse\n\t\treturn &dev->le_state;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic struct bearer_state *get_state(struct btd_device *dev,\n\t\t\t\t\t\t\tuint8_t bdaddr_type)\n{\n\tif (bdaddr_type == BDADDR_BREDR)\n\t\treturn &dev->bredr_state;\n\telse\n\t\treturn &dev->le_state;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid device_remove_connection(struct btd_device *device, uint8_t bdaddr_type)\n{\n\tstruct bearer_state *state = get_state(device, bdaddr_type);\n\n\tif (!state->connected)\n\t\treturn;\n\n\tstate->connected = false;\n\tdevice->general_connect = FALSE;\n\n\tdevice_set_svc_refreshed(device, false);\n\n\tif (device->disconn_timer > 0) {\n\t\tg_source_remove(device->disconn_timer);\n\t\tdevice->disconn_timer = 0;\n\t}\n\n\twhile (device->disconnects) {\n\t\tDBusMessage *msg = device->disconnects->data;\n\n\t\tg_dbus_send_reply(dbus_conn, msg, DBUS_TYPE_INVALID);\n\t\tdevice->disconnects = g_slist_remove(device->disconnects, msg);\n\t\tdbus_message_unref(msg);\n\t}\n\n\tif (state->paired && !state->bonded) {\n\t\tbtd_adapter_remove_bonding(device->adapter, &device->bdaddr,\n\t\t\t\t\t\t\t\tbdaddr_type);\n\n\t\tstate->paired = false;\n\n\t\t/* report change only if both bearers are unpaired */\n\t\tif (!device->bredr_state.paired && !device->le_state.paired)\n\t\t\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\t\t\tDEVICE_INTERFACE,\n\t\t\t\t\t\t\t\"Paired\");\n\t}\n\n\tif (device->bredr_state.connected || device->le_state.connected)\n\t\treturn;\n\n\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"Connected\");\n}"
  },
  {
    "function_name": "device_add_connection",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "2753-2782",
    "snippet": "void device_add_connection(struct btd_device *dev, uint8_t bdaddr_type)\n{\n\tstruct bearer_state *state = get_state(dev, bdaddr_type);\n\n\tdevice_update_last_seen(dev, bdaddr_type);\n\n\tif (state->connected) {\n\t\tchar addr[18];\n\t\tba2str(&dev->bdaddr, addr);\n\t\terror(\"Device %s is already connected\", addr);\n\t\treturn;\n\t}\n\n\tbacpy(&dev->conn_bdaddr, &dev->bdaddr);\n\tdev->conn_bdaddr_type = dev->bdaddr_type;\n\n\t/* If this is the first connection over this bearer */\n\tif (bdaddr_type == BDADDR_BREDR)\n\t\tdevice_set_bredr_support(dev);\n\telse\n\t\tdevice_set_le_support(dev, bdaddr_type);\n\n\tstate->connected = true;\n\n\tif (dev->le_state.connected && dev->bredr_state.connected)\n\t\treturn;\n\n\tg_dbus_emit_property_changed(dbus_conn, dev->path, DEVICE_INTERFACE,\n\t\t\t\t\t\t\t\t\"Connected\");\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static DBusConnection *dbus_conn = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_dbus_emit_property_changed",
          "args": [
            "dbus_conn",
            "dev->path",
            "DEVICE_INTERFACE",
            "\"Connected\""
          ],
          "line": 2780
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device_set_le_support",
          "args": [
            "dev",
            "bdaddr_type"
          ],
          "line": 2773
        },
        "resolved": true,
        "details": {
          "function_name": "device_set_le_support",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "3973-3982",
          "snippet": "void device_set_le_support(struct btd_device *device, uint8_t bdaddr_type)\n{\n\tif (device->le)\n\t\treturn;\n\n\tdevice->le = true;\n\tdevice->bdaddr_type = bdaddr_type;\n\n\tstore_device_info(device);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid device_set_le_support(struct btd_device *device, uint8_t bdaddr_type)\n{\n\tif (device->le)\n\t\treturn;\n\n\tdevice->le = true;\n\tdevice->bdaddr_type = bdaddr_type;\n\n\tstore_device_info(device);\n}"
        }
      },
      {
        "call_info": {
          "callee": "device_set_bredr_support",
          "args": [
            "dev"
          ],
          "line": 2771
        },
        "resolved": true,
        "details": {
          "function_name": "device_set_bredr_support",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "3964-3971",
          "snippet": "void device_set_bredr_support(struct btd_device *device)\n{\n\tif (device->bredr)\n\t\treturn;\n\n\tdevice->bredr = true;\n\tstore_device_info(device);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid device_set_bredr_support(struct btd_device *device)\n{\n\tif (device->bredr)\n\t\treturn;\n\n\tdevice->bredr = true;\n\tstore_device_info(device);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bacpy",
          "args": [
            "&dev->conn_bdaddr",
            "&dev->bdaddr"
          ],
          "line": 2766
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Device %s is already connected\"",
            "addr"
          ],
          "line": 2762
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "124-128",
          "snippet": "DBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ba2str",
          "args": [
            "&dev->bdaddr",
            "addr"
          ],
          "line": 2761
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device_update_last_seen",
          "args": [
            "dev",
            "bdaddr_type"
          ],
          "line": 2757
        },
        "resolved": true,
        "details": {
          "function_name": "device_update_last_seen",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "3984-3990",
          "snippet": "void device_update_last_seen(struct btd_device *device, uint8_t bdaddr_type)\n{\n\tif (bdaddr_type == BDADDR_BREDR)\n\t\tdevice->bredr_seen = time(NULL);\n\telse\n\t\tdevice->le_seen = time(NULL);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid device_update_last_seen(struct btd_device *device, uint8_t bdaddr_type)\n{\n\tif (bdaddr_type == BDADDR_BREDR)\n\t\tdevice->bredr_seen = time(NULL);\n\telse\n\t\tdevice->le_seen = time(NULL);\n}"
        }
      },
      {
        "call_info": {
          "callee": "get_state",
          "args": [
            "dev",
            "bdaddr_type"
          ],
          "line": 2755
        },
        "resolved": true,
        "details": {
          "function_name": "get_state",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "275-282",
          "snippet": "static struct bearer_state *get_state(struct btd_device *dev,\n\t\t\t\t\t\t\tuint8_t bdaddr_type)\n{\n\tif (bdaddr_type == BDADDR_BREDR)\n\t\treturn &dev->bredr_state;\n\telse\n\t\treturn &dev->le_state;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic struct bearer_state *get_state(struct btd_device *dev,\n\t\t\t\t\t\t\tuint8_t bdaddr_type)\n{\n\tif (bdaddr_type == BDADDR_BREDR)\n\t\treturn &dev->bredr_state;\n\telse\n\t\treturn &dev->le_state;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\n\nvoid device_add_connection(struct btd_device *dev, uint8_t bdaddr_type)\n{\n\tstruct bearer_state *state = get_state(dev, bdaddr_type);\n\n\tdevice_update_last_seen(dev, bdaddr_type);\n\n\tif (state->connected) {\n\t\tchar addr[18];\n\t\tba2str(&dev->bdaddr, addr);\n\t\terror(\"Device %s is already connected\", addr);\n\t\treturn;\n\t}\n\n\tbacpy(&dev->conn_bdaddr, &dev->bdaddr);\n\tdev->conn_bdaddr_type = dev->bdaddr_type;\n\n\t/* If this is the first connection over this bearer */\n\tif (bdaddr_type == BDADDR_BREDR)\n\t\tdevice_set_bredr_support(dev);\n\telse\n\t\tdevice_set_le_support(dev, bdaddr_type);\n\n\tstate->connected = true;\n\n\tif (dev->le_state.connected && dev->bredr_state.connected)\n\t\treturn;\n\n\tg_dbus_emit_property_changed(dbus_conn, dev->path, DEVICE_INTERFACE,\n\t\t\t\t\t\t\t\t\"Connected\");\n}"
  },
  {
    "function_name": "btd_device_is_connected",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "2748-2751",
    "snippet": "bool btd_device_is_connected(struct btd_device *dev)\n{\n\treturn dev->bredr_state.connected || dev->le_state.connected;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nbool btd_device_is_connected(struct btd_device *dev)\n{\n\treturn dev->bredr_state.connected || dev->le_state.connected;\n}"
  },
  {
    "function_name": "btd_device_get_bdaddr_type",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "2743-2746",
    "snippet": "uint8_t btd_device_get_bdaddr_type(struct btd_device *dev)\n{\n\treturn dev->bdaddr_type;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nuint8_t btd_device_get_bdaddr_type(struct btd_device *dev)\n{\n\treturn dev->bdaddr_type;\n}"
  },
  {
    "function_name": "cancel_pairing",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "2678-2692",
    "snippet": "static DBusMessage *cancel_pairing(DBusConnection *conn, DBusMessage *msg,\n\t\t\t\t\t\t\t\tvoid *data)\n{\n\tstruct btd_device *device = data;\n\tstruct bonding_req *req = device->bonding;\n\n\tDBG(\"\");\n\n\tif (!req)\n\t\treturn btd_error_does_not_exist(msg);\n\n\tdevice_cancel_bonding(device, MGMT_STATUS_CANCELLED);\n\n\treturn dbus_message_new_method_return(msg);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
      "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);",
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_new_method_return",
          "args": [
            "msg"
          ],
          "line": 2691
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device_cancel_bonding",
          "args": [
            "device",
            "MGMT_STATUS_CANCELLED"
          ],
          "line": 2689
        },
        "resolved": true,
        "details": {
          "function_name": "device_cancel_bonding",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "2656-2676",
          "snippet": "static void device_cancel_bonding(struct btd_device *device, uint8_t status)\n{\n\tstruct bonding_req *bonding = device->bonding;\n\tDBusMessage *reply;\n\tchar addr[18];\n\n\tif (!bonding)\n\t\treturn;\n\n\tba2str(&device->bdaddr, addr);\n\tDBG(\"Canceling bonding request for %s\", addr);\n\n\tif (device->authr)\n\t\tdevice_cancel_authentication(device, FALSE);\n\n\treply = new_authentication_return(bonding->msg, status);\n\tg_dbus_send_message(dbus_conn, reply);\n\n\tbonding_request_cancel(bonding);\n\tbonding_request_free(bonding);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *dbus_conn = NULL;",
            "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
            "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);",
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void device_cancel_bonding(struct btd_device *device, uint8_t status)\n{\n\tstruct bonding_req *bonding = device->bonding;\n\tDBusMessage *reply;\n\tchar addr[18];\n\n\tif (!bonding)\n\t\treturn;\n\n\tba2str(&device->bdaddr, addr);\n\tDBG(\"Canceling bonding request for %s\", addr);\n\n\tif (device->authr)\n\t\tdevice_cancel_authentication(device, FALSE);\n\n\treply = new_authentication_return(bonding->msg, status);\n\tg_dbus_send_message(dbus_conn, reply);\n\n\tbonding_request_cancel(bonding);\n\tbonding_request_free(bonding);\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_error_does_not_exist",
          "args": [
            "msg"
          ],
          "line": 2687
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_does_not_exist",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "88-92",
          "snippet": "DBusMessage *btd_error_does_not_exist(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".DoesNotExist\",\n\t\t\t\t\t\"Does Not Exist\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_does_not_exist(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".DoesNotExist\",\n\t\t\t\t\t\"Does Not Exist\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"\""
          ],
          "line": 2684
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic DBusMessage *cancel_pairing(DBusConnection *conn, DBusMessage *msg,\n\t\t\t\t\t\t\t\tvoid *data)\n{\n\tstruct btd_device *device = data;\n\tstruct bonding_req *req = device->bonding;\n\n\tDBG(\"\");\n\n\tif (!req)\n\t\treturn btd_error_does_not_exist(msg);\n\n\tdevice_cancel_bonding(device, MGMT_STATUS_CANCELLED);\n\n\treturn dbus_message_new_method_return(msg);\n}"
  },
  {
    "function_name": "device_cancel_bonding",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "2656-2676",
    "snippet": "static void device_cancel_bonding(struct btd_device *device, uint8_t status)\n{\n\tstruct bonding_req *bonding = device->bonding;\n\tDBusMessage *reply;\n\tchar addr[18];\n\n\tif (!bonding)\n\t\treturn;\n\n\tba2str(&device->bdaddr, addr);\n\tDBG(\"Canceling bonding request for %s\", addr);\n\n\tif (device->authr)\n\t\tdevice_cancel_authentication(device, FALSE);\n\n\treply = new_authentication_return(bonding->msg, status);\n\tg_dbus_send_message(dbus_conn, reply);\n\n\tbonding_request_cancel(bonding);\n\tbonding_request_free(bonding);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static DBusConnection *dbus_conn = NULL;",
      "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
      "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);",
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "bonding_request_free",
          "args": [
            "bonding"
          ],
          "line": 2675
        },
        "resolved": true,
        "details": {
          "function_name": "bonding_request_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "2513-2540",
          "snippet": "static void bonding_request_free(struct bonding_req *bonding)\n{\n\tif (!bonding)\n\t\treturn;\n\n\tif (bonding->listener_id)\n\t\tg_dbus_remove_watch(dbus_conn, bonding->listener_id);\n\n\tif (bonding->msg)\n\t\tdbus_message_unref(bonding->msg);\n\n\tif (bonding->cb_iter)\n\t\tg_free(bonding->cb_iter);\n\n\tif (bonding->agent) {\n\t\tagent_cancel(bonding->agent);\n\t\tagent_unref(bonding->agent);\n\t\tbonding->agent = NULL;\n\t}\n\n\tif (bonding->retry_timer)\n\t\tg_source_remove(bonding->retry_timer);\n\n\tif (bonding->device)\n\t\tbonding->device->bonding = NULL;\n\n\tg_free(bonding);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *dbus_conn = NULL;",
            "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
            "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);",
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void bonding_request_free(struct bonding_req *bonding)\n{\n\tif (!bonding)\n\t\treturn;\n\n\tif (bonding->listener_id)\n\t\tg_dbus_remove_watch(dbus_conn, bonding->listener_id);\n\n\tif (bonding->msg)\n\t\tdbus_message_unref(bonding->msg);\n\n\tif (bonding->cb_iter)\n\t\tg_free(bonding->cb_iter);\n\n\tif (bonding->agent) {\n\t\tagent_cancel(bonding->agent);\n\t\tagent_unref(bonding->agent);\n\t\tbonding->agent = NULL;\n\t}\n\n\tif (bonding->retry_timer)\n\t\tg_source_remove(bonding->retry_timer);\n\n\tif (bonding->device)\n\t\tbonding->device->bonding = NULL;\n\n\tg_free(bonding);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bonding_request_cancel",
          "args": [
            "bonding"
          ],
          "line": 2674
        },
        "resolved": true,
        "details": {
          "function_name": "bonding_request_cancel",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "1423-1429",
          "snippet": "static void bonding_request_cancel(struct bonding_req *bonding)\n{\n\tstruct btd_device *device = bonding->device;\n\tstruct btd_adapter *adapter = device->adapter;\n\n\tadapter_cancel_bonding(adapter, &device->bdaddr, device->bdaddr_type);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void bonding_request_cancel(struct bonding_req *bonding)\n{\n\tstruct btd_device *device = bonding->device;\n\tstruct btd_adapter *adapter = device->adapter;\n\n\tadapter_cancel_bonding(adapter, &device->bdaddr, device->bdaddr_type);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_send_message",
          "args": [
            "dbus_conn",
            "reply"
          ],
          "line": 2672
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "new_authentication_return",
          "args": [
            "bonding->msg",
            "status"
          ],
          "line": 2671
        },
        "resolved": true,
        "details": {
          "function_name": "new_authentication_return",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "2620-2654",
          "snippet": "static DBusMessage *new_authentication_return(DBusMessage *msg, uint8_t status)\n{\n\tswitch (status) {\n\tcase MGMT_STATUS_SUCCESS:\n\t\treturn dbus_message_new_method_return(msg);\n\n\tcase MGMT_STATUS_CONNECT_FAILED:\n\t\treturn dbus_message_new_error(msg,\n\t\t\t\tERROR_INTERFACE \".ConnectionAttemptFailed\",\n\t\t\t\t\"Page Timeout\");\n\tcase MGMT_STATUS_TIMEOUT:\n\t\treturn dbus_message_new_error(msg,\n\t\t\t\tERROR_INTERFACE \".AuthenticationTimeout\",\n\t\t\t\t\"Authentication Timeout\");\n\tcase MGMT_STATUS_BUSY:\n\tcase MGMT_STATUS_REJECTED:\n\t\treturn dbus_message_new_error(msg,\n\t\t\t\tERROR_INTERFACE \".AuthenticationRejected\",\n\t\t\t\t\"Authentication Rejected\");\n\tcase MGMT_STATUS_CANCELLED:\n\tcase MGMT_STATUS_NO_RESOURCES:\n\tcase MGMT_STATUS_DISCONNECTED:\n\t\treturn dbus_message_new_error(msg,\n\t\t\t\tERROR_INTERFACE \".AuthenticationCanceled\",\n\t\t\t\t\"Authentication Canceled\");\n\tcase MGMT_STATUS_ALREADY_PAIRED:\n\t\treturn dbus_message_new_error(msg,\n\t\t\t\tERROR_INTERFACE \".AlreadyExists\",\n\t\t\t\t\"Already Paired\");\n\tdefault:\n\t\treturn dbus_message_new_error(msg,\n\t\t\t\tERROR_INTERFACE \".AuthenticationFailed\",\n\t\t\t\t\"Authentication Failed\");\n\t}\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
            "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\n\nstatic DBusMessage *new_authentication_return(DBusMessage *msg, uint8_t status)\n{\n\tswitch (status) {\n\tcase MGMT_STATUS_SUCCESS:\n\t\treturn dbus_message_new_method_return(msg);\n\n\tcase MGMT_STATUS_CONNECT_FAILED:\n\t\treturn dbus_message_new_error(msg,\n\t\t\t\tERROR_INTERFACE \".ConnectionAttemptFailed\",\n\t\t\t\t\"Page Timeout\");\n\tcase MGMT_STATUS_TIMEOUT:\n\t\treturn dbus_message_new_error(msg,\n\t\t\t\tERROR_INTERFACE \".AuthenticationTimeout\",\n\t\t\t\t\"Authentication Timeout\");\n\tcase MGMT_STATUS_BUSY:\n\tcase MGMT_STATUS_REJECTED:\n\t\treturn dbus_message_new_error(msg,\n\t\t\t\tERROR_INTERFACE \".AuthenticationRejected\",\n\t\t\t\t\"Authentication Rejected\");\n\tcase MGMT_STATUS_CANCELLED:\n\tcase MGMT_STATUS_NO_RESOURCES:\n\tcase MGMT_STATUS_DISCONNECTED:\n\t\treturn dbus_message_new_error(msg,\n\t\t\t\tERROR_INTERFACE \".AuthenticationCanceled\",\n\t\t\t\t\"Authentication Canceled\");\n\tcase MGMT_STATUS_ALREADY_PAIRED:\n\t\treturn dbus_message_new_error(msg,\n\t\t\t\tERROR_INTERFACE \".AlreadyExists\",\n\t\t\t\t\"Already Paired\");\n\tdefault:\n\t\treturn dbus_message_new_error(msg,\n\t\t\t\tERROR_INTERFACE \".AuthenticationFailed\",\n\t\t\t\t\"Authentication Failed\");\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "device_cancel_authentication",
          "args": [
            "device",
            "FALSE"
          ],
          "line": 2669
        },
        "resolved": true,
        "details": {
          "function_name": "device_cancel_authentication",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "6170-6188",
          "snippet": "void device_cancel_authentication(struct btd_device *device, gboolean aborted)\n{\n\tstruct authentication_req *auth = device->authr;\n\tchar addr[18];\n\n\tif (!auth)\n\t\treturn;\n\n\tba2str(&device->bdaddr, addr);\n\tDBG(\"Canceling authentication request for %s\", addr);\n\n\tif (auth->agent)\n\t\tagent_cancel(auth->agent);\n\n\tif (!aborted)\n\t\tcancel_authentication(auth);\n\n\tdevice_auth_req_free(device);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid device_cancel_authentication(struct btd_device *device, gboolean aborted)\n{\n\tstruct authentication_req *auth = device->authr;\n\tchar addr[18];\n\n\tif (!auth)\n\t\treturn;\n\n\tba2str(&device->bdaddr, addr);\n\tDBG(\"Canceling authentication request for %s\", addr);\n\n\tif (auth->agent)\n\t\tagent_cancel(auth->agent);\n\n\tif (!aborted)\n\t\tcancel_authentication(auth);\n\n\tdevice_auth_req_free(device);\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Canceling bonding request for %s\"",
            "addr"
          ],
          "line": 2666
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ba2str",
          "args": [
            "&device->bdaddr",
            "addr"
          ],
          "line": 2665
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void device_cancel_bonding(struct btd_device *device, uint8_t status)\n{\n\tstruct bonding_req *bonding = device->bonding;\n\tDBusMessage *reply;\n\tchar addr[18];\n\n\tif (!bonding)\n\t\treturn;\n\n\tba2str(&device->bdaddr, addr);\n\tDBG(\"Canceling bonding request for %s\", addr);\n\n\tif (device->authr)\n\t\tdevice_cancel_authentication(device, FALSE);\n\n\treply = new_authentication_return(bonding->msg, status);\n\tg_dbus_send_message(dbus_conn, reply);\n\n\tbonding_request_cancel(bonding);\n\tbonding_request_free(bonding);\n}"
  },
  {
    "function_name": "new_authentication_return",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "2620-2654",
    "snippet": "static DBusMessage *new_authentication_return(DBusMessage *msg, uint8_t status)\n{\n\tswitch (status) {\n\tcase MGMT_STATUS_SUCCESS:\n\t\treturn dbus_message_new_method_return(msg);\n\n\tcase MGMT_STATUS_CONNECT_FAILED:\n\t\treturn dbus_message_new_error(msg,\n\t\t\t\tERROR_INTERFACE \".ConnectionAttemptFailed\",\n\t\t\t\t\"Page Timeout\");\n\tcase MGMT_STATUS_TIMEOUT:\n\t\treturn dbus_message_new_error(msg,\n\t\t\t\tERROR_INTERFACE \".AuthenticationTimeout\",\n\t\t\t\t\"Authentication Timeout\");\n\tcase MGMT_STATUS_BUSY:\n\tcase MGMT_STATUS_REJECTED:\n\t\treturn dbus_message_new_error(msg,\n\t\t\t\tERROR_INTERFACE \".AuthenticationRejected\",\n\t\t\t\t\"Authentication Rejected\");\n\tcase MGMT_STATUS_CANCELLED:\n\tcase MGMT_STATUS_NO_RESOURCES:\n\tcase MGMT_STATUS_DISCONNECTED:\n\t\treturn dbus_message_new_error(msg,\n\t\t\t\tERROR_INTERFACE \".AuthenticationCanceled\",\n\t\t\t\t\"Authentication Canceled\");\n\tcase MGMT_STATUS_ALREADY_PAIRED:\n\t\treturn dbus_message_new_error(msg,\n\t\t\t\tERROR_INTERFACE \".AlreadyExists\",\n\t\t\t\t\"Already Paired\");\n\tdefault:\n\t\treturn dbus_message_new_error(msg,\n\t\t\t\tERROR_INTERFACE \".AuthenticationFailed\",\n\t\t\t\t\"Authentication Failed\");\n\t}\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
      "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_new_error",
          "args": [
            "msg",
            "ERROR_INTERFACE \".AuthenticationFailed\"",
            "\"Authentication Failed\""
          ],
          "line": 2650
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_new_error",
          "args": [
            "msg",
            "ERROR_INTERFACE \".AlreadyExists\"",
            "\"Already Paired\""
          ],
          "line": 2646
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_new_error",
          "args": [
            "msg",
            "ERROR_INTERFACE \".AuthenticationCanceled\"",
            "\"Authentication Canceled\""
          ],
          "line": 2642
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_new_error",
          "args": [
            "msg",
            "ERROR_INTERFACE \".AuthenticationRejected\"",
            "\"Authentication Rejected\""
          ],
          "line": 2636
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_new_error",
          "args": [
            "msg",
            "ERROR_INTERFACE \".AuthenticationTimeout\"",
            "\"Authentication Timeout\""
          ],
          "line": 2631
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_new_error",
          "args": [
            "msg",
            "ERROR_INTERFACE \".ConnectionAttemptFailed\"",
            "\"Page Timeout\""
          ],
          "line": 2627
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_new_method_return",
          "args": [
            "msg"
          ],
          "line": 2624
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\n\nstatic DBusMessage *new_authentication_return(DBusMessage *msg, uint8_t status)\n{\n\tswitch (status) {\n\tcase MGMT_STATUS_SUCCESS:\n\t\treturn dbus_message_new_method_return(msg);\n\n\tcase MGMT_STATUS_CONNECT_FAILED:\n\t\treturn dbus_message_new_error(msg,\n\t\t\t\tERROR_INTERFACE \".ConnectionAttemptFailed\",\n\t\t\t\t\"Page Timeout\");\n\tcase MGMT_STATUS_TIMEOUT:\n\t\treturn dbus_message_new_error(msg,\n\t\t\t\tERROR_INTERFACE \".AuthenticationTimeout\",\n\t\t\t\t\"Authentication Timeout\");\n\tcase MGMT_STATUS_BUSY:\n\tcase MGMT_STATUS_REJECTED:\n\t\treturn dbus_message_new_error(msg,\n\t\t\t\tERROR_INTERFACE \".AuthenticationRejected\",\n\t\t\t\t\"Authentication Rejected\");\n\tcase MGMT_STATUS_CANCELLED:\n\tcase MGMT_STATUS_NO_RESOURCES:\n\tcase MGMT_STATUS_DISCONNECTED:\n\t\treturn dbus_message_new_error(msg,\n\t\t\t\tERROR_INTERFACE \".AuthenticationCanceled\",\n\t\t\t\t\"Authentication Canceled\");\n\tcase MGMT_STATUS_ALREADY_PAIRED:\n\t\treturn dbus_message_new_error(msg,\n\t\t\t\tERROR_INTERFACE \".AlreadyExists\",\n\t\t\t\t\"Already Paired\");\n\tdefault:\n\t\treturn dbus_message_new_error(msg,\n\t\t\t\tERROR_INTERFACE \".AuthenticationFailed\",\n\t\t\t\t\"Authentication Failed\");\n\t}\n}"
  },
  {
    "function_name": "pair_device",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "2542-2618",
    "snippet": "static DBusMessage *pair_device(DBusConnection *conn, DBusMessage *msg,\n\t\t\t\t\t\t\t\tvoid *data)\n{\n\tstruct btd_device *device = data;\n\tstruct btd_adapter *adapter = device->adapter;\n\tstruct bearer_state *state;\n\tuint8_t bdaddr_type;\n\tconst char *sender;\n\tstruct agent *agent;\n\tstruct bonding_req *bonding;\n\tuint8_t io_cap;\n\tint err;\n\n\tbtd_device_set_temporary(device, false);\n\n\tif (!dbus_message_get_args(msg, NULL, DBUS_TYPE_INVALID))\n\t\treturn btd_error_invalid_args(msg);\n\n\tif (device->bonding)\n\t\treturn btd_error_in_progress(msg);\n\n\tif (device->bredr_state.bonded)\n\t\tbdaddr_type = device->bdaddr_type;\n\telse if (device->le_state.bonded)\n\t\tbdaddr_type = BDADDR_BREDR;\n\telse\n\t\tbdaddr_type = select_conn_bearer(device);\n\n\tstate = get_state(device, bdaddr_type);\n\n\tif (state->bonded)\n\t\treturn btd_error_already_exists(msg);\n\n\tsender = dbus_message_get_sender(msg);\n\n\tagent = agent_get(sender);\n\tif (agent)\n\t\tio_cap = agent_get_io_capability(agent);\n\telse\n\t\tio_cap = IO_CAPABILITY_NOINPUTNOOUTPUT;\n\n\tbonding = bonding_request_new(msg, device, bdaddr_type, agent);\n\n\tif (agent)\n\t\tagent_unref(agent);\n\n\tbonding->listener_id = g_dbus_add_disconnect_watch(dbus_conn,\n\t\t\t\t\t\tsender, create_bond_req_exit,\n\t\t\t\t\t\tdevice, NULL);\n\n\tdevice->bonding = bonding;\n\tbonding->device = device;\n\n\t/* Due to a bug in the kernel we might loose out on ATT commands\n\t * that arrive during the SMP procedure, so connect the ATT\n\t * channel first and only then start pairing (there's code for\n\t * this in the ATT connect callback)\n\t */\n\tif (bdaddr_type != BDADDR_BREDR) {\n\t\tif (!state->connected && btd_le_connect_before_pairing())\n\t\t\terr = device_connect_le(device);\n\t\telse\n\t\t\terr = adapter_create_bonding(adapter, &device->bdaddr,\n\t\t\t\t\t\t\tdevice->bdaddr_type,\n\t\t\t\t\t\t\tio_cap);\n\t} else {\n\t\terr = adapter_create_bonding(adapter, &device->bdaddr,\n\t\t\t\t\t\t\tBDADDR_BREDR, io_cap);\n\t}\n\n\tif (err < 0) {\n\t\tbonding_request_free(device->bonding);\n\t\treturn btd_error_failed(msg, strerror(-err));\n\t}\n\n\treturn NULL;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static DBusConnection *dbus_conn = NULL;",
      "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
      "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);",
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "btd_error_failed",
          "args": [
            "msg",
            "strerror(-err)"
          ],
          "line": 2614
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "124-128",
          "snippet": "DBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "strerror",
          "args": [
            "-err"
          ],
          "line": 2614
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bonding_request_free",
          "args": [
            "device->bonding"
          ],
          "line": 2613
        },
        "resolved": true,
        "details": {
          "function_name": "bonding_request_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "2513-2540",
          "snippet": "static void bonding_request_free(struct bonding_req *bonding)\n{\n\tif (!bonding)\n\t\treturn;\n\n\tif (bonding->listener_id)\n\t\tg_dbus_remove_watch(dbus_conn, bonding->listener_id);\n\n\tif (bonding->msg)\n\t\tdbus_message_unref(bonding->msg);\n\n\tif (bonding->cb_iter)\n\t\tg_free(bonding->cb_iter);\n\n\tif (bonding->agent) {\n\t\tagent_cancel(bonding->agent);\n\t\tagent_unref(bonding->agent);\n\t\tbonding->agent = NULL;\n\t}\n\n\tif (bonding->retry_timer)\n\t\tg_source_remove(bonding->retry_timer);\n\n\tif (bonding->device)\n\t\tbonding->device->bonding = NULL;\n\n\tg_free(bonding);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *dbus_conn = NULL;",
            "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
            "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);",
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void bonding_request_free(struct bonding_req *bonding)\n{\n\tif (!bonding)\n\t\treturn;\n\n\tif (bonding->listener_id)\n\t\tg_dbus_remove_watch(dbus_conn, bonding->listener_id);\n\n\tif (bonding->msg)\n\t\tdbus_message_unref(bonding->msg);\n\n\tif (bonding->cb_iter)\n\t\tg_free(bonding->cb_iter);\n\n\tif (bonding->agent) {\n\t\tagent_cancel(bonding->agent);\n\t\tagent_unref(bonding->agent);\n\t\tbonding->agent = NULL;\n\t}\n\n\tif (bonding->retry_timer)\n\t\tg_source_remove(bonding->retry_timer);\n\n\tif (bonding->device)\n\t\tbonding->device->bonding = NULL;\n\n\tg_free(bonding);\n}"
        }
      },
      {
        "call_info": {
          "callee": "adapter_create_bonding",
          "args": [
            "adapter",
            "&device->bdaddr",
            "BDADDR_BREDR",
            "io_cap"
          ],
          "line": 2608
        },
        "resolved": true,
        "details": {
          "function_name": "adapter_create_bonding",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "7221-7233",
          "snippet": "int adapter_create_bonding(struct btd_adapter *adapter, const bdaddr_t *bdaddr,\n\t\t\t\t\tuint8_t addr_type, uint8_t io_cap)\n{\n\tif (adapter->pair_device_id > 0) {\n\t\tbtd_error(adapter->dev_id,\n\t\t\t\"Unable pair since another pairing is in progress\");\n\t\treturn -EBUSY;\n\t}\n\n\tsuspend_discovery(adapter);\n\n\treturn adapter_bonding_attempt(adapter, bdaddr, addr_type, io_cap);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nint adapter_create_bonding(struct btd_adapter *adapter, const bdaddr_t *bdaddr,\n\t\t\t\t\tuint8_t addr_type, uint8_t io_cap)\n{\n\tif (adapter->pair_device_id > 0) {\n\t\tbtd_error(adapter->dev_id,\n\t\t\t\"Unable pair since another pairing is in progress\");\n\t\treturn -EBUSY;\n\t}\n\n\tsuspend_discovery(adapter);\n\n\treturn adapter_bonding_attempt(adapter, bdaddr, addr_type, io_cap);\n}"
        }
      },
      {
        "call_info": {
          "callee": "device_connect_le",
          "args": [
            "device"
          ],
          "line": 2602
        },
        "resolved": true,
        "details": {
          "function_name": "device_connect_le",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5103-5158",
          "snippet": "int device_connect_le(struct btd_device *dev)\n{\n\tstruct btd_adapter *adapter = dev->adapter;\n\tBtIOSecLevel sec_level;\n\tGIOChannel *io;\n\tGError *gerr = NULL;\n\tchar addr[18];\n\n\t/* There is one connection attempt going on */\n\tif (dev->att_io)\n\t\treturn -EALREADY;\n\n\tba2str(&dev->bdaddr, addr);\n\n\tDBG(\"Connection attempt to: %s\", addr);\n\n\tif (dev->le_state.paired)\n\t\tsec_level = BT_IO_SEC_MEDIUM;\n\telse\n\t\tsec_level = BT_IO_SEC_LOW;\n\n\t/*\n\t * This connection will help us catch any PDUs that comes before\n\t * pairing finishes\n\t */\n\tio = bt_io_connect(att_connect_cb, dev, NULL, &gerr,\n\t\t\tBT_IO_OPT_SOURCE_BDADDR,\n\t\t\tbtd_adapter_get_address(adapter),\n\t\t\tBT_IO_OPT_SOURCE_TYPE,\n\t\t\tbtd_adapter_get_address_type(adapter),\n\t\t\tBT_IO_OPT_DEST_BDADDR, &dev->bdaddr,\n\t\t\tBT_IO_OPT_DEST_TYPE, dev->bdaddr_type,\n\t\t\tBT_IO_OPT_CID, ATT_CID,\n\t\t\tBT_IO_OPT_SEC_LEVEL, sec_level,\n\t\t\tBT_IO_OPT_INVALID);\n\n\tif (io == NULL) {\n\t\tif (dev->bonding) {\n\t\t\tDBusMessage *reply = btd_error_failed(\n\t\t\t\t\tdev->bonding->msg, gerr->message);\n\n\t\t\tg_dbus_send_message(dbus_conn, reply);\n\t\t\tbonding_request_cancel(dev->bonding);\n\t\t\tbonding_request_free(dev->bonding);\n\t\t}\n\n\t\terror(\"ATT bt_io_connect(%s): %s\", addr, gerr->message);\n\t\tg_error_free(gerr);\n\t\treturn -EIO;\n\t}\n\n\t/* Keep this, so we can cancel the connection */\n\tdev->att_io = io;\n\n\treturn 0;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *dbus_conn = NULL;",
            "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
            "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\n\nint device_connect_le(struct btd_device *dev)\n{\n\tstruct btd_adapter *adapter = dev->adapter;\n\tBtIOSecLevel sec_level;\n\tGIOChannel *io;\n\tGError *gerr = NULL;\n\tchar addr[18];\n\n\t/* There is one connection attempt going on */\n\tif (dev->att_io)\n\t\treturn -EALREADY;\n\n\tba2str(&dev->bdaddr, addr);\n\n\tDBG(\"Connection attempt to: %s\", addr);\n\n\tif (dev->le_state.paired)\n\t\tsec_level = BT_IO_SEC_MEDIUM;\n\telse\n\t\tsec_level = BT_IO_SEC_LOW;\n\n\t/*\n\t * This connection will help us catch any PDUs that comes before\n\t * pairing finishes\n\t */\n\tio = bt_io_connect(att_connect_cb, dev, NULL, &gerr,\n\t\t\tBT_IO_OPT_SOURCE_BDADDR,\n\t\t\tbtd_adapter_get_address(adapter),\n\t\t\tBT_IO_OPT_SOURCE_TYPE,\n\t\t\tbtd_adapter_get_address_type(adapter),\n\t\t\tBT_IO_OPT_DEST_BDADDR, &dev->bdaddr,\n\t\t\tBT_IO_OPT_DEST_TYPE, dev->bdaddr_type,\n\t\t\tBT_IO_OPT_CID, ATT_CID,\n\t\t\tBT_IO_OPT_SEC_LEVEL, sec_level,\n\t\t\tBT_IO_OPT_INVALID);\n\n\tif (io == NULL) {\n\t\tif (dev->bonding) {\n\t\t\tDBusMessage *reply = btd_error_failed(\n\t\t\t\t\tdev->bonding->msg, gerr->message);\n\n\t\t\tg_dbus_send_message(dbus_conn, reply);\n\t\t\tbonding_request_cancel(dev->bonding);\n\t\t\tbonding_request_free(dev->bonding);\n\t\t}\n\n\t\terror(\"ATT bt_io_connect(%s): %s\", addr, gerr->message);\n\t\tg_error_free(gerr);\n\t\treturn -EIO;\n\t}\n\n\t/* Keep this, so we can cancel the connection */\n\tdev->att_io = io;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_le_connect_before_pairing",
          "args": [],
          "line": 2601
        },
        "resolved": true,
        "details": {
          "function_name": "btd_le_connect_before_pairing",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "9126-9132",
          "snippet": "bool btd_le_connect_before_pairing(void)\n{\n\tif (MGMT_VERSION(mgmt_version, mgmt_revision) < MGMT_VERSION(1, 4))\n\t\treturn true;\n\n\treturn false;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static uint8_t mgmt_version = 0;",
            "static uint8_t mgmt_revision = 0;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic uint8_t mgmt_version = 0;\nstatic uint8_t mgmt_revision = 0;\n\nbool btd_le_connect_before_pairing(void)\n{\n\tif (MGMT_VERSION(mgmt_version, mgmt_revision) < MGMT_VERSION(1, 4))\n\t\treturn true;\n\n\treturn false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_add_disconnect_watch",
          "args": [
            "dbus_conn",
            "sender",
            "create_bond_req_exit",
            "device",
            "NULL"
          ],
          "line": 2588
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "agent_unref",
          "args": [
            "agent"
          ],
          "line": 2586
        },
        "resolved": true,
        "details": {
          "function_name": "agent_unref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "211-257",
          "snippet": "void agent_unref(struct agent *agent)\n{\n\tagent->ref--;\n\n\tDBG(\"%p: ref=%d\", agent, agent->ref);\n\n\tif (agent->ref > 0)\n\t\treturn;\n\n\tif (agent->request) {\n\t\tDBusError err;\n\t\tagent_pincode_cb pincode_cb;\n\t\tagent_passkey_cb passkey_cb;\n\t\tagent_cb cb;\n\n\t\tdbus_error_init(&err);\n\t\tdbus_set_error_const(&err, ERROR_INTERFACE \".Failed\",\n\t\t\t\t\t\t\t\t\"Canceled\");\n\n\t\tswitch (agent->request->type) {\n\t\tcase AGENT_REQUEST_PINCODE:\n\t\t\tpincode_cb = agent->request->cb;\n\t\t\tpincode_cb(agent, &err, NULL, agent->request->user_data);\n\t\t\tbreak;\n\t\tcase AGENT_REQUEST_PASSKEY:\n\t\t\tpasskey_cb = agent->request->cb;\n\t\t\tpasskey_cb(agent, &err, 0, agent->request->user_data);\n\t\t\tbreak;\n\t\tcase AGENT_REQUEST_CONFIRMATION:\n\t\tcase AGENT_REQUEST_AUTHORIZATION:\n\t\tcase AGENT_REQUEST_AUTHORIZE_SERVICE:\n\t\tcase AGENT_REQUEST_DISPLAY_PINCODE:\n\t\tdefault:\n\t\t\tcb = agent->request->cb;\n\t\t\tcb(agent, &err, agent->request->user_data);\n\t\t}\n\n\t\tdbus_error_free(&err);\n\n\t\tagent_cancel(agent);\n\t}\n\n\tg_free(agent->owner);\n\tg_free(agent->path);\n\n\tg_free(agent);\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid agent_unref(struct agent *agent)\n{\n\tagent->ref--;\n\n\tDBG(\"%p: ref=%d\", agent, agent->ref);\n\n\tif (agent->ref > 0)\n\t\treturn;\n\n\tif (agent->request) {\n\t\tDBusError err;\n\t\tagent_pincode_cb pincode_cb;\n\t\tagent_passkey_cb passkey_cb;\n\t\tagent_cb cb;\n\n\t\tdbus_error_init(&err);\n\t\tdbus_set_error_const(&err, ERROR_INTERFACE \".Failed\",\n\t\t\t\t\t\t\t\t\"Canceled\");\n\n\t\tswitch (agent->request->type) {\n\t\tcase AGENT_REQUEST_PINCODE:\n\t\t\tpincode_cb = agent->request->cb;\n\t\t\tpincode_cb(agent, &err, NULL, agent->request->user_data);\n\t\t\tbreak;\n\t\tcase AGENT_REQUEST_PASSKEY:\n\t\t\tpasskey_cb = agent->request->cb;\n\t\t\tpasskey_cb(agent, &err, 0, agent->request->user_data);\n\t\t\tbreak;\n\t\tcase AGENT_REQUEST_CONFIRMATION:\n\t\tcase AGENT_REQUEST_AUTHORIZATION:\n\t\tcase AGENT_REQUEST_AUTHORIZE_SERVICE:\n\t\tcase AGENT_REQUEST_DISPLAY_PINCODE:\n\t\tdefault:\n\t\t\tcb = agent->request->cb;\n\t\t\tcb(agent, &err, agent->request->user_data);\n\t\t}\n\n\t\tdbus_error_free(&err);\n\n\t\tagent_cancel(agent);\n\t}\n\n\tg_free(agent->owner);\n\tg_free(agent->path);\n\n\tg_free(agent);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bonding_request_new",
          "args": [
            "msg",
            "device",
            "bdaddr_type",
            "agent"
          ],
          "line": 2583
        },
        "resolved": true,
        "details": {
          "function_name": "bonding_request_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "2428-2455",
          "snippet": "static struct bonding_req *bonding_request_new(DBusMessage *msg,\n\t\t\t\t\t\tstruct btd_device *device,\n\t\t\t\t\t\tuint8_t bdaddr_type,\n\t\t\t\t\t\tstruct agent *agent)\n{\n\tstruct bonding_req *bonding;\n\tchar addr[18];\n\n\tba2str(&device->bdaddr, addr);\n\tDBG(\"Requesting bonding for %s\", addr);\n\n\tbonding = g_new0(struct bonding_req, 1);\n\n\tbonding->msg = dbus_message_ref(msg);\n\tbonding->bdaddr_type = bdaddr_type;\n\n\tbonding->cb_iter = btd_adapter_pin_cb_iter_new(device->adapter);\n\n\t/* Marks the bonding start time for the first attempt on request\n\t * construction. The following attempts will be updated on\n\t * device_bonding_retry. */\n\tclock_gettime(CLOCK_MONOTONIC, &bonding->attempt_start_time);\n\n\tif (agent)\n\t\tbonding->agent = agent_ref(agent);\n\n\treturn bonding;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
            "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);",
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic struct bonding_req *bonding_request_new(DBusMessage *msg,\n\t\t\t\t\t\tstruct btd_device *device,\n\t\t\t\t\t\tuint8_t bdaddr_type,\n\t\t\t\t\t\tstruct agent *agent)\n{\n\tstruct bonding_req *bonding;\n\tchar addr[18];\n\n\tba2str(&device->bdaddr, addr);\n\tDBG(\"Requesting bonding for %s\", addr);\n\n\tbonding = g_new0(struct bonding_req, 1);\n\n\tbonding->msg = dbus_message_ref(msg);\n\tbonding->bdaddr_type = bdaddr_type;\n\n\tbonding->cb_iter = btd_adapter_pin_cb_iter_new(device->adapter);\n\n\t/* Marks the bonding start time for the first attempt on request\n\t * construction. The following attempts will be updated on\n\t * device_bonding_retry. */\n\tclock_gettime(CLOCK_MONOTONIC, &bonding->attempt_start_time);\n\n\tif (agent)\n\t\tbonding->agent = agent_ref(agent);\n\n\treturn bonding;\n}"
        }
      },
      {
        "call_info": {
          "callee": "agent_get_io_capability",
          "args": [
            "agent"
          ],
          "line": 2579
        },
        "resolved": true,
        "details": {
          "function_name": "agent_get_io_capability",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "900-903",
          "snippet": "uint8_t agent_get_io_capability(struct agent *agent)\n{\n\treturn agent->capability;\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nuint8_t agent_get_io_capability(struct agent *agent)\n{\n\treturn agent->capability;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_get_sender",
          "args": [
            "msg"
          ],
          "line": 2575
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_error_already_exists",
          "args": [
            "msg"
          ],
          "line": 2573
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_already_exists",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "52-56",
          "snippet": "DBusMessage *btd_error_already_exists(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".AlreadyExists\",\n\t\t\t\t\t\"Already Exists\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_already_exists(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".AlreadyExists\",\n\t\t\t\t\t\"Already Exists\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "get_state",
          "args": [
            "device",
            "bdaddr_type"
          ],
          "line": 2570
        },
        "resolved": true,
        "details": {
          "function_name": "get_state",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "275-282",
          "snippet": "static struct bearer_state *get_state(struct btd_device *dev,\n\t\t\t\t\t\t\tuint8_t bdaddr_type)\n{\n\tif (bdaddr_type == BDADDR_BREDR)\n\t\treturn &dev->bredr_state;\n\telse\n\t\treturn &dev->le_state;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic struct bearer_state *get_state(struct btd_device *dev,\n\t\t\t\t\t\t\tuint8_t bdaddr_type)\n{\n\tif (bdaddr_type == BDADDR_BREDR)\n\t\treturn &dev->bredr_state;\n\telse\n\t\treturn &dev->le_state;\n}"
        }
      },
      {
        "call_info": {
          "callee": "select_conn_bearer",
          "args": [
            "device"
          ],
          "line": 2568
        },
        "resolved": true,
        "details": {
          "function_name": "select_conn_bearer",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "1893-1937",
          "snippet": "static uint8_t select_conn_bearer(struct btd_device *dev)\n{\n\ttime_t bredr_last = NVAL_TIME, le_last = NVAL_TIME;\n\ttime_t current = time(NULL);\n\n\t/* Prefer bonded bearer in case only one is bonded */\n\tif (dev->bredr_state.bonded && !dev->le_state.bonded )\n\t\treturn BDADDR_BREDR;\n\telse if (!dev->bredr_state.bonded && dev->le_state.bonded)\n\t\treturn dev->bdaddr_type;\n\n\t/* If the address is random it can only be connected over LE */\n\tif (dev->bdaddr_type == BDADDR_LE_RANDOM)\n\t\treturn dev->bdaddr_type;\n\n\tif (dev->bredr_seen) {\n\t\tbredr_last = current - dev->bredr_seen;\n\t\tif (bredr_last > SEEN_TRESHHOLD)\n\t\t\tbredr_last = NVAL_TIME;\n\t}\n\n\tif (dev->le_seen) {\n\t\tle_last = current - dev->le_seen;\n\t\tif (le_last > SEEN_TRESHHOLD)\n\t\t\tle_last = NVAL_TIME;\n\t}\n\n\tif (le_last == NVAL_TIME && bredr_last == NVAL_TIME)\n\t\treturn dev->bdaddr_type;\n\n\tif (dev->bredr && (!dev->le || le_last == NVAL_TIME))\n\t\treturn BDADDR_BREDR;\n\n\tif (dev->le && (!dev->bredr || bredr_last == NVAL_TIME))\n\t\treturn dev->bdaddr_type;\n\n\t/*\n\t * Prefer BR/EDR if time is the same since it might be from an\n\t * advertisement with BR/EDR flag set.\n\t */\n\tif (bredr_last <= le_last && btd_adapter_get_bredr(dev->adapter))\n\t\treturn BDADDR_BREDR;\n\n\treturn dev->bdaddr_type;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define SEEN_TRESHHOLD 300",
            "#define NVAL_TIME ((time_t) -1)"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\n#define SEEN_TRESHHOLD 300\n#define NVAL_TIME ((time_t) -1)\n\nstatic uint8_t select_conn_bearer(struct btd_device *dev)\n{\n\ttime_t bredr_last = NVAL_TIME, le_last = NVAL_TIME;\n\ttime_t current = time(NULL);\n\n\t/* Prefer bonded bearer in case only one is bonded */\n\tif (dev->bredr_state.bonded && !dev->le_state.bonded )\n\t\treturn BDADDR_BREDR;\n\telse if (!dev->bredr_state.bonded && dev->le_state.bonded)\n\t\treturn dev->bdaddr_type;\n\n\t/* If the address is random it can only be connected over LE */\n\tif (dev->bdaddr_type == BDADDR_LE_RANDOM)\n\t\treturn dev->bdaddr_type;\n\n\tif (dev->bredr_seen) {\n\t\tbredr_last = current - dev->bredr_seen;\n\t\tif (bredr_last > SEEN_TRESHHOLD)\n\t\t\tbredr_last = NVAL_TIME;\n\t}\n\n\tif (dev->le_seen) {\n\t\tle_last = current - dev->le_seen;\n\t\tif (le_last > SEEN_TRESHHOLD)\n\t\t\tle_last = NVAL_TIME;\n\t}\n\n\tif (le_last == NVAL_TIME && bredr_last == NVAL_TIME)\n\t\treturn dev->bdaddr_type;\n\n\tif (dev->bredr && (!dev->le || le_last == NVAL_TIME))\n\t\treturn BDADDR_BREDR;\n\n\tif (dev->le && (!dev->bredr || bredr_last == NVAL_TIME))\n\t\treturn dev->bdaddr_type;\n\n\t/*\n\t * Prefer BR/EDR if time is the same since it might be from an\n\t * advertisement with BR/EDR flag set.\n\t */\n\tif (bredr_last <= le_last && btd_adapter_get_bredr(dev->adapter))\n\t\treturn BDADDR_BREDR;\n\n\treturn dev->bdaddr_type;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_error_in_progress",
          "args": [
            "msg"
          ],
          "line": 2561
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_in_progress",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "76-80",
          "snippet": "DBusMessage *btd_error_in_progress(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".InProgress\",\n\t\t\t\t\t\"In Progress\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_in_progress(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".InProgress\",\n\t\t\t\t\t\"In Progress\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_error_invalid_args",
          "args": [
            "msg"
          ],
          "line": 2558
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_invalid_args",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "34-38",
          "snippet": "DBusMessage *btd_error_invalid_args(DBusMessage *msg)\n{\n\treturn btd_error_invalid_args_str(msg,\n\t\t\t\t\t\"Invalid arguments in method call\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_invalid_args(DBusMessage *msg)\n{\n\treturn btd_error_invalid_args_str(msg,\n\t\t\t\t\t\"Invalid arguments in method call\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_get_args",
          "args": [
            "msg",
            "NULL",
            "DBUS_TYPE_INVALID"
          ],
          "line": 2557
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_device_set_temporary",
          "args": [
            "device",
            "false"
          ],
          "line": 2555
        },
        "resolved": true,
        "details": {
          "function_name": "btd_device_set_temporary",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5336-5368",
          "snippet": "void btd_device_set_temporary(struct btd_device *device, bool temporary)\n{\n\tif (!device)\n\t\treturn;\n\n\tif (device->temporary == temporary)\n\t\treturn;\n\n\tif (device_address_is_private(device))\n\t\treturn;\n\n\tDBG(\"temporary %d\", temporary);\n\n\tdevice->temporary = temporary;\n\n\tif (temporary) {\n\t\tif (device->bredr)\n\t\t\tadapter_whitelist_remove(device->adapter, device);\n\t\tadapter_connect_list_remove(device->adapter, device);\n\t\treturn;\n\t}\n\n\tif (device->bredr)\n\t\tadapter_whitelist_add(device->adapter, device);\n\n\tstore_device_info(device);\n\n\t/* attributes were not stored when resolved if device was temporary */\n\tif (device->bdaddr_type != BDADDR_BREDR &&\n\t\t\tdevice->le_state.svc_resolved &&\n\t\t\tg_slist_length(device->primaries) != 0)\n\t\tstore_services(device);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid btd_device_set_temporary(struct btd_device *device, bool temporary)\n{\n\tif (!device)\n\t\treturn;\n\n\tif (device->temporary == temporary)\n\t\treturn;\n\n\tif (device_address_is_private(device))\n\t\treturn;\n\n\tDBG(\"temporary %d\", temporary);\n\n\tdevice->temporary = temporary;\n\n\tif (temporary) {\n\t\tif (device->bredr)\n\t\t\tadapter_whitelist_remove(device->adapter, device);\n\t\tadapter_connect_list_remove(device->adapter, device);\n\t\treturn;\n\t}\n\n\tif (device->bredr)\n\t\tadapter_whitelist_add(device->adapter, device);\n\n\tstore_device_info(device);\n\n\t/* attributes were not stored when resolved if device was temporary */\n\tif (device->bdaddr_type != BDADDR_BREDR &&\n\t\t\tdevice->le_state.svc_resolved &&\n\t\t\tg_slist_length(device->primaries) != 0)\n\t\tstore_services(device);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic DBusMessage *pair_device(DBusConnection *conn, DBusMessage *msg,\n\t\t\t\t\t\t\t\tvoid *data)\n{\n\tstruct btd_device *device = data;\n\tstruct btd_adapter *adapter = device->adapter;\n\tstruct bearer_state *state;\n\tuint8_t bdaddr_type;\n\tconst char *sender;\n\tstruct agent *agent;\n\tstruct bonding_req *bonding;\n\tuint8_t io_cap;\n\tint err;\n\n\tbtd_device_set_temporary(device, false);\n\n\tif (!dbus_message_get_args(msg, NULL, DBUS_TYPE_INVALID))\n\t\treturn btd_error_invalid_args(msg);\n\n\tif (device->bonding)\n\t\treturn btd_error_in_progress(msg);\n\n\tif (device->bredr_state.bonded)\n\t\tbdaddr_type = device->bdaddr_type;\n\telse if (device->le_state.bonded)\n\t\tbdaddr_type = BDADDR_BREDR;\n\telse\n\t\tbdaddr_type = select_conn_bearer(device);\n\n\tstate = get_state(device, bdaddr_type);\n\n\tif (state->bonded)\n\t\treturn btd_error_already_exists(msg);\n\n\tsender = dbus_message_get_sender(msg);\n\n\tagent = agent_get(sender);\n\tif (agent)\n\t\tio_cap = agent_get_io_capability(agent);\n\telse\n\t\tio_cap = IO_CAPABILITY_NOINPUTNOOUTPUT;\n\n\tbonding = bonding_request_new(msg, device, bdaddr_type, agent);\n\n\tif (agent)\n\t\tagent_unref(agent);\n\n\tbonding->listener_id = g_dbus_add_disconnect_watch(dbus_conn,\n\t\t\t\t\t\tsender, create_bond_req_exit,\n\t\t\t\t\t\tdevice, NULL);\n\n\tdevice->bonding = bonding;\n\tbonding->device = device;\n\n\t/* Due to a bug in the kernel we might loose out on ATT commands\n\t * that arrive during the SMP procedure, so connect the ATT\n\t * channel first and only then start pairing (there's code for\n\t * this in the ATT connect callback)\n\t */\n\tif (bdaddr_type != BDADDR_BREDR) {\n\t\tif (!state->connected && btd_le_connect_before_pairing())\n\t\t\terr = device_connect_le(device);\n\t\telse\n\t\t\terr = adapter_create_bonding(adapter, &device->bdaddr,\n\t\t\t\t\t\t\tdevice->bdaddr_type,\n\t\t\t\t\t\t\tio_cap);\n\t} else {\n\t\terr = adapter_create_bonding(adapter, &device->bdaddr,\n\t\t\t\t\t\t\tBDADDR_BREDR, io_cap);\n\t}\n\n\tif (err < 0) {\n\t\tbonding_request_free(device->bonding);\n\t\treturn btd_error_failed(msg, strerror(-err));\n\t}\n\n\treturn NULL;\n}"
  },
  {
    "function_name": "bonding_request_free",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "2513-2540",
    "snippet": "static void bonding_request_free(struct bonding_req *bonding)\n{\n\tif (!bonding)\n\t\treturn;\n\n\tif (bonding->listener_id)\n\t\tg_dbus_remove_watch(dbus_conn, bonding->listener_id);\n\n\tif (bonding->msg)\n\t\tdbus_message_unref(bonding->msg);\n\n\tif (bonding->cb_iter)\n\t\tg_free(bonding->cb_iter);\n\n\tif (bonding->agent) {\n\t\tagent_cancel(bonding->agent);\n\t\tagent_unref(bonding->agent);\n\t\tbonding->agent = NULL;\n\t}\n\n\tif (bonding->retry_timer)\n\t\tg_source_remove(bonding->retry_timer);\n\n\tif (bonding->device)\n\t\tbonding->device->bonding = NULL;\n\n\tg_free(bonding);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static DBusConnection *dbus_conn = NULL;",
      "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
      "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);",
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "bonding"
          ],
          "line": 2539
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_source_remove",
          "args": [
            "bonding->retry_timer"
          ],
          "line": 2534
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "agent_unref",
          "args": [
            "bonding->agent"
          ],
          "line": 2529
        },
        "resolved": true,
        "details": {
          "function_name": "agent_unref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "211-257",
          "snippet": "void agent_unref(struct agent *agent)\n{\n\tagent->ref--;\n\n\tDBG(\"%p: ref=%d\", agent, agent->ref);\n\n\tif (agent->ref > 0)\n\t\treturn;\n\n\tif (agent->request) {\n\t\tDBusError err;\n\t\tagent_pincode_cb pincode_cb;\n\t\tagent_passkey_cb passkey_cb;\n\t\tagent_cb cb;\n\n\t\tdbus_error_init(&err);\n\t\tdbus_set_error_const(&err, ERROR_INTERFACE \".Failed\",\n\t\t\t\t\t\t\t\t\"Canceled\");\n\n\t\tswitch (agent->request->type) {\n\t\tcase AGENT_REQUEST_PINCODE:\n\t\t\tpincode_cb = agent->request->cb;\n\t\t\tpincode_cb(agent, &err, NULL, agent->request->user_data);\n\t\t\tbreak;\n\t\tcase AGENT_REQUEST_PASSKEY:\n\t\t\tpasskey_cb = agent->request->cb;\n\t\t\tpasskey_cb(agent, &err, 0, agent->request->user_data);\n\t\t\tbreak;\n\t\tcase AGENT_REQUEST_CONFIRMATION:\n\t\tcase AGENT_REQUEST_AUTHORIZATION:\n\t\tcase AGENT_REQUEST_AUTHORIZE_SERVICE:\n\t\tcase AGENT_REQUEST_DISPLAY_PINCODE:\n\t\tdefault:\n\t\t\tcb = agent->request->cb;\n\t\t\tcb(agent, &err, agent->request->user_data);\n\t\t}\n\n\t\tdbus_error_free(&err);\n\n\t\tagent_cancel(agent);\n\t}\n\n\tg_free(agent->owner);\n\tg_free(agent->path);\n\n\tg_free(agent);\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid agent_unref(struct agent *agent)\n{\n\tagent->ref--;\n\n\tDBG(\"%p: ref=%d\", agent, agent->ref);\n\n\tif (agent->ref > 0)\n\t\treturn;\n\n\tif (agent->request) {\n\t\tDBusError err;\n\t\tagent_pincode_cb pincode_cb;\n\t\tagent_passkey_cb passkey_cb;\n\t\tagent_cb cb;\n\n\t\tdbus_error_init(&err);\n\t\tdbus_set_error_const(&err, ERROR_INTERFACE \".Failed\",\n\t\t\t\t\t\t\t\t\"Canceled\");\n\n\t\tswitch (agent->request->type) {\n\t\tcase AGENT_REQUEST_PINCODE:\n\t\t\tpincode_cb = agent->request->cb;\n\t\t\tpincode_cb(agent, &err, NULL, agent->request->user_data);\n\t\t\tbreak;\n\t\tcase AGENT_REQUEST_PASSKEY:\n\t\t\tpasskey_cb = agent->request->cb;\n\t\t\tpasskey_cb(agent, &err, 0, agent->request->user_data);\n\t\t\tbreak;\n\t\tcase AGENT_REQUEST_CONFIRMATION:\n\t\tcase AGENT_REQUEST_AUTHORIZATION:\n\t\tcase AGENT_REQUEST_AUTHORIZE_SERVICE:\n\t\tcase AGENT_REQUEST_DISPLAY_PINCODE:\n\t\tdefault:\n\t\t\tcb = agent->request->cb;\n\t\t\tcb(agent, &err, agent->request->user_data);\n\t\t}\n\n\t\tdbus_error_free(&err);\n\n\t\tagent_cancel(agent);\n\t}\n\n\tg_free(agent->owner);\n\tg_free(agent->path);\n\n\tg_free(agent);\n}"
        }
      },
      {
        "call_info": {
          "callee": "agent_cancel",
          "args": [
            "bonding->agent"
          ],
          "line": 2528
        },
        "resolved": true,
        "details": {
          "function_name": "agent_cancel",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "317-331",
          "snippet": "int agent_cancel(struct agent *agent)\n{\n\tif (!agent->request)\n\t\treturn -EINVAL;\n\n\tif (agent->request->call) {\n\t\tdbus_pending_call_cancel(agent->request->call);\n\t\tsend_cancel_request(agent->request);\n\t}\n\n\tagent_request_free(agent->request, TRUE);\n\tagent->request = NULL;\n\n\treturn 0;\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nint agent_cancel(struct agent *agent)\n{\n\tif (!agent->request)\n\t\treturn -EINVAL;\n\n\tif (agent->request->call) {\n\t\tdbus_pending_call_cancel(agent->request->call);\n\t\tsend_cancel_request(agent->request);\n\t}\n\n\tagent_request_free(agent->request, TRUE);\n\tagent->request = NULL;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "bonding->cb_iter"
          ],
          "line": 2525
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_unref",
          "args": [
            "bonding->msg"
          ],
          "line": 2522
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_remove_watch",
          "args": [
            "dbus_conn",
            "bonding->listener_id"
          ],
          "line": 2519
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void bonding_request_free(struct bonding_req *bonding)\n{\n\tif (!bonding)\n\t\treturn;\n\n\tif (bonding->listener_id)\n\t\tg_dbus_remove_watch(dbus_conn, bonding->listener_id);\n\n\tif (bonding->msg)\n\t\tdbus_message_unref(bonding->msg);\n\n\tif (bonding->cb_iter)\n\t\tg_free(bonding->cb_iter);\n\n\tif (bonding->agent) {\n\t\tagent_cancel(bonding->agent);\n\t\tagent_unref(bonding->agent);\n\t\tbonding->agent = NULL;\n\t}\n\n\tif (bonding->retry_timer)\n\t\tg_source_remove(bonding->retry_timer);\n\n\tif (bonding->device)\n\t\tbonding->device->bonding = NULL;\n\n\tg_free(bonding);\n}"
  },
  {
    "function_name": "create_bond_req_exit",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "2496-2511",
    "snippet": "static void create_bond_req_exit(DBusConnection *conn, void *user_data)\n{\n\tstruct btd_device *device = user_data;\n\tchar addr[18];\n\n\tba2str(&device->bdaddr, addr);\n\tDBG(\"%s: requestor exited before bonding was completed\", addr);\n\n\tif (device->authr)\n\t\tdevice_cancel_authentication(device, FALSE);\n\n\tif (device->bonding) {\n\t\tdevice->bonding->listener_id = 0;\n\t\tdevice_request_disconnect(device, NULL);\n\t}\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "device_request_disconnect",
          "args": [
            "device",
            "NULL"
          ],
          "line": 2509
        },
        "resolved": true,
        "details": {
          "function_name": "device_request_disconnect",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "1436-1495",
          "snippet": "void device_request_disconnect(struct btd_device *device, DBusMessage *msg)\n{\n\tif (device->bonding)\n\t\tbonding_request_cancel(device->bonding);\n\n\tif (device->browse)\n\t\tbrowse_request_cancel(device->browse);\n\n\tif (device->att_io) {\n\t\tg_io_channel_shutdown(device->att_io, FALSE, NULL);\n\t\tg_io_channel_unref(device->att_io);\n\t\tdevice->att_io = NULL;\n\t}\n\n\tif (device->connect) {\n\t\tDBusMessage *reply = btd_error_failed(device->connect,\n\t\t\t\t\t\t\t\t\"Cancelled\");\n\t\tg_dbus_send_message(dbus_conn, reply);\n\t\tdbus_message_unref(device->connect);\n\t\tdevice->connect = NULL;\n\t}\n\n\tif (btd_device_is_connected(device) && msg)\n\t\tdevice->disconnects = g_slist_append(device->disconnects,\n\t\t\t\t\t\tdbus_message_ref(msg));\n\n\tif (device->disconn_timer)\n\t\treturn;\n\n\tg_slist_foreach(device->services, dev_disconn_service, NULL);\n\n\tg_slist_free(device->pending);\n\tdevice->pending = NULL;\n\n\twhile (device->watches) {\n\t\tstruct btd_disconnect_data *data = device->watches->data;\n\n\t\tif (data->watch)\n\t\t\t/* temporary is set if device is going to be removed */\n\t\t\tdata->watch(device, device->temporary,\n\t\t\t\t\t\t\tdata->user_data);\n\n\t\t/* Check if the watch has been removed by callback function */\n\t\tif (!g_slist_find(device->watches, data))\n\t\t\tcontinue;\n\n\t\tdevice->watches = g_slist_remove(device->watches, data);\n\t\tg_free(data);\n\t}\n\n\tif (!btd_device_is_connected(device)) {\n\t\tif (msg)\n\t\t\tg_dbus_send_reply(dbus_conn, msg, DBUS_TYPE_INVALID);\n\t\treturn;\n\t}\n\n\tdevice->disconn_timer = g_timeout_add_seconds(DISCONNECT_TIMER,\n\t\t\t\t\t\t\tdisconnect_all,\n\t\t\t\t\t\t\tdevice);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define DISCONNECT_TIMER\t2"
          ],
          "globals_used": [
            "static DBusConnection *dbus_conn = NULL;",
            "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
            "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);",
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\n#define DISCONNECT_TIMER\t2\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid device_request_disconnect(struct btd_device *device, DBusMessage *msg)\n{\n\tif (device->bonding)\n\t\tbonding_request_cancel(device->bonding);\n\n\tif (device->browse)\n\t\tbrowse_request_cancel(device->browse);\n\n\tif (device->att_io) {\n\t\tg_io_channel_shutdown(device->att_io, FALSE, NULL);\n\t\tg_io_channel_unref(device->att_io);\n\t\tdevice->att_io = NULL;\n\t}\n\n\tif (device->connect) {\n\t\tDBusMessage *reply = btd_error_failed(device->connect,\n\t\t\t\t\t\t\t\t\"Cancelled\");\n\t\tg_dbus_send_message(dbus_conn, reply);\n\t\tdbus_message_unref(device->connect);\n\t\tdevice->connect = NULL;\n\t}\n\n\tif (btd_device_is_connected(device) && msg)\n\t\tdevice->disconnects = g_slist_append(device->disconnects,\n\t\t\t\t\t\tdbus_message_ref(msg));\n\n\tif (device->disconn_timer)\n\t\treturn;\n\n\tg_slist_foreach(device->services, dev_disconn_service, NULL);\n\n\tg_slist_free(device->pending);\n\tdevice->pending = NULL;\n\n\twhile (device->watches) {\n\t\tstruct btd_disconnect_data *data = device->watches->data;\n\n\t\tif (data->watch)\n\t\t\t/* temporary is set if device is going to be removed */\n\t\t\tdata->watch(device, device->temporary,\n\t\t\t\t\t\t\tdata->user_data);\n\n\t\t/* Check if the watch has been removed by callback function */\n\t\tif (!g_slist_find(device->watches, data))\n\t\t\tcontinue;\n\n\t\tdevice->watches = g_slist_remove(device->watches, data);\n\t\tg_free(data);\n\t}\n\n\tif (!btd_device_is_connected(device)) {\n\t\tif (msg)\n\t\t\tg_dbus_send_reply(dbus_conn, msg, DBUS_TYPE_INVALID);\n\t\treturn;\n\t}\n\n\tdevice->disconn_timer = g_timeout_add_seconds(DISCONNECT_TIMER,\n\t\t\t\t\t\t\tdisconnect_all,\n\t\t\t\t\t\t\tdevice);\n}"
        }
      },
      {
        "call_info": {
          "callee": "device_cancel_authentication",
          "args": [
            "device",
            "FALSE"
          ],
          "line": 2505
        },
        "resolved": true,
        "details": {
          "function_name": "device_cancel_authentication",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "6170-6188",
          "snippet": "void device_cancel_authentication(struct btd_device *device, gboolean aborted)\n{\n\tstruct authentication_req *auth = device->authr;\n\tchar addr[18];\n\n\tif (!auth)\n\t\treturn;\n\n\tba2str(&device->bdaddr, addr);\n\tDBG(\"Canceling authentication request for %s\", addr);\n\n\tif (auth->agent)\n\t\tagent_cancel(auth->agent);\n\n\tif (!aborted)\n\t\tcancel_authentication(auth);\n\n\tdevice_auth_req_free(device);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid device_cancel_authentication(struct btd_device *device, gboolean aborted)\n{\n\tstruct authentication_req *auth = device->authr;\n\tchar addr[18];\n\n\tif (!auth)\n\t\treturn;\n\n\tba2str(&device->bdaddr, addr);\n\tDBG(\"Canceling authentication request for %s\", addr);\n\n\tif (auth->agent)\n\t\tagent_cancel(auth->agent);\n\n\tif (!aborted)\n\t\tcancel_authentication(auth);\n\n\tdevice_auth_req_free(device);\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"%s: requestor exited before bonding was completed\"",
            "addr"
          ],
          "line": 2502
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ba2str",
          "args": [
            "&device->bdaddr",
            "addr"
          ],
          "line": 2501
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void create_bond_req_exit(DBusConnection *conn, void *user_data)\n{\n\tstruct btd_device *device = user_data;\n\tchar addr[18];\n\n\tba2str(&device->bdaddr, addr);\n\tDBG(\"%s: requestor exited before bonding was completed\", addr);\n\n\tif (device->authr)\n\t\tdevice_cancel_authentication(device, FALSE);\n\n\tif (device->bonding) {\n\t\tdevice->bonding->listener_id = 0;\n\t\tdevice_request_disconnect(device, NULL);\n\t}\n}"
  },
  {
    "function_name": "device_bonding_last_duration",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "2486-2494",
    "snippet": "long device_bonding_last_duration(struct btd_device *device)\n{\n\tstruct bonding_req *bonding = device->bonding;\n\n\tif (!bonding)\n\t\treturn 0;\n\n\treturn bonding->last_attempt_duration_ms;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nlong device_bonding_last_duration(struct btd_device *device)\n{\n\tstruct bonding_req *bonding = device->bonding;\n\n\tif (!bonding)\n\t\treturn 0;\n\n\treturn bonding->last_attempt_duration_ms;\n}"
  },
  {
    "function_name": "bonding_request_stop_timer",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "2465-2476",
    "snippet": "static void bonding_request_stop_timer(struct bonding_req *bonding)\n{\n\tstruct timespec current;\n\n\tclock_gettime(CLOCK_MONOTONIC, &current);\n\n\t/* Compute the time difference in ms. */\n\tbonding->last_attempt_duration_ms =\n\t\t(current.tv_sec - bonding->attempt_start_time.tv_sec) * 1000L +\n\t\t(current.tv_nsec - bonding->attempt_start_time.tv_nsec)\n\t\t\t\t\t\t\t\t/ 1000000L;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "clock_gettime",
          "args": [
            "CLOCK_MONOTONIC",
            "&current"
          ],
          "line": 2469
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void bonding_request_stop_timer(struct bonding_req *bonding)\n{\n\tstruct timespec current;\n\n\tclock_gettime(CLOCK_MONOTONIC, &current);\n\n\t/* Compute the time difference in ms. */\n\tbonding->last_attempt_duration_ms =\n\t\t(current.tv_sec - bonding->attempt_start_time.tv_sec) * 1000L +\n\t\t(current.tv_nsec - bonding->attempt_start_time.tv_nsec)\n\t\t\t\t\t\t\t\t/ 1000000L;\n}"
  },
  {
    "function_name": "device_bonding_restart_timer",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "2457-2463",
    "snippet": "void device_bonding_restart_timer(struct btd_device *device)\n{\n\tif (!device || !device->bonding)\n\t\treturn;\n\n\tclock_gettime(CLOCK_MONOTONIC, &device->bonding->attempt_start_time);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "clock_gettime",
          "args": [
            "CLOCK_MONOTONIC",
            "&device->bonding->attempt_start_time"
          ],
          "line": 2462
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid device_bonding_restart_timer(struct btd_device *device)\n{\n\tif (!device || !device->bonding)\n\t\treturn;\n\n\tclock_gettime(CLOCK_MONOTONIC, &device->bonding->attempt_start_time);\n}"
  },
  {
    "function_name": "bonding_request_new",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "2428-2455",
    "snippet": "static struct bonding_req *bonding_request_new(DBusMessage *msg,\n\t\t\t\t\t\tstruct btd_device *device,\n\t\t\t\t\t\tuint8_t bdaddr_type,\n\t\t\t\t\t\tstruct agent *agent)\n{\n\tstruct bonding_req *bonding;\n\tchar addr[18];\n\n\tba2str(&device->bdaddr, addr);\n\tDBG(\"Requesting bonding for %s\", addr);\n\n\tbonding = g_new0(struct bonding_req, 1);\n\n\tbonding->msg = dbus_message_ref(msg);\n\tbonding->bdaddr_type = bdaddr_type;\n\n\tbonding->cb_iter = btd_adapter_pin_cb_iter_new(device->adapter);\n\n\t/* Marks the bonding start time for the first attempt on request\n\t * construction. The following attempts will be updated on\n\t * device_bonding_retry. */\n\tclock_gettime(CLOCK_MONOTONIC, &bonding->attempt_start_time);\n\n\tif (agent)\n\t\tbonding->agent = agent_ref(agent);\n\n\treturn bonding;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
      "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);",
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "agent_ref",
          "args": [
            "agent"
          ],
          "line": 2452
        },
        "resolved": true,
        "details": {
          "function_name": "agent_ref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "202-209",
          "snippet": "struct agent *agent_ref(struct agent *agent)\n{\n\tagent->ref++;\n\n\tDBG(\"%p: ref=%d\", agent, agent->ref);\n\n\treturn agent;\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstruct agent *agent_ref(struct agent *agent)\n{\n\tagent->ref++;\n\n\tDBG(\"%p: ref=%d\", agent, agent->ref);\n\n\treturn agent;\n}"
        }
      },
      {
        "call_info": {
          "callee": "clock_gettime",
          "args": [
            "CLOCK_MONOTONIC",
            "&bonding->attempt_start_time"
          ],
          "line": 2449
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_adapter_pin_cb_iter_new",
          "args": [
            "device->adapter"
          ],
          "line": 2444
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_pin_cb_iter_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "6948-6958",
          "snippet": "struct btd_adapter_pin_cb_iter *btd_adapter_pin_cb_iter_new(\n\t\t\t\t\t\tstruct btd_adapter *adapter)\n{\n\tstruct btd_adapter_pin_cb_iter *iter =\n\t\t\t\tg_new0(struct btd_adapter_pin_cb_iter, 1);\n\n\titer->it = adapter->pin_callbacks;\n\titer->attempt = 1;\n\n\treturn iter;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nstruct btd_adapter_pin_cb_iter *btd_adapter_pin_cb_iter_new(\n\t\t\t\t\t\tstruct btd_adapter *adapter)\n{\n\tstruct btd_adapter_pin_cb_iter *iter =\n\t\t\t\tg_new0(struct btd_adapter_pin_cb_iter, 1);\n\n\titer->it = adapter->pin_callbacks;\n\titer->attempt = 1;\n\n\treturn iter;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_ref",
          "args": [
            "msg"
          ],
          "line": 2441
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_new0",
          "args": [
            "structbonding_req",
            "1"
          ],
          "line": 2439
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Requesting bonding for %s\"",
            "addr"
          ],
          "line": 2437
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ba2str",
          "args": [
            "&device->bdaddr",
            "addr"
          ],
          "line": 2436
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic struct bonding_req *bonding_request_new(DBusMessage *msg,\n\t\t\t\t\t\tstruct btd_device *device,\n\t\t\t\t\t\tuint8_t bdaddr_type,\n\t\t\t\t\t\tstruct agent *agent)\n{\n\tstruct bonding_req *bonding;\n\tchar addr[18];\n\n\tba2str(&device->bdaddr, addr);\n\tDBG(\"Requesting bonding for %s\", addr);\n\n\tbonding = g_new0(struct bonding_req, 1);\n\n\tbonding->msg = dbus_message_ref(msg);\n\tbonding->bdaddr_type = bdaddr_type;\n\n\tbonding->cb_iter = btd_adapter_pin_cb_iter_new(device->adapter);\n\n\t/* Marks the bonding start time for the first attempt on request\n\t * construction. The following attempts will be updated on\n\t * device_bonding_retry. */\n\tclock_gettime(CLOCK_MONOTONIC, &bonding->attempt_start_time);\n\n\tif (agent)\n\t\tbonding->agent = agent_ref(agent);\n\n\treturn bonding;\n}"
  },
  {
    "function_name": "device_svc_resolved",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "2378-2426",
    "snippet": "static void device_svc_resolved(struct btd_device *dev, uint8_t browse_type,\n\t\t\t\t\t\tuint8_t bdaddr_type, int err)\n{\n\tstruct bearer_state *state = get_state(dev, bdaddr_type);\n\tstruct browse_req *req = dev->browse;\n\n\tDBG(\"%s err %d\", dev->path, err);\n\n\tstate->svc_resolved = true;\n\n\t/* Disconnection notification can happen before this function\n\t * gets called, so don't set svc_refreshed for a disconnected\n\t * device.\n\t */\n\tif (state->connected)\n\t\tdevice_set_svc_refreshed(dev, true);\n\n\tg_slist_free_full(dev->eir_uuids, g_free);\n\tdev->eir_uuids = NULL;\n\n\tif (dev->pending_paired) {\n\t\tg_dbus_emit_property_changed(dbus_conn, dev->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"Paired\");\n\t\tdev->pending_paired = false;\n\t}\n\n\tif (!dev->temporary) {\n\t\tstore_device_info(dev);\n\n\t\tif (bdaddr_type != BDADDR_BREDR && err == 0)\n\t\t\tstore_services(dev);\n\t}\n\n\tif (req)\n\t\tbrowse_request_complete(req, browse_type, bdaddr_type, err);\n\n\twhile (dev->svc_callbacks) {\n\t\tstruct svc_callback *cb = dev->svc_callbacks->data;\n\n\t\tif (cb->idle_id > 0)\n\t\t\tg_source_remove(cb->idle_id);\n\n\t\tcb->func(dev, err, cb->user_data);\n\n\t\tdev->svc_callbacks = g_slist_delete_link(dev->svc_callbacks,\n\t\t\t\t\t\t\tdev->svc_callbacks);\n\t\tg_free(cb);\n\t}\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static DBusConnection *dbus_conn = NULL;",
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "cb"
          ],
          "line": 2424
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_delete_link",
          "args": [
            "dev->svc_callbacks",
            "dev->svc_callbacks"
          ],
          "line": 2422
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "cb->func",
          "args": [
            "dev",
            "err",
            "cb->user_data"
          ],
          "line": 2420
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_source_remove",
          "args": [
            "cb->idle_id"
          ],
          "line": 2418
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "browse_request_complete",
          "args": [
            "req",
            "browse_type",
            "bdaddr_type",
            "err"
          ],
          "line": 2412
        },
        "resolved": true,
        "details": {
          "function_name": "browse_request_complete",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "2298-2365",
          "snippet": "static void browse_request_complete(struct browse_req *req, uint8_t type,\n\t\t\t\t\t\tuint8_t bdaddr_type, int err)\n{\n\tstruct btd_device *dev = req->device;\n\tDBusMessage *reply = NULL;\n\tDBusMessage *msg;\n\n\tif (req->type != type)\n\t\treturn;\n\n\tif (!req->msg)\n\t\tgoto done;\n\n\tif (dbus_message_is_method_call(req->msg, DEVICE_INTERFACE, \"Pair\")) {\n\t\tif (!device_is_paired(dev, bdaddr_type)) {\n\t\t\treply = btd_error_failed(req->msg, \"Not paired\");\n\t\t\tgoto done;\n\t\t}\n\n\t\tif (dev->pending_paired) {\n\t\t\tg_dbus_emit_property_changed(dbus_conn, dev->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"Paired\");\n\t\t\tdev->pending_paired = false;\n\t\t}\n\n\t\t/* Disregard browse errors in case of Pair */\n\t\treply = g_dbus_create_reply(req->msg, DBUS_TYPE_INVALID);\n\t\tgoto done;\n\t}\n\n\tif (err) {\n\t\t/* Fallback to LE bearer if supported */\n\t\tif (err == -EHOSTDOWN && bdaddr_type == BDADDR_BREDR &&\n\t\t\t\tdev->le && !dev->le_state.connected) {\n\t\t\terr = device_connect_le(dev);\n\t\t\tif (err == 0)\n\t\t\t\tgoto done;\n\t\t}\n\t\treply = btd_error_failed(req->msg, strerror(-err));\n\t\tgoto done;\n\t}\n\n\t/* if successfully resolved services we need to free browsing request\n\t * before passing message back to connect functions, otherwise\n\t * device->browse is set and \"InProgress\" error is returned instead\n\t * of actually connecting services\n\t */\n\tmsg = dbus_message_ref(req->msg);\n\tbrowse_request_free(req);\n\treq = NULL;\n\n\tif (dbus_message_is_method_call(msg, DEVICE_INTERFACE, \"Connect\"))\n\t\treply = dev_connect(dbus_conn, msg, dev);\n\telse if (dbus_message_is_method_call(msg, DEVICE_INTERFACE,\n\t\t\t\t\t\t\t\"ConnectProfile\"))\n\t\treply = connect_profile(dbus_conn, msg, dev);\n\telse\n\t\treply = g_dbus_create_reply(msg, DBUS_TYPE_INVALID);\n\n\tdbus_message_unref(msg);\n\ndone:\n\tif (reply)\n\t\tg_dbus_send_message(dbus_conn, reply);\n\n\tif (req)\n\t\tbrowse_request_free(req);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *dbus_conn = NULL;",
            "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
            "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);",
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void browse_request_complete(struct browse_req *req, uint8_t type,\n\t\t\t\t\t\tuint8_t bdaddr_type, int err)\n{\n\tstruct btd_device *dev = req->device;\n\tDBusMessage *reply = NULL;\n\tDBusMessage *msg;\n\n\tif (req->type != type)\n\t\treturn;\n\n\tif (!req->msg)\n\t\tgoto done;\n\n\tif (dbus_message_is_method_call(req->msg, DEVICE_INTERFACE, \"Pair\")) {\n\t\tif (!device_is_paired(dev, bdaddr_type)) {\n\t\t\treply = btd_error_failed(req->msg, \"Not paired\");\n\t\t\tgoto done;\n\t\t}\n\n\t\tif (dev->pending_paired) {\n\t\t\tg_dbus_emit_property_changed(dbus_conn, dev->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"Paired\");\n\t\t\tdev->pending_paired = false;\n\t\t}\n\n\t\t/* Disregard browse errors in case of Pair */\n\t\treply = g_dbus_create_reply(req->msg, DBUS_TYPE_INVALID);\n\t\tgoto done;\n\t}\n\n\tif (err) {\n\t\t/* Fallback to LE bearer if supported */\n\t\tif (err == -EHOSTDOWN && bdaddr_type == BDADDR_BREDR &&\n\t\t\t\tdev->le && !dev->le_state.connected) {\n\t\t\terr = device_connect_le(dev);\n\t\t\tif (err == 0)\n\t\t\t\tgoto done;\n\t\t}\n\t\treply = btd_error_failed(req->msg, strerror(-err));\n\t\tgoto done;\n\t}\n\n\t/* if successfully resolved services we need to free browsing request\n\t * before passing message back to connect functions, otherwise\n\t * device->browse is set and \"InProgress\" error is returned instead\n\t * of actually connecting services\n\t */\n\tmsg = dbus_message_ref(req->msg);\n\tbrowse_request_free(req);\n\treq = NULL;\n\n\tif (dbus_message_is_method_call(msg, DEVICE_INTERFACE, \"Connect\"))\n\t\treply = dev_connect(dbus_conn, msg, dev);\n\telse if (dbus_message_is_method_call(msg, DEVICE_INTERFACE,\n\t\t\t\t\t\t\t\"ConnectProfile\"))\n\t\treply = connect_profile(dbus_conn, msg, dev);\n\telse\n\t\treply = g_dbus_create_reply(msg, DBUS_TYPE_INVALID);\n\n\tdbus_message_unref(msg);\n\ndone:\n\tif (reply)\n\t\tg_dbus_send_message(dbus_conn, reply);\n\n\tif (req)\n\t\tbrowse_request_free(req);\n}"
        }
      },
      {
        "call_info": {
          "callee": "store_services",
          "args": [
            "dev"
          ],
          "line": 2408
        },
        "resolved": true,
        "details": {
          "function_name": "store_services",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "2064-2134",
          "snippet": "static void store_services(struct btd_device *device)\n{\n\tchar filename[PATH_MAX];\n\tchar dst_addr[18];\n\tuuid_t uuid;\n\tchar *prim_uuid;\n\tGKeyFile *key_file;\n\tGSList *l;\n\tchar *data;\n\tgsize length = 0;\n\n\tif (device_address_is_private(device)) {\n\t\tDBG(\"Can't store services for private addressed device %s\",\n\t\t\t\t\t\t\t\tdevice->path);\n\t\treturn;\n\t}\n\n\tsdp_uuid16_create(&uuid, GATT_PRIM_SVC_UUID);\n\tprim_uuid = bt_uuid2string(&uuid);\n\tif (prim_uuid == NULL)\n\t\treturn;\n\n\tba2str(&device->bdaddr, dst_addr);\n\n\tsnprintf(filename, PATH_MAX, STORAGEDIR \"/%s/%s/attributes\",\n\t\t\t\tbtd_adapter_get_storage_dir(device->adapter),\n\t\t\t\tdst_addr);\n\tkey_file = g_key_file_new();\n\n\tfor (l = device->primaries; l; l = l->next) {\n\t\tstruct gatt_primary *primary = l->data;\n\t\tchar handle[6], uuid_str[33];\n\t\tint i;\n\n\t\tsprintf(handle, \"%hu\", primary->range.start);\n\n\t\tbt_string2uuid(&uuid, primary->uuid);\n\t\tsdp_uuid128_to_uuid(&uuid);\n\n\t\tswitch (uuid.type) {\n\t\tcase SDP_UUID16:\n\t\t\tsprintf(uuid_str, \"%4.4X\", uuid.value.uuid16);\n\t\t\tbreak;\n\t\tcase SDP_UUID32:\n\t\t\tsprintf(uuid_str, \"%8.8X\", uuid.value.uuid32);\n\t\t\tbreak;\n\t\tcase SDP_UUID128:\n\t\t\tfor (i = 0; i < 16; i++)\n\t\t\t\tsprintf(uuid_str + (i * 2), \"%2.2X\",\n\t\t\t\t\t\tuuid.value.uuid128.data[i]);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tuuid_str[0] = '\\0';\n\t\t}\n\n\t\tg_key_file_set_string(key_file, handle, \"UUID\", prim_uuid);\n\t\tg_key_file_set_string(key_file, handle, \"Value\", uuid_str);\n\t\tg_key_file_set_integer(key_file, handle, \"EndGroupHandle\",\n\t\t\t\t\tprimary->range.end);\n\t}\n\n\tdata = g_key_file_to_data(key_file, &length, NULL);\n\tif (length > 0) {\n\t\tcreate_file(filename, S_IRUSR | S_IWUSR);\n\t\tg_file_set_contents(filename, data, length, NULL);\n\t}\n\n\tfree(prim_uuid);\n\tg_free(data);\n\tg_key_file_free(key_file);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void store_services(struct btd_device *device)\n{\n\tchar filename[PATH_MAX];\n\tchar dst_addr[18];\n\tuuid_t uuid;\n\tchar *prim_uuid;\n\tGKeyFile *key_file;\n\tGSList *l;\n\tchar *data;\n\tgsize length = 0;\n\n\tif (device_address_is_private(device)) {\n\t\tDBG(\"Can't store services for private addressed device %s\",\n\t\t\t\t\t\t\t\tdevice->path);\n\t\treturn;\n\t}\n\n\tsdp_uuid16_create(&uuid, GATT_PRIM_SVC_UUID);\n\tprim_uuid = bt_uuid2string(&uuid);\n\tif (prim_uuid == NULL)\n\t\treturn;\n\n\tba2str(&device->bdaddr, dst_addr);\n\n\tsnprintf(filename, PATH_MAX, STORAGEDIR \"/%s/%s/attributes\",\n\t\t\t\tbtd_adapter_get_storage_dir(device->adapter),\n\t\t\t\tdst_addr);\n\tkey_file = g_key_file_new();\n\n\tfor (l = device->primaries; l; l = l->next) {\n\t\tstruct gatt_primary *primary = l->data;\n\t\tchar handle[6], uuid_str[33];\n\t\tint i;\n\n\t\tsprintf(handle, \"%hu\", primary->range.start);\n\n\t\tbt_string2uuid(&uuid, primary->uuid);\n\t\tsdp_uuid128_to_uuid(&uuid);\n\n\t\tswitch (uuid.type) {\n\t\tcase SDP_UUID16:\n\t\t\tsprintf(uuid_str, \"%4.4X\", uuid.value.uuid16);\n\t\t\tbreak;\n\t\tcase SDP_UUID32:\n\t\t\tsprintf(uuid_str, \"%8.8X\", uuid.value.uuid32);\n\t\t\tbreak;\n\t\tcase SDP_UUID128:\n\t\t\tfor (i = 0; i < 16; i++)\n\t\t\t\tsprintf(uuid_str + (i * 2), \"%2.2X\",\n\t\t\t\t\t\tuuid.value.uuid128.data[i]);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tuuid_str[0] = '\\0';\n\t\t}\n\n\t\tg_key_file_set_string(key_file, handle, \"UUID\", prim_uuid);\n\t\tg_key_file_set_string(key_file, handle, \"Value\", uuid_str);\n\t\tg_key_file_set_integer(key_file, handle, \"EndGroupHandle\",\n\t\t\t\t\tprimary->range.end);\n\t}\n\n\tdata = g_key_file_to_data(key_file, &length, NULL);\n\tif (length > 0) {\n\t\tcreate_file(filename, S_IRUSR | S_IWUSR);\n\t\tg_file_set_contents(filename, data, length, NULL);\n\t}\n\n\tfree(prim_uuid);\n\tg_free(data);\n\tg_key_file_free(key_file);\n}"
        }
      },
      {
        "call_info": {
          "callee": "store_device_info",
          "args": [
            "dev"
          ],
          "line": 2405
        },
        "resolved": true,
        "details": {
          "function_name": "store_device_info",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "475-487",
          "snippet": "static void store_device_info(struct btd_device *device)\n{\n\tif (device->temporary || device->store_id > 0)\n\t\treturn;\n\n\tif (device_address_is_private(device)) {\n\t\tDBG(\"Can't store info for private addressed device %s\",\n\t\t\t\t\t\t\t\tdevice->path);\n\t\treturn;\n\t}\n\n\tdevice->store_id = g_idle_add(store_device_info_cb, device);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void store_device_info(struct btd_device *device)\n{\n\tif (device->temporary || device->store_id > 0)\n\t\treturn;\n\n\tif (device_address_is_private(device)) {\n\t\tDBG(\"Can't store info for private addressed device %s\",\n\t\t\t\t\t\t\t\tdevice->path);\n\t\treturn;\n\t}\n\n\tdevice->store_id = g_idle_add(store_device_info_cb, device);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_emit_property_changed",
          "args": [
            "dbus_conn",
            "dev->path",
            "DEVICE_INTERFACE",
            "\"Paired\""
          ],
          "line": 2399
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_free_full",
          "args": [
            "dev->eir_uuids",
            "g_free"
          ],
          "line": 2395
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device_set_svc_refreshed",
          "args": [
            "dev",
            "true"
          ],
          "line": 2393
        },
        "resolved": true,
        "details": {
          "function_name": "device_set_svc_refreshed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "2367-2376",
          "snippet": "static void device_set_svc_refreshed(struct btd_device *device, bool value)\n{\n\tif (device->svc_refreshed == value)\n\t\treturn;\n\n\tdevice->svc_refreshed = value;\n\n\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\tDEVICE_INTERFACE, \"ServicesResolved\");\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *dbus_conn = NULL;",
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void device_set_svc_refreshed(struct btd_device *device, bool value)\n{\n\tif (device->svc_refreshed == value)\n\t\treturn;\n\n\tdevice->svc_refreshed = value;\n\n\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\tDEVICE_INTERFACE, \"ServicesResolved\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"%s err %d\"",
            "dev->path",
            "err"
          ],
          "line": 2384
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_state",
          "args": [
            "dev",
            "bdaddr_type"
          ],
          "line": 2381
        },
        "resolved": true,
        "details": {
          "function_name": "get_state",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "275-282",
          "snippet": "static struct bearer_state *get_state(struct btd_device *dev,\n\t\t\t\t\t\t\tuint8_t bdaddr_type)\n{\n\tif (bdaddr_type == BDADDR_BREDR)\n\t\treturn &dev->bredr_state;\n\telse\n\t\treturn &dev->le_state;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic struct bearer_state *get_state(struct btd_device *dev,\n\t\t\t\t\t\t\tuint8_t bdaddr_type)\n{\n\tif (bdaddr_type == BDADDR_BREDR)\n\t\treturn &dev->bredr_state;\n\telse\n\t\treturn &dev->le_state;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void device_svc_resolved(struct btd_device *dev, uint8_t browse_type,\n\t\t\t\t\t\tuint8_t bdaddr_type, int err)\n{\n\tstruct bearer_state *state = get_state(dev, bdaddr_type);\n\tstruct browse_req *req = dev->browse;\n\n\tDBG(\"%s err %d\", dev->path, err);\n\n\tstate->svc_resolved = true;\n\n\t/* Disconnection notification can happen before this function\n\t * gets called, so don't set svc_refreshed for a disconnected\n\t * device.\n\t */\n\tif (state->connected)\n\t\tdevice_set_svc_refreshed(dev, true);\n\n\tg_slist_free_full(dev->eir_uuids, g_free);\n\tdev->eir_uuids = NULL;\n\n\tif (dev->pending_paired) {\n\t\tg_dbus_emit_property_changed(dbus_conn, dev->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"Paired\");\n\t\tdev->pending_paired = false;\n\t}\n\n\tif (!dev->temporary) {\n\t\tstore_device_info(dev);\n\n\t\tif (bdaddr_type != BDADDR_BREDR && err == 0)\n\t\t\tstore_services(dev);\n\t}\n\n\tif (req)\n\t\tbrowse_request_complete(req, browse_type, bdaddr_type, err);\n\n\twhile (dev->svc_callbacks) {\n\t\tstruct svc_callback *cb = dev->svc_callbacks->data;\n\n\t\tif (cb->idle_id > 0)\n\t\t\tg_source_remove(cb->idle_id);\n\n\t\tcb->func(dev, err, cb->user_data);\n\n\t\tdev->svc_callbacks = g_slist_delete_link(dev->svc_callbacks,\n\t\t\t\t\t\t\tdev->svc_callbacks);\n\t\tg_free(cb);\n\t}\n}"
  },
  {
    "function_name": "device_set_svc_refreshed",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "2367-2376",
    "snippet": "static void device_set_svc_refreshed(struct btd_device *device, bool value)\n{\n\tif (device->svc_refreshed == value)\n\t\treturn;\n\n\tdevice->svc_refreshed = value;\n\n\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\tDEVICE_INTERFACE, \"ServicesResolved\");\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static DBusConnection *dbus_conn = NULL;",
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_dbus_emit_property_changed",
          "args": [
            "dbus_conn",
            "device->path",
            "DEVICE_INTERFACE",
            "\"ServicesResolved\""
          ],
          "line": 2374
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void device_set_svc_refreshed(struct btd_device *device, bool value)\n{\n\tif (device->svc_refreshed == value)\n\t\treturn;\n\n\tdevice->svc_refreshed = value;\n\n\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\tDEVICE_INTERFACE, \"ServicesResolved\");\n}"
  },
  {
    "function_name": "browse_request_complete",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "2298-2365",
    "snippet": "static void browse_request_complete(struct browse_req *req, uint8_t type,\n\t\t\t\t\t\tuint8_t bdaddr_type, int err)\n{\n\tstruct btd_device *dev = req->device;\n\tDBusMessage *reply = NULL;\n\tDBusMessage *msg;\n\n\tif (req->type != type)\n\t\treturn;\n\n\tif (!req->msg)\n\t\tgoto done;\n\n\tif (dbus_message_is_method_call(req->msg, DEVICE_INTERFACE, \"Pair\")) {\n\t\tif (!device_is_paired(dev, bdaddr_type)) {\n\t\t\treply = btd_error_failed(req->msg, \"Not paired\");\n\t\t\tgoto done;\n\t\t}\n\n\t\tif (dev->pending_paired) {\n\t\t\tg_dbus_emit_property_changed(dbus_conn, dev->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"Paired\");\n\t\t\tdev->pending_paired = false;\n\t\t}\n\n\t\t/* Disregard browse errors in case of Pair */\n\t\treply = g_dbus_create_reply(req->msg, DBUS_TYPE_INVALID);\n\t\tgoto done;\n\t}\n\n\tif (err) {\n\t\t/* Fallback to LE bearer if supported */\n\t\tif (err == -EHOSTDOWN && bdaddr_type == BDADDR_BREDR &&\n\t\t\t\tdev->le && !dev->le_state.connected) {\n\t\t\terr = device_connect_le(dev);\n\t\t\tif (err == 0)\n\t\t\t\tgoto done;\n\t\t}\n\t\treply = btd_error_failed(req->msg, strerror(-err));\n\t\tgoto done;\n\t}\n\n\t/* if successfully resolved services we need to free browsing request\n\t * before passing message back to connect functions, otherwise\n\t * device->browse is set and \"InProgress\" error is returned instead\n\t * of actually connecting services\n\t */\n\tmsg = dbus_message_ref(req->msg);\n\tbrowse_request_free(req);\n\treq = NULL;\n\n\tif (dbus_message_is_method_call(msg, DEVICE_INTERFACE, \"Connect\"))\n\t\treply = dev_connect(dbus_conn, msg, dev);\n\telse if (dbus_message_is_method_call(msg, DEVICE_INTERFACE,\n\t\t\t\t\t\t\t\"ConnectProfile\"))\n\t\treply = connect_profile(dbus_conn, msg, dev);\n\telse\n\t\treply = g_dbus_create_reply(msg, DBUS_TYPE_INVALID);\n\n\tdbus_message_unref(msg);\n\ndone:\n\tif (reply)\n\t\tg_dbus_send_message(dbus_conn, reply);\n\n\tif (req)\n\t\tbrowse_request_free(req);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static DBusConnection *dbus_conn = NULL;",
      "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
      "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);",
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "browse_request_free",
          "args": [
            "req"
          ],
          "line": 2364
        },
        "resolved": true,
        "details": {
          "function_name": "browse_request_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "519-535",
          "snippet": "static void browse_request_free(struct browse_req *req)\n{\n\tstruct btd_device *device = req->device;\n\n\tif (device->browse == req)\n\t\tdevice->browse = NULL;\n\n\tif (req->listener_id)\n\t\tg_dbus_remove_watch(dbus_conn, req->listener_id);\n\tif (req->msg)\n\t\tdbus_message_unref(req->msg);\n\tg_slist_free_full(req->profiles_added, g_free);\n\tif (req->records)\n\t\tsdp_list_free(req->records, (sdp_free_func_t) sdp_record_free);\n\n\tg_free(req);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *dbus_conn = NULL;",
            "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
            "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);",
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void browse_request_free(struct browse_req *req)\n{\n\tstruct btd_device *device = req->device;\n\n\tif (device->browse == req)\n\t\tdevice->browse = NULL;\n\n\tif (req->listener_id)\n\t\tg_dbus_remove_watch(dbus_conn, req->listener_id);\n\tif (req->msg)\n\t\tdbus_message_unref(req->msg);\n\tg_slist_free_full(req->profiles_added, g_free);\n\tif (req->records)\n\t\tsdp_list_free(req->records, (sdp_free_func_t) sdp_record_free);\n\n\tg_free(req);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_send_message",
          "args": [
            "dbus_conn",
            "reply"
          ],
          "line": 2361
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_unref",
          "args": [
            "msg"
          ],
          "line": 2357
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_create_reply",
          "args": [
            "msg",
            "DBUS_TYPE_INVALID"
          ],
          "line": 2355
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "connect_profile",
          "args": [
            "dbus_conn",
            "msg",
            "dev"
          ],
          "line": 2353
        },
        "resolved": true,
        "details": {
          "function_name": "disconnect_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "2023-2062",
          "snippet": "static DBusMessage *disconnect_profile(DBusConnection *conn, DBusMessage *msg,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct btd_device *dev = user_data;\n\tstruct btd_service *service;\n\tconst char *pattern;\n\tchar *uuid;\n\tint err;\n\n\tif (!dbus_message_get_args(msg, NULL, DBUS_TYPE_STRING, &pattern,\n\t\t\t\t\t\t\tDBUS_TYPE_INVALID))\n\t\treturn btd_error_invalid_args(msg);\n\n\tuuid = bt_name2string(pattern);\n\tif (uuid == NULL)\n\t\treturn btd_error_invalid_args(msg);\n\n\tservice = find_connectable_service(dev, uuid);\n\tfree(uuid);\n\n\tif (!service)\n\t\treturn btd_error_invalid_args(msg);\n\n\tif (dev->disconnect)\n\t\treturn btd_error_in_progress(msg);\n\n\tdev->disconnect = dbus_message_ref(msg);\n\n\terr = btd_service_disconnect(service);\n\tif (err == 0)\n\t\treturn NULL;\n\n\tdbus_message_unref(dev->disconnect);\n\tdev->disconnect = NULL;\n\n\tif (err == -ENOTSUP)\n\t\treturn btd_error_not_supported(msg);\n\n\treturn btd_error_failed(msg, strerror(-err));\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
            "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\n\nstatic DBusMessage *disconnect_profile(DBusConnection *conn, DBusMessage *msg,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct btd_device *dev = user_data;\n\tstruct btd_service *service;\n\tconst char *pattern;\n\tchar *uuid;\n\tint err;\n\n\tif (!dbus_message_get_args(msg, NULL, DBUS_TYPE_STRING, &pattern,\n\t\t\t\t\t\t\tDBUS_TYPE_INVALID))\n\t\treturn btd_error_invalid_args(msg);\n\n\tuuid = bt_name2string(pattern);\n\tif (uuid == NULL)\n\t\treturn btd_error_invalid_args(msg);\n\n\tservice = find_connectable_service(dev, uuid);\n\tfree(uuid);\n\n\tif (!service)\n\t\treturn btd_error_invalid_args(msg);\n\n\tif (dev->disconnect)\n\t\treturn btd_error_in_progress(msg);\n\n\tdev->disconnect = dbus_message_ref(msg);\n\n\terr = btd_service_disconnect(service);\n\tif (err == 0)\n\t\treturn NULL;\n\n\tdbus_message_unref(dev->disconnect);\n\tdev->disconnect = NULL;\n\n\tif (err == -ENOTSUP)\n\t\treturn btd_error_not_supported(msg);\n\n\treturn btd_error_failed(msg, strerror(-err));\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_is_method_call",
          "args": [
            "msg",
            "DEVICE_INTERFACE",
            "\"ConnectProfile\""
          ],
          "line": 2351
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dev_connect",
          "args": [
            "dbus_conn",
            "msg",
            "dev"
          ],
          "line": 2350
        },
        "resolved": true,
        "details": {
          "function_name": "dev_connect",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "1939-1984",
          "snippet": "static DBusMessage *dev_connect(DBusConnection *conn, DBusMessage *msg,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct btd_device *dev = user_data;\n\tuint8_t bdaddr_type;\n\n\tif (dev->bredr_state.connected) {\n\t\t/*\n\t\t * Check if services have been resolved and there is at list\n\t\t * one connected before switching to connect LE.\n\t\t */\n\t\tif (dev->bredr_state.svc_resolved &&\n\t\t\tfind_service_with_state(dev->services,\n\t\t\t\t\t\tBTD_SERVICE_STATE_CONNECTED))\n\t\t\tbdaddr_type = dev->bdaddr_type;\n\t\telse\n\t\t\tbdaddr_type = BDADDR_BREDR;\n\t} else if (dev->le_state.connected && dev->bredr)\n\t\tbdaddr_type = BDADDR_BREDR;\n\telse\n\t\tbdaddr_type = select_conn_bearer(dev);\n\n\tif (bdaddr_type != BDADDR_BREDR) {\n\t\tint err;\n\n\t\tif (dev->le_state.connected)\n\t\t\treturn dbus_message_new_method_return(msg);\n\n\t\tbtd_device_set_temporary(dev, false);\n\n\t\tif (dev->disable_auto_connect) {\n\t\t\tdev->disable_auto_connect = FALSE;\n\t\t\tdevice_set_auto_connect(dev, TRUE);\n\t\t}\n\n\t\terr = device_connect_le(dev);\n\t\tif (err < 0)\n\t\t\treturn btd_error_failed(msg, strerror(-err));\n\n\t\tdev->connect = dbus_message_ref(msg);\n\n\t\treturn NULL;\n\t}\n\n\treturn connect_profiles(dev, bdaddr_type, msg, NULL);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
            "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\n\nstatic DBusMessage *dev_connect(DBusConnection *conn, DBusMessage *msg,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct btd_device *dev = user_data;\n\tuint8_t bdaddr_type;\n\n\tif (dev->bredr_state.connected) {\n\t\t/*\n\t\t * Check if services have been resolved and there is at list\n\t\t * one connected before switching to connect LE.\n\t\t */\n\t\tif (dev->bredr_state.svc_resolved &&\n\t\t\tfind_service_with_state(dev->services,\n\t\t\t\t\t\tBTD_SERVICE_STATE_CONNECTED))\n\t\t\tbdaddr_type = dev->bdaddr_type;\n\t\telse\n\t\t\tbdaddr_type = BDADDR_BREDR;\n\t} else if (dev->le_state.connected && dev->bredr)\n\t\tbdaddr_type = BDADDR_BREDR;\n\telse\n\t\tbdaddr_type = select_conn_bearer(dev);\n\n\tif (bdaddr_type != BDADDR_BREDR) {\n\t\tint err;\n\n\t\tif (dev->le_state.connected)\n\t\t\treturn dbus_message_new_method_return(msg);\n\n\t\tbtd_device_set_temporary(dev, false);\n\n\t\tif (dev->disable_auto_connect) {\n\t\t\tdev->disable_auto_connect = FALSE;\n\t\t\tdevice_set_auto_connect(dev, TRUE);\n\t\t}\n\n\t\terr = device_connect_le(dev);\n\t\tif (err < 0)\n\t\t\treturn btd_error_failed(msg, strerror(-err));\n\n\t\tdev->connect = dbus_message_ref(msg);\n\n\t\treturn NULL;\n\t}\n\n\treturn connect_profiles(dev, bdaddr_type, msg, NULL);\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_is_method_call",
          "args": [
            "msg",
            "DEVICE_INTERFACE",
            "\"Connect\""
          ],
          "line": 2349
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_ref",
          "args": [
            "req->msg"
          ],
          "line": 2345
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_error_failed",
          "args": [
            "req->msg",
            "strerror(-err)"
          ],
          "line": 2336
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "124-128",
          "snippet": "DBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "strerror",
          "args": [
            "-err"
          ],
          "line": 2336
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device_connect_le",
          "args": [
            "dev"
          ],
          "line": 2332
        },
        "resolved": true,
        "details": {
          "function_name": "device_connect_le",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5103-5158",
          "snippet": "int device_connect_le(struct btd_device *dev)\n{\n\tstruct btd_adapter *adapter = dev->adapter;\n\tBtIOSecLevel sec_level;\n\tGIOChannel *io;\n\tGError *gerr = NULL;\n\tchar addr[18];\n\n\t/* There is one connection attempt going on */\n\tif (dev->att_io)\n\t\treturn -EALREADY;\n\n\tba2str(&dev->bdaddr, addr);\n\n\tDBG(\"Connection attempt to: %s\", addr);\n\n\tif (dev->le_state.paired)\n\t\tsec_level = BT_IO_SEC_MEDIUM;\n\telse\n\t\tsec_level = BT_IO_SEC_LOW;\n\n\t/*\n\t * This connection will help us catch any PDUs that comes before\n\t * pairing finishes\n\t */\n\tio = bt_io_connect(att_connect_cb, dev, NULL, &gerr,\n\t\t\tBT_IO_OPT_SOURCE_BDADDR,\n\t\t\tbtd_adapter_get_address(adapter),\n\t\t\tBT_IO_OPT_SOURCE_TYPE,\n\t\t\tbtd_adapter_get_address_type(adapter),\n\t\t\tBT_IO_OPT_DEST_BDADDR, &dev->bdaddr,\n\t\t\tBT_IO_OPT_DEST_TYPE, dev->bdaddr_type,\n\t\t\tBT_IO_OPT_CID, ATT_CID,\n\t\t\tBT_IO_OPT_SEC_LEVEL, sec_level,\n\t\t\tBT_IO_OPT_INVALID);\n\n\tif (io == NULL) {\n\t\tif (dev->bonding) {\n\t\t\tDBusMessage *reply = btd_error_failed(\n\t\t\t\t\tdev->bonding->msg, gerr->message);\n\n\t\t\tg_dbus_send_message(dbus_conn, reply);\n\t\t\tbonding_request_cancel(dev->bonding);\n\t\t\tbonding_request_free(dev->bonding);\n\t\t}\n\n\t\terror(\"ATT bt_io_connect(%s): %s\", addr, gerr->message);\n\t\tg_error_free(gerr);\n\t\treturn -EIO;\n\t}\n\n\t/* Keep this, so we can cancel the connection */\n\tdev->att_io = io;\n\n\treturn 0;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *dbus_conn = NULL;",
            "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
            "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\n\nint device_connect_le(struct btd_device *dev)\n{\n\tstruct btd_adapter *adapter = dev->adapter;\n\tBtIOSecLevel sec_level;\n\tGIOChannel *io;\n\tGError *gerr = NULL;\n\tchar addr[18];\n\n\t/* There is one connection attempt going on */\n\tif (dev->att_io)\n\t\treturn -EALREADY;\n\n\tba2str(&dev->bdaddr, addr);\n\n\tDBG(\"Connection attempt to: %s\", addr);\n\n\tif (dev->le_state.paired)\n\t\tsec_level = BT_IO_SEC_MEDIUM;\n\telse\n\t\tsec_level = BT_IO_SEC_LOW;\n\n\t/*\n\t * This connection will help us catch any PDUs that comes before\n\t * pairing finishes\n\t */\n\tio = bt_io_connect(att_connect_cb, dev, NULL, &gerr,\n\t\t\tBT_IO_OPT_SOURCE_BDADDR,\n\t\t\tbtd_adapter_get_address(adapter),\n\t\t\tBT_IO_OPT_SOURCE_TYPE,\n\t\t\tbtd_adapter_get_address_type(adapter),\n\t\t\tBT_IO_OPT_DEST_BDADDR, &dev->bdaddr,\n\t\t\tBT_IO_OPT_DEST_TYPE, dev->bdaddr_type,\n\t\t\tBT_IO_OPT_CID, ATT_CID,\n\t\t\tBT_IO_OPT_SEC_LEVEL, sec_level,\n\t\t\tBT_IO_OPT_INVALID);\n\n\tif (io == NULL) {\n\t\tif (dev->bonding) {\n\t\t\tDBusMessage *reply = btd_error_failed(\n\t\t\t\t\tdev->bonding->msg, gerr->message);\n\n\t\t\tg_dbus_send_message(dbus_conn, reply);\n\t\t\tbonding_request_cancel(dev->bonding);\n\t\t\tbonding_request_free(dev->bonding);\n\t\t}\n\n\t\terror(\"ATT bt_io_connect(%s): %s\", addr, gerr->message);\n\t\tg_error_free(gerr);\n\t\treturn -EIO;\n\t}\n\n\t/* Keep this, so we can cancel the connection */\n\tdev->att_io = io;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_create_reply",
          "args": [
            "req->msg",
            "DBUS_TYPE_INVALID"
          ],
          "line": 2324
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_emit_property_changed",
          "args": [
            "dbus_conn",
            "dev->path",
            "DEVICE_INTERFACE",
            "\"Paired\""
          ],
          "line": 2318
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device_is_paired",
          "args": [
            "dev",
            "bdaddr_type"
          ],
          "line": 2312
        },
        "resolved": true,
        "details": {
          "function_name": "device_is_paired",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "696-701",
          "snippet": "bool device_is_paired(struct btd_device *device, uint8_t bdaddr_type)\n{\n\tstruct bearer_state *state = get_state(device, bdaddr_type);\n\n\treturn state->paired;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nbool device_is_paired(struct btd_device *device, uint8_t bdaddr_type)\n{\n\tstruct bearer_state *state = get_state(device, bdaddr_type);\n\n\treturn state->paired;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_is_method_call",
          "args": [
            "req->msg",
            "DEVICE_INTERFACE",
            "\"Pair\""
          ],
          "line": 2311
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void browse_request_complete(struct browse_req *req, uint8_t type,\n\t\t\t\t\t\tuint8_t bdaddr_type, int err)\n{\n\tstruct btd_device *dev = req->device;\n\tDBusMessage *reply = NULL;\n\tDBusMessage *msg;\n\n\tif (req->type != type)\n\t\treturn;\n\n\tif (!req->msg)\n\t\tgoto done;\n\n\tif (dbus_message_is_method_call(req->msg, DEVICE_INTERFACE, \"Pair\")) {\n\t\tif (!device_is_paired(dev, bdaddr_type)) {\n\t\t\treply = btd_error_failed(req->msg, \"Not paired\");\n\t\t\tgoto done;\n\t\t}\n\n\t\tif (dev->pending_paired) {\n\t\t\tg_dbus_emit_property_changed(dbus_conn, dev->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"Paired\");\n\t\t\tdev->pending_paired = false;\n\t\t}\n\n\t\t/* Disregard browse errors in case of Pair */\n\t\treply = g_dbus_create_reply(req->msg, DBUS_TYPE_INVALID);\n\t\tgoto done;\n\t}\n\n\tif (err) {\n\t\t/* Fallback to LE bearer if supported */\n\t\tif (err == -EHOSTDOWN && bdaddr_type == BDADDR_BREDR &&\n\t\t\t\tdev->le && !dev->le_state.connected) {\n\t\t\terr = device_connect_le(dev);\n\t\t\tif (err == 0)\n\t\t\t\tgoto done;\n\t\t}\n\t\treply = btd_error_failed(req->msg, strerror(-err));\n\t\tgoto done;\n\t}\n\n\t/* if successfully resolved services we need to free browsing request\n\t * before passing message back to connect functions, otherwise\n\t * device->browse is set and \"InProgress\" error is returned instead\n\t * of actually connecting services\n\t */\n\tmsg = dbus_message_ref(req->msg);\n\tbrowse_request_free(req);\n\treq = NULL;\n\n\tif (dbus_message_is_method_call(msg, DEVICE_INTERFACE, \"Connect\"))\n\t\treply = dev_connect(dbus_conn, msg, dev);\n\telse if (dbus_message_is_method_call(msg, DEVICE_INTERFACE,\n\t\t\t\t\t\t\t\"ConnectProfile\"))\n\t\treply = connect_profile(dbus_conn, msg, dev);\n\telse\n\t\treply = g_dbus_create_reply(msg, DBUS_TYPE_INVALID);\n\n\tdbus_message_unref(msg);\n\ndone:\n\tif (reply)\n\t\tg_dbus_send_message(dbus_conn, reply);\n\n\tif (req)\n\t\tbrowse_request_free(req);\n}"
  },
  {
    "function_name": "store_gatt_db",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "2254-2295",
    "snippet": "static void store_gatt_db(struct btd_device *device)\n{\n\tchar filename[PATH_MAX];\n\tchar dst_addr[18];\n\tGKeyFile *key_file;\n\tchar *data;\n\tgsize length = 0;\n\tstruct gatt_saver saver;\n\n\tif (device_address_is_private(device)) {\n\t\tDBG(\"Can't store GATT db for private addressed device %s\",\n\t\t\t\t\t\t\t\tdevice->path);\n\t\treturn;\n\t}\n\n\tif (!gatt_cache_is_enabled(device))\n\t\treturn;\n\n\tba2str(&device->bdaddr, dst_addr);\n\n\tsnprintf(filename, PATH_MAX, STORAGEDIR \"/%s/cache/%s\",\n\t\t\t\tbtd_adapter_get_storage_dir(device->adapter),\n\t\t\t\tdst_addr);\n\tcreate_file(filename, S_IRUSR | S_IWUSR);\n\n\tkey_file = g_key_file_new();\n\tg_key_file_load_from_file(key_file, filename, 0, NULL);\n\n\t/* Remove current attributes since it might have changed */\n\tg_key_file_remove_group(key_file, \"Attributes\", NULL);\n\n\tsaver.key_file = key_file;\n\tsaver.device = device;\n\n\tgatt_db_foreach_service(device->db, NULL, store_service, &saver);\n\n\tdata = g_key_file_to_data(key_file, &length, NULL);\n\tg_file_set_contents(filename, data, length, NULL);\n\n\tg_free(data);\n\tg_key_file_free(key_file);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_key_file_free",
          "args": [
            "key_file"
          ],
          "line": 2294
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "data"
          ],
          "line": 2293
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_file_set_contents",
          "args": [
            "filename",
            "data",
            "length",
            "NULL"
          ],
          "line": 2291
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_to_data",
          "args": [
            "key_file",
            "&length",
            "NULL"
          ],
          "line": 2290
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gatt_db_foreach_service",
          "args": [
            "device->db",
            "NULL",
            "store_service",
            "&saver"
          ],
          "line": 2288
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_foreach_service",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1258-1264",
          "snippet": "void gatt_db_foreach_service(struct gatt_db *db, const bt_uuid_t *uuid,\n\t\t\t\t\t\tgatt_db_attribute_cb_t func,\n\t\t\t\t\t\tvoid *user_data)\n{\n\tgatt_db_foreach_service_in_range(db, uuid, func, user_data, 0x0001,\n\t\t\t\t\t\t\t\t\t0xffff);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nvoid gatt_db_foreach_service(struct gatt_db *db, const bt_uuid_t *uuid,\n\t\t\t\t\t\tgatt_db_attribute_cb_t func,\n\t\t\t\t\t\tvoid *user_data)\n{\n\tgatt_db_foreach_service_in_range(db, uuid, func, user_data, 0x0001,\n\t\t\t\t\t\t\t\t\t0xffff);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_key_file_remove_group",
          "args": [
            "key_file",
            "\"Attributes\"",
            "NULL"
          ],
          "line": 2283
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_load_from_file",
          "args": [
            "key_file",
            "filename",
            "0",
            "NULL"
          ],
          "line": 2280
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_new",
          "args": [],
          "line": 2279
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "create_file",
          "args": [
            "filename",
            "S_IRUSR | S_IWUSR"
          ],
          "line": 2277
        },
        "resolved": true,
        "details": {
          "function_name": "create_file",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/textfile.c",
          "lines": "76-89",
          "snippet": "int create_file(const char *filename, const mode_t mode)\n{\n\tint fd;\n\n\tcreate_dirs(filename, S_IRUSR | S_IWUSR | S_IXUSR);\n\n\tfd = open(filename, O_RDWR | O_CREAT, mode);\n\tif (fd < 0)\n\t\treturn fd;\n\n\tclose(fd);\n\n\treturn 0;\n}",
          "includes": [
            "#include \"textfile.h\"",
            "#include <sys/param.h>",
            "#include <sys/mman.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <ctype.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"textfile.h\"\n#include <sys/param.h>\n#include <sys/mman.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <ctype.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nint create_file(const char *filename, const mode_t mode)\n{\n\tint fd;\n\n\tcreate_dirs(filename, S_IRUSR | S_IWUSR | S_IXUSR);\n\n\tfd = open(filename, O_RDWR | O_CREAT, mode);\n\tif (fd < 0)\n\t\treturn fd;\n\n\tclose(fd);\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "filename",
            "PATH_MAX",
            "STORAGEDIR \"/%s/cache/%s\"",
            "btd_adapter_get_storage_dir(device->adapter)",
            "dst_addr"
          ],
          "line": 2274
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_adapter_get_storage_dir",
          "args": [
            "device->adapter"
          ],
          "line": 2275
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_get_storage_dir",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "438-450",
          "snippet": "const char *btd_adapter_get_storage_dir(struct btd_adapter *adapter)\n{\n\tstatic char dir[25];\n\n\tif (adapter->bdaddr_type == BDADDR_LE_RANDOM) {\n\t\tstrcpy(dir, \"static-\");\n\t\tba2str(&adapter->bdaddr, dir + 7);\n\t} else {\n\t\tba2str(&adapter->bdaddr, dir);\n\t}\n\n\treturn dir;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nconst char *btd_adapter_get_storage_dir(struct btd_adapter *adapter)\n{\n\tstatic char dir[25];\n\n\tif (adapter->bdaddr_type == BDADDR_LE_RANDOM) {\n\t\tstrcpy(dir, \"static-\");\n\t\tba2str(&adapter->bdaddr, dir + 7);\n\t} else {\n\t\tba2str(&adapter->bdaddr, dir);\n\t}\n\n\treturn dir;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ba2str",
          "args": [
            "&device->bdaddr",
            "dst_addr"
          ],
          "line": 2272
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gatt_cache_is_enabled",
          "args": [
            "device"
          ],
          "line": 2269
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_cache_is_enabled",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "537-548",
          "snippet": "static bool gatt_cache_is_enabled(struct btd_device *device)\n{\n\tswitch (main_opts.gatt_cache) {\n\tcase BT_GATT_CACHE_YES:\n\t\treturn device_is_paired(device, device->bdaddr_type);\n\tcase BT_GATT_CACHE_NO:\n\t\treturn false;\n\tcase BT_GATT_CACHE_ALWAYS:\n\tdefault:\n\t\treturn true;\n\t}\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic bool gatt_cache_is_enabled(struct btd_device *device)\n{\n\tswitch (main_opts.gatt_cache) {\n\tcase BT_GATT_CACHE_YES:\n\t\treturn device_is_paired(device, device->bdaddr_type);\n\tcase BT_GATT_CACHE_NO:\n\t\treturn false;\n\tcase BT_GATT_CACHE_ALWAYS:\n\tdefault:\n\t\treturn true;\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Can't store GATT db for private addressed device %s\"",
            "device->path"
          ],
          "line": 2264
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device_address_is_private",
          "args": [
            "device"
          ],
          "line": 2263
        },
        "resolved": true,
        "details": {
          "function_name": "device_address_is_private",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "461-473",
          "snippet": "static bool device_address_is_private(struct btd_device *dev)\n{\n\tif (dev->bdaddr_type != BDADDR_LE_RANDOM)\n\t\treturn false;\n\n\tswitch (dev->bdaddr.b[5] >> 6) {\n\tcase 0x00:\t/* Private non-resolvable */\n\tcase 0x01:\t/* Private resolvable */\n\t\treturn true;\n\tdefault:\n\t\treturn false;\n\t}\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic bool device_address_is_private(struct btd_device *dev)\n{\n\tif (dev->bdaddr_type != BDADDR_LE_RANDOM)\n\t\treturn false;\n\n\tswitch (dev->bdaddr.b[5] >> 6) {\n\tcase 0x00:\t/* Private non-resolvable */\n\tcase 0x01:\t/* Private resolvable */\n\t\treturn true;\n\tdefault:\n\t\treturn false;\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void store_gatt_db(struct btd_device *device)\n{\n\tchar filename[PATH_MAX];\n\tchar dst_addr[18];\n\tGKeyFile *key_file;\n\tchar *data;\n\tgsize length = 0;\n\tstruct gatt_saver saver;\n\n\tif (device_address_is_private(device)) {\n\t\tDBG(\"Can't store GATT db for private addressed device %s\",\n\t\t\t\t\t\t\t\tdevice->path);\n\t\treturn;\n\t}\n\n\tif (!gatt_cache_is_enabled(device))\n\t\treturn;\n\n\tba2str(&device->bdaddr, dst_addr);\n\n\tsnprintf(filename, PATH_MAX, STORAGEDIR \"/%s/cache/%s\",\n\t\t\t\tbtd_adapter_get_storage_dir(device->adapter),\n\t\t\t\tdst_addr);\n\tcreate_file(filename, S_IRUSR | S_IWUSR);\n\n\tkey_file = g_key_file_new();\n\tg_key_file_load_from_file(key_file, filename, 0, NULL);\n\n\t/* Remove current attributes since it might have changed */\n\tg_key_file_remove_group(key_file, \"Attributes\", NULL);\n\n\tsaver.key_file = key_file;\n\tsaver.device = device;\n\n\tgatt_db_foreach_service(device->db, NULL, store_service, &saver);\n\n\tdata = g_key_file_to_data(key_file, &length, NULL);\n\tg_file_set_contents(filename, data, length, NULL);\n\n\tg_free(data);\n\tg_key_file_free(key_file);\n}"
  },
  {
    "function_name": "store_service",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "2221-2252",
    "snippet": "static void store_service(struct gatt_db_attribute *attr, void *user_data)\n{\n\tstruct gatt_saver *saver = user_data;\n\tGKeyFile *key_file = saver->key_file;\n\tchar uuid_str[MAX_LEN_UUID_STR], handle[6], value[256];\n\tuint16_t start, end;\n\tbt_uuid_t uuid;\n\tbool primary;\n\tchar *type;\n\n\tif (!gatt_db_attribute_get_service_data(attr, &start, &end, &primary,\n\t\t\t\t\t\t\t\t&uuid)) {\n\t\twarn(\"Error storing service - can't get data\");\n\t\treturn;\n\t}\n\n\tsprintf(handle, \"%04hx\", start);\n\n\tbt_uuid_to_string(&uuid, uuid_str, sizeof(uuid_str));\n\n\tif (primary)\n\t\ttype = GATT_PRIM_SVC_UUID_STR;\n\telse\n\t\ttype = GATT_SND_SVC_UUID_STR;\n\n\tsprintf(value, \"%s:%04hx:%s\", type, end, uuid_str);\n\n\tg_key_file_set_string(key_file, \"Attributes\", handle, value);\n\n\tgatt_db_service_foreach_incl(attr, store_incl, saver);\n\tgatt_db_service_foreach_char(attr, store_chrc, saver);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define GATT_SND_SVC_UUID_STR  \"2801\"",
      "#define GATT_PRIM_SVC_UUID_STR \"2800\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "gatt_db_service_foreach_char",
          "args": [
            "attr",
            "store_chrc",
            "saver"
          ],
          "line": 2251
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_service_foreach_char",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1342-1347",
          "snippet": "void gatt_db_service_foreach_char(struct gatt_db_attribute *attrib,\n\t\t\t\t\t\tgatt_db_attribute_cb_t func,\n\t\t\t\t\t\tvoid *user_data)\n{\n\tgatt_db_service_foreach(attrib, &characteristic_uuid, func, user_data);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static const bt_uuid_t characteristic_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_CHARAC_UUID };"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic const bt_uuid_t characteristic_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_CHARAC_UUID };\n\nvoid gatt_db_service_foreach_char(struct gatt_db_attribute *attrib,\n\t\t\t\t\t\tgatt_db_attribute_cb_t func,\n\t\t\t\t\t\tvoid *user_data)\n{\n\tgatt_db_service_foreach(attrib, &characteristic_uuid, func, user_data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_service_foreach_incl",
          "args": [
            "attr",
            "store_incl",
            "saver"
          ],
          "line": 2250
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_service_foreach_incl",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1388-1394",
          "snippet": "void gatt_db_service_foreach_incl(struct gatt_db_attribute *attrib,\n\t\t\t\t\t\tgatt_db_attribute_cb_t func,\n\t\t\t\t\t\tvoid *user_data)\n{\n\tgatt_db_service_foreach(attrib, &included_service_uuid, func,\n\t\t\t\t\t\t\t\tuser_data);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static const bt_uuid_t included_service_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_INCLUDE_UUID };"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic const bt_uuid_t included_service_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_INCLUDE_UUID };\n\nvoid gatt_db_service_foreach_incl(struct gatt_db_attribute *attrib,\n\t\t\t\t\t\tgatt_db_attribute_cb_t func,\n\t\t\t\t\t\tvoid *user_data)\n{\n\tgatt_db_service_foreach(attrib, &included_service_uuid, func,\n\t\t\t\t\t\t\t\tuser_data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_key_file_set_string",
          "args": [
            "key_file",
            "\"Attributes\"",
            "handle",
            "value"
          ],
          "line": 2248
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            "value",
            "\"%s:%04hx:%s\"",
            "type",
            "end",
            "uuid_str"
          ],
          "line": 2246
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_uuid_to_string",
          "args": [
            "&uuid",
            "uuid_str",
            "sizeof(uuid_str)"
          ],
          "line": 2239
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            "handle",
            "\"%04hx\"",
            "start"
          ],
          "line": 2237
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "warn",
          "args": [
            "\"Error storing service - can't get data\""
          ],
          "line": 2233
        },
        "resolved": true,
        "details": {
          "function_name": "warn",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/log.c",
          "lines": "151-165",
          "snippet": "void warn(const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_WARNING, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(HCI_DEV_NONE, LOG_WARNING, format, ap);\n\tva_end(ap);\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdarg.h>",
            "#include <syslog.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int logging_fd = -1;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"src/shared/util.h\"\n#include \"lib/hci.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int logging_fd = -1;\n\nvoid warn(const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_WARNING, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(HCI_DEV_NONE, LOG_WARNING, format, ap);\n\tva_end(ap);\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_attribute_get_service_data",
          "args": [
            "attr",
            "&start",
            "&end",
            "&primary",
            "&uuid"
          ],
          "line": 2231
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_get_service_data",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1538-1566",
          "snippet": "bool gatt_db_attribute_get_service_data(const struct gatt_db_attribute *attrib,\n\t\t\t\t\t\t\tuint16_t *start_handle,\n\t\t\t\t\t\t\tuint16_t *end_handle,\n\t\t\t\t\t\t\tbool *primary,\n\t\t\t\t\t\t\tbt_uuid_t *uuid)\n{\n\tstruct gatt_db_service *service;\n\tstruct gatt_db_attribute *decl;\n\n\tif (!attrib)\n\t\treturn false;\n\n\tservice = attrib->service;\n\tdecl = service->attributes[0];\n\n\tgatt_db_service_get_handles(service, start_handle, end_handle);\n\n\tif (primary)\n\t\t*primary = bt_uuid_cmp(&decl->uuid, &secondary_service_uuid);\n\n\tif (!uuid)\n\t\treturn true;\n\n\t/*\n\t * The service declaration attribute value is the 16 or 128 bit service\n\t * UUID.\n\t */\n\treturn le_to_uuid(decl->value, decl->value_len, uuid);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static const bt_uuid_t secondary_service_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_SND_SVC_UUID };"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic const bt_uuid_t secondary_service_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_SND_SVC_UUID };\n\nbool gatt_db_attribute_get_service_data(const struct gatt_db_attribute *attrib,\n\t\t\t\t\t\t\tuint16_t *start_handle,\n\t\t\t\t\t\t\tuint16_t *end_handle,\n\t\t\t\t\t\t\tbool *primary,\n\t\t\t\t\t\t\tbt_uuid_t *uuid)\n{\n\tstruct gatt_db_service *service;\n\tstruct gatt_db_attribute *decl;\n\n\tif (!attrib)\n\t\treturn false;\n\n\tservice = attrib->service;\n\tdecl = service->attributes[0];\n\n\tgatt_db_service_get_handles(service, start_handle, end_handle);\n\n\tif (primary)\n\t\t*primary = bt_uuid_cmp(&decl->uuid, &secondary_service_uuid);\n\n\tif (!uuid)\n\t\treturn true;\n\n\t/*\n\t * The service declaration attribute value is the 16 or 128 bit service\n\t * UUID.\n\t */\n\treturn le_to_uuid(decl->value, decl->value_len, uuid);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\n#define GATT_SND_SVC_UUID_STR  \"2801\"\n#define GATT_PRIM_SVC_UUID_STR \"2800\"\n\nstatic void store_service(struct gatt_db_attribute *attr, void *user_data)\n{\n\tstruct gatt_saver *saver = user_data;\n\tGKeyFile *key_file = saver->key_file;\n\tchar uuid_str[MAX_LEN_UUID_STR], handle[6], value[256];\n\tuint16_t start, end;\n\tbt_uuid_t uuid;\n\tbool primary;\n\tchar *type;\n\n\tif (!gatt_db_attribute_get_service_data(attr, &start, &end, &primary,\n\t\t\t\t\t\t\t\t&uuid)) {\n\t\twarn(\"Error storing service - can't get data\");\n\t\treturn;\n\t}\n\n\tsprintf(handle, \"%04hx\", start);\n\n\tbt_uuid_to_string(&uuid, uuid_str, sizeof(uuid_str));\n\n\tif (primary)\n\t\ttype = GATT_PRIM_SVC_UUID_STR;\n\telse\n\t\ttype = GATT_SND_SVC_UUID_STR;\n\n\tsprintf(value, \"%s:%04hx:%s\", type, end, uuid_str);\n\n\tg_key_file_set_string(key_file, \"Attributes\", handle, value);\n\n\tgatt_db_service_foreach_incl(attr, store_incl, saver);\n\tgatt_db_service_foreach_char(attr, store_chrc, saver);\n}"
  },
  {
    "function_name": "store_incl",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "2191-2219",
    "snippet": "static void store_incl(struct gatt_db_attribute *attr, void *user_data)\n{\n\tstruct gatt_saver *saver = user_data;\n\tGKeyFile *key_file = saver->key_file;\n\tstruct gatt_db_attribute *service;\n\tchar handle[6], value[100], uuid_str[MAX_LEN_UUID_STR];\n\tuint16_t handle_num, start, end;\n\tbt_uuid_t uuid;\n\n\tif (!gatt_db_attribute_get_incl_data(attr, &handle_num, &start, &end)) {\n\t\twarn(\"Error storing included service - can't get data\");\n\t\treturn;\n\t}\n\n\tservice = gatt_db_get_attribute(saver->device->db, start);\n\tif (!service) {\n\t\twarn(\"Error storing included service - can't find it\");\n\t\treturn;\n\t}\n\n\tsprintf(handle, \"%04hx\", handle_num);\n\n\tgatt_db_attribute_get_service_uuid(service, &uuid);\n\tbt_uuid_to_string(&uuid, uuid_str, sizeof(uuid_str));\n\tsprintf(value, GATT_INCLUDE_UUID_STR \":%04hx:%04hx:%s\", start,\n\t\t\t\t\t\t\t\tend, uuid_str);\n\n\tg_key_file_set_string(key_file, \"Attributes\", handle, value);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define GATT_INCLUDE_UUID_STR \"2802\""
    ],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_key_file_set_string",
          "args": [
            "key_file",
            "\"Attributes\"",
            "handle",
            "value"
          ],
          "line": 2218
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            "value",
            "GATT_INCLUDE_UUID_STR \":%04hx:%04hx:%s\"",
            "start",
            "end",
            "uuid_str"
          ],
          "line": 2215
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_uuid_to_string",
          "args": [
            "&uuid",
            "uuid_str",
            "sizeof(uuid_str)"
          ],
          "line": 2214
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gatt_db_attribute_get_service_uuid",
          "args": [
            "service",
            "&uuid"
          ],
          "line": 2213
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_get_service_uuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1490-1519",
          "snippet": "bool gatt_db_attribute_get_service_uuid(const struct gatt_db_attribute *attrib,\n\t\t\t\t\t\t\tbt_uuid_t *uuid)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!attrib || !uuid)\n\t\treturn false;\n\n\tservice = attrib->service;\n\n\tif (service->attributes[0]->value_len == sizeof(uint16_t)) {\n\t\tuint16_t value;\n\n\t\tvalue = get_le16(service->attributes[0]->value);\n\t\tbt_uuid16_create(uuid, value);\n\n\t\treturn true;\n\t}\n\n\tif (service->attributes[0]->value_len == sizeof(uint128_t)) {\n\t\tuint128_t value;\n\n\t\tbswap_128(service->attributes[0]->value, &value);\n\t\tbt_uuid128_create(uuid, value);\n\n\t\treturn true;\n\t}\n\n\treturn false;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_attribute_get_service_uuid(const struct gatt_db_attribute *attrib,\n\t\t\t\t\t\t\tbt_uuid_t *uuid)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!attrib || !uuid)\n\t\treturn false;\n\n\tservice = attrib->service;\n\n\tif (service->attributes[0]->value_len == sizeof(uint16_t)) {\n\t\tuint16_t value;\n\n\t\tvalue = get_le16(service->attributes[0]->value);\n\t\tbt_uuid16_create(uuid, value);\n\n\t\treturn true;\n\t}\n\n\tif (service->attributes[0]->value_len == sizeof(uint128_t)) {\n\t\tuint128_t value;\n\n\t\tbswap_128(service->attributes[0]->value, &value);\n\t\tbt_uuid128_create(uuid, value);\n\n\t\treturn true;\n\t}\n\n\treturn false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            "handle",
            "\"%04hx\"",
            "handle_num"
          ],
          "line": 2211
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "warn",
          "args": [
            "\"Error storing included service - can't find it\""
          ],
          "line": 2207
        },
        "resolved": true,
        "details": {
          "function_name": "warn",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/log.c",
          "lines": "151-165",
          "snippet": "void warn(const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_WARNING, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(HCI_DEV_NONE, LOG_WARNING, format, ap);\n\tva_end(ap);\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdarg.h>",
            "#include <syslog.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int logging_fd = -1;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"src/shared/util.h\"\n#include \"lib/hci.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int logging_fd = -1;\n\nvoid warn(const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_WARNING, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(HCI_DEV_NONE, LOG_WARNING, format, ap);\n\tva_end(ap);\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_get_attribute",
          "args": [
            "saver->device->db",
            "start"
          ],
          "line": 2205
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_get_attribute",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1423-1445",
          "snippet": "struct gatt_db_attribute *gatt_db_get_attribute(struct gatt_db *db,\n\t\t\t\t\t\t\tuint16_t handle)\n{\n\tstruct gatt_db_attribute *attrib;\n\tstruct gatt_db_service *service;\n\tint i;\n\n\tattrib = gatt_db_get_service(db, handle);\n\tif (!attrib)\n\t\treturn NULL;\n\n\tservice = attrib->service;\n\n\tfor (i = 0; i < service->num_handles; i++) {\n\t\tif (!service->attributes[i])\n\t\t\tcontinue;\n\n\t\tif (service->attributes[i]->handle == handle)\n\t\t\treturn service->attributes[i];\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstruct gatt_db_attribute *gatt_db_get_attribute(struct gatt_db *db,\n\t\t\t\t\t\t\tuint16_t handle)\n{\n\tstruct gatt_db_attribute *attrib;\n\tstruct gatt_db_service *service;\n\tint i;\n\n\tattrib = gatt_db_get_service(db, handle);\n\tif (!attrib)\n\t\treturn NULL;\n\n\tservice = attrib->service;\n\n\tfor (i = 0; i < service->num_handles; i++) {\n\t\tif (!service->attributes[i])\n\t\t\tcontinue;\n\n\t\tif (service->attributes[i]->handle == handle)\n\t\t\treturn service->attributes[i];\n\t}\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_attribute_get_incl_data",
          "args": [
            "attr",
            "&handle_num",
            "&start",
            "&end"
          ],
          "line": 2200
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_get_incl_data",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1666-1700",
          "snippet": "bool gatt_db_attribute_get_incl_data(const struct gatt_db_attribute *attrib,\n\t\t\t\t\t\t\tuint16_t *handle,\n\t\t\t\t\t\t\tuint16_t *start_handle,\n\t\t\t\t\t\t\tuint16_t *end_handle)\n{\n\tif (!attrib)\n\t\treturn false;\n\n\tif (bt_uuid_cmp(&included_service_uuid, &attrib->uuid))\n\t\treturn false;\n\n\t/*\n\t * Include definition value:\n\t * 2 octets: start handle of included service\n\t * 2 octets: end handle of included service\n\t * optional 2 octets: 16-bit Bluetooth UUID\n\t */\n\tif (!attrib->value || attrib->value_len < 4 || attrib->value_len > 6)\n\t\treturn false;\n\n\t/*\n\t * We only return the handles since the UUID can be easily obtained\n\t * from the corresponding attribute.\n\t */\n\tif (handle)\n\t\t*handle = attrib->handle;\n\n\tif (start_handle)\n\t\t*start_handle = get_le16(attrib->value);\n\n\tif (end_handle)\n\t\t*end_handle = get_le16(attrib->value + 2);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static const bt_uuid_t included_service_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_INCLUDE_UUID };"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic const bt_uuid_t included_service_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_INCLUDE_UUID };\n\nbool gatt_db_attribute_get_incl_data(const struct gatt_db_attribute *attrib,\n\t\t\t\t\t\t\tuint16_t *handle,\n\t\t\t\t\t\t\tuint16_t *start_handle,\n\t\t\t\t\t\t\tuint16_t *end_handle)\n{\n\tif (!attrib)\n\t\treturn false;\n\n\tif (bt_uuid_cmp(&included_service_uuid, &attrib->uuid))\n\t\treturn false;\n\n\t/*\n\t * Include definition value:\n\t * 2 octets: start handle of included service\n\t * 2 octets: end handle of included service\n\t * optional 2 octets: 16-bit Bluetooth UUID\n\t */\n\tif (!attrib->value || attrib->value_len < 4 || attrib->value_len > 6)\n\t\treturn false;\n\n\t/*\n\t * We only return the handles since the UUID can be easily obtained\n\t * from the corresponding attribute.\n\t */\n\tif (handle)\n\t\t*handle = attrib->handle;\n\n\tif (start_handle)\n\t\t*start_handle = get_le16(attrib->value);\n\n\tif (end_handle)\n\t\t*end_handle = get_le16(attrib->value + 2);\n\n\treturn true;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\n#define GATT_INCLUDE_UUID_STR \"2802\"\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void store_incl(struct gatt_db_attribute *attr, void *user_data)\n{\n\tstruct gatt_saver *saver = user_data;\n\tGKeyFile *key_file = saver->key_file;\n\tstruct gatt_db_attribute *service;\n\tchar handle[6], value[100], uuid_str[MAX_LEN_UUID_STR];\n\tuint16_t handle_num, start, end;\n\tbt_uuid_t uuid;\n\n\tif (!gatt_db_attribute_get_incl_data(attr, &handle_num, &start, &end)) {\n\t\twarn(\"Error storing included service - can't get data\");\n\t\treturn;\n\t}\n\n\tservice = gatt_db_get_attribute(saver->device->db, start);\n\tif (!service) {\n\t\twarn(\"Error storing included service - can't find it\");\n\t\treturn;\n\t}\n\n\tsprintf(handle, \"%04hx\", handle_num);\n\n\tgatt_db_attribute_get_service_uuid(service, &uuid);\n\tbt_uuid_to_string(&uuid, uuid_str, sizeof(uuid_str));\n\tsprintf(value, GATT_INCLUDE_UUID_STR \":%04hx:%04hx:%s\", start,\n\t\t\t\t\t\t\t\tend, uuid_str);\n\n\tg_key_file_set_string(key_file, \"Attributes\", handle, value);\n}"
  },
  {
    "function_name": "store_chrc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "2166-2189",
    "snippet": "static void store_chrc(struct gatt_db_attribute *attr, void *user_data)\n{\n\tstruct gatt_saver *saver = user_data;\n\tGKeyFile *key_file = saver->key_file;\n\tchar handle[6], value[100], uuid_str[MAX_LEN_UUID_STR];\n\tuint16_t handle_num, value_handle;\n\tuint8_t properties;\n\tbt_uuid_t uuid;\n\n\tif (!gatt_db_attribute_get_char_data(attr, &handle_num, &value_handle,\n\t\t\t\t\t\t&properties, &saver->ext_props,\n\t\t\t\t\t\t&uuid)) {\n\t\twarn(\"Error storing characteristic - can't get data\");\n\t\treturn;\n\t}\n\n\tsprintf(handle, \"%04hx\", handle_num);\n\tbt_uuid_to_string(&uuid, uuid_str, sizeof(uuid_str));\n\tsprintf(value, GATT_CHARAC_UUID_STR \":%04hx:%02hhx:%s\", value_handle,\n\t\t\t\t\t\t\tproperties, uuid_str);\n\tg_key_file_set_string(key_file, \"Attributes\", handle, value);\n\n\tgatt_db_service_foreach_desc(attr, store_desc, saver);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define GATT_CHARAC_UUID_STR \"2803\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "gatt_db_service_foreach_desc",
          "args": [
            "attr",
            "store_desc",
            "saver"
          ],
          "line": 2188
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_service_foreach_desc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1349-1386",
          "snippet": "void gatt_db_service_foreach_desc(struct gatt_db_attribute *attrib,\n\t\t\t\t\t\tgatt_db_attribute_cb_t func,\n\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct gatt_db_service *service;\n\tstruct gatt_db_attribute *attr;\n\tuint16_t i;\n\n\tif (!attrib || !func)\n\t\treturn;\n\n\t/* Return if this attribute is not a characteristic declaration */\n\tif (bt_uuid_cmp(&characteristic_uuid, &attrib->uuid))\n\t\treturn;\n\n\tservice = attrib->service;\n\n\t/* Start from the attribute following the value handle */\n\tfor (i = 0; i < service->num_handles; i++) {\n\t\tif (service->attributes[i] == attrib) {\n\t\t\ti += 2;\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tfor (; i < service->num_handles; i++) {\n\t\tattr = service->attributes[i];\n\t\tif (!attr)\n\t\t\tcontinue;\n\n\t\t/* Return if we reached the end of this characteristic */\n\t\tif (!bt_uuid_cmp(&characteristic_uuid, &attr->uuid) ||\n\t\t\t!bt_uuid_cmp(&included_service_uuid, &attr->uuid))\n\t\t\treturn;\n\n\t\tfunc(attr, user_data);\n\t}\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static const bt_uuid_t characteristic_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_CHARAC_UUID };",
            "static const bt_uuid_t included_service_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_INCLUDE_UUID };"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic const bt_uuid_t characteristic_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_CHARAC_UUID };\nstatic const bt_uuid_t included_service_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_INCLUDE_UUID };\n\nvoid gatt_db_service_foreach_desc(struct gatt_db_attribute *attrib,\n\t\t\t\t\t\tgatt_db_attribute_cb_t func,\n\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct gatt_db_service *service;\n\tstruct gatt_db_attribute *attr;\n\tuint16_t i;\n\n\tif (!attrib || !func)\n\t\treturn;\n\n\t/* Return if this attribute is not a characteristic declaration */\n\tif (bt_uuid_cmp(&characteristic_uuid, &attrib->uuid))\n\t\treturn;\n\n\tservice = attrib->service;\n\n\t/* Start from the attribute following the value handle */\n\tfor (i = 0; i < service->num_handles; i++) {\n\t\tif (service->attributes[i] == attrib) {\n\t\t\ti += 2;\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tfor (; i < service->num_handles; i++) {\n\t\tattr = service->attributes[i];\n\t\tif (!attr)\n\t\t\tcontinue;\n\n\t\t/* Return if we reached the end of this characteristic */\n\t\tif (!bt_uuid_cmp(&characteristic_uuid, &attr->uuid) ||\n\t\t\t!bt_uuid_cmp(&included_service_uuid, &attr->uuid))\n\t\t\treturn;\n\n\t\tfunc(attr, user_data);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_key_file_set_string",
          "args": [
            "key_file",
            "\"Attributes\"",
            "handle",
            "value"
          ],
          "line": 2186
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            "value",
            "GATT_CHARAC_UUID_STR \":%04hx:%02hhx:%s\"",
            "value_handle",
            "properties",
            "uuid_str"
          ],
          "line": 2184
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_uuid_to_string",
          "args": [
            "&uuid",
            "uuid_str",
            "sizeof(uuid_str)"
          ],
          "line": 2183
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            "handle",
            "\"%04hx\"",
            "handle_num"
          ],
          "line": 2182
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "warn",
          "args": [
            "\"Error storing characteristic - can't get data\""
          ],
          "line": 2178
        },
        "resolved": true,
        "details": {
          "function_name": "warn",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/log.c",
          "lines": "151-165",
          "snippet": "void warn(const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_WARNING, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(HCI_DEV_NONE, LOG_WARNING, format, ap);\n\tva_end(ap);\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdarg.h>",
            "#include <syslog.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int logging_fd = -1;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"src/shared/util.h\"\n#include \"lib/hci.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int logging_fd = -1;\n\nvoid warn(const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_WARNING, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(HCI_DEV_NONE, LOG_WARNING, format, ap);\n\tva_end(ap);\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_attribute_get_char_data",
          "args": [
            "attr",
            "&handle_num",
            "&value_handle",
            "&properties",
            "&saver->ext_props",
            "&uuid"
          ],
          "line": 2175
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_get_char_data",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1625-1664",
          "snippet": "bool gatt_db_attribute_get_char_data(const struct gatt_db_attribute *attrib,\n\t\t\t\t\t\t\tuint16_t *handle,\n\t\t\t\t\t\t\tuint16_t *value_handle,\n\t\t\t\t\t\t\tuint8_t *properties,\n\t\t\t\t\t\t\tuint16_t *ext_prop,\n\t\t\t\t\t\t\tbt_uuid_t *uuid)\n{\n\tif (!attrib)\n\t\treturn false;\n\n\tif (bt_uuid_cmp(&characteristic_uuid, &attrib->uuid))\n\t\treturn false;\n\n\t/*\n\t * Characteristic declaration value:\n\t * 1 octet: Characteristic properties\n\t * 2 octets: Characteristic value handle\n\t * 2 or 16 octets: characteristic UUID\n\t */\n\tif (!attrib->value || (attrib->value_len != 5 &&\n\t\t\t\t\t\tattrib->value_len != 19))\n\t\treturn false;\n\n\tif (handle)\n\t\t*handle = attrib->handle;\n\n\tif (properties)\n\t\t*properties = attrib->value[0];\n\n\tif (ext_prop)\n\t\t*ext_prop = get_char_extended_prop(attrib);\n\n\tif (value_handle)\n\t\t*value_handle = get_le16(attrib->value + 1);\n\n\tif (!uuid)\n\t\treturn true;\n\n\treturn le_to_uuid(attrib->value + 3, attrib->value_len - 3, uuid);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static const bt_uuid_t characteristic_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_CHARAC_UUID };"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic const bt_uuid_t characteristic_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_CHARAC_UUID };\n\nbool gatt_db_attribute_get_char_data(const struct gatt_db_attribute *attrib,\n\t\t\t\t\t\t\tuint16_t *handle,\n\t\t\t\t\t\t\tuint16_t *value_handle,\n\t\t\t\t\t\t\tuint8_t *properties,\n\t\t\t\t\t\t\tuint16_t *ext_prop,\n\t\t\t\t\t\t\tbt_uuid_t *uuid)\n{\n\tif (!attrib)\n\t\treturn false;\n\n\tif (bt_uuid_cmp(&characteristic_uuid, &attrib->uuid))\n\t\treturn false;\n\n\t/*\n\t * Characteristic declaration value:\n\t * 1 octet: Characteristic properties\n\t * 2 octets: Characteristic value handle\n\t * 2 or 16 octets: characteristic UUID\n\t */\n\tif (!attrib->value || (attrib->value_len != 5 &&\n\t\t\t\t\t\tattrib->value_len != 19))\n\t\treturn false;\n\n\tif (handle)\n\t\t*handle = attrib->handle;\n\n\tif (properties)\n\t\t*properties = attrib->value[0];\n\n\tif (ext_prop)\n\t\t*ext_prop = get_char_extended_prop(attrib);\n\n\tif (value_handle)\n\t\t*value_handle = get_le16(attrib->value + 1);\n\n\tif (!uuid)\n\t\treturn true;\n\n\treturn le_to_uuid(attrib->value + 3, attrib->value_len - 3, uuid);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\n#define GATT_CHARAC_UUID_STR \"2803\"\n\nstatic void store_chrc(struct gatt_db_attribute *attr, void *user_data)\n{\n\tstruct gatt_saver *saver = user_data;\n\tGKeyFile *key_file = saver->key_file;\n\tchar handle[6], value[100], uuid_str[MAX_LEN_UUID_STR];\n\tuint16_t handle_num, value_handle;\n\tuint8_t properties;\n\tbt_uuid_t uuid;\n\n\tif (!gatt_db_attribute_get_char_data(attr, &handle_num, &value_handle,\n\t\t\t\t\t\t&properties, &saver->ext_props,\n\t\t\t\t\t\t&uuid)) {\n\t\twarn(\"Error storing characteristic - can't get data\");\n\t\treturn;\n\t}\n\n\tsprintf(handle, \"%04hx\", handle_num);\n\tbt_uuid_to_string(&uuid, uuid_str, sizeof(uuid_str));\n\tsprintf(value, GATT_CHARAC_UUID_STR \":%04hx:%02hhx:%s\", value_handle,\n\t\t\t\t\t\t\tproperties, uuid_str);\n\tg_key_file_set_string(key_file, \"Attributes\", handle, value);\n\n\tgatt_db_service_foreach_desc(attr, store_desc, saver);\n}"
  },
  {
    "function_name": "store_desc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "2142-2164",
    "snippet": "static void store_desc(struct gatt_db_attribute *attr, void *user_data)\n{\n\tstruct gatt_saver *saver = user_data;\n\tGKeyFile *key_file = saver->key_file;\n\tchar handle[6], value[100], uuid_str[MAX_LEN_UUID_STR];\n\tconst bt_uuid_t *uuid;\n\tbt_uuid_t ext_uuid;\n\tuint16_t handle_num;\n\n\thandle_num = gatt_db_attribute_get_handle(attr);\n\tsprintf(handle, \"%04hx\", handle_num);\n\n\tuuid = gatt_db_attribute_get_type(attr);\n\tbt_uuid_to_string(uuid, uuid_str, sizeof(uuid_str));\n\n\tbt_uuid16_create(&ext_uuid, GATT_CHARAC_EXT_PROPER_UUID);\n\tif (!bt_uuid_cmp(uuid, &ext_uuid) && saver->ext_props)\n\t\tsprintf(value, \"%04hx:%s\", saver->ext_props, uuid_str);\n\telse\n\t\tsprintf(value, \"%s\", uuid_str);\n\n\tg_key_file_set_string(key_file, \"Attributes\", handle, value);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_key_file_set_string",
          "args": [
            "key_file",
            "\"Attributes\"",
            "handle",
            "value"
          ],
          "line": 2163
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            "value",
            "\"%s\"",
            "uuid_str"
          ],
          "line": 2161
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            "value",
            "\"%04hx:%s\"",
            "saver->ext_props",
            "uuid_str"
          ],
          "line": 2159
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_uuid_cmp",
          "args": [
            "uuid",
            "&ext_uuid"
          ],
          "line": 2158
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_uuid16_create",
          "args": [
            "&ext_uuid",
            "GATT_CHARAC_EXT_PROPER_UUID"
          ],
          "line": 2157
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_uuid_to_string",
          "args": [
            "uuid",
            "uuid_str",
            "sizeof(uuid_str)"
          ],
          "line": 2155
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gatt_db_attribute_get_type",
          "args": [
            "attr"
          ],
          "line": 2154
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_get_type",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1473-1480",
          "snippet": "const bt_uuid_t *gatt_db_attribute_get_type(\n\t\t\t\t\tconst struct gatt_db_attribute *attrib)\n{\n\tif (!attrib)\n\t\treturn NULL;\n\n\treturn &attrib->uuid;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nconst bt_uuid_t *gatt_db_attribute_get_type(\n\t\t\t\t\tconst struct gatt_db_attribute *attrib)\n{\n\tif (!attrib)\n\t\treturn NULL;\n\n\treturn &attrib->uuid;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            "handle",
            "\"%04hx\"",
            "handle_num"
          ],
          "line": 2152
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gatt_db_attribute_get_handle",
          "args": [
            "attr"
          ],
          "line": 2151
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_get_handle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1482-1488",
          "snippet": "uint16_t gatt_db_attribute_get_handle(const struct gatt_db_attribute *attrib)\n{\n\tif (!attrib)\n\t\treturn 0;\n\n\treturn attrib->handle;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nuint16_t gatt_db_attribute_get_handle(const struct gatt_db_attribute *attrib)\n{\n\tif (!attrib)\n\t\treturn 0;\n\n\treturn attrib->handle;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void store_desc(struct gatt_db_attribute *attr, void *user_data)\n{\n\tstruct gatt_saver *saver = user_data;\n\tGKeyFile *key_file = saver->key_file;\n\tchar handle[6], value[100], uuid_str[MAX_LEN_UUID_STR];\n\tconst bt_uuid_t *uuid;\n\tbt_uuid_t ext_uuid;\n\tuint16_t handle_num;\n\n\thandle_num = gatt_db_attribute_get_handle(attr);\n\tsprintf(handle, \"%04hx\", handle_num);\n\n\tuuid = gatt_db_attribute_get_type(attr);\n\tbt_uuid_to_string(uuid, uuid_str, sizeof(uuid_str));\n\n\tbt_uuid16_create(&ext_uuid, GATT_CHARAC_EXT_PROPER_UUID);\n\tif (!bt_uuid_cmp(uuid, &ext_uuid) && saver->ext_props)\n\t\tsprintf(value, \"%04hx:%s\", saver->ext_props, uuid_str);\n\telse\n\t\tsprintf(value, \"%s\", uuid_str);\n\n\tg_key_file_set_string(key_file, \"Attributes\", handle, value);\n}"
  },
  {
    "function_name": "store_services",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "2064-2134",
    "snippet": "static void store_services(struct btd_device *device)\n{\n\tchar filename[PATH_MAX];\n\tchar dst_addr[18];\n\tuuid_t uuid;\n\tchar *prim_uuid;\n\tGKeyFile *key_file;\n\tGSList *l;\n\tchar *data;\n\tgsize length = 0;\n\n\tif (device_address_is_private(device)) {\n\t\tDBG(\"Can't store services for private addressed device %s\",\n\t\t\t\t\t\t\t\tdevice->path);\n\t\treturn;\n\t}\n\n\tsdp_uuid16_create(&uuid, GATT_PRIM_SVC_UUID);\n\tprim_uuid = bt_uuid2string(&uuid);\n\tif (prim_uuid == NULL)\n\t\treturn;\n\n\tba2str(&device->bdaddr, dst_addr);\n\n\tsnprintf(filename, PATH_MAX, STORAGEDIR \"/%s/%s/attributes\",\n\t\t\t\tbtd_adapter_get_storage_dir(device->adapter),\n\t\t\t\tdst_addr);\n\tkey_file = g_key_file_new();\n\n\tfor (l = device->primaries; l; l = l->next) {\n\t\tstruct gatt_primary *primary = l->data;\n\t\tchar handle[6], uuid_str[33];\n\t\tint i;\n\n\t\tsprintf(handle, \"%hu\", primary->range.start);\n\n\t\tbt_string2uuid(&uuid, primary->uuid);\n\t\tsdp_uuid128_to_uuid(&uuid);\n\n\t\tswitch (uuid.type) {\n\t\tcase SDP_UUID16:\n\t\t\tsprintf(uuid_str, \"%4.4X\", uuid.value.uuid16);\n\t\t\tbreak;\n\t\tcase SDP_UUID32:\n\t\t\tsprintf(uuid_str, \"%8.8X\", uuid.value.uuid32);\n\t\t\tbreak;\n\t\tcase SDP_UUID128:\n\t\t\tfor (i = 0; i < 16; i++)\n\t\t\t\tsprintf(uuid_str + (i * 2), \"%2.2X\",\n\t\t\t\t\t\tuuid.value.uuid128.data[i]);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tuuid_str[0] = '\\0';\n\t\t}\n\n\t\tg_key_file_set_string(key_file, handle, \"UUID\", prim_uuid);\n\t\tg_key_file_set_string(key_file, handle, \"Value\", uuid_str);\n\t\tg_key_file_set_integer(key_file, handle, \"EndGroupHandle\",\n\t\t\t\t\tprimary->range.end);\n\t}\n\n\tdata = g_key_file_to_data(key_file, &length, NULL);\n\tif (length > 0) {\n\t\tcreate_file(filename, S_IRUSR | S_IWUSR);\n\t\tg_file_set_contents(filename, data, length, NULL);\n\t}\n\n\tfree(prim_uuid);\n\tg_free(data);\n\tg_key_file_free(key_file);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_key_file_free",
          "args": [
            "key_file"
          ],
          "line": 2133
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "data"
          ],
          "line": 2132
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "prim_uuid"
          ],
          "line": 2131
        },
        "resolved": true,
        "details": {
          "function_name": "device_auth_req_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5662-5676",
          "snippet": "static void device_auth_req_free(struct btd_device *device)\n{\n\tstruct authentication_req *authr = device->authr;\n\n\tif (!authr)\n\t\treturn;\n\n\tif (authr->agent)\n\t\tagent_unref(authr->agent);\n\n\tg_free(authr->pincode);\n\tg_free(authr);\n\n\tdevice->authr = NULL;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void device_auth_req_free(struct btd_device *device)\n{\n\tstruct authentication_req *authr = device->authr;\n\n\tif (!authr)\n\t\treturn;\n\n\tif (authr->agent)\n\t\tagent_unref(authr->agent);\n\n\tg_free(authr->pincode);\n\tg_free(authr);\n\n\tdevice->authr = NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_file_set_contents",
          "args": [
            "filename",
            "data",
            "length",
            "NULL"
          ],
          "line": 2128
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "create_file",
          "args": [
            "filename",
            "S_IRUSR | S_IWUSR"
          ],
          "line": 2127
        },
        "resolved": true,
        "details": {
          "function_name": "create_file",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/textfile.c",
          "lines": "76-89",
          "snippet": "int create_file(const char *filename, const mode_t mode)\n{\n\tint fd;\n\n\tcreate_dirs(filename, S_IRUSR | S_IWUSR | S_IXUSR);\n\n\tfd = open(filename, O_RDWR | O_CREAT, mode);\n\tif (fd < 0)\n\t\treturn fd;\n\n\tclose(fd);\n\n\treturn 0;\n}",
          "includes": [
            "#include \"textfile.h\"",
            "#include <sys/param.h>",
            "#include <sys/mman.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <ctype.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"textfile.h\"\n#include <sys/param.h>\n#include <sys/mman.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <ctype.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nint create_file(const char *filename, const mode_t mode)\n{\n\tint fd;\n\n\tcreate_dirs(filename, S_IRUSR | S_IWUSR | S_IXUSR);\n\n\tfd = open(filename, O_RDWR | O_CREAT, mode);\n\tif (fd < 0)\n\t\treturn fd;\n\n\tclose(fd);\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_key_file_to_data",
          "args": [
            "key_file",
            "&length",
            "NULL"
          ],
          "line": 2125
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_set_integer",
          "args": [
            "key_file",
            "handle",
            "\"EndGroupHandle\"",
            "primary->range.end"
          ],
          "line": 2121
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_set_string",
          "args": [
            "key_file",
            "handle",
            "\"Value\"",
            "uuid_str"
          ],
          "line": 2120
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_set_string",
          "args": [
            "key_file",
            "handle",
            "\"UUID\"",
            "prim_uuid"
          ],
          "line": 2119
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            "uuid_str + (i * 2)",
            "\"%2.2X\"",
            "uuid.value.uuid128.data[i]"
          ],
          "line": 2112
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            "uuid_str",
            "\"%8.8X\"",
            "uuid.value.uuid32"
          ],
          "line": 2108
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            "uuid_str",
            "\"%4.4X\"",
            "uuid.value.uuid16"
          ],
          "line": 2105
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_uuid128_to_uuid",
          "args": [
            "&uuid"
          ],
          "line": 2101
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_string2uuid",
          "args": [
            "&uuid",
            "primary->uuid"
          ],
          "line": 2100
        },
        "resolved": true,
        "details": {
          "function_name": "bt_string2uuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/uuid-helper.c",
          "lines": "211-247",
          "snippet": "int bt_string2uuid(uuid_t *uuid, const char *string)\n{\n\tuint32_t data0, data4;\n\tuint16_t data1, data2, data3, data5;\n\n\tif (is_uuid128(string) &&\n\t\t\tsscanf(string, \"%08x-%04hx-%04hx-%04hx-%08x%04hx\",\n\t\t\t\t&data0, &data1, &data2, &data3, &data4, &data5) == 6) {\n\t\tuint8_t val[16];\n\n\t\tdata0 = htonl(data0);\n\t\tdata1 = htons(data1);\n\t\tdata2 = htons(data2);\n\t\tdata3 = htons(data3);\n\t\tdata4 = htonl(data4);\n\t\tdata5 = htons(data5);\n\n\t\tmemcpy(&val[0], &data0, 4);\n\t\tmemcpy(&val[4], &data1, 2);\n\t\tmemcpy(&val[6], &data2, 2);\n\t\tmemcpy(&val[8], &data3, 2);\n\t\tmemcpy(&val[10], &data4, 4);\n\t\tmemcpy(&val[14], &data5, 2);\n\n\t\tsdp_uuid128_create(uuid, val);\n\n\t\treturn 0;\n\t} else {\n\t\tuint16_t class = name2class(string);\n\t\tif (class) {\n\t\t\tsdp_uuid16_create(uuid, class);\n\t\t\treturn 0;\n\t\t}\n\n\t\treturn string2uuid16(uuid, string);\n\t}\n}",
          "includes": [
            "#include \"uuid-helper.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <arpa/inet.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"uuid-helper.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <arpa/inet.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <config.h>\n\nint bt_string2uuid(uuid_t *uuid, const char *string)\n{\n\tuint32_t data0, data4;\n\tuint16_t data1, data2, data3, data5;\n\n\tif (is_uuid128(string) &&\n\t\t\tsscanf(string, \"%08x-%04hx-%04hx-%04hx-%08x%04hx\",\n\t\t\t\t&data0, &data1, &data2, &data3, &data4, &data5) == 6) {\n\t\tuint8_t val[16];\n\n\t\tdata0 = htonl(data0);\n\t\tdata1 = htons(data1);\n\t\tdata2 = htons(data2);\n\t\tdata3 = htons(data3);\n\t\tdata4 = htonl(data4);\n\t\tdata5 = htons(data5);\n\n\t\tmemcpy(&val[0], &data0, 4);\n\t\tmemcpy(&val[4], &data1, 2);\n\t\tmemcpy(&val[6], &data2, 2);\n\t\tmemcpy(&val[8], &data3, 2);\n\t\tmemcpy(&val[10], &data4, 4);\n\t\tmemcpy(&val[14], &data5, 2);\n\n\t\tsdp_uuid128_create(uuid, val);\n\n\t\treturn 0;\n\t} else {\n\t\tuint16_t class = name2class(string);\n\t\tif (class) {\n\t\t\tsdp_uuid16_create(uuid, class);\n\t\t\treturn 0;\n\t\t}\n\n\t\treturn string2uuid16(uuid, string);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            "handle",
            "\"%hu\"",
            "primary->range.start"
          ],
          "line": 2098
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_new",
          "args": [],
          "line": 2091
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "filename",
            "PATH_MAX",
            "STORAGEDIR \"/%s/%s/attributes\"",
            "btd_adapter_get_storage_dir(device->adapter)",
            "dst_addr"
          ],
          "line": 2088
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_adapter_get_storage_dir",
          "args": [
            "device->adapter"
          ],
          "line": 2089
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_get_storage_dir",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "438-450",
          "snippet": "const char *btd_adapter_get_storage_dir(struct btd_adapter *adapter)\n{\n\tstatic char dir[25];\n\n\tif (adapter->bdaddr_type == BDADDR_LE_RANDOM) {\n\t\tstrcpy(dir, \"static-\");\n\t\tba2str(&adapter->bdaddr, dir + 7);\n\t} else {\n\t\tba2str(&adapter->bdaddr, dir);\n\t}\n\n\treturn dir;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nconst char *btd_adapter_get_storage_dir(struct btd_adapter *adapter)\n{\n\tstatic char dir[25];\n\n\tif (adapter->bdaddr_type == BDADDR_LE_RANDOM) {\n\t\tstrcpy(dir, \"static-\");\n\t\tba2str(&adapter->bdaddr, dir + 7);\n\t} else {\n\t\tba2str(&adapter->bdaddr, dir);\n\t}\n\n\treturn dir;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ba2str",
          "args": [
            "&device->bdaddr",
            "dst_addr"
          ],
          "line": 2086
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_uuid2string",
          "args": [
            "&uuid"
          ],
          "line": 2082
        },
        "resolved": true,
        "details": {
          "function_name": "bt_uuid2string",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/uuid-helper.c",
          "lines": "65-110",
          "snippet": "char *bt_uuid2string(uuid_t *uuid)\n{\n\tchar *str;\n\tuuid_t uuid128;\n\tunsigned int data0;\n\tunsigned short data1;\n\tunsigned short data2;\n\tunsigned short data3;\n\tunsigned int data4;\n\tunsigned short data5;\n\tint err;\n\n\tif (!uuid)\n\t\treturn NULL;\n\n\tswitch (uuid->type) {\n\tcase SDP_UUID16:\n\t\tsdp_uuid16_to_uuid128(&uuid128, uuid);\n\t\tbreak;\n\tcase SDP_UUID32:\n\t\tsdp_uuid32_to_uuid128(&uuid128, uuid);\n\t\tbreak;\n\tcase SDP_UUID128:\n\t\tmemcpy(&uuid128, uuid, sizeof(uuid_t));\n\t\tbreak;\n\tdefault:\n\t\t/* Type of UUID unknown */\n\t\treturn NULL;\n\t}\n\n\tmemcpy(&data0, &uuid128.value.uuid128.data[0], 4);\n\tmemcpy(&data1, &uuid128.value.uuid128.data[4], 2);\n\tmemcpy(&data2, &uuid128.value.uuid128.data[6], 2);\n\tmemcpy(&data3, &uuid128.value.uuid128.data[8], 2);\n\tmemcpy(&data4, &uuid128.value.uuid128.data[10], 4);\n\tmemcpy(&data5, &uuid128.value.uuid128.data[14], 2);\n\n\terr = asprintf(&str, \"%.8x-%.4x-%.4x-%.4x-%.8x%.4x\",\n\t\t\tntohl(data0), ntohs(data1),\n\t\t\tntohs(data2), ntohs(data3),\n\t\t\tntohl(data4), ntohs(data5));\n\tif (err < 0)\n\t\treturn NULL;\n\n\treturn str;\n}",
          "includes": [
            "#include \"uuid-helper.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <arpa/inet.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"uuid-helper.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <arpa/inet.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *bt_uuid2string(uuid_t *uuid)\n{\n\tchar *str;\n\tuuid_t uuid128;\n\tunsigned int data0;\n\tunsigned short data1;\n\tunsigned short data2;\n\tunsigned short data3;\n\tunsigned int data4;\n\tunsigned short data5;\n\tint err;\n\n\tif (!uuid)\n\t\treturn NULL;\n\n\tswitch (uuid->type) {\n\tcase SDP_UUID16:\n\t\tsdp_uuid16_to_uuid128(&uuid128, uuid);\n\t\tbreak;\n\tcase SDP_UUID32:\n\t\tsdp_uuid32_to_uuid128(&uuid128, uuid);\n\t\tbreak;\n\tcase SDP_UUID128:\n\t\tmemcpy(&uuid128, uuid, sizeof(uuid_t));\n\t\tbreak;\n\tdefault:\n\t\t/* Type of UUID unknown */\n\t\treturn NULL;\n\t}\n\n\tmemcpy(&data0, &uuid128.value.uuid128.data[0], 4);\n\tmemcpy(&data1, &uuid128.value.uuid128.data[4], 2);\n\tmemcpy(&data2, &uuid128.value.uuid128.data[6], 2);\n\tmemcpy(&data3, &uuid128.value.uuid128.data[8], 2);\n\tmemcpy(&data4, &uuid128.value.uuid128.data[10], 4);\n\tmemcpy(&data5, &uuid128.value.uuid128.data[14], 2);\n\n\terr = asprintf(&str, \"%.8x-%.4x-%.4x-%.4x-%.8x%.4x\",\n\t\t\tntohl(data0), ntohs(data1),\n\t\t\tntohs(data2), ntohs(data3),\n\t\t\tntohl(data4), ntohs(data5));\n\tif (err < 0)\n\t\treturn NULL;\n\n\treturn str;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sdp_uuid16_create",
          "args": [
            "&uuid",
            "GATT_PRIM_SVC_UUID"
          ],
          "line": 2081
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Can't store services for private addressed device %s\"",
            "device->path"
          ],
          "line": 2076
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device_address_is_private",
          "args": [
            "device"
          ],
          "line": 2075
        },
        "resolved": true,
        "details": {
          "function_name": "device_address_is_private",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "461-473",
          "snippet": "static bool device_address_is_private(struct btd_device *dev)\n{\n\tif (dev->bdaddr_type != BDADDR_LE_RANDOM)\n\t\treturn false;\n\n\tswitch (dev->bdaddr.b[5] >> 6) {\n\tcase 0x00:\t/* Private non-resolvable */\n\tcase 0x01:\t/* Private resolvable */\n\t\treturn true;\n\tdefault:\n\t\treturn false;\n\t}\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic bool device_address_is_private(struct btd_device *dev)\n{\n\tif (dev->bdaddr_type != BDADDR_LE_RANDOM)\n\t\treturn false;\n\n\tswitch (dev->bdaddr.b[5] >> 6) {\n\tcase 0x00:\t/* Private non-resolvable */\n\tcase 0x01:\t/* Private resolvable */\n\t\treturn true;\n\tdefault:\n\t\treturn false;\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void store_services(struct btd_device *device)\n{\n\tchar filename[PATH_MAX];\n\tchar dst_addr[18];\n\tuuid_t uuid;\n\tchar *prim_uuid;\n\tGKeyFile *key_file;\n\tGSList *l;\n\tchar *data;\n\tgsize length = 0;\n\n\tif (device_address_is_private(device)) {\n\t\tDBG(\"Can't store services for private addressed device %s\",\n\t\t\t\t\t\t\t\tdevice->path);\n\t\treturn;\n\t}\n\n\tsdp_uuid16_create(&uuid, GATT_PRIM_SVC_UUID);\n\tprim_uuid = bt_uuid2string(&uuid);\n\tif (prim_uuid == NULL)\n\t\treturn;\n\n\tba2str(&device->bdaddr, dst_addr);\n\n\tsnprintf(filename, PATH_MAX, STORAGEDIR \"/%s/%s/attributes\",\n\t\t\t\tbtd_adapter_get_storage_dir(device->adapter),\n\t\t\t\tdst_addr);\n\tkey_file = g_key_file_new();\n\n\tfor (l = device->primaries; l; l = l->next) {\n\t\tstruct gatt_primary *primary = l->data;\n\t\tchar handle[6], uuid_str[33];\n\t\tint i;\n\n\t\tsprintf(handle, \"%hu\", primary->range.start);\n\n\t\tbt_string2uuid(&uuid, primary->uuid);\n\t\tsdp_uuid128_to_uuid(&uuid);\n\n\t\tswitch (uuid.type) {\n\t\tcase SDP_UUID16:\n\t\t\tsprintf(uuid_str, \"%4.4X\", uuid.value.uuid16);\n\t\t\tbreak;\n\t\tcase SDP_UUID32:\n\t\t\tsprintf(uuid_str, \"%8.8X\", uuid.value.uuid32);\n\t\t\tbreak;\n\t\tcase SDP_UUID128:\n\t\t\tfor (i = 0; i < 16; i++)\n\t\t\t\tsprintf(uuid_str + (i * 2), \"%2.2X\",\n\t\t\t\t\t\tuuid.value.uuid128.data[i]);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tuuid_str[0] = '\\0';\n\t\t}\n\n\t\tg_key_file_set_string(key_file, handle, \"UUID\", prim_uuid);\n\t\tg_key_file_set_string(key_file, handle, \"Value\", uuid_str);\n\t\tg_key_file_set_integer(key_file, handle, \"EndGroupHandle\",\n\t\t\t\t\tprimary->range.end);\n\t}\n\n\tdata = g_key_file_to_data(key_file, &length, NULL);\n\tif (length > 0) {\n\t\tcreate_file(filename, S_IRUSR | S_IWUSR);\n\t\tg_file_set_contents(filename, data, length, NULL);\n\t}\n\n\tfree(prim_uuid);\n\tg_free(data);\n\tg_key_file_free(key_file);\n}"
  },
  {
    "function_name": "disconnect_profile",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "2023-2062",
    "snippet": "static DBusMessage *disconnect_profile(DBusConnection *conn, DBusMessage *msg,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct btd_device *dev = user_data;\n\tstruct btd_service *service;\n\tconst char *pattern;\n\tchar *uuid;\n\tint err;\n\n\tif (!dbus_message_get_args(msg, NULL, DBUS_TYPE_STRING, &pattern,\n\t\t\t\t\t\t\tDBUS_TYPE_INVALID))\n\t\treturn btd_error_invalid_args(msg);\n\n\tuuid = bt_name2string(pattern);\n\tif (uuid == NULL)\n\t\treturn btd_error_invalid_args(msg);\n\n\tservice = find_connectable_service(dev, uuid);\n\tfree(uuid);\n\n\tif (!service)\n\t\treturn btd_error_invalid_args(msg);\n\n\tif (dev->disconnect)\n\t\treturn btd_error_in_progress(msg);\n\n\tdev->disconnect = dbus_message_ref(msg);\n\n\terr = btd_service_disconnect(service);\n\tif (err == 0)\n\t\treturn NULL;\n\n\tdbus_message_unref(dev->disconnect);\n\tdev->disconnect = NULL;\n\n\tif (err == -ENOTSUP)\n\t\treturn btd_error_not_supported(msg);\n\n\treturn btd_error_failed(msg, strerror(-err));\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
      "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "btd_error_failed",
          "args": [
            "msg",
            "strerror(-err)"
          ],
          "line": 2061
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "124-128",
          "snippet": "DBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "strerror",
          "args": [
            "-err"
          ],
          "line": 2061
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_error_not_supported",
          "args": [
            "msg"
          ],
          "line": 2059
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_not_supported",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "58-62",
          "snippet": "DBusMessage *btd_error_not_supported(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotSupported\",\n\t\t\t\t\t\"Operation is not supported\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_not_supported(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotSupported\",\n\t\t\t\t\t\"Operation is not supported\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_unref",
          "args": [
            "dev->disconnect"
          ],
          "line": 2055
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_service_disconnect",
          "args": [
            "service"
          ],
          "line": 2051
        },
        "resolved": true,
        "details": {
          "function_name": "btd_service_disconnect",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
          "lines": "271-309",
          "snippet": "int btd_service_disconnect(struct btd_service *service)\n{\n\tstruct btd_profile *profile = service->profile;\n\tchar addr[18];\n\tint err;\n\n\tif (!profile->disconnect)\n\t\treturn -ENOTSUP;\n\n\tswitch (service->state) {\n\tcase BTD_SERVICE_STATE_UNAVAILABLE:\n\t\treturn -EINVAL;\n\tcase BTD_SERVICE_STATE_DISCONNECTED:\n\tcase BTD_SERVICE_STATE_DISCONNECTING:\n\t\treturn -EALREADY;\n\tcase BTD_SERVICE_STATE_CONNECTING:\n\tcase BTD_SERVICE_STATE_CONNECTED:\n\t\tbreak;\n\t}\n\n\tchange_state(service, BTD_SERVICE_STATE_DISCONNECTING, 0);\n\n\terr = profile->disconnect(service);\n\tif (err == 0)\n\t\treturn 0;\n\n\tif (err == -ENOTCONN) {\n\t\tbtd_service_disconnecting_complete(service, 0);\n\t\treturn 0;\n\t}\n\n\tba2str(device_get_address(service->device), addr);\n\terror(\"%s profile disconnect failed for %s: %s\", profile->name, addr,\n\t\t\t\t\t\t\t\tstrerror(-err));\n\n\tbtd_service_disconnecting_complete(service, err);\n\n\treturn err;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/stat.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nint btd_service_disconnect(struct btd_service *service)\n{\n\tstruct btd_profile *profile = service->profile;\n\tchar addr[18];\n\tint err;\n\n\tif (!profile->disconnect)\n\t\treturn -ENOTSUP;\n\n\tswitch (service->state) {\n\tcase BTD_SERVICE_STATE_UNAVAILABLE:\n\t\treturn -EINVAL;\n\tcase BTD_SERVICE_STATE_DISCONNECTED:\n\tcase BTD_SERVICE_STATE_DISCONNECTING:\n\t\treturn -EALREADY;\n\tcase BTD_SERVICE_STATE_CONNECTING:\n\tcase BTD_SERVICE_STATE_CONNECTED:\n\t\tbreak;\n\t}\n\n\tchange_state(service, BTD_SERVICE_STATE_DISCONNECTING, 0);\n\n\terr = profile->disconnect(service);\n\tif (err == 0)\n\t\treturn 0;\n\n\tif (err == -ENOTCONN) {\n\t\tbtd_service_disconnecting_complete(service, 0);\n\t\treturn 0;\n\t}\n\n\tba2str(device_get_address(service->device), addr);\n\terror(\"%s profile disconnect failed for %s: %s\", profile->name, addr,\n\t\t\t\t\t\t\t\tstrerror(-err));\n\n\tbtd_service_disconnecting_complete(service, err);\n\n\treturn err;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_ref",
          "args": [
            "msg"
          ],
          "line": 2049
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_error_in_progress",
          "args": [
            "msg"
          ],
          "line": 2047
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_in_progress",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "76-80",
          "snippet": "DBusMessage *btd_error_in_progress(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".InProgress\",\n\t\t\t\t\t\"In Progress\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_in_progress(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".InProgress\",\n\t\t\t\t\t\"In Progress\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_error_invalid_args",
          "args": [
            "msg"
          ],
          "line": 2044
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_invalid_args",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "34-38",
          "snippet": "DBusMessage *btd_error_invalid_args(DBusMessage *msg)\n{\n\treturn btd_error_invalid_args_str(msg,\n\t\t\t\t\t\"Invalid arguments in method call\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_invalid_args(DBusMessage *msg)\n{\n\treturn btd_error_invalid_args_str(msg,\n\t\t\t\t\t\"Invalid arguments in method call\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "uuid"
          ],
          "line": 2041
        },
        "resolved": true,
        "details": {
          "function_name": "device_auth_req_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5662-5676",
          "snippet": "static void device_auth_req_free(struct btd_device *device)\n{\n\tstruct authentication_req *authr = device->authr;\n\n\tif (!authr)\n\t\treturn;\n\n\tif (authr->agent)\n\t\tagent_unref(authr->agent);\n\n\tg_free(authr->pincode);\n\tg_free(authr);\n\n\tdevice->authr = NULL;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void device_auth_req_free(struct btd_device *device)\n{\n\tstruct authentication_req *authr = device->authr;\n\n\tif (!authr)\n\t\treturn;\n\n\tif (authr->agent)\n\t\tagent_unref(authr->agent);\n\n\tg_free(authr->pincode);\n\tg_free(authr);\n\n\tdevice->authr = NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "find_connectable_service",
          "args": [
            "dev",
            "uuid"
          ],
          "line": 2040
        },
        "resolved": true,
        "details": {
          "function_name": "find_connectable_service",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "1745-1762",
          "snippet": "static struct btd_service *find_connectable_service(struct btd_device *dev,\n\t\t\t\t\t\t\tconst char *uuid)\n{\n\tGSList *l;\n\n\tfor (l = dev->services; l != NULL; l = g_slist_next(l)) {\n\t\tstruct btd_service *service = l->data;\n\t\tstruct btd_profile *p = btd_service_get_profile(service);\n\n\t\tif (!p->connect || !p->remote_uuid)\n\t\t\tcontinue;\n\n\t\tif (strcasecmp(uuid, p->remote_uuid) == 0)\n\t\t\treturn service;\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic struct btd_service *find_connectable_service(struct btd_device *dev,\n\t\t\t\t\t\t\tconst char *uuid)\n{\n\tGSList *l;\n\n\tfor (l = dev->services; l != NULL; l = g_slist_next(l)) {\n\t\tstruct btd_service *service = l->data;\n\t\tstruct btd_profile *p = btd_service_get_profile(service);\n\n\t\tif (!p->connect || !p->remote_uuid)\n\t\t\tcontinue;\n\n\t\tif (strcasecmp(uuid, p->remote_uuid) == 0)\n\t\t\treturn service;\n\t}\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_name2string",
          "args": [
            "pattern"
          ],
          "line": 2036
        },
        "resolved": true,
        "details": {
          "function_name": "bt_name2string",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/uuid-helper.c",
          "lines": "181-209",
          "snippet": "char *bt_name2string(const char *pattern)\n{\n\tuuid_t uuid;\n\tuint16_t uuid16;\n\tint i;\n\n\t/* UUID 128 string format */\n\tif (is_uuid128(pattern))\n\t\treturn strdup(pattern);\n\n\t/* Friendly service name format */\n\tuuid16 = name2class(pattern);\n\tif (uuid16)\n\t\tgoto proceed;\n\n\t/* HEX format */\n\tuuid16 = strtol(pattern, NULL, 16);\n\tfor (i = 0; bt_services[i].class; i++) {\n\t\tif (bt_services[i].class == uuid16)\n\t\t\tgoto proceed;\n\t}\n\n\treturn NULL;\n\nproceed:\n\tsdp_uuid16_create(&uuid, uuid16);\n\n\treturn bt_uuid2string(&uuid);\n}",
          "includes": [
            "#include \"uuid-helper.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <arpa/inet.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static struct {\n\tconst char\t*name;\n\tuint16_t\tclass;\n} bt_services[] = {\n\t{ \"pbap\",\tPBAP_SVCLASS_ID\t\t\t},\n\t{ \"sap\",\tSAP_SVCLASS_ID\t\t\t},\n\t{ \"ftp\",\tOBEX_FILETRANS_SVCLASS_ID\t},\n\t{ \"bpp\",\tBASIC_PRINTING_SVCLASS_ID\t},\n\t{ \"bip\",\tIMAGING_SVCLASS_ID\t\t},\n\t{ \"synch\",\tIRMC_SYNC_SVCLASS_ID\t\t},\n\t{ \"dun\",\tDIALUP_NET_SVCLASS_ID\t\t},\n\t{ \"opp\",\tOBEX_OBJPUSH_SVCLASS_ID\t\t},\n\t{ \"fax\",\tFAX_SVCLASS_ID\t\t\t},\n\t{ \"spp\",\tSERIAL_PORT_SVCLASS_ID\t\t},\n\t{ \"hsp\",\tHEADSET_SVCLASS_ID\t\t},\n\t{ \"hsp-hs\",\tHEADSET_SVCLASS_ID\t\t},\n\t{ \"hsp-ag\",\tHEADSET_AGW_SVCLASS_ID\t\t},\n\t{ \"hfp\",\tHANDSFREE_SVCLASS_ID\t\t},\n\t{ \"hfp-hf\",\tHANDSFREE_SVCLASS_ID\t\t},\n\t{ \"hfp-ag\",\tHANDSFREE_AGW_SVCLASS_ID\t},\n\t{ \"pbap-pce\",\tPBAP_PCE_SVCLASS_ID\t\t},\n\t{ \"pbap-pse\",\tPBAP_PSE_SVCLASS_ID\t\t},\n\t{ \"map-mse\",\tMAP_MSE_SVCLASS_ID\t\t},\n\t{ \"map-mas\",\tMAP_MSE_SVCLASS_ID\t\t},\n\t{ \"map-mce\",\tMAP_MCE_SVCLASS_ID\t\t},\n\t{ \"map-mns\",\tMAP_MCE_SVCLASS_ID\t\t},\n\t{ \"gnss\",\tGNSS_SERVER_SVCLASS_ID\t\t},\n\t{ }\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"uuid-helper.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <arpa/inet.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic struct {\n\tconst char\t*name;\n\tuint16_t\tclass;\n} bt_services[] = {\n\t{ \"pbap\",\tPBAP_SVCLASS_ID\t\t\t},\n\t{ \"sap\",\tSAP_SVCLASS_ID\t\t\t},\n\t{ \"ftp\",\tOBEX_FILETRANS_SVCLASS_ID\t},\n\t{ \"bpp\",\tBASIC_PRINTING_SVCLASS_ID\t},\n\t{ \"bip\",\tIMAGING_SVCLASS_ID\t\t},\n\t{ \"synch\",\tIRMC_SYNC_SVCLASS_ID\t\t},\n\t{ \"dun\",\tDIALUP_NET_SVCLASS_ID\t\t},\n\t{ \"opp\",\tOBEX_OBJPUSH_SVCLASS_ID\t\t},\n\t{ \"fax\",\tFAX_SVCLASS_ID\t\t\t},\n\t{ \"spp\",\tSERIAL_PORT_SVCLASS_ID\t\t},\n\t{ \"hsp\",\tHEADSET_SVCLASS_ID\t\t},\n\t{ \"hsp-hs\",\tHEADSET_SVCLASS_ID\t\t},\n\t{ \"hsp-ag\",\tHEADSET_AGW_SVCLASS_ID\t\t},\n\t{ \"hfp\",\tHANDSFREE_SVCLASS_ID\t\t},\n\t{ \"hfp-hf\",\tHANDSFREE_SVCLASS_ID\t\t},\n\t{ \"hfp-ag\",\tHANDSFREE_AGW_SVCLASS_ID\t},\n\t{ \"pbap-pce\",\tPBAP_PCE_SVCLASS_ID\t\t},\n\t{ \"pbap-pse\",\tPBAP_PSE_SVCLASS_ID\t\t},\n\t{ \"map-mse\",\tMAP_MSE_SVCLASS_ID\t\t},\n\t{ \"map-mas\",\tMAP_MSE_SVCLASS_ID\t\t},\n\t{ \"map-mce\",\tMAP_MCE_SVCLASS_ID\t\t},\n\t{ \"map-mns\",\tMAP_MCE_SVCLASS_ID\t\t},\n\t{ \"gnss\",\tGNSS_SERVER_SVCLASS_ID\t\t},\n\t{ }\n};\n\nchar *bt_name2string(const char *pattern)\n{\n\tuuid_t uuid;\n\tuint16_t uuid16;\n\tint i;\n\n\t/* UUID 128 string format */\n\tif (is_uuid128(pattern))\n\t\treturn strdup(pattern);\n\n\t/* Friendly service name format */\n\tuuid16 = name2class(pattern);\n\tif (uuid16)\n\t\tgoto proceed;\n\n\t/* HEX format */\n\tuuid16 = strtol(pattern, NULL, 16);\n\tfor (i = 0; bt_services[i].class; i++) {\n\t\tif (bt_services[i].class == uuid16)\n\t\t\tgoto proceed;\n\t}\n\n\treturn NULL;\n\nproceed:\n\tsdp_uuid16_create(&uuid, uuid16);\n\n\treturn bt_uuid2string(&uuid);\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_get_args",
          "args": [
            "msg",
            "NULL",
            "DBUS_TYPE_STRING",
            "&pattern",
            "DBUS_TYPE_INVALID"
          ],
          "line": 2032
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\n\nstatic DBusMessage *disconnect_profile(DBusConnection *conn, DBusMessage *msg,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct btd_device *dev = user_data;\n\tstruct btd_service *service;\n\tconst char *pattern;\n\tchar *uuid;\n\tint err;\n\n\tif (!dbus_message_get_args(msg, NULL, DBUS_TYPE_STRING, &pattern,\n\t\t\t\t\t\t\tDBUS_TYPE_INVALID))\n\t\treturn btd_error_invalid_args(msg);\n\n\tuuid = bt_name2string(pattern);\n\tif (uuid == NULL)\n\t\treturn btd_error_invalid_args(msg);\n\n\tservice = find_connectable_service(dev, uuid);\n\tfree(uuid);\n\n\tif (!service)\n\t\treturn btd_error_invalid_args(msg);\n\n\tif (dev->disconnect)\n\t\treturn btd_error_in_progress(msg);\n\n\tdev->disconnect = dbus_message_ref(msg);\n\n\terr = btd_service_disconnect(service);\n\tif (err == 0)\n\t\treturn NULL;\n\n\tdbus_message_unref(dev->disconnect);\n\tdev->disconnect = NULL;\n\n\tif (err == -ENOTSUP)\n\t\treturn btd_error_not_supported(msg);\n\n\treturn btd_error_failed(msg, strerror(-err));\n}"
  },
  {
    "function_name": "device_profile_disconnected",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "2005-2021",
    "snippet": "static void device_profile_disconnected(struct btd_device *dev,\n\t\t\t\t\tstruct btd_profile *profile, int err)\n{\n\tif (!dev->disconnect)\n\t\treturn;\n\n\tif (err)\n\t\tg_dbus_send_message(dbus_conn,\n\t\t\t\t\tbtd_error_failed(dev->disconnect,\n\t\t\t\t\t\t\tstrerror(-err)));\n\telse\n\t\tg_dbus_send_reply(dbus_conn, dev->disconnect,\n\t\t\t\t\t\t\tDBUS_TYPE_INVALID);\n\n\tdbus_message_unref(dev->disconnect);\n\tdev->disconnect = NULL;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static DBusConnection *dbus_conn = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_unref",
          "args": [
            "dev->disconnect"
          ],
          "line": 2019
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_send_reply",
          "args": [
            "dbus_conn",
            "dev->disconnect",
            "DBUS_TYPE_INVALID"
          ],
          "line": 2016
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_send_message",
          "args": [
            "dbus_conn",
            "btd_error_failed(dev->disconnect,\n\t\t\t\t\t\t\tstrerror(-err))"
          ],
          "line": 2012
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_error_failed",
          "args": [
            "dev->disconnect",
            "strerror(-err)"
          ],
          "line": 2013
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "124-128",
          "snippet": "DBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "strerror",
          "args": [
            "-err"
          ],
          "line": 2014
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\n\nstatic void device_profile_disconnected(struct btd_device *dev,\n\t\t\t\t\tstruct btd_profile *profile, int err)\n{\n\tif (!dev->disconnect)\n\t\treturn;\n\n\tif (err)\n\t\tg_dbus_send_message(dbus_conn,\n\t\t\t\t\tbtd_error_failed(dev->disconnect,\n\t\t\t\t\t\t\tstrerror(-err)));\n\telse\n\t\tg_dbus_send_reply(dbus_conn, dev->disconnect,\n\t\t\t\t\t\t\tDBUS_TYPE_INVALID);\n\n\tdbus_message_unref(dev->disconnect);\n\tdev->disconnect = NULL;\n}"
  },
  {
    "function_name": "connect_profile",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "1986-2003",
    "snippet": "static DBusMessage *connect_profile(DBusConnection *conn, DBusMessage *msg,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct btd_device *dev = user_data;\n\tconst char *pattern;\n\tchar *uuid;\n\tDBusMessage *reply;\n\n\tif (!dbus_message_get_args(msg, NULL, DBUS_TYPE_STRING, &pattern,\n\t\t\t\t\t\t\tDBUS_TYPE_INVALID))\n\t\treturn btd_error_invalid_args(msg);\n\n\tuuid = bt_name2string(pattern);\n\treply = connect_profiles(dev, BDADDR_BREDR, msg, uuid);\n\tfree(uuid);\n\n\treturn reply;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
      "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "uuid"
          ],
          "line": 2000
        },
        "resolved": true,
        "details": {
          "function_name": "device_auth_req_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5662-5676",
          "snippet": "static void device_auth_req_free(struct btd_device *device)\n{\n\tstruct authentication_req *authr = device->authr;\n\n\tif (!authr)\n\t\treturn;\n\n\tif (authr->agent)\n\t\tagent_unref(authr->agent);\n\n\tg_free(authr->pincode);\n\tg_free(authr);\n\n\tdevice->authr = NULL;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void device_auth_req_free(struct btd_device *device)\n{\n\tstruct authentication_req *authr = device->authr;\n\n\tif (!authr)\n\t\treturn;\n\n\tif (authr->agent)\n\t\tagent_unref(authr->agent);\n\n\tg_free(authr->pincode);\n\tg_free(authr);\n\n\tdevice->authr = NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "connect_profiles",
          "args": [
            "dev",
            "BDADDR_BREDR",
            "msg",
            "uuid"
          ],
          "line": 1999
        },
        "resolved": true,
        "details": {
          "function_name": "connect_profiles",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "1833-1888",
          "snippet": "static DBusMessage *connect_profiles(struct btd_device *dev, uint8_t bdaddr_type,\n\t\t\t\t\tDBusMessage *msg, const char *uuid)\n{\n\tstruct bearer_state *state = get_state(dev, bdaddr_type);\n\tint err;\n\n\tDBG(\"%s %s, client %s\", dev->path, uuid ? uuid : \"(all)\",\n\t\t\t\t\t\tdbus_message_get_sender(msg));\n\n\tif (dev->pending || dev->connect || dev->browse)\n\t\treturn btd_error_in_progress(msg);\n\n\tif (!btd_adapter_get_powered(dev->adapter))\n\t\treturn btd_error_not_ready(msg);\n\n\tbtd_device_set_temporary(dev, false);\n\n\tif (!state->svc_resolved)\n\t\tgoto resolve_services;\n\n\tdev->pending = create_pending_list(dev, uuid);\n\tif (!dev->pending) {\n\t\tif (dev->svc_refreshed) {\n\t\t\tif (find_service_with_state(dev->services,\n\t\t\t\t\t\tBTD_SERVICE_STATE_CONNECTED))\n\t\t\t\treturn dbus_message_new_method_return(msg);\n\t\t\telse\n\t\t\t\treturn btd_error_not_available(msg);\n\t\t}\n\n\t\tgoto resolve_services;\n\t}\n\n\terr = connect_next(dev);\n\tif (err < 0) {\n\t\tif (err == -EALREADY)\n\t\t\treturn dbus_message_new_method_return(msg);\n\t\treturn btd_error_failed(msg, strerror(-err));\n\t}\n\n\tdev->connect = dbus_message_ref(msg);\n\n\treturn NULL;\n\nresolve_services:\n\tDBG(\"Resolving services for %s\", dev->path);\n\n\tif (bdaddr_type == BDADDR_BREDR)\n\t\terr = device_browse_sdp(dev, msg);\n\telse\n\t\terr = device_browse_gatt(dev, msg);\n\tif (err < 0)\n\t\treturn btd_error_failed(msg, strerror(-err));\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
            "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\n\nstatic DBusMessage *connect_profiles(struct btd_device *dev, uint8_t bdaddr_type,\n\t\t\t\t\tDBusMessage *msg, const char *uuid)\n{\n\tstruct bearer_state *state = get_state(dev, bdaddr_type);\n\tint err;\n\n\tDBG(\"%s %s, client %s\", dev->path, uuid ? uuid : \"(all)\",\n\t\t\t\t\t\tdbus_message_get_sender(msg));\n\n\tif (dev->pending || dev->connect || dev->browse)\n\t\treturn btd_error_in_progress(msg);\n\n\tif (!btd_adapter_get_powered(dev->adapter))\n\t\treturn btd_error_not_ready(msg);\n\n\tbtd_device_set_temporary(dev, false);\n\n\tif (!state->svc_resolved)\n\t\tgoto resolve_services;\n\n\tdev->pending = create_pending_list(dev, uuid);\n\tif (!dev->pending) {\n\t\tif (dev->svc_refreshed) {\n\t\t\tif (find_service_with_state(dev->services,\n\t\t\t\t\t\tBTD_SERVICE_STATE_CONNECTED))\n\t\t\t\treturn dbus_message_new_method_return(msg);\n\t\t\telse\n\t\t\t\treturn btd_error_not_available(msg);\n\t\t}\n\n\t\tgoto resolve_services;\n\t}\n\n\terr = connect_next(dev);\n\tif (err < 0) {\n\t\tif (err == -EALREADY)\n\t\t\treturn dbus_message_new_method_return(msg);\n\t\treturn btd_error_failed(msg, strerror(-err));\n\t}\n\n\tdev->connect = dbus_message_ref(msg);\n\n\treturn NULL;\n\nresolve_services:\n\tDBG(\"Resolving services for %s\", dev->path);\n\n\tif (bdaddr_type == BDADDR_BREDR)\n\t\terr = device_browse_sdp(dev, msg);\n\telse\n\t\terr = device_browse_gatt(dev, msg);\n\tif (err < 0)\n\t\treturn btd_error_failed(msg, strerror(-err));\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_name2string",
          "args": [
            "pattern"
          ],
          "line": 1998
        },
        "resolved": true,
        "details": {
          "function_name": "bt_name2string",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/uuid-helper.c",
          "lines": "181-209",
          "snippet": "char *bt_name2string(const char *pattern)\n{\n\tuuid_t uuid;\n\tuint16_t uuid16;\n\tint i;\n\n\t/* UUID 128 string format */\n\tif (is_uuid128(pattern))\n\t\treturn strdup(pattern);\n\n\t/* Friendly service name format */\n\tuuid16 = name2class(pattern);\n\tif (uuid16)\n\t\tgoto proceed;\n\n\t/* HEX format */\n\tuuid16 = strtol(pattern, NULL, 16);\n\tfor (i = 0; bt_services[i].class; i++) {\n\t\tif (bt_services[i].class == uuid16)\n\t\t\tgoto proceed;\n\t}\n\n\treturn NULL;\n\nproceed:\n\tsdp_uuid16_create(&uuid, uuid16);\n\n\treturn bt_uuid2string(&uuid);\n}",
          "includes": [
            "#include \"uuid-helper.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <arpa/inet.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static struct {\n\tconst char\t*name;\n\tuint16_t\tclass;\n} bt_services[] = {\n\t{ \"pbap\",\tPBAP_SVCLASS_ID\t\t\t},\n\t{ \"sap\",\tSAP_SVCLASS_ID\t\t\t},\n\t{ \"ftp\",\tOBEX_FILETRANS_SVCLASS_ID\t},\n\t{ \"bpp\",\tBASIC_PRINTING_SVCLASS_ID\t},\n\t{ \"bip\",\tIMAGING_SVCLASS_ID\t\t},\n\t{ \"synch\",\tIRMC_SYNC_SVCLASS_ID\t\t},\n\t{ \"dun\",\tDIALUP_NET_SVCLASS_ID\t\t},\n\t{ \"opp\",\tOBEX_OBJPUSH_SVCLASS_ID\t\t},\n\t{ \"fax\",\tFAX_SVCLASS_ID\t\t\t},\n\t{ \"spp\",\tSERIAL_PORT_SVCLASS_ID\t\t},\n\t{ \"hsp\",\tHEADSET_SVCLASS_ID\t\t},\n\t{ \"hsp-hs\",\tHEADSET_SVCLASS_ID\t\t},\n\t{ \"hsp-ag\",\tHEADSET_AGW_SVCLASS_ID\t\t},\n\t{ \"hfp\",\tHANDSFREE_SVCLASS_ID\t\t},\n\t{ \"hfp-hf\",\tHANDSFREE_SVCLASS_ID\t\t},\n\t{ \"hfp-ag\",\tHANDSFREE_AGW_SVCLASS_ID\t},\n\t{ \"pbap-pce\",\tPBAP_PCE_SVCLASS_ID\t\t},\n\t{ \"pbap-pse\",\tPBAP_PSE_SVCLASS_ID\t\t},\n\t{ \"map-mse\",\tMAP_MSE_SVCLASS_ID\t\t},\n\t{ \"map-mas\",\tMAP_MSE_SVCLASS_ID\t\t},\n\t{ \"map-mce\",\tMAP_MCE_SVCLASS_ID\t\t},\n\t{ \"map-mns\",\tMAP_MCE_SVCLASS_ID\t\t},\n\t{ \"gnss\",\tGNSS_SERVER_SVCLASS_ID\t\t},\n\t{ }\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"uuid-helper.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <arpa/inet.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic struct {\n\tconst char\t*name;\n\tuint16_t\tclass;\n} bt_services[] = {\n\t{ \"pbap\",\tPBAP_SVCLASS_ID\t\t\t},\n\t{ \"sap\",\tSAP_SVCLASS_ID\t\t\t},\n\t{ \"ftp\",\tOBEX_FILETRANS_SVCLASS_ID\t},\n\t{ \"bpp\",\tBASIC_PRINTING_SVCLASS_ID\t},\n\t{ \"bip\",\tIMAGING_SVCLASS_ID\t\t},\n\t{ \"synch\",\tIRMC_SYNC_SVCLASS_ID\t\t},\n\t{ \"dun\",\tDIALUP_NET_SVCLASS_ID\t\t},\n\t{ \"opp\",\tOBEX_OBJPUSH_SVCLASS_ID\t\t},\n\t{ \"fax\",\tFAX_SVCLASS_ID\t\t\t},\n\t{ \"spp\",\tSERIAL_PORT_SVCLASS_ID\t\t},\n\t{ \"hsp\",\tHEADSET_SVCLASS_ID\t\t},\n\t{ \"hsp-hs\",\tHEADSET_SVCLASS_ID\t\t},\n\t{ \"hsp-ag\",\tHEADSET_AGW_SVCLASS_ID\t\t},\n\t{ \"hfp\",\tHANDSFREE_SVCLASS_ID\t\t},\n\t{ \"hfp-hf\",\tHANDSFREE_SVCLASS_ID\t\t},\n\t{ \"hfp-ag\",\tHANDSFREE_AGW_SVCLASS_ID\t},\n\t{ \"pbap-pce\",\tPBAP_PCE_SVCLASS_ID\t\t},\n\t{ \"pbap-pse\",\tPBAP_PSE_SVCLASS_ID\t\t},\n\t{ \"map-mse\",\tMAP_MSE_SVCLASS_ID\t\t},\n\t{ \"map-mas\",\tMAP_MSE_SVCLASS_ID\t\t},\n\t{ \"map-mce\",\tMAP_MCE_SVCLASS_ID\t\t},\n\t{ \"map-mns\",\tMAP_MCE_SVCLASS_ID\t\t},\n\t{ \"gnss\",\tGNSS_SERVER_SVCLASS_ID\t\t},\n\t{ }\n};\n\nchar *bt_name2string(const char *pattern)\n{\n\tuuid_t uuid;\n\tuint16_t uuid16;\n\tint i;\n\n\t/* UUID 128 string format */\n\tif (is_uuid128(pattern))\n\t\treturn strdup(pattern);\n\n\t/* Friendly service name format */\n\tuuid16 = name2class(pattern);\n\tif (uuid16)\n\t\tgoto proceed;\n\n\t/* HEX format */\n\tuuid16 = strtol(pattern, NULL, 16);\n\tfor (i = 0; bt_services[i].class; i++) {\n\t\tif (bt_services[i].class == uuid16)\n\t\t\tgoto proceed;\n\t}\n\n\treturn NULL;\n\nproceed:\n\tsdp_uuid16_create(&uuid, uuid16);\n\n\treturn bt_uuid2string(&uuid);\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_error_invalid_args",
          "args": [
            "msg"
          ],
          "line": 1996
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_invalid_args",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "34-38",
          "snippet": "DBusMessage *btd_error_invalid_args(DBusMessage *msg)\n{\n\treturn btd_error_invalid_args_str(msg,\n\t\t\t\t\t\"Invalid arguments in method call\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_invalid_args(DBusMessage *msg)\n{\n\treturn btd_error_invalid_args_str(msg,\n\t\t\t\t\t\"Invalid arguments in method call\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_get_args",
          "args": [
            "msg",
            "NULL",
            "DBUS_TYPE_STRING",
            "&pattern",
            "DBUS_TYPE_INVALID"
          ],
          "line": 1994
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\n\nstatic DBusMessage *connect_profile(DBusConnection *conn, DBusMessage *msg,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct btd_device *dev = user_data;\n\tconst char *pattern;\n\tchar *uuid;\n\tDBusMessage *reply;\n\n\tif (!dbus_message_get_args(msg, NULL, DBUS_TYPE_STRING, &pattern,\n\t\t\t\t\t\t\tDBUS_TYPE_INVALID))\n\t\treturn btd_error_invalid_args(msg);\n\n\tuuid = bt_name2string(pattern);\n\treply = connect_profiles(dev, BDADDR_BREDR, msg, uuid);\n\tfree(uuid);\n\n\treturn reply;\n}"
  },
  {
    "function_name": "dev_connect",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "1939-1984",
    "snippet": "static DBusMessage *dev_connect(DBusConnection *conn, DBusMessage *msg,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct btd_device *dev = user_data;\n\tuint8_t bdaddr_type;\n\n\tif (dev->bredr_state.connected) {\n\t\t/*\n\t\t * Check if services have been resolved and there is at list\n\t\t * one connected before switching to connect LE.\n\t\t */\n\t\tif (dev->bredr_state.svc_resolved &&\n\t\t\tfind_service_with_state(dev->services,\n\t\t\t\t\t\tBTD_SERVICE_STATE_CONNECTED))\n\t\t\tbdaddr_type = dev->bdaddr_type;\n\t\telse\n\t\t\tbdaddr_type = BDADDR_BREDR;\n\t} else if (dev->le_state.connected && dev->bredr)\n\t\tbdaddr_type = BDADDR_BREDR;\n\telse\n\t\tbdaddr_type = select_conn_bearer(dev);\n\n\tif (bdaddr_type != BDADDR_BREDR) {\n\t\tint err;\n\n\t\tif (dev->le_state.connected)\n\t\t\treturn dbus_message_new_method_return(msg);\n\n\t\tbtd_device_set_temporary(dev, false);\n\n\t\tif (dev->disable_auto_connect) {\n\t\t\tdev->disable_auto_connect = FALSE;\n\t\t\tdevice_set_auto_connect(dev, TRUE);\n\t\t}\n\n\t\terr = device_connect_le(dev);\n\t\tif (err < 0)\n\t\t\treturn btd_error_failed(msg, strerror(-err));\n\n\t\tdev->connect = dbus_message_ref(msg);\n\n\t\treturn NULL;\n\t}\n\n\treturn connect_profiles(dev, bdaddr_type, msg, NULL);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
      "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "connect_profiles",
          "args": [
            "dev",
            "bdaddr_type",
            "msg",
            "NULL"
          ],
          "line": 1983
        },
        "resolved": true,
        "details": {
          "function_name": "connect_profiles",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "1833-1888",
          "snippet": "static DBusMessage *connect_profiles(struct btd_device *dev, uint8_t bdaddr_type,\n\t\t\t\t\tDBusMessage *msg, const char *uuid)\n{\n\tstruct bearer_state *state = get_state(dev, bdaddr_type);\n\tint err;\n\n\tDBG(\"%s %s, client %s\", dev->path, uuid ? uuid : \"(all)\",\n\t\t\t\t\t\tdbus_message_get_sender(msg));\n\n\tif (dev->pending || dev->connect || dev->browse)\n\t\treturn btd_error_in_progress(msg);\n\n\tif (!btd_adapter_get_powered(dev->adapter))\n\t\treturn btd_error_not_ready(msg);\n\n\tbtd_device_set_temporary(dev, false);\n\n\tif (!state->svc_resolved)\n\t\tgoto resolve_services;\n\n\tdev->pending = create_pending_list(dev, uuid);\n\tif (!dev->pending) {\n\t\tif (dev->svc_refreshed) {\n\t\t\tif (find_service_with_state(dev->services,\n\t\t\t\t\t\tBTD_SERVICE_STATE_CONNECTED))\n\t\t\t\treturn dbus_message_new_method_return(msg);\n\t\t\telse\n\t\t\t\treturn btd_error_not_available(msg);\n\t\t}\n\n\t\tgoto resolve_services;\n\t}\n\n\terr = connect_next(dev);\n\tif (err < 0) {\n\t\tif (err == -EALREADY)\n\t\t\treturn dbus_message_new_method_return(msg);\n\t\treturn btd_error_failed(msg, strerror(-err));\n\t}\n\n\tdev->connect = dbus_message_ref(msg);\n\n\treturn NULL;\n\nresolve_services:\n\tDBG(\"Resolving services for %s\", dev->path);\n\n\tif (bdaddr_type == BDADDR_BREDR)\n\t\terr = device_browse_sdp(dev, msg);\n\telse\n\t\terr = device_browse_gatt(dev, msg);\n\tif (err < 0)\n\t\treturn btd_error_failed(msg, strerror(-err));\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
            "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\n\nstatic DBusMessage *connect_profiles(struct btd_device *dev, uint8_t bdaddr_type,\n\t\t\t\t\tDBusMessage *msg, const char *uuid)\n{\n\tstruct bearer_state *state = get_state(dev, bdaddr_type);\n\tint err;\n\n\tDBG(\"%s %s, client %s\", dev->path, uuid ? uuid : \"(all)\",\n\t\t\t\t\t\tdbus_message_get_sender(msg));\n\n\tif (dev->pending || dev->connect || dev->browse)\n\t\treturn btd_error_in_progress(msg);\n\n\tif (!btd_adapter_get_powered(dev->adapter))\n\t\treturn btd_error_not_ready(msg);\n\n\tbtd_device_set_temporary(dev, false);\n\n\tif (!state->svc_resolved)\n\t\tgoto resolve_services;\n\n\tdev->pending = create_pending_list(dev, uuid);\n\tif (!dev->pending) {\n\t\tif (dev->svc_refreshed) {\n\t\t\tif (find_service_with_state(dev->services,\n\t\t\t\t\t\tBTD_SERVICE_STATE_CONNECTED))\n\t\t\t\treturn dbus_message_new_method_return(msg);\n\t\t\telse\n\t\t\t\treturn btd_error_not_available(msg);\n\t\t}\n\n\t\tgoto resolve_services;\n\t}\n\n\terr = connect_next(dev);\n\tif (err < 0) {\n\t\tif (err == -EALREADY)\n\t\t\treturn dbus_message_new_method_return(msg);\n\t\treturn btd_error_failed(msg, strerror(-err));\n\t}\n\n\tdev->connect = dbus_message_ref(msg);\n\n\treturn NULL;\n\nresolve_services:\n\tDBG(\"Resolving services for %s\", dev->path);\n\n\tif (bdaddr_type == BDADDR_BREDR)\n\t\terr = device_browse_sdp(dev, msg);\n\telse\n\t\terr = device_browse_gatt(dev, msg);\n\tif (err < 0)\n\t\treturn btd_error_failed(msg, strerror(-err));\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_ref",
          "args": [
            "msg"
          ],
          "line": 1978
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_error_failed",
          "args": [
            "msg",
            "strerror(-err)"
          ],
          "line": 1976
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "124-128",
          "snippet": "DBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "strerror",
          "args": [
            "-err"
          ],
          "line": 1976
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device_connect_le",
          "args": [
            "dev"
          ],
          "line": 1974
        },
        "resolved": true,
        "details": {
          "function_name": "device_connect_le",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5103-5158",
          "snippet": "int device_connect_le(struct btd_device *dev)\n{\n\tstruct btd_adapter *adapter = dev->adapter;\n\tBtIOSecLevel sec_level;\n\tGIOChannel *io;\n\tGError *gerr = NULL;\n\tchar addr[18];\n\n\t/* There is one connection attempt going on */\n\tif (dev->att_io)\n\t\treturn -EALREADY;\n\n\tba2str(&dev->bdaddr, addr);\n\n\tDBG(\"Connection attempt to: %s\", addr);\n\n\tif (dev->le_state.paired)\n\t\tsec_level = BT_IO_SEC_MEDIUM;\n\telse\n\t\tsec_level = BT_IO_SEC_LOW;\n\n\t/*\n\t * This connection will help us catch any PDUs that comes before\n\t * pairing finishes\n\t */\n\tio = bt_io_connect(att_connect_cb, dev, NULL, &gerr,\n\t\t\tBT_IO_OPT_SOURCE_BDADDR,\n\t\t\tbtd_adapter_get_address(adapter),\n\t\t\tBT_IO_OPT_SOURCE_TYPE,\n\t\t\tbtd_adapter_get_address_type(adapter),\n\t\t\tBT_IO_OPT_DEST_BDADDR, &dev->bdaddr,\n\t\t\tBT_IO_OPT_DEST_TYPE, dev->bdaddr_type,\n\t\t\tBT_IO_OPT_CID, ATT_CID,\n\t\t\tBT_IO_OPT_SEC_LEVEL, sec_level,\n\t\t\tBT_IO_OPT_INVALID);\n\n\tif (io == NULL) {\n\t\tif (dev->bonding) {\n\t\t\tDBusMessage *reply = btd_error_failed(\n\t\t\t\t\tdev->bonding->msg, gerr->message);\n\n\t\t\tg_dbus_send_message(dbus_conn, reply);\n\t\t\tbonding_request_cancel(dev->bonding);\n\t\t\tbonding_request_free(dev->bonding);\n\t\t}\n\n\t\terror(\"ATT bt_io_connect(%s): %s\", addr, gerr->message);\n\t\tg_error_free(gerr);\n\t\treturn -EIO;\n\t}\n\n\t/* Keep this, so we can cancel the connection */\n\tdev->att_io = io;\n\n\treturn 0;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *dbus_conn = NULL;",
            "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
            "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\n\nint device_connect_le(struct btd_device *dev)\n{\n\tstruct btd_adapter *adapter = dev->adapter;\n\tBtIOSecLevel sec_level;\n\tGIOChannel *io;\n\tGError *gerr = NULL;\n\tchar addr[18];\n\n\t/* There is one connection attempt going on */\n\tif (dev->att_io)\n\t\treturn -EALREADY;\n\n\tba2str(&dev->bdaddr, addr);\n\n\tDBG(\"Connection attempt to: %s\", addr);\n\n\tif (dev->le_state.paired)\n\t\tsec_level = BT_IO_SEC_MEDIUM;\n\telse\n\t\tsec_level = BT_IO_SEC_LOW;\n\n\t/*\n\t * This connection will help us catch any PDUs that comes before\n\t * pairing finishes\n\t */\n\tio = bt_io_connect(att_connect_cb, dev, NULL, &gerr,\n\t\t\tBT_IO_OPT_SOURCE_BDADDR,\n\t\t\tbtd_adapter_get_address(adapter),\n\t\t\tBT_IO_OPT_SOURCE_TYPE,\n\t\t\tbtd_adapter_get_address_type(adapter),\n\t\t\tBT_IO_OPT_DEST_BDADDR, &dev->bdaddr,\n\t\t\tBT_IO_OPT_DEST_TYPE, dev->bdaddr_type,\n\t\t\tBT_IO_OPT_CID, ATT_CID,\n\t\t\tBT_IO_OPT_SEC_LEVEL, sec_level,\n\t\t\tBT_IO_OPT_INVALID);\n\n\tif (io == NULL) {\n\t\tif (dev->bonding) {\n\t\t\tDBusMessage *reply = btd_error_failed(\n\t\t\t\t\tdev->bonding->msg, gerr->message);\n\n\t\t\tg_dbus_send_message(dbus_conn, reply);\n\t\t\tbonding_request_cancel(dev->bonding);\n\t\t\tbonding_request_free(dev->bonding);\n\t\t}\n\n\t\terror(\"ATT bt_io_connect(%s): %s\", addr, gerr->message);\n\t\tg_error_free(gerr);\n\t\treturn -EIO;\n\t}\n\n\t/* Keep this, so we can cancel the connection */\n\tdev->att_io = io;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "device_set_auto_connect",
          "args": [
            "dev",
            "TRUE"
          ],
          "line": 1971
        },
        "resolved": true,
        "details": {
          "function_name": "device_set_auto_connect",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "1508-1540",
          "snippet": "static void device_set_auto_connect(struct btd_device *device, gboolean enable)\n{\n\tchar addr[18];\n\n\tif (!device || !device->le)\n\t\treturn;\n\n\tba2str(&device->bdaddr, addr);\n\n\tDBG(\"%s auto connect: %d\", addr, enable);\n\n\tif (device->auto_connect == enable)\n\t\treturn;\n\n\tdevice->auto_connect = enable;\n\n\t/* Disabling auto connect */\n\tif (enable == FALSE) {\n\t\tadapter_connect_list_remove(device->adapter, device);\n\t\tadapter_auto_connect_remove(device->adapter, device);\n\t\treturn;\n\t}\n\n\t/* Enabling auto connect */\n\tadapter_auto_connect_add(device->adapter, device);\n\n\tif (device->attrib) {\n\t\tDBG(\"Already connected\");\n\t\treturn;\n\t}\n\n\tadapter_connect_list_add(device->adapter, device);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void device_set_auto_connect(struct btd_device *device, gboolean enable)\n{\n\tchar addr[18];\n\n\tif (!device || !device->le)\n\t\treturn;\n\n\tba2str(&device->bdaddr, addr);\n\n\tDBG(\"%s auto connect: %d\", addr, enable);\n\n\tif (device->auto_connect == enable)\n\t\treturn;\n\n\tdevice->auto_connect = enable;\n\n\t/* Disabling auto connect */\n\tif (enable == FALSE) {\n\t\tadapter_connect_list_remove(device->adapter, device);\n\t\tadapter_auto_connect_remove(device->adapter, device);\n\t\treturn;\n\t}\n\n\t/* Enabling auto connect */\n\tadapter_auto_connect_add(device->adapter, device);\n\n\tif (device->attrib) {\n\t\tDBG(\"Already connected\");\n\t\treturn;\n\t}\n\n\tadapter_connect_list_add(device->adapter, device);\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_device_set_temporary",
          "args": [
            "dev",
            "false"
          ],
          "line": 1967
        },
        "resolved": true,
        "details": {
          "function_name": "btd_device_set_temporary",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5336-5368",
          "snippet": "void btd_device_set_temporary(struct btd_device *device, bool temporary)\n{\n\tif (!device)\n\t\treturn;\n\n\tif (device->temporary == temporary)\n\t\treturn;\n\n\tif (device_address_is_private(device))\n\t\treturn;\n\n\tDBG(\"temporary %d\", temporary);\n\n\tdevice->temporary = temporary;\n\n\tif (temporary) {\n\t\tif (device->bredr)\n\t\t\tadapter_whitelist_remove(device->adapter, device);\n\t\tadapter_connect_list_remove(device->adapter, device);\n\t\treturn;\n\t}\n\n\tif (device->bredr)\n\t\tadapter_whitelist_add(device->adapter, device);\n\n\tstore_device_info(device);\n\n\t/* attributes were not stored when resolved if device was temporary */\n\tif (device->bdaddr_type != BDADDR_BREDR &&\n\t\t\tdevice->le_state.svc_resolved &&\n\t\t\tg_slist_length(device->primaries) != 0)\n\t\tstore_services(device);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid btd_device_set_temporary(struct btd_device *device, bool temporary)\n{\n\tif (!device)\n\t\treturn;\n\n\tif (device->temporary == temporary)\n\t\treturn;\n\n\tif (device_address_is_private(device))\n\t\treturn;\n\n\tDBG(\"temporary %d\", temporary);\n\n\tdevice->temporary = temporary;\n\n\tif (temporary) {\n\t\tif (device->bredr)\n\t\t\tadapter_whitelist_remove(device->adapter, device);\n\t\tadapter_connect_list_remove(device->adapter, device);\n\t\treturn;\n\t}\n\n\tif (device->bredr)\n\t\tadapter_whitelist_add(device->adapter, device);\n\n\tstore_device_info(device);\n\n\t/* attributes were not stored when resolved if device was temporary */\n\tif (device->bdaddr_type != BDADDR_BREDR &&\n\t\t\tdevice->le_state.svc_resolved &&\n\t\t\tg_slist_length(device->primaries) != 0)\n\t\tstore_services(device);\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_new_method_return",
          "args": [
            "msg"
          ],
          "line": 1965
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "select_conn_bearer",
          "args": [
            "dev"
          ],
          "line": 1959
        },
        "resolved": true,
        "details": {
          "function_name": "select_conn_bearer",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "1893-1937",
          "snippet": "static uint8_t select_conn_bearer(struct btd_device *dev)\n{\n\ttime_t bredr_last = NVAL_TIME, le_last = NVAL_TIME;\n\ttime_t current = time(NULL);\n\n\t/* Prefer bonded bearer in case only one is bonded */\n\tif (dev->bredr_state.bonded && !dev->le_state.bonded )\n\t\treturn BDADDR_BREDR;\n\telse if (!dev->bredr_state.bonded && dev->le_state.bonded)\n\t\treturn dev->bdaddr_type;\n\n\t/* If the address is random it can only be connected over LE */\n\tif (dev->bdaddr_type == BDADDR_LE_RANDOM)\n\t\treturn dev->bdaddr_type;\n\n\tif (dev->bredr_seen) {\n\t\tbredr_last = current - dev->bredr_seen;\n\t\tif (bredr_last > SEEN_TRESHHOLD)\n\t\t\tbredr_last = NVAL_TIME;\n\t}\n\n\tif (dev->le_seen) {\n\t\tle_last = current - dev->le_seen;\n\t\tif (le_last > SEEN_TRESHHOLD)\n\t\t\tle_last = NVAL_TIME;\n\t}\n\n\tif (le_last == NVAL_TIME && bredr_last == NVAL_TIME)\n\t\treturn dev->bdaddr_type;\n\n\tif (dev->bredr && (!dev->le || le_last == NVAL_TIME))\n\t\treturn BDADDR_BREDR;\n\n\tif (dev->le && (!dev->bredr || bredr_last == NVAL_TIME))\n\t\treturn dev->bdaddr_type;\n\n\t/*\n\t * Prefer BR/EDR if time is the same since it might be from an\n\t * advertisement with BR/EDR flag set.\n\t */\n\tif (bredr_last <= le_last && btd_adapter_get_bredr(dev->adapter))\n\t\treturn BDADDR_BREDR;\n\n\treturn dev->bdaddr_type;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define SEEN_TRESHHOLD 300",
            "#define NVAL_TIME ((time_t) -1)"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\n#define SEEN_TRESHHOLD 300\n#define NVAL_TIME ((time_t) -1)\n\nstatic uint8_t select_conn_bearer(struct btd_device *dev)\n{\n\ttime_t bredr_last = NVAL_TIME, le_last = NVAL_TIME;\n\ttime_t current = time(NULL);\n\n\t/* Prefer bonded bearer in case only one is bonded */\n\tif (dev->bredr_state.bonded && !dev->le_state.bonded )\n\t\treturn BDADDR_BREDR;\n\telse if (!dev->bredr_state.bonded && dev->le_state.bonded)\n\t\treturn dev->bdaddr_type;\n\n\t/* If the address is random it can only be connected over LE */\n\tif (dev->bdaddr_type == BDADDR_LE_RANDOM)\n\t\treturn dev->bdaddr_type;\n\n\tif (dev->bredr_seen) {\n\t\tbredr_last = current - dev->bredr_seen;\n\t\tif (bredr_last > SEEN_TRESHHOLD)\n\t\t\tbredr_last = NVAL_TIME;\n\t}\n\n\tif (dev->le_seen) {\n\t\tle_last = current - dev->le_seen;\n\t\tif (le_last > SEEN_TRESHHOLD)\n\t\t\tle_last = NVAL_TIME;\n\t}\n\n\tif (le_last == NVAL_TIME && bredr_last == NVAL_TIME)\n\t\treturn dev->bdaddr_type;\n\n\tif (dev->bredr && (!dev->le || le_last == NVAL_TIME))\n\t\treturn BDADDR_BREDR;\n\n\tif (dev->le && (!dev->bredr || bredr_last == NVAL_TIME))\n\t\treturn dev->bdaddr_type;\n\n\t/*\n\t * Prefer BR/EDR if time is the same since it might be from an\n\t * advertisement with BR/EDR flag set.\n\t */\n\tif (bredr_last <= le_last && btd_adapter_get_bredr(dev->adapter))\n\t\treturn BDADDR_BREDR;\n\n\treturn dev->bdaddr_type;\n}"
        }
      },
      {
        "call_info": {
          "callee": "find_service_with_state",
          "args": [
            "dev->services",
            "BTD_SERVICE_STATE_CONNECTED"
          ],
          "line": 1951
        },
        "resolved": true,
        "details": {
          "function_name": "find_service_with_state",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "298-311",
          "snippet": "static GSList *find_service_with_state(GSList *list,\n\t\t\t\t\t\tbtd_service_state_t state)\n{\n\tGSList *l;\n\n\tfor (l = list; l != NULL; l = g_slist_next(l)) {\n\t\tstruct btd_service *service = l->data;\n\n\t\tif (btd_service_get_state(service) == state)\n\t\t\treturn l;\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic GSList *find_service_with_state(GSList *list,\n\t\t\t\t\t\tbtd_service_state_t state)\n{\n\tGSList *l;\n\n\tfor (l = list; l != NULL; l = g_slist_next(l)) {\n\t\tstruct btd_service *service = l->data;\n\n\t\tif (btd_service_get_state(service) == state)\n\t\t\treturn l;\n\t}\n\n\treturn NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\n\nstatic DBusMessage *dev_connect(DBusConnection *conn, DBusMessage *msg,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct btd_device *dev = user_data;\n\tuint8_t bdaddr_type;\n\n\tif (dev->bredr_state.connected) {\n\t\t/*\n\t\t * Check if services have been resolved and there is at list\n\t\t * one connected before switching to connect LE.\n\t\t */\n\t\tif (dev->bredr_state.svc_resolved &&\n\t\t\tfind_service_with_state(dev->services,\n\t\t\t\t\t\tBTD_SERVICE_STATE_CONNECTED))\n\t\t\tbdaddr_type = dev->bdaddr_type;\n\t\telse\n\t\t\tbdaddr_type = BDADDR_BREDR;\n\t} else if (dev->le_state.connected && dev->bredr)\n\t\tbdaddr_type = BDADDR_BREDR;\n\telse\n\t\tbdaddr_type = select_conn_bearer(dev);\n\n\tif (bdaddr_type != BDADDR_BREDR) {\n\t\tint err;\n\n\t\tif (dev->le_state.connected)\n\t\t\treturn dbus_message_new_method_return(msg);\n\n\t\tbtd_device_set_temporary(dev, false);\n\n\t\tif (dev->disable_auto_connect) {\n\t\t\tdev->disable_auto_connect = FALSE;\n\t\t\tdevice_set_auto_connect(dev, TRUE);\n\t\t}\n\n\t\terr = device_connect_le(dev);\n\t\tif (err < 0)\n\t\t\treturn btd_error_failed(msg, strerror(-err));\n\n\t\tdev->connect = dbus_message_ref(msg);\n\n\t\treturn NULL;\n\t}\n\n\treturn connect_profiles(dev, bdaddr_type, msg, NULL);\n}"
  },
  {
    "function_name": "select_conn_bearer",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "1893-1937",
    "snippet": "static uint8_t select_conn_bearer(struct btd_device *dev)\n{\n\ttime_t bredr_last = NVAL_TIME, le_last = NVAL_TIME;\n\ttime_t current = time(NULL);\n\n\t/* Prefer bonded bearer in case only one is bonded */\n\tif (dev->bredr_state.bonded && !dev->le_state.bonded )\n\t\treturn BDADDR_BREDR;\n\telse if (!dev->bredr_state.bonded && dev->le_state.bonded)\n\t\treturn dev->bdaddr_type;\n\n\t/* If the address is random it can only be connected over LE */\n\tif (dev->bdaddr_type == BDADDR_LE_RANDOM)\n\t\treturn dev->bdaddr_type;\n\n\tif (dev->bredr_seen) {\n\t\tbredr_last = current - dev->bredr_seen;\n\t\tif (bredr_last > SEEN_TRESHHOLD)\n\t\t\tbredr_last = NVAL_TIME;\n\t}\n\n\tif (dev->le_seen) {\n\t\tle_last = current - dev->le_seen;\n\t\tif (le_last > SEEN_TRESHHOLD)\n\t\t\tle_last = NVAL_TIME;\n\t}\n\n\tif (le_last == NVAL_TIME && bredr_last == NVAL_TIME)\n\t\treturn dev->bdaddr_type;\n\n\tif (dev->bredr && (!dev->le || le_last == NVAL_TIME))\n\t\treturn BDADDR_BREDR;\n\n\tif (dev->le && (!dev->bredr || bredr_last == NVAL_TIME))\n\t\treturn dev->bdaddr_type;\n\n\t/*\n\t * Prefer BR/EDR if time is the same since it might be from an\n\t * advertisement with BR/EDR flag set.\n\t */\n\tif (bredr_last <= le_last && btd_adapter_get_bredr(dev->adapter))\n\t\treturn BDADDR_BREDR;\n\n\treturn dev->bdaddr_type;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define SEEN_TRESHHOLD 300",
      "#define NVAL_TIME ((time_t) -1)"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "btd_adapter_get_bredr",
          "args": [
            "dev->adapter"
          ],
          "line": 1933
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_get_bredr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "4438-4444",
          "snippet": "bool btd_adapter_get_bredr(struct btd_adapter *adapter)\n{\n\tif (adapter->current_settings & MGMT_SETTING_BREDR)\n\t\treturn true;\n\n\treturn false;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nbool btd_adapter_get_bredr(struct btd_adapter *adapter)\n{\n\tif (adapter->current_settings & MGMT_SETTING_BREDR)\n\t\treturn true;\n\n\treturn false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "time",
          "args": [
            "NULL"
          ],
          "line": 1896
        },
        "resolved": true,
        "details": {
          "function_name": "bonding_request_stop_timer",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "2465-2476",
          "snippet": "static void bonding_request_stop_timer(struct bonding_req *bonding)\n{\n\tstruct timespec current;\n\n\tclock_gettime(CLOCK_MONOTONIC, &current);\n\n\t/* Compute the time difference in ms. */\n\tbonding->last_attempt_duration_ms =\n\t\t(current.tv_sec - bonding->attempt_start_time.tv_sec) * 1000L +\n\t\t(current.tv_nsec - bonding->attempt_start_time.tv_nsec)\n\t\t\t\t\t\t\t\t/ 1000000L;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void bonding_request_stop_timer(struct bonding_req *bonding)\n{\n\tstruct timespec current;\n\n\tclock_gettime(CLOCK_MONOTONIC, &current);\n\n\t/* Compute the time difference in ms. */\n\tbonding->last_attempt_duration_ms =\n\t\t(current.tv_sec - bonding->attempt_start_time.tv_sec) * 1000L +\n\t\t(current.tv_nsec - bonding->attempt_start_time.tv_nsec)\n\t\t\t\t\t\t\t\t/ 1000000L;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\n#define SEEN_TRESHHOLD 300\n#define NVAL_TIME ((time_t) -1)\n\nstatic uint8_t select_conn_bearer(struct btd_device *dev)\n{\n\ttime_t bredr_last = NVAL_TIME, le_last = NVAL_TIME;\n\ttime_t current = time(NULL);\n\n\t/* Prefer bonded bearer in case only one is bonded */\n\tif (dev->bredr_state.bonded && !dev->le_state.bonded )\n\t\treturn BDADDR_BREDR;\n\telse if (!dev->bredr_state.bonded && dev->le_state.bonded)\n\t\treturn dev->bdaddr_type;\n\n\t/* If the address is random it can only be connected over LE */\n\tif (dev->bdaddr_type == BDADDR_LE_RANDOM)\n\t\treturn dev->bdaddr_type;\n\n\tif (dev->bredr_seen) {\n\t\tbredr_last = current - dev->bredr_seen;\n\t\tif (bredr_last > SEEN_TRESHHOLD)\n\t\t\tbredr_last = NVAL_TIME;\n\t}\n\n\tif (dev->le_seen) {\n\t\tle_last = current - dev->le_seen;\n\t\tif (le_last > SEEN_TRESHHOLD)\n\t\t\tle_last = NVAL_TIME;\n\t}\n\n\tif (le_last == NVAL_TIME && bredr_last == NVAL_TIME)\n\t\treturn dev->bdaddr_type;\n\n\tif (dev->bredr && (!dev->le || le_last == NVAL_TIME))\n\t\treturn BDADDR_BREDR;\n\n\tif (dev->le && (!dev->bredr || bredr_last == NVAL_TIME))\n\t\treturn dev->bdaddr_type;\n\n\t/*\n\t * Prefer BR/EDR if time is the same since it might be from an\n\t * advertisement with BR/EDR flag set.\n\t */\n\tif (bredr_last <= le_last && btd_adapter_get_bredr(dev->adapter))\n\t\treturn BDADDR_BREDR;\n\n\treturn dev->bdaddr_type;\n}"
  },
  {
    "function_name": "connect_profiles",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "1833-1888",
    "snippet": "static DBusMessage *connect_profiles(struct btd_device *dev, uint8_t bdaddr_type,\n\t\t\t\t\tDBusMessage *msg, const char *uuid)\n{\n\tstruct bearer_state *state = get_state(dev, bdaddr_type);\n\tint err;\n\n\tDBG(\"%s %s, client %s\", dev->path, uuid ? uuid : \"(all)\",\n\t\t\t\t\t\tdbus_message_get_sender(msg));\n\n\tif (dev->pending || dev->connect || dev->browse)\n\t\treturn btd_error_in_progress(msg);\n\n\tif (!btd_adapter_get_powered(dev->adapter))\n\t\treturn btd_error_not_ready(msg);\n\n\tbtd_device_set_temporary(dev, false);\n\n\tif (!state->svc_resolved)\n\t\tgoto resolve_services;\n\n\tdev->pending = create_pending_list(dev, uuid);\n\tif (!dev->pending) {\n\t\tif (dev->svc_refreshed) {\n\t\t\tif (find_service_with_state(dev->services,\n\t\t\t\t\t\tBTD_SERVICE_STATE_CONNECTED))\n\t\t\t\treturn dbus_message_new_method_return(msg);\n\t\t\telse\n\t\t\t\treturn btd_error_not_available(msg);\n\t\t}\n\n\t\tgoto resolve_services;\n\t}\n\n\terr = connect_next(dev);\n\tif (err < 0) {\n\t\tif (err == -EALREADY)\n\t\t\treturn dbus_message_new_method_return(msg);\n\t\treturn btd_error_failed(msg, strerror(-err));\n\t}\n\n\tdev->connect = dbus_message_ref(msg);\n\n\treturn NULL;\n\nresolve_services:\n\tDBG(\"Resolving services for %s\", dev->path);\n\n\tif (bdaddr_type == BDADDR_BREDR)\n\t\terr = device_browse_sdp(dev, msg);\n\telse\n\t\terr = device_browse_gatt(dev, msg);\n\tif (err < 0)\n\t\treturn btd_error_failed(msg, strerror(-err));\n\n\treturn NULL;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
      "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "btd_error_failed",
          "args": [
            "msg",
            "strerror(-err)"
          ],
          "line": 1885
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "124-128",
          "snippet": "DBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "strerror",
          "args": [
            "-err"
          ],
          "line": 1885
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device_browse_gatt",
          "args": [
            "dev",
            "msg"
          ],
          "line": 1883
        },
        "resolved": true,
        "details": {
          "function_name": "device_browse_gatt",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5192-5236",
          "snippet": "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg)\n{\n\tstruct btd_adapter *adapter = device->adapter;\n\tstruct browse_req *req;\n\n\treq = browse_request_new(device, BROWSE_GATT, msg);\n\tif (!req)\n\t\treturn -EBUSY;\n\n\tif (device->client) {\n\t\t/*\n\t\t * If discovery has not yet completed, then wait for gatt-client\n\t\t * to become ready.\n\t\t */\n\t\tif (!bt_gatt_client_is_ready(device->client))\n\t\t\treturn 0;\n\n\t\t/*\n\t\t * Services have already been discovered, so signal this browse\n\t\t * request as resolved.\n\t\t */\n\t\tdevice_svc_resolved(device, BROWSE_GATT, device->bdaddr_type,\n\t\t\t\t\t\t\t\t\t0);\n\t\treturn 0;\n\t}\n\n\tdevice->att_io = bt_io_connect(att_connect_cb,\n\t\t\t\tdevice, NULL, NULL,\n\t\t\t\tBT_IO_OPT_SOURCE_BDADDR,\n\t\t\t\tbtd_adapter_get_address(adapter),\n\t\t\t\tBT_IO_OPT_SOURCE_TYPE,\n\t\t\t\tbtd_adapter_get_address_type(adapter),\n\t\t\t\tBT_IO_OPT_DEST_BDADDR, &device->bdaddr,\n\t\t\t\tBT_IO_OPT_DEST_TYPE, device->bdaddr_type,\n\t\t\t\tBT_IO_OPT_CID, ATT_CID,\n\t\t\t\tBT_IO_OPT_SEC_LEVEL, BT_IO_SEC_LOW,\n\t\t\t\tBT_IO_OPT_INVALID);\n\n\tif (device->att_io == NULL) {\n\t\tbrowse_request_free(req);\n\t\treturn -EIO;\n\t}\n\n\treturn 0;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
            "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);",
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg)\n{\n\tstruct btd_adapter *adapter = device->adapter;\n\tstruct browse_req *req;\n\n\treq = browse_request_new(device, BROWSE_GATT, msg);\n\tif (!req)\n\t\treturn -EBUSY;\n\n\tif (device->client) {\n\t\t/*\n\t\t * If discovery has not yet completed, then wait for gatt-client\n\t\t * to become ready.\n\t\t */\n\t\tif (!bt_gatt_client_is_ready(device->client))\n\t\t\treturn 0;\n\n\t\t/*\n\t\t * Services have already been discovered, so signal this browse\n\t\t * request as resolved.\n\t\t */\n\t\tdevice_svc_resolved(device, BROWSE_GATT, device->bdaddr_type,\n\t\t\t\t\t\t\t\t\t0);\n\t\treturn 0;\n\t}\n\n\tdevice->att_io = bt_io_connect(att_connect_cb,\n\t\t\t\tdevice, NULL, NULL,\n\t\t\t\tBT_IO_OPT_SOURCE_BDADDR,\n\t\t\t\tbtd_adapter_get_address(adapter),\n\t\t\t\tBT_IO_OPT_SOURCE_TYPE,\n\t\t\t\tbtd_adapter_get_address_type(adapter),\n\t\t\t\tBT_IO_OPT_DEST_BDADDR, &device->bdaddr,\n\t\t\t\tBT_IO_OPT_DEST_TYPE, device->bdaddr_type,\n\t\t\t\tBT_IO_OPT_CID, ATT_CID,\n\t\t\t\tBT_IO_OPT_SEC_LEVEL, BT_IO_SEC_LOW,\n\t\t\t\tBT_IO_OPT_INVALID);\n\n\tif (device->att_io == NULL) {\n\t\tbrowse_request_free(req);\n\t\treturn -EIO;\n\t}\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "device_browse_sdp",
          "args": [
            "dev",
            "msg"
          ],
          "line": 1881
        },
        "resolved": true,
        "details": {
          "function_name": "device_browse_sdp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5263-5287",
          "snippet": "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg)\n{\n\tstruct btd_adapter *adapter = device->adapter;\n\tstruct browse_req *req;\n\tuuid_t uuid;\n\tint err;\n\n\treq = browse_request_new(device, BROWSE_SDP, msg);\n\tif (!req)\n\t\treturn -EBUSY;\n\n\tsdp_uuid16_create(&uuid, uuid_list[req->search_uuid++]);\n\n\treq->sdp_flags = get_sdp_flags(device);\n\n\terr = bt_search_service(btd_adapter_get_address(adapter),\n\t\t\t\t&device->bdaddr, &uuid, browse_cb, req, NULL,\n\t\t\t\treq->sdp_flags);\n\tif (err < 0) {\n\t\tbrowse_request_free(req);\n\t\treturn err;\n\t}\n\n\treturn err;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static const uint16_t uuid_list[] = {\n\tL2CAP_UUID,\n\tPNP_INFO_SVCLASS_ID,\n\tPUBLIC_BROWSE_GROUP,\n\t0\n};",
            "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
            "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);",
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic const uint16_t uuid_list[] = {\n\tL2CAP_UUID,\n\tPNP_INFO_SVCLASS_ID,\n\tPUBLIC_BROWSE_GROUP,\n\t0\n};\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg)\n{\n\tstruct btd_adapter *adapter = device->adapter;\n\tstruct browse_req *req;\n\tuuid_t uuid;\n\tint err;\n\n\treq = browse_request_new(device, BROWSE_SDP, msg);\n\tif (!req)\n\t\treturn -EBUSY;\n\n\tsdp_uuid16_create(&uuid, uuid_list[req->search_uuid++]);\n\n\treq->sdp_flags = get_sdp_flags(device);\n\n\terr = bt_search_service(btd_adapter_get_address(adapter),\n\t\t\t\t&device->bdaddr, &uuid, browse_cb, req, NULL,\n\t\t\t\treq->sdp_flags);\n\tif (err < 0) {\n\t\tbrowse_request_free(req);\n\t\treturn err;\n\t}\n\n\treturn err;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Resolving services for %s\"",
            "dev->path"
          ],
          "line": 1878
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_ref",
          "args": [
            "msg"
          ],
          "line": 1873
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strerror",
          "args": [
            "-err"
          ],
          "line": 1870
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_new_method_return",
          "args": [
            "msg"
          ],
          "line": 1869
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "connect_next",
          "args": [
            "dev"
          ],
          "line": 1866
        },
        "resolved": true,
        "details": {
          "function_name": "connect_next",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "1561-1577",
          "snippet": "static int connect_next(struct btd_device *dev)\n{\n\tstruct btd_service *service;\n\tint err = -ENOENT;\n\n\twhile (dev->pending) {\n\t\tservice = dev->pending->data;\n\n\t\terr = btd_service_connect(service);\n\t\tif (!err)\n\t\t\treturn 0;\n\n\t\tdev->pending = g_slist_delete_link(dev->pending, dev->pending);\n\t}\n\n\treturn err;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int connect_next(struct btd_device *dev)\n{\n\tstruct btd_service *service;\n\tint err = -ENOENT;\n\n\twhile (dev->pending) {\n\t\tservice = dev->pending->data;\n\n\t\terr = btd_service_connect(service);\n\t\tif (!err)\n\t\t\treturn 0;\n\n\t\tdev->pending = g_slist_delete_link(dev->pending, dev->pending);\n\t}\n\n\treturn err;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_error_not_available",
          "args": [
            "msg"
          ],
          "line": 1860
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_not_available",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "82-86",
          "snippet": "DBusMessage *btd_error_not_available(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotAvailable\",\n\t\t\t\t\t\"Operation currently not available\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_not_available(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotAvailable\",\n\t\t\t\t\t\"Operation currently not available\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_new_method_return",
          "args": [
            "msg"
          ],
          "line": 1858
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "find_service_with_state",
          "args": [
            "dev->services",
            "BTD_SERVICE_STATE_CONNECTED"
          ],
          "line": 1856
        },
        "resolved": true,
        "details": {
          "function_name": "find_service_with_state",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "298-311",
          "snippet": "static GSList *find_service_with_state(GSList *list,\n\t\t\t\t\t\tbtd_service_state_t state)\n{\n\tGSList *l;\n\n\tfor (l = list; l != NULL; l = g_slist_next(l)) {\n\t\tstruct btd_service *service = l->data;\n\n\t\tif (btd_service_get_state(service) == state)\n\t\t\treturn l;\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic GSList *find_service_with_state(GSList *list,\n\t\t\t\t\t\tbtd_service_state_t state)\n{\n\tGSList *l;\n\n\tfor (l = list; l != NULL; l = g_slist_next(l)) {\n\t\tstruct btd_service *service = l->data;\n\n\t\tif (btd_service_get_state(service) == state)\n\t\t\treturn l;\n\t}\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "create_pending_list",
          "args": [
            "dev",
            "uuid"
          ],
          "line": 1853
        },
        "resolved": true,
        "details": {
          "function_name": "create_pending_list",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "1772-1805",
          "snippet": "static GSList *create_pending_list(struct btd_device *dev, const char *uuid)\n{\n\tstruct btd_service *service;\n\tstruct btd_profile *p;\n\tGSList *l;\n\n\tif (uuid) {\n\t\tservice = find_connectable_service(dev, uuid);\n\t\tif (service)\n\t\t\treturn g_slist_prepend(dev->pending, service);\n\n\t\treturn dev->pending;\n\t}\n\n\tfor (l = dev->services; l != NULL; l = g_slist_next(l)) {\n\t\tservice = l->data;\n\t\tp = btd_service_get_profile(service);\n\n\t\tif (!p->auto_connect)\n\t\t\tcontinue;\n\n\t\tif (g_slist_find(dev->pending, service))\n\t\t\tcontinue;\n\n\t\tif (btd_service_get_state(service) !=\n\t\t\t\t\t\tBTD_SERVICE_STATE_DISCONNECTED)\n\t\t\tcontinue;\n\n\t\tdev->pending = g_slist_insert_sorted(dev->pending, service,\n\t\t\t\t\t\t\tservice_prio_cmp);\n\t}\n\n\treturn dev->pending;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic GSList *create_pending_list(struct btd_device *dev, const char *uuid)\n{\n\tstruct btd_service *service;\n\tstruct btd_profile *p;\n\tGSList *l;\n\n\tif (uuid) {\n\t\tservice = find_connectable_service(dev, uuid);\n\t\tif (service)\n\t\t\treturn g_slist_prepend(dev->pending, service);\n\n\t\treturn dev->pending;\n\t}\n\n\tfor (l = dev->services; l != NULL; l = g_slist_next(l)) {\n\t\tservice = l->data;\n\t\tp = btd_service_get_profile(service);\n\n\t\tif (!p->auto_connect)\n\t\t\tcontinue;\n\n\t\tif (g_slist_find(dev->pending, service))\n\t\t\tcontinue;\n\n\t\tif (btd_service_get_state(service) !=\n\t\t\t\t\t\tBTD_SERVICE_STATE_DISCONNECTED)\n\t\t\tcontinue;\n\n\t\tdev->pending = g_slist_insert_sorted(dev->pending, service,\n\t\t\t\t\t\t\tservice_prio_cmp);\n\t}\n\n\treturn dev->pending;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_device_set_temporary",
          "args": [
            "dev",
            "false"
          ],
          "line": 1848
        },
        "resolved": true,
        "details": {
          "function_name": "btd_device_set_temporary",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5336-5368",
          "snippet": "void btd_device_set_temporary(struct btd_device *device, bool temporary)\n{\n\tif (!device)\n\t\treturn;\n\n\tif (device->temporary == temporary)\n\t\treturn;\n\n\tif (device_address_is_private(device))\n\t\treturn;\n\n\tDBG(\"temporary %d\", temporary);\n\n\tdevice->temporary = temporary;\n\n\tif (temporary) {\n\t\tif (device->bredr)\n\t\t\tadapter_whitelist_remove(device->adapter, device);\n\t\tadapter_connect_list_remove(device->adapter, device);\n\t\treturn;\n\t}\n\n\tif (device->bredr)\n\t\tadapter_whitelist_add(device->adapter, device);\n\n\tstore_device_info(device);\n\n\t/* attributes were not stored when resolved if device was temporary */\n\tif (device->bdaddr_type != BDADDR_BREDR &&\n\t\t\tdevice->le_state.svc_resolved &&\n\t\t\tg_slist_length(device->primaries) != 0)\n\t\tstore_services(device);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid btd_device_set_temporary(struct btd_device *device, bool temporary)\n{\n\tif (!device)\n\t\treturn;\n\n\tif (device->temporary == temporary)\n\t\treturn;\n\n\tif (device_address_is_private(device))\n\t\treturn;\n\n\tDBG(\"temporary %d\", temporary);\n\n\tdevice->temporary = temporary;\n\n\tif (temporary) {\n\t\tif (device->bredr)\n\t\t\tadapter_whitelist_remove(device->adapter, device);\n\t\tadapter_connect_list_remove(device->adapter, device);\n\t\treturn;\n\t}\n\n\tif (device->bredr)\n\t\tadapter_whitelist_add(device->adapter, device);\n\n\tstore_device_info(device);\n\n\t/* attributes were not stored when resolved if device was temporary */\n\tif (device->bdaddr_type != BDADDR_BREDR &&\n\t\t\tdevice->le_state.svc_resolved &&\n\t\t\tg_slist_length(device->primaries) != 0)\n\t\tstore_services(device);\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_error_not_ready",
          "args": [
            "msg"
          ],
          "line": 1846
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_not_ready",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "118-122",
          "snippet": "DBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_adapter_get_powered",
          "args": [
            "dev->adapter"
          ],
          "line": 1845
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_get_powered",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "4414-4420",
          "snippet": "bool btd_adapter_get_powered(struct btd_adapter *adapter)\n{\n\tif (adapter->current_settings & MGMT_SETTING_POWERED)\n\t\treturn true;\n\n\treturn false;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nbool btd_adapter_get_powered(struct btd_adapter *adapter)\n{\n\tif (adapter->current_settings & MGMT_SETTING_POWERED)\n\t\treturn true;\n\n\treturn false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_error_in_progress",
          "args": [
            "msg"
          ],
          "line": 1843
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_in_progress",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "76-80",
          "snippet": "DBusMessage *btd_error_in_progress(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".InProgress\",\n\t\t\t\t\t\"In Progress\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_in_progress(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".InProgress\",\n\t\t\t\t\t\"In Progress\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"%s %s, client %s\"",
            "dev->path",
            "uuid ? uuid : \"(all)\"",
            "dbus_message_get_sender(msg)"
          ],
          "line": 1839
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_get_sender",
          "args": [
            "msg"
          ],
          "line": 1840
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_state",
          "args": [
            "dev",
            "bdaddr_type"
          ],
          "line": 1836
        },
        "resolved": true,
        "details": {
          "function_name": "get_state",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "275-282",
          "snippet": "static struct bearer_state *get_state(struct btd_device *dev,\n\t\t\t\t\t\t\tuint8_t bdaddr_type)\n{\n\tif (bdaddr_type == BDADDR_BREDR)\n\t\treturn &dev->bredr_state;\n\telse\n\t\treturn &dev->le_state;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic struct bearer_state *get_state(struct btd_device *dev,\n\t\t\t\t\t\t\tuint8_t bdaddr_type)\n{\n\tif (bdaddr_type == BDADDR_BREDR)\n\t\treturn &dev->bredr_state;\n\telse\n\t\treturn &dev->le_state;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\n\nstatic DBusMessage *connect_profiles(struct btd_device *dev, uint8_t bdaddr_type,\n\t\t\t\t\tDBusMessage *msg, const char *uuid)\n{\n\tstruct bearer_state *state = get_state(dev, bdaddr_type);\n\tint err;\n\n\tDBG(\"%s %s, client %s\", dev->path, uuid ? uuid : \"(all)\",\n\t\t\t\t\t\tdbus_message_get_sender(msg));\n\n\tif (dev->pending || dev->connect || dev->browse)\n\t\treturn btd_error_in_progress(msg);\n\n\tif (!btd_adapter_get_powered(dev->adapter))\n\t\treturn btd_error_not_ready(msg);\n\n\tbtd_device_set_temporary(dev, false);\n\n\tif (!state->svc_resolved)\n\t\tgoto resolve_services;\n\n\tdev->pending = create_pending_list(dev, uuid);\n\tif (!dev->pending) {\n\t\tif (dev->svc_refreshed) {\n\t\t\tif (find_service_with_state(dev->services,\n\t\t\t\t\t\tBTD_SERVICE_STATE_CONNECTED))\n\t\t\t\treturn dbus_message_new_method_return(msg);\n\t\t\telse\n\t\t\t\treturn btd_error_not_available(msg);\n\t\t}\n\n\t\tgoto resolve_services;\n\t}\n\n\terr = connect_next(dev);\n\tif (err < 0) {\n\t\tif (err == -EALREADY)\n\t\t\treturn dbus_message_new_method_return(msg);\n\t\treturn btd_error_failed(msg, strerror(-err));\n\t}\n\n\tdev->connect = dbus_message_ref(msg);\n\n\treturn NULL;\n\nresolve_services:\n\tDBG(\"Resolving services for %s\", dev->path);\n\n\tif (bdaddr_type == BDADDR_BREDR)\n\t\terr = device_browse_sdp(dev, msg);\n\telse\n\t\terr = device_browse_gatt(dev, msg);\n\tif (err < 0)\n\t\treturn btd_error_failed(msg, strerror(-err));\n\n\treturn NULL;\n}"
  },
  {
    "function_name": "btd_device_connect_services",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "1807-1831",
    "snippet": "int btd_device_connect_services(struct btd_device *dev, GSList *services)\n{\n\tGSList *l;\n\n\tif (dev->pending || dev->connect || dev->browse)\n\t\treturn -EBUSY;\n\n\tif (!btd_adapter_get_powered(dev->adapter))\n\t\treturn -ENETDOWN;\n\n\tif (!dev->bredr_state.svc_resolved)\n\t\treturn -ENOENT;\n\n\tif (services) {\n\t\tfor (l = services; l; l = g_slist_next(l)) {\n\t\t\tstruct btd_service *service = l->data;\n\n\t\t\tdev->pending = g_slist_append(dev->pending, service);\n\t\t}\n\t} else {\n\t\tdev->pending = create_pending_list(dev, NULL);\n\t}\n\n\treturn connect_next(dev);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "connect_next",
          "args": [
            "dev"
          ],
          "line": 1830
        },
        "resolved": true,
        "details": {
          "function_name": "connect_next",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "1561-1577",
          "snippet": "static int connect_next(struct btd_device *dev)\n{\n\tstruct btd_service *service;\n\tint err = -ENOENT;\n\n\twhile (dev->pending) {\n\t\tservice = dev->pending->data;\n\n\t\terr = btd_service_connect(service);\n\t\tif (!err)\n\t\t\treturn 0;\n\n\t\tdev->pending = g_slist_delete_link(dev->pending, dev->pending);\n\t}\n\n\treturn err;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int connect_next(struct btd_device *dev)\n{\n\tstruct btd_service *service;\n\tint err = -ENOENT;\n\n\twhile (dev->pending) {\n\t\tservice = dev->pending->data;\n\n\t\terr = btd_service_connect(service);\n\t\tif (!err)\n\t\t\treturn 0;\n\n\t\tdev->pending = g_slist_delete_link(dev->pending, dev->pending);\n\t}\n\n\treturn err;\n}"
        }
      },
      {
        "call_info": {
          "callee": "create_pending_list",
          "args": [
            "dev",
            "NULL"
          ],
          "line": 1827
        },
        "resolved": true,
        "details": {
          "function_name": "create_pending_list",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "1772-1805",
          "snippet": "static GSList *create_pending_list(struct btd_device *dev, const char *uuid)\n{\n\tstruct btd_service *service;\n\tstruct btd_profile *p;\n\tGSList *l;\n\n\tif (uuid) {\n\t\tservice = find_connectable_service(dev, uuid);\n\t\tif (service)\n\t\t\treturn g_slist_prepend(dev->pending, service);\n\n\t\treturn dev->pending;\n\t}\n\n\tfor (l = dev->services; l != NULL; l = g_slist_next(l)) {\n\t\tservice = l->data;\n\t\tp = btd_service_get_profile(service);\n\n\t\tif (!p->auto_connect)\n\t\t\tcontinue;\n\n\t\tif (g_slist_find(dev->pending, service))\n\t\t\tcontinue;\n\n\t\tif (btd_service_get_state(service) !=\n\t\t\t\t\t\tBTD_SERVICE_STATE_DISCONNECTED)\n\t\t\tcontinue;\n\n\t\tdev->pending = g_slist_insert_sorted(dev->pending, service,\n\t\t\t\t\t\t\tservice_prio_cmp);\n\t}\n\n\treturn dev->pending;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic GSList *create_pending_list(struct btd_device *dev, const char *uuid)\n{\n\tstruct btd_service *service;\n\tstruct btd_profile *p;\n\tGSList *l;\n\n\tif (uuid) {\n\t\tservice = find_connectable_service(dev, uuid);\n\t\tif (service)\n\t\t\treturn g_slist_prepend(dev->pending, service);\n\n\t\treturn dev->pending;\n\t}\n\n\tfor (l = dev->services; l != NULL; l = g_slist_next(l)) {\n\t\tservice = l->data;\n\t\tp = btd_service_get_profile(service);\n\n\t\tif (!p->auto_connect)\n\t\t\tcontinue;\n\n\t\tif (g_slist_find(dev->pending, service))\n\t\t\tcontinue;\n\n\t\tif (btd_service_get_state(service) !=\n\t\t\t\t\t\tBTD_SERVICE_STATE_DISCONNECTED)\n\t\t\tcontinue;\n\n\t\tdev->pending = g_slist_insert_sorted(dev->pending, service,\n\t\t\t\t\t\t\tservice_prio_cmp);\n\t}\n\n\treturn dev->pending;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_slist_append",
          "args": [
            "dev->pending",
            "service"
          ],
          "line": 1824
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_next",
          "args": [
            "l"
          ],
          "line": 1821
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_adapter_get_powered",
          "args": [
            "dev->adapter"
          ],
          "line": 1814
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_get_powered",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "4414-4420",
          "snippet": "bool btd_adapter_get_powered(struct btd_adapter *adapter)\n{\n\tif (adapter->current_settings & MGMT_SETTING_POWERED)\n\t\treturn true;\n\n\treturn false;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nbool btd_adapter_get_powered(struct btd_adapter *adapter)\n{\n\tif (adapter->current_settings & MGMT_SETTING_POWERED)\n\t\treturn true;\n\n\treturn false;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nint btd_device_connect_services(struct btd_device *dev, GSList *services)\n{\n\tGSList *l;\n\n\tif (dev->pending || dev->connect || dev->browse)\n\t\treturn -EBUSY;\n\n\tif (!btd_adapter_get_powered(dev->adapter))\n\t\treturn -ENETDOWN;\n\n\tif (!dev->bredr_state.svc_resolved)\n\t\treturn -ENOENT;\n\n\tif (services) {\n\t\tfor (l = services; l; l = g_slist_next(l)) {\n\t\t\tstruct btd_service *service = l->data;\n\n\t\t\tdev->pending = g_slist_append(dev->pending, service);\n\t\t}\n\t} else {\n\t\tdev->pending = create_pending_list(dev, NULL);\n\t}\n\n\treturn connect_next(dev);\n}"
  },
  {
    "function_name": "create_pending_list",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "1772-1805",
    "snippet": "static GSList *create_pending_list(struct btd_device *dev, const char *uuid)\n{\n\tstruct btd_service *service;\n\tstruct btd_profile *p;\n\tGSList *l;\n\n\tif (uuid) {\n\t\tservice = find_connectable_service(dev, uuid);\n\t\tif (service)\n\t\t\treturn g_slist_prepend(dev->pending, service);\n\n\t\treturn dev->pending;\n\t}\n\n\tfor (l = dev->services; l != NULL; l = g_slist_next(l)) {\n\t\tservice = l->data;\n\t\tp = btd_service_get_profile(service);\n\n\t\tif (!p->auto_connect)\n\t\t\tcontinue;\n\n\t\tif (g_slist_find(dev->pending, service))\n\t\t\tcontinue;\n\n\t\tif (btd_service_get_state(service) !=\n\t\t\t\t\t\tBTD_SERVICE_STATE_DISCONNECTED)\n\t\t\tcontinue;\n\n\t\tdev->pending = g_slist_insert_sorted(dev->pending, service,\n\t\t\t\t\t\t\tservice_prio_cmp);\n\t}\n\n\treturn dev->pending;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_slist_insert_sorted",
          "args": [
            "dev->pending",
            "service",
            "service_prio_cmp"
          ],
          "line": 1800
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_service_get_state",
          "args": [
            "service"
          ],
          "line": 1796
        },
        "resolved": true,
        "details": {
          "function_name": "btd_service_get_state",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
          "lines": "331-334",
          "snippet": "btd_service_state_t btd_service_get_state(const struct btd_service *service)\n{\n\treturn service->state;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/stat.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nbtd_service_state_t btd_service_get_state(const struct btd_service *service)\n{\n\treturn service->state;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_slist_find",
          "args": [
            "dev->pending",
            "service"
          ],
          "line": 1793
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_service_get_profile",
          "args": [
            "service"
          ],
          "line": 1788
        },
        "resolved": true,
        "details": {
          "function_name": "btd_service_get_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
          "lines": "316-319",
          "snippet": "struct btd_profile *btd_service_get_profile(const struct btd_service *service)\n{\n\treturn service->profile;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/stat.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstruct btd_profile *btd_service_get_profile(const struct btd_service *service)\n{\n\treturn service->profile;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_slist_next",
          "args": [
            "l"
          ],
          "line": 1786
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_prepend",
          "args": [
            "dev->pending",
            "service"
          ],
          "line": 1781
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "find_connectable_service",
          "args": [
            "dev",
            "uuid"
          ],
          "line": 1779
        },
        "resolved": true,
        "details": {
          "function_name": "find_connectable_service",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "1745-1762",
          "snippet": "static struct btd_service *find_connectable_service(struct btd_device *dev,\n\t\t\t\t\t\t\tconst char *uuid)\n{\n\tGSList *l;\n\n\tfor (l = dev->services; l != NULL; l = g_slist_next(l)) {\n\t\tstruct btd_service *service = l->data;\n\t\tstruct btd_profile *p = btd_service_get_profile(service);\n\n\t\tif (!p->connect || !p->remote_uuid)\n\t\t\tcontinue;\n\n\t\tif (strcasecmp(uuid, p->remote_uuid) == 0)\n\t\t\treturn service;\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic struct btd_service *find_connectable_service(struct btd_device *dev,\n\t\t\t\t\t\t\tconst char *uuid)\n{\n\tGSList *l;\n\n\tfor (l = dev->services; l != NULL; l = g_slist_next(l)) {\n\t\tstruct btd_service *service = l->data;\n\t\tstruct btd_profile *p = btd_service_get_profile(service);\n\n\t\tif (!p->connect || !p->remote_uuid)\n\t\t\tcontinue;\n\n\t\tif (strcasecmp(uuid, p->remote_uuid) == 0)\n\t\t\treturn service;\n\t}\n\n\treturn NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic GSList *create_pending_list(struct btd_device *dev, const char *uuid)\n{\n\tstruct btd_service *service;\n\tstruct btd_profile *p;\n\tGSList *l;\n\n\tif (uuid) {\n\t\tservice = find_connectable_service(dev, uuid);\n\t\tif (service)\n\t\t\treturn g_slist_prepend(dev->pending, service);\n\n\t\treturn dev->pending;\n\t}\n\n\tfor (l = dev->services; l != NULL; l = g_slist_next(l)) {\n\t\tservice = l->data;\n\t\tp = btd_service_get_profile(service);\n\n\t\tif (!p->auto_connect)\n\t\t\tcontinue;\n\n\t\tif (g_slist_find(dev->pending, service))\n\t\t\tcontinue;\n\n\t\tif (btd_service_get_state(service) !=\n\t\t\t\t\t\tBTD_SERVICE_STATE_DISCONNECTED)\n\t\t\tcontinue;\n\n\t\tdev->pending = g_slist_insert_sorted(dev->pending, service,\n\t\t\t\t\t\t\tservice_prio_cmp);\n\t}\n\n\treturn dev->pending;\n}"
  },
  {
    "function_name": "service_prio_cmp",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "1764-1770",
    "snippet": "static int service_prio_cmp(gconstpointer a, gconstpointer b)\n{\n\tstruct btd_profile *p1 = btd_service_get_profile(a);\n\tstruct btd_profile *p2 = btd_service_get_profile(b);\n\n\treturn p2->priority - p1->priority;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "btd_service_get_profile",
          "args": [
            "b"
          ],
          "line": 1767
        },
        "resolved": true,
        "details": {
          "function_name": "btd_service_get_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
          "lines": "316-319",
          "snippet": "struct btd_profile *btd_service_get_profile(const struct btd_service *service)\n{\n\treturn service->profile;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/stat.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstruct btd_profile *btd_service_get_profile(const struct btd_service *service)\n{\n\treturn service->profile;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int service_prio_cmp(gconstpointer a, gconstpointer b)\n{\n\tstruct btd_profile *p1 = btd_service_get_profile(a);\n\tstruct btd_profile *p2 = btd_service_get_profile(b);\n\n\treturn p2->priority - p1->priority;\n}"
  },
  {
    "function_name": "find_connectable_service",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "1745-1762",
    "snippet": "static struct btd_service *find_connectable_service(struct btd_device *dev,\n\t\t\t\t\t\t\tconst char *uuid)\n{\n\tGSList *l;\n\n\tfor (l = dev->services; l != NULL; l = g_slist_next(l)) {\n\t\tstruct btd_service *service = l->data;\n\t\tstruct btd_profile *p = btd_service_get_profile(service);\n\n\t\tif (!p->connect || !p->remote_uuid)\n\t\t\tcontinue;\n\n\t\tif (strcasecmp(uuid, p->remote_uuid) == 0)\n\t\t\treturn service;\n\t}\n\n\treturn NULL;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "strcasecmp",
          "args": [
            "uuid",
            "p->remote_uuid"
          ],
          "line": 1757
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_service_get_profile",
          "args": [
            "service"
          ],
          "line": 1752
        },
        "resolved": true,
        "details": {
          "function_name": "btd_service_get_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
          "lines": "316-319",
          "snippet": "struct btd_profile *btd_service_get_profile(const struct btd_service *service)\n{\n\treturn service->profile;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/stat.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstruct btd_profile *btd_service_get_profile(const struct btd_service *service)\n{\n\treturn service->profile;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_slist_next",
          "args": [
            "l"
          ],
          "line": 1750
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic struct btd_service *find_connectable_service(struct btd_device *dev,\n\t\t\t\t\t\t\tconst char *uuid)\n{\n\tGSList *l;\n\n\tfor (l = dev->services; l != NULL; l = g_slist_next(l)) {\n\t\tstruct btd_service *service = l->data;\n\t\tstruct btd_profile *p = btd_service_get_profile(service);\n\n\t\tif (!p->connect || !p->remote_uuid)\n\t\t\tcontinue;\n\n\t\tif (strcasecmp(uuid, p->remote_uuid) == 0)\n\t\t\treturn service;\n\t}\n\n\treturn NULL;\n}"
  },
  {
    "function_name": "device_set_data",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "1736-1743",
    "snippet": "void device_set_data(struct btd_device *dev, GSList *list,\n\t\t\t\t\t\t\tbool duplicate)\n{\n\tif (duplicate)\n\t\tbt_ad_clear_data(dev->ad);\n\n\tg_slist_foreach(list, add_data, dev);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_slist_foreach",
          "args": [
            "list",
            "add_data",
            "dev"
          ],
          "line": 1742
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_ad_clear_data",
          "args": [
            "dev->ad"
          ],
          "line": 1740
        },
        "resolved": true,
        "details": {
          "function_name": "bt_ad_clear_data",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "999-1005",
          "snippet": "void bt_ad_clear_data(struct bt_ad *ad)\n{\n\tif (!ad)\n\t\treturn;\n\n\tqueue_remove_all(ad->data, NULL, NULL, data_destroy);\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nvoid bt_ad_clear_data(struct bt_ad *ad)\n{\n\tif (!ad)\n\t\treturn;\n\n\tqueue_remove_all(ad->data, NULL, NULL, data_destroy);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid device_set_data(struct btd_device *dev, GSList *list,\n\t\t\t\t\t\t\tbool duplicate)\n{\n\tif (duplicate)\n\t\tbt_ad_clear_data(dev->ad);\n\n\tg_slist_foreach(list, add_data, dev);\n}"
  },
  {
    "function_name": "add_data",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "1722-1734",
    "snippet": "static void add_data(void *data, void *user_data)\n{\n\tstruct eir_ad *ad = data;\n\tstruct btd_device *dev = user_data;\n\n\tif (!bt_ad_add_data(dev->ad, ad->type, ad->data, ad->len))\n\t\treturn;\n\n\tif (ad->type == EIR_TRANSPORT_DISCOVERY)\n\t\tg_dbus_emit_property_changed(dbus_conn, dev->path,\n\t\t\t\t\t\tDEVICE_INTERFACE,\n\t\t\t\t\t\t\"AdvertisingData\");\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static DBusConnection *dbus_conn = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_dbus_emit_property_changed",
          "args": [
            "dbus_conn",
            "dev->path",
            "DEVICE_INTERFACE",
            "\"AdvertisingData\""
          ],
          "line": 1731
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_ad_add_data",
          "args": [
            "dev->ad",
            "ad->type",
            "ad->data",
            "ad->len"
          ],
          "line": 1727
        },
        "resolved": true,
        "details": {
          "function_name": "bt_ad_add_data",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "932-948",
          "snippet": "bool bt_ad_add_data(struct bt_ad *ad, uint8_t type, void *data, size_t len)\n{\n\tsize_t i;\n\n\tif (!ad)\n\t\treturn false;\n\n\tif (len > (MAX_ADV_DATA_LEN - 2))\n\t\treturn false;\n\n\tfor (i = 0; i < sizeof(type_blacklist); i++) {\n\t\tif (type == type_blacklist[i])\n\t\t\treturn false;\n\t}\n\n\treturn ad_replace_data(ad, type, data, len);\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [
            "#define MAX_ADV_DATA_LEN 31"
          ],
          "globals_used": [
            "static uint8_t type_blacklist[] = {\n\tBT_AD_FLAGS,\n\tBT_AD_UUID16_SOME,\n\tBT_AD_UUID16_ALL,\n\tBT_AD_UUID32_SOME,\n\tBT_AD_UUID32_ALL,\n\tBT_AD_UUID128_SOME,\n\tBT_AD_UUID128_ALL,\n\tBT_AD_NAME_SHORT,\n\tBT_AD_NAME_COMPLETE,\n\tBT_AD_TX_POWER,\n\tBT_AD_CLASS_OF_DEV,\n\tBT_AD_SSP_HASH,\n\tBT_AD_SSP_RANDOMIZER,\n\tBT_AD_DEVICE_ID,\n\tBT_AD_SMP_TK,\n\tBT_AD_SMP_OOB_FLAGS,\n\tBT_AD_SLAVE_CONN_INTERVAL,\n\tBT_AD_SOLICIT16,\n\tBT_AD_SOLICIT128,\n\tBT_AD_SERVICE_DATA16,\n\tBT_AD_PUBLIC_ADDRESS,\n\tBT_AD_RANDOM_ADDRESS,\n\tBT_AD_GAP_APPEARANCE,\n\tBT_AD_ADVERTISING_INTERVAL,\n\tBT_AD_LE_DEVICE_ADDRESS,\n\tBT_AD_LE_ROLE,\n\tBT_AD_SSP_HASH_P256,\n\tBT_AD_SSP_RANDOMIZER_P256,\n\tBT_AD_SOLICIT32,\n\tBT_AD_SERVICE_DATA32,\n\tBT_AD_SERVICE_DATA128,\n\tBT_AD_LE_SC_CONFIRM_VALUE,\n\tBT_AD_LE_SC_RANDOM_VALUE,\n\tBT_AD_LE_SUPPORTED_FEATURES,\n\tBT_AD_CHANNEL_MAP_UPDATE_IND,\n\tBT_AD_MESH_PROV,\n\tBT_AD_MESH_DATA,\n\tBT_AD_MESH_BEACON,\n\tBT_AD_3D_INFO_DATA,\n\tBT_AD_MANUFACTURER_DATA,\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\n#define MAX_ADV_DATA_LEN 31\n\nstatic uint8_t type_blacklist[] = {\n\tBT_AD_FLAGS,\n\tBT_AD_UUID16_SOME,\n\tBT_AD_UUID16_ALL,\n\tBT_AD_UUID32_SOME,\n\tBT_AD_UUID32_ALL,\n\tBT_AD_UUID128_SOME,\n\tBT_AD_UUID128_ALL,\n\tBT_AD_NAME_SHORT,\n\tBT_AD_NAME_COMPLETE,\n\tBT_AD_TX_POWER,\n\tBT_AD_CLASS_OF_DEV,\n\tBT_AD_SSP_HASH,\n\tBT_AD_SSP_RANDOMIZER,\n\tBT_AD_DEVICE_ID,\n\tBT_AD_SMP_TK,\n\tBT_AD_SMP_OOB_FLAGS,\n\tBT_AD_SLAVE_CONN_INTERVAL,\n\tBT_AD_SOLICIT16,\n\tBT_AD_SOLICIT128,\n\tBT_AD_SERVICE_DATA16,\n\tBT_AD_PUBLIC_ADDRESS,\n\tBT_AD_RANDOM_ADDRESS,\n\tBT_AD_GAP_APPEARANCE,\n\tBT_AD_ADVERTISING_INTERVAL,\n\tBT_AD_LE_DEVICE_ADDRESS,\n\tBT_AD_LE_ROLE,\n\tBT_AD_SSP_HASH_P256,\n\tBT_AD_SSP_RANDOMIZER_P256,\n\tBT_AD_SOLICIT32,\n\tBT_AD_SERVICE_DATA32,\n\tBT_AD_SERVICE_DATA128,\n\tBT_AD_LE_SC_CONFIRM_VALUE,\n\tBT_AD_LE_SC_RANDOM_VALUE,\n\tBT_AD_LE_SUPPORTED_FEATURES,\n\tBT_AD_CHANNEL_MAP_UPDATE_IND,\n\tBT_AD_MESH_PROV,\n\tBT_AD_MESH_DATA,\n\tBT_AD_MESH_BEACON,\n\tBT_AD_3D_INFO_DATA,\n\tBT_AD_MANUFACTURER_DATA,\n};\n\nbool bt_ad_add_data(struct bt_ad *ad, uint8_t type, void *data, size_t len)\n{\n\tsize_t i;\n\n\tif (!ad)\n\t\treturn false;\n\n\tif (len > (MAX_ADV_DATA_LEN - 2))\n\t\treturn false;\n\n\tfor (i = 0; i < sizeof(type_blacklist); i++) {\n\t\tif (type == type_blacklist[i])\n\t\t\treturn false;\n\t}\n\n\treturn ad_replace_data(ad, type, data, len);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\n\nstatic void add_data(void *data, void *user_data)\n{\n\tstruct eir_ad *ad = data;\n\tstruct btd_device *dev = user_data;\n\n\tif (!bt_ad_add_data(dev->ad, ad->type, ad->data, ad->len))\n\t\treturn;\n\n\tif (ad->type == EIR_TRANSPORT_DISCOVERY)\n\t\tg_dbus_emit_property_changed(dbus_conn, dev->path,\n\t\t\t\t\t\tDEVICE_INTERFACE,\n\t\t\t\t\t\t\"AdvertisingData\");\n}"
  },
  {
    "function_name": "device_set_service_data",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "1713-1720",
    "snippet": "void device_set_service_data(struct btd_device *dev, GSList *list,\n\t\t\t\t\t\t\tbool duplicate)\n{\n\tif (duplicate)\n\t\tbt_ad_clear_service_data(dev->ad);\n\n\tg_slist_foreach(list, add_service_data, dev);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_slist_foreach",
          "args": [
            "list",
            "add_service_data",
            "dev"
          ],
          "line": 1719
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_ad_clear_service_data",
          "args": [
            "dev->ad"
          ],
          "line": 1717
        },
        "resolved": true,
        "details": {
          "function_name": "bt_ad_clear_service_data",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "807-813",
          "snippet": "void bt_ad_clear_service_data(struct bt_ad *ad)\n{\n\tif (!ad)\n\t\treturn;\n\n\tqueue_remove_all(ad->service_data, NULL, NULL, uuid_destroy);\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nvoid bt_ad_clear_service_data(struct bt_ad *ad)\n{\n\tif (!ad)\n\t\treturn;\n\n\tqueue_remove_all(ad->service_data, NULL, NULL, uuid_destroy);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid device_set_service_data(struct btd_device *dev, GSList *list,\n\t\t\t\t\t\t\tbool duplicate)\n{\n\tif (duplicate)\n\t\tbt_ad_clear_service_data(dev->ad);\n\n\tg_slist_foreach(list, add_service_data, dev);\n}"
  },
  {
    "function_name": "add_service_data",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "1697-1711",
    "snippet": "static void add_service_data(void *data, void *user_data)\n{\n\tstruct eir_sd *sd = data;\n\tstruct btd_device *dev = user_data;\n\tbt_uuid_t uuid;\n\n\tif (bt_string_to_uuid(&uuid, sd->uuid) < 0)\n\t\treturn;\n\n\tif (!bt_ad_add_service_data(dev->ad, &uuid, sd->data, sd->data_len))\n\t\treturn;\n\n\tg_dbus_emit_property_changed(dbus_conn, dev->path,\n\t\t\t\t\tDEVICE_INTERFACE, \"ServiceData\");\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static DBusConnection *dbus_conn = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_dbus_emit_property_changed",
          "args": [
            "dbus_conn",
            "dev->path",
            "DEVICE_INTERFACE",
            "\"ServiceData\""
          ],
          "line": 1709
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_ad_add_service_data",
          "args": [
            "dev->ad",
            "&uuid",
            "sd->data",
            "sd->data_len"
          ],
          "line": 1706
        },
        "resolved": true,
        "details": {
          "function_name": "bt_ad_add_service_data",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "712-753",
          "snippet": "bool bt_ad_add_service_data(struct bt_ad *ad, const bt_uuid_t *uuid, void *data,\n\t\t\t\t\t\t\t\tsize_t len)\n{\n\tstruct bt_ad_service_data *new_data;\n\n\tif (!ad)\n\t\treturn false;\n\n\tif (len > (MAX_ADV_DATA_LEN - 2 - (size_t)bt_uuid_len(uuid)))\n\t\treturn false;\n\n\tnew_data = queue_find(ad->service_data, service_uuid_match, uuid);\n\tif (new_data) {\n\t\tif (new_data->len == len && !memcmp(new_data->data, data, len))\n\t\t\treturn false;\n\t\tnew_data->data = realloc(new_data->data, len);\n\t\tmemcpy(new_data->data, data, len);\n\t\tnew_data->len = len;\n\t\treturn true;\n\t}\n\n\tnew_data = new0(struct bt_ad_service_data, 1);\n\n\tnew_data->uuid = *uuid;\n\n\tnew_data->data = malloc(len);\n\tif (!new_data->data) {\n\t\tfree(new_data);\n\t\treturn false;\n\t}\n\n\tmemcpy(new_data->data, data, len);\n\n\tnew_data->len = len;\n\n\tif (queue_push_tail(ad->service_data, new_data))\n\t\treturn true;\n\n\tuuid_destroy(new_data);\n\n\treturn false;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [
            "#define MAX_ADV_DATA_LEN 31"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\n#define MAX_ADV_DATA_LEN 31\n\nbool bt_ad_add_service_data(struct bt_ad *ad, const bt_uuid_t *uuid, void *data,\n\t\t\t\t\t\t\t\tsize_t len)\n{\n\tstruct bt_ad_service_data *new_data;\n\n\tif (!ad)\n\t\treturn false;\n\n\tif (len > (MAX_ADV_DATA_LEN - 2 - (size_t)bt_uuid_len(uuid)))\n\t\treturn false;\n\n\tnew_data = queue_find(ad->service_data, service_uuid_match, uuid);\n\tif (new_data) {\n\t\tif (new_data->len == len && !memcmp(new_data->data, data, len))\n\t\t\treturn false;\n\t\tnew_data->data = realloc(new_data->data, len);\n\t\tmemcpy(new_data->data, data, len);\n\t\tnew_data->len = len;\n\t\treturn true;\n\t}\n\n\tnew_data = new0(struct bt_ad_service_data, 1);\n\n\tnew_data->uuid = *uuid;\n\n\tnew_data->data = malloc(len);\n\tif (!new_data->data) {\n\t\tfree(new_data);\n\t\treturn false;\n\t}\n\n\tmemcpy(new_data->data, data, len);\n\n\tnew_data->len = len;\n\n\tif (queue_push_tail(ad->service_data, new_data))\n\t\treturn true;\n\n\tuuid_destroy(new_data);\n\n\treturn false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_string_to_uuid",
          "args": [
            "&uuid",
            "sd->uuid"
          ],
          "line": 1703
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\n\nstatic void add_service_data(void *data, void *user_data)\n{\n\tstruct eir_sd *sd = data;\n\tstruct btd_device *dev = user_data;\n\tbt_uuid_t uuid;\n\n\tif (bt_string_to_uuid(&uuid, sd->uuid) < 0)\n\t\treturn;\n\n\tif (!bt_ad_add_service_data(dev->ad, &uuid, sd->data, sd->data_len))\n\t\treturn;\n\n\tg_dbus_emit_property_changed(dbus_conn, dev->path,\n\t\t\t\t\tDEVICE_INTERFACE, \"ServiceData\");\n}"
  },
  {
    "function_name": "device_set_manufacturer_data",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "1688-1695",
    "snippet": "void device_set_manufacturer_data(struct btd_device *dev, GSList *list,\n\t\t\t\t\t\t\t\tbool duplicate)\n{\n\tif (duplicate)\n\t\tbt_ad_clear_manufacturer_data(dev->ad);\n\n\tg_slist_foreach(list, add_manufacturer_data, dev);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_slist_foreach",
          "args": [
            "list",
            "add_manufacturer_data",
            "dev"
          ],
          "line": 1694
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_ad_clear_manufacturer_data",
          "args": [
            "dev->ad"
          ],
          "line": 1692
        },
        "resolved": true,
        "details": {
          "function_name": "bt_ad_clear_manufacturer_data",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "671-677",
          "snippet": "void bt_ad_clear_manufacturer_data(struct bt_ad *ad)\n{\n\tif (!ad)\n\t\treturn;\n\n\tqueue_remove_all(ad->manufacturer_data, NULL, NULL, manuf_destroy);\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nvoid bt_ad_clear_manufacturer_data(struct bt_ad *ad)\n{\n\tif (!ad)\n\t\treturn;\n\n\tqueue_remove_all(ad->manufacturer_data, NULL, NULL, manuf_destroy);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid device_set_manufacturer_data(struct btd_device *dev, GSList *list,\n\t\t\t\t\t\t\t\tbool duplicate)\n{\n\tif (duplicate)\n\t\tbt_ad_clear_manufacturer_data(dev->ad);\n\n\tg_slist_foreach(list, add_manufacturer_data, dev);\n}"
  },
  {
    "function_name": "add_manufacturer_data",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "1675-1686",
    "snippet": "static void add_manufacturer_data(void *data, void *user_data)\n{\n\tstruct eir_msd *msd = data;\n\tstruct btd_device *dev = user_data;\n\n\tif (!bt_ad_add_manufacturer_data(dev->ad, msd->company, msd->data,\n\t\t\t\t\t\t\t\tmsd->data_len))\n\t\treturn;\n\n\tg_dbus_emit_property_changed(dbus_conn, dev->path,\n\t\t\t\t\tDEVICE_INTERFACE, \"ManufacturerData\");\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static DBusConnection *dbus_conn = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_dbus_emit_property_changed",
          "args": [
            "dbus_conn",
            "dev->path",
            "DEVICE_INTERFACE",
            "\"ManufacturerData\""
          ],
          "line": 1684
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_ad_add_manufacturer_data",
          "args": [
            "dev->ad",
            "msd->company",
            "msd->data",
            "msd->data_len"
          ],
          "line": 1680
        },
        "resolved": true,
        "details": {
          "function_name": "bt_ad_add_manufacturer_data",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "575-616",
          "snippet": "bool bt_ad_add_manufacturer_data(struct bt_ad *ad, uint16_t manufacturer_id,\n\t\t\t\t\t\t\tvoid *data, size_t len)\n{\n\tstruct bt_ad_manufacturer_data *new_data;\n\n\tif (!ad)\n\t\treturn false;\n\n\tif (len > (MAX_ADV_DATA_LEN - 2 - sizeof(uint16_t)))\n\t\treturn false;\n\n\tnew_data = queue_find(ad->manufacturer_data, manufacturer_id_data_match,\n\t\t\t\t\t\tUINT_TO_PTR(manufacturer_id));\n\tif (new_data) {\n\t\tif (new_data->len == len && !memcmp(new_data->data, data, len))\n\t\t\treturn false;\n\t\tnew_data->data = realloc(new_data->data, len);\n\t\tmemcpy(new_data->data, data, len);\n\t\tnew_data->len = len;\n\t\treturn true;\n\t}\n\n\tnew_data = new0(struct bt_ad_manufacturer_data, 1);\n\tnew_data->manufacturer_id = manufacturer_id;\n\n\tnew_data->data = malloc(len);\n\tif (!new_data->data) {\n\t\tfree(new_data);\n\t\treturn false;\n\t}\n\n\tmemcpy(new_data->data, data, len);\n\n\tnew_data->len = len;\n\n\tif (queue_push_tail(ad->manufacturer_data, new_data))\n\t\treturn true;\n\n\tmanuf_destroy(new_data);\n\n\treturn false;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [
            "#define MAX_ADV_DATA_LEN 31"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\n#define MAX_ADV_DATA_LEN 31\n\nbool bt_ad_add_manufacturer_data(struct bt_ad *ad, uint16_t manufacturer_id,\n\t\t\t\t\t\t\tvoid *data, size_t len)\n{\n\tstruct bt_ad_manufacturer_data *new_data;\n\n\tif (!ad)\n\t\treturn false;\n\n\tif (len > (MAX_ADV_DATA_LEN - 2 - sizeof(uint16_t)))\n\t\treturn false;\n\n\tnew_data = queue_find(ad->manufacturer_data, manufacturer_id_data_match,\n\t\t\t\t\t\tUINT_TO_PTR(manufacturer_id));\n\tif (new_data) {\n\t\tif (new_data->len == len && !memcmp(new_data->data, data, len))\n\t\t\treturn false;\n\t\tnew_data->data = realloc(new_data->data, len);\n\t\tmemcpy(new_data->data, data, len);\n\t\tnew_data->len = len;\n\t\treturn true;\n\t}\n\n\tnew_data = new0(struct bt_ad_manufacturer_data, 1);\n\tnew_data->manufacturer_id = manufacturer_id;\n\n\tnew_data->data = malloc(len);\n\tif (!new_data->data) {\n\t\tfree(new_data);\n\t\treturn false;\n\t}\n\n\tmemcpy(new_data->data, data, len);\n\n\tnew_data->len = len;\n\n\tif (queue_push_tail(ad->manufacturer_data, new_data))\n\t\treturn true;\n\n\tmanuf_destroy(new_data);\n\n\treturn false;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\n\nstatic void add_manufacturer_data(void *data, void *user_data)\n{\n\tstruct eir_msd *msd = data;\n\tstruct btd_device *dev = user_data;\n\n\tif (!bt_ad_add_manufacturer_data(dev->ad, msd->company, msd->data,\n\t\t\t\t\t\t\t\tmsd->data_len))\n\t\treturn;\n\n\tg_dbus_emit_property_changed(dbus_conn, dev->path,\n\t\t\t\t\tDEVICE_INTERFACE, \"ManufacturerData\");\n}"
  },
  {
    "function_name": "device_add_eir_uuids",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "1654-1673",
    "snippet": "void device_add_eir_uuids(struct btd_device *dev, GSList *uuids)\n{\n\tGSList *l;\n\tbool added = false;\n\n\tif (dev->bredr_state.svc_resolved || dev->le_state.svc_resolved)\n\t\treturn;\n\n\tfor (l = uuids; l != NULL; l = l->next) {\n\t\tconst char *str = l->data;\n\t\tif (g_slist_find_custom(dev->eir_uuids, str, bt_uuid_strcmp))\n\t\t\tcontinue;\n\t\tadded = true;\n\t\tdev->eir_uuids = g_slist_append(dev->eir_uuids, g_strdup(str));\n\t}\n\n\tif (added)\n\t\tg_dbus_emit_property_changed(dbus_conn, dev->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"UUIDs\");\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static DBusConnection *dbus_conn = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_dbus_emit_property_changed",
          "args": [
            "dbus_conn",
            "dev->path",
            "DEVICE_INTERFACE",
            "\"UUIDs\""
          ],
          "line": 1671
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_append",
          "args": [
            "dev->eir_uuids",
            "g_strdup(str)"
          ],
          "line": 1667
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "str"
          ],
          "line": 1667
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_find_custom",
          "args": [
            "dev->eir_uuids",
            "str",
            "bt_uuid_strcmp"
          ],
          "line": 1664
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\n\nvoid device_add_eir_uuids(struct btd_device *dev, GSList *uuids)\n{\n\tGSList *l;\n\tbool added = false;\n\n\tif (dev->bredr_state.svc_resolved || dev->le_state.svc_resolved)\n\t\treturn;\n\n\tfor (l = uuids; l != NULL; l = l->next) {\n\t\tconst char *str = l->data;\n\t\tif (g_slist_find_custom(dev->eir_uuids, str, bt_uuid_strcmp))\n\t\t\tcontinue;\n\t\tadded = true;\n\t\tdev->eir_uuids = g_slist_append(dev->eir_uuids, g_strdup(str));\n\t}\n\n\tif (added)\n\t\tg_dbus_emit_property_changed(dbus_conn, dev->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"UUIDs\");\n}"
  },
  {
    "function_name": "device_profile_connected",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "1579-1652",
    "snippet": "static void device_profile_connected(struct btd_device *dev,\n\t\t\t\t\tstruct btd_profile *profile, int err)\n{\n\tstruct btd_service *pending;\n\tGSList *l;\n\n\tDBG(\"%s %s (%d)\", profile->name, strerror(-err), -err);\n\n\tif (!err)\n\t\tbtd_device_set_temporary(dev, false);\n\n\tif (dev->pending == NULL)\n\t\tgoto done;\n\n\tif (!btd_device_is_connected(dev)) {\n\t\tswitch (-err) {\n\t\tcase EHOSTDOWN: /* page timeout */\n\t\tcase EHOSTUNREACH: /* adapter not powered */\n\t\tcase ECONNABORTED: /* adapter powered down */\n\t\t\tgoto done;\n\t\t}\n\t}\n\n\n\tpending = dev->pending->data;\n\tl = find_service_with_profile(dev->pending, profile);\n\tif (l != NULL)\n\t\tdev->pending = g_slist_delete_link(dev->pending, l);\n\n\t/* Only continue connecting the next profile if it matches the first\n\t * pending, otherwise it will trigger another connect to the same\n\t * profile\n\t */\n\tif (profile != btd_service_get_profile(pending))\n\t\treturn;\n\n\tif (connect_next(dev) == 0)\n\t\treturn;\n\ndone:\n\tg_slist_free(dev->pending);\n\tdev->pending = NULL;\n\n\tif (!dev->connect)\n\t\treturn;\n\n\tif (!err && dbus_message_is_method_call(dev->connect, DEVICE_INTERFACE,\n\t\t\t\t\t\t\t\t\"Connect\"))\n\t\tdev->general_connect = TRUE;\n\n\tDBG(\"returning response to %s\", dbus_message_get_sender(dev->connect));\n\n\tl = find_service_with_state(dev->services, BTD_SERVICE_STATE_CONNECTED);\n\n\tif (err && l == NULL) {\n\t\t/* Fallback to LE bearer if supported */\n\t\tif (err == -EHOSTDOWN && dev->le && !dev->le_state.connected) {\n\t\t\terr = device_connect_le(dev);\n\t\t\tif (err == 0)\n\t\t\t\treturn;\n\t\t}\n\n\t\tg_dbus_send_message(dbus_conn,\n\t\t\t\tbtd_error_failed(dev->connect, strerror(-err)));\n\t} else {\n\t\t/* Start passive SDP discovery to update known services */\n\t\tif (dev->bredr && !dev->svc_refreshed)\n\t\t\tdevice_browse_sdp(dev, NULL);\n\t\tg_dbus_send_reply(dbus_conn, dev->connect, DBUS_TYPE_INVALID);\n\t}\n\n\tdbus_message_unref(dev->connect);\n\tdev->connect = NULL;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static DBusConnection *dbus_conn = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_unref",
          "args": [
            "dev->connect"
          ],
          "line": 1650
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_send_reply",
          "args": [
            "dbus_conn",
            "dev->connect",
            "DBUS_TYPE_INVALID"
          ],
          "line": 1647
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device_browse_sdp",
          "args": [
            "dev",
            "NULL"
          ],
          "line": 1646
        },
        "resolved": true,
        "details": {
          "function_name": "device_browse_sdp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5263-5287",
          "snippet": "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg)\n{\n\tstruct btd_adapter *adapter = device->adapter;\n\tstruct browse_req *req;\n\tuuid_t uuid;\n\tint err;\n\n\treq = browse_request_new(device, BROWSE_SDP, msg);\n\tif (!req)\n\t\treturn -EBUSY;\n\n\tsdp_uuid16_create(&uuid, uuid_list[req->search_uuid++]);\n\n\treq->sdp_flags = get_sdp_flags(device);\n\n\terr = bt_search_service(btd_adapter_get_address(adapter),\n\t\t\t\t&device->bdaddr, &uuid, browse_cb, req, NULL,\n\t\t\t\treq->sdp_flags);\n\tif (err < 0) {\n\t\tbrowse_request_free(req);\n\t\treturn err;\n\t}\n\n\treturn err;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static const uint16_t uuid_list[] = {\n\tL2CAP_UUID,\n\tPNP_INFO_SVCLASS_ID,\n\tPUBLIC_BROWSE_GROUP,\n\t0\n};",
            "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
            "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);",
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic const uint16_t uuid_list[] = {\n\tL2CAP_UUID,\n\tPNP_INFO_SVCLASS_ID,\n\tPUBLIC_BROWSE_GROUP,\n\t0\n};\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg)\n{\n\tstruct btd_adapter *adapter = device->adapter;\n\tstruct browse_req *req;\n\tuuid_t uuid;\n\tint err;\n\n\treq = browse_request_new(device, BROWSE_SDP, msg);\n\tif (!req)\n\t\treturn -EBUSY;\n\n\tsdp_uuid16_create(&uuid, uuid_list[req->search_uuid++]);\n\n\treq->sdp_flags = get_sdp_flags(device);\n\n\terr = bt_search_service(btd_adapter_get_address(adapter),\n\t\t\t\t&device->bdaddr, &uuid, browse_cb, req, NULL,\n\t\t\t\treq->sdp_flags);\n\tif (err < 0) {\n\t\tbrowse_request_free(req);\n\t\treturn err;\n\t}\n\n\treturn err;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_send_message",
          "args": [
            "dbus_conn",
            "btd_error_failed(dev->connect, strerror(-err))"
          ],
          "line": 1641
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_error_failed",
          "args": [
            "dev->connect",
            "strerror(-err)"
          ],
          "line": 1642
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "124-128",
          "snippet": "DBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "strerror",
          "args": [
            "-err"
          ],
          "line": 1642
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device_connect_le",
          "args": [
            "dev"
          ],
          "line": 1636
        },
        "resolved": true,
        "details": {
          "function_name": "device_connect_le",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5103-5158",
          "snippet": "int device_connect_le(struct btd_device *dev)\n{\n\tstruct btd_adapter *adapter = dev->adapter;\n\tBtIOSecLevel sec_level;\n\tGIOChannel *io;\n\tGError *gerr = NULL;\n\tchar addr[18];\n\n\t/* There is one connection attempt going on */\n\tif (dev->att_io)\n\t\treturn -EALREADY;\n\n\tba2str(&dev->bdaddr, addr);\n\n\tDBG(\"Connection attempt to: %s\", addr);\n\n\tif (dev->le_state.paired)\n\t\tsec_level = BT_IO_SEC_MEDIUM;\n\telse\n\t\tsec_level = BT_IO_SEC_LOW;\n\n\t/*\n\t * This connection will help us catch any PDUs that comes before\n\t * pairing finishes\n\t */\n\tio = bt_io_connect(att_connect_cb, dev, NULL, &gerr,\n\t\t\tBT_IO_OPT_SOURCE_BDADDR,\n\t\t\tbtd_adapter_get_address(adapter),\n\t\t\tBT_IO_OPT_SOURCE_TYPE,\n\t\t\tbtd_adapter_get_address_type(adapter),\n\t\t\tBT_IO_OPT_DEST_BDADDR, &dev->bdaddr,\n\t\t\tBT_IO_OPT_DEST_TYPE, dev->bdaddr_type,\n\t\t\tBT_IO_OPT_CID, ATT_CID,\n\t\t\tBT_IO_OPT_SEC_LEVEL, sec_level,\n\t\t\tBT_IO_OPT_INVALID);\n\n\tif (io == NULL) {\n\t\tif (dev->bonding) {\n\t\t\tDBusMessage *reply = btd_error_failed(\n\t\t\t\t\tdev->bonding->msg, gerr->message);\n\n\t\t\tg_dbus_send_message(dbus_conn, reply);\n\t\t\tbonding_request_cancel(dev->bonding);\n\t\t\tbonding_request_free(dev->bonding);\n\t\t}\n\n\t\terror(\"ATT bt_io_connect(%s): %s\", addr, gerr->message);\n\t\tg_error_free(gerr);\n\t\treturn -EIO;\n\t}\n\n\t/* Keep this, so we can cancel the connection */\n\tdev->att_io = io;\n\n\treturn 0;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *dbus_conn = NULL;",
            "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
            "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\n\nint device_connect_le(struct btd_device *dev)\n{\n\tstruct btd_adapter *adapter = dev->adapter;\n\tBtIOSecLevel sec_level;\n\tGIOChannel *io;\n\tGError *gerr = NULL;\n\tchar addr[18];\n\n\t/* There is one connection attempt going on */\n\tif (dev->att_io)\n\t\treturn -EALREADY;\n\n\tba2str(&dev->bdaddr, addr);\n\n\tDBG(\"Connection attempt to: %s\", addr);\n\n\tif (dev->le_state.paired)\n\t\tsec_level = BT_IO_SEC_MEDIUM;\n\telse\n\t\tsec_level = BT_IO_SEC_LOW;\n\n\t/*\n\t * This connection will help us catch any PDUs that comes before\n\t * pairing finishes\n\t */\n\tio = bt_io_connect(att_connect_cb, dev, NULL, &gerr,\n\t\t\tBT_IO_OPT_SOURCE_BDADDR,\n\t\t\tbtd_adapter_get_address(adapter),\n\t\t\tBT_IO_OPT_SOURCE_TYPE,\n\t\t\tbtd_adapter_get_address_type(adapter),\n\t\t\tBT_IO_OPT_DEST_BDADDR, &dev->bdaddr,\n\t\t\tBT_IO_OPT_DEST_TYPE, dev->bdaddr_type,\n\t\t\tBT_IO_OPT_CID, ATT_CID,\n\t\t\tBT_IO_OPT_SEC_LEVEL, sec_level,\n\t\t\tBT_IO_OPT_INVALID);\n\n\tif (io == NULL) {\n\t\tif (dev->bonding) {\n\t\t\tDBusMessage *reply = btd_error_failed(\n\t\t\t\t\tdev->bonding->msg, gerr->message);\n\n\t\t\tg_dbus_send_message(dbus_conn, reply);\n\t\t\tbonding_request_cancel(dev->bonding);\n\t\t\tbonding_request_free(dev->bonding);\n\t\t}\n\n\t\terror(\"ATT bt_io_connect(%s): %s\", addr, gerr->message);\n\t\tg_error_free(gerr);\n\t\treturn -EIO;\n\t}\n\n\t/* Keep this, so we can cancel the connection */\n\tdev->att_io = io;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "find_service_with_state",
          "args": [
            "dev->services",
            "BTD_SERVICE_STATE_CONNECTED"
          ],
          "line": 1631
        },
        "resolved": true,
        "details": {
          "function_name": "find_service_with_state",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "298-311",
          "snippet": "static GSList *find_service_with_state(GSList *list,\n\t\t\t\t\t\tbtd_service_state_t state)\n{\n\tGSList *l;\n\n\tfor (l = list; l != NULL; l = g_slist_next(l)) {\n\t\tstruct btd_service *service = l->data;\n\n\t\tif (btd_service_get_state(service) == state)\n\t\t\treturn l;\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic GSList *find_service_with_state(GSList *list,\n\t\t\t\t\t\tbtd_service_state_t state)\n{\n\tGSList *l;\n\n\tfor (l = list; l != NULL; l = g_slist_next(l)) {\n\t\tstruct btd_service *service = l->data;\n\n\t\tif (btd_service_get_state(service) == state)\n\t\t\treturn l;\n\t}\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"returning response to %s\"",
            "dbus_message_get_sender(dev->connect)"
          ],
          "line": 1629
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_get_sender",
          "args": [
            "dev->connect"
          ],
          "line": 1629
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_is_method_call",
          "args": [
            "dev->connect",
            "DEVICE_INTERFACE",
            "\"Connect\""
          ],
          "line": 1625
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_free",
          "args": [
            "dev->pending"
          ],
          "line": 1619
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "connect_next",
          "args": [
            "dev"
          ],
          "line": 1615
        },
        "resolved": true,
        "details": {
          "function_name": "connect_next",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "1561-1577",
          "snippet": "static int connect_next(struct btd_device *dev)\n{\n\tstruct btd_service *service;\n\tint err = -ENOENT;\n\n\twhile (dev->pending) {\n\t\tservice = dev->pending->data;\n\n\t\terr = btd_service_connect(service);\n\t\tif (!err)\n\t\t\treturn 0;\n\n\t\tdev->pending = g_slist_delete_link(dev->pending, dev->pending);\n\t}\n\n\treturn err;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int connect_next(struct btd_device *dev)\n{\n\tstruct btd_service *service;\n\tint err = -ENOENT;\n\n\twhile (dev->pending) {\n\t\tservice = dev->pending->data;\n\n\t\terr = btd_service_connect(service);\n\t\tif (!err)\n\t\t\treturn 0;\n\n\t\tdev->pending = g_slist_delete_link(dev->pending, dev->pending);\n\t}\n\n\treturn err;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_service_get_profile",
          "args": [
            "pending"
          ],
          "line": 1612
        },
        "resolved": true,
        "details": {
          "function_name": "btd_service_get_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
          "lines": "316-319",
          "snippet": "struct btd_profile *btd_service_get_profile(const struct btd_service *service)\n{\n\treturn service->profile;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/stat.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstruct btd_profile *btd_service_get_profile(const struct btd_service *service)\n{\n\treturn service->profile;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_slist_delete_link",
          "args": [
            "dev->pending",
            "l"
          ],
          "line": 1606
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "find_service_with_profile",
          "args": [
            "dev->pending",
            "profile"
          ],
          "line": 1604
        },
        "resolved": true,
        "details": {
          "function_name": "find_service_with_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "284-296",
          "snippet": "static GSList *find_service_with_profile(GSList *list, struct btd_profile *p)\n{\n\tGSList *l;\n\n\tfor (l = list; l != NULL; l = g_slist_next(l)) {\n\t\tstruct btd_service *service = l->data;\n\n\t\tif (btd_service_get_profile(service) == p)\n\t\t\treturn l;\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic GSList *find_service_with_profile(GSList *list, struct btd_profile *p)\n{\n\tGSList *l;\n\n\tfor (l = list; l != NULL; l = g_slist_next(l)) {\n\t\tstruct btd_service *service = l->data;\n\n\t\tif (btd_service_get_profile(service) == p)\n\t\t\treturn l;\n\t}\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_device_is_connected",
          "args": [
            "dev"
          ],
          "line": 1593
        },
        "resolved": true,
        "details": {
          "function_name": "btd_device_is_connected",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "2748-2751",
          "snippet": "bool btd_device_is_connected(struct btd_device *dev)\n{\n\treturn dev->bredr_state.connected || dev->le_state.connected;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nbool btd_device_is_connected(struct btd_device *dev)\n{\n\treturn dev->bredr_state.connected || dev->le_state.connected;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_device_set_temporary",
          "args": [
            "dev",
            "false"
          ],
          "line": 1588
        },
        "resolved": true,
        "details": {
          "function_name": "btd_device_set_temporary",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5336-5368",
          "snippet": "void btd_device_set_temporary(struct btd_device *device, bool temporary)\n{\n\tif (!device)\n\t\treturn;\n\n\tif (device->temporary == temporary)\n\t\treturn;\n\n\tif (device_address_is_private(device))\n\t\treturn;\n\n\tDBG(\"temporary %d\", temporary);\n\n\tdevice->temporary = temporary;\n\n\tif (temporary) {\n\t\tif (device->bredr)\n\t\t\tadapter_whitelist_remove(device->adapter, device);\n\t\tadapter_connect_list_remove(device->adapter, device);\n\t\treturn;\n\t}\n\n\tif (device->bredr)\n\t\tadapter_whitelist_add(device->adapter, device);\n\n\tstore_device_info(device);\n\n\t/* attributes were not stored when resolved if device was temporary */\n\tif (device->bdaddr_type != BDADDR_BREDR &&\n\t\t\tdevice->le_state.svc_resolved &&\n\t\t\tg_slist_length(device->primaries) != 0)\n\t\tstore_services(device);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid btd_device_set_temporary(struct btd_device *device, bool temporary)\n{\n\tif (!device)\n\t\treturn;\n\n\tif (device->temporary == temporary)\n\t\treturn;\n\n\tif (device_address_is_private(device))\n\t\treturn;\n\n\tDBG(\"temporary %d\", temporary);\n\n\tdevice->temporary = temporary;\n\n\tif (temporary) {\n\t\tif (device->bredr)\n\t\t\tadapter_whitelist_remove(device->adapter, device);\n\t\tadapter_connect_list_remove(device->adapter, device);\n\t\treturn;\n\t}\n\n\tif (device->bredr)\n\t\tadapter_whitelist_add(device->adapter, device);\n\n\tstore_device_info(device);\n\n\t/* attributes were not stored when resolved if device was temporary */\n\tif (device->bdaddr_type != BDADDR_BREDR &&\n\t\t\tdevice->le_state.svc_resolved &&\n\t\t\tg_slist_length(device->primaries) != 0)\n\t\tstore_services(device);\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"%s %s (%d)\"",
            "profile->name",
            "strerror(-err)",
            "-err"
          ],
          "line": 1585
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strerror",
          "args": [
            "-err"
          ],
          "line": 1585
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\n\nstatic void device_profile_connected(struct btd_device *dev,\n\t\t\t\t\tstruct btd_profile *profile, int err)\n{\n\tstruct btd_service *pending;\n\tGSList *l;\n\n\tDBG(\"%s %s (%d)\", profile->name, strerror(-err), -err);\n\n\tif (!err)\n\t\tbtd_device_set_temporary(dev, false);\n\n\tif (dev->pending == NULL)\n\t\tgoto done;\n\n\tif (!btd_device_is_connected(dev)) {\n\t\tswitch (-err) {\n\t\tcase EHOSTDOWN: /* page timeout */\n\t\tcase EHOSTUNREACH: /* adapter not powered */\n\t\tcase ECONNABORTED: /* adapter powered down */\n\t\t\tgoto done;\n\t\t}\n\t}\n\n\n\tpending = dev->pending->data;\n\tl = find_service_with_profile(dev->pending, profile);\n\tif (l != NULL)\n\t\tdev->pending = g_slist_delete_link(dev->pending, l);\n\n\t/* Only continue connecting the next profile if it matches the first\n\t * pending, otherwise it will trigger another connect to the same\n\t * profile\n\t */\n\tif (profile != btd_service_get_profile(pending))\n\t\treturn;\n\n\tif (connect_next(dev) == 0)\n\t\treturn;\n\ndone:\n\tg_slist_free(dev->pending);\n\tdev->pending = NULL;\n\n\tif (!dev->connect)\n\t\treturn;\n\n\tif (!err && dbus_message_is_method_call(dev->connect, DEVICE_INTERFACE,\n\t\t\t\t\t\t\t\t\"Connect\"))\n\t\tdev->general_connect = TRUE;\n\n\tDBG(\"returning response to %s\", dbus_message_get_sender(dev->connect));\n\n\tl = find_service_with_state(dev->services, BTD_SERVICE_STATE_CONNECTED);\n\n\tif (err && l == NULL) {\n\t\t/* Fallback to LE bearer if supported */\n\t\tif (err == -EHOSTDOWN && dev->le && !dev->le_state.connected) {\n\t\t\terr = device_connect_le(dev);\n\t\t\tif (err == 0)\n\t\t\t\treturn;\n\t\t}\n\n\t\tg_dbus_send_message(dbus_conn,\n\t\t\t\tbtd_error_failed(dev->connect, strerror(-err)));\n\t} else {\n\t\t/* Start passive SDP discovery to update known services */\n\t\tif (dev->bredr && !dev->svc_refreshed)\n\t\t\tdevice_browse_sdp(dev, NULL);\n\t\tg_dbus_send_reply(dbus_conn, dev->connect, DBUS_TYPE_INVALID);\n\t}\n\n\tdbus_message_unref(dev->connect);\n\tdev->connect = NULL;\n}"
  },
  {
    "function_name": "connect_next",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "1561-1577",
    "snippet": "static int connect_next(struct btd_device *dev)\n{\n\tstruct btd_service *service;\n\tint err = -ENOENT;\n\n\twhile (dev->pending) {\n\t\tservice = dev->pending->data;\n\n\t\terr = btd_service_connect(service);\n\t\tif (!err)\n\t\t\treturn 0;\n\n\t\tdev->pending = g_slist_delete_link(dev->pending, dev->pending);\n\t}\n\n\treturn err;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_slist_delete_link",
          "args": [
            "dev->pending",
            "dev->pending"
          ],
          "line": 1573
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_service_connect",
          "args": [
            "service"
          ],
          "line": 1569
        },
        "resolved": true,
        "details": {
          "function_name": "btd_service_connect",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
          "lines": "236-269",
          "snippet": "int btd_service_connect(struct btd_service *service)\n{\n\tstruct btd_profile *profile = service->profile;\n\tchar addr[18];\n\tint err;\n\n\tif (!profile->connect)\n\t\treturn -ENOTSUP;\n\n\tswitch (service->state) {\n\tcase BTD_SERVICE_STATE_UNAVAILABLE:\n\t\treturn -EINVAL;\n\tcase BTD_SERVICE_STATE_DISCONNECTED:\n\t\tbreak;\n\tcase BTD_SERVICE_STATE_CONNECTING:\n\t\treturn 0;\n\tcase BTD_SERVICE_STATE_CONNECTED:\n\t\treturn -EALREADY;\n\tcase BTD_SERVICE_STATE_DISCONNECTING:\n\t\treturn -EBUSY;\n\t}\n\n\terr = profile->connect(service);\n\tif (err == 0) {\n\t\tchange_state(service, BTD_SERVICE_STATE_CONNECTING, 0);\n\t\treturn 0;\n\t}\n\n\tba2str(device_get_address(service->device), addr);\n\terror(\"%s profile connect failed for %s: %s\", profile->name, addr,\n\t\t\t\t\t\t\t\tstrerror(-err));\n\n\treturn err;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/stat.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nint btd_service_connect(struct btd_service *service)\n{\n\tstruct btd_profile *profile = service->profile;\n\tchar addr[18];\n\tint err;\n\n\tif (!profile->connect)\n\t\treturn -ENOTSUP;\n\n\tswitch (service->state) {\n\tcase BTD_SERVICE_STATE_UNAVAILABLE:\n\t\treturn -EINVAL;\n\tcase BTD_SERVICE_STATE_DISCONNECTED:\n\t\tbreak;\n\tcase BTD_SERVICE_STATE_CONNECTING:\n\t\treturn 0;\n\tcase BTD_SERVICE_STATE_CONNECTED:\n\t\treturn -EALREADY;\n\tcase BTD_SERVICE_STATE_DISCONNECTING:\n\t\treturn -EBUSY;\n\t}\n\n\terr = profile->connect(service);\n\tif (err == 0) {\n\t\tchange_state(service, BTD_SERVICE_STATE_CONNECTING, 0);\n\t\treturn 0;\n\t}\n\n\tba2str(device_get_address(service->device), addr);\n\terror(\"%s profile connect failed for %s: %s\", profile->name, addr,\n\t\t\t\t\t\t\t\tstrerror(-err));\n\n\treturn err;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int connect_next(struct btd_device *dev)\n{\n\tstruct btd_service *service;\n\tint err = -ENOENT;\n\n\twhile (dev->pending) {\n\t\tservice = dev->pending->data;\n\n\t\terr = btd_service_connect(service);\n\t\tif (!err)\n\t\t\treturn 0;\n\n\t\tdev->pending = g_slist_delete_link(dev->pending, dev->pending);\n\t}\n\n\treturn err;\n}"
  },
  {
    "function_name": "dev_disconnect",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "1542-1559",
    "snippet": "static DBusMessage *dev_disconnect(DBusConnection *conn, DBusMessage *msg,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct btd_device *device = user_data;\n\n\t/*\n\t * If device is not trusted disable connections through passive\n\t * scanning until Device1.Connect is called\n\t */\n\tif (device->auto_connect && !device->trusted) {\n\t\tdevice->disable_auto_connect = TRUE;\n\t\tdevice_set_auto_connect(device, FALSE);\n\t}\n\n\tdevice_request_disconnect(device, msg);\n\n\treturn NULL;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
      "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);",
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "device_request_disconnect",
          "args": [
            "device",
            "msg"
          ],
          "line": 1556
        },
        "resolved": true,
        "details": {
          "function_name": "device_request_disconnect",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "1436-1495",
          "snippet": "void device_request_disconnect(struct btd_device *device, DBusMessage *msg)\n{\n\tif (device->bonding)\n\t\tbonding_request_cancel(device->bonding);\n\n\tif (device->browse)\n\t\tbrowse_request_cancel(device->browse);\n\n\tif (device->att_io) {\n\t\tg_io_channel_shutdown(device->att_io, FALSE, NULL);\n\t\tg_io_channel_unref(device->att_io);\n\t\tdevice->att_io = NULL;\n\t}\n\n\tif (device->connect) {\n\t\tDBusMessage *reply = btd_error_failed(device->connect,\n\t\t\t\t\t\t\t\t\"Cancelled\");\n\t\tg_dbus_send_message(dbus_conn, reply);\n\t\tdbus_message_unref(device->connect);\n\t\tdevice->connect = NULL;\n\t}\n\n\tif (btd_device_is_connected(device) && msg)\n\t\tdevice->disconnects = g_slist_append(device->disconnects,\n\t\t\t\t\t\tdbus_message_ref(msg));\n\n\tif (device->disconn_timer)\n\t\treturn;\n\n\tg_slist_foreach(device->services, dev_disconn_service, NULL);\n\n\tg_slist_free(device->pending);\n\tdevice->pending = NULL;\n\n\twhile (device->watches) {\n\t\tstruct btd_disconnect_data *data = device->watches->data;\n\n\t\tif (data->watch)\n\t\t\t/* temporary is set if device is going to be removed */\n\t\t\tdata->watch(device, device->temporary,\n\t\t\t\t\t\t\tdata->user_data);\n\n\t\t/* Check if the watch has been removed by callback function */\n\t\tif (!g_slist_find(device->watches, data))\n\t\t\tcontinue;\n\n\t\tdevice->watches = g_slist_remove(device->watches, data);\n\t\tg_free(data);\n\t}\n\n\tif (!btd_device_is_connected(device)) {\n\t\tif (msg)\n\t\t\tg_dbus_send_reply(dbus_conn, msg, DBUS_TYPE_INVALID);\n\t\treturn;\n\t}\n\n\tdevice->disconn_timer = g_timeout_add_seconds(DISCONNECT_TIMER,\n\t\t\t\t\t\t\tdisconnect_all,\n\t\t\t\t\t\t\tdevice);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define DISCONNECT_TIMER\t2"
          ],
          "globals_used": [
            "static DBusConnection *dbus_conn = NULL;",
            "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
            "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);",
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\n#define DISCONNECT_TIMER\t2\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid device_request_disconnect(struct btd_device *device, DBusMessage *msg)\n{\n\tif (device->bonding)\n\t\tbonding_request_cancel(device->bonding);\n\n\tif (device->browse)\n\t\tbrowse_request_cancel(device->browse);\n\n\tif (device->att_io) {\n\t\tg_io_channel_shutdown(device->att_io, FALSE, NULL);\n\t\tg_io_channel_unref(device->att_io);\n\t\tdevice->att_io = NULL;\n\t}\n\n\tif (device->connect) {\n\t\tDBusMessage *reply = btd_error_failed(device->connect,\n\t\t\t\t\t\t\t\t\"Cancelled\");\n\t\tg_dbus_send_message(dbus_conn, reply);\n\t\tdbus_message_unref(device->connect);\n\t\tdevice->connect = NULL;\n\t}\n\n\tif (btd_device_is_connected(device) && msg)\n\t\tdevice->disconnects = g_slist_append(device->disconnects,\n\t\t\t\t\t\tdbus_message_ref(msg));\n\n\tif (device->disconn_timer)\n\t\treturn;\n\n\tg_slist_foreach(device->services, dev_disconn_service, NULL);\n\n\tg_slist_free(device->pending);\n\tdevice->pending = NULL;\n\n\twhile (device->watches) {\n\t\tstruct btd_disconnect_data *data = device->watches->data;\n\n\t\tif (data->watch)\n\t\t\t/* temporary is set if device is going to be removed */\n\t\t\tdata->watch(device, device->temporary,\n\t\t\t\t\t\t\tdata->user_data);\n\n\t\t/* Check if the watch has been removed by callback function */\n\t\tif (!g_slist_find(device->watches, data))\n\t\t\tcontinue;\n\n\t\tdevice->watches = g_slist_remove(device->watches, data);\n\t\tg_free(data);\n\t}\n\n\tif (!btd_device_is_connected(device)) {\n\t\tif (msg)\n\t\t\tg_dbus_send_reply(dbus_conn, msg, DBUS_TYPE_INVALID);\n\t\treturn;\n\t}\n\n\tdevice->disconn_timer = g_timeout_add_seconds(DISCONNECT_TIMER,\n\t\t\t\t\t\t\tdisconnect_all,\n\t\t\t\t\t\t\tdevice);\n}"
        }
      },
      {
        "call_info": {
          "callee": "device_set_auto_connect",
          "args": [
            "device",
            "FALSE"
          ],
          "line": 1553
        },
        "resolved": true,
        "details": {
          "function_name": "device_set_auto_connect",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "1508-1540",
          "snippet": "static void device_set_auto_connect(struct btd_device *device, gboolean enable)\n{\n\tchar addr[18];\n\n\tif (!device || !device->le)\n\t\treturn;\n\n\tba2str(&device->bdaddr, addr);\n\n\tDBG(\"%s auto connect: %d\", addr, enable);\n\n\tif (device->auto_connect == enable)\n\t\treturn;\n\n\tdevice->auto_connect = enable;\n\n\t/* Disabling auto connect */\n\tif (enable == FALSE) {\n\t\tadapter_connect_list_remove(device->adapter, device);\n\t\tadapter_auto_connect_remove(device->adapter, device);\n\t\treturn;\n\t}\n\n\t/* Enabling auto connect */\n\tadapter_auto_connect_add(device->adapter, device);\n\n\tif (device->attrib) {\n\t\tDBG(\"Already connected\");\n\t\treturn;\n\t}\n\n\tadapter_connect_list_add(device->adapter, device);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void device_set_auto_connect(struct btd_device *device, gboolean enable)\n{\n\tchar addr[18];\n\n\tif (!device || !device->le)\n\t\treturn;\n\n\tba2str(&device->bdaddr, addr);\n\n\tDBG(\"%s auto connect: %d\", addr, enable);\n\n\tif (device->auto_connect == enable)\n\t\treturn;\n\n\tdevice->auto_connect = enable;\n\n\t/* Disabling auto connect */\n\tif (enable == FALSE) {\n\t\tadapter_connect_list_remove(device->adapter, device);\n\t\tadapter_auto_connect_remove(device->adapter, device);\n\t\treturn;\n\t}\n\n\t/* Enabling auto connect */\n\tadapter_auto_connect_add(device->adapter, device);\n\n\tif (device->attrib) {\n\t\tDBG(\"Already connected\");\n\t\treturn;\n\t}\n\n\tadapter_connect_list_add(device->adapter, device);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic DBusMessage *dev_disconnect(DBusConnection *conn, DBusMessage *msg,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct btd_device *device = user_data;\n\n\t/*\n\t * If device is not trusted disable connections through passive\n\t * scanning until Device1.Connect is called\n\t */\n\tif (device->auto_connect && !device->trusted) {\n\t\tdevice->disable_auto_connect = TRUE;\n\t\tdevice_set_auto_connect(device, FALSE);\n\t}\n\n\tdevice_request_disconnect(device, msg);\n\n\treturn NULL;\n}"
  },
  {
    "function_name": "device_set_auto_connect",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "1508-1540",
    "snippet": "static void device_set_auto_connect(struct btd_device *device, gboolean enable)\n{\n\tchar addr[18];\n\n\tif (!device || !device->le)\n\t\treturn;\n\n\tba2str(&device->bdaddr, addr);\n\n\tDBG(\"%s auto connect: %d\", addr, enable);\n\n\tif (device->auto_connect == enable)\n\t\treturn;\n\n\tdevice->auto_connect = enable;\n\n\t/* Disabling auto connect */\n\tif (enable == FALSE) {\n\t\tadapter_connect_list_remove(device->adapter, device);\n\t\tadapter_auto_connect_remove(device->adapter, device);\n\t\treturn;\n\t}\n\n\t/* Enabling auto connect */\n\tadapter_auto_connect_add(device->adapter, device);\n\n\tif (device->attrib) {\n\t\tDBG(\"Already connected\");\n\t\treturn;\n\t}\n\n\tadapter_connect_list_add(device->adapter, device);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "adapter_connect_list_add",
          "args": [
            "device->adapter",
            "device"
          ],
          "line": 1539
        },
        "resolved": true,
        "details": {
          "function_name": "adapter_connect_list_add",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "4470-4513",
          "snippet": "int adapter_connect_list_add(struct btd_adapter *adapter,\n\t\t\t\t\tstruct btd_device *device)\n{\n\t/*\n\t * If the adapter->connect_le device is getting added back to\n\t * the connect list it probably means that the connect attempt\n\t * failed and hence we should clear this pointer\n\t */\n\tif (device == adapter->connect_le)\n\t\tadapter->connect_le = NULL;\n\n\t/*\n\t * If kernel background scanning is supported then the\n\t * adapter_auto_connect_add() function is used to maintain what to\n\t * connect.\n\t */\n\tif (kernel_conn_control)\n\t\treturn 0;\n\n\tif (g_slist_find(adapter->connect_list, device)) {\n\t\tDBG(\"ignoring already added device %s\",\n\t\t\t\t\t\tdevice_get_path(device));\n\t\tgoto done;\n\t}\n\n\tif (!(adapter->supported_settings & MGMT_SETTING_LE)) {\n\t\tbtd_error(adapter->dev_id,\n\t\t\t\"Can't add %s to non-LE capable adapter connect list\",\n\t\t\t\t\t\tdevice_get_path(device));\n\t\treturn -ENOTSUP;\n\t}\n\n\tadapter->connect_list = g_slist_append(adapter->connect_list, device);\n\tDBG(\"%s added to %s's connect_list\", device_get_path(device),\n\t\t\t\t\t\t\tadapter->system_name);\n\ndone:\n\tif (!(adapter->current_settings & MGMT_SETTING_POWERED))\n\t\treturn 0;\n\n\ttrigger_passive_scanning(adapter);\n\n\treturn 0;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static bool kernel_conn_control = false;",
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic bool kernel_conn_control = false;\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nint adapter_connect_list_add(struct btd_adapter *adapter,\n\t\t\t\t\tstruct btd_device *device)\n{\n\t/*\n\t * If the adapter->connect_le device is getting added back to\n\t * the connect list it probably means that the connect attempt\n\t * failed and hence we should clear this pointer\n\t */\n\tif (device == adapter->connect_le)\n\t\tadapter->connect_le = NULL;\n\n\t/*\n\t * If kernel background scanning is supported then the\n\t * adapter_auto_connect_add() function is used to maintain what to\n\t * connect.\n\t */\n\tif (kernel_conn_control)\n\t\treturn 0;\n\n\tif (g_slist_find(adapter->connect_list, device)) {\n\t\tDBG(\"ignoring already added device %s\",\n\t\t\t\t\t\tdevice_get_path(device));\n\t\tgoto done;\n\t}\n\n\tif (!(adapter->supported_settings & MGMT_SETTING_LE)) {\n\t\tbtd_error(adapter->dev_id,\n\t\t\t\"Can't add %s to non-LE capable adapter connect list\",\n\t\t\t\t\t\tdevice_get_path(device));\n\t\treturn -ENOTSUP;\n\t}\n\n\tadapter->connect_list = g_slist_append(adapter->connect_list, device);\n\tDBG(\"%s added to %s's connect_list\", device_get_path(device),\n\t\t\t\t\t\t\tadapter->system_name);\n\ndone:\n\tif (!(adapter->current_settings & MGMT_SETTING_POWERED))\n\t\treturn 0;\n\n\ttrigger_passive_scanning(adapter);\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Already connected\""
          ],
          "line": 1535
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "adapter_auto_connect_add",
          "args": [
            "device->adapter",
            "device"
          ],
          "line": 1532
        },
        "resolved": true,
        "details": {
          "function_name": "adapter_auto_connect_add",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "4675-4712",
          "snippet": "void adapter_auto_connect_add(struct btd_adapter *adapter,\n\t\t\t\t\tstruct btd_device *device)\n{\n\tstruct mgmt_cp_add_device cp;\n\tconst bdaddr_t *bdaddr;\n\tuint8_t bdaddr_type;\n\tunsigned int id;\n\n\tif (!kernel_conn_control)\n\t\treturn;\n\n\tif (g_slist_find(adapter->connect_list, device)) {\n\t\tDBG(\"ignoring already added device %s\",\n\t\t\t\t\t\tdevice_get_path(device));\n\t\treturn;\n\t}\n\n\tbdaddr = device_get_address(device);\n\tbdaddr_type = btd_device_get_bdaddr_type(device);\n\n\tif (bdaddr_type == BDADDR_BREDR) {\n\t\tDBG(\"auto-connection feature is not avaiable for BR/EDR\");\n\t\treturn;\n\t}\n\n\tmemset(&cp, 0, sizeof(cp));\n\tbacpy(&cp.addr.bdaddr, bdaddr);\n\tcp.addr.type = bdaddr_type;\n\tcp.action = 0x02;\n\n\tid = mgmt_send(adapter->mgmt, MGMT_OP_ADD_DEVICE,\n\t\t\tadapter->dev_id, sizeof(cp), &cp, add_device_complete,\n\t\t\tadapter, NULL);\n\tif (id == 0)\n\t\treturn;\n\n\tadapter->connect_list = g_slist_append(adapter->connect_list, device);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static bool kernel_conn_control = false;",
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic bool kernel_conn_control = false;\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nvoid adapter_auto_connect_add(struct btd_adapter *adapter,\n\t\t\t\t\tstruct btd_device *device)\n{\n\tstruct mgmt_cp_add_device cp;\n\tconst bdaddr_t *bdaddr;\n\tuint8_t bdaddr_type;\n\tunsigned int id;\n\n\tif (!kernel_conn_control)\n\t\treturn;\n\n\tif (g_slist_find(adapter->connect_list, device)) {\n\t\tDBG(\"ignoring already added device %s\",\n\t\t\t\t\t\tdevice_get_path(device));\n\t\treturn;\n\t}\n\n\tbdaddr = device_get_address(device);\n\tbdaddr_type = btd_device_get_bdaddr_type(device);\n\n\tif (bdaddr_type == BDADDR_BREDR) {\n\t\tDBG(\"auto-connection feature is not avaiable for BR/EDR\");\n\t\treturn;\n\t}\n\n\tmemset(&cp, 0, sizeof(cp));\n\tbacpy(&cp.addr.bdaddr, bdaddr);\n\tcp.addr.type = bdaddr_type;\n\tcp.action = 0x02;\n\n\tid = mgmt_send(adapter->mgmt, MGMT_OP_ADD_DEVICE,\n\t\t\tadapter->dev_id, sizeof(cp), &cp, add_device_complete,\n\t\t\tadapter, NULL);\n\tif (id == 0)\n\t\treturn;\n\n\tadapter->connect_list = g_slist_append(adapter->connect_list, device);\n}"
        }
      },
      {
        "call_info": {
          "callee": "adapter_auto_connect_remove",
          "args": [
            "device->adapter",
            "device"
          ],
          "line": 1527
        },
        "resolved": true,
        "details": {
          "function_name": "adapter_auto_connect_remove",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "4736-4771",
          "snippet": "void adapter_auto_connect_remove(struct btd_adapter *adapter,\n\t\t\t\t\tstruct btd_device *device)\n{\n\tstruct mgmt_cp_remove_device cp;\n\tconst bdaddr_t *bdaddr;\n\tuint8_t bdaddr_type;\n\tunsigned int id;\n\n\tif (!kernel_conn_control)\n\t\treturn;\n\n\tif (!g_slist_find(adapter->connect_list, device)) {\n\t\tDBG(\"ignoring not added device %s\", device_get_path(device));\n\t\treturn;\n\t}\n\n\tbdaddr = device_get_address(device);\n\tbdaddr_type = btd_device_get_bdaddr_type(device);\n\n\tif (bdaddr_type == BDADDR_BREDR) {\n\t\tDBG(\"auto-connection feature is not avaiable for BR/EDR\");\n\t\treturn;\n\t}\n\n\tmemset(&cp, 0, sizeof(cp));\n\tbacpy(&cp.addr.bdaddr, bdaddr);\n\tcp.addr.type = bdaddr_type;\n\n\tid = mgmt_send(adapter->mgmt, MGMT_OP_REMOVE_DEVICE,\n\t\t\tadapter->dev_id, sizeof(cp), &cp,\n\t\t\tremove_device_complete, adapter, NULL);\n\tif (id == 0)\n\t\treturn;\n\n\tadapter->connect_list = g_slist_remove(adapter->connect_list, device);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static bool kernel_conn_control = false;",
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic bool kernel_conn_control = false;\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nvoid adapter_auto_connect_remove(struct btd_adapter *adapter,\n\t\t\t\t\tstruct btd_device *device)\n{\n\tstruct mgmt_cp_remove_device cp;\n\tconst bdaddr_t *bdaddr;\n\tuint8_t bdaddr_type;\n\tunsigned int id;\n\n\tif (!kernel_conn_control)\n\t\treturn;\n\n\tif (!g_slist_find(adapter->connect_list, device)) {\n\t\tDBG(\"ignoring not added device %s\", device_get_path(device));\n\t\treturn;\n\t}\n\n\tbdaddr = device_get_address(device);\n\tbdaddr_type = btd_device_get_bdaddr_type(device);\n\n\tif (bdaddr_type == BDADDR_BREDR) {\n\t\tDBG(\"auto-connection feature is not avaiable for BR/EDR\");\n\t\treturn;\n\t}\n\n\tmemset(&cp, 0, sizeof(cp));\n\tbacpy(&cp.addr.bdaddr, bdaddr);\n\tcp.addr.type = bdaddr_type;\n\n\tid = mgmt_send(adapter->mgmt, MGMT_OP_REMOVE_DEVICE,\n\t\t\tadapter->dev_id, sizeof(cp), &cp,\n\t\t\tremove_device_complete, adapter, NULL);\n\tif (id == 0)\n\t\treturn;\n\n\tadapter->connect_list = g_slist_remove(adapter->connect_list, device);\n}"
        }
      },
      {
        "call_info": {
          "callee": "adapter_connect_list_remove",
          "args": [
            "device->adapter",
            "device"
          ],
          "line": 1526
        },
        "resolved": true,
        "details": {
          "function_name": "adapter_connect_list_remove",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "4515-4548",
          "snippet": "void adapter_connect_list_remove(struct btd_adapter *adapter,\n\t\t\t\t\tstruct btd_device *device)\n{\n\t/*\n\t * If the adapter->connect_le device is being removed from the\n\t * connect list it means the connection was successful and hence\n\t * the pointer should be cleared\n\t */\n\tif (device == adapter->connect_le)\n\t\tadapter->connect_le = NULL;\n\n\tif (kernel_conn_control)\n\t\treturn;\n\n\tif (!g_slist_find(adapter->connect_list, device)) {\n\t\tDBG(\"device %s is not on the list, ignoring\",\n\t\t\t\t\t\tdevice_get_path(device));\n\t\treturn;\n\t}\n\n\tadapter->connect_list = g_slist_remove(adapter->connect_list, device);\n\tDBG(\"%s removed from %s's connect_list\", device_get_path(device),\n\t\t\t\t\t\t\tadapter->system_name);\n\n\tif (!adapter->connect_list) {\n\t\tstop_passive_scanning(adapter);\n\t\treturn;\n\t}\n\n\tif (!(adapter->current_settings & MGMT_SETTING_POWERED))\n\t\treturn;\n\n\ttrigger_passive_scanning(adapter);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static bool kernel_conn_control = false;",
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic bool kernel_conn_control = false;\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nvoid adapter_connect_list_remove(struct btd_adapter *adapter,\n\t\t\t\t\tstruct btd_device *device)\n{\n\t/*\n\t * If the adapter->connect_le device is being removed from the\n\t * connect list it means the connection was successful and hence\n\t * the pointer should be cleared\n\t */\n\tif (device == adapter->connect_le)\n\t\tadapter->connect_le = NULL;\n\n\tif (kernel_conn_control)\n\t\treturn;\n\n\tif (!g_slist_find(adapter->connect_list, device)) {\n\t\tDBG(\"device %s is not on the list, ignoring\",\n\t\t\t\t\t\tdevice_get_path(device));\n\t\treturn;\n\t}\n\n\tadapter->connect_list = g_slist_remove(adapter->connect_list, device);\n\tDBG(\"%s removed from %s's connect_list\", device_get_path(device),\n\t\t\t\t\t\t\tadapter->system_name);\n\n\tif (!adapter->connect_list) {\n\t\tstop_passive_scanning(adapter);\n\t\treturn;\n\t}\n\n\tif (!(adapter->current_settings & MGMT_SETTING_POWERED))\n\t\treturn;\n\n\ttrigger_passive_scanning(adapter);\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"%s auto connect: %d\"",
            "addr",
            "enable"
          ],
          "line": 1517
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ba2str",
          "args": [
            "&device->bdaddr",
            "addr"
          ],
          "line": 1515
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void device_set_auto_connect(struct btd_device *device, gboolean enable)\n{\n\tchar addr[18];\n\n\tif (!device || !device->le)\n\t\treturn;\n\n\tba2str(&device->bdaddr, addr);\n\n\tDBG(\"%s auto connect: %d\", addr, enable);\n\n\tif (device->auto_connect == enable)\n\t\treturn;\n\n\tdevice->auto_connect = enable;\n\n\t/* Disabling auto connect */\n\tif (enable == FALSE) {\n\t\tadapter_connect_list_remove(device->adapter, device);\n\t\tadapter_auto_connect_remove(device->adapter, device);\n\t\treturn;\n\t}\n\n\t/* Enabling auto connect */\n\tadapter_auto_connect_add(device->adapter, device);\n\n\tif (device->attrib) {\n\t\tDBG(\"Already connected\");\n\t\treturn;\n\t}\n\n\tadapter_connect_list_add(device->adapter, device);\n}"
  },
  {
    "function_name": "device_set_ltk_enc_size",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "1502-1506",
    "snippet": "void device_set_ltk_enc_size(struct btd_device *device, uint8_t enc_size)\n{\n\tdevice->ltk_enc_size = enc_size;\n\tbt_att_set_enc_key_size(device->att, device->ltk_enc_size);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "bt_att_set_enc_key_size",
          "args": [
            "device->att",
            "device->ltk_enc_size"
          ],
          "line": 1505
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_set_enc_key_size",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "1507-1513",
          "snippet": "void bt_att_set_enc_key_size(struct bt_att *att, uint8_t enc_size)\n{\n\tif (!att)\n\t\treturn;\n\n\tatt->enc_size = enc_size;\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nvoid bt_att_set_enc_key_size(struct bt_att *att, uint8_t enc_size)\n{\n\tif (!att)\n\t\treturn;\n\n\tatt->enc_size = enc_size;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid device_set_ltk_enc_size(struct btd_device *device, uint8_t enc_size)\n{\n\tdevice->ltk_enc_size = enc_size;\n\tbt_att_set_enc_key_size(device->att, device->ltk_enc_size);\n}"
  },
  {
    "function_name": "device_is_disconnecting",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "1497-1500",
    "snippet": "bool device_is_disconnecting(struct btd_device *device)\n{\n\treturn device->disconn_timer > 0;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nbool device_is_disconnecting(struct btd_device *device)\n{\n\treturn device->disconn_timer > 0;\n}"
  },
  {
    "function_name": "device_request_disconnect",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "1436-1495",
    "snippet": "void device_request_disconnect(struct btd_device *device, DBusMessage *msg)\n{\n\tif (device->bonding)\n\t\tbonding_request_cancel(device->bonding);\n\n\tif (device->browse)\n\t\tbrowse_request_cancel(device->browse);\n\n\tif (device->att_io) {\n\t\tg_io_channel_shutdown(device->att_io, FALSE, NULL);\n\t\tg_io_channel_unref(device->att_io);\n\t\tdevice->att_io = NULL;\n\t}\n\n\tif (device->connect) {\n\t\tDBusMessage *reply = btd_error_failed(device->connect,\n\t\t\t\t\t\t\t\t\"Cancelled\");\n\t\tg_dbus_send_message(dbus_conn, reply);\n\t\tdbus_message_unref(device->connect);\n\t\tdevice->connect = NULL;\n\t}\n\n\tif (btd_device_is_connected(device) && msg)\n\t\tdevice->disconnects = g_slist_append(device->disconnects,\n\t\t\t\t\t\tdbus_message_ref(msg));\n\n\tif (device->disconn_timer)\n\t\treturn;\n\n\tg_slist_foreach(device->services, dev_disconn_service, NULL);\n\n\tg_slist_free(device->pending);\n\tdevice->pending = NULL;\n\n\twhile (device->watches) {\n\t\tstruct btd_disconnect_data *data = device->watches->data;\n\n\t\tif (data->watch)\n\t\t\t/* temporary is set if device is going to be removed */\n\t\t\tdata->watch(device, device->temporary,\n\t\t\t\t\t\t\tdata->user_data);\n\n\t\t/* Check if the watch has been removed by callback function */\n\t\tif (!g_slist_find(device->watches, data))\n\t\t\tcontinue;\n\n\t\tdevice->watches = g_slist_remove(device->watches, data);\n\t\tg_free(data);\n\t}\n\n\tif (!btd_device_is_connected(device)) {\n\t\tif (msg)\n\t\t\tg_dbus_send_reply(dbus_conn, msg, DBUS_TYPE_INVALID);\n\t\treturn;\n\t}\n\n\tdevice->disconn_timer = g_timeout_add_seconds(DISCONNECT_TIMER,\n\t\t\t\t\t\t\tdisconnect_all,\n\t\t\t\t\t\t\tdevice);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define DISCONNECT_TIMER\t2"
    ],
    "globals_used": [
      "static DBusConnection *dbus_conn = NULL;",
      "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
      "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);",
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_timeout_add_seconds",
          "args": [
            "DISCONNECT_TIMER",
            "disconnect_all",
            "device"
          ],
          "line": 1492
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_send_reply",
          "args": [
            "dbus_conn",
            "msg",
            "DBUS_TYPE_INVALID"
          ],
          "line": 1488
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_device_is_connected",
          "args": [
            "device"
          ],
          "line": 1486
        },
        "resolved": true,
        "details": {
          "function_name": "btd_device_is_connected",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "2748-2751",
          "snippet": "bool btd_device_is_connected(struct btd_device *dev)\n{\n\treturn dev->bredr_state.connected || dev->le_state.connected;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nbool btd_device_is_connected(struct btd_device *dev)\n{\n\treturn dev->bredr_state.connected || dev->le_state.connected;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "data"
          ],
          "line": 1483
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_remove",
          "args": [
            "device->watches",
            "data"
          ],
          "line": 1482
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_find",
          "args": [
            "device->watches",
            "data"
          ],
          "line": 1479
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "data->watch",
          "args": [
            "device",
            "device->temporary",
            "data->user_data"
          ],
          "line": 1475
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_free",
          "args": [
            "device->pending"
          ],
          "line": 1467
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_foreach",
          "args": [
            "device->services",
            "dev_disconn_service",
            "NULL"
          ],
          "line": 1465
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_append",
          "args": [
            "device->disconnects",
            "dbus_message_ref(msg)"
          ],
          "line": 1459
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_ref",
          "args": [
            "msg"
          ],
          "line": 1460
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_unref",
          "args": [
            "device->connect"
          ],
          "line": 1454
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_send_message",
          "args": [
            "dbus_conn",
            "reply"
          ],
          "line": 1453
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_error_failed",
          "args": [
            "device->connect",
            "\"Cancelled\""
          ],
          "line": 1451
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "124-128",
          "snippet": "DBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_io_channel_unref",
          "args": [
            "device->att_io"
          ],
          "line": 1446
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_io_channel_shutdown",
          "args": [
            "device->att_io",
            "FALSE",
            "NULL"
          ],
          "line": 1445
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "browse_request_cancel",
          "args": [
            "device->browse"
          ],
          "line": 1442
        },
        "resolved": true,
        "details": {
          "function_name": "browse_request_cancel",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "614-626",
          "snippet": "static void browse_request_cancel(struct browse_req *req)\n{\n\tstruct btd_device *device = req->device;\n\tstruct btd_adapter *adapter = device->adapter;\n\n\tDBG(\"\");\n\n\tbt_cancel_discovery(btd_adapter_get_address(adapter), &device->bdaddr);\n\n\tattio_cleanup(device);\n\n\tbrowse_request_free(req);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void browse_request_cancel(struct browse_req *req)\n{\n\tstruct btd_device *device = req->device;\n\tstruct btd_adapter *adapter = device->adapter;\n\n\tDBG(\"\");\n\n\tbt_cancel_discovery(btd_adapter_get_address(adapter), &device->bdaddr);\n\n\tattio_cleanup(device);\n\n\tbrowse_request_free(req);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bonding_request_cancel",
          "args": [
            "device->bonding"
          ],
          "line": 1439
        },
        "resolved": true,
        "details": {
          "function_name": "bonding_request_cancel",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "1423-1429",
          "snippet": "static void bonding_request_cancel(struct bonding_req *bonding)\n{\n\tstruct btd_device *device = bonding->device;\n\tstruct btd_adapter *adapter = device->adapter;\n\n\tadapter_cancel_bonding(adapter, &device->bdaddr, device->bdaddr_type);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void bonding_request_cancel(struct bonding_req *bonding)\n{\n\tstruct btd_device *device = bonding->device;\n\tstruct btd_adapter *adapter = device->adapter;\n\n\tadapter_cancel_bonding(adapter, &device->bdaddr, device->bdaddr_type);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\n#define DISCONNECT_TIMER\t2\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid device_request_disconnect(struct btd_device *device, DBusMessage *msg)\n{\n\tif (device->bonding)\n\t\tbonding_request_cancel(device->bonding);\n\n\tif (device->browse)\n\t\tbrowse_request_cancel(device->browse);\n\n\tif (device->att_io) {\n\t\tg_io_channel_shutdown(device->att_io, FALSE, NULL);\n\t\tg_io_channel_unref(device->att_io);\n\t\tdevice->att_io = NULL;\n\t}\n\n\tif (device->connect) {\n\t\tDBusMessage *reply = btd_error_failed(device->connect,\n\t\t\t\t\t\t\t\t\"Cancelled\");\n\t\tg_dbus_send_message(dbus_conn, reply);\n\t\tdbus_message_unref(device->connect);\n\t\tdevice->connect = NULL;\n\t}\n\n\tif (btd_device_is_connected(device) && msg)\n\t\tdevice->disconnects = g_slist_append(device->disconnects,\n\t\t\t\t\t\tdbus_message_ref(msg));\n\n\tif (device->disconn_timer)\n\t\treturn;\n\n\tg_slist_foreach(device->services, dev_disconn_service, NULL);\n\n\tg_slist_free(device->pending);\n\tdevice->pending = NULL;\n\n\twhile (device->watches) {\n\t\tstruct btd_disconnect_data *data = device->watches->data;\n\n\t\tif (data->watch)\n\t\t\t/* temporary is set if device is going to be removed */\n\t\t\tdata->watch(device, device->temporary,\n\t\t\t\t\t\t\tdata->user_data);\n\n\t\t/* Check if the watch has been removed by callback function */\n\t\tif (!g_slist_find(device->watches, data))\n\t\t\tcontinue;\n\n\t\tdevice->watches = g_slist_remove(device->watches, data);\n\t\tg_free(data);\n\t}\n\n\tif (!btd_device_is_connected(device)) {\n\t\tif (msg)\n\t\t\tg_dbus_send_reply(dbus_conn, msg, DBUS_TYPE_INVALID);\n\t\treturn;\n\t}\n\n\tdevice->disconn_timer = g_timeout_add_seconds(DISCONNECT_TIMER,\n\t\t\t\t\t\t\tdisconnect_all,\n\t\t\t\t\t\t\tdevice);\n}"
  },
  {
    "function_name": "dev_disconn_service",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "1431-1434",
    "snippet": "static void dev_disconn_service(gpointer a, gpointer b)\n{\n\tbtd_service_disconnect(a);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "btd_service_disconnect",
          "args": [
            "a"
          ],
          "line": 1433
        },
        "resolved": true,
        "details": {
          "function_name": "btd_service_disconnect",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
          "lines": "271-309",
          "snippet": "int btd_service_disconnect(struct btd_service *service)\n{\n\tstruct btd_profile *profile = service->profile;\n\tchar addr[18];\n\tint err;\n\n\tif (!profile->disconnect)\n\t\treturn -ENOTSUP;\n\n\tswitch (service->state) {\n\tcase BTD_SERVICE_STATE_UNAVAILABLE:\n\t\treturn -EINVAL;\n\tcase BTD_SERVICE_STATE_DISCONNECTED:\n\tcase BTD_SERVICE_STATE_DISCONNECTING:\n\t\treturn -EALREADY;\n\tcase BTD_SERVICE_STATE_CONNECTING:\n\tcase BTD_SERVICE_STATE_CONNECTED:\n\t\tbreak;\n\t}\n\n\tchange_state(service, BTD_SERVICE_STATE_DISCONNECTING, 0);\n\n\terr = profile->disconnect(service);\n\tif (err == 0)\n\t\treturn 0;\n\n\tif (err == -ENOTCONN) {\n\t\tbtd_service_disconnecting_complete(service, 0);\n\t\treturn 0;\n\t}\n\n\tba2str(device_get_address(service->device), addr);\n\terror(\"%s profile disconnect failed for %s: %s\", profile->name, addr,\n\t\t\t\t\t\t\t\tstrerror(-err));\n\n\tbtd_service_disconnecting_complete(service, err);\n\n\treturn err;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/stat.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nint btd_service_disconnect(struct btd_service *service)\n{\n\tstruct btd_profile *profile = service->profile;\n\tchar addr[18];\n\tint err;\n\n\tif (!profile->disconnect)\n\t\treturn -ENOTSUP;\n\n\tswitch (service->state) {\n\tcase BTD_SERVICE_STATE_UNAVAILABLE:\n\t\treturn -EINVAL;\n\tcase BTD_SERVICE_STATE_DISCONNECTED:\n\tcase BTD_SERVICE_STATE_DISCONNECTING:\n\t\treturn -EALREADY;\n\tcase BTD_SERVICE_STATE_CONNECTING:\n\tcase BTD_SERVICE_STATE_CONNECTED:\n\t\tbreak;\n\t}\n\n\tchange_state(service, BTD_SERVICE_STATE_DISCONNECTING, 0);\n\n\terr = profile->disconnect(service);\n\tif (err == 0)\n\t\treturn 0;\n\n\tif (err == -ENOTCONN) {\n\t\tbtd_service_disconnecting_complete(service, 0);\n\t\treturn 0;\n\t}\n\n\tba2str(device_get_address(service->device), addr);\n\terror(\"%s profile disconnect failed for %s: %s\", profile->name, addr,\n\t\t\t\t\t\t\t\tstrerror(-err));\n\n\tbtd_service_disconnecting_complete(service, err);\n\n\treturn err;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void dev_disconn_service(gpointer a, gpointer b)\n{\n\tbtd_service_disconnect(a);\n}"
  },
  {
    "function_name": "bonding_request_cancel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "1423-1429",
    "snippet": "static void bonding_request_cancel(struct bonding_req *bonding)\n{\n\tstruct btd_device *device = bonding->device;\n\tstruct btd_adapter *adapter = device->adapter;\n\n\tadapter_cancel_bonding(adapter, &device->bdaddr, device->bdaddr_type);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "adapter_cancel_bonding",
          "args": [
            "adapter",
            "&device->bdaddr",
            "device->bdaddr_type"
          ],
          "line": 1428
        },
        "resolved": true,
        "details": {
          "function_name": "adapter_cancel_bonding",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "7061-7080",
          "snippet": "int adapter_cancel_bonding(struct btd_adapter *adapter, const bdaddr_t *bdaddr,\n\t\t\t\t\t\t\tuint8_t addr_type)\n{\n\tstruct mgmt_addr_info cp;\n\tchar addr[18];\n\n\tba2str(bdaddr, addr);\n\tDBG(\"hci%u bdaddr %s type %u\", adapter->dev_id, addr, addr_type);\n\n\tmemset(&cp, 0, sizeof(cp));\n\tbacpy(&cp.bdaddr, bdaddr);\n\tcp.type = addr_type;\n\n\tif (mgmt_reply(adapter->mgmt, MGMT_OP_CANCEL_PAIR_DEVICE,\n\t\t\t\tadapter->dev_id, sizeof(cp), &cp,\n\t\t\t\tNULL, NULL, NULL) > 0)\n\t\treturn 0;\n\n\treturn -EIO;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nint adapter_cancel_bonding(struct btd_adapter *adapter, const bdaddr_t *bdaddr,\n\t\t\t\t\t\t\tuint8_t addr_type)\n{\n\tstruct mgmt_addr_info cp;\n\tchar addr[18];\n\n\tba2str(bdaddr, addr);\n\tDBG(\"hci%u bdaddr %s type %u\", adapter->dev_id, addr, addr_type);\n\n\tmemset(&cp, 0, sizeof(cp));\n\tbacpy(&cp.bdaddr, bdaddr);\n\tcp.type = addr_type;\n\n\tif (mgmt_reply(adapter->mgmt, MGMT_OP_CANCEL_PAIR_DEVICE,\n\t\t\t\tadapter->dev_id, sizeof(cp), &cp,\n\t\t\t\tNULL, NULL, NULL) > 0)\n\t\treturn 0;\n\n\treturn -EIO;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void bonding_request_cancel(struct bonding_req *bonding)\n{\n\tstruct btd_device *device = bonding->device;\n\tstruct btd_adapter *adapter = device->adapter;\n\n\tadapter_cancel_bonding(adapter, &device->bdaddr, device->bdaddr_type);\n}"
  },
  {
    "function_name": "browse_request_exit",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "1414-1421",
    "snippet": "static void browse_request_exit(DBusConnection *conn, void *user_data)\n{\n\tstruct browse_req *req = user_data;\n\n\tDBG(\"Requestor exited\");\n\n\tbrowse_request_cancel(req);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "browse_request_cancel",
          "args": [
            "req"
          ],
          "line": 1420
        },
        "resolved": true,
        "details": {
          "function_name": "browse_request_cancel",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "614-626",
          "snippet": "static void browse_request_cancel(struct browse_req *req)\n{\n\tstruct btd_device *device = req->device;\n\tstruct btd_adapter *adapter = device->adapter;\n\n\tDBG(\"\");\n\n\tbt_cancel_discovery(btd_adapter_get_address(adapter), &device->bdaddr);\n\n\tattio_cleanup(device);\n\n\tbrowse_request_free(req);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void browse_request_cancel(struct browse_req *req)\n{\n\tstruct btd_device *device = req->device;\n\tstruct btd_adapter *adapter = device->adapter;\n\n\tDBG(\"\");\n\n\tbt_cancel_discovery(btd_adapter_get_address(adapter), &device->bdaddr);\n\n\tattio_cleanup(device);\n\n\tbrowse_request_free(req);\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Requestor exited\""
          ],
          "line": 1418
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void browse_request_exit(DBusConnection *conn, void *user_data)\n{\n\tstruct browse_req *req = user_data;\n\n\tDBG(\"Requestor exited\");\n\n\tbrowse_request_cancel(req);\n}"
  },
  {
    "function_name": "device_unblock",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "1379-1412",
    "snippet": "int device_unblock(struct btd_device *device, gboolean silent,\n\t\t\t\t\t\t\tgboolean update_only)\n{\n\tint err = 0;\n\n\tif (!device->blocked)\n\t\treturn 0;\n\n\tif (!update_only) {\n\t\tif (device->le)\n\t\t\terr = btd_adapter_unblock_address(device->adapter,\n\t\t\t\t\t\t\t&device->bdaddr,\n\t\t\t\t\t\t\tdevice->bdaddr_type);\n\t\tif (!err && device->bredr)\n\t\t\terr = btd_adapter_unblock_address(device->adapter,\n\t\t\t\t\t\t\t&device->bdaddr,\n\t\t\t\t\t\t\tBDADDR_BREDR);\n\t}\n\n\tif (err < 0)\n\t\treturn err;\n\n\tdevice->blocked = FALSE;\n\n\tstore_device_info(device);\n\n\tif (!silent) {\n\t\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"Blocked\");\n\t\tdevice_probe_profiles(device, device->uuids);\n\t}\n\n\treturn 0;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static DBusConnection *dbus_conn = NULL;",
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "device_probe_profiles",
          "args": [
            "device",
            "device->uuids"
          ],
          "line": 1408
        },
        "resolved": true,
        "details": {
          "function_name": "device_probe_profiles",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "4360-4378",
          "snippet": "void device_probe_profiles(struct btd_device *device, GSList *uuids)\n{\n\tstruct probe_data d = { device, uuids };\n\tchar addr[18];\n\n\tba2str(&device->bdaddr, addr);\n\n\tif (device->blocked) {\n\t\tDBG(\"Skipping profiles for blocked device %s\", addr);\n\t\tgoto add_uuids;\n\t}\n\n\tDBG(\"Probing profiles for device %s\", addr);\n\n\tbtd_profile_foreach(dev_probe, &d);\n\nadd_uuids:\n\tdevice_add_uuids(device, uuids);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid device_probe_profiles(struct btd_device *device, GSList *uuids)\n{\n\tstruct probe_data d = { device, uuids };\n\tchar addr[18];\n\n\tba2str(&device->bdaddr, addr);\n\n\tif (device->blocked) {\n\t\tDBG(\"Skipping profiles for blocked device %s\", addr);\n\t\tgoto add_uuids;\n\t}\n\n\tDBG(\"Probing profiles for device %s\", addr);\n\n\tbtd_profile_foreach(dev_probe, &d);\n\nadd_uuids:\n\tdevice_add_uuids(device, uuids);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_emit_property_changed",
          "args": [
            "dbus_conn",
            "device->path",
            "DEVICE_INTERFACE",
            "\"Blocked\""
          ],
          "line": 1406
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "store_device_info",
          "args": [
            "device"
          ],
          "line": 1403
        },
        "resolved": true,
        "details": {
          "function_name": "store_device_info",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "475-487",
          "snippet": "static void store_device_info(struct btd_device *device)\n{\n\tif (device->temporary || device->store_id > 0)\n\t\treturn;\n\n\tif (device_address_is_private(device)) {\n\t\tDBG(\"Can't store info for private addressed device %s\",\n\t\t\t\t\t\t\t\tdevice->path);\n\t\treturn;\n\t}\n\n\tdevice->store_id = g_idle_add(store_device_info_cb, device);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void store_device_info(struct btd_device *device)\n{\n\tif (device->temporary || device->store_id > 0)\n\t\treturn;\n\n\tif (device_address_is_private(device)) {\n\t\tDBG(\"Can't store info for private addressed device %s\",\n\t\t\t\t\t\t\t\tdevice->path);\n\t\treturn;\n\t}\n\n\tdevice->store_id = g_idle_add(store_device_info_cb, device);\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_adapter_unblock_address",
          "args": [
            "device->adapter",
            "&device->bdaddr",
            "BDADDR_BREDR"
          ],
          "line": 1393
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_unblock_address",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "4234-4253",
          "snippet": "int btd_adapter_unblock_address(struct btd_adapter *adapter,\n\t\t\t\tconst bdaddr_t *bdaddr, uint8_t bdaddr_type)\n{\n\tstruct mgmt_cp_unblock_device cp;\n\tchar addr[18];\n\n\tba2str(bdaddr, addr);\n\tDBG(\"hci%u %s\", adapter->dev_id, addr);\n\n\tmemset(&cp, 0, sizeof(cp));\n\tbacpy(&cp.addr.bdaddr, bdaddr);\n\tcp.addr.type = bdaddr_type;\n\n\tif (mgmt_send(adapter->mgmt, MGMT_OP_UNBLOCK_DEVICE,\n\t\t\t\tadapter->dev_id, sizeof(cp), &cp,\n\t\t\t\tNULL, NULL, NULL) > 0)\n\t\treturn 0;\n\n\treturn -EIO;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nint btd_adapter_unblock_address(struct btd_adapter *adapter,\n\t\t\t\tconst bdaddr_t *bdaddr, uint8_t bdaddr_type)\n{\n\tstruct mgmt_cp_unblock_device cp;\n\tchar addr[18];\n\n\tba2str(bdaddr, addr);\n\tDBG(\"hci%u %s\", adapter->dev_id, addr);\n\n\tmemset(&cp, 0, sizeof(cp));\n\tbacpy(&cp.addr.bdaddr, bdaddr);\n\tcp.addr.type = bdaddr_type;\n\n\tif (mgmt_send(adapter->mgmt, MGMT_OP_UNBLOCK_DEVICE,\n\t\t\t\tadapter->dev_id, sizeof(cp), &cp,\n\t\t\t\tNULL, NULL, NULL) > 0)\n\t\treturn 0;\n\n\treturn -EIO;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic void gatt_client_init(struct btd_device *device);\n\nint device_unblock(struct btd_device *device, gboolean silent,\n\t\t\t\t\t\t\tgboolean update_only)\n{\n\tint err = 0;\n\n\tif (!device->blocked)\n\t\treturn 0;\n\n\tif (!update_only) {\n\t\tif (device->le)\n\t\t\terr = btd_adapter_unblock_address(device->adapter,\n\t\t\t\t\t\t\t&device->bdaddr,\n\t\t\t\t\t\t\tdevice->bdaddr_type);\n\t\tif (!err && device->bredr)\n\t\t\terr = btd_adapter_unblock_address(device->adapter,\n\t\t\t\t\t\t\t&device->bdaddr,\n\t\t\t\t\t\t\tBDADDR_BREDR);\n\t}\n\n\tif (err < 0)\n\t\treturn err;\n\n\tdevice->blocked = FALSE;\n\n\tstore_device_info(device);\n\n\tif (!silent) {\n\t\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"Blocked\");\n\t\tdevice_probe_profiles(device, device->uuids);\n\t}\n\n\treturn 0;\n}"
  },
  {
    "function_name": "device_block",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "1334-1377",
    "snippet": "int device_block(struct btd_device *device, gboolean update_only)\n{\n\tint err = 0;\n\n\tif (device->blocked)\n\t\treturn 0;\n\n\tif (device->disconn_timer > 0)\n\t\tg_source_remove(device->disconn_timer);\n\n\tdisconnect_all(device);\n\n\twhile (device->services != NULL) {\n\t\tstruct btd_service *service = device->services->data;\n\n\t\tdevice->services = g_slist_remove(device->services, service);\n\t\tservice_remove(service);\n\t}\n\n\tif (!update_only) {\n\t\tif (device->le)\n\t\t\terr = btd_adapter_block_address(device->adapter,\n\t\t\t\t\t\t\t&device->bdaddr,\n\t\t\t\t\t\t\tdevice->bdaddr_type);\n\t\tif (!err && device->bredr)\n\t\t\terr = btd_adapter_block_address(device->adapter,\n\t\t\t\t\t\t\t&device->bdaddr,\n\t\t\t\t\t\t\tBDADDR_BREDR);\n\t}\n\n\tif (err < 0)\n\t\treturn err;\n\n\tdevice->blocked = TRUE;\n\n\tstore_device_info(device);\n\n\tbtd_device_set_temporary(device, false);\n\n\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"Blocked\");\n\n\treturn 0;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static DBusConnection *dbus_conn = NULL;",
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_dbus_emit_property_changed",
          "args": [
            "dbus_conn",
            "device->path",
            "DEVICE_INTERFACE",
            "\"Blocked\""
          ],
          "line": 1373
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_device_set_temporary",
          "args": [
            "device",
            "false"
          ],
          "line": 1371
        },
        "resolved": true,
        "details": {
          "function_name": "btd_device_set_temporary",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5336-5368",
          "snippet": "void btd_device_set_temporary(struct btd_device *device, bool temporary)\n{\n\tif (!device)\n\t\treturn;\n\n\tif (device->temporary == temporary)\n\t\treturn;\n\n\tif (device_address_is_private(device))\n\t\treturn;\n\n\tDBG(\"temporary %d\", temporary);\n\n\tdevice->temporary = temporary;\n\n\tif (temporary) {\n\t\tif (device->bredr)\n\t\t\tadapter_whitelist_remove(device->adapter, device);\n\t\tadapter_connect_list_remove(device->adapter, device);\n\t\treturn;\n\t}\n\n\tif (device->bredr)\n\t\tadapter_whitelist_add(device->adapter, device);\n\n\tstore_device_info(device);\n\n\t/* attributes were not stored when resolved if device was temporary */\n\tif (device->bdaddr_type != BDADDR_BREDR &&\n\t\t\tdevice->le_state.svc_resolved &&\n\t\t\tg_slist_length(device->primaries) != 0)\n\t\tstore_services(device);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid btd_device_set_temporary(struct btd_device *device, bool temporary)\n{\n\tif (!device)\n\t\treturn;\n\n\tif (device->temporary == temporary)\n\t\treturn;\n\n\tif (device_address_is_private(device))\n\t\treturn;\n\n\tDBG(\"temporary %d\", temporary);\n\n\tdevice->temporary = temporary;\n\n\tif (temporary) {\n\t\tif (device->bredr)\n\t\t\tadapter_whitelist_remove(device->adapter, device);\n\t\tadapter_connect_list_remove(device->adapter, device);\n\t\treturn;\n\t}\n\n\tif (device->bredr)\n\t\tadapter_whitelist_add(device->adapter, device);\n\n\tstore_device_info(device);\n\n\t/* attributes were not stored when resolved if device was temporary */\n\tif (device->bdaddr_type != BDADDR_BREDR &&\n\t\t\tdevice->le_state.svc_resolved &&\n\t\t\tg_slist_length(device->primaries) != 0)\n\t\tstore_services(device);\n}"
        }
      },
      {
        "call_info": {
          "callee": "store_device_info",
          "args": [
            "device"
          ],
          "line": 1369
        },
        "resolved": true,
        "details": {
          "function_name": "store_device_info",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "475-487",
          "snippet": "static void store_device_info(struct btd_device *device)\n{\n\tif (device->temporary || device->store_id > 0)\n\t\treturn;\n\n\tif (device_address_is_private(device)) {\n\t\tDBG(\"Can't store info for private addressed device %s\",\n\t\t\t\t\t\t\t\tdevice->path);\n\t\treturn;\n\t}\n\n\tdevice->store_id = g_idle_add(store_device_info_cb, device);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void store_device_info(struct btd_device *device)\n{\n\tif (device->temporary || device->store_id > 0)\n\t\treturn;\n\n\tif (device_address_is_private(device)) {\n\t\tDBG(\"Can't store info for private addressed device %s\",\n\t\t\t\t\t\t\t\tdevice->path);\n\t\treturn;\n\t}\n\n\tdevice->store_id = g_idle_add(store_device_info_cb, device);\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_adapter_block_address",
          "args": [
            "device->adapter",
            "&device->bdaddr",
            "BDADDR_BREDR"
          ],
          "line": 1359
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_block_address",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "4213-4232",
          "snippet": "int btd_adapter_block_address(struct btd_adapter *adapter,\n\t\t\t\tconst bdaddr_t *bdaddr, uint8_t bdaddr_type)\n{\n\tstruct mgmt_cp_block_device cp;\n\tchar addr[18];\n\n\tba2str(bdaddr, addr);\n\tDBG(\"hci%u %s\", adapter->dev_id, addr);\n\n\tmemset(&cp, 0, sizeof(cp));\n\tbacpy(&cp.addr.bdaddr, bdaddr);\n\tcp.addr.type = bdaddr_type;\n\n\tif (mgmt_send(adapter->mgmt, MGMT_OP_BLOCK_DEVICE,\n\t\t\t\tadapter->dev_id, sizeof(cp), &cp,\n\t\t\t\tNULL, NULL, NULL) > 0)\n\t\treturn 0;\n\n\treturn -EIO;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nint btd_adapter_block_address(struct btd_adapter *adapter,\n\t\t\t\tconst bdaddr_t *bdaddr, uint8_t bdaddr_type)\n{\n\tstruct mgmt_cp_block_device cp;\n\tchar addr[18];\n\n\tba2str(bdaddr, addr);\n\tDBG(\"hci%u %s\", adapter->dev_id, addr);\n\n\tmemset(&cp, 0, sizeof(cp));\n\tbacpy(&cp.addr.bdaddr, bdaddr);\n\tcp.addr.type = bdaddr_type;\n\n\tif (mgmt_send(adapter->mgmt, MGMT_OP_BLOCK_DEVICE,\n\t\t\t\tadapter->dev_id, sizeof(cp), &cp,\n\t\t\t\tNULL, NULL, NULL) > 0)\n\t\treturn 0;\n\n\treturn -EIO;\n}"
        }
      },
      {
        "call_info": {
          "callee": "service_remove",
          "args": [
            "service"
          ],
          "line": 1350
        },
        "resolved": true,
        "details": {
          "function_name": "btd_service_remove_state_cb",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
          "lines": "356-371",
          "snippet": "bool btd_service_remove_state_cb(unsigned int id)\n{\n\tGSList *l;\n\n\tfor (l = state_callbacks; l != NULL; l = g_slist_next(l)) {\n\t\tstruct service_state_callback *cb = l->data;\n\n\t\tif (cb && cb->id == id) {\n\t\t\tstate_callbacks = g_slist_remove(state_callbacks, cb);\n\t\t\tg_free(cb);\n\t\t\treturn true;\n\t\t}\n\t}\n\n\treturn false;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/stat.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static GSList *state_callbacks = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic GSList *state_callbacks = NULL;\n\nbool btd_service_remove_state_cb(unsigned int id)\n{\n\tGSList *l;\n\n\tfor (l = state_callbacks; l != NULL; l = g_slist_next(l)) {\n\t\tstruct service_state_callback *cb = l->data;\n\n\t\tif (cb && cb->id == id) {\n\t\t\tstate_callbacks = g_slist_remove(state_callbacks, cb);\n\t\t\tg_free(cb);\n\t\t\treturn true;\n\t\t}\n\t}\n\n\treturn false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_slist_remove",
          "args": [
            "device->services",
            "service"
          ],
          "line": 1349
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "disconnect_all",
          "args": [
            "device"
          ],
          "line": 1344
        },
        "resolved": true,
        "details": {
          "function_name": "disconnect_all",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "1317-1332",
          "snippet": "static gboolean disconnect_all(gpointer user_data)\n{\n\tstruct btd_device *device = user_data;\n\n\tdevice->disconn_timer = 0;\n\n\tif (device->bredr_state.connected)\n\t\tbtd_adapter_disconnect_device(device->adapter, &device->bdaddr,\n\t\t\t\t\t\t\t\tBDADDR_BREDR);\n\n\tif (device->le_state.connected)\n\t\tbtd_adapter_disconnect_device(device->adapter, &device->bdaddr,\n\t\t\t\t\t\t\tdevice->bdaddr_type);\n\n\treturn FALSE;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic gboolean disconnect_all(gpointer user_data)\n{\n\tstruct btd_device *device = user_data;\n\n\tdevice->disconn_timer = 0;\n\n\tif (device->bredr_state.connected)\n\t\tbtd_adapter_disconnect_device(device->adapter, &device->bdaddr,\n\t\t\t\t\t\t\t\tBDADDR_BREDR);\n\n\tif (device->le_state.connected)\n\t\tbtd_adapter_disconnect_device(device->adapter, &device->bdaddr,\n\t\t\t\t\t\t\tdevice->bdaddr_type);\n\n\treturn FALSE;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_source_remove",
          "args": [
            "device->disconn_timer"
          ],
          "line": 1342
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic void gatt_client_init(struct btd_device *device);\n\nint device_block(struct btd_device *device, gboolean update_only)\n{\n\tint err = 0;\n\n\tif (device->blocked)\n\t\treturn 0;\n\n\tif (device->disconn_timer > 0)\n\t\tg_source_remove(device->disconn_timer);\n\n\tdisconnect_all(device);\n\n\twhile (device->services != NULL) {\n\t\tstruct btd_service *service = device->services->data;\n\n\t\tdevice->services = g_slist_remove(device->services, service);\n\t\tservice_remove(service);\n\t}\n\n\tif (!update_only) {\n\t\tif (device->le)\n\t\t\terr = btd_adapter_block_address(device->adapter,\n\t\t\t\t\t\t\t&device->bdaddr,\n\t\t\t\t\t\t\tdevice->bdaddr_type);\n\t\tif (!err && device->bredr)\n\t\t\terr = btd_adapter_block_address(device->adapter,\n\t\t\t\t\t\t\t&device->bdaddr,\n\t\t\t\t\t\t\tBDADDR_BREDR);\n\t}\n\n\tif (err < 0)\n\t\treturn err;\n\n\tdevice->blocked = TRUE;\n\n\tstore_device_info(device);\n\n\tbtd_device_set_temporary(device, false);\n\n\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"Blocked\");\n\n\treturn 0;\n}"
  },
  {
    "function_name": "disconnect_all",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "1317-1332",
    "snippet": "static gboolean disconnect_all(gpointer user_data)\n{\n\tstruct btd_device *device = user_data;\n\n\tdevice->disconn_timer = 0;\n\n\tif (device->bredr_state.connected)\n\t\tbtd_adapter_disconnect_device(device->adapter, &device->bdaddr,\n\t\t\t\t\t\t\t\tBDADDR_BREDR);\n\n\tif (device->le_state.connected)\n\t\tbtd_adapter_disconnect_device(device->adapter, &device->bdaddr,\n\t\t\t\t\t\t\tdevice->bdaddr_type);\n\n\treturn FALSE;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "btd_adapter_disconnect_device",
          "args": [
            "device->adapter",
            "&device->bdaddr",
            "device->bdaddr_type"
          ],
          "line": 1328
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_disconnect_device",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "7351-7368",
          "snippet": "int btd_adapter_disconnect_device(struct btd_adapter *adapter,\n\t\t\t\t\t\tconst bdaddr_t *bdaddr,\n\t\t\t\t\t\tuint8_t bdaddr_type)\n\n{\n\tstruct mgmt_cp_disconnect cp;\n\n\tmemset(&cp, 0, sizeof(cp));\n\tbacpy(&cp.addr.bdaddr, bdaddr);\n\tcp.addr.type = bdaddr_type;\n\n\tif (mgmt_send(adapter->mgmt, MGMT_OP_DISCONNECT,\n\t\t\t\tadapter->dev_id, sizeof(cp), &cp,\n\t\t\t\tdisconnect_complete, adapter, NULL) > 0)\n\t\treturn 0;\n\n\treturn -EIO;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nint btd_adapter_disconnect_device(struct btd_adapter *adapter,\n\t\t\t\t\t\tconst bdaddr_t *bdaddr,\n\t\t\t\t\t\tuint8_t bdaddr_type)\n\n{\n\tstruct mgmt_cp_disconnect cp;\n\n\tmemset(&cp, 0, sizeof(cp));\n\tbacpy(&cp.addr.bdaddr, bdaddr);\n\tcp.addr.type = bdaddr_type;\n\n\tif (mgmt_send(adapter->mgmt, MGMT_OP_DISCONNECT,\n\t\t\t\tadapter->dev_id, sizeof(cp), &cp,\n\t\t\t\tdisconnect_complete, adapter, NULL) > 0)\n\t\treturn 0;\n\n\treturn -EIO;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic gboolean disconnect_all(gpointer user_data)\n{\n\tstruct btd_device *device = user_data;\n\n\tdevice->disconn_timer = 0;\n\n\tif (device->bredr_state.connected)\n\t\tbtd_adapter_disconnect_device(device->adapter, &device->bdaddr,\n\t\t\t\t\t\t\t\tBDADDR_BREDR);\n\n\tif (device->le_state.connected)\n\t\tbtd_adapter_disconnect_device(device->adapter, &device->bdaddr,\n\t\t\t\t\t\t\tdevice->bdaddr_type);\n\n\treturn FALSE;\n}"
  },
  {
    "function_name": "dev_property_advertising_data_exist",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "1308-1315",
    "snippet": "static gboolean\ndev_property_advertising_data_exist(const GDBusPropertyTable *property,\n\t\t\t\t\t\t\t\tvoid *data)\n{\n\tstruct btd_device *device = data;\n\n\treturn bt_ad_has_data(device->ad, NULL);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "bt_ad_has_data",
          "args": [
            "device->ad",
            "NULL"
          ],
          "line": 1314
        },
        "resolved": true,
        "details": {
          "function_name": "bt_ad_has_data",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "964-973",
          "snippet": "bool bt_ad_has_data(struct bt_ad *ad, const struct bt_ad_data *data)\n{\n\tif (!ad)\n\t\treturn false;\n\n\tif (!data)\n\t\treturn !queue_isempty(ad->data);\n\n\treturn queue_find(ad->data, data_match, data);\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nbool bt_ad_has_data(struct bt_ad *ad, const struct bt_ad_data *data)\n{\n\tif (!ad)\n\t\treturn false;\n\n\tif (!data)\n\t\treturn !queue_isempty(ad->data);\n\n\treturn queue_find(ad->data, data_match, data);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic gboolean\ndev_property_advertising_data_exist(const GDBusPropertyTable *property,\n\t\t\t\t\t\t\t\tvoid *data)\n{\n\tstruct btd_device *device = data;\n\n\treturn bt_ad_has_data(device->ad, NULL);\n}"
  },
  {
    "function_name": "dev_property_get_advertising_data",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "1287-1306",
    "snippet": "static gboolean\ndev_property_get_advertising_data(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct btd_device *device = data;\n\tDBusMessageIter dict;\n\n\tdbus_message_iter_open_container(iter, DBUS_TYPE_ARRAY,\n\t\t\t\t\tDBUS_DICT_ENTRY_BEGIN_CHAR_AS_STRING\n\t\t\t\t\tDBUS_TYPE_BYTE_AS_STRING\n\t\t\t\t\tDBUS_TYPE_VARIANT_AS_STRING\n\t\t\t\t\tDBUS_DICT_ENTRY_END_CHAR_AS_STRING,\n\t\t\t\t\t&dict);\n\n\tbt_ad_foreach_data(device->ad, append_advertising_data, &dict);\n\n\tdbus_message_iter_close_container(iter, &dict);\n\n\treturn TRUE;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_iter_close_container",
          "args": [
            "iter",
            "&dict"
          ],
          "line": 1303
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_ad_foreach_data",
          "args": [
            "device->ad",
            "append_advertising_data",
            "&dict"
          ],
          "line": 1301
        },
        "resolved": true,
        "details": {
          "function_name": "bt_ad_foreach_data",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "975-981",
          "snippet": "void bt_ad_foreach_data(struct bt_ad *ad, bt_ad_func_t func, void *user_data)\n{\n\tif (!ad)\n\t\treturn;\n\n\tqueue_foreach(ad->data, func, user_data);\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nvoid bt_ad_foreach_data(struct bt_ad *ad, bt_ad_func_t func, void *user_data)\n{\n\tif (!ad)\n\t\treturn;\n\n\tqueue_foreach(ad->data, func, user_data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_open_container",
          "args": [
            "iter",
            "DBUS_TYPE_ARRAY",
            "DBUS_DICT_ENTRY_BEGIN_CHAR_AS_STRINGDBUS_TYPE_BYTE_AS_STRING\n\t\t\t\t\tDBUS_TYPE_VARIANT_AS_STRING\n\t\t\t\t\tDBUS_DICT_ENTRY_END_CHAR_AS_STRING",
            "&dict"
          ],
          "line": 1294
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic gboolean\ndev_property_get_advertising_data(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct btd_device *device = data;\n\tDBusMessageIter dict;\n\n\tdbus_message_iter_open_container(iter, DBUS_TYPE_ARRAY,\n\t\t\t\t\tDBUS_DICT_ENTRY_BEGIN_CHAR_AS_STRING\n\t\t\t\t\tDBUS_TYPE_BYTE_AS_STRING\n\t\t\t\t\tDBUS_TYPE_VARIANT_AS_STRING\n\t\t\t\t\tDBUS_DICT_ENTRY_END_CHAR_AS_STRING,\n\t\t\t\t\t&dict);\n\n\tbt_ad_foreach_data(device->ad, append_advertising_data, &dict);\n\n\tdbus_message_iter_close_container(iter, &dict);\n\n\treturn TRUE;\n}"
  },
  {
    "function_name": "append_advertising_data",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "1277-1285",
    "snippet": "static void append_advertising_data(void *data, void *user_data)\n{\n\tstruct bt_ad_data *ad = data;\n\tDBusMessageIter *dict = user_data;\n\n\tg_dbus_dict_append_basic_array(dict,\n\t\t\t\tDBUS_TYPE_BYTE, &ad->type,\n\t\t\t\tDBUS_TYPE_BYTE, &ad->data, ad->len);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_dbus_dict_append_basic_array",
          "args": [
            "dict",
            "DBUS_TYPE_BYTE",
            "&ad->type",
            "DBUS_TYPE_BYTE",
            "&ad->data",
            "ad->len"
          ],
          "line": 1282
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void append_advertising_data(void *data, void *user_data)\n{\n\tstruct bt_ad_data *ad = data;\n\tDBusMessageIter *dict = user_data;\n\n\tg_dbus_dict_append_basic_array(dict,\n\t\t\t\tDBUS_TYPE_BYTE, &ad->type,\n\t\t\t\tDBUS_TYPE_BYTE, &ad->data, ad->len);\n}"
  },
  {
    "function_name": "dev_property_service_data_exist",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "1268-1275",
    "snippet": "static gboolean\ndev_property_service_data_exist(const GDBusPropertyTable *property,\n\t\t\t\t\t\t\t\tvoid *data)\n{\n\tstruct btd_device *device = data;\n\n\treturn bt_ad_has_service_data(device->ad, NULL);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "bt_ad_has_service_data",
          "args": [
            "device->ad",
            "NULL"
          ],
          "line": 1274
        },
        "resolved": true,
        "details": {
          "function_name": "bt_ad_has_service_data",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "769-779",
          "snippet": "bool bt_ad_has_service_data(struct bt_ad *ad,\n\t\t\t\t\tconst struct bt_ad_service_data *data)\n{\n\tif (!ad)\n\t\treturn false;\n\n\tif (!data)\n\t\treturn !queue_isempty(ad->service_data);\n\n\treturn queue_find(ad->service_data, service_data_match, data);\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nbool bt_ad_has_service_data(struct bt_ad *ad,\n\t\t\t\t\tconst struct bt_ad_service_data *data)\n{\n\tif (!ad)\n\t\treturn false;\n\n\tif (!data)\n\t\treturn !queue_isempty(ad->service_data);\n\n\treturn queue_find(ad->service_data, service_data_match, data);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic gboolean\ndev_property_service_data_exist(const GDBusPropertyTable *property,\n\t\t\t\t\t\t\t\tvoid *data)\n{\n\tstruct btd_device *device = data;\n\n\treturn bt_ad_has_service_data(device->ad, NULL);\n}"
  },
  {
    "function_name": "dev_property_get_service_data",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "1247-1266",
    "snippet": "static gboolean\ndev_property_get_service_data(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct btd_device *device = data;\n\tDBusMessageIter dict;\n\n\tdbus_message_iter_open_container(iter, DBUS_TYPE_ARRAY,\n\t\t\t\t\tDBUS_DICT_ENTRY_BEGIN_CHAR_AS_STRING\n\t\t\t\t\tDBUS_TYPE_STRING_AS_STRING\n\t\t\t\t\tDBUS_TYPE_VARIANT_AS_STRING\n\t\t\t\t\tDBUS_DICT_ENTRY_END_CHAR_AS_STRING,\n\t\t\t\t\t&dict);\n\n\tbt_ad_foreach_service_data(device->ad, append_service_data, &dict);\n\n\tdbus_message_iter_close_container(iter, &dict);\n\n\treturn TRUE;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_iter_close_container",
          "args": [
            "iter",
            "&dict"
          ],
          "line": 1263
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_ad_foreach_service_data",
          "args": [
            "device->ad",
            "append_service_data",
            "&dict"
          ],
          "line": 1261
        },
        "resolved": true,
        "details": {
          "function_name": "bt_ad_foreach_service_data",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "781-788",
          "snippet": "void bt_ad_foreach_service_data(struct bt_ad *ad, bt_ad_func_t func,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tif (!ad)\n\t\treturn;\n\n\tqueue_foreach(ad->service_data, func, user_data);\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nvoid bt_ad_foreach_service_data(struct bt_ad *ad, bt_ad_func_t func,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tif (!ad)\n\t\treturn;\n\n\tqueue_foreach(ad->service_data, func, user_data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_open_container",
          "args": [
            "iter",
            "DBUS_TYPE_ARRAY",
            "DBUS_DICT_ENTRY_BEGIN_CHAR_AS_STRINGDBUS_TYPE_STRING_AS_STRING\n\t\t\t\t\tDBUS_TYPE_VARIANT_AS_STRING\n\t\t\t\t\tDBUS_DICT_ENTRY_END_CHAR_AS_STRING",
            "&dict"
          ],
          "line": 1254
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic gboolean\ndev_property_get_service_data(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct btd_device *device = data;\n\tDBusMessageIter dict;\n\n\tdbus_message_iter_open_container(iter, DBUS_TYPE_ARRAY,\n\t\t\t\t\tDBUS_DICT_ENTRY_BEGIN_CHAR_AS_STRING\n\t\t\t\t\tDBUS_TYPE_STRING_AS_STRING\n\t\t\t\t\tDBUS_TYPE_VARIANT_AS_STRING\n\t\t\t\t\tDBUS_DICT_ENTRY_END_CHAR_AS_STRING,\n\t\t\t\t\t&dict);\n\n\tbt_ad_foreach_service_data(device->ad, append_service_data, &dict);\n\n\tdbus_message_iter_close_container(iter, &dict);\n\n\treturn TRUE;\n}"
  },
  {
    "function_name": "append_service_data",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "1236-1245",
    "snippet": "static void append_service_data(void *data, void *user_data)\n{\n\tstruct bt_ad_service_data *sd = data;\n\tDBusMessageIter *dict = user_data;\n\tchar uuid_str[MAX_LEN_UUID_STR];\n\n\tbt_uuid_to_string(&sd->uuid, uuid_str, sizeof(uuid_str));\n\n\tdict_append_array(dict, uuid_str, DBUS_TYPE_BYTE, &sd->data, sd->len);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dict_append_array",
          "args": [
            "dict",
            "uuid_str",
            "DBUS_TYPE_BYTE",
            "&sd->data",
            "sd->len"
          ],
          "line": 1244
        },
        "resolved": true,
        "details": {
          "function_name": "dict_append_array",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/dbus-common.c",
          "lines": "50-54",
          "snippet": "void dict_append_array(DBusMessageIter *dict, const char *key, int type,\n\t\t\tvoid *val, int n_elements)\n{\n\tg_dbus_dict_append_array(dict, key, type, val, n_elements);\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid dict_append_array(DBusMessageIter *dict, const char *key, int type,\n\t\t\tvoid *val, int n_elements)\n{\n\tg_dbus_dict_append_array(dict, key, type, val, n_elements);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_uuid_to_string",
          "args": [
            "&sd->uuid",
            "uuid_str",
            "sizeof(uuid_str)"
          ],
          "line": 1242
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void append_service_data(void *data, void *user_data)\n{\n\tstruct bt_ad_service_data *sd = data;\n\tDBusMessageIter *dict = user_data;\n\tchar uuid_str[MAX_LEN_UUID_STR];\n\n\tbt_uuid_to_string(&sd->uuid, uuid_str, sizeof(uuid_str));\n\n\tdict_append_array(dict, uuid_str, DBUS_TYPE_BYTE, &sd->data, sd->len);\n}"
  },
  {
    "function_name": "dev_property_manufacturer_data_exist",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "1227-1234",
    "snippet": "static gboolean\ndev_property_manufacturer_data_exist(const GDBusPropertyTable *property,\n\t\t\t\t\t\t\t\tvoid *data)\n{\n\tstruct btd_device *device = data;\n\n\treturn bt_ad_has_manufacturer_data(device->ad, NULL);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "bt_ad_has_manufacturer_data",
          "args": [
            "device->ad",
            "NULL"
          ],
          "line": 1233
        },
        "resolved": true,
        "details": {
          "function_name": "bt_ad_has_manufacturer_data",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "632-642",
          "snippet": "bool bt_ad_has_manufacturer_data(struct bt_ad *ad,\n\t\t\t\tconst struct bt_ad_manufacturer_data *data)\n{\n\tif (!ad)\n\t\treturn false;\n\n\tif (!data)\n\t\treturn !queue_isempty(ad->manufacturer_data);\n\n\treturn queue_find(ad->manufacturer_data, manufacturer_data_match, data);\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nbool bt_ad_has_manufacturer_data(struct bt_ad *ad,\n\t\t\t\tconst struct bt_ad_manufacturer_data *data)\n{\n\tif (!ad)\n\t\treturn false;\n\n\tif (!data)\n\t\treturn !queue_isempty(ad->manufacturer_data);\n\n\treturn queue_find(ad->manufacturer_data, manufacturer_data_match, data);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic gboolean\ndev_property_manufacturer_data_exist(const GDBusPropertyTable *property,\n\t\t\t\t\t\t\t\tvoid *data)\n{\n\tstruct btd_device *device = data;\n\n\treturn bt_ad_has_manufacturer_data(device->ad, NULL);\n}"
  },
  {
    "function_name": "dev_property_get_manufacturer_data",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "1205-1225",
    "snippet": "static gboolean\ndev_property_get_manufacturer_data(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct btd_device *device = data;\n\tDBusMessageIter dict;\n\n\tdbus_message_iter_open_container(iter, DBUS_TYPE_ARRAY,\n\t\t\t\t\tDBUS_DICT_ENTRY_BEGIN_CHAR_AS_STRING\n\t\t\t\t\tDBUS_TYPE_UINT16_AS_STRING\n\t\t\t\t\tDBUS_TYPE_VARIANT_AS_STRING\n\t\t\t\t\tDBUS_DICT_ENTRY_END_CHAR_AS_STRING,\n\t\t\t\t\t&dict);\n\n\tbt_ad_foreach_manufacturer_data(device->ad, append_manufacturer_data,\n\t\t\t\t\t\t\t\t\t&dict);\n\n\tdbus_message_iter_close_container(iter, &dict);\n\n\treturn TRUE;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_iter_close_container",
          "args": [
            "iter",
            "&dict"
          ],
          "line": 1222
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_ad_foreach_manufacturer_data",
          "args": [
            "device->ad",
            "append_manufacturer_data",
            "&dict"
          ],
          "line": 1219
        },
        "resolved": true,
        "details": {
          "function_name": "bt_ad_foreach_manufacturer_data",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "644-651",
          "snippet": "void bt_ad_foreach_manufacturer_data(struct bt_ad *ad, bt_ad_func_t func,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tif (!ad)\n\t\treturn;\n\n\tqueue_foreach(ad->manufacturer_data, func, user_data);\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nvoid bt_ad_foreach_manufacturer_data(struct bt_ad *ad, bt_ad_func_t func,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tif (!ad)\n\t\treturn;\n\n\tqueue_foreach(ad->manufacturer_data, func, user_data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_open_container",
          "args": [
            "iter",
            "DBUS_TYPE_ARRAY",
            "DBUS_DICT_ENTRY_BEGIN_CHAR_AS_STRINGDBUS_TYPE_UINT16_AS_STRING\n\t\t\t\t\tDBUS_TYPE_VARIANT_AS_STRING\n\t\t\t\t\tDBUS_DICT_ENTRY_END_CHAR_AS_STRING",
            "&dict"
          ],
          "line": 1212
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic gboolean\ndev_property_get_manufacturer_data(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct btd_device *device = data;\n\tDBusMessageIter dict;\n\n\tdbus_message_iter_open_container(iter, DBUS_TYPE_ARRAY,\n\t\t\t\t\tDBUS_DICT_ENTRY_BEGIN_CHAR_AS_STRING\n\t\t\t\t\tDBUS_TYPE_UINT16_AS_STRING\n\t\t\t\t\tDBUS_TYPE_VARIANT_AS_STRING\n\t\t\t\t\tDBUS_DICT_ENTRY_END_CHAR_AS_STRING,\n\t\t\t\t\t&dict);\n\n\tbt_ad_foreach_manufacturer_data(device->ad, append_manufacturer_data,\n\t\t\t\t\t\t\t\t\t&dict);\n\n\tdbus_message_iter_close_container(iter, &dict);\n\n\treturn TRUE;\n}"
  },
  {
    "function_name": "append_manufacturer_data",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "1195-1203",
    "snippet": "static void append_manufacturer_data(void *data, void *user_data)\n{\n\tstruct bt_ad_manufacturer_data *md = data;\n\tDBusMessageIter *dict = user_data;\n\n\tg_dbus_dict_append_basic_array(dict,\n\t\t\t\tDBUS_TYPE_UINT16, &md->manufacturer_id,\n\t\t\t\tDBUS_TYPE_BYTE, &md->data, md->len);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_dbus_dict_append_basic_array",
          "args": [
            "dict",
            "DBUS_TYPE_UINT16",
            "&md->manufacturer_id",
            "DBUS_TYPE_BYTE",
            "&md->data",
            "md->len"
          ],
          "line": 1200
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void append_manufacturer_data(void *data, void *user_data)\n{\n\tstruct bt_ad_manufacturer_data *md = data;\n\tDBusMessageIter *dict = user_data;\n\n\tg_dbus_dict_append_basic_array(dict,\n\t\t\t\tDBUS_TYPE_UINT16, &md->manufacturer_id,\n\t\t\t\tDBUS_TYPE_BYTE, &md->data, md->len);\n}"
  },
  {
    "function_name": "dev_property_get_adapter",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "1184-1193",
    "snippet": "static gboolean dev_property_get_adapter(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct btd_device *device = data;\n\tconst char *str = adapter_get_path(device->adapter);\n\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_OBJECT_PATH, &str);\n\n\treturn TRUE;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_iter_append_basic",
          "args": [
            "iter",
            "DBUS_TYPE_OBJECT_PATH",
            "&str"
          ],
          "line": 1190
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "adapter_get_path",
          "args": [
            "device->adapter"
          ],
          "line": 1188
        },
        "resolved": true,
        "details": {
          "function_name": "adapter_get_path",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "5873-5879",
          "snippet": "const char *adapter_get_path(struct btd_adapter *adapter)\n{\n\tif (!adapter)\n\t\treturn NULL;\n\n\treturn adapter->path;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nconst char *adapter_get_path(struct btd_adapter *adapter)\n{\n\tif (!adapter)\n\t\treturn NULL;\n\n\treturn adapter->path;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic gboolean dev_property_get_adapter(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct btd_device *device = data;\n\tconst char *str = adapter_get_path(device->adapter);\n\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_OBJECT_PATH, &str);\n\n\treturn TRUE;\n}"
  },
  {
    "function_name": "dev_property_exists_modalias",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "1176-1182",
    "snippet": "static gboolean dev_property_exists_modalias(const GDBusPropertyTable *property,\n\t\t\t\t\t\t\t\tvoid *data)\n{\n\tstruct btd_device *device = data;\n\n\treturn device->modalias ? TRUE : FALSE;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic gboolean dev_property_exists_modalias(const GDBusPropertyTable *property,\n\t\t\t\t\t\t\t\tvoid *data)\n{\n\tstruct btd_device *device = data;\n\n\treturn device->modalias ? TRUE : FALSE;\n}"
  },
  {
    "function_name": "dev_property_get_modalias",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "1162-1174",
    "snippet": "static gboolean dev_property_get_modalias(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct btd_device *device = data;\n\n\tif (!device->modalias)\n\t\treturn FALSE;\n\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_STRING,\n\t\t\t\t\t\t\t&device->modalias);\n\n\treturn TRUE;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_iter_append_basic",
          "args": [
            "iter",
            "DBUS_TYPE_STRING",
            "&device->modalias"
          ],
          "line": 1170
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic gboolean dev_property_get_modalias(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct btd_device *device = data;\n\n\tif (!device->modalias)\n\t\treturn FALSE;\n\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_STRING,\n\t\t\t\t\t\t\t&device->modalias);\n\n\treturn TRUE;\n}"
  },
  {
    "function_name": "dev_property_get_uuids",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "1136-1160",
    "snippet": "static gboolean dev_property_get_uuids(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct btd_device *dev = data;\n\tDBusMessageIter entry;\n\tGSList *l;\n\n\tdbus_message_iter_open_container(iter, DBUS_TYPE_ARRAY,\n\t\t\t\tDBUS_TYPE_STRING_AS_STRING, &entry);\n\n\tif (dev->bredr_state.svc_resolved || dev->le_state.svc_resolved)\n\t\tl = dev->uuids;\n\telse if (dev->eir_uuids)\n\t\tl = dev->eir_uuids;\n\telse\n\t\tl = dev->uuids;\n\n\tfor (; l != NULL; l = l->next)\n\t\tdbus_message_iter_append_basic(&entry, DBUS_TYPE_STRING,\n\t\t\t\t\t\t\t&l->data);\n\n\tdbus_message_iter_close_container(iter, &entry);\n\n\treturn TRUE;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_iter_close_container",
          "args": [
            "iter",
            "&entry"
          ],
          "line": 1157
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_append_basic",
          "args": [
            "&entry",
            "DBUS_TYPE_STRING",
            "&l->data"
          ],
          "line": 1154
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_open_container",
          "args": [
            "iter",
            "DBUS_TYPE_ARRAY",
            "DBUS_TYPE_STRING_AS_STRING",
            "&entry"
          ],
          "line": 1143
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic gboolean dev_property_get_uuids(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct btd_device *dev = data;\n\tDBusMessageIter entry;\n\tGSList *l;\n\n\tdbus_message_iter_open_container(iter, DBUS_TYPE_ARRAY,\n\t\t\t\tDBUS_TYPE_STRING_AS_STRING, &entry);\n\n\tif (dev->bredr_state.svc_resolved || dev->le_state.svc_resolved)\n\t\tl = dev->uuids;\n\telse if (dev->eir_uuids)\n\t\tl = dev->eir_uuids;\n\telse\n\t\tl = dev->uuids;\n\n\tfor (; l != NULL; l = l->next)\n\t\tdbus_message_iter_append_basic(&entry, DBUS_TYPE_STRING,\n\t\t\t\t\t\t\t&l->data);\n\n\tdbus_message_iter_close_container(iter, &entry);\n\n\treturn TRUE;\n}"
  },
  {
    "function_name": "dev_property_get_connected",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "1120-1134",
    "snippet": "static gboolean dev_property_get_connected(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct btd_device *dev = data;\n\tdbus_bool_t connected;\n\n\tif (dev->bredr_state.connected || dev->le_state.connected)\n\t\tconnected = TRUE;\n\telse\n\t\tconnected = FALSE;\n\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_BOOLEAN, &connected);\n\n\treturn TRUE;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_iter_append_basic",
          "args": [
            "iter",
            "DBUS_TYPE_BOOLEAN",
            "&connected"
          ],
          "line": 1131
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic gboolean dev_property_get_connected(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct btd_device *dev = data;\n\tdbus_bool_t connected;\n\n\tif (dev->bredr_state.connected || dev->le_state.connected)\n\t\tconnected = TRUE;\n\telse\n\t\tconnected = FALSE;\n\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_BOOLEAN, &connected);\n\n\treturn TRUE;\n}"
  },
  {
    "function_name": "dev_property_set_blocked",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "1102-1118",
    "snippet": "static void dev_property_set_blocked(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *value,\n\t\t\t\t\tGDBusPendingPropertySet id, void *data)\n{\n\tdbus_bool_t b;\n\n\tif (dbus_message_iter_get_arg_type(value) != DBUS_TYPE_BOOLEAN) {\n\t\tg_dbus_pending_property_error(id,\n\t\t\t\t\tERROR_INTERFACE \".InvalidArguments\",\n\t\t\t\t\t\"Invalid arguments in method call\");\n\t\treturn;\n\t}\n\n\tdbus_message_iter_get_basic(value, &b);\n\n\tset_blocked(id, b, data);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "set_blocked",
          "args": [
            "id",
            "b",
            "data"
          ],
          "line": 1117
        },
        "resolved": true,
        "details": {
          "function_name": "set_blocked",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "1076-1099",
          "snippet": "static void set_blocked(GDBusPendingPropertySet id, gboolean value, void *data)\n{\n\tstruct btd_device *device = data;\n\tint err;\n\n\tif (value)\n\t\terr = device_block(device, FALSE);\n\telse\n\t\terr = device_unblock(device, FALSE, FALSE);\n\n\tswitch (-err) {\n\tcase 0:\n\t\tg_dbus_pending_property_success(id);\n\t\tbreak;\n\tcase EINVAL:\n\t\tg_dbus_pending_property_error(id, ERROR_INTERFACE \".Failed\",\n\t\t\t\t\t\"Kernel lacks blacklist support\");\n\t\tbreak;\n\tdefault:\n\t\tg_dbus_pending_property_error(id, ERROR_INTERFACE \".Failed\",\n\t\t\t\t\t\t\tstrerror(-err));\n\t\tbreak;\n\t}\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void set_blocked(GDBusPendingPropertySet id, gboolean value, void *data)\n{\n\tstruct btd_device *device = data;\n\tint err;\n\n\tif (value)\n\t\terr = device_block(device, FALSE);\n\telse\n\t\terr = device_unblock(device, FALSE, FALSE);\n\n\tswitch (-err) {\n\tcase 0:\n\t\tg_dbus_pending_property_success(id);\n\t\tbreak;\n\tcase EINVAL:\n\t\tg_dbus_pending_property_error(id, ERROR_INTERFACE \".Failed\",\n\t\t\t\t\t\"Kernel lacks blacklist support\");\n\t\tbreak;\n\tdefault:\n\t\tg_dbus_pending_property_error(id, ERROR_INTERFACE \".Failed\",\n\t\t\t\t\t\t\tstrerror(-err));\n\t\tbreak;\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_basic",
          "args": [
            "value",
            "&b"
          ],
          "line": 1115
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_pending_property_error",
          "args": [
            "id",
            "ERROR_INTERFACE \".InvalidArguments\"",
            "\"Invalid arguments in method call\""
          ],
          "line": 1109
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_arg_type",
          "args": [
            "value"
          ],
          "line": 1108
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void dev_property_set_blocked(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *value,\n\t\t\t\t\tGDBusPendingPropertySet id, void *data)\n{\n\tdbus_bool_t b;\n\n\tif (dbus_message_iter_get_arg_type(value) != DBUS_TYPE_BOOLEAN) {\n\t\tg_dbus_pending_property_error(id,\n\t\t\t\t\tERROR_INTERFACE \".InvalidArguments\",\n\t\t\t\t\t\"Invalid arguments in method call\");\n\t\treturn;\n\t}\n\n\tdbus_message_iter_get_basic(value, &b);\n\n\tset_blocked(id, b, data);\n}"
  },
  {
    "function_name": "set_blocked",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "1076-1099",
    "snippet": "static void set_blocked(GDBusPendingPropertySet id, gboolean value, void *data)\n{\n\tstruct btd_device *device = data;\n\tint err;\n\n\tif (value)\n\t\terr = device_block(device, FALSE);\n\telse\n\t\terr = device_unblock(device, FALSE, FALSE);\n\n\tswitch (-err) {\n\tcase 0:\n\t\tg_dbus_pending_property_success(id);\n\t\tbreak;\n\tcase EINVAL:\n\t\tg_dbus_pending_property_error(id, ERROR_INTERFACE \".Failed\",\n\t\t\t\t\t\"Kernel lacks blacklist support\");\n\t\tbreak;\n\tdefault:\n\t\tg_dbus_pending_property_error(id, ERROR_INTERFACE \".Failed\",\n\t\t\t\t\t\t\tstrerror(-err));\n\t\tbreak;\n\t}\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_dbus_pending_property_error",
          "args": [
            "id",
            "ERROR_INTERFACE \".Failed\"",
            "strerror(-err)"
          ],
          "line": 1095
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strerror",
          "args": [
            "-err"
          ],
          "line": 1096
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_pending_property_error",
          "args": [
            "id",
            "ERROR_INTERFACE \".Failed\"",
            "\"Kernel lacks blacklist support\""
          ],
          "line": 1091
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_pending_property_success",
          "args": [
            "id"
          ],
          "line": 1088
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device_unblock",
          "args": [
            "device",
            "FALSE",
            "FALSE"
          ],
          "line": 1084
        },
        "resolved": true,
        "details": {
          "function_name": "device_unblock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "1379-1412",
          "snippet": "int device_unblock(struct btd_device *device, gboolean silent,\n\t\t\t\t\t\t\tgboolean update_only)\n{\n\tint err = 0;\n\n\tif (!device->blocked)\n\t\treturn 0;\n\n\tif (!update_only) {\n\t\tif (device->le)\n\t\t\terr = btd_adapter_unblock_address(device->adapter,\n\t\t\t\t\t\t\t&device->bdaddr,\n\t\t\t\t\t\t\tdevice->bdaddr_type);\n\t\tif (!err && device->bredr)\n\t\t\terr = btd_adapter_unblock_address(device->adapter,\n\t\t\t\t\t\t\t&device->bdaddr,\n\t\t\t\t\t\t\tBDADDR_BREDR);\n\t}\n\n\tif (err < 0)\n\t\treturn err;\n\n\tdevice->blocked = FALSE;\n\n\tstore_device_info(device);\n\n\tif (!silent) {\n\t\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"Blocked\");\n\t\tdevice_probe_profiles(device, device->uuids);\n\t}\n\n\treturn 0;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *dbus_conn = NULL;",
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic void gatt_client_init(struct btd_device *device);\n\nint device_unblock(struct btd_device *device, gboolean silent,\n\t\t\t\t\t\t\tgboolean update_only)\n{\n\tint err = 0;\n\n\tif (!device->blocked)\n\t\treturn 0;\n\n\tif (!update_only) {\n\t\tif (device->le)\n\t\t\terr = btd_adapter_unblock_address(device->adapter,\n\t\t\t\t\t\t\t&device->bdaddr,\n\t\t\t\t\t\t\tdevice->bdaddr_type);\n\t\tif (!err && device->bredr)\n\t\t\terr = btd_adapter_unblock_address(device->adapter,\n\t\t\t\t\t\t\t&device->bdaddr,\n\t\t\t\t\t\t\tBDADDR_BREDR);\n\t}\n\n\tif (err < 0)\n\t\treturn err;\n\n\tdevice->blocked = FALSE;\n\n\tstore_device_info(device);\n\n\tif (!silent) {\n\t\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"Blocked\");\n\t\tdevice_probe_profiles(device, device->uuids);\n\t}\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "device_block",
          "args": [
            "device",
            "FALSE"
          ],
          "line": 1082
        },
        "resolved": true,
        "details": {
          "function_name": "device_block",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "1334-1377",
          "snippet": "int device_block(struct btd_device *device, gboolean update_only)\n{\n\tint err = 0;\n\n\tif (device->blocked)\n\t\treturn 0;\n\n\tif (device->disconn_timer > 0)\n\t\tg_source_remove(device->disconn_timer);\n\n\tdisconnect_all(device);\n\n\twhile (device->services != NULL) {\n\t\tstruct btd_service *service = device->services->data;\n\n\t\tdevice->services = g_slist_remove(device->services, service);\n\t\tservice_remove(service);\n\t}\n\n\tif (!update_only) {\n\t\tif (device->le)\n\t\t\terr = btd_adapter_block_address(device->adapter,\n\t\t\t\t\t\t\t&device->bdaddr,\n\t\t\t\t\t\t\tdevice->bdaddr_type);\n\t\tif (!err && device->bredr)\n\t\t\terr = btd_adapter_block_address(device->adapter,\n\t\t\t\t\t\t\t&device->bdaddr,\n\t\t\t\t\t\t\tBDADDR_BREDR);\n\t}\n\n\tif (err < 0)\n\t\treturn err;\n\n\tdevice->blocked = TRUE;\n\n\tstore_device_info(device);\n\n\tbtd_device_set_temporary(device, false);\n\n\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"Blocked\");\n\n\treturn 0;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *dbus_conn = NULL;",
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic void gatt_client_init(struct btd_device *device);\n\nint device_block(struct btd_device *device, gboolean update_only)\n{\n\tint err = 0;\n\n\tif (device->blocked)\n\t\treturn 0;\n\n\tif (device->disconn_timer > 0)\n\t\tg_source_remove(device->disconn_timer);\n\n\tdisconnect_all(device);\n\n\twhile (device->services != NULL) {\n\t\tstruct btd_service *service = device->services->data;\n\n\t\tdevice->services = g_slist_remove(device->services, service);\n\t\tservice_remove(service);\n\t}\n\n\tif (!update_only) {\n\t\tif (device->le)\n\t\t\terr = btd_adapter_block_address(device->adapter,\n\t\t\t\t\t\t\t&device->bdaddr,\n\t\t\t\t\t\t\tdevice->bdaddr_type);\n\t\tif (!err && device->bredr)\n\t\t\terr = btd_adapter_block_address(device->adapter,\n\t\t\t\t\t\t\t&device->bdaddr,\n\t\t\t\t\t\t\tBDADDR_BREDR);\n\t}\n\n\tif (err < 0)\n\t\treturn err;\n\n\tdevice->blocked = TRUE;\n\n\tstore_device_info(device);\n\n\tbtd_device_set_temporary(device, false);\n\n\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"Blocked\");\n\n\treturn 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void set_blocked(GDBusPendingPropertySet id, gboolean value, void *data)\n{\n\tstruct btd_device *device = data;\n\tint err;\n\n\tif (value)\n\t\terr = device_block(device, FALSE);\n\telse\n\t\terr = device_unblock(device, FALSE, FALSE);\n\n\tswitch (-err) {\n\tcase 0:\n\t\tg_dbus_pending_property_success(id);\n\t\tbreak;\n\tcase EINVAL:\n\t\tg_dbus_pending_property_error(id, ERROR_INTERFACE \".Failed\",\n\t\t\t\t\t\"Kernel lacks blacklist support\");\n\t\tbreak;\n\tdefault:\n\t\tg_dbus_pending_property_error(id, ERROR_INTERFACE \".Failed\",\n\t\t\t\t\t\t\tstrerror(-err));\n\t\tbreak;\n\t}\n}"
  },
  {
    "function_name": "dev_property_get_blocked",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "1065-1074",
    "snippet": "static gboolean dev_property_get_blocked(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct btd_device *device = data;\n\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_BOOLEAN,\n\t\t\t\t\t\t\t&device->blocked);\n\n\treturn TRUE;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_iter_append_basic",
          "args": [
            "iter",
            "DBUS_TYPE_BOOLEAN",
            "&device->blocked"
          ],
          "line": 1070
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic gboolean dev_property_get_blocked(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct btd_device *device = data;\n\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_BOOLEAN,\n\t\t\t\t\t\t\t&device->blocked);\n\n\treturn TRUE;\n}"
  },
  {
    "function_name": "dev_property_set_trusted",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "1047-1063",
    "snippet": "static void dev_property_set_trusted(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *value,\n\t\t\t\t\tGDBusPendingPropertySet id, void *data)\n{\n\tdbus_bool_t b;\n\n\tif (dbus_message_iter_get_arg_type(value) != DBUS_TYPE_BOOLEAN) {\n\t\tg_dbus_pending_property_error(id,\n\t\t\t\t\tERROR_INTERFACE \".InvalidArguments\",\n\t\t\t\t\t\"Invalid arguments in method call\");\n\t\treturn;\n\t}\n\n\tdbus_message_iter_get_basic(value, &b);\n\n\tset_trust(id, b, data);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "set_trust",
          "args": [
            "id",
            "b",
            "data"
          ],
          "line": 1062
        },
        "resolved": true,
        "details": {
          "function_name": "set_trust",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "1038-1045",
          "snippet": "static void set_trust(GDBusPendingPropertySet id, gboolean value, void *data)\n{\n\tstruct btd_device *device = data;\n\n\tbtd_device_set_trusted(device, value);\n\n\tg_dbus_pending_property_success(id);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void set_trust(GDBusPendingPropertySet id, gboolean value, void *data)\n{\n\tstruct btd_device *device = data;\n\n\tbtd_device_set_trusted(device, value);\n\n\tg_dbus_pending_property_success(id);\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_basic",
          "args": [
            "value",
            "&b"
          ],
          "line": 1060
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_pending_property_error",
          "args": [
            "id",
            "ERROR_INTERFACE \".InvalidArguments\"",
            "\"Invalid arguments in method call\""
          ],
          "line": 1054
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_arg_type",
          "args": [
            "value"
          ],
          "line": 1053
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void dev_property_set_trusted(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *value,\n\t\t\t\t\tGDBusPendingPropertySet id, void *data)\n{\n\tdbus_bool_t b;\n\n\tif (dbus_message_iter_get_arg_type(value) != DBUS_TYPE_BOOLEAN) {\n\t\tg_dbus_pending_property_error(id,\n\t\t\t\t\tERROR_INTERFACE \".InvalidArguments\",\n\t\t\t\t\t\"Invalid arguments in method call\");\n\t\treturn;\n\t}\n\n\tdbus_message_iter_get_basic(value, &b);\n\n\tset_trust(id, b, data);\n}"
  },
  {
    "function_name": "set_trust",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "1038-1045",
    "snippet": "static void set_trust(GDBusPendingPropertySet id, gboolean value, void *data)\n{\n\tstruct btd_device *device = data;\n\n\tbtd_device_set_trusted(device, value);\n\n\tg_dbus_pending_property_success(id);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_dbus_pending_property_success",
          "args": [
            "id"
          ],
          "line": 1044
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_device_set_trusted",
          "args": [
            "device",
            "value"
          ],
          "line": 1042
        },
        "resolved": true,
        "details": {
          "function_name": "btd_device_set_trusted",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5370-5386",
          "snippet": "void btd_device_set_trusted(struct btd_device *device, gboolean trusted)\n{\n\tif (!device)\n\t\treturn;\n\n\tif (device->trusted == trusted)\n\t\treturn;\n\n\tDBG(\"trusted %d\", trusted);\n\n\tdevice->trusted = trusted;\n\n\tstore_device_info(device);\n\n\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\tDEVICE_INTERFACE, \"Trusted\");\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *dbus_conn = NULL;",
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid btd_device_set_trusted(struct btd_device *device, gboolean trusted)\n{\n\tif (!device)\n\t\treturn;\n\n\tif (device->trusted == trusted)\n\t\treturn;\n\n\tDBG(\"trusted %d\", trusted);\n\n\tdevice->trusted = trusted;\n\n\tstore_device_info(device);\n\n\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\tDEVICE_INTERFACE, \"Trusted\");\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void set_trust(GDBusPendingPropertySet id, gboolean value, void *data)\n{\n\tstruct btd_device *device = data;\n\n\tbtd_device_set_trusted(device, value);\n\n\tg_dbus_pending_property_success(id);\n}"
  },
  {
    "function_name": "dev_property_get_trusted",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "1027-1036",
    "snippet": "static gboolean dev_property_get_trusted(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct btd_device *device = data;\n\tgboolean val = device_is_trusted(device);\n\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_BOOLEAN, &val);\n\n\treturn TRUE;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_iter_append_basic",
          "args": [
            "iter",
            "DBUS_TYPE_BOOLEAN",
            "&val"
          ],
          "line": 1033
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device_is_trusted",
          "args": [
            "device"
          ],
          "line": 1031
        },
        "resolved": true,
        "details": {
          "function_name": "device_is_trusted",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "710-713",
          "snippet": "gboolean device_is_trusted(struct btd_device *device)\n{\n\treturn device->trusted;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\ngboolean device_is_trusted(struct btd_device *device)\n{\n\treturn device->trusted;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic gboolean dev_property_get_trusted(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct btd_device *device = data;\n\tgboolean val = device_is_trusted(device);\n\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_BOOLEAN, &val);\n\n\treturn TRUE;\n}"
  },
  {
    "function_name": "dev_property_get_flags",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "1010-1025",
    "snippet": "static gboolean\ndev_property_get_flags(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct btd_device *device = data;\n\tuint8_t *flags = device->ad_flags;\n\tDBusMessageIter array;\n\n\tdbus_message_iter_open_container(iter, DBUS_TYPE_ARRAY,\n\t\t\t\t\tDBUS_TYPE_BYTE_AS_STRING, &array);\n\tdbus_message_iter_append_fixed_array(&array, DBUS_TYPE_BYTE,\n\t\t\t\t\t&flags,\tsizeof(device->ad_flags));\n\tdbus_message_iter_close_container(iter, &array);\n\n\treturn TRUE;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_iter_close_container",
          "args": [
            "iter",
            "&array"
          ],
          "line": 1022
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_append_fixed_array",
          "args": [
            "&array",
            "DBUS_TYPE_BYTE",
            "&flags",
            "sizeof(device->ad_flags)"
          ],
          "line": 1020
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_open_container",
          "args": [
            "iter",
            "DBUS_TYPE_ARRAY",
            "DBUS_TYPE_BYTE_AS_STRING",
            "&array"
          ],
          "line": 1018
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic gboolean\ndev_property_get_flags(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct btd_device *device = data;\n\tuint8_t *flags = device->ad_flags;\n\tDBusMessageIter array;\n\n\tdbus_message_iter_open_container(iter, DBUS_TYPE_ARRAY,\n\t\t\t\t\tDBUS_TYPE_BYTE_AS_STRING, &array);\n\tdbus_message_iter_append_fixed_array(&array, DBUS_TYPE_BYTE,\n\t\t\t\t\t&flags,\tsizeof(device->ad_flags));\n\tdbus_message_iter_close_container(iter, &array);\n\n\treturn TRUE;\n}"
  },
  {
    "function_name": "dev_property_flags_exist",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "1002-1008",
    "snippet": "static gboolean dev_property_flags_exist(const GDBusPropertyTable *property,\n\t\t\t\t\t\t\t\tvoid *data)\n{\n\tstruct btd_device *device = data;\n\n\treturn device->ad_flags[0] != INVALID_FLAGS;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define INVALID_FLAGS\t\t0xff"
    ],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\n#define INVALID_FLAGS\t\t0xff\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic gboolean dev_property_flags_exist(const GDBusPropertyTable *property,\n\t\t\t\t\t\t\t\tvoid *data)\n{\n\tstruct btd_device *device = data;\n\n\treturn device->ad_flags[0] != INVALID_FLAGS;\n}"
  },
  {
    "function_name": "dev_property_get_svc_resolved",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "990-1000",
    "snippet": "static gboolean\ndev_property_get_svc_resolved(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct btd_device *device = data;\n\tgboolean val = device->svc_refreshed;\n\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_BOOLEAN, &val);\n\n\treturn TRUE;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_iter_append_basic",
          "args": [
            "iter",
            "DBUS_TYPE_BOOLEAN",
            "&val"
          ],
          "line": 997
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic gboolean\ndev_property_get_svc_resolved(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct btd_device *device = data;\n\tgboolean val = device->svc_refreshed;\n\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_BOOLEAN, &val);\n\n\treturn TRUE;\n}"
  },
  {
    "function_name": "dev_property_exists_tx_power",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "979-988",
    "snippet": "static gboolean dev_property_exists_tx_power(const GDBusPropertyTable *property,\n\t\t\t\t\t\t\t\tvoid *data)\n{\n\tstruct btd_device *dev = data;\n\n\tif (dev->tx_power == 127)\n\t\treturn FALSE;\n\n\treturn TRUE;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic gboolean dev_property_exists_tx_power(const GDBusPropertyTable *property,\n\t\t\t\t\t\t\t\tvoid *data)\n{\n\tstruct btd_device *dev = data;\n\n\tif (dev->tx_power == 127)\n\t\treturn FALSE;\n\n\treturn TRUE;\n}"
  },
  {
    "function_name": "dev_property_get_tx_power",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "968-977",
    "snippet": "static gboolean dev_property_get_tx_power(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct btd_device *dev = data;\n\tdbus_int16_t val = dev->tx_power;\n\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_INT16, &val);\n\n\treturn TRUE;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_iter_append_basic",
          "args": [
            "iter",
            "DBUS_TYPE_INT16",
            "&val"
          ],
          "line": 974
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic gboolean dev_property_get_tx_power(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct btd_device *dev = data;\n\tdbus_int16_t val = dev->tx_power;\n\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_INT16, &val);\n\n\treturn TRUE;\n}"
  },
  {
    "function_name": "dev_property_exists_rssi",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "957-966",
    "snippet": "static gboolean dev_property_exists_rssi(const GDBusPropertyTable *property,\n\t\t\t\t\t\t\t\tvoid *data)\n{\n\tstruct btd_device *dev = data;\n\n\tif (dev->rssi == 0)\n\t\treturn FALSE;\n\n\treturn TRUE;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic gboolean dev_property_exists_rssi(const GDBusPropertyTable *property,\n\t\t\t\t\t\t\t\tvoid *data)\n{\n\tstruct btd_device *dev = data;\n\n\tif (dev->rssi == 0)\n\t\treturn FALSE;\n\n\treturn TRUE;\n}"
  },
  {
    "function_name": "dev_property_get_rssi",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "946-955",
    "snippet": "static gboolean dev_property_get_rssi(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct btd_device *dev = data;\n\tdbus_int16_t val = dev->rssi;\n\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_INT16, &val);\n\n\treturn TRUE;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_iter_append_basic",
          "args": [
            "iter",
            "DBUS_TYPE_INT16",
            "&val"
          ],
          "line": 952
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic gboolean dev_property_get_rssi(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct btd_device *dev = data;\n\tdbus_int16_t val = dev->rssi;\n\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_INT16, &val);\n\n\treturn TRUE;\n}"
  },
  {
    "function_name": "dev_property_get_legacy",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "935-944",
    "snippet": "static gboolean dev_property_get_legacy(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct btd_device *device = data;\n\tdbus_bool_t val = device->legacy;\n\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_BOOLEAN, &val);\n\n\treturn TRUE;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_iter_append_basic",
          "args": [
            "iter",
            "DBUS_TYPE_BOOLEAN",
            "&val"
          ],
          "line": 941
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic gboolean dev_property_get_legacy(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct btd_device *device = data;\n\tdbus_bool_t val = device->legacy;\n\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_BOOLEAN, &val);\n\n\treturn TRUE;\n}"
  },
  {
    "function_name": "dev_property_get_paired",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "919-933",
    "snippet": "static gboolean dev_property_get_paired(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct btd_device *dev = data;\n\tdbus_bool_t val;\n\n\tif (dev->bredr_state.paired || dev->le_state.paired)\n\t\tval = TRUE;\n\telse\n\t\tval = FALSE;\n\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_BOOLEAN, &val);\n\n\treturn TRUE;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_iter_append_basic",
          "args": [
            "iter",
            "DBUS_TYPE_BOOLEAN",
            "&val"
          ],
          "line": 930
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic gboolean dev_property_get_paired(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct btd_device *dev = data;\n\tdbus_bool_t val;\n\n\tif (dev->bredr_state.paired || dev->le_state.paired)\n\t\tval = TRUE;\n\telse\n\t\tval = FALSE;\n\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_BOOLEAN, &val);\n\n\treturn TRUE;\n}"
  },
  {
    "function_name": "dev_property_get_icon",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "905-917",
    "snippet": "static gboolean dev_property_get_icon(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tconst char *icon;\n\n\ticon = get_icon(property, data);\n\tif (icon == NULL)\n\t\treturn FALSE;\n\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_STRING, &icon);\n\n\treturn TRUE;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_iter_append_basic",
          "args": [
            "iter",
            "DBUS_TYPE_STRING",
            "&icon"
          ],
          "line": 914
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_icon",
          "args": [
            "property",
            "data"
          ],
          "line": 910
        },
        "resolved": true,
        "details": {
          "function_name": "get_icon",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "885-897",
          "snippet": "static const char *get_icon(const GDBusPropertyTable *property, void *data)\n{\n\tstruct btd_device *device = data;\n\tconst char *icon = NULL;\n\tuint16_t appearance;\n\n\tif (device->class != 0)\n\t\ticon = class_to_icon(device->class);\n\telse if (get_appearance(property, data, &appearance))\n\t\ticon = gap_appearance_to_icon(appearance);\n\n\treturn icon;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic const char *get_icon(const GDBusPropertyTable *property, void *data)\n{\n\tstruct btd_device *device = data;\n\tconst char *icon = NULL;\n\tuint16_t appearance;\n\n\tif (device->class != 0)\n\t\ticon = class_to_icon(device->class);\n\telse if (get_appearance(property, data, &appearance))\n\t\ticon = gap_appearance_to_icon(appearance);\n\n\treturn icon;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic gboolean dev_property_get_icon(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tconst char *icon;\n\n\ticon = get_icon(property, data);\n\tif (icon == NULL)\n\t\treturn FALSE;\n\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_STRING, &icon);\n\n\treturn TRUE;\n}"
  },
  {
    "function_name": "dev_property_exists_icon",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "899-903",
    "snippet": "static gboolean dev_property_exists_icon(\n\t\t\tconst GDBusPropertyTable *property, void *data)\n{\n\treturn get_icon(property, data) != NULL;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "get_icon",
          "args": [
            "property",
            "data"
          ],
          "line": 902
        },
        "resolved": true,
        "details": {
          "function_name": "get_icon",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "885-897",
          "snippet": "static const char *get_icon(const GDBusPropertyTable *property, void *data)\n{\n\tstruct btd_device *device = data;\n\tconst char *icon = NULL;\n\tuint16_t appearance;\n\n\tif (device->class != 0)\n\t\ticon = class_to_icon(device->class);\n\telse if (get_appearance(property, data, &appearance))\n\t\ticon = gap_appearance_to_icon(appearance);\n\n\treturn icon;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic const char *get_icon(const GDBusPropertyTable *property, void *data)\n{\n\tstruct btd_device *device = data;\n\tconst char *icon = NULL;\n\tuint16_t appearance;\n\n\tif (device->class != 0)\n\t\ticon = class_to_icon(device->class);\n\telse if (get_appearance(property, data, &appearance))\n\t\ticon = gap_appearance_to_icon(appearance);\n\n\treturn icon;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic gboolean dev_property_exists_icon(\n\t\t\tconst GDBusPropertyTable *property, void *data)\n{\n\treturn get_icon(property, data) != NULL;\n}"
  },
  {
    "function_name": "get_icon",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "885-897",
    "snippet": "static const char *get_icon(const GDBusPropertyTable *property, void *data)\n{\n\tstruct btd_device *device = data;\n\tconst char *icon = NULL;\n\tuint16_t appearance;\n\n\tif (device->class != 0)\n\t\ticon = class_to_icon(device->class);\n\telse if (get_appearance(property, data, &appearance))\n\t\ticon = gap_appearance_to_icon(appearance);\n\n\treturn icon;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "gap_appearance_to_icon",
          "args": [
            "appearance"
          ],
          "line": 894
        },
        "resolved": true,
        "details": {
          "function_name": "gap_appearance_to_icon",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/dbus-common.c",
          "lines": "130-163",
          "snippet": "const char *gap_appearance_to_icon(uint16_t appearance)\n{\n\tswitch ((appearance & 0xffc0) >> 6) {\n\tcase 0x00:\n\t\treturn \"unknown\";\n\tcase 0x01:\n\t\treturn \"phone\";\n\tcase 0x02:\n\t\treturn \"computer\";\n\tcase 0x05:\n\t\treturn \"video-display\";\n\tcase 0x0a:\n\t\treturn \"multimedia-player\";\n\tcase 0x0b:\n\t\treturn \"scanner\";\n\tcase 0x0f: /* HID Generic */\n\t\tswitch (appearance & 0x3f) {\n\t\tcase 0x01:\n\t\t\treturn \"input-keyboard\";\n\t\tcase 0x02:\n\t\t\treturn \"input-mouse\";\n\t\tcase 0x03:\n\t\tcase 0x04:\n\t\t\treturn \"input-gaming\";\n\t\tcase 0x05:\n\t\t\treturn \"input-tablet\";\n\t\tcase 0x08:\n\t\t\treturn \"scanner\";\n\t\t}\n\t\tbreak;\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nconst char *gap_appearance_to_icon(uint16_t appearance)\n{\n\tswitch ((appearance & 0xffc0) >> 6) {\n\tcase 0x00:\n\t\treturn \"unknown\";\n\tcase 0x01:\n\t\treturn \"phone\";\n\tcase 0x02:\n\t\treturn \"computer\";\n\tcase 0x05:\n\t\treturn \"video-display\";\n\tcase 0x0a:\n\t\treturn \"multimedia-player\";\n\tcase 0x0b:\n\t\treturn \"scanner\";\n\tcase 0x0f: /* HID Generic */\n\t\tswitch (appearance & 0x3f) {\n\t\tcase 0x01:\n\t\t\treturn \"input-keyboard\";\n\t\tcase 0x02:\n\t\t\treturn \"input-mouse\";\n\t\tcase 0x03:\n\t\tcase 0x04:\n\t\t\treturn \"input-gaming\";\n\t\tcase 0x05:\n\t\t\treturn \"input-tablet\";\n\t\tcase 0x08:\n\t\t\treturn \"scanner\";\n\t\t}\n\t\tbreak;\n\t}\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "get_appearance",
          "args": [
            "property",
            "data",
            "&appearance"
          ],
          "line": 893
        },
        "resolved": true,
        "details": {
          "function_name": "dev_property_get_appearance",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "872-883",
          "snippet": "static gboolean dev_property_get_appearance(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tuint16_t appearance;\n\n\tif (!get_appearance(property, data, &appearance))\n\t\treturn FALSE;\n\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_UINT16, &appearance);\n\n\treturn TRUE;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic gboolean dev_property_get_appearance(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tuint16_t appearance;\n\n\tif (!get_appearance(property, data, &appearance))\n\t\treturn FALSE;\n\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_UINT16, &appearance);\n\n\treturn TRUE;\n}"
        }
      },
      {
        "call_info": {
          "callee": "class_to_icon",
          "args": [
            "device->class"
          ],
          "line": 892
        },
        "resolved": true,
        "details": {
          "function_name": "class_to_icon",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/dbus-common.c",
          "lines": "66-128",
          "snippet": "const char *class_to_icon(uint32_t class)\n{\n\tswitch ((class & 0x1f00) >> 8) {\n\tcase 0x01:\n\t\treturn \"computer\";\n\tcase 0x02:\n\t\tswitch ((class & 0xfc) >> 2) {\n\t\tcase 0x01:\n\t\tcase 0x02:\n\t\tcase 0x03:\n\t\tcase 0x05:\n\t\t\treturn \"phone\";\n\t\tcase 0x04:\n\t\t\treturn \"modem\";\n\t\t}\n\t\tbreak;\n\tcase 0x03:\n\t\treturn \"network-wireless\";\n\tcase 0x04:\n\t\tswitch ((class & 0xfc) >> 2) {\n\t\tcase 0x01:\n\t\tcase 0x02:\n\t\t\treturn \"audio-card\";\t/* Headset */\n\t\tcase 0x06:\n\t\t\treturn \"audio-card\";\t/* Headphone */\n\t\tcase 0x0b: /* VCR */\n\t\tcase 0x0c: /* Video Camera */\n\t\tcase 0x0d: /* Camcorder */\n\t\t\treturn \"camera-video\";\n\t\tdefault:\n\t\t\treturn \"audio-card\";\t/* Other audio device */\n\t\t}\n\t\tbreak;\n\tcase 0x05:\n\t\tswitch ((class & 0xc0) >> 6) {\n\t\tcase 0x00:\n\t\t\tswitch ((class & 0x1e) >> 2) {\n\t\t\tcase 0x01:\n\t\t\tcase 0x02:\n\t\t\t\treturn \"input-gaming\";\n\t\t\t}\n\t\t\tbreak;\n\t\tcase 0x01:\n\t\t\treturn \"input-keyboard\";\n\t\tcase 0x02:\n\t\t\tswitch ((class & 0x1e) >> 2) {\n\t\t\tcase 0x05:\n\t\t\t\treturn \"input-tablet\";\n\t\t\tdefault:\n\t\t\t\treturn \"input-mouse\";\n\t\t\t}\n\t\t}\n\t\tbreak;\n\tcase 0x06:\n\t\tif (class & 0x80)\n\t\t\treturn \"printer\";\n\t\tif (class & 0x20)\n\t\t\treturn \"camera-photo\";\n\t\tbreak;\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nconst char *class_to_icon(uint32_t class)\n{\n\tswitch ((class & 0x1f00) >> 8) {\n\tcase 0x01:\n\t\treturn \"computer\";\n\tcase 0x02:\n\t\tswitch ((class & 0xfc) >> 2) {\n\t\tcase 0x01:\n\t\tcase 0x02:\n\t\tcase 0x03:\n\t\tcase 0x05:\n\t\t\treturn \"phone\";\n\t\tcase 0x04:\n\t\t\treturn \"modem\";\n\t\t}\n\t\tbreak;\n\tcase 0x03:\n\t\treturn \"network-wireless\";\n\tcase 0x04:\n\t\tswitch ((class & 0xfc) >> 2) {\n\t\tcase 0x01:\n\t\tcase 0x02:\n\t\t\treturn \"audio-card\";\t/* Headset */\n\t\tcase 0x06:\n\t\t\treturn \"audio-card\";\t/* Headphone */\n\t\tcase 0x0b: /* VCR */\n\t\tcase 0x0c: /* Video Camera */\n\t\tcase 0x0d: /* Camcorder */\n\t\t\treturn \"camera-video\";\n\t\tdefault:\n\t\t\treturn \"audio-card\";\t/* Other audio device */\n\t\t}\n\t\tbreak;\n\tcase 0x05:\n\t\tswitch ((class & 0xc0) >> 6) {\n\t\tcase 0x00:\n\t\t\tswitch ((class & 0x1e) >> 2) {\n\t\t\tcase 0x01:\n\t\t\tcase 0x02:\n\t\t\t\treturn \"input-gaming\";\n\t\t\t}\n\t\t\tbreak;\n\t\tcase 0x01:\n\t\t\treturn \"input-keyboard\";\n\t\tcase 0x02:\n\t\t\tswitch ((class & 0x1e) >> 2) {\n\t\t\tcase 0x05:\n\t\t\t\treturn \"input-tablet\";\n\t\t\tdefault:\n\t\t\t\treturn \"input-mouse\";\n\t\t\t}\n\t\t}\n\t\tbreak;\n\tcase 0x06:\n\t\tif (class & 0x80)\n\t\t\treturn \"printer\";\n\t\tif (class & 0x20)\n\t\t\treturn \"camera-photo\";\n\t\tbreak;\n\t}\n\n\treturn NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic const char *get_icon(const GDBusPropertyTable *property, void *data)\n{\n\tstruct btd_device *device = data;\n\tconst char *icon = NULL;\n\tuint16_t appearance;\n\n\tif (device->class != 0)\n\t\ticon = class_to_icon(device->class);\n\telse if (get_appearance(property, data, &appearance))\n\t\ticon = gap_appearance_to_icon(appearance);\n\n\treturn icon;\n}"
  },
  {
    "function_name": "dev_property_get_appearance",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "872-883",
    "snippet": "static gboolean dev_property_get_appearance(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tuint16_t appearance;\n\n\tif (!get_appearance(property, data, &appearance))\n\t\treturn FALSE;\n\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_UINT16, &appearance);\n\n\treturn TRUE;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_iter_append_basic",
          "args": [
            "iter",
            "DBUS_TYPE_UINT16",
            "&appearance"
          ],
          "line": 880
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_appearance",
          "args": [
            "property",
            "data",
            "&appearance"
          ],
          "line": 877
        },
        "resolved": true,
        "details": {
          "function_name": "dev_property_get_appearance",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "872-883",
          "snippet": "static gboolean dev_property_get_appearance(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tuint16_t appearance;\n\n\tif (!get_appearance(property, data, &appearance))\n\t\treturn FALSE;\n\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_UINT16, &appearance);\n\n\treturn TRUE;\n}",
          "note": "cyclic_reference_detected"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic gboolean dev_property_get_appearance(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tuint16_t appearance;\n\n\tif (!get_appearance(property, data, &appearance))\n\t\treturn FALSE;\n\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_UINT16, &appearance);\n\n\treturn TRUE;\n}"
  },
  {
    "function_name": "dev_property_exists_appearance",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "864-870",
    "snippet": "static gboolean dev_property_exists_appearance(\n\t\t\tconst GDBusPropertyTable *property, void *data)\n{\n\tuint16_t appearance;\n\n\treturn get_appearance(property, data, &appearance);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "get_appearance",
          "args": [
            "property",
            "data",
            "&appearance"
          ],
          "line": 869
        },
        "resolved": true,
        "details": {
          "function_name": "dev_property_get_appearance",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "872-883",
          "snippet": "static gboolean dev_property_get_appearance(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tuint16_t appearance;\n\n\tif (!get_appearance(property, data, &appearance))\n\t\treturn FALSE;\n\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_UINT16, &appearance);\n\n\treturn TRUE;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic gboolean dev_property_get_appearance(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tuint16_t appearance;\n\n\tif (!get_appearance(property, data, &appearance))\n\t\treturn FALSE;\n\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_UINT16, &appearance);\n\n\treturn TRUE;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic gboolean dev_property_exists_appearance(\n\t\t\tconst GDBusPropertyTable *property, void *data)\n{\n\tuint16_t appearance;\n\n\treturn get_appearance(property, data, &appearance);\n}"
  },
  {
    "function_name": "get_appearance",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "848-862",
    "snippet": "static gboolean get_appearance(const GDBusPropertyTable *property, void *data,\n\t\t\t\t\t\t\tuint16_t *appearance)\n{\n\tstruct btd_device *device = data;\n\n\tif (dev_property_exists_class(property, data))\n\t\treturn FALSE;\n\n\tif (device->appearance) {\n\t\t*appearance = device->appearance;\n\t\treturn TRUE;\n\t}\n\n\treturn FALSE;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "dev_property_exists_class",
          "args": [
            "property",
            "data"
          ],
          "line": 853
        },
        "resolved": true,
        "details": {
          "function_name": "dev_property_exists_class",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "827-833",
          "snippet": "static gboolean dev_property_exists_class(const GDBusPropertyTable *property,\n\t\t\t\t\t\t\t\tvoid *data)\n{\n\tstruct btd_device *device = data;\n\n\treturn device->class != 0;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic gboolean dev_property_exists_class(const GDBusPropertyTable *property,\n\t\t\t\t\t\t\t\tvoid *data)\n{\n\tstruct btd_device *device = data;\n\n\treturn device->class != 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic gboolean get_appearance(const GDBusPropertyTable *property, void *data,\n\t\t\t\t\t\t\tuint16_t *appearance)\n{\n\tstruct btd_device *device = data;\n\n\tif (dev_property_exists_class(property, data))\n\t\treturn FALSE;\n\n\tif (device->appearance) {\n\t\t*appearance = device->appearance;\n\t\treturn TRUE;\n\t}\n\n\treturn FALSE;\n}"
  },
  {
    "function_name": "dev_property_get_class",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "835-846",
    "snippet": "static gboolean dev_property_get_class(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct btd_device *device = data;\n\n\tif (device->class == 0)\n\t\treturn FALSE;\n\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_UINT32, &device->class);\n\n\treturn TRUE;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_iter_append_basic",
          "args": [
            "iter",
            "DBUS_TYPE_UINT32",
            "&device->class"
          ],
          "line": 843
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic gboolean dev_property_get_class(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct btd_device *device = data;\n\n\tif (device->class == 0)\n\t\treturn FALSE;\n\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_UINT32, &device->class);\n\n\treturn TRUE;\n}"
  },
  {
    "function_name": "dev_property_exists_class",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "827-833",
    "snippet": "static gboolean dev_property_exists_class(const GDBusPropertyTable *property,\n\t\t\t\t\t\t\t\tvoid *data)\n{\n\tstruct btd_device *device = data;\n\n\treturn device->class != 0;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic gboolean dev_property_exists_class(const GDBusPropertyTable *property,\n\t\t\t\t\t\t\t\tvoid *data)\n{\n\tstruct btd_device *device = data;\n\n\treturn device->class != 0;\n}"
  },
  {
    "function_name": "dev_property_set_alias",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "809-825",
    "snippet": "static void dev_property_set_alias(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *value,\n\t\t\t\t\tGDBusPendingPropertySet id, void *data)\n{\n\tconst char *alias;\n\n\tif (dbus_message_iter_get_arg_type(value) != DBUS_TYPE_STRING) {\n\t\tg_dbus_pending_property_error(id,\n\t\t\t\t\tERROR_INTERFACE \".InvalidArguments\",\n\t\t\t\t\t\"Invalid arguments in method call\");\n\t\treturn;\n\t}\n\n\tdbus_message_iter_get_basic(value, &alias);\n\n\tset_alias(id, alias, data);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "set_alias",
          "args": [
            "id",
            "alias",
            "data"
          ],
          "line": 824
        },
        "resolved": true,
        "details": {
          "function_name": "set_alias",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "786-807",
          "snippet": "static void set_alias(GDBusPendingPropertySet id, const char *alias,\n\t\t\t\t\t\t\t\tvoid *data)\n{\n\tstruct btd_device *device = data;\n\n\t/* No change */\n\tif ((device->alias == NULL && g_str_equal(alias, \"\")) ||\n\t\t\t\t\tg_strcmp0(device->alias, alias) == 0) {\n\t\tg_dbus_pending_property_success(id);\n\t\treturn;\n\t}\n\n\tg_free(device->alias);\n\tdevice->alias = g_str_equal(alias, \"\") ? NULL : g_strdup(alias);\n\n\tstore_device_info(device);\n\n\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"Alias\");\n\n\tg_dbus_pending_property_success(id);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *dbus_conn = NULL;",
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void set_alias(GDBusPendingPropertySet id, const char *alias,\n\t\t\t\t\t\t\t\tvoid *data)\n{\n\tstruct btd_device *device = data;\n\n\t/* No change */\n\tif ((device->alias == NULL && g_str_equal(alias, \"\")) ||\n\t\t\t\t\tg_strcmp0(device->alias, alias) == 0) {\n\t\tg_dbus_pending_property_success(id);\n\t\treturn;\n\t}\n\n\tg_free(device->alias);\n\tdevice->alias = g_str_equal(alias, \"\") ? NULL : g_strdup(alias);\n\n\tstore_device_info(device);\n\n\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"Alias\");\n\n\tg_dbus_pending_property_success(id);\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_basic",
          "args": [
            "value",
            "&alias"
          ],
          "line": 822
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_pending_property_error",
          "args": [
            "id",
            "ERROR_INTERFACE \".InvalidArguments\"",
            "\"Invalid arguments in method call\""
          ],
          "line": 816
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_arg_type",
          "args": [
            "value"
          ],
          "line": 815
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void dev_property_set_alias(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *value,\n\t\t\t\t\tGDBusPendingPropertySet id, void *data)\n{\n\tconst char *alias;\n\n\tif (dbus_message_iter_get_arg_type(value) != DBUS_TYPE_STRING) {\n\t\tg_dbus_pending_property_error(id,\n\t\t\t\t\tERROR_INTERFACE \".InvalidArguments\",\n\t\t\t\t\t\"Invalid arguments in method call\");\n\t\treturn;\n\t}\n\n\tdbus_message_iter_get_basic(value, &alias);\n\n\tset_alias(id, alias, data);\n}"
  },
  {
    "function_name": "set_alias",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "786-807",
    "snippet": "static void set_alias(GDBusPendingPropertySet id, const char *alias,\n\t\t\t\t\t\t\t\tvoid *data)\n{\n\tstruct btd_device *device = data;\n\n\t/* No change */\n\tif ((device->alias == NULL && g_str_equal(alias, \"\")) ||\n\t\t\t\t\tg_strcmp0(device->alias, alias) == 0) {\n\t\tg_dbus_pending_property_success(id);\n\t\treturn;\n\t}\n\n\tg_free(device->alias);\n\tdevice->alias = g_str_equal(alias, \"\") ? NULL : g_strdup(alias);\n\n\tstore_device_info(device);\n\n\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"Alias\");\n\n\tg_dbus_pending_property_success(id);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static DBusConnection *dbus_conn = NULL;",
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_dbus_pending_property_success",
          "args": [
            "id"
          ],
          "line": 806
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_emit_property_changed",
          "args": [
            "dbus_conn",
            "device->path",
            "DEVICE_INTERFACE",
            "\"Alias\""
          ],
          "line": 803
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "store_device_info",
          "args": [
            "device"
          ],
          "line": 801
        },
        "resolved": true,
        "details": {
          "function_name": "store_device_info",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "475-487",
          "snippet": "static void store_device_info(struct btd_device *device)\n{\n\tif (device->temporary || device->store_id > 0)\n\t\treturn;\n\n\tif (device_address_is_private(device)) {\n\t\tDBG(\"Can't store info for private addressed device %s\",\n\t\t\t\t\t\t\t\tdevice->path);\n\t\treturn;\n\t}\n\n\tdevice->store_id = g_idle_add(store_device_info_cb, device);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void store_device_info(struct btd_device *device)\n{\n\tif (device->temporary || device->store_id > 0)\n\t\treturn;\n\n\tif (device_address_is_private(device)) {\n\t\tDBG(\"Can't store info for private addressed device %s\",\n\t\t\t\t\t\t\t\tdevice->path);\n\t\treturn;\n\t}\n\n\tdevice->store_id = g_idle_add(store_device_info_cb, device);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "alias"
          ],
          "line": 799
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_str_equal",
          "args": [
            "alias",
            "\"\""
          ],
          "line": 799
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "device->alias"
          ],
          "line": 798
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_pending_property_success",
          "args": [
            "id"
          ],
          "line": 794
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strcmp0",
          "args": [
            "device->alias",
            "alias"
          ],
          "line": 793
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_str_equal",
          "args": [
            "alias",
            "\"\""
          ],
          "line": 792
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void set_alias(GDBusPendingPropertySet id, const char *alias,\n\t\t\t\t\t\t\t\tvoid *data)\n{\n\tstruct btd_device *device = data;\n\n\t/* No change */\n\tif ((device->alias == NULL && g_str_equal(alias, \"\")) ||\n\t\t\t\t\tg_strcmp0(device->alias, alias) == 0) {\n\t\tg_dbus_pending_property_success(id);\n\t\treturn;\n\t}\n\n\tg_free(device->alias);\n\tdevice->alias = g_str_equal(alias, \"\") ? NULL : g_strdup(alias);\n\n\tstore_device_info(device);\n\n\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"Alias\");\n\n\tg_dbus_pending_property_success(id);\n}"
  },
  {
    "function_name": "dev_property_get_alias",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "763-784",
    "snippet": "static gboolean dev_property_get_alias(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct btd_device *device = data;\n\tchar dstaddr[18];\n\tconst char *ptr;\n\n\t/* Alias (fallback to name or address) */\n\tif (device->alias != NULL)\n\t\tptr = device->alias;\n\telse if (strlen(device->name) > 0) {\n\t\tptr = device->name;\n\t} else {\n\t\tba2str(&device->bdaddr, dstaddr);\n\t\tg_strdelimit(dstaddr, \":\", '-');\n\t\tptr = dstaddr;\n\t}\n\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_STRING, &ptr);\n\n\treturn TRUE;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_iter_append_basic",
          "args": [
            "iter",
            "DBUS_TYPE_STRING",
            "&ptr"
          ],
          "line": 781
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdelimit",
          "args": [
            "dstaddr",
            "\":\"",
            "'-'"
          ],
          "line": 777
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ba2str",
          "args": [
            "&device->bdaddr",
            "dstaddr"
          ],
          "line": 776
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "device->name"
          ],
          "line": 773
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic gboolean dev_property_get_alias(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct btd_device *device = data;\n\tchar dstaddr[18];\n\tconst char *ptr;\n\n\t/* Alias (fallback to name or address) */\n\tif (device->alias != NULL)\n\t\tptr = device->alias;\n\telse if (strlen(device->name) > 0) {\n\t\tptr = device->name;\n\t} else {\n\t\tba2str(&device->bdaddr, dstaddr);\n\t\tg_strdelimit(dstaddr, \":\", '-');\n\t\tptr = dstaddr;\n\t}\n\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_STRING, &ptr);\n\n\treturn TRUE;\n}"
  },
  {
    "function_name": "dev_property_exists_name",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "755-761",
    "snippet": "static gboolean dev_property_exists_name(const GDBusPropertyTable *property,\n\t\t\t\t\t\t\t\tvoid *data)\n{\n\tstruct btd_device *dev = data;\n\n\treturn device_name_known(dev);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "device_name_known",
          "args": [
            "dev"
          ],
          "line": 760
        },
        "resolved": true,
        "details": {
          "function_name": "device_name_known",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "3919-3922",
          "snippet": "bool device_name_known(struct btd_device *device)\n{\n\treturn device->name[0] != '\\0';\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nbool device_name_known(struct btd_device *device)\n{\n\treturn device->name[0] != '\\0';\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic gboolean dev_property_exists_name(const GDBusPropertyTable *property,\n\t\t\t\t\t\t\t\tvoid *data)\n{\n\tstruct btd_device *dev = data;\n\n\treturn device_name_known(dev);\n}"
  },
  {
    "function_name": "dev_property_get_name",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "744-753",
    "snippet": "static gboolean dev_property_get_name(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct btd_device *device = data;\n\tconst char *ptr = device->name;\n\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_STRING, &ptr);\n\n\treturn TRUE;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_iter_append_basic",
          "args": [
            "iter",
            "DBUS_TYPE_STRING",
            "&ptr"
          ],
          "line": 750
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic gboolean dev_property_get_name(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct btd_device *device = data;\n\tconst char *ptr = device->name;\n\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_STRING, &ptr);\n\n\treturn TRUE;\n}"
  },
  {
    "function_name": "property_get_address_type",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "728-742",
    "snippet": "static gboolean property_get_address_type(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *user_data)\n{\n\tstruct btd_device *device = user_data;\n\tconst char *str;\n\n\tif (device->le && device->bdaddr_type == BDADDR_LE_RANDOM)\n\t\tstr = \"random\";\n\telse\n\t\tstr = \"public\";\n\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_STRING, &str);\n\n\treturn TRUE;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_iter_append_basic",
          "args": [
            "iter",
            "DBUS_TYPE_STRING",
            "&str"
          ],
          "line": 739
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic gboolean property_get_address_type(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *user_data)\n{\n\tstruct btd_device *device = user_data;\n\tconst char *str;\n\n\tif (device->le && device->bdaddr_type == BDADDR_LE_RANDOM)\n\t\tstr = \"random\";\n\telse\n\t\tstr = \"public\";\n\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_STRING, &str);\n\n\treturn TRUE;\n}"
  },
  {
    "function_name": "dev_property_get_address",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "715-726",
    "snippet": "static gboolean dev_property_get_address(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct btd_device *device = data;\n\tchar dstaddr[18];\n\tconst char *ptr = dstaddr;\n\n\tba2str(&device->bdaddr, dstaddr);\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_STRING, &ptr);\n\n\treturn TRUE;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_iter_append_basic",
          "args": [
            "iter",
            "DBUS_TYPE_STRING",
            "&ptr"
          ],
          "line": 723
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ba2str",
          "args": [
            "&device->bdaddr",
            "dstaddr"
          ],
          "line": 722
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic gboolean dev_property_get_address(const GDBusPropertyTable *property,\n\t\t\t\t\tDBusMessageIter *iter, void *data)\n{\n\tstruct btd_device *device = data;\n\tchar dstaddr[18];\n\tconst char *ptr = dstaddr;\n\n\tba2str(&device->bdaddr, dstaddr);\n\tdbus_message_iter_append_basic(iter, DBUS_TYPE_STRING, &ptr);\n\n\treturn TRUE;\n}"
  },
  {
    "function_name": "device_is_trusted",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "710-713",
    "snippet": "gboolean device_is_trusted(struct btd_device *device)\n{\n\treturn device->trusted;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\ngboolean device_is_trusted(struct btd_device *device)\n{\n\treturn device->trusted;\n}"
  },
  {
    "function_name": "device_is_bonded",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "703-708",
    "snippet": "bool device_is_bonded(struct btd_device *device, uint8_t bdaddr_type)\n{\n\tstruct bearer_state *state = get_state(device, bdaddr_type);\n\n\treturn state->bonded;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "get_state",
          "args": [
            "device",
            "bdaddr_type"
          ],
          "line": 705
        },
        "resolved": true,
        "details": {
          "function_name": "get_state",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "275-282",
          "snippet": "static struct bearer_state *get_state(struct btd_device *dev,\n\t\t\t\t\t\t\tuint8_t bdaddr_type)\n{\n\tif (bdaddr_type == BDADDR_BREDR)\n\t\treturn &dev->bredr_state;\n\telse\n\t\treturn &dev->le_state;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic struct bearer_state *get_state(struct btd_device *dev,\n\t\t\t\t\t\t\tuint8_t bdaddr_type)\n{\n\tif (bdaddr_type == BDADDR_BREDR)\n\t\treturn &dev->bredr_state;\n\telse\n\t\treturn &dev->le_state;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nbool device_is_bonded(struct btd_device *device, uint8_t bdaddr_type)\n{\n\tstruct bearer_state *state = get_state(device, bdaddr_type);\n\n\treturn state->bonded;\n}"
  },
  {
    "function_name": "device_is_paired",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "696-701",
    "snippet": "bool device_is_paired(struct btd_device *device, uint8_t bdaddr_type)\n{\n\tstruct bearer_state *state = get_state(device, bdaddr_type);\n\n\treturn state->paired;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "get_state",
          "args": [
            "device",
            "bdaddr_type"
          ],
          "line": 698
        },
        "resolved": true,
        "details": {
          "function_name": "get_state",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "275-282",
          "snippet": "static struct bearer_state *get_state(struct btd_device *dev,\n\t\t\t\t\t\t\tuint8_t bdaddr_type)\n{\n\tif (bdaddr_type == BDADDR_BREDR)\n\t\treturn &dev->bredr_state;\n\telse\n\t\treturn &dev->le_state;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic struct bearer_state *get_state(struct btd_device *dev,\n\t\t\t\t\t\t\tuint8_t bdaddr_type)\n{\n\tif (bdaddr_type == BDADDR_BREDR)\n\t\treturn &dev->bredr_state;\n\telse\n\t\treturn &dev->le_state;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nbool device_is_paired(struct btd_device *device, uint8_t bdaddr_type)\n{\n\tstruct bearer_state *state = get_state(device, bdaddr_type);\n\n\treturn state->paired;\n}"
  },
  {
    "function_name": "device_free",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "640-694",
    "snippet": "static void device_free(gpointer user_data)\n{\n\tstruct btd_device *device = user_data;\n\n\tbtd_gatt_client_destroy(device->client_dbus);\n\tdevice->client_dbus = NULL;\n\n\tg_slist_free_full(device->uuids, g_free);\n\tg_slist_free_full(device->primaries, g_free);\n\tg_slist_free_full(device->svc_callbacks, svc_dev_remove);\n\n\t/* Reset callbacks since the device is going to be freed */\n\tgatt_db_unregister(device->db, device->db_id);\n\n\tattio_cleanup(device);\n\n\tgatt_db_unref(device->db);\n\n\tbt_ad_unref(device->ad);\n\n\tif (device->tmp_records)\n\t\tsdp_list_free(device->tmp_records,\n\t\t\t\t\t(sdp_free_func_t) sdp_record_free);\n\n\tif (device->disconn_timer)\n\t\tg_source_remove(device->disconn_timer);\n\n\tif (device->discov_timer)\n\t\tg_source_remove(device->discov_timer);\n\n\tif (device->connect)\n\t\tdbus_message_unref(device->connect);\n\n\tif (device->disconnect)\n\t\tdbus_message_unref(device->disconnect);\n\n\tDBG(\"%p\", device);\n\n\tif (device->authr) {\n\t\tif (device->authr->agent)\n\t\t\tagent_unref(device->authr->agent);\n\t\tg_free(device->authr->pincode);\n\t\tg_free(device->authr);\n\t}\n\n\tif (device->eir_uuids)\n\t\tg_slist_free_full(device->eir_uuids, g_free);\n\n\tg_free(device->local_csrk);\n\tg_free(device->remote_csrk);\n\tg_free(device->path);\n\tg_free(device->alias);\n\tfree(device->modalias);\n\tg_free(device);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "device"
          ],
          "line": 693
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "device->modalias"
          ],
          "line": 692
        },
        "resolved": true,
        "details": {
          "function_name": "device_auth_req_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5662-5676",
          "snippet": "static void device_auth_req_free(struct btd_device *device)\n{\n\tstruct authentication_req *authr = device->authr;\n\n\tif (!authr)\n\t\treturn;\n\n\tif (authr->agent)\n\t\tagent_unref(authr->agent);\n\n\tg_free(authr->pincode);\n\tg_free(authr);\n\n\tdevice->authr = NULL;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void device_auth_req_free(struct btd_device *device)\n{\n\tstruct authentication_req *authr = device->authr;\n\n\tif (!authr)\n\t\treturn;\n\n\tif (authr->agent)\n\t\tagent_unref(authr->agent);\n\n\tg_free(authr->pincode);\n\tg_free(authr);\n\n\tdevice->authr = NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "device->alias"
          ],
          "line": 691
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "device->path"
          ],
          "line": 690
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "device->remote_csrk"
          ],
          "line": 689
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "device->local_csrk"
          ],
          "line": 688
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_free_full",
          "args": [
            "device->eir_uuids",
            "g_free"
          ],
          "line": 686
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "device->authr"
          ],
          "line": 682
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "device->authr->pincode"
          ],
          "line": 681
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "agent_unref",
          "args": [
            "device->authr->agent"
          ],
          "line": 680
        },
        "resolved": true,
        "details": {
          "function_name": "agent_unref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/agent.c",
          "lines": "211-257",
          "snippet": "void agent_unref(struct agent *agent)\n{\n\tagent->ref--;\n\n\tDBG(\"%p: ref=%d\", agent, agent->ref);\n\n\tif (agent->ref > 0)\n\t\treturn;\n\n\tif (agent->request) {\n\t\tDBusError err;\n\t\tagent_pincode_cb pincode_cb;\n\t\tagent_passkey_cb passkey_cb;\n\t\tagent_cb cb;\n\n\t\tdbus_error_init(&err);\n\t\tdbus_set_error_const(&err, ERROR_INTERFACE \".Failed\",\n\t\t\t\t\t\t\t\t\"Canceled\");\n\n\t\tswitch (agent->request->type) {\n\t\tcase AGENT_REQUEST_PINCODE:\n\t\t\tpincode_cb = agent->request->cb;\n\t\t\tpincode_cb(agent, &err, NULL, agent->request->user_data);\n\t\t\tbreak;\n\t\tcase AGENT_REQUEST_PASSKEY:\n\t\t\tpasskey_cb = agent->request->cb;\n\t\t\tpasskey_cb(agent, &err, 0, agent->request->user_data);\n\t\t\tbreak;\n\t\tcase AGENT_REQUEST_CONFIRMATION:\n\t\tcase AGENT_REQUEST_AUTHORIZATION:\n\t\tcase AGENT_REQUEST_AUTHORIZE_SERVICE:\n\t\tcase AGENT_REQUEST_DISPLAY_PINCODE:\n\t\tdefault:\n\t\t\tcb = agent->request->cb;\n\t\t\tcb(agent, &err, agent->request->user_data);\n\t\t}\n\n\t\tdbus_error_free(&err);\n\n\t\tagent_cancel(agent);\n\t}\n\n\tg_free(agent->owner);\n\tg_free(agent->path);\n\n\tg_free(agent);\n}",
          "includes": [
            "#include \"shared/queue.h\"",
            "#include \"agent.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"dbus-common.h\"",
            "#include \"hcid.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/socket.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shared/queue.h\"\n#include \"agent.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"dbus-common.h\"\n#include \"hcid.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <sys/ioctl.h>\n#include <sys/socket.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid agent_unref(struct agent *agent)\n{\n\tagent->ref--;\n\n\tDBG(\"%p: ref=%d\", agent, agent->ref);\n\n\tif (agent->ref > 0)\n\t\treturn;\n\n\tif (agent->request) {\n\t\tDBusError err;\n\t\tagent_pincode_cb pincode_cb;\n\t\tagent_passkey_cb passkey_cb;\n\t\tagent_cb cb;\n\n\t\tdbus_error_init(&err);\n\t\tdbus_set_error_const(&err, ERROR_INTERFACE \".Failed\",\n\t\t\t\t\t\t\t\t\"Canceled\");\n\n\t\tswitch (agent->request->type) {\n\t\tcase AGENT_REQUEST_PINCODE:\n\t\t\tpincode_cb = agent->request->cb;\n\t\t\tpincode_cb(agent, &err, NULL, agent->request->user_data);\n\t\t\tbreak;\n\t\tcase AGENT_REQUEST_PASSKEY:\n\t\t\tpasskey_cb = agent->request->cb;\n\t\t\tpasskey_cb(agent, &err, 0, agent->request->user_data);\n\t\t\tbreak;\n\t\tcase AGENT_REQUEST_CONFIRMATION:\n\t\tcase AGENT_REQUEST_AUTHORIZATION:\n\t\tcase AGENT_REQUEST_AUTHORIZE_SERVICE:\n\t\tcase AGENT_REQUEST_DISPLAY_PINCODE:\n\t\tdefault:\n\t\t\tcb = agent->request->cb;\n\t\t\tcb(agent, &err, agent->request->user_data);\n\t\t}\n\n\t\tdbus_error_free(&err);\n\n\t\tagent_cancel(agent);\n\t}\n\n\tg_free(agent->owner);\n\tg_free(agent->path);\n\n\tg_free(agent);\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"%p\"",
            "device"
          ],
          "line": 676
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_unref",
          "args": [
            "device->disconnect"
          ],
          "line": 674
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_unref",
          "args": [
            "device->connect"
          ],
          "line": 671
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_source_remove",
          "args": [
            "device->discov_timer"
          ],
          "line": 668
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_source_remove",
          "args": [
            "device->disconn_timer"
          ],
          "line": 665
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_free",
          "args": [
            "device->tmp_records",
            "(sdp_free_func_t) sdp_record_free"
          ],
          "line": 661
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_ad_unref",
          "args": [
            "device->ad"
          ],
          "line": 658
        },
        "resolved": true,
        "details": {
          "function_name": "bt_ad_unref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "107-128",
          "snippet": "void bt_ad_unref(struct bt_ad *ad)\n{\n\tif (!ad)\n\t\treturn;\n\n\tif (__sync_sub_and_fetch(&ad->ref_count, 1))\n\t\treturn;\n\n\tqueue_destroy(ad->service_uuids, free);\n\n\tqueue_destroy(ad->manufacturer_data, manuf_destroy);\n\n\tqueue_destroy(ad->solicit_uuids, free);\n\n\tqueue_destroy(ad->service_data, uuid_destroy);\n\n\tqueue_destroy(ad->data, data_destroy);\n\n\tfree(ad->name);\n\n\tfree(ad);\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nvoid bt_ad_unref(struct bt_ad *ad)\n{\n\tif (!ad)\n\t\treturn;\n\n\tif (__sync_sub_and_fetch(&ad->ref_count, 1))\n\t\treturn;\n\n\tqueue_destroy(ad->service_uuids, free);\n\n\tqueue_destroy(ad->manufacturer_data, manuf_destroy);\n\n\tqueue_destroy(ad->solicit_uuids, free);\n\n\tqueue_destroy(ad->service_data, uuid_destroy);\n\n\tqueue_destroy(ad->data, data_destroy);\n\n\tfree(ad->name);\n\n\tfree(ad);\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_unref",
          "args": [
            "device->db"
          ],
          "line": 656
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_unref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "316-325",
          "snippet": "void gatt_db_unref(struct gatt_db *db)\n{\n\tif (!db)\n\t\treturn;\n\n\tif (__sync_sub_and_fetch(&db->ref_count, 1))\n\t\treturn;\n\n\tgatt_db_destroy(db);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nvoid gatt_db_unref(struct gatt_db *db)\n{\n\tif (!db)\n\t\treturn;\n\n\tif (__sync_sub_and_fetch(&db->ref_count, 1))\n\t\treturn;\n\n\tgatt_db_destroy(db);\n}"
        }
      },
      {
        "call_info": {
          "callee": "attio_cleanup",
          "args": [
            "device"
          ],
          "line": 654
        },
        "resolved": true,
        "details": {
          "function_name": "attio_cleanup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "585-612",
          "snippet": "static void attio_cleanup(struct btd_device *device)\n{\n\tif (device->att_disconn_id)\n\t\tbt_att_unregister_disconnect(device->att,\n\t\t\t\t\t\t\tdevice->att_disconn_id);\n\n\tif (device->att_io) {\n\t\tg_io_channel_shutdown(device->att_io, FALSE, NULL);\n\t\tg_io_channel_unref(device->att_io);\n\t\tdevice->att_io = NULL;\n\t}\n\n\tgatt_client_cleanup(device);\n\tgatt_server_cleanup(device);\n\n\tif (device->att) {\n\t\tbt_att_unref(device->att);\n\t\tdevice->att = NULL;\n\t}\n\n\tif (device->attrib) {\n\t\tGAttrib *attrib = device->attrib;\n\n\t\tdevice->attrib = NULL;\n\t\tg_attrib_cancel_all(attrib);\n\t\tg_attrib_unref(attrib);\n\t}\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void attio_cleanup(struct btd_device *device)\n{\n\tif (device->att_disconn_id)\n\t\tbt_att_unregister_disconnect(device->att,\n\t\t\t\t\t\t\tdevice->att_disconn_id);\n\n\tif (device->att_io) {\n\t\tg_io_channel_shutdown(device->att_io, FALSE, NULL);\n\t\tg_io_channel_unref(device->att_io);\n\t\tdevice->att_io = NULL;\n\t}\n\n\tgatt_client_cleanup(device);\n\tgatt_server_cleanup(device);\n\n\tif (device->att) {\n\t\tbt_att_unref(device->att);\n\t\tdevice->att = NULL;\n\t}\n\n\tif (device->attrib) {\n\t\tGAttrib *attrib = device->attrib;\n\n\t\tdevice->attrib = NULL;\n\t\tg_attrib_cancel_all(attrib);\n\t\tg_attrib_unref(attrib);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_unregister",
          "args": [
            "device->db",
            "device->db_id"
          ],
          "line": 652
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_unregister",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "622-637",
          "snippet": "bool gatt_db_unregister(struct gatt_db *db, unsigned int id)\n{\n\tstruct notify *notify;\n\n\tif (!db || !id)\n\t\treturn false;\n\n\tnotify = queue_find(db->notify_list, match_notify_id, UINT_TO_PTR(id));\n\tif (!notify)\n\t\treturn false;\n\n\tqueue_remove(db->notify_list, notify);\n\tnotify_destroy(notify);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_unregister(struct gatt_db *db, unsigned int id)\n{\n\tstruct notify *notify;\n\n\tif (!db || !id)\n\t\treturn false;\n\n\tnotify = queue_find(db->notify_list, match_notify_id, UINT_TO_PTR(id));\n\tif (!notify)\n\t\treturn false;\n\n\tqueue_remove(db->notify_list, notify);\n\tnotify_destroy(notify);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_slist_free_full",
          "args": [
            "device->svc_callbacks",
            "svc_dev_remove"
          ],
          "line": 649
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_free_full",
          "args": [
            "device->primaries",
            "g_free"
          ],
          "line": 648
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_free_full",
          "args": [
            "device->uuids",
            "g_free"
          ],
          "line": 647
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_gatt_client_destroy",
          "args": [
            "device->client_dbus"
          ],
          "line": 644
        },
        "resolved": true,
        "details": {
          "function_name": "btd_gatt_client_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/gatt-client.c",
          "lines": "2089-2100",
          "snippet": "void btd_gatt_client_destroy(struct btd_gatt_client *client)\n{\n\tif (!client)\n\t\treturn;\n\n\tqueue_destroy(client->services, unregister_service);\n\tqueue_destroy(client->all_notify_clients, NULL);\n\tqueue_destroy(client->ios, NULL);\n\tbt_gatt_client_unref(client->gatt);\n\tgatt_db_unref(client->db);\n\tfree(client);\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"gatt-client.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"gatt-client.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nvoid btd_gatt_client_destroy(struct btd_gatt_client *client)\n{\n\tif (!client)\n\t\treturn;\n\n\tqueue_destroy(client->services, unregister_service);\n\tqueue_destroy(client->all_notify_clients, NULL);\n\tqueue_destroy(client->ios, NULL);\n\tbt_gatt_client_unref(client->gatt);\n\tgatt_db_unref(client->db);\n\tfree(client);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void device_free(gpointer user_data)\n{\n\tstruct btd_device *device = user_data;\n\n\tbtd_gatt_client_destroy(device->client_dbus);\n\tdevice->client_dbus = NULL;\n\n\tg_slist_free_full(device->uuids, g_free);\n\tg_slist_free_full(device->primaries, g_free);\n\tg_slist_free_full(device->svc_callbacks, svc_dev_remove);\n\n\t/* Reset callbacks since the device is going to be freed */\n\tgatt_db_unregister(device->db, device->db_id);\n\n\tattio_cleanup(device);\n\n\tgatt_db_unref(device->db);\n\n\tbt_ad_unref(device->ad);\n\n\tif (device->tmp_records)\n\t\tsdp_list_free(device->tmp_records,\n\t\t\t\t\t(sdp_free_func_t) sdp_record_free);\n\n\tif (device->disconn_timer)\n\t\tg_source_remove(device->disconn_timer);\n\n\tif (device->discov_timer)\n\t\tg_source_remove(device->discov_timer);\n\n\tif (device->connect)\n\t\tdbus_message_unref(device->connect);\n\n\tif (device->disconnect)\n\t\tdbus_message_unref(device->disconnect);\n\n\tDBG(\"%p\", device);\n\n\tif (device->authr) {\n\t\tif (device->authr->agent)\n\t\t\tagent_unref(device->authr->agent);\n\t\tg_free(device->authr->pincode);\n\t\tg_free(device->authr);\n\t}\n\n\tif (device->eir_uuids)\n\t\tg_slist_free_full(device->eir_uuids, g_free);\n\n\tg_free(device->local_csrk);\n\tg_free(device->remote_csrk);\n\tg_free(device->path);\n\tg_free(device->alias);\n\tfree(device->modalias);\n\tg_free(device);\n}"
  },
  {
    "function_name": "svc_dev_remove",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "628-638",
    "snippet": "static void svc_dev_remove(gpointer user_data)\n{\n\tstruct svc_callback *cb = user_data;\n\n\tif (cb->idle_id > 0)\n\t\tg_source_remove(cb->idle_id);\n\n\tcb->func(cb->dev, -ENODEV, cb->user_data);\n\n\tg_free(cb);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "cb"
          ],
          "line": 637
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "cb->func",
          "args": [
            "cb->dev",
            "-ENODEV",
            "cb->user_data"
          ],
          "line": 635
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_source_remove",
          "args": [
            "cb->idle_id"
          ],
          "line": 633
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void svc_dev_remove(gpointer user_data)\n{\n\tstruct svc_callback *cb = user_data;\n\n\tif (cb->idle_id > 0)\n\t\tg_source_remove(cb->idle_id);\n\n\tcb->func(cb->dev, -ENODEV, cb->user_data);\n\n\tg_free(cb);\n}"
  },
  {
    "function_name": "browse_request_cancel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "614-626",
    "snippet": "static void browse_request_cancel(struct browse_req *req)\n{\n\tstruct btd_device *device = req->device;\n\tstruct btd_adapter *adapter = device->adapter;\n\n\tDBG(\"\");\n\n\tbt_cancel_discovery(btd_adapter_get_address(adapter), &device->bdaddr);\n\n\tattio_cleanup(device);\n\n\tbrowse_request_free(req);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "browse_request_free",
          "args": [
            "req"
          ],
          "line": 625
        },
        "resolved": true,
        "details": {
          "function_name": "browse_request_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "519-535",
          "snippet": "static void browse_request_free(struct browse_req *req)\n{\n\tstruct btd_device *device = req->device;\n\n\tif (device->browse == req)\n\t\tdevice->browse = NULL;\n\n\tif (req->listener_id)\n\t\tg_dbus_remove_watch(dbus_conn, req->listener_id);\n\tif (req->msg)\n\t\tdbus_message_unref(req->msg);\n\tg_slist_free_full(req->profiles_added, g_free);\n\tif (req->records)\n\t\tsdp_list_free(req->records, (sdp_free_func_t) sdp_record_free);\n\n\tg_free(req);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *dbus_conn = NULL;",
            "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
            "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);",
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void browse_request_free(struct browse_req *req)\n{\n\tstruct btd_device *device = req->device;\n\n\tif (device->browse == req)\n\t\tdevice->browse = NULL;\n\n\tif (req->listener_id)\n\t\tg_dbus_remove_watch(dbus_conn, req->listener_id);\n\tif (req->msg)\n\t\tdbus_message_unref(req->msg);\n\tg_slist_free_full(req->profiles_added, g_free);\n\tif (req->records)\n\t\tsdp_list_free(req->records, (sdp_free_func_t) sdp_record_free);\n\n\tg_free(req);\n}"
        }
      },
      {
        "call_info": {
          "callee": "attio_cleanup",
          "args": [
            "device"
          ],
          "line": 623
        },
        "resolved": true,
        "details": {
          "function_name": "attio_cleanup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "585-612",
          "snippet": "static void attio_cleanup(struct btd_device *device)\n{\n\tif (device->att_disconn_id)\n\t\tbt_att_unregister_disconnect(device->att,\n\t\t\t\t\t\t\tdevice->att_disconn_id);\n\n\tif (device->att_io) {\n\t\tg_io_channel_shutdown(device->att_io, FALSE, NULL);\n\t\tg_io_channel_unref(device->att_io);\n\t\tdevice->att_io = NULL;\n\t}\n\n\tgatt_client_cleanup(device);\n\tgatt_server_cleanup(device);\n\n\tif (device->att) {\n\t\tbt_att_unref(device->att);\n\t\tdevice->att = NULL;\n\t}\n\n\tif (device->attrib) {\n\t\tGAttrib *attrib = device->attrib;\n\n\t\tdevice->attrib = NULL;\n\t\tg_attrib_cancel_all(attrib);\n\t\tg_attrib_unref(attrib);\n\t}\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void attio_cleanup(struct btd_device *device)\n{\n\tif (device->att_disconn_id)\n\t\tbt_att_unregister_disconnect(device->att,\n\t\t\t\t\t\t\tdevice->att_disconn_id);\n\n\tif (device->att_io) {\n\t\tg_io_channel_shutdown(device->att_io, FALSE, NULL);\n\t\tg_io_channel_unref(device->att_io);\n\t\tdevice->att_io = NULL;\n\t}\n\n\tgatt_client_cleanup(device);\n\tgatt_server_cleanup(device);\n\n\tif (device->att) {\n\t\tbt_att_unref(device->att);\n\t\tdevice->att = NULL;\n\t}\n\n\tif (device->attrib) {\n\t\tGAttrib *attrib = device->attrib;\n\n\t\tdevice->attrib = NULL;\n\t\tg_attrib_cancel_all(attrib);\n\t\tg_attrib_unref(attrib);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_cancel_discovery",
          "args": [
            "btd_adapter_get_address(adapter)",
            "&device->bdaddr"
          ],
          "line": 621
        },
        "resolved": true,
        "details": {
          "function_name": "bt_cancel_discovery",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdp-client.c",
          "lines": "376-404",
          "snippet": "int bt_cancel_discovery(const bdaddr_t *src, const bdaddr_t *dst)\n{\n\tstruct search_context match, *ctxt;\n\tGSList *l;\n\n\tmemset(&match, 0, sizeof(match));\n\tbacpy(&match.src, src);\n\tbacpy(&match.dst, dst);\n\n\t/* Ongoing SDP Discovery */\n\tl = g_slist_find_custom(context_list, &match, find_by_bdaddr);\n\tif (l == NULL)\n\t\treturn -ENOENT;\n\n\tctxt = l->data;\n\n\tif (!ctxt->session)\n\t\treturn -ENOTCONN;\n\n\tif (ctxt->io_id)\n\t\tg_source_remove(ctxt->io_id);\n\n\tif (ctxt->session)\n\t\tsdp_close(ctxt->session);\n\n\tsearch_context_cleanup(ctxt);\n\n\treturn 0;\n}",
          "includes": [
            "#include \"sdp-client.h\"",
            "#include \"log.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static GSList *context_list = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"sdp-client.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nstatic GSList *context_list = NULL;\n\nint bt_cancel_discovery(const bdaddr_t *src, const bdaddr_t *dst)\n{\n\tstruct search_context match, *ctxt;\n\tGSList *l;\n\n\tmemset(&match, 0, sizeof(match));\n\tbacpy(&match.src, src);\n\tbacpy(&match.dst, dst);\n\n\t/* Ongoing SDP Discovery */\n\tl = g_slist_find_custom(context_list, &match, find_by_bdaddr);\n\tif (l == NULL)\n\t\treturn -ENOENT;\n\n\tctxt = l->data;\n\n\tif (!ctxt->session)\n\t\treturn -ENOTCONN;\n\n\tif (ctxt->io_id)\n\t\tg_source_remove(ctxt->io_id);\n\n\tif (ctxt->session)\n\t\tsdp_close(ctxt->session);\n\n\tsearch_context_cleanup(ctxt);\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_adapter_get_address",
          "args": [
            "adapter"
          ],
          "line": 621
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_get_address",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "5881-5884",
          "snippet": "const bdaddr_t *btd_adapter_get_address(struct btd_adapter *adapter)\n{\n\treturn &adapter->bdaddr;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nconst bdaddr_t *btd_adapter_get_address(struct btd_adapter *adapter)\n{\n\treturn &adapter->bdaddr;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"\""
          ],
          "line": 619
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void browse_request_cancel(struct browse_req *req)\n{\n\tstruct btd_device *device = req->device;\n\tstruct btd_adapter *adapter = device->adapter;\n\n\tDBG(\"\");\n\n\tbt_cancel_discovery(btd_adapter_get_address(adapter), &device->bdaddr);\n\n\tattio_cleanup(device);\n\n\tbrowse_request_free(req);\n}"
  },
  {
    "function_name": "attio_cleanup",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "585-612",
    "snippet": "static void attio_cleanup(struct btd_device *device)\n{\n\tif (device->att_disconn_id)\n\t\tbt_att_unregister_disconnect(device->att,\n\t\t\t\t\t\t\tdevice->att_disconn_id);\n\n\tif (device->att_io) {\n\t\tg_io_channel_shutdown(device->att_io, FALSE, NULL);\n\t\tg_io_channel_unref(device->att_io);\n\t\tdevice->att_io = NULL;\n\t}\n\n\tgatt_client_cleanup(device);\n\tgatt_server_cleanup(device);\n\n\tif (device->att) {\n\t\tbt_att_unref(device->att);\n\t\tdevice->att = NULL;\n\t}\n\n\tif (device->attrib) {\n\t\tGAttrib *attrib = device->attrib;\n\n\t\tdevice->attrib = NULL;\n\t\tg_attrib_cancel_all(attrib);\n\t\tg_attrib_unref(attrib);\n\t}\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_attrib_unref",
          "args": [
            "attrib"
          ],
          "line": 610
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_attrib_cancel_all",
          "args": [
            "attrib"
          ],
          "line": 609
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_att_unref",
          "args": [
            "device->att"
          ],
          "line": 601
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_unref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "1063-1075",
          "snippet": "void bt_att_unref(struct bt_att *att)\n{\n\tif (!att)\n\t\treturn;\n\n\tif (__sync_sub_and_fetch(&att->ref_count, 1))\n\t\treturn;\n\n\tbt_att_unregister_all(att);\n\tbt_att_cancel_all(att);\n\n\tbt_att_free(att);\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nvoid bt_att_unref(struct bt_att *att)\n{\n\tif (!att)\n\t\treturn;\n\n\tif (__sync_sub_and_fetch(&att->ref_count, 1))\n\t\treturn;\n\n\tbt_att_unregister_all(att);\n\tbt_att_cancel_all(att);\n\n\tbt_att_free(att);\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_server_cleanup",
          "args": [
            "device"
          ],
          "line": 598
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_server_cleanup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "576-583",
          "snippet": "static void gatt_server_cleanup(struct btd_device *device)\n{\n\tif (!device->server)\n\t\treturn;\n\n\tbt_gatt_server_unref(device->server);\n\tdevice->server = NULL;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void gatt_server_cleanup(struct btd_device *device)\n{\n\tif (!device->server)\n\t\treturn;\n\n\tbt_gatt_server_unref(device->server);\n\tdevice->server = NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_client_cleanup",
          "args": [
            "device"
          ],
          "line": 597
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_client_cleanup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "558-574",
          "snippet": "static void gatt_client_cleanup(struct btd_device *device)\n{\n\tif (!device->client)\n\t\treturn;\n\n\tgatt_cache_cleanup(device);\n\tbt_gatt_client_set_service_changed(device->client, NULL, NULL, NULL);\n\n\tif (device->gatt_ready_id > 0) {\n\t\tbt_gatt_client_ready_unregister(device->client,\n\t\t\t\t\t\tdevice->gatt_ready_id);\n\t\tdevice->gatt_ready_id = 0;\n\t}\n\n\tbt_gatt_client_unref(device->client);\n\tdevice->client = NULL;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void gatt_client_cleanup(struct btd_device *device)\n{\n\tif (!device->client)\n\t\treturn;\n\n\tgatt_cache_cleanup(device);\n\tbt_gatt_client_set_service_changed(device->client, NULL, NULL, NULL);\n\n\tif (device->gatt_ready_id > 0) {\n\t\tbt_gatt_client_ready_unregister(device->client,\n\t\t\t\t\t\tdevice->gatt_ready_id);\n\t\tdevice->gatt_ready_id = 0;\n\t}\n\n\tbt_gatt_client_unref(device->client);\n\tdevice->client = NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_io_channel_unref",
          "args": [
            "device->att_io"
          ],
          "line": 593
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_io_channel_shutdown",
          "args": [
            "device->att_io",
            "FALSE",
            "NULL"
          ],
          "line": 592
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_att_unregister_disconnect",
          "args": [
            "device->att",
            "device->att_disconn_id"
          ],
          "line": 588
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_unregister_disconnect",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "1206-1231",
          "snippet": "bool bt_att_unregister_disconnect(struct bt_att *att, unsigned int id)\n{\n\tstruct att_disconn *disconn;\n\n\tif (!att || !id)\n\t\treturn false;\n\n\t/* Check if disconnect is running */\n\tif (!att->io) {\n\t\tdisconn = queue_find(att->disconn_list, match_disconn_id,\n\t\t\t\t\t\t\tUINT_TO_PTR(id));\n\t\tif (!disconn)\n\t\t\treturn false;\n\n\t\tdisconn->removed = true;\n\t\treturn true;\n\t}\n\n\tdisconn = queue_remove_if(att->disconn_list, match_disconn_id,\n\t\t\t\t\t\t\tUINT_TO_PTR(id));\n\tif (!disconn)\n\t\treturn false;\n\n\tdestroy_att_disconn(disconn);\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nbool bt_att_unregister_disconnect(struct bt_att *att, unsigned int id)\n{\n\tstruct att_disconn *disconn;\n\n\tif (!att || !id)\n\t\treturn false;\n\n\t/* Check if disconnect is running */\n\tif (!att->io) {\n\t\tdisconn = queue_find(att->disconn_list, match_disconn_id,\n\t\t\t\t\t\t\tUINT_TO_PTR(id));\n\t\tif (!disconn)\n\t\t\treturn false;\n\n\t\tdisconn->removed = true;\n\t\treturn true;\n\t}\n\n\tdisconn = queue_remove_if(att->disconn_list, match_disconn_id,\n\t\t\t\t\t\t\tUINT_TO_PTR(id));\n\tif (!disconn)\n\t\treturn false;\n\n\tdestroy_att_disconn(disconn);\n\treturn true;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void attio_cleanup(struct btd_device *device)\n{\n\tif (device->att_disconn_id)\n\t\tbt_att_unregister_disconnect(device->att,\n\t\t\t\t\t\t\tdevice->att_disconn_id);\n\n\tif (device->att_io) {\n\t\tg_io_channel_shutdown(device->att_io, FALSE, NULL);\n\t\tg_io_channel_unref(device->att_io);\n\t\tdevice->att_io = NULL;\n\t}\n\n\tgatt_client_cleanup(device);\n\tgatt_server_cleanup(device);\n\n\tif (device->att) {\n\t\tbt_att_unref(device->att);\n\t\tdevice->att = NULL;\n\t}\n\n\tif (device->attrib) {\n\t\tGAttrib *attrib = device->attrib;\n\n\t\tdevice->attrib = NULL;\n\t\tg_attrib_cancel_all(attrib);\n\t\tg_attrib_unref(attrib);\n\t}\n}"
  },
  {
    "function_name": "gatt_server_cleanup",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "576-583",
    "snippet": "static void gatt_server_cleanup(struct btd_device *device)\n{\n\tif (!device->server)\n\t\treturn;\n\n\tbt_gatt_server_unref(device->server);\n\tdevice->server = NULL;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "bt_gatt_server_unref",
          "args": [
            "device->server"
          ],
          "line": 581
        },
        "resolved": true,
        "details": {
          "function_name": "bt_gatt_server_unref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-server.c",
          "lines": "1601-1610",
          "snippet": "void bt_gatt_server_unref(struct bt_gatt_server *server)\n{\n\tif (!server)\n\t\treturn;\n\n\tif (__sync_sub_and_fetch(&server->ref_count, 1))\n\t\treturn;\n\n\tbt_gatt_server_free(server);\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-helpers.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/att.h\"",
            "#include <errno.h>",
            "#include <sys/uio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/gatt-helpers.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/att.h\"\n#include <errno.h>\n#include <sys/uio.h>\n#include <config.h>\n\nvoid bt_gatt_server_unref(struct bt_gatt_server *server)\n{\n\tif (!server)\n\t\treturn;\n\n\tif (__sync_sub_and_fetch(&server->ref_count, 1))\n\t\treturn;\n\n\tbt_gatt_server_free(server);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void gatt_server_cleanup(struct btd_device *device)\n{\n\tif (!device->server)\n\t\treturn;\n\n\tbt_gatt_server_unref(device->server);\n\tdevice->server = NULL;\n}"
  },
  {
    "function_name": "gatt_client_cleanup",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "558-574",
    "snippet": "static void gatt_client_cleanup(struct btd_device *device)\n{\n\tif (!device->client)\n\t\treturn;\n\n\tgatt_cache_cleanup(device);\n\tbt_gatt_client_set_service_changed(device->client, NULL, NULL, NULL);\n\n\tif (device->gatt_ready_id > 0) {\n\t\tbt_gatt_client_ready_unregister(device->client,\n\t\t\t\t\t\tdevice->gatt_ready_id);\n\t\tdevice->gatt_ready_id = 0;\n\t}\n\n\tbt_gatt_client_unref(device->client);\n\tdevice->client = NULL;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "bt_gatt_client_unref",
          "args": [
            "device->client"
          ],
          "line": 572
        },
        "resolved": true,
        "details": {
          "function_name": "bt_gatt_client_unref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-client.c",
          "lines": "2004-2013",
          "snippet": "void bt_gatt_client_unref(struct bt_gatt_client *client)\n{\n\tif (!client)\n\t\treturn;\n\n\tif (__sync_sub_and_fetch(&client->ref_count, 1))\n\t\treturn;\n\n\tbt_gatt_client_free(client);\n}",
          "includes": [
            "#include <sys/uio.h>",
            "#include <limits.h>",
            "#include <assert.h>",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-helpers.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/att.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/uio.h>\n#include <limits.h>\n#include <assert.h>\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-helpers.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/att.h\"\n#include <config.h>\n\nvoid bt_gatt_client_unref(struct bt_gatt_client *client)\n{\n\tif (!client)\n\t\treturn;\n\n\tif (__sync_sub_and_fetch(&client->ref_count, 1))\n\t\treturn;\n\n\tbt_gatt_client_free(client);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_gatt_client_ready_unregister",
          "args": [
            "device->client",
            "device->gatt_ready_id"
          ],
          "line": 567
        },
        "resolved": true,
        "details": {
          "function_name": "bt_gatt_client_ready_unregister",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-client.c",
          "lines": "2040-2051",
          "snippet": "bool bt_gatt_client_ready_unregister(struct bt_gatt_client *client,\n\t\t\t\t\t\tunsigned int id)\n{\n\tstruct ready_cb *ready = UINT_TO_PTR(id);\n\n\tif (queue_remove(client->ready_cbs, ready)) {\n\t\tready_destroy(ready);\n\t\treturn true;\n\t}\n\n\treturn false;\n}",
          "includes": [
            "#include <sys/uio.h>",
            "#include <limits.h>",
            "#include <assert.h>",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-helpers.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/att.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/uio.h>\n#include <limits.h>\n#include <assert.h>\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-helpers.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/att.h\"\n#include <config.h>\n\nbool bt_gatt_client_ready_unregister(struct bt_gatt_client *client,\n\t\t\t\t\t\tunsigned int id)\n{\n\tstruct ready_cb *ready = UINT_TO_PTR(id);\n\n\tif (queue_remove(client->ready_cbs, ready)) {\n\t\tready_destroy(ready);\n\t\treturn true;\n\t}\n\n\treturn false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_gatt_client_set_service_changed",
          "args": [
            "device->client",
            "NULL",
            "NULL",
            "NULL"
          ],
          "line": 564
        },
        "resolved": true,
        "details": {
          "function_name": "bt_gatt_client_set_service_changed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-client.c",
          "lines": "2053-2069",
          "snippet": "bool bt_gatt_client_set_service_changed(struct bt_gatt_client *client,\n\t\t\tbt_gatt_client_service_changed_callback_t callback,\n\t\t\tvoid *user_data,\n\t\t\tbt_gatt_client_destroy_func_t destroy)\n{\n\tif (!client)\n\t\treturn false;\n\n\tif (client->svc_chngd_destroy)\n\t\tclient->svc_chngd_destroy(client->svc_chngd_data);\n\n\tclient->svc_chngd_callback = callback;\n\tclient->svc_chngd_destroy = destroy;\n\tclient->svc_chngd_data = user_data;\n\n\treturn true;\n}",
          "includes": [
            "#include <sys/uio.h>",
            "#include <limits.h>",
            "#include <assert.h>",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/gatt-helpers.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/att.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void discover_chrcs_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\t\tstruct bt_gatt_result *result,\n\t\t\t\t\t\tvoid *user_data);",
            "static void discover_descs_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\t\tstruct bt_gatt_result *result,\n\t\t\t\t\t\tvoid *user_data);",
            "static void ext_prop_read_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\tconst uint8_t *value, uint16_t length,\n\t\t\t\t\tvoid *user_data);",
            "static void service_changed_cb(uint16_t value_handle, const uint8_t *value,\n\t\t\t\t\tuint16_t length, void *user_data);",
            "static void prepare_write_cb(uint8_t opcode, const void *pdu, uint16_t length,\n\t\t\t\t\t\t\tvoid *user_data);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <sys/uio.h>\n#include <limits.h>\n#include <assert.h>\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/gatt-helpers.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/att.h\"\n#include <config.h>\n\nstatic void discover_chrcs_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\t\tstruct bt_gatt_result *result,\n\t\t\t\t\t\tvoid *user_data);\nstatic void discover_descs_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\t\tstruct bt_gatt_result *result,\n\t\t\t\t\t\tvoid *user_data);\nstatic void ext_prop_read_cb(bool success, uint8_t att_ecode,\n\t\t\t\t\tconst uint8_t *value, uint16_t length,\n\t\t\t\t\tvoid *user_data);\nstatic void service_changed_cb(uint16_t value_handle, const uint8_t *value,\n\t\t\t\t\tuint16_t length, void *user_data);\nstatic void prepare_write_cb(uint8_t opcode, const void *pdu, uint16_t length,\n\t\t\t\t\t\t\tvoid *user_data);\n\nbool bt_gatt_client_set_service_changed(struct bt_gatt_client *client,\n\t\t\tbt_gatt_client_service_changed_callback_t callback,\n\t\t\tvoid *user_data,\n\t\t\tbt_gatt_client_destroy_func_t destroy)\n{\n\tif (!client)\n\t\treturn false;\n\n\tif (client->svc_chngd_destroy)\n\t\tclient->svc_chngd_destroy(client->svc_chngd_data);\n\n\tclient->svc_chngd_callback = callback;\n\tclient->svc_chngd_destroy = destroy;\n\tclient->svc_chngd_data = user_data;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_cache_cleanup",
          "args": [
            "device"
          ],
          "line": 563
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_cache_cleanup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "550-556",
          "snippet": "static void gatt_cache_cleanup(struct btd_device *device)\n{\n\tif (gatt_cache_is_enabled(device))\n\t\treturn;\n\n\tgatt_db_clear(device->db);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void gatt_cache_cleanup(struct btd_device *device)\n{\n\tif (gatt_cache_is_enabled(device))\n\t\treturn;\n\n\tgatt_db_clear(device->db);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void gatt_client_cleanup(struct btd_device *device)\n{\n\tif (!device->client)\n\t\treturn;\n\n\tgatt_cache_cleanup(device);\n\tbt_gatt_client_set_service_changed(device->client, NULL, NULL, NULL);\n\n\tif (device->gatt_ready_id > 0) {\n\t\tbt_gatt_client_ready_unregister(device->client,\n\t\t\t\t\t\tdevice->gatt_ready_id);\n\t\tdevice->gatt_ready_id = 0;\n\t}\n\n\tbt_gatt_client_unref(device->client);\n\tdevice->client = NULL;\n}"
  },
  {
    "function_name": "gatt_cache_cleanup",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "550-556",
    "snippet": "static void gatt_cache_cleanup(struct btd_device *device)\n{\n\tif (gatt_cache_is_enabled(device))\n\t\treturn;\n\n\tgatt_db_clear(device->db);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "gatt_db_clear",
          "args": [
            "device->db"
          ],
          "line": 555
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_clear",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "425-428",
          "snippet": "bool gatt_db_clear(struct gatt_db *db)\n{\n\treturn gatt_db_clear_range(db, 1, UINT16_MAX);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_clear(struct gatt_db *db)\n{\n\treturn gatt_db_clear_range(db, 1, UINT16_MAX);\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_cache_is_enabled",
          "args": [
            "device"
          ],
          "line": 552
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_cache_is_enabled",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "537-548",
          "snippet": "static bool gatt_cache_is_enabled(struct btd_device *device)\n{\n\tswitch (main_opts.gatt_cache) {\n\tcase BT_GATT_CACHE_YES:\n\t\treturn device_is_paired(device, device->bdaddr_type);\n\tcase BT_GATT_CACHE_NO:\n\t\treturn false;\n\tcase BT_GATT_CACHE_ALWAYS:\n\tdefault:\n\t\treturn true;\n\t}\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic bool gatt_cache_is_enabled(struct btd_device *device)\n{\n\tswitch (main_opts.gatt_cache) {\n\tcase BT_GATT_CACHE_YES:\n\t\treturn device_is_paired(device, device->bdaddr_type);\n\tcase BT_GATT_CACHE_NO:\n\t\treturn false;\n\tcase BT_GATT_CACHE_ALWAYS:\n\tdefault:\n\t\treturn true;\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void gatt_cache_cleanup(struct btd_device *device)\n{\n\tif (gatt_cache_is_enabled(device))\n\t\treturn;\n\n\tgatt_db_clear(device->db);\n}"
  },
  {
    "function_name": "gatt_cache_is_enabled",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "537-548",
    "snippet": "static bool gatt_cache_is_enabled(struct btd_device *device)\n{\n\tswitch (main_opts.gatt_cache) {\n\tcase BT_GATT_CACHE_YES:\n\t\treturn device_is_paired(device, device->bdaddr_type);\n\tcase BT_GATT_CACHE_NO:\n\t\treturn false;\n\tcase BT_GATT_CACHE_ALWAYS:\n\tdefault:\n\t\treturn true;\n\t}\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "device_is_paired",
          "args": [
            "device",
            "device->bdaddr_type"
          ],
          "line": 541
        },
        "resolved": true,
        "details": {
          "function_name": "device_is_paired",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "696-701",
          "snippet": "bool device_is_paired(struct btd_device *device, uint8_t bdaddr_type)\n{\n\tstruct bearer_state *state = get_state(device, bdaddr_type);\n\n\treturn state->paired;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nbool device_is_paired(struct btd_device *device, uint8_t bdaddr_type)\n{\n\tstruct bearer_state *state = get_state(device, bdaddr_type);\n\n\treturn state->paired;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic bool gatt_cache_is_enabled(struct btd_device *device)\n{\n\tswitch (main_opts.gatt_cache) {\n\tcase BT_GATT_CACHE_YES:\n\t\treturn device_is_paired(device, device->bdaddr_type);\n\tcase BT_GATT_CACHE_NO:\n\t\treturn false;\n\tcase BT_GATT_CACHE_ALWAYS:\n\tdefault:\n\t\treturn true;\n\t}\n}"
  },
  {
    "function_name": "browse_request_free",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "519-535",
    "snippet": "static void browse_request_free(struct browse_req *req)\n{\n\tstruct btd_device *device = req->device;\n\n\tif (device->browse == req)\n\t\tdevice->browse = NULL;\n\n\tif (req->listener_id)\n\t\tg_dbus_remove_watch(dbus_conn, req->listener_id);\n\tif (req->msg)\n\t\tdbus_message_unref(req->msg);\n\tg_slist_free_full(req->profiles_added, g_free);\n\tif (req->records)\n\t\tsdp_list_free(req->records, (sdp_free_func_t) sdp_record_free);\n\n\tg_free(req);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static DBusConnection *dbus_conn = NULL;",
      "static int device_browse_gatt(struct btd_device *device, DBusMessage *msg);",
      "static int device_browse_sdp(struct btd_device *device, DBusMessage *msg);",
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "req"
          ],
          "line": 534
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_free",
          "args": [
            "req->records",
            "(sdp_free_func_t) sdp_record_free"
          ],
          "line": 532
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_free_full",
          "args": [
            "req->profiles_added",
            "g_free"
          ],
          "line": 530
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_unref",
          "args": [
            "req->msg"
          ],
          "line": 529
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_remove_watch",
          "args": [
            "dbus_conn",
            "req->listener_id"
          ],
          "line": 527
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic int device_browse_gatt(struct btd_device *device, DBusMessage *msg);\nstatic int device_browse_sdp(struct btd_device *device, DBusMessage *msg);\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void browse_request_free(struct browse_req *req)\n{\n\tstruct btd_device *device = req->device;\n\n\tif (device->browse == req)\n\t\tdevice->browse = NULL;\n\n\tif (req->listener_id)\n\t\tg_dbus_remove_watch(dbus_conn, req->listener_id);\n\tif (req->msg)\n\t\tdbus_message_unref(req->msg);\n\tg_slist_free_full(req->profiles_added, g_free);\n\tif (req->records)\n\t\tsdp_list_free(req->records, (sdp_free_func_t) sdp_record_free);\n\n\tg_free(req);\n}"
  },
  {
    "function_name": "device_store_cached_name",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "489-517",
    "snippet": "void device_store_cached_name(struct btd_device *dev, const char *name)\n{\n\tchar filename[PATH_MAX];\n\tchar d_addr[18];\n\tGKeyFile *key_file;\n\tchar *data;\n\tgsize length = 0;\n\n\tif (device_address_is_private(dev)) {\n\t\tDBG(\"Can't store name for private addressed device %s\",\n\t\t\t\t\t\t\t\tdev->path);\n\t\treturn;\n\t}\n\n\tba2str(&dev->bdaddr, d_addr);\n\tsnprintf(filename, PATH_MAX, STORAGEDIR \"/%s/cache/%s\",\n\t\t\tbtd_adapter_get_storage_dir(dev->adapter), d_addr);\n\tcreate_file(filename, S_IRUSR | S_IWUSR);\n\n\tkey_file = g_key_file_new();\n\tg_key_file_load_from_file(key_file, filename, 0, NULL);\n\tg_key_file_set_string(key_file, \"General\", \"Name\", name);\n\n\tdata = g_key_file_to_data(key_file, &length, NULL);\n\tg_file_set_contents(filename, data, length, NULL);\n\tg_free(data);\n\n\tg_key_file_free(key_file);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_key_file_free",
          "args": [
            "key_file"
          ],
          "line": 516
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "data"
          ],
          "line": 514
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_file_set_contents",
          "args": [
            "filename",
            "data",
            "length",
            "NULL"
          ],
          "line": 513
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_to_data",
          "args": [
            "key_file",
            "&length",
            "NULL"
          ],
          "line": 512
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_set_string",
          "args": [
            "key_file",
            "\"General\"",
            "\"Name\"",
            "name"
          ],
          "line": 510
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_load_from_file",
          "args": [
            "key_file",
            "filename",
            "0",
            "NULL"
          ],
          "line": 509
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_new",
          "args": [],
          "line": 508
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "create_file",
          "args": [
            "filename",
            "S_IRUSR | S_IWUSR"
          ],
          "line": 506
        },
        "resolved": true,
        "details": {
          "function_name": "create_file",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/textfile.c",
          "lines": "76-89",
          "snippet": "int create_file(const char *filename, const mode_t mode)\n{\n\tint fd;\n\n\tcreate_dirs(filename, S_IRUSR | S_IWUSR | S_IXUSR);\n\n\tfd = open(filename, O_RDWR | O_CREAT, mode);\n\tif (fd < 0)\n\t\treturn fd;\n\n\tclose(fd);\n\n\treturn 0;\n}",
          "includes": [
            "#include \"textfile.h\"",
            "#include <sys/param.h>",
            "#include <sys/mman.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <ctype.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"textfile.h\"\n#include <sys/param.h>\n#include <sys/mman.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <ctype.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nint create_file(const char *filename, const mode_t mode)\n{\n\tint fd;\n\n\tcreate_dirs(filename, S_IRUSR | S_IWUSR | S_IXUSR);\n\n\tfd = open(filename, O_RDWR | O_CREAT, mode);\n\tif (fd < 0)\n\t\treturn fd;\n\n\tclose(fd);\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "filename",
            "PATH_MAX",
            "STORAGEDIR \"/%s/cache/%s\"",
            "btd_adapter_get_storage_dir(dev->adapter)",
            "d_addr"
          ],
          "line": 504
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_adapter_get_storage_dir",
          "args": [
            "dev->adapter"
          ],
          "line": 505
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_get_storage_dir",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "438-450",
          "snippet": "const char *btd_adapter_get_storage_dir(struct btd_adapter *adapter)\n{\n\tstatic char dir[25];\n\n\tif (adapter->bdaddr_type == BDADDR_LE_RANDOM) {\n\t\tstrcpy(dir, \"static-\");\n\t\tba2str(&adapter->bdaddr, dir + 7);\n\t} else {\n\t\tba2str(&adapter->bdaddr, dir);\n\t}\n\n\treturn dir;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nconst char *btd_adapter_get_storage_dir(struct btd_adapter *adapter)\n{\n\tstatic char dir[25];\n\n\tif (adapter->bdaddr_type == BDADDR_LE_RANDOM) {\n\t\tstrcpy(dir, \"static-\");\n\t\tba2str(&adapter->bdaddr, dir + 7);\n\t} else {\n\t\tba2str(&adapter->bdaddr, dir);\n\t}\n\n\treturn dir;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ba2str",
          "args": [
            "&dev->bdaddr",
            "d_addr"
          ],
          "line": 503
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Can't store name for private addressed device %s\"",
            "dev->path"
          ],
          "line": 498
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device_address_is_private",
          "args": [
            "dev"
          ],
          "line": 497
        },
        "resolved": true,
        "details": {
          "function_name": "device_address_is_private",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "461-473",
          "snippet": "static bool device_address_is_private(struct btd_device *dev)\n{\n\tif (dev->bdaddr_type != BDADDR_LE_RANDOM)\n\t\treturn false;\n\n\tswitch (dev->bdaddr.b[5] >> 6) {\n\tcase 0x00:\t/* Private non-resolvable */\n\tcase 0x01:\t/* Private resolvable */\n\t\treturn true;\n\tdefault:\n\t\treturn false;\n\t}\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic bool device_address_is_private(struct btd_device *dev)\n{\n\tif (dev->bdaddr_type != BDADDR_LE_RANDOM)\n\t\treturn false;\n\n\tswitch (dev->bdaddr.b[5] >> 6) {\n\tcase 0x00:\t/* Private non-resolvable */\n\tcase 0x01:\t/* Private resolvable */\n\t\treturn true;\n\tdefault:\n\t\treturn false;\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid device_store_cached_name(struct btd_device *dev, const char *name)\n{\n\tchar filename[PATH_MAX];\n\tchar d_addr[18];\n\tGKeyFile *key_file;\n\tchar *data;\n\tgsize length = 0;\n\n\tif (device_address_is_private(dev)) {\n\t\tDBG(\"Can't store name for private addressed device %s\",\n\t\t\t\t\t\t\t\tdev->path);\n\t\treturn;\n\t}\n\n\tba2str(&dev->bdaddr, d_addr);\n\tsnprintf(filename, PATH_MAX, STORAGEDIR \"/%s/cache/%s\",\n\t\t\tbtd_adapter_get_storage_dir(dev->adapter), d_addr);\n\tcreate_file(filename, S_IRUSR | S_IWUSR);\n\n\tkey_file = g_key_file_new();\n\tg_key_file_load_from_file(key_file, filename, 0, NULL);\n\tg_key_file_set_string(key_file, \"General\", \"Name\", name);\n\n\tdata = g_key_file_to_data(key_file, &length, NULL);\n\tg_file_set_contents(filename, data, length, NULL);\n\tg_free(data);\n\n\tg_key_file_free(key_file);\n}"
  },
  {
    "function_name": "store_device_info",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "475-487",
    "snippet": "static void store_device_info(struct btd_device *device)\n{\n\tif (device->temporary || device->store_id > 0)\n\t\treturn;\n\n\tif (device_address_is_private(device)) {\n\t\tDBG(\"Can't store info for private addressed device %s\",\n\t\t\t\t\t\t\t\tdevice->path);\n\t\treturn;\n\t}\n\n\tdevice->store_id = g_idle_add(store_device_info_cb, device);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_idle_add",
          "args": [
            "store_device_info_cb",
            "device"
          ],
          "line": 486
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Can't store info for private addressed device %s\"",
            "device->path"
          ],
          "line": 481
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device_address_is_private",
          "args": [
            "device"
          ],
          "line": 480
        },
        "resolved": true,
        "details": {
          "function_name": "device_address_is_private",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "461-473",
          "snippet": "static bool device_address_is_private(struct btd_device *dev)\n{\n\tif (dev->bdaddr_type != BDADDR_LE_RANDOM)\n\t\treturn false;\n\n\tswitch (dev->bdaddr.b[5] >> 6) {\n\tcase 0x00:\t/* Private non-resolvable */\n\tcase 0x01:\t/* Private resolvable */\n\t\treturn true;\n\tdefault:\n\t\treturn false;\n\t}\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic bool device_address_is_private(struct btd_device *dev)\n{\n\tif (dev->bdaddr_type != BDADDR_LE_RANDOM)\n\t\treturn false;\n\n\tswitch (dev->bdaddr.b[5] >> 6) {\n\tcase 0x00:\t/* Private non-resolvable */\n\tcase 0x01:\t/* Private resolvable */\n\t\treturn true;\n\tdefault:\n\t\treturn false;\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic void store_device_info(struct btd_device *device)\n{\n\tif (device->temporary || device->store_id > 0)\n\t\treturn;\n\n\tif (device_address_is_private(device)) {\n\t\tDBG(\"Can't store info for private addressed device %s\",\n\t\t\t\t\t\t\t\tdevice->path);\n\t\treturn;\n\t}\n\n\tdevice->store_id = g_idle_add(store_device_info_cb, device);\n}"
  },
  {
    "function_name": "device_address_is_private",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "461-473",
    "snippet": "static bool device_address_is_private(struct btd_device *dev)\n{\n\tif (dev->bdaddr_type != BDADDR_LE_RANDOM)\n\t\treturn false;\n\n\tswitch (dev->bdaddr.b[5] >> 6) {\n\tcase 0x00:\t/* Private non-resolvable */\n\tcase 0x01:\t/* Private resolvable */\n\t\treturn true;\n\tdefault:\n\t\treturn false;\n\t}\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic bool device_address_is_private(struct btd_device *dev)\n{\n\tif (dev->bdaddr_type != BDADDR_LE_RANDOM)\n\t\treturn false;\n\n\tswitch (dev->bdaddr.b[5] >> 6) {\n\tcase 0x00:\t/* Private non-resolvable */\n\tcase 0x01:\t/* Private resolvable */\n\t\treturn true;\n\tdefault:\n\t\treturn false;\n\t}\n}"
  },
  {
    "function_name": "store_device_info_cb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "366-459",
    "snippet": "static gboolean store_device_info_cb(gpointer user_data)\n{\n\tstruct btd_device *device = user_data;\n\tGKeyFile *key_file;\n\tchar filename[PATH_MAX];\n\tchar device_addr[18];\n\tchar *str;\n\tchar class[9];\n\tchar **uuids = NULL;\n\tgsize length = 0;\n\n\tdevice->store_id = 0;\n\n\tba2str(&device->bdaddr, device_addr);\n\tsnprintf(filename, PATH_MAX, STORAGEDIR \"/%s/%s/info\",\n\t\t\t\tbtd_adapter_get_storage_dir(device->adapter),\n\t\t\t\tdevice_addr);\n\n\tkey_file = g_key_file_new();\n\tg_key_file_load_from_file(key_file, filename, 0, NULL);\n\n\tg_key_file_set_string(key_file, \"General\", \"Name\", device->name);\n\n\tif (device->alias != NULL)\n\t\tg_key_file_set_string(key_file, \"General\", \"Alias\",\n\t\t\t\t\t\t\t\tdevice->alias);\n\telse\n\t\tg_key_file_remove_key(key_file, \"General\", \"Alias\", NULL);\n\n\tif (device->class) {\n\t\tsprintf(class, \"0x%6.6x\", device->class);\n\t\tg_key_file_set_string(key_file, \"General\", \"Class\", class);\n\t} else {\n\t\tg_key_file_remove_key(key_file, \"General\", \"Class\", NULL);\n\t}\n\n\tif (device->appearance) {\n\t\tsprintf(class, \"0x%4.4x\", device->appearance);\n\t\tg_key_file_set_string(key_file, \"General\", \"Appearance\", class);\n\t} else {\n\t\tg_key_file_remove_key(key_file, \"General\", \"Appearance\", NULL);\n\t}\n\n\tupdate_technologies(key_file, device);\n\n\tg_key_file_set_boolean(key_file, \"General\", \"Trusted\",\n\t\t\t\t\t\t\tdevice->trusted);\n\n\tg_key_file_set_boolean(key_file, \"General\", \"Blocked\",\n\t\t\t\t\t\t\tdevice->blocked);\n\n\tif (device->uuids) {\n\t\tGSList *l;\n\t\tint i;\n\n\t\tuuids = g_new0(char *, g_slist_length(device->uuids) + 1);\n\t\tfor (i = 0, l = device->uuids; l; l = g_slist_next(l), i++)\n\t\t\tuuids[i] = l->data;\n\t\tg_key_file_set_string_list(key_file, \"General\", \"Services\",\n\t\t\t\t\t\t(const char **)uuids, i);\n\t} else {\n\t\tg_key_file_remove_key(key_file, \"General\", \"Services\", NULL);\n\t}\n\n\tif (device->vendor_src) {\n\t\tg_key_file_set_integer(key_file, \"DeviceID\", \"Source\",\n\t\t\t\t\tdevice->vendor_src);\n\t\tg_key_file_set_integer(key_file, \"DeviceID\", \"Vendor\",\n\t\t\t\t\tdevice->vendor);\n\t\tg_key_file_set_integer(key_file, \"DeviceID\", \"Product\",\n\t\t\t\t\tdevice->product);\n\t\tg_key_file_set_integer(key_file, \"DeviceID\", \"Version\",\n\t\t\t\t\tdevice->version);\n\t} else {\n\t\tg_key_file_remove_group(key_file, \"DeviceID\", NULL);\n\t}\n\n\tif (device->local_csrk)\n\t\tstore_csrk(device->local_csrk, key_file, \"LocalSignatureKey\");\n\n\tif (device->remote_csrk)\n\t\tstore_csrk(device->remote_csrk, key_file, \"RemoteSignatureKey\");\n\n\tcreate_file(filename, S_IRUSR | S_IWUSR);\n\n\tstr = g_key_file_to_data(key_file, &length, NULL);\n\tg_file_set_contents(filename, str, length, NULL);\n\tg_free(str);\n\n\tg_key_file_free(key_file);\n\tg_free(uuids);\n\n\treturn FALSE;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void gatt_client_init(struct btd_device *device);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "uuids"
          ],
          "line": 456
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_free",
          "args": [
            "key_file"
          ],
          "line": 455
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "str"
          ],
          "line": 453
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_file_set_contents",
          "args": [
            "filename",
            "str",
            "length",
            "NULL"
          ],
          "line": 452
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_to_data",
          "args": [
            "key_file",
            "&length",
            "NULL"
          ],
          "line": 451
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "create_file",
          "args": [
            "filename",
            "S_IRUSR | S_IWUSR"
          ],
          "line": 449
        },
        "resolved": true,
        "details": {
          "function_name": "create_file",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/textfile.c",
          "lines": "76-89",
          "snippet": "int create_file(const char *filename, const mode_t mode)\n{\n\tint fd;\n\n\tcreate_dirs(filename, S_IRUSR | S_IWUSR | S_IXUSR);\n\n\tfd = open(filename, O_RDWR | O_CREAT, mode);\n\tif (fd < 0)\n\t\treturn fd;\n\n\tclose(fd);\n\n\treturn 0;\n}",
          "includes": [
            "#include \"textfile.h\"",
            "#include <sys/param.h>",
            "#include <sys/mman.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <ctype.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"textfile.h\"\n#include <sys/param.h>\n#include <sys/mman.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <ctype.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nint create_file(const char *filename, const mode_t mode)\n{\n\tint fd;\n\n\tcreate_dirs(filename, S_IRUSR | S_IWUSR | S_IXUSR);\n\n\tfd = open(filename, O_RDWR | O_CREAT, mode);\n\tif (fd < 0)\n\t\treturn fd;\n\n\tclose(fd);\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "store_csrk",
          "args": [
            "device->remote_csrk",
            "key_file",
            "\"RemoteSignatureKey\""
          ],
          "line": 447
        },
        "resolved": true,
        "details": {
          "function_name": "store_csrk",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "353-364",
          "snippet": "static void store_csrk(struct csrk_info *csrk, GKeyFile *key_file,\n\t\t\t\t\t\t\tconst char *group)\n{\n\tchar key[33];\n\tint i;\n\n\tfor (i = 0; i < 16; i++)\n\t\tsprintf(key + (i * 2), \"%2.2X\", csrk->key[i]);\n\n\tg_key_file_set_string(key_file, group, \"Key\", key);\n\tg_key_file_set_integer(key_file, group, \"Counter\", csrk->counter);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void store_csrk(struct csrk_info *csrk, GKeyFile *key_file,\n\t\t\t\t\t\t\tconst char *group)\n{\n\tchar key[33];\n\tint i;\n\n\tfor (i = 0; i < 16; i++)\n\t\tsprintf(key + (i * 2), \"%2.2X\", csrk->key[i]);\n\n\tg_key_file_set_string(key_file, group, \"Key\", key);\n\tg_key_file_set_integer(key_file, group, \"Counter\", csrk->counter);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_key_file_remove_group",
          "args": [
            "key_file",
            "\"DeviceID\"",
            "NULL"
          ],
          "line": 440
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_set_integer",
          "args": [
            "key_file",
            "\"DeviceID\"",
            "\"Version\"",
            "device->version"
          ],
          "line": 437
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_set_integer",
          "args": [
            "key_file",
            "\"DeviceID\"",
            "\"Product\"",
            "device->product"
          ],
          "line": 435
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_set_integer",
          "args": [
            "key_file",
            "\"DeviceID\"",
            "\"Vendor\"",
            "device->vendor"
          ],
          "line": 433
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_set_integer",
          "args": [
            "key_file",
            "\"DeviceID\"",
            "\"Source\"",
            "device->vendor_src"
          ],
          "line": 431
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_remove_key",
          "args": [
            "key_file",
            "\"General\"",
            "\"Services\"",
            "NULL"
          ],
          "line": 427
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_set_string_list",
          "args": [
            "key_file",
            "\"General\"",
            "\"Services\"",
            "(const char **)uuids",
            "i"
          ],
          "line": 424
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_next",
          "args": [
            "l"
          ],
          "line": 422
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_new0",
          "args": [
            "char *, g_slist_length(device->uuids) + 1"
          ],
          "line": 421
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_length",
          "args": [
            "device->uuids"
          ],
          "line": 421
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_set_boolean",
          "args": [
            "key_file",
            "\"General\"",
            "\"Blocked\"",
            "device->blocked"
          ],
          "line": 414
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_set_boolean",
          "args": [
            "key_file",
            "\"General\"",
            "\"Trusted\"",
            "device->trusted"
          ],
          "line": 411
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "update_technologies",
          "args": [
            "key_file",
            "device"
          ],
          "line": 409
        },
        "resolved": true,
        "details": {
          "function_name": "update_technologies",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "328-351",
          "snippet": "static void update_technologies(GKeyFile *file, struct btd_device *dev)\n{\n\tconst char *list[2];\n\tsize_t len = 0;\n\n\tif (dev->bredr)\n\t\tlist[len++] = \"BR/EDR\";\n\n\tif (dev->le) {\n\t\tconst char *type;\n\n\t\tif (dev->bdaddr_type == BDADDR_LE_PUBLIC)\n\t\t\ttype = \"public\";\n\t\telse\n\t\t\ttype = \"static\";\n\n\t\tg_key_file_set_string(file, \"General\", \"AddressType\", type);\n\n\t\tlist[len++] = \"LE\";\n\t}\n\n\tg_key_file_set_string_list(file, \"General\", \"SupportedTechnologies\",\n\t\t\t\t\t\t\t\tlist, len);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void update_technologies(GKeyFile *file, struct btd_device *dev)\n{\n\tconst char *list[2];\n\tsize_t len = 0;\n\n\tif (dev->bredr)\n\t\tlist[len++] = \"BR/EDR\";\n\n\tif (dev->le) {\n\t\tconst char *type;\n\n\t\tif (dev->bdaddr_type == BDADDR_LE_PUBLIC)\n\t\t\ttype = \"public\";\n\t\telse\n\t\t\ttype = \"static\";\n\n\t\tg_key_file_set_string(file, \"General\", \"AddressType\", type);\n\n\t\tlist[len++] = \"LE\";\n\t}\n\n\tg_key_file_set_string_list(file, \"General\", \"SupportedTechnologies\",\n\t\t\t\t\t\t\t\tlist, len);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_key_file_remove_key",
          "args": [
            "key_file",
            "\"General\"",
            "\"Appearance\"",
            "NULL"
          ],
          "line": 406
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_set_string",
          "args": [
            "key_file",
            "\"General\"",
            "\"Appearance\"",
            "class"
          ],
          "line": 404
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            "class",
            "\"0x%4.4x\"",
            "device->appearance"
          ],
          "line": 403
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_remove_key",
          "args": [
            "key_file",
            "\"General\"",
            "\"Class\"",
            "NULL"
          ],
          "line": 399
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_set_string",
          "args": [
            "key_file",
            "\"General\"",
            "\"Class\"",
            "class"
          ],
          "line": 397
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            "class",
            "\"0x%6.6x\"",
            "device->class"
          ],
          "line": 396
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_remove_key",
          "args": [
            "key_file",
            "\"General\"",
            "\"Alias\"",
            "NULL"
          ],
          "line": 393
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_set_string",
          "args": [
            "key_file",
            "\"General\"",
            "\"Alias\"",
            "device->alias"
          ],
          "line": 390
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_set_string",
          "args": [
            "key_file",
            "\"General\"",
            "\"Name\"",
            "device->name"
          ],
          "line": 387
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_load_from_file",
          "args": [
            "key_file",
            "filename",
            "0",
            "NULL"
          ],
          "line": 385
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_new",
          "args": [],
          "line": 384
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "filename",
            "PATH_MAX",
            "STORAGEDIR \"/%s/%s/info\"",
            "btd_adapter_get_storage_dir(device->adapter)",
            "device_addr"
          ],
          "line": 380
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_adapter_get_storage_dir",
          "args": [
            "device->adapter"
          ],
          "line": 381
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_get_storage_dir",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "438-450",
          "snippet": "const char *btd_adapter_get_storage_dir(struct btd_adapter *adapter)\n{\n\tstatic char dir[25];\n\n\tif (adapter->bdaddr_type == BDADDR_LE_RANDOM) {\n\t\tstrcpy(dir, \"static-\");\n\t\tba2str(&adapter->bdaddr, dir + 7);\n\t} else {\n\t\tba2str(&adapter->bdaddr, dir);\n\t}\n\n\treturn dir;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nconst char *btd_adapter_get_storage_dir(struct btd_adapter *adapter)\n{\n\tstatic char dir[25];\n\n\tif (adapter->bdaddr_type == BDADDR_LE_RANDOM) {\n\t\tstrcpy(dir, \"static-\");\n\t\tba2str(&adapter->bdaddr, dir + 7);\n\t} else {\n\t\tba2str(&adapter->bdaddr, dir);\n\t}\n\n\treturn dir;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ba2str",
          "args": [
            "&device->bdaddr",
            "device_addr"
          ],
          "line": 379
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstatic gboolean store_device_info_cb(gpointer user_data)\n{\n\tstruct btd_device *device = user_data;\n\tGKeyFile *key_file;\n\tchar filename[PATH_MAX];\n\tchar device_addr[18];\n\tchar *str;\n\tchar class[9];\n\tchar **uuids = NULL;\n\tgsize length = 0;\n\n\tdevice->store_id = 0;\n\n\tba2str(&device->bdaddr, device_addr);\n\tsnprintf(filename, PATH_MAX, STORAGEDIR \"/%s/%s/info\",\n\t\t\t\tbtd_adapter_get_storage_dir(device->adapter),\n\t\t\t\tdevice_addr);\n\n\tkey_file = g_key_file_new();\n\tg_key_file_load_from_file(key_file, filename, 0, NULL);\n\n\tg_key_file_set_string(key_file, \"General\", \"Name\", device->name);\n\n\tif (device->alias != NULL)\n\t\tg_key_file_set_string(key_file, \"General\", \"Alias\",\n\t\t\t\t\t\t\t\tdevice->alias);\n\telse\n\t\tg_key_file_remove_key(key_file, \"General\", \"Alias\", NULL);\n\n\tif (device->class) {\n\t\tsprintf(class, \"0x%6.6x\", device->class);\n\t\tg_key_file_set_string(key_file, \"General\", \"Class\", class);\n\t} else {\n\t\tg_key_file_remove_key(key_file, \"General\", \"Class\", NULL);\n\t}\n\n\tif (device->appearance) {\n\t\tsprintf(class, \"0x%4.4x\", device->appearance);\n\t\tg_key_file_set_string(key_file, \"General\", \"Appearance\", class);\n\t} else {\n\t\tg_key_file_remove_key(key_file, \"General\", \"Appearance\", NULL);\n\t}\n\n\tupdate_technologies(key_file, device);\n\n\tg_key_file_set_boolean(key_file, \"General\", \"Trusted\",\n\t\t\t\t\t\t\tdevice->trusted);\n\n\tg_key_file_set_boolean(key_file, \"General\", \"Blocked\",\n\t\t\t\t\t\t\tdevice->blocked);\n\n\tif (device->uuids) {\n\t\tGSList *l;\n\t\tint i;\n\n\t\tuuids = g_new0(char *, g_slist_length(device->uuids) + 1);\n\t\tfor (i = 0, l = device->uuids; l; l = g_slist_next(l), i++)\n\t\t\tuuids[i] = l->data;\n\t\tg_key_file_set_string_list(key_file, \"General\", \"Services\",\n\t\t\t\t\t\t(const char **)uuids, i);\n\t} else {\n\t\tg_key_file_remove_key(key_file, \"General\", \"Services\", NULL);\n\t}\n\n\tif (device->vendor_src) {\n\t\tg_key_file_set_integer(key_file, \"DeviceID\", \"Source\",\n\t\t\t\t\tdevice->vendor_src);\n\t\tg_key_file_set_integer(key_file, \"DeviceID\", \"Vendor\",\n\t\t\t\t\tdevice->vendor);\n\t\tg_key_file_set_integer(key_file, \"DeviceID\", \"Product\",\n\t\t\t\t\tdevice->product);\n\t\tg_key_file_set_integer(key_file, \"DeviceID\", \"Version\",\n\t\t\t\t\tdevice->version);\n\t} else {\n\t\tg_key_file_remove_group(key_file, \"DeviceID\", NULL);\n\t}\n\n\tif (device->local_csrk)\n\t\tstore_csrk(device->local_csrk, key_file, \"LocalSignatureKey\");\n\n\tif (device->remote_csrk)\n\t\tstore_csrk(device->remote_csrk, key_file, \"RemoteSignatureKey\");\n\n\tcreate_file(filename, S_IRUSR | S_IWUSR);\n\n\tstr = g_key_file_to_data(key_file, &length, NULL);\n\tg_file_set_contents(filename, str, length, NULL);\n\tg_free(str);\n\n\tg_key_file_free(key_file);\n\tg_free(uuids);\n\n\treturn FALSE;\n}"
  },
  {
    "function_name": "store_csrk",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "353-364",
    "snippet": "static void store_csrk(struct csrk_info *csrk, GKeyFile *key_file,\n\t\t\t\t\t\t\tconst char *group)\n{\n\tchar key[33];\n\tint i;\n\n\tfor (i = 0; i < 16; i++)\n\t\tsprintf(key + (i * 2), \"%2.2X\", csrk->key[i]);\n\n\tg_key_file_set_string(key_file, group, \"Key\", key);\n\tg_key_file_set_integer(key_file, group, \"Counter\", csrk->counter);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_key_file_set_integer",
          "args": [
            "key_file",
            "group",
            "\"Counter\"",
            "csrk->counter"
          ],
          "line": 363
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_set_string",
          "args": [
            "key_file",
            "group",
            "\"Key\"",
            "key"
          ],
          "line": 362
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            "key + (i * 2)",
            "\"%2.2X\"",
            "csrk->key[i]"
          ],
          "line": 360
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void store_csrk(struct csrk_info *csrk, GKeyFile *key_file,\n\t\t\t\t\t\t\tconst char *group)\n{\n\tchar key[33];\n\tint i;\n\n\tfor (i = 0; i < 16; i++)\n\t\tsprintf(key + (i * 2), \"%2.2X\", csrk->key[i]);\n\n\tg_key_file_set_string(key_file, group, \"Key\", key);\n\tg_key_file_set_integer(key_file, group, \"Counter\", csrk->counter);\n}"
  },
  {
    "function_name": "update_technologies",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "328-351",
    "snippet": "static void update_technologies(GKeyFile *file, struct btd_device *dev)\n{\n\tconst char *list[2];\n\tsize_t len = 0;\n\n\tif (dev->bredr)\n\t\tlist[len++] = \"BR/EDR\";\n\n\tif (dev->le) {\n\t\tconst char *type;\n\n\t\tif (dev->bdaddr_type == BDADDR_LE_PUBLIC)\n\t\t\ttype = \"public\";\n\t\telse\n\t\t\ttype = \"static\";\n\n\t\tg_key_file_set_string(file, \"General\", \"AddressType\", type);\n\n\t\tlist[len++] = \"LE\";\n\t}\n\n\tg_key_file_set_string_list(file, \"General\", \"SupportedTechnologies\",\n\t\t\t\t\t\t\t\tlist, len);\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_key_file_set_string_list",
          "args": [
            "file",
            "\"General\"",
            "\"SupportedTechnologies\"",
            "list",
            "len"
          ],
          "line": 349
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_key_file_set_string",
          "args": [
            "file",
            "\"General\"",
            "\"AddressType\"",
            "type"
          ],
          "line": 344
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void update_technologies(GKeyFile *file, struct btd_device *dev)\n{\n\tconst char *list[2];\n\tsize_t len = 0;\n\n\tif (dev->bredr)\n\t\tlist[len++] = \"BR/EDR\";\n\n\tif (dev->le) {\n\t\tconst char *type;\n\n\t\tif (dev->bdaddr_type == BDADDR_LE_PUBLIC)\n\t\t\ttype = \"public\";\n\t\telse\n\t\t\ttype = \"static\";\n\n\t\tg_key_file_set_string(file, \"General\", \"AddressType\", type);\n\n\t\tlist[len++] = \"LE\";\n\t}\n\n\tg_key_file_set_string_list(file, \"General\", \"SupportedTechnologies\",\n\t\t\t\t\t\t\t\tlist, len);\n}"
  },
  {
    "function_name": "find_service_with_uuid",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "313-326",
    "snippet": "static GSList *find_service_with_uuid(GSList *list, char *uuid)\n{\n\tGSList *l;\n\n\tfor (l = list; l != NULL; l = g_slist_next(l)) {\n\t\tstruct btd_service *service = l->data;\n\t\tstruct btd_profile *profile = btd_service_get_profile(service);\n\n\t\tif (bt_uuid_strcmp(profile->remote_uuid, uuid) == 0)\n\t\t\treturn l;\n\t}\n\n\treturn NULL;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bt_uuid_strcmp",
          "args": [
            "profile->remote_uuid",
            "uuid"
          ],
          "line": 321
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_service_get_profile",
          "args": [
            "service"
          ],
          "line": 319
        },
        "resolved": true,
        "details": {
          "function_name": "btd_service_get_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
          "lines": "316-319",
          "snippet": "struct btd_profile *btd_service_get_profile(const struct btd_service *service)\n{\n\treturn service->profile;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/stat.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstruct btd_profile *btd_service_get_profile(const struct btd_service *service)\n{\n\treturn service->profile;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_slist_next",
          "args": [
            "l"
          ],
          "line": 317
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic GSList *find_service_with_uuid(GSList *list, char *uuid)\n{\n\tGSList *l;\n\n\tfor (l = list; l != NULL; l = g_slist_next(l)) {\n\t\tstruct btd_service *service = l->data;\n\t\tstruct btd_profile *profile = btd_service_get_profile(service);\n\n\t\tif (bt_uuid_strcmp(profile->remote_uuid, uuid) == 0)\n\t\t\treturn l;\n\t}\n\n\treturn NULL;\n}"
  },
  {
    "function_name": "find_service_with_state",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "298-311",
    "snippet": "static GSList *find_service_with_state(GSList *list,\n\t\t\t\t\t\tbtd_service_state_t state)\n{\n\tGSList *l;\n\n\tfor (l = list; l != NULL; l = g_slist_next(l)) {\n\t\tstruct btd_service *service = l->data;\n\n\t\tif (btd_service_get_state(service) == state)\n\t\t\treturn l;\n\t}\n\n\treturn NULL;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "btd_service_get_state",
          "args": [
            "service"
          ],
          "line": 306
        },
        "resolved": true,
        "details": {
          "function_name": "btd_service_get_state",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
          "lines": "331-334",
          "snippet": "btd_service_state_t btd_service_get_state(const struct btd_service *service)\n{\n\treturn service->state;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/stat.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nbtd_service_state_t btd_service_get_state(const struct btd_service *service)\n{\n\treturn service->state;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_slist_next",
          "args": [
            "l"
          ],
          "line": 303
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic GSList *find_service_with_state(GSList *list,\n\t\t\t\t\t\tbtd_service_state_t state)\n{\n\tGSList *l;\n\n\tfor (l = list; l != NULL; l = g_slist_next(l)) {\n\t\tstruct btd_service *service = l->data;\n\n\t\tif (btd_service_get_state(service) == state)\n\t\t\treturn l;\n\t}\n\n\treturn NULL;\n}"
  },
  {
    "function_name": "find_service_with_profile",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "284-296",
    "snippet": "static GSList *find_service_with_profile(GSList *list, struct btd_profile *p)\n{\n\tGSList *l;\n\n\tfor (l = list; l != NULL; l = g_slist_next(l)) {\n\t\tstruct btd_service *service = l->data;\n\n\t\tif (btd_service_get_profile(service) == p)\n\t\t\treturn l;\n\t}\n\n\treturn NULL;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "btd_service_get_profile",
          "args": [
            "service"
          ],
          "line": 291
        },
        "resolved": true,
        "details": {
          "function_name": "btd_service_get_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
          "lines": "316-319",
          "snippet": "struct btd_profile *btd_service_get_profile(const struct btd_service *service)\n{\n\treturn service->profile;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/stat.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstruct btd_profile *btd_service_get_profile(const struct btd_service *service)\n{\n\treturn service->profile;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_slist_next",
          "args": [
            "l"
          ],
          "line": 288
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic GSList *find_service_with_profile(GSList *list, struct btd_profile *p)\n{\n\tGSList *l;\n\n\tfor (l = list; l != NULL; l = g_slist_next(l)) {\n\t\tstruct btd_service *service = l->data;\n\n\t\tif (btd_service_get_profile(service) == p)\n\t\t\treturn l;\n\t}\n\n\treturn NULL;\n}"
  },
  {
    "function_name": "get_state",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
    "lines": "275-282",
    "snippet": "static struct bearer_state *get_state(struct btd_device *dev,\n\t\t\t\t\t\t\tuint8_t bdaddr_type)\n{\n\tif (bdaddr_type == BDADDR_BREDR)\n\t\treturn &dev->bredr_state;\n\telse\n\t\treturn &dev->le_state;\n}",
    "includes": [
      "#include \"eir.h\"",
      "#include \"attrib-server.h\"",
      "#include \"storage.h\"",
      "#include \"textfile.h\"",
      "#include \"agent.h\"",
      "#include \"attrib/gatt.h\"",
      "#include \"sdp-client.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"dbus-common.h\"",
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"gatt-client.h\"",
      "#include \"device.h\"",
      "#include \"attrib/gattrib.h\"",
      "#include \"gatt-database.h\"",
      "#include \"adapter.h\"",
      "#include \"hcid.h\"",
      "#include \"attrib/att.h\"",
      "#include \"lib/mgmt.h\"",
      "#include \"btio/btio.h\"",
      "#include \"src/shared/ad.h\"",
      "#include \"src/shared/gatt-server.h\"",
      "#include \"src/shared/gatt-client.h\"",
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"log.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <time.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic struct bearer_state *get_state(struct btd_device *dev,\n\t\t\t\t\t\t\tuint8_t bdaddr_type)\n{\n\tif (bdaddr_type == BDADDR_BREDR)\n\t\treturn &dev->bredr_state;\n\telse\n\t\treturn &dev->le_state;\n}"
  }
]