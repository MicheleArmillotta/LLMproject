[
  {
    "function_name": "find_record_in_list",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/storage.c",
    "lines": "169-198",
    "snippet": "sdp_record_t *find_record_in_list(sdp_list_t *recs, const char *uuid)\n{\n\tsdp_list_t *seq;\n\n\tfor (seq = recs; seq; seq = seq->next) {\n\t\tsdp_record_t *rec = (sdp_record_t *) seq->data;\n\t\tsdp_list_t *svcclass = NULL;\n\t\tchar *uuid_str;\n\n\t\tif (sdp_get_service_classes(rec, &svcclass) < 0)\n\t\t\tcontinue;\n\n\t\t/* Extract the uuid */\n\t\tuuid_str = bt_uuid2string(svcclass->data);\n\t\tif (!uuid_str) {\n\t\t\tsdp_list_free(svcclass, free);\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (!strcasecmp(uuid_str, uuid)) {\n\t\t\tsdp_list_free(svcclass, free);\n\t\t\tfree(uuid_str);\n\t\t\treturn rec;\n\t\t}\n\n\t\tsdp_list_free(svcclass, free);\n\t\tfree(uuid_str);\n\t}\n\treturn NULL;\n}",
    "includes": [
      "#include \"storage.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"textfile.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <sys/stat.h>",
      "#include <sys/file.h>",
      "#include <time.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <fcntl.h>",
      "#include <ctype.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "uuid_str"
          ],
          "line": 195
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_server_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
          "lines": "123-150",
          "snippet": "static void gatt_server_free(struct gatt_server *server)\n{\n\tg_list_free_full(server->database, attrib_free);\n\n\tif (server->l2cap_io != NULL) {\n\t\tg_io_channel_shutdown(server->l2cap_io, FALSE, NULL);\n\t\tg_io_channel_unref(server->l2cap_io);\n\t}\n\n\tif (server->le_io != NULL) {\n\t\tg_io_channel_shutdown(server->le_io, FALSE, NULL);\n\t\tg_io_channel_unref(server->le_io);\n\t}\n\n\tg_slist_free_full(server->clients, (GDestroyNotify) channel_free);\n\n\tif (server->gatt_sdp_handle > 0)\n\t\tadapter_service_remove(server->adapter,\n\t\t\t\t\tserver->gatt_sdp_handle);\n\n\tif (server->gap_sdp_handle > 0)\n\t\tadapter_service_remove(server->adapter, server->gap_sdp_handle);\n\n\tif (server->adapter != NULL)\n\t\tbtd_adapter_unref(server->adapter);\n\n\tg_free(server);\n}",
          "includes": [
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"attrib/att-database.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <sys/stat.h>",
            "#include <glib.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic void gatt_server_free(struct gatt_server *server)\n{\n\tg_list_free_full(server->database, attrib_free);\n\n\tif (server->l2cap_io != NULL) {\n\t\tg_io_channel_shutdown(server->l2cap_io, FALSE, NULL);\n\t\tg_io_channel_unref(server->l2cap_io);\n\t}\n\n\tif (server->le_io != NULL) {\n\t\tg_io_channel_shutdown(server->le_io, FALSE, NULL);\n\t\tg_io_channel_unref(server->le_io);\n\t}\n\n\tg_slist_free_full(server->clients, (GDestroyNotify) channel_free);\n\n\tif (server->gatt_sdp_handle > 0)\n\t\tadapter_service_remove(server->adapter,\n\t\t\t\t\tserver->gatt_sdp_handle);\n\n\tif (server->gap_sdp_handle > 0)\n\t\tadapter_service_remove(server->adapter, server->gap_sdp_handle);\n\n\tif (server->adapter != NULL)\n\t\tbtd_adapter_unref(server->adapter);\n\n\tg_free(server);\n}"
        }
      },
      {
        "call_info": {
          "callee": "sdp_list_free",
          "args": [
            "svcclass",
            "free"
          ],
          "line": 194
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_free",
          "args": [
            "svcclass",
            "free"
          ],
          "line": 189
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcasecmp",
          "args": [
            "uuid_str",
            "uuid"
          ],
          "line": 188
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_free",
          "args": [
            "svcclass",
            "free"
          ],
          "line": 184
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_uuid2string",
          "args": [
            "svcclass->data"
          ],
          "line": 182
        },
        "resolved": true,
        "details": {
          "function_name": "bt_uuid2string",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/uuid-helper.c",
          "lines": "65-110",
          "snippet": "char *bt_uuid2string(uuid_t *uuid)\n{\n\tchar *str;\n\tuuid_t uuid128;\n\tunsigned int data0;\n\tunsigned short data1;\n\tunsigned short data2;\n\tunsigned short data3;\n\tunsigned int data4;\n\tunsigned short data5;\n\tint err;\n\n\tif (!uuid)\n\t\treturn NULL;\n\n\tswitch (uuid->type) {\n\tcase SDP_UUID16:\n\t\tsdp_uuid16_to_uuid128(&uuid128, uuid);\n\t\tbreak;\n\tcase SDP_UUID32:\n\t\tsdp_uuid32_to_uuid128(&uuid128, uuid);\n\t\tbreak;\n\tcase SDP_UUID128:\n\t\tmemcpy(&uuid128, uuid, sizeof(uuid_t));\n\t\tbreak;\n\tdefault:\n\t\t/* Type of UUID unknown */\n\t\treturn NULL;\n\t}\n\n\tmemcpy(&data0, &uuid128.value.uuid128.data[0], 4);\n\tmemcpy(&data1, &uuid128.value.uuid128.data[4], 2);\n\tmemcpy(&data2, &uuid128.value.uuid128.data[6], 2);\n\tmemcpy(&data3, &uuid128.value.uuid128.data[8], 2);\n\tmemcpy(&data4, &uuid128.value.uuid128.data[10], 4);\n\tmemcpy(&data5, &uuid128.value.uuid128.data[14], 2);\n\n\terr = asprintf(&str, \"%.8x-%.4x-%.4x-%.4x-%.8x%.4x\",\n\t\t\tntohl(data0), ntohs(data1),\n\t\t\tntohs(data2), ntohs(data3),\n\t\t\tntohl(data4), ntohs(data5));\n\tif (err < 0)\n\t\treturn NULL;\n\n\treturn str;\n}",
          "includes": [
            "#include \"uuid-helper.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <arpa/inet.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"uuid-helper.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <arpa/inet.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *bt_uuid2string(uuid_t *uuid)\n{\n\tchar *str;\n\tuuid_t uuid128;\n\tunsigned int data0;\n\tunsigned short data1;\n\tunsigned short data2;\n\tunsigned short data3;\n\tunsigned int data4;\n\tunsigned short data5;\n\tint err;\n\n\tif (!uuid)\n\t\treturn NULL;\n\n\tswitch (uuid->type) {\n\tcase SDP_UUID16:\n\t\tsdp_uuid16_to_uuid128(&uuid128, uuid);\n\t\tbreak;\n\tcase SDP_UUID32:\n\t\tsdp_uuid32_to_uuid128(&uuid128, uuid);\n\t\tbreak;\n\tcase SDP_UUID128:\n\t\tmemcpy(&uuid128, uuid, sizeof(uuid_t));\n\t\tbreak;\n\tdefault:\n\t\t/* Type of UUID unknown */\n\t\treturn NULL;\n\t}\n\n\tmemcpy(&data0, &uuid128.value.uuid128.data[0], 4);\n\tmemcpy(&data1, &uuid128.value.uuid128.data[4], 2);\n\tmemcpy(&data2, &uuid128.value.uuid128.data[6], 2);\n\tmemcpy(&data3, &uuid128.value.uuid128.data[8], 2);\n\tmemcpy(&data4, &uuid128.value.uuid128.data[10], 4);\n\tmemcpy(&data5, &uuid128.value.uuid128.data[14], 2);\n\n\terr = asprintf(&str, \"%.8x-%.4x-%.4x-%.4x-%.8x%.4x\",\n\t\t\tntohl(data0), ntohs(data1),\n\t\t\tntohs(data2), ntohs(data3),\n\t\t\tntohl(data4), ntohs(data5));\n\tif (err < 0)\n\t\treturn NULL;\n\n\treturn str;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sdp_get_service_classes",
          "args": [
            "rec",
            "&svcclass"
          ],
          "line": 178
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"storage.h\"\n#include \"uuid-helper.h\"\n#include \"textfile.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <time.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <ctype.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nsdp_record_t *find_record_in_list(sdp_list_t *recs, const char *uuid)\n{\n\tsdp_list_t *seq;\n\n\tfor (seq = recs; seq; seq = seq->next) {\n\t\tsdp_record_t *rec = (sdp_record_t *) seq->data;\n\t\tsdp_list_t *svcclass = NULL;\n\t\tchar *uuid_str;\n\n\t\tif (sdp_get_service_classes(rec, &svcclass) < 0)\n\t\t\tcontinue;\n\n\t\t/* Extract the uuid */\n\t\tuuid_str = bt_uuid2string(svcclass->data);\n\t\tif (!uuid_str) {\n\t\t\tsdp_list_free(svcclass, free);\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (!strcasecmp(uuid_str, uuid)) {\n\t\t\tsdp_list_free(svcclass, free);\n\t\t\tfree(uuid_str);\n\t\t\treturn rec;\n\t\t}\n\n\t\tsdp_list_free(svcclass, free);\n\t\tfree(uuid_str);\n\t}\n\treturn NULL;\n}"
  },
  {
    "function_name": "record_from_string",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/storage.c",
    "lines": "147-167",
    "snippet": "sdp_record_t *record_from_string(const char *str)\n{\n\tsdp_record_t *rec;\n\tint size, i, len;\n\tuint8_t *pdata;\n\tchar tmp[3];\n\n\tsize = strlen(str)/2;\n\tpdata = g_malloc0(size);\n\n\ttmp[2] = 0;\n\tfor (i = 0; i < size; i++) {\n\t\tmemcpy(tmp, str + (i * 2), 2);\n\t\tpdata[i] = (uint8_t) strtol(tmp, NULL, 16);\n\t}\n\n\trec = sdp_extract_pdu(pdata, size, &len);\n\tg_free(pdata);\n\n\treturn rec;\n}",
    "includes": [
      "#include \"storage.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"textfile.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <sys/stat.h>",
      "#include <sys/file.h>",
      "#include <time.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <fcntl.h>",
      "#include <ctype.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "pdata"
          ],
          "line": 164
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_extract_pdu",
          "args": [
            "pdata",
            "size",
            "&len"
          ],
          "line": 163
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strtol",
          "args": [
            "tmp",
            "NULL",
            "16"
          ],
          "line": 160
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "tmp",
            "str + (i * 2)",
            "2"
          ],
          "line": 159
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_malloc0",
          "args": [
            "size"
          ],
          "line": 155
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "str"
          ],
          "line": 154
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"storage.h\"\n#include \"uuid-helper.h\"\n#include \"textfile.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <time.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <ctype.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nsdp_record_t *record_from_string(const char *str)\n{\n\tsdp_record_t *rec;\n\tint size, i, len;\n\tuint8_t *pdata;\n\tchar tmp[3];\n\n\tsize = strlen(str)/2;\n\tpdata = g_malloc0(size);\n\n\ttmp[2] = 0;\n\tfor (i = 0; i < size; i++) {\n\t\tmemcpy(tmp, str + (i * 2), 2);\n\t\tpdata[i] = (uint8_t) strtol(tmp, NULL, 16);\n\t}\n\n\trec = sdp_extract_pdu(pdata, size, &len);\n\tg_free(pdata);\n\n\treturn rec;\n}"
  },
  {
    "function_name": "read_local_name",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/storage.c",
    "lines": "126-145",
    "snippet": "int read_local_name(const bdaddr_t *bdaddr, char *name)\n{\n\tchar filename[PATH_MAX], *str;\n\tint len;\n\n\tcreate_filename(filename, PATH_MAX, bdaddr, \"config\");\n\n\tstr = textfile_get(filename, \"name\");\n\tif (!str)\n\t\treturn -ENOENT;\n\n\tlen = strlen(str);\n\tif (len > HCI_MAX_NAME_LENGTH)\n\t\tstr[HCI_MAX_NAME_LENGTH] = '\\0';\n\tstrcpy(name, str);\n\n\tfree(str);\n\n\treturn 0;\n}",
    "includes": [
      "#include \"storage.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"textfile.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <sys/stat.h>",
      "#include <sys/file.h>",
      "#include <time.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <fcntl.h>",
      "#include <ctype.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "str"
          ],
          "line": 142
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_server_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
          "lines": "123-150",
          "snippet": "static void gatt_server_free(struct gatt_server *server)\n{\n\tg_list_free_full(server->database, attrib_free);\n\n\tif (server->l2cap_io != NULL) {\n\t\tg_io_channel_shutdown(server->l2cap_io, FALSE, NULL);\n\t\tg_io_channel_unref(server->l2cap_io);\n\t}\n\n\tif (server->le_io != NULL) {\n\t\tg_io_channel_shutdown(server->le_io, FALSE, NULL);\n\t\tg_io_channel_unref(server->le_io);\n\t}\n\n\tg_slist_free_full(server->clients, (GDestroyNotify) channel_free);\n\n\tif (server->gatt_sdp_handle > 0)\n\t\tadapter_service_remove(server->adapter,\n\t\t\t\t\tserver->gatt_sdp_handle);\n\n\tif (server->gap_sdp_handle > 0)\n\t\tadapter_service_remove(server->adapter, server->gap_sdp_handle);\n\n\tif (server->adapter != NULL)\n\t\tbtd_adapter_unref(server->adapter);\n\n\tg_free(server);\n}",
          "includes": [
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"attrib/att-database.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <sys/stat.h>",
            "#include <glib.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic void gatt_server_free(struct gatt_server *server)\n{\n\tg_list_free_full(server->database, attrib_free);\n\n\tif (server->l2cap_io != NULL) {\n\t\tg_io_channel_shutdown(server->l2cap_io, FALSE, NULL);\n\t\tg_io_channel_unref(server->l2cap_io);\n\t}\n\n\tif (server->le_io != NULL) {\n\t\tg_io_channel_shutdown(server->le_io, FALSE, NULL);\n\t\tg_io_channel_unref(server->le_io);\n\t}\n\n\tg_slist_free_full(server->clients, (GDestroyNotify) channel_free);\n\n\tif (server->gatt_sdp_handle > 0)\n\t\tadapter_service_remove(server->adapter,\n\t\t\t\t\tserver->gatt_sdp_handle);\n\n\tif (server->gap_sdp_handle > 0)\n\t\tadapter_service_remove(server->adapter, server->gap_sdp_handle);\n\n\tif (server->adapter != NULL)\n\t\tbtd_adapter_unref(server->adapter);\n\n\tg_free(server);\n}"
        }
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "name",
            "str"
          ],
          "line": 140
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "str"
          ],
          "line": 137
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "textfile_get",
          "args": [
            "filename",
            "\"name\""
          ],
          "line": 133
        },
        "resolved": true,
        "details": {
          "function_name": "textfile_get",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/textfile.c",
          "lines": "376-379",
          "snippet": "char *textfile_get(const char *pathname, const char *key)\n{\n\treturn read_key(pathname, key, 0);\n}",
          "includes": [
            "#include \"textfile.h\"",
            "#include <sys/param.h>",
            "#include <sys/mman.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <ctype.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"textfile.h\"\n#include <sys/param.h>\n#include <sys/mman.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <ctype.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nchar *textfile_get(const char *pathname, const char *key)\n{\n\treturn read_key(pathname, key, 0);\n}"
        }
      },
      {
        "call_info": {
          "callee": "create_filename",
          "args": [
            "filename",
            "PATH_MAX",
            "bdaddr",
            "\"config\""
          ],
          "line": 131
        },
        "resolved": true,
        "details": {
          "function_name": "create_filename",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/storage.c",
          "lines": "58-66",
          "snippet": "static inline int create_filename(char *buf, size_t size,\n\t\t\t\tconst bdaddr_t *bdaddr, const char *name)\n{\n\tchar addr[18];\n\n\tba2str(bdaddr, addr);\n\n\treturn create_name(buf, size, STORAGEDIR, addr, name);\n}",
          "includes": [
            "#include \"storage.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"textfile.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <time.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <ctype.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"storage.h\"\n#include \"uuid-helper.h\"\n#include \"textfile.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <time.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <ctype.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic inline int create_filename(char *buf, size_t size,\n\t\t\t\tconst bdaddr_t *bdaddr, const char *name)\n{\n\tchar addr[18];\n\n\tba2str(bdaddr, addr);\n\n\treturn create_name(buf, size, STORAGEDIR, addr, name);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"storage.h\"\n#include \"uuid-helper.h\"\n#include \"textfile.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <time.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <ctype.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nint read_local_name(const bdaddr_t *bdaddr, char *name)\n{\n\tchar filename[PATH_MAX], *str;\n\tint len;\n\n\tcreate_filename(filename, PATH_MAX, bdaddr, \"config\");\n\n\tstr = textfile_get(filename, \"name\");\n\tif (!str)\n\t\treturn -ENOENT;\n\n\tlen = strlen(str);\n\tif (len > HCI_MAX_NAME_LENGTH)\n\t\tstr[HCI_MAX_NAME_LENGTH] = '\\0';\n\tstrcpy(name, str);\n\n\tfree(str);\n\n\treturn 0;\n}"
  },
  {
    "function_name": "read_on_mode",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/storage.c",
    "lines": "108-124",
    "snippet": "int read_on_mode(const char *src, char *mode, int length)\n{\n\tchar filename[PATH_MAX], *str;\n\n\tcreate_name(filename, PATH_MAX, STORAGEDIR, src, \"config\");\n\n\tstr = textfile_get(filename, \"onmode\");\n\tif (!str)\n\t\treturn -ENOENT;\n\n\tstrncpy(mode, str, length);\n\tmode[length - 1] = '\\0';\n\n\tfree(str);\n\n\treturn 0;\n}",
    "includes": [
      "#include \"storage.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"textfile.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <sys/stat.h>",
      "#include <sys/file.h>",
      "#include <time.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <fcntl.h>",
      "#include <ctype.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "str"
          ],
          "line": 121
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_server_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
          "lines": "123-150",
          "snippet": "static void gatt_server_free(struct gatt_server *server)\n{\n\tg_list_free_full(server->database, attrib_free);\n\n\tif (server->l2cap_io != NULL) {\n\t\tg_io_channel_shutdown(server->l2cap_io, FALSE, NULL);\n\t\tg_io_channel_unref(server->l2cap_io);\n\t}\n\n\tif (server->le_io != NULL) {\n\t\tg_io_channel_shutdown(server->le_io, FALSE, NULL);\n\t\tg_io_channel_unref(server->le_io);\n\t}\n\n\tg_slist_free_full(server->clients, (GDestroyNotify) channel_free);\n\n\tif (server->gatt_sdp_handle > 0)\n\t\tadapter_service_remove(server->adapter,\n\t\t\t\t\tserver->gatt_sdp_handle);\n\n\tif (server->gap_sdp_handle > 0)\n\t\tadapter_service_remove(server->adapter, server->gap_sdp_handle);\n\n\tif (server->adapter != NULL)\n\t\tbtd_adapter_unref(server->adapter);\n\n\tg_free(server);\n}",
          "includes": [
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"attrib/att-database.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <sys/stat.h>",
            "#include <glib.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic void gatt_server_free(struct gatt_server *server)\n{\n\tg_list_free_full(server->database, attrib_free);\n\n\tif (server->l2cap_io != NULL) {\n\t\tg_io_channel_shutdown(server->l2cap_io, FALSE, NULL);\n\t\tg_io_channel_unref(server->l2cap_io);\n\t}\n\n\tif (server->le_io != NULL) {\n\t\tg_io_channel_shutdown(server->le_io, FALSE, NULL);\n\t\tg_io_channel_unref(server->le_io);\n\t}\n\n\tg_slist_free_full(server->clients, (GDestroyNotify) channel_free);\n\n\tif (server->gatt_sdp_handle > 0)\n\t\tadapter_service_remove(server->adapter,\n\t\t\t\t\tserver->gatt_sdp_handle);\n\n\tif (server->gap_sdp_handle > 0)\n\t\tadapter_service_remove(server->adapter, server->gap_sdp_handle);\n\n\tif (server->adapter != NULL)\n\t\tbtd_adapter_unref(server->adapter);\n\n\tg_free(server);\n}"
        }
      },
      {
        "call_info": {
          "callee": "strncpy",
          "args": [
            "mode",
            "str",
            "length"
          ],
          "line": 118
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "textfile_get",
          "args": [
            "filename",
            "\"onmode\""
          ],
          "line": 114
        },
        "resolved": true,
        "details": {
          "function_name": "textfile_get",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/textfile.c",
          "lines": "376-379",
          "snippet": "char *textfile_get(const char *pathname, const char *key)\n{\n\treturn read_key(pathname, key, 0);\n}",
          "includes": [
            "#include \"textfile.h\"",
            "#include <sys/param.h>",
            "#include <sys/mman.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <ctype.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"textfile.h\"\n#include <sys/param.h>\n#include <sys/mman.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <ctype.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nchar *textfile_get(const char *pathname, const char *key)\n{\n\treturn read_key(pathname, key, 0);\n}"
        }
      },
      {
        "call_info": {
          "callee": "create_name",
          "args": [
            "filename",
            "PATH_MAX",
            "STORAGEDIR",
            "src",
            "\"config\""
          ],
          "line": 112
        },
        "resolved": true,
        "details": {
          "function_name": "create_name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/textfile.c",
          "lines": "91-94",
          "snippet": "int create_name(char *buf, size_t size, const char *path, const char *address, const char *name)\n{\n\treturn snprintf(buf, size, \"%s/%s/%s\", path, address, name);\n}",
          "includes": [
            "#include \"textfile.h\"",
            "#include <sys/param.h>",
            "#include <sys/mman.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <ctype.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"textfile.h\"\n#include <sys/param.h>\n#include <sys/mman.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <ctype.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nint create_name(char *buf, size_t size, const char *path, const char *address, const char *name)\n{\n\treturn snprintf(buf, size, \"%s/%s/%s\", path, address, name);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"storage.h\"\n#include \"uuid-helper.h\"\n#include \"textfile.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <time.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <ctype.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nint read_on_mode(const char *src, char *mode, int length)\n{\n\tchar filename[PATH_MAX], *str;\n\n\tcreate_name(filename, PATH_MAX, STORAGEDIR, src, \"config\");\n\n\tstr = textfile_get(filename, \"onmode\");\n\tif (!str)\n\t\treturn -ENOENT;\n\n\tstrncpy(mode, str, length);\n\tmode[length - 1] = '\\0';\n\n\tfree(str);\n\n\treturn 0;\n}"
  },
  {
    "function_name": "read_pairable_timeout",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/storage.c",
    "lines": "88-106",
    "snippet": "int read_pairable_timeout(const char *src, int *timeout)\n{\n\tchar filename[PATH_MAX], *str;\n\n\tcreate_name(filename, PATH_MAX, STORAGEDIR, src, \"config\");\n\n\tstr = textfile_get(filename, \"pairto\");\n\tif (!str)\n\t\treturn -ENOENT;\n\n\tif (sscanf(str, \"%d\", timeout) != 1) {\n\t\tfree(str);\n\t\treturn -ENOENT;\n\t}\n\n\tfree(str);\n\n\treturn 0;\n}",
    "includes": [
      "#include \"storage.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"textfile.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <sys/stat.h>",
      "#include <sys/file.h>",
      "#include <time.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <fcntl.h>",
      "#include <ctype.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "str"
          ],
          "line": 103
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_server_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
          "lines": "123-150",
          "snippet": "static void gatt_server_free(struct gatt_server *server)\n{\n\tg_list_free_full(server->database, attrib_free);\n\n\tif (server->l2cap_io != NULL) {\n\t\tg_io_channel_shutdown(server->l2cap_io, FALSE, NULL);\n\t\tg_io_channel_unref(server->l2cap_io);\n\t}\n\n\tif (server->le_io != NULL) {\n\t\tg_io_channel_shutdown(server->le_io, FALSE, NULL);\n\t\tg_io_channel_unref(server->le_io);\n\t}\n\n\tg_slist_free_full(server->clients, (GDestroyNotify) channel_free);\n\n\tif (server->gatt_sdp_handle > 0)\n\t\tadapter_service_remove(server->adapter,\n\t\t\t\t\tserver->gatt_sdp_handle);\n\n\tif (server->gap_sdp_handle > 0)\n\t\tadapter_service_remove(server->adapter, server->gap_sdp_handle);\n\n\tif (server->adapter != NULL)\n\t\tbtd_adapter_unref(server->adapter);\n\n\tg_free(server);\n}",
          "includes": [
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"attrib/att-database.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <sys/stat.h>",
            "#include <glib.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic void gatt_server_free(struct gatt_server *server)\n{\n\tg_list_free_full(server->database, attrib_free);\n\n\tif (server->l2cap_io != NULL) {\n\t\tg_io_channel_shutdown(server->l2cap_io, FALSE, NULL);\n\t\tg_io_channel_unref(server->l2cap_io);\n\t}\n\n\tif (server->le_io != NULL) {\n\t\tg_io_channel_shutdown(server->le_io, FALSE, NULL);\n\t\tg_io_channel_unref(server->le_io);\n\t}\n\n\tg_slist_free_full(server->clients, (GDestroyNotify) channel_free);\n\n\tif (server->gatt_sdp_handle > 0)\n\t\tadapter_service_remove(server->adapter,\n\t\t\t\t\tserver->gatt_sdp_handle);\n\n\tif (server->gap_sdp_handle > 0)\n\t\tadapter_service_remove(server->adapter, server->gap_sdp_handle);\n\n\tif (server->adapter != NULL)\n\t\tbtd_adapter_unref(server->adapter);\n\n\tg_free(server);\n}"
        }
      },
      {
        "call_info": {
          "callee": "sscanf",
          "args": [
            "str",
            "\"%d\"",
            "timeout"
          ],
          "line": 98
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "textfile_get",
          "args": [
            "filename",
            "\"pairto\""
          ],
          "line": 94
        },
        "resolved": true,
        "details": {
          "function_name": "textfile_get",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/textfile.c",
          "lines": "376-379",
          "snippet": "char *textfile_get(const char *pathname, const char *key)\n{\n\treturn read_key(pathname, key, 0);\n}",
          "includes": [
            "#include \"textfile.h\"",
            "#include <sys/param.h>",
            "#include <sys/mman.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <ctype.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"textfile.h\"\n#include <sys/param.h>\n#include <sys/mman.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <ctype.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nchar *textfile_get(const char *pathname, const char *key)\n{\n\treturn read_key(pathname, key, 0);\n}"
        }
      },
      {
        "call_info": {
          "callee": "create_name",
          "args": [
            "filename",
            "PATH_MAX",
            "STORAGEDIR",
            "src",
            "\"config\""
          ],
          "line": 92
        },
        "resolved": true,
        "details": {
          "function_name": "create_name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/textfile.c",
          "lines": "91-94",
          "snippet": "int create_name(char *buf, size_t size, const char *path, const char *address, const char *name)\n{\n\treturn snprintf(buf, size, \"%s/%s/%s\", path, address, name);\n}",
          "includes": [
            "#include \"textfile.h\"",
            "#include <sys/param.h>",
            "#include <sys/mman.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <ctype.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"textfile.h\"\n#include <sys/param.h>\n#include <sys/mman.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <ctype.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nint create_name(char *buf, size_t size, const char *path, const char *address, const char *name)\n{\n\treturn snprintf(buf, size, \"%s/%s/%s\", path, address, name);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"storage.h\"\n#include \"uuid-helper.h\"\n#include \"textfile.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <time.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <ctype.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nint read_pairable_timeout(const char *src, int *timeout)\n{\n\tchar filename[PATH_MAX], *str;\n\n\tcreate_name(filename, PATH_MAX, STORAGEDIR, src, \"config\");\n\n\tstr = textfile_get(filename, \"pairto\");\n\tif (!str)\n\t\treturn -ENOENT;\n\n\tif (sscanf(str, \"%d\", timeout) != 1) {\n\t\tfree(str);\n\t\treturn -ENOENT;\n\t}\n\n\tfree(str);\n\n\treturn 0;\n}"
  },
  {
    "function_name": "read_discoverable_timeout",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/storage.c",
    "lines": "68-86",
    "snippet": "int read_discoverable_timeout(const char *src, int *timeout)\n{\n\tchar filename[PATH_MAX], *str;\n\n\tcreate_name(filename, PATH_MAX, STORAGEDIR, src, \"config\");\n\n\tstr = textfile_get(filename, \"discovto\");\n\tif (!str)\n\t\treturn -ENOENT;\n\n\tif (sscanf(str, \"%d\", timeout) != 1) {\n\t\tfree(str);\n\t\treturn -ENOENT;\n\t}\n\n\tfree(str);\n\n\treturn 0;\n}",
    "includes": [
      "#include \"storage.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"textfile.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <sys/stat.h>",
      "#include <sys/file.h>",
      "#include <time.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <fcntl.h>",
      "#include <ctype.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "str"
          ],
          "line": 83
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_server_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/attrib-server.c",
          "lines": "123-150",
          "snippet": "static void gatt_server_free(struct gatt_server *server)\n{\n\tg_list_free_full(server->database, attrib_free);\n\n\tif (server->l2cap_io != NULL) {\n\t\tg_io_channel_shutdown(server->l2cap_io, FALSE, NULL);\n\t\tg_io_channel_unref(server->l2cap_io);\n\t}\n\n\tif (server->le_io != NULL) {\n\t\tg_io_channel_shutdown(server->le_io, FALSE, NULL);\n\t\tg_io_channel_unref(server->le_io);\n\t}\n\n\tg_slist_free_full(server->clients, (GDestroyNotify) channel_free);\n\n\tif (server->gatt_sdp_handle > 0)\n\t\tadapter_service_remove(server->adapter,\n\t\t\t\t\tserver->gatt_sdp_handle);\n\n\tif (server->gap_sdp_handle > 0)\n\t\tadapter_service_remove(server->adapter, server->gap_sdp_handle);\n\n\tif (server->adapter != NULL)\n\t\tbtd_adapter_unref(server->adapter);\n\n\tg_free(server);\n}",
          "includes": [
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"attrib/att-database.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <sys/stat.h>",
            "#include <glib.h>",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdbool.h>",
            "#include <stdint.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"attrib/att-database.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"src/shared/util.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <sys/stat.h>\n#include <glib.h>\n#include <unistd.h>\n#include <string.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include <errno.h>\n#include <config.h>\n\nstatic void gatt_server_free(struct gatt_server *server)\n{\n\tg_list_free_full(server->database, attrib_free);\n\n\tif (server->l2cap_io != NULL) {\n\t\tg_io_channel_shutdown(server->l2cap_io, FALSE, NULL);\n\t\tg_io_channel_unref(server->l2cap_io);\n\t}\n\n\tif (server->le_io != NULL) {\n\t\tg_io_channel_shutdown(server->le_io, FALSE, NULL);\n\t\tg_io_channel_unref(server->le_io);\n\t}\n\n\tg_slist_free_full(server->clients, (GDestroyNotify) channel_free);\n\n\tif (server->gatt_sdp_handle > 0)\n\t\tadapter_service_remove(server->adapter,\n\t\t\t\t\tserver->gatt_sdp_handle);\n\n\tif (server->gap_sdp_handle > 0)\n\t\tadapter_service_remove(server->adapter, server->gap_sdp_handle);\n\n\tif (server->adapter != NULL)\n\t\tbtd_adapter_unref(server->adapter);\n\n\tg_free(server);\n}"
        }
      },
      {
        "call_info": {
          "callee": "sscanf",
          "args": [
            "str",
            "\"%d\"",
            "timeout"
          ],
          "line": 78
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "textfile_get",
          "args": [
            "filename",
            "\"discovto\""
          ],
          "line": 74
        },
        "resolved": true,
        "details": {
          "function_name": "textfile_get",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/textfile.c",
          "lines": "376-379",
          "snippet": "char *textfile_get(const char *pathname, const char *key)\n{\n\treturn read_key(pathname, key, 0);\n}",
          "includes": [
            "#include \"textfile.h\"",
            "#include <sys/param.h>",
            "#include <sys/mman.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <ctype.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"textfile.h\"\n#include <sys/param.h>\n#include <sys/mman.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <ctype.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nchar *textfile_get(const char *pathname, const char *key)\n{\n\treturn read_key(pathname, key, 0);\n}"
        }
      },
      {
        "call_info": {
          "callee": "create_name",
          "args": [
            "filename",
            "PATH_MAX",
            "STORAGEDIR",
            "src",
            "\"config\""
          ],
          "line": 72
        },
        "resolved": true,
        "details": {
          "function_name": "create_name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/textfile.c",
          "lines": "91-94",
          "snippet": "int create_name(char *buf, size_t size, const char *path, const char *address, const char *name)\n{\n\treturn snprintf(buf, size, \"%s/%s/%s\", path, address, name);\n}",
          "includes": [
            "#include \"textfile.h\"",
            "#include <sys/param.h>",
            "#include <sys/mman.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <ctype.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"textfile.h\"\n#include <sys/param.h>\n#include <sys/mman.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <ctype.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nint create_name(char *buf, size_t size, const char *path, const char *address, const char *name)\n{\n\treturn snprintf(buf, size, \"%s/%s/%s\", path, address, name);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"storage.h\"\n#include \"uuid-helper.h\"\n#include \"textfile.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <time.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <ctype.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nint read_discoverable_timeout(const char *src, int *timeout)\n{\n\tchar filename[PATH_MAX], *str;\n\n\tcreate_name(filename, PATH_MAX, STORAGEDIR, src, \"config\");\n\n\tstr = textfile_get(filename, \"discovto\");\n\tif (!str)\n\t\treturn -ENOENT;\n\n\tif (sscanf(str, \"%d\", timeout) != 1) {\n\t\tfree(str);\n\t\treturn -ENOENT;\n\t}\n\n\tfree(str);\n\n\treturn 0;\n}"
  },
  {
    "function_name": "create_filename",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/storage.c",
    "lines": "58-66",
    "snippet": "static inline int create_filename(char *buf, size_t size,\n\t\t\t\tconst bdaddr_t *bdaddr, const char *name)\n{\n\tchar addr[18];\n\n\tba2str(bdaddr, addr);\n\n\treturn create_name(buf, size, STORAGEDIR, addr, name);\n}",
    "includes": [
      "#include \"storage.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"textfile.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <sys/stat.h>",
      "#include <sys/file.h>",
      "#include <time.h>",
      "#include <stdlib.h>",
      "#include <unistd.h>",
      "#include <fcntl.h>",
      "#include <ctype.h>",
      "#include <errno.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "create_name",
          "args": [
            "buf",
            "size",
            "STORAGEDIR",
            "addr",
            "name"
          ],
          "line": 65
        },
        "resolved": true,
        "details": {
          "function_name": "create_name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/textfile.c",
          "lines": "91-94",
          "snippet": "int create_name(char *buf, size_t size, const char *path, const char *address, const char *name)\n{\n\treturn snprintf(buf, size, \"%s/%s/%s\", path, address, name);\n}",
          "includes": [
            "#include \"textfile.h\"",
            "#include <sys/param.h>",
            "#include <sys/mman.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <ctype.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"textfile.h\"\n#include <sys/param.h>\n#include <sys/mman.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <ctype.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nint create_name(char *buf, size_t size, const char *path, const char *address, const char *name)\n{\n\treturn snprintf(buf, size, \"%s/%s/%s\", path, address, name);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ba2str",
          "args": [
            "bdaddr",
            "addr"
          ],
          "line": 63
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"storage.h\"\n#include \"uuid-helper.h\"\n#include \"textfile.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <time.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <ctype.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic inline int create_filename(char *buf, size_t size,\n\t\t\t\tconst bdaddr_t *bdaddr, const char *name)\n{\n\tchar addr[18];\n\n\tba2str(bdaddr, addr);\n\n\treturn create_name(buf, size, STORAGEDIR, addr, name);\n}"
  }
]