[
  {
    "function_name": "hfp_hf_disconnect",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "1535-1541",
    "snippet": "bool hfp_hf_disconnect(struct hfp_hf *hfp)\n{\n\tif (!hfp)\n\t\treturn false;\n\n\treturn io_shutdown(hfp->io);\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "io_shutdown",
          "args": [
            "hfp->io"
          ],
          "line": 1540
        },
        "resolved": true,
        "details": {
          "function_name": "io_shutdown",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-glib.c",
          "lines": "286-293",
          "snippet": "bool io_shutdown(struct io *io)\n{\n\tif (!io || !io->channel)\n\t\treturn false;\n\n\treturn g_io_channel_shutdown(io->channel, TRUE, NULL)\n\t\t\t\t\t\t\t== G_IO_STATUS_NORMAL;\n}",
          "includes": [
            "#include \"src/shared/io.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/io.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nbool io_shutdown(struct io *io)\n{\n\tif (!io || !io->channel)\n\t\treturn false;\n\n\treturn g_io_channel_shutdown(io->channel, TRUE, NULL)\n\t\t\t\t\t\t\t== G_IO_STATUS_NORMAL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nbool hfp_hf_disconnect(struct hfp_hf *hfp)\n{\n\tif (!hfp)\n\t\treturn false;\n\n\treturn io_shutdown(hfp->io);\n}"
  },
  {
    "function_name": "hfp_hf_set_disconnect_handler",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "1509-1533",
    "snippet": "bool hfp_hf_set_disconnect_handler(struct hfp_hf *hfp,\n\t\t\t\t\t\thfp_disconnect_func_t callback,\n\t\t\t\t\t\tvoid *user_data,\n\t\t\t\t\t\thfp_destroy_func_t destroy)\n{\n\tif (!hfp)\n\t\treturn false;\n\n\tif (hfp->disconnect_destroy)\n\t\thfp->disconnect_destroy(hfp->disconnect_data);\n\n\tif (!io_set_disconnect_handler(hfp->io, hf_io_disconnected, hfp,\n\t\t\t\t\t\thf_disconnect_watch_destroy)) {\n\t\thfp->disconnect_callback = NULL;\n\t\thfp->disconnect_destroy = NULL;\n\t\thfp->disconnect_data = NULL;\n\t\treturn false;\n\t}\n\n\thfp->disconnect_callback = callback;\n\thfp->disconnect_destroy = destroy;\n\thfp->disconnect_data = user_data;\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "io_set_disconnect_handler",
          "args": [
            "hfp->io",
            "hf_io_disconnected",
            "hfp",
            "hf_disconnect_watch_destroy"
          ],
          "line": 1520
        },
        "resolved": true,
        "details": {
          "function_name": "io_set_disconnect_handler",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-glib.c",
          "lines": "260-264",
          "snippet": "bool io_set_disconnect_handler(struct io *io, io_callback_func_t callback,\n\t\t\t\tvoid *user_data, io_destroy_func_t destroy)\n{\n\treturn io_set_handler(io, G_IO_HUP, callback, user_data, destroy);\n}",
          "includes": [
            "#include \"src/shared/io.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/io.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nbool io_set_disconnect_handler(struct io *io, io_callback_func_t callback,\n\t\t\t\tvoid *user_data, io_destroy_func_t destroy)\n{\n\treturn io_set_handler(io, G_IO_HUP, callback, user_data, destroy);\n}"
        }
      },
      {
        "call_info": {
          "callee": "hfp->disconnect_destroy",
          "args": [
            "hfp->disconnect_data"
          ],
          "line": 1518
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nbool hfp_hf_set_disconnect_handler(struct hfp_hf *hfp,\n\t\t\t\t\t\thfp_disconnect_func_t callback,\n\t\t\t\t\t\tvoid *user_data,\n\t\t\t\t\t\thfp_destroy_func_t destroy)\n{\n\tif (!hfp)\n\t\treturn false;\n\n\tif (hfp->disconnect_destroy)\n\t\thfp->disconnect_destroy(hfp->disconnect_data);\n\n\tif (!io_set_disconnect_handler(hfp->io, hf_io_disconnected, hfp,\n\t\t\t\t\t\thf_disconnect_watch_destroy)) {\n\t\thfp->disconnect_callback = NULL;\n\t\thfp->disconnect_destroy = NULL;\n\t\thfp->disconnect_data = NULL;\n\t\treturn false;\n\t}\n\n\thfp->disconnect_callback = callback;\n\thfp->disconnect_destroy = destroy;\n\thfp->disconnect_data = user_data;\n\n\treturn true;\n}"
  },
  {
    "function_name": "hf_io_disconnected",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "1495-1507",
    "snippet": "static bool hf_io_disconnected(struct io *io, void *user_data)\n{\n\tstruct hfp_hf *hfp = user_data;\n\n\thfp->in_disconnect = true;\n\n\tif (hfp->disconnect_callback)\n\t\thfp->disconnect_callback(hfp->disconnect_data);\n\n\thfp->in_disconnect = false;\n\n\treturn false;\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "hfp->disconnect_callback",
          "args": [
            "hfp->disconnect_data"
          ],
          "line": 1502
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic bool hf_io_disconnected(struct io *io, void *user_data)\n{\n\tstruct hfp_hf *hfp = user_data;\n\n\thfp->in_disconnect = true;\n\n\tif (hfp->disconnect_callback)\n\t\thfp->disconnect_callback(hfp->disconnect_data);\n\n\thfp->in_disconnect = false;\n\n\treturn false;\n}"
  },
  {
    "function_name": "hf_disconnect_watch_destroy",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "1484-1493",
    "snippet": "static void hf_disconnect_watch_destroy(void *user_data)\n{\n\tstruct hfp_hf *hfp = user_data;\n\n\tif (hfp->disconnect_destroy)\n\t\thfp->disconnect_destroy(hfp->disconnect_data);\n\n\tif (hfp->destroyed)\n\t\tfree(hfp);\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "hfp"
          ],
          "line": 1492
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "956-985",
          "snippet": "static void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}"
        }
      },
      {
        "call_info": {
          "callee": "hfp->disconnect_destroy",
          "args": [
            "hfp->disconnect_data"
          ],
          "line": 1489
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void hf_disconnect_watch_destroy(void *user_data)\n{\n\tstruct hfp_hf *hfp = user_data;\n\n\tif (hfp->disconnect_destroy)\n\t\thfp->disconnect_destroy(hfp->disconnect_data);\n\n\tif (hfp->destroyed)\n\t\tfree(hfp);\n}"
  },
  {
    "function_name": "hfp_hf_unregister",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "1467-1482",
    "snippet": "bool hfp_hf_unregister(struct hfp_hf *hfp, const char *prefix)\n{\n\tstruct cmd_handler *handler;\n\n\t/* Cast to void as queue_remove needs that */\n\thandler = queue_remove_if(hfp->event_handlers,\n\t\t\t\t\t\tmatch_handler_event_prefix,\n\t\t\t\t\t\t(void *) prefix);\n\n\tif (!handler)\n\t\treturn false;\n\n\tdestroy_event_handler(handler);\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "destroy_event_handler",
          "args": [
            "handler"
          ],
          "line": 1479
        },
        "resolved": true,
        "details": {
          "function_name": "destroy_event_handler",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
          "lines": "948-958",
          "snippet": "static void destroy_event_handler(void *data)\n{\n\tstruct event_handler *handler = data;\n\n\tif (handler->destroy)\n\t\thandler->destroy(handler->user_data);\n\n\tfree(handler->prefix);\n\n\tfree(handler);\n}",
          "includes": [
            "#include \"src/shared/hfp.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <ctype.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void destroy_event_handler(void *data)\n{\n\tstruct event_handler *handler = data;\n\n\tif (handler->destroy)\n\t\thandler->destroy(handler->user_data);\n\n\tfree(handler->prefix);\n\n\tfree(handler);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_remove_if",
          "args": [
            "hfp->event_handlers",
            "match_handler_event_prefix",
            "(void *) prefix"
          ],
          "line": 1472
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_if",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "278-316",
          "snippet": "void *queue_remove_if(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry, *prev = NULL;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tentry = queue->head;\n\n\twhile (entry) {\n\t\tif (function(entry->data, user_data)) {\n\t\t\tvoid *data;\n\n\t\t\tif (prev)\n\t\t\t\tprev->next = entry->next;\n\t\t\telse\n\t\t\t\tqueue->head = entry->next;\n\n\t\t\tif (!entry->next)\n\t\t\t\tqueue->tail = prev;\n\n\t\t\tdata = entry->data;\n\n\t\t\tfree(entry);\n\t\t\tqueue->entries--;\n\n\t\t\treturn data;\n\t\t} else {\n\t\t\tprev = entry;\n\t\t\tentry = entry->next;\n\t\t}\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid *queue_remove_if(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry, *prev = NULL;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tentry = queue->head;\n\n\twhile (entry) {\n\t\tif (function(entry->data, user_data)) {\n\t\t\tvoid *data;\n\n\t\t\tif (prev)\n\t\t\t\tprev->next = entry->next;\n\t\t\telse\n\t\t\t\tqueue->head = entry->next;\n\n\t\t\tif (!entry->next)\n\t\t\t\tqueue->tail = prev;\n\n\t\t\tdata = entry->data;\n\n\t\t\tfree(entry);\n\t\t\tqueue->entries--;\n\n\t\t\treturn data;\n\t\t} else {\n\t\t\tprev = entry;\n\t\t\tentry = entry->next;\n\t\t}\n\t}\n\n\treturn NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nbool hfp_hf_unregister(struct hfp_hf *hfp, const char *prefix)\n{\n\tstruct cmd_handler *handler;\n\n\t/* Cast to void as queue_remove needs that */\n\thandler = queue_remove_if(hfp->event_handlers,\n\t\t\t\t\t\tmatch_handler_event_prefix,\n\t\t\t\t\t\t(void *) prefix);\n\n\tif (!handler)\n\t\treturn false;\n\n\tdestroy_event_handler(handler);\n\n\treturn true;\n}"
  },
  {
    "function_name": "hfp_hf_register",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "1436-1465",
    "snippet": "bool hfp_hf_register(struct hfp_hf *hfp, hfp_hf_result_func_t callback,\n\t\t\t\t\t\tconst char *prefix,\n\t\t\t\t\t\tvoid *user_data,\n\t\t\t\t\t\thfp_destroy_func_t destroy)\n{\n\tstruct event_handler *handler;\n\n\tif (!callback)\n\t\treturn false;\n\n\thandler = new0(struct event_handler, 1);\n\thandler->callback = callback;\n\thandler->user_data = user_data;\n\n\thandler->prefix = strdup(prefix);\n\tif (!handler->prefix) {\n\t\tfree(handler);\n\t\treturn false;\n\t}\n\n\tif (queue_find(hfp->event_handlers, match_handler_event_prefix,\n\t\t\t\t\t\t\thandler->prefix)) {\n\t\tdestroy_event_handler(handler);\n\t\treturn false;\n\t}\n\n\thandler->destroy = destroy;\n\n\treturn queue_push_tail(hfp->event_handlers, handler);\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_push_tail",
          "args": [
            "hfp->event_handlers",
            "handler"
          ],
          "line": 1464
        },
        "resolved": true,
        "details": {
          "function_name": "queue_push_tail",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "88-108",
          "snippet": "bool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "destroy_event_handler",
          "args": [
            "handler"
          ],
          "line": 1458
        },
        "resolved": true,
        "details": {
          "function_name": "destroy_event_handler",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
          "lines": "948-958",
          "snippet": "static void destroy_event_handler(void *data)\n{\n\tstruct event_handler *handler = data;\n\n\tif (handler->destroy)\n\t\thandler->destroy(handler->user_data);\n\n\tfree(handler->prefix);\n\n\tfree(handler);\n}",
          "includes": [
            "#include \"src/shared/hfp.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <ctype.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void destroy_event_handler(void *data)\n{\n\tstruct event_handler *handler = data;\n\n\tif (handler->destroy)\n\t\thandler->destroy(handler->user_data);\n\n\tfree(handler->prefix);\n\n\tfree(handler);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_find",
          "args": [
            "hfp->event_handlers",
            "match_handler_event_prefix",
            "handler->prefix"
          ],
          "line": 1456
        },
        "resolved": true,
        "details": {
          "function_name": "queue_find",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "231-247",
          "snippet": "void *queue_find(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tconst void *match_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tfor (entry = queue->head; entry; entry = entry->next)\n\t\tif (function(entry->data, match_data))\n\t\t\treturn entry->data;\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid *queue_find(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tconst void *match_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tfor (entry = queue->head; entry; entry = entry->next)\n\t\tif (function(entry->data, match_data))\n\t\t\treturn entry->data;\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "handler"
          ],
          "line": 1452
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "956-985",
          "snippet": "static void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}"
        }
      },
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "prefix"
          ],
          "line": 1450
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "new0",
          "args": [
            "structevent_handler",
            "1"
          ],
          "line": 1446
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nbool hfp_hf_register(struct hfp_hf *hfp, hfp_hf_result_func_t callback,\n\t\t\t\t\t\tconst char *prefix,\n\t\t\t\t\t\tvoid *user_data,\n\t\t\t\t\t\thfp_destroy_func_t destroy)\n{\n\tstruct event_handler *handler;\n\n\tif (!callback)\n\t\treturn false;\n\n\thandler = new0(struct event_handler, 1);\n\thandler->callback = callback;\n\thandler->user_data = user_data;\n\n\thandler->prefix = strdup(prefix);\n\tif (!handler->prefix) {\n\t\tfree(handler);\n\t\treturn false;\n\t}\n\n\tif (queue_find(hfp->event_handlers, match_handler_event_prefix,\n\t\t\t\t\t\t\thandler->prefix)) {\n\t\tdestroy_event_handler(handler);\n\t\treturn false;\n\t}\n\n\thandler->destroy = destroy;\n\n\treturn queue_push_tail(hfp->event_handlers, handler);\n}"
  },
  {
    "function_name": "hfp_hf_send_command",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "1395-1434",
    "snippet": "bool hfp_hf_send_command(struct hfp_hf *hfp, hfp_response_func_t resp_cb,\n\t\t\t\tvoid *user_data, const char *format, ...)\n{\n\tva_list ap;\n\tchar *fmt;\n\tint len;\n\tstruct cmd_response *cmd;\n\n\tif (!hfp || !format || !resp_cb)\n\t\treturn false;\n\n\tif (asprintf(&fmt, \"%s\\r\", format) < 0)\n\t\treturn false;\n\n\tcmd = new0(struct cmd_response, 1);\n\n\tva_start(ap, format);\n\tlen = ringbuf_vprintf(hfp->write_buf, fmt, ap);\n\tva_end(ap);\n\n\tfree(fmt);\n\n\tif (len < 0) {\n\t\tfree(cmd);\n\t\treturn false;\n\t}\n\n\tcmd->resp_cb = resp_cb;\n\tcmd->user_data = user_data;\n\n\tif (!queue_push_tail(hfp->cmd_queue, cmd)) {\n\t\tringbuf_drain(hfp->write_buf, len);\n\t\tfree(cmd);\n\t\treturn false;\n\t}\n\n\thf_wakeup_writer(hfp);\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "hf_wakeup_writer",
          "args": [
            "hfp"
          ],
          "line": 1431
        },
        "resolved": true,
        "details": {
          "function_name": "hf_wakeup_writer",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
          "lines": "1055-1068",
          "snippet": "static void hf_wakeup_writer(struct hfp_hf *hfp)\n{\n\tif (hfp->writer_active)\n\t\treturn;\n\n\tif (!ringbuf_len(hfp->write_buf))\n\t\treturn;\n\n\tif (!io_set_write_handler(hfp->io, hf_can_write_data,\n\t\t\t\t\thfp, hf_write_watch_destroy))\n\t\treturn;\n\n\thfp->writer_active = true;\n}",
          "includes": [
            "#include \"src/shared/hfp.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <ctype.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void hf_wakeup_writer(struct hfp_hf *hfp)\n{\n\tif (hfp->writer_active)\n\t\treturn;\n\n\tif (!ringbuf_len(hfp->write_buf))\n\t\treturn;\n\n\tif (!io_set_write_handler(hfp->io, hf_can_write_data,\n\t\t\t\t\thfp, hf_write_watch_destroy))\n\t\treturn;\n\n\thfp->writer_active = true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "cmd"
          ],
          "line": 1427
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "956-985",
          "snippet": "static void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ringbuf_drain",
          "args": [
            "hfp->write_buf",
            "len"
          ],
          "line": 1426
        },
        "resolved": true,
        "details": {
          "function_name": "ringbuf_drain",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ringbuf.c",
          "lines": "125-144",
          "snippet": "size_t ringbuf_drain(struct ringbuf *ringbuf, size_t count)\n{\n\tsize_t len;\n\n\tif (!ringbuf)\n\t\treturn 0;\n\n\tlen = MIN(count, ringbuf->in - ringbuf->out);\n\tif (!len)\n\t\treturn 0;\n\n\tringbuf->out += len;\n\n\tif (ringbuf->out == ringbuf->in) {\n\t\tringbuf->in = RINGBUF_RESET;\n\t\tringbuf->out = RINGBUF_RESET;\n\t}\n\n\treturn len;\n}",
          "includes": [
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <sys/param.h>",
            "#include <sys/uio.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define RINGBUF_RESET 0"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <sys/param.h>\n#include <sys/uio.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\n#define RINGBUF_RESET 0\n\nsize_t ringbuf_drain(struct ringbuf *ringbuf, size_t count)\n{\n\tsize_t len;\n\n\tif (!ringbuf)\n\t\treturn 0;\n\n\tlen = MIN(count, ringbuf->in - ringbuf->out);\n\tif (!len)\n\t\treturn 0;\n\n\tringbuf->out += len;\n\n\tif (ringbuf->out == ringbuf->in) {\n\t\tringbuf->in = RINGBUF_RESET;\n\t\tringbuf->out = RINGBUF_RESET;\n\t}\n\n\treturn len;\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_push_tail",
          "args": [
            "hfp->cmd_queue",
            "cmd"
          ],
          "line": 1425
        },
        "resolved": true,
        "details": {
          "function_name": "queue_push_tail",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "88-108",
          "snippet": "bool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "va_end",
          "args": [
            "ap"
          ],
          "line": 1413
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ringbuf_vprintf",
          "args": [
            "hfp->write_buf",
            "fmt",
            "ap"
          ],
          "line": 1412
        },
        "resolved": true,
        "details": {
          "function_name": "ringbuf_vprintf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ringbuf.c",
          "lines": "220-266",
          "snippet": "int ringbuf_vprintf(struct ringbuf *ringbuf, const char *format, va_list ap)\n{\n\tsize_t avail, offset, end;\n\tchar *str;\n\tint len;\n\n\tif (!ringbuf || !format)\n\t\treturn -1;\n\n\t/* Determine maximum length available for string */\n\tavail = ringbuf->size - ringbuf->in + ringbuf->out;\n\tif (!avail)\n\t\treturn -1;\n\n\tlen = vasprintf(&str, format, ap);\n\tif (len < 0)\n\t\treturn -1;\n\n\tif ((size_t) len > avail) {\n\t\tfree(str);\n\t\treturn -1;\n\t}\n\n\t/* Determine possible length of string before wrapping */\n\toffset = ringbuf->in & (ringbuf->size - 1);\n\tend = MIN((size_t) len, ringbuf->size - offset);\n\tmemcpy(ringbuf->buffer + offset, str, end);\n\n\tif (ringbuf->in_tracing)\n\t\tringbuf->in_tracing(ringbuf->buffer + offset, end,\n\t\t\t\t\t\t\tringbuf->in_data);\n\n\tif (len - end > 0) {\n\t\t/* Put the remainder of string at the beginning */\n\t\tmemcpy(ringbuf->buffer, str + end, len - end);\n\n\t\tif (ringbuf->in_tracing)\n\t\t\tringbuf->in_tracing(ringbuf->buffer, len - end,\n\t\t\t\t\t\t\tringbuf->in_data);\n\t}\n\n\tfree(str);\n\n\tringbuf->in += len;\n\n\treturn len;\n}",
          "includes": [
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <sys/param.h>",
            "#include <sys/uio.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <sys/param.h>\n#include <sys/uio.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nint ringbuf_vprintf(struct ringbuf *ringbuf, const char *format, va_list ap)\n{\n\tsize_t avail, offset, end;\n\tchar *str;\n\tint len;\n\n\tif (!ringbuf || !format)\n\t\treturn -1;\n\n\t/* Determine maximum length available for string */\n\tavail = ringbuf->size - ringbuf->in + ringbuf->out;\n\tif (!avail)\n\t\treturn -1;\n\n\tlen = vasprintf(&str, format, ap);\n\tif (len < 0)\n\t\treturn -1;\n\n\tif ((size_t) len > avail) {\n\t\tfree(str);\n\t\treturn -1;\n\t}\n\n\t/* Determine possible length of string before wrapping */\n\toffset = ringbuf->in & (ringbuf->size - 1);\n\tend = MIN((size_t) len, ringbuf->size - offset);\n\tmemcpy(ringbuf->buffer + offset, str, end);\n\n\tif (ringbuf->in_tracing)\n\t\tringbuf->in_tracing(ringbuf->buffer + offset, end,\n\t\t\t\t\t\t\tringbuf->in_data);\n\n\tif (len - end > 0) {\n\t\t/* Put the remainder of string at the beginning */\n\t\tmemcpy(ringbuf->buffer, str + end, len - end);\n\n\t\tif (ringbuf->in_tracing)\n\t\t\tringbuf->in_tracing(ringbuf->buffer, len - end,\n\t\t\t\t\t\t\tringbuf->in_data);\n\t}\n\n\tfree(str);\n\n\tringbuf->in += len;\n\n\treturn len;\n}"
        }
      },
      {
        "call_info": {
          "callee": "va_start",
          "args": [
            "ap",
            "format"
          ],
          "line": 1411
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "new0",
          "args": [
            "structcmd_response",
            "1"
          ],
          "line": 1409
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "asprintf",
          "args": [
            "&fmt",
            "\"%s\\r\"",
            "format"
          ],
          "line": 1406
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nbool hfp_hf_send_command(struct hfp_hf *hfp, hfp_response_func_t resp_cb,\n\t\t\t\tvoid *user_data, const char *format, ...)\n{\n\tva_list ap;\n\tchar *fmt;\n\tint len;\n\tstruct cmd_response *cmd;\n\n\tif (!hfp || !format || !resp_cb)\n\t\treturn false;\n\n\tif (asprintf(&fmt, \"%s\\r\", format) < 0)\n\t\treturn false;\n\n\tcmd = new0(struct cmd_response, 1);\n\n\tva_start(ap, format);\n\tlen = ringbuf_vprintf(hfp->write_buf, fmt, ap);\n\tva_end(ap);\n\n\tfree(fmt);\n\n\tif (len < 0) {\n\t\tfree(cmd);\n\t\treturn false;\n\t}\n\n\tcmd->resp_cb = resp_cb;\n\tcmd->user_data = user_data;\n\n\tif (!queue_push_tail(hfp->cmd_queue, cmd)) {\n\t\tringbuf_drain(hfp->write_buf, len);\n\t\tfree(cmd);\n\t\treturn false;\n\t}\n\n\thf_wakeup_writer(hfp);\n\n\treturn true;\n}"
  },
  {
    "function_name": "hfp_hf_set_close_on_unref",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "1385-1393",
    "snippet": "bool hfp_hf_set_close_on_unref(struct hfp_hf *hfp, bool do_close)\n{\n\tif (!hfp)\n\t\treturn false;\n\n\thfp->close_on_unref = do_close;\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nbool hfp_hf_set_close_on_unref(struct hfp_hf *hfp, bool do_close)\n{\n\tif (!hfp)\n\t\treturn false;\n\n\thfp->close_on_unref = do_close;\n\n\treturn true;\n}"
  },
  {
    "function_name": "hfp_hf_set_debug",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "1360-1383",
    "snippet": "bool hfp_hf_set_debug(struct hfp_hf *hfp, hfp_debug_func_t callback,\n\t\t\t\tvoid *user_data, hfp_destroy_func_t destroy)\n{\n\tif (!hfp)\n\t\treturn false;\n\n\tif (hfp->debug_destroy)\n\t\thfp->debug_destroy(hfp->debug_data);\n\n\thfp->debug_callback = callback;\n\thfp->debug_destroy = destroy;\n\thfp->debug_data = user_data;\n\n\tif (hfp->debug_callback) {\n\t\tringbuf_set_input_tracing(hfp->read_buf, hf_read_tracing, hfp);\n\t\tringbuf_set_input_tracing(hfp->write_buf, hf_write_tracing,\n\t\t\t\t\t\t\t\t\thfp);\n\t} else {\n\t\tringbuf_set_input_tracing(hfp->read_buf, NULL, NULL);\n\t\tringbuf_set_input_tracing(hfp->write_buf, NULL, NULL);\n\t}\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ringbuf_set_input_tracing",
          "args": [
            "hfp->write_buf",
            "NULL",
            "NULL"
          ],
          "line": 1379
        },
        "resolved": true,
        "details": {
          "function_name": "ringbuf_set_input_tracing",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ringbuf.c",
          "lines": "97-107",
          "snippet": "bool ringbuf_set_input_tracing(struct ringbuf *ringbuf,\n\t\t\tringbuf_tracing_func_t callback, void *user_data)\n{\n\tif (!ringbuf)\n\t\treturn false;\n\n\tringbuf->in_tracing = callback;\n\tringbuf->in_data = user_data;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <sys/param.h>",
            "#include <sys/uio.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <sys/param.h>\n#include <sys/uio.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nbool ringbuf_set_input_tracing(struct ringbuf *ringbuf,\n\t\t\tringbuf_tracing_func_t callback, void *user_data)\n{\n\tif (!ringbuf)\n\t\treturn false;\n\n\tringbuf->in_tracing = callback;\n\tringbuf->in_data = user_data;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "hfp->debug_destroy",
          "args": [
            "hfp->debug_data"
          ],
          "line": 1367
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nbool hfp_hf_set_debug(struct hfp_hf *hfp, hfp_debug_func_t callback,\n\t\t\t\tvoid *user_data, hfp_destroy_func_t destroy)\n{\n\tif (!hfp)\n\t\treturn false;\n\n\tif (hfp->debug_destroy)\n\t\thfp->debug_destroy(hfp->debug_data);\n\n\thfp->debug_callback = callback;\n\thfp->debug_destroy = destroy;\n\thfp->debug_data = user_data;\n\n\tif (hfp->debug_callback) {\n\t\tringbuf_set_input_tracing(hfp->read_buf, hf_read_tracing, hfp);\n\t\tringbuf_set_input_tracing(hfp->write_buf, hf_write_tracing,\n\t\t\t\t\t\t\t\t\thfp);\n\t} else {\n\t\tringbuf_set_input_tracing(hfp->read_buf, NULL, NULL);\n\t\tringbuf_set_input_tracing(hfp->write_buf, NULL, NULL);\n\t}\n\n\treturn true;\n}"
  },
  {
    "function_name": "hf_write_tracing",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "1352-1358",
    "snippet": "static void hf_write_tracing(const void *buf, size_t count,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct hfp_hf *hfp = user_data;\n\n\tutil_hexdump('<', buf, count, hfp->debug_callback, hfp->debug_data);\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "util_hexdump",
          "args": [
            "'<'",
            "buf",
            "count",
            "hfp->debug_callback",
            "hfp->debug_data"
          ],
          "line": 1357
        },
        "resolved": true,
        "details": {
          "function_name": "util_hexdump",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/util.c",
          "lines": "73-113",
          "snippet": "void util_hexdump(const char dir, const unsigned char *buf, size_t len,\n\t\t\t\tutil_debug_func_t function, void *user_data)\n{\n\tstatic const char hexdigits[] = \"0123456789abcdef\";\n\tchar str[68];\n\tsize_t i;\n\n\tif (!function || !len)\n\t\treturn;\n\n\tstr[0] = dir;\n\n\tfor (i = 0; i < len; i++) {\n\t\tstr[((i % 16) * 3) + 1] = ' ';\n\t\tstr[((i % 16) * 3) + 2] = hexdigits[buf[i] >> 4];\n\t\tstr[((i % 16) * 3) + 3] = hexdigits[buf[i] & 0xf];\n\t\tstr[(i % 16) + 51] = isprint(buf[i]) ? buf[i] : '.';\n\n\t\tif ((i + 1) % 16 == 0) {\n\t\t\tstr[49] = ' ';\n\t\t\tstr[50] = ' ';\n\t\t\tstr[67] = '\\0';\n\t\t\tfunction(str, user_data);\n\t\t\tstr[0] = ' ';\n\t\t}\n\t}\n\n\tif (i % 16 > 0) {\n\t\tsize_t j;\n\t\tfor (j = (i % 16); j < 16; j++) {\n\t\t\tstr[(j * 3) + 1] = ' ';\n\t\t\tstr[(j * 3) + 2] = ' ';\n\t\t\tstr[(j * 3) + 3] = ' ';\n\t\t\tstr[j + 51] = ' ';\n\t\t}\n\t\tstr[49] = ' ';\n\t\tstr[50] = ' ';\n\t\tstr[67] = '\\0';\n\t\tfunction(str, user_data);\n\t}\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include <string.h>",
            "#include <limits.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include <string.h>\n#include <limits.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid util_hexdump(const char dir, const unsigned char *buf, size_t len,\n\t\t\t\tutil_debug_func_t function, void *user_data)\n{\n\tstatic const char hexdigits[] = \"0123456789abcdef\";\n\tchar str[68];\n\tsize_t i;\n\n\tif (!function || !len)\n\t\treturn;\n\n\tstr[0] = dir;\n\n\tfor (i = 0; i < len; i++) {\n\t\tstr[((i % 16) * 3) + 1] = ' ';\n\t\tstr[((i % 16) * 3) + 2] = hexdigits[buf[i] >> 4];\n\t\tstr[((i % 16) * 3) + 3] = hexdigits[buf[i] & 0xf];\n\t\tstr[(i % 16) + 51] = isprint(buf[i]) ? buf[i] : '.';\n\n\t\tif ((i + 1) % 16 == 0) {\n\t\t\tstr[49] = ' ';\n\t\t\tstr[50] = ' ';\n\t\t\tstr[67] = '\\0';\n\t\t\tfunction(str, user_data);\n\t\t\tstr[0] = ' ';\n\t\t}\n\t}\n\n\tif (i % 16 > 0) {\n\t\tsize_t j;\n\t\tfor (j = (i % 16); j < 16; j++) {\n\t\t\tstr[(j * 3) + 1] = ' ';\n\t\t\tstr[(j * 3) + 2] = ' ';\n\t\t\tstr[(j * 3) + 3] = ' ';\n\t\t\tstr[j + 51] = ' ';\n\t\t}\n\t\tstr[49] = ' ';\n\t\tstr[50] = ' ';\n\t\tstr[67] = '\\0';\n\t\tfunction(str, user_data);\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void hf_write_tracing(const void *buf, size_t count,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct hfp_hf *hfp = user_data;\n\n\tutil_hexdump('<', buf, count, hfp->debug_callback, hfp->debug_data);\n}"
  },
  {
    "function_name": "hf_read_tracing",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "1344-1350",
    "snippet": "static void hf_read_tracing(const void *buf, size_t count,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct hfp_hf *hfp = user_data;\n\n\tutil_hexdump('>', buf, count, hfp->debug_callback, hfp->debug_data);\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "util_hexdump",
          "args": [
            "'>'",
            "buf",
            "count",
            "hfp->debug_callback",
            "hfp->debug_data"
          ],
          "line": 1349
        },
        "resolved": true,
        "details": {
          "function_name": "util_hexdump",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/util.c",
          "lines": "73-113",
          "snippet": "void util_hexdump(const char dir, const unsigned char *buf, size_t len,\n\t\t\t\tutil_debug_func_t function, void *user_data)\n{\n\tstatic const char hexdigits[] = \"0123456789abcdef\";\n\tchar str[68];\n\tsize_t i;\n\n\tif (!function || !len)\n\t\treturn;\n\n\tstr[0] = dir;\n\n\tfor (i = 0; i < len; i++) {\n\t\tstr[((i % 16) * 3) + 1] = ' ';\n\t\tstr[((i % 16) * 3) + 2] = hexdigits[buf[i] >> 4];\n\t\tstr[((i % 16) * 3) + 3] = hexdigits[buf[i] & 0xf];\n\t\tstr[(i % 16) + 51] = isprint(buf[i]) ? buf[i] : '.';\n\n\t\tif ((i + 1) % 16 == 0) {\n\t\t\tstr[49] = ' ';\n\t\t\tstr[50] = ' ';\n\t\t\tstr[67] = '\\0';\n\t\t\tfunction(str, user_data);\n\t\t\tstr[0] = ' ';\n\t\t}\n\t}\n\n\tif (i % 16 > 0) {\n\t\tsize_t j;\n\t\tfor (j = (i % 16); j < 16; j++) {\n\t\t\tstr[(j * 3) + 1] = ' ';\n\t\t\tstr[(j * 3) + 2] = ' ';\n\t\t\tstr[(j * 3) + 3] = ' ';\n\t\t\tstr[j + 51] = ' ';\n\t\t}\n\t\tstr[49] = ' ';\n\t\tstr[50] = ' ';\n\t\tstr[67] = '\\0';\n\t\tfunction(str, user_data);\n\t}\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include <string.h>",
            "#include <limits.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include <string.h>\n#include <limits.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid util_hexdump(const char dir, const unsigned char *buf, size_t len,\n\t\t\t\tutil_debug_func_t function, void *user_data)\n{\n\tstatic const char hexdigits[] = \"0123456789abcdef\";\n\tchar str[68];\n\tsize_t i;\n\n\tif (!function || !len)\n\t\treturn;\n\n\tstr[0] = dir;\n\n\tfor (i = 0; i < len; i++) {\n\t\tstr[((i % 16) * 3) + 1] = ' ';\n\t\tstr[((i % 16) * 3) + 2] = hexdigits[buf[i] >> 4];\n\t\tstr[((i % 16) * 3) + 3] = hexdigits[buf[i] & 0xf];\n\t\tstr[(i % 16) + 51] = isprint(buf[i]) ? buf[i] : '.';\n\n\t\tif ((i + 1) % 16 == 0) {\n\t\t\tstr[49] = ' ';\n\t\t\tstr[50] = ' ';\n\t\t\tstr[67] = '\\0';\n\t\t\tfunction(str, user_data);\n\t\t\tstr[0] = ' ';\n\t\t}\n\t}\n\n\tif (i % 16 > 0) {\n\t\tsize_t j;\n\t\tfor (j = (i % 16); j < 16; j++) {\n\t\t\tstr[(j * 3) + 1] = ' ';\n\t\t\tstr[(j * 3) + 2] = ' ';\n\t\t\tstr[(j * 3) + 3] = ' ';\n\t\t\tstr[j + 51] = ' ';\n\t\t}\n\t\tstr[49] = ' ';\n\t\tstr[50] = ' ';\n\t\tstr[67] = '\\0';\n\t\tfunction(str, user_data);\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void hf_read_tracing(const void *buf, size_t count,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct hfp_hf *hfp = user_data;\n\n\tutil_hexdump('>', buf, count, hfp->debug_callback, hfp->debug_data);\n}"
  },
  {
    "function_name": "hfp_hf_unref",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "1304-1342",
    "snippet": "void hfp_hf_unref(struct hfp_hf *hfp)\n{\n\tif (!hfp)\n\t\treturn;\n\n\tif (__sync_sub_and_fetch(&hfp->ref_count, 1))\n\t\treturn;\n\n\tio_set_write_handler(hfp->io, NULL, NULL, NULL);\n\tio_set_read_handler(hfp->io, NULL, NULL, NULL);\n\tio_set_disconnect_handler(hfp->io, NULL, NULL, NULL);\n\n\tio_destroy(hfp->io);\n\thfp->io = NULL;\n\n\tif (hfp->close_on_unref)\n\t\tclose(hfp->fd);\n\n\thfp_hf_set_debug(hfp, NULL, NULL, NULL);\n\n\tringbuf_free(hfp->read_buf);\n\thfp->read_buf = NULL;\n\n\tringbuf_free(hfp->write_buf);\n\thfp->write_buf = NULL;\n\n\tqueue_destroy(hfp->event_handlers, destroy_event_handler);\n\thfp->event_handlers = NULL;\n\n\tqueue_destroy(hfp->cmd_queue, free);\n\thfp->cmd_queue = NULL;\n\n\tif (!hfp->in_disconnect) {\n\t\tfree(hfp);\n\t\treturn;\n\t}\n\n\thfp->destroyed = true;\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "hfp"
          ],
          "line": 1337
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "956-985",
          "snippet": "static void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_destroy",
          "args": [
            "hfp->cmd_queue",
            "free"
          ],
          "line": 1333
        },
        "resolved": true,
        "details": {
          "function_name": "queue_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "68-76",
          "snippet": "void queue_destroy(struct queue *queue, queue_destroy_func_t destroy)\n{\n\tif (!queue)\n\t\treturn;\n\n\tqueue_remove_all(queue, NULL, NULL, destroy);\n\n\tqueue_unref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid queue_destroy(struct queue *queue, queue_destroy_func_t destroy)\n{\n\tif (!queue)\n\t\treturn;\n\n\tqueue_remove_all(queue, NULL, NULL, destroy);\n\n\tqueue_unref(queue);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ringbuf_free",
          "args": [
            "hfp->write_buf"
          ],
          "line": 1327
        },
        "resolved": true,
        "details": {
          "function_name": "ringbuf_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ringbuf.c",
          "lines": "88-95",
          "snippet": "void ringbuf_free(struct ringbuf *ringbuf)\n{\n\tif (!ringbuf)\n\t\treturn;\n\n\tfree(ringbuf->buffer);\n\tfree(ringbuf);\n}",
          "includes": [
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <sys/param.h>",
            "#include <sys/uio.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <sys/param.h>\n#include <sys/uio.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid ringbuf_free(struct ringbuf *ringbuf)\n{\n\tif (!ringbuf)\n\t\treturn;\n\n\tfree(ringbuf->buffer);\n\tfree(ringbuf);\n}"
        }
      },
      {
        "call_info": {
          "callee": "hfp_hf_set_debug",
          "args": [
            "hfp",
            "NULL",
            "NULL",
            "NULL"
          ],
          "line": 1322
        },
        "resolved": true,
        "details": {
          "function_name": "hfp_hf_set_debug",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
          "lines": "1360-1383",
          "snippet": "bool hfp_hf_set_debug(struct hfp_hf *hfp, hfp_debug_func_t callback,\n\t\t\t\tvoid *user_data, hfp_destroy_func_t destroy)\n{\n\tif (!hfp)\n\t\treturn false;\n\n\tif (hfp->debug_destroy)\n\t\thfp->debug_destroy(hfp->debug_data);\n\n\thfp->debug_callback = callback;\n\thfp->debug_destroy = destroy;\n\thfp->debug_data = user_data;\n\n\tif (hfp->debug_callback) {\n\t\tringbuf_set_input_tracing(hfp->read_buf, hf_read_tracing, hfp);\n\t\tringbuf_set_input_tracing(hfp->write_buf, hf_write_tracing,\n\t\t\t\t\t\t\t\t\thfp);\n\t} else {\n\t\tringbuf_set_input_tracing(hfp->read_buf, NULL, NULL);\n\t\tringbuf_set_input_tracing(hfp->write_buf, NULL, NULL);\n\t}\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/hfp.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <ctype.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nbool hfp_hf_set_debug(struct hfp_hf *hfp, hfp_debug_func_t callback,\n\t\t\t\tvoid *user_data, hfp_destroy_func_t destroy)\n{\n\tif (!hfp)\n\t\treturn false;\n\n\tif (hfp->debug_destroy)\n\t\thfp->debug_destroy(hfp->debug_data);\n\n\thfp->debug_callback = callback;\n\thfp->debug_destroy = destroy;\n\thfp->debug_data = user_data;\n\n\tif (hfp->debug_callback) {\n\t\tringbuf_set_input_tracing(hfp->read_buf, hf_read_tracing, hfp);\n\t\tringbuf_set_input_tracing(hfp->write_buf, hf_write_tracing,\n\t\t\t\t\t\t\t\t\thfp);\n\t} else {\n\t\tringbuf_set_input_tracing(hfp->read_buf, NULL, NULL);\n\t\tringbuf_set_input_tracing(hfp->write_buf, NULL, NULL);\n\t}\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "close",
          "args": [
            "hfp->fd"
          ],
          "line": 1320
        },
        "resolved": true,
        "details": {
          "function_name": "hfp_context_close_container",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
          "lines": "334-347",
          "snippet": "bool hfp_context_close_container(struct hfp_context *context)\n{\n\tskip_whitespace(context);\n\n\t/* The list shall be followed by a right parenthesis (\")\" V250 5.7.3.1*/\n\tif (context->data[context->offset] != ')')\n\t\treturn false;\n\n\tcontext->offset++;\n\n\tnext_field(context);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/hfp.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <ctype.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nbool hfp_context_close_container(struct hfp_context *context)\n{\n\tskip_whitespace(context);\n\n\t/* The list shall be followed by a right parenthesis (\")\" V250 5.7.3.1*/\n\tif (context->data[context->offset] != ')')\n\t\treturn false;\n\n\tcontext->offset++;\n\n\tnext_field(context);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "io_destroy",
          "args": [
            "hfp->io"
          ],
          "line": 1316
        },
        "resolved": true,
        "details": {
          "function_name": "io_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-glib.c",
          "lines": "111-135",
          "snippet": "void io_destroy(struct io *io)\n{\n\tif (!io)\n\t\treturn;\n\n\tif (io->read_watch) {\n\t\tg_source_remove(io->read_watch->id);\n\t\tio->read_watch = NULL;\n\t}\n\n\tif (io->write_watch) {\n\t\tg_source_remove(io->write_watch->id);\n\t\tio->write_watch = NULL;\n\t}\n\n\tif (io->disconnect_watch) {\n\t\tg_source_remove(io->disconnect_watch->id);\n\t\tio->disconnect_watch = NULL;\n\t}\n\n\tg_io_channel_unref(io->channel);\n\tio->channel = NULL;\n\n\tio_unref(io);\n}",
          "includes": [
            "#include \"src/shared/io.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/io.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nvoid io_destroy(struct io *io)\n{\n\tif (!io)\n\t\treturn;\n\n\tif (io->read_watch) {\n\t\tg_source_remove(io->read_watch->id);\n\t\tio->read_watch = NULL;\n\t}\n\n\tif (io->write_watch) {\n\t\tg_source_remove(io->write_watch->id);\n\t\tio->write_watch = NULL;\n\t}\n\n\tif (io->disconnect_watch) {\n\t\tg_source_remove(io->disconnect_watch->id);\n\t\tio->disconnect_watch = NULL;\n\t}\n\n\tg_io_channel_unref(io->channel);\n\tio->channel = NULL;\n\n\tio_unref(io);\n}"
        }
      },
      {
        "call_info": {
          "callee": "io_set_disconnect_handler",
          "args": [
            "hfp->io",
            "NULL",
            "NULL",
            "NULL"
          ],
          "line": 1314
        },
        "resolved": true,
        "details": {
          "function_name": "io_set_disconnect_handler",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-glib.c",
          "lines": "260-264",
          "snippet": "bool io_set_disconnect_handler(struct io *io, io_callback_func_t callback,\n\t\t\t\tvoid *user_data, io_destroy_func_t destroy)\n{\n\treturn io_set_handler(io, G_IO_HUP, callback, user_data, destroy);\n}",
          "includes": [
            "#include \"src/shared/io.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/io.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nbool io_set_disconnect_handler(struct io *io, io_callback_func_t callback,\n\t\t\t\tvoid *user_data, io_destroy_func_t destroy)\n{\n\treturn io_set_handler(io, G_IO_HUP, callback, user_data, destroy);\n}"
        }
      },
      {
        "call_info": {
          "callee": "io_set_read_handler",
          "args": [
            "hfp->io",
            "NULL",
            "NULL",
            "NULL"
          ],
          "line": 1313
        },
        "resolved": true,
        "details": {
          "function_name": "io_set_read_handler",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-glib.c",
          "lines": "248-252",
          "snippet": "bool io_set_read_handler(struct io *io, io_callback_func_t callback,\n\t\t\t\tvoid *user_data, io_destroy_func_t destroy)\n{\n\treturn io_set_handler(io, G_IO_IN, callback, user_data, destroy);\n}",
          "includes": [
            "#include \"src/shared/io.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/io.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nbool io_set_read_handler(struct io *io, io_callback_func_t callback,\n\t\t\t\tvoid *user_data, io_destroy_func_t destroy)\n{\n\treturn io_set_handler(io, G_IO_IN, callback, user_data, destroy);\n}"
        }
      },
      {
        "call_info": {
          "callee": "io_set_write_handler",
          "args": [
            "hfp->io",
            "NULL",
            "NULL",
            "NULL"
          ],
          "line": 1312
        },
        "resolved": true,
        "details": {
          "function_name": "io_set_write_handler",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-glib.c",
          "lines": "254-258",
          "snippet": "bool io_set_write_handler(struct io *io, io_callback_func_t callback,\n\t\t\t\tvoid *user_data, io_destroy_func_t destroy)\n{\n\treturn io_set_handler(io, G_IO_OUT, callback, user_data, destroy);\n}",
          "includes": [
            "#include \"src/shared/io.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/io.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nbool io_set_write_handler(struct io *io, io_callback_func_t callback,\n\t\t\t\tvoid *user_data, io_destroy_func_t destroy)\n{\n\treturn io_set_handler(io, G_IO_OUT, callback, user_data, destroy);\n}"
        }
      },
      {
        "call_info": {
          "callee": "__sync_sub_and_fetch",
          "args": [
            "&hfp->ref_count",
            "1"
          ],
          "line": 1309
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid hfp_hf_unref(struct hfp_hf *hfp)\n{\n\tif (!hfp)\n\t\treturn;\n\n\tif (__sync_sub_and_fetch(&hfp->ref_count, 1))\n\t\treturn;\n\n\tio_set_write_handler(hfp->io, NULL, NULL, NULL);\n\tio_set_read_handler(hfp->io, NULL, NULL, NULL);\n\tio_set_disconnect_handler(hfp->io, NULL, NULL, NULL);\n\n\tio_destroy(hfp->io);\n\thfp->io = NULL;\n\n\tif (hfp->close_on_unref)\n\t\tclose(hfp->fd);\n\n\thfp_hf_set_debug(hfp, NULL, NULL, NULL);\n\n\tringbuf_free(hfp->read_buf);\n\thfp->read_buf = NULL;\n\n\tringbuf_free(hfp->write_buf);\n\thfp->write_buf = NULL;\n\n\tqueue_destroy(hfp->event_handlers, destroy_event_handler);\n\thfp->event_handlers = NULL;\n\n\tqueue_destroy(hfp->cmd_queue, free);\n\thfp->cmd_queue = NULL;\n\n\tif (!hfp->in_disconnect) {\n\t\tfree(hfp);\n\t\treturn;\n\t}\n\n\thfp->destroyed = true;\n}"
  },
  {
    "function_name": "hfp_hf_ref",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "1294-1302",
    "snippet": "struct hfp_hf *hfp_hf_ref(struct hfp_hf *hfp)\n{\n\tif (!hfp)\n\t\treturn NULL;\n\n\t__sync_fetch_and_add(&hfp->ref_count, 1);\n\n\treturn hfp;\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "__sync_fetch_and_add",
          "args": [
            "&hfp->ref_count",
            "1"
          ],
          "line": 1299
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstruct hfp_hf *hfp_hf_ref(struct hfp_hf *hfp)\n{\n\tif (!hfp)\n\t\treturn NULL;\n\n\t__sync_fetch_and_add(&hfp->ref_count, 1);\n\n\treturn hfp;\n}"
  },
  {
    "function_name": "hfp_hf_new",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "1244-1292",
    "snippet": "struct hfp_hf *hfp_hf_new(int fd)\n{\n\tstruct hfp_hf *hfp;\n\n\tif (fd < 0)\n\t\treturn NULL;\n\n\thfp = new0(struct hfp_hf, 1);\n\thfp->fd = fd;\n\thfp->close_on_unref = false;\n\n\thfp->read_buf = ringbuf_new(4096);\n\tif (!hfp->read_buf) {\n\t\tfree(hfp);\n\t\treturn NULL;\n\t}\n\n\thfp->write_buf = ringbuf_new(4096);\n\tif (!hfp->write_buf) {\n\t\tringbuf_free(hfp->read_buf);\n\t\tfree(hfp);\n\t\treturn NULL;\n\t}\n\n\thfp->io = io_new(fd);\n\tif (!hfp->io) {\n\t\tringbuf_free(hfp->write_buf);\n\t\tringbuf_free(hfp->read_buf);\n\t\tfree(hfp);\n\t\treturn NULL;\n\t}\n\n\thfp->event_handlers = queue_new();\n\thfp->cmd_queue = queue_new();\n\thfp->writer_active = false;\n\n\tif (!io_set_read_handler(hfp->io, hf_can_read_data, hfp,\n\t\t\t\t\t\t\tread_watch_destroy)) {\n\t\tqueue_destroy(hfp->event_handlers,\n\t\t\t\t\t\tdestroy_event_handler);\n\t\tio_destroy(hfp->io);\n\t\tringbuf_free(hfp->write_buf);\n\t\tringbuf_free(hfp->read_buf);\n\t\tfree(hfp);\n\t\treturn NULL;\n\t}\n\n\treturn hfp_hf_ref(hfp);\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "hfp_hf_ref",
          "args": [
            "hfp"
          ],
          "line": 1291
        },
        "resolved": true,
        "details": {
          "function_name": "hfp_hf_ref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
          "lines": "1294-1302",
          "snippet": "struct hfp_hf *hfp_hf_ref(struct hfp_hf *hfp)\n{\n\tif (!hfp)\n\t\treturn NULL;\n\n\t__sync_fetch_and_add(&hfp->ref_count, 1);\n\n\treturn hfp;\n}",
          "includes": [
            "#include \"src/shared/hfp.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <ctype.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstruct hfp_hf *hfp_hf_ref(struct hfp_hf *hfp)\n{\n\tif (!hfp)\n\t\treturn NULL;\n\n\t__sync_fetch_and_add(&hfp->ref_count, 1);\n\n\treturn hfp;\n}"
        }
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "hfp"
          ],
          "line": 1287
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "956-985",
          "snippet": "static void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ringbuf_free",
          "args": [
            "hfp->read_buf"
          ],
          "line": 1286
        },
        "resolved": true,
        "details": {
          "function_name": "ringbuf_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ringbuf.c",
          "lines": "88-95",
          "snippet": "void ringbuf_free(struct ringbuf *ringbuf)\n{\n\tif (!ringbuf)\n\t\treturn;\n\n\tfree(ringbuf->buffer);\n\tfree(ringbuf);\n}",
          "includes": [
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <sys/param.h>",
            "#include <sys/uio.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <sys/param.h>\n#include <sys/uio.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid ringbuf_free(struct ringbuf *ringbuf)\n{\n\tif (!ringbuf)\n\t\treturn;\n\n\tfree(ringbuf->buffer);\n\tfree(ringbuf);\n}"
        }
      },
      {
        "call_info": {
          "callee": "io_destroy",
          "args": [
            "hfp->io"
          ],
          "line": 1284
        },
        "resolved": true,
        "details": {
          "function_name": "io_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-glib.c",
          "lines": "111-135",
          "snippet": "void io_destroy(struct io *io)\n{\n\tif (!io)\n\t\treturn;\n\n\tif (io->read_watch) {\n\t\tg_source_remove(io->read_watch->id);\n\t\tio->read_watch = NULL;\n\t}\n\n\tif (io->write_watch) {\n\t\tg_source_remove(io->write_watch->id);\n\t\tio->write_watch = NULL;\n\t}\n\n\tif (io->disconnect_watch) {\n\t\tg_source_remove(io->disconnect_watch->id);\n\t\tio->disconnect_watch = NULL;\n\t}\n\n\tg_io_channel_unref(io->channel);\n\tio->channel = NULL;\n\n\tio_unref(io);\n}",
          "includes": [
            "#include \"src/shared/io.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/io.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nvoid io_destroy(struct io *io)\n{\n\tif (!io)\n\t\treturn;\n\n\tif (io->read_watch) {\n\t\tg_source_remove(io->read_watch->id);\n\t\tio->read_watch = NULL;\n\t}\n\n\tif (io->write_watch) {\n\t\tg_source_remove(io->write_watch->id);\n\t\tio->write_watch = NULL;\n\t}\n\n\tif (io->disconnect_watch) {\n\t\tg_source_remove(io->disconnect_watch->id);\n\t\tio->disconnect_watch = NULL;\n\t}\n\n\tg_io_channel_unref(io->channel);\n\tio->channel = NULL;\n\n\tio_unref(io);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_destroy",
          "args": [
            "hfp->event_handlers",
            "destroy_event_handler"
          ],
          "line": 1282
        },
        "resolved": true,
        "details": {
          "function_name": "queue_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "68-76",
          "snippet": "void queue_destroy(struct queue *queue, queue_destroy_func_t destroy)\n{\n\tif (!queue)\n\t\treturn;\n\n\tqueue_remove_all(queue, NULL, NULL, destroy);\n\n\tqueue_unref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid queue_destroy(struct queue *queue, queue_destroy_func_t destroy)\n{\n\tif (!queue)\n\t\treturn;\n\n\tqueue_remove_all(queue, NULL, NULL, destroy);\n\n\tqueue_unref(queue);\n}"
        }
      },
      {
        "call_info": {
          "callee": "io_set_read_handler",
          "args": [
            "hfp->io",
            "hf_can_read_data",
            "hfp",
            "read_watch_destroy"
          ],
          "line": 1280
        },
        "resolved": true,
        "details": {
          "function_name": "io_set_read_handler",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-glib.c",
          "lines": "248-252",
          "snippet": "bool io_set_read_handler(struct io *io, io_callback_func_t callback,\n\t\t\t\tvoid *user_data, io_destroy_func_t destroy)\n{\n\treturn io_set_handler(io, G_IO_IN, callback, user_data, destroy);\n}",
          "includes": [
            "#include \"src/shared/io.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/io.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nbool io_set_read_handler(struct io *io, io_callback_func_t callback,\n\t\t\t\tvoid *user_data, io_destroy_func_t destroy)\n{\n\treturn io_set_handler(io, G_IO_IN, callback, user_data, destroy);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_new",
          "args": [],
          "line": 1277
        },
        "resolved": true,
        "details": {
          "function_name": "queue_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "56-66",
          "snippet": "struct queue *queue_new(void)\n{\n\tstruct queue *queue;\n\n\tqueue = new0(struct queue, 1);\n\tqueue->head = NULL;\n\tqueue->tail = NULL;\n\tqueue->entries = 0;\n\n\treturn queue_ref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nstruct queue *queue_new(void)\n{\n\tstruct queue *queue;\n\n\tqueue = new0(struct queue, 1);\n\tqueue->head = NULL;\n\tqueue->tail = NULL;\n\tqueue->entries = 0;\n\n\treturn queue_ref(queue);\n}"
        }
      },
      {
        "call_info": {
          "callee": "io_new",
          "args": [
            "fd"
          ],
          "line": 1268
        },
        "resolved": true,
        "details": {
          "function_name": "io_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-glib.c",
          "lines": "71-90",
          "snippet": "struct io *io_new(int fd)\n{\n\tstruct io *io;\n\n\tif (fd < 0)\n\t\treturn NULL;\n\n\tio = g_try_new0(struct io, 1);\n\tif (!io)\n\t\treturn NULL;\n\n\tio->channel = g_io_channel_unix_new(fd);\n\n\tg_io_channel_set_encoding(io->channel, NULL, NULL);\n\tg_io_channel_set_buffered(io->channel, FALSE);\n\n\tg_io_channel_set_close_on_unref(io->channel, FALSE);\n\n\treturn io_ref(io);\n}",
          "includes": [
            "#include \"src/shared/io.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/io.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nstruct io *io_new(int fd)\n{\n\tstruct io *io;\n\n\tif (fd < 0)\n\t\treturn NULL;\n\n\tio = g_try_new0(struct io, 1);\n\tif (!io)\n\t\treturn NULL;\n\n\tio->channel = g_io_channel_unix_new(fd);\n\n\tg_io_channel_set_encoding(io->channel, NULL, NULL);\n\tg_io_channel_set_buffered(io->channel, FALSE);\n\n\tg_io_channel_set_close_on_unref(io->channel, FALSE);\n\n\treturn io_ref(io);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ringbuf_new",
          "args": [
            "4096"
          ],
          "line": 1261
        },
        "resolved": true,
        "details": {
          "function_name": "ringbuf_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ringbuf.c",
          "lines": "63-86",
          "snippet": "struct ringbuf *ringbuf_new(size_t size)\n{\n\tstruct ringbuf *ringbuf;\n\tsize_t real_size;\n\n\tif (size < 2 || size > UINT_MAX)\n\t\treturn NULL;\n\n\t/* Find the next power of two for size */\n\treal_size = align_power2(size);\n\n\tringbuf = new0(struct ringbuf, 1);\n\tringbuf->buffer = malloc(real_size);\n\tif (!ringbuf->buffer) {\n\t\tfree(ringbuf);\n\t\treturn NULL;\n\t}\n\n\tringbuf->size = real_size;\n\tringbuf->in = RINGBUF_RESET;\n\tringbuf->out = RINGBUF_RESET;\n\n\treturn ringbuf;\n}",
          "includes": [
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <sys/param.h>",
            "#include <sys/uio.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define RINGBUF_RESET 0"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <sys/param.h>\n#include <sys/uio.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\n#define RINGBUF_RESET 0\n\nstruct ringbuf *ringbuf_new(size_t size)\n{\n\tstruct ringbuf *ringbuf;\n\tsize_t real_size;\n\n\tif (size < 2 || size > UINT_MAX)\n\t\treturn NULL;\n\n\t/* Find the next power of two for size */\n\treal_size = align_power2(size);\n\n\tringbuf = new0(struct ringbuf, 1);\n\tringbuf->buffer = malloc(real_size);\n\tif (!ringbuf->buffer) {\n\t\tfree(ringbuf);\n\t\treturn NULL;\n\t}\n\n\tringbuf->size = real_size;\n\tringbuf->in = RINGBUF_RESET;\n\tringbuf->out = RINGBUF_RESET;\n\n\treturn ringbuf;\n}"
        }
      },
      {
        "call_info": {
          "callee": "new0",
          "args": [
            "structhfp_hf",
            "1"
          ],
          "line": 1251
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstruct hfp_hf *hfp_hf_new(int fd)\n{\n\tstruct hfp_hf *hfp;\n\n\tif (fd < 0)\n\t\treturn NULL;\n\n\thfp = new0(struct hfp_hf, 1);\n\thfp->fd = fd;\n\thfp->close_on_unref = false;\n\n\thfp->read_buf = ringbuf_new(4096);\n\tif (!hfp->read_buf) {\n\t\tfree(hfp);\n\t\treturn NULL;\n\t}\n\n\thfp->write_buf = ringbuf_new(4096);\n\tif (!hfp->write_buf) {\n\t\tringbuf_free(hfp->read_buf);\n\t\tfree(hfp);\n\t\treturn NULL;\n\t}\n\n\thfp->io = io_new(fd);\n\tif (!hfp->io) {\n\t\tringbuf_free(hfp->write_buf);\n\t\tringbuf_free(hfp->read_buf);\n\t\tfree(hfp);\n\t\treturn NULL;\n\t}\n\n\thfp->event_handlers = queue_new();\n\thfp->cmd_queue = queue_new();\n\thfp->writer_active = false;\n\n\tif (!io_set_read_handler(hfp->io, hf_can_read_data, hfp,\n\t\t\t\t\t\t\tread_watch_destroy)) {\n\t\tqueue_destroy(hfp->event_handlers,\n\t\t\t\t\t\tdestroy_event_handler);\n\t\tio_destroy(hfp->io);\n\t\tringbuf_free(hfp->write_buf);\n\t\tringbuf_free(hfp->read_buf);\n\t\tfree(hfp);\n\t\treturn NULL;\n\t}\n\n\treturn hfp_hf_ref(hfp);\n}"
  },
  {
    "function_name": "hf_can_read_data",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "1230-1242",
    "snippet": "static bool hf_can_read_data(struct io *io, void *user_data)\n{\n\tstruct hfp_hf *hfp = user_data;\n\tssize_t bytes_read;\n\n\tbytes_read = ringbuf_read(hfp->read_buf, hfp->fd);\n\tif (bytes_read < 0)\n\t\treturn false;\n\n\thf_process_input(hfp);\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "hf_process_input",
          "args": [
            "hfp"
          ],
          "line": 1239
        },
        "resolved": true,
        "details": {
          "function_name": "hf_process_input",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
          "lines": "1155-1228",
          "snippet": "static void hf_process_input(struct hfp_hf *hfp)\n{\n\tchar *str, *ptr, *str2, *tmp;\n\tsize_t len, count, offset, len2;\n\tbool free_tmp = false;\n\n\tstr = ringbuf_peek(hfp->read_buf, 0, &len);\n\tif (!str)\n\t\treturn;\n\n\toffset = 0;\n\n\tptr = find_cr_lf(str, len);\n\twhile (ptr) {\n\t\tcount = ptr - (str + offset);\n\t\tif (count == 0) {\n\t\t\t/* 2 is for <cr><lf> */\n\t\t\toffset += 2;\n\t\t} else {\n\t\t\t*ptr = '\\0';\n\t\t\thf_call_prefix_handler(hfp, str + offset);\n\t\t\toffset += count + 2;\n\t\t}\n\n\t\tptr = find_cr_lf(str + offset, len - offset);\n\t}\n\n\t/*\n\t * Just check if there is no wrapped data in ring buffer.\n\t * Should not happen too often\n\t */\n\tif (len == ringbuf_len(hfp->read_buf))\n\t\tgoto done;\n\n\tstr2 = ringbuf_peek(hfp->read_buf, len, &len2);\n\tif (!str2)\n\t\tgoto done;\n\n\tptr = find_cr_lf(str2, len2);\n\tif (!ptr) {\n\t\t/* Might happen that we wrap between \\r and \\n */\n\t\tptr = memchr(str2, '\\n', len2);\n\t\tif (!ptr)\n\t\t\tgoto done;\n\t}\n\n\tcount = ptr - str2;\n\n\tif (count) {\n\t\t*ptr = '\\0';\n\n\t\ttmp = malloc(len + count);\n\t\tif (!tmp)\n\t\t\tgoto done;\n\n\t\t/* \"str\" here is not a string so we need to use memcpy */\n\t\tmemcpy(tmp, str, len);\n\t\tmemcpy(tmp + len, str2, count);\n\n\t\tfree_tmp = true;\n\t} else {\n\t\tstr[len-1] = '\\0';\n\t\ttmp = str;\n\t}\n\n\thf_call_prefix_handler(hfp, tmp);\n\toffset += count;\n\ndone:\n\tringbuf_drain(hfp->read_buf, offset);\n\n\tif (free_tmp)\n\t\tfree(tmp);\n}",
          "includes": [
            "#include \"src/shared/hfp.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <ctype.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void hf_process_input(struct hfp_hf *hfp)\n{\n\tchar *str, *ptr, *str2, *tmp;\n\tsize_t len, count, offset, len2;\n\tbool free_tmp = false;\n\n\tstr = ringbuf_peek(hfp->read_buf, 0, &len);\n\tif (!str)\n\t\treturn;\n\n\toffset = 0;\n\n\tptr = find_cr_lf(str, len);\n\twhile (ptr) {\n\t\tcount = ptr - (str + offset);\n\t\tif (count == 0) {\n\t\t\t/* 2 is for <cr><lf> */\n\t\t\toffset += 2;\n\t\t} else {\n\t\t\t*ptr = '\\0';\n\t\t\thf_call_prefix_handler(hfp, str + offset);\n\t\t\toffset += count + 2;\n\t\t}\n\n\t\tptr = find_cr_lf(str + offset, len - offset);\n\t}\n\n\t/*\n\t * Just check if there is no wrapped data in ring buffer.\n\t * Should not happen too often\n\t */\n\tif (len == ringbuf_len(hfp->read_buf))\n\t\tgoto done;\n\n\tstr2 = ringbuf_peek(hfp->read_buf, len, &len2);\n\tif (!str2)\n\t\tgoto done;\n\n\tptr = find_cr_lf(str2, len2);\n\tif (!ptr) {\n\t\t/* Might happen that we wrap between \\r and \\n */\n\t\tptr = memchr(str2, '\\n', len2);\n\t\tif (!ptr)\n\t\t\tgoto done;\n\t}\n\n\tcount = ptr - str2;\n\n\tif (count) {\n\t\t*ptr = '\\0';\n\n\t\ttmp = malloc(len + count);\n\t\tif (!tmp)\n\t\t\tgoto done;\n\n\t\t/* \"str\" here is not a string so we need to use memcpy */\n\t\tmemcpy(tmp, str, len);\n\t\tmemcpy(tmp + len, str2, count);\n\n\t\tfree_tmp = true;\n\t} else {\n\t\tstr[len-1] = '\\0';\n\t\ttmp = str;\n\t}\n\n\thf_call_prefix_handler(hfp, tmp);\n\toffset += count;\n\ndone:\n\tringbuf_drain(hfp->read_buf, offset);\n\n\tif (free_tmp)\n\t\tfree(tmp);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ringbuf_read",
          "args": [
            "hfp->read_buf",
            "hfp->fd"
          ],
          "line": 1235
        },
        "resolved": true,
        "details": {
          "function_name": "ringbuf_read",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ringbuf.c",
          "lines": "268-309",
          "snippet": "ssize_t ringbuf_read(struct ringbuf *ringbuf, int fd)\n{\n\tsize_t avail, offset, end;\n\tstruct iovec iov[2];\n\tssize_t consumed;\n\n\tif (!ringbuf || fd < 0)\n\t\treturn -1;\n\n\t/* Determine how much can actually be consumed */\n\tavail = ringbuf->size - ringbuf->in + ringbuf->out;\n\tif (!avail)\n\t\treturn -1;\n\n\t/* Determine how much to consume before wrapping */\n\toffset = ringbuf->in & (ringbuf->size - 1);\n\tend = MIN(avail, ringbuf->size - offset);\n\n\tiov[0].iov_base = ringbuf->buffer + offset;\n\tiov[0].iov_len = end;\n\n\t/* Now put the remainder into the second vector */\n\tiov[1].iov_base = ringbuf->buffer;\n\tiov[1].iov_len = avail - end;\n\n\tconsumed = readv(fd, iov, 2);\n\tif (consumed < 0)\n\t\treturn -1;\n\n\tif (ringbuf->in_tracing) {\n\t\tsize_t len = MIN((size_t) consumed, end);\n\t\tringbuf->in_tracing(ringbuf->buffer + offset, len,\n\t\t\t\t\t\t\tringbuf->in_data);\n\t\tif (consumed - len > 0)\n\t\t\tringbuf->in_tracing(ringbuf->buffer, consumed - len,\n\t\t\t\t\t\t\tringbuf->in_data);\n\t}\n\n\tringbuf->in += consumed;\n\n\treturn consumed;\n}",
          "includes": [
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <sys/param.h>",
            "#include <sys/uio.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <sys/param.h>\n#include <sys/uio.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nssize_t ringbuf_read(struct ringbuf *ringbuf, int fd)\n{\n\tsize_t avail, offset, end;\n\tstruct iovec iov[2];\n\tssize_t consumed;\n\n\tif (!ringbuf || fd < 0)\n\t\treturn -1;\n\n\t/* Determine how much can actually be consumed */\n\tavail = ringbuf->size - ringbuf->in + ringbuf->out;\n\tif (!avail)\n\t\treturn -1;\n\n\t/* Determine how much to consume before wrapping */\n\toffset = ringbuf->in & (ringbuf->size - 1);\n\tend = MIN(avail, ringbuf->size - offset);\n\n\tiov[0].iov_base = ringbuf->buffer + offset;\n\tiov[0].iov_len = end;\n\n\t/* Now put the remainder into the second vector */\n\tiov[1].iov_base = ringbuf->buffer;\n\tiov[1].iov_len = avail - end;\n\n\tconsumed = readv(fd, iov, 2);\n\tif (consumed < 0)\n\t\treturn -1;\n\n\tif (ringbuf->in_tracing) {\n\t\tsize_t len = MIN((size_t) consumed, end);\n\t\tringbuf->in_tracing(ringbuf->buffer + offset, len,\n\t\t\t\t\t\t\tringbuf->in_data);\n\t\tif (consumed - len > 0)\n\t\t\tringbuf->in_tracing(ringbuf->buffer, consumed - len,\n\t\t\t\t\t\t\tringbuf->in_data);\n\t}\n\n\tringbuf->in += consumed;\n\n\treturn consumed;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic bool hf_can_read_data(struct io *io, void *user_data)\n{\n\tstruct hfp_hf *hfp = user_data;\n\tssize_t bytes_read;\n\n\tbytes_read = ringbuf_read(hfp->read_buf, hfp->fd);\n\tif (bytes_read < 0)\n\t\treturn false;\n\n\thf_process_input(hfp);\n\n\treturn true;\n}"
  },
  {
    "function_name": "hf_process_input",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "1155-1228",
    "snippet": "static void hf_process_input(struct hfp_hf *hfp)\n{\n\tchar *str, *ptr, *str2, *tmp;\n\tsize_t len, count, offset, len2;\n\tbool free_tmp = false;\n\n\tstr = ringbuf_peek(hfp->read_buf, 0, &len);\n\tif (!str)\n\t\treturn;\n\n\toffset = 0;\n\n\tptr = find_cr_lf(str, len);\n\twhile (ptr) {\n\t\tcount = ptr - (str + offset);\n\t\tif (count == 0) {\n\t\t\t/* 2 is for <cr><lf> */\n\t\t\toffset += 2;\n\t\t} else {\n\t\t\t*ptr = '\\0';\n\t\t\thf_call_prefix_handler(hfp, str + offset);\n\t\t\toffset += count + 2;\n\t\t}\n\n\t\tptr = find_cr_lf(str + offset, len - offset);\n\t}\n\n\t/*\n\t * Just check if there is no wrapped data in ring buffer.\n\t * Should not happen too often\n\t */\n\tif (len == ringbuf_len(hfp->read_buf))\n\t\tgoto done;\n\n\tstr2 = ringbuf_peek(hfp->read_buf, len, &len2);\n\tif (!str2)\n\t\tgoto done;\n\n\tptr = find_cr_lf(str2, len2);\n\tif (!ptr) {\n\t\t/* Might happen that we wrap between \\r and \\n */\n\t\tptr = memchr(str2, '\\n', len2);\n\t\tif (!ptr)\n\t\t\tgoto done;\n\t}\n\n\tcount = ptr - str2;\n\n\tif (count) {\n\t\t*ptr = '\\0';\n\n\t\ttmp = malloc(len + count);\n\t\tif (!tmp)\n\t\t\tgoto done;\n\n\t\t/* \"str\" here is not a string so we need to use memcpy */\n\t\tmemcpy(tmp, str, len);\n\t\tmemcpy(tmp + len, str2, count);\n\n\t\tfree_tmp = true;\n\t} else {\n\t\tstr[len-1] = '\\0';\n\t\ttmp = str;\n\t}\n\n\thf_call_prefix_handler(hfp, tmp);\n\toffset += count;\n\ndone:\n\tringbuf_drain(hfp->read_buf, offset);\n\n\tif (free_tmp)\n\t\tfree(tmp);\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "tmp"
          ],
          "line": 1227
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "956-985",
          "snippet": "static void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ringbuf_drain",
          "args": [
            "hfp->read_buf",
            "offset"
          ],
          "line": 1224
        },
        "resolved": true,
        "details": {
          "function_name": "ringbuf_drain",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ringbuf.c",
          "lines": "125-144",
          "snippet": "size_t ringbuf_drain(struct ringbuf *ringbuf, size_t count)\n{\n\tsize_t len;\n\n\tif (!ringbuf)\n\t\treturn 0;\n\n\tlen = MIN(count, ringbuf->in - ringbuf->out);\n\tif (!len)\n\t\treturn 0;\n\n\tringbuf->out += len;\n\n\tif (ringbuf->out == ringbuf->in) {\n\t\tringbuf->in = RINGBUF_RESET;\n\t\tringbuf->out = RINGBUF_RESET;\n\t}\n\n\treturn len;\n}",
          "includes": [
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <sys/param.h>",
            "#include <sys/uio.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define RINGBUF_RESET 0"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <sys/param.h>\n#include <sys/uio.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\n#define RINGBUF_RESET 0\n\nsize_t ringbuf_drain(struct ringbuf *ringbuf, size_t count)\n{\n\tsize_t len;\n\n\tif (!ringbuf)\n\t\treturn 0;\n\n\tlen = MIN(count, ringbuf->in - ringbuf->out);\n\tif (!len)\n\t\treturn 0;\n\n\tringbuf->out += len;\n\n\tif (ringbuf->out == ringbuf->in) {\n\t\tringbuf->in = RINGBUF_RESET;\n\t\tringbuf->out = RINGBUF_RESET;\n\t}\n\n\treturn len;\n}"
        }
      },
      {
        "call_info": {
          "callee": "hf_call_prefix_handler",
          "args": [
            "hfp",
            "tmp"
          ],
          "line": 1220
        },
        "resolved": true,
        "details": {
          "function_name": "hf_call_prefix_handler",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
          "lines": "1070-1124",
          "snippet": "static void hf_call_prefix_handler(struct hfp_hf *hfp, const char *data)\n{\n\tstruct event_handler *handler;\n\tconst char *separators = \";:\\0\";\n\tstruct hfp_context context;\n\tenum hfp_result result;\n\tenum hfp_error cme_err;\n\tchar lookup_prefix[18];\n\tuint8_t pref_len = 0;\n\tconst char *prefix;\n\tint i;\n\n\tcontext.offset = 0;\n\tcontext.data = data;\n\n\thf_skip_whitespace(&context);\n\n\tif (strlen(data + context.offset) < 2)\n\t\treturn;\n\n\tprefix = data + context.offset;\n\n\tpref_len = strcspn(prefix, separators);\n\tif (pref_len > 17 || pref_len < 2)\n\t\treturn;\n\n\tfor (i = 0; i < pref_len; i++)\n\t\tlookup_prefix[i] = toupper(prefix[i]);\n\n\tlookup_prefix[pref_len] = '\\0';\n\tcontext.offset += pref_len + 1;\n\n\tif (is_response(lookup_prefix, &result, &cme_err, &context)) {\n\t\tstruct cmd_response *cmd;\n\n\t\tcmd = queue_peek_head(hfp->cmd_queue);\n\t\tif (!cmd)\n\t\t\treturn;\n\n\t\tcmd->resp_cb(result, cme_err, cmd->user_data);\n\n\t\tqueue_remove(hfp->cmd_queue, cmd);\n\t\tfree(cmd);\n\n\t\thf_wakeup_writer(hfp);\n\t\treturn;\n\t}\n\n\thandler = queue_find(hfp->event_handlers, match_handler_event_prefix,\n\t\t\t\t\t\t\t\tlookup_prefix);\n\tif (!handler)\n\t\treturn;\n\n\thandler->callback(&context, handler->user_data);\n}",
          "includes": [
            "#include \"src/shared/hfp.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <ctype.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void hf_call_prefix_handler(struct hfp_hf *hfp, const char *data)\n{\n\tstruct event_handler *handler;\n\tconst char *separators = \";:\\0\";\n\tstruct hfp_context context;\n\tenum hfp_result result;\n\tenum hfp_error cme_err;\n\tchar lookup_prefix[18];\n\tuint8_t pref_len = 0;\n\tconst char *prefix;\n\tint i;\n\n\tcontext.offset = 0;\n\tcontext.data = data;\n\n\thf_skip_whitespace(&context);\n\n\tif (strlen(data + context.offset) < 2)\n\t\treturn;\n\n\tprefix = data + context.offset;\n\n\tpref_len = strcspn(prefix, separators);\n\tif (pref_len > 17 || pref_len < 2)\n\t\treturn;\n\n\tfor (i = 0; i < pref_len; i++)\n\t\tlookup_prefix[i] = toupper(prefix[i]);\n\n\tlookup_prefix[pref_len] = '\\0';\n\tcontext.offset += pref_len + 1;\n\n\tif (is_response(lookup_prefix, &result, &cme_err, &context)) {\n\t\tstruct cmd_response *cmd;\n\n\t\tcmd = queue_peek_head(hfp->cmd_queue);\n\t\tif (!cmd)\n\t\t\treturn;\n\n\t\tcmd->resp_cb(result, cme_err, cmd->user_data);\n\n\t\tqueue_remove(hfp->cmd_queue, cmd);\n\t\tfree(cmd);\n\n\t\thf_wakeup_writer(hfp);\n\t\treturn;\n\t}\n\n\thandler = queue_find(hfp->event_handlers, match_handler_event_prefix,\n\t\t\t\t\t\t\t\tlookup_prefix);\n\tif (!handler)\n\t\treturn;\n\n\thandler->callback(&context, handler->user_data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "tmp + len",
            "str2",
            "count"
          ],
          "line": 1212
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "tmp",
            "str",
            "len"
          ],
          "line": 1211
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "malloc",
          "args": [
            "len + count"
          ],
          "line": 1206
        },
        "resolved": true,
        "details": {
          "function_name": "btd_malloc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/util.c",
          "lines": "41-55",
          "snippet": "void *btd_malloc(size_t size)\n{\n\tif (__builtin_expect(!!size, 1)) {\n\t\tvoid *ptr;\n\n\t\tptr = malloc(size);\n\t\tif (ptr)\n\t\t\treturn ptr;\n\n\t\tfprintf(stderr, \"failed to allocate %zu bytes\\n\", size);\n\t\tabort();\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include <string.h>",
            "#include <limits.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include <string.h>\n#include <limits.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid *btd_malloc(size_t size)\n{\n\tif (__builtin_expect(!!size, 1)) {\n\t\tvoid *ptr;\n\n\t\tptr = malloc(size);\n\t\tif (ptr)\n\t\t\treturn ptr;\n\n\t\tfprintf(stderr, \"failed to allocate %zu bytes\\n\", size);\n\t\tabort();\n\t}\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "memchr",
          "args": [
            "str2",
            "'\\n'",
            "len2"
          ],
          "line": 1196
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "find_cr_lf",
          "args": [
            "str2",
            "len2"
          ],
          "line": 1193
        },
        "resolved": true,
        "details": {
          "function_name": "find_cr_lf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
          "lines": "1126-1153",
          "snippet": "static char *find_cr_lf(char *str, size_t len)\n{\n\tchar *ptr;\n\tsize_t count, offset;\n\n\toffset = 0;\n\n\tptr = memchr(str, '\\r', len);\n\twhile (ptr) {\n\t\t/*\n\t\t * Check if there is more data after '\\r'. If so check for\n\t\t * '\\n'\n\t\t */\n\t\tcount = ptr - str;\n\t\tif ((count < (len - 1)) && *(ptr + 1) == '\\n')\n\t\t\treturn ptr;\n\n\t\t/* There is only '\\r'? Let's try to find next one */\n\t\toffset += count + 1;\n\n\t\tif (offset >= len)\n\t\t\treturn NULL;\n\n\t\tptr = memchr(str + offset, '\\r', len - offset);\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/hfp.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <ctype.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic char *find_cr_lf(char *str, size_t len)\n{\n\tchar *ptr;\n\tsize_t count, offset;\n\n\toffset = 0;\n\n\tptr = memchr(str, '\\r', len);\n\twhile (ptr) {\n\t\t/*\n\t\t * Check if there is more data after '\\r'. If so check for\n\t\t * '\\n'\n\t\t */\n\t\tcount = ptr - str;\n\t\tif ((count < (len - 1)) && *(ptr + 1) == '\\n')\n\t\t\treturn ptr;\n\n\t\t/* There is only '\\r'? Let's try to find next one */\n\t\toffset += count + 1;\n\n\t\tif (offset >= len)\n\t\t\treturn NULL;\n\n\t\tptr = memchr(str + offset, '\\r', len - offset);\n\t}\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ringbuf_peek",
          "args": [
            "hfp->read_buf",
            "len",
            "&len2"
          ],
          "line": 1189
        },
        "resolved": true,
        "details": {
          "function_name": "ringbuf_peek",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ringbuf.c",
          "lines": "146-159",
          "snippet": "void *ringbuf_peek(struct ringbuf *ringbuf, size_t offset, size_t *len_nowrap)\n{\n\tif (!ringbuf)\n\t\treturn NULL;\n\n\toffset = (ringbuf->out + offset) & (ringbuf->size - 1);\n\n\tif (len_nowrap) {\n\t\tsize_t len = ringbuf->in - ringbuf->out;\n\t\t*len_nowrap = MIN(len, ringbuf->size - offset);\n\t}\n\n\treturn ringbuf->buffer + offset;\n}",
          "includes": [
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <sys/param.h>",
            "#include <sys/uio.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <sys/param.h>\n#include <sys/uio.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid *ringbuf_peek(struct ringbuf *ringbuf, size_t offset, size_t *len_nowrap)\n{\n\tif (!ringbuf)\n\t\treturn NULL;\n\n\toffset = (ringbuf->out + offset) & (ringbuf->size - 1);\n\n\tif (len_nowrap) {\n\t\tsize_t len = ringbuf->in - ringbuf->out;\n\t\t*len_nowrap = MIN(len, ringbuf->size - offset);\n\t}\n\n\treturn ringbuf->buffer + offset;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ringbuf_len",
          "args": [
            "hfp->read_buf"
          ],
          "line": 1186
        },
        "resolved": true,
        "details": {
          "function_name": "ringbuf_len",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ringbuf.c",
          "lines": "117-123",
          "snippet": "size_t ringbuf_len(struct ringbuf *ringbuf)\n{\n\tif (!ringbuf)\n\t\treturn 0;\n\n\treturn ringbuf->in - ringbuf->out;\n}",
          "includes": [
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <sys/param.h>",
            "#include <sys/uio.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <sys/param.h>\n#include <sys/uio.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nsize_t ringbuf_len(struct ringbuf *ringbuf)\n{\n\tif (!ringbuf)\n\t\treturn 0;\n\n\treturn ringbuf->in - ringbuf->out;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void hf_process_input(struct hfp_hf *hfp)\n{\n\tchar *str, *ptr, *str2, *tmp;\n\tsize_t len, count, offset, len2;\n\tbool free_tmp = false;\n\n\tstr = ringbuf_peek(hfp->read_buf, 0, &len);\n\tif (!str)\n\t\treturn;\n\n\toffset = 0;\n\n\tptr = find_cr_lf(str, len);\n\twhile (ptr) {\n\t\tcount = ptr - (str + offset);\n\t\tif (count == 0) {\n\t\t\t/* 2 is for <cr><lf> */\n\t\t\toffset += 2;\n\t\t} else {\n\t\t\t*ptr = '\\0';\n\t\t\thf_call_prefix_handler(hfp, str + offset);\n\t\t\toffset += count + 2;\n\t\t}\n\n\t\tptr = find_cr_lf(str + offset, len - offset);\n\t}\n\n\t/*\n\t * Just check if there is no wrapped data in ring buffer.\n\t * Should not happen too often\n\t */\n\tif (len == ringbuf_len(hfp->read_buf))\n\t\tgoto done;\n\n\tstr2 = ringbuf_peek(hfp->read_buf, len, &len2);\n\tif (!str2)\n\t\tgoto done;\n\n\tptr = find_cr_lf(str2, len2);\n\tif (!ptr) {\n\t\t/* Might happen that we wrap between \\r and \\n */\n\t\tptr = memchr(str2, '\\n', len2);\n\t\tif (!ptr)\n\t\t\tgoto done;\n\t}\n\n\tcount = ptr - str2;\n\n\tif (count) {\n\t\t*ptr = '\\0';\n\n\t\ttmp = malloc(len + count);\n\t\tif (!tmp)\n\t\t\tgoto done;\n\n\t\t/* \"str\" here is not a string so we need to use memcpy */\n\t\tmemcpy(tmp, str, len);\n\t\tmemcpy(tmp + len, str2, count);\n\n\t\tfree_tmp = true;\n\t} else {\n\t\tstr[len-1] = '\\0';\n\t\ttmp = str;\n\t}\n\n\thf_call_prefix_handler(hfp, tmp);\n\toffset += count;\n\ndone:\n\tringbuf_drain(hfp->read_buf, offset);\n\n\tif (free_tmp)\n\t\tfree(tmp);\n}"
  },
  {
    "function_name": "find_cr_lf",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "1126-1153",
    "snippet": "static char *find_cr_lf(char *str, size_t len)\n{\n\tchar *ptr;\n\tsize_t count, offset;\n\n\toffset = 0;\n\n\tptr = memchr(str, '\\r', len);\n\twhile (ptr) {\n\t\t/*\n\t\t * Check if there is more data after '\\r'. If so check for\n\t\t * '\\n'\n\t\t */\n\t\tcount = ptr - str;\n\t\tif ((count < (len - 1)) && *(ptr + 1) == '\\n')\n\t\t\treturn ptr;\n\n\t\t/* There is only '\\r'? Let's try to find next one */\n\t\toffset += count + 1;\n\n\t\tif (offset >= len)\n\t\t\treturn NULL;\n\n\t\tptr = memchr(str + offset, '\\r', len - offset);\n\t}\n\n\treturn NULL;\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "memchr",
          "args": [
            "str + offset",
            "'\\r'",
            "len - offset"
          ],
          "line": 1149
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memchr",
          "args": [
            "str",
            "'\\r'",
            "len"
          ],
          "line": 1133
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic char *find_cr_lf(char *str, size_t len)\n{\n\tchar *ptr;\n\tsize_t count, offset;\n\n\toffset = 0;\n\n\tptr = memchr(str, '\\r', len);\n\twhile (ptr) {\n\t\t/*\n\t\t * Check if there is more data after '\\r'. If so check for\n\t\t * '\\n'\n\t\t */\n\t\tcount = ptr - str;\n\t\tif ((count < (len - 1)) && *(ptr + 1) == '\\n')\n\t\t\treturn ptr;\n\n\t\t/* There is only '\\r'? Let's try to find next one */\n\t\toffset += count + 1;\n\n\t\tif (offset >= len)\n\t\t\treturn NULL;\n\n\t\tptr = memchr(str + offset, '\\r', len - offset);\n\t}\n\n\treturn NULL;\n}"
  },
  {
    "function_name": "hf_call_prefix_handler",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "1070-1124",
    "snippet": "static void hf_call_prefix_handler(struct hfp_hf *hfp, const char *data)\n{\n\tstruct event_handler *handler;\n\tconst char *separators = \";:\\0\";\n\tstruct hfp_context context;\n\tenum hfp_result result;\n\tenum hfp_error cme_err;\n\tchar lookup_prefix[18];\n\tuint8_t pref_len = 0;\n\tconst char *prefix;\n\tint i;\n\n\tcontext.offset = 0;\n\tcontext.data = data;\n\n\thf_skip_whitespace(&context);\n\n\tif (strlen(data + context.offset) < 2)\n\t\treturn;\n\n\tprefix = data + context.offset;\n\n\tpref_len = strcspn(prefix, separators);\n\tif (pref_len > 17 || pref_len < 2)\n\t\treturn;\n\n\tfor (i = 0; i < pref_len; i++)\n\t\tlookup_prefix[i] = toupper(prefix[i]);\n\n\tlookup_prefix[pref_len] = '\\0';\n\tcontext.offset += pref_len + 1;\n\n\tif (is_response(lookup_prefix, &result, &cme_err, &context)) {\n\t\tstruct cmd_response *cmd;\n\n\t\tcmd = queue_peek_head(hfp->cmd_queue);\n\t\tif (!cmd)\n\t\t\treturn;\n\n\t\tcmd->resp_cb(result, cme_err, cmd->user_data);\n\n\t\tqueue_remove(hfp->cmd_queue, cmd);\n\t\tfree(cmd);\n\n\t\thf_wakeup_writer(hfp);\n\t\treturn;\n\t}\n\n\thandler = queue_find(hfp->event_handlers, match_handler_event_prefix,\n\t\t\t\t\t\t\t\tlookup_prefix);\n\tif (!handler)\n\t\treturn;\n\n\thandler->callback(&context, handler->user_data);\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "handler->callback",
          "args": [
            "&context",
            "handler->user_data"
          ],
          "line": 1123
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "queue_find",
          "args": [
            "hfp->event_handlers",
            "match_handler_event_prefix",
            "lookup_prefix"
          ],
          "line": 1118
        },
        "resolved": true,
        "details": {
          "function_name": "queue_find",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "231-247",
          "snippet": "void *queue_find(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tconst void *match_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tfor (entry = queue->head; entry; entry = entry->next)\n\t\tif (function(entry->data, match_data))\n\t\t\treturn entry->data;\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid *queue_find(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tconst void *match_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tfor (entry = queue->head; entry; entry = entry->next)\n\t\tif (function(entry->data, match_data))\n\t\t\treturn entry->data;\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "hf_wakeup_writer",
          "args": [
            "hfp"
          ],
          "line": 1114
        },
        "resolved": true,
        "details": {
          "function_name": "hf_wakeup_writer",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
          "lines": "1055-1068",
          "snippet": "static void hf_wakeup_writer(struct hfp_hf *hfp)\n{\n\tif (hfp->writer_active)\n\t\treturn;\n\n\tif (!ringbuf_len(hfp->write_buf))\n\t\treturn;\n\n\tif (!io_set_write_handler(hfp->io, hf_can_write_data,\n\t\t\t\t\thfp, hf_write_watch_destroy))\n\t\treturn;\n\n\thfp->writer_active = true;\n}",
          "includes": [
            "#include \"src/shared/hfp.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <ctype.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void hf_wakeup_writer(struct hfp_hf *hfp)\n{\n\tif (hfp->writer_active)\n\t\treturn;\n\n\tif (!ringbuf_len(hfp->write_buf))\n\t\treturn;\n\n\tif (!io_set_write_handler(hfp->io, hf_can_write_data,\n\t\t\t\t\thfp, hf_write_watch_destroy))\n\t\treturn;\n\n\thfp->writer_active = true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "cmd"
          ],
          "line": 1112
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "956-985",
          "snippet": "static void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_remove",
          "args": [
            "hfp->cmd_queue",
            "cmd"
          ],
          "line": 1111
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_uuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "526-541",
          "snippet": "static bool queue_remove_uuid(struct queue *queue, bt_uuid_t *uuid)\n{\n\tbt_uuid_t *removed;\n\n\tif (!queue || !uuid)\n\t\treturn false;\n\n\tremoved = queue_remove_if(queue, uuid_match, uuid);\n\n\tif (removed) {\n\t\tfree(removed);\n\t\treturn true;\n\t}\n\n\treturn false;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic bool queue_remove_uuid(struct queue *queue, bt_uuid_t *uuid)\n{\n\tbt_uuid_t *removed;\n\n\tif (!queue || !uuid)\n\t\treturn false;\n\n\tremoved = queue_remove_if(queue, uuid_match, uuid);\n\n\tif (removed) {\n\t\tfree(removed);\n\t\treturn true;\n\t}\n\n\treturn false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "cmd->resp_cb",
          "args": [
            "result",
            "cme_err",
            "cmd->user_data"
          ],
          "line": 1109
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "queue_peek_head",
          "args": [
            "hfp->cmd_queue"
          ],
          "line": 1105
        },
        "resolved": true,
        "details": {
          "function_name": "queue_peek_head",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "187-193",
          "snippet": "void *queue_peek_head(struct queue *queue)\n{\n\tif (!queue || !queue->head)\n\t\treturn NULL;\n\n\treturn queue->head->data;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid *queue_peek_head(struct queue *queue)\n{\n\tif (!queue || !queue->head)\n\t\treturn NULL;\n\n\treturn queue->head->data;\n}"
        }
      },
      {
        "call_info": {
          "callee": "is_response",
          "args": [
            "lookup_prefix",
            "&result",
            "&cme_err",
            "&context"
          ],
          "line": 1102
        },
        "resolved": true,
        "details": {
          "function_name": "is_response",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
          "lines": "988-1053",
          "snippet": "static bool is_response(const char *prefix, enum hfp_result *result,\n\t\t\t\t\t\tenum hfp_error *cme_err,\n\t\t\t\t\t\tstruct hfp_context *context)\n{\n\tif (strcmp(prefix, \"OK\") == 0) {\n\t\t*result = HFP_RESULT_OK;\n\t\t/*\n\t\t * Set cme_err to 0 as this is not valid when result is not\n\t\t * CME ERROR\n\t\t */\n\t\t*cme_err = 0;\n\t\treturn true;\n\t}\n\n\tif (strcmp(prefix, \"ERROR\") == 0) {\n\t\t*result = HFP_RESULT_ERROR;\n\t\t*cme_err = 0;\n\t\treturn true;\n\t}\n\n\tif (strcmp(prefix, \"NO CARRIER\") == 0) {\n\t\t*result = HFP_RESULT_NO_CARRIER;\n\t\t*cme_err = 0;\n\t\treturn true;\n\t}\n\n\tif (strcmp(prefix, \"NO ANSWER\") == 0) {\n\t\t*result = HFP_RESULT_NO_ANSWER;\n\t\t*cme_err = 0;\n\t\treturn true;\n\t}\n\n\tif (strcmp(prefix, \"BUSY\") == 0) {\n\t\t*result = HFP_RESULT_BUSY;\n\t\t*cme_err = 0;\n\t\treturn true;\n\t}\n\n\tif (strcmp(prefix, \"DELAYED\") == 0) {\n\t\t*result = HFP_RESULT_DELAYED;\n\t\t*cme_err = 0;\n\t\treturn true;\n\t}\n\n\tif (strcmp(prefix, \"BLACKLISTED\") == 0) {\n\t\t*result = HFP_RESULT_BLACKLISTED;\n\t\t*cme_err = 0;\n\t\treturn true;\n\t}\n\n\tif (strcmp(prefix, \"+CME ERROR\") == 0) {\n\t\tuint32_t val;\n\n\t\t*result = HFP_RESULT_CME_ERROR;\n\n\t\tif (hfp_context_get_number(context, &val) &&\n\t\t\t\t\tval <= HFP_ERROR_NETWORK_NOT_ALLOWED)\n\t\t\t*cme_err = val;\n\t\telse\n\t\t\t*cme_err = HFP_ERROR_AG_FAILURE;\n\n\t\treturn true;\n\t}\n\n\treturn false;\n}",
          "includes": [
            "#include \"src/shared/hfp.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <ctype.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic bool is_response(const char *prefix, enum hfp_result *result,\n\t\t\t\t\t\tenum hfp_error *cme_err,\n\t\t\t\t\t\tstruct hfp_context *context)\n{\n\tif (strcmp(prefix, \"OK\") == 0) {\n\t\t*result = HFP_RESULT_OK;\n\t\t/*\n\t\t * Set cme_err to 0 as this is not valid when result is not\n\t\t * CME ERROR\n\t\t */\n\t\t*cme_err = 0;\n\t\treturn true;\n\t}\n\n\tif (strcmp(prefix, \"ERROR\") == 0) {\n\t\t*result = HFP_RESULT_ERROR;\n\t\t*cme_err = 0;\n\t\treturn true;\n\t}\n\n\tif (strcmp(prefix, \"NO CARRIER\") == 0) {\n\t\t*result = HFP_RESULT_NO_CARRIER;\n\t\t*cme_err = 0;\n\t\treturn true;\n\t}\n\n\tif (strcmp(prefix, \"NO ANSWER\") == 0) {\n\t\t*result = HFP_RESULT_NO_ANSWER;\n\t\t*cme_err = 0;\n\t\treturn true;\n\t}\n\n\tif (strcmp(prefix, \"BUSY\") == 0) {\n\t\t*result = HFP_RESULT_BUSY;\n\t\t*cme_err = 0;\n\t\treturn true;\n\t}\n\n\tif (strcmp(prefix, \"DELAYED\") == 0) {\n\t\t*result = HFP_RESULT_DELAYED;\n\t\t*cme_err = 0;\n\t\treturn true;\n\t}\n\n\tif (strcmp(prefix, \"BLACKLISTED\") == 0) {\n\t\t*result = HFP_RESULT_BLACKLISTED;\n\t\t*cme_err = 0;\n\t\treturn true;\n\t}\n\n\tif (strcmp(prefix, \"+CME ERROR\") == 0) {\n\t\tuint32_t val;\n\n\t\t*result = HFP_RESULT_CME_ERROR;\n\n\t\tif (hfp_context_get_number(context, &val) &&\n\t\t\t\t\tval <= HFP_ERROR_NETWORK_NOT_ALLOWED)\n\t\t\t*cme_err = val;\n\t\telse\n\t\t\t*cme_err = HFP_ERROR_AG_FAILURE;\n\n\t\treturn true;\n\t}\n\n\treturn false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "toupper",
          "args": [
            "prefix[i]"
          ],
          "line": 1097
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcspn",
          "args": [
            "prefix",
            "separators"
          ],
          "line": 1092
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "data + context.offset"
          ],
          "line": 1087
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hf_skip_whitespace",
          "args": [
            "&context"
          ],
          "line": 1085
        },
        "resolved": true,
        "details": {
          "function_name": "hf_skip_whitespace",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
          "lines": "982-986",
          "snippet": "static void hf_skip_whitespace(struct hfp_context *context)\n{\n\twhile (context->data[context->offset] == ' ')\n\t\tcontext->offset++;\n}",
          "includes": [
            "#include \"src/shared/hfp.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <ctype.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void hf_skip_whitespace(struct hfp_context *context)\n{\n\twhile (context->data[context->offset] == ' ')\n\t\tcontext->offset++;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void hf_call_prefix_handler(struct hfp_hf *hfp, const char *data)\n{\n\tstruct event_handler *handler;\n\tconst char *separators = \";:\\0\";\n\tstruct hfp_context context;\n\tenum hfp_result result;\n\tenum hfp_error cme_err;\n\tchar lookup_prefix[18];\n\tuint8_t pref_len = 0;\n\tconst char *prefix;\n\tint i;\n\n\tcontext.offset = 0;\n\tcontext.data = data;\n\n\thf_skip_whitespace(&context);\n\n\tif (strlen(data + context.offset) < 2)\n\t\treturn;\n\n\tprefix = data + context.offset;\n\n\tpref_len = strcspn(prefix, separators);\n\tif (pref_len > 17 || pref_len < 2)\n\t\treturn;\n\n\tfor (i = 0; i < pref_len; i++)\n\t\tlookup_prefix[i] = toupper(prefix[i]);\n\n\tlookup_prefix[pref_len] = '\\0';\n\tcontext.offset += pref_len + 1;\n\n\tif (is_response(lookup_prefix, &result, &cme_err, &context)) {\n\t\tstruct cmd_response *cmd;\n\n\t\tcmd = queue_peek_head(hfp->cmd_queue);\n\t\tif (!cmd)\n\t\t\treturn;\n\n\t\tcmd->resp_cb(result, cme_err, cmd->user_data);\n\n\t\tqueue_remove(hfp->cmd_queue, cmd);\n\t\tfree(cmd);\n\n\t\thf_wakeup_writer(hfp);\n\t\treturn;\n\t}\n\n\thandler = queue_find(hfp->event_handlers, match_handler_event_prefix,\n\t\t\t\t\t\t\t\tlookup_prefix);\n\tif (!handler)\n\t\treturn;\n\n\thandler->callback(&context, handler->user_data);\n}"
  },
  {
    "function_name": "hf_wakeup_writer",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "1055-1068",
    "snippet": "static void hf_wakeup_writer(struct hfp_hf *hfp)\n{\n\tif (hfp->writer_active)\n\t\treturn;\n\n\tif (!ringbuf_len(hfp->write_buf))\n\t\treturn;\n\n\tif (!io_set_write_handler(hfp->io, hf_can_write_data,\n\t\t\t\t\thfp, hf_write_watch_destroy))\n\t\treturn;\n\n\thfp->writer_active = true;\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "io_set_write_handler",
          "args": [
            "hfp->io",
            "hf_can_write_data",
            "hfp",
            "hf_write_watch_destroy"
          ],
          "line": 1063
        },
        "resolved": true,
        "details": {
          "function_name": "io_set_write_handler",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-glib.c",
          "lines": "254-258",
          "snippet": "bool io_set_write_handler(struct io *io, io_callback_func_t callback,\n\t\t\t\tvoid *user_data, io_destroy_func_t destroy)\n{\n\treturn io_set_handler(io, G_IO_OUT, callback, user_data, destroy);\n}",
          "includes": [
            "#include \"src/shared/io.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/io.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nbool io_set_write_handler(struct io *io, io_callback_func_t callback,\n\t\t\t\tvoid *user_data, io_destroy_func_t destroy)\n{\n\treturn io_set_handler(io, G_IO_OUT, callback, user_data, destroy);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ringbuf_len",
          "args": [
            "hfp->write_buf"
          ],
          "line": 1060
        },
        "resolved": true,
        "details": {
          "function_name": "ringbuf_len",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ringbuf.c",
          "lines": "117-123",
          "snippet": "size_t ringbuf_len(struct ringbuf *ringbuf)\n{\n\tif (!ringbuf)\n\t\treturn 0;\n\n\treturn ringbuf->in - ringbuf->out;\n}",
          "includes": [
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <sys/param.h>",
            "#include <sys/uio.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <sys/param.h>\n#include <sys/uio.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nsize_t ringbuf_len(struct ringbuf *ringbuf)\n{\n\tif (!ringbuf)\n\t\treturn 0;\n\n\treturn ringbuf->in - ringbuf->out;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void hf_wakeup_writer(struct hfp_hf *hfp)\n{\n\tif (hfp->writer_active)\n\t\treturn;\n\n\tif (!ringbuf_len(hfp->write_buf))\n\t\treturn;\n\n\tif (!io_set_write_handler(hfp->io, hf_can_write_data,\n\t\t\t\t\thfp, hf_write_watch_destroy))\n\t\treturn;\n\n\thfp->writer_active = true;\n}"
  },
  {
    "function_name": "is_response",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "988-1053",
    "snippet": "static bool is_response(const char *prefix, enum hfp_result *result,\n\t\t\t\t\t\tenum hfp_error *cme_err,\n\t\t\t\t\t\tstruct hfp_context *context)\n{\n\tif (strcmp(prefix, \"OK\") == 0) {\n\t\t*result = HFP_RESULT_OK;\n\t\t/*\n\t\t * Set cme_err to 0 as this is not valid when result is not\n\t\t * CME ERROR\n\t\t */\n\t\t*cme_err = 0;\n\t\treturn true;\n\t}\n\n\tif (strcmp(prefix, \"ERROR\") == 0) {\n\t\t*result = HFP_RESULT_ERROR;\n\t\t*cme_err = 0;\n\t\treturn true;\n\t}\n\n\tif (strcmp(prefix, \"NO CARRIER\") == 0) {\n\t\t*result = HFP_RESULT_NO_CARRIER;\n\t\t*cme_err = 0;\n\t\treturn true;\n\t}\n\n\tif (strcmp(prefix, \"NO ANSWER\") == 0) {\n\t\t*result = HFP_RESULT_NO_ANSWER;\n\t\t*cme_err = 0;\n\t\treturn true;\n\t}\n\n\tif (strcmp(prefix, \"BUSY\") == 0) {\n\t\t*result = HFP_RESULT_BUSY;\n\t\t*cme_err = 0;\n\t\treturn true;\n\t}\n\n\tif (strcmp(prefix, \"DELAYED\") == 0) {\n\t\t*result = HFP_RESULT_DELAYED;\n\t\t*cme_err = 0;\n\t\treturn true;\n\t}\n\n\tif (strcmp(prefix, \"BLACKLISTED\") == 0) {\n\t\t*result = HFP_RESULT_BLACKLISTED;\n\t\t*cme_err = 0;\n\t\treturn true;\n\t}\n\n\tif (strcmp(prefix, \"+CME ERROR\") == 0) {\n\t\tuint32_t val;\n\n\t\t*result = HFP_RESULT_CME_ERROR;\n\n\t\tif (hfp_context_get_number(context, &val) &&\n\t\t\t\t\tval <= HFP_ERROR_NETWORK_NOT_ALLOWED)\n\t\t\t*cme_err = val;\n\t\telse\n\t\t\t*cme_err = HFP_ERROR_AG_FAILURE;\n\n\t\treturn true;\n\t}\n\n\treturn false;\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "hfp_context_get_number",
          "args": [
            "context",
            "&val"
          ],
          "line": 1043
        },
        "resolved": true,
        "details": {
          "function_name": "hfp_context_get_number",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
          "lines": "295-319",
          "snippet": "bool hfp_context_get_number(struct hfp_context *context,\n\t\t\t\t\t\t\tunsigned int *val)\n{\n\tunsigned int i;\n\tint tmp = 0;\n\n\tskip_whitespace(context);\n\n\ti = context->offset;\n\n\twhile (context->data[i] >= '0' && context->data[i] <= '9')\n\t\ttmp = tmp * 10 + context->data[i++] - '0';\n\n\tif (i == context->offset)\n\t\treturn false;\n\n\tif (val)\n\t\t*val = tmp;\n\tcontext->offset = i;\n\n\tskip_whitespace(context);\n\tnext_field(context);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/hfp.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <ctype.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nbool hfp_context_get_number(struct hfp_context *context,\n\t\t\t\t\t\t\tunsigned int *val)\n{\n\tunsigned int i;\n\tint tmp = 0;\n\n\tskip_whitespace(context);\n\n\ti = context->offset;\n\n\twhile (context->data[i] >= '0' && context->data[i] <= '9')\n\t\ttmp = tmp * 10 + context->data[i++] - '0';\n\n\tif (i == context->offset)\n\t\treturn false;\n\n\tif (val)\n\t\t*val = tmp;\n\tcontext->offset = i;\n\n\tskip_whitespace(context);\n\tnext_field(context);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "prefix",
            "\"+CME ERROR\""
          ],
          "line": 1038
        },
        "resolved": true,
        "details": {
          "function_name": "g_strcmp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "1927-1930",
          "snippet": "static gint g_strcmp(gconstpointer a, gconstpointer b)\n{\n\treturn strcmp(a, b);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic gint g_strcmp(gconstpointer a, gconstpointer b)\n{\n\treturn strcmp(a, b);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic bool is_response(const char *prefix, enum hfp_result *result,\n\t\t\t\t\t\tenum hfp_error *cme_err,\n\t\t\t\t\t\tstruct hfp_context *context)\n{\n\tif (strcmp(prefix, \"OK\") == 0) {\n\t\t*result = HFP_RESULT_OK;\n\t\t/*\n\t\t * Set cme_err to 0 as this is not valid when result is not\n\t\t * CME ERROR\n\t\t */\n\t\t*cme_err = 0;\n\t\treturn true;\n\t}\n\n\tif (strcmp(prefix, \"ERROR\") == 0) {\n\t\t*result = HFP_RESULT_ERROR;\n\t\t*cme_err = 0;\n\t\treturn true;\n\t}\n\n\tif (strcmp(prefix, \"NO CARRIER\") == 0) {\n\t\t*result = HFP_RESULT_NO_CARRIER;\n\t\t*cme_err = 0;\n\t\treturn true;\n\t}\n\n\tif (strcmp(prefix, \"NO ANSWER\") == 0) {\n\t\t*result = HFP_RESULT_NO_ANSWER;\n\t\t*cme_err = 0;\n\t\treturn true;\n\t}\n\n\tif (strcmp(prefix, \"BUSY\") == 0) {\n\t\t*result = HFP_RESULT_BUSY;\n\t\t*cme_err = 0;\n\t\treturn true;\n\t}\n\n\tif (strcmp(prefix, \"DELAYED\") == 0) {\n\t\t*result = HFP_RESULT_DELAYED;\n\t\t*cme_err = 0;\n\t\treturn true;\n\t}\n\n\tif (strcmp(prefix, \"BLACKLISTED\") == 0) {\n\t\t*result = HFP_RESULT_BLACKLISTED;\n\t\t*cme_err = 0;\n\t\treturn true;\n\t}\n\n\tif (strcmp(prefix, \"+CME ERROR\") == 0) {\n\t\tuint32_t val;\n\n\t\t*result = HFP_RESULT_CME_ERROR;\n\n\t\tif (hfp_context_get_number(context, &val) &&\n\t\t\t\t\tval <= HFP_ERROR_NETWORK_NOT_ALLOWED)\n\t\t\t*cme_err = val;\n\t\telse\n\t\t\t*cme_err = HFP_ERROR_AG_FAILURE;\n\n\t\treturn true;\n\t}\n\n\treturn false;\n}"
  },
  {
    "function_name": "hf_skip_whitespace",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "982-986",
    "snippet": "static void hf_skip_whitespace(struct hfp_context *context)\n{\n\twhile (context->data[context->offset] == ' ')\n\t\tcontext->offset++;\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void hf_skip_whitespace(struct hfp_context *context)\n{\n\twhile (context->data[context->offset] == ' ')\n\t\tcontext->offset++;\n}"
  },
  {
    "function_name": "hf_write_watch_destroy",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "975-980",
    "snippet": "static void hf_write_watch_destroy(void *user_data)\n{\n\tstruct hfp_hf *hfp = user_data;\n\n\thfp->writer_active = false;\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void hf_write_watch_destroy(void *user_data)\n{\n\tstruct hfp_hf *hfp = user_data;\n\n\thfp->writer_active = false;\n}"
  },
  {
    "function_name": "hf_can_write_data",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "960-973",
    "snippet": "static bool hf_can_write_data(struct io *io, void *user_data)\n{\n\tstruct hfp_hf *hfp = user_data;\n\tssize_t bytes_written;\n\n\tbytes_written = ringbuf_write(hfp->write_buf, hfp->fd);\n\tif (bytes_written < 0)\n\t\treturn false;\n\n\tif (ringbuf_len(hfp->write_buf) > 0)\n\t\treturn true;\n\n\treturn false;\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ringbuf_len",
          "args": [
            "hfp->write_buf"
          ],
          "line": 969
        },
        "resolved": true,
        "details": {
          "function_name": "ringbuf_len",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ringbuf.c",
          "lines": "117-123",
          "snippet": "size_t ringbuf_len(struct ringbuf *ringbuf)\n{\n\tif (!ringbuf)\n\t\treturn 0;\n\n\treturn ringbuf->in - ringbuf->out;\n}",
          "includes": [
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <sys/param.h>",
            "#include <sys/uio.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <sys/param.h>\n#include <sys/uio.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nsize_t ringbuf_len(struct ringbuf *ringbuf)\n{\n\tif (!ringbuf)\n\t\treturn 0;\n\n\treturn ringbuf->in - ringbuf->out;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ringbuf_write",
          "args": [
            "hfp->write_buf",
            "hfp->fd"
          ],
          "line": 965
        },
        "resolved": true,
        "details": {
          "function_name": "ringbuf_write",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ringbuf.c",
          "lines": "161-198",
          "snippet": "ssize_t ringbuf_write(struct ringbuf *ringbuf, int fd)\n{\n\tsize_t len, offset, end;\n\tstruct iovec iov[2];\n\tssize_t consumed;\n\n\tif (!ringbuf || fd < 0)\n\t\treturn -1;\n\n\t/* Determine how much data is available */\n\tlen = ringbuf->in - ringbuf->out;\n\tif (!len)\n\t\treturn 0;\n\n\t/* Grab data from buffer starting at offset until the end */\n\toffset = ringbuf->out & (ringbuf->size - 1);\n\tend = MIN(len, ringbuf->size - offset);\n\n\tiov[0].iov_base = ringbuf->buffer + offset;\n\tiov[0].iov_len = end;\n\n\t/* Use second vector for remainder from the beginning */\n\tiov[1].iov_base = ringbuf->buffer;\n\tiov[1].iov_len = len - end;\n\n\tconsumed = writev(fd, iov, 2);\n\tif (consumed < 0)\n\t\treturn -1;\n\n\tringbuf->out += consumed;\n\n\tif (ringbuf->out == ringbuf->in) {\n\t\tringbuf->in = RINGBUF_RESET;\n\t\tringbuf->out = RINGBUF_RESET;\n\t}\n\n\treturn consumed;\n}",
          "includes": [
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <sys/param.h>",
            "#include <sys/uio.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define RINGBUF_RESET 0"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <sys/param.h>\n#include <sys/uio.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\n#define RINGBUF_RESET 0\n\nssize_t ringbuf_write(struct ringbuf *ringbuf, int fd)\n{\n\tsize_t len, offset, end;\n\tstruct iovec iov[2];\n\tssize_t consumed;\n\n\tif (!ringbuf || fd < 0)\n\t\treturn -1;\n\n\t/* Determine how much data is available */\n\tlen = ringbuf->in - ringbuf->out;\n\tif (!len)\n\t\treturn 0;\n\n\t/* Grab data from buffer starting at offset until the end */\n\toffset = ringbuf->out & (ringbuf->size - 1);\n\tend = MIN(len, ringbuf->size - offset);\n\n\tiov[0].iov_base = ringbuf->buffer + offset;\n\tiov[0].iov_len = end;\n\n\t/* Use second vector for remainder from the beginning */\n\tiov[1].iov_base = ringbuf->buffer;\n\tiov[1].iov_len = len - end;\n\n\tconsumed = writev(fd, iov, 2);\n\tif (consumed < 0)\n\t\treturn -1;\n\n\tringbuf->out += consumed;\n\n\tif (ringbuf->out == ringbuf->in) {\n\t\tringbuf->in = RINGBUF_RESET;\n\t\tringbuf->out = RINGBUF_RESET;\n\t}\n\n\treturn consumed;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic bool hf_can_write_data(struct io *io, void *user_data)\n{\n\tstruct hfp_hf *hfp = user_data;\n\tssize_t bytes_written;\n\n\tbytes_written = ringbuf_write(hfp->write_buf, hfp->fd);\n\tif (bytes_written < 0)\n\t\treturn false;\n\n\tif (ringbuf_len(hfp->write_buf) > 0)\n\t\treturn true;\n\n\treturn false;\n}"
  },
  {
    "function_name": "destroy_event_handler",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "948-958",
    "snippet": "static void destroy_event_handler(void *data)\n{\n\tstruct event_handler *handler = data;\n\n\tif (handler->destroy)\n\t\thandler->destroy(handler->user_data);\n\n\tfree(handler->prefix);\n\n\tfree(handler);\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "handler"
          ],
          "line": 957
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "956-985",
          "snippet": "static void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}"
        }
      },
      {
        "call_info": {
          "callee": "handler->destroy",
          "args": [
            "handler->user_data"
          ],
          "line": 953
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void destroy_event_handler(void *data)\n{\n\tstruct event_handler *handler = data;\n\n\tif (handler->destroy)\n\t\thandler->destroy(handler->user_data);\n\n\tfree(handler->prefix);\n\n\tfree(handler);\n}"
  },
  {
    "function_name": "match_handler_event_prefix",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "937-946",
    "snippet": "static bool match_handler_event_prefix(const void *a, const void *b)\n{\n\tconst struct event_handler *handler = a;\n\tconst char *prefix = b;\n\n\tif (strcmp(handler->prefix, prefix) != 0)\n\t\treturn false;\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "handler->prefix",
            "prefix"
          ],
          "line": 942
        },
        "resolved": true,
        "details": {
          "function_name": "g_strcmp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "1927-1930",
          "snippet": "static gint g_strcmp(gconstpointer a, gconstpointer b)\n{\n\treturn strcmp(a, b);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic gint g_strcmp(gconstpointer a, gconstpointer b)\n{\n\treturn strcmp(a, b);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic bool match_handler_event_prefix(const void *a, const void *b)\n{\n\tconst struct event_handler *handler = a;\n\tconst char *prefix = b;\n\n\tif (strcmp(handler->prefix, prefix) != 0)\n\t\treturn false;\n\n\treturn true;\n}"
  },
  {
    "function_name": "hfp_gw_disconnect",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "929-935",
    "snippet": "bool hfp_gw_disconnect(struct hfp_gw *hfp)\n{\n\tif (!hfp)\n\t\treturn false;\n\n\treturn io_shutdown(hfp->io);\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "io_shutdown",
          "args": [
            "hfp->io"
          ],
          "line": 934
        },
        "resolved": true,
        "details": {
          "function_name": "io_shutdown",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-glib.c",
          "lines": "286-293",
          "snippet": "bool io_shutdown(struct io *io)\n{\n\tif (!io || !io->channel)\n\t\treturn false;\n\n\treturn g_io_channel_shutdown(io->channel, TRUE, NULL)\n\t\t\t\t\t\t\t== G_IO_STATUS_NORMAL;\n}",
          "includes": [
            "#include \"src/shared/io.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/io.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nbool io_shutdown(struct io *io)\n{\n\tif (!io || !io->channel)\n\t\treturn false;\n\n\treturn g_io_channel_shutdown(io->channel, TRUE, NULL)\n\t\t\t\t\t\t\t== G_IO_STATUS_NORMAL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nbool hfp_gw_disconnect(struct hfp_gw *hfp)\n{\n\tif (!hfp)\n\t\treturn false;\n\n\treturn io_shutdown(hfp->io);\n}"
  },
  {
    "function_name": "hfp_gw_set_disconnect_handler",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "903-927",
    "snippet": "bool hfp_gw_set_disconnect_handler(struct hfp_gw *hfp,\n\t\t\t\t\thfp_disconnect_func_t callback,\n\t\t\t\t\tvoid *user_data,\n\t\t\t\t\thfp_destroy_func_t destroy)\n{\n\tif (!hfp)\n\t\treturn false;\n\n\tif (hfp->disconnect_destroy)\n\t\thfp->disconnect_destroy(hfp->disconnect_data);\n\n\tif (!io_set_disconnect_handler(hfp->io, io_disconnected, hfp,\n\t\t\t\t\t\tdisconnect_watch_destroy)) {\n\t\thfp->disconnect_callback = NULL;\n\t\thfp->disconnect_destroy = NULL;\n\t\thfp->disconnect_data = NULL;\n\t\treturn false;\n\t}\n\n\thfp->disconnect_callback = callback;\n\thfp->disconnect_destroy = destroy;\n\thfp->disconnect_data = user_data;\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "io_set_disconnect_handler",
          "args": [
            "hfp->io",
            "io_disconnected",
            "hfp",
            "disconnect_watch_destroy"
          ],
          "line": 914
        },
        "resolved": true,
        "details": {
          "function_name": "io_set_disconnect_handler",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-glib.c",
          "lines": "260-264",
          "snippet": "bool io_set_disconnect_handler(struct io *io, io_callback_func_t callback,\n\t\t\t\tvoid *user_data, io_destroy_func_t destroy)\n{\n\treturn io_set_handler(io, G_IO_HUP, callback, user_data, destroy);\n}",
          "includes": [
            "#include \"src/shared/io.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/io.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nbool io_set_disconnect_handler(struct io *io, io_callback_func_t callback,\n\t\t\t\tvoid *user_data, io_destroy_func_t destroy)\n{\n\treturn io_set_handler(io, G_IO_HUP, callback, user_data, destroy);\n}"
        }
      },
      {
        "call_info": {
          "callee": "hfp->disconnect_destroy",
          "args": [
            "hfp->disconnect_data"
          ],
          "line": 912
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nbool hfp_gw_set_disconnect_handler(struct hfp_gw *hfp,\n\t\t\t\t\thfp_disconnect_func_t callback,\n\t\t\t\t\tvoid *user_data,\n\t\t\t\t\thfp_destroy_func_t destroy)\n{\n\tif (!hfp)\n\t\treturn false;\n\n\tif (hfp->disconnect_destroy)\n\t\thfp->disconnect_destroy(hfp->disconnect_data);\n\n\tif (!io_set_disconnect_handler(hfp->io, io_disconnected, hfp,\n\t\t\t\t\t\tdisconnect_watch_destroy)) {\n\t\thfp->disconnect_callback = NULL;\n\t\thfp->disconnect_destroy = NULL;\n\t\thfp->disconnect_data = NULL;\n\t\treturn false;\n\t}\n\n\thfp->disconnect_callback = callback;\n\thfp->disconnect_destroy = destroy;\n\thfp->disconnect_data = user_data;\n\n\treturn true;\n}"
  },
  {
    "function_name": "io_disconnected",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "889-901",
    "snippet": "static bool io_disconnected(struct io *io, void *user_data)\n{\n\tstruct hfp_gw *hfp = user_data;\n\n\thfp->in_disconnect = true;\n\n\tif (hfp->disconnect_callback)\n\t\thfp->disconnect_callback(hfp->disconnect_data);\n\n\thfp->in_disconnect = false;\n\n\treturn false;\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "hfp->disconnect_callback",
          "args": [
            "hfp->disconnect_data"
          ],
          "line": 896
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic bool io_disconnected(struct io *io, void *user_data)\n{\n\tstruct hfp_gw *hfp = user_data;\n\n\thfp->in_disconnect = true;\n\n\tif (hfp->disconnect_callback)\n\t\thfp->disconnect_callback(hfp->disconnect_data);\n\n\thfp->in_disconnect = false;\n\n\treturn false;\n}"
  },
  {
    "function_name": "disconnect_watch_destroy",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "878-887",
    "snippet": "static void disconnect_watch_destroy(void *user_data)\n{\n\tstruct hfp_gw *hfp = user_data;\n\n\tif (hfp->disconnect_destroy)\n\t\thfp->disconnect_destroy(hfp->disconnect_data);\n\n\tif (hfp->destroyed)\n\t\tfree(hfp);\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "hfp"
          ],
          "line": 886
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "956-985",
          "snippet": "static void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}"
        }
      },
      {
        "call_info": {
          "callee": "hfp->disconnect_destroy",
          "args": [
            "hfp->disconnect_data"
          ],
          "line": 883
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void disconnect_watch_destroy(void *user_data)\n{\n\tstruct hfp_gw *hfp = user_data;\n\n\tif (hfp->disconnect_destroy)\n\t\thfp->disconnect_destroy(hfp->disconnect_data);\n\n\tif (hfp->destroyed)\n\t\tfree(hfp);\n}"
  },
  {
    "function_name": "hfp_gw_unregister",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "857-876",
    "snippet": "bool hfp_gw_unregister(struct hfp_gw *hfp, const char *prefix)\n{\n\tstruct cmd_handler *handler;\n\tchar *lookup_prefix;\n\n\tlookup_prefix = strdup(prefix);\n\tif (!lookup_prefix)\n\t\treturn false;\n\n\thandler = queue_remove_if(hfp->cmd_handlers, match_handler_prefix,\n\t\t\t\t\t\t\t\tlookup_prefix);\n\tfree(lookup_prefix);\n\n\tif (!handler)\n\t\treturn false;\n\n\tdestroy_cmd_handler(handler);\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "destroy_cmd_handler",
          "args": [
            "handler"
          ],
          "line": 873
        },
        "resolved": true,
        "details": {
          "function_name": "destroy_cmd_handler",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
          "lines": "116-126",
          "snippet": "static void destroy_cmd_handler(void *data)\n{\n\tstruct cmd_handler *handler = data;\n\n\tif (handler->destroy)\n\t\thandler->destroy(handler->user_data);\n\n\tfree(handler->prefix);\n\n\tfree(handler);\n}",
          "includes": [
            "#include \"src/shared/hfp.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <ctype.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void destroy_cmd_handler(void *data)\n{\n\tstruct cmd_handler *handler = data;\n\n\tif (handler->destroy)\n\t\thandler->destroy(handler->user_data);\n\n\tfree(handler->prefix);\n\n\tfree(handler);\n}"
        }
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "lookup_prefix"
          ],
          "line": 868
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "956-985",
          "snippet": "static void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_remove_if",
          "args": [
            "hfp->cmd_handlers",
            "match_handler_prefix",
            "lookup_prefix"
          ],
          "line": 866
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_if",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "278-316",
          "snippet": "void *queue_remove_if(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry, *prev = NULL;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tentry = queue->head;\n\n\twhile (entry) {\n\t\tif (function(entry->data, user_data)) {\n\t\t\tvoid *data;\n\n\t\t\tif (prev)\n\t\t\t\tprev->next = entry->next;\n\t\t\telse\n\t\t\t\tqueue->head = entry->next;\n\n\t\t\tif (!entry->next)\n\t\t\t\tqueue->tail = prev;\n\n\t\t\tdata = entry->data;\n\n\t\t\tfree(entry);\n\t\t\tqueue->entries--;\n\n\t\t\treturn data;\n\t\t} else {\n\t\t\tprev = entry;\n\t\t\tentry = entry->next;\n\t\t}\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid *queue_remove_if(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry, *prev = NULL;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tentry = queue->head;\n\n\twhile (entry) {\n\t\tif (function(entry->data, user_data)) {\n\t\t\tvoid *data;\n\n\t\t\tif (prev)\n\t\t\t\tprev->next = entry->next;\n\t\t\telse\n\t\t\t\tqueue->head = entry->next;\n\n\t\t\tif (!entry->next)\n\t\t\t\tqueue->tail = prev;\n\n\t\t\tdata = entry->data;\n\n\t\t\tfree(entry);\n\t\t\tqueue->entries--;\n\n\t\t\treturn data;\n\t\t} else {\n\t\t\tprev = entry;\n\t\t\tentry = entry->next;\n\t\t}\n\t}\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "prefix"
          ],
          "line": 862
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nbool hfp_gw_unregister(struct hfp_gw *hfp, const char *prefix)\n{\n\tstruct cmd_handler *handler;\n\tchar *lookup_prefix;\n\n\tlookup_prefix = strdup(prefix);\n\tif (!lookup_prefix)\n\t\treturn false;\n\n\thandler = queue_remove_if(hfp->cmd_handlers, match_handler_prefix,\n\t\t\t\t\t\t\t\tlookup_prefix);\n\tfree(lookup_prefix);\n\n\tif (!handler)\n\t\treturn false;\n\n\tdestroy_cmd_handler(handler);\n\n\treturn true;\n}"
  },
  {
    "function_name": "hfp_gw_register",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "829-855",
    "snippet": "bool hfp_gw_register(struct hfp_gw *hfp, hfp_result_func_t callback,\n\t\t\t\t\t\tconst char *prefix,\n\t\t\t\t\t\tvoid *user_data,\n\t\t\t\t\t\thfp_destroy_func_t destroy)\n{\n\tstruct cmd_handler *handler;\n\n\thandler = new0(struct cmd_handler, 1);\n\thandler->callback = callback;\n\thandler->user_data = user_data;\n\n\thandler->prefix = strdup(prefix);\n\tif (!handler->prefix) {\n\t\tfree(handler);\n\t\treturn false;\n\t}\n\n\tif (queue_find(hfp->cmd_handlers, match_handler_prefix,\n\t\t\t\t\t\t\thandler->prefix)) {\n\t\tdestroy_cmd_handler(handler);\n\t\treturn false;\n\t}\n\n\thandler->destroy = destroy;\n\n\treturn queue_push_tail(hfp->cmd_handlers, handler);\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_push_tail",
          "args": [
            "hfp->cmd_handlers",
            "handler"
          ],
          "line": 854
        },
        "resolved": true,
        "details": {
          "function_name": "queue_push_tail",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "88-108",
          "snippet": "bool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "destroy_cmd_handler",
          "args": [
            "handler"
          ],
          "line": 848
        },
        "resolved": true,
        "details": {
          "function_name": "destroy_cmd_handler",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
          "lines": "116-126",
          "snippet": "static void destroy_cmd_handler(void *data)\n{\n\tstruct cmd_handler *handler = data;\n\n\tif (handler->destroy)\n\t\thandler->destroy(handler->user_data);\n\n\tfree(handler->prefix);\n\n\tfree(handler);\n}",
          "includes": [
            "#include \"src/shared/hfp.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <ctype.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void destroy_cmd_handler(void *data)\n{\n\tstruct cmd_handler *handler = data;\n\n\tif (handler->destroy)\n\t\thandler->destroy(handler->user_data);\n\n\tfree(handler->prefix);\n\n\tfree(handler);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_find",
          "args": [
            "hfp->cmd_handlers",
            "match_handler_prefix",
            "handler->prefix"
          ],
          "line": 846
        },
        "resolved": true,
        "details": {
          "function_name": "queue_find",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "231-247",
          "snippet": "void *queue_find(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tconst void *match_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tfor (entry = queue->head; entry; entry = entry->next)\n\t\tif (function(entry->data, match_data))\n\t\t\treturn entry->data;\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid *queue_find(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tconst void *match_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tfor (entry = queue->head; entry; entry = entry->next)\n\t\tif (function(entry->data, match_data))\n\t\t\treturn entry->data;\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "handler"
          ],
          "line": 842
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "956-985",
          "snippet": "static void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}"
        }
      },
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "prefix"
          ],
          "line": 840
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "new0",
          "args": [
            "structcmd_handler",
            "1"
          ],
          "line": 836
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nbool hfp_gw_register(struct hfp_gw *hfp, hfp_result_func_t callback,\n\t\t\t\t\t\tconst char *prefix,\n\t\t\t\t\t\tvoid *user_data,\n\t\t\t\t\t\thfp_destroy_func_t destroy)\n{\n\tstruct cmd_handler *handler;\n\n\thandler = new0(struct cmd_handler, 1);\n\thandler->callback = callback;\n\thandler->user_data = user_data;\n\n\thandler->prefix = strdup(prefix);\n\tif (!handler->prefix) {\n\t\tfree(handler);\n\t\treturn false;\n\t}\n\n\tif (queue_find(hfp->cmd_handlers, match_handler_prefix,\n\t\t\t\t\t\t\thandler->prefix)) {\n\t\tdestroy_cmd_handler(handler);\n\t\treturn false;\n\t}\n\n\thandler->destroy = destroy;\n\n\treturn queue_push_tail(hfp->cmd_handlers, handler);\n}"
  },
  {
    "function_name": "hfp_gw_set_command_handler",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "812-827",
    "snippet": "bool hfp_gw_set_command_handler(struct hfp_gw *hfp,\n\t\t\t\thfp_command_func_t callback,\n\t\t\t\tvoid *user_data, hfp_destroy_func_t destroy)\n{\n\tif (!hfp)\n\t\treturn false;\n\n\tif (hfp->command_destroy)\n\t\thfp->command_destroy(hfp->command_data);\n\n\thfp->command_callback = callback;\n\thfp->command_destroy = destroy;\n\thfp->command_data = user_data;\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "hfp->command_destroy",
          "args": [
            "hfp->command_data"
          ],
          "line": 820
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nbool hfp_gw_set_command_handler(struct hfp_gw *hfp,\n\t\t\t\thfp_command_func_t callback,\n\t\t\t\tvoid *user_data, hfp_destroy_func_t destroy)\n{\n\tif (!hfp)\n\t\treturn false;\n\n\tif (hfp->command_destroy)\n\t\thfp->command_destroy(hfp->command_data);\n\n\thfp->command_callback = callback;\n\thfp->command_destroy = destroy;\n\thfp->command_data = user_data;\n\n\treturn true;\n}"
  },
  {
    "function_name": "hfp_gw_send_info",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "783-810",
    "snippet": "bool hfp_gw_send_info(struct hfp_gw *hfp, const char *format, ...)\n{\n\tva_list ap;\n\tchar *fmt;\n\tint len;\n\n\tif (!hfp || !format)\n\t\treturn false;\n\n\tif (asprintf(&fmt, \"\\r\\n%s\\r\\n\", format) < 0)\n\t\treturn false;\n\n\tva_start(ap, format);\n\tlen = ringbuf_vprintf(hfp->write_buf, fmt, ap);\n\tva_end(ap);\n\n\tfree(fmt);\n\n\tif (len < 0)\n\t\treturn false;\n\n\tif (hfp->result_pending)\n\t\treturn true;\n\n\twakeup_writer(hfp);\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "wakeup_writer",
          "args": [
            "hfp"
          ],
          "line": 807
        },
        "resolved": true,
        "details": {
          "function_name": "hf_wakeup_writer",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
          "lines": "1055-1068",
          "snippet": "static void hf_wakeup_writer(struct hfp_hf *hfp)\n{\n\tif (hfp->writer_active)\n\t\treturn;\n\n\tif (!ringbuf_len(hfp->write_buf))\n\t\treturn;\n\n\tif (!io_set_write_handler(hfp->io, hf_can_write_data,\n\t\t\t\t\thfp, hf_write_watch_destroy))\n\t\treturn;\n\n\thfp->writer_active = true;\n}",
          "includes": [
            "#include \"src/shared/hfp.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <ctype.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void hf_wakeup_writer(struct hfp_hf *hfp)\n{\n\tif (hfp->writer_active)\n\t\treturn;\n\n\tif (!ringbuf_len(hfp->write_buf))\n\t\treturn;\n\n\tif (!io_set_write_handler(hfp->io, hf_can_write_data,\n\t\t\t\t\thfp, hf_write_watch_destroy))\n\t\treturn;\n\n\thfp->writer_active = true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "fmt"
          ],
          "line": 799
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "956-985",
          "snippet": "static void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}"
        }
      },
      {
        "call_info": {
          "callee": "va_end",
          "args": [
            "ap"
          ],
          "line": 797
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ringbuf_vprintf",
          "args": [
            "hfp->write_buf",
            "fmt",
            "ap"
          ],
          "line": 796
        },
        "resolved": true,
        "details": {
          "function_name": "ringbuf_vprintf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ringbuf.c",
          "lines": "220-266",
          "snippet": "int ringbuf_vprintf(struct ringbuf *ringbuf, const char *format, va_list ap)\n{\n\tsize_t avail, offset, end;\n\tchar *str;\n\tint len;\n\n\tif (!ringbuf || !format)\n\t\treturn -1;\n\n\t/* Determine maximum length available for string */\n\tavail = ringbuf->size - ringbuf->in + ringbuf->out;\n\tif (!avail)\n\t\treturn -1;\n\n\tlen = vasprintf(&str, format, ap);\n\tif (len < 0)\n\t\treturn -1;\n\n\tif ((size_t) len > avail) {\n\t\tfree(str);\n\t\treturn -1;\n\t}\n\n\t/* Determine possible length of string before wrapping */\n\toffset = ringbuf->in & (ringbuf->size - 1);\n\tend = MIN((size_t) len, ringbuf->size - offset);\n\tmemcpy(ringbuf->buffer + offset, str, end);\n\n\tif (ringbuf->in_tracing)\n\t\tringbuf->in_tracing(ringbuf->buffer + offset, end,\n\t\t\t\t\t\t\tringbuf->in_data);\n\n\tif (len - end > 0) {\n\t\t/* Put the remainder of string at the beginning */\n\t\tmemcpy(ringbuf->buffer, str + end, len - end);\n\n\t\tif (ringbuf->in_tracing)\n\t\t\tringbuf->in_tracing(ringbuf->buffer, len - end,\n\t\t\t\t\t\t\tringbuf->in_data);\n\t}\n\n\tfree(str);\n\n\tringbuf->in += len;\n\n\treturn len;\n}",
          "includes": [
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <sys/param.h>",
            "#include <sys/uio.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <sys/param.h>\n#include <sys/uio.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nint ringbuf_vprintf(struct ringbuf *ringbuf, const char *format, va_list ap)\n{\n\tsize_t avail, offset, end;\n\tchar *str;\n\tint len;\n\n\tif (!ringbuf || !format)\n\t\treturn -1;\n\n\t/* Determine maximum length available for string */\n\tavail = ringbuf->size - ringbuf->in + ringbuf->out;\n\tif (!avail)\n\t\treturn -1;\n\n\tlen = vasprintf(&str, format, ap);\n\tif (len < 0)\n\t\treturn -1;\n\n\tif ((size_t) len > avail) {\n\t\tfree(str);\n\t\treturn -1;\n\t}\n\n\t/* Determine possible length of string before wrapping */\n\toffset = ringbuf->in & (ringbuf->size - 1);\n\tend = MIN((size_t) len, ringbuf->size - offset);\n\tmemcpy(ringbuf->buffer + offset, str, end);\n\n\tif (ringbuf->in_tracing)\n\t\tringbuf->in_tracing(ringbuf->buffer + offset, end,\n\t\t\t\t\t\t\tringbuf->in_data);\n\n\tif (len - end > 0) {\n\t\t/* Put the remainder of string at the beginning */\n\t\tmemcpy(ringbuf->buffer, str + end, len - end);\n\n\t\tif (ringbuf->in_tracing)\n\t\t\tringbuf->in_tracing(ringbuf->buffer, len - end,\n\t\t\t\t\t\t\tringbuf->in_data);\n\t}\n\n\tfree(str);\n\n\tringbuf->in += len;\n\n\treturn len;\n}"
        }
      },
      {
        "call_info": {
          "callee": "va_start",
          "args": [
            "ap",
            "format"
          ],
          "line": 795
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "asprintf",
          "args": [
            "&fmt",
            "\"\\r\\n%s\\r\\n\"",
            "format"
          ],
          "line": 792
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nbool hfp_gw_send_info(struct hfp_gw *hfp, const char *format, ...)\n{\n\tva_list ap;\n\tchar *fmt;\n\tint len;\n\n\tif (!hfp || !format)\n\t\treturn false;\n\n\tif (asprintf(&fmt, \"\\r\\n%s\\r\\n\", format) < 0)\n\t\treturn false;\n\n\tva_start(ap, format);\n\tlen = ringbuf_vprintf(hfp->write_buf, fmt, ap);\n\tva_end(ap);\n\n\tfree(fmt);\n\n\tif (len < 0)\n\t\treturn false;\n\n\tif (hfp->result_pending)\n\t\treturn true;\n\n\twakeup_writer(hfp);\n\n\treturn true;\n}"
  },
  {
    "function_name": "hfp_gw_send_error",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "761-781",
    "snippet": "bool hfp_gw_send_error(struct hfp_gw *hfp, enum hfp_error error)\n{\n\tif (!hfp)\n\t\treturn false;\n\n\tif (ringbuf_printf(hfp->write_buf, \"\\r\\n+CME ERROR: %u\\r\\n\", error) < 0)\n\t\treturn false;\n\n\twakeup_writer(hfp);\n\n\t/*\n\t * There might be already something to read in the ring buffer.\n\t * If so, let's read it.\n\t */\n\tif (hfp->result_pending) {\n\t\thfp->result_pending = false;\n\t\tprocess_input(hfp);\n\t}\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "process_input",
          "args": [
            "hfp"
          ],
          "line": 777
        },
        "resolved": true,
        "details": {
          "function_name": "hf_process_input",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
          "lines": "1155-1228",
          "snippet": "static void hf_process_input(struct hfp_hf *hfp)\n{\n\tchar *str, *ptr, *str2, *tmp;\n\tsize_t len, count, offset, len2;\n\tbool free_tmp = false;\n\n\tstr = ringbuf_peek(hfp->read_buf, 0, &len);\n\tif (!str)\n\t\treturn;\n\n\toffset = 0;\n\n\tptr = find_cr_lf(str, len);\n\twhile (ptr) {\n\t\tcount = ptr - (str + offset);\n\t\tif (count == 0) {\n\t\t\t/* 2 is for <cr><lf> */\n\t\t\toffset += 2;\n\t\t} else {\n\t\t\t*ptr = '\\0';\n\t\t\thf_call_prefix_handler(hfp, str + offset);\n\t\t\toffset += count + 2;\n\t\t}\n\n\t\tptr = find_cr_lf(str + offset, len - offset);\n\t}\n\n\t/*\n\t * Just check if there is no wrapped data in ring buffer.\n\t * Should not happen too often\n\t */\n\tif (len == ringbuf_len(hfp->read_buf))\n\t\tgoto done;\n\n\tstr2 = ringbuf_peek(hfp->read_buf, len, &len2);\n\tif (!str2)\n\t\tgoto done;\n\n\tptr = find_cr_lf(str2, len2);\n\tif (!ptr) {\n\t\t/* Might happen that we wrap between \\r and \\n */\n\t\tptr = memchr(str2, '\\n', len2);\n\t\tif (!ptr)\n\t\t\tgoto done;\n\t}\n\n\tcount = ptr - str2;\n\n\tif (count) {\n\t\t*ptr = '\\0';\n\n\t\ttmp = malloc(len + count);\n\t\tif (!tmp)\n\t\t\tgoto done;\n\n\t\t/* \"str\" here is not a string so we need to use memcpy */\n\t\tmemcpy(tmp, str, len);\n\t\tmemcpy(tmp + len, str2, count);\n\n\t\tfree_tmp = true;\n\t} else {\n\t\tstr[len-1] = '\\0';\n\t\ttmp = str;\n\t}\n\n\thf_call_prefix_handler(hfp, tmp);\n\toffset += count;\n\ndone:\n\tringbuf_drain(hfp->read_buf, offset);\n\n\tif (free_tmp)\n\t\tfree(tmp);\n}",
          "includes": [
            "#include \"src/shared/hfp.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <ctype.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void hf_process_input(struct hfp_hf *hfp)\n{\n\tchar *str, *ptr, *str2, *tmp;\n\tsize_t len, count, offset, len2;\n\tbool free_tmp = false;\n\n\tstr = ringbuf_peek(hfp->read_buf, 0, &len);\n\tif (!str)\n\t\treturn;\n\n\toffset = 0;\n\n\tptr = find_cr_lf(str, len);\n\twhile (ptr) {\n\t\tcount = ptr - (str + offset);\n\t\tif (count == 0) {\n\t\t\t/* 2 is for <cr><lf> */\n\t\t\toffset += 2;\n\t\t} else {\n\t\t\t*ptr = '\\0';\n\t\t\thf_call_prefix_handler(hfp, str + offset);\n\t\t\toffset += count + 2;\n\t\t}\n\n\t\tptr = find_cr_lf(str + offset, len - offset);\n\t}\n\n\t/*\n\t * Just check if there is no wrapped data in ring buffer.\n\t * Should not happen too often\n\t */\n\tif (len == ringbuf_len(hfp->read_buf))\n\t\tgoto done;\n\n\tstr2 = ringbuf_peek(hfp->read_buf, len, &len2);\n\tif (!str2)\n\t\tgoto done;\n\n\tptr = find_cr_lf(str2, len2);\n\tif (!ptr) {\n\t\t/* Might happen that we wrap between \\r and \\n */\n\t\tptr = memchr(str2, '\\n', len2);\n\t\tif (!ptr)\n\t\t\tgoto done;\n\t}\n\n\tcount = ptr - str2;\n\n\tif (count) {\n\t\t*ptr = '\\0';\n\n\t\ttmp = malloc(len + count);\n\t\tif (!tmp)\n\t\t\tgoto done;\n\n\t\t/* \"str\" here is not a string so we need to use memcpy */\n\t\tmemcpy(tmp, str, len);\n\t\tmemcpy(tmp + len, str2, count);\n\n\t\tfree_tmp = true;\n\t} else {\n\t\tstr[len-1] = '\\0';\n\t\ttmp = str;\n\t}\n\n\thf_call_prefix_handler(hfp, tmp);\n\toffset += count;\n\ndone:\n\tringbuf_drain(hfp->read_buf, offset);\n\n\tif (free_tmp)\n\t\tfree(tmp);\n}"
        }
      },
      {
        "call_info": {
          "callee": "wakeup_writer",
          "args": [
            "hfp"
          ],
          "line": 769
        },
        "resolved": true,
        "details": {
          "function_name": "hf_wakeup_writer",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
          "lines": "1055-1068",
          "snippet": "static void hf_wakeup_writer(struct hfp_hf *hfp)\n{\n\tif (hfp->writer_active)\n\t\treturn;\n\n\tif (!ringbuf_len(hfp->write_buf))\n\t\treturn;\n\n\tif (!io_set_write_handler(hfp->io, hf_can_write_data,\n\t\t\t\t\thfp, hf_write_watch_destroy))\n\t\treturn;\n\n\thfp->writer_active = true;\n}",
          "includes": [
            "#include \"src/shared/hfp.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <ctype.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void hf_wakeup_writer(struct hfp_hf *hfp)\n{\n\tif (hfp->writer_active)\n\t\treturn;\n\n\tif (!ringbuf_len(hfp->write_buf))\n\t\treturn;\n\n\tif (!io_set_write_handler(hfp->io, hf_can_write_data,\n\t\t\t\t\thfp, hf_write_watch_destroy))\n\t\treturn;\n\n\thfp->writer_active = true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ringbuf_printf",
          "args": [
            "hfp->write_buf",
            "\"\\r\\n+CME ERROR: %u\\r\\n\"",
            "error"
          ],
          "line": 766
        },
        "resolved": true,
        "details": {
          "function_name": "ringbuf_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ringbuf.c",
          "lines": "208-218",
          "snippet": "int ringbuf_printf(struct ringbuf *ringbuf, const char *format, ...)\n{\n\tva_list ap;\n\tint len;\n\n\tva_start(ap, format);\n\tlen = ringbuf_vprintf(ringbuf, format, ap);\n\tva_end(ap);\n\n\treturn len;\n}",
          "includes": [
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <sys/param.h>",
            "#include <sys/uio.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <sys/param.h>\n#include <sys/uio.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nint ringbuf_printf(struct ringbuf *ringbuf, const char *format, ...)\n{\n\tva_list ap;\n\tint len;\n\n\tva_start(ap, format);\n\tlen = ringbuf_vprintf(ringbuf, format, ap);\n\tva_end(ap);\n\n\treturn len;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nbool hfp_gw_send_error(struct hfp_gw *hfp, enum hfp_error error)\n{\n\tif (!hfp)\n\t\treturn false;\n\n\tif (ringbuf_printf(hfp->write_buf, \"\\r\\n+CME ERROR: %u\\r\\n\", error) < 0)\n\t\treturn false;\n\n\twakeup_writer(hfp);\n\n\t/*\n\t * There might be already something to read in the ring buffer.\n\t * If so, let's read it.\n\t */\n\tif (hfp->result_pending) {\n\t\thfp->result_pending = false;\n\t\tprocess_input(hfp);\n\t}\n\n\treturn true;\n}"
  },
  {
    "function_name": "hfp_gw_send_result",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "717-759",
    "snippet": "bool hfp_gw_send_result(struct hfp_gw *hfp, enum hfp_result result)\n{\n\tconst char *str;\n\n\tif (!hfp)\n\t\treturn false;\n\n\tswitch (result) {\n\tcase HFP_RESULT_OK:\n\t\tstr = \"OK\";\n\t\tbreak;\n\tcase HFP_RESULT_ERROR:\n\t\tstr = \"ERROR\";\n\t\tbreak;\n\tcase HFP_RESULT_RING:\n\tcase HFP_RESULT_NO_CARRIER:\n\tcase HFP_RESULT_BUSY:\n\tcase HFP_RESULT_NO_ANSWER:\n\tcase HFP_RESULT_DELAYED:\n\tcase HFP_RESULT_BLACKLISTED:\n\tcase HFP_RESULT_CME_ERROR:\n\tcase HFP_RESULT_NO_DIALTONE:\n\tcase HFP_RESULT_CONNECT:\n\tdefault:\n\t\treturn false;\n\t}\n\n\tif (ringbuf_printf(hfp->write_buf, \"\\r\\n%s\\r\\n\", str) < 0)\n\t\treturn false;\n\n\twakeup_writer(hfp);\n\n\t/*\n\t * There might be already something to read in the ring buffer.\n\t * If so, let's read it.\n\t */\n\tif (hfp->result_pending) {\n\t\thfp->result_pending = false;\n\t\tprocess_input(hfp);\n\t}\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "process_input",
          "args": [
            "hfp"
          ],
          "line": 755
        },
        "resolved": true,
        "details": {
          "function_name": "hf_process_input",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
          "lines": "1155-1228",
          "snippet": "static void hf_process_input(struct hfp_hf *hfp)\n{\n\tchar *str, *ptr, *str2, *tmp;\n\tsize_t len, count, offset, len2;\n\tbool free_tmp = false;\n\n\tstr = ringbuf_peek(hfp->read_buf, 0, &len);\n\tif (!str)\n\t\treturn;\n\n\toffset = 0;\n\n\tptr = find_cr_lf(str, len);\n\twhile (ptr) {\n\t\tcount = ptr - (str + offset);\n\t\tif (count == 0) {\n\t\t\t/* 2 is for <cr><lf> */\n\t\t\toffset += 2;\n\t\t} else {\n\t\t\t*ptr = '\\0';\n\t\t\thf_call_prefix_handler(hfp, str + offset);\n\t\t\toffset += count + 2;\n\t\t}\n\n\t\tptr = find_cr_lf(str + offset, len - offset);\n\t}\n\n\t/*\n\t * Just check if there is no wrapped data in ring buffer.\n\t * Should not happen too often\n\t */\n\tif (len == ringbuf_len(hfp->read_buf))\n\t\tgoto done;\n\n\tstr2 = ringbuf_peek(hfp->read_buf, len, &len2);\n\tif (!str2)\n\t\tgoto done;\n\n\tptr = find_cr_lf(str2, len2);\n\tif (!ptr) {\n\t\t/* Might happen that we wrap between \\r and \\n */\n\t\tptr = memchr(str2, '\\n', len2);\n\t\tif (!ptr)\n\t\t\tgoto done;\n\t}\n\n\tcount = ptr - str2;\n\n\tif (count) {\n\t\t*ptr = '\\0';\n\n\t\ttmp = malloc(len + count);\n\t\tif (!tmp)\n\t\t\tgoto done;\n\n\t\t/* \"str\" here is not a string so we need to use memcpy */\n\t\tmemcpy(tmp, str, len);\n\t\tmemcpy(tmp + len, str2, count);\n\n\t\tfree_tmp = true;\n\t} else {\n\t\tstr[len-1] = '\\0';\n\t\ttmp = str;\n\t}\n\n\thf_call_prefix_handler(hfp, tmp);\n\toffset += count;\n\ndone:\n\tringbuf_drain(hfp->read_buf, offset);\n\n\tif (free_tmp)\n\t\tfree(tmp);\n}",
          "includes": [
            "#include \"src/shared/hfp.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <ctype.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void hf_process_input(struct hfp_hf *hfp)\n{\n\tchar *str, *ptr, *str2, *tmp;\n\tsize_t len, count, offset, len2;\n\tbool free_tmp = false;\n\n\tstr = ringbuf_peek(hfp->read_buf, 0, &len);\n\tif (!str)\n\t\treturn;\n\n\toffset = 0;\n\n\tptr = find_cr_lf(str, len);\n\twhile (ptr) {\n\t\tcount = ptr - (str + offset);\n\t\tif (count == 0) {\n\t\t\t/* 2 is for <cr><lf> */\n\t\t\toffset += 2;\n\t\t} else {\n\t\t\t*ptr = '\\0';\n\t\t\thf_call_prefix_handler(hfp, str + offset);\n\t\t\toffset += count + 2;\n\t\t}\n\n\t\tptr = find_cr_lf(str + offset, len - offset);\n\t}\n\n\t/*\n\t * Just check if there is no wrapped data in ring buffer.\n\t * Should not happen too often\n\t */\n\tif (len == ringbuf_len(hfp->read_buf))\n\t\tgoto done;\n\n\tstr2 = ringbuf_peek(hfp->read_buf, len, &len2);\n\tif (!str2)\n\t\tgoto done;\n\n\tptr = find_cr_lf(str2, len2);\n\tif (!ptr) {\n\t\t/* Might happen that we wrap between \\r and \\n */\n\t\tptr = memchr(str2, '\\n', len2);\n\t\tif (!ptr)\n\t\t\tgoto done;\n\t}\n\n\tcount = ptr - str2;\n\n\tif (count) {\n\t\t*ptr = '\\0';\n\n\t\ttmp = malloc(len + count);\n\t\tif (!tmp)\n\t\t\tgoto done;\n\n\t\t/* \"str\" here is not a string so we need to use memcpy */\n\t\tmemcpy(tmp, str, len);\n\t\tmemcpy(tmp + len, str2, count);\n\n\t\tfree_tmp = true;\n\t} else {\n\t\tstr[len-1] = '\\0';\n\t\ttmp = str;\n\t}\n\n\thf_call_prefix_handler(hfp, tmp);\n\toffset += count;\n\ndone:\n\tringbuf_drain(hfp->read_buf, offset);\n\n\tif (free_tmp)\n\t\tfree(tmp);\n}"
        }
      },
      {
        "call_info": {
          "callee": "wakeup_writer",
          "args": [
            "hfp"
          ],
          "line": 747
        },
        "resolved": true,
        "details": {
          "function_name": "hf_wakeup_writer",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
          "lines": "1055-1068",
          "snippet": "static void hf_wakeup_writer(struct hfp_hf *hfp)\n{\n\tif (hfp->writer_active)\n\t\treturn;\n\n\tif (!ringbuf_len(hfp->write_buf))\n\t\treturn;\n\n\tif (!io_set_write_handler(hfp->io, hf_can_write_data,\n\t\t\t\t\thfp, hf_write_watch_destroy))\n\t\treturn;\n\n\thfp->writer_active = true;\n}",
          "includes": [
            "#include \"src/shared/hfp.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <ctype.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void hf_wakeup_writer(struct hfp_hf *hfp)\n{\n\tif (hfp->writer_active)\n\t\treturn;\n\n\tif (!ringbuf_len(hfp->write_buf))\n\t\treturn;\n\n\tif (!io_set_write_handler(hfp->io, hf_can_write_data,\n\t\t\t\t\thfp, hf_write_watch_destroy))\n\t\treturn;\n\n\thfp->writer_active = true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ringbuf_printf",
          "args": [
            "hfp->write_buf",
            "\"\\r\\n%s\\r\\n\"",
            "str"
          ],
          "line": 744
        },
        "resolved": true,
        "details": {
          "function_name": "ringbuf_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ringbuf.c",
          "lines": "208-218",
          "snippet": "int ringbuf_printf(struct ringbuf *ringbuf, const char *format, ...)\n{\n\tva_list ap;\n\tint len;\n\n\tva_start(ap, format);\n\tlen = ringbuf_vprintf(ringbuf, format, ap);\n\tva_end(ap);\n\n\treturn len;\n}",
          "includes": [
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <sys/param.h>",
            "#include <sys/uio.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <sys/param.h>\n#include <sys/uio.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nint ringbuf_printf(struct ringbuf *ringbuf, const char *format, ...)\n{\n\tva_list ap;\n\tint len;\n\n\tva_start(ap, format);\n\tlen = ringbuf_vprintf(ringbuf, format, ap);\n\tva_end(ap);\n\n\treturn len;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nbool hfp_gw_send_result(struct hfp_gw *hfp, enum hfp_result result)\n{\n\tconst char *str;\n\n\tif (!hfp)\n\t\treturn false;\n\n\tswitch (result) {\n\tcase HFP_RESULT_OK:\n\t\tstr = \"OK\";\n\t\tbreak;\n\tcase HFP_RESULT_ERROR:\n\t\tstr = \"ERROR\";\n\t\tbreak;\n\tcase HFP_RESULT_RING:\n\tcase HFP_RESULT_NO_CARRIER:\n\tcase HFP_RESULT_BUSY:\n\tcase HFP_RESULT_NO_ANSWER:\n\tcase HFP_RESULT_DELAYED:\n\tcase HFP_RESULT_BLACKLISTED:\n\tcase HFP_RESULT_CME_ERROR:\n\tcase HFP_RESULT_NO_DIALTONE:\n\tcase HFP_RESULT_CONNECT:\n\tdefault:\n\t\treturn false;\n\t}\n\n\tif (ringbuf_printf(hfp->write_buf, \"\\r\\n%s\\r\\n\", str) < 0)\n\t\treturn false;\n\n\twakeup_writer(hfp);\n\n\t/*\n\t * There might be already something to read in the ring buffer.\n\t * If so, let's read it.\n\t */\n\tif (hfp->result_pending) {\n\t\thfp->result_pending = false;\n\t\tprocess_input(hfp);\n\t}\n\n\treturn true;\n}"
  },
  {
    "function_name": "hfp_gw_set_close_on_unref",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "707-715",
    "snippet": "bool hfp_gw_set_close_on_unref(struct hfp_gw *hfp, bool do_close)\n{\n\tif (!hfp)\n\t\treturn false;\n\n\thfp->close_on_unref = do_close;\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nbool hfp_gw_set_close_on_unref(struct hfp_gw *hfp, bool do_close)\n{\n\tif (!hfp)\n\t\treturn false;\n\n\thfp->close_on_unref = do_close;\n\n\treturn true;\n}"
  },
  {
    "function_name": "hfp_gw_set_debug",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "683-705",
    "snippet": "bool hfp_gw_set_debug(struct hfp_gw *hfp, hfp_debug_func_t callback,\n\t\t\t\tvoid *user_data, hfp_destroy_func_t destroy)\n{\n\tif (!hfp)\n\t\treturn false;\n\n\tif (hfp->debug_destroy)\n\t\thfp->debug_destroy(hfp->debug_data);\n\n\thfp->debug_callback = callback;\n\thfp->debug_destroy = destroy;\n\thfp->debug_data = user_data;\n\n\tif (hfp->debug_callback) {\n\t\tringbuf_set_input_tracing(hfp->read_buf, read_tracing, hfp);\n\t\tringbuf_set_input_tracing(hfp->write_buf, write_tracing, hfp);\n\t} else {\n\t\tringbuf_set_input_tracing(hfp->read_buf, NULL, NULL);\n\t\tringbuf_set_input_tracing(hfp->write_buf, NULL, NULL);\n\t}\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ringbuf_set_input_tracing",
          "args": [
            "hfp->write_buf",
            "NULL",
            "NULL"
          ],
          "line": 701
        },
        "resolved": true,
        "details": {
          "function_name": "ringbuf_set_input_tracing",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ringbuf.c",
          "lines": "97-107",
          "snippet": "bool ringbuf_set_input_tracing(struct ringbuf *ringbuf,\n\t\t\tringbuf_tracing_func_t callback, void *user_data)\n{\n\tif (!ringbuf)\n\t\treturn false;\n\n\tringbuf->in_tracing = callback;\n\tringbuf->in_data = user_data;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <sys/param.h>",
            "#include <sys/uio.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <sys/param.h>\n#include <sys/uio.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nbool ringbuf_set_input_tracing(struct ringbuf *ringbuf,\n\t\t\tringbuf_tracing_func_t callback, void *user_data)\n{\n\tif (!ringbuf)\n\t\treturn false;\n\n\tringbuf->in_tracing = callback;\n\tringbuf->in_data = user_data;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "hfp->debug_destroy",
          "args": [
            "hfp->debug_data"
          ],
          "line": 690
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nbool hfp_gw_set_debug(struct hfp_gw *hfp, hfp_debug_func_t callback,\n\t\t\t\tvoid *user_data, hfp_destroy_func_t destroy)\n{\n\tif (!hfp)\n\t\treturn false;\n\n\tif (hfp->debug_destroy)\n\t\thfp->debug_destroy(hfp->debug_data);\n\n\thfp->debug_callback = callback;\n\thfp->debug_destroy = destroy;\n\thfp->debug_data = user_data;\n\n\tif (hfp->debug_callback) {\n\t\tringbuf_set_input_tracing(hfp->read_buf, read_tracing, hfp);\n\t\tringbuf_set_input_tracing(hfp->write_buf, write_tracing, hfp);\n\t} else {\n\t\tringbuf_set_input_tracing(hfp->read_buf, NULL, NULL);\n\t\tringbuf_set_input_tracing(hfp->write_buf, NULL, NULL);\n\t}\n\n\treturn true;\n}"
  },
  {
    "function_name": "write_tracing",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "676-681",
    "snippet": "static void write_tracing(const void *buf, size_t count, void *user_data)\n{\n\tstruct hfp_gw *hfp = user_data;\n\n\tutil_hexdump('<', buf, count, hfp->debug_callback, hfp->debug_data);\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "util_hexdump",
          "args": [
            "'<'",
            "buf",
            "count",
            "hfp->debug_callback",
            "hfp->debug_data"
          ],
          "line": 680
        },
        "resolved": true,
        "details": {
          "function_name": "util_hexdump",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/util.c",
          "lines": "73-113",
          "snippet": "void util_hexdump(const char dir, const unsigned char *buf, size_t len,\n\t\t\t\tutil_debug_func_t function, void *user_data)\n{\n\tstatic const char hexdigits[] = \"0123456789abcdef\";\n\tchar str[68];\n\tsize_t i;\n\n\tif (!function || !len)\n\t\treturn;\n\n\tstr[0] = dir;\n\n\tfor (i = 0; i < len; i++) {\n\t\tstr[((i % 16) * 3) + 1] = ' ';\n\t\tstr[((i % 16) * 3) + 2] = hexdigits[buf[i] >> 4];\n\t\tstr[((i % 16) * 3) + 3] = hexdigits[buf[i] & 0xf];\n\t\tstr[(i % 16) + 51] = isprint(buf[i]) ? buf[i] : '.';\n\n\t\tif ((i + 1) % 16 == 0) {\n\t\t\tstr[49] = ' ';\n\t\t\tstr[50] = ' ';\n\t\t\tstr[67] = '\\0';\n\t\t\tfunction(str, user_data);\n\t\t\tstr[0] = ' ';\n\t\t}\n\t}\n\n\tif (i % 16 > 0) {\n\t\tsize_t j;\n\t\tfor (j = (i % 16); j < 16; j++) {\n\t\t\tstr[(j * 3) + 1] = ' ';\n\t\t\tstr[(j * 3) + 2] = ' ';\n\t\t\tstr[(j * 3) + 3] = ' ';\n\t\t\tstr[j + 51] = ' ';\n\t\t}\n\t\tstr[49] = ' ';\n\t\tstr[50] = ' ';\n\t\tstr[67] = '\\0';\n\t\tfunction(str, user_data);\n\t}\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include <string.h>",
            "#include <limits.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include <string.h>\n#include <limits.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid util_hexdump(const char dir, const unsigned char *buf, size_t len,\n\t\t\t\tutil_debug_func_t function, void *user_data)\n{\n\tstatic const char hexdigits[] = \"0123456789abcdef\";\n\tchar str[68];\n\tsize_t i;\n\n\tif (!function || !len)\n\t\treturn;\n\n\tstr[0] = dir;\n\n\tfor (i = 0; i < len; i++) {\n\t\tstr[((i % 16) * 3) + 1] = ' ';\n\t\tstr[((i % 16) * 3) + 2] = hexdigits[buf[i] >> 4];\n\t\tstr[((i % 16) * 3) + 3] = hexdigits[buf[i] & 0xf];\n\t\tstr[(i % 16) + 51] = isprint(buf[i]) ? buf[i] : '.';\n\n\t\tif ((i + 1) % 16 == 0) {\n\t\t\tstr[49] = ' ';\n\t\t\tstr[50] = ' ';\n\t\t\tstr[67] = '\\0';\n\t\t\tfunction(str, user_data);\n\t\t\tstr[0] = ' ';\n\t\t}\n\t}\n\n\tif (i % 16 > 0) {\n\t\tsize_t j;\n\t\tfor (j = (i % 16); j < 16; j++) {\n\t\t\tstr[(j * 3) + 1] = ' ';\n\t\t\tstr[(j * 3) + 2] = ' ';\n\t\t\tstr[(j * 3) + 3] = ' ';\n\t\t\tstr[j + 51] = ' ';\n\t\t}\n\t\tstr[49] = ' ';\n\t\tstr[50] = ' ';\n\t\tstr[67] = '\\0';\n\t\tfunction(str, user_data);\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void write_tracing(const void *buf, size_t count, void *user_data)\n{\n\tstruct hfp_gw *hfp = user_data;\n\n\tutil_hexdump('<', buf, count, hfp->debug_callback, hfp->debug_data);\n}"
  },
  {
    "function_name": "read_tracing",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "669-674",
    "snippet": "static void read_tracing(const void *buf, size_t count, void *user_data)\n{\n\tstruct hfp_gw *hfp = user_data;\n\n\tutil_hexdump('>', buf, count, hfp->debug_callback, hfp->debug_data);\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "util_hexdump",
          "args": [
            "'>'",
            "buf",
            "count",
            "hfp->debug_callback",
            "hfp->debug_data"
          ],
          "line": 673
        },
        "resolved": true,
        "details": {
          "function_name": "util_hexdump",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/util.c",
          "lines": "73-113",
          "snippet": "void util_hexdump(const char dir, const unsigned char *buf, size_t len,\n\t\t\t\tutil_debug_func_t function, void *user_data)\n{\n\tstatic const char hexdigits[] = \"0123456789abcdef\";\n\tchar str[68];\n\tsize_t i;\n\n\tif (!function || !len)\n\t\treturn;\n\n\tstr[0] = dir;\n\n\tfor (i = 0; i < len; i++) {\n\t\tstr[((i % 16) * 3) + 1] = ' ';\n\t\tstr[((i % 16) * 3) + 2] = hexdigits[buf[i] >> 4];\n\t\tstr[((i % 16) * 3) + 3] = hexdigits[buf[i] & 0xf];\n\t\tstr[(i % 16) + 51] = isprint(buf[i]) ? buf[i] : '.';\n\n\t\tif ((i + 1) % 16 == 0) {\n\t\t\tstr[49] = ' ';\n\t\t\tstr[50] = ' ';\n\t\t\tstr[67] = '\\0';\n\t\t\tfunction(str, user_data);\n\t\t\tstr[0] = ' ';\n\t\t}\n\t}\n\n\tif (i % 16 > 0) {\n\t\tsize_t j;\n\t\tfor (j = (i % 16); j < 16; j++) {\n\t\t\tstr[(j * 3) + 1] = ' ';\n\t\t\tstr[(j * 3) + 2] = ' ';\n\t\t\tstr[(j * 3) + 3] = ' ';\n\t\t\tstr[j + 51] = ' ';\n\t\t}\n\t\tstr[49] = ' ';\n\t\tstr[50] = ' ';\n\t\tstr[67] = '\\0';\n\t\tfunction(str, user_data);\n\t}\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include <string.h>",
            "#include <limits.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include <string.h>\n#include <limits.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid util_hexdump(const char dir, const unsigned char *buf, size_t len,\n\t\t\t\tutil_debug_func_t function, void *user_data)\n{\n\tstatic const char hexdigits[] = \"0123456789abcdef\";\n\tchar str[68];\n\tsize_t i;\n\n\tif (!function || !len)\n\t\treturn;\n\n\tstr[0] = dir;\n\n\tfor (i = 0; i < len; i++) {\n\t\tstr[((i % 16) * 3) + 1] = ' ';\n\t\tstr[((i % 16) * 3) + 2] = hexdigits[buf[i] >> 4];\n\t\tstr[((i % 16) * 3) + 3] = hexdigits[buf[i] & 0xf];\n\t\tstr[(i % 16) + 51] = isprint(buf[i]) ? buf[i] : '.';\n\n\t\tif ((i + 1) % 16 == 0) {\n\t\t\tstr[49] = ' ';\n\t\t\tstr[50] = ' ';\n\t\t\tstr[67] = '\\0';\n\t\t\tfunction(str, user_data);\n\t\t\tstr[0] = ' ';\n\t\t}\n\t}\n\n\tif (i % 16 > 0) {\n\t\tsize_t j;\n\t\tfor (j = (i % 16); j < 16; j++) {\n\t\t\tstr[(j * 3) + 1] = ' ';\n\t\t\tstr[(j * 3) + 2] = ' ';\n\t\t\tstr[(j * 3) + 3] = ' ';\n\t\t\tstr[j + 51] = ' ';\n\t\t}\n\t\tstr[49] = ' ';\n\t\tstr[50] = ' ';\n\t\tstr[67] = '\\0';\n\t\tfunction(str, user_data);\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void read_tracing(const void *buf, size_t count, void *user_data)\n{\n\tstruct hfp_gw *hfp = user_data;\n\n\tutil_hexdump('>', buf, count, hfp->debug_callback, hfp->debug_data);\n}"
  },
  {
    "function_name": "hfp_gw_unref",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "630-667",
    "snippet": "void hfp_gw_unref(struct hfp_gw *hfp)\n{\n\tif (!hfp)\n\t\treturn;\n\n\tif (__sync_sub_and_fetch(&hfp->ref_count, 1))\n\t\treturn;\n\n\thfp_gw_set_command_handler(hfp, NULL, NULL, NULL);\n\n\tio_set_write_handler(hfp->io, NULL, NULL, NULL);\n\tio_set_read_handler(hfp->io, NULL, NULL, NULL);\n\tio_set_disconnect_handler(hfp->io, NULL, NULL, NULL);\n\n\tio_destroy(hfp->io);\n\thfp->io = NULL;\n\n\tif (hfp->close_on_unref)\n\t\tclose(hfp->fd);\n\n\thfp_gw_set_debug(hfp, NULL, NULL, NULL);\n\n\tringbuf_free(hfp->read_buf);\n\thfp->read_buf = NULL;\n\n\tringbuf_free(hfp->write_buf);\n\thfp->write_buf = NULL;\n\n\tqueue_destroy(hfp->cmd_handlers, destroy_cmd_handler);\n\thfp->cmd_handlers = NULL;\n\n\tif (!hfp->in_disconnect) {\n\t\tfree(hfp);\n\t\treturn;\n\t}\n\n\thfp->destroyed = true;\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "hfp"
          ],
          "line": 662
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "956-985",
          "snippet": "static void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_destroy",
          "args": [
            "hfp->cmd_handlers",
            "destroy_cmd_handler"
          ],
          "line": 658
        },
        "resolved": true,
        "details": {
          "function_name": "queue_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "68-76",
          "snippet": "void queue_destroy(struct queue *queue, queue_destroy_func_t destroy)\n{\n\tif (!queue)\n\t\treturn;\n\n\tqueue_remove_all(queue, NULL, NULL, destroy);\n\n\tqueue_unref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid queue_destroy(struct queue *queue, queue_destroy_func_t destroy)\n{\n\tif (!queue)\n\t\treturn;\n\n\tqueue_remove_all(queue, NULL, NULL, destroy);\n\n\tqueue_unref(queue);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ringbuf_free",
          "args": [
            "hfp->write_buf"
          ],
          "line": 655
        },
        "resolved": true,
        "details": {
          "function_name": "ringbuf_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ringbuf.c",
          "lines": "88-95",
          "snippet": "void ringbuf_free(struct ringbuf *ringbuf)\n{\n\tif (!ringbuf)\n\t\treturn;\n\n\tfree(ringbuf->buffer);\n\tfree(ringbuf);\n}",
          "includes": [
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <sys/param.h>",
            "#include <sys/uio.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <sys/param.h>\n#include <sys/uio.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid ringbuf_free(struct ringbuf *ringbuf)\n{\n\tif (!ringbuf)\n\t\treturn;\n\n\tfree(ringbuf->buffer);\n\tfree(ringbuf);\n}"
        }
      },
      {
        "call_info": {
          "callee": "hfp_gw_set_debug",
          "args": [
            "hfp",
            "NULL",
            "NULL",
            "NULL"
          ],
          "line": 650
        },
        "resolved": true,
        "details": {
          "function_name": "hfp_gw_set_debug",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
          "lines": "683-705",
          "snippet": "bool hfp_gw_set_debug(struct hfp_gw *hfp, hfp_debug_func_t callback,\n\t\t\t\tvoid *user_data, hfp_destroy_func_t destroy)\n{\n\tif (!hfp)\n\t\treturn false;\n\n\tif (hfp->debug_destroy)\n\t\thfp->debug_destroy(hfp->debug_data);\n\n\thfp->debug_callback = callback;\n\thfp->debug_destroy = destroy;\n\thfp->debug_data = user_data;\n\n\tif (hfp->debug_callback) {\n\t\tringbuf_set_input_tracing(hfp->read_buf, read_tracing, hfp);\n\t\tringbuf_set_input_tracing(hfp->write_buf, write_tracing, hfp);\n\t} else {\n\t\tringbuf_set_input_tracing(hfp->read_buf, NULL, NULL);\n\t\tringbuf_set_input_tracing(hfp->write_buf, NULL, NULL);\n\t}\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/hfp.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <ctype.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nbool hfp_gw_set_debug(struct hfp_gw *hfp, hfp_debug_func_t callback,\n\t\t\t\tvoid *user_data, hfp_destroy_func_t destroy)\n{\n\tif (!hfp)\n\t\treturn false;\n\n\tif (hfp->debug_destroy)\n\t\thfp->debug_destroy(hfp->debug_data);\n\n\thfp->debug_callback = callback;\n\thfp->debug_destroy = destroy;\n\thfp->debug_data = user_data;\n\n\tif (hfp->debug_callback) {\n\t\tringbuf_set_input_tracing(hfp->read_buf, read_tracing, hfp);\n\t\tringbuf_set_input_tracing(hfp->write_buf, write_tracing, hfp);\n\t} else {\n\t\tringbuf_set_input_tracing(hfp->read_buf, NULL, NULL);\n\t\tringbuf_set_input_tracing(hfp->write_buf, NULL, NULL);\n\t}\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "close",
          "args": [
            "hfp->fd"
          ],
          "line": 648
        },
        "resolved": true,
        "details": {
          "function_name": "hfp_context_close_container",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
          "lines": "334-347",
          "snippet": "bool hfp_context_close_container(struct hfp_context *context)\n{\n\tskip_whitespace(context);\n\n\t/* The list shall be followed by a right parenthesis (\")\" V250 5.7.3.1*/\n\tif (context->data[context->offset] != ')')\n\t\treturn false;\n\n\tcontext->offset++;\n\n\tnext_field(context);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/hfp.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <ctype.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nbool hfp_context_close_container(struct hfp_context *context)\n{\n\tskip_whitespace(context);\n\n\t/* The list shall be followed by a right parenthesis (\")\" V250 5.7.3.1*/\n\tif (context->data[context->offset] != ')')\n\t\treturn false;\n\n\tcontext->offset++;\n\n\tnext_field(context);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "io_destroy",
          "args": [
            "hfp->io"
          ],
          "line": 644
        },
        "resolved": true,
        "details": {
          "function_name": "io_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-glib.c",
          "lines": "111-135",
          "snippet": "void io_destroy(struct io *io)\n{\n\tif (!io)\n\t\treturn;\n\n\tif (io->read_watch) {\n\t\tg_source_remove(io->read_watch->id);\n\t\tio->read_watch = NULL;\n\t}\n\n\tif (io->write_watch) {\n\t\tg_source_remove(io->write_watch->id);\n\t\tio->write_watch = NULL;\n\t}\n\n\tif (io->disconnect_watch) {\n\t\tg_source_remove(io->disconnect_watch->id);\n\t\tio->disconnect_watch = NULL;\n\t}\n\n\tg_io_channel_unref(io->channel);\n\tio->channel = NULL;\n\n\tio_unref(io);\n}",
          "includes": [
            "#include \"src/shared/io.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/io.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nvoid io_destroy(struct io *io)\n{\n\tif (!io)\n\t\treturn;\n\n\tif (io->read_watch) {\n\t\tg_source_remove(io->read_watch->id);\n\t\tio->read_watch = NULL;\n\t}\n\n\tif (io->write_watch) {\n\t\tg_source_remove(io->write_watch->id);\n\t\tio->write_watch = NULL;\n\t}\n\n\tif (io->disconnect_watch) {\n\t\tg_source_remove(io->disconnect_watch->id);\n\t\tio->disconnect_watch = NULL;\n\t}\n\n\tg_io_channel_unref(io->channel);\n\tio->channel = NULL;\n\n\tio_unref(io);\n}"
        }
      },
      {
        "call_info": {
          "callee": "io_set_disconnect_handler",
          "args": [
            "hfp->io",
            "NULL",
            "NULL",
            "NULL"
          ],
          "line": 642
        },
        "resolved": true,
        "details": {
          "function_name": "io_set_disconnect_handler",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-glib.c",
          "lines": "260-264",
          "snippet": "bool io_set_disconnect_handler(struct io *io, io_callback_func_t callback,\n\t\t\t\tvoid *user_data, io_destroy_func_t destroy)\n{\n\treturn io_set_handler(io, G_IO_HUP, callback, user_data, destroy);\n}",
          "includes": [
            "#include \"src/shared/io.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/io.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nbool io_set_disconnect_handler(struct io *io, io_callback_func_t callback,\n\t\t\t\tvoid *user_data, io_destroy_func_t destroy)\n{\n\treturn io_set_handler(io, G_IO_HUP, callback, user_data, destroy);\n}"
        }
      },
      {
        "call_info": {
          "callee": "io_set_read_handler",
          "args": [
            "hfp->io",
            "NULL",
            "NULL",
            "NULL"
          ],
          "line": 641
        },
        "resolved": true,
        "details": {
          "function_name": "io_set_read_handler",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-glib.c",
          "lines": "248-252",
          "snippet": "bool io_set_read_handler(struct io *io, io_callback_func_t callback,\n\t\t\t\tvoid *user_data, io_destroy_func_t destroy)\n{\n\treturn io_set_handler(io, G_IO_IN, callback, user_data, destroy);\n}",
          "includes": [
            "#include \"src/shared/io.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/io.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nbool io_set_read_handler(struct io *io, io_callback_func_t callback,\n\t\t\t\tvoid *user_data, io_destroy_func_t destroy)\n{\n\treturn io_set_handler(io, G_IO_IN, callback, user_data, destroy);\n}"
        }
      },
      {
        "call_info": {
          "callee": "io_set_write_handler",
          "args": [
            "hfp->io",
            "NULL",
            "NULL",
            "NULL"
          ],
          "line": 640
        },
        "resolved": true,
        "details": {
          "function_name": "io_set_write_handler",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-glib.c",
          "lines": "254-258",
          "snippet": "bool io_set_write_handler(struct io *io, io_callback_func_t callback,\n\t\t\t\tvoid *user_data, io_destroy_func_t destroy)\n{\n\treturn io_set_handler(io, G_IO_OUT, callback, user_data, destroy);\n}",
          "includes": [
            "#include \"src/shared/io.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/io.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nbool io_set_write_handler(struct io *io, io_callback_func_t callback,\n\t\t\t\tvoid *user_data, io_destroy_func_t destroy)\n{\n\treturn io_set_handler(io, G_IO_OUT, callback, user_data, destroy);\n}"
        }
      },
      {
        "call_info": {
          "callee": "hfp_gw_set_command_handler",
          "args": [
            "hfp",
            "NULL",
            "NULL",
            "NULL"
          ],
          "line": 638
        },
        "resolved": true,
        "details": {
          "function_name": "hfp_gw_set_command_handler",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
          "lines": "812-827",
          "snippet": "bool hfp_gw_set_command_handler(struct hfp_gw *hfp,\n\t\t\t\thfp_command_func_t callback,\n\t\t\t\tvoid *user_data, hfp_destroy_func_t destroy)\n{\n\tif (!hfp)\n\t\treturn false;\n\n\tif (hfp->command_destroy)\n\t\thfp->command_destroy(hfp->command_data);\n\n\thfp->command_callback = callback;\n\thfp->command_destroy = destroy;\n\thfp->command_data = user_data;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/hfp.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <ctype.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nbool hfp_gw_set_command_handler(struct hfp_gw *hfp,\n\t\t\t\thfp_command_func_t callback,\n\t\t\t\tvoid *user_data, hfp_destroy_func_t destroy)\n{\n\tif (!hfp)\n\t\treturn false;\n\n\tif (hfp->command_destroy)\n\t\thfp->command_destroy(hfp->command_data);\n\n\thfp->command_callback = callback;\n\thfp->command_destroy = destroy;\n\thfp->command_data = user_data;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "__sync_sub_and_fetch",
          "args": [
            "&hfp->ref_count",
            "1"
          ],
          "line": 635
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid hfp_gw_unref(struct hfp_gw *hfp)\n{\n\tif (!hfp)\n\t\treturn;\n\n\tif (__sync_sub_and_fetch(&hfp->ref_count, 1))\n\t\treturn;\n\n\thfp_gw_set_command_handler(hfp, NULL, NULL, NULL);\n\n\tio_set_write_handler(hfp->io, NULL, NULL, NULL);\n\tio_set_read_handler(hfp->io, NULL, NULL, NULL);\n\tio_set_disconnect_handler(hfp->io, NULL, NULL, NULL);\n\n\tio_destroy(hfp->io);\n\thfp->io = NULL;\n\n\tif (hfp->close_on_unref)\n\t\tclose(hfp->fd);\n\n\thfp_gw_set_debug(hfp, NULL, NULL, NULL);\n\n\tringbuf_free(hfp->read_buf);\n\thfp->read_buf = NULL;\n\n\tringbuf_free(hfp->write_buf);\n\thfp->write_buf = NULL;\n\n\tqueue_destroy(hfp->cmd_handlers, destroy_cmd_handler);\n\thfp->cmd_handlers = NULL;\n\n\tif (!hfp->in_disconnect) {\n\t\tfree(hfp);\n\t\treturn;\n\t}\n\n\thfp->destroyed = true;\n}"
  },
  {
    "function_name": "hfp_gw_ref",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "620-628",
    "snippet": "struct hfp_gw *hfp_gw_ref(struct hfp_gw *hfp)\n{\n\tif (!hfp)\n\t\treturn NULL;\n\n\t__sync_fetch_and_add(&hfp->ref_count, 1);\n\n\treturn hfp;\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "__sync_fetch_and_add",
          "args": [
            "&hfp->ref_count",
            "1"
          ],
          "line": 625
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstruct hfp_gw *hfp_gw_ref(struct hfp_gw *hfp)\n{\n\tif (!hfp)\n\t\treturn NULL;\n\n\t__sync_fetch_and_add(&hfp->ref_count, 1);\n\n\treturn hfp;\n}"
  },
  {
    "function_name": "hfp_gw_new",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "570-618",
    "snippet": "struct hfp_gw *hfp_gw_new(int fd)\n{\n\tstruct hfp_gw *hfp;\n\n\tif (fd < 0)\n\t\treturn NULL;\n\n\thfp = new0(struct hfp_gw, 1);\n\thfp->fd = fd;\n\thfp->close_on_unref = false;\n\n\thfp->read_buf = ringbuf_new(4096);\n\tif (!hfp->read_buf) {\n\t\tfree(hfp);\n\t\treturn NULL;\n\t}\n\n\thfp->write_buf = ringbuf_new(4096);\n\tif (!hfp->write_buf) {\n\t\tringbuf_free(hfp->read_buf);\n\t\tfree(hfp);\n\t\treturn NULL;\n\t}\n\n\thfp->io = io_new(fd);\n\tif (!hfp->io) {\n\t\tringbuf_free(hfp->write_buf);\n\t\tringbuf_free(hfp->read_buf);\n\t\tfree(hfp);\n\t\treturn NULL;\n\t}\n\n\thfp->cmd_handlers = queue_new();\n\n\tif (!io_set_read_handler(hfp->io, can_read_data, hfp,\n\t\t\t\t\t\t\tread_watch_destroy)) {\n\t\tqueue_destroy(hfp->cmd_handlers, destroy_cmd_handler);\n\t\tio_destroy(hfp->io);\n\t\tringbuf_free(hfp->write_buf);\n\t\tringbuf_free(hfp->read_buf);\n\t\tfree(hfp);\n\t\treturn NULL;\n\t}\n\n\thfp->writer_active = false;\n\thfp->result_pending = false;\n\n\treturn hfp_gw_ref(hfp);\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "hfp_gw_ref",
          "args": [
            "hfp"
          ],
          "line": 617
        },
        "resolved": true,
        "details": {
          "function_name": "hfp_gw_ref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
          "lines": "620-628",
          "snippet": "struct hfp_gw *hfp_gw_ref(struct hfp_gw *hfp)\n{\n\tif (!hfp)\n\t\treturn NULL;\n\n\t__sync_fetch_and_add(&hfp->ref_count, 1);\n\n\treturn hfp;\n}",
          "includes": [
            "#include \"src/shared/hfp.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <ctype.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstruct hfp_gw *hfp_gw_ref(struct hfp_gw *hfp)\n{\n\tif (!hfp)\n\t\treturn NULL;\n\n\t__sync_fetch_and_add(&hfp->ref_count, 1);\n\n\treturn hfp;\n}"
        }
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "hfp"
          ],
          "line": 610
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "956-985",
          "snippet": "static void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ringbuf_free",
          "args": [
            "hfp->read_buf"
          ],
          "line": 609
        },
        "resolved": true,
        "details": {
          "function_name": "ringbuf_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ringbuf.c",
          "lines": "88-95",
          "snippet": "void ringbuf_free(struct ringbuf *ringbuf)\n{\n\tif (!ringbuf)\n\t\treturn;\n\n\tfree(ringbuf->buffer);\n\tfree(ringbuf);\n}",
          "includes": [
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <sys/param.h>",
            "#include <sys/uio.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <sys/param.h>\n#include <sys/uio.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid ringbuf_free(struct ringbuf *ringbuf)\n{\n\tif (!ringbuf)\n\t\treturn;\n\n\tfree(ringbuf->buffer);\n\tfree(ringbuf);\n}"
        }
      },
      {
        "call_info": {
          "callee": "io_destroy",
          "args": [
            "hfp->io"
          ],
          "line": 607
        },
        "resolved": true,
        "details": {
          "function_name": "io_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-glib.c",
          "lines": "111-135",
          "snippet": "void io_destroy(struct io *io)\n{\n\tif (!io)\n\t\treturn;\n\n\tif (io->read_watch) {\n\t\tg_source_remove(io->read_watch->id);\n\t\tio->read_watch = NULL;\n\t}\n\n\tif (io->write_watch) {\n\t\tg_source_remove(io->write_watch->id);\n\t\tio->write_watch = NULL;\n\t}\n\n\tif (io->disconnect_watch) {\n\t\tg_source_remove(io->disconnect_watch->id);\n\t\tio->disconnect_watch = NULL;\n\t}\n\n\tg_io_channel_unref(io->channel);\n\tio->channel = NULL;\n\n\tio_unref(io);\n}",
          "includes": [
            "#include \"src/shared/io.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/io.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nvoid io_destroy(struct io *io)\n{\n\tif (!io)\n\t\treturn;\n\n\tif (io->read_watch) {\n\t\tg_source_remove(io->read_watch->id);\n\t\tio->read_watch = NULL;\n\t}\n\n\tif (io->write_watch) {\n\t\tg_source_remove(io->write_watch->id);\n\t\tio->write_watch = NULL;\n\t}\n\n\tif (io->disconnect_watch) {\n\t\tg_source_remove(io->disconnect_watch->id);\n\t\tio->disconnect_watch = NULL;\n\t}\n\n\tg_io_channel_unref(io->channel);\n\tio->channel = NULL;\n\n\tio_unref(io);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_destroy",
          "args": [
            "hfp->cmd_handlers",
            "destroy_cmd_handler"
          ],
          "line": 606
        },
        "resolved": true,
        "details": {
          "function_name": "queue_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "68-76",
          "snippet": "void queue_destroy(struct queue *queue, queue_destroy_func_t destroy)\n{\n\tif (!queue)\n\t\treturn;\n\n\tqueue_remove_all(queue, NULL, NULL, destroy);\n\n\tqueue_unref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid queue_destroy(struct queue *queue, queue_destroy_func_t destroy)\n{\n\tif (!queue)\n\t\treturn;\n\n\tqueue_remove_all(queue, NULL, NULL, destroy);\n\n\tqueue_unref(queue);\n}"
        }
      },
      {
        "call_info": {
          "callee": "io_set_read_handler",
          "args": [
            "hfp->io",
            "can_read_data",
            "hfp",
            "read_watch_destroy"
          ],
          "line": 604
        },
        "resolved": true,
        "details": {
          "function_name": "io_set_read_handler",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-glib.c",
          "lines": "248-252",
          "snippet": "bool io_set_read_handler(struct io *io, io_callback_func_t callback,\n\t\t\t\tvoid *user_data, io_destroy_func_t destroy)\n{\n\treturn io_set_handler(io, G_IO_IN, callback, user_data, destroy);\n}",
          "includes": [
            "#include \"src/shared/io.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/io.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nbool io_set_read_handler(struct io *io, io_callback_func_t callback,\n\t\t\t\tvoid *user_data, io_destroy_func_t destroy)\n{\n\treturn io_set_handler(io, G_IO_IN, callback, user_data, destroy);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_new",
          "args": [],
          "line": 602
        },
        "resolved": true,
        "details": {
          "function_name": "queue_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "56-66",
          "snippet": "struct queue *queue_new(void)\n{\n\tstruct queue *queue;\n\n\tqueue = new0(struct queue, 1);\n\tqueue->head = NULL;\n\tqueue->tail = NULL;\n\tqueue->entries = 0;\n\n\treturn queue_ref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nstruct queue *queue_new(void)\n{\n\tstruct queue *queue;\n\n\tqueue = new0(struct queue, 1);\n\tqueue->head = NULL;\n\tqueue->tail = NULL;\n\tqueue->entries = 0;\n\n\treturn queue_ref(queue);\n}"
        }
      },
      {
        "call_info": {
          "callee": "io_new",
          "args": [
            "fd"
          ],
          "line": 594
        },
        "resolved": true,
        "details": {
          "function_name": "io_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-glib.c",
          "lines": "71-90",
          "snippet": "struct io *io_new(int fd)\n{\n\tstruct io *io;\n\n\tif (fd < 0)\n\t\treturn NULL;\n\n\tio = g_try_new0(struct io, 1);\n\tif (!io)\n\t\treturn NULL;\n\n\tio->channel = g_io_channel_unix_new(fd);\n\n\tg_io_channel_set_encoding(io->channel, NULL, NULL);\n\tg_io_channel_set_buffered(io->channel, FALSE);\n\n\tg_io_channel_set_close_on_unref(io->channel, FALSE);\n\n\treturn io_ref(io);\n}",
          "includes": [
            "#include \"src/shared/io.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/io.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nstruct io *io_new(int fd)\n{\n\tstruct io *io;\n\n\tif (fd < 0)\n\t\treturn NULL;\n\n\tio = g_try_new0(struct io, 1);\n\tif (!io)\n\t\treturn NULL;\n\n\tio->channel = g_io_channel_unix_new(fd);\n\n\tg_io_channel_set_encoding(io->channel, NULL, NULL);\n\tg_io_channel_set_buffered(io->channel, FALSE);\n\n\tg_io_channel_set_close_on_unref(io->channel, FALSE);\n\n\treturn io_ref(io);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ringbuf_new",
          "args": [
            "4096"
          ],
          "line": 587
        },
        "resolved": true,
        "details": {
          "function_name": "ringbuf_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ringbuf.c",
          "lines": "63-86",
          "snippet": "struct ringbuf *ringbuf_new(size_t size)\n{\n\tstruct ringbuf *ringbuf;\n\tsize_t real_size;\n\n\tif (size < 2 || size > UINT_MAX)\n\t\treturn NULL;\n\n\t/* Find the next power of two for size */\n\treal_size = align_power2(size);\n\n\tringbuf = new0(struct ringbuf, 1);\n\tringbuf->buffer = malloc(real_size);\n\tif (!ringbuf->buffer) {\n\t\tfree(ringbuf);\n\t\treturn NULL;\n\t}\n\n\tringbuf->size = real_size;\n\tringbuf->in = RINGBUF_RESET;\n\tringbuf->out = RINGBUF_RESET;\n\n\treturn ringbuf;\n}",
          "includes": [
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <sys/param.h>",
            "#include <sys/uio.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define RINGBUF_RESET 0"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <sys/param.h>\n#include <sys/uio.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\n#define RINGBUF_RESET 0\n\nstruct ringbuf *ringbuf_new(size_t size)\n{\n\tstruct ringbuf *ringbuf;\n\tsize_t real_size;\n\n\tif (size < 2 || size > UINT_MAX)\n\t\treturn NULL;\n\n\t/* Find the next power of two for size */\n\treal_size = align_power2(size);\n\n\tringbuf = new0(struct ringbuf, 1);\n\tringbuf->buffer = malloc(real_size);\n\tif (!ringbuf->buffer) {\n\t\tfree(ringbuf);\n\t\treturn NULL;\n\t}\n\n\tringbuf->size = real_size;\n\tringbuf->in = RINGBUF_RESET;\n\tringbuf->out = RINGBUF_RESET;\n\n\treturn ringbuf;\n}"
        }
      },
      {
        "call_info": {
          "callee": "new0",
          "args": [
            "structhfp_gw",
            "1"
          ],
          "line": 577
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstruct hfp_gw *hfp_gw_new(int fd)\n{\n\tstruct hfp_gw *hfp;\n\n\tif (fd < 0)\n\t\treturn NULL;\n\n\thfp = new0(struct hfp_gw, 1);\n\thfp->fd = fd;\n\thfp->close_on_unref = false;\n\n\thfp->read_buf = ringbuf_new(4096);\n\tif (!hfp->read_buf) {\n\t\tfree(hfp);\n\t\treturn NULL;\n\t}\n\n\thfp->write_buf = ringbuf_new(4096);\n\tif (!hfp->write_buf) {\n\t\tringbuf_free(hfp->read_buf);\n\t\tfree(hfp);\n\t\treturn NULL;\n\t}\n\n\thfp->io = io_new(fd);\n\tif (!hfp->io) {\n\t\tringbuf_free(hfp->write_buf);\n\t\tringbuf_free(hfp->read_buf);\n\t\tfree(hfp);\n\t\treturn NULL;\n\t}\n\n\thfp->cmd_handlers = queue_new();\n\n\tif (!io_set_read_handler(hfp->io, can_read_data, hfp,\n\t\t\t\t\t\t\tread_watch_destroy)) {\n\t\tqueue_destroy(hfp->cmd_handlers, destroy_cmd_handler);\n\t\tio_destroy(hfp->io);\n\t\tringbuf_free(hfp->write_buf);\n\t\tringbuf_free(hfp->read_buf);\n\t\tfree(hfp);\n\t\treturn NULL;\n\t}\n\n\thfp->writer_active = false;\n\thfp->result_pending = false;\n\n\treturn hfp_gw_ref(hfp);\n}"
  },
  {
    "function_name": "can_read_data",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "553-568",
    "snippet": "static bool can_read_data(struct io *io, void *user_data)\n{\n\tstruct hfp_gw *hfp = user_data;\n\tssize_t bytes_read;\n\n\tbytes_read = ringbuf_read(hfp->read_buf, hfp->fd);\n\tif (bytes_read < 0)\n\t\treturn false;\n\n\tif (hfp->result_pending)\n\t\treturn true;\n\n\tprocess_input(hfp);\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "process_input",
          "args": [
            "hfp"
          ],
          "line": 565
        },
        "resolved": true,
        "details": {
          "function_name": "hf_process_input",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
          "lines": "1155-1228",
          "snippet": "static void hf_process_input(struct hfp_hf *hfp)\n{\n\tchar *str, *ptr, *str2, *tmp;\n\tsize_t len, count, offset, len2;\n\tbool free_tmp = false;\n\n\tstr = ringbuf_peek(hfp->read_buf, 0, &len);\n\tif (!str)\n\t\treturn;\n\n\toffset = 0;\n\n\tptr = find_cr_lf(str, len);\n\twhile (ptr) {\n\t\tcount = ptr - (str + offset);\n\t\tif (count == 0) {\n\t\t\t/* 2 is for <cr><lf> */\n\t\t\toffset += 2;\n\t\t} else {\n\t\t\t*ptr = '\\0';\n\t\t\thf_call_prefix_handler(hfp, str + offset);\n\t\t\toffset += count + 2;\n\t\t}\n\n\t\tptr = find_cr_lf(str + offset, len - offset);\n\t}\n\n\t/*\n\t * Just check if there is no wrapped data in ring buffer.\n\t * Should not happen too often\n\t */\n\tif (len == ringbuf_len(hfp->read_buf))\n\t\tgoto done;\n\n\tstr2 = ringbuf_peek(hfp->read_buf, len, &len2);\n\tif (!str2)\n\t\tgoto done;\n\n\tptr = find_cr_lf(str2, len2);\n\tif (!ptr) {\n\t\t/* Might happen that we wrap between \\r and \\n */\n\t\tptr = memchr(str2, '\\n', len2);\n\t\tif (!ptr)\n\t\t\tgoto done;\n\t}\n\n\tcount = ptr - str2;\n\n\tif (count) {\n\t\t*ptr = '\\0';\n\n\t\ttmp = malloc(len + count);\n\t\tif (!tmp)\n\t\t\tgoto done;\n\n\t\t/* \"str\" here is not a string so we need to use memcpy */\n\t\tmemcpy(tmp, str, len);\n\t\tmemcpy(tmp + len, str2, count);\n\n\t\tfree_tmp = true;\n\t} else {\n\t\tstr[len-1] = '\\0';\n\t\ttmp = str;\n\t}\n\n\thf_call_prefix_handler(hfp, tmp);\n\toffset += count;\n\ndone:\n\tringbuf_drain(hfp->read_buf, offset);\n\n\tif (free_tmp)\n\t\tfree(tmp);\n}",
          "includes": [
            "#include \"src/shared/hfp.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <ctype.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void hf_process_input(struct hfp_hf *hfp)\n{\n\tchar *str, *ptr, *str2, *tmp;\n\tsize_t len, count, offset, len2;\n\tbool free_tmp = false;\n\n\tstr = ringbuf_peek(hfp->read_buf, 0, &len);\n\tif (!str)\n\t\treturn;\n\n\toffset = 0;\n\n\tptr = find_cr_lf(str, len);\n\twhile (ptr) {\n\t\tcount = ptr - (str + offset);\n\t\tif (count == 0) {\n\t\t\t/* 2 is for <cr><lf> */\n\t\t\toffset += 2;\n\t\t} else {\n\t\t\t*ptr = '\\0';\n\t\t\thf_call_prefix_handler(hfp, str + offset);\n\t\t\toffset += count + 2;\n\t\t}\n\n\t\tptr = find_cr_lf(str + offset, len - offset);\n\t}\n\n\t/*\n\t * Just check if there is no wrapped data in ring buffer.\n\t * Should not happen too often\n\t */\n\tif (len == ringbuf_len(hfp->read_buf))\n\t\tgoto done;\n\n\tstr2 = ringbuf_peek(hfp->read_buf, len, &len2);\n\tif (!str2)\n\t\tgoto done;\n\n\tptr = find_cr_lf(str2, len2);\n\tif (!ptr) {\n\t\t/* Might happen that we wrap between \\r and \\n */\n\t\tptr = memchr(str2, '\\n', len2);\n\t\tif (!ptr)\n\t\t\tgoto done;\n\t}\n\n\tcount = ptr - str2;\n\n\tif (count) {\n\t\t*ptr = '\\0';\n\n\t\ttmp = malloc(len + count);\n\t\tif (!tmp)\n\t\t\tgoto done;\n\n\t\t/* \"str\" here is not a string so we need to use memcpy */\n\t\tmemcpy(tmp, str, len);\n\t\tmemcpy(tmp + len, str2, count);\n\n\t\tfree_tmp = true;\n\t} else {\n\t\tstr[len-1] = '\\0';\n\t\ttmp = str;\n\t}\n\n\thf_call_prefix_handler(hfp, tmp);\n\toffset += count;\n\ndone:\n\tringbuf_drain(hfp->read_buf, offset);\n\n\tif (free_tmp)\n\t\tfree(tmp);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ringbuf_read",
          "args": [
            "hfp->read_buf",
            "hfp->fd"
          ],
          "line": 558
        },
        "resolved": true,
        "details": {
          "function_name": "ringbuf_read",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ringbuf.c",
          "lines": "268-309",
          "snippet": "ssize_t ringbuf_read(struct ringbuf *ringbuf, int fd)\n{\n\tsize_t avail, offset, end;\n\tstruct iovec iov[2];\n\tssize_t consumed;\n\n\tif (!ringbuf || fd < 0)\n\t\treturn -1;\n\n\t/* Determine how much can actually be consumed */\n\tavail = ringbuf->size - ringbuf->in + ringbuf->out;\n\tif (!avail)\n\t\treturn -1;\n\n\t/* Determine how much to consume before wrapping */\n\toffset = ringbuf->in & (ringbuf->size - 1);\n\tend = MIN(avail, ringbuf->size - offset);\n\n\tiov[0].iov_base = ringbuf->buffer + offset;\n\tiov[0].iov_len = end;\n\n\t/* Now put the remainder into the second vector */\n\tiov[1].iov_base = ringbuf->buffer;\n\tiov[1].iov_len = avail - end;\n\n\tconsumed = readv(fd, iov, 2);\n\tif (consumed < 0)\n\t\treturn -1;\n\n\tif (ringbuf->in_tracing) {\n\t\tsize_t len = MIN((size_t) consumed, end);\n\t\tringbuf->in_tracing(ringbuf->buffer + offset, len,\n\t\t\t\t\t\t\tringbuf->in_data);\n\t\tif (consumed - len > 0)\n\t\t\tringbuf->in_tracing(ringbuf->buffer, consumed - len,\n\t\t\t\t\t\t\tringbuf->in_data);\n\t}\n\n\tringbuf->in += consumed;\n\n\treturn consumed;\n}",
          "includes": [
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <sys/param.h>",
            "#include <sys/uio.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <sys/param.h>\n#include <sys/uio.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nssize_t ringbuf_read(struct ringbuf *ringbuf, int fd)\n{\n\tsize_t avail, offset, end;\n\tstruct iovec iov[2];\n\tssize_t consumed;\n\n\tif (!ringbuf || fd < 0)\n\t\treturn -1;\n\n\t/* Determine how much can actually be consumed */\n\tavail = ringbuf->size - ringbuf->in + ringbuf->out;\n\tif (!avail)\n\t\treturn -1;\n\n\t/* Determine how much to consume before wrapping */\n\toffset = ringbuf->in & (ringbuf->size - 1);\n\tend = MIN(avail, ringbuf->size - offset);\n\n\tiov[0].iov_base = ringbuf->buffer + offset;\n\tiov[0].iov_len = end;\n\n\t/* Now put the remainder into the second vector */\n\tiov[1].iov_base = ringbuf->buffer;\n\tiov[1].iov_len = avail - end;\n\n\tconsumed = readv(fd, iov, 2);\n\tif (consumed < 0)\n\t\treturn -1;\n\n\tif (ringbuf->in_tracing) {\n\t\tsize_t len = MIN((size_t) consumed, end);\n\t\tringbuf->in_tracing(ringbuf->buffer + offset, len,\n\t\t\t\t\t\t\tringbuf->in_data);\n\t\tif (consumed - len > 0)\n\t\t\tringbuf->in_tracing(ringbuf->buffer, consumed - len,\n\t\t\t\t\t\t\tringbuf->in_data);\n\t}\n\n\tringbuf->in += consumed;\n\n\treturn consumed;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic bool can_read_data(struct io *io, void *user_data)\n{\n\tstruct hfp_gw *hfp = user_data;\n\tssize_t bytes_read;\n\n\tbytes_read = ringbuf_read(hfp->read_buf, hfp->fd);\n\tif (bytes_read < 0)\n\t\treturn false;\n\n\tif (hfp->result_pending)\n\t\treturn true;\n\n\tprocess_input(hfp);\n\n\treturn true;\n}"
  },
  {
    "function_name": "read_watch_destroy",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "549-551",
    "snippet": "static void read_watch_destroy(void *user_data)\n{\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void read_watch_destroy(void *user_data)\n{\n}"
  },
  {
    "function_name": "process_input",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "475-547",
    "snippet": "static void process_input(struct hfp_gw *hfp)\n{\n\tchar *str, *ptr;\n\tsize_t len, count;\n\tbool free_ptr = false;\n\tbool read_again;\n\n\tdo {\n\t\tstr = ringbuf_peek(hfp->read_buf, 0, &len);\n\t\tif (!str)\n\t\t\treturn;\n\n\t\tptr = memchr(str, '\\r', len);\n\t\tif (!ptr) {\n\t\t\tchar *str2;\n\t\t\tsize_t len2;\n\n\t\t\t/*\n\t\t\t * If there is no more data in ringbuffer,\n\t\t\t * it's just an incomplete command.\n\t\t\t */\n\t\t\tif (len == ringbuf_len(hfp->read_buf))\n\t\t\t\treturn;\n\n\t\t\tstr2 = ringbuf_peek(hfp->read_buf, len, &len2);\n\t\t\tif (!str2)\n\t\t\t\treturn;\n\n\t\t\tptr = memchr(str2, '\\r', len2);\n\t\t\tif (!ptr)\n\t\t\t\treturn;\n\n\t\t\t*ptr = '\\0';\n\n\t\t\tcount = len2 + len;\n\t\t\tptr = malloc(count);\n\t\t\tif (!ptr)\n\t\t\t\treturn;\n\n\t\t\tmemcpy(ptr, str, len);\n\t\t\tmemcpy(ptr + len, str2, len2);\n\n\t\t\tfree_ptr = true;\n\t\t\tstr = ptr;\n\t\t} else {\n\t\t\tcount = ptr - str;\n\t\t\t*ptr = '\\0';\n\t\t}\n\n\t\tif (!handle_at_command(hfp, str))\n\t\t\t/*\n\t\t\t * Command is not handled that means that was some\n\t\t\t * trash. Let's skip that and keep reading from ring\n\t\t\t * buffer.\n\t\t\t */\n\t\t\tread_again = true;\n\t\telse\n\t\t\t/*\n\t\t\t * Command has been handled. If we are waiting for a\n\t\t\t * result from upper layer, we can stop reading. If we\n\t\t\t * already reply i.e. ERROR on unknown command, then we\n\t\t\t * can keep reading ring buffer. Actually ring buffer\n\t\t\t * should be empty but lets just look there.\n\t\t\t */\n\t\t\tread_again = !hfp->result_pending;\n\n\t\tringbuf_drain(hfp->read_buf, count + 1);\n\n\t\tif (free_ptr)\n\t\t\tfree(ptr);\n\n\t} while (read_again);\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "ptr"
          ],
          "line": 544
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "956-985",
          "snippet": "static void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ringbuf_drain",
          "args": [
            "hfp->read_buf",
            "count + 1"
          ],
          "line": 541
        },
        "resolved": true,
        "details": {
          "function_name": "ringbuf_drain",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ringbuf.c",
          "lines": "125-144",
          "snippet": "size_t ringbuf_drain(struct ringbuf *ringbuf, size_t count)\n{\n\tsize_t len;\n\n\tif (!ringbuf)\n\t\treturn 0;\n\n\tlen = MIN(count, ringbuf->in - ringbuf->out);\n\tif (!len)\n\t\treturn 0;\n\n\tringbuf->out += len;\n\n\tif (ringbuf->out == ringbuf->in) {\n\t\tringbuf->in = RINGBUF_RESET;\n\t\tringbuf->out = RINGBUF_RESET;\n\t}\n\n\treturn len;\n}",
          "includes": [
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <sys/param.h>",
            "#include <sys/uio.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define RINGBUF_RESET 0"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <sys/param.h>\n#include <sys/uio.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\n#define RINGBUF_RESET 0\n\nsize_t ringbuf_drain(struct ringbuf *ringbuf, size_t count)\n{\n\tsize_t len;\n\n\tif (!ringbuf)\n\t\treturn 0;\n\n\tlen = MIN(count, ringbuf->in - ringbuf->out);\n\tif (!len)\n\t\treturn 0;\n\n\tringbuf->out += len;\n\n\tif (ringbuf->out == ringbuf->in) {\n\t\tringbuf->in = RINGBUF_RESET;\n\t\tringbuf->out = RINGBUF_RESET;\n\t}\n\n\treturn len;\n}"
        }
      },
      {
        "call_info": {
          "callee": "handle_at_command",
          "args": [
            "hfp",
            "str"
          ],
          "line": 524
        },
        "resolved": true,
        "details": {
          "function_name": "handle_at_command",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
          "lines": "193-270",
          "snippet": "static bool handle_at_command(struct hfp_gw *hfp, const char *data)\n{\n\tstruct cmd_handler *handler;\n\tconst char *separators = \";?=\\0\";\n\tstruct hfp_context context;\n\tenum hfp_gw_cmd_type type;\n\tchar lookup_prefix[18];\n\tuint8_t pref_len = 0;\n\tconst char *prefix;\n\tint i;\n\n\tcontext.offset = 0;\n\tcontext.data = data;\n\n\tskip_whitespace(&context);\n\n\tif (strlen(data + context.offset) < 3)\n\t\treturn false;\n\n\tif (strncmp(data + context.offset, \"AT\", 2))\n\t\tif (strncmp(data + context.offset, \"at\", 2))\n\t\t\treturn false;\n\n\tcontext.offset += 2;\n\tprefix = data + context.offset;\n\n\tif (isalpha(prefix[0])) {\n\t\tlookup_prefix[pref_len++] = toupper(prefix[0]);\n\t} else {\n\t\tpref_len = strcspn(prefix, separators);\n\t\tif (pref_len > 17 || pref_len < 2)\n\t\t\treturn false;\n\n\t\tfor (i = 0; i < pref_len; i++)\n\t\t\tlookup_prefix[i] = toupper(prefix[i]);\n\t}\n\n\tlookup_prefix[pref_len] = '\\0';\n\tcontext.offset += pref_len;\n\n\tif (lookup_prefix[0] == 'D') {\n\t\ttype = HFP_GW_CMD_TYPE_SET;\n\t\tgoto done;\n\t}\n\n\tif (data[context.offset] == '=') {\n\t\tcontext.offset++;\n\t\tif (data[context.offset] == '?') {\n\t\t\tcontext.offset++;\n\t\t\ttype = HFP_GW_CMD_TYPE_TEST;\n\t\t} else {\n\t\t\ttype = HFP_GW_CMD_TYPE_SET;\n\t\t}\n\t\tgoto done;\n\t}\n\n\tif (data[context.offset] == '?') {\n\t\tcontext.offset++;\n\t\ttype = HFP_GW_CMD_TYPE_READ;\n\t\tgoto done;\n\t}\n\n\ttype = HFP_GW_CMD_TYPE_COMMAND;\n\ndone:\n\n\thandler = queue_find(hfp->cmd_handlers, match_handler_prefix,\n\t\t\t\t\t\t\t\tlookup_prefix);\n\tif (!handler) {\n\t\thandle_unknown_at_command(hfp, data);\n\t\treturn true;\n\t}\n\n\thfp->result_pending = true;\n\thandler->callback(&context, type, handler->user_data);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/hfp.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <ctype.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic bool handle_at_command(struct hfp_gw *hfp, const char *data)\n{\n\tstruct cmd_handler *handler;\n\tconst char *separators = \";?=\\0\";\n\tstruct hfp_context context;\n\tenum hfp_gw_cmd_type type;\n\tchar lookup_prefix[18];\n\tuint8_t pref_len = 0;\n\tconst char *prefix;\n\tint i;\n\n\tcontext.offset = 0;\n\tcontext.data = data;\n\n\tskip_whitespace(&context);\n\n\tif (strlen(data + context.offset) < 3)\n\t\treturn false;\n\n\tif (strncmp(data + context.offset, \"AT\", 2))\n\t\tif (strncmp(data + context.offset, \"at\", 2))\n\t\t\treturn false;\n\n\tcontext.offset += 2;\n\tprefix = data + context.offset;\n\n\tif (isalpha(prefix[0])) {\n\t\tlookup_prefix[pref_len++] = toupper(prefix[0]);\n\t} else {\n\t\tpref_len = strcspn(prefix, separators);\n\t\tif (pref_len > 17 || pref_len < 2)\n\t\t\treturn false;\n\n\t\tfor (i = 0; i < pref_len; i++)\n\t\t\tlookup_prefix[i] = toupper(prefix[i]);\n\t}\n\n\tlookup_prefix[pref_len] = '\\0';\n\tcontext.offset += pref_len;\n\n\tif (lookup_prefix[0] == 'D') {\n\t\ttype = HFP_GW_CMD_TYPE_SET;\n\t\tgoto done;\n\t}\n\n\tif (data[context.offset] == '=') {\n\t\tcontext.offset++;\n\t\tif (data[context.offset] == '?') {\n\t\t\tcontext.offset++;\n\t\t\ttype = HFP_GW_CMD_TYPE_TEST;\n\t\t} else {\n\t\t\ttype = HFP_GW_CMD_TYPE_SET;\n\t\t}\n\t\tgoto done;\n\t}\n\n\tif (data[context.offset] == '?') {\n\t\tcontext.offset++;\n\t\ttype = HFP_GW_CMD_TYPE_READ;\n\t\tgoto done;\n\t}\n\n\ttype = HFP_GW_CMD_TYPE_COMMAND;\n\ndone:\n\n\thandler = queue_find(hfp->cmd_handlers, match_handler_prefix,\n\t\t\t\t\t\t\t\tlookup_prefix);\n\tif (!handler) {\n\t\thandle_unknown_at_command(hfp, data);\n\t\treturn true;\n\t}\n\n\thfp->result_pending = true;\n\thandler->callback(&context, type, handler->user_data);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "ptr + len",
            "str2",
            "len2"
          ],
          "line": 515
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "ptr",
            "str",
            "len"
          ],
          "line": 514
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "malloc",
          "args": [
            "count"
          ],
          "line": 510
        },
        "resolved": true,
        "details": {
          "function_name": "btd_malloc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/util.c",
          "lines": "41-55",
          "snippet": "void *btd_malloc(size_t size)\n{\n\tif (__builtin_expect(!!size, 1)) {\n\t\tvoid *ptr;\n\n\t\tptr = malloc(size);\n\t\tif (ptr)\n\t\t\treturn ptr;\n\n\t\tfprintf(stderr, \"failed to allocate %zu bytes\\n\", size);\n\t\tabort();\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include <string.h>",
            "#include <limits.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <stdbool.h>",
            "#include <stdarg.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include <string.h>\n#include <limits.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdbool.h>\n#include <stdarg.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid *btd_malloc(size_t size)\n{\n\tif (__builtin_expect(!!size, 1)) {\n\t\tvoid *ptr;\n\n\t\tptr = malloc(size);\n\t\tif (ptr)\n\t\t\treturn ptr;\n\n\t\tfprintf(stderr, \"failed to allocate %zu bytes\\n\", size);\n\t\tabort();\n\t}\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "memchr",
          "args": [
            "str2",
            "'\\r'",
            "len2"
          ],
          "line": 503
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ringbuf_peek",
          "args": [
            "hfp->read_buf",
            "len",
            "&len2"
          ],
          "line": 499
        },
        "resolved": true,
        "details": {
          "function_name": "ringbuf_peek",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ringbuf.c",
          "lines": "146-159",
          "snippet": "void *ringbuf_peek(struct ringbuf *ringbuf, size_t offset, size_t *len_nowrap)\n{\n\tif (!ringbuf)\n\t\treturn NULL;\n\n\toffset = (ringbuf->out + offset) & (ringbuf->size - 1);\n\n\tif (len_nowrap) {\n\t\tsize_t len = ringbuf->in - ringbuf->out;\n\t\t*len_nowrap = MIN(len, ringbuf->size - offset);\n\t}\n\n\treturn ringbuf->buffer + offset;\n}",
          "includes": [
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <sys/param.h>",
            "#include <sys/uio.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <sys/param.h>\n#include <sys/uio.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid *ringbuf_peek(struct ringbuf *ringbuf, size_t offset, size_t *len_nowrap)\n{\n\tif (!ringbuf)\n\t\treturn NULL;\n\n\toffset = (ringbuf->out + offset) & (ringbuf->size - 1);\n\n\tif (len_nowrap) {\n\t\tsize_t len = ringbuf->in - ringbuf->out;\n\t\t*len_nowrap = MIN(len, ringbuf->size - offset);\n\t}\n\n\treturn ringbuf->buffer + offset;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ringbuf_len",
          "args": [
            "hfp->read_buf"
          ],
          "line": 496
        },
        "resolved": true,
        "details": {
          "function_name": "ringbuf_len",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ringbuf.c",
          "lines": "117-123",
          "snippet": "size_t ringbuf_len(struct ringbuf *ringbuf)\n{\n\tif (!ringbuf)\n\t\treturn 0;\n\n\treturn ringbuf->in - ringbuf->out;\n}",
          "includes": [
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <sys/param.h>",
            "#include <sys/uio.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <sys/param.h>\n#include <sys/uio.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nsize_t ringbuf_len(struct ringbuf *ringbuf)\n{\n\tif (!ringbuf)\n\t\treturn 0;\n\n\treturn ringbuf->in - ringbuf->out;\n}"
        }
      },
      {
        "call_info": {
          "callee": "memchr",
          "args": [
            "str",
            "'\\r'",
            "len"
          ],
          "line": 487
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void process_input(struct hfp_gw *hfp)\n{\n\tchar *str, *ptr;\n\tsize_t len, count;\n\tbool free_ptr = false;\n\tbool read_again;\n\n\tdo {\n\t\tstr = ringbuf_peek(hfp->read_buf, 0, &len);\n\t\tif (!str)\n\t\t\treturn;\n\n\t\tptr = memchr(str, '\\r', len);\n\t\tif (!ptr) {\n\t\t\tchar *str2;\n\t\t\tsize_t len2;\n\n\t\t\t/*\n\t\t\t * If there is no more data in ringbuffer,\n\t\t\t * it's just an incomplete command.\n\t\t\t */\n\t\t\tif (len == ringbuf_len(hfp->read_buf))\n\t\t\t\treturn;\n\n\t\t\tstr2 = ringbuf_peek(hfp->read_buf, len, &len2);\n\t\t\tif (!str2)\n\t\t\t\treturn;\n\n\t\t\tptr = memchr(str2, '\\r', len2);\n\t\t\tif (!ptr)\n\t\t\t\treturn;\n\n\t\t\t*ptr = '\\0';\n\n\t\t\tcount = len2 + len;\n\t\t\tptr = malloc(count);\n\t\t\tif (!ptr)\n\t\t\t\treturn;\n\n\t\t\tmemcpy(ptr, str, len);\n\t\t\tmemcpy(ptr + len, str2, len2);\n\n\t\t\tfree_ptr = true;\n\t\t\tstr = ptr;\n\t\t} else {\n\t\t\tcount = ptr - str;\n\t\t\t*ptr = '\\0';\n\t\t}\n\n\t\tif (!handle_at_command(hfp, str))\n\t\t\t/*\n\t\t\t * Command is not handled that means that was some\n\t\t\t * trash. Let's skip that and keep reading from ring\n\t\t\t * buffer.\n\t\t\t */\n\t\t\tread_again = true;\n\t\telse\n\t\t\t/*\n\t\t\t * Command has been handled. If we are waiting for a\n\t\t\t * result from upper layer, we can stop reading. If we\n\t\t\t * already reply i.e. ERROR on unknown command, then we\n\t\t\t * can keep reading ring buffer. Actually ring buffer\n\t\t\t * should be empty but lets just look there.\n\t\t\t */\n\t\t\tread_again = !hfp->result_pending;\n\n\t\tringbuf_drain(hfp->read_buf, count + 1);\n\n\t\tif (free_ptr)\n\t\t\tfree(ptr);\n\n\t} while (read_again);\n}"
  },
  {
    "function_name": "hfp_context_get_range",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "444-473",
    "snippet": "bool hfp_context_get_range(struct hfp_context *context, uint32_t *min,\n\t\t\t\t\t\t\t\tuint32_t *max)\n{\n\tuint32_t l, h;\n\tuint32_t start;\n\n\tstart = context->offset;\n\n\tif (!hfp_context_get_number(context, &l))\n\t\tgoto failed;\n\n\tif (context->data[context->offset] != '-')\n\t\tgoto failed;\n\n\tcontext->offset++;\n\n\tif (!hfp_context_get_number(context, &h))\n\t\tgoto failed;\n\n\t*min = l;\n\t*max = h;\n\n\tnext_field(context);\n\n\treturn true;\n\nfailed:\n\tcontext->offset = start;\n\treturn false;\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "next_field",
          "args": [
            "context"
          ],
          "line": 466
        },
        "resolved": true,
        "details": {
          "function_name": "next_field",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
          "lines": "272-276",
          "snippet": "static void next_field(struct hfp_context *context)\n{\n\tif (context->data[context->offset] == ',')\n\t\tcontext->offset++;\n}",
          "includes": [
            "#include \"src/shared/hfp.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <ctype.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void next_field(struct hfp_context *context)\n{\n\tif (context->data[context->offset] == ',')\n\t\tcontext->offset++;\n}"
        }
      },
      {
        "call_info": {
          "callee": "hfp_context_get_number",
          "args": [
            "context",
            "&h"
          ],
          "line": 460
        },
        "resolved": true,
        "details": {
          "function_name": "hfp_context_get_number",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
          "lines": "295-319",
          "snippet": "bool hfp_context_get_number(struct hfp_context *context,\n\t\t\t\t\t\t\tunsigned int *val)\n{\n\tunsigned int i;\n\tint tmp = 0;\n\n\tskip_whitespace(context);\n\n\ti = context->offset;\n\n\twhile (context->data[i] >= '0' && context->data[i] <= '9')\n\t\ttmp = tmp * 10 + context->data[i++] - '0';\n\n\tif (i == context->offset)\n\t\treturn false;\n\n\tif (val)\n\t\t*val = tmp;\n\tcontext->offset = i;\n\n\tskip_whitespace(context);\n\tnext_field(context);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/hfp.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <ctype.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nbool hfp_context_get_number(struct hfp_context *context,\n\t\t\t\t\t\t\tunsigned int *val)\n{\n\tunsigned int i;\n\tint tmp = 0;\n\n\tskip_whitespace(context);\n\n\ti = context->offset;\n\n\twhile (context->data[i] >= '0' && context->data[i] <= '9')\n\t\ttmp = tmp * 10 + context->data[i++] - '0';\n\n\tif (i == context->offset)\n\t\treturn false;\n\n\tif (val)\n\t\t*val = tmp;\n\tcontext->offset = i;\n\n\tskip_whitespace(context);\n\tnext_field(context);\n\n\treturn true;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nbool hfp_context_get_range(struct hfp_context *context, uint32_t *min,\n\t\t\t\t\t\t\t\tuint32_t *max)\n{\n\tuint32_t l, h;\n\tuint32_t start;\n\n\tstart = context->offset;\n\n\tif (!hfp_context_get_number(context, &l))\n\t\tgoto failed;\n\n\tif (context->data[context->offset] != '-')\n\t\tgoto failed;\n\n\tcontext->offset++;\n\n\tif (!hfp_context_get_number(context, &h))\n\t\tgoto failed;\n\n\t*min = l;\n\t*max = h;\n\n\tnext_field(context);\n\n\treturn true;\n\nfailed:\n\tcontext->offset = start;\n\treturn false;\n}"
  },
  {
    "function_name": "hfp_context_skip_field",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "432-442",
    "snippet": "void hfp_context_skip_field(struct hfp_context *context)\n{\n\tconst char *data = context->data;\n\tunsigned int offset = context->offset;\n\n\twhile (data[offset] != '\\0' && data[offset] != ',')\n\t\toffset++;\n\n\tcontext->offset = offset;\n\tnext_field(context);\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "next_field",
          "args": [
            "context"
          ],
          "line": 441
        },
        "resolved": true,
        "details": {
          "function_name": "next_field",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
          "lines": "272-276",
          "snippet": "static void next_field(struct hfp_context *context)\n{\n\tif (context->data[context->offset] == ',')\n\t\tcontext->offset++;\n}",
          "includes": [
            "#include \"src/shared/hfp.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <ctype.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void next_field(struct hfp_context *context)\n{\n\tif (context->data[context->offset] == ',')\n\t\tcontext->offset++;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid hfp_context_skip_field(struct hfp_context *context)\n{\n\tconst char *data = context->data;\n\tunsigned int offset = context->offset;\n\n\twhile (data[offset] != '\\0' && data[offset] != ',')\n\t\toffset++;\n\n\tcontext->offset = offset;\n\tnext_field(context);\n}"
  },
  {
    "function_name": "hfp_context_has_next",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "427-430",
    "snippet": "bool hfp_context_has_next(struct hfp_context *context)\n{\n\treturn context->data[context->offset] != '\\0';\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nbool hfp_context_has_next(struct hfp_context *context)\n{\n\treturn context->data[context->offset] != '\\0';\n}"
  },
  {
    "function_name": "hfp_context_get_unquoted_string",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "390-425",
    "snippet": "bool hfp_context_get_unquoted_string(struct hfp_context *context,\n\t\t\t\t\t\t\tchar *buf, uint8_t len)\n{\n\tconst char *data = context->data;\n\tunsigned int offset;\n\tint i = 0;\n\tchar c;\n\n\tskip_whitespace(context);\n\n\tc = data[context->offset];\n\tif (c == '\"' || c == ')' || c == '(')\n\t\treturn false;\n\n\toffset = context->offset;\n\n\twhile (data[offset] != '\\0' && data[offset] != ',' &&\n\t\t\t\t\t\t\tdata[offset] != ')') {\n\t\tif (i == len)\n\t\t\treturn false;\n\n\t\tbuf[i++] = data[offset];\n\t\toffset++;\n\t}\n\n\tif (i == len)\n\t\treturn false;\n\n\tbuf[i] = '\\0';\n\n\tcontext->offset = offset;\n\n\tnext_field(context);\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "next_field",
          "args": [
            "context"
          ],
          "line": 422
        },
        "resolved": true,
        "details": {
          "function_name": "next_field",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
          "lines": "272-276",
          "snippet": "static void next_field(struct hfp_context *context)\n{\n\tif (context->data[context->offset] == ',')\n\t\tcontext->offset++;\n}",
          "includes": [
            "#include \"src/shared/hfp.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <ctype.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void next_field(struct hfp_context *context)\n{\n\tif (context->data[context->offset] == ',')\n\t\tcontext->offset++;\n}"
        }
      },
      {
        "call_info": {
          "callee": "skip_whitespace",
          "args": [
            "context"
          ],
          "line": 398
        },
        "resolved": true,
        "details": {
          "function_name": "hf_skip_whitespace",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
          "lines": "982-986",
          "snippet": "static void hf_skip_whitespace(struct hfp_context *context)\n{\n\twhile (context->data[context->offset] == ' ')\n\t\tcontext->offset++;\n}",
          "includes": [
            "#include \"src/shared/hfp.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <ctype.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void hf_skip_whitespace(struct hfp_context *context)\n{\n\twhile (context->data[context->offset] == ' ')\n\t\tcontext->offset++;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nbool hfp_context_get_unquoted_string(struct hfp_context *context,\n\t\t\t\t\t\t\tchar *buf, uint8_t len)\n{\n\tconst char *data = context->data;\n\tunsigned int offset;\n\tint i = 0;\n\tchar c;\n\n\tskip_whitespace(context);\n\n\tc = data[context->offset];\n\tif (c == '\"' || c == ')' || c == '(')\n\t\treturn false;\n\n\toffset = context->offset;\n\n\twhile (data[offset] != '\\0' && data[offset] != ',' &&\n\t\t\t\t\t\t\tdata[offset] != ')') {\n\t\tif (i == len)\n\t\t\treturn false;\n\n\t\tbuf[i++] = data[offset];\n\t\toffset++;\n\t}\n\n\tif (i == len)\n\t\treturn false;\n\n\tbuf[i] = '\\0';\n\n\tcontext->offset = offset;\n\n\tnext_field(context);\n\n\treturn true;\n}"
  },
  {
    "function_name": "hfp_context_get_string",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "349-388",
    "snippet": "bool hfp_context_get_string(struct hfp_context *context, char *buf,\n\t\t\t\t\t\t\t\tuint8_t len)\n{\n\tint i = 0;\n\tconst char *data = context->data;\n\tunsigned int offset;\n\n\tskip_whitespace(context);\n\n\tif (data[context->offset] != '\"')\n\t\treturn false;\n\n\toffset = context->offset;\n\toffset++;\n\n\twhile (data[offset] != '\\0' && data[offset] != '\"') {\n\t\tif (i == len)\n\t\t\treturn false;\n\n\t\tbuf[i++] = data[offset];\n\t\toffset++;\n\t}\n\n\tif (i == len)\n\t\treturn false;\n\n\tbuf[i] = '\\0';\n\n\tif (data[offset] == '\"')\n\t\toffset++;\n\telse\n\t\treturn false;\n\n\tcontext->offset = offset;\n\n\tskip_whitespace(context);\n\tnext_field(context);\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "next_field",
          "args": [
            "context"
          ],
          "line": 385
        },
        "resolved": true,
        "details": {
          "function_name": "next_field",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
          "lines": "272-276",
          "snippet": "static void next_field(struct hfp_context *context)\n{\n\tif (context->data[context->offset] == ',')\n\t\tcontext->offset++;\n}",
          "includes": [
            "#include \"src/shared/hfp.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <ctype.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void next_field(struct hfp_context *context)\n{\n\tif (context->data[context->offset] == ',')\n\t\tcontext->offset++;\n}"
        }
      },
      {
        "call_info": {
          "callee": "skip_whitespace",
          "args": [
            "context"
          ],
          "line": 384
        },
        "resolved": true,
        "details": {
          "function_name": "hf_skip_whitespace",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
          "lines": "982-986",
          "snippet": "static void hf_skip_whitespace(struct hfp_context *context)\n{\n\twhile (context->data[context->offset] == ' ')\n\t\tcontext->offset++;\n}",
          "includes": [
            "#include \"src/shared/hfp.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <ctype.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void hf_skip_whitespace(struct hfp_context *context)\n{\n\twhile (context->data[context->offset] == ' ')\n\t\tcontext->offset++;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nbool hfp_context_get_string(struct hfp_context *context, char *buf,\n\t\t\t\t\t\t\t\tuint8_t len)\n{\n\tint i = 0;\n\tconst char *data = context->data;\n\tunsigned int offset;\n\n\tskip_whitespace(context);\n\n\tif (data[context->offset] != '\"')\n\t\treturn false;\n\n\toffset = context->offset;\n\toffset++;\n\n\twhile (data[offset] != '\\0' && data[offset] != '\"') {\n\t\tif (i == len)\n\t\t\treturn false;\n\n\t\tbuf[i++] = data[offset];\n\t\toffset++;\n\t}\n\n\tif (i == len)\n\t\treturn false;\n\n\tbuf[i] = '\\0';\n\n\tif (data[offset] == '\"')\n\t\toffset++;\n\telse\n\t\treturn false;\n\n\tcontext->offset = offset;\n\n\tskip_whitespace(context);\n\tnext_field(context);\n\n\treturn true;\n}"
  },
  {
    "function_name": "hfp_context_close_container",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "334-347",
    "snippet": "bool hfp_context_close_container(struct hfp_context *context)\n{\n\tskip_whitespace(context);\n\n\t/* The list shall be followed by a right parenthesis (\")\" V250 5.7.3.1*/\n\tif (context->data[context->offset] != ')')\n\t\treturn false;\n\n\tcontext->offset++;\n\n\tnext_field(context);\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "next_field",
          "args": [
            "context"
          ],
          "line": 344
        },
        "resolved": true,
        "details": {
          "function_name": "next_field",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
          "lines": "272-276",
          "snippet": "static void next_field(struct hfp_context *context)\n{\n\tif (context->data[context->offset] == ',')\n\t\tcontext->offset++;\n}",
          "includes": [
            "#include \"src/shared/hfp.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <ctype.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void next_field(struct hfp_context *context)\n{\n\tif (context->data[context->offset] == ',')\n\t\tcontext->offset++;\n}"
        }
      },
      {
        "call_info": {
          "callee": "skip_whitespace",
          "args": [
            "context"
          ],
          "line": 336
        },
        "resolved": true,
        "details": {
          "function_name": "hf_skip_whitespace",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
          "lines": "982-986",
          "snippet": "static void hf_skip_whitespace(struct hfp_context *context)\n{\n\twhile (context->data[context->offset] == ' ')\n\t\tcontext->offset++;\n}",
          "includes": [
            "#include \"src/shared/hfp.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <ctype.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void hf_skip_whitespace(struct hfp_context *context)\n{\n\twhile (context->data[context->offset] == ' ')\n\t\tcontext->offset++;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nbool hfp_context_close_container(struct hfp_context *context)\n{\n\tskip_whitespace(context);\n\n\t/* The list shall be followed by a right parenthesis (\")\" V250 5.7.3.1*/\n\tif (context->data[context->offset] != ')')\n\t\treturn false;\n\n\tcontext->offset++;\n\n\tnext_field(context);\n\n\treturn true;\n}"
  },
  {
    "function_name": "hfp_context_open_container",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "321-332",
    "snippet": "bool hfp_context_open_container(struct hfp_context *context)\n{\n\tskip_whitespace(context);\n\n\t/* The list shall be preceded by a left parenthesis \"(\") */\n\tif (context->data[context->offset] != '(')\n\t\treturn false;\n\n\tcontext->offset++;\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "skip_whitespace",
          "args": [
            "context"
          ],
          "line": 323
        },
        "resolved": true,
        "details": {
          "function_name": "hf_skip_whitespace",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
          "lines": "982-986",
          "snippet": "static void hf_skip_whitespace(struct hfp_context *context)\n{\n\twhile (context->data[context->offset] == ' ')\n\t\tcontext->offset++;\n}",
          "includes": [
            "#include \"src/shared/hfp.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <ctype.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void hf_skip_whitespace(struct hfp_context *context)\n{\n\twhile (context->data[context->offset] == ' ')\n\t\tcontext->offset++;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nbool hfp_context_open_container(struct hfp_context *context)\n{\n\tskip_whitespace(context);\n\n\t/* The list shall be preceded by a left parenthesis \"(\") */\n\tif (context->data[context->offset] != '(')\n\t\treturn false;\n\n\tcontext->offset++;\n\n\treturn true;\n}"
  },
  {
    "function_name": "hfp_context_get_number",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "295-319",
    "snippet": "bool hfp_context_get_number(struct hfp_context *context,\n\t\t\t\t\t\t\tunsigned int *val)\n{\n\tunsigned int i;\n\tint tmp = 0;\n\n\tskip_whitespace(context);\n\n\ti = context->offset;\n\n\twhile (context->data[i] >= '0' && context->data[i] <= '9')\n\t\ttmp = tmp * 10 + context->data[i++] - '0';\n\n\tif (i == context->offset)\n\t\treturn false;\n\n\tif (val)\n\t\t*val = tmp;\n\tcontext->offset = i;\n\n\tskip_whitespace(context);\n\tnext_field(context);\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "next_field",
          "args": [
            "context"
          ],
          "line": 316
        },
        "resolved": true,
        "details": {
          "function_name": "next_field",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
          "lines": "272-276",
          "snippet": "static void next_field(struct hfp_context *context)\n{\n\tif (context->data[context->offset] == ',')\n\t\tcontext->offset++;\n}",
          "includes": [
            "#include \"src/shared/hfp.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <ctype.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void next_field(struct hfp_context *context)\n{\n\tif (context->data[context->offset] == ',')\n\t\tcontext->offset++;\n}"
        }
      },
      {
        "call_info": {
          "callee": "skip_whitespace",
          "args": [
            "context"
          ],
          "line": 315
        },
        "resolved": true,
        "details": {
          "function_name": "hf_skip_whitespace",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
          "lines": "982-986",
          "snippet": "static void hf_skip_whitespace(struct hfp_context *context)\n{\n\twhile (context->data[context->offset] == ' ')\n\t\tcontext->offset++;\n}",
          "includes": [
            "#include \"src/shared/hfp.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <ctype.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void hf_skip_whitespace(struct hfp_context *context)\n{\n\twhile (context->data[context->offset] == ' ')\n\t\tcontext->offset++;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nbool hfp_context_get_number(struct hfp_context *context,\n\t\t\t\t\t\t\tunsigned int *val)\n{\n\tunsigned int i;\n\tint tmp = 0;\n\n\tskip_whitespace(context);\n\n\ti = context->offset;\n\n\twhile (context->data[i] >= '0' && context->data[i] <= '9')\n\t\ttmp = tmp * 10 + context->data[i++] - '0';\n\n\tif (i == context->offset)\n\t\treturn false;\n\n\tif (val)\n\t\t*val = tmp;\n\tcontext->offset = i;\n\n\tskip_whitespace(context);\n\tnext_field(context);\n\n\treturn true;\n}"
  },
  {
    "function_name": "hfp_context_get_number_default",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "278-293",
    "snippet": "bool hfp_context_get_number_default(struct hfp_context *context,\n\t\t\t\t\t\tunsigned int *val,\n\t\t\t\t\t\tunsigned int default_val)\n{\n\tskip_whitespace(context);\n\n\tif (context->data[context->offset] == ',') {\n\t\tif (val)\n\t\t\t*val = default_val;\n\n\t\tcontext->offset++;\n\t\treturn true;\n\t}\n\n\treturn hfp_context_get_number(context, val);\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "hfp_context_get_number",
          "args": [
            "context",
            "val"
          ],
          "line": 292
        },
        "resolved": true,
        "details": {
          "function_name": "hfp_context_get_number",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
          "lines": "295-319",
          "snippet": "bool hfp_context_get_number(struct hfp_context *context,\n\t\t\t\t\t\t\tunsigned int *val)\n{\n\tunsigned int i;\n\tint tmp = 0;\n\n\tskip_whitespace(context);\n\n\ti = context->offset;\n\n\twhile (context->data[i] >= '0' && context->data[i] <= '9')\n\t\ttmp = tmp * 10 + context->data[i++] - '0';\n\n\tif (i == context->offset)\n\t\treturn false;\n\n\tif (val)\n\t\t*val = tmp;\n\tcontext->offset = i;\n\n\tskip_whitespace(context);\n\tnext_field(context);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/hfp.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <ctype.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nbool hfp_context_get_number(struct hfp_context *context,\n\t\t\t\t\t\t\tunsigned int *val)\n{\n\tunsigned int i;\n\tint tmp = 0;\n\n\tskip_whitespace(context);\n\n\ti = context->offset;\n\n\twhile (context->data[i] >= '0' && context->data[i] <= '9')\n\t\ttmp = tmp * 10 + context->data[i++] - '0';\n\n\tif (i == context->offset)\n\t\treturn false;\n\n\tif (val)\n\t\t*val = tmp;\n\tcontext->offset = i;\n\n\tskip_whitespace(context);\n\tnext_field(context);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "skip_whitespace",
          "args": [
            "context"
          ],
          "line": 282
        },
        "resolved": true,
        "details": {
          "function_name": "hf_skip_whitespace",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
          "lines": "982-986",
          "snippet": "static void hf_skip_whitespace(struct hfp_context *context)\n{\n\twhile (context->data[context->offset] == ' ')\n\t\tcontext->offset++;\n}",
          "includes": [
            "#include \"src/shared/hfp.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <ctype.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void hf_skip_whitespace(struct hfp_context *context)\n{\n\twhile (context->data[context->offset] == ' ')\n\t\tcontext->offset++;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nbool hfp_context_get_number_default(struct hfp_context *context,\n\t\t\t\t\t\tunsigned int *val,\n\t\t\t\t\t\tunsigned int default_val)\n{\n\tskip_whitespace(context);\n\n\tif (context->data[context->offset] == ',') {\n\t\tif (val)\n\t\t\t*val = default_val;\n\n\t\tcontext->offset++;\n\t\treturn true;\n\t}\n\n\treturn hfp_context_get_number(context, val);\n}"
  },
  {
    "function_name": "next_field",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "272-276",
    "snippet": "static void next_field(struct hfp_context *context)\n{\n\tif (context->data[context->offset] == ',')\n\t\tcontext->offset++;\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void next_field(struct hfp_context *context)\n{\n\tif (context->data[context->offset] == ',')\n\t\tcontext->offset++;\n}"
  },
  {
    "function_name": "handle_at_command",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "193-270",
    "snippet": "static bool handle_at_command(struct hfp_gw *hfp, const char *data)\n{\n\tstruct cmd_handler *handler;\n\tconst char *separators = \";?=\\0\";\n\tstruct hfp_context context;\n\tenum hfp_gw_cmd_type type;\n\tchar lookup_prefix[18];\n\tuint8_t pref_len = 0;\n\tconst char *prefix;\n\tint i;\n\n\tcontext.offset = 0;\n\tcontext.data = data;\n\n\tskip_whitespace(&context);\n\n\tif (strlen(data + context.offset) < 3)\n\t\treturn false;\n\n\tif (strncmp(data + context.offset, \"AT\", 2))\n\t\tif (strncmp(data + context.offset, \"at\", 2))\n\t\t\treturn false;\n\n\tcontext.offset += 2;\n\tprefix = data + context.offset;\n\n\tif (isalpha(prefix[0])) {\n\t\tlookup_prefix[pref_len++] = toupper(prefix[0]);\n\t} else {\n\t\tpref_len = strcspn(prefix, separators);\n\t\tif (pref_len > 17 || pref_len < 2)\n\t\t\treturn false;\n\n\t\tfor (i = 0; i < pref_len; i++)\n\t\t\tlookup_prefix[i] = toupper(prefix[i]);\n\t}\n\n\tlookup_prefix[pref_len] = '\\0';\n\tcontext.offset += pref_len;\n\n\tif (lookup_prefix[0] == 'D') {\n\t\ttype = HFP_GW_CMD_TYPE_SET;\n\t\tgoto done;\n\t}\n\n\tif (data[context.offset] == '=') {\n\t\tcontext.offset++;\n\t\tif (data[context.offset] == '?') {\n\t\t\tcontext.offset++;\n\t\t\ttype = HFP_GW_CMD_TYPE_TEST;\n\t\t} else {\n\t\t\ttype = HFP_GW_CMD_TYPE_SET;\n\t\t}\n\t\tgoto done;\n\t}\n\n\tif (data[context.offset] == '?') {\n\t\tcontext.offset++;\n\t\ttype = HFP_GW_CMD_TYPE_READ;\n\t\tgoto done;\n\t}\n\n\ttype = HFP_GW_CMD_TYPE_COMMAND;\n\ndone:\n\n\thandler = queue_find(hfp->cmd_handlers, match_handler_prefix,\n\t\t\t\t\t\t\t\tlookup_prefix);\n\tif (!handler) {\n\t\thandle_unknown_at_command(hfp, data);\n\t\treturn true;\n\t}\n\n\thfp->result_pending = true;\n\thandler->callback(&context, type, handler->user_data);\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "handler->callback",
          "args": [
            "&context",
            "type",
            "handler->user_data"
          ],
          "line": 267
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "handle_unknown_at_command",
          "args": [
            "hfp",
            "data"
          ],
          "line": 262
        },
        "resolved": true,
        "details": {
          "function_name": "handle_unknown_at_command",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
          "lines": "182-191",
          "snippet": "static void handle_unknown_at_command(struct hfp_gw *hfp,\n\t\t\t\t\t\t\tconst char *data)\n{\n\tif (hfp->command_callback) {\n\t\thfp->result_pending = true;\n\t\thfp->command_callback(data, hfp->command_data);\n\t} else {\n\t\thfp_gw_send_result(hfp, HFP_RESULT_ERROR);\n\t}\n}",
          "includes": [
            "#include \"src/shared/hfp.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <ctype.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void handle_unknown_at_command(struct hfp_gw *hfp,\n\t\t\t\t\t\t\tconst char *data)\n{\n\tif (hfp->command_callback) {\n\t\thfp->result_pending = true;\n\t\thfp->command_callback(data, hfp->command_data);\n\t} else {\n\t\thfp_gw_send_result(hfp, HFP_RESULT_ERROR);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_find",
          "args": [
            "hfp->cmd_handlers",
            "match_handler_prefix",
            "lookup_prefix"
          ],
          "line": 259
        },
        "resolved": true,
        "details": {
          "function_name": "queue_find",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "231-247",
          "snippet": "void *queue_find(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tconst void *match_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tfor (entry = queue->head; entry; entry = entry->next)\n\t\tif (function(entry->data, match_data))\n\t\t\treturn entry->data;\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid *queue_find(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tconst void *match_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tfor (entry = queue->head; entry; entry = entry->next)\n\t\tif (function(entry->data, match_data))\n\t\t\treturn entry->data;\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "toupper",
          "args": [
            "prefix[i]"
          ],
          "line": 227
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcspn",
          "args": [
            "prefix",
            "separators"
          ],
          "line": 222
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "toupper",
          "args": [
            "prefix[0]"
          ],
          "line": 220
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "isalpha",
          "args": [
            "prefix[0]"
          ],
          "line": 219
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strncmp",
          "args": [
            "data + context.offset",
            "\"at\"",
            "2"
          ],
          "line": 213
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strncmp",
          "args": [
            "data + context.offset",
            "\"AT\"",
            "2"
          ],
          "line": 212
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "data + context.offset"
          ],
          "line": 209
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "skip_whitespace",
          "args": [
            "&context"
          ],
          "line": 207
        },
        "resolved": true,
        "details": {
          "function_name": "hf_skip_whitespace",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
          "lines": "982-986",
          "snippet": "static void hf_skip_whitespace(struct hfp_context *context)\n{\n\twhile (context->data[context->offset] == ' ')\n\t\tcontext->offset++;\n}",
          "includes": [
            "#include \"src/shared/hfp.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <ctype.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void hf_skip_whitespace(struct hfp_context *context)\n{\n\twhile (context->data[context->offset] == ' ')\n\t\tcontext->offset++;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic bool handle_at_command(struct hfp_gw *hfp, const char *data)\n{\n\tstruct cmd_handler *handler;\n\tconst char *separators = \";?=\\0\";\n\tstruct hfp_context context;\n\tenum hfp_gw_cmd_type type;\n\tchar lookup_prefix[18];\n\tuint8_t pref_len = 0;\n\tconst char *prefix;\n\tint i;\n\n\tcontext.offset = 0;\n\tcontext.data = data;\n\n\tskip_whitespace(&context);\n\n\tif (strlen(data + context.offset) < 3)\n\t\treturn false;\n\n\tif (strncmp(data + context.offset, \"AT\", 2))\n\t\tif (strncmp(data + context.offset, \"at\", 2))\n\t\t\treturn false;\n\n\tcontext.offset += 2;\n\tprefix = data + context.offset;\n\n\tif (isalpha(prefix[0])) {\n\t\tlookup_prefix[pref_len++] = toupper(prefix[0]);\n\t} else {\n\t\tpref_len = strcspn(prefix, separators);\n\t\tif (pref_len > 17 || pref_len < 2)\n\t\t\treturn false;\n\n\t\tfor (i = 0; i < pref_len; i++)\n\t\t\tlookup_prefix[i] = toupper(prefix[i]);\n\t}\n\n\tlookup_prefix[pref_len] = '\\0';\n\tcontext.offset += pref_len;\n\n\tif (lookup_prefix[0] == 'D') {\n\t\ttype = HFP_GW_CMD_TYPE_SET;\n\t\tgoto done;\n\t}\n\n\tif (data[context.offset] == '=') {\n\t\tcontext.offset++;\n\t\tif (data[context.offset] == '?') {\n\t\t\tcontext.offset++;\n\t\t\ttype = HFP_GW_CMD_TYPE_TEST;\n\t\t} else {\n\t\t\ttype = HFP_GW_CMD_TYPE_SET;\n\t\t}\n\t\tgoto done;\n\t}\n\n\tif (data[context.offset] == '?') {\n\t\tcontext.offset++;\n\t\ttype = HFP_GW_CMD_TYPE_READ;\n\t\tgoto done;\n\t}\n\n\ttype = HFP_GW_CMD_TYPE_COMMAND;\n\ndone:\n\n\thandler = queue_find(hfp->cmd_handlers, match_handler_prefix,\n\t\t\t\t\t\t\t\tlookup_prefix);\n\tif (!handler) {\n\t\thandle_unknown_at_command(hfp, data);\n\t\treturn true;\n\t}\n\n\thfp->result_pending = true;\n\thandler->callback(&context, type, handler->user_data);\n\n\treturn true;\n}"
  },
  {
    "function_name": "handle_unknown_at_command",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "182-191",
    "snippet": "static void handle_unknown_at_command(struct hfp_gw *hfp,\n\t\t\t\t\t\t\tconst char *data)\n{\n\tif (hfp->command_callback) {\n\t\thfp->result_pending = true;\n\t\thfp->command_callback(data, hfp->command_data);\n\t} else {\n\t\thfp_gw_send_result(hfp, HFP_RESULT_ERROR);\n\t}\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "hfp_gw_send_result",
          "args": [
            "hfp",
            "HFP_RESULT_ERROR"
          ],
          "line": 189
        },
        "resolved": true,
        "details": {
          "function_name": "hfp_gw_send_result",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
          "lines": "717-759",
          "snippet": "bool hfp_gw_send_result(struct hfp_gw *hfp, enum hfp_result result)\n{\n\tconst char *str;\n\n\tif (!hfp)\n\t\treturn false;\n\n\tswitch (result) {\n\tcase HFP_RESULT_OK:\n\t\tstr = \"OK\";\n\t\tbreak;\n\tcase HFP_RESULT_ERROR:\n\t\tstr = \"ERROR\";\n\t\tbreak;\n\tcase HFP_RESULT_RING:\n\tcase HFP_RESULT_NO_CARRIER:\n\tcase HFP_RESULT_BUSY:\n\tcase HFP_RESULT_NO_ANSWER:\n\tcase HFP_RESULT_DELAYED:\n\tcase HFP_RESULT_BLACKLISTED:\n\tcase HFP_RESULT_CME_ERROR:\n\tcase HFP_RESULT_NO_DIALTONE:\n\tcase HFP_RESULT_CONNECT:\n\tdefault:\n\t\treturn false;\n\t}\n\n\tif (ringbuf_printf(hfp->write_buf, \"\\r\\n%s\\r\\n\", str) < 0)\n\t\treturn false;\n\n\twakeup_writer(hfp);\n\n\t/*\n\t * There might be already something to read in the ring buffer.\n\t * If so, let's read it.\n\t */\n\tif (hfp->result_pending) {\n\t\thfp->result_pending = false;\n\t\tprocess_input(hfp);\n\t}\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/hfp.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <ctype.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nbool hfp_gw_send_result(struct hfp_gw *hfp, enum hfp_result result)\n{\n\tconst char *str;\n\n\tif (!hfp)\n\t\treturn false;\n\n\tswitch (result) {\n\tcase HFP_RESULT_OK:\n\t\tstr = \"OK\";\n\t\tbreak;\n\tcase HFP_RESULT_ERROR:\n\t\tstr = \"ERROR\";\n\t\tbreak;\n\tcase HFP_RESULT_RING:\n\tcase HFP_RESULT_NO_CARRIER:\n\tcase HFP_RESULT_BUSY:\n\tcase HFP_RESULT_NO_ANSWER:\n\tcase HFP_RESULT_DELAYED:\n\tcase HFP_RESULT_BLACKLISTED:\n\tcase HFP_RESULT_CME_ERROR:\n\tcase HFP_RESULT_NO_DIALTONE:\n\tcase HFP_RESULT_CONNECT:\n\tdefault:\n\t\treturn false;\n\t}\n\n\tif (ringbuf_printf(hfp->write_buf, \"\\r\\n%s\\r\\n\", str) < 0)\n\t\treturn false;\n\n\twakeup_writer(hfp);\n\n\t/*\n\t * There might be already something to read in the ring buffer.\n\t * If so, let's read it.\n\t */\n\tif (hfp->result_pending) {\n\t\thfp->result_pending = false;\n\t\tprocess_input(hfp);\n\t}\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "hfp->command_callback",
          "args": [
            "data",
            "hfp->command_data"
          ],
          "line": 187
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void handle_unknown_at_command(struct hfp_gw *hfp,\n\t\t\t\t\t\t\tconst char *data)\n{\n\tif (hfp->command_callback) {\n\t\thfp->result_pending = true;\n\t\thfp->command_callback(data, hfp->command_data);\n\t} else {\n\t\thfp_gw_send_result(hfp, HFP_RESULT_ERROR);\n\t}\n}"
  },
  {
    "function_name": "skip_whitespace",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "176-180",
    "snippet": "static void skip_whitespace(struct hfp_context *context)\n{\n\twhile (context->data[context->offset] == ' ')\n\t\tcontext->offset++;\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void skip_whitespace(struct hfp_context *context)\n{\n\twhile (context->data[context->offset] == ' ')\n\t\tcontext->offset++;\n}"
  },
  {
    "function_name": "wakeup_writer",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "161-174",
    "snippet": "static void wakeup_writer(struct hfp_gw *hfp)\n{\n\tif (hfp->writer_active)\n\t\treturn;\n\n\tif (!ringbuf_len(hfp->write_buf))\n\t\treturn;\n\n\tif (!io_set_write_handler(hfp->io, can_write_data,\n\t\t\t\t\thfp, write_watch_destroy))\n\t\treturn;\n\n\thfp->writer_active = true;\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "io_set_write_handler",
          "args": [
            "hfp->io",
            "can_write_data",
            "hfp",
            "write_watch_destroy"
          ],
          "line": 169
        },
        "resolved": true,
        "details": {
          "function_name": "io_set_write_handler",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-glib.c",
          "lines": "254-258",
          "snippet": "bool io_set_write_handler(struct io *io, io_callback_func_t callback,\n\t\t\t\tvoid *user_data, io_destroy_func_t destroy)\n{\n\treturn io_set_handler(io, G_IO_OUT, callback, user_data, destroy);\n}",
          "includes": [
            "#include \"src/shared/io.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/io.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nbool io_set_write_handler(struct io *io, io_callback_func_t callback,\n\t\t\t\tvoid *user_data, io_destroy_func_t destroy)\n{\n\treturn io_set_handler(io, G_IO_OUT, callback, user_data, destroy);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ringbuf_len",
          "args": [
            "hfp->write_buf"
          ],
          "line": 166
        },
        "resolved": true,
        "details": {
          "function_name": "ringbuf_len",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ringbuf.c",
          "lines": "117-123",
          "snippet": "size_t ringbuf_len(struct ringbuf *ringbuf)\n{\n\tif (!ringbuf)\n\t\treturn 0;\n\n\treturn ringbuf->in - ringbuf->out;\n}",
          "includes": [
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <sys/param.h>",
            "#include <sys/uio.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <sys/param.h>\n#include <sys/uio.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nsize_t ringbuf_len(struct ringbuf *ringbuf)\n{\n\tif (!ringbuf)\n\t\treturn 0;\n\n\treturn ringbuf->in - ringbuf->out;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void wakeup_writer(struct hfp_gw *hfp)\n{\n\tif (hfp->writer_active)\n\t\treturn;\n\n\tif (!ringbuf_len(hfp->write_buf))\n\t\treturn;\n\n\tif (!io_set_write_handler(hfp->io, can_write_data,\n\t\t\t\t\thfp, write_watch_destroy))\n\t\treturn;\n\n\thfp->writer_active = true;\n}"
  },
  {
    "function_name": "can_write_data",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "146-159",
    "snippet": "static bool can_write_data(struct io *io, void *user_data)\n{\n\tstruct hfp_gw *hfp = user_data;\n\tssize_t bytes_written;\n\n\tbytes_written = ringbuf_write(hfp->write_buf, hfp->fd);\n\tif (bytes_written < 0)\n\t\treturn false;\n\n\tif (ringbuf_len(hfp->write_buf) > 0)\n\t\treturn true;\n\n\treturn false;\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ringbuf_len",
          "args": [
            "hfp->write_buf"
          ],
          "line": 155
        },
        "resolved": true,
        "details": {
          "function_name": "ringbuf_len",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ringbuf.c",
          "lines": "117-123",
          "snippet": "size_t ringbuf_len(struct ringbuf *ringbuf)\n{\n\tif (!ringbuf)\n\t\treturn 0;\n\n\treturn ringbuf->in - ringbuf->out;\n}",
          "includes": [
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <sys/param.h>",
            "#include <sys/uio.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <sys/param.h>\n#include <sys/uio.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nsize_t ringbuf_len(struct ringbuf *ringbuf)\n{\n\tif (!ringbuf)\n\t\treturn 0;\n\n\treturn ringbuf->in - ringbuf->out;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ringbuf_write",
          "args": [
            "hfp->write_buf",
            "hfp->fd"
          ],
          "line": 151
        },
        "resolved": true,
        "details": {
          "function_name": "ringbuf_write",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ringbuf.c",
          "lines": "161-198",
          "snippet": "ssize_t ringbuf_write(struct ringbuf *ringbuf, int fd)\n{\n\tsize_t len, offset, end;\n\tstruct iovec iov[2];\n\tssize_t consumed;\n\n\tif (!ringbuf || fd < 0)\n\t\treturn -1;\n\n\t/* Determine how much data is available */\n\tlen = ringbuf->in - ringbuf->out;\n\tif (!len)\n\t\treturn 0;\n\n\t/* Grab data from buffer starting at offset until the end */\n\toffset = ringbuf->out & (ringbuf->size - 1);\n\tend = MIN(len, ringbuf->size - offset);\n\n\tiov[0].iov_base = ringbuf->buffer + offset;\n\tiov[0].iov_len = end;\n\n\t/* Use second vector for remainder from the beginning */\n\tiov[1].iov_base = ringbuf->buffer;\n\tiov[1].iov_len = len - end;\n\n\tconsumed = writev(fd, iov, 2);\n\tif (consumed < 0)\n\t\treturn -1;\n\n\tringbuf->out += consumed;\n\n\tif (ringbuf->out == ringbuf->in) {\n\t\tringbuf->in = RINGBUF_RESET;\n\t\tringbuf->out = RINGBUF_RESET;\n\t}\n\n\treturn consumed;\n}",
          "includes": [
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <sys/param.h>",
            "#include <sys/uio.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define RINGBUF_RESET 0"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <sys/param.h>\n#include <sys/uio.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\n#define RINGBUF_RESET 0\n\nssize_t ringbuf_write(struct ringbuf *ringbuf, int fd)\n{\n\tsize_t len, offset, end;\n\tstruct iovec iov[2];\n\tssize_t consumed;\n\n\tif (!ringbuf || fd < 0)\n\t\treturn -1;\n\n\t/* Determine how much data is available */\n\tlen = ringbuf->in - ringbuf->out;\n\tif (!len)\n\t\treturn 0;\n\n\t/* Grab data from buffer starting at offset until the end */\n\toffset = ringbuf->out & (ringbuf->size - 1);\n\tend = MIN(len, ringbuf->size - offset);\n\n\tiov[0].iov_base = ringbuf->buffer + offset;\n\tiov[0].iov_len = end;\n\n\t/* Use second vector for remainder from the beginning */\n\tiov[1].iov_base = ringbuf->buffer;\n\tiov[1].iov_len = len - end;\n\n\tconsumed = writev(fd, iov, 2);\n\tif (consumed < 0)\n\t\treturn -1;\n\n\tringbuf->out += consumed;\n\n\tif (ringbuf->out == ringbuf->in) {\n\t\tringbuf->in = RINGBUF_RESET;\n\t\tringbuf->out = RINGBUF_RESET;\n\t}\n\n\treturn consumed;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic bool can_write_data(struct io *io, void *user_data)\n{\n\tstruct hfp_gw *hfp = user_data;\n\tssize_t bytes_written;\n\n\tbytes_written = ringbuf_write(hfp->write_buf, hfp->fd);\n\tif (bytes_written < 0)\n\t\treturn false;\n\n\tif (ringbuf_len(hfp->write_buf) > 0)\n\t\treturn true;\n\n\treturn false;\n}"
  },
  {
    "function_name": "write_watch_destroy",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "139-144",
    "snippet": "static void write_watch_destroy(void *user_data)\n{\n\tstruct hfp_gw *hfp = user_data;\n\n\thfp->writer_active = false;\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void write_watch_destroy(void *user_data)\n{\n\tstruct hfp_gw *hfp = user_data;\n\n\thfp->writer_active = false;\n}"
  },
  {
    "function_name": "match_handler_prefix",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "128-137",
    "snippet": "static bool match_handler_prefix(const void *a, const void *b)\n{\n\tconst struct cmd_handler *handler = a;\n\tconst char *prefix = b;\n\n\tif (strcmp(handler->prefix, prefix) != 0)\n\t\treturn false;\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "handler->prefix",
            "prefix"
          ],
          "line": 133
        },
        "resolved": true,
        "details": {
          "function_name": "g_strcmp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "1927-1930",
          "snippet": "static gint g_strcmp(gconstpointer a, gconstpointer b)\n{\n\treturn strcmp(a, b);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic gint g_strcmp(gconstpointer a, gconstpointer b)\n{\n\treturn strcmp(a, b);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic bool match_handler_prefix(const void *a, const void *b)\n{\n\tconst struct cmd_handler *handler = a;\n\tconst char *prefix = b;\n\n\tif (strcmp(handler->prefix, prefix) != 0)\n\t\treturn false;\n\n\treturn true;\n}"
  },
  {
    "function_name": "destroy_cmd_handler",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
    "lines": "116-126",
    "snippet": "static void destroy_cmd_handler(void *data)\n{\n\tstruct cmd_handler *handler = data;\n\n\tif (handler->destroy)\n\t\thandler->destroy(handler->user_data);\n\n\tfree(handler->prefix);\n\n\tfree(handler);\n}",
    "includes": [
      "#include \"src/shared/hfp.h\"",
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/ringbuf.h\"",
      "#include \"src/shared/util.h\"",
      "#include <ctype.h>",
      "#include <stdarg.h>",
      "#include <string.h>",
      "#include <unistd.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "handler"
          ],
          "line": 125
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "956-985",
          "snippet": "static void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}"
        }
      },
      {
        "call_info": {
          "callee": "handler->destroy",
          "args": [
            "handler->user_data"
          ],
          "line": 121
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void destroy_cmd_handler(void *data)\n{\n\tstruct cmd_handler *handler = data;\n\n\tif (handler->destroy)\n\t\thandler->destroy(handler->user_data);\n\n\tfree(handler->prefix);\n\n\tfree(handler);\n}"
  }
]