[
  {
    "function_name": "btd_profile_cleanup",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
    "lines": "2500-2528",
    "snippet": "void btd_profile_cleanup(void)\n{\n\twhile (ext_profiles) {\n\t\tstruct ext_profile *ext = ext_profiles->data;\n\t\tDBusConnection *conn = btd_get_dbus_connection();\n\t\tDBusMessage *msg;\n\n\t\tDBG(\"Releasing \\\"%s\\\"\", ext->name);\n\n\t\tg_slist_free_full(ext->conns, ext_io_destroy);\n\t\text->conns = NULL;\n\n\t\tmsg = dbus_message_new_method_call(ext->owner, ext->path,\n\t\t\t\t\t\t\t\"org.bluez.Profile1\",\n\t\t\t\t\t\t\t\"Release\");\n\t\tif (msg)\n\t\t\tg_dbus_send_message(conn, msg);\n\n\t\tg_dbus_remove_watch(conn, ext->id);\n\t\tremove_ext(ext);\n\n\t}\n\n\tg_slist_free_full(custom_props, free_property);\n\tcustom_props = NULL;\n\n\tg_dbus_unregister_interface(btd_get_dbus_connection(),\n\t\t\t\t\"/org/bluez\", \"org.bluez.ProfileManager1\");\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"sdp-xml.h\"",
      "#include \"sdp-client.h\"",
      "#include \"dbus-common.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"btio/btio.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static GSList *custom_props = NULL;",
      "static GSList *ext_profiles = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_dbus_unregister_interface",
          "args": [
            "btd_get_dbus_connection()",
            "\"/org/bluez\"",
            "\"org.bluez.ProfileManager1\""
          ],
          "line": 2526
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_get_dbus_connection",
          "args": [],
          "line": 2526
        },
        "resolved": true,
        "details": {
          "function_name": "btd_get_dbus_connection",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/dbus-common.c",
          "lines": "61-64",
          "snippet": "DBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *connection = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *connection = NULL;\n\nDBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_slist_free_full",
          "args": [
            "custom_props",
            "free_property"
          ],
          "line": 2523
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "remove_ext",
          "args": [
            "ext"
          ],
          "line": 2519
        },
        "resolved": true,
        "details": {
          "function_name": "remove_ext",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
          "lines": "2318-2341",
          "snippet": "static void remove_ext(struct ext_profile *ext)\n{\n\tadapter_foreach(adapter_remove_profile, &ext->p);\n\n\text_profiles = g_slist_remove(ext_profiles, ext);\n\n\tDBG(\"Removed \\\"%s\\\"\", ext->name);\n\n\text_remove_records(ext, NULL);\n\n\tg_slist_free_full(ext->servers, ext_io_destroy);\n\tg_slist_free_full(ext->conns, ext_io_destroy);\n\n\tg_free(ext->remote_uuid);\n\tg_free(ext->name);\n\tg_free(ext->owner);\n\tfree(ext->uuid);\n\tfree(ext->service);\n\tg_free(ext->role);\n\tg_free(ext->path);\n\tg_free(ext->record);\n\n\tg_free(ext);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdp-xml.h\"",
            "#include \"sdp-client.h\"",
            "#include \"dbus-common.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"btio/btio.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static GSList *ext_profiles = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic GSList *ext_profiles = NULL;\n\nstatic void remove_ext(struct ext_profile *ext)\n{\n\tadapter_foreach(adapter_remove_profile, &ext->p);\n\n\text_profiles = g_slist_remove(ext_profiles, ext);\n\n\tDBG(\"Removed \\\"%s\\\"\", ext->name);\n\n\text_remove_records(ext, NULL);\n\n\tg_slist_free_full(ext->servers, ext_io_destroy);\n\tg_slist_free_full(ext->conns, ext_io_destroy);\n\n\tg_free(ext->remote_uuid);\n\tg_free(ext->name);\n\tg_free(ext->owner);\n\tfree(ext->uuid);\n\tfree(ext->service);\n\tg_free(ext->role);\n\tg_free(ext->path);\n\tg_free(ext->record);\n\n\tg_free(ext);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_remove_watch",
          "args": [
            "conn",
            "ext->id"
          ],
          "line": 2518
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_send_message",
          "args": [
            "conn",
            "msg"
          ],
          "line": 2516
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_new_method_call",
          "args": [
            "ext->owner",
            "ext->path",
            "\"org.bluez.Profile1\"",
            "\"Release\""
          ],
          "line": 2512
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_free_full",
          "args": [
            "ext->conns",
            "ext_io_destroy"
          ],
          "line": 2509
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Releasing \\\"%s\\\"\"",
            "ext->name"
          ],
          "line": 2507
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic GSList *custom_props = NULL;\nstatic GSList *ext_profiles = NULL;\n\nvoid btd_profile_cleanup(void)\n{\n\twhile (ext_profiles) {\n\t\tstruct ext_profile *ext = ext_profiles->data;\n\t\tDBusConnection *conn = btd_get_dbus_connection();\n\t\tDBusMessage *msg;\n\n\t\tDBG(\"Releasing \\\"%s\\\"\", ext->name);\n\n\t\tg_slist_free_full(ext->conns, ext_io_destroy);\n\t\text->conns = NULL;\n\n\t\tmsg = dbus_message_new_method_call(ext->owner, ext->path,\n\t\t\t\t\t\t\t\"org.bluez.Profile1\",\n\t\t\t\t\t\t\t\"Release\");\n\t\tif (msg)\n\t\t\tg_dbus_send_message(conn, msg);\n\n\t\tg_dbus_remove_watch(conn, ext->id);\n\t\tremove_ext(ext);\n\n\t}\n\n\tg_slist_free_full(custom_props, free_property);\n\tcustom_props = NULL;\n\n\tg_dbus_unregister_interface(btd_get_dbus_connection(),\n\t\t\t\t\"/org/bluez\", \"org.bluez.ProfileManager1\");\n}"
  },
  {
    "function_name": "btd_profile_init",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
    "lines": "2493-2498",
    "snippet": "void btd_profile_init(void)\n{\n\tg_dbus_register_interface(btd_get_dbus_connection(),\n\t\t\t\t\"/org/bluez\", \"org.bluez.ProfileManager1\",\n\t\t\t\tmethods, NULL, NULL, NULL, NULL);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"sdp-xml.h\"",
      "#include \"sdp-client.h\"",
      "#include \"dbus-common.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"btio/btio.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static const GDBusMethodTable methods[] = {\n\t{ GDBUS_METHOD(\"RegisterProfile\",\n\t\t\tGDBUS_ARGS({ \"profile\", \"o\"}, { \"UUID\", \"s\" },\n\t\t\t\t\t\t{ \"options\", \"a{sv}\" }),\n\t\t\tNULL, register_profile) },\n\t{ GDBUS_METHOD(\"UnregisterProfile\", GDBUS_ARGS({ \"profile\", \"o\" }),\n\t\t\tNULL, unregister_profile) },\n\t{ }\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_dbus_register_interface",
          "args": [
            "btd_get_dbus_connection()",
            "\"/org/bluez\"",
            "\"org.bluez.ProfileManager1\"",
            "methods",
            "NULL",
            "NULL",
            "NULL",
            "NULL"
          ],
          "line": 2495
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_get_dbus_connection",
          "args": [],
          "line": 2495
        },
        "resolved": true,
        "details": {
          "function_name": "btd_get_dbus_connection",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/dbus-common.c",
          "lines": "61-64",
          "snippet": "DBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *connection = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *connection = NULL;\n\nDBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic const GDBusMethodTable methods[] = {\n\t{ GDBUS_METHOD(\"RegisterProfile\",\n\t\t\tGDBUS_ARGS({ \"profile\", \"o\"}, { \"UUID\", \"s\" },\n\t\t\t\t\t\t{ \"options\", \"a{sv}\" }),\n\t\t\tNULL, register_profile) },\n\t{ GDBUS_METHOD(\"UnregisterProfile\", GDBUS_ARGS({ \"profile\", \"o\" }),\n\t\t\tNULL, unregister_profile) },\n\t{ }\n};\n\nvoid btd_profile_init(void)\n{\n\tg_dbus_register_interface(btd_get_dbus_connection(),\n\t\t\t\t\"/org/bluez\", \"org.bluez.ProfileManager1\",\n\t\t\t\tmethods, NULL, NULL, NULL, NULL);\n}"
  },
  {
    "function_name": "btd_profile_remove_custom_prop",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
    "lines": "2479-2491",
    "snippet": "bool btd_profile_remove_custom_prop(const char *uuid, const char *name)\n{\n\tstruct btd_profile_custom_property *prop;\n\n\tprop = find_custom_prop(uuid, name);\n\tif (prop == NULL)\n\t\treturn false;\n\n\tcustom_props = g_slist_remove(custom_props, prop);\n\tfree_property(prop);\n\n\treturn false;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"sdp-xml.h\"",
      "#include \"sdp-client.h\"",
      "#include \"dbus-common.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"btio/btio.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static GSList *custom_props = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "free_property",
          "args": [
            "prop"
          ],
          "line": 2488
        },
        "resolved": true,
        "details": {
          "function_name": "free_property",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
          "lines": "2468-2477",
          "snippet": "static void free_property(gpointer data)\n{\n\tstruct btd_profile_custom_property *p = data;\n\n\tg_free(p->uuid);\n\tg_free(p->type);\n\tg_free(p->name);\n\n\tg_free(p);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdp-xml.h\"",
            "#include \"sdp-client.h\"",
            "#include \"dbus-common.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"btio/btio.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void free_property(gpointer data)\n{\n\tstruct btd_profile_custom_property *p = data;\n\n\tg_free(p->uuid);\n\tg_free(p->type);\n\tg_free(p->name);\n\n\tg_free(p);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_slist_remove",
          "args": [
            "custom_props",
            "prop"
          ],
          "line": 2487
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "find_custom_prop",
          "args": [
            "uuid",
            "name"
          ],
          "line": 2483
        },
        "resolved": true,
        "details": {
          "function_name": "find_custom_prop",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
          "lines": "2424-2440",
          "snippet": "static struct btd_profile_custom_property *find_custom_prop(const char *uuid,\n\t\t\t\t\t\t\tconst char *name)\n{\n\tGSList *l;\n\n\tfor (l = custom_props; l; l = l->next) {\n\t\tstruct btd_profile_custom_property *prop = l->data;\n\n\t\tif (strcasecmp(prop->uuid, uuid) != 0)\n\t\t\tcontinue;\n\n\t\tif (g_strcmp0(prop->name, name) == 0)\n\t\t\treturn prop;\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdp-xml.h\"",
            "#include \"sdp-client.h\"",
            "#include \"dbus-common.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"btio/btio.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static GSList *custom_props = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic GSList *custom_props = NULL;\n\nstatic struct btd_profile_custom_property *find_custom_prop(const char *uuid,\n\t\t\t\t\t\t\tconst char *name)\n{\n\tGSList *l;\n\n\tfor (l = custom_props; l; l = l->next) {\n\t\tstruct btd_profile_custom_property *prop = l->data;\n\n\t\tif (strcasecmp(prop->uuid, uuid) != 0)\n\t\t\tcontinue;\n\n\t\tif (g_strcmp0(prop->name, name) == 0)\n\t\t\treturn prop;\n\t}\n\n\treturn NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic GSList *custom_props = NULL;\n\nbool btd_profile_remove_custom_prop(const char *uuid, const char *name)\n{\n\tstruct btd_profile_custom_property *prop;\n\n\tprop = find_custom_prop(uuid, name);\n\tif (prop == NULL)\n\t\treturn false;\n\n\tcustom_props = g_slist_remove(custom_props, prop);\n\tfree_property(prop);\n\n\treturn false;\n}"
  },
  {
    "function_name": "free_property",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
    "lines": "2468-2477",
    "snippet": "static void free_property(gpointer data)\n{\n\tstruct btd_profile_custom_property *p = data;\n\n\tg_free(p->uuid);\n\tg_free(p->type);\n\tg_free(p->name);\n\n\tg_free(p);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"sdp-xml.h\"",
      "#include \"sdp-client.h\"",
      "#include \"dbus-common.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"btio/btio.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "p"
          ],
          "line": 2476
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "p->name"
          ],
          "line": 2474
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "p->type"
          ],
          "line": 2473
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "p->uuid"
          ],
          "line": 2472
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void free_property(gpointer data)\n{\n\tstruct btd_profile_custom_property *p = data;\n\n\tg_free(p->uuid);\n\tg_free(p->type);\n\tg_free(p->name);\n\n\tg_free(p);\n}"
  },
  {
    "function_name": "btd_profile_add_custom_prop",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
    "lines": "2442-2466",
    "snippet": "bool btd_profile_add_custom_prop(const char *uuid, const char *type,\n\t\t\t\t\tconst char *name,\n\t\t\t\t\tbtd_profile_prop_exists exists,\n\t\t\t\t\tbtd_profile_prop_get get,\n\t\t\t\t\tvoid *user_data)\n{\n\tstruct btd_profile_custom_property *prop;\n\n\tprop = find_custom_prop(uuid, name);\n\tif (prop != NULL)\n\t\treturn false;\n\n\tprop = g_new0(struct btd_profile_custom_property, 1);\n\n\tprop->uuid = strdup(uuid);\n\tprop->type = g_strdup(type);\n\tprop->name = g_strdup(name);\n\tprop->exists = exists;\n\tprop->get = get;\n\tprop->user_data = user_data;\n\n\tcustom_props = g_slist_append(custom_props, prop);\n\n\treturn true;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"sdp-xml.h\"",
      "#include \"sdp-client.h\"",
      "#include \"dbus-common.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"btio/btio.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static GSList *custom_props = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_slist_append",
          "args": [
            "custom_props",
            "prop"
          ],
          "line": 2463
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "name"
          ],
          "line": 2458
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "type"
          ],
          "line": 2457
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "uuid"
          ],
          "line": 2456
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_new0",
          "args": [
            "structbtd_profile_custom_property",
            "1"
          ],
          "line": 2454
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "find_custom_prop",
          "args": [
            "uuid",
            "name"
          ],
          "line": 2450
        },
        "resolved": true,
        "details": {
          "function_name": "find_custom_prop",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
          "lines": "2424-2440",
          "snippet": "static struct btd_profile_custom_property *find_custom_prop(const char *uuid,\n\t\t\t\t\t\t\tconst char *name)\n{\n\tGSList *l;\n\n\tfor (l = custom_props; l; l = l->next) {\n\t\tstruct btd_profile_custom_property *prop = l->data;\n\n\t\tif (strcasecmp(prop->uuid, uuid) != 0)\n\t\t\tcontinue;\n\n\t\tif (g_strcmp0(prop->name, name) == 0)\n\t\t\treturn prop;\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdp-xml.h\"",
            "#include \"sdp-client.h\"",
            "#include \"dbus-common.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"btio/btio.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static GSList *custom_props = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic GSList *custom_props = NULL;\n\nstatic struct btd_profile_custom_property *find_custom_prop(const char *uuid,\n\t\t\t\t\t\t\tconst char *name)\n{\n\tGSList *l;\n\n\tfor (l = custom_props; l; l = l->next) {\n\t\tstruct btd_profile_custom_property *prop = l->data;\n\n\t\tif (strcasecmp(prop->uuid, uuid) != 0)\n\t\t\tcontinue;\n\n\t\tif (g_strcmp0(prop->name, name) == 0)\n\t\t\treturn prop;\n\t}\n\n\treturn NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic GSList *custom_props = NULL;\n\nbool btd_profile_add_custom_prop(const char *uuid, const char *type,\n\t\t\t\t\tconst char *name,\n\t\t\t\t\tbtd_profile_prop_exists exists,\n\t\t\t\t\tbtd_profile_prop_get get,\n\t\t\t\t\tvoid *user_data)\n{\n\tstruct btd_profile_custom_property *prop;\n\n\tprop = find_custom_prop(uuid, name);\n\tif (prop != NULL)\n\t\treturn false;\n\n\tprop = g_new0(struct btd_profile_custom_property, 1);\n\n\tprop->uuid = strdup(uuid);\n\tprop->type = g_strdup(type);\n\tprop->name = g_strdup(name);\n\tprop->exists = exists;\n\tprop->get = get;\n\tprop->user_data = user_data;\n\n\tcustom_props = g_slist_append(custom_props, prop);\n\n\treturn true;\n}"
  },
  {
    "function_name": "find_custom_prop",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
    "lines": "2424-2440",
    "snippet": "static struct btd_profile_custom_property *find_custom_prop(const char *uuid,\n\t\t\t\t\t\t\tconst char *name)\n{\n\tGSList *l;\n\n\tfor (l = custom_props; l; l = l->next) {\n\t\tstruct btd_profile_custom_property *prop = l->data;\n\n\t\tif (strcasecmp(prop->uuid, uuid) != 0)\n\t\t\tcontinue;\n\n\t\tif (g_strcmp0(prop->name, name) == 0)\n\t\t\treturn prop;\n\t}\n\n\treturn NULL;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"sdp-xml.h\"",
      "#include \"sdp-client.h\"",
      "#include \"dbus-common.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"btio/btio.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static GSList *custom_props = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_strcmp0",
          "args": [
            "prop->name",
            "name"
          ],
          "line": 2435
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcasecmp",
          "args": [
            "prop->uuid",
            "uuid"
          ],
          "line": 2432
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic GSList *custom_props = NULL;\n\nstatic struct btd_profile_custom_property *find_custom_prop(const char *uuid,\n\t\t\t\t\t\t\tconst char *name)\n{\n\tGSList *l;\n\n\tfor (l = custom_props; l; l = l->next) {\n\t\tstruct btd_profile_custom_property *prop = l->data;\n\n\t\tif (strcasecmp(prop->uuid, uuid) != 0)\n\t\t\tcontinue;\n\n\t\tif (g_strcmp0(prop->name, name) == 0)\n\t\t\treturn prop;\n\t}\n\n\treturn NULL;\n}"
  },
  {
    "function_name": "unregister_profile",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
    "lines": "2390-2412",
    "snippet": "static DBusMessage *unregister_profile(DBusConnection *conn,\n\t\t\t\t\tDBusMessage *msg, void *user_data)\n{\n\tconst char *path, *sender;\n\tstruct ext_profile *ext;\n\n\tsender = dbus_message_get_sender(msg);\n\n\tDBG(\"sender %s\", sender);\n\n\tif (!dbus_message_get_args(msg, NULL, DBUS_TYPE_OBJECT_PATH, &path,\n\t\t\t\t\t\t\tDBUS_TYPE_INVALID))\n\t\treturn btd_error_invalid_args(msg);\n\n\text = find_ext_profile(sender, path);\n\tif (!ext)\n\t\treturn btd_error_does_not_exist(msg);\n\n\tg_dbus_remove_watch(conn, ext->id);\n\tremove_ext(ext);\n\n\treturn dbus_message_new_method_return(msg);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"sdp-xml.h\"",
      "#include \"sdp-client.h\"",
      "#include \"dbus-common.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"btio/btio.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_new_method_return",
          "args": [
            "msg"
          ],
          "line": 2411
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "remove_ext",
          "args": [
            "ext"
          ],
          "line": 2409
        },
        "resolved": true,
        "details": {
          "function_name": "remove_ext",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
          "lines": "2318-2341",
          "snippet": "static void remove_ext(struct ext_profile *ext)\n{\n\tadapter_foreach(adapter_remove_profile, &ext->p);\n\n\text_profiles = g_slist_remove(ext_profiles, ext);\n\n\tDBG(\"Removed \\\"%s\\\"\", ext->name);\n\n\text_remove_records(ext, NULL);\n\n\tg_slist_free_full(ext->servers, ext_io_destroy);\n\tg_slist_free_full(ext->conns, ext_io_destroy);\n\n\tg_free(ext->remote_uuid);\n\tg_free(ext->name);\n\tg_free(ext->owner);\n\tfree(ext->uuid);\n\tfree(ext->service);\n\tg_free(ext->role);\n\tg_free(ext->path);\n\tg_free(ext->record);\n\n\tg_free(ext);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdp-xml.h\"",
            "#include \"sdp-client.h\"",
            "#include \"dbus-common.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"btio/btio.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static GSList *ext_profiles = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic GSList *ext_profiles = NULL;\n\nstatic void remove_ext(struct ext_profile *ext)\n{\n\tadapter_foreach(adapter_remove_profile, &ext->p);\n\n\text_profiles = g_slist_remove(ext_profiles, ext);\n\n\tDBG(\"Removed \\\"%s\\\"\", ext->name);\n\n\text_remove_records(ext, NULL);\n\n\tg_slist_free_full(ext->servers, ext_io_destroy);\n\tg_slist_free_full(ext->conns, ext_io_destroy);\n\n\tg_free(ext->remote_uuid);\n\tg_free(ext->name);\n\tg_free(ext->owner);\n\tfree(ext->uuid);\n\tfree(ext->service);\n\tg_free(ext->role);\n\tg_free(ext->path);\n\tg_free(ext->record);\n\n\tg_free(ext);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_remove_watch",
          "args": [
            "conn",
            "ext->id"
          ],
          "line": 2408
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_error_does_not_exist",
          "args": [
            "msg"
          ],
          "line": 2406
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_does_not_exist",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "88-92",
          "snippet": "DBusMessage *btd_error_does_not_exist(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".DoesNotExist\",\n\t\t\t\t\t\"Does Not Exist\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_does_not_exist(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".DoesNotExist\",\n\t\t\t\t\t\"Does Not Exist\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "find_ext_profile",
          "args": [
            "sender",
            "path"
          ],
          "line": 2404
        },
        "resolved": true,
        "details": {
          "function_name": "find_ext_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
          "lines": "731-747",
          "snippet": "static struct ext_profile *find_ext_profile(const char *owner,\n\t\t\t\t\t\tconst char *path)\n{\n\tGSList *l;\n\n\tfor (l = ext_profiles; l != NULL; l = g_slist_next(l)) {\n\t\tstruct ext_profile *ext = l->data;\n\n\t\tif (g_strcmp0(ext->owner, owner))\n\t\t\tcontinue;\n\n\t\tif (!g_strcmp0(ext->path, path))\n\t\t\treturn ext;\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdp-xml.h\"",
            "#include \"sdp-client.h\"",
            "#include \"dbus-common.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"btio/btio.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static GSList *ext_profiles = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic GSList *ext_profiles = NULL;\n\nstatic struct ext_profile *find_ext_profile(const char *owner,\n\t\t\t\t\t\tconst char *path)\n{\n\tGSList *l;\n\n\tfor (l = ext_profiles; l != NULL; l = g_slist_next(l)) {\n\t\tstruct ext_profile *ext = l->data;\n\n\t\tif (g_strcmp0(ext->owner, owner))\n\t\t\tcontinue;\n\n\t\tif (!g_strcmp0(ext->path, path))\n\t\t\treturn ext;\n\t}\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_error_invalid_args",
          "args": [
            "msg"
          ],
          "line": 2402
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_invalid_args",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "34-38",
          "snippet": "DBusMessage *btd_error_invalid_args(DBusMessage *msg)\n{\n\treturn btd_error_invalid_args_str(msg,\n\t\t\t\t\t\"Invalid arguments in method call\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_invalid_args(DBusMessage *msg)\n{\n\treturn btd_error_invalid_args_str(msg,\n\t\t\t\t\t\"Invalid arguments in method call\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_get_args",
          "args": [
            "msg",
            "NULL",
            "DBUS_TYPE_OBJECT_PATH",
            "&path",
            "DBUS_TYPE_INVALID"
          ],
          "line": 2400
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"sender %s\"",
            "sender"
          ],
          "line": 2398
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_get_sender",
          "args": [
            "msg"
          ],
          "line": 2396
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic DBusMessage *unregister_profile(DBusConnection *conn,\n\t\t\t\t\tDBusMessage *msg, void *user_data)\n{\n\tconst char *path, *sender;\n\tstruct ext_profile *ext;\n\n\tsender = dbus_message_get_sender(msg);\n\n\tDBG(\"sender %s\", sender);\n\n\tif (!dbus_message_get_args(msg, NULL, DBUS_TYPE_OBJECT_PATH, &path,\n\t\t\t\t\t\t\tDBUS_TYPE_INVALID))\n\t\treturn btd_error_invalid_args(msg);\n\n\text = find_ext_profile(sender, path);\n\tif (!ext)\n\t\treturn btd_error_does_not_exist(msg);\n\n\tg_dbus_remove_watch(conn, ext->id);\n\tremove_ext(ext);\n\n\treturn dbus_message_new_method_return(msg);\n}"
  },
  {
    "function_name": "register_profile",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
    "lines": "2352-2388",
    "snippet": "static DBusMessage *register_profile(DBusConnection *conn,\n\t\t\t\t\tDBusMessage *msg, void *user_data)\n{\n\tconst char *path, *sender, *uuid;\n\tDBusMessageIter args, opts;\n\tstruct ext_profile *ext;\n\n\tsender = dbus_message_get_sender(msg);\n\n\tDBG(\"sender %s\", sender);\n\n\tdbus_message_iter_init(msg, &args);\n\n\tdbus_message_iter_get_basic(&args, &path);\n\tdbus_message_iter_next(&args);\n\n\text = find_ext_profile(sender, path);\n\tif (ext)\n\t\treturn btd_error_already_exists(msg);\n\n\tdbus_message_iter_get_basic(&args, &uuid);\n\tdbus_message_iter_next(&args);\n\n\tif (dbus_message_iter_get_arg_type(&args) != DBUS_TYPE_ARRAY)\n\t\treturn btd_error_invalid_args(msg);\n\n\tdbus_message_iter_recurse(&args, &opts);\n\n\text = create_ext(sender, path, uuid, &opts);\n\tif (!ext)\n\t\treturn btd_error_invalid_args(msg);\n\n\text->id = g_dbus_add_disconnect_watch(conn, sender, ext_exited, ext,\n\t\t\t\t\t\t\t\t\tNULL);\n\n\treturn dbus_message_new_method_return(msg);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"sdp-xml.h\"",
      "#include \"sdp-client.h\"",
      "#include \"dbus-common.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"btio/btio.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_new_method_return",
          "args": [
            "msg"
          ],
          "line": 2387
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_dbus_add_disconnect_watch",
          "args": [
            "conn",
            "sender",
            "ext_exited",
            "ext",
            "NULL"
          ],
          "line": 2384
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_error_invalid_args",
          "args": [
            "msg"
          ],
          "line": 2382
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_invalid_args",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "34-38",
          "snippet": "DBusMessage *btd_error_invalid_args(DBusMessage *msg)\n{\n\treturn btd_error_invalid_args_str(msg,\n\t\t\t\t\t\"Invalid arguments in method call\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_invalid_args(DBusMessage *msg)\n{\n\treturn btd_error_invalid_args_str(msg,\n\t\t\t\t\t\"Invalid arguments in method call\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "create_ext",
          "args": [
            "sender",
            "path",
            "uuid",
            "&opts"
          ],
          "line": 2380
        },
        "resolved": true,
        "details": {
          "function_name": "create_ext",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
          "lines": "2238-2316",
          "snippet": "static struct ext_profile *create_ext(const char *owner, const char *path,\n\t\t\t\t\tconst char *uuid,\n\t\t\t\t\tDBusMessageIter *opts)\n{\n\tstruct btd_profile *p;\n\tstruct ext_profile *ext;\n\n\text = g_new0(struct ext_profile, 1);\n\n\text->uuid = bt_name2string(uuid);\n\tif (ext->uuid == NULL) {\n\t\tg_free(ext);\n\t\treturn NULL;\n\t}\n\n\text->owner = g_strdup(owner);\n\text->path = g_strdup(path);\n\n\text_set_defaults(ext);\n\n\twhile (dbus_message_iter_get_arg_type(opts) == DBUS_TYPE_DICT_ENTRY) {\n\t\tDBusMessageIter value, entry;\n\t\tconst char *key;\n\n\t\tdbus_message_iter_recurse(opts, &entry);\n\t\tdbus_message_iter_get_basic(&entry, &key);\n\n\t\tdbus_message_iter_next(&entry);\n\t\tdbus_message_iter_recurse(&entry, &value);\n\n\t\tif (parse_ext_opt(ext, key, &value) < 0)\n\t\t\terror(\"Invalid value for profile option %s\", key);\n\n\t\tdbus_message_iter_next(opts);\n\t}\n\n\tif (!ext->service)\n\t\tset_service(ext);\n\n\tif (ext->enable_server && !(ext->record || ext->get_record))\n\t\text->get_record = get_generic_record;\n\n\tif (!ext->name)\n\t\text->name = g_strdup_printf(\"%s%s/%s\", owner, path, uuid);\n\n\tif (!ext->remote_uuid) {\n\t\tif (ext->service)\n\t\t\text->remote_uuid = g_strdup(ext->service);\n\t\telse\n\t\t\text->remote_uuid = g_strdup(ext->uuid);\n\t}\n\n\tp = &ext->p;\n\n\tp->name = ext->name;\n\tp->local_uuid = ext->service ? ext->service : ext->uuid;\n\tp->remote_uuid = ext->remote_uuid;\n\tp->external = true;\n\n\tif (ext->enable_server) {\n\t\tp->adapter_probe = ext_adapter_probe;\n\t\tp->adapter_remove = ext_adapter_remove;\n\t}\n\n\tif (ext->enable_client) {\n\t\tp->device_probe = ext_device_probe;\n\t\tp->device_remove = ext_device_remove;\n\t\tp->connect = ext_connect_dev;\n\t\tp->disconnect = ext_disconnect_dev;\n\t}\n\n\tDBG(\"Created \\\"%s\\\"\", ext->name);\n\n\text_profiles = g_slist_append(ext_profiles, ext);\n\n\tadapter_foreach(adapter_add_profile, &ext->p);\n\n\treturn ext;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdp-xml.h\"",
            "#include \"sdp-client.h\"",
            "#include \"dbus-common.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"btio/btio.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static GSList *ext_profiles = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic GSList *ext_profiles = NULL;\n\nstatic struct ext_profile *create_ext(const char *owner, const char *path,\n\t\t\t\t\tconst char *uuid,\n\t\t\t\t\tDBusMessageIter *opts)\n{\n\tstruct btd_profile *p;\n\tstruct ext_profile *ext;\n\n\text = g_new0(struct ext_profile, 1);\n\n\text->uuid = bt_name2string(uuid);\n\tif (ext->uuid == NULL) {\n\t\tg_free(ext);\n\t\treturn NULL;\n\t}\n\n\text->owner = g_strdup(owner);\n\text->path = g_strdup(path);\n\n\text_set_defaults(ext);\n\n\twhile (dbus_message_iter_get_arg_type(opts) == DBUS_TYPE_DICT_ENTRY) {\n\t\tDBusMessageIter value, entry;\n\t\tconst char *key;\n\n\t\tdbus_message_iter_recurse(opts, &entry);\n\t\tdbus_message_iter_get_basic(&entry, &key);\n\n\t\tdbus_message_iter_next(&entry);\n\t\tdbus_message_iter_recurse(&entry, &value);\n\n\t\tif (parse_ext_opt(ext, key, &value) < 0)\n\t\t\terror(\"Invalid value for profile option %s\", key);\n\n\t\tdbus_message_iter_next(opts);\n\t}\n\n\tif (!ext->service)\n\t\tset_service(ext);\n\n\tif (ext->enable_server && !(ext->record || ext->get_record))\n\t\text->get_record = get_generic_record;\n\n\tif (!ext->name)\n\t\text->name = g_strdup_printf(\"%s%s/%s\", owner, path, uuid);\n\n\tif (!ext->remote_uuid) {\n\t\tif (ext->service)\n\t\t\text->remote_uuid = g_strdup(ext->service);\n\t\telse\n\t\t\text->remote_uuid = g_strdup(ext->uuid);\n\t}\n\n\tp = &ext->p;\n\n\tp->name = ext->name;\n\tp->local_uuid = ext->service ? ext->service : ext->uuid;\n\tp->remote_uuid = ext->remote_uuid;\n\tp->external = true;\n\n\tif (ext->enable_server) {\n\t\tp->adapter_probe = ext_adapter_probe;\n\t\tp->adapter_remove = ext_adapter_remove;\n\t}\n\n\tif (ext->enable_client) {\n\t\tp->device_probe = ext_device_probe;\n\t\tp->device_remove = ext_device_remove;\n\t\tp->connect = ext_connect_dev;\n\t\tp->disconnect = ext_disconnect_dev;\n\t}\n\n\tDBG(\"Created \\\"%s\\\"\", ext->name);\n\n\text_profiles = g_slist_append(ext_profiles, ext);\n\n\tadapter_foreach(adapter_add_profile, &ext->p);\n\n\treturn ext;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_recurse",
          "args": [
            "&args",
            "&opts"
          ],
          "line": 2378
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_arg_type",
          "args": [
            "&args"
          ],
          "line": 2375
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_next",
          "args": [
            "&args"
          ],
          "line": 2373
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_basic",
          "args": [
            "&args",
            "&uuid"
          ],
          "line": 2372
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_error_already_exists",
          "args": [
            "msg"
          ],
          "line": 2370
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_already_exists",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "52-56",
          "snippet": "DBusMessage *btd_error_already_exists(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".AlreadyExists\",\n\t\t\t\t\t\"Already Exists\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_already_exists(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".AlreadyExists\",\n\t\t\t\t\t\"Already Exists\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "find_ext_profile",
          "args": [
            "sender",
            "path"
          ],
          "line": 2368
        },
        "resolved": true,
        "details": {
          "function_name": "find_ext_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
          "lines": "731-747",
          "snippet": "static struct ext_profile *find_ext_profile(const char *owner,\n\t\t\t\t\t\tconst char *path)\n{\n\tGSList *l;\n\n\tfor (l = ext_profiles; l != NULL; l = g_slist_next(l)) {\n\t\tstruct ext_profile *ext = l->data;\n\n\t\tif (g_strcmp0(ext->owner, owner))\n\t\t\tcontinue;\n\n\t\tif (!g_strcmp0(ext->path, path))\n\t\t\treturn ext;\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdp-xml.h\"",
            "#include \"sdp-client.h\"",
            "#include \"dbus-common.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"btio/btio.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static GSList *ext_profiles = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic GSList *ext_profiles = NULL;\n\nstatic struct ext_profile *find_ext_profile(const char *owner,\n\t\t\t\t\t\tconst char *path)\n{\n\tGSList *l;\n\n\tfor (l = ext_profiles; l != NULL; l = g_slist_next(l)) {\n\t\tstruct ext_profile *ext = l->data;\n\n\t\tif (g_strcmp0(ext->owner, owner))\n\t\t\tcontinue;\n\n\t\tif (!g_strcmp0(ext->path, path))\n\t\t\treturn ext;\n\t}\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_next",
          "args": [
            "&args"
          ],
          "line": 2366
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_basic",
          "args": [
            "&args",
            "&path"
          ],
          "line": 2365
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_init",
          "args": [
            "msg",
            "&args"
          ],
          "line": 2363
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"sender %s\"",
            "sender"
          ],
          "line": 2361
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_get_sender",
          "args": [
            "msg"
          ],
          "line": 2359
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic DBusMessage *register_profile(DBusConnection *conn,\n\t\t\t\t\tDBusMessage *msg, void *user_data)\n{\n\tconst char *path, *sender, *uuid;\n\tDBusMessageIter args, opts;\n\tstruct ext_profile *ext;\n\n\tsender = dbus_message_get_sender(msg);\n\n\tDBG(\"sender %s\", sender);\n\n\tdbus_message_iter_init(msg, &args);\n\n\tdbus_message_iter_get_basic(&args, &path);\n\tdbus_message_iter_next(&args);\n\n\text = find_ext_profile(sender, path);\n\tif (ext)\n\t\treturn btd_error_already_exists(msg);\n\n\tdbus_message_iter_get_basic(&args, &uuid);\n\tdbus_message_iter_next(&args);\n\n\tif (dbus_message_iter_get_arg_type(&args) != DBUS_TYPE_ARRAY)\n\t\treturn btd_error_invalid_args(msg);\n\n\tdbus_message_iter_recurse(&args, &opts);\n\n\text = create_ext(sender, path, uuid, &opts);\n\tif (!ext)\n\t\treturn btd_error_invalid_args(msg);\n\n\text->id = g_dbus_add_disconnect_watch(conn, sender, ext_exited, ext,\n\t\t\t\t\t\t\t\t\tNULL);\n\n\treturn dbus_message_new_method_return(msg);\n}"
  },
  {
    "function_name": "ext_exited",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
    "lines": "2343-2350",
    "snippet": "static void ext_exited(DBusConnection *conn, void *user_data)\n{\n\tstruct ext_profile *ext = user_data;\n\n\tDBG(\"\\\"%s\\\" exited\", ext->name);\n\n\tremove_ext(ext);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"sdp-xml.h\"",
      "#include \"sdp-client.h\"",
      "#include \"dbus-common.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"btio/btio.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "remove_ext",
          "args": [
            "ext"
          ],
          "line": 2349
        },
        "resolved": true,
        "details": {
          "function_name": "remove_ext",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
          "lines": "2318-2341",
          "snippet": "static void remove_ext(struct ext_profile *ext)\n{\n\tadapter_foreach(adapter_remove_profile, &ext->p);\n\n\text_profiles = g_slist_remove(ext_profiles, ext);\n\n\tDBG(\"Removed \\\"%s\\\"\", ext->name);\n\n\text_remove_records(ext, NULL);\n\n\tg_slist_free_full(ext->servers, ext_io_destroy);\n\tg_slist_free_full(ext->conns, ext_io_destroy);\n\n\tg_free(ext->remote_uuid);\n\tg_free(ext->name);\n\tg_free(ext->owner);\n\tfree(ext->uuid);\n\tfree(ext->service);\n\tg_free(ext->role);\n\tg_free(ext->path);\n\tg_free(ext->record);\n\n\tg_free(ext);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdp-xml.h\"",
            "#include \"sdp-client.h\"",
            "#include \"dbus-common.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"btio/btio.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static GSList *ext_profiles = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic GSList *ext_profiles = NULL;\n\nstatic void remove_ext(struct ext_profile *ext)\n{\n\tadapter_foreach(adapter_remove_profile, &ext->p);\n\n\text_profiles = g_slist_remove(ext_profiles, ext);\n\n\tDBG(\"Removed \\\"%s\\\"\", ext->name);\n\n\text_remove_records(ext, NULL);\n\n\tg_slist_free_full(ext->servers, ext_io_destroy);\n\tg_slist_free_full(ext->conns, ext_io_destroy);\n\n\tg_free(ext->remote_uuid);\n\tg_free(ext->name);\n\tg_free(ext->owner);\n\tfree(ext->uuid);\n\tfree(ext->service);\n\tg_free(ext->role);\n\tg_free(ext->path);\n\tg_free(ext->record);\n\n\tg_free(ext);\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"\\\"%s\\\" exited\"",
            "ext->name"
          ],
          "line": 2347
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void ext_exited(DBusConnection *conn, void *user_data)\n{\n\tstruct ext_profile *ext = user_data;\n\n\tDBG(\"\\\"%s\\\" exited\", ext->name);\n\n\tremove_ext(ext);\n}"
  },
  {
    "function_name": "remove_ext",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
    "lines": "2318-2341",
    "snippet": "static void remove_ext(struct ext_profile *ext)\n{\n\tadapter_foreach(adapter_remove_profile, &ext->p);\n\n\text_profiles = g_slist_remove(ext_profiles, ext);\n\n\tDBG(\"Removed \\\"%s\\\"\", ext->name);\n\n\text_remove_records(ext, NULL);\n\n\tg_slist_free_full(ext->servers, ext_io_destroy);\n\tg_slist_free_full(ext->conns, ext_io_destroy);\n\n\tg_free(ext->remote_uuid);\n\tg_free(ext->name);\n\tg_free(ext->owner);\n\tfree(ext->uuid);\n\tfree(ext->service);\n\tg_free(ext->role);\n\tg_free(ext->path);\n\tg_free(ext->record);\n\n\tg_free(ext);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"sdp-xml.h\"",
      "#include \"sdp-client.h\"",
      "#include \"dbus-common.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"btio/btio.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static GSList *ext_profiles = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "ext"
          ],
          "line": 2340
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "ext->record"
          ],
          "line": 2338
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "ext->path"
          ],
          "line": 2337
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "ext->role"
          ],
          "line": 2336
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "ext->service"
          ],
          "line": 2335
        },
        "resolved": true,
        "details": {
          "function_name": "free_property",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
          "lines": "2468-2477",
          "snippet": "static void free_property(gpointer data)\n{\n\tstruct btd_profile_custom_property *p = data;\n\n\tg_free(p->uuid);\n\tg_free(p->type);\n\tg_free(p->name);\n\n\tg_free(p);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdp-xml.h\"",
            "#include \"sdp-client.h\"",
            "#include \"dbus-common.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"btio/btio.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void free_property(gpointer data)\n{\n\tstruct btd_profile_custom_property *p = data;\n\n\tg_free(p->uuid);\n\tg_free(p->type);\n\tg_free(p->name);\n\n\tg_free(p);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "ext->owner"
          ],
          "line": 2333
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "ext->name"
          ],
          "line": 2332
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "ext->remote_uuid"
          ],
          "line": 2331
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_free_full",
          "args": [
            "ext->conns",
            "ext_io_destroy"
          ],
          "line": 2329
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_free_full",
          "args": [
            "ext->servers",
            "ext_io_destroy"
          ],
          "line": 2328
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ext_remove_records",
          "args": [
            "ext",
            "NULL"
          ],
          "line": 2326
        },
        "resolved": true,
        "details": {
          "function_name": "ext_remove_records",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
          "lines": "1397-1416",
          "snippet": "static void ext_remove_records(struct ext_profile *ext,\n\t\t\t\t\t\tstruct btd_adapter *adapter)\n{\n\tGSList *l, *next;\n\n\tfor (l = ext->records; l != NULL; l = next) {\n\t\tstruct ext_record *r = l->data;\n\n\t\tnext = g_slist_next(l);\n\n\t\tif (adapter && r->adapter != adapter)\n\t\t\tcontinue;\n\n\t\text->records = g_slist_remove(ext->records, r);\n\n\t\tadapter_service_remove(adapter, r->handle);\n\t\tbtd_adapter_unref(r->adapter);\n\t\tg_free(r);\n\t}\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdp-xml.h\"",
            "#include \"sdp-client.h\"",
            "#include \"dbus-common.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"btio/btio.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void ext_remove_records(struct ext_profile *ext,\n\t\t\t\t\t\tstruct btd_adapter *adapter)\n{\n\tGSList *l, *next;\n\n\tfor (l = ext->records; l != NULL; l = next) {\n\t\tstruct ext_record *r = l->data;\n\n\t\tnext = g_slist_next(l);\n\n\t\tif (adapter && r->adapter != adapter)\n\t\t\tcontinue;\n\n\t\text->records = g_slist_remove(ext->records, r);\n\n\t\tadapter_service_remove(adapter, r->handle);\n\t\tbtd_adapter_unref(r->adapter);\n\t\tg_free(r);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Removed \\\"%s\\\"\"",
            "ext->name"
          ],
          "line": 2324
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_remove",
          "args": [
            "ext_profiles",
            "ext"
          ],
          "line": 2322
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "adapter_foreach",
          "args": [
            "adapter_remove_profile",
            "&ext->p"
          ],
          "line": 2320
        },
        "resolved": true,
        "details": {
          "function_name": "adapter_foreach",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "8025-8028",
          "snippet": "void adapter_foreach(adapter_cb func, gpointer user_data)\n{\n\tg_slist_foreach(adapters, (GFunc) func, user_data);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static GSList *adapters = NULL;",
            "static gboolean process_auth_queue(gpointer user_data);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic GSList *adapters = NULL;\nstatic gboolean process_auth_queue(gpointer user_data);\n\nvoid adapter_foreach(adapter_cb func, gpointer user_data)\n{\n\tg_slist_foreach(adapters, (GFunc) func, user_data);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic GSList *ext_profiles = NULL;\n\nstatic void remove_ext(struct ext_profile *ext)\n{\n\tadapter_foreach(adapter_remove_profile, &ext->p);\n\n\text_profiles = g_slist_remove(ext_profiles, ext);\n\n\tDBG(\"Removed \\\"%s\\\"\", ext->name);\n\n\text_remove_records(ext, NULL);\n\n\tg_slist_free_full(ext->servers, ext_io_destroy);\n\tg_slist_free_full(ext->conns, ext_io_destroy);\n\n\tg_free(ext->remote_uuid);\n\tg_free(ext->name);\n\tg_free(ext->owner);\n\tfree(ext->uuid);\n\tfree(ext->service);\n\tg_free(ext->role);\n\tg_free(ext->path);\n\tg_free(ext->record);\n\n\tg_free(ext);\n}"
  },
  {
    "function_name": "create_ext",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
    "lines": "2238-2316",
    "snippet": "static struct ext_profile *create_ext(const char *owner, const char *path,\n\t\t\t\t\tconst char *uuid,\n\t\t\t\t\tDBusMessageIter *opts)\n{\n\tstruct btd_profile *p;\n\tstruct ext_profile *ext;\n\n\text = g_new0(struct ext_profile, 1);\n\n\text->uuid = bt_name2string(uuid);\n\tif (ext->uuid == NULL) {\n\t\tg_free(ext);\n\t\treturn NULL;\n\t}\n\n\text->owner = g_strdup(owner);\n\text->path = g_strdup(path);\n\n\text_set_defaults(ext);\n\n\twhile (dbus_message_iter_get_arg_type(opts) == DBUS_TYPE_DICT_ENTRY) {\n\t\tDBusMessageIter value, entry;\n\t\tconst char *key;\n\n\t\tdbus_message_iter_recurse(opts, &entry);\n\t\tdbus_message_iter_get_basic(&entry, &key);\n\n\t\tdbus_message_iter_next(&entry);\n\t\tdbus_message_iter_recurse(&entry, &value);\n\n\t\tif (parse_ext_opt(ext, key, &value) < 0)\n\t\t\terror(\"Invalid value for profile option %s\", key);\n\n\t\tdbus_message_iter_next(opts);\n\t}\n\n\tif (!ext->service)\n\t\tset_service(ext);\n\n\tif (ext->enable_server && !(ext->record || ext->get_record))\n\t\text->get_record = get_generic_record;\n\n\tif (!ext->name)\n\t\text->name = g_strdup_printf(\"%s%s/%s\", owner, path, uuid);\n\n\tif (!ext->remote_uuid) {\n\t\tif (ext->service)\n\t\t\text->remote_uuid = g_strdup(ext->service);\n\t\telse\n\t\t\text->remote_uuid = g_strdup(ext->uuid);\n\t}\n\n\tp = &ext->p;\n\n\tp->name = ext->name;\n\tp->local_uuid = ext->service ? ext->service : ext->uuid;\n\tp->remote_uuid = ext->remote_uuid;\n\tp->external = true;\n\n\tif (ext->enable_server) {\n\t\tp->adapter_probe = ext_adapter_probe;\n\t\tp->adapter_remove = ext_adapter_remove;\n\t}\n\n\tif (ext->enable_client) {\n\t\tp->device_probe = ext_device_probe;\n\t\tp->device_remove = ext_device_remove;\n\t\tp->connect = ext_connect_dev;\n\t\tp->disconnect = ext_disconnect_dev;\n\t}\n\n\tDBG(\"Created \\\"%s\\\"\", ext->name);\n\n\text_profiles = g_slist_append(ext_profiles, ext);\n\n\tadapter_foreach(adapter_add_profile, &ext->p);\n\n\treturn ext;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"sdp-xml.h\"",
      "#include \"sdp-client.h\"",
      "#include \"dbus-common.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"btio/btio.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static GSList *ext_profiles = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "adapter_foreach",
          "args": [
            "adapter_add_profile",
            "&ext->p"
          ],
          "line": 2313
        },
        "resolved": true,
        "details": {
          "function_name": "adapter_foreach",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "8025-8028",
          "snippet": "void adapter_foreach(adapter_cb func, gpointer user_data)\n{\n\tg_slist_foreach(adapters, (GFunc) func, user_data);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static GSList *adapters = NULL;",
            "static gboolean process_auth_queue(gpointer user_data);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic GSList *adapters = NULL;\nstatic gboolean process_auth_queue(gpointer user_data);\n\nvoid adapter_foreach(adapter_cb func, gpointer user_data)\n{\n\tg_slist_foreach(adapters, (GFunc) func, user_data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_slist_append",
          "args": [
            "ext_profiles",
            "ext"
          ],
          "line": 2311
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"Created \\\"%s\\\"\"",
            "ext->name"
          ],
          "line": 2309
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "ext->uuid"
          ],
          "line": 2287
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "ext->service"
          ],
          "line": 2285
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"%s%s/%s\"",
            "owner",
            "path",
            "uuid"
          ],
          "line": 2281
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "set_service",
          "args": [
            "ext"
          ],
          "line": 2275
        },
        "resolved": true,
        "details": {
          "function_name": "set_service",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
          "lines": "2211-2236",
          "snippet": "static void set_service(struct ext_profile *ext)\n{\n\tif (strcasecmp(ext->uuid, HSP_HS_UUID) == 0) {\n\t\text->service = strdup(ext->uuid);\n\t} else if (strcasecmp(ext->uuid, HSP_AG_UUID) == 0) {\n\t\text->service = ext->uuid;\n\t\text->uuid = strdup(HSP_HS_UUID);\n\t} else if (strcasecmp(ext->uuid, HFP_HS_UUID) == 0) {\n\t\text->service = strdup(ext->uuid);\n\t} else if (strcasecmp(ext->uuid, HFP_AG_UUID) == 0) {\n\t\text->service = ext->uuid;\n\t\text->uuid = strdup(HFP_HS_UUID);\n\t} else if (strcasecmp(ext->uuid, OBEX_SYNC_UUID) == 0 ||\n\t\t\tstrcasecmp(ext->uuid, OBEX_OPP_UUID) == 0 ||\n\t\t\tstrcasecmp(ext->uuid, OBEX_FTP_UUID) == 0) {\n\t\text->service = strdup(ext->uuid);\n\t} else if (strcasecmp(ext->uuid, OBEX_PSE_UUID) == 0 ||\n\t\t\tstrcasecmp(ext->uuid, OBEX_PCE_UUID) ==  0) {\n\t\text->service = ext->uuid;\n\t\text->uuid = strdup(OBEX_PBAP_UUID);\n\t} else if (strcasecmp(ext->uuid, OBEX_MAS_UUID) == 0 ||\n\t\t\tstrcasecmp(ext->uuid, OBEX_MNS_UUID) == 0) {\n\t\text->service = ext->uuid;\n\t\text->uuid = strdup(OBEX_MAP_UUID);\n\t}\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdp-xml.h\"",
            "#include \"sdp-client.h\"",
            "#include \"dbus-common.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"btio/btio.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void set_service(struct ext_profile *ext)\n{\n\tif (strcasecmp(ext->uuid, HSP_HS_UUID) == 0) {\n\t\text->service = strdup(ext->uuid);\n\t} else if (strcasecmp(ext->uuid, HSP_AG_UUID) == 0) {\n\t\text->service = ext->uuid;\n\t\text->uuid = strdup(HSP_HS_UUID);\n\t} else if (strcasecmp(ext->uuid, HFP_HS_UUID) == 0) {\n\t\text->service = strdup(ext->uuid);\n\t} else if (strcasecmp(ext->uuid, HFP_AG_UUID) == 0) {\n\t\text->service = ext->uuid;\n\t\text->uuid = strdup(HFP_HS_UUID);\n\t} else if (strcasecmp(ext->uuid, OBEX_SYNC_UUID) == 0 ||\n\t\t\tstrcasecmp(ext->uuid, OBEX_OPP_UUID) == 0 ||\n\t\t\tstrcasecmp(ext->uuid, OBEX_FTP_UUID) == 0) {\n\t\text->service = strdup(ext->uuid);\n\t} else if (strcasecmp(ext->uuid, OBEX_PSE_UUID) == 0 ||\n\t\t\tstrcasecmp(ext->uuid, OBEX_PCE_UUID) ==  0) {\n\t\text->service = ext->uuid;\n\t\text->uuid = strdup(OBEX_PBAP_UUID);\n\t} else if (strcasecmp(ext->uuid, OBEX_MAS_UUID) == 0 ||\n\t\t\tstrcasecmp(ext->uuid, OBEX_MNS_UUID) == 0) {\n\t\text->service = ext->uuid;\n\t\text->uuid = strdup(OBEX_MAP_UUID);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_next",
          "args": [
            "opts"
          ],
          "line": 2271
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Invalid value for profile option %s\"",
            "key"
          ],
          "line": 2269
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "124-128",
          "snippet": "DBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "parse_ext_opt",
          "args": [
            "ext",
            "key",
            "&value"
          ],
          "line": 2268
        },
        "resolved": true,
        "details": {
          "function_name": "parse_ext_opt",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
          "lines": "2117-2209",
          "snippet": "static int parse_ext_opt(struct ext_profile *ext, const char *key,\n\t\t\t\t\t\t\tDBusMessageIter *value)\n{\n\tint type = dbus_message_iter_get_arg_type(value);\n\tconst char *str;\n\tuint16_t u16;\n\tdbus_bool_t b;\n\n\tif (strcasecmp(key, \"Name\") == 0) {\n\t\tif (type != DBUS_TYPE_STRING)\n\t\t\treturn -EINVAL;\n\t\tdbus_message_iter_get_basic(value, &str);\n\t\tg_free(ext->name);\n\t\text->name = g_strdup(str);\n\t} else if (strcasecmp(key, \"AutoConnect\") == 0) {\n\t\tif (type != DBUS_TYPE_BOOLEAN)\n\t\t\treturn -EINVAL;\n\t\tdbus_message_iter_get_basic(value, &b);\n\t\text->p.auto_connect = b;\n\t} else if (strcasecmp(key, \"PSM\") == 0) {\n\t\tif (type != DBUS_TYPE_UINT16)\n\t\t\treturn -EINVAL;\n\t\tdbus_message_iter_get_basic(value, &u16);\n\t\text->local_psm = u16 ? u16 : BTD_PROFILE_PSM_AUTO;\n\t} else if (strcasecmp(key, \"Channel\") == 0) {\n\t\tif (type != DBUS_TYPE_UINT16)\n\t\t\treturn -EINVAL;\n\n\t\tdbus_message_iter_get_basic(value, &u16);\n\t\tif (u16 > 31)\n\t\t\treturn -EINVAL;\n\t\text->local_chan = u16 ? u16 : BTD_PROFILE_CHAN_AUTO;\n\t} else if (strcasecmp(key, \"RequireAuthentication\") == 0) {\n\t\tif (type != DBUS_TYPE_BOOLEAN)\n\t\t\treturn -EINVAL;\n\n\t\tdbus_message_iter_get_basic(value, &b);\n\t\tif (b)\n\t\t\text->sec_level = BT_IO_SEC_MEDIUM;\n\t\telse\n\t\t\text->sec_level = BT_IO_SEC_LOW;\n\t} else if (strcasecmp(key, \"RequireAuthorization\") == 0) {\n\t\tif (type != DBUS_TYPE_BOOLEAN)\n\t\t\treturn -EINVAL;\n\t\tdbus_message_iter_get_basic(value, &b);\n\t\text->authorize = b;\n\t} else if (strcasecmp(key, \"Role\") == 0) {\n\t\tif (type != DBUS_TYPE_STRING)\n\t\t\treturn -EINVAL;\n\t\tdbus_message_iter_get_basic(value, &str);\n\t\tg_free(ext->role);\n\t\text->role = g_strdup(str);\n\n\t\tif (g_str_equal(ext->role, \"client\")) {\n\t\t\text->enable_server = false;\n\t\t\text->enable_client = true;\n\t\t} else if (g_str_equal(ext->role, \"server\")) {\n\t\t\text->enable_server = true;\n\t\t\text->enable_client = false;\n\t\t}\n\t} else if (strcasecmp(key, \"ServiceRecord\") == 0) {\n\t\tif (type != DBUS_TYPE_STRING)\n\t\t\treturn -EINVAL;\n\t\tdbus_message_iter_get_basic(value, &str);\n\t\tg_free(ext->record);\n\t\text->record = g_strdup(str);\n\t\text->enable_server = true;\n\t} else if (strcasecmp(key, \"Version\") == 0) {\n\t\tuint16_t ver;\n\n\t\tif (type != DBUS_TYPE_UINT16)\n\t\t\treturn -EINVAL;\n\n\t\tdbus_message_iter_get_basic(value, &ver);\n\t\text->version = ver;\n\t} else if (strcasecmp(key, \"Features\") == 0) {\n\t\tuint16_t feat;\n\n\t\tif (type != DBUS_TYPE_UINT16)\n\t\t\treturn -EINVAL;\n\n\t\tdbus_message_iter_get_basic(value, &feat);\n\t\text->features = feat;\n\t} else if (strcasecmp(key, \"Service\") == 0) {\n\t\tif (type != DBUS_TYPE_STRING)\n\t\t\treturn -EINVAL;\n\t\tdbus_message_iter_get_basic(value, &str);\n\t\tfree(ext->service);\n\t\text->service = bt_name2string(str);\n\t}\n\n\treturn 0;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdp-xml.h\"",
            "#include \"sdp-client.h\"",
            "#include \"dbus-common.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"btio/btio.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define BTD_PROFILE_CHAN_AUTO\t-1",
            "#define BTD_PROFILE_PSM_AUTO\t-1"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\n#define BTD_PROFILE_CHAN_AUTO\t-1\n#define BTD_PROFILE_PSM_AUTO\t-1\n\nstatic int parse_ext_opt(struct ext_profile *ext, const char *key,\n\t\t\t\t\t\t\tDBusMessageIter *value)\n{\n\tint type = dbus_message_iter_get_arg_type(value);\n\tconst char *str;\n\tuint16_t u16;\n\tdbus_bool_t b;\n\n\tif (strcasecmp(key, \"Name\") == 0) {\n\t\tif (type != DBUS_TYPE_STRING)\n\t\t\treturn -EINVAL;\n\t\tdbus_message_iter_get_basic(value, &str);\n\t\tg_free(ext->name);\n\t\text->name = g_strdup(str);\n\t} else if (strcasecmp(key, \"AutoConnect\") == 0) {\n\t\tif (type != DBUS_TYPE_BOOLEAN)\n\t\t\treturn -EINVAL;\n\t\tdbus_message_iter_get_basic(value, &b);\n\t\text->p.auto_connect = b;\n\t} else if (strcasecmp(key, \"PSM\") == 0) {\n\t\tif (type != DBUS_TYPE_UINT16)\n\t\t\treturn -EINVAL;\n\t\tdbus_message_iter_get_basic(value, &u16);\n\t\text->local_psm = u16 ? u16 : BTD_PROFILE_PSM_AUTO;\n\t} else if (strcasecmp(key, \"Channel\") == 0) {\n\t\tif (type != DBUS_TYPE_UINT16)\n\t\t\treturn -EINVAL;\n\n\t\tdbus_message_iter_get_basic(value, &u16);\n\t\tif (u16 > 31)\n\t\t\treturn -EINVAL;\n\t\text->local_chan = u16 ? u16 : BTD_PROFILE_CHAN_AUTO;\n\t} else if (strcasecmp(key, \"RequireAuthentication\") == 0) {\n\t\tif (type != DBUS_TYPE_BOOLEAN)\n\t\t\treturn -EINVAL;\n\n\t\tdbus_message_iter_get_basic(value, &b);\n\t\tif (b)\n\t\t\text->sec_level = BT_IO_SEC_MEDIUM;\n\t\telse\n\t\t\text->sec_level = BT_IO_SEC_LOW;\n\t} else if (strcasecmp(key, \"RequireAuthorization\") == 0) {\n\t\tif (type != DBUS_TYPE_BOOLEAN)\n\t\t\treturn -EINVAL;\n\t\tdbus_message_iter_get_basic(value, &b);\n\t\text->authorize = b;\n\t} else if (strcasecmp(key, \"Role\") == 0) {\n\t\tif (type != DBUS_TYPE_STRING)\n\t\t\treturn -EINVAL;\n\t\tdbus_message_iter_get_basic(value, &str);\n\t\tg_free(ext->role);\n\t\text->role = g_strdup(str);\n\n\t\tif (g_str_equal(ext->role, \"client\")) {\n\t\t\text->enable_server = false;\n\t\t\text->enable_client = true;\n\t\t} else if (g_str_equal(ext->role, \"server\")) {\n\t\t\text->enable_server = true;\n\t\t\text->enable_client = false;\n\t\t}\n\t} else if (strcasecmp(key, \"ServiceRecord\") == 0) {\n\t\tif (type != DBUS_TYPE_STRING)\n\t\t\treturn -EINVAL;\n\t\tdbus_message_iter_get_basic(value, &str);\n\t\tg_free(ext->record);\n\t\text->record = g_strdup(str);\n\t\text->enable_server = true;\n\t} else if (strcasecmp(key, \"Version\") == 0) {\n\t\tuint16_t ver;\n\n\t\tif (type != DBUS_TYPE_UINT16)\n\t\t\treturn -EINVAL;\n\n\t\tdbus_message_iter_get_basic(value, &ver);\n\t\text->version = ver;\n\t} else if (strcasecmp(key, \"Features\") == 0) {\n\t\tuint16_t feat;\n\n\t\tif (type != DBUS_TYPE_UINT16)\n\t\t\treturn -EINVAL;\n\n\t\tdbus_message_iter_get_basic(value, &feat);\n\t\text->features = feat;\n\t} else if (strcasecmp(key, \"Service\") == 0) {\n\t\tif (type != DBUS_TYPE_STRING)\n\t\t\treturn -EINVAL;\n\t\tdbus_message_iter_get_basic(value, &str);\n\t\tfree(ext->service);\n\t\text->service = bt_name2string(str);\n\t}\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_recurse",
          "args": [
            "&entry",
            "&value"
          ],
          "line": 2266
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_next",
          "args": [
            "&entry"
          ],
          "line": 2265
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_basic",
          "args": [
            "&entry",
            "&key"
          ],
          "line": 2263
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_recurse",
          "args": [
            "opts",
            "&entry"
          ],
          "line": 2262
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_arg_type",
          "args": [
            "opts"
          ],
          "line": 2258
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ext_set_defaults",
          "args": [
            "ext"
          ],
          "line": 2256
        },
        "resolved": true,
        "details": {
          "function_name": "ext_set_defaults",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
          "lines": "2058-2115",
          "snippet": "static void ext_set_defaults(struct ext_profile *ext)\n{\n\tunsigned int i;\n\n\text->mode = BT_IO_MODE_BASIC;\n\text->sec_level = BT_IO_SEC_MEDIUM;\n\text->authorize = true;\n\text->enable_client = true;\n\text->enable_server = true;\n\text->remote_uuid = NULL;\n\n\tfor (i = 0; i < G_N_ELEMENTS(defaults); i++) {\n\t\tstruct default_settings *settings = &defaults[i];\n\t\tconst char *remote_uuid;\n\n\t\tif (strcasecmp(ext->uuid, settings->uuid) != 0)\n\t\t\tcontinue;\n\n\t\tif (settings->remote_uuid)\n\t\t\tremote_uuid = settings->remote_uuid;\n\t\telse\n\t\t\tremote_uuid = ext->uuid;\n\n\t\text->remote_uuid = g_strdup(remote_uuid);\n\n\t\tif (settings->channel)\n\t\t\text->local_chan = settings->channel;\n\n\t\tif (settings->psm)\n\t\t\text->local_psm = settings->psm;\n\n\t\tif (settings->sec_level)\n\t\t\text->sec_level = settings->sec_level;\n\n\t\tif (settings->mode)\n\t\t\text->mode = settings->mode;\n\n\t\text->authorize = settings->authorize;\n\n\t\tif (settings->auto_connect)\n\t\t\text->p.auto_connect = true;\n\n\t\tif (settings->priority)\n\t\t\text->p.priority = settings->priority;\n\n\t\tif (settings->get_record)\n\t\t\text->get_record = settings->get_record;\n\n\t\tif (settings->version)\n\t\t\text->version = settings->version;\n\n\t\tif (settings->features)\n\t\t\text->features = settings->features;\n\n\t\tif (settings->name)\n\t\t\text->name = g_strdup(settings->name);\n\t}\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdp-xml.h\"",
            "#include \"sdp-client.h\"",
            "#include \"dbus-common.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"btio/btio.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static struct default_settings {\n\tconst char\t*uuid;\n\tconst char\t*name;\n\tint\t\tpriority;\n\tconst char\t*remote_uuid;\n\tint\t\tchannel;\n\tint\t\tpsm;\n\tBtIOMode\tmode;\n\tBtIOSecLevel\tsec_level;\n\tbool\t\tauthorize;\n\tbool\t\tauto_connect;\n\tchar *\t\t(*get_record)(struct ext_profile *ext,\n\t\t\t\t\tstruct ext_io *l2cap,\n\t\t\t\t\tstruct ext_io *rfcomm);\n\tuint16_t\tversion;\n\tuint16_t\tfeatures;\n} defaults[] = {\n\t{\n\t\t.uuid\t\t= SPP_UUID,\n\t\t.name\t\t= \"Serial Port\",\n\t\t.channel\t= SPP_DEFAULT_CHANNEL,\n\t\t.authorize\t= true,\n\t\t.get_record\t= get_spp_record,\n\t\t.version\t= 0x0102,\n\t}, {\n\t\t.uuid\t\t= DUN_GW_UUID,\n\t\t.name\t\t= \"Dial-Up Networking\",\n\t\t.channel\t= DUN_DEFAULT_CHANNEL,\n\t\t.authorize\t= true,\n\t\t.get_record\t= get_dun_record,\n\t\t.version\t= 0x0102,\n\t}, {\n\t\t.uuid\t\t= HFP_HS_UUID,\n\t\t.name\t\t= \"Hands-Free unit\",\n\t\t.priority\t= BTD_PROFILE_PRIORITY_HIGH,\n\t\t.remote_uuid\t= HFP_AG_UUID,\n\t\t.channel\t= HFP_HF_DEFAULT_CHANNEL,\n\t\t.authorize\t= true,\n\t\t.auto_connect\t= true,\n\t\t.get_record\t= get_hfp_hf_record,\n\t\t.version\t= 0x0107,\n\t}, {\n\t\t.uuid\t\t= HFP_AG_UUID,\n\t\t.name\t\t= \"Hands-Free Voice gateway\",\n\t\t.priority\t= BTD_PROFILE_PRIORITY_HIGH,\n\t\t.remote_uuid\t= HFP_HS_UUID,\n\t\t.channel\t= HFP_AG_DEFAULT_CHANNEL,\n\t\t.authorize\t= true,\n\t\t.auto_connect\t= true,\n\t\t.get_record\t= get_hfp_ag_record,\n\t\t.version\t= 0x0107,\n\t}, {\n\t\t.uuid\t\t= HSP_AG_UUID,\n\t\t.name\t\t= \"Headset Voice gateway\",\n\t\t.priority\t= BTD_PROFILE_PRIORITY_HIGH,\n\t\t.remote_uuid\t= HSP_HS_UUID,\n\t\t.channel\t= HSP_AG_DEFAULT_CHANNEL,\n\t\t.authorize\t= true,\n\t\t.auto_connect\t= true,\n\t\t.get_record\t= get_hsp_ag_record,\n\t\t.version\t= 0x0102,\n\t}, {\n\t\t.uuid\t\t= OBEX_OPP_UUID,\n\t\t.name\t\t= \"Object Push\",\n\t\t.channel\t= OPP_DEFAULT_CHANNEL,\n\t\t.psm\t\t= BTD_PROFILE_PSM_AUTO,\n\t\t.mode\t\t= BT_IO_MODE_ERTM,\n\t\t.sec_level\t= BT_IO_SEC_LOW,\n\t\t.authorize\t= false,\n\t\t.get_record\t= get_opp_record,\n\t\t.version\t= 0x0102,\n\t}, {\n\t\t.uuid\t\t= OBEX_FTP_UUID,\n\t\t.name\t\t= \"File Transfer\",\n\t\t.channel\t= FTP_DEFAULT_CHANNEL,\n\t\t.psm\t\t= BTD_PROFILE_PSM_AUTO,\n\t\t.mode\t\t= BT_IO_MODE_ERTM,\n\t\t.authorize\t= true,\n\t\t.get_record\t= get_ftp_record,\n\t\t.version\t= 0x0102,\n\t}, {\n\t\t.uuid\t\t= OBEX_SYNC_UUID,\n\t\t.name\t\t= \"Synchronization\",\n\t\t.channel\t= SYNC_DEFAULT_CHANNEL,\n\t\t.authorize\t= true,\n\t\t.get_record\t= get_sync_record,\n\t\t.version\t= 0x0100,\n\t}, {\n\t\t.uuid\t\t= OBEX_PSE_UUID,\n\t\t.name\t\t= \"Phone Book Access\",\n\t\t.channel\t= PBAP_DEFAULT_CHANNEL,\n\t\t.psm\t\t= BTD_PROFILE_PSM_AUTO,\n\t\t.mode\t\t= BT_IO_MODE_ERTM,\n\t\t.authorize\t= true,\n\t\t.get_record\t= get_pse_record,\n\t\t.version\t= 0x0101,\n\t}, {\n\t\t.uuid\t\t= OBEX_PCE_UUID,\n\t\t.name\t\t= \"Phone Book Access Client\",\n\t\t.remote_uuid\t= OBEX_PSE_UUID,\n\t\t.authorize\t= true,\n\t\t.get_record\t= get_pce_record,\n\t\t.version\t= 0x0102,\n\t}, {\n\t\t.uuid\t\t= OBEX_MAS_UUID,\n\t\t.name\t\t= \"Message Access\",\n\t\t.channel\t= MAS_DEFAULT_CHANNEL,\n\t\t.psm\t\t= BTD_PROFILE_PSM_AUTO,\n\t\t.mode\t\t= BT_IO_MODE_ERTM,\n\t\t.authorize\t= true,\n\t\t.get_record\t= get_mas_record,\n\t\t.version\t= 0x0100\n\t}, {\n\t\t.uuid\t\t= OBEX_MNS_UUID,\n\t\t.name\t\t= \"Message Notification\",\n\t\t.channel\t= MNS_DEFAULT_CHANNEL,\n\t\t.psm\t\t= BTD_PROFILE_PSM_AUTO,\n\t\t.mode\t\t= BT_IO_MODE_ERTM,\n\t\t.authorize\t= true,\n\t\t.get_record\t= get_mns_record,\n\t\t.version\t= 0x0102\n\t},\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic struct default_settings {\n\tconst char\t*uuid;\n\tconst char\t*name;\n\tint\t\tpriority;\n\tconst char\t*remote_uuid;\n\tint\t\tchannel;\n\tint\t\tpsm;\n\tBtIOMode\tmode;\n\tBtIOSecLevel\tsec_level;\n\tbool\t\tauthorize;\n\tbool\t\tauto_connect;\n\tchar *\t\t(*get_record)(struct ext_profile *ext,\n\t\t\t\t\tstruct ext_io *l2cap,\n\t\t\t\t\tstruct ext_io *rfcomm);\n\tuint16_t\tversion;\n\tuint16_t\tfeatures;\n} defaults[] = {\n\t{\n\t\t.uuid\t\t= SPP_UUID,\n\t\t.name\t\t= \"Serial Port\",\n\t\t.channel\t= SPP_DEFAULT_CHANNEL,\n\t\t.authorize\t= true,\n\t\t.get_record\t= get_spp_record,\n\t\t.version\t= 0x0102,\n\t}, {\n\t\t.uuid\t\t= DUN_GW_UUID,\n\t\t.name\t\t= \"Dial-Up Networking\",\n\t\t.channel\t= DUN_DEFAULT_CHANNEL,\n\t\t.authorize\t= true,\n\t\t.get_record\t= get_dun_record,\n\t\t.version\t= 0x0102,\n\t}, {\n\t\t.uuid\t\t= HFP_HS_UUID,\n\t\t.name\t\t= \"Hands-Free unit\",\n\t\t.priority\t= BTD_PROFILE_PRIORITY_HIGH,\n\t\t.remote_uuid\t= HFP_AG_UUID,\n\t\t.channel\t= HFP_HF_DEFAULT_CHANNEL,\n\t\t.authorize\t= true,\n\t\t.auto_connect\t= true,\n\t\t.get_record\t= get_hfp_hf_record,\n\t\t.version\t= 0x0107,\n\t}, {\n\t\t.uuid\t\t= HFP_AG_UUID,\n\t\t.name\t\t= \"Hands-Free Voice gateway\",\n\t\t.priority\t= BTD_PROFILE_PRIORITY_HIGH,\n\t\t.remote_uuid\t= HFP_HS_UUID,\n\t\t.channel\t= HFP_AG_DEFAULT_CHANNEL,\n\t\t.authorize\t= true,\n\t\t.auto_connect\t= true,\n\t\t.get_record\t= get_hfp_ag_record,\n\t\t.version\t= 0x0107,\n\t}, {\n\t\t.uuid\t\t= HSP_AG_UUID,\n\t\t.name\t\t= \"Headset Voice gateway\",\n\t\t.priority\t= BTD_PROFILE_PRIORITY_HIGH,\n\t\t.remote_uuid\t= HSP_HS_UUID,\n\t\t.channel\t= HSP_AG_DEFAULT_CHANNEL,\n\t\t.authorize\t= true,\n\t\t.auto_connect\t= true,\n\t\t.get_record\t= get_hsp_ag_record,\n\t\t.version\t= 0x0102,\n\t}, {\n\t\t.uuid\t\t= OBEX_OPP_UUID,\n\t\t.name\t\t= \"Object Push\",\n\t\t.channel\t= OPP_DEFAULT_CHANNEL,\n\t\t.psm\t\t= BTD_PROFILE_PSM_AUTO,\n\t\t.mode\t\t= BT_IO_MODE_ERTM,\n\t\t.sec_level\t= BT_IO_SEC_LOW,\n\t\t.authorize\t= false,\n\t\t.get_record\t= get_opp_record,\n\t\t.version\t= 0x0102,\n\t}, {\n\t\t.uuid\t\t= OBEX_FTP_UUID,\n\t\t.name\t\t= \"File Transfer\",\n\t\t.channel\t= FTP_DEFAULT_CHANNEL,\n\t\t.psm\t\t= BTD_PROFILE_PSM_AUTO,\n\t\t.mode\t\t= BT_IO_MODE_ERTM,\n\t\t.authorize\t= true,\n\t\t.get_record\t= get_ftp_record,\n\t\t.version\t= 0x0102,\n\t}, {\n\t\t.uuid\t\t= OBEX_SYNC_UUID,\n\t\t.name\t\t= \"Synchronization\",\n\t\t.channel\t= SYNC_DEFAULT_CHANNEL,\n\t\t.authorize\t= true,\n\t\t.get_record\t= get_sync_record,\n\t\t.version\t= 0x0100,\n\t}, {\n\t\t.uuid\t\t= OBEX_PSE_UUID,\n\t\t.name\t\t= \"Phone Book Access\",\n\t\t.channel\t= PBAP_DEFAULT_CHANNEL,\n\t\t.psm\t\t= BTD_PROFILE_PSM_AUTO,\n\t\t.mode\t\t= BT_IO_MODE_ERTM,\n\t\t.authorize\t= true,\n\t\t.get_record\t= get_pse_record,\n\t\t.version\t= 0x0101,\n\t}, {\n\t\t.uuid\t\t= OBEX_PCE_UUID,\n\t\t.name\t\t= \"Phone Book Access Client\",\n\t\t.remote_uuid\t= OBEX_PSE_UUID,\n\t\t.authorize\t= true,\n\t\t.get_record\t= get_pce_record,\n\t\t.version\t= 0x0102,\n\t}, {\n\t\t.uuid\t\t= OBEX_MAS_UUID,\n\t\t.name\t\t= \"Message Access\",\n\t\t.channel\t= MAS_DEFAULT_CHANNEL,\n\t\t.psm\t\t= BTD_PROFILE_PSM_AUTO,\n\t\t.mode\t\t= BT_IO_MODE_ERTM,\n\t\t.authorize\t= true,\n\t\t.get_record\t= get_mas_record,\n\t\t.version\t= 0x0100\n\t}, {\n\t\t.uuid\t\t= OBEX_MNS_UUID,\n\t\t.name\t\t= \"Message Notification\",\n\t\t.channel\t= MNS_DEFAULT_CHANNEL,\n\t\t.psm\t\t= BTD_PROFILE_PSM_AUTO,\n\t\t.mode\t\t= BT_IO_MODE_ERTM,\n\t\t.authorize\t= true,\n\t\t.get_record\t= get_mns_record,\n\t\t.version\t= 0x0102\n\t},\n};\n\nstatic void ext_set_defaults(struct ext_profile *ext)\n{\n\tunsigned int i;\n\n\text->mode = BT_IO_MODE_BASIC;\n\text->sec_level = BT_IO_SEC_MEDIUM;\n\text->authorize = true;\n\text->enable_client = true;\n\text->enable_server = true;\n\text->remote_uuid = NULL;\n\n\tfor (i = 0; i < G_N_ELEMENTS(defaults); i++) {\n\t\tstruct default_settings *settings = &defaults[i];\n\t\tconst char *remote_uuid;\n\n\t\tif (strcasecmp(ext->uuid, settings->uuid) != 0)\n\t\t\tcontinue;\n\n\t\tif (settings->remote_uuid)\n\t\t\tremote_uuid = settings->remote_uuid;\n\t\telse\n\t\t\tremote_uuid = ext->uuid;\n\n\t\text->remote_uuid = g_strdup(remote_uuid);\n\n\t\tif (settings->channel)\n\t\t\text->local_chan = settings->channel;\n\n\t\tif (settings->psm)\n\t\t\text->local_psm = settings->psm;\n\n\t\tif (settings->sec_level)\n\t\t\text->sec_level = settings->sec_level;\n\n\t\tif (settings->mode)\n\t\t\text->mode = settings->mode;\n\n\t\text->authorize = settings->authorize;\n\n\t\tif (settings->auto_connect)\n\t\t\text->p.auto_connect = true;\n\n\t\tif (settings->priority)\n\t\t\text->p.priority = settings->priority;\n\n\t\tif (settings->get_record)\n\t\t\text->get_record = settings->get_record;\n\n\t\tif (settings->version)\n\t\t\text->version = settings->version;\n\n\t\tif (settings->features)\n\t\t\text->features = settings->features;\n\n\t\tif (settings->name)\n\t\t\text->name = g_strdup(settings->name);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "path"
          ],
          "line": 2254
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "owner"
          ],
          "line": 2253
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "ext"
          ],
          "line": 2249
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_name2string",
          "args": [
            "uuid"
          ],
          "line": 2247
        },
        "resolved": true,
        "details": {
          "function_name": "bt_name2string",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/uuid-helper.c",
          "lines": "181-209",
          "snippet": "char *bt_name2string(const char *pattern)\n{\n\tuuid_t uuid;\n\tuint16_t uuid16;\n\tint i;\n\n\t/* UUID 128 string format */\n\tif (is_uuid128(pattern))\n\t\treturn strdup(pattern);\n\n\t/* Friendly service name format */\n\tuuid16 = name2class(pattern);\n\tif (uuid16)\n\t\tgoto proceed;\n\n\t/* HEX format */\n\tuuid16 = strtol(pattern, NULL, 16);\n\tfor (i = 0; bt_services[i].class; i++) {\n\t\tif (bt_services[i].class == uuid16)\n\t\t\tgoto proceed;\n\t}\n\n\treturn NULL;\n\nproceed:\n\tsdp_uuid16_create(&uuid, uuid16);\n\n\treturn bt_uuid2string(&uuid);\n}",
          "includes": [
            "#include \"uuid-helper.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <arpa/inet.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static struct {\n\tconst char\t*name;\n\tuint16_t\tclass;\n} bt_services[] = {\n\t{ \"pbap\",\tPBAP_SVCLASS_ID\t\t\t},\n\t{ \"sap\",\tSAP_SVCLASS_ID\t\t\t},\n\t{ \"ftp\",\tOBEX_FILETRANS_SVCLASS_ID\t},\n\t{ \"bpp\",\tBASIC_PRINTING_SVCLASS_ID\t},\n\t{ \"bip\",\tIMAGING_SVCLASS_ID\t\t},\n\t{ \"synch\",\tIRMC_SYNC_SVCLASS_ID\t\t},\n\t{ \"dun\",\tDIALUP_NET_SVCLASS_ID\t\t},\n\t{ \"opp\",\tOBEX_OBJPUSH_SVCLASS_ID\t\t},\n\t{ \"fax\",\tFAX_SVCLASS_ID\t\t\t},\n\t{ \"spp\",\tSERIAL_PORT_SVCLASS_ID\t\t},\n\t{ \"hsp\",\tHEADSET_SVCLASS_ID\t\t},\n\t{ \"hsp-hs\",\tHEADSET_SVCLASS_ID\t\t},\n\t{ \"hsp-ag\",\tHEADSET_AGW_SVCLASS_ID\t\t},\n\t{ \"hfp\",\tHANDSFREE_SVCLASS_ID\t\t},\n\t{ \"hfp-hf\",\tHANDSFREE_SVCLASS_ID\t\t},\n\t{ \"hfp-ag\",\tHANDSFREE_AGW_SVCLASS_ID\t},\n\t{ \"pbap-pce\",\tPBAP_PCE_SVCLASS_ID\t\t},\n\t{ \"pbap-pse\",\tPBAP_PSE_SVCLASS_ID\t\t},\n\t{ \"map-mse\",\tMAP_MSE_SVCLASS_ID\t\t},\n\t{ \"map-mas\",\tMAP_MSE_SVCLASS_ID\t\t},\n\t{ \"map-mce\",\tMAP_MCE_SVCLASS_ID\t\t},\n\t{ \"map-mns\",\tMAP_MCE_SVCLASS_ID\t\t},\n\t{ \"gnss\",\tGNSS_SERVER_SVCLASS_ID\t\t},\n\t{ }\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"uuid-helper.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <arpa/inet.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic struct {\n\tconst char\t*name;\n\tuint16_t\tclass;\n} bt_services[] = {\n\t{ \"pbap\",\tPBAP_SVCLASS_ID\t\t\t},\n\t{ \"sap\",\tSAP_SVCLASS_ID\t\t\t},\n\t{ \"ftp\",\tOBEX_FILETRANS_SVCLASS_ID\t},\n\t{ \"bpp\",\tBASIC_PRINTING_SVCLASS_ID\t},\n\t{ \"bip\",\tIMAGING_SVCLASS_ID\t\t},\n\t{ \"synch\",\tIRMC_SYNC_SVCLASS_ID\t\t},\n\t{ \"dun\",\tDIALUP_NET_SVCLASS_ID\t\t},\n\t{ \"opp\",\tOBEX_OBJPUSH_SVCLASS_ID\t\t},\n\t{ \"fax\",\tFAX_SVCLASS_ID\t\t\t},\n\t{ \"spp\",\tSERIAL_PORT_SVCLASS_ID\t\t},\n\t{ \"hsp\",\tHEADSET_SVCLASS_ID\t\t},\n\t{ \"hsp-hs\",\tHEADSET_SVCLASS_ID\t\t},\n\t{ \"hsp-ag\",\tHEADSET_AGW_SVCLASS_ID\t\t},\n\t{ \"hfp\",\tHANDSFREE_SVCLASS_ID\t\t},\n\t{ \"hfp-hf\",\tHANDSFREE_SVCLASS_ID\t\t},\n\t{ \"hfp-ag\",\tHANDSFREE_AGW_SVCLASS_ID\t},\n\t{ \"pbap-pce\",\tPBAP_PCE_SVCLASS_ID\t\t},\n\t{ \"pbap-pse\",\tPBAP_PSE_SVCLASS_ID\t\t},\n\t{ \"map-mse\",\tMAP_MSE_SVCLASS_ID\t\t},\n\t{ \"map-mas\",\tMAP_MSE_SVCLASS_ID\t\t},\n\t{ \"map-mce\",\tMAP_MCE_SVCLASS_ID\t\t},\n\t{ \"map-mns\",\tMAP_MCE_SVCLASS_ID\t\t},\n\t{ \"gnss\",\tGNSS_SERVER_SVCLASS_ID\t\t},\n\t{ }\n};\n\nchar *bt_name2string(const char *pattern)\n{\n\tuuid_t uuid;\n\tuint16_t uuid16;\n\tint i;\n\n\t/* UUID 128 string format */\n\tif (is_uuid128(pattern))\n\t\treturn strdup(pattern);\n\n\t/* Friendly service name format */\n\tuuid16 = name2class(pattern);\n\tif (uuid16)\n\t\tgoto proceed;\n\n\t/* HEX format */\n\tuuid16 = strtol(pattern, NULL, 16);\n\tfor (i = 0; bt_services[i].class; i++) {\n\t\tif (bt_services[i].class == uuid16)\n\t\t\tgoto proceed;\n\t}\n\n\treturn NULL;\n\nproceed:\n\tsdp_uuid16_create(&uuid, uuid16);\n\n\treturn bt_uuid2string(&uuid);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_new0",
          "args": [
            "structext_profile",
            "1"
          ],
          "line": 2245
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic GSList *ext_profiles = NULL;\n\nstatic struct ext_profile *create_ext(const char *owner, const char *path,\n\t\t\t\t\tconst char *uuid,\n\t\t\t\t\tDBusMessageIter *opts)\n{\n\tstruct btd_profile *p;\n\tstruct ext_profile *ext;\n\n\text = g_new0(struct ext_profile, 1);\n\n\text->uuid = bt_name2string(uuid);\n\tif (ext->uuid == NULL) {\n\t\tg_free(ext);\n\t\treturn NULL;\n\t}\n\n\text->owner = g_strdup(owner);\n\text->path = g_strdup(path);\n\n\text_set_defaults(ext);\n\n\twhile (dbus_message_iter_get_arg_type(opts) == DBUS_TYPE_DICT_ENTRY) {\n\t\tDBusMessageIter value, entry;\n\t\tconst char *key;\n\n\t\tdbus_message_iter_recurse(opts, &entry);\n\t\tdbus_message_iter_get_basic(&entry, &key);\n\n\t\tdbus_message_iter_next(&entry);\n\t\tdbus_message_iter_recurse(&entry, &value);\n\n\t\tif (parse_ext_opt(ext, key, &value) < 0)\n\t\t\terror(\"Invalid value for profile option %s\", key);\n\n\t\tdbus_message_iter_next(opts);\n\t}\n\n\tif (!ext->service)\n\t\tset_service(ext);\n\n\tif (ext->enable_server && !(ext->record || ext->get_record))\n\t\text->get_record = get_generic_record;\n\n\tif (!ext->name)\n\t\text->name = g_strdup_printf(\"%s%s/%s\", owner, path, uuid);\n\n\tif (!ext->remote_uuid) {\n\t\tif (ext->service)\n\t\t\text->remote_uuid = g_strdup(ext->service);\n\t\telse\n\t\t\text->remote_uuid = g_strdup(ext->uuid);\n\t}\n\n\tp = &ext->p;\n\n\tp->name = ext->name;\n\tp->local_uuid = ext->service ? ext->service : ext->uuid;\n\tp->remote_uuid = ext->remote_uuid;\n\tp->external = true;\n\n\tif (ext->enable_server) {\n\t\tp->adapter_probe = ext_adapter_probe;\n\t\tp->adapter_remove = ext_adapter_remove;\n\t}\n\n\tif (ext->enable_client) {\n\t\tp->device_probe = ext_device_probe;\n\t\tp->device_remove = ext_device_remove;\n\t\tp->connect = ext_connect_dev;\n\t\tp->disconnect = ext_disconnect_dev;\n\t}\n\n\tDBG(\"Created \\\"%s\\\"\", ext->name);\n\n\text_profiles = g_slist_append(ext_profiles, ext);\n\n\tadapter_foreach(adapter_add_profile, &ext->p);\n\n\treturn ext;\n}"
  },
  {
    "function_name": "set_service",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
    "lines": "2211-2236",
    "snippet": "static void set_service(struct ext_profile *ext)\n{\n\tif (strcasecmp(ext->uuid, HSP_HS_UUID) == 0) {\n\t\text->service = strdup(ext->uuid);\n\t} else if (strcasecmp(ext->uuid, HSP_AG_UUID) == 0) {\n\t\text->service = ext->uuid;\n\t\text->uuid = strdup(HSP_HS_UUID);\n\t} else if (strcasecmp(ext->uuid, HFP_HS_UUID) == 0) {\n\t\text->service = strdup(ext->uuid);\n\t} else if (strcasecmp(ext->uuid, HFP_AG_UUID) == 0) {\n\t\text->service = ext->uuid;\n\t\text->uuid = strdup(HFP_HS_UUID);\n\t} else if (strcasecmp(ext->uuid, OBEX_SYNC_UUID) == 0 ||\n\t\t\tstrcasecmp(ext->uuid, OBEX_OPP_UUID) == 0 ||\n\t\t\tstrcasecmp(ext->uuid, OBEX_FTP_UUID) == 0) {\n\t\text->service = strdup(ext->uuid);\n\t} else if (strcasecmp(ext->uuid, OBEX_PSE_UUID) == 0 ||\n\t\t\tstrcasecmp(ext->uuid, OBEX_PCE_UUID) ==  0) {\n\t\text->service = ext->uuid;\n\t\text->uuid = strdup(OBEX_PBAP_UUID);\n\t} else if (strcasecmp(ext->uuid, OBEX_MAS_UUID) == 0 ||\n\t\t\tstrcasecmp(ext->uuid, OBEX_MNS_UUID) == 0) {\n\t\text->service = ext->uuid;\n\t\text->uuid = strdup(OBEX_MAP_UUID);\n\t}\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"sdp-xml.h\"",
      "#include \"sdp-client.h\"",
      "#include \"dbus-common.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"btio/btio.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "OBEX_MAP_UUID"
          ],
          "line": 2234
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcasecmp",
          "args": [
            "ext->uuid",
            "OBEX_MNS_UUID"
          ],
          "line": 2232
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcasecmp",
          "args": [
            "ext->uuid",
            "OBEX_MAS_UUID"
          ],
          "line": 2231
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "OBEX_PBAP_UUID"
          ],
          "line": 2230
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcasecmp",
          "args": [
            "ext->uuid",
            "OBEX_PCE_UUID"
          ],
          "line": 2228
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcasecmp",
          "args": [
            "ext->uuid",
            "OBEX_PSE_UUID"
          ],
          "line": 2227
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "ext->uuid"
          ],
          "line": 2226
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcasecmp",
          "args": [
            "ext->uuid",
            "OBEX_FTP_UUID"
          ],
          "line": 2225
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcasecmp",
          "args": [
            "ext->uuid",
            "OBEX_OPP_UUID"
          ],
          "line": 2224
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcasecmp",
          "args": [
            "ext->uuid",
            "OBEX_SYNC_UUID"
          ],
          "line": 2223
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "HFP_HS_UUID"
          ],
          "line": 2222
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcasecmp",
          "args": [
            "ext->uuid",
            "HFP_AG_UUID"
          ],
          "line": 2220
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "ext->uuid"
          ],
          "line": 2219
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcasecmp",
          "args": [
            "ext->uuid",
            "HFP_HS_UUID"
          ],
          "line": 2218
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "HSP_HS_UUID"
          ],
          "line": 2217
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcasecmp",
          "args": [
            "ext->uuid",
            "HSP_AG_UUID"
          ],
          "line": 2215
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "ext->uuid"
          ],
          "line": 2214
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcasecmp",
          "args": [
            "ext->uuid",
            "HSP_HS_UUID"
          ],
          "line": 2213
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void set_service(struct ext_profile *ext)\n{\n\tif (strcasecmp(ext->uuid, HSP_HS_UUID) == 0) {\n\t\text->service = strdup(ext->uuid);\n\t} else if (strcasecmp(ext->uuid, HSP_AG_UUID) == 0) {\n\t\text->service = ext->uuid;\n\t\text->uuid = strdup(HSP_HS_UUID);\n\t} else if (strcasecmp(ext->uuid, HFP_HS_UUID) == 0) {\n\t\text->service = strdup(ext->uuid);\n\t} else if (strcasecmp(ext->uuid, HFP_AG_UUID) == 0) {\n\t\text->service = ext->uuid;\n\t\text->uuid = strdup(HFP_HS_UUID);\n\t} else if (strcasecmp(ext->uuid, OBEX_SYNC_UUID) == 0 ||\n\t\t\tstrcasecmp(ext->uuid, OBEX_OPP_UUID) == 0 ||\n\t\t\tstrcasecmp(ext->uuid, OBEX_FTP_UUID) == 0) {\n\t\text->service = strdup(ext->uuid);\n\t} else if (strcasecmp(ext->uuid, OBEX_PSE_UUID) == 0 ||\n\t\t\tstrcasecmp(ext->uuid, OBEX_PCE_UUID) ==  0) {\n\t\text->service = ext->uuid;\n\t\text->uuid = strdup(OBEX_PBAP_UUID);\n\t} else if (strcasecmp(ext->uuid, OBEX_MAS_UUID) == 0 ||\n\t\t\tstrcasecmp(ext->uuid, OBEX_MNS_UUID) == 0) {\n\t\text->service = ext->uuid;\n\t\text->uuid = strdup(OBEX_MAP_UUID);\n\t}\n}"
  },
  {
    "function_name": "parse_ext_opt",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
    "lines": "2117-2209",
    "snippet": "static int parse_ext_opt(struct ext_profile *ext, const char *key,\n\t\t\t\t\t\t\tDBusMessageIter *value)\n{\n\tint type = dbus_message_iter_get_arg_type(value);\n\tconst char *str;\n\tuint16_t u16;\n\tdbus_bool_t b;\n\n\tif (strcasecmp(key, \"Name\") == 0) {\n\t\tif (type != DBUS_TYPE_STRING)\n\t\t\treturn -EINVAL;\n\t\tdbus_message_iter_get_basic(value, &str);\n\t\tg_free(ext->name);\n\t\text->name = g_strdup(str);\n\t} else if (strcasecmp(key, \"AutoConnect\") == 0) {\n\t\tif (type != DBUS_TYPE_BOOLEAN)\n\t\t\treturn -EINVAL;\n\t\tdbus_message_iter_get_basic(value, &b);\n\t\text->p.auto_connect = b;\n\t} else if (strcasecmp(key, \"PSM\") == 0) {\n\t\tif (type != DBUS_TYPE_UINT16)\n\t\t\treturn -EINVAL;\n\t\tdbus_message_iter_get_basic(value, &u16);\n\t\text->local_psm = u16 ? u16 : BTD_PROFILE_PSM_AUTO;\n\t} else if (strcasecmp(key, \"Channel\") == 0) {\n\t\tif (type != DBUS_TYPE_UINT16)\n\t\t\treturn -EINVAL;\n\n\t\tdbus_message_iter_get_basic(value, &u16);\n\t\tif (u16 > 31)\n\t\t\treturn -EINVAL;\n\t\text->local_chan = u16 ? u16 : BTD_PROFILE_CHAN_AUTO;\n\t} else if (strcasecmp(key, \"RequireAuthentication\") == 0) {\n\t\tif (type != DBUS_TYPE_BOOLEAN)\n\t\t\treturn -EINVAL;\n\n\t\tdbus_message_iter_get_basic(value, &b);\n\t\tif (b)\n\t\t\text->sec_level = BT_IO_SEC_MEDIUM;\n\t\telse\n\t\t\text->sec_level = BT_IO_SEC_LOW;\n\t} else if (strcasecmp(key, \"RequireAuthorization\") == 0) {\n\t\tif (type != DBUS_TYPE_BOOLEAN)\n\t\t\treturn -EINVAL;\n\t\tdbus_message_iter_get_basic(value, &b);\n\t\text->authorize = b;\n\t} else if (strcasecmp(key, \"Role\") == 0) {\n\t\tif (type != DBUS_TYPE_STRING)\n\t\t\treturn -EINVAL;\n\t\tdbus_message_iter_get_basic(value, &str);\n\t\tg_free(ext->role);\n\t\text->role = g_strdup(str);\n\n\t\tif (g_str_equal(ext->role, \"client\")) {\n\t\t\text->enable_server = false;\n\t\t\text->enable_client = true;\n\t\t} else if (g_str_equal(ext->role, \"server\")) {\n\t\t\text->enable_server = true;\n\t\t\text->enable_client = false;\n\t\t}\n\t} else if (strcasecmp(key, \"ServiceRecord\") == 0) {\n\t\tif (type != DBUS_TYPE_STRING)\n\t\t\treturn -EINVAL;\n\t\tdbus_message_iter_get_basic(value, &str);\n\t\tg_free(ext->record);\n\t\text->record = g_strdup(str);\n\t\text->enable_server = true;\n\t} else if (strcasecmp(key, \"Version\") == 0) {\n\t\tuint16_t ver;\n\n\t\tif (type != DBUS_TYPE_UINT16)\n\t\t\treturn -EINVAL;\n\n\t\tdbus_message_iter_get_basic(value, &ver);\n\t\text->version = ver;\n\t} else if (strcasecmp(key, \"Features\") == 0) {\n\t\tuint16_t feat;\n\n\t\tif (type != DBUS_TYPE_UINT16)\n\t\t\treturn -EINVAL;\n\n\t\tdbus_message_iter_get_basic(value, &feat);\n\t\text->features = feat;\n\t} else if (strcasecmp(key, \"Service\") == 0) {\n\t\tif (type != DBUS_TYPE_STRING)\n\t\t\treturn -EINVAL;\n\t\tdbus_message_iter_get_basic(value, &str);\n\t\tfree(ext->service);\n\t\text->service = bt_name2string(str);\n\t}\n\n\treturn 0;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"sdp-xml.h\"",
      "#include \"sdp-client.h\"",
      "#include \"dbus-common.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"btio/btio.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define BTD_PROFILE_CHAN_AUTO\t-1",
      "#define BTD_PROFILE_PSM_AUTO\t-1"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bt_name2string",
          "args": [
            "str"
          ],
          "line": 2205
        },
        "resolved": true,
        "details": {
          "function_name": "bt_name2string",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/uuid-helper.c",
          "lines": "181-209",
          "snippet": "char *bt_name2string(const char *pattern)\n{\n\tuuid_t uuid;\n\tuint16_t uuid16;\n\tint i;\n\n\t/* UUID 128 string format */\n\tif (is_uuid128(pattern))\n\t\treturn strdup(pattern);\n\n\t/* Friendly service name format */\n\tuuid16 = name2class(pattern);\n\tif (uuid16)\n\t\tgoto proceed;\n\n\t/* HEX format */\n\tuuid16 = strtol(pattern, NULL, 16);\n\tfor (i = 0; bt_services[i].class; i++) {\n\t\tif (bt_services[i].class == uuid16)\n\t\t\tgoto proceed;\n\t}\n\n\treturn NULL;\n\nproceed:\n\tsdp_uuid16_create(&uuid, uuid16);\n\n\treturn bt_uuid2string(&uuid);\n}",
          "includes": [
            "#include \"uuid-helper.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <arpa/inet.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static struct {\n\tconst char\t*name;\n\tuint16_t\tclass;\n} bt_services[] = {\n\t{ \"pbap\",\tPBAP_SVCLASS_ID\t\t\t},\n\t{ \"sap\",\tSAP_SVCLASS_ID\t\t\t},\n\t{ \"ftp\",\tOBEX_FILETRANS_SVCLASS_ID\t},\n\t{ \"bpp\",\tBASIC_PRINTING_SVCLASS_ID\t},\n\t{ \"bip\",\tIMAGING_SVCLASS_ID\t\t},\n\t{ \"synch\",\tIRMC_SYNC_SVCLASS_ID\t\t},\n\t{ \"dun\",\tDIALUP_NET_SVCLASS_ID\t\t},\n\t{ \"opp\",\tOBEX_OBJPUSH_SVCLASS_ID\t\t},\n\t{ \"fax\",\tFAX_SVCLASS_ID\t\t\t},\n\t{ \"spp\",\tSERIAL_PORT_SVCLASS_ID\t\t},\n\t{ \"hsp\",\tHEADSET_SVCLASS_ID\t\t},\n\t{ \"hsp-hs\",\tHEADSET_SVCLASS_ID\t\t},\n\t{ \"hsp-ag\",\tHEADSET_AGW_SVCLASS_ID\t\t},\n\t{ \"hfp\",\tHANDSFREE_SVCLASS_ID\t\t},\n\t{ \"hfp-hf\",\tHANDSFREE_SVCLASS_ID\t\t},\n\t{ \"hfp-ag\",\tHANDSFREE_AGW_SVCLASS_ID\t},\n\t{ \"pbap-pce\",\tPBAP_PCE_SVCLASS_ID\t\t},\n\t{ \"pbap-pse\",\tPBAP_PSE_SVCLASS_ID\t\t},\n\t{ \"map-mse\",\tMAP_MSE_SVCLASS_ID\t\t},\n\t{ \"map-mas\",\tMAP_MSE_SVCLASS_ID\t\t},\n\t{ \"map-mce\",\tMAP_MCE_SVCLASS_ID\t\t},\n\t{ \"map-mns\",\tMAP_MCE_SVCLASS_ID\t\t},\n\t{ \"gnss\",\tGNSS_SERVER_SVCLASS_ID\t\t},\n\t{ }\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"uuid-helper.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <arpa/inet.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic struct {\n\tconst char\t*name;\n\tuint16_t\tclass;\n} bt_services[] = {\n\t{ \"pbap\",\tPBAP_SVCLASS_ID\t\t\t},\n\t{ \"sap\",\tSAP_SVCLASS_ID\t\t\t},\n\t{ \"ftp\",\tOBEX_FILETRANS_SVCLASS_ID\t},\n\t{ \"bpp\",\tBASIC_PRINTING_SVCLASS_ID\t},\n\t{ \"bip\",\tIMAGING_SVCLASS_ID\t\t},\n\t{ \"synch\",\tIRMC_SYNC_SVCLASS_ID\t\t},\n\t{ \"dun\",\tDIALUP_NET_SVCLASS_ID\t\t},\n\t{ \"opp\",\tOBEX_OBJPUSH_SVCLASS_ID\t\t},\n\t{ \"fax\",\tFAX_SVCLASS_ID\t\t\t},\n\t{ \"spp\",\tSERIAL_PORT_SVCLASS_ID\t\t},\n\t{ \"hsp\",\tHEADSET_SVCLASS_ID\t\t},\n\t{ \"hsp-hs\",\tHEADSET_SVCLASS_ID\t\t},\n\t{ \"hsp-ag\",\tHEADSET_AGW_SVCLASS_ID\t\t},\n\t{ \"hfp\",\tHANDSFREE_SVCLASS_ID\t\t},\n\t{ \"hfp-hf\",\tHANDSFREE_SVCLASS_ID\t\t},\n\t{ \"hfp-ag\",\tHANDSFREE_AGW_SVCLASS_ID\t},\n\t{ \"pbap-pce\",\tPBAP_PCE_SVCLASS_ID\t\t},\n\t{ \"pbap-pse\",\tPBAP_PSE_SVCLASS_ID\t\t},\n\t{ \"map-mse\",\tMAP_MSE_SVCLASS_ID\t\t},\n\t{ \"map-mas\",\tMAP_MSE_SVCLASS_ID\t\t},\n\t{ \"map-mce\",\tMAP_MCE_SVCLASS_ID\t\t},\n\t{ \"map-mns\",\tMAP_MCE_SVCLASS_ID\t\t},\n\t{ \"gnss\",\tGNSS_SERVER_SVCLASS_ID\t\t},\n\t{ }\n};\n\nchar *bt_name2string(const char *pattern)\n{\n\tuuid_t uuid;\n\tuint16_t uuid16;\n\tint i;\n\n\t/* UUID 128 string format */\n\tif (is_uuid128(pattern))\n\t\treturn strdup(pattern);\n\n\t/* Friendly service name format */\n\tuuid16 = name2class(pattern);\n\tif (uuid16)\n\t\tgoto proceed;\n\n\t/* HEX format */\n\tuuid16 = strtol(pattern, NULL, 16);\n\tfor (i = 0; bt_services[i].class; i++) {\n\t\tif (bt_services[i].class == uuid16)\n\t\t\tgoto proceed;\n\t}\n\n\treturn NULL;\n\nproceed:\n\tsdp_uuid16_create(&uuid, uuid16);\n\n\treturn bt_uuid2string(&uuid);\n}"
        }
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "ext->service"
          ],
          "line": 2204
        },
        "resolved": true,
        "details": {
          "function_name": "free_property",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
          "lines": "2468-2477",
          "snippet": "static void free_property(gpointer data)\n{\n\tstruct btd_profile_custom_property *p = data;\n\n\tg_free(p->uuid);\n\tg_free(p->type);\n\tg_free(p->name);\n\n\tg_free(p);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdp-xml.h\"",
            "#include \"sdp-client.h\"",
            "#include \"dbus-common.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"btio/btio.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void free_property(gpointer data)\n{\n\tstruct btd_profile_custom_property *p = data;\n\n\tg_free(p->uuid);\n\tg_free(p->type);\n\tg_free(p->name);\n\n\tg_free(p);\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_basic",
          "args": [
            "value",
            "&str"
          ],
          "line": 2203
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcasecmp",
          "args": [
            "key",
            "\"Service\""
          ],
          "line": 2200
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_basic",
          "args": [
            "value",
            "&feat"
          ],
          "line": 2198
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcasecmp",
          "args": [
            "key",
            "\"Features\""
          ],
          "line": 2192
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_basic",
          "args": [
            "value",
            "&ver"
          ],
          "line": 2190
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcasecmp",
          "args": [
            "key",
            "\"Version\""
          ],
          "line": 2184
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "str"
          ],
          "line": 2182
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "ext->record"
          ],
          "line": 2181
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_basic",
          "args": [
            "value",
            "&str"
          ],
          "line": 2180
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcasecmp",
          "args": [
            "key",
            "\"ServiceRecord\""
          ],
          "line": 2177
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_str_equal",
          "args": [
            "ext->role",
            "\"server\""
          ],
          "line": 2173
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_str_equal",
          "args": [
            "ext->role",
            "\"client\""
          ],
          "line": 2170
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "str"
          ],
          "line": 2168
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "ext->role"
          ],
          "line": 2167
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_basic",
          "args": [
            "value",
            "&str"
          ],
          "line": 2166
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcasecmp",
          "args": [
            "key",
            "\"Role\""
          ],
          "line": 2163
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_basic",
          "args": [
            "value",
            "&b"
          ],
          "line": 2161
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcasecmp",
          "args": [
            "key",
            "\"RequireAuthorization\""
          ],
          "line": 2158
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_basic",
          "args": [
            "value",
            "&b"
          ],
          "line": 2153
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcasecmp",
          "args": [
            "key",
            "\"RequireAuthentication\""
          ],
          "line": 2149
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_basic",
          "args": [
            "value",
            "&u16"
          ],
          "line": 2145
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcasecmp",
          "args": [
            "key",
            "\"Channel\""
          ],
          "line": 2141
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_basic",
          "args": [
            "value",
            "&u16"
          ],
          "line": 2139
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcasecmp",
          "args": [
            "key",
            "\"PSM\""
          ],
          "line": 2136
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_basic",
          "args": [
            "value",
            "&b"
          ],
          "line": 2134
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcasecmp",
          "args": [
            "key",
            "\"AutoConnect\""
          ],
          "line": 2131
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "str"
          ],
          "line": 2130
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "ext->name"
          ],
          "line": 2129
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_basic",
          "args": [
            "value",
            "&str"
          ],
          "line": 2128
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcasecmp",
          "args": [
            "key",
            "\"Name\""
          ],
          "line": 2125
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_get_arg_type",
          "args": [
            "value"
          ],
          "line": 2120
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\n#define BTD_PROFILE_CHAN_AUTO\t-1\n#define BTD_PROFILE_PSM_AUTO\t-1\n\nstatic int parse_ext_opt(struct ext_profile *ext, const char *key,\n\t\t\t\t\t\t\tDBusMessageIter *value)\n{\n\tint type = dbus_message_iter_get_arg_type(value);\n\tconst char *str;\n\tuint16_t u16;\n\tdbus_bool_t b;\n\n\tif (strcasecmp(key, \"Name\") == 0) {\n\t\tif (type != DBUS_TYPE_STRING)\n\t\t\treturn -EINVAL;\n\t\tdbus_message_iter_get_basic(value, &str);\n\t\tg_free(ext->name);\n\t\text->name = g_strdup(str);\n\t} else if (strcasecmp(key, \"AutoConnect\") == 0) {\n\t\tif (type != DBUS_TYPE_BOOLEAN)\n\t\t\treturn -EINVAL;\n\t\tdbus_message_iter_get_basic(value, &b);\n\t\text->p.auto_connect = b;\n\t} else if (strcasecmp(key, \"PSM\") == 0) {\n\t\tif (type != DBUS_TYPE_UINT16)\n\t\t\treturn -EINVAL;\n\t\tdbus_message_iter_get_basic(value, &u16);\n\t\text->local_psm = u16 ? u16 : BTD_PROFILE_PSM_AUTO;\n\t} else if (strcasecmp(key, \"Channel\") == 0) {\n\t\tif (type != DBUS_TYPE_UINT16)\n\t\t\treturn -EINVAL;\n\n\t\tdbus_message_iter_get_basic(value, &u16);\n\t\tif (u16 > 31)\n\t\t\treturn -EINVAL;\n\t\text->local_chan = u16 ? u16 : BTD_PROFILE_CHAN_AUTO;\n\t} else if (strcasecmp(key, \"RequireAuthentication\") == 0) {\n\t\tif (type != DBUS_TYPE_BOOLEAN)\n\t\t\treturn -EINVAL;\n\n\t\tdbus_message_iter_get_basic(value, &b);\n\t\tif (b)\n\t\t\text->sec_level = BT_IO_SEC_MEDIUM;\n\t\telse\n\t\t\text->sec_level = BT_IO_SEC_LOW;\n\t} else if (strcasecmp(key, \"RequireAuthorization\") == 0) {\n\t\tif (type != DBUS_TYPE_BOOLEAN)\n\t\t\treturn -EINVAL;\n\t\tdbus_message_iter_get_basic(value, &b);\n\t\text->authorize = b;\n\t} else if (strcasecmp(key, \"Role\") == 0) {\n\t\tif (type != DBUS_TYPE_STRING)\n\t\t\treturn -EINVAL;\n\t\tdbus_message_iter_get_basic(value, &str);\n\t\tg_free(ext->role);\n\t\text->role = g_strdup(str);\n\n\t\tif (g_str_equal(ext->role, \"client\")) {\n\t\t\text->enable_server = false;\n\t\t\text->enable_client = true;\n\t\t} else if (g_str_equal(ext->role, \"server\")) {\n\t\t\text->enable_server = true;\n\t\t\text->enable_client = false;\n\t\t}\n\t} else if (strcasecmp(key, \"ServiceRecord\") == 0) {\n\t\tif (type != DBUS_TYPE_STRING)\n\t\t\treturn -EINVAL;\n\t\tdbus_message_iter_get_basic(value, &str);\n\t\tg_free(ext->record);\n\t\text->record = g_strdup(str);\n\t\text->enable_server = true;\n\t} else if (strcasecmp(key, \"Version\") == 0) {\n\t\tuint16_t ver;\n\n\t\tif (type != DBUS_TYPE_UINT16)\n\t\t\treturn -EINVAL;\n\n\t\tdbus_message_iter_get_basic(value, &ver);\n\t\text->version = ver;\n\t} else if (strcasecmp(key, \"Features\") == 0) {\n\t\tuint16_t feat;\n\n\t\tif (type != DBUS_TYPE_UINT16)\n\t\t\treturn -EINVAL;\n\n\t\tdbus_message_iter_get_basic(value, &feat);\n\t\text->features = feat;\n\t} else if (strcasecmp(key, \"Service\") == 0) {\n\t\tif (type != DBUS_TYPE_STRING)\n\t\t\treturn -EINVAL;\n\t\tdbus_message_iter_get_basic(value, &str);\n\t\tfree(ext->service);\n\t\text->service = bt_name2string(str);\n\t}\n\n\treturn 0;\n}"
  },
  {
    "function_name": "ext_set_defaults",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
    "lines": "2058-2115",
    "snippet": "static void ext_set_defaults(struct ext_profile *ext)\n{\n\tunsigned int i;\n\n\text->mode = BT_IO_MODE_BASIC;\n\text->sec_level = BT_IO_SEC_MEDIUM;\n\text->authorize = true;\n\text->enable_client = true;\n\text->enable_server = true;\n\text->remote_uuid = NULL;\n\n\tfor (i = 0; i < G_N_ELEMENTS(defaults); i++) {\n\t\tstruct default_settings *settings = &defaults[i];\n\t\tconst char *remote_uuid;\n\n\t\tif (strcasecmp(ext->uuid, settings->uuid) != 0)\n\t\t\tcontinue;\n\n\t\tif (settings->remote_uuid)\n\t\t\tremote_uuid = settings->remote_uuid;\n\t\telse\n\t\t\tremote_uuid = ext->uuid;\n\n\t\text->remote_uuid = g_strdup(remote_uuid);\n\n\t\tif (settings->channel)\n\t\t\text->local_chan = settings->channel;\n\n\t\tif (settings->psm)\n\t\t\text->local_psm = settings->psm;\n\n\t\tif (settings->sec_level)\n\t\t\text->sec_level = settings->sec_level;\n\n\t\tif (settings->mode)\n\t\t\text->mode = settings->mode;\n\n\t\text->authorize = settings->authorize;\n\n\t\tif (settings->auto_connect)\n\t\t\text->p.auto_connect = true;\n\n\t\tif (settings->priority)\n\t\t\text->p.priority = settings->priority;\n\n\t\tif (settings->get_record)\n\t\t\text->get_record = settings->get_record;\n\n\t\tif (settings->version)\n\t\t\text->version = settings->version;\n\n\t\tif (settings->features)\n\t\t\text->features = settings->features;\n\n\t\tif (settings->name)\n\t\t\text->name = g_strdup(settings->name);\n\t}\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"sdp-xml.h\"",
      "#include \"sdp-client.h\"",
      "#include \"dbus-common.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"btio/btio.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static struct default_settings {\n\tconst char\t*uuid;\n\tconst char\t*name;\n\tint\t\tpriority;\n\tconst char\t*remote_uuid;\n\tint\t\tchannel;\n\tint\t\tpsm;\n\tBtIOMode\tmode;\n\tBtIOSecLevel\tsec_level;\n\tbool\t\tauthorize;\n\tbool\t\tauto_connect;\n\tchar *\t\t(*get_record)(struct ext_profile *ext,\n\t\t\t\t\tstruct ext_io *l2cap,\n\t\t\t\t\tstruct ext_io *rfcomm);\n\tuint16_t\tversion;\n\tuint16_t\tfeatures;\n} defaults[] = {\n\t{\n\t\t.uuid\t\t= SPP_UUID,\n\t\t.name\t\t= \"Serial Port\",\n\t\t.channel\t= SPP_DEFAULT_CHANNEL,\n\t\t.authorize\t= true,\n\t\t.get_record\t= get_spp_record,\n\t\t.version\t= 0x0102,\n\t}, {\n\t\t.uuid\t\t= DUN_GW_UUID,\n\t\t.name\t\t= \"Dial-Up Networking\",\n\t\t.channel\t= DUN_DEFAULT_CHANNEL,\n\t\t.authorize\t= true,\n\t\t.get_record\t= get_dun_record,\n\t\t.version\t= 0x0102,\n\t}, {\n\t\t.uuid\t\t= HFP_HS_UUID,\n\t\t.name\t\t= \"Hands-Free unit\",\n\t\t.priority\t= BTD_PROFILE_PRIORITY_HIGH,\n\t\t.remote_uuid\t= HFP_AG_UUID,\n\t\t.channel\t= HFP_HF_DEFAULT_CHANNEL,\n\t\t.authorize\t= true,\n\t\t.auto_connect\t= true,\n\t\t.get_record\t= get_hfp_hf_record,\n\t\t.version\t= 0x0107,\n\t}, {\n\t\t.uuid\t\t= HFP_AG_UUID,\n\t\t.name\t\t= \"Hands-Free Voice gateway\",\n\t\t.priority\t= BTD_PROFILE_PRIORITY_HIGH,\n\t\t.remote_uuid\t= HFP_HS_UUID,\n\t\t.channel\t= HFP_AG_DEFAULT_CHANNEL,\n\t\t.authorize\t= true,\n\t\t.auto_connect\t= true,\n\t\t.get_record\t= get_hfp_ag_record,\n\t\t.version\t= 0x0107,\n\t}, {\n\t\t.uuid\t\t= HSP_AG_UUID,\n\t\t.name\t\t= \"Headset Voice gateway\",\n\t\t.priority\t= BTD_PROFILE_PRIORITY_HIGH,\n\t\t.remote_uuid\t= HSP_HS_UUID,\n\t\t.channel\t= HSP_AG_DEFAULT_CHANNEL,\n\t\t.authorize\t= true,\n\t\t.auto_connect\t= true,\n\t\t.get_record\t= get_hsp_ag_record,\n\t\t.version\t= 0x0102,\n\t}, {\n\t\t.uuid\t\t= OBEX_OPP_UUID,\n\t\t.name\t\t= \"Object Push\",\n\t\t.channel\t= OPP_DEFAULT_CHANNEL,\n\t\t.psm\t\t= BTD_PROFILE_PSM_AUTO,\n\t\t.mode\t\t= BT_IO_MODE_ERTM,\n\t\t.sec_level\t= BT_IO_SEC_LOW,\n\t\t.authorize\t= false,\n\t\t.get_record\t= get_opp_record,\n\t\t.version\t= 0x0102,\n\t}, {\n\t\t.uuid\t\t= OBEX_FTP_UUID,\n\t\t.name\t\t= \"File Transfer\",\n\t\t.channel\t= FTP_DEFAULT_CHANNEL,\n\t\t.psm\t\t= BTD_PROFILE_PSM_AUTO,\n\t\t.mode\t\t= BT_IO_MODE_ERTM,\n\t\t.authorize\t= true,\n\t\t.get_record\t= get_ftp_record,\n\t\t.version\t= 0x0102,\n\t}, {\n\t\t.uuid\t\t= OBEX_SYNC_UUID,\n\t\t.name\t\t= \"Synchronization\",\n\t\t.channel\t= SYNC_DEFAULT_CHANNEL,\n\t\t.authorize\t= true,\n\t\t.get_record\t= get_sync_record,\n\t\t.version\t= 0x0100,\n\t}, {\n\t\t.uuid\t\t= OBEX_PSE_UUID,\n\t\t.name\t\t= \"Phone Book Access\",\n\t\t.channel\t= PBAP_DEFAULT_CHANNEL,\n\t\t.psm\t\t= BTD_PROFILE_PSM_AUTO,\n\t\t.mode\t\t= BT_IO_MODE_ERTM,\n\t\t.authorize\t= true,\n\t\t.get_record\t= get_pse_record,\n\t\t.version\t= 0x0101,\n\t}, {\n\t\t.uuid\t\t= OBEX_PCE_UUID,\n\t\t.name\t\t= \"Phone Book Access Client\",\n\t\t.remote_uuid\t= OBEX_PSE_UUID,\n\t\t.authorize\t= true,\n\t\t.get_record\t= get_pce_record,\n\t\t.version\t= 0x0102,\n\t}, {\n\t\t.uuid\t\t= OBEX_MAS_UUID,\n\t\t.name\t\t= \"Message Access\",\n\t\t.channel\t= MAS_DEFAULT_CHANNEL,\n\t\t.psm\t\t= BTD_PROFILE_PSM_AUTO,\n\t\t.mode\t\t= BT_IO_MODE_ERTM,\n\t\t.authorize\t= true,\n\t\t.get_record\t= get_mas_record,\n\t\t.version\t= 0x0100\n\t}, {\n\t\t.uuid\t\t= OBEX_MNS_UUID,\n\t\t.name\t\t= \"Message Notification\",\n\t\t.channel\t= MNS_DEFAULT_CHANNEL,\n\t\t.psm\t\t= BTD_PROFILE_PSM_AUTO,\n\t\t.mode\t\t= BT_IO_MODE_ERTM,\n\t\t.authorize\t= true,\n\t\t.get_record\t= get_mns_record,\n\t\t.version\t= 0x0102\n\t},\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "settings->name"
          ],
          "line": 2113
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "remote_uuid"
          ],
          "line": 2081
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcasecmp",
          "args": [
            "ext->uuid",
            "settings->uuid"
          ],
          "line": 2073
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "G_N_ELEMENTS",
          "args": [
            "defaults"
          ],
          "line": 2069
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic struct default_settings {\n\tconst char\t*uuid;\n\tconst char\t*name;\n\tint\t\tpriority;\n\tconst char\t*remote_uuid;\n\tint\t\tchannel;\n\tint\t\tpsm;\n\tBtIOMode\tmode;\n\tBtIOSecLevel\tsec_level;\n\tbool\t\tauthorize;\n\tbool\t\tauto_connect;\n\tchar *\t\t(*get_record)(struct ext_profile *ext,\n\t\t\t\t\tstruct ext_io *l2cap,\n\t\t\t\t\tstruct ext_io *rfcomm);\n\tuint16_t\tversion;\n\tuint16_t\tfeatures;\n} defaults[] = {\n\t{\n\t\t.uuid\t\t= SPP_UUID,\n\t\t.name\t\t= \"Serial Port\",\n\t\t.channel\t= SPP_DEFAULT_CHANNEL,\n\t\t.authorize\t= true,\n\t\t.get_record\t= get_spp_record,\n\t\t.version\t= 0x0102,\n\t}, {\n\t\t.uuid\t\t= DUN_GW_UUID,\n\t\t.name\t\t= \"Dial-Up Networking\",\n\t\t.channel\t= DUN_DEFAULT_CHANNEL,\n\t\t.authorize\t= true,\n\t\t.get_record\t= get_dun_record,\n\t\t.version\t= 0x0102,\n\t}, {\n\t\t.uuid\t\t= HFP_HS_UUID,\n\t\t.name\t\t= \"Hands-Free unit\",\n\t\t.priority\t= BTD_PROFILE_PRIORITY_HIGH,\n\t\t.remote_uuid\t= HFP_AG_UUID,\n\t\t.channel\t= HFP_HF_DEFAULT_CHANNEL,\n\t\t.authorize\t= true,\n\t\t.auto_connect\t= true,\n\t\t.get_record\t= get_hfp_hf_record,\n\t\t.version\t= 0x0107,\n\t}, {\n\t\t.uuid\t\t= HFP_AG_UUID,\n\t\t.name\t\t= \"Hands-Free Voice gateway\",\n\t\t.priority\t= BTD_PROFILE_PRIORITY_HIGH,\n\t\t.remote_uuid\t= HFP_HS_UUID,\n\t\t.channel\t= HFP_AG_DEFAULT_CHANNEL,\n\t\t.authorize\t= true,\n\t\t.auto_connect\t= true,\n\t\t.get_record\t= get_hfp_ag_record,\n\t\t.version\t= 0x0107,\n\t}, {\n\t\t.uuid\t\t= HSP_AG_UUID,\n\t\t.name\t\t= \"Headset Voice gateway\",\n\t\t.priority\t= BTD_PROFILE_PRIORITY_HIGH,\n\t\t.remote_uuid\t= HSP_HS_UUID,\n\t\t.channel\t= HSP_AG_DEFAULT_CHANNEL,\n\t\t.authorize\t= true,\n\t\t.auto_connect\t= true,\n\t\t.get_record\t= get_hsp_ag_record,\n\t\t.version\t= 0x0102,\n\t}, {\n\t\t.uuid\t\t= OBEX_OPP_UUID,\n\t\t.name\t\t= \"Object Push\",\n\t\t.channel\t= OPP_DEFAULT_CHANNEL,\n\t\t.psm\t\t= BTD_PROFILE_PSM_AUTO,\n\t\t.mode\t\t= BT_IO_MODE_ERTM,\n\t\t.sec_level\t= BT_IO_SEC_LOW,\n\t\t.authorize\t= false,\n\t\t.get_record\t= get_opp_record,\n\t\t.version\t= 0x0102,\n\t}, {\n\t\t.uuid\t\t= OBEX_FTP_UUID,\n\t\t.name\t\t= \"File Transfer\",\n\t\t.channel\t= FTP_DEFAULT_CHANNEL,\n\t\t.psm\t\t= BTD_PROFILE_PSM_AUTO,\n\t\t.mode\t\t= BT_IO_MODE_ERTM,\n\t\t.authorize\t= true,\n\t\t.get_record\t= get_ftp_record,\n\t\t.version\t= 0x0102,\n\t}, {\n\t\t.uuid\t\t= OBEX_SYNC_UUID,\n\t\t.name\t\t= \"Synchronization\",\n\t\t.channel\t= SYNC_DEFAULT_CHANNEL,\n\t\t.authorize\t= true,\n\t\t.get_record\t= get_sync_record,\n\t\t.version\t= 0x0100,\n\t}, {\n\t\t.uuid\t\t= OBEX_PSE_UUID,\n\t\t.name\t\t= \"Phone Book Access\",\n\t\t.channel\t= PBAP_DEFAULT_CHANNEL,\n\t\t.psm\t\t= BTD_PROFILE_PSM_AUTO,\n\t\t.mode\t\t= BT_IO_MODE_ERTM,\n\t\t.authorize\t= true,\n\t\t.get_record\t= get_pse_record,\n\t\t.version\t= 0x0101,\n\t}, {\n\t\t.uuid\t\t= OBEX_PCE_UUID,\n\t\t.name\t\t= \"Phone Book Access Client\",\n\t\t.remote_uuid\t= OBEX_PSE_UUID,\n\t\t.authorize\t= true,\n\t\t.get_record\t= get_pce_record,\n\t\t.version\t= 0x0102,\n\t}, {\n\t\t.uuid\t\t= OBEX_MAS_UUID,\n\t\t.name\t\t= \"Message Access\",\n\t\t.channel\t= MAS_DEFAULT_CHANNEL,\n\t\t.psm\t\t= BTD_PROFILE_PSM_AUTO,\n\t\t.mode\t\t= BT_IO_MODE_ERTM,\n\t\t.authorize\t= true,\n\t\t.get_record\t= get_mas_record,\n\t\t.version\t= 0x0100\n\t}, {\n\t\t.uuid\t\t= OBEX_MNS_UUID,\n\t\t.name\t\t= \"Message Notification\",\n\t\t.channel\t= MNS_DEFAULT_CHANNEL,\n\t\t.psm\t\t= BTD_PROFILE_PSM_AUTO,\n\t\t.mode\t\t= BT_IO_MODE_ERTM,\n\t\t.authorize\t= true,\n\t\t.get_record\t= get_mns_record,\n\t\t.version\t= 0x0102\n\t},\n};\n\nstatic void ext_set_defaults(struct ext_profile *ext)\n{\n\tunsigned int i;\n\n\text->mode = BT_IO_MODE_BASIC;\n\text->sec_level = BT_IO_SEC_MEDIUM;\n\text->authorize = true;\n\text->enable_client = true;\n\text->enable_server = true;\n\text->remote_uuid = NULL;\n\n\tfor (i = 0; i < G_N_ELEMENTS(defaults); i++) {\n\t\tstruct default_settings *settings = &defaults[i];\n\t\tconst char *remote_uuid;\n\n\t\tif (strcasecmp(ext->uuid, settings->uuid) != 0)\n\t\t\tcontinue;\n\n\t\tif (settings->remote_uuid)\n\t\t\tremote_uuid = settings->remote_uuid;\n\t\telse\n\t\t\tremote_uuid = ext->uuid;\n\n\t\text->remote_uuid = g_strdup(remote_uuid);\n\n\t\tif (settings->channel)\n\t\t\text->local_chan = settings->channel;\n\n\t\tif (settings->psm)\n\t\t\text->local_psm = settings->psm;\n\n\t\tif (settings->sec_level)\n\t\t\text->sec_level = settings->sec_level;\n\n\t\tif (settings->mode)\n\t\t\text->mode = settings->mode;\n\n\t\text->authorize = settings->authorize;\n\n\t\tif (settings->auto_connect)\n\t\t\text->p.auto_connect = true;\n\n\t\tif (settings->priority)\n\t\t\text->p.priority = settings->priority;\n\n\t\tif (settings->get_record)\n\t\t\text->get_record = settings->get_record;\n\n\t\tif (settings->version)\n\t\t\text->version = settings->version;\n\n\t\tif (settings->features)\n\t\t\text->features = settings->features;\n\n\t\tif (settings->name)\n\t\t\text->name = g_strdup(settings->name);\n\t}\n}"
  },
  {
    "function_name": "get_generic_record",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
    "lines": "1891-1932",
    "snippet": "static char *get_generic_record(struct ext_profile *ext, struct ext_io *l2cap,\n\t\t\t\t\t\t\tstruct ext_io *rfcomm)\n{\n\tchar uuid_str[MAX_LEN_UUID_STR], svc_str[MAX_LEN_UUID_STR], psm[30];\n\tchar *rf_seq, *ver_attr, *rec;\n\tuuid_t uuid;\n\n\tbt_string2uuid(&uuid, ext->uuid);\n\tsdp_uuid2strn(&uuid, uuid_str, sizeof(uuid_str));\n\n\tif (ext->service) {\n\t\tbt_string2uuid(&uuid, ext->service);\n\t\tsdp_uuid2strn(&uuid, svc_str, sizeof(svc_str));\n\t} else {\n\t\tstrncpy(svc_str, uuid_str, sizeof(svc_str));\n\t}\n\n\tif (l2cap)\n\t\tsnprintf(psm, sizeof(psm), \"<uint16 value=\\\"0x%04x\\\" />\",\n\t\t\t\t\t\t\t\tl2cap->psm);\n\telse\n\t\tpsm[0] = '\\0';\n\n\tif (rfcomm)\n\t\trf_seq = g_strdup_printf(RFCOMM_SEQ, rfcomm->chan);\n\telse\n\t\trf_seq = g_strdup(\"\");\n\n\tif (ext->version)\n\t\tver_attr = g_strdup_printf(VERSION_ATTR, uuid_str,\n\t\t\t\t\t\t\t\text->version);\n\telse\n\t\tver_attr = g_strdup(\"\");\n\n\trec = g_strdup_printf(GENERIC_RECORD, svc_str, psm, rf_seq, ver_attr,\n\t\t\t\t\t\t\t\text->name);\n\n\tg_free(rf_seq);\n\tg_free(ver_attr);\n\n\treturn rec;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"sdp-xml.h\"",
      "#include \"sdp-client.h\"",
      "#include \"dbus-common.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"btio/btio.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define VERSION_ATTR\t\t\t\t\t\t\t\\\n\t\t\"<attribute id=\\\"0x0009\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"%s\\\" />\t\t\\\n\t\t\t\t\t<uint16 value=\\\"0x%04x\\\" />\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\"",
      "#define RFCOMM_SEQ\t\"<sequence>\t\t\t\t\\\n\t\t\t\t<uuid value=\\\"0x0003\\\" />\t\\\n\t\t\t\t<uint8 value=\\\"0x%02x\\\" />\t\\\n\t\t\t</sequence>\"",
      "#define GENERIC_RECORD\t\t\t\t\t\t\t\\\n\t\"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\" ?>\t\t\t\\\n\t<record>\t\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0001\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<uuid value=\\\"%s\\\" />\t\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0004\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x0100\\\" />\t\\\n\t\t\t\t\t%s\t\t\t\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t\t%s\t\t\t\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0005\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<uuid value=\\\"0x1002\\\" />\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t%s\t\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0100\\\">\t\t\t\t\\\n\t\t\t<text value=\\\"%s\\\" />\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t</record>\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "ver_attr"
          ],
          "line": 1929
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "rf_seq"
          ],
          "line": 1928
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "GENERIC_RECORD",
            "svc_str",
            "psm",
            "rf_seq",
            "ver_attr",
            "ext->name"
          ],
          "line": 1925
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "\"\""
          ],
          "line": 1923
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "VERSION_ATTR",
            "uuid_str",
            "ext->version"
          ],
          "line": 1920
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "\"\""
          ],
          "line": 1917
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "RFCOMM_SEQ",
            "rfcomm->chan"
          ],
          "line": 1915
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "psm",
            "sizeof(psm)",
            "\"<uint16 value=\\\"0x%04x\\\" />\"",
            "l2cap->psm"
          ],
          "line": 1909
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strncpy",
          "args": [
            "svc_str",
            "uuid_str",
            "sizeof(svc_str)"
          ],
          "line": 1905
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_uuid2strn",
          "args": [
            "&uuid",
            "svc_str",
            "sizeof(svc_str)"
          ],
          "line": 1903
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_string2uuid",
          "args": [
            "&uuid",
            "ext->service"
          ],
          "line": 1902
        },
        "resolved": true,
        "details": {
          "function_name": "bt_string2uuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/uuid-helper.c",
          "lines": "211-247",
          "snippet": "int bt_string2uuid(uuid_t *uuid, const char *string)\n{\n\tuint32_t data0, data4;\n\tuint16_t data1, data2, data3, data5;\n\n\tif (is_uuid128(string) &&\n\t\t\tsscanf(string, \"%08x-%04hx-%04hx-%04hx-%08x%04hx\",\n\t\t\t\t&data0, &data1, &data2, &data3, &data4, &data5) == 6) {\n\t\tuint8_t val[16];\n\n\t\tdata0 = htonl(data0);\n\t\tdata1 = htons(data1);\n\t\tdata2 = htons(data2);\n\t\tdata3 = htons(data3);\n\t\tdata4 = htonl(data4);\n\t\tdata5 = htons(data5);\n\n\t\tmemcpy(&val[0], &data0, 4);\n\t\tmemcpy(&val[4], &data1, 2);\n\t\tmemcpy(&val[6], &data2, 2);\n\t\tmemcpy(&val[8], &data3, 2);\n\t\tmemcpy(&val[10], &data4, 4);\n\t\tmemcpy(&val[14], &data5, 2);\n\n\t\tsdp_uuid128_create(uuid, val);\n\n\t\treturn 0;\n\t} else {\n\t\tuint16_t class = name2class(string);\n\t\tif (class) {\n\t\t\tsdp_uuid16_create(uuid, class);\n\t\t\treturn 0;\n\t\t}\n\n\t\treturn string2uuid16(uuid, string);\n\t}\n}",
          "includes": [
            "#include \"uuid-helper.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <arpa/inet.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"uuid-helper.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <arpa/inet.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <config.h>\n\nint bt_string2uuid(uuid_t *uuid, const char *string)\n{\n\tuint32_t data0, data4;\n\tuint16_t data1, data2, data3, data5;\n\n\tif (is_uuid128(string) &&\n\t\t\tsscanf(string, \"%08x-%04hx-%04hx-%04hx-%08x%04hx\",\n\t\t\t\t&data0, &data1, &data2, &data3, &data4, &data5) == 6) {\n\t\tuint8_t val[16];\n\n\t\tdata0 = htonl(data0);\n\t\tdata1 = htons(data1);\n\t\tdata2 = htons(data2);\n\t\tdata3 = htons(data3);\n\t\tdata4 = htonl(data4);\n\t\tdata5 = htons(data5);\n\n\t\tmemcpy(&val[0], &data0, 4);\n\t\tmemcpy(&val[4], &data1, 2);\n\t\tmemcpy(&val[6], &data2, 2);\n\t\tmemcpy(&val[8], &data3, 2);\n\t\tmemcpy(&val[10], &data4, 4);\n\t\tmemcpy(&val[14], &data5, 2);\n\n\t\tsdp_uuid128_create(uuid, val);\n\n\t\treturn 0;\n\t} else {\n\t\tuint16_t class = name2class(string);\n\t\tif (class) {\n\t\t\tsdp_uuid16_create(uuid, class);\n\t\t\treturn 0;\n\t\t}\n\n\t\treturn string2uuid16(uuid, string);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "sdp_uuid2strn",
          "args": [
            "&uuid",
            "uuid_str",
            "sizeof(uuid_str)"
          ],
          "line": 1899
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\n#define VERSION_ATTR\t\t\t\t\t\t\t\\\n\t\t\"<attribute id=\\\"0x0009\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"%s\\\" />\t\t\\\n\t\t\t\t\t<uint16 value=\\\"0x%04x\\\" />\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\"\n#define RFCOMM_SEQ\t\"<sequence>\t\t\t\t\\\n\t\t\t\t<uuid value=\\\"0x0003\\\" />\t\\\n\t\t\t\t<uint8 value=\\\"0x%02x\\\" />\t\\\n\t\t\t</sequence>\"\n#define GENERIC_RECORD\t\t\t\t\t\t\t\\\n\t\"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\" ?>\t\t\t\\\n\t<record>\t\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0001\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<uuid value=\\\"%s\\\" />\t\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0004\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x0100\\\" />\t\\\n\t\t\t\t\t%s\t\t\t\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t\t%s\t\t\t\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0005\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<uuid value=\\\"0x1002\\\" />\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t%s\t\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0100\\\">\t\t\t\t\\\n\t\t\t<text value=\\\"%s\\\" />\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t</record>\"\n\nstatic char *get_generic_record(struct ext_profile *ext, struct ext_io *l2cap,\n\t\t\t\t\t\t\tstruct ext_io *rfcomm)\n{\n\tchar uuid_str[MAX_LEN_UUID_STR], svc_str[MAX_LEN_UUID_STR], psm[30];\n\tchar *rf_seq, *ver_attr, *rec;\n\tuuid_t uuid;\n\n\tbt_string2uuid(&uuid, ext->uuid);\n\tsdp_uuid2strn(&uuid, uuid_str, sizeof(uuid_str));\n\n\tif (ext->service) {\n\t\tbt_string2uuid(&uuid, ext->service);\n\t\tsdp_uuid2strn(&uuid, svc_str, sizeof(svc_str));\n\t} else {\n\t\tstrncpy(svc_str, uuid_str, sizeof(svc_str));\n\t}\n\n\tif (l2cap)\n\t\tsnprintf(psm, sizeof(psm), \"<uint16 value=\\\"0x%04x\\\" />\",\n\t\t\t\t\t\t\t\tl2cap->psm);\n\telse\n\t\tpsm[0] = '\\0';\n\n\tif (rfcomm)\n\t\trf_seq = g_strdup_printf(RFCOMM_SEQ, rfcomm->chan);\n\telse\n\t\trf_seq = g_strdup(\"\");\n\n\tif (ext->version)\n\t\tver_attr = g_strdup_printf(VERSION_ATTR, uuid_str,\n\t\t\t\t\t\t\t\text->version);\n\telse\n\t\tver_attr = g_strdup(\"\");\n\n\trec = g_strdup_printf(GENERIC_RECORD, svc_str, psm, rf_seq, ver_attr,\n\t\t\t\t\t\t\t\text->name);\n\n\tg_free(rf_seq);\n\tg_free(ver_attr);\n\n\treturn rec;\n}"
  },
  {
    "function_name": "get_ftp_record",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
    "lines": "1862-1874",
    "snippet": "static char *get_ftp_record(struct ext_profile *ext, struct ext_io *l2cap,\n\t\t\t\t\t\t\tstruct ext_io *rfcomm)\n{\n\tuint16_t psm = 0;\n\tuint8_t chan = 0;\n\n\tif (l2cap)\n\t\tpsm = l2cap->psm;\n\tif (rfcomm)\n\t\tchan = rfcomm->chan;\n\n\treturn g_strdup_printf(FTP_RECORD, chan, ext->version, psm, ext->name);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"sdp-xml.h\"",
      "#include \"sdp-client.h\"",
      "#include \"dbus-common.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"btio/btio.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define FTP_RECORD\t\t\t\t\t\t\t\\\n\t\"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\" ?>\t\t\t\\\n\t<record>\t\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0001\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<uuid value=\\\"0x1106\\\" />\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0004\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x0100\\\" />\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x0003\\\" />\t\\\n\t\t\t\t\t<uint8 value=\\\"0x%02x\\\" />\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x0008\\\"/>\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0005\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<uuid value=\\\"0x1002\\\" />\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0009\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x1106\\\" />\t\\\n\t\t\t\t\t<uint16 value=\\\"0x%04x\\\" />\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0200\\\">\t\t\t\t\\\n\t\t\t<uint16 value=\\\"%u\\\" name=\\\"psm\\\"/>\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0100\\\">\t\t\t\t\\\n\t\t\t<text value=\\\"%s\\\" />\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t</record>\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "FTP_RECORD",
            "chan",
            "ext->version",
            "psm",
            "ext->name"
          ],
          "line": 1873
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\n#define FTP_RECORD\t\t\t\t\t\t\t\\\n\t\"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\" ?>\t\t\t\\\n\t<record>\t\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0001\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<uuid value=\\\"0x1106\\\" />\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0004\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x0100\\\" />\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x0003\\\" />\t\\\n\t\t\t\t\t<uint8 value=\\\"0x%02x\\\" />\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x0008\\\"/>\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0005\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<uuid value=\\\"0x1002\\\" />\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0009\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x1106\\\" />\t\\\n\t\t\t\t\t<uint16 value=\\\"0x%04x\\\" />\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0200\\\">\t\t\t\t\\\n\t\t\t<uint16 value=\\\"%u\\\" name=\\\"psm\\\"/>\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0100\\\">\t\t\t\t\\\n\t\t\t<text value=\\\"%s\\\" />\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t</record>\"\n\nstatic char *get_ftp_record(struct ext_profile *ext, struct ext_io *l2cap,\n\t\t\t\t\t\t\tstruct ext_io *rfcomm)\n{\n\tuint16_t psm = 0;\n\tuint8_t chan = 0;\n\n\tif (l2cap)\n\t\tpsm = l2cap->psm;\n\tif (rfcomm)\n\t\tchan = rfcomm->chan;\n\n\treturn g_strdup_printf(FTP_RECORD, chan, ext->version, psm, ext->name);\n}"
  },
  {
    "function_name": "get_opp_record",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
    "lines": "1848-1860",
    "snippet": "static char *get_opp_record(struct ext_profile *ext, struct ext_io *l2cap,\n\t\t\t\t\t\t\tstruct ext_io *rfcomm)\n{\n\tuint16_t psm = 0;\n\tuint8_t chan = 0;\n\n\tif (l2cap)\n\t\tpsm = l2cap->psm;\n\tif (rfcomm)\n\t\tchan = rfcomm->chan;\n\n\treturn g_strdup_printf(OPP_RECORD, chan, ext->version, psm, ext->name);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"sdp-xml.h\"",
      "#include \"sdp-client.h\"",
      "#include \"dbus-common.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"btio/btio.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define OPP_RECORD\t\t\t\t\t\t\t\\\n\t\"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\" ?>\t\t\t\\\n\t<record>\t\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0001\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<uuid value=\\\"0x1105\\\" />\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0004\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x0100\\\" />\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x0003\\\" />\t\\\n\t\t\t\t\t<uint8 value=\\\"0x%02x\\\" />\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x0008\\\"/>\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0005\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<uuid value=\\\"0x1002\\\" />\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0009\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x1105\\\" />\t\\\n\t\t\t\t\t<uint16 value=\\\"0x%04x\\\" />\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0303\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<uint8 value=\\\"0x01\\\"/>\t\t\t\\\n\t\t\t\t<uint8 value=\\\"0x02\\\"/>\t\t\t\\\n\t\t\t\t<uint8 value=\\\"0x03\\\"/>\t\t\t\\\n\t\t\t\t<uint8 value=\\\"0x04\\\"/>\t\t\t\\\n\t\t\t\t<uint8 value=\\\"0x05\\\"/>\t\t\t\\\n\t\t\t\t<uint8 value=\\\"0x06\\\"/>\t\t\t\\\n\t\t\t\t<uint8 value=\\\"0xff\\\"/>\t\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0200\\\">\t\t\t\t\\\n\t\t\t<uint16 value=\\\"%u\\\" name=\\\"psm\\\"/>\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0100\\\">\t\t\t\t\\\n\t\t\t<text value=\\\"%s\\\" />\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t</record>\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "OPP_RECORD",
            "chan",
            "ext->version",
            "psm",
            "ext->name"
          ],
          "line": 1859
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\n#define OPP_RECORD\t\t\t\t\t\t\t\\\n\t\"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\" ?>\t\t\t\\\n\t<record>\t\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0001\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<uuid value=\\\"0x1105\\\" />\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0004\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x0100\\\" />\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x0003\\\" />\t\\\n\t\t\t\t\t<uint8 value=\\\"0x%02x\\\" />\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x0008\\\"/>\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0005\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<uuid value=\\\"0x1002\\\" />\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0009\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x1105\\\" />\t\\\n\t\t\t\t\t<uint16 value=\\\"0x%04x\\\" />\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0303\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<uint8 value=\\\"0x01\\\"/>\t\t\t\\\n\t\t\t\t<uint8 value=\\\"0x02\\\"/>\t\t\t\\\n\t\t\t\t<uint8 value=\\\"0x03\\\"/>\t\t\t\\\n\t\t\t\t<uint8 value=\\\"0x04\\\"/>\t\t\t\\\n\t\t\t\t<uint8 value=\\\"0x05\\\"/>\t\t\t\\\n\t\t\t\t<uint8 value=\\\"0x06\\\"/>\t\t\t\\\n\t\t\t\t<uint8 value=\\\"0xff\\\"/>\t\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0200\\\">\t\t\t\t\\\n\t\t\t<uint16 value=\\\"%u\\\" name=\\\"psm\\\"/>\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0100\\\">\t\t\t\t\\\n\t\t\t<text value=\\\"%s\\\" />\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t</record>\"\n\nstatic char *get_opp_record(struct ext_profile *ext, struct ext_io *l2cap,\n\t\t\t\t\t\t\tstruct ext_io *rfcomm)\n{\n\tuint16_t psm = 0;\n\tuint8_t chan = 0;\n\n\tif (l2cap)\n\t\tpsm = l2cap->psm;\n\tif (rfcomm)\n\t\tchan = rfcomm->chan;\n\n\treturn g_strdup_printf(OPP_RECORD, chan, ext->version, psm, ext->name);\n}"
  },
  {
    "function_name": "get_sync_record",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
    "lines": "1841-1846",
    "snippet": "static char *get_sync_record(struct ext_profile *ext, struct ext_io *l2cap,\n\t\t\t\t\t\t\tstruct ext_io *rfcomm)\n{\n\treturn g_strdup_printf(SYNC_RECORD, rfcomm->chan, ext->version,\n\t\t\t\t\t\t\t\text->name);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"sdp-xml.h\"",
      "#include \"sdp-client.h\"",
      "#include \"dbus-common.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"btio/btio.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define SYNC_RECORD\t\t\t\t\t\t\t\\\n\t\"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\" ?>\t\t\t\\\n\t<record>\t\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0001\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<uuid value=\\\"0x1104\\\"/>\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0004\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x0100\\\"/>\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x0003\\\"/>\t\\\n\t\t\t\t\t<uint8 value=\\\"0x%02x\\\"/>\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x0008\\\"/>\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0005\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<uuid value=\\\"0x1002\\\" />\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0009\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x1104\\\"/>\t\\\n\t\t\t\t\t<uint16 value=\\\"0x%04x\\\" />\t\\\n\t\t\t\t </sequence>\t\t\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0100\\\">\t\t\t\t\\\n\t\t\t<text value=\\\"%s\\\"/>\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0301\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<uint8 value=\\\"0x01\\\"/>\t\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t</record>\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "SYNC_RECORD",
            "rfcomm->chan",
            "ext->version",
            "ext->name"
          ],
          "line": 1844
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\n#define SYNC_RECORD\t\t\t\t\t\t\t\\\n\t\"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\" ?>\t\t\t\\\n\t<record>\t\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0001\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<uuid value=\\\"0x1104\\\"/>\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0004\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x0100\\\"/>\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x0003\\\"/>\t\\\n\t\t\t\t\t<uint8 value=\\\"0x%02x\\\"/>\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x0008\\\"/>\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0005\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<uuid value=\\\"0x1002\\\" />\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0009\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x1104\\\"/>\t\\\n\t\t\t\t\t<uint16 value=\\\"0x%04x\\\" />\t\\\n\t\t\t\t </sequence>\t\t\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0100\\\">\t\t\t\t\\\n\t\t\t<text value=\\\"%s\\\"/>\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0301\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<uint8 value=\\\"0x01\\\"/>\t\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t</record>\"\n\nstatic char *get_sync_record(struct ext_profile *ext, struct ext_io *l2cap,\n\t\t\t\t\t\t\tstruct ext_io *rfcomm)\n{\n\treturn g_strdup_printf(SYNC_RECORD, rfcomm->chan, ext->version,\n\t\t\t\t\t\t\t\text->name);\n}"
  },
  {
    "function_name": "get_mns_record",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
    "lines": "1827-1839",
    "snippet": "static char *get_mns_record(struct ext_profile *ext, struct ext_io *l2cap,\n\t\t\t\t\t\t\tstruct ext_io *rfcomm)\n{\n\tuint16_t psm = 0;\n\tuint8_t chan = 0;\n\n\tif (l2cap)\n\t\tpsm = l2cap->psm;\n\tif (rfcomm)\n\t\tchan = rfcomm->chan;\n\n\treturn g_strdup_printf(MNS_RECORD, chan, ext->version, ext->name, psm);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"sdp-xml.h\"",
      "#include \"sdp-client.h\"",
      "#include \"dbus-common.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"btio/btio.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define MNS_RECORD\t\t\t\t\t\t\t\\\n\t\"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\" ?>\t\t\t\\\n\t<record>\t\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0001\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<uuid value=\\\"0x1133\\\"/>\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0004\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x0100\\\"/>\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x0003\\\"/>\t\\\n\t\t\t\t\t<uint8 value=\\\"0x%02x\\\"/>\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x0008\\\"/>\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0005\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<uuid value=\\\"0x1002\\\" />\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0009\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x1134\\\"/>\t\\\n\t\t\t\t\t<uint16 value=\\\"0x%04x\\\"/>\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0100\\\">\t\t\t\t\\\n\t\t\t<text value=\\\"%s\\\"/>\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0317\\\">\t\t\t\t\\\n\t\t\t<uint32 value=\\\"0x0000007f\\\"/>\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0200\\\">\t\t\t\t\\\n\t\t\t<uint16 value=\\\"%u\\\" name=\\\"psm\\\"/>\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t</record>\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "MNS_RECORD",
            "chan",
            "ext->version",
            "ext->name",
            "psm"
          ],
          "line": 1838
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\n#define MNS_RECORD\t\t\t\t\t\t\t\\\n\t\"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\" ?>\t\t\t\\\n\t<record>\t\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0001\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<uuid value=\\\"0x1133\\\"/>\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0004\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x0100\\\"/>\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x0003\\\"/>\t\\\n\t\t\t\t\t<uint8 value=\\\"0x%02x\\\"/>\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x0008\\\"/>\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0005\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<uuid value=\\\"0x1002\\\" />\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0009\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x1134\\\"/>\t\\\n\t\t\t\t\t<uint16 value=\\\"0x%04x\\\"/>\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0100\\\">\t\t\t\t\\\n\t\t\t<text value=\\\"%s\\\"/>\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0317\\\">\t\t\t\t\\\n\t\t\t<uint32 value=\\\"0x0000007f\\\"/>\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0200\\\">\t\t\t\t\\\n\t\t\t<uint16 value=\\\"%u\\\" name=\\\"psm\\\"/>\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t</record>\"\n\nstatic char *get_mns_record(struct ext_profile *ext, struct ext_io *l2cap,\n\t\t\t\t\t\t\tstruct ext_io *rfcomm)\n{\n\tuint16_t psm = 0;\n\tuint8_t chan = 0;\n\n\tif (l2cap)\n\t\tpsm = l2cap->psm;\n\tif (rfcomm)\n\t\tchan = rfcomm->chan;\n\n\treturn g_strdup_printf(MNS_RECORD, chan, ext->version, ext->name, psm);\n}"
  },
  {
    "function_name": "get_mas_record",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
    "lines": "1813-1825",
    "snippet": "static char *get_mas_record(struct ext_profile *ext, struct ext_io *l2cap,\n\t\t\t\t\t\t\tstruct ext_io *rfcomm)\n{\n\tuint16_t psm = 0;\n\tuint8_t chan = 0;\n\n\tif (l2cap)\n\t\tpsm = l2cap->psm;\n\tif (rfcomm)\n\t\tchan = rfcomm->chan;\n\n\treturn g_strdup_printf(MAS_RECORD, chan, ext->version, ext->name, psm);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"sdp-xml.h\"",
      "#include \"sdp-client.h\"",
      "#include \"dbus-common.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"btio/btio.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define MAS_RECORD\t\t\t\t\t\t\t\\\n\t\"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\" ?>\t\t\t\\\n\t<record>\t\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0001\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<uuid value=\\\"0x1132\\\"/>\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0004\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x0100\\\"/>\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x0003\\\"/>\t\\\n\t\t\t\t\t<uint8 value=\\\"0x%02x\\\"/>\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x0008\\\"/>\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0005\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<uuid value=\\\"0x1002\\\" />\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0009\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x1134\\\"/>\t\\\n\t\t\t\t\t<uint16 value=\\\"0x%04x\\\" />\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0100\\\">\t\t\t\t\\\n\t\t\t<text value=\\\"%s\\\"/>\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0315\\\">\t\t\t\t\\\n\t\t\t<uint8 value=\\\"0x00\\\"/>\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0316\\\">\t\t\t\t\\\n\t\t\t<uint8 value=\\\"0x0F\\\"/>\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0317\\\">\t\t\t\t\\\n\t\t\t<uint32 value=\\\"0x0000007f\\\"/>\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0200\\\">\t\t\t\t\\\n\t\t\t<uint16 value=\\\"%u\\\" name=\\\"psm\\\"/>\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t</record>\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "MAS_RECORD",
            "chan",
            "ext->version",
            "ext->name",
            "psm"
          ],
          "line": 1824
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\n#define MAS_RECORD\t\t\t\t\t\t\t\\\n\t\"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\" ?>\t\t\t\\\n\t<record>\t\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0001\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<uuid value=\\\"0x1132\\\"/>\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0004\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x0100\\\"/>\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x0003\\\"/>\t\\\n\t\t\t\t\t<uint8 value=\\\"0x%02x\\\"/>\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x0008\\\"/>\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0005\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<uuid value=\\\"0x1002\\\" />\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0009\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x1134\\\"/>\t\\\n\t\t\t\t\t<uint16 value=\\\"0x%04x\\\" />\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0100\\\">\t\t\t\t\\\n\t\t\t<text value=\\\"%s\\\"/>\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0315\\\">\t\t\t\t\\\n\t\t\t<uint8 value=\\\"0x00\\\"/>\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0316\\\">\t\t\t\t\\\n\t\t\t<uint8 value=\\\"0x0F\\\"/>\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0317\\\">\t\t\t\t\\\n\t\t\t<uint32 value=\\\"0x0000007f\\\"/>\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0200\\\">\t\t\t\t\\\n\t\t\t<uint16 value=\\\"%u\\\" name=\\\"psm\\\"/>\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t</record>\"\n\nstatic char *get_mas_record(struct ext_profile *ext, struct ext_io *l2cap,\n\t\t\t\t\t\t\tstruct ext_io *rfcomm)\n{\n\tuint16_t psm = 0;\n\tuint8_t chan = 0;\n\n\tif (l2cap)\n\t\tpsm = l2cap->psm;\n\tif (rfcomm)\n\t\tchan = rfcomm->chan;\n\n\treturn g_strdup_printf(MAS_RECORD, chan, ext->version, ext->name, psm);\n}"
  },
  {
    "function_name": "get_pse_record",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
    "lines": "1799-1811",
    "snippet": "static char *get_pse_record(struct ext_profile *ext, struct ext_io *l2cap,\n\t\t\t\t\t\t\tstruct ext_io *rfcomm)\n{\n\tuint16_t psm = 0;\n\tuint8_t chan = 0;\n\n\tif (l2cap)\n\t\tpsm = l2cap->psm;\n\tif (rfcomm)\n\t\tchan = rfcomm->chan;\n\n\treturn g_strdup_printf(PSE_RECORD, chan, ext->version, ext->name, psm);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"sdp-xml.h\"",
      "#include \"sdp-client.h\"",
      "#include \"dbus-common.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"btio/btio.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define PSE_RECORD\t\t\t\t\t\t\t\\\n\t\"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\" ?>\t\t\t\\\n\t<record>\t\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0001\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<uuid value=\\\"0x112f\\\" />\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0004\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x0100\\\" />\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x0003\\\" />\t\\\n\t\t\t\t\t<uint8 value=\\\"0x%02x\\\" />\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x0008\\\"/>\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0005\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<uuid value=\\\"0x1002\\\" />\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0009\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x1130\\\" />\t\\\n\t\t\t\t\t<uint16 value=\\\"0x%04x\\\" />\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0100\\\">\t\t\t\t\\\n\t\t\t<text value=\\\"%s\\\" />\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0314\\\">\t\t\t\t\\\n\t\t\t<uint8 value=\\\"0x01\\\"/>\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0317\\\">\t\t\t\t\\\n\t\t\t<uint32 value=\\\"0x00000003\\\"/>\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0200\\\">\t\t\t\t\\\n\t\t\t<uint16 value=\\\"%u\\\" name=\\\"psm\\\"/>\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t</record>\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "PSE_RECORD",
            "chan",
            "ext->version",
            "ext->name",
            "psm"
          ],
          "line": 1810
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\n#define PSE_RECORD\t\t\t\t\t\t\t\\\n\t\"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\" ?>\t\t\t\\\n\t<record>\t\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0001\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<uuid value=\\\"0x112f\\\" />\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0004\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x0100\\\" />\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x0003\\\" />\t\\\n\t\t\t\t\t<uint8 value=\\\"0x%02x\\\" />\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x0008\\\"/>\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0005\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<uuid value=\\\"0x1002\\\" />\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0009\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x1130\\\" />\t\\\n\t\t\t\t\t<uint16 value=\\\"0x%04x\\\" />\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0100\\\">\t\t\t\t\\\n\t\t\t<text value=\\\"%s\\\" />\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0314\\\">\t\t\t\t\\\n\t\t\t<uint8 value=\\\"0x01\\\"/>\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0317\\\">\t\t\t\t\\\n\t\t\t<uint32 value=\\\"0x00000003\\\"/>\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0200\\\">\t\t\t\t\\\n\t\t\t<uint16 value=\\\"%u\\\" name=\\\"psm\\\"/>\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t</record>\"\n\nstatic char *get_pse_record(struct ext_profile *ext, struct ext_io *l2cap,\n\t\t\t\t\t\t\tstruct ext_io *rfcomm)\n{\n\tuint16_t psm = 0;\n\tuint8_t chan = 0;\n\n\tif (l2cap)\n\t\tpsm = l2cap->psm;\n\tif (rfcomm)\n\t\tchan = rfcomm->chan;\n\n\treturn g_strdup_printf(PSE_RECORD, chan, ext->version, ext->name, psm);\n}"
  },
  {
    "function_name": "get_pce_record",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
    "lines": "1793-1797",
    "snippet": "static char *get_pce_record(struct ext_profile *ext, struct ext_io *l2cap,\n\t\t\t\t\t\t\tstruct ext_io *rfcomm)\n{\n\treturn g_strdup_printf(PCE_RECORD, ext->version, ext->name);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"sdp-xml.h\"",
      "#include \"sdp-client.h\"",
      "#include \"dbus-common.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"btio/btio.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define PCE_RECORD\t\t\t\t\t\t\t\\\n\t\"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\" ?>\t\t\t\\\n\t<record>\t\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0001\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<uuid value=\\\"0x112e\\\" />\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0005\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<uuid value=\\\"0x1002\\\" />\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0009\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x1130\\\" />\t\\\n\t\t\t\t\t<uint16 value=\\\"0x%04x\\\" />\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0100\\\">\t\t\t\t\\\n\t\t\t<text value=\\\"%s\\\" />\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t</record>\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "PCE_RECORD",
            "ext->version",
            "ext->name"
          ],
          "line": 1796
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\n#define PCE_RECORD\t\t\t\t\t\t\t\\\n\t\"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\" ?>\t\t\t\\\n\t<record>\t\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0001\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<uuid value=\\\"0x112e\\\" />\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0005\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<uuid value=\\\"0x1002\\\" />\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0009\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x1130\\\" />\t\\\n\t\t\t\t\t<uint16 value=\\\"0x%04x\\\" />\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0100\\\">\t\t\t\t\\\n\t\t\t<text value=\\\"%s\\\" />\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t</record>\"\n\nstatic char *get_pce_record(struct ext_profile *ext, struct ext_io *l2cap,\n\t\t\t\t\t\t\tstruct ext_io *rfcomm)\n{\n\treturn g_strdup_printf(PCE_RECORD, ext->version, ext->name);\n}"
  },
  {
    "function_name": "get_dun_record",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
    "lines": "1786-1791",
    "snippet": "static char *get_dun_record(struct ext_profile *ext, struct ext_io *l2cap,\n\t\t\t\t\t\t\tstruct ext_io *rfcomm)\n{\n\treturn g_strdup_printf(DUN_RECORD, rfcomm->chan, ext->version,\n\t\t\t\t\t\t\t\text->name);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"sdp-xml.h\"",
      "#include \"sdp-client.h\"",
      "#include \"dbus-common.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"btio/btio.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define DUN_RECORD\t\t\t\t\t\t\t\\\n\t\"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\" ?>\t\t\t\\\n\t<record>\t\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0001\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<uuid value=\\\"0x1103\\\" />\t\t\\\n\t\t\t\t<uuid value=\\\"0x1201\\\" />\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0004\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x0100\\\" />\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x0003\\\" />\t\\\n\t\t\t\t\t<uint8 value=\\\"0x%02x\\\" />\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0005\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<uuid value=\\\"0x1002\\\" />\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0009\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x1103\\\" />\t\\\n\t\t\t\t\t<uint16 value=\\\"0x%04x\\\" />\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0100\\\">\t\t\t\t\\\n\t\t\t<text value=\\\"%s\\\" />\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t</record>\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "DUN_RECORD",
            "rfcomm->chan",
            "ext->version",
            "ext->name"
          ],
          "line": 1789
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\n#define DUN_RECORD\t\t\t\t\t\t\t\\\n\t\"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\" ?>\t\t\t\\\n\t<record>\t\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0001\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<uuid value=\\\"0x1103\\\" />\t\t\\\n\t\t\t\t<uuid value=\\\"0x1201\\\" />\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0004\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x0100\\\" />\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x0003\\\" />\t\\\n\t\t\t\t\t<uint8 value=\\\"0x%02x\\\" />\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0005\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<uuid value=\\\"0x1002\\\" />\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0009\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x1103\\\" />\t\\\n\t\t\t\t\t<uint16 value=\\\"0x%04x\\\" />\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0100\\\">\t\t\t\t\\\n\t\t\t<text value=\\\"%s\\\" />\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t</record>\"\n\nstatic char *get_dun_record(struct ext_profile *ext, struct ext_io *l2cap,\n\t\t\t\t\t\t\tstruct ext_io *rfcomm)\n{\n\treturn g_strdup_printf(DUN_RECORD, rfcomm->chan, ext->version,\n\t\t\t\t\t\t\t\text->name);\n}"
  },
  {
    "function_name": "get_spp_record",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
    "lines": "1770-1784",
    "snippet": "static char *get_spp_record(struct ext_profile *ext, struct ext_io *l2cap,\n\t\t\t\t\t\t\tstruct ext_io *rfcomm)\n{\n\tchar *svc, *rec;\n\n\tif (ext->service)\n\t\tsvc = g_strdup_printf(\"<uuid value=\\\"%s\\\" />\", ext->service);\n\telse\n\t\tsvc = g_strdup(\"\");\n\n\trec = g_strdup_printf(SPP_RECORD, svc, rfcomm->chan, ext->version,\n\t\t\t\t\t\t\t\text->name);\n\tg_free(svc);\n\treturn rec;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"sdp-xml.h\"",
      "#include \"sdp-client.h\"",
      "#include \"dbus-common.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"btio/btio.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define SPP_RECORD\t\t\t\t\t\t\t\\\n\t\"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\" ?>\t\t\t\\\n\t<record>\t\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0001\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<uuid value=\\\"0x1101\\\" />\t\t\\\n\t\t\t\t%s\t\t\t\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0004\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x0100\\\" />\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x0003\\\" />\t\\\n\t\t\t\t\t<uint8 value=\\\"0x%02x\\\" />\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0005\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<uuid value=\\\"0x1002\\\" />\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0009\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x1101\\\" />\t\\\n\t\t\t\t\t<uint16 value=\\\"0x%04x\\\" />\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0100\\\">\t\t\t\t\\\n\t\t\t<text value=\\\"%s\\\" />\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t</record>\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "svc"
          ],
          "line": 1782
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "SPP_RECORD",
            "svc",
            "rfcomm->chan",
            "ext->version",
            "ext->name"
          ],
          "line": 1780
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "\"\""
          ],
          "line": 1778
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"<uuid value=\\\"%s\\\" />\"",
            "ext->service"
          ],
          "line": 1776
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\n#define SPP_RECORD\t\t\t\t\t\t\t\\\n\t\"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\" ?>\t\t\t\\\n\t<record>\t\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0001\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<uuid value=\\\"0x1101\\\" />\t\t\\\n\t\t\t\t%s\t\t\t\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0004\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x0100\\\" />\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x0003\\\" />\t\\\n\t\t\t\t\t<uint8 value=\\\"0x%02x\\\" />\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0005\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<uuid value=\\\"0x1002\\\" />\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0009\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x1101\\\" />\t\\\n\t\t\t\t\t<uint16 value=\\\"0x%04x\\\" />\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0100\\\">\t\t\t\t\\\n\t\t\t<text value=\\\"%s\\\" />\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t</record>\"\n\nstatic char *get_spp_record(struct ext_profile *ext, struct ext_io *l2cap,\n\t\t\t\t\t\t\tstruct ext_io *rfcomm)\n{\n\tchar *svc, *rec;\n\n\tif (ext->service)\n\t\tsvc = g_strdup_printf(\"<uuid value=\\\"%s\\\" />\", ext->service);\n\telse\n\t\tsvc = g_strdup(\"\");\n\n\trec = g_strdup_printf(SPP_RECORD, svc, rfcomm->chan, ext->version,\n\t\t\t\t\t\t\t\text->name);\n\tg_free(svc);\n\treturn rec;\n}"
  },
  {
    "function_name": "get_hsp_ag_record",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
    "lines": "1763-1768",
    "snippet": "static char *get_hsp_ag_record(struct ext_profile *ext, struct ext_io *l2cap,\n\t\t\t\t\t\t\tstruct ext_io *rfcomm)\n{\n\treturn g_strdup_printf(HSP_AG_RECORD, rfcomm->chan, ext->version,\n\t\t\t\t\t\text->name);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"sdp-xml.h\"",
      "#include \"sdp-client.h\"",
      "#include \"dbus-common.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"btio/btio.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define HSP_AG_RECORD\t\t\t\t\t\t\t\\\n\t\"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\" ?>\t\t\t\\\n\t<record>\t\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0001\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<uuid value=\\\"0x1112\\\" />\t\t\\\n\t\t\t\t<uuid value=\\\"0x1203\\\" />\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0004\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x0100\\\" />\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x0003\\\" />\t\\\n\t\t\t\t\t<uint8 value=\\\"0x%02x\\\" />\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0005\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<uuid value=\\\"0x1002\\\" />\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0009\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x1108\\\" />\t\\\n\t\t\t\t\t<uint16 value=\\\"0x%04x\\\" />\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0100\\\">\t\t\t\t\\\n\t\t\t<text value=\\\"%s\\\" />\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t</record>\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "HSP_AG_RECORD",
            "rfcomm->chan",
            "ext->version",
            "ext->name"
          ],
          "line": 1766
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\n#define HSP_AG_RECORD\t\t\t\t\t\t\t\\\n\t\"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\" ?>\t\t\t\\\n\t<record>\t\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0001\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<uuid value=\\\"0x1112\\\" />\t\t\\\n\t\t\t\t<uuid value=\\\"0x1203\\\" />\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0004\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x0100\\\" />\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x0003\\\" />\t\\\n\t\t\t\t\t<uint8 value=\\\"0x%02x\\\" />\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0005\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<uuid value=\\\"0x1002\\\" />\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0009\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x1108\\\" />\t\\\n\t\t\t\t\t<uint16 value=\\\"0x%04x\\\" />\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0100\\\">\t\t\t\t\\\n\t\t\t<text value=\\\"%s\\\" />\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t</record>\"\n\nstatic char *get_hsp_ag_record(struct ext_profile *ext, struct ext_io *l2cap,\n\t\t\t\t\t\t\tstruct ext_io *rfcomm)\n{\n\treturn g_strdup_printf(HSP_AG_RECORD, rfcomm->chan, ext->version,\n\t\t\t\t\t\text->name);\n}"
  },
  {
    "function_name": "get_hfp_ag_record",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
    "lines": "1756-1761",
    "snippet": "static char *get_hfp_ag_record(struct ext_profile *ext, struct ext_io *l2cap,\n\t\t\t\t\t\t\tstruct ext_io *rfcomm)\n{\n\treturn g_strdup_printf(HFP_AG_RECORD, rfcomm->chan, ext->version,\n\t\t\t\t\t\text->name, ext->features);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"sdp-xml.h\"",
      "#include \"sdp-client.h\"",
      "#include \"dbus-common.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"btio/btio.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define HFP_AG_RECORD\t\t\t\t\t\t\t\\\n\t\"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\" ?>\t\t\t\\\n\t<record>\t\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0001\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<uuid value=\\\"0x111f\\\" />\t\t\\\n\t\t\t\t<uuid value=\\\"0x1203\\\" />\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0004\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x0100\\\" />\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x0003\\\" />\t\\\n\t\t\t\t\t<uint8 value=\\\"0x%02x\\\" />\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0005\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<uuid value=\\\"0x1002\\\" />\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0009\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x111e\\\" />\t\\\n\t\t\t\t\t<uint16 value=\\\"0x%04x\\\" />\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0100\\\">\t\t\t\t\\\n\t\t\t<text value=\\\"%s\\\" />\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0311\\\">\t\t\t\t\\\n\t\t\t<uint16 value=\\\"0x%04x\\\" />\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0301\\\" >\t\t\t\t\\\n\t\t\t<uint8 value=\\\"0x01\\\" />\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t</record>\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "HFP_AG_RECORD",
            "rfcomm->chan",
            "ext->version",
            "ext->name",
            "ext->features"
          ],
          "line": 1759
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\n#define HFP_AG_RECORD\t\t\t\t\t\t\t\\\n\t\"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\" ?>\t\t\t\\\n\t<record>\t\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0001\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<uuid value=\\\"0x111f\\\" />\t\t\\\n\t\t\t\t<uuid value=\\\"0x1203\\\" />\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0004\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x0100\\\" />\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x0003\\\" />\t\\\n\t\t\t\t\t<uint8 value=\\\"0x%02x\\\" />\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0005\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<uuid value=\\\"0x1002\\\" />\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0009\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x111e\\\" />\t\\\n\t\t\t\t\t<uint16 value=\\\"0x%04x\\\" />\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0100\\\">\t\t\t\t\\\n\t\t\t<text value=\\\"%s\\\" />\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0311\\\">\t\t\t\t\\\n\t\t\t<uint16 value=\\\"0x%04x\\\" />\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0301\\\" >\t\t\t\t\\\n\t\t\t<uint8 value=\\\"0x01\\\" />\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t</record>\"\n\nstatic char *get_hfp_ag_record(struct ext_profile *ext, struct ext_io *l2cap,\n\t\t\t\t\t\t\tstruct ext_io *rfcomm)\n{\n\treturn g_strdup_printf(HFP_AG_RECORD, rfcomm->chan, ext->version,\n\t\t\t\t\t\text->name, ext->features);\n}"
  },
  {
    "function_name": "get_hfp_hf_record",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
    "lines": "1749-1754",
    "snippet": "static char *get_hfp_hf_record(struct ext_profile *ext, struct ext_io *l2cap,\n\t\t\t\t\t\t\tstruct ext_io *rfcomm)\n{\n\treturn g_strdup_printf(HFP_HF_RECORD, rfcomm->chan, ext->version,\n\t\t\t\t\t\text->name, ext->features);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"sdp-xml.h\"",
      "#include \"sdp-client.h\"",
      "#include \"dbus-common.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"btio/btio.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define HFP_HF_RECORD\t\t\t\t\t\t\t\\\n\t\"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\" ?>\t\t\t\\\n\t<record>\t\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0001\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<uuid value=\\\"0x111e\\\" />\t\t\\\n\t\t\t\t<uuid value=\\\"0x1203\\\" />\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0004\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x0100\\\" />\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x0003\\\" />\t\\\n\t\t\t\t\t<uint8 value=\\\"0x%02x\\\" />\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0005\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<uuid value=\\\"0x1002\\\" />\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0009\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x111e\\\" />\t\\\n\t\t\t\t\t<uint16 value=\\\"0x%04x\\\" />\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0100\\\">\t\t\t\t\\\n\t\t\t<text value=\\\"%s\\\" />\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0311\\\">\t\t\t\t\\\n\t\t\t<uint16 value=\\\"0x%04x\\\" />\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t</record>\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "HFP_HF_RECORD",
            "rfcomm->chan",
            "ext->version",
            "ext->name",
            "ext->features"
          ],
          "line": 1752
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\n#define HFP_HF_RECORD\t\t\t\t\t\t\t\\\n\t\"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\" ?>\t\t\t\\\n\t<record>\t\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0001\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<uuid value=\\\"0x111e\\\" />\t\t\\\n\t\t\t\t<uuid value=\\\"0x1203\\\" />\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0004\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x0100\\\" />\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x0003\\\" />\t\\\n\t\t\t\t\t<uint8 value=\\\"0x%02x\\\" />\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0005\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<uuid value=\\\"0x1002\\\" />\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0009\\\">\t\t\t\t\\\n\t\t\t<sequence>\t\t\t\t\t\\\n\t\t\t\t<sequence>\t\t\t\t\\\n\t\t\t\t\t<uuid value=\\\"0x111e\\\" />\t\\\n\t\t\t\t\t<uint16 value=\\\"0x%04x\\\" />\t\\\n\t\t\t\t</sequence>\t\t\t\t\\\n\t\t\t</sequence>\t\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0100\\\">\t\t\t\t\\\n\t\t\t<text value=\\\"%s\\\" />\t\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t\t<attribute id=\\\"0x0311\\\">\t\t\t\t\\\n\t\t\t<uint16 value=\\\"0x%04x\\\" />\t\t\t\\\n\t\t</attribute>\t\t\t\t\t\t\\\n\t</record>\"\n\nstatic char *get_hfp_hf_record(struct ext_profile *ext, struct ext_io *l2cap,\n\t\t\t\t\t\t\tstruct ext_io *rfcomm)\n{\n\treturn g_strdup_printf(HFP_HF_RECORD, rfcomm->chan, ext->version,\n\t\t\t\t\t\text->name, ext->features);\n}"
  },
  {
    "function_name": "ext_disconnect_dev",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
    "lines": "1723-1747",
    "snippet": "static int ext_disconnect_dev(struct btd_service *service)\n{\n\tstruct btd_device *dev = btd_service_get_device(service);\n\tstruct btd_profile *profile = btd_service_get_profile(service);\n\tstruct ext_profile *ext;\n\tstruct ext_io *conn;\n\tint err;\n\n\text = find_ext(profile);\n\tif (!ext)\n\t\treturn -ENOENT;\n\n\tconn = find_connection(ext, dev);\n\tif (!conn || !conn->connected)\n\t\treturn -ENOTCONN;\n\n\tif (conn->pending)\n\t\treturn -EBUSY;\n\n\terr = send_disconn_req(ext, conn);\n\tif (err < 0)\n\t\treturn err;\n\n\treturn 0;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"sdp-xml.h\"",
      "#include \"sdp-client.h\"",
      "#include \"dbus-common.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"btio/btio.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "send_disconn_req",
          "args": [
            "ext",
            "conn"
          ],
          "line": 1742
        },
        "resolved": true,
        "details": {
          "function_name": "send_disconn_req",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
          "lines": "1691-1721",
          "snippet": "static int send_disconn_req(struct ext_profile *ext, struct ext_io *conn)\n{\n\tDBusMessage *msg;\n\tconst char *path;\n\n\tmsg = dbus_message_new_method_call(ext->owner, ext->path,\n\t\t\t\t\t\t\"org.bluez.Profile1\",\n\t\t\t\t\t\t\"RequestDisconnection\");\n\tif (!msg) {\n\t\terror(\"Unable to create RequestDisconnection call for %s\",\n\t\t\t\t\t\t\t\text->name);\n\t\treturn -ENOMEM;\n\t}\n\n\tpath = device_get_path(conn->device);\n\tdbus_message_append_args(msg, DBUS_TYPE_OBJECT_PATH, &path,\n\t\t\t\t\t\t\tDBUS_TYPE_INVALID);\n\n\tif (!g_dbus_send_message_with_reply(btd_get_dbus_connection(),\n\t\t\t\t\t\tmsg, &conn->pending, -1)) {\n\t\terror(\"%s: sending RequestDisconnection failed\", ext->name);\n\t\tdbus_message_unref(msg);\n\t\treturn -EIO;\n\t}\n\n\tdbus_message_unref(msg);\n\n\tdbus_pending_call_set_notify(conn->pending, disconn_reply, conn, NULL);\n\n\treturn 0;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdp-xml.h\"",
            "#include \"sdp-client.h\"",
            "#include \"dbus-common.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"btio/btio.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic int send_disconn_req(struct ext_profile *ext, struct ext_io *conn)\n{\n\tDBusMessage *msg;\n\tconst char *path;\n\n\tmsg = dbus_message_new_method_call(ext->owner, ext->path,\n\t\t\t\t\t\t\"org.bluez.Profile1\",\n\t\t\t\t\t\t\"RequestDisconnection\");\n\tif (!msg) {\n\t\terror(\"Unable to create RequestDisconnection call for %s\",\n\t\t\t\t\t\t\t\text->name);\n\t\treturn -ENOMEM;\n\t}\n\n\tpath = device_get_path(conn->device);\n\tdbus_message_append_args(msg, DBUS_TYPE_OBJECT_PATH, &path,\n\t\t\t\t\t\t\tDBUS_TYPE_INVALID);\n\n\tif (!g_dbus_send_message_with_reply(btd_get_dbus_connection(),\n\t\t\t\t\t\tmsg, &conn->pending, -1)) {\n\t\terror(\"%s: sending RequestDisconnection failed\", ext->name);\n\t\tdbus_message_unref(msg);\n\t\treturn -EIO;\n\t}\n\n\tdbus_message_unref(msg);\n\n\tdbus_pending_call_set_notify(conn->pending, disconn_reply, conn, NULL);\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "find_connection",
          "args": [
            "ext",
            "dev"
          ],
          "line": 1735
        },
        "resolved": true,
        "details": {
          "function_name": "find_connection",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
          "lines": "1459-1472",
          "snippet": "static struct ext_io *find_connection(struct ext_profile *ext,\n\t\t\t\t\t\t\tstruct btd_device *dev)\n{\n\tGSList *l;\n\n\tfor (l = ext->conns; l != NULL; l = g_slist_next(l)) {\n\t\tstruct ext_io *conn = l->data;\n\n\t\tif (conn->device == dev)\n\t\t\treturn conn;\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdp-xml.h\"",
            "#include \"sdp-client.h\"",
            "#include \"dbus-common.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"btio/btio.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic struct ext_io *find_connection(struct ext_profile *ext,\n\t\t\t\t\t\t\tstruct btd_device *dev)\n{\n\tGSList *l;\n\n\tfor (l = ext->conns; l != NULL; l = g_slist_next(l)) {\n\t\tstruct ext_io *conn = l->data;\n\n\t\tif (conn->device == dev)\n\t\t\treturn conn;\n\t}\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "find_ext",
          "args": [
            "profile"
          ],
          "line": 1731
        },
        "resolved": true,
        "details": {
          "function_name": "find_ext",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
          "lines": "1360-1369",
          "snippet": "static struct ext_profile *find_ext(struct btd_profile *p)\n{\n\tGSList *l;\n\n\tl = g_slist_find(ext_profiles, p);\n\tif (!l)\n\t\treturn NULL;\n\n\treturn l->data;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdp-xml.h\"",
            "#include \"sdp-client.h\"",
            "#include \"dbus-common.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"btio/btio.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static GSList *ext_profiles = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic GSList *ext_profiles = NULL;\n\nstatic struct ext_profile *find_ext(struct btd_profile *p)\n{\n\tGSList *l;\n\n\tl = g_slist_find(ext_profiles, p);\n\tif (!l)\n\t\treturn NULL;\n\n\treturn l->data;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_service_get_profile",
          "args": [
            "service"
          ],
          "line": 1726
        },
        "resolved": true,
        "details": {
          "function_name": "btd_service_get_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
          "lines": "316-319",
          "snippet": "struct btd_profile *btd_service_get_profile(const struct btd_service *service)\n{\n\treturn service->profile;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/stat.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstruct btd_profile *btd_service_get_profile(const struct btd_service *service)\n{\n\treturn service->profile;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_service_get_device",
          "args": [
            "service"
          ],
          "line": 1725
        },
        "resolved": true,
        "details": {
          "function_name": "btd_service_get_device",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
          "lines": "311-314",
          "snippet": "struct btd_device *btd_service_get_device(const struct btd_service *service)\n{\n\treturn service->device;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/stat.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstruct btd_device *btd_service_get_device(const struct btd_service *service)\n{\n\treturn service->device;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic int ext_disconnect_dev(struct btd_service *service)\n{\n\tstruct btd_device *dev = btd_service_get_device(service);\n\tstruct btd_profile *profile = btd_service_get_profile(service);\n\tstruct ext_profile *ext;\n\tstruct ext_io *conn;\n\tint err;\n\n\text = find_ext(profile);\n\tif (!ext)\n\t\treturn -ENOENT;\n\n\tconn = find_connection(ext, dev);\n\tif (!conn || !conn->connected)\n\t\treturn -ENOTCONN;\n\n\tif (conn->pending)\n\t\treturn -EBUSY;\n\n\terr = send_disconn_req(ext, conn);\n\tif (err < 0)\n\t\treturn err;\n\n\treturn 0;\n}"
  },
  {
    "function_name": "send_disconn_req",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
    "lines": "1691-1721",
    "snippet": "static int send_disconn_req(struct ext_profile *ext, struct ext_io *conn)\n{\n\tDBusMessage *msg;\n\tconst char *path;\n\n\tmsg = dbus_message_new_method_call(ext->owner, ext->path,\n\t\t\t\t\t\t\"org.bluez.Profile1\",\n\t\t\t\t\t\t\"RequestDisconnection\");\n\tif (!msg) {\n\t\terror(\"Unable to create RequestDisconnection call for %s\",\n\t\t\t\t\t\t\t\text->name);\n\t\treturn -ENOMEM;\n\t}\n\n\tpath = device_get_path(conn->device);\n\tdbus_message_append_args(msg, DBUS_TYPE_OBJECT_PATH, &path,\n\t\t\t\t\t\t\tDBUS_TYPE_INVALID);\n\n\tif (!g_dbus_send_message_with_reply(btd_get_dbus_connection(),\n\t\t\t\t\t\tmsg, &conn->pending, -1)) {\n\t\terror(\"%s: sending RequestDisconnection failed\", ext->name);\n\t\tdbus_message_unref(msg);\n\t\treturn -EIO;\n\t}\n\n\tdbus_message_unref(msg);\n\n\tdbus_pending_call_set_notify(conn->pending, disconn_reply, conn, NULL);\n\n\treturn 0;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"sdp-xml.h\"",
      "#include \"sdp-client.h\"",
      "#include \"dbus-common.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"btio/btio.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_pending_call_set_notify",
          "args": [
            "conn->pending",
            "disconn_reply",
            "conn",
            "NULL"
          ],
          "line": 1718
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_unref",
          "args": [
            "msg"
          ],
          "line": 1716
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_unref",
          "args": [
            "msg"
          ],
          "line": 1712
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"%s: sending RequestDisconnection failed\"",
            "ext->name"
          ],
          "line": 1711
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "124-128",
          "snippet": "DBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_send_message_with_reply",
          "args": [
            "btd_get_dbus_connection()",
            "msg",
            "&conn->pending",
            "-1"
          ],
          "line": 1709
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_get_dbus_connection",
          "args": [],
          "line": 1709
        },
        "resolved": true,
        "details": {
          "function_name": "btd_get_dbus_connection",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/dbus-common.c",
          "lines": "61-64",
          "snippet": "DBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *connection = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *connection = NULL;\n\nDBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_append_args",
          "args": [
            "msg",
            "DBUS_TYPE_OBJECT_PATH",
            "&path",
            "DBUS_TYPE_INVALID"
          ],
          "line": 1706
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device_get_path",
          "args": [
            "conn->device"
          ],
          "line": 1705
        },
        "resolved": true,
        "details": {
          "function_name": "device_get_path",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5323-5329",
          "snippet": "const char *device_get_path(const struct btd_device *device)\n{\n\tif (!device)\n\t\treturn NULL;\n\n\treturn device->path;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nconst char *device_get_path(const struct btd_device *device)\n{\n\tif (!device)\n\t\treturn NULL;\n\n\treturn device->path;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_new_method_call",
          "args": [
            "ext->owner",
            "ext->path",
            "\"org.bluez.Profile1\"",
            "\"RequestDisconnection\""
          ],
          "line": 1696
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic int send_disconn_req(struct ext_profile *ext, struct ext_io *conn)\n{\n\tDBusMessage *msg;\n\tconst char *path;\n\n\tmsg = dbus_message_new_method_call(ext->owner, ext->path,\n\t\t\t\t\t\t\"org.bluez.Profile1\",\n\t\t\t\t\t\t\"RequestDisconnection\");\n\tif (!msg) {\n\t\terror(\"Unable to create RequestDisconnection call for %s\",\n\t\t\t\t\t\t\t\text->name);\n\t\treturn -ENOMEM;\n\t}\n\n\tpath = device_get_path(conn->device);\n\tdbus_message_append_args(msg, DBUS_TYPE_OBJECT_PATH, &path,\n\t\t\t\t\t\t\tDBUS_TYPE_INVALID);\n\n\tif (!g_dbus_send_message_with_reply(btd_get_dbus_connection(),\n\t\t\t\t\t\tmsg, &conn->pending, -1)) {\n\t\terror(\"%s: sending RequestDisconnection failed\", ext->name);\n\t\tdbus_message_unref(msg);\n\t\treturn -EIO;\n\t}\n\n\tdbus_message_unref(msg);\n\n\tdbus_pending_call_set_notify(conn->pending, disconn_reply, conn, NULL);\n\n\treturn 0;\n}"
  },
  {
    "function_name": "ext_connect_dev",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
    "lines": "1643-1689",
    "snippet": "static int ext_connect_dev(struct btd_service *service)\n{\n\tstruct btd_device *dev = btd_service_get_device(service);\n\tstruct btd_profile *profile = btd_service_get_profile(service);\n\tstruct btd_adapter *adapter;\n\tstruct ext_io *conn;\n\tstruct ext_profile *ext;\n\tint err;\n\n\text = find_ext(profile);\n\tif (!ext)\n\t\treturn -ENOENT;\n\n\tconn = find_connection(ext, dev);\n\tif (conn)\n\t\treturn -EALREADY;\n\n\tadapter = device_get_adapter(dev);\n\n\tconn = g_new0(struct ext_io, 1);\n\tconn->ext = ext;\n\n\tif (ext->remote_psm || ext->remote_chan) {\n\t\tconn->psm = ext->remote_psm;\n\t\tconn->chan = ext->remote_chan;\n\t\terr = connect_io(conn, btd_adapter_get_address(adapter),\n\t\t\t\t\t\tdevice_get_address(dev));\n\t} else {\n\t\terr = resolve_service(conn, btd_adapter_get_address(adapter),\n\t\t\t\t\t\tdevice_get_address(dev));\n\t}\n\n\tif (err < 0)\n\t\tgoto failed;\n\n\tconn->adapter = btd_adapter_ref(adapter);\n\tconn->device = btd_device_ref(dev);\n\tconn->service = btd_service_ref(service);\n\n\text->conns = g_slist_append(ext->conns, conn);\n\n\treturn 0;\n\nfailed:\n\tg_free(conn);\n\treturn err;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"sdp-xml.h\"",
      "#include \"sdp-client.h\"",
      "#include \"dbus-common.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"btio/btio.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "conn"
          ],
          "line": 1687
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_append",
          "args": [
            "ext->conns",
            "conn"
          ],
          "line": 1682
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_service_ref",
          "args": [
            "service"
          ],
          "line": 1680
        },
        "resolved": true,
        "details": {
          "function_name": "btd_service_ref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
          "lines": "113-120",
          "snippet": "struct btd_service *btd_service_ref(struct btd_service *service)\n{\n\tservice->ref++;\n\n\tDBG(\"%p: ref=%d\", service, service->ref);\n\n\treturn service;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/stat.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstruct btd_service *btd_service_ref(struct btd_service *service)\n{\n\tservice->ref++;\n\n\tDBG(\"%p: ref=%d\", service, service->ref);\n\n\treturn service;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_device_ref",
          "args": [
            "dev"
          ],
          "line": 1679
        },
        "resolved": true,
        "details": {
          "function_name": "btd_device_ref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "6357-6362",
          "snippet": "struct btd_device *btd_device_ref(struct btd_device *device)\n{\n\t__sync_fetch_and_add(&device->ref_count, 1);\n\n\treturn device;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstruct btd_device *btd_device_ref(struct btd_device *device)\n{\n\t__sync_fetch_and_add(&device->ref_count, 1);\n\n\treturn device;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_adapter_ref",
          "args": [
            "adapter"
          ],
          "line": 1678
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_ref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "4898-4903",
          "snippet": "struct btd_adapter *btd_adapter_ref(struct btd_adapter *adapter)\n{\n\t__sync_fetch_and_add(&adapter->ref_count, 1);\n\n\treturn adapter;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nstruct btd_adapter *btd_adapter_ref(struct btd_adapter *adapter)\n{\n\t__sync_fetch_and_add(&adapter->ref_count, 1);\n\n\treturn adapter;\n}"
        }
      },
      {
        "call_info": {
          "callee": "resolve_service",
          "args": [
            "conn",
            "btd_adapter_get_address(adapter)",
            "device_get_address(dev)"
          ],
          "line": 1671
        },
        "resolved": true,
        "details": {
          "function_name": "resolve_service",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
          "lines": "1626-1641",
          "snippet": "static int resolve_service(struct ext_io *conn, const bdaddr_t *src,\n\t\t\t\t\t\t\tconst bdaddr_t *dst)\n{\n\tstruct ext_profile *ext = conn->ext;\n\tuuid_t uuid;\n\tint err;\n\n\tbt_string2uuid(&uuid, ext->remote_uuid);\n\tsdp_uuid128_to_uuid(&uuid);\n\n\terr = bt_search_service(src, dst, &uuid, record_cb, conn, NULL, 0);\n\tif (err == 0)\n\t\tconn->resolving = true;\n\n\treturn err;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdp-xml.h\"",
            "#include \"sdp-client.h\"",
            "#include \"dbus-common.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"btio/btio.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic int resolve_service(struct ext_io *conn, const bdaddr_t *src,\n\t\t\t\t\t\t\tconst bdaddr_t *dst)\n{\n\tstruct ext_profile *ext = conn->ext;\n\tuuid_t uuid;\n\tint err;\n\n\tbt_string2uuid(&uuid, ext->remote_uuid);\n\tsdp_uuid128_to_uuid(&uuid);\n\n\terr = bt_search_service(src, dst, &uuid, record_cb, conn, NULL, 0);\n\tif (err == 0)\n\t\tconn->resolving = true;\n\n\treturn err;\n}"
        }
      },
      {
        "call_info": {
          "callee": "device_get_address",
          "args": [
            "dev"
          ],
          "line": 1672
        },
        "resolved": true,
        "details": {
          "function_name": "device_get_address",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5314-5317",
          "snippet": "const bdaddr_t *device_get_address(struct btd_device *device)\n{\n\treturn &device->bdaddr;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nconst bdaddr_t *device_get_address(struct btd_device *device)\n{\n\treturn &device->bdaddr;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_adapter_get_address",
          "args": [
            "adapter"
          ],
          "line": 1671
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_get_address",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "5881-5884",
          "snippet": "const bdaddr_t *btd_adapter_get_address(struct btd_adapter *adapter)\n{\n\treturn &adapter->bdaddr;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nconst bdaddr_t *btd_adapter_get_address(struct btd_adapter *adapter)\n{\n\treturn &adapter->bdaddr;\n}"
        }
      },
      {
        "call_info": {
          "callee": "connect_io",
          "args": [
            "conn",
            "btd_adapter_get_address(adapter)",
            "device_get_address(dev)"
          ],
          "line": 1668
        },
        "resolved": true,
        "details": {
          "function_name": "connect_io",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
          "lines": "1494-1528",
          "snippet": "static int connect_io(struct ext_io *conn, const bdaddr_t *src,\n\t\t\t\t\t\t\tconst bdaddr_t *dst)\n{\n\tstruct ext_profile *ext = conn->ext;\n\tGError *gerr = NULL;\n\tGIOChannel *io;\n\n\tif (conn->psm) {\n\t\tconn->proto = BTPROTO_L2CAP;\n\t\tio = bt_io_connect(ext_connect, conn, NULL, &gerr,\n\t\t\t\t\tBT_IO_OPT_SOURCE_BDADDR, src,\n\t\t\t\t\tBT_IO_OPT_DEST_BDADDR, dst,\n\t\t\t\t\tBT_IO_OPT_SEC_LEVEL, ext->sec_level,\n\t\t\t\t\tBT_IO_OPT_PSM, conn->psm,\n\t\t\t\t\tBT_IO_OPT_INVALID);\n\t} else {\n\t\tconn->proto = BTPROTO_RFCOMM;\n\t\tio = bt_io_connect(ext_connect, conn, NULL, &gerr,\n\t\t\t\t\tBT_IO_OPT_SOURCE_BDADDR, src,\n\t\t\t\t\tBT_IO_OPT_DEST_BDADDR, dst,\n\t\t\t\t\tBT_IO_OPT_SEC_LEVEL, ext->sec_level,\n\t\t\t\t\tBT_IO_OPT_CHANNEL, conn->chan,\n\t\t\t\t\tBT_IO_OPT_INVALID);\n\t}\n\n\tif (gerr != NULL) {\n\t\terror(\"Unable to connect %s: %s\", ext->name, gerr->message);\n\t\tg_error_free(gerr);\n\t\treturn -EIO;\n\t}\n\n\tconn->io = io;\n\n\treturn 0;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdp-xml.h\"",
            "#include \"sdp-client.h\"",
            "#include \"dbus-common.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"btio/btio.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic int connect_io(struct ext_io *conn, const bdaddr_t *src,\n\t\t\t\t\t\t\tconst bdaddr_t *dst)\n{\n\tstruct ext_profile *ext = conn->ext;\n\tGError *gerr = NULL;\n\tGIOChannel *io;\n\n\tif (conn->psm) {\n\t\tconn->proto = BTPROTO_L2CAP;\n\t\tio = bt_io_connect(ext_connect, conn, NULL, &gerr,\n\t\t\t\t\tBT_IO_OPT_SOURCE_BDADDR, src,\n\t\t\t\t\tBT_IO_OPT_DEST_BDADDR, dst,\n\t\t\t\t\tBT_IO_OPT_SEC_LEVEL, ext->sec_level,\n\t\t\t\t\tBT_IO_OPT_PSM, conn->psm,\n\t\t\t\t\tBT_IO_OPT_INVALID);\n\t} else {\n\t\tconn->proto = BTPROTO_RFCOMM;\n\t\tio = bt_io_connect(ext_connect, conn, NULL, &gerr,\n\t\t\t\t\tBT_IO_OPT_SOURCE_BDADDR, src,\n\t\t\t\t\tBT_IO_OPT_DEST_BDADDR, dst,\n\t\t\t\t\tBT_IO_OPT_SEC_LEVEL, ext->sec_level,\n\t\t\t\t\tBT_IO_OPT_CHANNEL, conn->chan,\n\t\t\t\t\tBT_IO_OPT_INVALID);\n\t}\n\n\tif (gerr != NULL) {\n\t\terror(\"Unable to connect %s: %s\", ext->name, gerr->message);\n\t\tg_error_free(gerr);\n\t\treturn -EIO;\n\t}\n\n\tconn->io = io;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_new0",
          "args": [
            "structext_io",
            "1"
          ],
          "line": 1662
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device_get_adapter",
          "args": [
            "dev"
          ],
          "line": 1660
        },
        "resolved": true,
        "details": {
          "function_name": "device_get_adapter",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5306-5312",
          "snippet": "struct btd_adapter *device_get_adapter(struct btd_device *device)\n{\n\tif (!device)\n\t\treturn NULL;\n\n\treturn device->adapter;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstruct btd_adapter *device_get_adapter(struct btd_device *device)\n{\n\tif (!device)\n\t\treturn NULL;\n\n\treturn device->adapter;\n}"
        }
      },
      {
        "call_info": {
          "callee": "find_connection",
          "args": [
            "ext",
            "dev"
          ],
          "line": 1656
        },
        "resolved": true,
        "details": {
          "function_name": "find_connection",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
          "lines": "1459-1472",
          "snippet": "static struct ext_io *find_connection(struct ext_profile *ext,\n\t\t\t\t\t\t\tstruct btd_device *dev)\n{\n\tGSList *l;\n\n\tfor (l = ext->conns; l != NULL; l = g_slist_next(l)) {\n\t\tstruct ext_io *conn = l->data;\n\n\t\tif (conn->device == dev)\n\t\t\treturn conn;\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdp-xml.h\"",
            "#include \"sdp-client.h\"",
            "#include \"dbus-common.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"btio/btio.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic struct ext_io *find_connection(struct ext_profile *ext,\n\t\t\t\t\t\t\tstruct btd_device *dev)\n{\n\tGSList *l;\n\n\tfor (l = ext->conns; l != NULL; l = g_slist_next(l)) {\n\t\tstruct ext_io *conn = l->data;\n\n\t\tif (conn->device == dev)\n\t\t\treturn conn;\n\t}\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "find_ext",
          "args": [
            "profile"
          ],
          "line": 1652
        },
        "resolved": true,
        "details": {
          "function_name": "find_ext",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
          "lines": "1360-1369",
          "snippet": "static struct ext_profile *find_ext(struct btd_profile *p)\n{\n\tGSList *l;\n\n\tl = g_slist_find(ext_profiles, p);\n\tif (!l)\n\t\treturn NULL;\n\n\treturn l->data;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdp-xml.h\"",
            "#include \"sdp-client.h\"",
            "#include \"dbus-common.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"btio/btio.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static GSList *ext_profiles = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic GSList *ext_profiles = NULL;\n\nstatic struct ext_profile *find_ext(struct btd_profile *p)\n{\n\tGSList *l;\n\n\tl = g_slist_find(ext_profiles, p);\n\tif (!l)\n\t\treturn NULL;\n\n\treturn l->data;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_service_get_profile",
          "args": [
            "service"
          ],
          "line": 1646
        },
        "resolved": true,
        "details": {
          "function_name": "btd_service_get_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
          "lines": "316-319",
          "snippet": "struct btd_profile *btd_service_get_profile(const struct btd_service *service)\n{\n\treturn service->profile;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/stat.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstruct btd_profile *btd_service_get_profile(const struct btd_service *service)\n{\n\treturn service->profile;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_service_get_device",
          "args": [
            "service"
          ],
          "line": 1645
        },
        "resolved": true,
        "details": {
          "function_name": "btd_service_get_device",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
          "lines": "311-314",
          "snippet": "struct btd_device *btd_service_get_device(const struct btd_service *service)\n{\n\treturn service->device;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/stat.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstruct btd_device *btd_service_get_device(const struct btd_service *service)\n{\n\treturn service->device;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic int ext_connect_dev(struct btd_service *service)\n{\n\tstruct btd_device *dev = btd_service_get_device(service);\n\tstruct btd_profile *profile = btd_service_get_profile(service);\n\tstruct btd_adapter *adapter;\n\tstruct ext_io *conn;\n\tstruct ext_profile *ext;\n\tint err;\n\n\text = find_ext(profile);\n\tif (!ext)\n\t\treturn -ENOENT;\n\n\tconn = find_connection(ext, dev);\n\tif (conn)\n\t\treturn -EALREADY;\n\n\tadapter = device_get_adapter(dev);\n\n\tconn = g_new0(struct ext_io, 1);\n\tconn->ext = ext;\n\n\tif (ext->remote_psm || ext->remote_chan) {\n\t\tconn->psm = ext->remote_psm;\n\t\tconn->chan = ext->remote_chan;\n\t\terr = connect_io(conn, btd_adapter_get_address(adapter),\n\t\t\t\t\t\tdevice_get_address(dev));\n\t} else {\n\t\terr = resolve_service(conn, btd_adapter_get_address(adapter),\n\t\t\t\t\t\tdevice_get_address(dev));\n\t}\n\n\tif (err < 0)\n\t\tgoto failed;\n\n\tconn->adapter = btd_adapter_ref(adapter);\n\tconn->device = btd_device_ref(dev);\n\tconn->service = btd_service_ref(service);\n\n\text->conns = g_slist_append(ext->conns, conn);\n\n\treturn 0;\n\nfailed:\n\tg_free(conn);\n\treturn err;\n}"
  },
  {
    "function_name": "resolve_service",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
    "lines": "1626-1641",
    "snippet": "static int resolve_service(struct ext_io *conn, const bdaddr_t *src,\n\t\t\t\t\t\t\tconst bdaddr_t *dst)\n{\n\tstruct ext_profile *ext = conn->ext;\n\tuuid_t uuid;\n\tint err;\n\n\tbt_string2uuid(&uuid, ext->remote_uuid);\n\tsdp_uuid128_to_uuid(&uuid);\n\n\terr = bt_search_service(src, dst, &uuid, record_cb, conn, NULL, 0);\n\tif (err == 0)\n\t\tconn->resolving = true;\n\n\treturn err;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"sdp-xml.h\"",
      "#include \"sdp-client.h\"",
      "#include \"dbus-common.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"btio/btio.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bt_search_service",
          "args": [
            "src",
            "dst",
            "&uuid",
            "record_cb",
            "conn",
            "NULL",
            "0"
          ],
          "line": 1636
        },
        "resolved": true,
        "details": {
          "function_name": "bt_search_service",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdp-client.c",
          "lines": "341-362",
          "snippet": "int bt_search_service(const bdaddr_t *src, const bdaddr_t *dst,\n\t\t\tuuid_t *uuid, bt_callback_t cb, void *user_data,\n\t\t\tbt_destroy_t destroy, uint16_t flags)\n{\n\tstruct search_context *ctxt = NULL;\n\tint err;\n\n\tif (!cb)\n\t\treturn -EINVAL;\n\n\terr = create_search_context(&ctxt, src, dst, uuid, flags);\n\tif (err < 0)\n\t\treturn err;\n\n\tctxt->cb\t= cb;\n\tctxt->destroy\t= destroy;\n\tctxt->user_data\t= user_data;\n\n\tcontext_list = g_slist_append(context_list, ctxt);\n\n\treturn 0;\n}",
          "includes": [
            "#include \"sdp-client.h\"",
            "#include \"log.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static GSList *context_list = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"sdp-client.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nstatic GSList *context_list = NULL;\n\nint bt_search_service(const bdaddr_t *src, const bdaddr_t *dst,\n\t\t\tuuid_t *uuid, bt_callback_t cb, void *user_data,\n\t\t\tbt_destroy_t destroy, uint16_t flags)\n{\n\tstruct search_context *ctxt = NULL;\n\tint err;\n\n\tif (!cb)\n\t\treturn -EINVAL;\n\n\terr = create_search_context(&ctxt, src, dst, uuid, flags);\n\tif (err < 0)\n\t\treturn err;\n\n\tctxt->cb\t= cb;\n\tctxt->destroy\t= destroy;\n\tctxt->user_data\t= user_data;\n\n\tcontext_list = g_slist_append(context_list, ctxt);\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sdp_uuid128_to_uuid",
          "args": [
            "&uuid"
          ],
          "line": 1634
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_string2uuid",
          "args": [
            "&uuid",
            "ext->remote_uuid"
          ],
          "line": 1633
        },
        "resolved": true,
        "details": {
          "function_name": "bt_string2uuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/uuid-helper.c",
          "lines": "211-247",
          "snippet": "int bt_string2uuid(uuid_t *uuid, const char *string)\n{\n\tuint32_t data0, data4;\n\tuint16_t data1, data2, data3, data5;\n\n\tif (is_uuid128(string) &&\n\t\t\tsscanf(string, \"%08x-%04hx-%04hx-%04hx-%08x%04hx\",\n\t\t\t\t&data0, &data1, &data2, &data3, &data4, &data5) == 6) {\n\t\tuint8_t val[16];\n\n\t\tdata0 = htonl(data0);\n\t\tdata1 = htons(data1);\n\t\tdata2 = htons(data2);\n\t\tdata3 = htons(data3);\n\t\tdata4 = htonl(data4);\n\t\tdata5 = htons(data5);\n\n\t\tmemcpy(&val[0], &data0, 4);\n\t\tmemcpy(&val[4], &data1, 2);\n\t\tmemcpy(&val[6], &data2, 2);\n\t\tmemcpy(&val[8], &data3, 2);\n\t\tmemcpy(&val[10], &data4, 4);\n\t\tmemcpy(&val[14], &data5, 2);\n\n\t\tsdp_uuid128_create(uuid, val);\n\n\t\treturn 0;\n\t} else {\n\t\tuint16_t class = name2class(string);\n\t\tif (class) {\n\t\t\tsdp_uuid16_create(uuid, class);\n\t\t\treturn 0;\n\t\t}\n\n\t\treturn string2uuid16(uuid, string);\n\t}\n}",
          "includes": [
            "#include \"uuid-helper.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <arpa/inet.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"uuid-helper.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <arpa/inet.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <config.h>\n\nint bt_string2uuid(uuid_t *uuid, const char *string)\n{\n\tuint32_t data0, data4;\n\tuint16_t data1, data2, data3, data5;\n\n\tif (is_uuid128(string) &&\n\t\t\tsscanf(string, \"%08x-%04hx-%04hx-%04hx-%08x%04hx\",\n\t\t\t\t&data0, &data1, &data2, &data3, &data4, &data5) == 6) {\n\t\tuint8_t val[16];\n\n\t\tdata0 = htonl(data0);\n\t\tdata1 = htons(data1);\n\t\tdata2 = htons(data2);\n\t\tdata3 = htons(data3);\n\t\tdata4 = htonl(data4);\n\t\tdata5 = htons(data5);\n\n\t\tmemcpy(&val[0], &data0, 4);\n\t\tmemcpy(&val[4], &data1, 2);\n\t\tmemcpy(&val[6], &data2, 2);\n\t\tmemcpy(&val[8], &data3, 2);\n\t\tmemcpy(&val[10], &data4, 4);\n\t\tmemcpy(&val[14], &data5, 2);\n\n\t\tsdp_uuid128_create(uuid, val);\n\n\t\treturn 0;\n\t} else {\n\t\tuint16_t class = name2class(string);\n\t\tif (class) {\n\t\t\tsdp_uuid16_create(uuid, class);\n\t\t\treturn 0;\n\t\t}\n\n\t\treturn string2uuid16(uuid, string);\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic int resolve_service(struct ext_io *conn, const bdaddr_t *src,\n\t\t\t\t\t\t\tconst bdaddr_t *dst)\n{\n\tstruct ext_profile *ext = conn->ext;\n\tuuid_t uuid;\n\tint err;\n\n\tbt_string2uuid(&uuid, ext->remote_uuid);\n\tsdp_uuid128_to_uuid(&uuid);\n\n\terr = bt_search_service(src, dst, &uuid, record_cb, conn, NULL, 0);\n\tif (err == 0)\n\t\tconn->resolving = true;\n\n\treturn err;\n}"
  },
  {
    "function_name": "record_cb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
    "lines": "1548-1624",
    "snippet": "static void record_cb(sdp_list_t *recs, int err, gpointer user_data)\n{\n\tstruct ext_io *conn = user_data;\n\tstruct ext_profile *ext = conn->ext;\n\tsdp_list_t *r;\n\n\tconn->resolving = false;\n\n\tif (err < 0) {\n\t\terror(\"Unable to get %s SDP record: %s\", ext->name,\n\t\t\t\t\t\t\tstrerror(-err));\n\t\tgoto failed;\n\t}\n\n\tif (!recs || !recs->data) {\n\t\terror(\"No SDP records found for %s\", ext->name);\n\t\terr = -ENOTSUP;\n\t\tgoto failed;\n\t}\n\n\tfor (r = recs; r != NULL; r = r->next) {\n\t\tsdp_record_t *rec = r->data;\n\t\tsdp_list_t *protos;\n\t\tint port;\n\n\t\tif (sdp_get_access_protos(rec, &protos) < 0) {\n\t\t\terror(\"Unable to get proto list from %s record\",\n\t\t\t\t\t\t\t\text->name);\n\t\t\terr = -ENOTSUP;\n\t\t\tgoto failed;\n\t\t}\n\n\t\tport = sdp_get_proto_port(protos, L2CAP_UUID);\n\t\tif (port > 0)\n\t\t\tconn->psm = port;\n\n\t\tport = sdp_get_proto_port(protos, RFCOMM_UUID);\n\t\tif (port > 0)\n\t\t\tconn->chan = port;\n\n\t\tif (conn->psm == 0 && sdp_get_proto_desc(protos, OBEX_UUID))\n\t\t\tconn->psm = get_goep_l2cap_psm(rec);\n\n\t\tconn->features = get_supported_features(rec);\n\t\tconn->version = get_profile_version(rec);\n\n\t\tsdp_list_foreach(protos, (sdp_list_func_t) sdp_list_free,\n\t\t\t\t\t\t\t\t\tNULL);\n\t\tsdp_list_free(protos, NULL);\n\n\t\tif (conn->chan || conn->psm)\n\t\t\tbreak;\n\t}\n\n\tif (!conn->chan && !conn->psm) {\n\t\terror(\"Failed to find L2CAP PSM or RFCOMM channel for %s\",\n\t\t\t\t\t\t\t\text->name);\n\t\terr = -ENOTSUP;\n\t\tgoto failed;\n\t}\n\n\terr = connect_io(conn, btd_adapter_get_address(conn->adapter),\n\t\t\t\t\tdevice_get_address(conn->device));\n\tif (err < 0) {\n\t\terror(\"Connecting %s failed: %s\", ext->name, strerror(-err));\n\t\tgoto failed;\n\t}\n\n\treturn;\n\nfailed:\n\tif (conn->service)\n\t\tbtd_service_connecting_complete(conn->service, err);\n\n\text->conns = g_slist_remove(ext->conns, conn);\n\text_io_destroy(conn);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"sdp-xml.h\"",
      "#include \"sdp-client.h\"",
      "#include \"dbus-common.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"btio/btio.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ext_io_destroy",
          "args": [
            "conn"
          ],
          "line": 1623
        },
        "resolved": true,
        "details": {
          "function_name": "ext_io_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
          "lines": "749-783",
          "snippet": "static void ext_io_destroy(gpointer p)\n{\n\tstruct ext_io *ext_io = p;\n\n\tif (ext_io->io_id > 0)\n\t\tg_source_remove(ext_io->io_id);\n\n\tif (ext_io->io) {\n\t\tg_io_channel_shutdown(ext_io->io, FALSE, NULL);\n\t\tg_io_channel_unref(ext_io->io);\n\t}\n\n\tif (ext_io->auth_id != 0)\n\t\tbtd_cancel_authorization(ext_io->auth_id);\n\n\tif (ext_io->pending) {\n\t\tdbus_pending_call_cancel(ext_io->pending);\n\t\tdbus_pending_call_unref(ext_io->pending);\n\t}\n\n\tif (ext_io->resolving)\n\t\tbt_cancel_discovery(btd_adapter_get_address(ext_io->adapter),\n\t\t\t\t\tdevice_get_address(ext_io->device));\n\n\tif (ext_io->adapter)\n\t\tbtd_adapter_unref(ext_io->adapter);\n\n\tif (ext_io->device)\n\t\tbtd_device_unref(ext_io->device);\n\n\tif (ext_io->service)\n\t\tbtd_service_unref(ext_io->service);\n\n\tg_free(ext_io);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdp-xml.h\"",
            "#include \"sdp-client.h\"",
            "#include \"dbus-common.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"btio/btio.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void ext_io_destroy(gpointer p)\n{\n\tstruct ext_io *ext_io = p;\n\n\tif (ext_io->io_id > 0)\n\t\tg_source_remove(ext_io->io_id);\n\n\tif (ext_io->io) {\n\t\tg_io_channel_shutdown(ext_io->io, FALSE, NULL);\n\t\tg_io_channel_unref(ext_io->io);\n\t}\n\n\tif (ext_io->auth_id != 0)\n\t\tbtd_cancel_authorization(ext_io->auth_id);\n\n\tif (ext_io->pending) {\n\t\tdbus_pending_call_cancel(ext_io->pending);\n\t\tdbus_pending_call_unref(ext_io->pending);\n\t}\n\n\tif (ext_io->resolving)\n\t\tbt_cancel_discovery(btd_adapter_get_address(ext_io->adapter),\n\t\t\t\t\tdevice_get_address(ext_io->device));\n\n\tif (ext_io->adapter)\n\t\tbtd_adapter_unref(ext_io->adapter);\n\n\tif (ext_io->device)\n\t\tbtd_device_unref(ext_io->device);\n\n\tif (ext_io->service)\n\t\tbtd_service_unref(ext_io->service);\n\n\tg_free(ext_io);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_slist_remove",
          "args": [
            "ext->conns",
            "conn"
          ],
          "line": 1622
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_service_connecting_complete",
          "args": [
            "conn->service",
            "err"
          ],
          "line": 1620
        },
        "resolved": true,
        "details": {
          "function_name": "btd_service_connecting_complete",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
          "lines": "373-383",
          "snippet": "void btd_service_connecting_complete(struct btd_service *service, int err)\n{\n\tif (service->state != BTD_SERVICE_STATE_DISCONNECTED &&\n\t\t\tservice->state != BTD_SERVICE_STATE_CONNECTING)\n\t\treturn;\n\n\tif (err == 0)\n\t\tchange_state(service, BTD_SERVICE_STATE_CONNECTED, 0);\n\telse\n\t\tchange_state(service, BTD_SERVICE_STATE_DISCONNECTED, err);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/stat.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid btd_service_connecting_complete(struct btd_service *service, int err)\n{\n\tif (service->state != BTD_SERVICE_STATE_DISCONNECTED &&\n\t\t\tservice->state != BTD_SERVICE_STATE_CONNECTING)\n\t\treturn;\n\n\tif (err == 0)\n\t\tchange_state(service, BTD_SERVICE_STATE_CONNECTED, 0);\n\telse\n\t\tchange_state(service, BTD_SERVICE_STATE_DISCONNECTED, err);\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Connecting %s failed: %s\"",
            "ext->name",
            "strerror(-err)"
          ],
          "line": 1612
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/log.c",
          "lines": "199-213",
          "snippet": "void btd_error(uint16_t index, const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_ERR, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(index, LOG_ERR, format, ap);\n\tva_end(ap);\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdarg.h>",
            "#include <syslog.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int logging_fd = -1;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"src/shared/util.h\"\n#include \"lib/hci.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int logging_fd = -1;\n\nvoid btd_error(uint16_t index, const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_ERR, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(index, LOG_ERR, format, ap);\n\tva_end(ap);\n}"
        }
      },
      {
        "call_info": {
          "callee": "strerror",
          "args": [
            "-err"
          ],
          "line": 1612
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "connect_io",
          "args": [
            "conn",
            "btd_adapter_get_address(conn->adapter)",
            "device_get_address(conn->device)"
          ],
          "line": 1609
        },
        "resolved": true,
        "details": {
          "function_name": "connect_io",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
          "lines": "1494-1528",
          "snippet": "static int connect_io(struct ext_io *conn, const bdaddr_t *src,\n\t\t\t\t\t\t\tconst bdaddr_t *dst)\n{\n\tstruct ext_profile *ext = conn->ext;\n\tGError *gerr = NULL;\n\tGIOChannel *io;\n\n\tif (conn->psm) {\n\t\tconn->proto = BTPROTO_L2CAP;\n\t\tio = bt_io_connect(ext_connect, conn, NULL, &gerr,\n\t\t\t\t\tBT_IO_OPT_SOURCE_BDADDR, src,\n\t\t\t\t\tBT_IO_OPT_DEST_BDADDR, dst,\n\t\t\t\t\tBT_IO_OPT_SEC_LEVEL, ext->sec_level,\n\t\t\t\t\tBT_IO_OPT_PSM, conn->psm,\n\t\t\t\t\tBT_IO_OPT_INVALID);\n\t} else {\n\t\tconn->proto = BTPROTO_RFCOMM;\n\t\tio = bt_io_connect(ext_connect, conn, NULL, &gerr,\n\t\t\t\t\tBT_IO_OPT_SOURCE_BDADDR, src,\n\t\t\t\t\tBT_IO_OPT_DEST_BDADDR, dst,\n\t\t\t\t\tBT_IO_OPT_SEC_LEVEL, ext->sec_level,\n\t\t\t\t\tBT_IO_OPT_CHANNEL, conn->chan,\n\t\t\t\t\tBT_IO_OPT_INVALID);\n\t}\n\n\tif (gerr != NULL) {\n\t\terror(\"Unable to connect %s: %s\", ext->name, gerr->message);\n\t\tg_error_free(gerr);\n\t\treturn -EIO;\n\t}\n\n\tconn->io = io;\n\n\treturn 0;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdp-xml.h\"",
            "#include \"sdp-client.h\"",
            "#include \"dbus-common.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"btio/btio.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic int connect_io(struct ext_io *conn, const bdaddr_t *src,\n\t\t\t\t\t\t\tconst bdaddr_t *dst)\n{\n\tstruct ext_profile *ext = conn->ext;\n\tGError *gerr = NULL;\n\tGIOChannel *io;\n\n\tif (conn->psm) {\n\t\tconn->proto = BTPROTO_L2CAP;\n\t\tio = bt_io_connect(ext_connect, conn, NULL, &gerr,\n\t\t\t\t\tBT_IO_OPT_SOURCE_BDADDR, src,\n\t\t\t\t\tBT_IO_OPT_DEST_BDADDR, dst,\n\t\t\t\t\tBT_IO_OPT_SEC_LEVEL, ext->sec_level,\n\t\t\t\t\tBT_IO_OPT_PSM, conn->psm,\n\t\t\t\t\tBT_IO_OPT_INVALID);\n\t} else {\n\t\tconn->proto = BTPROTO_RFCOMM;\n\t\tio = bt_io_connect(ext_connect, conn, NULL, &gerr,\n\t\t\t\t\tBT_IO_OPT_SOURCE_BDADDR, src,\n\t\t\t\t\tBT_IO_OPT_DEST_BDADDR, dst,\n\t\t\t\t\tBT_IO_OPT_SEC_LEVEL, ext->sec_level,\n\t\t\t\t\tBT_IO_OPT_CHANNEL, conn->chan,\n\t\t\t\t\tBT_IO_OPT_INVALID);\n\t}\n\n\tif (gerr != NULL) {\n\t\terror(\"Unable to connect %s: %s\", ext->name, gerr->message);\n\t\tg_error_free(gerr);\n\t\treturn -EIO;\n\t}\n\n\tconn->io = io;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "device_get_address",
          "args": [
            "conn->device"
          ],
          "line": 1610
        },
        "resolved": true,
        "details": {
          "function_name": "device_get_address",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5314-5317",
          "snippet": "const bdaddr_t *device_get_address(struct btd_device *device)\n{\n\treturn &device->bdaddr;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nconst bdaddr_t *device_get_address(struct btd_device *device)\n{\n\treturn &device->bdaddr;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_adapter_get_address",
          "args": [
            "conn->adapter"
          ],
          "line": 1609
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_get_address",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "5881-5884",
          "snippet": "const bdaddr_t *btd_adapter_get_address(struct btd_adapter *adapter)\n{\n\treturn &adapter->bdaddr;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nconst bdaddr_t *btd_adapter_get_address(struct btd_adapter *adapter)\n{\n\treturn &adapter->bdaddr;\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Failed to find L2CAP PSM or RFCOMM channel for %s\"",
            "ext->name"
          ],
          "line": 1603
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "124-128",
          "snippet": "DBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "sdp_list_free",
          "args": [
            "protos",
            "NULL"
          ],
          "line": 1596
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_list_foreach",
          "args": [
            "protos",
            "(sdp_list_func_t) sdp_list_free",
            "NULL"
          ],
          "line": 1594
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_profile_version",
          "args": [
            "rec"
          ],
          "line": 1592
        },
        "resolved": true,
        "details": {
          "function_name": "get_profile_version",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
          "lines": "933-951",
          "snippet": "static uint16_t get_profile_version(const sdp_record_t *rec)\n{\n\tsdp_list_t *descs;\n\tuint16_t version;\n\n\tif (sdp_get_profile_descs(rec, &descs) < 0)\n\t\treturn 0;\n\n\tif (descs && descs->data) {\n\t\tsdp_profile_desc_t *desc = descs->data;\n\t\tversion = desc->version;\n\t} else {\n\t\tversion = 0;\n\t}\n\n\tsdp_list_free(descs, free);\n\n\treturn version;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdp-xml.h\"",
            "#include \"sdp-client.h\"",
            "#include \"dbus-common.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"btio/btio.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic uint16_t get_profile_version(const sdp_record_t *rec)\n{\n\tsdp_list_t *descs;\n\tuint16_t version;\n\n\tif (sdp_get_profile_descs(rec, &descs) < 0)\n\t\treturn 0;\n\n\tif (descs && descs->data) {\n\t\tsdp_profile_desc_t *desc = descs->data;\n\t\tversion = desc->version;\n\t} else {\n\t\tversion = 0;\n\t}\n\n\tsdp_list_free(descs, free);\n\n\treturn version;\n}"
        }
      },
      {
        "call_info": {
          "callee": "get_supported_features",
          "args": [
            "rec"
          ],
          "line": 1591
        },
        "resolved": true,
        "details": {
          "function_name": "get_supported_features",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
          "lines": "922-931",
          "snippet": "static uint16_t get_supported_features(const sdp_record_t *rec)\n{\n\tsdp_data_t *data;\n\n\tdata = sdp_data_get(rec, SDP_ATTR_SUPPORTED_FEATURES);\n\tif (!data || data->dtd != SDP_UINT16)\n\t\treturn 0;\n\n\treturn data->val.uint16;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdp-xml.h\"",
            "#include \"sdp-client.h\"",
            "#include \"dbus-common.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"btio/btio.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic uint16_t get_supported_features(const sdp_record_t *rec)\n{\n\tsdp_data_t *data;\n\n\tdata = sdp_data_get(rec, SDP_ATTR_SUPPORTED_FEATURES);\n\tif (!data || data->dtd != SDP_UINT16)\n\t\treturn 0;\n\n\treturn data->val.uint16;\n}"
        }
      },
      {
        "call_info": {
          "callee": "get_goep_l2cap_psm",
          "args": [
            "rec"
          ],
          "line": 1589
        },
        "resolved": true,
        "details": {
          "function_name": "get_goep_l2cap_psm",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
          "lines": "1530-1546",
          "snippet": "static uint16_t get_goep_l2cap_psm(sdp_record_t *rec)\n{\n\tsdp_data_t *data;\n\n\tdata = sdp_data_get(rec, SDP_ATTR_GOEP_L2CAP_PSM);\n\tif (!data)\n\t\treturn 0;\n\n\tif (data->dtd != SDP_UINT16)\n\t\treturn 0;\n\n\t/* PSM must be odd and lsb of upper byte must be 0 */\n\tif ((data->val.uint16 & 0x0101) != 0x0001)\n\t\treturn 0;\n\n\treturn data->val.uint16;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdp-xml.h\"",
            "#include \"sdp-client.h\"",
            "#include \"dbus-common.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"btio/btio.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic uint16_t get_goep_l2cap_psm(sdp_record_t *rec)\n{\n\tsdp_data_t *data;\n\n\tdata = sdp_data_get(rec, SDP_ATTR_GOEP_L2CAP_PSM);\n\tif (!data)\n\t\treturn 0;\n\n\tif (data->dtd != SDP_UINT16)\n\t\treturn 0;\n\n\t/* PSM must be odd and lsb of upper byte must be 0 */\n\tif ((data->val.uint16 & 0x0101) != 0x0001)\n\t\treturn 0;\n\n\treturn data->val.uint16;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sdp_get_proto_desc",
          "args": [
            "protos",
            "OBEX_UUID"
          ],
          "line": 1588
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_get_proto_port",
          "args": [
            "protos",
            "RFCOMM_UUID"
          ],
          "line": 1584
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_get_proto_port",
          "args": [
            "protos",
            "L2CAP_UUID"
          ],
          "line": 1580
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_get_access_protos",
          "args": [
            "rec",
            "&protos"
          ],
          "line": 1573
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strerror",
          "args": [
            "-err"
          ],
          "line": 1558
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void record_cb(sdp_list_t *recs, int err, gpointer user_data)\n{\n\tstruct ext_io *conn = user_data;\n\tstruct ext_profile *ext = conn->ext;\n\tsdp_list_t *r;\n\n\tconn->resolving = false;\n\n\tif (err < 0) {\n\t\terror(\"Unable to get %s SDP record: %s\", ext->name,\n\t\t\t\t\t\t\tstrerror(-err));\n\t\tgoto failed;\n\t}\n\n\tif (!recs || !recs->data) {\n\t\terror(\"No SDP records found for %s\", ext->name);\n\t\terr = -ENOTSUP;\n\t\tgoto failed;\n\t}\n\n\tfor (r = recs; r != NULL; r = r->next) {\n\t\tsdp_record_t *rec = r->data;\n\t\tsdp_list_t *protos;\n\t\tint port;\n\n\t\tif (sdp_get_access_protos(rec, &protos) < 0) {\n\t\t\terror(\"Unable to get proto list from %s record\",\n\t\t\t\t\t\t\t\text->name);\n\t\t\terr = -ENOTSUP;\n\t\t\tgoto failed;\n\t\t}\n\n\t\tport = sdp_get_proto_port(protos, L2CAP_UUID);\n\t\tif (port > 0)\n\t\t\tconn->psm = port;\n\n\t\tport = sdp_get_proto_port(protos, RFCOMM_UUID);\n\t\tif (port > 0)\n\t\t\tconn->chan = port;\n\n\t\tif (conn->psm == 0 && sdp_get_proto_desc(protos, OBEX_UUID))\n\t\t\tconn->psm = get_goep_l2cap_psm(rec);\n\n\t\tconn->features = get_supported_features(rec);\n\t\tconn->version = get_profile_version(rec);\n\n\t\tsdp_list_foreach(protos, (sdp_list_func_t) sdp_list_free,\n\t\t\t\t\t\t\t\t\tNULL);\n\t\tsdp_list_free(protos, NULL);\n\n\t\tif (conn->chan || conn->psm)\n\t\t\tbreak;\n\t}\n\n\tif (!conn->chan && !conn->psm) {\n\t\terror(\"Failed to find L2CAP PSM or RFCOMM channel for %s\",\n\t\t\t\t\t\t\t\text->name);\n\t\terr = -ENOTSUP;\n\t\tgoto failed;\n\t}\n\n\terr = connect_io(conn, btd_adapter_get_address(conn->adapter),\n\t\t\t\t\tdevice_get_address(conn->device));\n\tif (err < 0) {\n\t\terror(\"Connecting %s failed: %s\", ext->name, strerror(-err));\n\t\tgoto failed;\n\t}\n\n\treturn;\n\nfailed:\n\tif (conn->service)\n\t\tbtd_service_connecting_complete(conn->service, err);\n\n\text->conns = g_slist_remove(ext->conns, conn);\n\text_io_destroy(conn);\n}"
  },
  {
    "function_name": "get_goep_l2cap_psm",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
    "lines": "1530-1546",
    "snippet": "static uint16_t get_goep_l2cap_psm(sdp_record_t *rec)\n{\n\tsdp_data_t *data;\n\n\tdata = sdp_data_get(rec, SDP_ATTR_GOEP_L2CAP_PSM);\n\tif (!data)\n\t\treturn 0;\n\n\tif (data->dtd != SDP_UINT16)\n\t\treturn 0;\n\n\t/* PSM must be odd and lsb of upper byte must be 0 */\n\tif ((data->val.uint16 & 0x0101) != 0x0001)\n\t\treturn 0;\n\n\treturn data->val.uint16;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"sdp-xml.h\"",
      "#include \"sdp-client.h\"",
      "#include \"dbus-common.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"btio/btio.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sdp_data_get",
          "args": [
            "rec",
            "SDP_ATTR_GOEP_L2CAP_PSM"
          ],
          "line": 1534
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic uint16_t get_goep_l2cap_psm(sdp_record_t *rec)\n{\n\tsdp_data_t *data;\n\n\tdata = sdp_data_get(rec, SDP_ATTR_GOEP_L2CAP_PSM);\n\tif (!data)\n\t\treturn 0;\n\n\tif (data->dtd != SDP_UINT16)\n\t\treturn 0;\n\n\t/* PSM must be odd and lsb of upper byte must be 0 */\n\tif ((data->val.uint16 & 0x0101) != 0x0001)\n\t\treturn 0;\n\n\treturn data->val.uint16;\n}"
  },
  {
    "function_name": "connect_io",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
    "lines": "1494-1528",
    "snippet": "static int connect_io(struct ext_io *conn, const bdaddr_t *src,\n\t\t\t\t\t\t\tconst bdaddr_t *dst)\n{\n\tstruct ext_profile *ext = conn->ext;\n\tGError *gerr = NULL;\n\tGIOChannel *io;\n\n\tif (conn->psm) {\n\t\tconn->proto = BTPROTO_L2CAP;\n\t\tio = bt_io_connect(ext_connect, conn, NULL, &gerr,\n\t\t\t\t\tBT_IO_OPT_SOURCE_BDADDR, src,\n\t\t\t\t\tBT_IO_OPT_DEST_BDADDR, dst,\n\t\t\t\t\tBT_IO_OPT_SEC_LEVEL, ext->sec_level,\n\t\t\t\t\tBT_IO_OPT_PSM, conn->psm,\n\t\t\t\t\tBT_IO_OPT_INVALID);\n\t} else {\n\t\tconn->proto = BTPROTO_RFCOMM;\n\t\tio = bt_io_connect(ext_connect, conn, NULL, &gerr,\n\t\t\t\t\tBT_IO_OPT_SOURCE_BDADDR, src,\n\t\t\t\t\tBT_IO_OPT_DEST_BDADDR, dst,\n\t\t\t\t\tBT_IO_OPT_SEC_LEVEL, ext->sec_level,\n\t\t\t\t\tBT_IO_OPT_CHANNEL, conn->chan,\n\t\t\t\t\tBT_IO_OPT_INVALID);\n\t}\n\n\tif (gerr != NULL) {\n\t\terror(\"Unable to connect %s: %s\", ext->name, gerr->message);\n\t\tg_error_free(gerr);\n\t\treturn -EIO;\n\t}\n\n\tconn->io = io;\n\n\treturn 0;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"sdp-xml.h\"",
      "#include \"sdp-client.h\"",
      "#include \"dbus-common.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"btio/btio.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_error_free",
          "args": [
            "gerr"
          ],
          "line": 1521
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Unable to connect %s: %s\"",
            "ext->name",
            "gerr->message"
          ],
          "line": 1520
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/log.c",
          "lines": "199-213",
          "snippet": "void btd_error(uint16_t index, const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_ERR, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(index, LOG_ERR, format, ap);\n\tva_end(ap);\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdarg.h>",
            "#include <syslog.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int logging_fd = -1;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"src/shared/util.h\"\n#include \"lib/hci.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int logging_fd = -1;\n\nvoid btd_error(uint16_t index, const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_ERR, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(index, LOG_ERR, format, ap);\n\tva_end(ap);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_io_connect",
          "args": [
            "ext_connect",
            "conn",
            "NULL",
            "&gerr",
            "BT_IO_OPT_SOURCE_BDADDR",
            "src",
            "BT_IO_OPT_DEST_BDADDR",
            "dst",
            "BT_IO_OPT_SEC_LEVEL",
            "ext->sec_level",
            "BT_IO_OPT_CHANNEL",
            "conn->chan",
            "BT_IO_OPT_INVALID"
          ],
          "line": 1511
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_io_connect",
          "args": [
            "ext_connect",
            "conn",
            "NULL",
            "&gerr",
            "BT_IO_OPT_SOURCE_BDADDR",
            "src",
            "BT_IO_OPT_DEST_BDADDR",
            "dst",
            "BT_IO_OPT_SEC_LEVEL",
            "ext->sec_level",
            "BT_IO_OPT_PSM",
            "conn->psm",
            "BT_IO_OPT_INVALID"
          ],
          "line": 1503
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic int connect_io(struct ext_io *conn, const bdaddr_t *src,\n\t\t\t\t\t\t\tconst bdaddr_t *dst)\n{\n\tstruct ext_profile *ext = conn->ext;\n\tGError *gerr = NULL;\n\tGIOChannel *io;\n\n\tif (conn->psm) {\n\t\tconn->proto = BTPROTO_L2CAP;\n\t\tio = bt_io_connect(ext_connect, conn, NULL, &gerr,\n\t\t\t\t\tBT_IO_OPT_SOURCE_BDADDR, src,\n\t\t\t\t\tBT_IO_OPT_DEST_BDADDR, dst,\n\t\t\t\t\tBT_IO_OPT_SEC_LEVEL, ext->sec_level,\n\t\t\t\t\tBT_IO_OPT_PSM, conn->psm,\n\t\t\t\t\tBT_IO_OPT_INVALID);\n\t} else {\n\t\tconn->proto = BTPROTO_RFCOMM;\n\t\tio = bt_io_connect(ext_connect, conn, NULL, &gerr,\n\t\t\t\t\tBT_IO_OPT_SOURCE_BDADDR, src,\n\t\t\t\t\tBT_IO_OPT_DEST_BDADDR, dst,\n\t\t\t\t\tBT_IO_OPT_SEC_LEVEL, ext->sec_level,\n\t\t\t\t\tBT_IO_OPT_CHANNEL, conn->chan,\n\t\t\t\t\tBT_IO_OPT_INVALID);\n\t}\n\n\tif (gerr != NULL) {\n\t\terror(\"Unable to connect %s: %s\", ext->name, gerr->message);\n\t\tg_error_free(gerr);\n\t\treturn -EIO;\n\t}\n\n\tconn->io = io;\n\n\treturn 0;\n}"
  },
  {
    "function_name": "ext_device_remove",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
    "lines": "1474-1492",
    "snippet": "static void ext_device_remove(struct btd_service *service)\n{\n\tstruct btd_profile *p = btd_service_get_profile(service);\n\tstruct btd_device *dev = btd_service_get_device(service);\n\tstruct ext_profile *ext;\n\tstruct ext_io *conn;\n\n\text = find_ext(p);\n\tif (!ext)\n\t\treturn;\n\n\tDBG(\"%s\", ext->name);\n\n\tconn = find_connection(ext, dev);\n\tif (conn) {\n\t\text->conns = g_slist_remove(ext->conns, conn);\n\t\text_io_destroy(conn);\n\t}\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"sdp-xml.h\"",
      "#include \"sdp-client.h\"",
      "#include \"dbus-common.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"btio/btio.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ext_io_destroy",
          "args": [
            "conn"
          ],
          "line": 1490
        },
        "resolved": true,
        "details": {
          "function_name": "ext_io_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
          "lines": "749-783",
          "snippet": "static void ext_io_destroy(gpointer p)\n{\n\tstruct ext_io *ext_io = p;\n\n\tif (ext_io->io_id > 0)\n\t\tg_source_remove(ext_io->io_id);\n\n\tif (ext_io->io) {\n\t\tg_io_channel_shutdown(ext_io->io, FALSE, NULL);\n\t\tg_io_channel_unref(ext_io->io);\n\t}\n\n\tif (ext_io->auth_id != 0)\n\t\tbtd_cancel_authorization(ext_io->auth_id);\n\n\tif (ext_io->pending) {\n\t\tdbus_pending_call_cancel(ext_io->pending);\n\t\tdbus_pending_call_unref(ext_io->pending);\n\t}\n\n\tif (ext_io->resolving)\n\t\tbt_cancel_discovery(btd_adapter_get_address(ext_io->adapter),\n\t\t\t\t\tdevice_get_address(ext_io->device));\n\n\tif (ext_io->adapter)\n\t\tbtd_adapter_unref(ext_io->adapter);\n\n\tif (ext_io->device)\n\t\tbtd_device_unref(ext_io->device);\n\n\tif (ext_io->service)\n\t\tbtd_service_unref(ext_io->service);\n\n\tg_free(ext_io);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdp-xml.h\"",
            "#include \"sdp-client.h\"",
            "#include \"dbus-common.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"btio/btio.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void ext_io_destroy(gpointer p)\n{\n\tstruct ext_io *ext_io = p;\n\n\tif (ext_io->io_id > 0)\n\t\tg_source_remove(ext_io->io_id);\n\n\tif (ext_io->io) {\n\t\tg_io_channel_shutdown(ext_io->io, FALSE, NULL);\n\t\tg_io_channel_unref(ext_io->io);\n\t}\n\n\tif (ext_io->auth_id != 0)\n\t\tbtd_cancel_authorization(ext_io->auth_id);\n\n\tif (ext_io->pending) {\n\t\tdbus_pending_call_cancel(ext_io->pending);\n\t\tdbus_pending_call_unref(ext_io->pending);\n\t}\n\n\tif (ext_io->resolving)\n\t\tbt_cancel_discovery(btd_adapter_get_address(ext_io->adapter),\n\t\t\t\t\tdevice_get_address(ext_io->device));\n\n\tif (ext_io->adapter)\n\t\tbtd_adapter_unref(ext_io->adapter);\n\n\tif (ext_io->device)\n\t\tbtd_device_unref(ext_io->device);\n\n\tif (ext_io->service)\n\t\tbtd_service_unref(ext_io->service);\n\n\tg_free(ext_io);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_slist_remove",
          "args": [
            "ext->conns",
            "conn"
          ],
          "line": 1489
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "find_connection",
          "args": [
            "ext",
            "dev"
          ],
          "line": 1487
        },
        "resolved": true,
        "details": {
          "function_name": "find_connection",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
          "lines": "1459-1472",
          "snippet": "static struct ext_io *find_connection(struct ext_profile *ext,\n\t\t\t\t\t\t\tstruct btd_device *dev)\n{\n\tGSList *l;\n\n\tfor (l = ext->conns; l != NULL; l = g_slist_next(l)) {\n\t\tstruct ext_io *conn = l->data;\n\n\t\tif (conn->device == dev)\n\t\t\treturn conn;\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdp-xml.h\"",
            "#include \"sdp-client.h\"",
            "#include \"dbus-common.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"btio/btio.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic struct ext_io *find_connection(struct ext_profile *ext,\n\t\t\t\t\t\t\tstruct btd_device *dev)\n{\n\tGSList *l;\n\n\tfor (l = ext->conns; l != NULL; l = g_slist_next(l)) {\n\t\tstruct ext_io *conn = l->data;\n\n\t\tif (conn->device == dev)\n\t\t\treturn conn;\n\t}\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"%s\"",
            "ext->name"
          ],
          "line": 1485
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "find_ext",
          "args": [
            "p"
          ],
          "line": 1481
        },
        "resolved": true,
        "details": {
          "function_name": "find_ext",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
          "lines": "1360-1369",
          "snippet": "static struct ext_profile *find_ext(struct btd_profile *p)\n{\n\tGSList *l;\n\n\tl = g_slist_find(ext_profiles, p);\n\tif (!l)\n\t\treturn NULL;\n\n\treturn l->data;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdp-xml.h\"",
            "#include \"sdp-client.h\"",
            "#include \"dbus-common.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"btio/btio.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static GSList *ext_profiles = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic GSList *ext_profiles = NULL;\n\nstatic struct ext_profile *find_ext(struct btd_profile *p)\n{\n\tGSList *l;\n\n\tl = g_slist_find(ext_profiles, p);\n\tif (!l)\n\t\treturn NULL;\n\n\treturn l->data;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_service_get_device",
          "args": [
            "service"
          ],
          "line": 1477
        },
        "resolved": true,
        "details": {
          "function_name": "btd_service_get_device",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
          "lines": "311-314",
          "snippet": "struct btd_device *btd_service_get_device(const struct btd_service *service)\n{\n\treturn service->device;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/stat.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstruct btd_device *btd_service_get_device(const struct btd_service *service)\n{\n\treturn service->device;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_service_get_profile",
          "args": [
            "service"
          ],
          "line": 1476
        },
        "resolved": true,
        "details": {
          "function_name": "btd_service_get_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
          "lines": "316-319",
          "snippet": "struct btd_profile *btd_service_get_profile(const struct btd_service *service)\n{\n\treturn service->profile;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/stat.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstruct btd_profile *btd_service_get_profile(const struct btd_service *service)\n{\n\treturn service->profile;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void ext_device_remove(struct btd_service *service)\n{\n\tstruct btd_profile *p = btd_service_get_profile(service);\n\tstruct btd_device *dev = btd_service_get_device(service);\n\tstruct ext_profile *ext;\n\tstruct ext_io *conn;\n\n\text = find_ext(p);\n\tif (!ext)\n\t\treturn;\n\n\tDBG(\"%s\", ext->name);\n\n\tconn = find_connection(ext, dev);\n\tif (conn) {\n\t\text->conns = g_slist_remove(ext->conns, conn);\n\t\text_io_destroy(conn);\n\t}\n}"
  },
  {
    "function_name": "find_connection",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
    "lines": "1459-1472",
    "snippet": "static struct ext_io *find_connection(struct ext_profile *ext,\n\t\t\t\t\t\t\tstruct btd_device *dev)\n{\n\tGSList *l;\n\n\tfor (l = ext->conns; l != NULL; l = g_slist_next(l)) {\n\t\tstruct ext_io *conn = l->data;\n\n\t\tif (conn->device == dev)\n\t\t\treturn conn;\n\t}\n\n\treturn NULL;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"sdp-xml.h\"",
      "#include \"sdp-client.h\"",
      "#include \"dbus-common.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"btio/btio.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_slist_next",
          "args": [
            "l"
          ],
          "line": 1464
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic struct ext_io *find_connection(struct ext_profile *ext,\n\t\t\t\t\t\t\tstruct btd_device *dev)\n{\n\tGSList *l;\n\n\tfor (l = ext->conns; l != NULL; l = g_slist_next(l)) {\n\t\tstruct ext_io *conn = l->data;\n\n\t\tif (conn->device == dev)\n\t\t\treturn conn;\n\t}\n\n\treturn NULL;\n}"
  },
  {
    "function_name": "ext_device_probe",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
    "lines": "1445-1457",
    "snippet": "static int ext_device_probe(struct btd_service *service)\n{\n\tstruct btd_profile *p = btd_service_get_profile(service);\n\tstruct ext_profile *ext;\n\n\text = find_ext(p);\n\tif (!ext)\n\t\treturn -ENOENT;\n\n\tDBG(\"%s probed with UUID %s\", ext->name, p->remote_uuid);\n\n\treturn 0;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"sdp-xml.h\"",
      "#include \"sdp-client.h\"",
      "#include \"dbus-common.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"btio/btio.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"%s probed with UUID %s\"",
            "ext->name",
            "p->remote_uuid"
          ],
          "line": 1454
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "find_ext",
          "args": [
            "p"
          ],
          "line": 1450
        },
        "resolved": true,
        "details": {
          "function_name": "find_ext",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
          "lines": "1360-1369",
          "snippet": "static struct ext_profile *find_ext(struct btd_profile *p)\n{\n\tGSList *l;\n\n\tl = g_slist_find(ext_profiles, p);\n\tif (!l)\n\t\treturn NULL;\n\n\treturn l->data;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdp-xml.h\"",
            "#include \"sdp-client.h\"",
            "#include \"dbus-common.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"btio/btio.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static GSList *ext_profiles = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic GSList *ext_profiles = NULL;\n\nstatic struct ext_profile *find_ext(struct btd_profile *p)\n{\n\tGSList *l;\n\n\tl = g_slist_find(ext_profiles, p);\n\tif (!l)\n\t\treturn NULL;\n\n\treturn l->data;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_service_get_profile",
          "args": [
            "service"
          ],
          "line": 1447
        },
        "resolved": true,
        "details": {
          "function_name": "btd_service_get_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
          "lines": "316-319",
          "snippet": "struct btd_profile *btd_service_get_profile(const struct btd_service *service)\n{\n\treturn service->profile;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/stat.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstruct btd_profile *btd_service_get_profile(const struct btd_service *service)\n{\n\treturn service->profile;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic int ext_device_probe(struct btd_service *service)\n{\n\tstruct btd_profile *p = btd_service_get_profile(service);\n\tstruct ext_profile *ext;\n\n\text = find_ext(p);\n\tif (!ext)\n\t\treturn -ENOENT;\n\n\tDBG(\"%s probed with UUID %s\", ext->name, p->remote_uuid);\n\n\treturn 0;\n}"
  },
  {
    "function_name": "ext_adapter_remove",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
    "lines": "1418-1443",
    "snippet": "static void ext_adapter_remove(struct btd_profile *p,\n\t\t\t\t\t\tstruct btd_adapter *adapter)\n{\n\tstruct ext_profile *ext;\n\tGSList *l, *next;\n\n\text = find_ext(p);\n\tif (!ext)\n\t\treturn;\n\n\tDBG(\"\\\"%s\\\" removed\", ext->name);\n\n\text_remove_records(ext, adapter);\n\n\tfor (l = ext->servers; l != NULL; l = next) {\n\t\tstruct ext_io *server = l->data;\n\n\t\tnext = g_slist_next(l);\n\n\t\tif (server->adapter != adapter)\n\t\t\tcontinue;\n\n\t\text->servers = g_slist_remove(ext->servers, server);\n\t\text_io_destroy(server);\n\t}\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"sdp-xml.h\"",
      "#include \"sdp-client.h\"",
      "#include \"dbus-common.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"btio/btio.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ext_io_destroy",
          "args": [
            "server"
          ],
          "line": 1441
        },
        "resolved": true,
        "details": {
          "function_name": "ext_io_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
          "lines": "749-783",
          "snippet": "static void ext_io_destroy(gpointer p)\n{\n\tstruct ext_io *ext_io = p;\n\n\tif (ext_io->io_id > 0)\n\t\tg_source_remove(ext_io->io_id);\n\n\tif (ext_io->io) {\n\t\tg_io_channel_shutdown(ext_io->io, FALSE, NULL);\n\t\tg_io_channel_unref(ext_io->io);\n\t}\n\n\tif (ext_io->auth_id != 0)\n\t\tbtd_cancel_authorization(ext_io->auth_id);\n\n\tif (ext_io->pending) {\n\t\tdbus_pending_call_cancel(ext_io->pending);\n\t\tdbus_pending_call_unref(ext_io->pending);\n\t}\n\n\tif (ext_io->resolving)\n\t\tbt_cancel_discovery(btd_adapter_get_address(ext_io->adapter),\n\t\t\t\t\tdevice_get_address(ext_io->device));\n\n\tif (ext_io->adapter)\n\t\tbtd_adapter_unref(ext_io->adapter);\n\n\tif (ext_io->device)\n\t\tbtd_device_unref(ext_io->device);\n\n\tif (ext_io->service)\n\t\tbtd_service_unref(ext_io->service);\n\n\tg_free(ext_io);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdp-xml.h\"",
            "#include \"sdp-client.h\"",
            "#include \"dbus-common.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"btio/btio.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void ext_io_destroy(gpointer p)\n{\n\tstruct ext_io *ext_io = p;\n\n\tif (ext_io->io_id > 0)\n\t\tg_source_remove(ext_io->io_id);\n\n\tif (ext_io->io) {\n\t\tg_io_channel_shutdown(ext_io->io, FALSE, NULL);\n\t\tg_io_channel_unref(ext_io->io);\n\t}\n\n\tif (ext_io->auth_id != 0)\n\t\tbtd_cancel_authorization(ext_io->auth_id);\n\n\tif (ext_io->pending) {\n\t\tdbus_pending_call_cancel(ext_io->pending);\n\t\tdbus_pending_call_unref(ext_io->pending);\n\t}\n\n\tif (ext_io->resolving)\n\t\tbt_cancel_discovery(btd_adapter_get_address(ext_io->adapter),\n\t\t\t\t\tdevice_get_address(ext_io->device));\n\n\tif (ext_io->adapter)\n\t\tbtd_adapter_unref(ext_io->adapter);\n\n\tif (ext_io->device)\n\t\tbtd_device_unref(ext_io->device);\n\n\tif (ext_io->service)\n\t\tbtd_service_unref(ext_io->service);\n\n\tg_free(ext_io);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_slist_remove",
          "args": [
            "ext->servers",
            "server"
          ],
          "line": 1440
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_next",
          "args": [
            "l"
          ],
          "line": 1435
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ext_remove_records",
          "args": [
            "ext",
            "adapter"
          ],
          "line": 1430
        },
        "resolved": true,
        "details": {
          "function_name": "ext_remove_records",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
          "lines": "1397-1416",
          "snippet": "static void ext_remove_records(struct ext_profile *ext,\n\t\t\t\t\t\tstruct btd_adapter *adapter)\n{\n\tGSList *l, *next;\n\n\tfor (l = ext->records; l != NULL; l = next) {\n\t\tstruct ext_record *r = l->data;\n\n\t\tnext = g_slist_next(l);\n\n\t\tif (adapter && r->adapter != adapter)\n\t\t\tcontinue;\n\n\t\text->records = g_slist_remove(ext->records, r);\n\n\t\tadapter_service_remove(adapter, r->handle);\n\t\tbtd_adapter_unref(r->adapter);\n\t\tg_free(r);\n\t}\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdp-xml.h\"",
            "#include \"sdp-client.h\"",
            "#include \"dbus-common.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"btio/btio.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void ext_remove_records(struct ext_profile *ext,\n\t\t\t\t\t\tstruct btd_adapter *adapter)\n{\n\tGSList *l, *next;\n\n\tfor (l = ext->records; l != NULL; l = next) {\n\t\tstruct ext_record *r = l->data;\n\n\t\tnext = g_slist_next(l);\n\n\t\tif (adapter && r->adapter != adapter)\n\t\t\tcontinue;\n\n\t\text->records = g_slist_remove(ext->records, r);\n\n\t\tadapter_service_remove(adapter, r->handle);\n\t\tbtd_adapter_unref(r->adapter);\n\t\tg_free(r);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"\\\"%s\\\" removed\"",
            "ext->name"
          ],
          "line": 1428
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "find_ext",
          "args": [
            "p"
          ],
          "line": 1424
        },
        "resolved": true,
        "details": {
          "function_name": "find_ext",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
          "lines": "1360-1369",
          "snippet": "static struct ext_profile *find_ext(struct btd_profile *p)\n{\n\tGSList *l;\n\n\tl = g_slist_find(ext_profiles, p);\n\tif (!l)\n\t\treturn NULL;\n\n\treturn l->data;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdp-xml.h\"",
            "#include \"sdp-client.h\"",
            "#include \"dbus-common.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"btio/btio.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static GSList *ext_profiles = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic GSList *ext_profiles = NULL;\n\nstatic struct ext_profile *find_ext(struct btd_profile *p)\n{\n\tGSList *l;\n\n\tl = g_slist_find(ext_profiles, p);\n\tif (!l)\n\t\treturn NULL;\n\n\treturn l->data;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void ext_adapter_remove(struct btd_profile *p,\n\t\t\t\t\t\tstruct btd_adapter *adapter)\n{\n\tstruct ext_profile *ext;\n\tGSList *l, *next;\n\n\text = find_ext(p);\n\tif (!ext)\n\t\treturn;\n\n\tDBG(\"\\\"%s\\\" removed\", ext->name);\n\n\text_remove_records(ext, adapter);\n\n\tfor (l = ext->servers; l != NULL; l = next) {\n\t\tstruct ext_io *server = l->data;\n\n\t\tnext = g_slist_next(l);\n\n\t\tif (server->adapter != adapter)\n\t\t\tcontinue;\n\n\t\text->servers = g_slist_remove(ext->servers, server);\n\t\text_io_destroy(server);\n\t}\n}"
  },
  {
    "function_name": "ext_remove_records",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
    "lines": "1397-1416",
    "snippet": "static void ext_remove_records(struct ext_profile *ext,\n\t\t\t\t\t\tstruct btd_adapter *adapter)\n{\n\tGSList *l, *next;\n\n\tfor (l = ext->records; l != NULL; l = next) {\n\t\tstruct ext_record *r = l->data;\n\n\t\tnext = g_slist_next(l);\n\n\t\tif (adapter && r->adapter != adapter)\n\t\t\tcontinue;\n\n\t\text->records = g_slist_remove(ext->records, r);\n\n\t\tadapter_service_remove(adapter, r->handle);\n\t\tbtd_adapter_unref(r->adapter);\n\t\tg_free(r);\n\t}\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"sdp-xml.h\"",
      "#include \"sdp-client.h\"",
      "#include \"dbus-common.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"btio/btio.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "r"
          ],
          "line": 1414
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_adapter_unref",
          "args": [
            "r->adapter"
          ],
          "line": 1413
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_unref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "4905-4921",
          "snippet": "void btd_adapter_unref(struct btd_adapter *adapter)\n{\n\tif (__sync_sub_and_fetch(&adapter->ref_count, 1))\n\t\treturn;\n\n\tif (!adapter->path) {\n\t\tDBG(\"Freeing adapter %u\", adapter->dev_id);\n\n\t\tadapter_free(adapter);\n\t\treturn;\n\t}\n\n\tDBG(\"Freeing adapter %s\", adapter->path);\n\n\tg_dbus_unregister_interface(dbus_conn, adapter->path,\n\t\t\t\t\t\tADAPTER_INTERFACE);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define ADAPTER_INTERFACE\t\"org.bluez.Adapter1\""
          ],
          "globals_used": [
            "static DBusConnection *dbus_conn = NULL;",
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\n#define ADAPTER_INTERFACE\t\"org.bluez.Adapter1\"\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nvoid btd_adapter_unref(struct btd_adapter *adapter)\n{\n\tif (__sync_sub_and_fetch(&adapter->ref_count, 1))\n\t\treturn;\n\n\tif (!adapter->path) {\n\t\tDBG(\"Freeing adapter %u\", adapter->dev_id);\n\n\t\tadapter_free(adapter);\n\t\treturn;\n\t}\n\n\tDBG(\"Freeing adapter %s\", adapter->path);\n\n\tg_dbus_unregister_interface(dbus_conn, adapter->path,\n\t\t\t\t\t\tADAPTER_INTERFACE);\n}"
        }
      },
      {
        "call_info": {
          "callee": "adapter_service_remove",
          "args": [
            "adapter",
            "r->handle"
          ],
          "line": 1412
        },
        "resolved": true,
        "details": {
          "function_name": "adapter_service_remove",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "1144-1159",
          "snippet": "void adapter_service_remove(struct btd_adapter *adapter, uint32_t handle)\n{\n\tsdp_record_t *rec = sdp_record_find(handle);\n\n\tDBG(\"%s\", adapter->path);\n\n\tif (!rec)\n\t\treturn;\n\n\tadapter->services = sdp_list_remove(adapter->services, rec);\n\n\tif (sdp_list_find(adapter->services, &rec->svclass, uuid_cmp) == NULL)\n\t\tremove_uuid(adapter, &rec->svclass);\n\n\tremove_record_from_server(rec->handle);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nvoid adapter_service_remove(struct btd_adapter *adapter, uint32_t handle)\n{\n\tsdp_record_t *rec = sdp_record_find(handle);\n\n\tDBG(\"%s\", adapter->path);\n\n\tif (!rec)\n\t\treturn;\n\n\tadapter->services = sdp_list_remove(adapter->services, rec);\n\n\tif (sdp_list_find(adapter->services, &rec->svclass, uuid_cmp) == NULL)\n\t\tremove_uuid(adapter, &rec->svclass);\n\n\tremove_record_from_server(rec->handle);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_slist_remove",
          "args": [
            "ext->records",
            "r"
          ],
          "line": 1410
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_next",
          "args": [
            "l"
          ],
          "line": 1405
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void ext_remove_records(struct ext_profile *ext,\n\t\t\t\t\t\tstruct btd_adapter *adapter)\n{\n\tGSList *l, *next;\n\n\tfor (l = ext->records; l != NULL; l = next) {\n\t\tstruct ext_record *r = l->data;\n\n\t\tnext = g_slist_next(l);\n\n\t\tif (adapter && r->adapter != adapter)\n\t\t\tcontinue;\n\n\t\text->records = g_slist_remove(ext->records, r);\n\n\t\tadapter_service_remove(adapter, r->handle);\n\t\tbtd_adapter_unref(r->adapter);\n\t\tg_free(r);\n\t}\n}"
  },
  {
    "function_name": "ext_adapter_probe",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
    "lines": "1371-1395",
    "snippet": "static int ext_adapter_probe(struct btd_profile *p,\n\t\t\t\t\t\tstruct btd_adapter *adapter)\n{\n\tstruct ext_profile *ext;\n\tstruct ext_record *rec;\n\tuint32_t handle;\n\n\text = find_ext(p);\n\tif (!ext)\n\t\treturn -ENOENT;\n\n\tDBG(\"\\\"%s\\\" probed\", ext->name);\n\n\thandle = ext_start_servers(ext, adapter);\n\tif (!handle)\n\t\treturn 0;\n\n\trec = g_new0(struct ext_record, 1);\n\trec->adapter = btd_adapter_ref(adapter);\n\trec->handle = handle;\n\n\text->records = g_slist_append(ext->records, rec);\n\n\treturn 0;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"sdp-xml.h\"",
      "#include \"sdp-client.h\"",
      "#include \"dbus-common.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"btio/btio.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_slist_append",
          "args": [
            "ext->records",
            "rec"
          ],
          "line": 1392
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_adapter_ref",
          "args": [
            "adapter"
          ],
          "line": 1389
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_ref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "4898-4903",
          "snippet": "struct btd_adapter *btd_adapter_ref(struct btd_adapter *adapter)\n{\n\t__sync_fetch_and_add(&adapter->ref_count, 1);\n\n\treturn adapter;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nstruct btd_adapter *btd_adapter_ref(struct btd_adapter *adapter)\n{\n\t__sync_fetch_and_add(&adapter->ref_count, 1);\n\n\treturn adapter;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_new0",
          "args": [
            "structext_record",
            "1"
          ],
          "line": 1388
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ext_start_servers",
          "args": [
            "ext",
            "adapter"
          ],
          "line": 1384
        },
        "resolved": true,
        "details": {
          "function_name": "ext_start_servers",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
          "lines": "1257-1358",
          "snippet": "static uint32_t ext_start_servers(struct ext_profile *ext,\n\t\t\t\t\t\tstruct btd_adapter *adapter)\n{\n\tstruct ext_io *l2cap = NULL;\n\tstruct ext_io *rfcomm = NULL;\n\tBtIOConfirm confirm;\n\tBtIOConnect connect;\n\tGError *err = NULL;\n\tGIOChannel *io;\n\n\tif (ext->authorize) {\n\t\tconfirm = ext_confirm;\n\t\tconnect = NULL;\n\t} else {\n\t\tconfirm = NULL;\n\t\tconnect = ext_direct_connect;\n\t}\n\n\tif (ext->local_psm) {\n\t\tuint16_t psm;\n\n\t\tif (ext->local_psm > 0)\n\t\t\tpsm = ext->local_psm;\n\t\telse\n\t\t\tpsm = 0;\n\n\t\tl2cap = g_new0(struct ext_io, 1);\n\t\tl2cap->ext = ext;\n\n\t\tio = bt_io_listen(connect, confirm, l2cap, NULL, &err,\n\t\t\t\t\tBT_IO_OPT_SOURCE_BDADDR,\n\t\t\t\t\tbtd_adapter_get_address(adapter),\n\t\t\t\t\tBT_IO_OPT_MODE, ext->mode,\n\t\t\t\t\tBT_IO_OPT_PSM, psm,\n\t\t\t\t\tBT_IO_OPT_SEC_LEVEL, ext->sec_level,\n\t\t\t\t\tBT_IO_OPT_INVALID);\n\t\tif (err != NULL) {\n\t\t\terror(\"L2CAP server failed for %s: %s\",\n\t\t\t\t\t\text->name, err->message);\n\t\t\tg_free(l2cap);\n\t\t\tl2cap = NULL;\n\t\t\tg_clear_error(&err);\n\t\t\tgoto failed;\n\t\t} else {\n\t\t\tif (psm == 0)\n\t\t\t\tbt_io_get(io, NULL, BT_IO_OPT_PSM, &psm,\n\t\t\t\t\t\t\tBT_IO_OPT_INVALID);\n\t\t\tl2cap->io = io;\n\t\t\tl2cap->proto = BTPROTO_L2CAP;\n\t\t\tl2cap->psm = psm;\n\t\t\tl2cap->adapter = btd_adapter_ref(adapter);\n\t\t\text->servers = g_slist_append(ext->servers, l2cap);\n\t\t\tDBG(\"%s listening on PSM %u\", ext->name, psm);\n\t\t}\n\t}\n\n\tif (ext->local_chan) {\n\t\tuint8_t chan;\n\n\t\tif (ext->local_chan > 0)\n\t\t\tchan = ext->local_chan;\n\t\telse\n\t\t\tchan = 0;\n\n\t\trfcomm = g_new0(struct ext_io, 1);\n\t\trfcomm->ext = ext;\n\n\t\tio = bt_io_listen(connect, confirm, rfcomm, NULL, &err,\n\t\t\t\t\tBT_IO_OPT_SOURCE_BDADDR,\n\t\t\t\t\tbtd_adapter_get_address(adapter),\n\t\t\t\t\tBT_IO_OPT_CHANNEL, chan,\n\t\t\t\t\tBT_IO_OPT_SEC_LEVEL, ext->sec_level,\n\t\t\t\t\tBT_IO_OPT_INVALID);\n\t\tif (err != NULL) {\n\t\t\terror(\"RFCOMM server failed for %s: %s\",\n\t\t\t\t\t\text->name, err->message);\n\t\t\tg_free(rfcomm);\n\t\t\tg_clear_error(&err);\n\t\t\tgoto failed;\n\t\t} else {\n\t\t\tif (chan == 0)\n\t\t\t\tbt_io_get(io, NULL, BT_IO_OPT_CHANNEL, &chan,\n\t\t\t\t\t\t\tBT_IO_OPT_INVALID);\n\t\t\trfcomm->io = io;\n\t\t\trfcomm->proto = BTPROTO_RFCOMM;\n\t\t\trfcomm->chan = chan;\n\t\t\trfcomm->adapter = btd_adapter_ref(adapter);\n\t\t\text->servers = g_slist_append(ext->servers, rfcomm);\n\t\t\tDBG(\"%s listening on chan %u\", ext->name, chan);\n\t\t}\n\t}\n\n\treturn ext_register_record(ext, l2cap, rfcomm, adapter);\n\nfailed:\n\tif (l2cap) {\n\t\text->servers = g_slist_remove(ext->servers, l2cap);\n\t\text_io_destroy(l2cap);\n\t}\n\n\treturn 0;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdp-xml.h\"",
            "#include \"sdp-client.h\"",
            "#include \"dbus-common.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"btio/btio.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic uint32_t ext_start_servers(struct ext_profile *ext,\n\t\t\t\t\t\tstruct btd_adapter *adapter)\n{\n\tstruct ext_io *l2cap = NULL;\n\tstruct ext_io *rfcomm = NULL;\n\tBtIOConfirm confirm;\n\tBtIOConnect connect;\n\tGError *err = NULL;\n\tGIOChannel *io;\n\n\tif (ext->authorize) {\n\t\tconfirm = ext_confirm;\n\t\tconnect = NULL;\n\t} else {\n\t\tconfirm = NULL;\n\t\tconnect = ext_direct_connect;\n\t}\n\n\tif (ext->local_psm) {\n\t\tuint16_t psm;\n\n\t\tif (ext->local_psm > 0)\n\t\t\tpsm = ext->local_psm;\n\t\telse\n\t\t\tpsm = 0;\n\n\t\tl2cap = g_new0(struct ext_io, 1);\n\t\tl2cap->ext = ext;\n\n\t\tio = bt_io_listen(connect, confirm, l2cap, NULL, &err,\n\t\t\t\t\tBT_IO_OPT_SOURCE_BDADDR,\n\t\t\t\t\tbtd_adapter_get_address(adapter),\n\t\t\t\t\tBT_IO_OPT_MODE, ext->mode,\n\t\t\t\t\tBT_IO_OPT_PSM, psm,\n\t\t\t\t\tBT_IO_OPT_SEC_LEVEL, ext->sec_level,\n\t\t\t\t\tBT_IO_OPT_INVALID);\n\t\tif (err != NULL) {\n\t\t\terror(\"L2CAP server failed for %s: %s\",\n\t\t\t\t\t\text->name, err->message);\n\t\t\tg_free(l2cap);\n\t\t\tl2cap = NULL;\n\t\t\tg_clear_error(&err);\n\t\t\tgoto failed;\n\t\t} else {\n\t\t\tif (psm == 0)\n\t\t\t\tbt_io_get(io, NULL, BT_IO_OPT_PSM, &psm,\n\t\t\t\t\t\t\tBT_IO_OPT_INVALID);\n\t\t\tl2cap->io = io;\n\t\t\tl2cap->proto = BTPROTO_L2CAP;\n\t\t\tl2cap->psm = psm;\n\t\t\tl2cap->adapter = btd_adapter_ref(adapter);\n\t\t\text->servers = g_slist_append(ext->servers, l2cap);\n\t\t\tDBG(\"%s listening on PSM %u\", ext->name, psm);\n\t\t}\n\t}\n\n\tif (ext->local_chan) {\n\t\tuint8_t chan;\n\n\t\tif (ext->local_chan > 0)\n\t\t\tchan = ext->local_chan;\n\t\telse\n\t\t\tchan = 0;\n\n\t\trfcomm = g_new0(struct ext_io, 1);\n\t\trfcomm->ext = ext;\n\n\t\tio = bt_io_listen(connect, confirm, rfcomm, NULL, &err,\n\t\t\t\t\tBT_IO_OPT_SOURCE_BDADDR,\n\t\t\t\t\tbtd_adapter_get_address(adapter),\n\t\t\t\t\tBT_IO_OPT_CHANNEL, chan,\n\t\t\t\t\tBT_IO_OPT_SEC_LEVEL, ext->sec_level,\n\t\t\t\t\tBT_IO_OPT_INVALID);\n\t\tif (err != NULL) {\n\t\t\terror(\"RFCOMM server failed for %s: %s\",\n\t\t\t\t\t\text->name, err->message);\n\t\t\tg_free(rfcomm);\n\t\t\tg_clear_error(&err);\n\t\t\tgoto failed;\n\t\t} else {\n\t\t\tif (chan == 0)\n\t\t\t\tbt_io_get(io, NULL, BT_IO_OPT_CHANNEL, &chan,\n\t\t\t\t\t\t\tBT_IO_OPT_INVALID);\n\t\t\trfcomm->io = io;\n\t\t\trfcomm->proto = BTPROTO_RFCOMM;\n\t\t\trfcomm->chan = chan;\n\t\t\trfcomm->adapter = btd_adapter_ref(adapter);\n\t\t\text->servers = g_slist_append(ext->servers, rfcomm);\n\t\t\tDBG(\"%s listening on chan %u\", ext->name, chan);\n\t\t}\n\t}\n\n\treturn ext_register_record(ext, l2cap, rfcomm, adapter);\n\nfailed:\n\tif (l2cap) {\n\t\text->servers = g_slist_remove(ext->servers, l2cap);\n\t\text_io_destroy(l2cap);\n\t}\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"\\\"%s\\\" probed\"",
            "ext->name"
          ],
          "line": 1382
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "find_ext",
          "args": [
            "p"
          ],
          "line": 1378
        },
        "resolved": true,
        "details": {
          "function_name": "find_ext",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
          "lines": "1360-1369",
          "snippet": "static struct ext_profile *find_ext(struct btd_profile *p)\n{\n\tGSList *l;\n\n\tl = g_slist_find(ext_profiles, p);\n\tif (!l)\n\t\treturn NULL;\n\n\treturn l->data;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdp-xml.h\"",
            "#include \"sdp-client.h\"",
            "#include \"dbus-common.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"btio/btio.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static GSList *ext_profiles = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic GSList *ext_profiles = NULL;\n\nstatic struct ext_profile *find_ext(struct btd_profile *p)\n{\n\tGSList *l;\n\n\tl = g_slist_find(ext_profiles, p);\n\tif (!l)\n\t\treturn NULL;\n\n\treturn l->data;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic int ext_adapter_probe(struct btd_profile *p,\n\t\t\t\t\t\tstruct btd_adapter *adapter)\n{\n\tstruct ext_profile *ext;\n\tstruct ext_record *rec;\n\tuint32_t handle;\n\n\text = find_ext(p);\n\tif (!ext)\n\t\treturn -ENOENT;\n\n\tDBG(\"\\\"%s\\\" probed\", ext->name);\n\n\thandle = ext_start_servers(ext, adapter);\n\tif (!handle)\n\t\treturn 0;\n\n\trec = g_new0(struct ext_record, 1);\n\trec->adapter = btd_adapter_ref(adapter);\n\trec->handle = handle;\n\n\text->records = g_slist_append(ext->records, rec);\n\n\treturn 0;\n}"
  },
  {
    "function_name": "find_ext",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
    "lines": "1360-1369",
    "snippet": "static struct ext_profile *find_ext(struct btd_profile *p)\n{\n\tGSList *l;\n\n\tl = g_slist_find(ext_profiles, p);\n\tif (!l)\n\t\treturn NULL;\n\n\treturn l->data;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"sdp-xml.h\"",
      "#include \"sdp-client.h\"",
      "#include \"dbus-common.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"btio/btio.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static GSList *ext_profiles = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_slist_find",
          "args": [
            "ext_profiles",
            "p"
          ],
          "line": 1364
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic GSList *ext_profiles = NULL;\n\nstatic struct ext_profile *find_ext(struct btd_profile *p)\n{\n\tGSList *l;\n\n\tl = g_slist_find(ext_profiles, p);\n\tif (!l)\n\t\treturn NULL;\n\n\treturn l->data;\n}"
  },
  {
    "function_name": "ext_start_servers",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
    "lines": "1257-1358",
    "snippet": "static uint32_t ext_start_servers(struct ext_profile *ext,\n\t\t\t\t\t\tstruct btd_adapter *adapter)\n{\n\tstruct ext_io *l2cap = NULL;\n\tstruct ext_io *rfcomm = NULL;\n\tBtIOConfirm confirm;\n\tBtIOConnect connect;\n\tGError *err = NULL;\n\tGIOChannel *io;\n\n\tif (ext->authorize) {\n\t\tconfirm = ext_confirm;\n\t\tconnect = NULL;\n\t} else {\n\t\tconfirm = NULL;\n\t\tconnect = ext_direct_connect;\n\t}\n\n\tif (ext->local_psm) {\n\t\tuint16_t psm;\n\n\t\tif (ext->local_psm > 0)\n\t\t\tpsm = ext->local_psm;\n\t\telse\n\t\t\tpsm = 0;\n\n\t\tl2cap = g_new0(struct ext_io, 1);\n\t\tl2cap->ext = ext;\n\n\t\tio = bt_io_listen(connect, confirm, l2cap, NULL, &err,\n\t\t\t\t\tBT_IO_OPT_SOURCE_BDADDR,\n\t\t\t\t\tbtd_adapter_get_address(adapter),\n\t\t\t\t\tBT_IO_OPT_MODE, ext->mode,\n\t\t\t\t\tBT_IO_OPT_PSM, psm,\n\t\t\t\t\tBT_IO_OPT_SEC_LEVEL, ext->sec_level,\n\t\t\t\t\tBT_IO_OPT_INVALID);\n\t\tif (err != NULL) {\n\t\t\terror(\"L2CAP server failed for %s: %s\",\n\t\t\t\t\t\text->name, err->message);\n\t\t\tg_free(l2cap);\n\t\t\tl2cap = NULL;\n\t\t\tg_clear_error(&err);\n\t\t\tgoto failed;\n\t\t} else {\n\t\t\tif (psm == 0)\n\t\t\t\tbt_io_get(io, NULL, BT_IO_OPT_PSM, &psm,\n\t\t\t\t\t\t\tBT_IO_OPT_INVALID);\n\t\t\tl2cap->io = io;\n\t\t\tl2cap->proto = BTPROTO_L2CAP;\n\t\t\tl2cap->psm = psm;\n\t\t\tl2cap->adapter = btd_adapter_ref(adapter);\n\t\t\text->servers = g_slist_append(ext->servers, l2cap);\n\t\t\tDBG(\"%s listening on PSM %u\", ext->name, psm);\n\t\t}\n\t}\n\n\tif (ext->local_chan) {\n\t\tuint8_t chan;\n\n\t\tif (ext->local_chan > 0)\n\t\t\tchan = ext->local_chan;\n\t\telse\n\t\t\tchan = 0;\n\n\t\trfcomm = g_new0(struct ext_io, 1);\n\t\trfcomm->ext = ext;\n\n\t\tio = bt_io_listen(connect, confirm, rfcomm, NULL, &err,\n\t\t\t\t\tBT_IO_OPT_SOURCE_BDADDR,\n\t\t\t\t\tbtd_adapter_get_address(adapter),\n\t\t\t\t\tBT_IO_OPT_CHANNEL, chan,\n\t\t\t\t\tBT_IO_OPT_SEC_LEVEL, ext->sec_level,\n\t\t\t\t\tBT_IO_OPT_INVALID);\n\t\tif (err != NULL) {\n\t\t\terror(\"RFCOMM server failed for %s: %s\",\n\t\t\t\t\t\text->name, err->message);\n\t\t\tg_free(rfcomm);\n\t\t\tg_clear_error(&err);\n\t\t\tgoto failed;\n\t\t} else {\n\t\t\tif (chan == 0)\n\t\t\t\tbt_io_get(io, NULL, BT_IO_OPT_CHANNEL, &chan,\n\t\t\t\t\t\t\tBT_IO_OPT_INVALID);\n\t\t\trfcomm->io = io;\n\t\t\trfcomm->proto = BTPROTO_RFCOMM;\n\t\t\trfcomm->chan = chan;\n\t\t\trfcomm->adapter = btd_adapter_ref(adapter);\n\t\t\text->servers = g_slist_append(ext->servers, rfcomm);\n\t\t\tDBG(\"%s listening on chan %u\", ext->name, chan);\n\t\t}\n\t}\n\n\treturn ext_register_record(ext, l2cap, rfcomm, adapter);\n\nfailed:\n\tif (l2cap) {\n\t\text->servers = g_slist_remove(ext->servers, l2cap);\n\t\text_io_destroy(l2cap);\n\t}\n\n\treturn 0;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"sdp-xml.h\"",
      "#include \"sdp-client.h\"",
      "#include \"dbus-common.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"btio/btio.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ext_io_destroy",
          "args": [
            "l2cap"
          ],
          "line": 1354
        },
        "resolved": true,
        "details": {
          "function_name": "ext_io_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
          "lines": "749-783",
          "snippet": "static void ext_io_destroy(gpointer p)\n{\n\tstruct ext_io *ext_io = p;\n\n\tif (ext_io->io_id > 0)\n\t\tg_source_remove(ext_io->io_id);\n\n\tif (ext_io->io) {\n\t\tg_io_channel_shutdown(ext_io->io, FALSE, NULL);\n\t\tg_io_channel_unref(ext_io->io);\n\t}\n\n\tif (ext_io->auth_id != 0)\n\t\tbtd_cancel_authorization(ext_io->auth_id);\n\n\tif (ext_io->pending) {\n\t\tdbus_pending_call_cancel(ext_io->pending);\n\t\tdbus_pending_call_unref(ext_io->pending);\n\t}\n\n\tif (ext_io->resolving)\n\t\tbt_cancel_discovery(btd_adapter_get_address(ext_io->adapter),\n\t\t\t\t\tdevice_get_address(ext_io->device));\n\n\tif (ext_io->adapter)\n\t\tbtd_adapter_unref(ext_io->adapter);\n\n\tif (ext_io->device)\n\t\tbtd_device_unref(ext_io->device);\n\n\tif (ext_io->service)\n\t\tbtd_service_unref(ext_io->service);\n\n\tg_free(ext_io);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdp-xml.h\"",
            "#include \"sdp-client.h\"",
            "#include \"dbus-common.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"btio/btio.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void ext_io_destroy(gpointer p)\n{\n\tstruct ext_io *ext_io = p;\n\n\tif (ext_io->io_id > 0)\n\t\tg_source_remove(ext_io->io_id);\n\n\tif (ext_io->io) {\n\t\tg_io_channel_shutdown(ext_io->io, FALSE, NULL);\n\t\tg_io_channel_unref(ext_io->io);\n\t}\n\n\tif (ext_io->auth_id != 0)\n\t\tbtd_cancel_authorization(ext_io->auth_id);\n\n\tif (ext_io->pending) {\n\t\tdbus_pending_call_cancel(ext_io->pending);\n\t\tdbus_pending_call_unref(ext_io->pending);\n\t}\n\n\tif (ext_io->resolving)\n\t\tbt_cancel_discovery(btd_adapter_get_address(ext_io->adapter),\n\t\t\t\t\tdevice_get_address(ext_io->device));\n\n\tif (ext_io->adapter)\n\t\tbtd_adapter_unref(ext_io->adapter);\n\n\tif (ext_io->device)\n\t\tbtd_device_unref(ext_io->device);\n\n\tif (ext_io->service)\n\t\tbtd_service_unref(ext_io->service);\n\n\tg_free(ext_io);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_slist_remove",
          "args": [
            "ext->servers",
            "l2cap"
          ],
          "line": 1353
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ext_register_record",
          "args": [
            "ext",
            "l2cap",
            "rfcomm",
            "adapter"
          ],
          "line": 1349
        },
        "resolved": true,
        "details": {
          "function_name": "ext_register_record",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
          "lines": "1222-1255",
          "snippet": "static uint32_t ext_register_record(struct ext_profile *ext,\n\t\t\t\t\t\t\tstruct ext_io *l2cap,\n\t\t\t\t\t\t\tstruct ext_io *rfcomm,\n\t\t\t\t\t\t\tstruct btd_adapter *a)\n{\n\tsdp_record_t *rec;\n\tchar *dyn_record = NULL;\n\tconst char *record = ext->record;\n\n\tif (!record && ext->get_record) {\n\t\tdyn_record = ext->get_record(ext, l2cap, rfcomm);\n\t\trecord = dyn_record;\n\t}\n\n\tif (!record)\n\t\treturn 0;\n\n\trec = sdp_xml_parse_record(record, strlen(record));\n\n\tg_free(dyn_record);\n\n\tif (!rec) {\n\t\terror(\"Unable to parse record for %s\", ext->name);\n\t\treturn 0;\n\t}\n\n\tif (adapter_service_add(a, rec) < 0) {\n\t\terror(\"Failed to register service record\");\n\t\tsdp_record_free(rec);\n\t\treturn 0;\n\t}\n\n\treturn rec->handle;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdp-xml.h\"",
            "#include \"sdp-client.h\"",
            "#include \"dbus-common.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"btio/btio.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic uint32_t ext_register_record(struct ext_profile *ext,\n\t\t\t\t\t\t\tstruct ext_io *l2cap,\n\t\t\t\t\t\t\tstruct ext_io *rfcomm,\n\t\t\t\t\t\t\tstruct btd_adapter *a)\n{\n\tsdp_record_t *rec;\n\tchar *dyn_record = NULL;\n\tconst char *record = ext->record;\n\n\tif (!record && ext->get_record) {\n\t\tdyn_record = ext->get_record(ext, l2cap, rfcomm);\n\t\trecord = dyn_record;\n\t}\n\n\tif (!record)\n\t\treturn 0;\n\n\trec = sdp_xml_parse_record(record, strlen(record));\n\n\tg_free(dyn_record);\n\n\tif (!rec) {\n\t\terror(\"Unable to parse record for %s\", ext->name);\n\t\treturn 0;\n\t}\n\n\tif (adapter_service_add(a, rec) < 0) {\n\t\terror(\"Failed to register service record\");\n\t\tsdp_record_free(rec);\n\t\treturn 0;\n\t}\n\n\treturn rec->handle;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"%s listening on chan %u\"",
            "ext->name",
            "chan"
          ],
          "line": 1345
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_append",
          "args": [
            "ext->servers",
            "rfcomm"
          ],
          "line": 1344
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_adapter_ref",
          "args": [
            "adapter"
          ],
          "line": 1343
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_ref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "4898-4903",
          "snippet": "struct btd_adapter *btd_adapter_ref(struct btd_adapter *adapter)\n{\n\t__sync_fetch_and_add(&adapter->ref_count, 1);\n\n\treturn adapter;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nstruct btd_adapter *btd_adapter_ref(struct btd_adapter *adapter)\n{\n\t__sync_fetch_and_add(&adapter->ref_count, 1);\n\n\treturn adapter;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_io_get",
          "args": [
            "io",
            "NULL",
            "BT_IO_OPT_CHANNEL",
            "&chan",
            "BT_IO_OPT_INVALID"
          ],
          "line": 1338
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_clear_error",
          "args": [
            "&err"
          ],
          "line": 1334
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "rfcomm"
          ],
          "line": 1333
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"RFCOMM server failed for %s: %s\"",
            "ext->name",
            "err->message"
          ],
          "line": 1331
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/log.c",
          "lines": "199-213",
          "snippet": "void btd_error(uint16_t index, const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_ERR, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(index, LOG_ERR, format, ap);\n\tva_end(ap);\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdarg.h>",
            "#include <syslog.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int logging_fd = -1;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"src/shared/util.h\"\n#include \"lib/hci.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int logging_fd = -1;\n\nvoid btd_error(uint16_t index, const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_ERR, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(index, LOG_ERR, format, ap);\n\tva_end(ap);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_io_listen",
          "args": [
            "connect",
            "confirm",
            "rfcomm",
            "NULL",
            "&err",
            "BT_IO_OPT_SOURCE_BDADDR",
            "btd_adapter_get_address(adapter)",
            "BT_IO_OPT_CHANNEL",
            "chan",
            "BT_IO_OPT_SEC_LEVEL",
            "ext->sec_level",
            "BT_IO_OPT_INVALID"
          ],
          "line": 1324
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_adapter_get_address",
          "args": [
            "adapter"
          ],
          "line": 1326
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_get_address",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "5881-5884",
          "snippet": "const bdaddr_t *btd_adapter_get_address(struct btd_adapter *adapter)\n{\n\treturn &adapter->bdaddr;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nconst bdaddr_t *btd_adapter_get_address(struct btd_adapter *adapter)\n{\n\treturn &adapter->bdaddr;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_new0",
          "args": [
            "structext_io",
            "1"
          ],
          "line": 1321
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"%s listening on PSM %u\"",
            "ext->name",
            "psm"
          ],
          "line": 1309
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_append",
          "args": [
            "ext->servers",
            "l2cap"
          ],
          "line": 1308
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_io_get",
          "args": [
            "io",
            "NULL",
            "BT_IO_OPT_PSM",
            "&psm",
            "BT_IO_OPT_INVALID"
          ],
          "line": 1302
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_clear_error",
          "args": [
            "&err"
          ],
          "line": 1298
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "l2cap"
          ],
          "line": 1296
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_io_listen",
          "args": [
            "connect",
            "confirm",
            "l2cap",
            "NULL",
            "&err",
            "BT_IO_OPT_SOURCE_BDADDR",
            "btd_adapter_get_address(adapter)",
            "BT_IO_OPT_MODE",
            "ext->mode",
            "BT_IO_OPT_PSM",
            "psm",
            "BT_IO_OPT_SEC_LEVEL",
            "ext->sec_level",
            "BT_IO_OPT_INVALID"
          ],
          "line": 1286
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_new0",
          "args": [
            "structext_io",
            "1"
          ],
          "line": 1283
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic uint32_t ext_start_servers(struct ext_profile *ext,\n\t\t\t\t\t\tstruct btd_adapter *adapter)\n{\n\tstruct ext_io *l2cap = NULL;\n\tstruct ext_io *rfcomm = NULL;\n\tBtIOConfirm confirm;\n\tBtIOConnect connect;\n\tGError *err = NULL;\n\tGIOChannel *io;\n\n\tif (ext->authorize) {\n\t\tconfirm = ext_confirm;\n\t\tconnect = NULL;\n\t} else {\n\t\tconfirm = NULL;\n\t\tconnect = ext_direct_connect;\n\t}\n\n\tif (ext->local_psm) {\n\t\tuint16_t psm;\n\n\t\tif (ext->local_psm > 0)\n\t\t\tpsm = ext->local_psm;\n\t\telse\n\t\t\tpsm = 0;\n\n\t\tl2cap = g_new0(struct ext_io, 1);\n\t\tl2cap->ext = ext;\n\n\t\tio = bt_io_listen(connect, confirm, l2cap, NULL, &err,\n\t\t\t\t\tBT_IO_OPT_SOURCE_BDADDR,\n\t\t\t\t\tbtd_adapter_get_address(adapter),\n\t\t\t\t\tBT_IO_OPT_MODE, ext->mode,\n\t\t\t\t\tBT_IO_OPT_PSM, psm,\n\t\t\t\t\tBT_IO_OPT_SEC_LEVEL, ext->sec_level,\n\t\t\t\t\tBT_IO_OPT_INVALID);\n\t\tif (err != NULL) {\n\t\t\terror(\"L2CAP server failed for %s: %s\",\n\t\t\t\t\t\text->name, err->message);\n\t\t\tg_free(l2cap);\n\t\t\tl2cap = NULL;\n\t\t\tg_clear_error(&err);\n\t\t\tgoto failed;\n\t\t} else {\n\t\t\tif (psm == 0)\n\t\t\t\tbt_io_get(io, NULL, BT_IO_OPT_PSM, &psm,\n\t\t\t\t\t\t\tBT_IO_OPT_INVALID);\n\t\t\tl2cap->io = io;\n\t\t\tl2cap->proto = BTPROTO_L2CAP;\n\t\t\tl2cap->psm = psm;\n\t\t\tl2cap->adapter = btd_adapter_ref(adapter);\n\t\t\text->servers = g_slist_append(ext->servers, l2cap);\n\t\t\tDBG(\"%s listening on PSM %u\", ext->name, psm);\n\t\t}\n\t}\n\n\tif (ext->local_chan) {\n\t\tuint8_t chan;\n\n\t\tif (ext->local_chan > 0)\n\t\t\tchan = ext->local_chan;\n\t\telse\n\t\t\tchan = 0;\n\n\t\trfcomm = g_new0(struct ext_io, 1);\n\t\trfcomm->ext = ext;\n\n\t\tio = bt_io_listen(connect, confirm, rfcomm, NULL, &err,\n\t\t\t\t\tBT_IO_OPT_SOURCE_BDADDR,\n\t\t\t\t\tbtd_adapter_get_address(adapter),\n\t\t\t\t\tBT_IO_OPT_CHANNEL, chan,\n\t\t\t\t\tBT_IO_OPT_SEC_LEVEL, ext->sec_level,\n\t\t\t\t\tBT_IO_OPT_INVALID);\n\t\tif (err != NULL) {\n\t\t\terror(\"RFCOMM server failed for %s: %s\",\n\t\t\t\t\t\text->name, err->message);\n\t\t\tg_free(rfcomm);\n\t\t\tg_clear_error(&err);\n\t\t\tgoto failed;\n\t\t} else {\n\t\t\tif (chan == 0)\n\t\t\t\tbt_io_get(io, NULL, BT_IO_OPT_CHANNEL, &chan,\n\t\t\t\t\t\t\tBT_IO_OPT_INVALID);\n\t\t\trfcomm->io = io;\n\t\t\trfcomm->proto = BTPROTO_RFCOMM;\n\t\t\trfcomm->chan = chan;\n\t\t\trfcomm->adapter = btd_adapter_ref(adapter);\n\t\t\text->servers = g_slist_append(ext->servers, rfcomm);\n\t\t\tDBG(\"%s listening on chan %u\", ext->name, chan);\n\t\t}\n\t}\n\n\treturn ext_register_record(ext, l2cap, rfcomm, adapter);\n\nfailed:\n\tif (l2cap) {\n\t\text->servers = g_slist_remove(ext->servers, l2cap);\n\t\text_io_destroy(l2cap);\n\t}\n\n\treturn 0;\n}"
  },
  {
    "function_name": "ext_register_record",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
    "lines": "1222-1255",
    "snippet": "static uint32_t ext_register_record(struct ext_profile *ext,\n\t\t\t\t\t\t\tstruct ext_io *l2cap,\n\t\t\t\t\t\t\tstruct ext_io *rfcomm,\n\t\t\t\t\t\t\tstruct btd_adapter *a)\n{\n\tsdp_record_t *rec;\n\tchar *dyn_record = NULL;\n\tconst char *record = ext->record;\n\n\tif (!record && ext->get_record) {\n\t\tdyn_record = ext->get_record(ext, l2cap, rfcomm);\n\t\trecord = dyn_record;\n\t}\n\n\tif (!record)\n\t\treturn 0;\n\n\trec = sdp_xml_parse_record(record, strlen(record));\n\n\tg_free(dyn_record);\n\n\tif (!rec) {\n\t\terror(\"Unable to parse record for %s\", ext->name);\n\t\treturn 0;\n\t}\n\n\tif (adapter_service_add(a, rec) < 0) {\n\t\terror(\"Failed to register service record\");\n\t\tsdp_record_free(rec);\n\t\treturn 0;\n\t}\n\n\treturn rec->handle;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"sdp-xml.h\"",
      "#include \"sdp-client.h\"",
      "#include \"dbus-common.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"btio/btio.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sdp_record_free",
          "args": [
            "rec"
          ],
          "line": 1250
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Failed to register service record\""
          ],
          "line": 1249
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_not_ready",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "118-122",
          "snippet": "DBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_not_ready(DBusMessage *msg)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE \".NotReady\",\n\t\t\t\t\t\"Resource Not Ready\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "adapter_service_add",
          "args": [
            "a",
            "rec"
          ],
          "line": 1248
        },
        "resolved": true,
        "details": {
          "function_name": "adapter_service_add",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "1129-1142",
          "snippet": "int adapter_service_add(struct btd_adapter *adapter, sdp_record_t *rec)\n{\n\tint ret;\n\n\tDBG(\"%s\", adapter->path);\n\n\tret = add_record_to_server(&adapter->bdaddr, rec);\n\tif (ret < 0)\n\t\treturn ret;\n\n\tadapter_service_insert(adapter, rec);\n\n\treturn 0;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nint adapter_service_add(struct btd_adapter *adapter, sdp_record_t *rec)\n{\n\tint ret;\n\n\tDBG(\"%s\", adapter->path);\n\n\tret = add_record_to_server(&adapter->bdaddr, rec);\n\tif (ret < 0)\n\t\treturn ret;\n\n\tadapter_service_insert(adapter, rec);\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Unable to parse record for %s\"",
            "ext->name"
          ],
          "line": 1244
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "124-128",
          "snippet": "DBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "dyn_record"
          ],
          "line": 1241
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_xml_parse_record",
          "args": [
            "record",
            "strlen(record)"
          ],
          "line": 1239
        },
        "resolved": true,
        "details": {
          "function_name": "sdp_xml_parse_record",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdp-xml.c",
          "lines": "612-646",
          "snippet": "sdp_record_t *sdp_xml_parse_record(const char *data, int size)\n{\n\tGMarkupParseContext *ctx;\n\tstruct context_data *ctx_data;\n\tsdp_record_t *record;\n\n\tctx_data = malloc(sizeof(*ctx_data));\n\tif (!ctx_data)\n\t\treturn NULL;\n\n\trecord = sdp_record_alloc();\n\tif (!record) {\n\t\tfree(ctx_data);\n\t\treturn NULL;\n\t}\n\n\tmemset(ctx_data, 0, sizeof(*ctx_data));\n\tctx_data->record = record;\n\n\tctx = g_markup_parse_context_new(&parser, 0, ctx_data, NULL);\n\n\tif (g_markup_parse_context_parse(ctx, data, size, NULL) == FALSE) {\n\t\terror(\"XML parsing error\");\n\t\tg_markup_parse_context_free(ctx);\n\t\tsdp_record_free(record);\n\t\tfree(ctx_data);\n\t\treturn NULL;\n\t}\n\n\tg_markup_parse_context_free(ctx);\n\n\tfree(ctx_data);\n\n\treturn record;\n}",
          "includes": [
            "#include \"sdp-xml.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include <glib.h>",
            "#include <stdlib.h>",
            "#include <limits.h>",
            "#include <string.h>",
            "#include <ctype.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static GMarkupParser parser = {\n\telement_start, element_end, NULL, NULL, NULL\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"sdp-xml.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include <glib.h>\n#include <stdlib.h>\n#include <limits.h>\n#include <string.h>\n#include <ctype.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic GMarkupParser parser = {\n\telement_start, element_end, NULL, NULL, NULL\n};\n\nsdp_record_t *sdp_xml_parse_record(const char *data, int size)\n{\n\tGMarkupParseContext *ctx;\n\tstruct context_data *ctx_data;\n\tsdp_record_t *record;\n\n\tctx_data = malloc(sizeof(*ctx_data));\n\tif (!ctx_data)\n\t\treturn NULL;\n\n\trecord = sdp_record_alloc();\n\tif (!record) {\n\t\tfree(ctx_data);\n\t\treturn NULL;\n\t}\n\n\tmemset(ctx_data, 0, sizeof(*ctx_data));\n\tctx_data->record = record;\n\n\tctx = g_markup_parse_context_new(&parser, 0, ctx_data, NULL);\n\n\tif (g_markup_parse_context_parse(ctx, data, size, NULL) == FALSE) {\n\t\terror(\"XML parsing error\");\n\t\tg_markup_parse_context_free(ctx);\n\t\tsdp_record_free(record);\n\t\tfree(ctx_data);\n\t\treturn NULL;\n\t}\n\n\tg_markup_parse_context_free(ctx);\n\n\tfree(ctx_data);\n\n\treturn record;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "record"
          ],
          "line": 1239
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ext->get_record",
          "args": [
            "ext",
            "l2cap",
            "rfcomm"
          ],
          "line": 1232
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic uint32_t ext_register_record(struct ext_profile *ext,\n\t\t\t\t\t\t\tstruct ext_io *l2cap,\n\t\t\t\t\t\t\tstruct ext_io *rfcomm,\n\t\t\t\t\t\t\tstruct btd_adapter *a)\n{\n\tsdp_record_t *rec;\n\tchar *dyn_record = NULL;\n\tconst char *record = ext->record;\n\n\tif (!record && ext->get_record) {\n\t\tdyn_record = ext->get_record(ext, l2cap, rfcomm);\n\t\trecord = dyn_record;\n\t}\n\n\tif (!record)\n\t\treturn 0;\n\n\trec = sdp_xml_parse_record(record, strlen(record));\n\n\tg_free(dyn_record);\n\n\tif (!rec) {\n\t\terror(\"Unable to parse record for %s\", ext->name);\n\t\treturn 0;\n\t}\n\n\tif (adapter_service_add(a, rec) < 0) {\n\t\terror(\"Failed to register service record\");\n\t\tsdp_record_free(rec);\n\t\treturn 0;\n\t}\n\n\treturn rec->handle;\n}"
  },
  {
    "function_name": "ext_direct_connect",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
    "lines": "1194-1220",
    "snippet": "static void ext_direct_connect(GIOChannel *io, GError *err, gpointer user_data)\n{\n\tstruct ext_io *server = user_data;\n\tstruct ext_profile *ext = server->ext;\n\tGError *gerr = NULL;\n\tstruct ext_io *conn;\n\tbdaddr_t src, dst;\n\n\tbt_io_get(io, &gerr,\n\t\t\tBT_IO_OPT_SOURCE_BDADDR, &src,\n\t\t\tBT_IO_OPT_DEST_BDADDR, &dst,\n\t\t\tBT_IO_OPT_INVALID);\n\tif (gerr != NULL) {\n\t\terror(\"%s failed to get connect data: %s\", ext->name,\n\t\t\t\t\t\t\t\tgerr->message);\n\t\tg_error_free(gerr);\n\t\treturn;\n\t}\n\n\tconn = create_conn(server, io, &src, &dst);\n\tif (conn == NULL)\n\t\treturn;\n\n\text->conns = g_slist_append(ext->conns, conn);\n\n\text_connect(io, err, conn);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"sdp-xml.h\"",
      "#include \"sdp-client.h\"",
      "#include \"dbus-common.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"btio/btio.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ext_connect",
          "args": [
            "io",
            "err",
            "conn"
          ],
          "line": 1219
        },
        "resolved": true,
        "details": {
          "function_name": "ext_connect",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
          "lines": "1015-1066",
          "snippet": "static void ext_connect(GIOChannel *io, GError *err, gpointer user_data)\n{\n\tstruct ext_io *conn = user_data;\n\tstruct ext_profile *ext = conn->ext;\n\tGError *io_err = NULL;\n\tchar addr[18];\n\n\tif (!bt_io_get(io, &io_err,\n\t\t\t\tBT_IO_OPT_DEST, addr,\n\t\t\t\tBT_IO_OPT_INVALID)) {\n\t\terror(\"Unable to get connect data for %s: %s\", ext->name,\n\t\t\t\t\t\t\tio_err->message);\n\t\tif (err) {\n\t\t\tg_error_free(io_err);\n\t\t\tio_err = NULL;\n\t\t} else {\n\t\t\terr = io_err;\n\t\t}\n\t\tgoto drop;\n\t}\n\n\tif (err != NULL) {\n\t\terror(\"%s failed to connect to %s: %s\", ext->name, addr,\n\t\t\t\t\t\t\t\terr->message);\n\t\tgoto drop;\n\t}\n\n\tDBG(\"%s connected to %s\", ext->name, addr);\n\n\tif (conn->io_id == 0) {\n\t\tGIOCondition cond = G_IO_HUP | G_IO_ERR | G_IO_NVAL;\n\t\tconn->io_id = g_io_add_watch(io, cond, ext_io_disconnected,\n\t\t\t\t\t\t\t\t\tconn);\n\t}\n\n\tif (conn->service && service_set_connecting(conn->service) < 0)\n\t\tgoto drop;\n\n\tif (send_new_connection(ext, conn))\n\t\treturn;\n\ndrop:\n\tif (conn->service)\n\t\tbtd_service_connecting_complete(conn->service,\n\t\t\t\t\t\terr ? -err->code : -EIO);\n\n\tif (io_err)\n\t\tg_error_free(io_err);\n\n\text->conns = g_slist_remove(ext->conns, conn);\n\text_io_destroy(conn);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdp-xml.h\"",
            "#include \"sdp-client.h\"",
            "#include \"dbus-common.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"btio/btio.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void ext_connect(GIOChannel *io, GError *err, gpointer user_data)\n{\n\tstruct ext_io *conn = user_data;\n\tstruct ext_profile *ext = conn->ext;\n\tGError *io_err = NULL;\n\tchar addr[18];\n\n\tif (!bt_io_get(io, &io_err,\n\t\t\t\tBT_IO_OPT_DEST, addr,\n\t\t\t\tBT_IO_OPT_INVALID)) {\n\t\terror(\"Unable to get connect data for %s: %s\", ext->name,\n\t\t\t\t\t\t\tio_err->message);\n\t\tif (err) {\n\t\t\tg_error_free(io_err);\n\t\t\tio_err = NULL;\n\t\t} else {\n\t\t\terr = io_err;\n\t\t}\n\t\tgoto drop;\n\t}\n\n\tif (err != NULL) {\n\t\terror(\"%s failed to connect to %s: %s\", ext->name, addr,\n\t\t\t\t\t\t\t\terr->message);\n\t\tgoto drop;\n\t}\n\n\tDBG(\"%s connected to %s\", ext->name, addr);\n\n\tif (conn->io_id == 0) {\n\t\tGIOCondition cond = G_IO_HUP | G_IO_ERR | G_IO_NVAL;\n\t\tconn->io_id = g_io_add_watch(io, cond, ext_io_disconnected,\n\t\t\t\t\t\t\t\t\tconn);\n\t}\n\n\tif (conn->service && service_set_connecting(conn->service) < 0)\n\t\tgoto drop;\n\n\tif (send_new_connection(ext, conn))\n\t\treturn;\n\ndrop:\n\tif (conn->service)\n\t\tbtd_service_connecting_complete(conn->service,\n\t\t\t\t\t\terr ? -err->code : -EIO);\n\n\tif (io_err)\n\t\tg_error_free(io_err);\n\n\text->conns = g_slist_remove(ext->conns, conn);\n\text_io_destroy(conn);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_slist_append",
          "args": [
            "ext->conns",
            "conn"
          ],
          "line": 1217
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "create_conn",
          "args": [
            "server",
            "io",
            "&src",
            "&dst"
          ],
          "line": 1213
        },
        "resolved": true,
        "details": {
          "function_name": "create_conn",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
          "lines": "1105-1151",
          "snippet": "static struct ext_io *create_conn(struct ext_io *server, GIOChannel *io,\n\t\t\t\t\t\tbdaddr_t *src, bdaddr_t *dst)\n{\n\tstruct btd_device *device;\n\tstruct btd_service *service;\n\tstruct ext_io *conn;\n\tGIOCondition cond;\n\tchar addr[18];\n\n\tdevice = btd_adapter_find_device(server->adapter, dst, BDADDR_BREDR);\n\tif (device == NULL) {\n\t\tba2str(dst, addr);\n\t\terror(\"%s device %s not found\", server->ext->name, addr);\n\t\treturn NULL;\n\t}\n\n\t/* Do not add UUID if client role is not enabled */\n\tif (!server->ext->enable_client) {\n\t\tservice = NULL;\n\t\tgoto done;\n\t}\n\n\tbtd_device_add_uuid(device, server->ext->remote_uuid);\n\tservice = btd_device_get_service(device, server->ext->remote_uuid);\n\tif (service == NULL) {\n\t\tba2str(dst, addr);\n\t\terror(\"%s service not found for device %s\", server->ext->name,\n\t\t\t\t\t\t\t\t\taddr);\n\t\treturn NULL;\n\t}\n\ndone:\n\tconn = g_new0(struct ext_io, 1);\n\tconn->io = g_io_channel_ref(io);\n\tconn->proto = server->proto;\n\tconn->ext = server->ext;\n\tconn->adapter = btd_adapter_ref(server->adapter);\n\tconn->device = btd_device_ref(device);\n\n\tif (service)\n\t\tconn->service = btd_service_ref(service);\n\n\tcond = G_IO_HUP | G_IO_ERR | G_IO_NVAL;\n\tconn->io_id = g_io_add_watch(io, cond, ext_io_disconnected, conn);\n\n\treturn conn;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdp-xml.h\"",
            "#include \"sdp-client.h\"",
            "#include \"dbus-common.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"btio/btio.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic struct ext_io *create_conn(struct ext_io *server, GIOChannel *io,\n\t\t\t\t\t\tbdaddr_t *src, bdaddr_t *dst)\n{\n\tstruct btd_device *device;\n\tstruct btd_service *service;\n\tstruct ext_io *conn;\n\tGIOCondition cond;\n\tchar addr[18];\n\n\tdevice = btd_adapter_find_device(server->adapter, dst, BDADDR_BREDR);\n\tif (device == NULL) {\n\t\tba2str(dst, addr);\n\t\terror(\"%s device %s not found\", server->ext->name, addr);\n\t\treturn NULL;\n\t}\n\n\t/* Do not add UUID if client role is not enabled */\n\tif (!server->ext->enable_client) {\n\t\tservice = NULL;\n\t\tgoto done;\n\t}\n\n\tbtd_device_add_uuid(device, server->ext->remote_uuid);\n\tservice = btd_device_get_service(device, server->ext->remote_uuid);\n\tif (service == NULL) {\n\t\tba2str(dst, addr);\n\t\terror(\"%s service not found for device %s\", server->ext->name,\n\t\t\t\t\t\t\t\t\taddr);\n\t\treturn NULL;\n\t}\n\ndone:\n\tconn = g_new0(struct ext_io, 1);\n\tconn->io = g_io_channel_ref(io);\n\tconn->proto = server->proto;\n\tconn->ext = server->ext;\n\tconn->adapter = btd_adapter_ref(server->adapter);\n\tconn->device = btd_device_ref(device);\n\n\tif (service)\n\t\tconn->service = btd_service_ref(service);\n\n\tcond = G_IO_HUP | G_IO_ERR | G_IO_NVAL;\n\tconn->io_id = g_io_add_watch(io, cond, ext_io_disconnected, conn);\n\n\treturn conn;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_error_free",
          "args": [
            "gerr"
          ],
          "line": 1209
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"%s failed to get connect data: %s\"",
            "ext->name",
            "gerr->message"
          ],
          "line": 1207
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/log.c",
          "lines": "199-213",
          "snippet": "void btd_error(uint16_t index, const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_ERR, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(index, LOG_ERR, format, ap);\n\tva_end(ap);\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdarg.h>",
            "#include <syslog.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int logging_fd = -1;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"src/shared/util.h\"\n#include \"lib/hci.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int logging_fd = -1;\n\nvoid btd_error(uint16_t index, const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_ERR, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(index, LOG_ERR, format, ap);\n\tva_end(ap);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_io_get",
          "args": [
            "io",
            "&gerr",
            "BT_IO_OPT_SOURCE_BDADDR",
            "&src",
            "BT_IO_OPT_DEST_BDADDR",
            "&dst",
            "BT_IO_OPT_INVALID"
          ],
          "line": 1202
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void ext_direct_connect(GIOChannel *io, GError *err, gpointer user_data)\n{\n\tstruct ext_io *server = user_data;\n\tstruct ext_profile *ext = server->ext;\n\tGError *gerr = NULL;\n\tstruct ext_io *conn;\n\tbdaddr_t src, dst;\n\n\tbt_io_get(io, &gerr,\n\t\t\tBT_IO_OPT_SOURCE_BDADDR, &src,\n\t\t\tBT_IO_OPT_DEST_BDADDR, &dst,\n\t\t\tBT_IO_OPT_INVALID);\n\tif (gerr != NULL) {\n\t\terror(\"%s failed to get connect data: %s\", ext->name,\n\t\t\t\t\t\t\t\tgerr->message);\n\t\tg_error_free(gerr);\n\t\treturn;\n\t}\n\n\tconn = create_conn(server, io, &src, &dst);\n\tif (conn == NULL)\n\t\treturn;\n\n\text->conns = g_slist_append(ext->conns, conn);\n\n\text_connect(io, err, conn);\n}"
  },
  {
    "function_name": "ext_confirm",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
    "lines": "1153-1192",
    "snippet": "static void ext_confirm(GIOChannel *io, gpointer user_data)\n{\n\tstruct ext_io *server = user_data;\n\tstruct ext_profile *ext = server->ext;\n\tconst char *uuid = ext->service ? ext->service : ext->uuid;\n\tstruct ext_io *conn;\n\tGError *gerr = NULL;\n\tbdaddr_t src, dst;\n\tchar addr[18];\n\n\tbt_io_get(io, &gerr,\n\t\t\tBT_IO_OPT_SOURCE_BDADDR, &src,\n\t\t\tBT_IO_OPT_DEST_BDADDR, &dst,\n\t\t\tBT_IO_OPT_DEST, addr,\n\t\t\tBT_IO_OPT_INVALID);\n\tif (gerr != NULL) {\n\t\terror(\"%s failed to get connect data: %s\", ext->name,\n\t\t\t\t\t\t\t\tgerr->message);\n\t\tg_error_free(gerr);\n\t\treturn;\n\t}\n\n\tDBG(\"incoming connect from %s\", addr);\n\n\tconn = create_conn(server, io, &src, &dst);\n\tif (conn == NULL)\n\t\treturn;\n\n\tconn->auth_id = btd_request_authorization(&src, &dst, uuid, ext_auth,\n\t\t\t\t\t\t\t\t\tconn);\n\tif (conn->auth_id == 0) {\n\t\terror(\"%s authorization failure\", ext->name);\n\t\text_io_destroy(conn);\n\t\treturn;\n\t}\n\n\text->conns = g_slist_append(ext->conns, conn);\n\n\tDBG(\"%s authorizing connection from %s\", ext->name, addr);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"sdp-xml.h\"",
      "#include \"sdp-client.h\"",
      "#include \"dbus-common.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"btio/btio.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"%s authorizing connection from %s\"",
            "ext->name",
            "addr"
          ],
          "line": 1191
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_append",
          "args": [
            "ext->conns",
            "conn"
          ],
          "line": 1189
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ext_io_destroy",
          "args": [
            "conn"
          ],
          "line": 1185
        },
        "resolved": true,
        "details": {
          "function_name": "ext_io_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
          "lines": "749-783",
          "snippet": "static void ext_io_destroy(gpointer p)\n{\n\tstruct ext_io *ext_io = p;\n\n\tif (ext_io->io_id > 0)\n\t\tg_source_remove(ext_io->io_id);\n\n\tif (ext_io->io) {\n\t\tg_io_channel_shutdown(ext_io->io, FALSE, NULL);\n\t\tg_io_channel_unref(ext_io->io);\n\t}\n\n\tif (ext_io->auth_id != 0)\n\t\tbtd_cancel_authorization(ext_io->auth_id);\n\n\tif (ext_io->pending) {\n\t\tdbus_pending_call_cancel(ext_io->pending);\n\t\tdbus_pending_call_unref(ext_io->pending);\n\t}\n\n\tif (ext_io->resolving)\n\t\tbt_cancel_discovery(btd_adapter_get_address(ext_io->adapter),\n\t\t\t\t\tdevice_get_address(ext_io->device));\n\n\tif (ext_io->adapter)\n\t\tbtd_adapter_unref(ext_io->adapter);\n\n\tif (ext_io->device)\n\t\tbtd_device_unref(ext_io->device);\n\n\tif (ext_io->service)\n\t\tbtd_service_unref(ext_io->service);\n\n\tg_free(ext_io);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdp-xml.h\"",
            "#include \"sdp-client.h\"",
            "#include \"dbus-common.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"btio/btio.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void ext_io_destroy(gpointer p)\n{\n\tstruct ext_io *ext_io = p;\n\n\tif (ext_io->io_id > 0)\n\t\tg_source_remove(ext_io->io_id);\n\n\tif (ext_io->io) {\n\t\tg_io_channel_shutdown(ext_io->io, FALSE, NULL);\n\t\tg_io_channel_unref(ext_io->io);\n\t}\n\n\tif (ext_io->auth_id != 0)\n\t\tbtd_cancel_authorization(ext_io->auth_id);\n\n\tif (ext_io->pending) {\n\t\tdbus_pending_call_cancel(ext_io->pending);\n\t\tdbus_pending_call_unref(ext_io->pending);\n\t}\n\n\tif (ext_io->resolving)\n\t\tbt_cancel_discovery(btd_adapter_get_address(ext_io->adapter),\n\t\t\t\t\tdevice_get_address(ext_io->device));\n\n\tif (ext_io->adapter)\n\t\tbtd_adapter_unref(ext_io->adapter);\n\n\tif (ext_io->device)\n\t\tbtd_device_unref(ext_io->device);\n\n\tif (ext_io->service)\n\t\tbtd_service_unref(ext_io->service);\n\n\tg_free(ext_io);\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"%s authorization failure\"",
            "ext->name"
          ],
          "line": 1184
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "124-128",
          "snippet": "DBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_request_authorization",
          "args": [
            "&src",
            "&dst",
            "uuid",
            "ext_auth",
            "conn"
          ],
          "line": 1181
        },
        "resolved": true,
        "details": {
          "function_name": "btd_request_authorization_cable_configured",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "6582-6597",
          "snippet": "guint btd_request_authorization_cable_configured(const bdaddr_t *src, const bdaddr_t *dst,\n\t\t\t\t\t\tconst char *uuid, service_auth_cb cb,\n\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct btd_adapter *adapter;\n\n\tif (bacmp(src, BDADDR_ANY) == 0)\n\t\treturn 0;\n\n\tadapter = adapter_find(src);\n\tif (!adapter)\n\t\treturn 0;\n\n\treturn adapter_authorize(adapter, dst, uuid,\n\t\t\tADAPTER_AUTHORIZE_DISCONNECTED, cb, user_data);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static gboolean process_auth_queue(gpointer user_data);",
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic gboolean process_auth_queue(gpointer user_data);\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nguint btd_request_authorization_cable_configured(const bdaddr_t *src, const bdaddr_t *dst,\n\t\t\t\t\t\tconst char *uuid, service_auth_cb cb,\n\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct btd_adapter *adapter;\n\n\tif (bacmp(src, BDADDR_ANY) == 0)\n\t\treturn 0;\n\n\tadapter = adapter_find(src);\n\tif (!adapter)\n\t\treturn 0;\n\n\treturn adapter_authorize(adapter, dst, uuid,\n\t\t\tADAPTER_AUTHORIZE_DISCONNECTED, cb, user_data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "create_conn",
          "args": [
            "server",
            "io",
            "&src",
            "&dst"
          ],
          "line": 1177
        },
        "resolved": true,
        "details": {
          "function_name": "create_conn",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
          "lines": "1105-1151",
          "snippet": "static struct ext_io *create_conn(struct ext_io *server, GIOChannel *io,\n\t\t\t\t\t\tbdaddr_t *src, bdaddr_t *dst)\n{\n\tstruct btd_device *device;\n\tstruct btd_service *service;\n\tstruct ext_io *conn;\n\tGIOCondition cond;\n\tchar addr[18];\n\n\tdevice = btd_adapter_find_device(server->adapter, dst, BDADDR_BREDR);\n\tif (device == NULL) {\n\t\tba2str(dst, addr);\n\t\terror(\"%s device %s not found\", server->ext->name, addr);\n\t\treturn NULL;\n\t}\n\n\t/* Do not add UUID if client role is not enabled */\n\tif (!server->ext->enable_client) {\n\t\tservice = NULL;\n\t\tgoto done;\n\t}\n\n\tbtd_device_add_uuid(device, server->ext->remote_uuid);\n\tservice = btd_device_get_service(device, server->ext->remote_uuid);\n\tif (service == NULL) {\n\t\tba2str(dst, addr);\n\t\terror(\"%s service not found for device %s\", server->ext->name,\n\t\t\t\t\t\t\t\t\taddr);\n\t\treturn NULL;\n\t}\n\ndone:\n\tconn = g_new0(struct ext_io, 1);\n\tconn->io = g_io_channel_ref(io);\n\tconn->proto = server->proto;\n\tconn->ext = server->ext;\n\tconn->adapter = btd_adapter_ref(server->adapter);\n\tconn->device = btd_device_ref(device);\n\n\tif (service)\n\t\tconn->service = btd_service_ref(service);\n\n\tcond = G_IO_HUP | G_IO_ERR | G_IO_NVAL;\n\tconn->io_id = g_io_add_watch(io, cond, ext_io_disconnected, conn);\n\n\treturn conn;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdp-xml.h\"",
            "#include \"sdp-client.h\"",
            "#include \"dbus-common.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"btio/btio.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic struct ext_io *create_conn(struct ext_io *server, GIOChannel *io,\n\t\t\t\t\t\tbdaddr_t *src, bdaddr_t *dst)\n{\n\tstruct btd_device *device;\n\tstruct btd_service *service;\n\tstruct ext_io *conn;\n\tGIOCondition cond;\n\tchar addr[18];\n\n\tdevice = btd_adapter_find_device(server->adapter, dst, BDADDR_BREDR);\n\tif (device == NULL) {\n\t\tba2str(dst, addr);\n\t\terror(\"%s device %s not found\", server->ext->name, addr);\n\t\treturn NULL;\n\t}\n\n\t/* Do not add UUID if client role is not enabled */\n\tif (!server->ext->enable_client) {\n\t\tservice = NULL;\n\t\tgoto done;\n\t}\n\n\tbtd_device_add_uuid(device, server->ext->remote_uuid);\n\tservice = btd_device_get_service(device, server->ext->remote_uuid);\n\tif (service == NULL) {\n\t\tba2str(dst, addr);\n\t\terror(\"%s service not found for device %s\", server->ext->name,\n\t\t\t\t\t\t\t\t\taddr);\n\t\treturn NULL;\n\t}\n\ndone:\n\tconn = g_new0(struct ext_io, 1);\n\tconn->io = g_io_channel_ref(io);\n\tconn->proto = server->proto;\n\tconn->ext = server->ext;\n\tconn->adapter = btd_adapter_ref(server->adapter);\n\tconn->device = btd_device_ref(device);\n\n\tif (service)\n\t\tconn->service = btd_service_ref(service);\n\n\tcond = G_IO_HUP | G_IO_ERR | G_IO_NVAL;\n\tconn->io_id = g_io_add_watch(io, cond, ext_io_disconnected, conn);\n\n\treturn conn;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"incoming connect from %s\"",
            "addr"
          ],
          "line": 1175
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_error_free",
          "args": [
            "gerr"
          ],
          "line": 1171
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"%s failed to get connect data: %s\"",
            "ext->name",
            "gerr->message"
          ],
          "line": 1169
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/log.c",
          "lines": "199-213",
          "snippet": "void btd_error(uint16_t index, const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_ERR, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(index, LOG_ERR, format, ap);\n\tva_end(ap);\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdarg.h>",
            "#include <syslog.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int logging_fd = -1;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"src/shared/util.h\"\n#include \"lib/hci.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int logging_fd = -1;\n\nvoid btd_error(uint16_t index, const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_ERR, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(index, LOG_ERR, format, ap);\n\tva_end(ap);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_io_get",
          "args": [
            "io",
            "&gerr",
            "BT_IO_OPT_SOURCE_BDADDR",
            "&src",
            "BT_IO_OPT_DEST_BDADDR",
            "&dst",
            "BT_IO_OPT_DEST",
            "addr",
            "BT_IO_OPT_INVALID"
          ],
          "line": 1163
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void ext_confirm(GIOChannel *io, gpointer user_data)\n{\n\tstruct ext_io *server = user_data;\n\tstruct ext_profile *ext = server->ext;\n\tconst char *uuid = ext->service ? ext->service : ext->uuid;\n\tstruct ext_io *conn;\n\tGError *gerr = NULL;\n\tbdaddr_t src, dst;\n\tchar addr[18];\n\n\tbt_io_get(io, &gerr,\n\t\t\tBT_IO_OPT_SOURCE_BDADDR, &src,\n\t\t\tBT_IO_OPT_DEST_BDADDR, &dst,\n\t\t\tBT_IO_OPT_DEST, addr,\n\t\t\tBT_IO_OPT_INVALID);\n\tif (gerr != NULL) {\n\t\terror(\"%s failed to get connect data: %s\", ext->name,\n\t\t\t\t\t\t\t\tgerr->message);\n\t\tg_error_free(gerr);\n\t\treturn;\n\t}\n\n\tDBG(\"incoming connect from %s\", addr);\n\n\tconn = create_conn(server, io, &src, &dst);\n\tif (conn == NULL)\n\t\treturn;\n\n\tconn->auth_id = btd_request_authorization(&src, &dst, uuid, ext_auth,\n\t\t\t\t\t\t\t\t\tconn);\n\tif (conn->auth_id == 0) {\n\t\terror(\"%s authorization failure\", ext->name);\n\t\text_io_destroy(conn);\n\t\treturn;\n\t}\n\n\text->conns = g_slist_append(ext->conns, conn);\n\n\tDBG(\"%s authorizing connection from %s\", ext->name, addr);\n}"
  },
  {
    "function_name": "create_conn",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
    "lines": "1105-1151",
    "snippet": "static struct ext_io *create_conn(struct ext_io *server, GIOChannel *io,\n\t\t\t\t\t\tbdaddr_t *src, bdaddr_t *dst)\n{\n\tstruct btd_device *device;\n\tstruct btd_service *service;\n\tstruct ext_io *conn;\n\tGIOCondition cond;\n\tchar addr[18];\n\n\tdevice = btd_adapter_find_device(server->adapter, dst, BDADDR_BREDR);\n\tif (device == NULL) {\n\t\tba2str(dst, addr);\n\t\terror(\"%s device %s not found\", server->ext->name, addr);\n\t\treturn NULL;\n\t}\n\n\t/* Do not add UUID if client role is not enabled */\n\tif (!server->ext->enable_client) {\n\t\tservice = NULL;\n\t\tgoto done;\n\t}\n\n\tbtd_device_add_uuid(device, server->ext->remote_uuid);\n\tservice = btd_device_get_service(device, server->ext->remote_uuid);\n\tif (service == NULL) {\n\t\tba2str(dst, addr);\n\t\terror(\"%s service not found for device %s\", server->ext->name,\n\t\t\t\t\t\t\t\t\taddr);\n\t\treturn NULL;\n\t}\n\ndone:\n\tconn = g_new0(struct ext_io, 1);\n\tconn->io = g_io_channel_ref(io);\n\tconn->proto = server->proto;\n\tconn->ext = server->ext;\n\tconn->adapter = btd_adapter_ref(server->adapter);\n\tconn->device = btd_device_ref(device);\n\n\tif (service)\n\t\tconn->service = btd_service_ref(service);\n\n\tcond = G_IO_HUP | G_IO_ERR | G_IO_NVAL;\n\tconn->io_id = g_io_add_watch(io, cond, ext_io_disconnected, conn);\n\n\treturn conn;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"sdp-xml.h\"",
      "#include \"sdp-client.h\"",
      "#include \"dbus-common.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"btio/btio.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_io_add_watch",
          "args": [
            "io",
            "cond",
            "ext_io_disconnected",
            "conn"
          ],
          "line": 1148
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_service_ref",
          "args": [
            "service"
          ],
          "line": 1145
        },
        "resolved": true,
        "details": {
          "function_name": "btd_service_ref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
          "lines": "113-120",
          "snippet": "struct btd_service *btd_service_ref(struct btd_service *service)\n{\n\tservice->ref++;\n\n\tDBG(\"%p: ref=%d\", service, service->ref);\n\n\treturn service;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/stat.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstruct btd_service *btd_service_ref(struct btd_service *service)\n{\n\tservice->ref++;\n\n\tDBG(\"%p: ref=%d\", service, service->ref);\n\n\treturn service;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_device_ref",
          "args": [
            "device"
          ],
          "line": 1142
        },
        "resolved": true,
        "details": {
          "function_name": "btd_device_ref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "6357-6362",
          "snippet": "struct btd_device *btd_device_ref(struct btd_device *device)\n{\n\t__sync_fetch_and_add(&device->ref_count, 1);\n\n\treturn device;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nstruct btd_device *btd_device_ref(struct btd_device *device)\n{\n\t__sync_fetch_and_add(&device->ref_count, 1);\n\n\treturn device;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_adapter_ref",
          "args": [
            "server->adapter"
          ],
          "line": 1141
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_ref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "4898-4903",
          "snippet": "struct btd_adapter *btd_adapter_ref(struct btd_adapter *adapter)\n{\n\t__sync_fetch_and_add(&adapter->ref_count, 1);\n\n\treturn adapter;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nstruct btd_adapter *btd_adapter_ref(struct btd_adapter *adapter)\n{\n\t__sync_fetch_and_add(&adapter->ref_count, 1);\n\n\treturn adapter;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_io_channel_ref",
          "args": [
            "io"
          ],
          "line": 1138
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_new0",
          "args": [
            "structext_io",
            "1"
          ],
          "line": 1137
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"%s service not found for device %s\"",
            "server->ext->name",
            "addr"
          ],
          "line": 1131
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/log.c",
          "lines": "199-213",
          "snippet": "void btd_error(uint16_t index, const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_ERR, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(index, LOG_ERR, format, ap);\n\tva_end(ap);\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdarg.h>",
            "#include <syslog.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int logging_fd = -1;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"src/shared/util.h\"\n#include \"lib/hci.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int logging_fd = -1;\n\nvoid btd_error(uint16_t index, const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_ERR, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(index, LOG_ERR, format, ap);\n\tva_end(ap);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ba2str",
          "args": [
            "dst",
            "addr"
          ],
          "line": 1130
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_device_get_service",
          "args": [
            "device",
            "server->ext->remote_uuid"
          ],
          "line": 1128
        },
        "resolved": true,
        "details": {
          "function_name": "btd_device_get_service",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "6448-6462",
          "snippet": "struct btd_service *btd_device_get_service(struct btd_device *dev,\n\t\t\t\t\t\tconst char *remote_uuid)\n{\n\tGSList *l;\n\n\tfor (l = dev->services; l != NULL; l = g_slist_next(l)) {\n\t\tstruct btd_service *service = l->data;\n\t\tstruct btd_profile *p = btd_service_get_profile(service);\n\n\t\tif (g_str_equal(p->remote_uuid, remote_uuid))\n\t\t\treturn service;\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstruct btd_service *btd_device_get_service(struct btd_device *dev,\n\t\t\t\t\t\tconst char *remote_uuid)\n{\n\tGSList *l;\n\n\tfor (l = dev->services; l != NULL; l = g_slist_next(l)) {\n\t\tstruct btd_service *service = l->data;\n\t\tstruct btd_profile *p = btd_service_get_profile(service);\n\n\t\tif (g_str_equal(p->remote_uuid, remote_uuid))\n\t\t\treturn service;\n\t}\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_device_add_uuid",
          "args": [
            "device",
            "server->ext->remote_uuid"
          ],
          "line": 1127
        },
        "resolved": true,
        "details": {
          "function_name": "btd_device_add_uuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "6253-6273",
          "snippet": "void btd_device_add_uuid(struct btd_device *device, const char *uuid)\n{\n\tGSList *uuid_list;\n\tchar *new_uuid;\n\n\tif (g_slist_find_custom(device->uuids, uuid, bt_uuid_strcmp))\n\t\treturn;\n\n\tnew_uuid = g_strdup(uuid);\n\tuuid_list = g_slist_append(NULL, new_uuid);\n\n\tdevice_probe_profiles(device, uuid_list);\n\n\tg_free(new_uuid);\n\tg_slist_free(uuid_list);\n\n\tstore_device_info(device);\n\n\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"UUIDs\");\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *dbus_conn = NULL;",
            "static const uint16_t uuid_list[] = {\n\tL2CAP_UUID,\n\tPNP_INFO_SVCLASS_ID,\n\tPUBLIC_BROWSE_GROUP,\n\t0\n};",
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic const uint16_t uuid_list[] = {\n\tL2CAP_UUID,\n\tPNP_INFO_SVCLASS_ID,\n\tPUBLIC_BROWSE_GROUP,\n\t0\n};\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid btd_device_add_uuid(struct btd_device *device, const char *uuid)\n{\n\tGSList *uuid_list;\n\tchar *new_uuid;\n\n\tif (g_slist_find_custom(device->uuids, uuid, bt_uuid_strcmp))\n\t\treturn;\n\n\tnew_uuid = g_strdup(uuid);\n\tuuid_list = g_slist_append(NULL, new_uuid);\n\n\tdevice_probe_profiles(device, uuid_list);\n\n\tg_free(new_uuid);\n\tg_slist_free(uuid_list);\n\n\tstore_device_info(device);\n\n\tg_dbus_emit_property_changed(dbus_conn, device->path,\n\t\t\t\t\t\tDEVICE_INTERFACE, \"UUIDs\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "ba2str",
          "args": [
            "dst",
            "addr"
          ],
          "line": 1116
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_adapter_find_device",
          "args": [
            "server->adapter",
            "dst",
            "BDADDR_BREDR"
          ],
          "line": 1114
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_find_device",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "831-863",
          "snippet": "struct btd_device *btd_adapter_find_device(struct btd_adapter *adapter,\n\t\t\t\t\t\t\tconst bdaddr_t *dst,\n\t\t\t\t\t\t\tuint8_t bdaddr_type)\n{\n\tstruct device_addr_type addr;\n\tstruct btd_device *device;\n\tGSList *list;\n\n\tif (!adapter)\n\t\treturn NULL;\n\n\tbacpy(&addr.bdaddr, dst);\n\taddr.bdaddr_type = bdaddr_type;\n\n\tlist = g_slist_find_custom(adapter->devices, &addr,\n\t\t\t\t\t\t\tdevice_addr_type_cmp);\n\tif (!list)\n\t\treturn NULL;\n\n\tdevice = list->data;\n\n\t/*\n\t * If we're looking up based on public address and the address\n\t * was not previously used over this bearer we may need to\n\t * update LE or BR/EDR support information.\n\t */\n\tif (bdaddr_type == BDADDR_BREDR)\n\t\tdevice_set_bredr_support(device);\n\telse\n\t\tdevice_set_le_support(device, bdaddr_type);\n\n\treturn device;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nstruct btd_device *btd_adapter_find_device(struct btd_adapter *adapter,\n\t\t\t\t\t\t\tconst bdaddr_t *dst,\n\t\t\t\t\t\t\tuint8_t bdaddr_type)\n{\n\tstruct device_addr_type addr;\n\tstruct btd_device *device;\n\tGSList *list;\n\n\tif (!adapter)\n\t\treturn NULL;\n\n\tbacpy(&addr.bdaddr, dst);\n\taddr.bdaddr_type = bdaddr_type;\n\n\tlist = g_slist_find_custom(adapter->devices, &addr,\n\t\t\t\t\t\t\tdevice_addr_type_cmp);\n\tif (!list)\n\t\treturn NULL;\n\n\tdevice = list->data;\n\n\t/*\n\t * If we're looking up based on public address and the address\n\t * was not previously used over this bearer we may need to\n\t * update LE or BR/EDR support information.\n\t */\n\tif (bdaddr_type == BDADDR_BREDR)\n\t\tdevice_set_bredr_support(device);\n\telse\n\t\tdevice_set_le_support(device, bdaddr_type);\n\n\treturn device;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic struct ext_io *create_conn(struct ext_io *server, GIOChannel *io,\n\t\t\t\t\t\tbdaddr_t *src, bdaddr_t *dst)\n{\n\tstruct btd_device *device;\n\tstruct btd_service *service;\n\tstruct ext_io *conn;\n\tGIOCondition cond;\n\tchar addr[18];\n\n\tdevice = btd_adapter_find_device(server->adapter, dst, BDADDR_BREDR);\n\tif (device == NULL) {\n\t\tba2str(dst, addr);\n\t\terror(\"%s device %s not found\", server->ext->name, addr);\n\t\treturn NULL;\n\t}\n\n\t/* Do not add UUID if client role is not enabled */\n\tif (!server->ext->enable_client) {\n\t\tservice = NULL;\n\t\tgoto done;\n\t}\n\n\tbtd_device_add_uuid(device, server->ext->remote_uuid);\n\tservice = btd_device_get_service(device, server->ext->remote_uuid);\n\tif (service == NULL) {\n\t\tba2str(dst, addr);\n\t\terror(\"%s service not found for device %s\", server->ext->name,\n\t\t\t\t\t\t\t\t\taddr);\n\t\treturn NULL;\n\t}\n\ndone:\n\tconn = g_new0(struct ext_io, 1);\n\tconn->io = g_io_channel_ref(io);\n\tconn->proto = server->proto;\n\tconn->ext = server->ext;\n\tconn->adapter = btd_adapter_ref(server->adapter);\n\tconn->device = btd_device_ref(device);\n\n\tif (service)\n\t\tconn->service = btd_service_ref(service);\n\n\tcond = G_IO_HUP | G_IO_ERR | G_IO_NVAL;\n\tconn->io_id = g_io_add_watch(io, cond, ext_io_disconnected, conn);\n\n\treturn conn;\n}"
  },
  {
    "function_name": "ext_auth",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
    "lines": "1068-1103",
    "snippet": "static void ext_auth(DBusError *err, void *user_data)\n{\n\tstruct ext_io *conn = user_data;\n\tstruct ext_profile *ext = conn->ext;\n\tGError *gerr = NULL;\n\tchar addr[18];\n\n\tconn->auth_id = 0;\n\n\tbt_io_get(conn->io, &gerr, BT_IO_OPT_DEST, addr, BT_IO_OPT_INVALID);\n\tif (gerr != NULL) {\n\t\terror(\"Unable to get connect data for %s: %s\",\n\t\t\t\t\t\text->name, gerr->message);\n\t\tg_error_free(gerr);\n\t\tgoto drop;\n\t}\n\n\tif (err && dbus_error_is_set(err)) {\n\t\terror(\"%s rejected %s: %s\", ext->name, addr, err->message);\n\t\tgoto drop;\n\t}\n\n\tif (!bt_io_accept(conn->io, ext_connect, conn, NULL, &gerr)) {\n\t\terror(\"bt_io_accept: %s\", gerr->message);\n\t\tg_error_free(gerr);\n\t\tgoto drop;\n\t}\n\n\tDBG(\"%s authorized to connect to %s\", addr, ext->name);\n\n\treturn;\n\ndrop:\n\text->conns = g_slist_remove(ext->conns, conn);\n\text_io_destroy(conn);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"sdp-xml.h\"",
      "#include \"sdp-client.h\"",
      "#include \"dbus-common.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"btio/btio.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ext_io_destroy",
          "args": [
            "conn"
          ],
          "line": 1102
        },
        "resolved": true,
        "details": {
          "function_name": "ext_io_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
          "lines": "749-783",
          "snippet": "static void ext_io_destroy(gpointer p)\n{\n\tstruct ext_io *ext_io = p;\n\n\tif (ext_io->io_id > 0)\n\t\tg_source_remove(ext_io->io_id);\n\n\tif (ext_io->io) {\n\t\tg_io_channel_shutdown(ext_io->io, FALSE, NULL);\n\t\tg_io_channel_unref(ext_io->io);\n\t}\n\n\tif (ext_io->auth_id != 0)\n\t\tbtd_cancel_authorization(ext_io->auth_id);\n\n\tif (ext_io->pending) {\n\t\tdbus_pending_call_cancel(ext_io->pending);\n\t\tdbus_pending_call_unref(ext_io->pending);\n\t}\n\n\tif (ext_io->resolving)\n\t\tbt_cancel_discovery(btd_adapter_get_address(ext_io->adapter),\n\t\t\t\t\tdevice_get_address(ext_io->device));\n\n\tif (ext_io->adapter)\n\t\tbtd_adapter_unref(ext_io->adapter);\n\n\tif (ext_io->device)\n\t\tbtd_device_unref(ext_io->device);\n\n\tif (ext_io->service)\n\t\tbtd_service_unref(ext_io->service);\n\n\tg_free(ext_io);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdp-xml.h\"",
            "#include \"sdp-client.h\"",
            "#include \"dbus-common.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"btio/btio.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void ext_io_destroy(gpointer p)\n{\n\tstruct ext_io *ext_io = p;\n\n\tif (ext_io->io_id > 0)\n\t\tg_source_remove(ext_io->io_id);\n\n\tif (ext_io->io) {\n\t\tg_io_channel_shutdown(ext_io->io, FALSE, NULL);\n\t\tg_io_channel_unref(ext_io->io);\n\t}\n\n\tif (ext_io->auth_id != 0)\n\t\tbtd_cancel_authorization(ext_io->auth_id);\n\n\tif (ext_io->pending) {\n\t\tdbus_pending_call_cancel(ext_io->pending);\n\t\tdbus_pending_call_unref(ext_io->pending);\n\t}\n\n\tif (ext_io->resolving)\n\t\tbt_cancel_discovery(btd_adapter_get_address(ext_io->adapter),\n\t\t\t\t\tdevice_get_address(ext_io->device));\n\n\tif (ext_io->adapter)\n\t\tbtd_adapter_unref(ext_io->adapter);\n\n\tif (ext_io->device)\n\t\tbtd_device_unref(ext_io->device);\n\n\tif (ext_io->service)\n\t\tbtd_service_unref(ext_io->service);\n\n\tg_free(ext_io);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_slist_remove",
          "args": [
            "ext->conns",
            "conn"
          ],
          "line": 1101
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"%s authorized to connect to %s\"",
            "addr",
            "ext->name"
          ],
          "line": 1096
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_error_free",
          "args": [
            "gerr"
          ],
          "line": 1092
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"bt_io_accept: %s\"",
            "gerr->message"
          ],
          "line": 1091
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "124-128",
          "snippet": "DBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_io_accept",
          "args": [
            "conn->io",
            "ext_connect",
            "conn",
            "NULL",
            "&gerr"
          ],
          "line": 1090
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"%s rejected %s: %s\"",
            "ext->name",
            "addr",
            "err->message"
          ],
          "line": 1086
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/log.c",
          "lines": "199-213",
          "snippet": "void btd_error(uint16_t index, const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_ERR, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(index, LOG_ERR, format, ap);\n\tva_end(ap);\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdarg.h>",
            "#include <syslog.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int logging_fd = -1;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"src/shared/util.h\"\n#include \"lib/hci.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int logging_fd = -1;\n\nvoid btd_error(uint16_t index, const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_ERR, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(index, LOG_ERR, format, ap);\n\tva_end(ap);\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_error_is_set",
          "args": [
            "err"
          ],
          "line": 1085
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_error_free",
          "args": [
            "gerr"
          ],
          "line": 1081
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_io_get",
          "args": [
            "conn->io",
            "&gerr",
            "BT_IO_OPT_DEST",
            "addr",
            "BT_IO_OPT_INVALID"
          ],
          "line": 1077
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void ext_auth(DBusError *err, void *user_data)\n{\n\tstruct ext_io *conn = user_data;\n\tstruct ext_profile *ext = conn->ext;\n\tGError *gerr = NULL;\n\tchar addr[18];\n\n\tconn->auth_id = 0;\n\n\tbt_io_get(conn->io, &gerr, BT_IO_OPT_DEST, addr, BT_IO_OPT_INVALID);\n\tif (gerr != NULL) {\n\t\terror(\"Unable to get connect data for %s: %s\",\n\t\t\t\t\t\text->name, gerr->message);\n\t\tg_error_free(gerr);\n\t\tgoto drop;\n\t}\n\n\tif (err && dbus_error_is_set(err)) {\n\t\terror(\"%s rejected %s: %s\", ext->name, addr, err->message);\n\t\tgoto drop;\n\t}\n\n\tif (!bt_io_accept(conn->io, ext_connect, conn, NULL, &gerr)) {\n\t\terror(\"bt_io_accept: %s\", gerr->message);\n\t\tg_error_free(gerr);\n\t\tgoto drop;\n\t}\n\n\tDBG(\"%s authorized to connect to %s\", addr, ext->name);\n\n\treturn;\n\ndrop:\n\text->conns = g_slist_remove(ext->conns, conn);\n\text_io_destroy(conn);\n}"
  },
  {
    "function_name": "ext_connect",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
    "lines": "1015-1066",
    "snippet": "static void ext_connect(GIOChannel *io, GError *err, gpointer user_data)\n{\n\tstruct ext_io *conn = user_data;\n\tstruct ext_profile *ext = conn->ext;\n\tGError *io_err = NULL;\n\tchar addr[18];\n\n\tif (!bt_io_get(io, &io_err,\n\t\t\t\tBT_IO_OPT_DEST, addr,\n\t\t\t\tBT_IO_OPT_INVALID)) {\n\t\terror(\"Unable to get connect data for %s: %s\", ext->name,\n\t\t\t\t\t\t\tio_err->message);\n\t\tif (err) {\n\t\t\tg_error_free(io_err);\n\t\t\tio_err = NULL;\n\t\t} else {\n\t\t\terr = io_err;\n\t\t}\n\t\tgoto drop;\n\t}\n\n\tif (err != NULL) {\n\t\terror(\"%s failed to connect to %s: %s\", ext->name, addr,\n\t\t\t\t\t\t\t\terr->message);\n\t\tgoto drop;\n\t}\n\n\tDBG(\"%s connected to %s\", ext->name, addr);\n\n\tif (conn->io_id == 0) {\n\t\tGIOCondition cond = G_IO_HUP | G_IO_ERR | G_IO_NVAL;\n\t\tconn->io_id = g_io_add_watch(io, cond, ext_io_disconnected,\n\t\t\t\t\t\t\t\t\tconn);\n\t}\n\n\tif (conn->service && service_set_connecting(conn->service) < 0)\n\t\tgoto drop;\n\n\tif (send_new_connection(ext, conn))\n\t\treturn;\n\ndrop:\n\tif (conn->service)\n\t\tbtd_service_connecting_complete(conn->service,\n\t\t\t\t\t\terr ? -err->code : -EIO);\n\n\tif (io_err)\n\t\tg_error_free(io_err);\n\n\text->conns = g_slist_remove(ext->conns, conn);\n\text_io_destroy(conn);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"sdp-xml.h\"",
      "#include \"sdp-client.h\"",
      "#include \"dbus-common.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"btio/btio.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ext_io_destroy",
          "args": [
            "conn"
          ],
          "line": 1065
        },
        "resolved": true,
        "details": {
          "function_name": "ext_io_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
          "lines": "749-783",
          "snippet": "static void ext_io_destroy(gpointer p)\n{\n\tstruct ext_io *ext_io = p;\n\n\tif (ext_io->io_id > 0)\n\t\tg_source_remove(ext_io->io_id);\n\n\tif (ext_io->io) {\n\t\tg_io_channel_shutdown(ext_io->io, FALSE, NULL);\n\t\tg_io_channel_unref(ext_io->io);\n\t}\n\n\tif (ext_io->auth_id != 0)\n\t\tbtd_cancel_authorization(ext_io->auth_id);\n\n\tif (ext_io->pending) {\n\t\tdbus_pending_call_cancel(ext_io->pending);\n\t\tdbus_pending_call_unref(ext_io->pending);\n\t}\n\n\tif (ext_io->resolving)\n\t\tbt_cancel_discovery(btd_adapter_get_address(ext_io->adapter),\n\t\t\t\t\tdevice_get_address(ext_io->device));\n\n\tif (ext_io->adapter)\n\t\tbtd_adapter_unref(ext_io->adapter);\n\n\tif (ext_io->device)\n\t\tbtd_device_unref(ext_io->device);\n\n\tif (ext_io->service)\n\t\tbtd_service_unref(ext_io->service);\n\n\tg_free(ext_io);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdp-xml.h\"",
            "#include \"sdp-client.h\"",
            "#include \"dbus-common.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"btio/btio.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void ext_io_destroy(gpointer p)\n{\n\tstruct ext_io *ext_io = p;\n\n\tif (ext_io->io_id > 0)\n\t\tg_source_remove(ext_io->io_id);\n\n\tif (ext_io->io) {\n\t\tg_io_channel_shutdown(ext_io->io, FALSE, NULL);\n\t\tg_io_channel_unref(ext_io->io);\n\t}\n\n\tif (ext_io->auth_id != 0)\n\t\tbtd_cancel_authorization(ext_io->auth_id);\n\n\tif (ext_io->pending) {\n\t\tdbus_pending_call_cancel(ext_io->pending);\n\t\tdbus_pending_call_unref(ext_io->pending);\n\t}\n\n\tif (ext_io->resolving)\n\t\tbt_cancel_discovery(btd_adapter_get_address(ext_io->adapter),\n\t\t\t\t\tdevice_get_address(ext_io->device));\n\n\tif (ext_io->adapter)\n\t\tbtd_adapter_unref(ext_io->adapter);\n\n\tif (ext_io->device)\n\t\tbtd_device_unref(ext_io->device);\n\n\tif (ext_io->service)\n\t\tbtd_service_unref(ext_io->service);\n\n\tg_free(ext_io);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_slist_remove",
          "args": [
            "ext->conns",
            "conn"
          ],
          "line": 1064
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_error_free",
          "args": [
            "io_err"
          ],
          "line": 1062
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_service_connecting_complete",
          "args": [
            "conn->service",
            "err ? -err->code : -EIO"
          ],
          "line": 1058
        },
        "resolved": true,
        "details": {
          "function_name": "btd_service_connecting_complete",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
          "lines": "373-383",
          "snippet": "void btd_service_connecting_complete(struct btd_service *service, int err)\n{\n\tif (service->state != BTD_SERVICE_STATE_DISCONNECTED &&\n\t\t\tservice->state != BTD_SERVICE_STATE_CONNECTING)\n\t\treturn;\n\n\tif (err == 0)\n\t\tchange_state(service, BTD_SERVICE_STATE_CONNECTED, 0);\n\telse\n\t\tchange_state(service, BTD_SERVICE_STATE_DISCONNECTED, err);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/stat.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid btd_service_connecting_complete(struct btd_service *service, int err)\n{\n\tif (service->state != BTD_SERVICE_STATE_DISCONNECTED &&\n\t\t\tservice->state != BTD_SERVICE_STATE_CONNECTING)\n\t\treturn;\n\n\tif (err == 0)\n\t\tchange_state(service, BTD_SERVICE_STATE_CONNECTED, 0);\n\telse\n\t\tchange_state(service, BTD_SERVICE_STATE_DISCONNECTED, err);\n}"
        }
      },
      {
        "call_info": {
          "callee": "send_new_connection",
          "args": [
            "ext",
            "conn"
          ],
          "line": 1053
        },
        "resolved": true,
        "details": {
          "function_name": "send_new_connection",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
          "lines": "953-1013",
          "snippet": "static bool send_new_connection(struct ext_profile *ext, struct ext_io *conn)\n{\n\tDBusMessage *msg;\n\tDBusMessageIter iter, dict;\n\tstruct prop_append_data data = { &dict, conn };\n\tconst char *remote_uuid = ext->remote_uuid;\n\tconst sdp_record_t *rec;\n\tconst char *path;\n\tint fd;\n\n\tmsg = dbus_message_new_method_call(ext->owner, ext->path,\n\t\t\t\t\t\t\t\"org.bluez.Profile1\",\n\t\t\t\t\t\t\t\"NewConnection\");\n\tif (!msg) {\n\t\terror(\"Unable to create NewConnection call for %s\", ext->name);\n\t\treturn false;\n\t}\n\n\tif (remote_uuid) {\n\t\trec = btd_device_get_record(conn->device, remote_uuid);\n\t\tif (rec) {\n\t\t\tconn->features = get_supported_features(rec);\n\t\t\tconn->version = get_profile_version(rec);\n\t\t}\n\t}\n\n\tdbus_message_iter_init_append(msg, &iter);\n\n\tpath = device_get_path(conn->device);\n\tdbus_message_iter_append_basic(&iter, DBUS_TYPE_OBJECT_PATH, &path);\n\n\tfd = g_io_channel_unix_get_fd(conn->io);\n\tdbus_message_iter_append_basic(&iter, DBUS_TYPE_UNIX_FD, &fd);\n\n\tdbus_message_iter_open_container(&iter, DBUS_TYPE_ARRAY, \"{sv}\", &dict);\n\n\tif (conn->version)\n\t\tdict_append_entry(&dict, \"Version\", DBUS_TYPE_UINT16,\n\t\t\t\t\t\t\t&conn->version);\n\n\tif (conn->features)\n\t\tdict_append_entry(&dict, \"Features\", DBUS_TYPE_UINT16,\n\t\t\t\t\t\t\t&conn->features);\n\n\tg_slist_foreach(custom_props, append_prop, &data);\n\n\tdbus_message_iter_close_container(&iter, &dict);\n\n\tif (!g_dbus_send_message_with_reply(btd_get_dbus_connection(),\n\t\t\t\t\t\tmsg, &conn->pending, -1)) {\n\t\terror(\"%s: sending NewConnection failed\", ext->name);\n\t\tdbus_message_unref(msg);\n\t\treturn false;\n\t}\n\n\tdbus_message_unref(msg);\n\n\tdbus_pending_call_set_notify(conn->pending, new_conn_reply, conn, NULL);\n\n\treturn true;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdp-xml.h\"",
            "#include \"sdp-client.h\"",
            "#include \"dbus-common.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"btio/btio.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static GSList *custom_props = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic GSList *custom_props = NULL;\n\nstatic bool send_new_connection(struct ext_profile *ext, struct ext_io *conn)\n{\n\tDBusMessage *msg;\n\tDBusMessageIter iter, dict;\n\tstruct prop_append_data data = { &dict, conn };\n\tconst char *remote_uuid = ext->remote_uuid;\n\tconst sdp_record_t *rec;\n\tconst char *path;\n\tint fd;\n\n\tmsg = dbus_message_new_method_call(ext->owner, ext->path,\n\t\t\t\t\t\t\t\"org.bluez.Profile1\",\n\t\t\t\t\t\t\t\"NewConnection\");\n\tif (!msg) {\n\t\terror(\"Unable to create NewConnection call for %s\", ext->name);\n\t\treturn false;\n\t}\n\n\tif (remote_uuid) {\n\t\trec = btd_device_get_record(conn->device, remote_uuid);\n\t\tif (rec) {\n\t\t\tconn->features = get_supported_features(rec);\n\t\t\tconn->version = get_profile_version(rec);\n\t\t}\n\t}\n\n\tdbus_message_iter_init_append(msg, &iter);\n\n\tpath = device_get_path(conn->device);\n\tdbus_message_iter_append_basic(&iter, DBUS_TYPE_OBJECT_PATH, &path);\n\n\tfd = g_io_channel_unix_get_fd(conn->io);\n\tdbus_message_iter_append_basic(&iter, DBUS_TYPE_UNIX_FD, &fd);\n\n\tdbus_message_iter_open_container(&iter, DBUS_TYPE_ARRAY, \"{sv}\", &dict);\n\n\tif (conn->version)\n\t\tdict_append_entry(&dict, \"Version\", DBUS_TYPE_UINT16,\n\t\t\t\t\t\t\t&conn->version);\n\n\tif (conn->features)\n\t\tdict_append_entry(&dict, \"Features\", DBUS_TYPE_UINT16,\n\t\t\t\t\t\t\t&conn->features);\n\n\tg_slist_foreach(custom_props, append_prop, &data);\n\n\tdbus_message_iter_close_container(&iter, &dict);\n\n\tif (!g_dbus_send_message_with_reply(btd_get_dbus_connection(),\n\t\t\t\t\t\tmsg, &conn->pending, -1)) {\n\t\terror(\"%s: sending NewConnection failed\", ext->name);\n\t\tdbus_message_unref(msg);\n\t\treturn false;\n\t}\n\n\tdbus_message_unref(msg);\n\n\tdbus_pending_call_set_notify(conn->pending, new_conn_reply, conn, NULL);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "service_set_connecting",
          "args": [
            "conn->service"
          ],
          "line": 1050
        },
        "resolved": true,
        "details": {
          "function_name": "service_set_connecting",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
          "lines": "217-234",
          "snippet": "int service_set_connecting(struct btd_service *service)\n{\n\tswitch (service->state) {\n\tcase BTD_SERVICE_STATE_UNAVAILABLE:\n\t\treturn -EINVAL;\n\tcase BTD_SERVICE_STATE_DISCONNECTED:\n\t\tbreak;\n\tcase BTD_SERVICE_STATE_CONNECTING:\n\tcase BTD_SERVICE_STATE_CONNECTED:\n\t\treturn 0;\n\tcase BTD_SERVICE_STATE_DISCONNECTING:\n\t\treturn -EBUSY;\n\t}\n\n\tchange_state(service, BTD_SERVICE_STATE_CONNECTING, 0);\n\n\treturn 0;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/stat.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nint service_set_connecting(struct btd_service *service)\n{\n\tswitch (service->state) {\n\tcase BTD_SERVICE_STATE_UNAVAILABLE:\n\t\treturn -EINVAL;\n\tcase BTD_SERVICE_STATE_DISCONNECTED:\n\t\tbreak;\n\tcase BTD_SERVICE_STATE_CONNECTING:\n\tcase BTD_SERVICE_STATE_CONNECTED:\n\t\treturn 0;\n\tcase BTD_SERVICE_STATE_DISCONNECTING:\n\t\treturn -EBUSY;\n\t}\n\n\tchange_state(service, BTD_SERVICE_STATE_CONNECTING, 0);\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_io_add_watch",
          "args": [
            "io",
            "cond",
            "ext_io_disconnected",
            "conn"
          ],
          "line": 1046
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"%s connected to %s\"",
            "ext->name",
            "addr"
          ],
          "line": 1042
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"%s failed to connect to %s: %s\"",
            "ext->name",
            "addr",
            "err->message"
          ],
          "line": 1037
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/log.c",
          "lines": "199-213",
          "snippet": "void btd_error(uint16_t index, const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_ERR, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(index, LOG_ERR, format, ap);\n\tva_end(ap);\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdarg.h>",
            "#include <syslog.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int logging_fd = -1;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"src/shared/util.h\"\n#include \"lib/hci.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int logging_fd = -1;\n\nvoid btd_error(uint16_t index, const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_ERR, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(index, LOG_ERR, format, ap);\n\tva_end(ap);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_error_free",
          "args": [
            "io_err"
          ],
          "line": 1028
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_io_get",
          "args": [
            "io",
            "&io_err",
            "BT_IO_OPT_DEST",
            "addr",
            "BT_IO_OPT_INVALID"
          ],
          "line": 1022
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void ext_connect(GIOChannel *io, GError *err, gpointer user_data)\n{\n\tstruct ext_io *conn = user_data;\n\tstruct ext_profile *ext = conn->ext;\n\tGError *io_err = NULL;\n\tchar addr[18];\n\n\tif (!bt_io_get(io, &io_err,\n\t\t\t\tBT_IO_OPT_DEST, addr,\n\t\t\t\tBT_IO_OPT_INVALID)) {\n\t\terror(\"Unable to get connect data for %s: %s\", ext->name,\n\t\t\t\t\t\t\tio_err->message);\n\t\tif (err) {\n\t\t\tg_error_free(io_err);\n\t\t\tio_err = NULL;\n\t\t} else {\n\t\t\terr = io_err;\n\t\t}\n\t\tgoto drop;\n\t}\n\n\tif (err != NULL) {\n\t\terror(\"%s failed to connect to %s: %s\", ext->name, addr,\n\t\t\t\t\t\t\t\terr->message);\n\t\tgoto drop;\n\t}\n\n\tDBG(\"%s connected to %s\", ext->name, addr);\n\n\tif (conn->io_id == 0) {\n\t\tGIOCondition cond = G_IO_HUP | G_IO_ERR | G_IO_NVAL;\n\t\tconn->io_id = g_io_add_watch(io, cond, ext_io_disconnected,\n\t\t\t\t\t\t\t\t\tconn);\n\t}\n\n\tif (conn->service && service_set_connecting(conn->service) < 0)\n\t\tgoto drop;\n\n\tif (send_new_connection(ext, conn))\n\t\treturn;\n\ndrop:\n\tif (conn->service)\n\t\tbtd_service_connecting_complete(conn->service,\n\t\t\t\t\t\terr ? -err->code : -EIO);\n\n\tif (io_err)\n\t\tg_error_free(io_err);\n\n\text->conns = g_slist_remove(ext->conns, conn);\n\text_io_destroy(conn);\n}"
  },
  {
    "function_name": "send_new_connection",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
    "lines": "953-1013",
    "snippet": "static bool send_new_connection(struct ext_profile *ext, struct ext_io *conn)\n{\n\tDBusMessage *msg;\n\tDBusMessageIter iter, dict;\n\tstruct prop_append_data data = { &dict, conn };\n\tconst char *remote_uuid = ext->remote_uuid;\n\tconst sdp_record_t *rec;\n\tconst char *path;\n\tint fd;\n\n\tmsg = dbus_message_new_method_call(ext->owner, ext->path,\n\t\t\t\t\t\t\t\"org.bluez.Profile1\",\n\t\t\t\t\t\t\t\"NewConnection\");\n\tif (!msg) {\n\t\terror(\"Unable to create NewConnection call for %s\", ext->name);\n\t\treturn false;\n\t}\n\n\tif (remote_uuid) {\n\t\trec = btd_device_get_record(conn->device, remote_uuid);\n\t\tif (rec) {\n\t\t\tconn->features = get_supported_features(rec);\n\t\t\tconn->version = get_profile_version(rec);\n\t\t}\n\t}\n\n\tdbus_message_iter_init_append(msg, &iter);\n\n\tpath = device_get_path(conn->device);\n\tdbus_message_iter_append_basic(&iter, DBUS_TYPE_OBJECT_PATH, &path);\n\n\tfd = g_io_channel_unix_get_fd(conn->io);\n\tdbus_message_iter_append_basic(&iter, DBUS_TYPE_UNIX_FD, &fd);\n\n\tdbus_message_iter_open_container(&iter, DBUS_TYPE_ARRAY, \"{sv}\", &dict);\n\n\tif (conn->version)\n\t\tdict_append_entry(&dict, \"Version\", DBUS_TYPE_UINT16,\n\t\t\t\t\t\t\t&conn->version);\n\n\tif (conn->features)\n\t\tdict_append_entry(&dict, \"Features\", DBUS_TYPE_UINT16,\n\t\t\t\t\t\t\t&conn->features);\n\n\tg_slist_foreach(custom_props, append_prop, &data);\n\n\tdbus_message_iter_close_container(&iter, &dict);\n\n\tif (!g_dbus_send_message_with_reply(btd_get_dbus_connection(),\n\t\t\t\t\t\tmsg, &conn->pending, -1)) {\n\t\terror(\"%s: sending NewConnection failed\", ext->name);\n\t\tdbus_message_unref(msg);\n\t\treturn false;\n\t}\n\n\tdbus_message_unref(msg);\n\n\tdbus_pending_call_set_notify(conn->pending, new_conn_reply, conn, NULL);\n\n\treturn true;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"sdp-xml.h\"",
      "#include \"sdp-client.h\"",
      "#include \"dbus-common.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"btio/btio.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static GSList *custom_props = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_pending_call_set_notify",
          "args": [
            "conn->pending",
            "new_conn_reply",
            "conn",
            "NULL"
          ],
          "line": 1010
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_unref",
          "args": [
            "msg"
          ],
          "line": 1008
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_unref",
          "args": [
            "msg"
          ],
          "line": 1004
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"%s: sending NewConnection failed\"",
            "ext->name"
          ],
          "line": 1003
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error_failed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/error.c",
          "lines": "124-128",
          "snippet": "DBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}",
          "includes": [
            "#include \"error.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"error.h\"\n#include \"gdbus/gdbus.h\"\n#include <config.h>\n\nDBusMessage *btd_error_failed(DBusMessage *msg, const char *str)\n{\n\treturn g_dbus_create_error(msg, ERROR_INTERFACE\n\t\t\t\t\t\".Failed\", \"%s\", str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_dbus_send_message_with_reply",
          "args": [
            "btd_get_dbus_connection()",
            "msg",
            "&conn->pending",
            "-1"
          ],
          "line": 1001
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_get_dbus_connection",
          "args": [],
          "line": 1001
        },
        "resolved": true,
        "details": {
          "function_name": "btd_get_dbus_connection",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/dbus-common.c",
          "lines": "61-64",
          "snippet": "DBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *connection = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *connection = NULL;\n\nDBusConnection *btd_get_dbus_connection(void)\n{\n\treturn connection;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_close_container",
          "args": [
            "&iter",
            "&dict"
          ],
          "line": 999
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_foreach",
          "args": [
            "custom_props",
            "append_prop",
            "&data"
          ],
          "line": 997
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dict_append_entry",
          "args": [
            "&dict",
            "\"Features\"",
            "DBUS_TYPE_UINT16",
            "&conn->features"
          ],
          "line": 994
        },
        "resolved": true,
        "details": {
          "function_name": "dict_append_entry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/dbus-common.c",
          "lines": "44-48",
          "snippet": "void dict_append_entry(DBusMessageIter *dict,\n\t\t\tconst char *key, int type, void *val)\n{\n\tg_dbus_dict_append_entry(dict, key, type, val);\n}",
          "includes": [
            "#include \"dbus-common.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"dbus-common.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid dict_append_entry(DBusMessageIter *dict,\n\t\t\tconst char *key, int type, void *val)\n{\n\tg_dbus_dict_append_entry(dict, key, type, val);\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_open_container",
          "args": [
            "&iter",
            "DBUS_TYPE_ARRAY",
            "\"{sv}\"",
            "&dict"
          ],
          "line": 987
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_append_basic",
          "args": [
            "&iter",
            "DBUS_TYPE_UNIX_FD",
            "&fd"
          ],
          "line": 985
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_io_channel_unix_get_fd",
          "args": [
            "conn->io"
          ],
          "line": 984
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_append_basic",
          "args": [
            "&iter",
            "DBUS_TYPE_OBJECT_PATH",
            "&path"
          ],
          "line": 982
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device_get_path",
          "args": [
            "conn->device"
          ],
          "line": 981
        },
        "resolved": true,
        "details": {
          "function_name": "device_get_path",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5323-5329",
          "snippet": "const char *device_get_path(const struct btd_device *device)\n{\n\tif (!device)\n\t\treturn NULL;\n\n\treturn device->path;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nconst char *device_get_path(const struct btd_device *device)\n{\n\tif (!device)\n\t\treturn NULL;\n\n\treturn device->path;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_init_append",
          "args": [
            "msg",
            "&iter"
          ],
          "line": 979
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_profile_version",
          "args": [
            "rec"
          ],
          "line": 975
        },
        "resolved": true,
        "details": {
          "function_name": "get_profile_version",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
          "lines": "933-951",
          "snippet": "static uint16_t get_profile_version(const sdp_record_t *rec)\n{\n\tsdp_list_t *descs;\n\tuint16_t version;\n\n\tif (sdp_get_profile_descs(rec, &descs) < 0)\n\t\treturn 0;\n\n\tif (descs && descs->data) {\n\t\tsdp_profile_desc_t *desc = descs->data;\n\t\tversion = desc->version;\n\t} else {\n\t\tversion = 0;\n\t}\n\n\tsdp_list_free(descs, free);\n\n\treturn version;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdp-xml.h\"",
            "#include \"sdp-client.h\"",
            "#include \"dbus-common.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"btio/btio.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic uint16_t get_profile_version(const sdp_record_t *rec)\n{\n\tsdp_list_t *descs;\n\tuint16_t version;\n\n\tif (sdp_get_profile_descs(rec, &descs) < 0)\n\t\treturn 0;\n\n\tif (descs && descs->data) {\n\t\tsdp_profile_desc_t *desc = descs->data;\n\t\tversion = desc->version;\n\t} else {\n\t\tversion = 0;\n\t}\n\n\tsdp_list_free(descs, free);\n\n\treturn version;\n}"
        }
      },
      {
        "call_info": {
          "callee": "get_supported_features",
          "args": [
            "rec"
          ],
          "line": 974
        },
        "resolved": true,
        "details": {
          "function_name": "get_supported_features",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
          "lines": "922-931",
          "snippet": "static uint16_t get_supported_features(const sdp_record_t *rec)\n{\n\tsdp_data_t *data;\n\n\tdata = sdp_data_get(rec, SDP_ATTR_SUPPORTED_FEATURES);\n\tif (!data || data->dtd != SDP_UINT16)\n\t\treturn 0;\n\n\treturn data->val.uint16;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdp-xml.h\"",
            "#include \"sdp-client.h\"",
            "#include \"dbus-common.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"btio/btio.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic uint16_t get_supported_features(const sdp_record_t *rec)\n{\n\tsdp_data_t *data;\n\n\tdata = sdp_data_get(rec, SDP_ATTR_SUPPORTED_FEATURES);\n\tif (!data || data->dtd != SDP_UINT16)\n\t\treturn 0;\n\n\treturn data->val.uint16;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_device_get_record",
          "args": [
            "conn->device",
            "remote_uuid"
          ],
          "line": 972
        },
        "resolved": true,
        "details": {
          "function_name": "btd_device_get_record",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "6344-6355",
          "snippet": "const sdp_record_t *btd_device_get_record(struct btd_device *device,\n\t\t\t\t\t\t\tconst char *uuid)\n{\n\t/* Load records from storage if there is nothing in cache */\n\tif (!device->tmp_records) {\n\t\tdevice->tmp_records = read_device_records(device);\n\t\tif (!device->tmp_records)\n\t\t\treturn NULL;\n\t}\n\n\treturn find_record_in_list(device->tmp_records, uuid);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nconst sdp_record_t *btd_device_get_record(struct btd_device *device,\n\t\t\t\t\t\t\tconst char *uuid)\n{\n\t/* Load records from storage if there is nothing in cache */\n\tif (!device->tmp_records) {\n\t\tdevice->tmp_records = read_device_records(device);\n\t\tif (!device->tmp_records)\n\t\t\treturn NULL;\n\t}\n\n\treturn find_record_in_list(device->tmp_records, uuid);\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_message_new_method_call",
          "args": [
            "ext->owner",
            "ext->path",
            "\"org.bluez.Profile1\"",
            "\"NewConnection\""
          ],
          "line": 963
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic GSList *custom_props = NULL;\n\nstatic bool send_new_connection(struct ext_profile *ext, struct ext_io *conn)\n{\n\tDBusMessage *msg;\n\tDBusMessageIter iter, dict;\n\tstruct prop_append_data data = { &dict, conn };\n\tconst char *remote_uuid = ext->remote_uuid;\n\tconst sdp_record_t *rec;\n\tconst char *path;\n\tint fd;\n\n\tmsg = dbus_message_new_method_call(ext->owner, ext->path,\n\t\t\t\t\t\t\t\"org.bluez.Profile1\",\n\t\t\t\t\t\t\t\"NewConnection\");\n\tif (!msg) {\n\t\terror(\"Unable to create NewConnection call for %s\", ext->name);\n\t\treturn false;\n\t}\n\n\tif (remote_uuid) {\n\t\trec = btd_device_get_record(conn->device, remote_uuid);\n\t\tif (rec) {\n\t\t\tconn->features = get_supported_features(rec);\n\t\t\tconn->version = get_profile_version(rec);\n\t\t}\n\t}\n\n\tdbus_message_iter_init_append(msg, &iter);\n\n\tpath = device_get_path(conn->device);\n\tdbus_message_iter_append_basic(&iter, DBUS_TYPE_OBJECT_PATH, &path);\n\n\tfd = g_io_channel_unix_get_fd(conn->io);\n\tdbus_message_iter_append_basic(&iter, DBUS_TYPE_UNIX_FD, &fd);\n\n\tdbus_message_iter_open_container(&iter, DBUS_TYPE_ARRAY, \"{sv}\", &dict);\n\n\tif (conn->version)\n\t\tdict_append_entry(&dict, \"Version\", DBUS_TYPE_UINT16,\n\t\t\t\t\t\t\t&conn->version);\n\n\tif (conn->features)\n\t\tdict_append_entry(&dict, \"Features\", DBUS_TYPE_UINT16,\n\t\t\t\t\t\t\t&conn->features);\n\n\tg_slist_foreach(custom_props, append_prop, &data);\n\n\tdbus_message_iter_close_container(&iter, &dict);\n\n\tif (!g_dbus_send_message_with_reply(btd_get_dbus_connection(),\n\t\t\t\t\t\tmsg, &conn->pending, -1)) {\n\t\terror(\"%s: sending NewConnection failed\", ext->name);\n\t\tdbus_message_unref(msg);\n\t\treturn false;\n\t}\n\n\tdbus_message_unref(msg);\n\n\tdbus_pending_call_set_notify(conn->pending, new_conn_reply, conn, NULL);\n\n\treturn true;\n}"
  },
  {
    "function_name": "get_profile_version",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
    "lines": "933-951",
    "snippet": "static uint16_t get_profile_version(const sdp_record_t *rec)\n{\n\tsdp_list_t *descs;\n\tuint16_t version;\n\n\tif (sdp_get_profile_descs(rec, &descs) < 0)\n\t\treturn 0;\n\n\tif (descs && descs->data) {\n\t\tsdp_profile_desc_t *desc = descs->data;\n\t\tversion = desc->version;\n\t} else {\n\t\tversion = 0;\n\t}\n\n\tsdp_list_free(descs, free);\n\n\treturn version;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"sdp-xml.h\"",
      "#include \"sdp-client.h\"",
      "#include \"dbus-common.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"btio/btio.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sdp_list_free",
          "args": [
            "descs",
            "free"
          ],
          "line": 948
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sdp_get_profile_descs",
          "args": [
            "rec",
            "&descs"
          ],
          "line": 938
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic uint16_t get_profile_version(const sdp_record_t *rec)\n{\n\tsdp_list_t *descs;\n\tuint16_t version;\n\n\tif (sdp_get_profile_descs(rec, &descs) < 0)\n\t\treturn 0;\n\n\tif (descs && descs->data) {\n\t\tsdp_profile_desc_t *desc = descs->data;\n\t\tversion = desc->version;\n\t} else {\n\t\tversion = 0;\n\t}\n\n\tsdp_list_free(descs, free);\n\n\treturn version;\n}"
  },
  {
    "function_name": "get_supported_features",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
    "lines": "922-931",
    "snippet": "static uint16_t get_supported_features(const sdp_record_t *rec)\n{\n\tsdp_data_t *data;\n\n\tdata = sdp_data_get(rec, SDP_ATTR_SUPPORTED_FEATURES);\n\tif (!data || data->dtd != SDP_UINT16)\n\t\treturn 0;\n\n\treturn data->val.uint16;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"sdp-xml.h\"",
      "#include \"sdp-client.h\"",
      "#include \"dbus-common.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"btio/btio.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sdp_data_get",
          "args": [
            "rec",
            "SDP_ATTR_SUPPORTED_FEATURES"
          ],
          "line": 926
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic uint16_t get_supported_features(const sdp_record_t *rec)\n{\n\tsdp_data_t *data;\n\n\tdata = sdp_data_get(rec, SDP_ATTR_SUPPORTED_FEATURES);\n\tif (!data || data->dtd != SDP_UINT16)\n\t\treturn 0;\n\n\treturn data->val.uint16;\n}"
  },
  {
    "function_name": "append_prop",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
    "lines": "895-920",
    "snippet": "static void append_prop(gpointer a, gpointer b)\n{\n\tstruct btd_profile_custom_property *p = a;\n\tstruct prop_append_data *data = b;\n\tDBusMessageIter entry, value, *dict = data->dict;\n\tstruct btd_device *dev = data->io->device;\n\tstruct ext_profile *ext = data->io->ext;\n\tconst char *uuid = ext->service ? ext->service : ext->uuid;\n\n\tif (strcasecmp(p->uuid, uuid) != 0)\n\t\treturn;\n\n\tif (p->exists && !p->exists(p->uuid, dev, p->user_data))\n\t\treturn;\n\n\tdbus_message_iter_open_container(dict, DBUS_TYPE_DICT_ENTRY, NULL,\n\t\t\t\t\t\t\t\t&entry);\n\tdbus_message_iter_append_basic(&entry, DBUS_TYPE_STRING, &p->name);\n\tdbus_message_iter_open_container(&entry, DBUS_TYPE_VARIANT, p->type,\n\t\t\t\t\t\t\t\t&value);\n\n\tp->get(p->uuid, dev, &value, p->user_data);\n\n\tdbus_message_iter_close_container(&entry, &value);\n\tdbus_message_iter_close_container(dict, &entry);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"sdp-xml.h\"",
      "#include \"sdp-client.h\"",
      "#include \"dbus-common.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"btio/btio.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbus_message_iter_close_container",
          "args": [
            "dict",
            "&entry"
          ],
          "line": 919
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_close_container",
          "args": [
            "&entry",
            "&value"
          ],
          "line": 918
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "p->get",
          "args": [
            "p->uuid",
            "dev",
            "&value",
            "p->user_data"
          ],
          "line": 916
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_open_container",
          "args": [
            "&entry",
            "DBUS_TYPE_VARIANT",
            "p->type",
            "&value"
          ],
          "line": 913
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_append_basic",
          "args": [
            "&entry",
            "DBUS_TYPE_STRING",
            "&p->name"
          ],
          "line": 912
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_iter_open_container",
          "args": [
            "dict",
            "DBUS_TYPE_DICT_ENTRY",
            "NULL",
            "&entry"
          ],
          "line": 910
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "p->exists",
          "args": [
            "p->uuid",
            "dev",
            "p->user_data"
          ],
          "line": 907
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcasecmp",
          "args": [
            "p->uuid",
            "uuid"
          ],
          "line": 904
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void append_prop(gpointer a, gpointer b)\n{\n\tstruct btd_profile_custom_property *p = a;\n\tstruct prop_append_data *data = b;\n\tDBusMessageIter entry, value, *dict = data->dict;\n\tstruct btd_device *dev = data->io->device;\n\tstruct ext_profile *ext = data->io->ext;\n\tconst char *uuid = ext->service ? ext->service : ext->uuid;\n\n\tif (strcasecmp(p->uuid, uuid) != 0)\n\t\treturn;\n\n\tif (p->exists && !p->exists(p->uuid, dev, p->user_data))\n\t\treturn;\n\n\tdbus_message_iter_open_container(dict, DBUS_TYPE_DICT_ENTRY, NULL,\n\t\t\t\t\t\t\t\t&entry);\n\tdbus_message_iter_append_basic(&entry, DBUS_TYPE_STRING, &p->name);\n\tdbus_message_iter_open_container(&entry, DBUS_TYPE_VARIANT, p->type,\n\t\t\t\t\t\t\t\t&value);\n\n\tp->get(p->uuid, dev, &value, p->user_data);\n\n\tdbus_message_iter_close_container(&entry, &value);\n\tdbus_message_iter_close_container(dict, &entry);\n}"
  },
  {
    "function_name": "disconn_reply",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
    "lines": "854-888",
    "snippet": "static void disconn_reply(DBusPendingCall *call, void *user_data)\n{\n\tstruct ext_io *conn = user_data;\n\tstruct ext_profile *ext = conn->ext;\n\tDBusMessage *reply = dbus_pending_call_steal_reply(call);\n\tDBusError err;\n\n\tdbus_error_init(&err);\n\tdbus_set_error_from_message(&err, reply);\n\n\tdbus_message_unref(reply);\n\n\tdbus_pending_call_unref(conn->pending);\n\tconn->pending = NULL;\n\n\tif (!dbus_error_is_set(&err)) {\n\t\tif (conn->service)\n\t\t\tbtd_service_disconnecting_complete(conn->service, 0);\n\n\t\tgoto disconnect;\n\t}\n\n\terror(\"%s replied with an error: %s, %s\", ext->name,\n\t\t\t\t\t\terr.name, err.message);\n\n\tif (conn->service)\n\t\tbtd_service_disconnecting_complete(conn->service,\n\t\t\t\t\t\t\t\t-ECONNREFUSED);\n\n\tdbus_error_free(&err);\n\ndisconnect:\n\text->conns = g_slist_remove(ext->conns, conn);\n\text_io_destroy(conn);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"sdp-xml.h\"",
      "#include \"sdp-client.h\"",
      "#include \"dbus-common.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"btio/btio.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ext_io_destroy",
          "args": [
            "conn"
          ],
          "line": 887
        },
        "resolved": true,
        "details": {
          "function_name": "ext_io_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
          "lines": "749-783",
          "snippet": "static void ext_io_destroy(gpointer p)\n{\n\tstruct ext_io *ext_io = p;\n\n\tif (ext_io->io_id > 0)\n\t\tg_source_remove(ext_io->io_id);\n\n\tif (ext_io->io) {\n\t\tg_io_channel_shutdown(ext_io->io, FALSE, NULL);\n\t\tg_io_channel_unref(ext_io->io);\n\t}\n\n\tif (ext_io->auth_id != 0)\n\t\tbtd_cancel_authorization(ext_io->auth_id);\n\n\tif (ext_io->pending) {\n\t\tdbus_pending_call_cancel(ext_io->pending);\n\t\tdbus_pending_call_unref(ext_io->pending);\n\t}\n\n\tif (ext_io->resolving)\n\t\tbt_cancel_discovery(btd_adapter_get_address(ext_io->adapter),\n\t\t\t\t\tdevice_get_address(ext_io->device));\n\n\tif (ext_io->adapter)\n\t\tbtd_adapter_unref(ext_io->adapter);\n\n\tif (ext_io->device)\n\t\tbtd_device_unref(ext_io->device);\n\n\tif (ext_io->service)\n\t\tbtd_service_unref(ext_io->service);\n\n\tg_free(ext_io);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdp-xml.h\"",
            "#include \"sdp-client.h\"",
            "#include \"dbus-common.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"btio/btio.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void ext_io_destroy(gpointer p)\n{\n\tstruct ext_io *ext_io = p;\n\n\tif (ext_io->io_id > 0)\n\t\tg_source_remove(ext_io->io_id);\n\n\tif (ext_io->io) {\n\t\tg_io_channel_shutdown(ext_io->io, FALSE, NULL);\n\t\tg_io_channel_unref(ext_io->io);\n\t}\n\n\tif (ext_io->auth_id != 0)\n\t\tbtd_cancel_authorization(ext_io->auth_id);\n\n\tif (ext_io->pending) {\n\t\tdbus_pending_call_cancel(ext_io->pending);\n\t\tdbus_pending_call_unref(ext_io->pending);\n\t}\n\n\tif (ext_io->resolving)\n\t\tbt_cancel_discovery(btd_adapter_get_address(ext_io->adapter),\n\t\t\t\t\tdevice_get_address(ext_io->device));\n\n\tif (ext_io->adapter)\n\t\tbtd_adapter_unref(ext_io->adapter);\n\n\tif (ext_io->device)\n\t\tbtd_device_unref(ext_io->device);\n\n\tif (ext_io->service)\n\t\tbtd_service_unref(ext_io->service);\n\n\tg_free(ext_io);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_slist_remove",
          "args": [
            "ext->conns",
            "conn"
          ],
          "line": 886
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_error_free",
          "args": [
            "&err"
          ],
          "line": 883
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_service_disconnecting_complete",
          "args": [
            "conn->service",
            "-ECONNREFUSED"
          ],
          "line": 880
        },
        "resolved": true,
        "details": {
          "function_name": "btd_service_disconnecting_complete",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
          "lines": "385-395",
          "snippet": "void btd_service_disconnecting_complete(struct btd_service *service, int err)\n{\n\tif (service->state != BTD_SERVICE_STATE_CONNECTED &&\n\t\t\tservice->state != BTD_SERVICE_STATE_DISCONNECTING)\n\t\treturn;\n\n\tif (err == 0)\n\t\tchange_state(service, BTD_SERVICE_STATE_DISCONNECTED, 0);\n\telse /* If disconnect fails, we assume it remains connected */\n\t\tchange_state(service, BTD_SERVICE_STATE_CONNECTED, err);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/stat.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid btd_service_disconnecting_complete(struct btd_service *service, int err)\n{\n\tif (service->state != BTD_SERVICE_STATE_CONNECTED &&\n\t\t\tservice->state != BTD_SERVICE_STATE_DISCONNECTING)\n\t\treturn;\n\n\tif (err == 0)\n\t\tchange_state(service, BTD_SERVICE_STATE_DISCONNECTED, 0);\n\telse /* If disconnect fails, we assume it remains connected */\n\t\tchange_state(service, BTD_SERVICE_STATE_CONNECTED, err);\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"%s replied with an error: %s, %s\"",
            "ext->name",
            "err.name",
            "err.message"
          ],
          "line": 876
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/log.c",
          "lines": "199-213",
          "snippet": "void btd_error(uint16_t index, const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_ERR, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(index, LOG_ERR, format, ap);\n\tva_end(ap);\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdarg.h>",
            "#include <syslog.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int logging_fd = -1;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"src/shared/util.h\"\n#include \"lib/hci.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int logging_fd = -1;\n\nvoid btd_error(uint16_t index, const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_ERR, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(index, LOG_ERR, format, ap);\n\tva_end(ap);\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_error_is_set",
          "args": [
            "&err"
          ],
          "line": 869
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_pending_call_unref",
          "args": [
            "conn->pending"
          ],
          "line": 866
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_unref",
          "args": [
            "reply"
          ],
          "line": 864
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_set_error_from_message",
          "args": [
            "&err",
            "reply"
          ],
          "line": 862
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_error_init",
          "args": [
            "&err"
          ],
          "line": 861
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_pending_call_steal_reply",
          "args": [
            "call"
          ],
          "line": 858
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void disconn_reply(DBusPendingCall *call, void *user_data)\n{\n\tstruct ext_io *conn = user_data;\n\tstruct ext_profile *ext = conn->ext;\n\tDBusMessage *reply = dbus_pending_call_steal_reply(call);\n\tDBusError err;\n\n\tdbus_error_init(&err);\n\tdbus_set_error_from_message(&err, reply);\n\n\tdbus_message_unref(reply);\n\n\tdbus_pending_call_unref(conn->pending);\n\tconn->pending = NULL;\n\n\tif (!dbus_error_is_set(&err)) {\n\t\tif (conn->service)\n\t\t\tbtd_service_disconnecting_complete(conn->service, 0);\n\n\t\tgoto disconnect;\n\t}\n\n\terror(\"%s replied with an error: %s, %s\", ext->name,\n\t\t\t\t\t\terr.name, err.message);\n\n\tif (conn->service)\n\t\tbtd_service_disconnecting_complete(conn->service,\n\t\t\t\t\t\t\t\t-ECONNREFUSED);\n\n\tdbus_error_free(&err);\n\ndisconnect:\n\text->conns = g_slist_remove(ext->conns, conn);\n\text_io_destroy(conn);\n}"
  },
  {
    "function_name": "new_conn_reply",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
    "lines": "819-852",
    "snippet": "static void new_conn_reply(DBusPendingCall *call, void *user_data)\n{\n\tstruct ext_io *conn = user_data;\n\tstruct ext_profile *ext = conn->ext;\n\tDBusMessage *reply = dbus_pending_call_steal_reply(call);\n\tDBusError err;\n\n\tdbus_error_init(&err);\n\tdbus_set_error_from_message(&err, reply);\n\n\tdbus_message_unref(reply);\n\n\tdbus_pending_call_unref(conn->pending);\n\tconn->pending = NULL;\n\n\tif (!dbus_error_is_set(&err)) {\n\t\tif (conn->service)\n\t\t\tbtd_service_connecting_complete(conn->service, 0);\n\n\t\tconn->connected = true;\n\t\treturn;\n\t}\n\n\terror(\"%s replied with an error: %s, %s\", ext->name,\n\t\t\t\t\t\terr.name, err.message);\n\n\tif (conn->service)\n\t\tbtd_service_connecting_complete(conn->service, -ECONNREFUSED);\n\n\tdbus_error_free(&err);\n\n\text->conns = g_slist_remove(ext->conns, conn);\n\text_io_destroy(conn);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"sdp-xml.h\"",
      "#include \"sdp-client.h\"",
      "#include \"dbus-common.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"btio/btio.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ext_io_destroy",
          "args": [
            "conn"
          ],
          "line": 851
        },
        "resolved": true,
        "details": {
          "function_name": "ext_io_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
          "lines": "749-783",
          "snippet": "static void ext_io_destroy(gpointer p)\n{\n\tstruct ext_io *ext_io = p;\n\n\tif (ext_io->io_id > 0)\n\t\tg_source_remove(ext_io->io_id);\n\n\tif (ext_io->io) {\n\t\tg_io_channel_shutdown(ext_io->io, FALSE, NULL);\n\t\tg_io_channel_unref(ext_io->io);\n\t}\n\n\tif (ext_io->auth_id != 0)\n\t\tbtd_cancel_authorization(ext_io->auth_id);\n\n\tif (ext_io->pending) {\n\t\tdbus_pending_call_cancel(ext_io->pending);\n\t\tdbus_pending_call_unref(ext_io->pending);\n\t}\n\n\tif (ext_io->resolving)\n\t\tbt_cancel_discovery(btd_adapter_get_address(ext_io->adapter),\n\t\t\t\t\tdevice_get_address(ext_io->device));\n\n\tif (ext_io->adapter)\n\t\tbtd_adapter_unref(ext_io->adapter);\n\n\tif (ext_io->device)\n\t\tbtd_device_unref(ext_io->device);\n\n\tif (ext_io->service)\n\t\tbtd_service_unref(ext_io->service);\n\n\tg_free(ext_io);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdp-xml.h\"",
            "#include \"sdp-client.h\"",
            "#include \"dbus-common.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"btio/btio.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void ext_io_destroy(gpointer p)\n{\n\tstruct ext_io *ext_io = p;\n\n\tif (ext_io->io_id > 0)\n\t\tg_source_remove(ext_io->io_id);\n\n\tif (ext_io->io) {\n\t\tg_io_channel_shutdown(ext_io->io, FALSE, NULL);\n\t\tg_io_channel_unref(ext_io->io);\n\t}\n\n\tif (ext_io->auth_id != 0)\n\t\tbtd_cancel_authorization(ext_io->auth_id);\n\n\tif (ext_io->pending) {\n\t\tdbus_pending_call_cancel(ext_io->pending);\n\t\tdbus_pending_call_unref(ext_io->pending);\n\t}\n\n\tif (ext_io->resolving)\n\t\tbt_cancel_discovery(btd_adapter_get_address(ext_io->adapter),\n\t\t\t\t\tdevice_get_address(ext_io->device));\n\n\tif (ext_io->adapter)\n\t\tbtd_adapter_unref(ext_io->adapter);\n\n\tif (ext_io->device)\n\t\tbtd_device_unref(ext_io->device);\n\n\tif (ext_io->service)\n\t\tbtd_service_unref(ext_io->service);\n\n\tg_free(ext_io);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_slist_remove",
          "args": [
            "ext->conns",
            "conn"
          ],
          "line": 850
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_error_free",
          "args": [
            "&err"
          ],
          "line": 848
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_service_connecting_complete",
          "args": [
            "conn->service",
            "-ECONNREFUSED"
          ],
          "line": 846
        },
        "resolved": true,
        "details": {
          "function_name": "btd_service_connecting_complete",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
          "lines": "373-383",
          "snippet": "void btd_service_connecting_complete(struct btd_service *service, int err)\n{\n\tif (service->state != BTD_SERVICE_STATE_DISCONNECTED &&\n\t\t\tservice->state != BTD_SERVICE_STATE_CONNECTING)\n\t\treturn;\n\n\tif (err == 0)\n\t\tchange_state(service, BTD_SERVICE_STATE_CONNECTED, 0);\n\telse\n\t\tchange_state(service, BTD_SERVICE_STATE_DISCONNECTED, err);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/stat.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid btd_service_connecting_complete(struct btd_service *service, int err)\n{\n\tif (service->state != BTD_SERVICE_STATE_DISCONNECTED &&\n\t\t\tservice->state != BTD_SERVICE_STATE_CONNECTING)\n\t\treturn;\n\n\tif (err == 0)\n\t\tchange_state(service, BTD_SERVICE_STATE_CONNECTED, 0);\n\telse\n\t\tchange_state(service, BTD_SERVICE_STATE_DISCONNECTED, err);\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"%s replied with an error: %s, %s\"",
            "ext->name",
            "err.name",
            "err.message"
          ],
          "line": 842
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/log.c",
          "lines": "199-213",
          "snippet": "void btd_error(uint16_t index, const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_ERR, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(index, LOG_ERR, format, ap);\n\tva_end(ap);\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdarg.h>",
            "#include <syslog.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int logging_fd = -1;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"src/shared/util.h\"\n#include \"lib/hci.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int logging_fd = -1;\n\nvoid btd_error(uint16_t index, const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_ERR, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(index, LOG_ERR, format, ap);\n\tva_end(ap);\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_error_is_set",
          "args": [
            "&err"
          ],
          "line": 834
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_pending_call_unref",
          "args": [
            "conn->pending"
          ],
          "line": 831
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_message_unref",
          "args": [
            "reply"
          ],
          "line": 829
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_set_error_from_message",
          "args": [
            "&err",
            "reply"
          ],
          "line": 827
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_error_init",
          "args": [
            "&err"
          ],
          "line": 826
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_pending_call_steal_reply",
          "args": [
            "call"
          ],
          "line": 823
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void new_conn_reply(DBusPendingCall *call, void *user_data)\n{\n\tstruct ext_io *conn = user_data;\n\tstruct ext_profile *ext = conn->ext;\n\tDBusMessage *reply = dbus_pending_call_steal_reply(call);\n\tDBusError err;\n\n\tdbus_error_init(&err);\n\tdbus_set_error_from_message(&err, reply);\n\n\tdbus_message_unref(reply);\n\n\tdbus_pending_call_unref(conn->pending);\n\tconn->pending = NULL;\n\n\tif (!dbus_error_is_set(&err)) {\n\t\tif (conn->service)\n\t\t\tbtd_service_connecting_complete(conn->service, 0);\n\n\t\tconn->connected = true;\n\t\treturn;\n\t}\n\n\terror(\"%s replied with an error: %s, %s\", ext->name,\n\t\t\t\t\t\terr.name, err.message);\n\n\tif (conn->service)\n\t\tbtd_service_connecting_complete(conn->service, -ECONNREFUSED);\n\n\tdbus_error_free(&err);\n\n\text->conns = g_slist_remove(ext->conns, conn);\n\text_io_destroy(conn);\n}"
  },
  {
    "function_name": "ext_io_disconnected",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
    "lines": "785-817",
    "snippet": "static gboolean ext_io_disconnected(GIOChannel *io, GIOCondition cond,\n\t\t\t\t\t\t\tgpointer user_data)\n{\n\tstruct ext_io *conn = user_data;\n\tstruct ext_profile *ext = conn->ext;\n\tGError *gerr = NULL;\n\tchar addr[18];\n\n\tif (cond & G_IO_NVAL)\n\t\treturn FALSE;\n\n\tbt_io_get(io, &gerr, BT_IO_OPT_DEST, addr, BT_IO_OPT_INVALID);\n\tif (gerr != NULL) {\n\t\terror(\"Unable to get io data for %s: %s\",\n\t\t\t\t\t\text->name, gerr->message);\n\t\tg_error_free(gerr);\n\t\tgoto drop;\n\t}\n\n\tDBG(\"%s disconnected from %s\", ext->name, addr);\ndrop:\n\tif (conn->service) {\n\t\tif (btd_service_get_state(conn->service) ==\n\t\t\t\t\t\tBTD_SERVICE_STATE_CONNECTING)\n\t\t\tbtd_service_connecting_complete(conn->service, -EIO);\n\t\telse\n\t\t\tbtd_service_disconnecting_complete(conn->service, 0);\n\t}\n\n\text->conns = g_slist_remove(ext->conns, conn);\n\text_io_destroy(conn);\n\treturn FALSE;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"sdp-xml.h\"",
      "#include \"sdp-client.h\"",
      "#include \"dbus-common.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"btio/btio.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ext_io_destroy",
          "args": [
            "conn"
          ],
          "line": 815
        },
        "resolved": true,
        "details": {
          "function_name": "ext_io_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
          "lines": "749-783",
          "snippet": "static void ext_io_destroy(gpointer p)\n{\n\tstruct ext_io *ext_io = p;\n\n\tif (ext_io->io_id > 0)\n\t\tg_source_remove(ext_io->io_id);\n\n\tif (ext_io->io) {\n\t\tg_io_channel_shutdown(ext_io->io, FALSE, NULL);\n\t\tg_io_channel_unref(ext_io->io);\n\t}\n\n\tif (ext_io->auth_id != 0)\n\t\tbtd_cancel_authorization(ext_io->auth_id);\n\n\tif (ext_io->pending) {\n\t\tdbus_pending_call_cancel(ext_io->pending);\n\t\tdbus_pending_call_unref(ext_io->pending);\n\t}\n\n\tif (ext_io->resolving)\n\t\tbt_cancel_discovery(btd_adapter_get_address(ext_io->adapter),\n\t\t\t\t\tdevice_get_address(ext_io->device));\n\n\tif (ext_io->adapter)\n\t\tbtd_adapter_unref(ext_io->adapter);\n\n\tif (ext_io->device)\n\t\tbtd_device_unref(ext_io->device);\n\n\tif (ext_io->service)\n\t\tbtd_service_unref(ext_io->service);\n\n\tg_free(ext_io);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdp-xml.h\"",
            "#include \"sdp-client.h\"",
            "#include \"dbus-common.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"log.h\"",
            "#include \"sdpd.h\"",
            "#include \"btio/btio.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void ext_io_destroy(gpointer p)\n{\n\tstruct ext_io *ext_io = p;\n\n\tif (ext_io->io_id > 0)\n\t\tg_source_remove(ext_io->io_id);\n\n\tif (ext_io->io) {\n\t\tg_io_channel_shutdown(ext_io->io, FALSE, NULL);\n\t\tg_io_channel_unref(ext_io->io);\n\t}\n\n\tif (ext_io->auth_id != 0)\n\t\tbtd_cancel_authorization(ext_io->auth_id);\n\n\tif (ext_io->pending) {\n\t\tdbus_pending_call_cancel(ext_io->pending);\n\t\tdbus_pending_call_unref(ext_io->pending);\n\t}\n\n\tif (ext_io->resolving)\n\t\tbt_cancel_discovery(btd_adapter_get_address(ext_io->adapter),\n\t\t\t\t\tdevice_get_address(ext_io->device));\n\n\tif (ext_io->adapter)\n\t\tbtd_adapter_unref(ext_io->adapter);\n\n\tif (ext_io->device)\n\t\tbtd_device_unref(ext_io->device);\n\n\tif (ext_io->service)\n\t\tbtd_service_unref(ext_io->service);\n\n\tg_free(ext_io);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_slist_remove",
          "args": [
            "ext->conns",
            "conn"
          ],
          "line": 814
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_service_disconnecting_complete",
          "args": [
            "conn->service",
            "0"
          ],
          "line": 811
        },
        "resolved": true,
        "details": {
          "function_name": "btd_service_disconnecting_complete",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
          "lines": "385-395",
          "snippet": "void btd_service_disconnecting_complete(struct btd_service *service, int err)\n{\n\tif (service->state != BTD_SERVICE_STATE_CONNECTED &&\n\t\t\tservice->state != BTD_SERVICE_STATE_DISCONNECTING)\n\t\treturn;\n\n\tif (err == 0)\n\t\tchange_state(service, BTD_SERVICE_STATE_DISCONNECTED, 0);\n\telse /* If disconnect fails, we assume it remains connected */\n\t\tchange_state(service, BTD_SERVICE_STATE_CONNECTED, err);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/stat.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid btd_service_disconnecting_complete(struct btd_service *service, int err)\n{\n\tif (service->state != BTD_SERVICE_STATE_CONNECTED &&\n\t\t\tservice->state != BTD_SERVICE_STATE_DISCONNECTING)\n\t\treturn;\n\n\tif (err == 0)\n\t\tchange_state(service, BTD_SERVICE_STATE_DISCONNECTED, 0);\n\telse /* If disconnect fails, we assume it remains connected */\n\t\tchange_state(service, BTD_SERVICE_STATE_CONNECTED, err);\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_service_connecting_complete",
          "args": [
            "conn->service",
            "-EIO"
          ],
          "line": 809
        },
        "resolved": true,
        "details": {
          "function_name": "btd_service_connecting_complete",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
          "lines": "373-383",
          "snippet": "void btd_service_connecting_complete(struct btd_service *service, int err)\n{\n\tif (service->state != BTD_SERVICE_STATE_DISCONNECTED &&\n\t\t\tservice->state != BTD_SERVICE_STATE_CONNECTING)\n\t\treturn;\n\n\tif (err == 0)\n\t\tchange_state(service, BTD_SERVICE_STATE_CONNECTED, 0);\n\telse\n\t\tchange_state(service, BTD_SERVICE_STATE_DISCONNECTED, err);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/stat.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid btd_service_connecting_complete(struct btd_service *service, int err)\n{\n\tif (service->state != BTD_SERVICE_STATE_DISCONNECTED &&\n\t\t\tservice->state != BTD_SERVICE_STATE_CONNECTING)\n\t\treturn;\n\n\tif (err == 0)\n\t\tchange_state(service, BTD_SERVICE_STATE_CONNECTED, 0);\n\telse\n\t\tchange_state(service, BTD_SERVICE_STATE_DISCONNECTED, err);\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_service_get_state",
          "args": [
            "conn->service"
          ],
          "line": 807
        },
        "resolved": true,
        "details": {
          "function_name": "btd_service_get_state",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
          "lines": "331-334",
          "snippet": "btd_service_state_t btd_service_get_state(const struct btd_service *service)\n{\n\treturn service->state;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/stat.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nbtd_service_state_t btd_service_get_state(const struct btd_service *service)\n{\n\treturn service->state;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"%s disconnected from %s\"",
            "ext->name",
            "addr"
          ],
          "line": 804
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_error_free",
          "args": [
            "gerr"
          ],
          "line": 800
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"Unable to get io data for %s: %s\"",
            "ext->name",
            "gerr->message"
          ],
          "line": 798
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/log.c",
          "lines": "199-213",
          "snippet": "void btd_error(uint16_t index, const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_ERR, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(index, LOG_ERR, format, ap);\n\tva_end(ap);\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdarg.h>",
            "#include <syslog.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int logging_fd = -1;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"src/shared/util.h\"\n#include \"lib/hci.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int logging_fd = -1;\n\nvoid btd_error(uint16_t index, const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_ERR, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(index, LOG_ERR, format, ap);\n\tva_end(ap);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_io_get",
          "args": [
            "io",
            "&gerr",
            "BT_IO_OPT_DEST",
            "addr",
            "BT_IO_OPT_INVALID"
          ],
          "line": 796
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic gboolean ext_io_disconnected(GIOChannel *io, GIOCondition cond,\n\t\t\t\t\t\t\tgpointer user_data)\n{\n\tstruct ext_io *conn = user_data;\n\tstruct ext_profile *ext = conn->ext;\n\tGError *gerr = NULL;\n\tchar addr[18];\n\n\tif (cond & G_IO_NVAL)\n\t\treturn FALSE;\n\n\tbt_io_get(io, &gerr, BT_IO_OPT_DEST, addr, BT_IO_OPT_INVALID);\n\tif (gerr != NULL) {\n\t\terror(\"Unable to get io data for %s: %s\",\n\t\t\t\t\t\text->name, gerr->message);\n\t\tg_error_free(gerr);\n\t\tgoto drop;\n\t}\n\n\tDBG(\"%s disconnected from %s\", ext->name, addr);\ndrop:\n\tif (conn->service) {\n\t\tif (btd_service_get_state(conn->service) ==\n\t\t\t\t\t\tBTD_SERVICE_STATE_CONNECTING)\n\t\t\tbtd_service_connecting_complete(conn->service, -EIO);\n\t\telse\n\t\t\tbtd_service_disconnecting_complete(conn->service, 0);\n\t}\n\n\text->conns = g_slist_remove(ext->conns, conn);\n\text_io_destroy(conn);\n\treturn FALSE;\n}"
  },
  {
    "function_name": "ext_io_destroy",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
    "lines": "749-783",
    "snippet": "static void ext_io_destroy(gpointer p)\n{\n\tstruct ext_io *ext_io = p;\n\n\tif (ext_io->io_id > 0)\n\t\tg_source_remove(ext_io->io_id);\n\n\tif (ext_io->io) {\n\t\tg_io_channel_shutdown(ext_io->io, FALSE, NULL);\n\t\tg_io_channel_unref(ext_io->io);\n\t}\n\n\tif (ext_io->auth_id != 0)\n\t\tbtd_cancel_authorization(ext_io->auth_id);\n\n\tif (ext_io->pending) {\n\t\tdbus_pending_call_cancel(ext_io->pending);\n\t\tdbus_pending_call_unref(ext_io->pending);\n\t}\n\n\tif (ext_io->resolving)\n\t\tbt_cancel_discovery(btd_adapter_get_address(ext_io->adapter),\n\t\t\t\t\tdevice_get_address(ext_io->device));\n\n\tif (ext_io->adapter)\n\t\tbtd_adapter_unref(ext_io->adapter);\n\n\tif (ext_io->device)\n\t\tbtd_device_unref(ext_io->device);\n\n\tif (ext_io->service)\n\t\tbtd_service_unref(ext_io->service);\n\n\tg_free(ext_io);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"sdp-xml.h\"",
      "#include \"sdp-client.h\"",
      "#include \"dbus-common.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"btio/btio.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "ext_io"
          ],
          "line": 782
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_service_unref",
          "args": [
            "ext_io->service"
          ],
          "line": 780
        },
        "resolved": true,
        "details": {
          "function_name": "btd_service_unref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
          "lines": "122-132",
          "snippet": "void btd_service_unref(struct btd_service *service)\n{\n\tservice->ref--;\n\n\tDBG(\"%p: ref=%d\", service, service->ref);\n\n\tif (service->ref > 0)\n\t\treturn;\n\n\tg_free(service);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/stat.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid btd_service_unref(struct btd_service *service)\n{\n\tservice->ref--;\n\n\tDBG(\"%p: ref=%d\", service, service->ref);\n\n\tif (service->ref > 0)\n\t\treturn;\n\n\tg_free(service);\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_device_unref",
          "args": [
            "ext_io->device"
          ],
          "line": 777
        },
        "resolved": true,
        "details": {
          "function_name": "btd_device_unref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "6364-6377",
          "snippet": "void btd_device_unref(struct btd_device *device)\n{\n\tif (__sync_sub_and_fetch(&device->ref_count, 1))\n\t\treturn;\n\n\tif (!device->path) {\n\t\terror(\"freeing device without an object path\");\n\t\treturn;\n\t}\n\n\tDBG(\"Freeing device %s\", device->path);\n\n\tg_dbus_unregister_interface(dbus_conn, device->path, DEVICE_INTERFACE);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static DBusConnection *dbus_conn = NULL;",
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic void gatt_client_init(struct btd_device *device);\n\nvoid btd_device_unref(struct btd_device *device)\n{\n\tif (__sync_sub_and_fetch(&device->ref_count, 1))\n\t\treturn;\n\n\tif (!device->path) {\n\t\terror(\"freeing device without an object path\");\n\t\treturn;\n\t}\n\n\tDBG(\"Freeing device %s\", device->path);\n\n\tg_dbus_unregister_interface(dbus_conn, device->path, DEVICE_INTERFACE);\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_adapter_unref",
          "args": [
            "ext_io->adapter"
          ],
          "line": 774
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_unref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "4905-4921",
          "snippet": "void btd_adapter_unref(struct btd_adapter *adapter)\n{\n\tif (__sync_sub_and_fetch(&adapter->ref_count, 1))\n\t\treturn;\n\n\tif (!adapter->path) {\n\t\tDBG(\"Freeing adapter %u\", adapter->dev_id);\n\n\t\tadapter_free(adapter);\n\t\treturn;\n\t}\n\n\tDBG(\"Freeing adapter %s\", adapter->path);\n\n\tg_dbus_unregister_interface(dbus_conn, adapter->path,\n\t\t\t\t\t\tADAPTER_INTERFACE);\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define ADAPTER_INTERFACE\t\"org.bluez.Adapter1\""
          ],
          "globals_used": [
            "static DBusConnection *dbus_conn = NULL;",
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\n#define ADAPTER_INTERFACE\t\"org.bluez.Adapter1\"\n\nstatic DBusConnection *dbus_conn = NULL;\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nvoid btd_adapter_unref(struct btd_adapter *adapter)\n{\n\tif (__sync_sub_and_fetch(&adapter->ref_count, 1))\n\t\treturn;\n\n\tif (!adapter->path) {\n\t\tDBG(\"Freeing adapter %u\", adapter->dev_id);\n\n\t\tadapter_free(adapter);\n\t\treturn;\n\t}\n\n\tDBG(\"Freeing adapter %s\", adapter->path);\n\n\tg_dbus_unregister_interface(dbus_conn, adapter->path,\n\t\t\t\t\t\tADAPTER_INTERFACE);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_cancel_discovery",
          "args": [
            "btd_adapter_get_address(ext_io->adapter)",
            "device_get_address(ext_io->device)"
          ],
          "line": 770
        },
        "resolved": true,
        "details": {
          "function_name": "bt_cancel_discovery",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdp-client.c",
          "lines": "376-404",
          "snippet": "int bt_cancel_discovery(const bdaddr_t *src, const bdaddr_t *dst)\n{\n\tstruct search_context match, *ctxt;\n\tGSList *l;\n\n\tmemset(&match, 0, sizeof(match));\n\tbacpy(&match.src, src);\n\tbacpy(&match.dst, dst);\n\n\t/* Ongoing SDP Discovery */\n\tl = g_slist_find_custom(context_list, &match, find_by_bdaddr);\n\tif (l == NULL)\n\t\treturn -ENOENT;\n\n\tctxt = l->data;\n\n\tif (!ctxt->session)\n\t\treturn -ENOTCONN;\n\n\tif (ctxt->io_id)\n\t\tg_source_remove(ctxt->io_id);\n\n\tif (ctxt->session)\n\t\tsdp_close(ctxt->session);\n\n\tsearch_context_cleanup(ctxt);\n\n\treturn 0;\n}",
          "includes": [
            "#include \"sdp-client.h\"",
            "#include \"log.h\"",
            "#include \"btio/btio.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static GSList *context_list = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"sdp-client.h\"\n#include \"log.h\"\n#include \"btio/btio.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <config.h>\n\nstatic GSList *context_list = NULL;\n\nint bt_cancel_discovery(const bdaddr_t *src, const bdaddr_t *dst)\n{\n\tstruct search_context match, *ctxt;\n\tGSList *l;\n\n\tmemset(&match, 0, sizeof(match));\n\tbacpy(&match.src, src);\n\tbacpy(&match.dst, dst);\n\n\t/* Ongoing SDP Discovery */\n\tl = g_slist_find_custom(context_list, &match, find_by_bdaddr);\n\tif (l == NULL)\n\t\treturn -ENOENT;\n\n\tctxt = l->data;\n\n\tif (!ctxt->session)\n\t\treturn -ENOTCONN;\n\n\tif (ctxt->io_id)\n\t\tg_source_remove(ctxt->io_id);\n\n\tif (ctxt->session)\n\t\tsdp_close(ctxt->session);\n\n\tsearch_context_cleanup(ctxt);\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "device_get_address",
          "args": [
            "ext_io->device"
          ],
          "line": 771
        },
        "resolved": true,
        "details": {
          "function_name": "device_get_address",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5314-5317",
          "snippet": "const bdaddr_t *device_get_address(struct btd_device *device)\n{\n\treturn &device->bdaddr;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nconst bdaddr_t *device_get_address(struct btd_device *device)\n{\n\treturn &device->bdaddr;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_adapter_get_address",
          "args": [
            "ext_io->adapter"
          ],
          "line": 770
        },
        "resolved": true,
        "details": {
          "function_name": "btd_adapter_get_address",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "5881-5884",
          "snippet": "const bdaddr_t *btd_adapter_get_address(struct btd_adapter *adapter)\n{\n\treturn &adapter->bdaddr;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nconst bdaddr_t *btd_adapter_get_address(struct btd_adapter *adapter)\n{\n\treturn &adapter->bdaddr;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbus_pending_call_unref",
          "args": [
            "ext_io->pending"
          ],
          "line": 766
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbus_pending_call_cancel",
          "args": [
            "ext_io->pending"
          ],
          "line": 765
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_cancel_authorization",
          "args": [
            "ext_io->auth_id"
          ],
          "line": 762
        },
        "resolved": true,
        "details": {
          "function_name": "btd_cancel_authorization",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/adapter.c",
          "lines": "6618-6640",
          "snippet": "int btd_cancel_authorization(guint id)\n{\n\tstruct service_auth *auth;\n\n\tauth = find_authorization(id);\n\tif (auth == NULL)\n\t\treturn -EPERM;\n\n\tif (auth->svc_id > 0)\n\t\tdevice_remove_svc_complete_callback(auth->device,\n\t\t\t\t\t\t\t\tauth->svc_id);\n\n\tg_queue_remove(auth->adapter->auths, auth);\n\n\tif (auth->agent) {\n\t\tagent_cancel(auth->agent);\n\t\tagent_unref(auth->agent);\n\t}\n\n\tg_free(auth);\n\n\treturn 0;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"advertising.h\"",
            "#include \"gatt-database.h\"",
            "#include \"attrib-server.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"attrib/att.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"storage.h\"",
            "#include \"agent.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"sdpd.h\"",
            "#include \"hcid.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mgmt.h\"",
            "#include \"textfile.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"bluetooth/sdp_lib.h\"",
            "#include \"bluetooth/sdp.h\"",
            "#include \"bluetooth/hci_lib.h\"",
            "#include \"bluetooth/hci.h\"",
            "#include \"bluetooth/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <dirent.h>",
            "#include <sys/stat.h>",
            "#include <sys/file.h>",
            "#include <sys/ioctl.h>",
            "#include <stdbool.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <inttypes.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void trigger_pairable_timeout(struct btd_adapter *adapter);",
            "static void adapter_start(struct btd_adapter *adapter);",
            "static void adapter_stop(struct btd_adapter *adapter);",
            "static void trigger_passive_scanning(struct btd_adapter *adapter);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"advertising.h\"\n#include \"gatt-database.h\"\n#include \"attrib-server.h\"\n#include \"attrib/gatt.h\"\n#include \"attrib/att.h\"\n#include \"attrib/gattrib.h\"\n#include \"storage.h\"\n#include \"agent.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdpd.h\"\n#include \"hcid.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mgmt.h\"\n#include \"textfile.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/mgmt.h\"\n#include \"lib/uuid.h\"\n#include \"bluetooth/sdp_lib.h\"\n#include \"bluetooth/sdp.h\"\n#include \"bluetooth/hci_lib.h\"\n#include \"bluetooth/hci.h\"\n#include \"bluetooth/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <dirent.h>\n#include <sys/stat.h>\n#include <sys/file.h>\n#include <sys/ioctl.h>\n#include <stdbool.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <inttypes.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void trigger_pairable_timeout(struct btd_adapter *adapter);\nstatic void adapter_start(struct btd_adapter *adapter);\nstatic void adapter_stop(struct btd_adapter *adapter);\nstatic void trigger_passive_scanning(struct btd_adapter *adapter);\n\nint btd_cancel_authorization(guint id)\n{\n\tstruct service_auth *auth;\n\n\tauth = find_authorization(id);\n\tif (auth == NULL)\n\t\treturn -EPERM;\n\n\tif (auth->svc_id > 0)\n\t\tdevice_remove_svc_complete_callback(auth->device,\n\t\t\t\t\t\t\t\tauth->svc_id);\n\n\tg_queue_remove(auth->adapter->auths, auth);\n\n\tif (auth->agent) {\n\t\tagent_cancel(auth->agent);\n\t\tagent_unref(auth->agent);\n\t}\n\n\tg_free(auth);\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_io_channel_unref",
          "args": [
            "ext_io->io"
          ],
          "line": 758
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_io_channel_shutdown",
          "args": [
            "ext_io->io",
            "FALSE",
            "NULL"
          ],
          "line": 757
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_source_remove",
          "args": [
            "ext_io->io_id"
          ],
          "line": 754
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void ext_io_destroy(gpointer p)\n{\n\tstruct ext_io *ext_io = p;\n\n\tif (ext_io->io_id > 0)\n\t\tg_source_remove(ext_io->io_id);\n\n\tif (ext_io->io) {\n\t\tg_io_channel_shutdown(ext_io->io, FALSE, NULL);\n\t\tg_io_channel_unref(ext_io->io);\n\t}\n\n\tif (ext_io->auth_id != 0)\n\t\tbtd_cancel_authorization(ext_io->auth_id);\n\n\tif (ext_io->pending) {\n\t\tdbus_pending_call_cancel(ext_io->pending);\n\t\tdbus_pending_call_unref(ext_io->pending);\n\t}\n\n\tif (ext_io->resolving)\n\t\tbt_cancel_discovery(btd_adapter_get_address(ext_io->adapter),\n\t\t\t\t\tdevice_get_address(ext_io->device));\n\n\tif (ext_io->adapter)\n\t\tbtd_adapter_unref(ext_io->adapter);\n\n\tif (ext_io->device)\n\t\tbtd_device_unref(ext_io->device);\n\n\tif (ext_io->service)\n\t\tbtd_service_unref(ext_io->service);\n\n\tg_free(ext_io);\n}"
  },
  {
    "function_name": "find_ext_profile",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
    "lines": "731-747",
    "snippet": "static struct ext_profile *find_ext_profile(const char *owner,\n\t\t\t\t\t\tconst char *path)\n{\n\tGSList *l;\n\n\tfor (l = ext_profiles; l != NULL; l = g_slist_next(l)) {\n\t\tstruct ext_profile *ext = l->data;\n\n\t\tif (g_strcmp0(ext->owner, owner))\n\t\t\tcontinue;\n\n\t\tif (!g_strcmp0(ext->path, path))\n\t\t\treturn ext;\n\t}\n\n\treturn NULL;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"sdp-xml.h\"",
      "#include \"sdp-client.h\"",
      "#include \"dbus-common.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"btio/btio.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static GSList *ext_profiles = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_strcmp0",
          "args": [
            "ext->path",
            "path"
          ],
          "line": 742
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strcmp0",
          "args": [
            "ext->owner",
            "owner"
          ],
          "line": 739
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_next",
          "args": [
            "l"
          ],
          "line": 736
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic GSList *ext_profiles = NULL;\n\nstatic struct ext_profile *find_ext_profile(const char *owner,\n\t\t\t\t\t\tconst char *path)\n{\n\tGSList *l;\n\n\tfor (l = ext_profiles; l != NULL; l = g_slist_next(l)) {\n\t\tstruct ext_profile *ext = l->data;\n\n\t\tif (g_strcmp0(ext->owner, owner))\n\t\t\tcontinue;\n\n\t\tif (!g_strcmp0(ext->path, path))\n\t\t\treturn ext;\n\t}\n\n\treturn NULL;\n}"
  },
  {
    "function_name": "btd_profile_unregister",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
    "lines": "726-729",
    "snippet": "void btd_profile_unregister(struct btd_profile *profile)\n{\n\tprofiles = g_slist_remove(profiles, profile);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"sdp-xml.h\"",
      "#include \"sdp-client.h\"",
      "#include \"dbus-common.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"btio/btio.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static GSList *profiles = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_slist_remove",
          "args": [
            "profiles",
            "profile"
          ],
          "line": 728
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic GSList *profiles = NULL;\n\nvoid btd_profile_unregister(struct btd_profile *profile)\n{\n\tprofiles = g_slist_remove(profiles, profile);\n}"
  },
  {
    "function_name": "btd_profile_register",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
    "lines": "720-724",
    "snippet": "int btd_profile_register(struct btd_profile *profile)\n{\n\tprofiles = g_slist_append(profiles, profile);\n\treturn 0;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"sdp-xml.h\"",
      "#include \"sdp-client.h\"",
      "#include \"dbus-common.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"btio/btio.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static GSList *profiles = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_slist_append",
          "args": [
            "profiles",
            "profile"
          ],
          "line": 722
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic GSList *profiles = NULL;\n\nint btd_profile_register(struct btd_profile *profile)\n{\n\tprofiles = g_slist_append(profiles, profile);\n\treturn 0;\n}"
  },
  {
    "function_name": "btd_profile_foreach",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/profile.c",
    "lines": "698-718",
    "snippet": "void btd_profile_foreach(void (*func)(struct btd_profile *p, void *data),\n\t\t\t\t\t\t\t\tvoid *data)\n{\n\tGSList *l, *next;\n\n\tfor (l = profiles; l != NULL; l = next) {\n\t\tstruct btd_profile *profile = l->data;\n\n\t\tnext = g_slist_next(l);\n\n\t\tfunc(profile, data);\n\t}\n\n\tfor (l = ext_profiles; l != NULL; l = next) {\n\t\tstruct ext_profile *profile = l->data;\n\n\t\tnext = g_slist_next(l);\n\n\t\tfunc(&profile->p, data);\n\t}\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"sdp-xml.h\"",
      "#include \"sdp-client.h\"",
      "#include \"dbus-common.h\"",
      "#include \"uuid-helper.h\"",
      "#include \"error.h\"",
      "#include \"log.h\"",
      "#include \"sdpd.h\"",
      "#include \"btio/btio.h\"",
      "#include \"gdbus/gdbus.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/sdp_lib.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <dbus/dbus.h>",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <stdlib.h>",
      "#include <stdint.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static GSList *profiles = NULL;",
      "static GSList *ext_profiles = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "func",
          "args": [
            "&profile->p",
            "data"
          ],
          "line": 716
        },
        "resolved": true,
        "details": {
          "function_name": "convert_raw_attr_to_xml_func",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdp-xml.c",
          "lines": "977-991",
          "snippet": "static void convert_raw_attr_to_xml_func(void *val, void *data)\n{\n\tstruct conversion_data *cd = data;\n\tsdp_data_t *value = val;\n\tchar buf[STRBUFSIZE];\n\n\tbuf[STRBUFSIZE - 1] = '\\0';\n\tsnprintf(buf, STRBUFSIZE - 1, \"\\t<attribute id=\\\"0x%04x\\\">\\n\",\n\t\t value->attrId);\n\tcd->appender(cd->data, buf);\n\n\tconvert_raw_data_to_xml(value, 2, cd->data, cd->appender);\n\n\tcd->appender(cd->data, \"\\t</attribute>\\n\");\n}",
          "includes": [
            "#include \"sdp-xml.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include <glib.h>",
            "#include <stdlib.h>",
            "#include <limits.h>",
            "#include <string.h>",
            "#include <ctype.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define STRBUFSIZE 1024"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sdp-xml.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include <glib.h>\n#include <stdlib.h>\n#include <limits.h>\n#include <string.h>\n#include <ctype.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\n#define STRBUFSIZE 1024\n\nstatic void convert_raw_attr_to_xml_func(void *val, void *data)\n{\n\tstruct conversion_data *cd = data;\n\tsdp_data_t *value = val;\n\tchar buf[STRBUFSIZE];\n\n\tbuf[STRBUFSIZE - 1] = '\\0';\n\tsnprintf(buf, STRBUFSIZE - 1, \"\\t<attribute id=\\\"0x%04x\\\">\\n\",\n\t\t value->attrId);\n\tcd->appender(cd->data, buf);\n\n\tconvert_raw_data_to_xml(value, 2, cd->data, cd->appender);\n\n\tcd->appender(cd->data, \"\\t</attribute>\\n\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_slist_next",
          "args": [
            "l"
          ],
          "line": 714
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_next",
          "args": [
            "l"
          ],
          "line": 706
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"sdp-xml.h\"\n#include \"sdp-client.h\"\n#include \"dbus-common.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"log.h\"\n#include \"sdpd.h\"\n#include \"btio/btio.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <errno.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic GSList *profiles = NULL;\nstatic GSList *ext_profiles = NULL;\n\nvoid btd_profile_foreach(void (*func)(struct btd_profile *p, void *data),\n\t\t\t\t\t\t\t\tvoid *data)\n{\n\tGSList *l, *next;\n\n\tfor (l = profiles; l != NULL; l = next) {\n\t\tstruct btd_profile *profile = l->data;\n\n\t\tnext = g_slist_next(l);\n\n\t\tfunc(profile, data);\n\t}\n\n\tfor (l = ext_profiles; l != NULL; l = next) {\n\t\tstruct ext_profile *profile = l->data;\n\n\t\tnext = g_slist_next(l);\n\n\t\tfunc(&profile->p, data);\n\t}\n}"
  }
]