[
  {
    "function_name": "io_shutdown",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-mainloop.c",
    "lines": "318-324",
    "snippet": "bool io_shutdown(struct io *io)\n{\n\tif (!io || io->fd < 0)\n\t\treturn false;\n\n\treturn shutdown(io->fd, SHUT_RDWR) == 0;\n}",
    "includes": [
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <sys/socket.h>",
      "#include <errno.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "shutdown",
          "args": [
            "io->fd",
            "SHUT_RDWR"
          ],
          "line": 323
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/io.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mainloop.h\"\n#include <sys/socket.h>\n#include <errno.h>\n#include <unistd.h>\n#include <config.h>\n\nbool io_shutdown(struct io *io)\n{\n\tif (!io || io->fd < 0)\n\t\treturn false;\n\n\treturn shutdown(io->fd, SHUT_RDWR) == 0;\n}"
  },
  {
    "function_name": "io_send",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-mainloop.c",
    "lines": "301-316",
    "snippet": "ssize_t io_send(struct io *io, const struct iovec *iov, int iovcnt)\n{\n\tssize_t ret;\n\n\tif (!io || io->fd < 0)\n\t\treturn -ENOTCONN;\n\n\tdo {\n\t\tret = writev(io->fd, iov, iovcnt);\n\t} while (ret < 0 && errno == EINTR);\n\n\tif (ret < 0)\n\t\treturn -errno;\n\n\treturn ret;\n}",
    "includes": [
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <sys/socket.h>",
      "#include <errno.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "writev",
          "args": [
            "io->fd",
            "iov",
            "iovcnt"
          ],
          "line": 309
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/io.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mainloop.h\"\n#include <sys/socket.h>\n#include <errno.h>\n#include <unistd.h>\n#include <config.h>\n\nssize_t io_send(struct io *io, const struct iovec *iov, int iovcnt)\n{\n\tssize_t ret;\n\n\tif (!io || io->fd < 0)\n\t\treturn -ENOTCONN;\n\n\tdo {\n\t\tret = writev(io->fd, iov, iovcnt);\n\t} while (ret < 0 && errno == EINTR);\n\n\tif (ret < 0)\n\t\treturn -errno;\n\n\treturn ret;\n}"
  },
  {
    "function_name": "io_set_disconnect_handler",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-mainloop.c",
    "lines": "270-299",
    "snippet": "bool io_set_disconnect_handler(struct io *io, io_callback_func_t callback,\n\t\t\t\tvoid *user_data, io_destroy_func_t destroy)\n{\n\tuint32_t events;\n\n\tif (!io || io->fd < 0)\n\t\treturn false;\n\n\tif (io->disconnect_destroy)\n\t\tio->disconnect_destroy(io->disconnect_data);\n\n\tif (callback)\n\t\tevents = io->events | EPOLLRDHUP;\n\telse\n\t\tevents = io->events & ~EPOLLRDHUP;\n\n\tio->disconnect_callback = callback;\n\tio->disconnect_destroy = destroy;\n\tio->disconnect_data = user_data;\n\n\tif (events == io->events)\n\t\treturn true;\n\n\tif (mainloop_modify_fd(io->fd, events) < 0)\n\t\treturn false;\n\n\tio->events = events;\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <sys/socket.h>",
      "#include <errno.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "mainloop_modify_fd",
          "args": [
            "io->fd",
            "events"
          ],
          "line": 293
        },
        "resolved": true,
        "details": {
          "function_name": "mainloop_modify_fd",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mainloop.c",
          "lines": "225-249",
          "snippet": "int mainloop_modify_fd(int fd, uint32_t events)\n{\n\tstruct mainloop_data *data;\n\tstruct epoll_event ev;\n\tint err;\n\n\tif (fd < 0 || fd > MAX_MAINLOOP_ENTRIES - 1)\n\t\treturn -EINVAL;\n\n\tdata = mainloop_list[fd];\n\tif (!data)\n\t\treturn -ENXIO;\n\n\tmemset(&ev, 0, sizeof(ev));\n\tev.events = events;\n\tev.data.ptr = data;\n\n\terr = epoll_ctl(epoll_fd, EPOLL_CTL_MOD, data->fd, &ev);\n\tif (err < 0)\n\t\treturn err;\n\n\tdata->events = events;\n\n\treturn 0;\n}",
          "includes": [
            "#include \"mainloop.h\"",
            "#include <sys/epoll.h>",
            "#include <sys/timerfd.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define MAX_MAINLOOP_ENTRIES 128"
          ],
          "globals_used": [
            "static int epoll_fd;",
            "static struct mainloop_data *mainloop_list[MAX_MAINLOOP_ENTRIES];"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"mainloop.h\"\n#include <sys/epoll.h>\n#include <sys/timerfd.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\n#define MAX_MAINLOOP_ENTRIES 128\n\nstatic int epoll_fd;\nstatic struct mainloop_data *mainloop_list[MAX_MAINLOOP_ENTRIES];\n\nint mainloop_modify_fd(int fd, uint32_t events)\n{\n\tstruct mainloop_data *data;\n\tstruct epoll_event ev;\n\tint err;\n\n\tif (fd < 0 || fd > MAX_MAINLOOP_ENTRIES - 1)\n\t\treturn -EINVAL;\n\n\tdata = mainloop_list[fd];\n\tif (!data)\n\t\treturn -ENXIO;\n\n\tmemset(&ev, 0, sizeof(ev));\n\tev.events = events;\n\tev.data.ptr = data;\n\n\terr = epoll_ctl(epoll_fd, EPOLL_CTL_MOD, data->fd, &ev);\n\tif (err < 0)\n\t\treturn err;\n\n\tdata->events = events;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "io->disconnect_destroy",
          "args": [
            "io->disconnect_data"
          ],
          "line": 279
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/io.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mainloop.h\"\n#include <sys/socket.h>\n#include <errno.h>\n#include <unistd.h>\n#include <config.h>\n\nbool io_set_disconnect_handler(struct io *io, io_callback_func_t callback,\n\t\t\t\tvoid *user_data, io_destroy_func_t destroy)\n{\n\tuint32_t events;\n\n\tif (!io || io->fd < 0)\n\t\treturn false;\n\n\tif (io->disconnect_destroy)\n\t\tio->disconnect_destroy(io->disconnect_data);\n\n\tif (callback)\n\t\tevents = io->events | EPOLLRDHUP;\n\telse\n\t\tevents = io->events & ~EPOLLRDHUP;\n\n\tio->disconnect_callback = callback;\n\tio->disconnect_destroy = destroy;\n\tio->disconnect_data = user_data;\n\n\tif (events == io->events)\n\t\treturn true;\n\n\tif (mainloop_modify_fd(io->fd, events) < 0)\n\t\treturn false;\n\n\tio->events = events;\n\n\treturn true;\n}"
  },
  {
    "function_name": "io_set_write_handler",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-mainloop.c",
    "lines": "239-268",
    "snippet": "bool io_set_write_handler(struct io *io, io_callback_func_t callback,\n\t\t\t\tvoid *user_data, io_destroy_func_t destroy)\n{\n\tuint32_t events;\n\n\tif (!io || io->fd < 0)\n\t\treturn false;\n\n\tif (io->write_destroy)\n\t\tio->write_destroy(io->write_data);\n\n\tif (callback)\n\t\tevents = io->events | EPOLLOUT;\n\telse\n\t\tevents = io->events & ~EPOLLOUT;\n\n\tio->write_callback = callback;\n\tio->write_destroy = destroy;\n\tio->write_data = user_data;\n\n\tif (events == io->events)\n\t\treturn true;\n\n\tif (mainloop_modify_fd(io->fd, events) < 0)\n\t\treturn false;\n\n\tio->events = events;\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <sys/socket.h>",
      "#include <errno.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "mainloop_modify_fd",
          "args": [
            "io->fd",
            "events"
          ],
          "line": 262
        },
        "resolved": true,
        "details": {
          "function_name": "mainloop_modify_fd",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mainloop.c",
          "lines": "225-249",
          "snippet": "int mainloop_modify_fd(int fd, uint32_t events)\n{\n\tstruct mainloop_data *data;\n\tstruct epoll_event ev;\n\tint err;\n\n\tif (fd < 0 || fd > MAX_MAINLOOP_ENTRIES - 1)\n\t\treturn -EINVAL;\n\n\tdata = mainloop_list[fd];\n\tif (!data)\n\t\treturn -ENXIO;\n\n\tmemset(&ev, 0, sizeof(ev));\n\tev.events = events;\n\tev.data.ptr = data;\n\n\terr = epoll_ctl(epoll_fd, EPOLL_CTL_MOD, data->fd, &ev);\n\tif (err < 0)\n\t\treturn err;\n\n\tdata->events = events;\n\n\treturn 0;\n}",
          "includes": [
            "#include \"mainloop.h\"",
            "#include <sys/epoll.h>",
            "#include <sys/timerfd.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define MAX_MAINLOOP_ENTRIES 128"
          ],
          "globals_used": [
            "static int epoll_fd;",
            "static struct mainloop_data *mainloop_list[MAX_MAINLOOP_ENTRIES];"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"mainloop.h\"\n#include <sys/epoll.h>\n#include <sys/timerfd.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\n#define MAX_MAINLOOP_ENTRIES 128\n\nstatic int epoll_fd;\nstatic struct mainloop_data *mainloop_list[MAX_MAINLOOP_ENTRIES];\n\nint mainloop_modify_fd(int fd, uint32_t events)\n{\n\tstruct mainloop_data *data;\n\tstruct epoll_event ev;\n\tint err;\n\n\tif (fd < 0 || fd > MAX_MAINLOOP_ENTRIES - 1)\n\t\treturn -EINVAL;\n\n\tdata = mainloop_list[fd];\n\tif (!data)\n\t\treturn -ENXIO;\n\n\tmemset(&ev, 0, sizeof(ev));\n\tev.events = events;\n\tev.data.ptr = data;\n\n\terr = epoll_ctl(epoll_fd, EPOLL_CTL_MOD, data->fd, &ev);\n\tif (err < 0)\n\t\treturn err;\n\n\tdata->events = events;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "io->write_destroy",
          "args": [
            "io->write_data"
          ],
          "line": 248
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/io.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mainloop.h\"\n#include <sys/socket.h>\n#include <errno.h>\n#include <unistd.h>\n#include <config.h>\n\nbool io_set_write_handler(struct io *io, io_callback_func_t callback,\n\t\t\t\tvoid *user_data, io_destroy_func_t destroy)\n{\n\tuint32_t events;\n\n\tif (!io || io->fd < 0)\n\t\treturn false;\n\n\tif (io->write_destroy)\n\t\tio->write_destroy(io->write_data);\n\n\tif (callback)\n\t\tevents = io->events | EPOLLOUT;\n\telse\n\t\tevents = io->events & ~EPOLLOUT;\n\n\tio->write_callback = callback;\n\tio->write_destroy = destroy;\n\tio->write_data = user_data;\n\n\tif (events == io->events)\n\t\treturn true;\n\n\tif (mainloop_modify_fd(io->fd, events) < 0)\n\t\treturn false;\n\n\tio->events = events;\n\n\treturn true;\n}"
  },
  {
    "function_name": "io_set_read_handler",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-mainloop.c",
    "lines": "208-237",
    "snippet": "bool io_set_read_handler(struct io *io, io_callback_func_t callback,\n\t\t\t\tvoid *user_data, io_destroy_func_t destroy)\n{\n\tuint32_t events;\n\n\tif (!io || io->fd < 0)\n\t\treturn false;\n\n\tif (io->read_destroy)\n\t\tio->read_destroy(io->read_data);\n\n\tif (callback)\n\t\tevents = io->events | EPOLLIN;\n\telse\n\t\tevents = io->events & ~EPOLLIN;\n\n\tio->read_callback = callback;\n\tio->read_destroy = destroy;\n\tio->read_data = user_data;\n\n\tif (events == io->events)\n\t\treturn true;\n\n\tif (mainloop_modify_fd(io->fd, events) < 0)\n\t\treturn false;\n\n\tio->events = events;\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <sys/socket.h>",
      "#include <errno.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "mainloop_modify_fd",
          "args": [
            "io->fd",
            "events"
          ],
          "line": 231
        },
        "resolved": true,
        "details": {
          "function_name": "mainloop_modify_fd",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mainloop.c",
          "lines": "225-249",
          "snippet": "int mainloop_modify_fd(int fd, uint32_t events)\n{\n\tstruct mainloop_data *data;\n\tstruct epoll_event ev;\n\tint err;\n\n\tif (fd < 0 || fd > MAX_MAINLOOP_ENTRIES - 1)\n\t\treturn -EINVAL;\n\n\tdata = mainloop_list[fd];\n\tif (!data)\n\t\treturn -ENXIO;\n\n\tmemset(&ev, 0, sizeof(ev));\n\tev.events = events;\n\tev.data.ptr = data;\n\n\terr = epoll_ctl(epoll_fd, EPOLL_CTL_MOD, data->fd, &ev);\n\tif (err < 0)\n\t\treturn err;\n\n\tdata->events = events;\n\n\treturn 0;\n}",
          "includes": [
            "#include \"mainloop.h\"",
            "#include <sys/epoll.h>",
            "#include <sys/timerfd.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define MAX_MAINLOOP_ENTRIES 128"
          ],
          "globals_used": [
            "static int epoll_fd;",
            "static struct mainloop_data *mainloop_list[MAX_MAINLOOP_ENTRIES];"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"mainloop.h\"\n#include <sys/epoll.h>\n#include <sys/timerfd.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\n#define MAX_MAINLOOP_ENTRIES 128\n\nstatic int epoll_fd;\nstatic struct mainloop_data *mainloop_list[MAX_MAINLOOP_ENTRIES];\n\nint mainloop_modify_fd(int fd, uint32_t events)\n{\n\tstruct mainloop_data *data;\n\tstruct epoll_event ev;\n\tint err;\n\n\tif (fd < 0 || fd > MAX_MAINLOOP_ENTRIES - 1)\n\t\treturn -EINVAL;\n\n\tdata = mainloop_list[fd];\n\tif (!data)\n\t\treturn -ENXIO;\n\n\tmemset(&ev, 0, sizeof(ev));\n\tev.events = events;\n\tev.data.ptr = data;\n\n\terr = epoll_ctl(epoll_fd, EPOLL_CTL_MOD, data->fd, &ev);\n\tif (err < 0)\n\t\treturn err;\n\n\tdata->events = events;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "io->read_destroy",
          "args": [
            "io->read_data"
          ],
          "line": 217
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/io.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mainloop.h\"\n#include <sys/socket.h>\n#include <errno.h>\n#include <unistd.h>\n#include <config.h>\n\nbool io_set_read_handler(struct io *io, io_callback_func_t callback,\n\t\t\t\tvoid *user_data, io_destroy_func_t destroy)\n{\n\tuint32_t events;\n\n\tif (!io || io->fd < 0)\n\t\treturn false;\n\n\tif (io->read_destroy)\n\t\tio->read_destroy(io->read_data);\n\n\tif (callback)\n\t\tevents = io->events | EPOLLIN;\n\telse\n\t\tevents = io->events & ~EPOLLIN;\n\n\tio->read_callback = callback;\n\tio->read_destroy = destroy;\n\tio->read_data = user_data;\n\n\tif (events == io->events)\n\t\treturn true;\n\n\tif (mainloop_modify_fd(io->fd, events) < 0)\n\t\treturn false;\n\n\tio->events = events;\n\n\treturn true;\n}"
  },
  {
    "function_name": "io_set_close_on_destroy",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-mainloop.c",
    "lines": "198-206",
    "snippet": "bool io_set_close_on_destroy(struct io *io, bool do_close)\n{\n\tif (!io)\n\t\treturn false;\n\n\tio->close_on_destroy = do_close;\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <sys/socket.h>",
      "#include <errno.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"src/shared/io.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mainloop.h\"\n#include <sys/socket.h>\n#include <errno.h>\n#include <unistd.h>\n#include <config.h>\n\nbool io_set_close_on_destroy(struct io *io, bool do_close)\n{\n\tif (!io)\n\t\treturn false;\n\n\tio->close_on_destroy = do_close;\n\n\treturn true;\n}"
  },
  {
    "function_name": "io_get_fd",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-mainloop.c",
    "lines": "190-196",
    "snippet": "int io_get_fd(struct io *io)\n{\n\tif (!io)\n\t\treturn -ENOTCONN;\n\n\treturn io->fd;\n}",
    "includes": [
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <sys/socket.h>",
      "#include <errno.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"src/shared/io.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mainloop.h\"\n#include <sys/socket.h>\n#include <errno.h>\n#include <unistd.h>\n#include <config.h>\n\nint io_get_fd(struct io *io)\n{\n\tif (!io)\n\t\treturn -ENOTCONN;\n\n\treturn io->fd;\n}"
  },
  {
    "function_name": "io_destroy",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-mainloop.c",
    "lines": "176-188",
    "snippet": "void io_destroy(struct io *io)\n{\n\tif (!io)\n\t\treturn;\n\n\tio->read_callback = NULL;\n\tio->write_callback = NULL;\n\tio->disconnect_callback = NULL;\n\n\tmainloop_remove_fd(io->fd);\n\n\tio_unref(io);\n}",
    "includes": [
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <sys/socket.h>",
      "#include <errno.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "io_unref",
          "args": [
            "io"
          ],
          "line": 187
        },
        "resolved": true,
        "details": {
          "function_name": "io_unref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-mainloop.c",
          "lines": "62-71",
          "snippet": "static void io_unref(struct io *io)\n{\n\tif (!io)\n\t\treturn;\n\n\tif (__sync_sub_and_fetch(&io->ref_count, 1))\n\t\treturn;\n\n\tfree(io);\n}",
          "includes": [
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include <sys/socket.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/io.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mainloop.h\"\n#include <sys/socket.h>\n#include <errno.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic void io_unref(struct io *io)\n{\n\tif (!io)\n\t\treturn;\n\n\tif (__sync_sub_and_fetch(&io->ref_count, 1))\n\t\treturn;\n\n\tfree(io);\n}"
        }
      },
      {
        "call_info": {
          "callee": "mainloop_remove_fd",
          "args": [
            "io->fd"
          ],
          "line": 185
        },
        "resolved": true,
        "details": {
          "function_name": "mainloop_remove_fd",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mainloop.c",
          "lines": "251-273",
          "snippet": "int mainloop_remove_fd(int fd)\n{\n\tstruct mainloop_data *data;\n\tint err;\n\n\tif (fd < 0 || fd > MAX_MAINLOOP_ENTRIES - 1)\n\t\treturn -EINVAL;\n\n\tdata = mainloop_list[fd];\n\tif (!data)\n\t\treturn -ENXIO;\n\n\tmainloop_list[fd] = NULL;\n\n\terr = epoll_ctl(epoll_fd, EPOLL_CTL_DEL, data->fd, NULL);\n\n\tif (data->destroy)\n\t\tdata->destroy(data->user_data);\n\n\tfree(data);\n\n\treturn err;\n}",
          "includes": [
            "#include \"mainloop.h\"",
            "#include <sys/epoll.h>",
            "#include <sys/timerfd.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define MAX_MAINLOOP_ENTRIES 128"
          ],
          "globals_used": [
            "static int epoll_fd;",
            "static struct mainloop_data *mainloop_list[MAX_MAINLOOP_ENTRIES];"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"mainloop.h\"\n#include <sys/epoll.h>\n#include <sys/timerfd.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\n#define MAX_MAINLOOP_ENTRIES 128\n\nstatic int epoll_fd;\nstatic struct mainloop_data *mainloop_list[MAX_MAINLOOP_ENTRIES];\n\nint mainloop_remove_fd(int fd)\n{\n\tstruct mainloop_data *data;\n\tint err;\n\n\tif (fd < 0 || fd > MAX_MAINLOOP_ENTRIES - 1)\n\t\treturn -EINVAL;\n\n\tdata = mainloop_list[fd];\n\tif (!data)\n\t\treturn -ENXIO;\n\n\tmainloop_list[fd] = NULL;\n\n\terr = epoll_ctl(epoll_fd, EPOLL_CTL_DEL, data->fd, NULL);\n\n\tif (data->destroy)\n\t\tdata->destroy(data->user_data);\n\n\tfree(data);\n\n\treturn err;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/io.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mainloop.h\"\n#include <sys/socket.h>\n#include <errno.h>\n#include <unistd.h>\n#include <config.h>\n\nvoid io_destroy(struct io *io)\n{\n\tif (!io)\n\t\treturn;\n\n\tio->read_callback = NULL;\n\tio->write_callback = NULL;\n\tio->disconnect_callback = NULL;\n\n\tmainloop_remove_fd(io->fd);\n\n\tio_unref(io);\n}"
  },
  {
    "function_name": "io_new",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-mainloop.c",
    "lines": "155-174",
    "snippet": "struct io *io_new(int fd)\n{\n\tstruct io *io;\n\n\tif (fd < 0)\n\t\treturn NULL;\n\n\tio = new0(struct io, 1);\n\tio->fd = fd;\n\tio->events = 0;\n\tio->close_on_destroy = false;\n\n\tif (mainloop_add_fd(io->fd, io->events, io_callback,\n\t\t\t\t\t\tio, io_cleanup) < 0) {\n\t\tfree(io);\n\t\treturn NULL;\n\t}\n\n\treturn io_ref(io);\n}",
    "includes": [
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <sys/socket.h>",
      "#include <errno.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "io_ref",
          "args": [
            "io"
          ],
          "line": 173
        },
        "resolved": true,
        "details": {
          "function_name": "io_ref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-mainloop.c",
          "lines": "52-60",
          "snippet": "static struct io *io_ref(struct io *io)\n{\n\tif (!io)\n\t\treturn NULL;\n\n\t__sync_fetch_and_add(&io->ref_count, 1);\n\n\treturn io;\n}",
          "includes": [
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include <sys/socket.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/io.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mainloop.h\"\n#include <sys/socket.h>\n#include <errno.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic struct io *io_ref(struct io *io)\n{\n\tif (!io)\n\t\treturn NULL;\n\n\t__sync_fetch_and_add(&io->ref_count, 1);\n\n\treturn io;\n}"
        }
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "io"
          ],
          "line": 169
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "956-985",
          "snippet": "static void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}"
        }
      },
      {
        "call_info": {
          "callee": "mainloop_add_fd",
          "args": [
            "io->fd",
            "io->events",
            "io_callback",
            "io",
            "io_cleanup"
          ],
          "line": 167
        },
        "resolved": true,
        "details": {
          "function_name": "mainloop_add_fd",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mainloop.c",
          "lines": "189-223",
          "snippet": "int mainloop_add_fd(int fd, uint32_t events, mainloop_event_func callback,\n\t\t\t\tvoid *user_data, mainloop_destroy_func destroy)\n{\n\tstruct mainloop_data *data;\n\tstruct epoll_event ev;\n\tint err;\n\n\tif (fd < 0 || fd > MAX_MAINLOOP_ENTRIES - 1 || !callback)\n\t\treturn -EINVAL;\n\n\tdata = malloc(sizeof(*data));\n\tif (!data)\n\t\treturn -ENOMEM;\n\n\tmemset(data, 0, sizeof(*data));\n\tdata->fd = fd;\n\tdata->events = events;\n\tdata->callback = callback;\n\tdata->destroy = destroy;\n\tdata->user_data = user_data;\n\n\tmemset(&ev, 0, sizeof(ev));\n\tev.events = events;\n\tev.data.ptr = data;\n\n\terr = epoll_ctl(epoll_fd, EPOLL_CTL_ADD, data->fd, &ev);\n\tif (err < 0) {\n\t\tfree(data);\n\t\treturn err;\n\t}\n\n\tmainloop_list[fd] = data;\n\n\treturn 0;\n}",
          "includes": [
            "#include \"mainloop.h\"",
            "#include <sys/epoll.h>",
            "#include <sys/timerfd.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define MAX_MAINLOOP_ENTRIES 128"
          ],
          "globals_used": [
            "static int epoll_fd;",
            "static struct mainloop_data *mainloop_list[MAX_MAINLOOP_ENTRIES];"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"mainloop.h\"\n#include <sys/epoll.h>\n#include <sys/timerfd.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\n#define MAX_MAINLOOP_ENTRIES 128\n\nstatic int epoll_fd;\nstatic struct mainloop_data *mainloop_list[MAX_MAINLOOP_ENTRIES];\n\nint mainloop_add_fd(int fd, uint32_t events, mainloop_event_func callback,\n\t\t\t\tvoid *user_data, mainloop_destroy_func destroy)\n{\n\tstruct mainloop_data *data;\n\tstruct epoll_event ev;\n\tint err;\n\n\tif (fd < 0 || fd > MAX_MAINLOOP_ENTRIES - 1 || !callback)\n\t\treturn -EINVAL;\n\n\tdata = malloc(sizeof(*data));\n\tif (!data)\n\t\treturn -ENOMEM;\n\n\tmemset(data, 0, sizeof(*data));\n\tdata->fd = fd;\n\tdata->events = events;\n\tdata->callback = callback;\n\tdata->destroy = destroy;\n\tdata->user_data = user_data;\n\n\tmemset(&ev, 0, sizeof(ev));\n\tev.events = events;\n\tev.data.ptr = data;\n\n\terr = epoll_ctl(epoll_fd, EPOLL_CTL_ADD, data->fd, &ev);\n\tif (err < 0) {\n\t\tfree(data);\n\t\treturn err;\n\t}\n\n\tmainloop_list[fd] = data;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "new0",
          "args": [
            "structio",
            "1"
          ],
          "line": 162
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/io.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mainloop.h\"\n#include <sys/socket.h>\n#include <errno.h>\n#include <unistd.h>\n#include <config.h>\n\nstruct io *io_new(int fd)\n{\n\tstruct io *io;\n\n\tif (fd < 0)\n\t\treturn NULL;\n\n\tio = new0(struct io, 1);\n\tio->fd = fd;\n\tio->events = 0;\n\tio->close_on_destroy = false;\n\n\tif (mainloop_add_fd(io->fd, io->events, io_callback,\n\t\t\t\t\t\tio, io_cleanup) < 0) {\n\t\tfree(io);\n\t\treturn NULL;\n\t}\n\n\treturn io_ref(io);\n}"
  },
  {
    "function_name": "io_callback",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-mainloop.c",
    "lines": "92-153",
    "snippet": "static void io_callback(int fd, uint32_t events, void *user_data)\n{\n\tstruct io *io = user_data;\n\n\tio_ref(io);\n\n\tif ((events & (EPOLLRDHUP | EPOLLHUP | EPOLLERR))) {\n\t\tio->read_callback = NULL;\n\t\tio->write_callback = NULL;\n\n\t\tif (!io->disconnect_callback) {\n\t\t\tmainloop_remove_fd(io->fd);\n\t\t\tio_unref(io);\n\t\t\treturn;\n\t\t}\n\n\t\tif (!io->disconnect_callback(io, io->disconnect_data)) {\n\t\t\tif (io->disconnect_destroy)\n\t\t\t\tio->disconnect_destroy(io->disconnect_data);\n\n\t\t\tio->disconnect_callback = NULL;\n\t\t\tio->disconnect_destroy = NULL;\n\t\t\tio->disconnect_data = NULL;\n\n\t\t\tio->events &= ~EPOLLRDHUP;\n\n\t\t\tmainloop_modify_fd(io->fd, io->events);\n\t\t}\n\t}\n\n\tif ((events & EPOLLIN) && io->read_callback) {\n\t\tif (!io->read_callback(io, io->read_data)) {\n\t\t\tif (io->read_destroy)\n\t\t\t\tio->read_destroy(io->read_data);\n\n\t\t\tio->read_callback = NULL;\n\t\t\tio->read_destroy = NULL;\n\t\t\tio->read_data = NULL;\n\n\t\t\tio->events &= ~EPOLLIN;\n\n\t\t\tmainloop_modify_fd(io->fd, io->events);\n\t\t}\n\t}\n\n\tif ((events & EPOLLOUT) && io->write_callback) {\n\t\tif (!io->write_callback(io, io->write_data)) {\n\t\t\tif (io->write_destroy)\n\t\t\t\tio->write_destroy(io->write_data);\n\n\t\t\tio->write_callback = NULL;\n\t\t\tio->write_destroy = NULL;\n\t\t\tio->write_data = NULL;\n\n\t\t\tio->events &= ~EPOLLOUT;\n\n\t\t\tmainloop_modify_fd(io->fd, io->events);\n\t\t}\n\t}\n\n\tio_unref(io);\n}",
    "includes": [
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <sys/socket.h>",
      "#include <errno.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "io_unref",
          "args": [
            "io"
          ],
          "line": 152
        },
        "resolved": true,
        "details": {
          "function_name": "io_unref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-mainloop.c",
          "lines": "62-71",
          "snippet": "static void io_unref(struct io *io)\n{\n\tif (!io)\n\t\treturn;\n\n\tif (__sync_sub_and_fetch(&io->ref_count, 1))\n\t\treturn;\n\n\tfree(io);\n}",
          "includes": [
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include <sys/socket.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/io.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mainloop.h\"\n#include <sys/socket.h>\n#include <errno.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic void io_unref(struct io *io)\n{\n\tif (!io)\n\t\treturn;\n\n\tif (__sync_sub_and_fetch(&io->ref_count, 1))\n\t\treturn;\n\n\tfree(io);\n}"
        }
      },
      {
        "call_info": {
          "callee": "mainloop_modify_fd",
          "args": [
            "io->fd",
            "io->events"
          ],
          "line": 148
        },
        "resolved": true,
        "details": {
          "function_name": "mainloop_modify_fd",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mainloop.c",
          "lines": "225-249",
          "snippet": "int mainloop_modify_fd(int fd, uint32_t events)\n{\n\tstruct mainloop_data *data;\n\tstruct epoll_event ev;\n\tint err;\n\n\tif (fd < 0 || fd > MAX_MAINLOOP_ENTRIES - 1)\n\t\treturn -EINVAL;\n\n\tdata = mainloop_list[fd];\n\tif (!data)\n\t\treturn -ENXIO;\n\n\tmemset(&ev, 0, sizeof(ev));\n\tev.events = events;\n\tev.data.ptr = data;\n\n\terr = epoll_ctl(epoll_fd, EPOLL_CTL_MOD, data->fd, &ev);\n\tif (err < 0)\n\t\treturn err;\n\n\tdata->events = events;\n\n\treturn 0;\n}",
          "includes": [
            "#include \"mainloop.h\"",
            "#include <sys/epoll.h>",
            "#include <sys/timerfd.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define MAX_MAINLOOP_ENTRIES 128"
          ],
          "globals_used": [
            "static int epoll_fd;",
            "static struct mainloop_data *mainloop_list[MAX_MAINLOOP_ENTRIES];"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"mainloop.h\"\n#include <sys/epoll.h>\n#include <sys/timerfd.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\n#define MAX_MAINLOOP_ENTRIES 128\n\nstatic int epoll_fd;\nstatic struct mainloop_data *mainloop_list[MAX_MAINLOOP_ENTRIES];\n\nint mainloop_modify_fd(int fd, uint32_t events)\n{\n\tstruct mainloop_data *data;\n\tstruct epoll_event ev;\n\tint err;\n\n\tif (fd < 0 || fd > MAX_MAINLOOP_ENTRIES - 1)\n\t\treturn -EINVAL;\n\n\tdata = mainloop_list[fd];\n\tif (!data)\n\t\treturn -ENXIO;\n\n\tmemset(&ev, 0, sizeof(ev));\n\tev.events = events;\n\tev.data.ptr = data;\n\n\terr = epoll_ctl(epoll_fd, EPOLL_CTL_MOD, data->fd, &ev);\n\tif (err < 0)\n\t\treturn err;\n\n\tdata->events = events;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "io->write_destroy",
          "args": [
            "io->write_data"
          ],
          "line": 140
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "io->write_callback",
          "args": [
            "io",
            "io->write_data"
          ],
          "line": 138
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "io->read_destroy",
          "args": [
            "io->read_data"
          ],
          "line": 125
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "io->read_callback",
          "args": [
            "io",
            "io->read_data"
          ],
          "line": 123
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "io->disconnect_destroy",
          "args": [
            "io->disconnect_data"
          ],
          "line": 110
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "io->disconnect_callback",
          "args": [
            "io",
            "io->disconnect_data"
          ],
          "line": 108
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mainloop_remove_fd",
          "args": [
            "io->fd"
          ],
          "line": 103
        },
        "resolved": true,
        "details": {
          "function_name": "mainloop_remove_fd",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/mainloop.c",
          "lines": "251-273",
          "snippet": "int mainloop_remove_fd(int fd)\n{\n\tstruct mainloop_data *data;\n\tint err;\n\n\tif (fd < 0 || fd > MAX_MAINLOOP_ENTRIES - 1)\n\t\treturn -EINVAL;\n\n\tdata = mainloop_list[fd];\n\tif (!data)\n\t\treturn -ENXIO;\n\n\tmainloop_list[fd] = NULL;\n\n\terr = epoll_ctl(epoll_fd, EPOLL_CTL_DEL, data->fd, NULL);\n\n\tif (data->destroy)\n\t\tdata->destroy(data->user_data);\n\n\tfree(data);\n\n\treturn err;\n}",
          "includes": [
            "#include \"mainloop.h\"",
            "#include <sys/epoll.h>",
            "#include <sys/timerfd.h>",
            "#include <sys/signalfd.h>",
            "#include <signal.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <unistd.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define MAX_MAINLOOP_ENTRIES 128"
          ],
          "globals_used": [
            "static int epoll_fd;",
            "static struct mainloop_data *mainloop_list[MAX_MAINLOOP_ENTRIES];"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"mainloop.h\"\n#include <sys/epoll.h>\n#include <sys/timerfd.h>\n#include <sys/signalfd.h>\n#include <signal.h>\n#include <string.h>\n#include <stdlib.h>\n#include <unistd.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\n#define MAX_MAINLOOP_ENTRIES 128\n\nstatic int epoll_fd;\nstatic struct mainloop_data *mainloop_list[MAX_MAINLOOP_ENTRIES];\n\nint mainloop_remove_fd(int fd)\n{\n\tstruct mainloop_data *data;\n\tint err;\n\n\tif (fd < 0 || fd > MAX_MAINLOOP_ENTRIES - 1)\n\t\treturn -EINVAL;\n\n\tdata = mainloop_list[fd];\n\tif (!data)\n\t\treturn -ENXIO;\n\n\tmainloop_list[fd] = NULL;\n\n\terr = epoll_ctl(epoll_fd, EPOLL_CTL_DEL, data->fd, NULL);\n\n\tif (data->destroy)\n\t\tdata->destroy(data->user_data);\n\n\tfree(data);\n\n\treturn err;\n}"
        }
      },
      {
        "call_info": {
          "callee": "io_ref",
          "args": [
            "io"
          ],
          "line": 96
        },
        "resolved": true,
        "details": {
          "function_name": "io_ref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-mainloop.c",
          "lines": "52-60",
          "snippet": "static struct io *io_ref(struct io *io)\n{\n\tif (!io)\n\t\treturn NULL;\n\n\t__sync_fetch_and_add(&io->ref_count, 1);\n\n\treturn io;\n}",
          "includes": [
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/mainloop.h\"",
            "#include <sys/socket.h>",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/io.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mainloop.h\"\n#include <sys/socket.h>\n#include <errno.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic struct io *io_ref(struct io *io)\n{\n\tif (!io)\n\t\treturn NULL;\n\n\t__sync_fetch_and_add(&io->ref_count, 1);\n\n\treturn io;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/io.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mainloop.h\"\n#include <sys/socket.h>\n#include <errno.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic void io_callback(int fd, uint32_t events, void *user_data)\n{\n\tstruct io *io = user_data;\n\n\tio_ref(io);\n\n\tif ((events & (EPOLLRDHUP | EPOLLHUP | EPOLLERR))) {\n\t\tio->read_callback = NULL;\n\t\tio->write_callback = NULL;\n\n\t\tif (!io->disconnect_callback) {\n\t\t\tmainloop_remove_fd(io->fd);\n\t\t\tio_unref(io);\n\t\t\treturn;\n\t\t}\n\n\t\tif (!io->disconnect_callback(io, io->disconnect_data)) {\n\t\t\tif (io->disconnect_destroy)\n\t\t\t\tio->disconnect_destroy(io->disconnect_data);\n\n\t\t\tio->disconnect_callback = NULL;\n\t\t\tio->disconnect_destroy = NULL;\n\t\t\tio->disconnect_data = NULL;\n\n\t\t\tio->events &= ~EPOLLRDHUP;\n\n\t\t\tmainloop_modify_fd(io->fd, io->events);\n\t\t}\n\t}\n\n\tif ((events & EPOLLIN) && io->read_callback) {\n\t\tif (!io->read_callback(io, io->read_data)) {\n\t\t\tif (io->read_destroy)\n\t\t\t\tio->read_destroy(io->read_data);\n\n\t\t\tio->read_callback = NULL;\n\t\t\tio->read_destroy = NULL;\n\t\t\tio->read_data = NULL;\n\n\t\t\tio->events &= ~EPOLLIN;\n\n\t\t\tmainloop_modify_fd(io->fd, io->events);\n\t\t}\n\t}\n\n\tif ((events & EPOLLOUT) && io->write_callback) {\n\t\tif (!io->write_callback(io, io->write_data)) {\n\t\t\tif (io->write_destroy)\n\t\t\t\tio->write_destroy(io->write_data);\n\n\t\t\tio->write_callback = NULL;\n\t\t\tio->write_destroy = NULL;\n\t\t\tio->write_data = NULL;\n\n\t\t\tio->events &= ~EPOLLOUT;\n\n\t\t\tmainloop_modify_fd(io->fd, io->events);\n\t\t}\n\t}\n\n\tio_unref(io);\n}"
  },
  {
    "function_name": "io_cleanup",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-mainloop.c",
    "lines": "73-90",
    "snippet": "static void io_cleanup(void *user_data)\n{\n\tstruct io *io = user_data;\n\n\tif (io->write_destroy)\n\t\tio->write_destroy(io->write_data);\n\n\tif (io->read_destroy)\n\t\tio->read_destroy(io->read_data);\n\n\tif (io->disconnect_destroy)\n\t\tio->disconnect_destroy(io->disconnect_data);\n\n\tif (io->close_on_destroy)\n\t\tclose(io->fd);\n\n\tio->fd = -1;\n}",
    "includes": [
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <sys/socket.h>",
      "#include <errno.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "close",
          "args": [
            "io->fd"
          ],
          "line": 87
        },
        "resolved": true,
        "details": {
          "function_name": "hfp_context_close_container",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/hfp.c",
          "lines": "334-347",
          "snippet": "bool hfp_context_close_container(struct hfp_context *context)\n{\n\tskip_whitespace(context);\n\n\t/* The list shall be followed by a right parenthesis (\")\" V250 5.7.3.1*/\n\tif (context->data[context->offset] != ')')\n\t\treturn false;\n\n\tcontext->offset++;\n\n\tnext_field(context);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/hfp.h\"",
            "#include \"src/shared/io.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/ringbuf.h\"",
            "#include \"src/shared/util.h\"",
            "#include <ctype.h>",
            "#include <stdarg.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/hfp.h\"\n#include \"src/shared/io.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/ringbuf.h\"\n#include \"src/shared/util.h\"\n#include <ctype.h>\n#include <stdarg.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdio.h>\n#include <config.h>\n\nbool hfp_context_close_container(struct hfp_context *context)\n{\n\tskip_whitespace(context);\n\n\t/* The list shall be followed by a right parenthesis (\")\" V250 5.7.3.1*/\n\tif (context->data[context->offset] != ')')\n\t\treturn false;\n\n\tcontext->offset++;\n\n\tnext_field(context);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "io->disconnect_destroy",
          "args": [
            "io->disconnect_data"
          ],
          "line": 84
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "io->read_destroy",
          "args": [
            "io->read_data"
          ],
          "line": 81
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "io->write_destroy",
          "args": [
            "io->write_data"
          ],
          "line": 78
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/io.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mainloop.h\"\n#include <sys/socket.h>\n#include <errno.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic void io_cleanup(void *user_data)\n{\n\tstruct io *io = user_data;\n\n\tif (io->write_destroy)\n\t\tio->write_destroy(io->write_data);\n\n\tif (io->read_destroy)\n\t\tio->read_destroy(io->read_data);\n\n\tif (io->disconnect_destroy)\n\t\tio->disconnect_destroy(io->disconnect_data);\n\n\tif (io->close_on_destroy)\n\t\tclose(io->fd);\n\n\tio->fd = -1;\n}"
  },
  {
    "function_name": "io_unref",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-mainloop.c",
    "lines": "62-71",
    "snippet": "static void io_unref(struct io *io)\n{\n\tif (!io)\n\t\treturn;\n\n\tif (__sync_sub_and_fetch(&io->ref_count, 1))\n\t\treturn;\n\n\tfree(io);\n}",
    "includes": [
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <sys/socket.h>",
      "#include <errno.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "io"
          ],
          "line": 70
        },
        "resolved": true,
        "details": {
          "function_name": "bt_att_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/att.c",
          "lines": "956-985",
          "snippet": "static void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}",
          "includes": [
            "#include \"src/shared/crypto.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/l2cap.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/io.h\"",
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/crypto.h\"\n#include \"src/shared/att.h\"\n#include \"lib/uuid.h\"\n#include \"lib/l2cap.h\"\n#include \"lib/bluetooth.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/io.h\"\n#include <errno.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic void bt_att_free(struct bt_att *att)\n{\n\tif (att->pending_req)\n\t\tdestroy_att_send_op(att->pending_req);\n\n\tif (att->pending_ind)\n\t\tdestroy_att_send_op(att->pending_ind);\n\n\tio_destroy(att->io);\n\tbt_crypto_unref(att->crypto);\n\n\tqueue_destroy(att->req_queue, NULL);\n\tqueue_destroy(att->ind_queue, NULL);\n\tqueue_destroy(att->write_queue, NULL);\n\tqueue_destroy(att->notify_list, NULL);\n\tqueue_destroy(att->disconn_list, NULL);\n\n\tif (att->timeout_destroy)\n\t\tatt->timeout_destroy(att->timeout_data);\n\n\tif (att->debug_destroy)\n\t\tatt->debug_destroy(att->debug_data);\n\n\tfree(att->local_sign);\n\tfree(att->remote_sign);\n\n\tfree(att->buf);\n\n\tfree(att);\n}"
        }
      },
      {
        "call_info": {
          "callee": "__sync_sub_and_fetch",
          "args": [
            "&io->ref_count",
            "1"
          ],
          "line": 67
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/io.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mainloop.h\"\n#include <sys/socket.h>\n#include <errno.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic void io_unref(struct io *io)\n{\n\tif (!io)\n\t\treturn;\n\n\tif (__sync_sub_and_fetch(&io->ref_count, 1))\n\t\treturn;\n\n\tfree(io);\n}"
  },
  {
    "function_name": "io_ref",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/io-mainloop.c",
    "lines": "52-60",
    "snippet": "static struct io *io_ref(struct io *io)\n{\n\tif (!io)\n\t\treturn NULL;\n\n\t__sync_fetch_and_add(&io->ref_count, 1);\n\n\treturn io;\n}",
    "includes": [
      "#include \"src/shared/io.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"src/shared/mainloop.h\"",
      "#include <sys/socket.h>",
      "#include <errno.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "__sync_fetch_and_add",
          "args": [
            "&io->ref_count",
            "1"
          ],
          "line": 57
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/io.h\"\n#include \"src/shared/util.h\"\n#include \"src/shared/mainloop.h\"\n#include <sys/socket.h>\n#include <errno.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic struct io *io_ref(struct io *io)\n{\n\tif (!io)\n\t\treturn NULL;\n\n\t__sync_fetch_and_add(&io->ref_count, 1);\n\n\treturn io;\n}"
  }
]