[
  {
    "function_name": "gatt_db_attribute_get_user_data",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "1895-1901",
    "snippet": "void *gatt_db_attribute_get_user_data(struct gatt_db_attribute *attrib)\n{\n\tif (!attrib)\n\t\treturn NULL;\n\n\treturn attrib->user_data;\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nvoid *gatt_db_attribute_get_user_data(struct gatt_db_attribute *attrib)\n{\n\tif (!attrib)\n\t\treturn NULL;\n\n\treturn attrib->user_data;\n}"
  },
  {
    "function_name": "gatt_db_attribute_reset",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "1880-1893",
    "snippet": "bool gatt_db_attribute_reset(struct gatt_db_attribute *attrib)\n{\n\tif (!attrib)\n\t\treturn false;\n\n\tif (!attrib->value || !attrib->value_len)\n\t\treturn true;\n\n\tfree(attrib->value);\n\tattrib->value = NULL;\n\tattrib->value_len = 0;\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "attrib->value"
          ],
          "line": 1888
        },
        "resolved": true,
        "details": {
          "function_name": "pending_write_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "158-163",
          "snippet": "static void pending_write_free(void *data)\n{\n\tstruct pending_write *p = data;\n\n\tpending_write_result(p, -ECANCELED);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void pending_write_free(void *data)\n{\n\tstruct pending_write *p = data;\n\n\tpending_write_result(p, -ECANCELED);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_attribute_reset(struct gatt_db_attribute *attrib)\n{\n\tif (!attrib)\n\t\treturn false;\n\n\tif (!attrib->value || !attrib->value_len)\n\t\treturn true;\n\n\tfree(attrib->value);\n\tattrib->value = NULL;\n\tattrib->value_len = 0;\n\n\treturn true;\n}"
  },
  {
    "function_name": "gatt_db_attribute_write_result",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "1862-1878",
    "snippet": "bool gatt_db_attribute_write_result(struct gatt_db_attribute *attrib,\n\t\t\t\t\t\tunsigned int id, int err)\n{\n\tstruct pending_write *p;\n\n\tif (!attrib || !id)\n\t\treturn false;\n\n\tp = queue_remove_if(attrib->pending_writes, find_pending,\n\t\t\t\t\t\t\tUINT_TO_PTR(id));\n\tif (!p)\n\t\treturn false;\n\n\tpending_write_result(p, err);\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "pending_write_result",
          "args": [
            "p",
            "err"
          ],
          "line": 1875
        },
        "resolved": true,
        "details": {
          "function_name": "pending_write_result",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "148-156",
          "snippet": "static void pending_write_result(struct pending_write *p, int err)\n{\n\tif (p->timeout_id > 0)\n\t\ttimeout_remove(p->timeout_id);\n\n\tp->func(p->attrib, err, p->user_data);\n\n\tfree(p);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void pending_write_result(struct pending_write *p, int err)\n{\n\tif (p->timeout_id > 0)\n\t\ttimeout_remove(p->timeout_id);\n\n\tp->func(p->attrib, err, p->user_data);\n\n\tfree(p);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_remove_if",
          "args": [
            "attrib->pending_writes",
            "find_pending",
            "UINT_TO_PTR(id)"
          ],
          "line": 1870
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_if",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "278-316",
          "snippet": "void *queue_remove_if(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry, *prev = NULL;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tentry = queue->head;\n\n\twhile (entry) {\n\t\tif (function(entry->data, user_data)) {\n\t\t\tvoid *data;\n\n\t\t\tif (prev)\n\t\t\t\tprev->next = entry->next;\n\t\t\telse\n\t\t\t\tqueue->head = entry->next;\n\n\t\t\tif (!entry->next)\n\t\t\t\tqueue->tail = prev;\n\n\t\t\tdata = entry->data;\n\n\t\t\tfree(entry);\n\t\t\tqueue->entries--;\n\n\t\t\treturn data;\n\t\t} else {\n\t\t\tprev = entry;\n\t\t\tentry = entry->next;\n\t\t}\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid *queue_remove_if(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry, *prev = NULL;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tentry = queue->head;\n\n\twhile (entry) {\n\t\tif (function(entry->data, user_data)) {\n\t\t\tvoid *data;\n\n\t\t\tif (prev)\n\t\t\t\tprev->next = entry->next;\n\t\t\telse\n\t\t\t\tqueue->head = entry->next;\n\n\t\t\tif (!entry->next)\n\t\t\t\tqueue->tail = prev;\n\n\t\t\tdata = entry->data;\n\n\t\t\tfree(entry);\n\t\t\tqueue->entries--;\n\n\t\t\treturn data;\n\t\t} else {\n\t\t\tprev = entry;\n\t\t\tentry = entry->next;\n\t\t}\n\t}\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "UINT_TO_PTR",
          "args": [
            "id"
          ],
          "line": 1871
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_attribute_write_result(struct gatt_db_attribute *attrib,\n\t\t\t\t\t\tunsigned int id, int err)\n{\n\tstruct pending_write *p;\n\n\tif (!attrib || !id)\n\t\treturn false;\n\n\tp = queue_remove_if(attrib->pending_writes, find_pending,\n\t\t\t\t\t\t\tUINT_TO_PTR(id));\n\tif (!p)\n\t\treturn false;\n\n\tpending_write_result(p, err);\n\n\treturn true;\n}"
  },
  {
    "function_name": "gatt_db_attribute_write",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "1805-1860",
    "snippet": "bool gatt_db_attribute_write(struct gatt_db_attribute *attrib, uint16_t offset,\n\t\t\t\t\tconst uint8_t *value, size_t len,\n\t\t\t\t\tuint8_t opcode, struct bt_att *att,\n\t\t\t\t\tgatt_db_attribute_write_t func,\n\t\t\t\t\tvoid *user_data)\n{\n\tif (!attrib || !func)\n\t\treturn false;\n\n\tif (attrib->write_func) {\n\t\tstruct pending_write *p;\n\n\t\tp = new0(struct pending_write, 1);\n\t\tp->attrib = attrib;\n\t\tp->id = ++attrib->write_id;\n\t\tp->timeout_id = timeout_add(ATTRIBUTE_TIMEOUT, write_timeout,\n\t\t\t\t\t\t\t\tp, NULL);\n\t\tp->func = func;\n\t\tp->user_data = user_data;\n\n\t\tqueue_push_tail(attrib->pending_writes, p);\n\n\t\tattrib->write_func(attrib, p->id, offset, value, len, opcode,\n\t\t\t\t\t\t\tatt, attrib->user_data);\n\t\treturn true;\n\t}\n\n\t/* Nothing to write just skip */\n\tif (len == 0)\n\t\tgoto done;\n\n\t/* For values stored in db allocate on demand */\n\tif (!attrib->value || offset >= attrib->value_len ||\n\t\t\t\tlen > (unsigned) (attrib->value_len - offset)) {\n\t\tvoid *buf;\n\n\t\tbuf = realloc(attrib->value, len + offset);\n\t\tif (!buf)\n\t\t\treturn false;\n\n\t\tattrib->value = buf;\n\n\t\t/* Init data in the first allocation */\n\t\tif (!attrib->value_len)\n\t\t\tmemset(attrib->value, 0, offset);\n\n\t\tattrib->value_len = len + offset;\n\t}\n\n\tmemcpy(&attrib->value[offset], value, len);\n\ndone:\n\tfunc(attrib, 0, user_data);\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define ATTRIBUTE_TIMEOUT 5000"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "func",
          "args": [
            "attrib",
            "0",
            "user_data"
          ],
          "line": 1857
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "&attrib->value[offset]",
            "value",
            "len"
          ],
          "line": 1854
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "attrib->value",
            "0",
            "offset"
          ],
          "line": 1849
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "realloc",
          "args": [
            "attrib->value",
            "len + offset"
          ],
          "line": 1841
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "attrib->write_func",
          "args": [
            "attrib",
            "p->id",
            "offset",
            "value",
            "len",
            "opcode",
            "att",
            "attrib->user_data"
          ],
          "line": 1827
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "queue_push_tail",
          "args": [
            "attrib->pending_writes",
            "p"
          ],
          "line": 1825
        },
        "resolved": true,
        "details": {
          "function_name": "queue_push_tail",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "88-108",
          "snippet": "bool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "timeout_add",
          "args": [
            "ATTRIBUTE_TIMEOUT",
            "write_timeout",
            "p",
            "NULL"
          ],
          "line": 1820
        },
        "resolved": true,
        "details": {
          "function_name": "timeout_add",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/timeout-mainloop.c",
          "lines": "55-74",
          "snippet": "unsigned int timeout_add(unsigned int timeout, timeout_func_t func,\n\t\t\tvoid *user_data, timeout_destroy_func_t destroy)\n{\n\tstruct timeout_data *data;\n\n\tdata = new0(struct timeout_data, 1);\n\tdata->func = func;\n\tdata->user_data = user_data;\n\tdata->timeout = timeout;\n\tdata->destroy = destroy;\n\n\tdata->id = mainloop_add_timeout(timeout, timeout_callback, data,\n\t\t\t\t\t\t\ttimeout_destroy);\n\tif (data->id < 0) {\n\t\tfree(data);\n\t\treturn 0;\n\t}\n\n\treturn (unsigned int) data->id;\n}",
          "includes": [
            "#include \"timeout.h\"",
            "#include \"util.h\"",
            "#include \"mainloop.h\"",
            "#include <stdlib.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"timeout.h\"\n#include \"util.h\"\n#include \"mainloop.h\"\n#include <stdlib.h>\n\nunsigned int timeout_add(unsigned int timeout, timeout_func_t func,\n\t\t\tvoid *user_data, timeout_destroy_func_t destroy)\n{\n\tstruct timeout_data *data;\n\n\tdata = new0(struct timeout_data, 1);\n\tdata->func = func;\n\tdata->user_data = user_data;\n\tdata->timeout = timeout;\n\tdata->destroy = destroy;\n\n\tdata->id = mainloop_add_timeout(timeout, timeout_callback, data,\n\t\t\t\t\t\t\ttimeout_destroy);\n\tif (data->id < 0) {\n\t\tfree(data);\n\t\treturn 0;\n\t}\n\n\treturn (unsigned int) data->id;\n}"
        }
      },
      {
        "call_info": {
          "callee": "new0",
          "args": [
            "structpending_write",
            "1"
          ],
          "line": 1817
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\n#define ATTRIBUTE_TIMEOUT 5000\n\nbool gatt_db_attribute_write(struct gatt_db_attribute *attrib, uint16_t offset,\n\t\t\t\t\tconst uint8_t *value, size_t len,\n\t\t\t\t\tuint8_t opcode, struct bt_att *att,\n\t\t\t\t\tgatt_db_attribute_write_t func,\n\t\t\t\t\tvoid *user_data)\n{\n\tif (!attrib || !func)\n\t\treturn false;\n\n\tif (attrib->write_func) {\n\t\tstruct pending_write *p;\n\n\t\tp = new0(struct pending_write, 1);\n\t\tp->attrib = attrib;\n\t\tp->id = ++attrib->write_id;\n\t\tp->timeout_id = timeout_add(ATTRIBUTE_TIMEOUT, write_timeout,\n\t\t\t\t\t\t\t\tp, NULL);\n\t\tp->func = func;\n\t\tp->user_data = user_data;\n\n\t\tqueue_push_tail(attrib->pending_writes, p);\n\n\t\tattrib->write_func(attrib, p->id, offset, value, len, opcode,\n\t\t\t\t\t\t\tatt, attrib->user_data);\n\t\treturn true;\n\t}\n\n\t/* Nothing to write just skip */\n\tif (len == 0)\n\t\tgoto done;\n\n\t/* For values stored in db allocate on demand */\n\tif (!attrib->value || offset >= attrib->value_len ||\n\t\t\t\tlen > (unsigned) (attrib->value_len - offset)) {\n\t\tvoid *buf;\n\n\t\tbuf = realloc(attrib->value, len + offset);\n\t\tif (!buf)\n\t\t\treturn false;\n\n\t\tattrib->value = buf;\n\n\t\t/* Init data in the first allocation */\n\t\tif (!attrib->value_len)\n\t\t\tmemset(attrib->value, 0, offset);\n\n\t\tattrib->value_len = len + offset;\n\t}\n\n\tmemcpy(&attrib->value[offset], value, len);\n\ndone:\n\tfunc(attrib, 0, user_data);\n\n\treturn true;\n}"
  },
  {
    "function_name": "write_timeout",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "1792-1803",
    "snippet": "static bool write_timeout(void *user_data)\n{\n\tstruct pending_write *p = user_data;\n\n\tp->timeout_id = 0;\n\n\tqueue_remove(p->attrib->pending_writes, p);\n\n\tpending_write_result(p, -ETIMEDOUT);\n\n\treturn false;\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "pending_write_result",
          "args": [
            "p",
            "-ETIMEDOUT"
          ],
          "line": 1800
        },
        "resolved": true,
        "details": {
          "function_name": "pending_write_result",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "148-156",
          "snippet": "static void pending_write_result(struct pending_write *p, int err)\n{\n\tif (p->timeout_id > 0)\n\t\ttimeout_remove(p->timeout_id);\n\n\tp->func(p->attrib, err, p->user_data);\n\n\tfree(p);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void pending_write_result(struct pending_write *p, int err)\n{\n\tif (p->timeout_id > 0)\n\t\ttimeout_remove(p->timeout_id);\n\n\tp->func(p->attrib, err, p->user_data);\n\n\tfree(p);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_remove",
          "args": [
            "p->attrib->pending_writes",
            "p"
          ],
          "line": 1798
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_uuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "526-541",
          "snippet": "static bool queue_remove_uuid(struct queue *queue, bt_uuid_t *uuid)\n{\n\tbt_uuid_t *removed;\n\n\tif (!queue || !uuid)\n\t\treturn false;\n\n\tremoved = queue_remove_if(queue, uuid_match, uuid);\n\n\tif (removed) {\n\t\tfree(removed);\n\t\treturn true;\n\t}\n\n\treturn false;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic bool queue_remove_uuid(struct queue *queue, bt_uuid_t *uuid)\n{\n\tbt_uuid_t *removed;\n\n\tif (!queue || !uuid)\n\t\treturn false;\n\n\tremoved = queue_remove_if(queue, uuid_match, uuid);\n\n\tif (removed) {\n\t\tfree(removed);\n\t\treturn true;\n\t}\n\n\treturn false;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic bool write_timeout(void *user_data)\n{\n\tstruct pending_write *p = user_data;\n\n\tp->timeout_id = 0;\n\n\tqueue_remove(p->attrib->pending_writes, p);\n\n\tpending_write_result(p, -ETIMEDOUT);\n\n\treturn false;\n}"
  },
  {
    "function_name": "gatt_db_attribute_read_result",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "1773-1790",
    "snippet": "bool gatt_db_attribute_read_result(struct gatt_db_attribute *attrib,\n\t\t\t\t\tunsigned int id, int err,\n\t\t\t\t\tconst uint8_t *value, size_t length)\n{\n\tstruct pending_read *p;\n\n\tif (!attrib || !id)\n\t\treturn false;\n\n\tp = queue_remove_if(attrib->pending_reads, find_pending,\n\t\t\t\t\t\t\tUINT_TO_PTR(id));\n\tif (!p)\n\t\treturn false;\n\n\tpending_read_result(p, err, value, length);\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "pending_read_result",
          "args": [
            "p",
            "err",
            "value",
            "length"
          ],
          "line": 1787
        },
        "resolved": true,
        "details": {
          "function_name": "pending_read_result",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "130-139",
          "snippet": "static void pending_read_result(struct pending_read *p, int err,\n\t\t\t\t\tconst uint8_t *data, size_t length)\n{\n\tif (p->timeout_id > 0)\n\t\ttimeout_remove(p->timeout_id);\n\n\tp->func(p->attrib, err, data, length, p->user_data);\n\n\tfree(p);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void pending_read_result(struct pending_read *p, int err,\n\t\t\t\t\tconst uint8_t *data, size_t length)\n{\n\tif (p->timeout_id > 0)\n\t\ttimeout_remove(p->timeout_id);\n\n\tp->func(p->attrib, err, data, length, p->user_data);\n\n\tfree(p);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_remove_if",
          "args": [
            "attrib->pending_reads",
            "find_pending",
            "UINT_TO_PTR(id)"
          ],
          "line": 1782
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_if",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "278-316",
          "snippet": "void *queue_remove_if(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry, *prev = NULL;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tentry = queue->head;\n\n\twhile (entry) {\n\t\tif (function(entry->data, user_data)) {\n\t\t\tvoid *data;\n\n\t\t\tif (prev)\n\t\t\t\tprev->next = entry->next;\n\t\t\telse\n\t\t\t\tqueue->head = entry->next;\n\n\t\t\tif (!entry->next)\n\t\t\t\tqueue->tail = prev;\n\n\t\t\tdata = entry->data;\n\n\t\t\tfree(entry);\n\t\t\tqueue->entries--;\n\n\t\t\treturn data;\n\t\t} else {\n\t\t\tprev = entry;\n\t\t\tentry = entry->next;\n\t\t}\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid *queue_remove_if(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry, *prev = NULL;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tentry = queue->head;\n\n\twhile (entry) {\n\t\tif (function(entry->data, user_data)) {\n\t\t\tvoid *data;\n\n\t\t\tif (prev)\n\t\t\t\tprev->next = entry->next;\n\t\t\telse\n\t\t\t\tqueue->head = entry->next;\n\n\t\t\tif (!entry->next)\n\t\t\t\tqueue->tail = prev;\n\n\t\t\tdata = entry->data;\n\n\t\t\tfree(entry);\n\t\t\tqueue->entries--;\n\n\t\t\treturn data;\n\t\t} else {\n\t\t\tprev = entry;\n\t\t\tentry = entry->next;\n\t\t}\n\t}\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "UINT_TO_PTR",
          "args": [
            "id"
          ],
          "line": 1783
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_attribute_read_result(struct gatt_db_attribute *attrib,\n\t\t\t\t\tunsigned int id, int err,\n\t\t\t\t\tconst uint8_t *value, size_t length)\n{\n\tstruct pending_read *p;\n\n\tif (!attrib || !id)\n\t\treturn false;\n\n\tp = queue_remove_if(attrib->pending_reads, find_pending,\n\t\t\t\t\t\t\tUINT_TO_PTR(id));\n\tif (!p)\n\t\treturn false;\n\n\tpending_read_result(p, err, value, length);\n\n\treturn true;\n}"
  },
  {
    "function_name": "find_pending",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "1765-1771",
    "snippet": "static bool find_pending(const void *a, const void *b)\n{\n\tconst struct pending_read *p = a;\n\tunsigned int id = PTR_TO_UINT(b);\n\n\treturn p->id == id;\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "PTR_TO_UINT",
          "args": [
            "b"
          ],
          "line": 1768
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic bool find_pending(const void *a, const void *b)\n{\n\tconst struct pending_read *p = a;\n\tunsigned int id = PTR_TO_UINT(b);\n\n\treturn p->id == id;\n}"
  },
  {
    "function_name": "gatt_db_attribute_read",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "1724-1763",
    "snippet": "bool gatt_db_attribute_read(struct gatt_db_attribute *attrib, uint16_t offset,\n\t\t\t\tuint8_t opcode, struct bt_att *att,\n\t\t\t\tgatt_db_attribute_read_t func, void *user_data)\n{\n\tuint8_t *value;\n\n\tif (!attrib || !func)\n\t\treturn false;\n\n\tif (attrib->read_func) {\n\t\tstruct pending_read *p;\n\n\t\tp = new0(struct pending_read, 1);\n\t\tp->attrib = attrib;\n\t\tp->id = ++attrib->read_id;\n\t\tp->timeout_id = timeout_add(ATTRIBUTE_TIMEOUT, read_timeout,\n\t\t\t\t\t\t\t\tp, NULL);\n\t\tp->func = func;\n\t\tp->user_data = user_data;\n\n\t\tqueue_push_tail(attrib->pending_reads, p);\n\n\t\tattrib->read_func(attrib, p->id, offset, opcode, att,\n\t\t\t\t\t\t\tattrib->user_data);\n\t\treturn true;\n\t}\n\n\t/* Check boundary if value is stored in the db */\n\tif (offset > attrib->value_len) {\n\t\tfunc(attrib, BT_ATT_ERROR_INVALID_OFFSET, NULL, 0, user_data);\n\t\treturn true;\n\t}\n\n\t/* Guard against invalid access if offset equals to value length */\n\tvalue = offset == attrib->value_len ? NULL : &attrib->value[offset];\n\n\tfunc(attrib, 0, value, attrib->value_len - offset, user_data);\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define ATTRIBUTE_TIMEOUT 5000"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "func",
          "args": [
            "attrib",
            "0",
            "value",
            "attrib->value_len - offset",
            "user_data"
          ],
          "line": 1760
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "func",
          "args": [
            "attrib",
            "BT_ATT_ERROR_INVALID_OFFSET",
            "NULL",
            "0",
            "user_data"
          ],
          "line": 1753
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "attrib->read_func",
          "args": [
            "attrib",
            "p->id",
            "offset",
            "opcode",
            "att",
            "attrib->user_data"
          ],
          "line": 1746
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "queue_push_tail",
          "args": [
            "attrib->pending_reads",
            "p"
          ],
          "line": 1744
        },
        "resolved": true,
        "details": {
          "function_name": "queue_push_tail",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "88-108",
          "snippet": "bool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "timeout_add",
          "args": [
            "ATTRIBUTE_TIMEOUT",
            "read_timeout",
            "p",
            "NULL"
          ],
          "line": 1739
        },
        "resolved": true,
        "details": {
          "function_name": "timeout_add",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/timeout-mainloop.c",
          "lines": "55-74",
          "snippet": "unsigned int timeout_add(unsigned int timeout, timeout_func_t func,\n\t\t\tvoid *user_data, timeout_destroy_func_t destroy)\n{\n\tstruct timeout_data *data;\n\n\tdata = new0(struct timeout_data, 1);\n\tdata->func = func;\n\tdata->user_data = user_data;\n\tdata->timeout = timeout;\n\tdata->destroy = destroy;\n\n\tdata->id = mainloop_add_timeout(timeout, timeout_callback, data,\n\t\t\t\t\t\t\ttimeout_destroy);\n\tif (data->id < 0) {\n\t\tfree(data);\n\t\treturn 0;\n\t}\n\n\treturn (unsigned int) data->id;\n}",
          "includes": [
            "#include \"timeout.h\"",
            "#include \"util.h\"",
            "#include \"mainloop.h\"",
            "#include <stdlib.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"timeout.h\"\n#include \"util.h\"\n#include \"mainloop.h\"\n#include <stdlib.h>\n\nunsigned int timeout_add(unsigned int timeout, timeout_func_t func,\n\t\t\tvoid *user_data, timeout_destroy_func_t destroy)\n{\n\tstruct timeout_data *data;\n\n\tdata = new0(struct timeout_data, 1);\n\tdata->func = func;\n\tdata->user_data = user_data;\n\tdata->timeout = timeout;\n\tdata->destroy = destroy;\n\n\tdata->id = mainloop_add_timeout(timeout, timeout_callback, data,\n\t\t\t\t\t\t\ttimeout_destroy);\n\tif (data->id < 0) {\n\t\tfree(data);\n\t\treturn 0;\n\t}\n\n\treturn (unsigned int) data->id;\n}"
        }
      },
      {
        "call_info": {
          "callee": "new0",
          "args": [
            "structpending_read",
            "1"
          ],
          "line": 1736
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\n#define ATTRIBUTE_TIMEOUT 5000\n\nbool gatt_db_attribute_read(struct gatt_db_attribute *attrib, uint16_t offset,\n\t\t\t\tuint8_t opcode, struct bt_att *att,\n\t\t\t\tgatt_db_attribute_read_t func, void *user_data)\n{\n\tuint8_t *value;\n\n\tif (!attrib || !func)\n\t\treturn false;\n\n\tif (attrib->read_func) {\n\t\tstruct pending_read *p;\n\n\t\tp = new0(struct pending_read, 1);\n\t\tp->attrib = attrib;\n\t\tp->id = ++attrib->read_id;\n\t\tp->timeout_id = timeout_add(ATTRIBUTE_TIMEOUT, read_timeout,\n\t\t\t\t\t\t\t\tp, NULL);\n\t\tp->func = func;\n\t\tp->user_data = user_data;\n\n\t\tqueue_push_tail(attrib->pending_reads, p);\n\n\t\tattrib->read_func(attrib, p->id, offset, opcode, att,\n\t\t\t\t\t\t\tattrib->user_data);\n\t\treturn true;\n\t}\n\n\t/* Check boundary if value is stored in the db */\n\tif (offset > attrib->value_len) {\n\t\tfunc(attrib, BT_ATT_ERROR_INVALID_OFFSET, NULL, 0, user_data);\n\t\treturn true;\n\t}\n\n\t/* Guard against invalid access if offset equals to value length */\n\tvalue = offset == attrib->value_len ? NULL : &attrib->value[offset];\n\n\tfunc(attrib, 0, value, attrib->value_len - offset, user_data);\n\n\treturn true;\n}"
  },
  {
    "function_name": "read_timeout",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "1711-1722",
    "snippet": "static bool read_timeout(void *user_data)\n{\n\tstruct pending_read *p = user_data;\n\n\tp->timeout_id = 0;\n\n\tqueue_remove(p->attrib->pending_reads, p);\n\n\tpending_read_result(p, -ETIMEDOUT, NULL, 0);\n\n\treturn false;\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "pending_read_result",
          "args": [
            "p",
            "-ETIMEDOUT",
            "NULL",
            "0"
          ],
          "line": 1719
        },
        "resolved": true,
        "details": {
          "function_name": "pending_read_result",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "130-139",
          "snippet": "static void pending_read_result(struct pending_read *p, int err,\n\t\t\t\t\tconst uint8_t *data, size_t length)\n{\n\tif (p->timeout_id > 0)\n\t\ttimeout_remove(p->timeout_id);\n\n\tp->func(p->attrib, err, data, length, p->user_data);\n\n\tfree(p);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void pending_read_result(struct pending_read *p, int err,\n\t\t\t\t\tconst uint8_t *data, size_t length)\n{\n\tif (p->timeout_id > 0)\n\t\ttimeout_remove(p->timeout_id);\n\n\tp->func(p->attrib, err, data, length, p->user_data);\n\n\tfree(p);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_remove",
          "args": [
            "p->attrib->pending_reads",
            "p"
          ],
          "line": 1717
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_uuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "526-541",
          "snippet": "static bool queue_remove_uuid(struct queue *queue, bt_uuid_t *uuid)\n{\n\tbt_uuid_t *removed;\n\n\tif (!queue || !uuid)\n\t\treturn false;\n\n\tremoved = queue_remove_if(queue, uuid_match, uuid);\n\n\tif (removed) {\n\t\tfree(removed);\n\t\treturn true;\n\t}\n\n\treturn false;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic bool queue_remove_uuid(struct queue *queue, bt_uuid_t *uuid)\n{\n\tbt_uuid_t *removed;\n\n\tif (!queue || !uuid)\n\t\treturn false;\n\n\tremoved = queue_remove_if(queue, uuid_match, uuid);\n\n\tif (removed) {\n\t\tfree(removed);\n\t\treturn true;\n\t}\n\n\treturn false;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic bool read_timeout(void *user_data)\n{\n\tstruct pending_read *p = user_data;\n\n\tp->timeout_id = 0;\n\n\tqueue_remove(p->attrib->pending_reads, p);\n\n\tpending_read_result(p, -ETIMEDOUT, NULL, 0);\n\n\treturn false;\n}"
  },
  {
    "function_name": "gatt_db_attribute_get_permissions",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "1702-1709",
    "snippet": "uint32_t\ngatt_db_attribute_get_permissions(const struct gatt_db_attribute *attrib)\n{\n\tif (!attrib)\n\t\treturn 0;\n\n\treturn attrib->permissions;\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nuint32_t\ngatt_db_attribute_get_permissions(const struct gatt_db_attribute *attrib)\n{\n\tif (!attrib)\n\t\treturn 0;\n\n\treturn attrib->permissions;\n}"
  },
  {
    "function_name": "gatt_db_attribute_get_incl_data",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "1666-1700",
    "snippet": "bool gatt_db_attribute_get_incl_data(const struct gatt_db_attribute *attrib,\n\t\t\t\t\t\t\tuint16_t *handle,\n\t\t\t\t\t\t\tuint16_t *start_handle,\n\t\t\t\t\t\t\tuint16_t *end_handle)\n{\n\tif (!attrib)\n\t\treturn false;\n\n\tif (bt_uuid_cmp(&included_service_uuid, &attrib->uuid))\n\t\treturn false;\n\n\t/*\n\t * Include definition value:\n\t * 2 octets: start handle of included service\n\t * 2 octets: end handle of included service\n\t * optional 2 octets: 16-bit Bluetooth UUID\n\t */\n\tif (!attrib->value || attrib->value_len < 4 || attrib->value_len > 6)\n\t\treturn false;\n\n\t/*\n\t * We only return the handles since the UUID can be easily obtained\n\t * from the corresponding attribute.\n\t */\n\tif (handle)\n\t\t*handle = attrib->handle;\n\n\tif (start_handle)\n\t\t*start_handle = get_le16(attrib->value);\n\n\tif (end_handle)\n\t\t*end_handle = get_le16(attrib->value + 2);\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static const bt_uuid_t included_service_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_INCLUDE_UUID };"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "get_le16",
          "args": [
            "attrib->value + 2"
          ],
          "line": 1697
        },
        "resolved": true,
        "details": {
          "function_name": "get_le16",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/util.h",
          "lines": "129-132",
          "snippet": "static inline uint16_t get_le16(const void *ptr)\n{\n\treturn le16_to_cpu(get_unaligned((const uint16_t *) ptr));\n}",
          "includes": [
            "#include <string.h>",
            "#include <byteswap.h>",
            "#include <alloca.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <byteswap.h>\n#include <alloca.h>\n#include <stdlib.h>\n#include <stdint.h>\n\nstatic inline uint16_t get_le16(const void *ptr)\n{\n\treturn le16_to_cpu(get_unaligned((const uint16_t *) ptr));\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_uuid_cmp",
          "args": [
            "&included_service_uuid",
            "&attrib->uuid"
          ],
          "line": 1674
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic const bt_uuid_t included_service_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_INCLUDE_UUID };\n\nbool gatt_db_attribute_get_incl_data(const struct gatt_db_attribute *attrib,\n\t\t\t\t\t\t\tuint16_t *handle,\n\t\t\t\t\t\t\tuint16_t *start_handle,\n\t\t\t\t\t\t\tuint16_t *end_handle)\n{\n\tif (!attrib)\n\t\treturn false;\n\n\tif (bt_uuid_cmp(&included_service_uuid, &attrib->uuid))\n\t\treturn false;\n\n\t/*\n\t * Include definition value:\n\t * 2 octets: start handle of included service\n\t * 2 octets: end handle of included service\n\t * optional 2 octets: 16-bit Bluetooth UUID\n\t */\n\tif (!attrib->value || attrib->value_len < 4 || attrib->value_len > 6)\n\t\treturn false;\n\n\t/*\n\t * We only return the handles since the UUID can be easily obtained\n\t * from the corresponding attribute.\n\t */\n\tif (handle)\n\t\t*handle = attrib->handle;\n\n\tif (start_handle)\n\t\t*start_handle = get_le16(attrib->value);\n\n\tif (end_handle)\n\t\t*end_handle = get_le16(attrib->value + 2);\n\n\treturn true;\n}"
  },
  {
    "function_name": "gatt_db_attribute_get_char_data",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "1625-1664",
    "snippet": "bool gatt_db_attribute_get_char_data(const struct gatt_db_attribute *attrib,\n\t\t\t\t\t\t\tuint16_t *handle,\n\t\t\t\t\t\t\tuint16_t *value_handle,\n\t\t\t\t\t\t\tuint8_t *properties,\n\t\t\t\t\t\t\tuint16_t *ext_prop,\n\t\t\t\t\t\t\tbt_uuid_t *uuid)\n{\n\tif (!attrib)\n\t\treturn false;\n\n\tif (bt_uuid_cmp(&characteristic_uuid, &attrib->uuid))\n\t\treturn false;\n\n\t/*\n\t * Characteristic declaration value:\n\t * 1 octet: Characteristic properties\n\t * 2 octets: Characteristic value handle\n\t * 2 or 16 octets: characteristic UUID\n\t */\n\tif (!attrib->value || (attrib->value_len != 5 &&\n\t\t\t\t\t\tattrib->value_len != 19))\n\t\treturn false;\n\n\tif (handle)\n\t\t*handle = attrib->handle;\n\n\tif (properties)\n\t\t*properties = attrib->value[0];\n\n\tif (ext_prop)\n\t\t*ext_prop = get_char_extended_prop(attrib);\n\n\tif (value_handle)\n\t\t*value_handle = get_le16(attrib->value + 1);\n\n\tif (!uuid)\n\t\treturn true;\n\n\treturn le_to_uuid(attrib->value + 3, attrib->value_len - 3, uuid);\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static const bt_uuid_t characteristic_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_CHARAC_UUID };"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "le_to_uuid",
          "args": [
            "attrib->value + 3",
            "attrib->value_len - 3",
            "uuid"
          ],
          "line": 1663
        },
        "resolved": true,
        "details": {
          "function_name": "le_to_uuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "349-370",
          "snippet": "static bool le_to_uuid(const uint8_t *src, size_t len, bt_uuid_t *uuid)\n{\n\tuint128_t u128;\n\n\tif (len == 2) {\n\t\tbt_uuid16_create(uuid, get_le16(src));\n\t\treturn true;\n\t}\n\n\tif (len == 4) {\n\t\tbt_uuid32_create(uuid, get_le32(src));\n\t\treturn true;\n\t}\n\n\tif (len != 16)\n\t\treturn false;\n\n\tbswap_128(src, &u128);\n\tbt_uuid128_create(uuid, u128);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic bool le_to_uuid(const uint8_t *src, size_t len, bt_uuid_t *uuid)\n{\n\tuint128_t u128;\n\n\tif (len == 2) {\n\t\tbt_uuid16_create(uuid, get_le16(src));\n\t\treturn true;\n\t}\n\n\tif (len == 4) {\n\t\tbt_uuid32_create(uuid, get_le32(src));\n\t\treturn true;\n\t}\n\n\tif (len != 16)\n\t\treturn false;\n\n\tbswap_128(src, &u128);\n\tbt_uuid128_create(uuid, u128);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "get_le16",
          "args": [
            "attrib->value + 1"
          ],
          "line": 1658
        },
        "resolved": true,
        "details": {
          "function_name": "get_le16",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/util.h",
          "lines": "129-132",
          "snippet": "static inline uint16_t get_le16(const void *ptr)\n{\n\treturn le16_to_cpu(get_unaligned((const uint16_t *) ptr));\n}",
          "includes": [
            "#include <string.h>",
            "#include <byteswap.h>",
            "#include <alloca.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <byteswap.h>\n#include <alloca.h>\n#include <stdlib.h>\n#include <stdint.h>\n\nstatic inline uint16_t get_le16(const void *ptr)\n{\n\treturn le16_to_cpu(get_unaligned((const uint16_t *) ptr));\n}"
        }
      },
      {
        "call_info": {
          "callee": "get_char_extended_prop",
          "args": [
            "attrib"
          ],
          "line": 1655
        },
        "resolved": true,
        "details": {
          "function_name": "get_char_extended_prop",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1599-1623",
          "snippet": "static uint8_t get_char_extended_prop(const struct gatt_db_attribute *attrib)\n{\n\tuint16_t ext_prop;\n\n\tif (!attrib)\n\t\treturn 0;\n\n\tif (bt_uuid_cmp(&characteristic_uuid, &attrib->uuid))\n\t\treturn 0;\n\n\t/* Check properties first */\n\tif (!(attrib->value[0] & BT_GATT_CHRC_PROP_EXT_PROP))\n\t\treturn 0;\n\n\text_prop = 0;\n\n\t/*\n\t * Cast needed for foreach function. We do not change attrib during\n\t * this call\n\t */\n\tgatt_db_service_foreach_desc((struct gatt_db_attribute *) attrib,\n\t\t\t\t\t\tread_ext_prop, &ext_prop);\n\n\treturn ext_prop;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static const bt_uuid_t characteristic_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_CHARAC_UUID };"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic const bt_uuid_t characteristic_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_CHARAC_UUID };\n\nstatic uint8_t get_char_extended_prop(const struct gatt_db_attribute *attrib)\n{\n\tuint16_t ext_prop;\n\n\tif (!attrib)\n\t\treturn 0;\n\n\tif (bt_uuid_cmp(&characteristic_uuid, &attrib->uuid))\n\t\treturn 0;\n\n\t/* Check properties first */\n\tif (!(attrib->value[0] & BT_GATT_CHRC_PROP_EXT_PROP))\n\t\treturn 0;\n\n\text_prop = 0;\n\n\t/*\n\t * Cast needed for foreach function. We do not change attrib during\n\t * this call\n\t */\n\tgatt_db_service_foreach_desc((struct gatt_db_attribute *) attrib,\n\t\t\t\t\t\tread_ext_prop, &ext_prop);\n\n\treturn ext_prop;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_uuid_cmp",
          "args": [
            "&characteristic_uuid",
            "&attrib->uuid"
          ],
          "line": 1635
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic const bt_uuid_t characteristic_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_CHARAC_UUID };\n\nbool gatt_db_attribute_get_char_data(const struct gatt_db_attribute *attrib,\n\t\t\t\t\t\t\tuint16_t *handle,\n\t\t\t\t\t\t\tuint16_t *value_handle,\n\t\t\t\t\t\t\tuint8_t *properties,\n\t\t\t\t\t\t\tuint16_t *ext_prop,\n\t\t\t\t\t\t\tbt_uuid_t *uuid)\n{\n\tif (!attrib)\n\t\treturn false;\n\n\tif (bt_uuid_cmp(&characteristic_uuid, &attrib->uuid))\n\t\treturn false;\n\n\t/*\n\t * Characteristic declaration value:\n\t * 1 octet: Characteristic properties\n\t * 2 octets: Characteristic value handle\n\t * 2 or 16 octets: characteristic UUID\n\t */\n\tif (!attrib->value || (attrib->value_len != 5 &&\n\t\t\t\t\t\tattrib->value_len != 19))\n\t\treturn false;\n\n\tif (handle)\n\t\t*handle = attrib->handle;\n\n\tif (properties)\n\t\t*properties = attrib->value[0];\n\n\tif (ext_prop)\n\t\t*ext_prop = get_char_extended_prop(attrib);\n\n\tif (value_handle)\n\t\t*value_handle = get_le16(attrib->value + 1);\n\n\tif (!uuid)\n\t\treturn true;\n\n\treturn le_to_uuid(attrib->value + 3, attrib->value_len - 3, uuid);\n}"
  },
  {
    "function_name": "get_char_extended_prop",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "1599-1623",
    "snippet": "static uint8_t get_char_extended_prop(const struct gatt_db_attribute *attrib)\n{\n\tuint16_t ext_prop;\n\n\tif (!attrib)\n\t\treturn 0;\n\n\tif (bt_uuid_cmp(&characteristic_uuid, &attrib->uuid))\n\t\treturn 0;\n\n\t/* Check properties first */\n\tif (!(attrib->value[0] & BT_GATT_CHRC_PROP_EXT_PROP))\n\t\treturn 0;\n\n\text_prop = 0;\n\n\t/*\n\t * Cast needed for foreach function. We do not change attrib during\n\t * this call\n\t */\n\tgatt_db_service_foreach_desc((struct gatt_db_attribute *) attrib,\n\t\t\t\t\t\tread_ext_prop, &ext_prop);\n\n\treturn ext_prop;\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static const bt_uuid_t characteristic_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_CHARAC_UUID };"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "gatt_db_service_foreach_desc",
          "args": [
            "(struct gatt_db_attribute *) attrib",
            "read_ext_prop",
            "&ext_prop"
          ],
          "line": 1619
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_service_foreach_desc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1349-1386",
          "snippet": "void gatt_db_service_foreach_desc(struct gatt_db_attribute *attrib,\n\t\t\t\t\t\tgatt_db_attribute_cb_t func,\n\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct gatt_db_service *service;\n\tstruct gatt_db_attribute *attr;\n\tuint16_t i;\n\n\tif (!attrib || !func)\n\t\treturn;\n\n\t/* Return if this attribute is not a characteristic declaration */\n\tif (bt_uuid_cmp(&characteristic_uuid, &attrib->uuid))\n\t\treturn;\n\n\tservice = attrib->service;\n\n\t/* Start from the attribute following the value handle */\n\tfor (i = 0; i < service->num_handles; i++) {\n\t\tif (service->attributes[i] == attrib) {\n\t\t\ti += 2;\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tfor (; i < service->num_handles; i++) {\n\t\tattr = service->attributes[i];\n\t\tif (!attr)\n\t\t\tcontinue;\n\n\t\t/* Return if we reached the end of this characteristic */\n\t\tif (!bt_uuid_cmp(&characteristic_uuid, &attr->uuid) ||\n\t\t\t!bt_uuid_cmp(&included_service_uuid, &attr->uuid))\n\t\t\treturn;\n\n\t\tfunc(attr, user_data);\n\t}\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static const bt_uuid_t characteristic_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_CHARAC_UUID };",
            "static const bt_uuid_t included_service_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_INCLUDE_UUID };"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic const bt_uuid_t characteristic_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_CHARAC_UUID };\nstatic const bt_uuid_t included_service_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_INCLUDE_UUID };\n\nvoid gatt_db_service_foreach_desc(struct gatt_db_attribute *attrib,\n\t\t\t\t\t\tgatt_db_attribute_cb_t func,\n\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct gatt_db_service *service;\n\tstruct gatt_db_attribute *attr;\n\tuint16_t i;\n\n\tif (!attrib || !func)\n\t\treturn;\n\n\t/* Return if this attribute is not a characteristic declaration */\n\tif (bt_uuid_cmp(&characteristic_uuid, &attrib->uuid))\n\t\treturn;\n\n\tservice = attrib->service;\n\n\t/* Start from the attribute following the value handle */\n\tfor (i = 0; i < service->num_handles; i++) {\n\t\tif (service->attributes[i] == attrib) {\n\t\t\ti += 2;\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tfor (; i < service->num_handles; i++) {\n\t\tattr = service->attributes[i];\n\t\tif (!attr)\n\t\t\tcontinue;\n\n\t\t/* Return if we reached the end of this characteristic */\n\t\tif (!bt_uuid_cmp(&characteristic_uuid, &attr->uuid) ||\n\t\t\t!bt_uuid_cmp(&included_service_uuid, &attr->uuid))\n\t\t\treturn;\n\n\t\tfunc(attr, user_data);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_uuid_cmp",
          "args": [
            "&characteristic_uuid",
            "&attrib->uuid"
          ],
          "line": 1606
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic const bt_uuid_t characteristic_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_CHARAC_UUID };\n\nstatic uint8_t get_char_extended_prop(const struct gatt_db_attribute *attrib)\n{\n\tuint16_t ext_prop;\n\n\tif (!attrib)\n\t\treturn 0;\n\n\tif (bt_uuid_cmp(&characteristic_uuid, &attrib->uuid))\n\t\treturn 0;\n\n\t/* Check properties first */\n\tif (!(attrib->value[0] & BT_GATT_CHRC_PROP_EXT_PROP))\n\t\treturn 0;\n\n\text_prop = 0;\n\n\t/*\n\t * Cast needed for foreach function. We do not change attrib during\n\t * this call\n\t */\n\tgatt_db_service_foreach_desc((struct gatt_db_attribute *) attrib,\n\t\t\t\t\t\tread_ext_prop, &ext_prop);\n\n\treturn ext_prop;\n}"
  },
  {
    "function_name": "read_ext_prop",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "1580-1597",
    "snippet": "static void read_ext_prop(struct gatt_db_attribute *attrib,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tuint16_t *ext_prop = user_data;\n\n\t/*\n\t * If ext_prop is set that means extended properties descriptor\n\t * has been already found\n\t */\n\tif (*ext_prop != 0)\n\t\treturn;\n\n\tif (bt_uuid_cmp(&ext_desc_uuid, &attrib->uuid))\n\t\treturn;\n\n\tgatt_db_attribute_read(attrib, 0, BT_ATT_OP_READ_REQ, NULL,\n\t\t\t\t\t\tread_ext_prop_value, ext_prop);\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static const bt_uuid_t ext_desc_uuid = { .type = BT_UUID16,\n\t\t\t\t.value.u16 = GATT_CHARAC_EXT_PROPER_UUID };"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "gatt_db_attribute_read",
          "args": [
            "attrib",
            "0",
            "BT_ATT_OP_READ_REQ",
            "NULL",
            "read_ext_prop_value",
            "ext_prop"
          ],
          "line": 1595
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_read",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1724-1763",
          "snippet": "bool gatt_db_attribute_read(struct gatt_db_attribute *attrib, uint16_t offset,\n\t\t\t\tuint8_t opcode, struct bt_att *att,\n\t\t\t\tgatt_db_attribute_read_t func, void *user_data)\n{\n\tuint8_t *value;\n\n\tif (!attrib || !func)\n\t\treturn false;\n\n\tif (attrib->read_func) {\n\t\tstruct pending_read *p;\n\n\t\tp = new0(struct pending_read, 1);\n\t\tp->attrib = attrib;\n\t\tp->id = ++attrib->read_id;\n\t\tp->timeout_id = timeout_add(ATTRIBUTE_TIMEOUT, read_timeout,\n\t\t\t\t\t\t\t\tp, NULL);\n\t\tp->func = func;\n\t\tp->user_data = user_data;\n\n\t\tqueue_push_tail(attrib->pending_reads, p);\n\n\t\tattrib->read_func(attrib, p->id, offset, opcode, att,\n\t\t\t\t\t\t\tattrib->user_data);\n\t\treturn true;\n\t}\n\n\t/* Check boundary if value is stored in the db */\n\tif (offset > attrib->value_len) {\n\t\tfunc(attrib, BT_ATT_ERROR_INVALID_OFFSET, NULL, 0, user_data);\n\t\treturn true;\n\t}\n\n\t/* Guard against invalid access if offset equals to value length */\n\tvalue = offset == attrib->value_len ? NULL : &attrib->value[offset];\n\n\tfunc(attrib, 0, value, attrib->value_len - offset, user_data);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define ATTRIBUTE_TIMEOUT 5000"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\n#define ATTRIBUTE_TIMEOUT 5000\n\nbool gatt_db_attribute_read(struct gatt_db_attribute *attrib, uint16_t offset,\n\t\t\t\tuint8_t opcode, struct bt_att *att,\n\t\t\t\tgatt_db_attribute_read_t func, void *user_data)\n{\n\tuint8_t *value;\n\n\tif (!attrib || !func)\n\t\treturn false;\n\n\tif (attrib->read_func) {\n\t\tstruct pending_read *p;\n\n\t\tp = new0(struct pending_read, 1);\n\t\tp->attrib = attrib;\n\t\tp->id = ++attrib->read_id;\n\t\tp->timeout_id = timeout_add(ATTRIBUTE_TIMEOUT, read_timeout,\n\t\t\t\t\t\t\t\tp, NULL);\n\t\tp->func = func;\n\t\tp->user_data = user_data;\n\n\t\tqueue_push_tail(attrib->pending_reads, p);\n\n\t\tattrib->read_func(attrib, p->id, offset, opcode, att,\n\t\t\t\t\t\t\tattrib->user_data);\n\t\treturn true;\n\t}\n\n\t/* Check boundary if value is stored in the db */\n\tif (offset > attrib->value_len) {\n\t\tfunc(attrib, BT_ATT_ERROR_INVALID_OFFSET, NULL, 0, user_data);\n\t\treturn true;\n\t}\n\n\t/* Guard against invalid access if offset equals to value length */\n\tvalue = offset == attrib->value_len ? NULL : &attrib->value[offset];\n\n\tfunc(attrib, 0, value, attrib->value_len - offset, user_data);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_uuid_cmp",
          "args": [
            "&ext_desc_uuid",
            "&attrib->uuid"
          ],
          "line": 1592
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic const bt_uuid_t ext_desc_uuid = { .type = BT_UUID16,\n\t\t\t\t.value.u16 = GATT_CHARAC_EXT_PROPER_UUID };\n\nstatic void read_ext_prop(struct gatt_db_attribute *attrib,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tuint16_t *ext_prop = user_data;\n\n\t/*\n\t * If ext_prop is set that means extended properties descriptor\n\t * has been already found\n\t */\n\tif (*ext_prop != 0)\n\t\treturn;\n\n\tif (bt_uuid_cmp(&ext_desc_uuid, &attrib->uuid))\n\t\treturn;\n\n\tgatt_db_attribute_read(attrib, 0, BT_ATT_OP_READ_REQ, NULL,\n\t\t\t\t\t\tread_ext_prop_value, ext_prop);\n}"
  },
  {
    "function_name": "read_ext_prop_value",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "1568-1578",
    "snippet": "static void read_ext_prop_value(struct gatt_db_attribute *attrib,\n\t\t\t\t\t\tint err, const uint8_t *value,\n\t\t\t\t\t\tsize_t length, void *user_data)\n{\n\tuint16_t *ext_prop = user_data;\n\n\tif (err || (length != sizeof(uint16_t)))\n\t\treturn;\n\n\t*ext_prop = (uint16_t) value[0];\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void read_ext_prop_value(struct gatt_db_attribute *attrib,\n\t\t\t\t\t\tint err, const uint8_t *value,\n\t\t\t\t\t\tsize_t length, void *user_data)\n{\n\tuint16_t *ext_prop = user_data;\n\n\tif (err || (length != sizeof(uint16_t)))\n\t\treturn;\n\n\t*ext_prop = (uint16_t) value[0];\n}"
  },
  {
    "function_name": "gatt_db_attribute_get_service_data",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "1538-1566",
    "snippet": "bool gatt_db_attribute_get_service_data(const struct gatt_db_attribute *attrib,\n\t\t\t\t\t\t\tuint16_t *start_handle,\n\t\t\t\t\t\t\tuint16_t *end_handle,\n\t\t\t\t\t\t\tbool *primary,\n\t\t\t\t\t\t\tbt_uuid_t *uuid)\n{\n\tstruct gatt_db_service *service;\n\tstruct gatt_db_attribute *decl;\n\n\tif (!attrib)\n\t\treturn false;\n\n\tservice = attrib->service;\n\tdecl = service->attributes[0];\n\n\tgatt_db_service_get_handles(service, start_handle, end_handle);\n\n\tif (primary)\n\t\t*primary = bt_uuid_cmp(&decl->uuid, &secondary_service_uuid);\n\n\tif (!uuid)\n\t\treturn true;\n\n\t/*\n\t * The service declaration attribute value is the 16 or 128 bit service\n\t * UUID.\n\t */\n\treturn le_to_uuid(decl->value, decl->value_len, uuid);\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static const bt_uuid_t secondary_service_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_SND_SVC_UUID };"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "le_to_uuid",
          "args": [
            "decl->value",
            "decl->value_len",
            "uuid"
          ],
          "line": 1565
        },
        "resolved": true,
        "details": {
          "function_name": "le_to_uuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "349-370",
          "snippet": "static bool le_to_uuid(const uint8_t *src, size_t len, bt_uuid_t *uuid)\n{\n\tuint128_t u128;\n\n\tif (len == 2) {\n\t\tbt_uuid16_create(uuid, get_le16(src));\n\t\treturn true;\n\t}\n\n\tif (len == 4) {\n\t\tbt_uuid32_create(uuid, get_le32(src));\n\t\treturn true;\n\t}\n\n\tif (len != 16)\n\t\treturn false;\n\n\tbswap_128(src, &u128);\n\tbt_uuid128_create(uuid, u128);\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic bool le_to_uuid(const uint8_t *src, size_t len, bt_uuid_t *uuid)\n{\n\tuint128_t u128;\n\n\tif (len == 2) {\n\t\tbt_uuid16_create(uuid, get_le16(src));\n\t\treturn true;\n\t}\n\n\tif (len == 4) {\n\t\tbt_uuid32_create(uuid, get_le32(src));\n\t\treturn true;\n\t}\n\n\tif (len != 16)\n\t\treturn false;\n\n\tbswap_128(src, &u128);\n\tbt_uuid128_create(uuid, u128);\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_uuid_cmp",
          "args": [
            "&decl->uuid",
            "&secondary_service_uuid"
          ],
          "line": 1556
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gatt_db_service_get_handles",
          "args": [
            "service",
            "start_handle",
            "end_handle"
          ],
          "line": 1553
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_service_get_handles",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "430-440",
          "snippet": "static void gatt_db_service_get_handles(const struct gatt_db_service *service,\n\t\t\t\t\t\t\tuint16_t *start_handle,\n\t\t\t\t\t\t\tuint16_t *end_handle)\n{\n\tif (start_handle)\n\t\t*start_handle = service->attributes[0]->handle;\n\n\tif (end_handle)\n\t\t*end_handle = service->attributes[0]->handle +\n\t\t\t\t\t\tservice->num_handles - 1;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void gatt_db_service_get_handles(const struct gatt_db_service *service,\n\t\t\t\t\t\t\tuint16_t *start_handle,\n\t\t\t\t\t\t\tuint16_t *end_handle)\n{\n\tif (start_handle)\n\t\t*start_handle = service->attributes[0]->handle;\n\n\tif (end_handle)\n\t\t*end_handle = service->attributes[0]->handle +\n\t\t\t\t\t\tservice->num_handles - 1;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic const bt_uuid_t secondary_service_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_SND_SVC_UUID };\n\nbool gatt_db_attribute_get_service_data(const struct gatt_db_attribute *attrib,\n\t\t\t\t\t\t\tuint16_t *start_handle,\n\t\t\t\t\t\t\tuint16_t *end_handle,\n\t\t\t\t\t\t\tbool *primary,\n\t\t\t\t\t\t\tbt_uuid_t *uuid)\n{\n\tstruct gatt_db_service *service;\n\tstruct gatt_db_attribute *decl;\n\n\tif (!attrib)\n\t\treturn false;\n\n\tservice = attrib->service;\n\tdecl = service->attributes[0];\n\n\tgatt_db_service_get_handles(service, start_handle, end_handle);\n\n\tif (primary)\n\t\t*primary = bt_uuid_cmp(&decl->uuid, &secondary_service_uuid);\n\n\tif (!uuid)\n\t\treturn true;\n\n\t/*\n\t * The service declaration attribute value is the 16 or 128 bit service\n\t * UUID.\n\t */\n\treturn le_to_uuid(decl->value, decl->value_len, uuid);\n}"
  },
  {
    "function_name": "gatt_db_attribute_get_service_handles",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "1521-1536",
    "snippet": "bool gatt_db_attribute_get_service_handles(\n\t\t\t\t\tconst struct gatt_db_attribute *attrib,\n\t\t\t\t\tuint16_t *start_handle,\n\t\t\t\t\tuint16_t *end_handle)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!attrib)\n\t\treturn false;\n\n\tservice = attrib->service;\n\n\tgatt_db_service_get_handles(service, start_handle, end_handle);\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "gatt_db_service_get_handles",
          "args": [
            "service",
            "start_handle",
            "end_handle"
          ],
          "line": 1533
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_service_get_handles",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "430-440",
          "snippet": "static void gatt_db_service_get_handles(const struct gatt_db_service *service,\n\t\t\t\t\t\t\tuint16_t *start_handle,\n\t\t\t\t\t\t\tuint16_t *end_handle)\n{\n\tif (start_handle)\n\t\t*start_handle = service->attributes[0]->handle;\n\n\tif (end_handle)\n\t\t*end_handle = service->attributes[0]->handle +\n\t\t\t\t\t\tservice->num_handles - 1;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void gatt_db_service_get_handles(const struct gatt_db_service *service,\n\t\t\t\t\t\t\tuint16_t *start_handle,\n\t\t\t\t\t\t\tuint16_t *end_handle)\n{\n\tif (start_handle)\n\t\t*start_handle = service->attributes[0]->handle;\n\n\tif (end_handle)\n\t\t*end_handle = service->attributes[0]->handle +\n\t\t\t\t\t\tservice->num_handles - 1;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_attribute_get_service_handles(\n\t\t\t\t\tconst struct gatt_db_attribute *attrib,\n\t\t\t\t\tuint16_t *start_handle,\n\t\t\t\t\tuint16_t *end_handle)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!attrib)\n\t\treturn false;\n\n\tservice = attrib->service;\n\n\tgatt_db_service_get_handles(service, start_handle, end_handle);\n\n\treturn true;\n}"
  },
  {
    "function_name": "gatt_db_attribute_get_service_uuid",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "1490-1519",
    "snippet": "bool gatt_db_attribute_get_service_uuid(const struct gatt_db_attribute *attrib,\n\t\t\t\t\t\t\tbt_uuid_t *uuid)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!attrib || !uuid)\n\t\treturn false;\n\n\tservice = attrib->service;\n\n\tif (service->attributes[0]->value_len == sizeof(uint16_t)) {\n\t\tuint16_t value;\n\n\t\tvalue = get_le16(service->attributes[0]->value);\n\t\tbt_uuid16_create(uuid, value);\n\n\t\treturn true;\n\t}\n\n\tif (service->attributes[0]->value_len == sizeof(uint128_t)) {\n\t\tuint128_t value;\n\n\t\tbswap_128(service->attributes[0]->value, &value);\n\t\tbt_uuid128_create(uuid, value);\n\n\t\treturn true;\n\t}\n\n\treturn false;\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bt_uuid128_create",
          "args": [
            "uuid",
            "value"
          ],
          "line": 1513
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bswap_128",
          "args": [
            "service->attributes[0]->value",
            "&value"
          ],
          "line": 1512
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_uuid16_create",
          "args": [
            "uuid",
            "value"
          ],
          "line": 1504
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_le16",
          "args": [
            "service->attributes[0]->value"
          ],
          "line": 1503
        },
        "resolved": true,
        "details": {
          "function_name": "get_le16",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/util.h",
          "lines": "129-132",
          "snippet": "static inline uint16_t get_le16(const void *ptr)\n{\n\treturn le16_to_cpu(get_unaligned((const uint16_t *) ptr));\n}",
          "includes": [
            "#include <string.h>",
            "#include <byteswap.h>",
            "#include <alloca.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <byteswap.h>\n#include <alloca.h>\n#include <stdlib.h>\n#include <stdint.h>\n\nstatic inline uint16_t get_le16(const void *ptr)\n{\n\treturn le16_to_cpu(get_unaligned((const uint16_t *) ptr));\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_attribute_get_service_uuid(const struct gatt_db_attribute *attrib,\n\t\t\t\t\t\t\tbt_uuid_t *uuid)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!attrib || !uuid)\n\t\treturn false;\n\n\tservice = attrib->service;\n\n\tif (service->attributes[0]->value_len == sizeof(uint16_t)) {\n\t\tuint16_t value;\n\n\t\tvalue = get_le16(service->attributes[0]->value);\n\t\tbt_uuid16_create(uuid, value);\n\n\t\treturn true;\n\t}\n\n\tif (service->attributes[0]->value_len == sizeof(uint128_t)) {\n\t\tuint128_t value;\n\n\t\tbswap_128(service->attributes[0]->value, &value);\n\t\tbt_uuid128_create(uuid, value);\n\n\t\treturn true;\n\t}\n\n\treturn false;\n}"
  },
  {
    "function_name": "gatt_db_attribute_get_handle",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "1482-1488",
    "snippet": "uint16_t gatt_db_attribute_get_handle(const struct gatt_db_attribute *attrib)\n{\n\tif (!attrib)\n\t\treturn 0;\n\n\treturn attrib->handle;\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nuint16_t gatt_db_attribute_get_handle(const struct gatt_db_attribute *attrib)\n{\n\tif (!attrib)\n\t\treturn 0;\n\n\treturn attrib->handle;\n}"
  },
  {
    "function_name": "gatt_db_attribute_get_type",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "1473-1480",
    "snippet": "const bt_uuid_t *gatt_db_attribute_get_type(\n\t\t\t\t\tconst struct gatt_db_attribute *attrib)\n{\n\tif (!attrib)\n\t\treturn NULL;\n\n\treturn &attrib->uuid;\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nconst bt_uuid_t *gatt_db_attribute_get_type(\n\t\t\t\t\tconst struct gatt_db_attribute *attrib)\n{\n\tif (!attrib)\n\t\treturn NULL;\n\n\treturn &attrib->uuid;\n}"
  },
  {
    "function_name": "gatt_db_get_service_with_uuid",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "1458-1471",
    "snippet": "struct gatt_db_attribute *gatt_db_get_service_with_uuid(struct gatt_db *db,\n\t\t\t\t\t\t\tconst bt_uuid_t *uuid)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!db || !uuid)\n\t\treturn NULL;\n\n\tservice = queue_find(db->services, find_service_with_uuid, uuid);\n\tif (!service)\n\t\treturn NULL;\n\n\treturn service->attributes[0];\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_find",
          "args": [
            "db->services",
            "find_service_with_uuid",
            "uuid"
          ],
          "line": 1466
        },
        "resolved": true,
        "details": {
          "function_name": "queue_find",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "231-247",
          "snippet": "void *queue_find(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tconst void *match_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tfor (entry = queue->head; entry; entry = entry->next)\n\t\tif (function(entry->data, match_data))\n\t\t\treturn entry->data;\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid *queue_find(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tconst void *match_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tfor (entry = queue->head; entry; entry = entry->next)\n\t\tif (function(entry->data, match_data))\n\t\t\treturn entry->data;\n\n\treturn NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstruct gatt_db_attribute *gatt_db_get_service_with_uuid(struct gatt_db *db,\n\t\t\t\t\t\t\tconst bt_uuid_t *uuid)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!db || !uuid)\n\t\treturn NULL;\n\n\tservice = queue_find(db->services, find_service_with_uuid, uuid);\n\tif (!service)\n\t\treturn NULL;\n\n\treturn service->attributes[0];\n}"
  },
  {
    "function_name": "find_service_with_uuid",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "1447-1456",
    "snippet": "static bool find_service_with_uuid(const void *data, const void *user_data)\n{\n\tconst struct gatt_db_service *service = data;\n\tconst bt_uuid_t *uuid = user_data;\n\tbt_uuid_t svc_uuid;\n\n\tgatt_db_attribute_get_service_uuid(service->attributes[0], &svc_uuid);\n\n\treturn bt_uuid_cmp(uuid, &svc_uuid) == 0;\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bt_uuid_cmp",
          "args": [
            "uuid",
            "&svc_uuid"
          ],
          "line": 1455
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gatt_db_attribute_get_service_uuid",
          "args": [
            "service->attributes[0]",
            "&svc_uuid"
          ],
          "line": 1453
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_get_service_uuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1490-1519",
          "snippet": "bool gatt_db_attribute_get_service_uuid(const struct gatt_db_attribute *attrib,\n\t\t\t\t\t\t\tbt_uuid_t *uuid)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!attrib || !uuid)\n\t\treturn false;\n\n\tservice = attrib->service;\n\n\tif (service->attributes[0]->value_len == sizeof(uint16_t)) {\n\t\tuint16_t value;\n\n\t\tvalue = get_le16(service->attributes[0]->value);\n\t\tbt_uuid16_create(uuid, value);\n\n\t\treturn true;\n\t}\n\n\tif (service->attributes[0]->value_len == sizeof(uint128_t)) {\n\t\tuint128_t value;\n\n\t\tbswap_128(service->attributes[0]->value, &value);\n\t\tbt_uuid128_create(uuid, value);\n\n\t\treturn true;\n\t}\n\n\treturn false;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_attribute_get_service_uuid(const struct gatt_db_attribute *attrib,\n\t\t\t\t\t\t\tbt_uuid_t *uuid)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!attrib || !uuid)\n\t\treturn false;\n\n\tservice = attrib->service;\n\n\tif (service->attributes[0]->value_len == sizeof(uint16_t)) {\n\t\tuint16_t value;\n\n\t\tvalue = get_le16(service->attributes[0]->value);\n\t\tbt_uuid16_create(uuid, value);\n\n\t\treturn true;\n\t}\n\n\tif (service->attributes[0]->value_len == sizeof(uint128_t)) {\n\t\tuint128_t value;\n\n\t\tbswap_128(service->attributes[0]->value, &value);\n\t\tbt_uuid128_create(uuid, value);\n\n\t\treturn true;\n\t}\n\n\treturn false;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic bool find_service_with_uuid(const void *data, const void *user_data)\n{\n\tconst struct gatt_db_service *service = data;\n\tconst bt_uuid_t *uuid = user_data;\n\tbt_uuid_t svc_uuid;\n\n\tgatt_db_attribute_get_service_uuid(service->attributes[0], &svc_uuid);\n\n\treturn bt_uuid_cmp(uuid, &svc_uuid) == 0;\n}"
  },
  {
    "function_name": "gatt_db_get_attribute",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "1423-1445",
    "snippet": "struct gatt_db_attribute *gatt_db_get_attribute(struct gatt_db *db,\n\t\t\t\t\t\t\tuint16_t handle)\n{\n\tstruct gatt_db_attribute *attrib;\n\tstruct gatt_db_service *service;\n\tint i;\n\n\tattrib = gatt_db_get_service(db, handle);\n\tif (!attrib)\n\t\treturn NULL;\n\n\tservice = attrib->service;\n\n\tfor (i = 0; i < service->num_handles; i++) {\n\t\tif (!service->attributes[i])\n\t\t\tcontinue;\n\n\t\tif (service->attributes[i]->handle == handle)\n\t\t\treturn service->attributes[i];\n\t}\n\n\treturn NULL;\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "gatt_db_get_service",
          "args": [
            "db",
            "handle"
          ],
          "line": 1430
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_get_service_with_uuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1458-1471",
          "snippet": "struct gatt_db_attribute *gatt_db_get_service_with_uuid(struct gatt_db *db,\n\t\t\t\t\t\t\tconst bt_uuid_t *uuid)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!db || !uuid)\n\t\treturn NULL;\n\n\tservice = queue_find(db->services, find_service_with_uuid, uuid);\n\tif (!service)\n\t\treturn NULL;\n\n\treturn service->attributes[0];\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstruct gatt_db_attribute *gatt_db_get_service_with_uuid(struct gatt_db *db,\n\t\t\t\t\t\t\tconst bt_uuid_t *uuid)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!db || !uuid)\n\t\treturn NULL;\n\n\tservice = queue_find(db->services, find_service_with_uuid, uuid);\n\tif (!service)\n\t\treturn NULL;\n\n\treturn service->attributes[0];\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstruct gatt_db_attribute *gatt_db_get_attribute(struct gatt_db *db,\n\t\t\t\t\t\t\tuint16_t handle)\n{\n\tstruct gatt_db_attribute *attrib;\n\tstruct gatt_db_service *service;\n\tint i;\n\n\tattrib = gatt_db_get_service(db, handle);\n\tif (!attrib)\n\t\treturn NULL;\n\n\tservice = attrib->service;\n\n\tfor (i = 0; i < service->num_handles; i++) {\n\t\tif (!service->attributes[i])\n\t\t\tcontinue;\n\n\t\tif (service->attributes[i]->handle == handle)\n\t\t\treturn service->attributes[i];\n\t}\n\n\treturn NULL;\n}"
  },
  {
    "function_name": "gatt_db_get_service",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "1407-1421",
    "snippet": "struct gatt_db_attribute *gatt_db_get_service(struct gatt_db *db,\n\t\t\t\t\t\t\tuint16_t handle)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!db || !handle)\n\t\treturn NULL;\n\n\tservice = queue_find(db->services, find_service_for_handle,\n\t\t\t\t\t\tUINT_TO_PTR(handle));\n\tif (!service)\n\t\treturn NULL;\n\n\treturn service->attributes[0];\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_find",
          "args": [
            "db->services",
            "find_service_for_handle",
            "UINT_TO_PTR(handle)"
          ],
          "line": 1415
        },
        "resolved": true,
        "details": {
          "function_name": "queue_find",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "231-247",
          "snippet": "void *queue_find(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tconst void *match_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tfor (entry = queue->head; entry; entry = entry->next)\n\t\tif (function(entry->data, match_data))\n\t\t\treturn entry->data;\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid *queue_find(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tconst void *match_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tfor (entry = queue->head; entry; entry = entry->next)\n\t\tif (function(entry->data, match_data))\n\t\t\treturn entry->data;\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "UINT_TO_PTR",
          "args": [
            "handle"
          ],
          "line": 1416
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstruct gatt_db_attribute *gatt_db_get_service(struct gatt_db *db,\n\t\t\t\t\t\t\tuint16_t handle)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!db || !handle)\n\t\treturn NULL;\n\n\tservice = queue_find(db->services, find_service_for_handle,\n\t\t\t\t\t\tUINT_TO_PTR(handle));\n\tif (!service)\n\t\treturn NULL;\n\n\treturn service->attributes[0];\n}"
  },
  {
    "function_name": "find_service_for_handle",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "1396-1405",
    "snippet": "static bool find_service_for_handle(const void *data, const void *user_data)\n{\n\tconst struct gatt_db_service *service = data;\n\tuint16_t handle = PTR_TO_UINT(user_data);\n\tuint16_t start, end;\n\n\tgatt_db_service_get_handles(service, &start, &end);\n\n\treturn (start <= handle) && (handle <= end);\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "gatt_db_service_get_handles",
          "args": [
            "service",
            "&start",
            "&end"
          ],
          "line": 1402
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_service_get_handles",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "430-440",
          "snippet": "static void gatt_db_service_get_handles(const struct gatt_db_service *service,\n\t\t\t\t\t\t\tuint16_t *start_handle,\n\t\t\t\t\t\t\tuint16_t *end_handle)\n{\n\tif (start_handle)\n\t\t*start_handle = service->attributes[0]->handle;\n\n\tif (end_handle)\n\t\t*end_handle = service->attributes[0]->handle +\n\t\t\t\t\t\tservice->num_handles - 1;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void gatt_db_service_get_handles(const struct gatt_db_service *service,\n\t\t\t\t\t\t\tuint16_t *start_handle,\n\t\t\t\t\t\t\tuint16_t *end_handle)\n{\n\tif (start_handle)\n\t\t*start_handle = service->attributes[0]->handle;\n\n\tif (end_handle)\n\t\t*end_handle = service->attributes[0]->handle +\n\t\t\t\t\t\tservice->num_handles - 1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "PTR_TO_UINT",
          "args": [
            "user_data"
          ],
          "line": 1399
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic bool find_service_for_handle(const void *data, const void *user_data)\n{\n\tconst struct gatt_db_service *service = data;\n\tuint16_t handle = PTR_TO_UINT(user_data);\n\tuint16_t start, end;\n\n\tgatt_db_service_get_handles(service, &start, &end);\n\n\treturn (start <= handle) && (handle <= end);\n}"
  },
  {
    "function_name": "gatt_db_service_foreach_incl",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "1388-1394",
    "snippet": "void gatt_db_service_foreach_incl(struct gatt_db_attribute *attrib,\n\t\t\t\t\t\tgatt_db_attribute_cb_t func,\n\t\t\t\t\t\tvoid *user_data)\n{\n\tgatt_db_service_foreach(attrib, &included_service_uuid, func,\n\t\t\t\t\t\t\t\tuser_data);\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static const bt_uuid_t included_service_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_INCLUDE_UUID };"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "gatt_db_service_foreach",
          "args": [
            "attrib",
            "&included_service_uuid",
            "func",
            "user_data"
          ],
          "line": 1392
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_service_foreach",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1316-1340",
          "snippet": "void gatt_db_service_foreach(struct gatt_db_attribute *attrib,\n\t\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\t\tgatt_db_attribute_cb_t func,\n\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct gatt_db_service *service;\n\tstruct gatt_db_attribute *attr;\n\tuint16_t i;\n\n\tif (!attrib || !func)\n\t\treturn;\n\n\tservice = attrib->service;\n\n\tfor (i = 0; i < service->num_handles; i++) {\n\t\tattr = service->attributes[i];\n\t\tif (!attr)\n\t\t\tcontinue;\n\n\t\tif (uuid && bt_uuid_cmp(uuid, &attr->uuid))\n\t\t\tcontinue;\n\n\t\tfunc(attr, user_data);\n\t}\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nvoid gatt_db_service_foreach(struct gatt_db_attribute *attrib,\n\t\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\t\tgatt_db_attribute_cb_t func,\n\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct gatt_db_service *service;\n\tstruct gatt_db_attribute *attr;\n\tuint16_t i;\n\n\tif (!attrib || !func)\n\t\treturn;\n\n\tservice = attrib->service;\n\n\tfor (i = 0; i < service->num_handles; i++) {\n\t\tattr = service->attributes[i];\n\t\tif (!attr)\n\t\t\tcontinue;\n\n\t\tif (uuid && bt_uuid_cmp(uuid, &attr->uuid))\n\t\t\tcontinue;\n\n\t\tfunc(attr, user_data);\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic const bt_uuid_t included_service_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_INCLUDE_UUID };\n\nvoid gatt_db_service_foreach_incl(struct gatt_db_attribute *attrib,\n\t\t\t\t\t\tgatt_db_attribute_cb_t func,\n\t\t\t\t\t\tvoid *user_data)\n{\n\tgatt_db_service_foreach(attrib, &included_service_uuid, func,\n\t\t\t\t\t\t\t\tuser_data);\n}"
  },
  {
    "function_name": "gatt_db_service_foreach_desc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "1349-1386",
    "snippet": "void gatt_db_service_foreach_desc(struct gatt_db_attribute *attrib,\n\t\t\t\t\t\tgatt_db_attribute_cb_t func,\n\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct gatt_db_service *service;\n\tstruct gatt_db_attribute *attr;\n\tuint16_t i;\n\n\tif (!attrib || !func)\n\t\treturn;\n\n\t/* Return if this attribute is not a characteristic declaration */\n\tif (bt_uuid_cmp(&characteristic_uuid, &attrib->uuid))\n\t\treturn;\n\n\tservice = attrib->service;\n\n\t/* Start from the attribute following the value handle */\n\tfor (i = 0; i < service->num_handles; i++) {\n\t\tif (service->attributes[i] == attrib) {\n\t\t\ti += 2;\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tfor (; i < service->num_handles; i++) {\n\t\tattr = service->attributes[i];\n\t\tif (!attr)\n\t\t\tcontinue;\n\n\t\t/* Return if we reached the end of this characteristic */\n\t\tif (!bt_uuid_cmp(&characteristic_uuid, &attr->uuid) ||\n\t\t\t!bt_uuid_cmp(&included_service_uuid, &attr->uuid))\n\t\t\treturn;\n\n\t\tfunc(attr, user_data);\n\t}\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static const bt_uuid_t characteristic_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_CHARAC_UUID };",
      "static const bt_uuid_t included_service_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_INCLUDE_UUID };"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "func",
          "args": [
            "attr",
            "user_data"
          ],
          "line": 1384
        },
        "resolved": true,
        "details": {
          "function_name": "convert_raw_attr_to_xml_func",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdp-xml.c",
          "lines": "977-991",
          "snippet": "static void convert_raw_attr_to_xml_func(void *val, void *data)\n{\n\tstruct conversion_data *cd = data;\n\tsdp_data_t *value = val;\n\tchar buf[STRBUFSIZE];\n\n\tbuf[STRBUFSIZE - 1] = '\\0';\n\tsnprintf(buf, STRBUFSIZE - 1, \"\\t<attribute id=\\\"0x%04x\\\">\\n\",\n\t\t value->attrId);\n\tcd->appender(cd->data, buf);\n\n\tconvert_raw_data_to_xml(value, 2, cd->data, cd->appender);\n\n\tcd->appender(cd->data, \"\\t</attribute>\\n\");\n}",
          "includes": [
            "#include \"sdp-xml.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include <glib.h>",
            "#include <stdlib.h>",
            "#include <limits.h>",
            "#include <string.h>",
            "#include <ctype.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define STRBUFSIZE 1024"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sdp-xml.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include <glib.h>\n#include <stdlib.h>\n#include <limits.h>\n#include <string.h>\n#include <ctype.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\n#define STRBUFSIZE 1024\n\nstatic void convert_raw_attr_to_xml_func(void *val, void *data)\n{\n\tstruct conversion_data *cd = data;\n\tsdp_data_t *value = val;\n\tchar buf[STRBUFSIZE];\n\n\tbuf[STRBUFSIZE - 1] = '\\0';\n\tsnprintf(buf, STRBUFSIZE - 1, \"\\t<attribute id=\\\"0x%04x\\\">\\n\",\n\t\t value->attrId);\n\tcd->appender(cd->data, buf);\n\n\tconvert_raw_data_to_xml(value, 2, cd->data, cd->appender);\n\n\tcd->appender(cd->data, \"\\t</attribute>\\n\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_uuid_cmp",
          "args": [
            "&included_service_uuid",
            "&attr->uuid"
          ],
          "line": 1381
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_uuid_cmp",
          "args": [
            "&characteristic_uuid",
            "&attr->uuid"
          ],
          "line": 1380
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_uuid_cmp",
          "args": [
            "&characteristic_uuid",
            "&attrib->uuid"
          ],
          "line": 1361
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic const bt_uuid_t characteristic_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_CHARAC_UUID };\nstatic const bt_uuid_t included_service_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_INCLUDE_UUID };\n\nvoid gatt_db_service_foreach_desc(struct gatt_db_attribute *attrib,\n\t\t\t\t\t\tgatt_db_attribute_cb_t func,\n\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct gatt_db_service *service;\n\tstruct gatt_db_attribute *attr;\n\tuint16_t i;\n\n\tif (!attrib || !func)\n\t\treturn;\n\n\t/* Return if this attribute is not a characteristic declaration */\n\tif (bt_uuid_cmp(&characteristic_uuid, &attrib->uuid))\n\t\treturn;\n\n\tservice = attrib->service;\n\n\t/* Start from the attribute following the value handle */\n\tfor (i = 0; i < service->num_handles; i++) {\n\t\tif (service->attributes[i] == attrib) {\n\t\t\ti += 2;\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tfor (; i < service->num_handles; i++) {\n\t\tattr = service->attributes[i];\n\t\tif (!attr)\n\t\t\tcontinue;\n\n\t\t/* Return if we reached the end of this characteristic */\n\t\tif (!bt_uuid_cmp(&characteristic_uuid, &attr->uuid) ||\n\t\t\t!bt_uuid_cmp(&included_service_uuid, &attr->uuid))\n\t\t\treturn;\n\n\t\tfunc(attr, user_data);\n\t}\n}"
  },
  {
    "function_name": "gatt_db_service_foreach_char",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "1342-1347",
    "snippet": "void gatt_db_service_foreach_char(struct gatt_db_attribute *attrib,\n\t\t\t\t\t\tgatt_db_attribute_cb_t func,\n\t\t\t\t\t\tvoid *user_data)\n{\n\tgatt_db_service_foreach(attrib, &characteristic_uuid, func, user_data);\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static const bt_uuid_t characteristic_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_CHARAC_UUID };"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "gatt_db_service_foreach",
          "args": [
            "attrib",
            "&characteristic_uuid",
            "func",
            "user_data"
          ],
          "line": 1346
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_service_foreach",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1316-1340",
          "snippet": "void gatt_db_service_foreach(struct gatt_db_attribute *attrib,\n\t\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\t\tgatt_db_attribute_cb_t func,\n\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct gatt_db_service *service;\n\tstruct gatt_db_attribute *attr;\n\tuint16_t i;\n\n\tif (!attrib || !func)\n\t\treturn;\n\n\tservice = attrib->service;\n\n\tfor (i = 0; i < service->num_handles; i++) {\n\t\tattr = service->attributes[i];\n\t\tif (!attr)\n\t\t\tcontinue;\n\n\t\tif (uuid && bt_uuid_cmp(uuid, &attr->uuid))\n\t\t\tcontinue;\n\n\t\tfunc(attr, user_data);\n\t}\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nvoid gatt_db_service_foreach(struct gatt_db_attribute *attrib,\n\t\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\t\tgatt_db_attribute_cb_t func,\n\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct gatt_db_service *service;\n\tstruct gatt_db_attribute *attr;\n\tuint16_t i;\n\n\tif (!attrib || !func)\n\t\treturn;\n\n\tservice = attrib->service;\n\n\tfor (i = 0; i < service->num_handles; i++) {\n\t\tattr = service->attributes[i];\n\t\tif (!attr)\n\t\t\tcontinue;\n\n\t\tif (uuid && bt_uuid_cmp(uuid, &attr->uuid))\n\t\t\tcontinue;\n\n\t\tfunc(attr, user_data);\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic const bt_uuid_t characteristic_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_CHARAC_UUID };\n\nvoid gatt_db_service_foreach_char(struct gatt_db_attribute *attrib,\n\t\t\t\t\t\tgatt_db_attribute_cb_t func,\n\t\t\t\t\t\tvoid *user_data)\n{\n\tgatt_db_service_foreach(attrib, &characteristic_uuid, func, user_data);\n}"
  },
  {
    "function_name": "gatt_db_service_foreach",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "1316-1340",
    "snippet": "void gatt_db_service_foreach(struct gatt_db_attribute *attrib,\n\t\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\t\tgatt_db_attribute_cb_t func,\n\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct gatt_db_service *service;\n\tstruct gatt_db_attribute *attr;\n\tuint16_t i;\n\n\tif (!attrib || !func)\n\t\treturn;\n\n\tservice = attrib->service;\n\n\tfor (i = 0; i < service->num_handles; i++) {\n\t\tattr = service->attributes[i];\n\t\tif (!attr)\n\t\t\tcontinue;\n\n\t\tif (uuid && bt_uuid_cmp(uuid, &attr->uuid))\n\t\t\tcontinue;\n\n\t\tfunc(attr, user_data);\n\t}\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "func",
          "args": [
            "attr",
            "user_data"
          ],
          "line": 1338
        },
        "resolved": true,
        "details": {
          "function_name": "convert_raw_attr_to_xml_func",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/sdp-xml.c",
          "lines": "977-991",
          "snippet": "static void convert_raw_attr_to_xml_func(void *val, void *data)\n{\n\tstruct conversion_data *cd = data;\n\tsdp_data_t *value = val;\n\tchar buf[STRBUFSIZE];\n\n\tbuf[STRBUFSIZE - 1] = '\\0';\n\tsnprintf(buf, STRBUFSIZE - 1, \"\\t<attribute id=\\\"0x%04x\\\">\\n\",\n\t\t value->attrId);\n\tcd->appender(cd->data, buf);\n\n\tconvert_raw_data_to_xml(value, 2, cd->data, cd->appender);\n\n\tcd->appender(cd->data, \"\\t</attribute>\\n\");\n}",
          "includes": [
            "#include \"sdp-xml.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include <glib.h>",
            "#include <stdlib.h>",
            "#include <limits.h>",
            "#include <string.h>",
            "#include <ctype.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define STRBUFSIZE 1024"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sdp-xml.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include <glib.h>\n#include <stdlib.h>\n#include <limits.h>\n#include <string.h>\n#include <ctype.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\n#define STRBUFSIZE 1024\n\nstatic void convert_raw_attr_to_xml_func(void *val, void *data)\n{\n\tstruct conversion_data *cd = data;\n\tsdp_data_t *value = val;\n\tchar buf[STRBUFSIZE];\n\n\tbuf[STRBUFSIZE - 1] = '\\0';\n\tsnprintf(buf, STRBUFSIZE - 1, \"\\t<attribute id=\\\"0x%04x\\\">\\n\",\n\t\t value->attrId);\n\tcd->appender(cd->data, buf);\n\n\tconvert_raw_data_to_xml(value, 2, cd->data, cd->appender);\n\n\tcd->appender(cd->data, \"\\t</attribute>\\n\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_uuid_cmp",
          "args": [
            "uuid",
            "&attr->uuid"
          ],
          "line": 1335
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nvoid gatt_db_service_foreach(struct gatt_db_attribute *attrib,\n\t\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\t\tgatt_db_attribute_cb_t func,\n\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct gatt_db_service *service;\n\tstruct gatt_db_attribute *attr;\n\tuint16_t i;\n\n\tif (!attrib || !func)\n\t\treturn;\n\n\tservice = attrib->service;\n\n\tfor (i = 0; i < service->num_handles; i++) {\n\t\tattr = service->attributes[i];\n\t\tif (!attr)\n\t\t\tcontinue;\n\n\t\tif (uuid && bt_uuid_cmp(uuid, &attr->uuid))\n\t\t\tcontinue;\n\n\t\tfunc(attr, user_data);\n\t}\n}"
  },
  {
    "function_name": "gatt_db_foreach_service_in_range",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "1295-1314",
    "snippet": "void gatt_db_foreach_service_in_range(struct gatt_db *db,\n\t\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\t\tgatt_db_attribute_cb_t func,\n\t\t\t\t\t\tvoid *user_data,\n\t\t\t\t\t\tuint16_t start_handle,\n\t\t\t\t\t\tuint16_t end_handle)\n{\n\tstruct foreach_data data;\n\n\tif (!db || !func || start_handle > end_handle)\n\t\treturn;\n\n\tdata.func = func;\n\tdata.uuid = uuid;\n\tdata.user_data = user_data;\n\tdata.start = start_handle;\n\tdata.end = end_handle;\n\n\tqueue_foreach(db->services, foreach_service_in_range, &data);\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_foreach",
          "args": [
            "db->services",
            "foreach_service_in_range",
            "&data"
          ],
          "line": 1313
        },
        "resolved": true,
        "details": {
          "function_name": "queue_foreach",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "203-224",
          "snippet": "void queue_foreach(struct queue *queue, queue_foreach_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue || !function)\n\t\treturn;\n\n\tentry = queue->head;\n\tif (!entry)\n\t\treturn;\n\n\tqueue_ref(queue);\n\twhile (entry && queue->head && queue->ref_count > 1) {\n\t\tstruct queue_entry *next;\n\n\t\tnext = entry->next;\n\t\tfunction(entry->data, user_data);\n\t\tentry = next;\n\t}\n\tqueue_unref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid queue_foreach(struct queue *queue, queue_foreach_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue || !function)\n\t\treturn;\n\n\tentry = queue->head;\n\tif (!entry)\n\t\treturn;\n\n\tqueue_ref(queue);\n\twhile (entry && queue->head && queue->ref_count > 1) {\n\t\tstruct queue_entry *next;\n\n\t\tnext = entry->next;\n\t\tfunction(entry->data, user_data);\n\t\tentry = next;\n\t}\n\tqueue_unref(queue);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nvoid gatt_db_foreach_service_in_range(struct gatt_db *db,\n\t\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\t\tgatt_db_attribute_cb_t func,\n\t\t\t\t\t\tvoid *user_data,\n\t\t\t\t\t\tuint16_t start_handle,\n\t\t\t\t\t\tuint16_t end_handle)\n{\n\tstruct foreach_data data;\n\n\tif (!db || !func || start_handle > end_handle)\n\t\treturn;\n\n\tdata.func = func;\n\tdata.uuid = uuid;\n\tdata.user_data = user_data;\n\tdata.start = start_handle;\n\tdata.end = end_handle;\n\n\tqueue_foreach(db->services, foreach_service_in_range, &data);\n}"
  },
  {
    "function_name": "foreach_service_in_range",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "1273-1293",
    "snippet": "static void foreach_service_in_range(void *data, void *user_data)\n{\n\tstruct gatt_db_service *service = data;\n\tstruct foreach_data *foreach_data = user_data;\n\tuint16_t svc_start;\n\tbt_uuid_t uuid;\n\n\tsvc_start = get_handle_at_index(service, 0);\n\n\tif (svc_start > foreach_data->end || svc_start < foreach_data->start)\n\t\treturn;\n\n\tif (foreach_data->uuid) {\n\t\tgatt_db_attribute_get_service_uuid(service->attributes[0],\n\t\t\t\t\t\t\t\t\t&uuid);\n\t\tif (bt_uuid_cmp(&uuid, foreach_data->uuid))\n\t\t\treturn;\n\t}\n\n\tforeach_data->func(service->attributes[0], foreach_data->user_data);\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "foreach_data->func",
          "args": [
            "service->attributes[0]",
            "foreach_data->user_data"
          ],
          "line": 1292
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_uuid_cmp",
          "args": [
            "&uuid",
            "foreach_data->uuid"
          ],
          "line": 1288
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gatt_db_attribute_get_service_uuid",
          "args": [
            "service->attributes[0]",
            "&uuid"
          ],
          "line": 1286
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_get_service_uuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1490-1519",
          "snippet": "bool gatt_db_attribute_get_service_uuid(const struct gatt_db_attribute *attrib,\n\t\t\t\t\t\t\tbt_uuid_t *uuid)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!attrib || !uuid)\n\t\treturn false;\n\n\tservice = attrib->service;\n\n\tif (service->attributes[0]->value_len == sizeof(uint16_t)) {\n\t\tuint16_t value;\n\n\t\tvalue = get_le16(service->attributes[0]->value);\n\t\tbt_uuid16_create(uuid, value);\n\n\t\treturn true;\n\t}\n\n\tif (service->attributes[0]->value_len == sizeof(uint128_t)) {\n\t\tuint128_t value;\n\n\t\tbswap_128(service->attributes[0]->value, &value);\n\t\tbt_uuid128_create(uuid, value);\n\n\t\treturn true;\n\t}\n\n\treturn false;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_attribute_get_service_uuid(const struct gatt_db_attribute *attrib,\n\t\t\t\t\t\t\tbt_uuid_t *uuid)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!attrib || !uuid)\n\t\treturn false;\n\n\tservice = attrib->service;\n\n\tif (service->attributes[0]->value_len == sizeof(uint16_t)) {\n\t\tuint16_t value;\n\n\t\tvalue = get_le16(service->attributes[0]->value);\n\t\tbt_uuid16_create(uuid, value);\n\n\t\treturn true;\n\t}\n\n\tif (service->attributes[0]->value_len == sizeof(uint128_t)) {\n\t\tuint128_t value;\n\n\t\tbswap_128(service->attributes[0]->value, &value);\n\t\tbt_uuid128_create(uuid, value);\n\n\t\treturn true;\n\t}\n\n\treturn false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "get_handle_at_index",
          "args": [
            "service",
            "0"
          ],
          "line": 1280
        },
        "resolved": true,
        "details": {
          "function_name": "get_handle_at_index",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "652-656",
          "snippet": "static uint16_t get_handle_at_index(struct gatt_db_service *service,\n\t\t\t\t\t\t\t\tint index)\n{\n\treturn service->attributes[index]->handle;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic uint16_t get_handle_at_index(struct gatt_db_service *service,\n\t\t\t\t\t\t\t\tint index)\n{\n\treturn service->attributes[index]->handle;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void foreach_service_in_range(void *data, void *user_data)\n{\n\tstruct gatt_db_service *service = data;\n\tstruct foreach_data *foreach_data = user_data;\n\tuint16_t svc_start;\n\tbt_uuid_t uuid;\n\n\tsvc_start = get_handle_at_index(service, 0);\n\n\tif (svc_start > foreach_data->end || svc_start < foreach_data->start)\n\t\treturn;\n\n\tif (foreach_data->uuid) {\n\t\tgatt_db_attribute_get_service_uuid(service->attributes[0],\n\t\t\t\t\t\t\t\t\t&uuid);\n\t\tif (bt_uuid_cmp(&uuid, foreach_data->uuid))\n\t\t\treturn;\n\t}\n\n\tforeach_data->func(service->attributes[0], foreach_data->user_data);\n}"
  },
  {
    "function_name": "gatt_db_foreach_service",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "1258-1264",
    "snippet": "void gatt_db_foreach_service(struct gatt_db *db, const bt_uuid_t *uuid,\n\t\t\t\t\t\tgatt_db_attribute_cb_t func,\n\t\t\t\t\t\tvoid *user_data)\n{\n\tgatt_db_foreach_service_in_range(db, uuid, func, user_data, 0x0001,\n\t\t\t\t\t\t\t\t\t0xffff);\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "gatt_db_foreach_service_in_range",
          "args": [
            "db",
            "uuid",
            "func",
            "user_data",
            "0x0001",
            "0xffff"
          ],
          "line": 1262
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_foreach_service_in_range",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1295-1314",
          "snippet": "void gatt_db_foreach_service_in_range(struct gatt_db *db,\n\t\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\t\tgatt_db_attribute_cb_t func,\n\t\t\t\t\t\tvoid *user_data,\n\t\t\t\t\t\tuint16_t start_handle,\n\t\t\t\t\t\tuint16_t end_handle)\n{\n\tstruct foreach_data data;\n\n\tif (!db || !func || start_handle > end_handle)\n\t\treturn;\n\n\tdata.func = func;\n\tdata.uuid = uuid;\n\tdata.user_data = user_data;\n\tdata.start = start_handle;\n\tdata.end = end_handle;\n\n\tqueue_foreach(db->services, foreach_service_in_range, &data);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nvoid gatt_db_foreach_service_in_range(struct gatt_db *db,\n\t\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\t\tgatt_db_attribute_cb_t func,\n\t\t\t\t\t\tvoid *user_data,\n\t\t\t\t\t\tuint16_t start_handle,\n\t\t\t\t\t\tuint16_t end_handle)\n{\n\tstruct foreach_data data;\n\n\tif (!db || !func || start_handle > end_handle)\n\t\treturn;\n\n\tdata.func = func;\n\tdata.uuid = uuid;\n\tdata.user_data = user_data;\n\tdata.start = start_handle;\n\tdata.end = end_handle;\n\n\tqueue_foreach(db->services, foreach_service_in_range, &data);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nvoid gatt_db_foreach_service(struct gatt_db *db, const bt_uuid_t *uuid,\n\t\t\t\t\t\tgatt_db_attribute_cb_t func,\n\t\t\t\t\t\tvoid *user_data)\n{\n\tgatt_db_foreach_service_in_range(db, uuid, func, user_data, 0x0001,\n\t\t\t\t\t\t\t\t\t0xffff);\n}"
  },
  {
    "function_name": "gatt_db_find_information",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "1245-1256",
    "snippet": "void gatt_db_find_information(struct gatt_db *db, uint16_t start_handle,\n\t\t\t\t\t\t\tuint16_t end_handle,\n\t\t\t\t\t\t\tstruct queue *queue)\n{\n\tstruct find_information_data data;\n\n\tdata.start_handle = start_handle;\n\tdata.end_handle = end_handle;\n\tdata.queue = queue;\n\n\tqueue_foreach(db->services, find_information, &data);\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_foreach",
          "args": [
            "db->services",
            "find_information",
            "&data"
          ],
          "line": 1255
        },
        "resolved": true,
        "details": {
          "function_name": "queue_foreach",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "203-224",
          "snippet": "void queue_foreach(struct queue *queue, queue_foreach_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue || !function)\n\t\treturn;\n\n\tentry = queue->head;\n\tif (!entry)\n\t\treturn;\n\n\tqueue_ref(queue);\n\twhile (entry && queue->head && queue->ref_count > 1) {\n\t\tstruct queue_entry *next;\n\n\t\tnext = entry->next;\n\t\tfunction(entry->data, user_data);\n\t\tentry = next;\n\t}\n\tqueue_unref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid queue_foreach(struct queue *queue, queue_foreach_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue || !function)\n\t\treturn;\n\n\tentry = queue->head;\n\tif (!entry)\n\t\treturn;\n\n\tqueue_ref(queue);\n\twhile (entry && queue->head && queue->ref_count > 1) {\n\t\tstruct queue_entry *next;\n\n\t\tnext = entry->next;\n\t\tfunction(entry->data, user_data);\n\t\tentry = next;\n\t}\n\tqueue_unref(queue);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nvoid gatt_db_find_information(struct gatt_db *db, uint16_t start_handle,\n\t\t\t\t\t\t\tuint16_t end_handle,\n\t\t\t\t\t\t\tstruct queue *queue)\n{\n\tstruct find_information_data data;\n\n\tdata.start_handle = start_handle;\n\tdata.end_handle = end_handle;\n\tdata.queue = queue;\n\n\tqueue_foreach(db->services, find_information, &data);\n}"
  },
  {
    "function_name": "find_information",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "1215-1243",
    "snippet": "static void find_information(void *data, void *user_data)\n{\n\tstruct find_information_data *search_data = user_data;\n\tstruct gatt_db_service *service = data;\n\tstruct gatt_db_attribute *attribute;\n\tint i;\n\n\tif (!service->active)\n\t\treturn;\n\n\t/* Check if service is in range */\n\tif ((service->attributes[0]->handle + service->num_handles - 1) <\n\t\t\t\t\t\tsearch_data->start_handle)\n\t\treturn;\n\n\tfor (i = 0; i < service->num_handles; i++) {\n\t\tattribute = service->attributes[i];\n\t\tif (!attribute)\n\t\t\tcontinue;\n\n\t\tif (attribute->handle < search_data->start_handle)\n\t\t\tcontinue;\n\n\t\tif (attribute->handle > search_data->end_handle)\n\t\t\treturn;\n\n\t\tqueue_push_tail(search_data->queue, attribute);\n\t}\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_push_tail",
          "args": [
            "search_data->queue",
            "attribute"
          ],
          "line": 1241
        },
        "resolved": true,
        "details": {
          "function_name": "queue_push_tail",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "88-108",
          "snippet": "bool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void find_information(void *data, void *user_data)\n{\n\tstruct find_information_data *search_data = user_data;\n\tstruct gatt_db_service *service = data;\n\tstruct gatt_db_attribute *attribute;\n\tint i;\n\n\tif (!service->active)\n\t\treturn;\n\n\t/* Check if service is in range */\n\tif ((service->attributes[0]->handle + service->num_handles - 1) <\n\t\t\t\t\t\tsearch_data->start_handle)\n\t\treturn;\n\n\tfor (i = 0; i < service->num_handles; i++) {\n\t\tattribute = service->attributes[i];\n\t\tif (!attribute)\n\t\t\tcontinue;\n\n\t\tif (attribute->handle < search_data->start_handle)\n\t\t\tcontinue;\n\n\t\tif (attribute->handle > search_data->end_handle)\n\t\t\treturn;\n\n\t\tqueue_push_tail(search_data->queue, attribute);\n\t}\n}"
  },
  {
    "function_name": "gatt_db_read_by_type",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "1194-1206",
    "snippet": "void gatt_db_read_by_type(struct gatt_db *db, uint16_t start_handle,\n\t\t\t\t\t\tuint16_t end_handle,\n\t\t\t\t\t\tconst bt_uuid_t type,\n\t\t\t\t\t\tstruct queue *queue)\n{\n\tstruct read_by_type_data data;\n\tdata.uuid = type;\n\tdata.start_handle = start_handle;\n\tdata.end_handle = end_handle;\n\tdata.queue = queue;\n\n\tqueue_foreach(db->services, read_by_type, &data);\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_foreach",
          "args": [
            "db->services",
            "read_by_type",
            "&data"
          ],
          "line": 1205
        },
        "resolved": true,
        "details": {
          "function_name": "queue_foreach",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "203-224",
          "snippet": "void queue_foreach(struct queue *queue, queue_foreach_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue || !function)\n\t\treturn;\n\n\tentry = queue->head;\n\tif (!entry)\n\t\treturn;\n\n\tqueue_ref(queue);\n\twhile (entry && queue->head && queue->ref_count > 1) {\n\t\tstruct queue_entry *next;\n\n\t\tnext = entry->next;\n\t\tfunction(entry->data, user_data);\n\t\tentry = next;\n\t}\n\tqueue_unref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid queue_foreach(struct queue *queue, queue_foreach_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue || !function)\n\t\treturn;\n\n\tentry = queue->head;\n\tif (!entry)\n\t\treturn;\n\n\tqueue_ref(queue);\n\twhile (entry && queue->head && queue->ref_count > 1) {\n\t\tstruct queue_entry *next;\n\n\t\tnext = entry->next;\n\t\tfunction(entry->data, user_data);\n\t\tentry = next;\n\t}\n\tqueue_unref(queue);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nvoid gatt_db_read_by_type(struct gatt_db *db, uint16_t start_handle,\n\t\t\t\t\t\tuint16_t end_handle,\n\t\t\t\t\t\tconst bt_uuid_t type,\n\t\t\t\t\t\tstruct queue *queue)\n{\n\tstruct read_by_type_data data;\n\tdata.uuid = type;\n\tdata.start_handle = start_handle;\n\tdata.end_handle = end_handle;\n\tdata.queue = queue;\n\n\tqueue_foreach(db->services, read_by_type, &data);\n}"
  },
  {
    "function_name": "read_by_type",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "1166-1192",
    "snippet": "static void read_by_type(void *data, void *user_data)\n{\n\tstruct read_by_type_data *search_data = user_data;\n\tstruct gatt_db_service *service = data;\n\tstruct gatt_db_attribute *attribute;\n\tint i;\n\n\tif (!service->active)\n\t\treturn;\n\n\tfor (i = 0; i < service->num_handles; i++) {\n\t\tattribute = service->attributes[i];\n\t\tif (!attribute)\n\t\t\tcontinue;\n\n\t\tif (attribute->handle < search_data->start_handle)\n\t\t\tcontinue;\n\n\t\tif (attribute->handle > search_data->end_handle)\n\t\t\treturn;\n\n\t\tif (bt_uuid_cmp(&search_data->uuid, &attribute->uuid))\n\t\t\tcontinue;\n\n\t\tqueue_push_tail(search_data->queue, attribute);\n\t}\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_push_tail",
          "args": [
            "search_data->queue",
            "attribute"
          ],
          "line": 1190
        },
        "resolved": true,
        "details": {
          "function_name": "queue_push_tail",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "88-108",
          "snippet": "bool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_uuid_cmp",
          "args": [
            "&search_data->uuid",
            "&attribute->uuid"
          ],
          "line": 1187
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void read_by_type(void *data, void *user_data)\n{\n\tstruct read_by_type_data *search_data = user_data;\n\tstruct gatt_db_service *service = data;\n\tstruct gatt_db_attribute *attribute;\n\tint i;\n\n\tif (!service->active)\n\t\treturn;\n\n\tfor (i = 0; i < service->num_handles; i++) {\n\t\tattribute = service->attributes[i];\n\t\tif (!attribute)\n\t\t\tcontinue;\n\n\t\tif (attribute->handle < search_data->start_handle)\n\t\t\tcontinue;\n\n\t\tif (attribute->handle > search_data->end_handle)\n\t\t\treturn;\n\n\t\tif (bt_uuid_cmp(&search_data->uuid, &attribute->uuid))\n\t\t\tcontinue;\n\n\t\tqueue_push_tail(search_data->queue, attribute);\n\t}\n}"
  },
  {
    "function_name": "gatt_db_find_by_type_value",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "1135-1157",
    "snippet": "unsigned int gatt_db_find_by_type_value(struct gatt_db *db,\n\t\t\t\t\t\tuint16_t start_handle,\n\t\t\t\t\t\tuint16_t end_handle,\n\t\t\t\t\t\tconst bt_uuid_t *type,\n\t\t\t\t\t\tconst void *value,\n\t\t\t\t\t\tsize_t value_len,\n\t\t\t\t\t\tgatt_db_attribute_cb_t func,\n\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct find_by_type_value_data data;\n\n\tdata.uuid = *type;\n\tdata.start_handle = start_handle;\n\tdata.end_handle = end_handle;\n\tdata.func = func;\n\tdata.user_data = user_data;\n\tdata.value = value;\n\tdata.value_len = value_len;\n\n\tqueue_foreach(db->services, find_by_type, &data);\n\n\treturn data.num_of_res;\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_foreach",
          "args": [
            "db->services",
            "find_by_type",
            "&data"
          ],
          "line": 1154
        },
        "resolved": true,
        "details": {
          "function_name": "queue_foreach",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "203-224",
          "snippet": "void queue_foreach(struct queue *queue, queue_foreach_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue || !function)\n\t\treturn;\n\n\tentry = queue->head;\n\tif (!entry)\n\t\treturn;\n\n\tqueue_ref(queue);\n\twhile (entry && queue->head && queue->ref_count > 1) {\n\t\tstruct queue_entry *next;\n\n\t\tnext = entry->next;\n\t\tfunction(entry->data, user_data);\n\t\tentry = next;\n\t}\n\tqueue_unref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid queue_foreach(struct queue *queue, queue_foreach_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue || !function)\n\t\treturn;\n\n\tentry = queue->head;\n\tif (!entry)\n\t\treturn;\n\n\tqueue_ref(queue);\n\twhile (entry && queue->head && queue->ref_count > 1) {\n\t\tstruct queue_entry *next;\n\n\t\tnext = entry->next;\n\t\tfunction(entry->data, user_data);\n\t\tentry = next;\n\t}\n\tqueue_unref(queue);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nunsigned int gatt_db_find_by_type_value(struct gatt_db *db,\n\t\t\t\t\t\tuint16_t start_handle,\n\t\t\t\t\t\tuint16_t end_handle,\n\t\t\t\t\t\tconst bt_uuid_t *type,\n\t\t\t\t\t\tconst void *value,\n\t\t\t\t\t\tsize_t value_len,\n\t\t\t\t\t\tgatt_db_attribute_cb_t func,\n\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct find_by_type_value_data data;\n\n\tdata.uuid = *type;\n\tdata.start_handle = start_handle;\n\tdata.end_handle = end_handle;\n\tdata.func = func;\n\tdata.user_data = user_data;\n\tdata.value = value;\n\tdata.value_len = value_len;\n\n\tqueue_foreach(db->services, find_by_type, &data);\n\n\treturn data.num_of_res;\n}"
  },
  {
    "function_name": "gatt_db_find_by_type",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "1114-1133",
    "snippet": "unsigned int gatt_db_find_by_type(struct gatt_db *db, uint16_t start_handle,\n\t\t\t\t\t\tuint16_t end_handle,\n\t\t\t\t\t\tconst bt_uuid_t *type,\n\t\t\t\t\t\tgatt_db_attribute_cb_t func,\n\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct find_by_type_value_data data;\n\n\tmemset(&data, 0, sizeof(data));\n\n\tdata.uuid = *type;\n\tdata.start_handle = start_handle;\n\tdata.end_handle = end_handle;\n\tdata.func = func;\n\tdata.user_data = user_data;\n\n\tqueue_foreach(db->services, find_by_type, &data);\n\n\treturn data.num_of_res;\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_foreach",
          "args": [
            "db->services",
            "find_by_type",
            "&data"
          ],
          "line": 1130
        },
        "resolved": true,
        "details": {
          "function_name": "queue_foreach",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "203-224",
          "snippet": "void queue_foreach(struct queue *queue, queue_foreach_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue || !function)\n\t\treturn;\n\n\tentry = queue->head;\n\tif (!entry)\n\t\treturn;\n\n\tqueue_ref(queue);\n\twhile (entry && queue->head && queue->ref_count > 1) {\n\t\tstruct queue_entry *next;\n\n\t\tnext = entry->next;\n\t\tfunction(entry->data, user_data);\n\t\tentry = next;\n\t}\n\tqueue_unref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid queue_foreach(struct queue *queue, queue_foreach_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue || !function)\n\t\treturn;\n\n\tentry = queue->head;\n\tif (!entry)\n\t\treturn;\n\n\tqueue_ref(queue);\n\twhile (entry && queue->head && queue->ref_count > 1) {\n\t\tstruct queue_entry *next;\n\n\t\tnext = entry->next;\n\t\tfunction(entry->data, user_data);\n\t\tentry = next;\n\t}\n\tqueue_unref(queue);\n}"
        }
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&data",
            "0",
            "sizeof(data)"
          ],
          "line": 1122
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nunsigned int gatt_db_find_by_type(struct gatt_db *db, uint16_t start_handle,\n\t\t\t\t\t\tuint16_t end_handle,\n\t\t\t\t\t\tconst bt_uuid_t *type,\n\t\t\t\t\t\tgatt_db_attribute_cb_t func,\n\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct find_by_type_value_data data;\n\n\tmemset(&data, 0, sizeof(data));\n\n\tdata.uuid = *type;\n\tdata.start_handle = start_handle;\n\tdata.end_handle = end_handle;\n\tdata.func = func;\n\tdata.user_data = user_data;\n\n\tqueue_foreach(db->services, find_by_type, &data);\n\n\treturn data.num_of_res;\n}"
  },
  {
    "function_name": "find_by_type",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "1075-1112",
    "snippet": "static void find_by_type(void *data, void *user_data)\n{\n\tstruct find_by_type_value_data *search_data = user_data;\n\tstruct gatt_db_service *service = data;\n\tstruct gatt_db_attribute *attribute;\n\tint i;\n\n\tif (!service->active)\n\t\treturn;\n\n\tfor (i = 0; i < service->num_handles; i++) {\n\t\tattribute = service->attributes[i];\n\n\t\tif (!attribute)\n\t\t\tcontinue;\n\n\t\tif ((attribute->handle < search_data->start_handle) ||\n\t\t\t\t(attribute->handle > search_data->end_handle))\n\t\t\tcontinue;\n\n\t\tif (bt_uuid_cmp(&search_data->uuid, &attribute->uuid))\n\t\t\tcontinue;\n\n\t\t/* TODO: fix for read-callback based attributes */\n\t\tif (search_data->value) {\n\t\t\tif (search_data->value_len != attribute->value_len)\n\t\t\t\tcontinue;\n\n\t\t\tif (memcmp(attribute->value, search_data->value,\n\t\t\t\t\tsearch_data->value_len)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t}\n\n\t\tsearch_data->num_of_res++;\n\t\tsearch_data->func(attribute, search_data->user_data);\n\t}\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "search_data->func",
          "args": [
            "attribute",
            "search_data->user_data"
          ],
          "line": 1110
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcmp",
          "args": [
            "attribute->value",
            "search_data->value",
            "search_data->value_len"
          ],
          "line": 1103
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_uuid_cmp",
          "args": [
            "&search_data->uuid",
            "&attribute->uuid"
          ],
          "line": 1095
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void find_by_type(void *data, void *user_data)\n{\n\tstruct find_by_type_value_data *search_data = user_data;\n\tstruct gatt_db_service *service = data;\n\tstruct gatt_db_attribute *attribute;\n\tint i;\n\n\tif (!service->active)\n\t\treturn;\n\n\tfor (i = 0; i < service->num_handles; i++) {\n\t\tattribute = service->attributes[i];\n\n\t\tif (!attribute)\n\t\t\tcontinue;\n\n\t\tif ((attribute->handle < search_data->start_handle) ||\n\t\t\t\t(attribute->handle > search_data->end_handle))\n\t\t\tcontinue;\n\n\t\tif (bt_uuid_cmp(&search_data->uuid, &attribute->uuid))\n\t\t\tcontinue;\n\n\t\t/* TODO: fix for read-callback based attributes */\n\t\tif (search_data->value) {\n\t\t\tif (search_data->value_len != attribute->value_len)\n\t\t\t\tcontinue;\n\n\t\t\tif (memcmp(attribute->value, search_data->value,\n\t\t\t\t\tsearch_data->value_len)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t}\n\n\t\tsearch_data->num_of_res++;\n\t\tsearch_data->func(attribute, search_data->user_data);\n\t}\n}"
  },
  {
    "function_name": "gatt_db_read_by_group_type",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "1021-1062",
    "snippet": "void gatt_db_read_by_group_type(struct gatt_db *db, uint16_t start_handle,\n\t\t\t\t\t\t\tuint16_t end_handle,\n\t\t\t\t\t\t\tconst bt_uuid_t type,\n\t\t\t\t\t\t\tstruct queue *queue)\n{\n\tconst struct queue_entry *services_entry;\n\tstruct gatt_db_service *service;\n\tuint16_t grp_start, grp_end, uuid_size;\n\n\tuuid_size = 0;\n\n\tservices_entry = queue_get_entries(db->services);\n\n\twhile (services_entry) {\n\t\tservice = services_entry->data;\n\n\t\tif (!service->active)\n\t\t\tgoto next_service;\n\n\t\tif (bt_uuid_cmp(&type, &service->attributes[0]->uuid))\n\t\t\tgoto next_service;\n\n\t\tgrp_start = service->attributes[0]->handle;\n\t\tgrp_end = grp_start + service->num_handles - 1;\n\n\t\tif (grp_end < start_handle || grp_start > end_handle)\n\t\t\tgoto next_service;\n\n\t\tif (grp_start < start_handle || grp_start > end_handle)\n\t\t\tgoto next_service;\n\n\t\tif (!uuid_size)\n\t\t\tuuid_size = service->attributes[0]->value_len;\n\t\telse if (uuid_size != service->attributes[0]->value_len)\n\t\t\treturn;\n\n\t\tqueue_push_tail(queue, service->attributes[0]);\n\nnext_service:\n\t\tservices_entry = services_entry->next;\n\t}\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_push_tail",
          "args": [
            "queue",
            "service->attributes[0]"
          ],
          "line": 1057
        },
        "resolved": true,
        "details": {
          "function_name": "queue_push_tail",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "88-108",
          "snippet": "bool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_uuid_cmp",
          "args": [
            "&type",
            "&service->attributes[0]->uuid"
          ],
          "line": 1040
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "queue_get_entries",
          "args": [
            "db->services"
          ],
          "line": 1032
        },
        "resolved": true,
        "details": {
          "function_name": "queue_get_entries",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "364-370",
          "snippet": "const struct queue_entry *queue_get_entries(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn NULL;\n\n\treturn queue->head;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nconst struct queue_entry *queue_get_entries(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn NULL;\n\n\treturn queue->head;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nvoid gatt_db_read_by_group_type(struct gatt_db *db, uint16_t start_handle,\n\t\t\t\t\t\t\tuint16_t end_handle,\n\t\t\t\t\t\t\tconst bt_uuid_t type,\n\t\t\t\t\t\t\tstruct queue *queue)\n{\n\tconst struct queue_entry *services_entry;\n\tstruct gatt_db_service *service;\n\tuint16_t grp_start, grp_end, uuid_size;\n\n\tuuid_size = 0;\n\n\tservices_entry = queue_get_entries(db->services);\n\n\twhile (services_entry) {\n\t\tservice = services_entry->data;\n\n\t\tif (!service->active)\n\t\t\tgoto next_service;\n\n\t\tif (bt_uuid_cmp(&type, &service->attributes[0]->uuid))\n\t\t\tgoto next_service;\n\n\t\tgrp_start = service->attributes[0]->handle;\n\t\tgrp_end = grp_start + service->num_handles - 1;\n\n\t\tif (grp_end < start_handle || grp_start > end_handle)\n\t\t\tgoto next_service;\n\n\t\tif (grp_start < start_handle || grp_start > end_handle)\n\t\t\tgoto next_service;\n\n\t\tif (!uuid_size)\n\t\t\tuuid_size = service->attributes[0]->value_len;\n\t\telse if (uuid_size != service->attributes[0]->value_len)\n\t\t\treturn;\n\n\t\tqueue_push_tail(queue, service->attributes[0]);\n\nnext_service:\n\t\tservices_entry = services_entry->next;\n\t}\n}"
  },
  {
    "function_name": "gatt_db_service_get_claimed",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "1013-1019",
    "snippet": "bool gatt_db_service_get_claimed(struct gatt_db_attribute *attrib)\n{\n\tif (!attrib)\n\t\treturn false;\n\n\treturn attrib->service->claimed;\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_service_get_claimed(struct gatt_db_attribute *attrib)\n{\n\tif (!attrib)\n\t\treturn false;\n\n\treturn attrib->service->claimed;\n}"
  },
  {
    "function_name": "gatt_db_service_set_claimed",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "1002-1011",
    "snippet": "bool gatt_db_service_set_claimed(struct gatt_db_attribute *attrib,\n\t\t\t\t\t\t\t\tbool claimed)\n{\n\tif (!attrib)\n\t\treturn false;\n\n\tattrib->service->claimed = claimed;\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_service_set_claimed(struct gatt_db_attribute *attrib,\n\t\t\t\t\t\t\t\tbool claimed)\n{\n\tif (!attrib)\n\t\treturn false;\n\n\tattrib->service->claimed = claimed;\n\n\treturn true;\n}"
  },
  {
    "function_name": "gatt_db_service_get_active",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "994-1000",
    "snippet": "bool gatt_db_service_get_active(struct gatt_db_attribute *attrib)\n{\n\tif (!attrib)\n\t\treturn false;\n\n\treturn attrib->service->active;\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_service_get_active(struct gatt_db_attribute *attrib)\n{\n\tif (!attrib)\n\t\treturn false;\n\n\treturn attrib->service->active;\n}"
  },
  {
    "function_name": "gatt_db_service_set_active",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "975-992",
    "snippet": "bool gatt_db_service_set_active(struct gatt_db_attribute *attrib, bool active)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!attrib)\n\t\treturn false;\n\n\tservice = attrib->service;\n\n\tif (service->active == active)\n\t\treturn true;\n\n\tservice->active = active;\n\n\tnotify_service_changed(service->db, service, active);\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "notify_service_changed",
          "args": [
            "service->db",
            "service",
            "active"
          ],
          "line": 989
        },
        "resolved": true,
        "details": {
          "function_name": "notify_service_changed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "266-283",
          "snippet": "static void notify_service_changed(struct gatt_db *db,\n\t\t\t\t\t\tstruct gatt_db_service *service,\n\t\t\t\t\t\tbool added)\n{\n\tstruct notify_data data;\n\n\tif (queue_isempty(db->notify_list))\n\t\treturn;\n\n\tdata.attr = service->attributes[0];\n\tdata.added = added;\n\n\tgatt_db_ref(db);\n\n\tqueue_foreach(db->notify_list, handle_notify, &data);\n\n\tgatt_db_unref(db);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void notify_service_changed(struct gatt_db *db,\n\t\t\t\t\t\tstruct gatt_db_service *service,\n\t\t\t\t\t\tbool added)\n{\n\tstruct notify_data data;\n\n\tif (queue_isempty(db->notify_list))\n\t\treturn;\n\n\tdata.attr = service->attributes[0];\n\tdata.added = added;\n\n\tgatt_db_ref(db);\n\n\tqueue_foreach(db->notify_list, handle_notify, &data);\n\n\tgatt_db_unref(db);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_service_set_active(struct gatt_db_attribute *attrib, bool active)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!attrib)\n\t\treturn false;\n\n\tservice = attrib->service;\n\n\tif (service->active == active)\n\t\treturn true;\n\n\tservice->active = active;\n\n\tnotify_service_changed(service->db, service, active);\n\n\treturn true;\n}"
  },
  {
    "function_name": "gatt_db_insert_included",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "962-973",
    "snippet": "struct gatt_db_attribute *\ngatt_db_insert_included(struct gatt_db *db, uint16_t handle,\n\t\t\tstruct gatt_db_attribute *include)\n{\n\tstruct gatt_db_attribute *attrib;\n\n\tattrib = gatt_db_get_service(db, handle);\n\tif (!attrib)\n\t\treturn NULL;\n\n\treturn service_insert_included(attrib->service, handle, include);\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "service_insert_included",
          "args": [
            "attrib->service",
            "handle",
            "include"
          ],
          "line": 972
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_service_insert_included",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "951-960",
          "snippet": "struct gatt_db_attribute *\ngatt_db_service_insert_included(struct gatt_db_attribute *attrib,\n\t\t\t\tuint16_t handle,\n\t\t\t\tstruct gatt_db_attribute *include)\n{\n\tif (!attrib || !handle || !include)\n\t\treturn NULL;\n\n\treturn service_insert_included(attrib->service, handle, include);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstruct gatt_db_attribute *\ngatt_db_service_insert_included(struct gatt_db_attribute *attrib,\n\t\t\t\tuint16_t handle,\n\t\t\t\tstruct gatt_db_attribute *include)\n{\n\tif (!attrib || !handle || !include)\n\t\treturn NULL;\n\n\treturn service_insert_included(attrib->service, handle, include);\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_get_service",
          "args": [
            "db",
            "handle"
          ],
          "line": 968
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_get_service_with_uuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1458-1471",
          "snippet": "struct gatt_db_attribute *gatt_db_get_service_with_uuid(struct gatt_db *db,\n\t\t\t\t\t\t\tconst bt_uuid_t *uuid)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!db || !uuid)\n\t\treturn NULL;\n\n\tservice = queue_find(db->services, find_service_with_uuid, uuid);\n\tif (!service)\n\t\treturn NULL;\n\n\treturn service->attributes[0];\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstruct gatt_db_attribute *gatt_db_get_service_with_uuid(struct gatt_db *db,\n\t\t\t\t\t\t\tconst bt_uuid_t *uuid)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!db || !uuid)\n\t\treturn NULL;\n\n\tservice = queue_find(db->services, find_service_with_uuid, uuid);\n\tif (!service)\n\t\treturn NULL;\n\n\treturn service->attributes[0];\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstruct gatt_db_attribute *\ngatt_db_insert_included(struct gatt_db *db, uint16_t handle,\n\t\t\tstruct gatt_db_attribute *include)\n{\n\tstruct gatt_db_attribute *attrib;\n\n\tattrib = gatt_db_get_service(db, handle);\n\tif (!attrib)\n\t\treturn NULL;\n\n\treturn service_insert_included(attrib->service, handle, include);\n}"
  },
  {
    "function_name": "gatt_db_service_insert_included",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "951-960",
    "snippet": "struct gatt_db_attribute *\ngatt_db_service_insert_included(struct gatt_db_attribute *attrib,\n\t\t\t\tuint16_t handle,\n\t\t\t\tstruct gatt_db_attribute *include)\n{\n\tif (!attrib || !handle || !include)\n\t\treturn NULL;\n\n\treturn service_insert_included(attrib->service, handle, include);\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "service_insert_included",
          "args": [
            "attrib->service",
            "handle",
            "include"
          ],
          "line": 959
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_service_insert_included",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "951-960",
          "snippet": "struct gatt_db_attribute *\ngatt_db_service_insert_included(struct gatt_db_attribute *attrib,\n\t\t\t\tuint16_t handle,\n\t\t\t\tstruct gatt_db_attribute *include)\n{\n\tif (!attrib || !handle || !include)\n\t\treturn NULL;\n\n\treturn service_insert_included(attrib->service, handle, include);\n}",
          "note": "cyclic_reference_detected"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstruct gatt_db_attribute *\ngatt_db_service_insert_included(struct gatt_db_attribute *attrib,\n\t\t\t\tuint16_t handle,\n\t\t\t\tstruct gatt_db_attribute *include)\n{\n\tif (!attrib || !handle || !include)\n\t\treturn NULL;\n\n\treturn service_insert_included(attrib->service, handle, include);\n}"
  },
  {
    "function_name": "gatt_db_service_add_included",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "941-949",
    "snippet": "struct gatt_db_attribute *\ngatt_db_service_add_included(struct gatt_db_attribute *attrib,\n\t\t\t\t\tstruct gatt_db_attribute *include)\n{\n\tif (!attrib || !include)\n\t\treturn NULL;\n\n\treturn service_insert_included(attrib->service, 0, include);\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "service_insert_included",
          "args": [
            "attrib->service",
            "0",
            "include"
          ],
          "line": 948
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_service_insert_included",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "951-960",
          "snippet": "struct gatt_db_attribute *\ngatt_db_service_insert_included(struct gatt_db_attribute *attrib,\n\t\t\t\tuint16_t handle,\n\t\t\t\tstruct gatt_db_attribute *include)\n{\n\tif (!attrib || !handle || !include)\n\t\treturn NULL;\n\n\treturn service_insert_included(attrib->service, handle, include);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstruct gatt_db_attribute *\ngatt_db_service_insert_included(struct gatt_db_attribute *attrib,\n\t\t\t\tuint16_t handle,\n\t\t\t\tstruct gatt_db_attribute *include)\n{\n\tif (!attrib || !handle || !include)\n\t\treturn NULL;\n\n\treturn service_insert_included(attrib->service, handle, include);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstruct gatt_db_attribute *\ngatt_db_service_add_included(struct gatt_db_attribute *attrib,\n\t\t\t\t\tstruct gatt_db_attribute *include)\n{\n\tif (!attrib || !include)\n\t\treturn NULL;\n\n\treturn service_insert_included(attrib->service, 0, include);\n}"
  },
  {
    "function_name": "service_insert_included",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "883-939",
    "snippet": "static struct gatt_db_attribute *\nservice_insert_included(struct gatt_db_service *service, uint16_t handle,\n\t\t\t\t\tstruct gatt_db_attribute *include)\n{\n\tstruct gatt_db_service *included;\n\tuint8_t value[MAX_INCLUDED_VALUE_LEN];\n\tuint16_t included_handle, len = 0;\n\tint index;\n\n\tincluded = include->service;\n\n\t/* Adjust include to point to the first attribute */\n\tif (include != included->attributes[0])\n\t\tinclude = included->attributes[0];\n\n\tincluded_handle = include->handle;\n\n\tput_le16(included_handle, &value[len]);\n\tlen += sizeof(uint16_t);\n\n\tput_le16(included_handle + included->num_handles - 1, &value[len]);\n\tlen += sizeof(uint16_t);\n\n\t/* The Service UUID shall only be present when the UUID is a 16-bit\n\t * Bluetooth UUID. Vol 2. Part G. 3.2\n\t */\n\tif (include->value_len == sizeof(uint16_t)) {\n\t\tmemcpy(&value[len], include->value, include->value_len);\n\t\tlen += include->value_len;\n\t}\n\n\tindex = get_attribute_index(service, 0);\n\tif (!index)\n\t\treturn NULL;\n\n\t/* Check if handle is in within service range */\n\tif (handle && handle <= service->attributes[0]->handle)\n\t\treturn NULL;\n\n\tif (!handle)\n\t\thandle = get_handle_at_index(service, index - 1) + 1;\n\n\tservice->attributes[index] = new_attribute(service, handle,\n\t\t\t\t\t\t\t&included_service_uuid,\n\t\t\t\t\t\t\tvalue, len);\n\tif (!service->attributes[index])\n\t\treturn NULL;\n\n\t/* The Attribute Permissions shall be read only and not require\n\t * authentication or authorization. Vol 2. Part G. 3.2\n\t *\n\t * TODO handle permissions\n\t */\n\tset_attribute_data(service->attributes[index], NULL, NULL, BT_ATT_PERM_READ, NULL);\n\n\treturn attribute_update(service, index);\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define MAX_INCLUDED_VALUE_LEN 6"
    ],
    "globals_used": [
      "static const bt_uuid_t included_service_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_INCLUDE_UUID };"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "attribute_update",
          "args": [
            "service",
            "index"
          ],
          "line": 938
        },
        "resolved": true,
        "details": {
          "function_name": "attribute_update",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "658-670",
          "snippet": "static struct gatt_db_attribute *\nattribute_update(struct gatt_db_service *service, int index)\n{\n\tuint16_t previous_handle;\n\n\t/* We call this function with index > 0, because index 0 is reserved\n\t * for service declaration, and is set in add_service()\n\t */\n\tprevious_handle = service->attributes[index - 1]->handle;\n\tservice->attributes[index]->handle = previous_handle + 1;\n\n\treturn service->attributes[index];\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic struct gatt_db_attribute *\nattribute_update(struct gatt_db_service *service, int index)\n{\n\tuint16_t previous_handle;\n\n\t/* We call this function with index > 0, because index 0 is reserved\n\t * for service declaration, and is set in add_service()\n\t */\n\tprevious_handle = service->attributes[index - 1]->handle;\n\tservice->attributes[index]->handle = previous_handle + 1;\n\n\treturn service->attributes[index];\n}"
        }
      },
      {
        "call_info": {
          "callee": "set_attribute_data",
          "args": [
            "service->attributes[index]",
            "NULL",
            "NULL",
            "BT_ATT_PERM_READ",
            "NULL"
          ],
          "line": 936
        },
        "resolved": true,
        "details": {
          "function_name": "set_attribute_data",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "118-128",
          "snippet": "static void set_attribute_data(struct gatt_db_attribute *attribute,\n\t\t\t\t\t\tgatt_db_read_t read_func,\n\t\t\t\t\t\tgatt_db_write_t write_func,\n\t\t\t\t\t\tuint32_t permissions,\n\t\t\t\t\t\tvoid *user_data)\n{\n\tattribute->permissions = permissions;\n\tattribute->read_func = read_func;\n\tattribute->write_func = write_func;\n\tattribute->user_data = user_data;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void set_attribute_data(struct gatt_db_attribute *attribute,\n\t\t\t\t\t\tgatt_db_read_t read_func,\n\t\t\t\t\t\tgatt_db_write_t write_func,\n\t\t\t\t\t\tuint32_t permissions,\n\t\t\t\t\t\tvoid *user_data)\n{\n\tattribute->permissions = permissions;\n\tattribute->read_func = read_func;\n\tattribute->write_func = write_func;\n\tattribute->user_data = user_data;\n}"
        }
      },
      {
        "call_info": {
          "callee": "new_attribute",
          "args": [
            "service",
            "handle",
            "&included_service_uuid",
            "value",
            "len"
          ],
          "line": 925
        },
        "resolved": true,
        "details": {
          "function_name": "new_attribute",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "178-208",
          "snippet": "static struct gatt_db_attribute *new_attribute(struct gatt_db_service *service,\n\t\t\t\t\t\t\tuint16_t handle,\n\t\t\t\t\t\t\tconst bt_uuid_t *type,\n\t\t\t\t\t\t\tconst uint8_t *val,\n\t\t\t\t\t\t\tuint16_t len)\n{\n\tstruct gatt_db_attribute *attribute;\n\n\tattribute = new0(struct gatt_db_attribute, 1);\n\n\tattribute->service = service;\n\tattribute->handle = handle;\n\tattribute->uuid = *type;\n\tattribute->value_len = len;\n\tif (len) {\n\t\tattribute->value = malloc0(len);\n\t\tif (!attribute->value)\n\t\t\tgoto failed;\n\n\t\tmemcpy(attribute->value, val, len);\n\t}\n\n\tattribute->pending_reads = queue_new();\n\tattribute->pending_writes = queue_new();\n\n\treturn attribute;\n\nfailed:\n\tattribute_destroy(attribute);\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic struct gatt_db_attribute *new_attribute(struct gatt_db_service *service,\n\t\t\t\t\t\t\tuint16_t handle,\n\t\t\t\t\t\t\tconst bt_uuid_t *type,\n\t\t\t\t\t\t\tconst uint8_t *val,\n\t\t\t\t\t\t\tuint16_t len)\n{\n\tstruct gatt_db_attribute *attribute;\n\n\tattribute = new0(struct gatt_db_attribute, 1);\n\n\tattribute->service = service;\n\tattribute->handle = handle;\n\tattribute->uuid = *type;\n\tattribute->value_len = len;\n\tif (len) {\n\t\tattribute->value = malloc0(len);\n\t\tif (!attribute->value)\n\t\t\tgoto failed;\n\n\t\tmemcpy(attribute->value, val, len);\n\t}\n\n\tattribute->pending_reads = queue_new();\n\tattribute->pending_writes = queue_new();\n\n\treturn attribute;\n\nfailed:\n\tattribute_destroy(attribute);\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "get_handle_at_index",
          "args": [
            "service",
            "index - 1"
          ],
          "line": 923
        },
        "resolved": true,
        "details": {
          "function_name": "get_handle_at_index",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "652-656",
          "snippet": "static uint16_t get_handle_at_index(struct gatt_db_service *service,\n\t\t\t\t\t\t\t\tint index)\n{\n\treturn service->attributes[index]->handle;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic uint16_t get_handle_at_index(struct gatt_db_service *service,\n\t\t\t\t\t\t\t\tint index)\n{\n\treturn service->attributes[index]->handle;\n}"
        }
      },
      {
        "call_info": {
          "callee": "get_attribute_index",
          "args": [
            "service",
            "0"
          ],
          "line": 914
        },
        "resolved": true,
        "details": {
          "function_name": "get_attribute_index",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "639-650",
          "snippet": "static uint16_t get_attribute_index(struct gatt_db_service *service,\n\t\t\t\t\t\t\tint end_offset)\n{\n\tint i = 0;\n\n\t/* Here we look for first free attribute index with given offset */\n\twhile (i < (service->num_handles - end_offset) &&\n\t\t\t\t\t\tservice->attributes[i])\n\t\ti++;\n\n\treturn i == (service->num_handles - end_offset) ? 0 : i;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic uint16_t get_attribute_index(struct gatt_db_service *service,\n\t\t\t\t\t\t\tint end_offset)\n{\n\tint i = 0;\n\n\t/* Here we look for first free attribute index with given offset */\n\twhile (i < (service->num_handles - end_offset) &&\n\t\t\t\t\t\tservice->attributes[i])\n\t\ti++;\n\n\treturn i == (service->num_handles - end_offset) ? 0 : i;\n}"
        }
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "&value[len]",
            "include->value",
            "include->value_len"
          ],
          "line": 910
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "put_le16",
          "args": [
            "included_handle + included->num_handles - 1",
            "&value[len]"
          ],
          "line": 903
        },
        "resolved": true,
        "details": {
          "function_name": "put_le16",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/util.h",
          "lines": "159-162",
          "snippet": "static inline void put_le16(uint16_t val, void *dst)\n{\n\tput_unaligned(cpu_to_le16(val), (uint16_t *) dst);\n}",
          "includes": [
            "#include <string.h>",
            "#include <byteswap.h>",
            "#include <alloca.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <byteswap.h>\n#include <alloca.h>\n#include <stdlib.h>\n#include <stdint.h>\n\nstatic inline void put_le16(uint16_t val, void *dst)\n{\n\tput_unaligned(cpu_to_le16(val), (uint16_t *) dst);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\n#define MAX_INCLUDED_VALUE_LEN 6\n\nstatic const bt_uuid_t included_service_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_INCLUDE_UUID };\n\nstatic struct gatt_db_attribute *\nservice_insert_included(struct gatt_db_service *service, uint16_t handle,\n\t\t\t\t\tstruct gatt_db_attribute *include)\n{\n\tstruct gatt_db_service *included;\n\tuint8_t value[MAX_INCLUDED_VALUE_LEN];\n\tuint16_t included_handle, len = 0;\n\tint index;\n\n\tincluded = include->service;\n\n\t/* Adjust include to point to the first attribute */\n\tif (include != included->attributes[0])\n\t\tinclude = included->attributes[0];\n\n\tincluded_handle = include->handle;\n\n\tput_le16(included_handle, &value[len]);\n\tlen += sizeof(uint16_t);\n\n\tput_le16(included_handle + included->num_handles - 1, &value[len]);\n\tlen += sizeof(uint16_t);\n\n\t/* The Service UUID shall only be present when the UUID is a 16-bit\n\t * Bluetooth UUID. Vol 2. Part G. 3.2\n\t */\n\tif (include->value_len == sizeof(uint16_t)) {\n\t\tmemcpy(&value[len], include->value, include->value_len);\n\t\tlen += include->value_len;\n\t}\n\n\tindex = get_attribute_index(service, 0);\n\tif (!index)\n\t\treturn NULL;\n\n\t/* Check if handle is in within service range */\n\tif (handle && handle <= service->attributes[0]->handle)\n\t\treturn NULL;\n\n\tif (!handle)\n\t\thandle = get_handle_at_index(service, index - 1) + 1;\n\n\tservice->attributes[index] = new_attribute(service, handle,\n\t\t\t\t\t\t\t&included_service_uuid,\n\t\t\t\t\t\t\tvalue, len);\n\tif (!service->attributes[index])\n\t\treturn NULL;\n\n\t/* The Attribute Permissions shall be read only and not require\n\t * authentication or authorization. Vol 2. Part G. 3.2\n\t *\n\t * TODO handle permissions\n\t */\n\tset_attribute_data(service->attributes[index], NULL, NULL, BT_ATT_PERM_READ, NULL);\n\n\treturn attribute_update(service, index);\n}"
  },
  {
    "function_name": "gatt_db_service_add_descriptor",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "867-881",
    "snippet": "struct gatt_db_attribute *\ngatt_db_service_add_descriptor(struct gatt_db_attribute *attrib,\n\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\tuint32_t permissions,\n\t\t\t\t\tgatt_db_read_t read_func,\n\t\t\t\t\tgatt_db_write_t write_func,\n\t\t\t\t\tvoid *user_data)\n{\n\tif (!attrib)\n\t\treturn NULL;\n\n\treturn service_insert_descriptor(attrib->service, 0, uuid,\n\t\t\t\t\tpermissions, read_func, write_func,\n\t\t\t\t\tuser_data);\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "service_insert_descriptor",
          "args": [
            "attrib->service",
            "0",
            "uuid",
            "permissions",
            "read_func",
            "write_func",
            "user_data"
          ],
          "line": 878
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_service_insert_descriptor",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "850-865",
          "snippet": "struct gatt_db_attribute *\ngatt_db_service_insert_descriptor(struct gatt_db_attribute *attrib,\n\t\t\t\t\tuint16_t handle,\n\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\tuint32_t permissions,\n\t\t\t\t\tgatt_db_read_t read_func,\n\t\t\t\t\tgatt_db_write_t write_func,\n\t\t\t\t\tvoid *user_data)\n{\n\tif (!attrib || !handle)\n\t\treturn NULL;\n\n\treturn service_insert_descriptor(attrib->service, handle, uuid,\n\t\t\t\t\tpermissions, read_func, write_func,\n\t\t\t\t\tuser_data);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstruct gatt_db_attribute *\ngatt_db_service_insert_descriptor(struct gatt_db_attribute *attrib,\n\t\t\t\t\tuint16_t handle,\n\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\tuint32_t permissions,\n\t\t\t\t\tgatt_db_read_t read_func,\n\t\t\t\t\tgatt_db_write_t write_func,\n\t\t\t\t\tvoid *user_data)\n{\n\tif (!attrib || !handle)\n\t\treturn NULL;\n\n\treturn service_insert_descriptor(attrib->service, handle, uuid,\n\t\t\t\t\tpermissions, read_func, write_func,\n\t\t\t\t\tuser_data);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstruct gatt_db_attribute *\ngatt_db_service_add_descriptor(struct gatt_db_attribute *attrib,\n\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\tuint32_t permissions,\n\t\t\t\t\tgatt_db_read_t read_func,\n\t\t\t\t\tgatt_db_write_t write_func,\n\t\t\t\t\tvoid *user_data)\n{\n\tif (!attrib)\n\t\treturn NULL;\n\n\treturn service_insert_descriptor(attrib->service, 0, uuid,\n\t\t\t\t\tpermissions, read_func, write_func,\n\t\t\t\t\tuser_data);\n}"
  },
  {
    "function_name": "gatt_db_service_insert_descriptor",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "850-865",
    "snippet": "struct gatt_db_attribute *\ngatt_db_service_insert_descriptor(struct gatt_db_attribute *attrib,\n\t\t\t\t\tuint16_t handle,\n\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\tuint32_t permissions,\n\t\t\t\t\tgatt_db_read_t read_func,\n\t\t\t\t\tgatt_db_write_t write_func,\n\t\t\t\t\tvoid *user_data)\n{\n\tif (!attrib || !handle)\n\t\treturn NULL;\n\n\treturn service_insert_descriptor(attrib->service, handle, uuid,\n\t\t\t\t\tpermissions, read_func, write_func,\n\t\t\t\t\tuser_data);\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "service_insert_descriptor",
          "args": [
            "attrib->service",
            "handle",
            "uuid",
            "permissions",
            "read_func",
            "write_func",
            "user_data"
          ],
          "line": 862
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_service_insert_descriptor",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "850-865",
          "snippet": "struct gatt_db_attribute *\ngatt_db_service_insert_descriptor(struct gatt_db_attribute *attrib,\n\t\t\t\t\tuint16_t handle,\n\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\tuint32_t permissions,\n\t\t\t\t\tgatt_db_read_t read_func,\n\t\t\t\t\tgatt_db_write_t write_func,\n\t\t\t\t\tvoid *user_data)\n{\n\tif (!attrib || !handle)\n\t\treturn NULL;\n\n\treturn service_insert_descriptor(attrib->service, handle, uuid,\n\t\t\t\t\tpermissions, read_func, write_func,\n\t\t\t\t\tuser_data);\n}",
          "note": "cyclic_reference_detected"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstruct gatt_db_attribute *\ngatt_db_service_insert_descriptor(struct gatt_db_attribute *attrib,\n\t\t\t\t\tuint16_t handle,\n\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\tuint32_t permissions,\n\t\t\t\t\tgatt_db_read_t read_func,\n\t\t\t\t\tgatt_db_write_t write_func,\n\t\t\t\t\tvoid *user_data)\n{\n\tif (!attrib || !handle)\n\t\treturn NULL;\n\n\treturn service_insert_descriptor(attrib->service, handle, uuid,\n\t\t\t\t\tpermissions, read_func, write_func,\n\t\t\t\t\tuser_data);\n}"
  },
  {
    "function_name": "gatt_db_insert_descriptor",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "830-848",
    "snippet": "struct gatt_db_attribute *\ngatt_db_insert_descriptor(struct gatt_db *db,\n\t\t\t\t\tuint16_t handle,\n\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\tuint32_t permissions,\n\t\t\t\t\tgatt_db_read_t read_func,\n\t\t\t\t\tgatt_db_write_t write_func,\n\t\t\t\t\tvoid *user_data)\n{\n\tstruct gatt_db_attribute *attrib;\n\n\tattrib = gatt_db_get_service(db, handle);\n\tif (!attrib)\n\t\treturn NULL;\n\n\treturn service_insert_descriptor(attrib->service, handle, uuid,\n\t\t\t\t\tpermissions, read_func, write_func,\n\t\t\t\t\tuser_data);\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "service_insert_descriptor",
          "args": [
            "attrib->service",
            "handle",
            "uuid",
            "permissions",
            "read_func",
            "write_func",
            "user_data"
          ],
          "line": 845
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_service_insert_descriptor",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "850-865",
          "snippet": "struct gatt_db_attribute *\ngatt_db_service_insert_descriptor(struct gatt_db_attribute *attrib,\n\t\t\t\t\tuint16_t handle,\n\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\tuint32_t permissions,\n\t\t\t\t\tgatt_db_read_t read_func,\n\t\t\t\t\tgatt_db_write_t write_func,\n\t\t\t\t\tvoid *user_data)\n{\n\tif (!attrib || !handle)\n\t\treturn NULL;\n\n\treturn service_insert_descriptor(attrib->service, handle, uuid,\n\t\t\t\t\tpermissions, read_func, write_func,\n\t\t\t\t\tuser_data);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstruct gatt_db_attribute *\ngatt_db_service_insert_descriptor(struct gatt_db_attribute *attrib,\n\t\t\t\t\tuint16_t handle,\n\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\tuint32_t permissions,\n\t\t\t\t\tgatt_db_read_t read_func,\n\t\t\t\t\tgatt_db_write_t write_func,\n\t\t\t\t\tvoid *user_data)\n{\n\tif (!attrib || !handle)\n\t\treturn NULL;\n\n\treturn service_insert_descriptor(attrib->service, handle, uuid,\n\t\t\t\t\tpermissions, read_func, write_func,\n\t\t\t\t\tuser_data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_get_service",
          "args": [
            "db",
            "handle"
          ],
          "line": 841
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_get_service_with_uuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1458-1471",
          "snippet": "struct gatt_db_attribute *gatt_db_get_service_with_uuid(struct gatt_db *db,\n\t\t\t\t\t\t\tconst bt_uuid_t *uuid)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!db || !uuid)\n\t\treturn NULL;\n\n\tservice = queue_find(db->services, find_service_with_uuid, uuid);\n\tif (!service)\n\t\treturn NULL;\n\n\treturn service->attributes[0];\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstruct gatt_db_attribute *gatt_db_get_service_with_uuid(struct gatt_db *db,\n\t\t\t\t\t\t\tconst bt_uuid_t *uuid)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!db || !uuid)\n\t\treturn NULL;\n\n\tservice = queue_find(db->services, find_service_with_uuid, uuid);\n\tif (!service)\n\t\treturn NULL;\n\n\treturn service->attributes[0];\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstruct gatt_db_attribute *\ngatt_db_insert_descriptor(struct gatt_db *db,\n\t\t\t\t\tuint16_t handle,\n\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\tuint32_t permissions,\n\t\t\t\t\tgatt_db_read_t read_func,\n\t\t\t\t\tgatt_db_write_t write_func,\n\t\t\t\t\tvoid *user_data)\n{\n\tstruct gatt_db_attribute *attrib;\n\n\tattrib = gatt_db_get_service(db, handle);\n\tif (!attrib)\n\t\treturn NULL;\n\n\treturn service_insert_descriptor(attrib->service, handle, uuid,\n\t\t\t\t\tpermissions, read_func, write_func,\n\t\t\t\t\tuser_data);\n}"
  },
  {
    "function_name": "service_insert_descriptor",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "798-828",
    "snippet": "static struct gatt_db_attribute *\nservice_insert_descriptor(struct gatt_db_service *service,\n\t\t\t\t\tuint16_t handle,\n\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\tuint32_t permissions,\n\t\t\t\t\tgatt_db_read_t read_func,\n\t\t\t\t\tgatt_db_write_t write_func,\n\t\t\t\t\tvoid *user_data)\n{\n\tint i;\n\n\ti = get_attribute_index(service, 0);\n\tif (!i)\n\t\treturn NULL;\n\n\t/* Check if handle is in within service range */\n\tif (handle && handle <= service->attributes[0]->handle)\n\t\treturn NULL;\n\n\tif (!handle)\n\t\thandle = get_handle_at_index(service, i - 1) + 1;\n\n\tservice->attributes[i] = new_attribute(service, handle, uuid, NULL, 0);\n\tif (!service->attributes[i])\n\t\treturn NULL;\n\n\tset_attribute_data(service->attributes[i], read_func, write_func,\n\t\t\t\t\t\t\tpermissions, user_data);\n\n\treturn service->attributes[i];\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "set_attribute_data",
          "args": [
            "service->attributes[i]",
            "read_func",
            "write_func",
            "permissions",
            "user_data"
          ],
          "line": 824
        },
        "resolved": true,
        "details": {
          "function_name": "set_attribute_data",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "118-128",
          "snippet": "static void set_attribute_data(struct gatt_db_attribute *attribute,\n\t\t\t\t\t\tgatt_db_read_t read_func,\n\t\t\t\t\t\tgatt_db_write_t write_func,\n\t\t\t\t\t\tuint32_t permissions,\n\t\t\t\t\t\tvoid *user_data)\n{\n\tattribute->permissions = permissions;\n\tattribute->read_func = read_func;\n\tattribute->write_func = write_func;\n\tattribute->user_data = user_data;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void set_attribute_data(struct gatt_db_attribute *attribute,\n\t\t\t\t\t\tgatt_db_read_t read_func,\n\t\t\t\t\t\tgatt_db_write_t write_func,\n\t\t\t\t\t\tuint32_t permissions,\n\t\t\t\t\t\tvoid *user_data)\n{\n\tattribute->permissions = permissions;\n\tattribute->read_func = read_func;\n\tattribute->write_func = write_func;\n\tattribute->user_data = user_data;\n}"
        }
      },
      {
        "call_info": {
          "callee": "new_attribute",
          "args": [
            "service",
            "handle",
            "uuid",
            "NULL",
            "0"
          ],
          "line": 820
        },
        "resolved": true,
        "details": {
          "function_name": "new_attribute",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "178-208",
          "snippet": "static struct gatt_db_attribute *new_attribute(struct gatt_db_service *service,\n\t\t\t\t\t\t\tuint16_t handle,\n\t\t\t\t\t\t\tconst bt_uuid_t *type,\n\t\t\t\t\t\t\tconst uint8_t *val,\n\t\t\t\t\t\t\tuint16_t len)\n{\n\tstruct gatt_db_attribute *attribute;\n\n\tattribute = new0(struct gatt_db_attribute, 1);\n\n\tattribute->service = service;\n\tattribute->handle = handle;\n\tattribute->uuid = *type;\n\tattribute->value_len = len;\n\tif (len) {\n\t\tattribute->value = malloc0(len);\n\t\tif (!attribute->value)\n\t\t\tgoto failed;\n\n\t\tmemcpy(attribute->value, val, len);\n\t}\n\n\tattribute->pending_reads = queue_new();\n\tattribute->pending_writes = queue_new();\n\n\treturn attribute;\n\nfailed:\n\tattribute_destroy(attribute);\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic struct gatt_db_attribute *new_attribute(struct gatt_db_service *service,\n\t\t\t\t\t\t\tuint16_t handle,\n\t\t\t\t\t\t\tconst bt_uuid_t *type,\n\t\t\t\t\t\t\tconst uint8_t *val,\n\t\t\t\t\t\t\tuint16_t len)\n{\n\tstruct gatt_db_attribute *attribute;\n\n\tattribute = new0(struct gatt_db_attribute, 1);\n\n\tattribute->service = service;\n\tattribute->handle = handle;\n\tattribute->uuid = *type;\n\tattribute->value_len = len;\n\tif (len) {\n\t\tattribute->value = malloc0(len);\n\t\tif (!attribute->value)\n\t\t\tgoto failed;\n\n\t\tmemcpy(attribute->value, val, len);\n\t}\n\n\tattribute->pending_reads = queue_new();\n\tattribute->pending_writes = queue_new();\n\n\treturn attribute;\n\nfailed:\n\tattribute_destroy(attribute);\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "get_handle_at_index",
          "args": [
            "service",
            "i - 1"
          ],
          "line": 818
        },
        "resolved": true,
        "details": {
          "function_name": "get_handle_at_index",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "652-656",
          "snippet": "static uint16_t get_handle_at_index(struct gatt_db_service *service,\n\t\t\t\t\t\t\t\tint index)\n{\n\treturn service->attributes[index]->handle;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic uint16_t get_handle_at_index(struct gatt_db_service *service,\n\t\t\t\t\t\t\t\tint index)\n{\n\treturn service->attributes[index]->handle;\n}"
        }
      },
      {
        "call_info": {
          "callee": "get_attribute_index",
          "args": [
            "service",
            "0"
          ],
          "line": 809
        },
        "resolved": true,
        "details": {
          "function_name": "get_attribute_index",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "639-650",
          "snippet": "static uint16_t get_attribute_index(struct gatt_db_service *service,\n\t\t\t\t\t\t\tint end_offset)\n{\n\tint i = 0;\n\n\t/* Here we look for first free attribute index with given offset */\n\twhile (i < (service->num_handles - end_offset) &&\n\t\t\t\t\t\tservice->attributes[i])\n\t\ti++;\n\n\treturn i == (service->num_handles - end_offset) ? 0 : i;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic uint16_t get_attribute_index(struct gatt_db_service *service,\n\t\t\t\t\t\t\tint end_offset)\n{\n\tint i = 0;\n\n\t/* Here we look for first free attribute index with given offset */\n\twhile (i < (service->num_handles - end_offset) &&\n\t\t\t\t\t\tservice->attributes[i])\n\t\ti++;\n\n\treturn i == (service->num_handles - end_offset) ? 0 : i;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic struct gatt_db_attribute *\nservice_insert_descriptor(struct gatt_db_service *service,\n\t\t\t\t\tuint16_t handle,\n\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\tuint32_t permissions,\n\t\t\t\t\tgatt_db_read_t read_func,\n\t\t\t\t\tgatt_db_write_t write_func,\n\t\t\t\t\tvoid *user_data)\n{\n\tint i;\n\n\ti = get_attribute_index(service, 0);\n\tif (!i)\n\t\treturn NULL;\n\n\t/* Check if handle is in within service range */\n\tif (handle && handle <= service->attributes[0]->handle)\n\t\treturn NULL;\n\n\tif (!handle)\n\t\thandle = get_handle_at_index(service, i - 1) + 1;\n\n\tservice->attributes[i] = new_attribute(service, handle, uuid, NULL, 0);\n\tif (!service->attributes[i])\n\t\treturn NULL;\n\n\tset_attribute_data(service->attributes[i], read_func, write_func,\n\t\t\t\t\t\t\tpermissions, user_data);\n\n\treturn service->attributes[i];\n}"
  },
  {
    "function_name": "gatt_db_service_add_characteristic",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "780-796",
    "snippet": "struct gatt_db_attribute *\ngatt_db_service_add_characteristic(struct gatt_db_attribute *attrib,\n\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\tuint32_t permissions,\n\t\t\t\t\tuint8_t properties,\n\t\t\t\t\tgatt_db_read_t read_func,\n\t\t\t\t\tgatt_db_write_t write_func,\n\t\t\t\t\tvoid *user_data)\n{\n\tif (!attrib)\n\t\treturn NULL;\n\n\treturn service_insert_characteristic(attrib->service, 0, uuid,\n\t\t\t\t\t\tpermissions, properties,\n\t\t\t\t\t\tread_func, write_func,\n\t\t\t\t\t\tuser_data);\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "service_insert_characteristic",
          "args": [
            "attrib->service",
            "0",
            "uuid",
            "permissions",
            "properties",
            "read_func",
            "write_func",
            "user_data"
          ],
          "line": 792
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_service_insert_characteristic",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "761-778",
          "snippet": "struct gatt_db_attribute *\ngatt_db_service_insert_characteristic(struct gatt_db_attribute *attrib,\n\t\t\t\t\tuint16_t handle,\n\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\tuint32_t permissions,\n\t\t\t\t\tuint8_t properties,\n\t\t\t\t\tgatt_db_read_t read_func,\n\t\t\t\t\tgatt_db_write_t write_func,\n\t\t\t\t\tvoid *user_data)\n{\n\tif (!attrib || !handle)\n\t\treturn NULL;\n\n\treturn service_insert_characteristic(attrib->service, handle, uuid,\n\t\t\t\t\t\tpermissions, properties,\n\t\t\t\t\t\tread_func, write_func,\n\t\t\t\t\t\tuser_data);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstruct gatt_db_attribute *\ngatt_db_service_insert_characteristic(struct gatt_db_attribute *attrib,\n\t\t\t\t\tuint16_t handle,\n\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\tuint32_t permissions,\n\t\t\t\t\tuint8_t properties,\n\t\t\t\t\tgatt_db_read_t read_func,\n\t\t\t\t\tgatt_db_write_t write_func,\n\t\t\t\t\tvoid *user_data)\n{\n\tif (!attrib || !handle)\n\t\treturn NULL;\n\n\treturn service_insert_characteristic(attrib->service, handle, uuid,\n\t\t\t\t\t\tpermissions, properties,\n\t\t\t\t\t\tread_func, write_func,\n\t\t\t\t\t\tuser_data);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstruct gatt_db_attribute *\ngatt_db_service_add_characteristic(struct gatt_db_attribute *attrib,\n\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\tuint32_t permissions,\n\t\t\t\t\tuint8_t properties,\n\t\t\t\t\tgatt_db_read_t read_func,\n\t\t\t\t\tgatt_db_write_t write_func,\n\t\t\t\t\tvoid *user_data)\n{\n\tif (!attrib)\n\t\treturn NULL;\n\n\treturn service_insert_characteristic(attrib->service, 0, uuid,\n\t\t\t\t\t\tpermissions, properties,\n\t\t\t\t\t\tread_func, write_func,\n\t\t\t\t\t\tuser_data);\n}"
  },
  {
    "function_name": "gatt_db_service_insert_characteristic",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "761-778",
    "snippet": "struct gatt_db_attribute *\ngatt_db_service_insert_characteristic(struct gatt_db_attribute *attrib,\n\t\t\t\t\tuint16_t handle,\n\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\tuint32_t permissions,\n\t\t\t\t\tuint8_t properties,\n\t\t\t\t\tgatt_db_read_t read_func,\n\t\t\t\t\tgatt_db_write_t write_func,\n\t\t\t\t\tvoid *user_data)\n{\n\tif (!attrib || !handle)\n\t\treturn NULL;\n\n\treturn service_insert_characteristic(attrib->service, handle, uuid,\n\t\t\t\t\t\tpermissions, properties,\n\t\t\t\t\t\tread_func, write_func,\n\t\t\t\t\t\tuser_data);\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "service_insert_characteristic",
          "args": [
            "attrib->service",
            "handle",
            "uuid",
            "permissions",
            "properties",
            "read_func",
            "write_func",
            "user_data"
          ],
          "line": 774
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_service_insert_characteristic",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "761-778",
          "snippet": "struct gatt_db_attribute *\ngatt_db_service_insert_characteristic(struct gatt_db_attribute *attrib,\n\t\t\t\t\tuint16_t handle,\n\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\tuint32_t permissions,\n\t\t\t\t\tuint8_t properties,\n\t\t\t\t\tgatt_db_read_t read_func,\n\t\t\t\t\tgatt_db_write_t write_func,\n\t\t\t\t\tvoid *user_data)\n{\n\tif (!attrib || !handle)\n\t\treturn NULL;\n\n\treturn service_insert_characteristic(attrib->service, handle, uuid,\n\t\t\t\t\t\tpermissions, properties,\n\t\t\t\t\t\tread_func, write_func,\n\t\t\t\t\t\tuser_data);\n}",
          "note": "cyclic_reference_detected"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstruct gatt_db_attribute *\ngatt_db_service_insert_characteristic(struct gatt_db_attribute *attrib,\n\t\t\t\t\tuint16_t handle,\n\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\tuint32_t permissions,\n\t\t\t\t\tuint8_t properties,\n\t\t\t\t\tgatt_db_read_t read_func,\n\t\t\t\t\tgatt_db_write_t write_func,\n\t\t\t\t\tvoid *user_data)\n{\n\tif (!attrib || !handle)\n\t\treturn NULL;\n\n\treturn service_insert_characteristic(attrib->service, handle, uuid,\n\t\t\t\t\t\tpermissions, properties,\n\t\t\t\t\t\tread_func, write_func,\n\t\t\t\t\t\tuser_data);\n}"
  },
  {
    "function_name": "gatt_db_insert_characteristic",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "739-759",
    "snippet": "struct gatt_db_attribute *\ngatt_db_insert_characteristic(struct gatt_db *db,\n\t\t\t\t\tuint16_t handle,\n\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\tuint32_t permissions,\n\t\t\t\t\tuint8_t properties,\n\t\t\t\t\tgatt_db_read_t read_func,\n\t\t\t\t\tgatt_db_write_t write_func,\n\t\t\t\t\tvoid *user_data)\n{\n\tstruct gatt_db_attribute *attrib;\n\n\tattrib = gatt_db_get_service(db, handle);\n\tif (!attrib)\n\t\treturn NULL;\n\n\treturn service_insert_characteristic(attrib->service, handle, uuid,\n\t\t\t\t\t\tpermissions, properties,\n\t\t\t\t\t\tread_func, write_func,\n\t\t\t\t\t\tuser_data);\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "service_insert_characteristic",
          "args": [
            "attrib->service",
            "handle",
            "uuid",
            "permissions",
            "properties",
            "read_func",
            "write_func",
            "user_data"
          ],
          "line": 755
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_service_insert_characteristic",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "761-778",
          "snippet": "struct gatt_db_attribute *\ngatt_db_service_insert_characteristic(struct gatt_db_attribute *attrib,\n\t\t\t\t\tuint16_t handle,\n\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\tuint32_t permissions,\n\t\t\t\t\tuint8_t properties,\n\t\t\t\t\tgatt_db_read_t read_func,\n\t\t\t\t\tgatt_db_write_t write_func,\n\t\t\t\t\tvoid *user_data)\n{\n\tif (!attrib || !handle)\n\t\treturn NULL;\n\n\treturn service_insert_characteristic(attrib->service, handle, uuid,\n\t\t\t\t\t\tpermissions, properties,\n\t\t\t\t\t\tread_func, write_func,\n\t\t\t\t\t\tuser_data);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstruct gatt_db_attribute *\ngatt_db_service_insert_characteristic(struct gatt_db_attribute *attrib,\n\t\t\t\t\tuint16_t handle,\n\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\tuint32_t permissions,\n\t\t\t\t\tuint8_t properties,\n\t\t\t\t\tgatt_db_read_t read_func,\n\t\t\t\t\tgatt_db_write_t write_func,\n\t\t\t\t\tvoid *user_data)\n{\n\tif (!attrib || !handle)\n\t\treturn NULL;\n\n\treturn service_insert_characteristic(attrib->service, handle, uuid,\n\t\t\t\t\t\tpermissions, properties,\n\t\t\t\t\t\tread_func, write_func,\n\t\t\t\t\t\tuser_data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_get_service",
          "args": [
            "db",
            "handle"
          ],
          "line": 751
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_get_service_with_uuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1458-1471",
          "snippet": "struct gatt_db_attribute *gatt_db_get_service_with_uuid(struct gatt_db *db,\n\t\t\t\t\t\t\tconst bt_uuid_t *uuid)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!db || !uuid)\n\t\treturn NULL;\n\n\tservice = queue_find(db->services, find_service_with_uuid, uuid);\n\tif (!service)\n\t\treturn NULL;\n\n\treturn service->attributes[0];\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstruct gatt_db_attribute *gatt_db_get_service_with_uuid(struct gatt_db *db,\n\t\t\t\t\t\t\tconst bt_uuid_t *uuid)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!db || !uuid)\n\t\treturn NULL;\n\n\tservice = queue_find(db->services, find_service_with_uuid, uuid);\n\tif (!service)\n\t\treturn NULL;\n\n\treturn service->attributes[0];\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstruct gatt_db_attribute *\ngatt_db_insert_characteristic(struct gatt_db *db,\n\t\t\t\t\tuint16_t handle,\n\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\tuint32_t permissions,\n\t\t\t\t\tuint8_t properties,\n\t\t\t\t\tgatt_db_read_t read_func,\n\t\t\t\t\tgatt_db_write_t write_func,\n\t\t\t\t\tvoid *user_data)\n{\n\tstruct gatt_db_attribute *attrib;\n\n\tattrib = gatt_db_get_service(db, handle);\n\tif (!attrib)\n\t\treturn NULL;\n\n\treturn service_insert_characteristic(attrib->service, handle, uuid,\n\t\t\t\t\t\tpermissions, properties,\n\t\t\t\t\t\tread_func, write_func,\n\t\t\t\t\t\tuser_data);\n}"
  },
  {
    "function_name": "service_insert_characteristic",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "672-737",
    "snippet": "static struct gatt_db_attribute *\nservice_insert_characteristic(struct gatt_db_service *service,\n\t\t\t\t\tuint16_t handle,\n\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\tuint32_t permissions,\n\t\t\t\t\tuint8_t properties,\n\t\t\t\t\tgatt_db_read_t read_func,\n\t\t\t\t\tgatt_db_write_t write_func,\n\t\t\t\t\tvoid *user_data)\n{\n\tuint8_t value[MAX_CHAR_DECL_VALUE_LEN];\n\tuint16_t len = 0;\n\tint i;\n\n\t/* Check if handle is in within service range */\n\tif (handle && handle <= service->attributes[0]->handle)\n\t\treturn NULL;\n\n\t/*\n\t * It is not possible to allocate last handle for a Characteristic\n\t * since it would not have space for its value:\n\t * 3.3.2 Characteristic Value Declaration\n\t * The Characteristic Value declaration contains the value of the\n\t * characteristic. It is the first Attribute after the characteristic\n\t * declaration. All characteristic definitions shall have a\n\t * Characteristic Value declaration.\n\t */\n\tif (handle == UINT16_MAX)\n\t\treturn NULL;\n\n\ti = get_attribute_index(service, 1);\n\tif (!i)\n\t\treturn NULL;\n\n\tif (!handle)\n\t\thandle = get_handle_at_index(service, i - 1) + 2;\n\n\tvalue[0] = properties;\n\tlen += sizeof(properties);\n\n\t/* We set handle of characteristic value, which will be added next */\n\tput_le16(handle, &value[1]);\n\tlen += sizeof(uint16_t);\n\tlen += uuid_to_le(uuid, &value[3]);\n\n\tservice->attributes[i] = new_attribute(service, handle - 1,\n\t\t\t\t\t\t\t&characteristic_uuid,\n\t\t\t\t\t\t\tvalue, len);\n\tif (!service->attributes[i])\n\t\treturn NULL;\n\n\tset_attribute_data(service->attributes[i], NULL, NULL, BT_ATT_PERM_READ, NULL);\n\n\ti++;\n\n\tservice->attributes[i] = new_attribute(service, handle, uuid, NULL, 0);\n\tif (!service->attributes[i]) {\n\t\tfree(service->attributes[i - 1]);\n\t\treturn NULL;\n\t}\n\n\tset_attribute_data(service->attributes[i], read_func, write_func,\n\t\t\t\t\t\t\tpermissions, user_data);\n\n\treturn service->attributes[i];\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define MAX_CHAR_DECL_VALUE_LEN 19"
    ],
    "globals_used": [
      "static const bt_uuid_t characteristic_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_CHARAC_UUID };"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "set_attribute_data",
          "args": [
            "service->attributes[i]",
            "read_func",
            "write_func",
            "permissions",
            "user_data"
          ],
          "line": 733
        },
        "resolved": true,
        "details": {
          "function_name": "set_attribute_data",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "118-128",
          "snippet": "static void set_attribute_data(struct gatt_db_attribute *attribute,\n\t\t\t\t\t\tgatt_db_read_t read_func,\n\t\t\t\t\t\tgatt_db_write_t write_func,\n\t\t\t\t\t\tuint32_t permissions,\n\t\t\t\t\t\tvoid *user_data)\n{\n\tattribute->permissions = permissions;\n\tattribute->read_func = read_func;\n\tattribute->write_func = write_func;\n\tattribute->user_data = user_data;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void set_attribute_data(struct gatt_db_attribute *attribute,\n\t\t\t\t\t\tgatt_db_read_t read_func,\n\t\t\t\t\t\tgatt_db_write_t write_func,\n\t\t\t\t\t\tuint32_t permissions,\n\t\t\t\t\t\tvoid *user_data)\n{\n\tattribute->permissions = permissions;\n\tattribute->read_func = read_func;\n\tattribute->write_func = write_func;\n\tattribute->user_data = user_data;\n}"
        }
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "service->attributes[i - 1]"
          ],
          "line": 729
        },
        "resolved": true,
        "details": {
          "function_name": "pending_write_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "158-163",
          "snippet": "static void pending_write_free(void *data)\n{\n\tstruct pending_write *p = data;\n\n\tpending_write_result(p, -ECANCELED);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void pending_write_free(void *data)\n{\n\tstruct pending_write *p = data;\n\n\tpending_write_result(p, -ECANCELED);\n}"
        }
      },
      {
        "call_info": {
          "callee": "new_attribute",
          "args": [
            "service",
            "handle",
            "uuid",
            "NULL",
            "0"
          ],
          "line": 727
        },
        "resolved": true,
        "details": {
          "function_name": "new_attribute",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "178-208",
          "snippet": "static struct gatt_db_attribute *new_attribute(struct gatt_db_service *service,\n\t\t\t\t\t\t\tuint16_t handle,\n\t\t\t\t\t\t\tconst bt_uuid_t *type,\n\t\t\t\t\t\t\tconst uint8_t *val,\n\t\t\t\t\t\t\tuint16_t len)\n{\n\tstruct gatt_db_attribute *attribute;\n\n\tattribute = new0(struct gatt_db_attribute, 1);\n\n\tattribute->service = service;\n\tattribute->handle = handle;\n\tattribute->uuid = *type;\n\tattribute->value_len = len;\n\tif (len) {\n\t\tattribute->value = malloc0(len);\n\t\tif (!attribute->value)\n\t\t\tgoto failed;\n\n\t\tmemcpy(attribute->value, val, len);\n\t}\n\n\tattribute->pending_reads = queue_new();\n\tattribute->pending_writes = queue_new();\n\n\treturn attribute;\n\nfailed:\n\tattribute_destroy(attribute);\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic struct gatt_db_attribute *new_attribute(struct gatt_db_service *service,\n\t\t\t\t\t\t\tuint16_t handle,\n\t\t\t\t\t\t\tconst bt_uuid_t *type,\n\t\t\t\t\t\t\tconst uint8_t *val,\n\t\t\t\t\t\t\tuint16_t len)\n{\n\tstruct gatt_db_attribute *attribute;\n\n\tattribute = new0(struct gatt_db_attribute, 1);\n\n\tattribute->service = service;\n\tattribute->handle = handle;\n\tattribute->uuid = *type;\n\tattribute->value_len = len;\n\tif (len) {\n\t\tattribute->value = malloc0(len);\n\t\tif (!attribute->value)\n\t\t\tgoto failed;\n\n\t\tmemcpy(attribute->value, val, len);\n\t}\n\n\tattribute->pending_reads = queue_new();\n\tattribute->pending_writes = queue_new();\n\n\treturn attribute;\n\nfailed:\n\tattribute_destroy(attribute);\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "uuid_to_le",
          "args": [
            "uuid",
            "&value[3]"
          ],
          "line": 715
        },
        "resolved": true,
        "details": {
          "function_name": "uuid_to_le",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "335-347",
          "snippet": "static int uuid_to_le(const bt_uuid_t *uuid, uint8_t *dst)\n{\n\tbt_uuid_t uuid128;\n\n\tif (uuid->type == BT_UUID16) {\n\t\tput_le16(uuid->value.u16, dst);\n\t\treturn bt_uuid_len(uuid);\n\t}\n\n\tbt_uuid_to_uuid128(uuid, &uuid128);\n\tbswap_128(&uuid128.value.u128, dst);\n\treturn bt_uuid_len(&uuid128);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic int uuid_to_le(const bt_uuid_t *uuid, uint8_t *dst)\n{\n\tbt_uuid_t uuid128;\n\n\tif (uuid->type == BT_UUID16) {\n\t\tput_le16(uuid->value.u16, dst);\n\t\treturn bt_uuid_len(uuid);\n\t}\n\n\tbt_uuid_to_uuid128(uuid, &uuid128);\n\tbswap_128(&uuid128.value.u128, dst);\n\treturn bt_uuid_len(&uuid128);\n}"
        }
      },
      {
        "call_info": {
          "callee": "put_le16",
          "args": [
            "handle",
            "&value[1]"
          ],
          "line": 713
        },
        "resolved": true,
        "details": {
          "function_name": "put_le16",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/util.h",
          "lines": "159-162",
          "snippet": "static inline void put_le16(uint16_t val, void *dst)\n{\n\tput_unaligned(cpu_to_le16(val), (uint16_t *) dst);\n}",
          "includes": [
            "#include <string.h>",
            "#include <byteswap.h>",
            "#include <alloca.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <byteswap.h>\n#include <alloca.h>\n#include <stdlib.h>\n#include <stdint.h>\n\nstatic inline void put_le16(uint16_t val, void *dst)\n{\n\tput_unaligned(cpu_to_le16(val), (uint16_t *) dst);\n}"
        }
      },
      {
        "call_info": {
          "callee": "get_handle_at_index",
          "args": [
            "service",
            "i - 1"
          ],
          "line": 707
        },
        "resolved": true,
        "details": {
          "function_name": "get_handle_at_index",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "652-656",
          "snippet": "static uint16_t get_handle_at_index(struct gatt_db_service *service,\n\t\t\t\t\t\t\t\tint index)\n{\n\treturn service->attributes[index]->handle;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic uint16_t get_handle_at_index(struct gatt_db_service *service,\n\t\t\t\t\t\t\t\tint index)\n{\n\treturn service->attributes[index]->handle;\n}"
        }
      },
      {
        "call_info": {
          "callee": "get_attribute_index",
          "args": [
            "service",
            "1"
          ],
          "line": 702
        },
        "resolved": true,
        "details": {
          "function_name": "get_attribute_index",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "639-650",
          "snippet": "static uint16_t get_attribute_index(struct gatt_db_service *service,\n\t\t\t\t\t\t\tint end_offset)\n{\n\tint i = 0;\n\n\t/* Here we look for first free attribute index with given offset */\n\twhile (i < (service->num_handles - end_offset) &&\n\t\t\t\t\t\tservice->attributes[i])\n\t\ti++;\n\n\treturn i == (service->num_handles - end_offset) ? 0 : i;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic uint16_t get_attribute_index(struct gatt_db_service *service,\n\t\t\t\t\t\t\tint end_offset)\n{\n\tint i = 0;\n\n\t/* Here we look for first free attribute index with given offset */\n\twhile (i < (service->num_handles - end_offset) &&\n\t\t\t\t\t\tservice->attributes[i])\n\t\ti++;\n\n\treturn i == (service->num_handles - end_offset) ? 0 : i;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\n#define MAX_CHAR_DECL_VALUE_LEN 19\n\nstatic const bt_uuid_t characteristic_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_CHARAC_UUID };\n\nstatic struct gatt_db_attribute *\nservice_insert_characteristic(struct gatt_db_service *service,\n\t\t\t\t\tuint16_t handle,\n\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\tuint32_t permissions,\n\t\t\t\t\tuint8_t properties,\n\t\t\t\t\tgatt_db_read_t read_func,\n\t\t\t\t\tgatt_db_write_t write_func,\n\t\t\t\t\tvoid *user_data)\n{\n\tuint8_t value[MAX_CHAR_DECL_VALUE_LEN];\n\tuint16_t len = 0;\n\tint i;\n\n\t/* Check if handle is in within service range */\n\tif (handle && handle <= service->attributes[0]->handle)\n\t\treturn NULL;\n\n\t/*\n\t * It is not possible to allocate last handle for a Characteristic\n\t * since it would not have space for its value:\n\t * 3.3.2 Characteristic Value Declaration\n\t * The Characteristic Value declaration contains the value of the\n\t * characteristic. It is the first Attribute after the characteristic\n\t * declaration. All characteristic definitions shall have a\n\t * Characteristic Value declaration.\n\t */\n\tif (handle == UINT16_MAX)\n\t\treturn NULL;\n\n\ti = get_attribute_index(service, 1);\n\tif (!i)\n\t\treturn NULL;\n\n\tif (!handle)\n\t\thandle = get_handle_at_index(service, i - 1) + 2;\n\n\tvalue[0] = properties;\n\tlen += sizeof(properties);\n\n\t/* We set handle of characteristic value, which will be added next */\n\tput_le16(handle, &value[1]);\n\tlen += sizeof(uint16_t);\n\tlen += uuid_to_le(uuid, &value[3]);\n\n\tservice->attributes[i] = new_attribute(service, handle - 1,\n\t\t\t\t\t\t\t&characteristic_uuid,\n\t\t\t\t\t\t\tvalue, len);\n\tif (!service->attributes[i])\n\t\treturn NULL;\n\n\tset_attribute_data(service->attributes[i], NULL, NULL, BT_ATT_PERM_READ, NULL);\n\n\ti++;\n\n\tservice->attributes[i] = new_attribute(service, handle, uuid, NULL, 0);\n\tif (!service->attributes[i]) {\n\t\tfree(service->attributes[i - 1]);\n\t\treturn NULL;\n\t}\n\n\tset_attribute_data(service->attributes[i], read_func, write_func,\n\t\t\t\t\t\t\tpermissions, user_data);\n\n\treturn service->attributes[i];\n}"
  },
  {
    "function_name": "attribute_update",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "658-670",
    "snippet": "static struct gatt_db_attribute *\nattribute_update(struct gatt_db_service *service, int index)\n{\n\tuint16_t previous_handle;\n\n\t/* We call this function with index > 0, because index 0 is reserved\n\t * for service declaration, and is set in add_service()\n\t */\n\tprevious_handle = service->attributes[index - 1]->handle;\n\tservice->attributes[index]->handle = previous_handle + 1;\n\n\treturn service->attributes[index];\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic struct gatt_db_attribute *\nattribute_update(struct gatt_db_service *service, int index)\n{\n\tuint16_t previous_handle;\n\n\t/* We call this function with index > 0, because index 0 is reserved\n\t * for service declaration, and is set in add_service()\n\t */\n\tprevious_handle = service->attributes[index - 1]->handle;\n\tservice->attributes[index]->handle = previous_handle + 1;\n\n\treturn service->attributes[index];\n}"
  },
  {
    "function_name": "get_handle_at_index",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "652-656",
    "snippet": "static uint16_t get_handle_at_index(struct gatt_db_service *service,\n\t\t\t\t\t\t\t\tint index)\n{\n\treturn service->attributes[index]->handle;\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic uint16_t get_handle_at_index(struct gatt_db_service *service,\n\t\t\t\t\t\t\t\tint index)\n{\n\treturn service->attributes[index]->handle;\n}"
  },
  {
    "function_name": "get_attribute_index",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "639-650",
    "snippet": "static uint16_t get_attribute_index(struct gatt_db_service *service,\n\t\t\t\t\t\t\tint end_offset)\n{\n\tint i = 0;\n\n\t/* Here we look for first free attribute index with given offset */\n\twhile (i < (service->num_handles - end_offset) &&\n\t\t\t\t\t\tservice->attributes[i])\n\t\ti++;\n\n\treturn i == (service->num_handles - end_offset) ? 0 : i;\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic uint16_t get_attribute_index(struct gatt_db_service *service,\n\t\t\t\t\t\t\tint end_offset)\n{\n\tint i = 0;\n\n\t/* Here we look for first free attribute index with given offset */\n\twhile (i < (service->num_handles - end_offset) &&\n\t\t\t\t\t\tservice->attributes[i])\n\t\ti++;\n\n\treturn i == (service->num_handles - end_offset) ? 0 : i;\n}"
  },
  {
    "function_name": "gatt_db_unregister",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "622-637",
    "snippet": "bool gatt_db_unregister(struct gatt_db *db, unsigned int id)\n{\n\tstruct notify *notify;\n\n\tif (!db || !id)\n\t\treturn false;\n\n\tnotify = queue_find(db->notify_list, match_notify_id, UINT_TO_PTR(id));\n\tif (!notify)\n\t\treturn false;\n\n\tqueue_remove(db->notify_list, notify);\n\tnotify_destroy(notify);\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "notify_destroy",
          "args": [
            "notify"
          ],
          "line": 634
        },
        "resolved": true,
        "details": {
          "function_name": "notify_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "232-240",
          "snippet": "static void notify_destroy(void *data)\n{\n\tstruct notify *notify = data;\n\n\tif (notify->destroy)\n\t\tnotify->destroy(notify->user_data);\n\n\tfree(notify);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void notify_destroy(void *data)\n{\n\tstruct notify *notify = data;\n\n\tif (notify->destroy)\n\t\tnotify->destroy(notify->user_data);\n\n\tfree(notify);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_remove",
          "args": [
            "db->notify_list",
            "notify"
          ],
          "line": 633
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_uuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "526-541",
          "snippet": "static bool queue_remove_uuid(struct queue *queue, bt_uuid_t *uuid)\n{\n\tbt_uuid_t *removed;\n\n\tif (!queue || !uuid)\n\t\treturn false;\n\n\tremoved = queue_remove_if(queue, uuid_match, uuid);\n\n\tif (removed) {\n\t\tfree(removed);\n\t\treturn true;\n\t}\n\n\treturn false;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic bool queue_remove_uuid(struct queue *queue, bt_uuid_t *uuid)\n{\n\tbt_uuid_t *removed;\n\n\tif (!queue || !uuid)\n\t\treturn false;\n\n\tremoved = queue_remove_if(queue, uuid_match, uuid);\n\n\tif (removed) {\n\t\tfree(removed);\n\t\treturn true;\n\t}\n\n\treturn false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_find",
          "args": [
            "db->notify_list",
            "match_notify_id",
            "UINT_TO_PTR(id)"
          ],
          "line": 629
        },
        "resolved": true,
        "details": {
          "function_name": "queue_find",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "231-247",
          "snippet": "void *queue_find(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tconst void *match_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tfor (entry = queue->head; entry; entry = entry->next)\n\t\tif (function(entry->data, match_data))\n\t\t\treturn entry->data;\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid *queue_find(struct queue *queue, queue_match_func_t function,\n\t\t\t\t\t\t\tconst void *match_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn NULL;\n\n\tif (!function)\n\t\tfunction = direct_match;\n\n\tfor (entry = queue->head; entry; entry = entry->next)\n\t\tif (function(entry->data, match_data))\n\t\t\treturn entry->data;\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "UINT_TO_PTR",
          "args": [
            "id"
          ],
          "line": 629
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_unregister(struct gatt_db *db, unsigned int id)\n{\n\tstruct notify *notify;\n\n\tif (!db || !id)\n\t\treturn false;\n\n\tnotify = queue_find(db->notify_list, match_notify_id, UINT_TO_PTR(id));\n\tif (!notify)\n\t\treturn false;\n\n\tqueue_remove(db->notify_list, notify);\n\tnotify_destroy(notify);\n\n\treturn true;\n}"
  },
  {
    "function_name": "gatt_db_register",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "592-620",
    "snippet": "unsigned int gatt_db_register(struct gatt_db *db,\n\t\t\t\t\tgatt_db_attribute_cb_t service_added,\n\t\t\t\t\tgatt_db_attribute_cb_t service_removed,\n\t\t\t\t\tvoid *user_data,\n\t\t\t\t\tgatt_db_destroy_func_t destroy)\n{\n\tstruct notify *notify;\n\n\tif (!db || !(service_added || service_removed))\n\t\treturn 0;\n\n\tnotify = new0(struct notify, 1);\n\tnotify->service_added = service_added;\n\tnotify->service_removed = service_removed;\n\tnotify->destroy = destroy;\n\tnotify->user_data = user_data;\n\n\tif (db->next_notify_id < 1)\n\t\tdb->next_notify_id = 1;\n\n\tnotify->id = db->next_notify_id++;\n\n\tif (!queue_push_tail(db->notify_list, notify)) {\n\t\tfree(notify);\n\t\treturn 0;\n\t}\n\n\treturn notify->id;\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "notify"
          ],
          "line": 615
        },
        "resolved": true,
        "details": {
          "function_name": "pending_write_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "158-163",
          "snippet": "static void pending_write_free(void *data)\n{\n\tstruct pending_write *p = data;\n\n\tpending_write_result(p, -ECANCELED);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void pending_write_free(void *data)\n{\n\tstruct pending_write *p = data;\n\n\tpending_write_result(p, -ECANCELED);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_push_tail",
          "args": [
            "db->notify_list",
            "notify"
          ],
          "line": 614
        },
        "resolved": true,
        "details": {
          "function_name": "queue_push_tail",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "88-108",
          "snippet": "bool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_push_tail(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tif (queue->tail)\n\t\tqueue->tail->next = entry;\n\n\tqueue->tail = entry;\n\n\tif (!queue->head)\n\t\tqueue->head = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "new0",
          "args": [
            "structnotify",
            "1"
          ],
          "line": 603
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nunsigned int gatt_db_register(struct gatt_db *db,\n\t\t\t\t\tgatt_db_attribute_cb_t service_added,\n\t\t\t\t\tgatt_db_attribute_cb_t service_removed,\n\t\t\t\t\tvoid *user_data,\n\t\t\t\t\tgatt_db_destroy_func_t destroy)\n{\n\tstruct notify *notify;\n\n\tif (!db || !(service_added || service_removed))\n\t\treturn 0;\n\n\tnotify = new0(struct notify, 1);\n\tnotify->service_added = service_added;\n\tnotify->service_removed = service_removed;\n\tnotify->destroy = destroy;\n\tnotify->user_data = user_data;\n\n\tif (db->next_notify_id < 1)\n\t\tdb->next_notify_id = 1;\n\n\tnotify->id = db->next_notify_id++;\n\n\tif (!queue_push_tail(db->notify_list, notify)) {\n\t\tfree(notify);\n\t\treturn 0;\n\t}\n\n\treturn notify->id;\n}"
  },
  {
    "function_name": "gatt_db_add_service",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "583-590",
    "snippet": "struct gatt_db_attribute *gatt_db_add_service(struct gatt_db *db,\n\t\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\t\tbool primary,\n\t\t\t\t\t\tuint16_t num_handles)\n{\n\treturn gatt_db_insert_service(db, db->next_handle, uuid, primary,\n\t\t\t\t\t\t\t\tnum_handles);\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "gatt_db_insert_service",
          "args": [
            "db",
            "db->next_handle",
            "uuid",
            "primary",
            "num_handles"
          ],
          "line": 588
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_insert_service",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "518-581",
          "snippet": "struct gatt_db_attribute *gatt_db_insert_service(struct gatt_db *db,\n\t\t\t\t\t\t\tuint16_t handle,\n\t\t\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\t\t\tbool primary,\n\t\t\t\t\t\t\tuint16_t num_handles)\n{\n\tstruct gatt_db_service *service, *after;\n\n\tafter = NULL;\n\n\tif (!db || handle < 1)\n\t\treturn NULL;\n\n\tif (num_handles < 1 || (handle + num_handles - 1) > UINT16_MAX)\n\t\treturn NULL;\n\n\tservice = find_insert_loc(db, handle, handle + num_handles - 1, &after);\n\tif (service) {\n\t\tconst bt_uuid_t *type;\n\t\tbt_uuid_t value;\n\n\t\tif (primary)\n\t\t\ttype = &primary_service_uuid;\n\t\telse\n\t\t\ttype = &secondary_service_uuid;\n\n\t\tgatt_db_attribute_get_service_uuid(service->attributes[0],\n\t\t\t\t\t\t\t\t\t&value);\n\n\t\t/* Check if service match */\n\t\tif (!bt_uuid_cmp(&service->attributes[0]->uuid, type) &&\n\t\t\t\t!bt_uuid_cmp(&value, uuid) &&\n\t\t\t\tservice->num_handles == num_handles &&\n\t\t\t\tservice->attributes[0]->handle == handle)\n\t\t\treturn service->attributes[0];\n\n\t\treturn NULL;\n\t}\n\n\tservice = gatt_db_service_create(uuid, handle, primary, num_handles);\n\n\tif (!service)\n\t\treturn NULL;\n\n\tif (after) {\n\t\tif (!queue_push_after(db->services, after, service))\n\t\t\tgoto fail;\n\t} else if (!queue_push_head(db->services, service)) {\n\t\tgoto fail;\n\t}\n\n\tservice->db = db;\n\tservice->attributes[0]->handle = handle;\n\tservice->num_handles = num_handles;\n\n\t/* Fast-forward next_handle if the new service was added to the end */\n\tdb->next_handle = MAX(handle + num_handles, db->next_handle);\n\n\treturn service->attributes[0];\n\nfail:\n\tgatt_db_service_destroy(service);\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static const bt_uuid_t primary_service_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_PRIM_SVC_UUID };",
            "static const bt_uuid_t secondary_service_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_SND_SVC_UUID };"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic const bt_uuid_t primary_service_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_PRIM_SVC_UUID };\nstatic const bt_uuid_t secondary_service_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_SND_SVC_UUID };\n\nstruct gatt_db_attribute *gatt_db_insert_service(struct gatt_db *db,\n\t\t\t\t\t\t\tuint16_t handle,\n\t\t\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\t\t\tbool primary,\n\t\t\t\t\t\t\tuint16_t num_handles)\n{\n\tstruct gatt_db_service *service, *after;\n\n\tafter = NULL;\n\n\tif (!db || handle < 1)\n\t\treturn NULL;\n\n\tif (num_handles < 1 || (handle + num_handles - 1) > UINT16_MAX)\n\t\treturn NULL;\n\n\tservice = find_insert_loc(db, handle, handle + num_handles - 1, &after);\n\tif (service) {\n\t\tconst bt_uuid_t *type;\n\t\tbt_uuid_t value;\n\n\t\tif (primary)\n\t\t\ttype = &primary_service_uuid;\n\t\telse\n\t\t\ttype = &secondary_service_uuid;\n\n\t\tgatt_db_attribute_get_service_uuid(service->attributes[0],\n\t\t\t\t\t\t\t\t\t&value);\n\n\t\t/* Check if service match */\n\t\tif (!bt_uuid_cmp(&service->attributes[0]->uuid, type) &&\n\t\t\t\t!bt_uuid_cmp(&value, uuid) &&\n\t\t\t\tservice->num_handles == num_handles &&\n\t\t\t\tservice->attributes[0]->handle == handle)\n\t\t\treturn service->attributes[0];\n\n\t\treturn NULL;\n\t}\n\n\tservice = gatt_db_service_create(uuid, handle, primary, num_handles);\n\n\tif (!service)\n\t\treturn NULL;\n\n\tif (after) {\n\t\tif (!queue_push_after(db->services, after, service))\n\t\t\tgoto fail;\n\t} else if (!queue_push_head(db->services, service)) {\n\t\tgoto fail;\n\t}\n\n\tservice->db = db;\n\tservice->attributes[0]->handle = handle;\n\tservice->num_handles = num_handles;\n\n\t/* Fast-forward next_handle if the new service was added to the end */\n\tdb->next_handle = MAX(handle + num_handles, db->next_handle);\n\n\treturn service->attributes[0];\n\nfail:\n\tgatt_db_service_destroy(service);\n\treturn NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstruct gatt_db_attribute *gatt_db_add_service(struct gatt_db *db,\n\t\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\t\tbool primary,\n\t\t\t\t\t\tuint16_t num_handles)\n{\n\treturn gatt_db_insert_service(db, db->next_handle, uuid, primary,\n\t\t\t\t\t\t\t\tnum_handles);\n}"
  },
  {
    "function_name": "gatt_db_insert_service",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "518-581",
    "snippet": "struct gatt_db_attribute *gatt_db_insert_service(struct gatt_db *db,\n\t\t\t\t\t\t\tuint16_t handle,\n\t\t\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\t\t\tbool primary,\n\t\t\t\t\t\t\tuint16_t num_handles)\n{\n\tstruct gatt_db_service *service, *after;\n\n\tafter = NULL;\n\n\tif (!db || handle < 1)\n\t\treturn NULL;\n\n\tif (num_handles < 1 || (handle + num_handles - 1) > UINT16_MAX)\n\t\treturn NULL;\n\n\tservice = find_insert_loc(db, handle, handle + num_handles - 1, &after);\n\tif (service) {\n\t\tconst bt_uuid_t *type;\n\t\tbt_uuid_t value;\n\n\t\tif (primary)\n\t\t\ttype = &primary_service_uuid;\n\t\telse\n\t\t\ttype = &secondary_service_uuid;\n\n\t\tgatt_db_attribute_get_service_uuid(service->attributes[0],\n\t\t\t\t\t\t\t\t\t&value);\n\n\t\t/* Check if service match */\n\t\tif (!bt_uuid_cmp(&service->attributes[0]->uuid, type) &&\n\t\t\t\t!bt_uuid_cmp(&value, uuid) &&\n\t\t\t\tservice->num_handles == num_handles &&\n\t\t\t\tservice->attributes[0]->handle == handle)\n\t\t\treturn service->attributes[0];\n\n\t\treturn NULL;\n\t}\n\n\tservice = gatt_db_service_create(uuid, handle, primary, num_handles);\n\n\tif (!service)\n\t\treturn NULL;\n\n\tif (after) {\n\t\tif (!queue_push_after(db->services, after, service))\n\t\t\tgoto fail;\n\t} else if (!queue_push_head(db->services, service)) {\n\t\tgoto fail;\n\t}\n\n\tservice->db = db;\n\tservice->attributes[0]->handle = handle;\n\tservice->num_handles = num_handles;\n\n\t/* Fast-forward next_handle if the new service was added to the end */\n\tdb->next_handle = MAX(handle + num_handles, db->next_handle);\n\n\treturn service->attributes[0];\n\nfail:\n\tgatt_db_service_destroy(service);\n\treturn NULL;\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static const bt_uuid_t primary_service_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_PRIM_SVC_UUID };",
      "static const bt_uuid_t secondary_service_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_SND_SVC_UUID };"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "gatt_db_service_destroy",
          "args": [
            "service"
          ],
          "line": 579
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_service_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "285-298",
          "snippet": "static void gatt_db_service_destroy(void *data)\n{\n\tstruct gatt_db_service *service = data;\n\tint i;\n\n\tif (service->active)\n\t\tnotify_service_changed(service->db, service, false);\n\n\tfor (i = 0; i < service->num_handles; i++)\n\t\tattribute_destroy(service->attributes[i]);\n\n\tfree(service->attributes);\n\tfree(service);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void gatt_db_service_destroy(void *data)\n{\n\tstruct gatt_db_service *service = data;\n\tint i;\n\n\tif (service->active)\n\t\tnotify_service_changed(service->db, service, false);\n\n\tfor (i = 0; i < service->num_handles; i++)\n\t\tattribute_destroy(service->attributes[i]);\n\n\tfree(service->attributes);\n\tfree(service);\n}"
        }
      },
      {
        "call_info": {
          "callee": "MAX",
          "args": [
            "handle + num_handles",
            "db->next_handle"
          ],
          "line": 574
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "queue_push_head",
          "args": [
            "db->services",
            "service"
          ],
          "line": 565
        },
        "resolved": true,
        "details": {
          "function_name": "queue_push_head",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "110-129",
          "snippet": "bool queue_push_head(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tentry->next = queue->head;\n\n\tqueue->head = entry;\n\n\tif (!queue->tail)\n\t\tqueue->tail = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_push_head(struct queue *queue, void *data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue)\n\t\treturn false;\n\n\tentry = queue_entry_new(data);\n\n\tentry->next = queue->head;\n\n\tqueue->head = entry;\n\n\tif (!queue->tail)\n\t\tqueue->tail = entry;\n\n\tqueue->entries++;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_push_after",
          "args": [
            "db->services",
            "after",
            "service"
          ],
          "line": 563
        },
        "resolved": true,
        "details": {
          "function_name": "queue_push_after",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "131-161",
          "snippet": "bool queue_push_after(struct queue *queue, void *entry, void *data)\n{\n\tstruct queue_entry *qentry, *tmp, *new_entry;\n\n\tqentry = NULL;\n\n\tif (!queue)\n\t\treturn false;\n\n\tfor (tmp = queue->head; tmp; tmp = tmp->next) {\n\t\tif (tmp->data == entry) {\n\t\t\tqentry = tmp;\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tif (!qentry)\n\t\treturn false;\n\n\tnew_entry = queue_entry_new(data);\n\n\tnew_entry->next = qentry->next;\n\n\tif (!qentry->next)\n\t\tqueue->tail = new_entry;\n\n\tqentry->next = new_entry;\n\tqueue->entries++;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_push_after(struct queue *queue, void *entry, void *data)\n{\n\tstruct queue_entry *qentry, *tmp, *new_entry;\n\n\tqentry = NULL;\n\n\tif (!queue)\n\t\treturn false;\n\n\tfor (tmp = queue->head; tmp; tmp = tmp->next) {\n\t\tif (tmp->data == entry) {\n\t\t\tqentry = tmp;\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tif (!qentry)\n\t\treturn false;\n\n\tnew_entry = queue_entry_new(data);\n\n\tnew_entry->next = qentry->next;\n\n\tif (!qentry->next)\n\t\tqueue->tail = new_entry;\n\n\tqentry->next = new_entry;\n\tqueue->entries++;\n\n\treturn true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_service_create",
          "args": [
            "uuid",
            "handle",
            "primary",
            "num_handles"
          ],
          "line": 557
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_service_create",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "372-405",
          "snippet": "static struct gatt_db_service *gatt_db_service_create(const bt_uuid_t *uuid,\n\t\t\t\t\t\t\tuint16_t handle,\n\t\t\t\t\t\t\tbool primary,\n\t\t\t\t\t\t\tuint16_t num_handles)\n{\n\tstruct gatt_db_service *service;\n\tconst bt_uuid_t *type;\n\tuint8_t value[16];\n\tuint16_t len;\n\n\tif (num_handles < 1)\n\t\treturn NULL;\n\n\tservice = new0(struct gatt_db_service, 1);\n\tservice->attributes = new0(struct gatt_db_attribute *, num_handles);\n\n\tif (primary)\n\t\ttype = &primary_service_uuid;\n\telse\n\t\ttype = &secondary_service_uuid;\n\n\tlen = uuid_to_le(uuid, value);\n\n\tservice->attributes[0] = new_attribute(service, handle, type, value,\n\t\t\t\t\t\t\t\t\tlen);\n\tif (!service->attributes[0]) {\n\t\tgatt_db_service_destroy(service);\n\t\treturn NULL;\n\t}\n\n\tset_attribute_data(service->attributes[0], NULL, NULL, BT_ATT_PERM_READ, NULL);\n\n\treturn service;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static const bt_uuid_t primary_service_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_PRIM_SVC_UUID };",
            "static const bt_uuid_t secondary_service_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_SND_SVC_UUID };"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic const bt_uuid_t primary_service_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_PRIM_SVC_UUID };\nstatic const bt_uuid_t secondary_service_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_SND_SVC_UUID };\n\nstatic struct gatt_db_service *gatt_db_service_create(const bt_uuid_t *uuid,\n\t\t\t\t\t\t\tuint16_t handle,\n\t\t\t\t\t\t\tbool primary,\n\t\t\t\t\t\t\tuint16_t num_handles)\n{\n\tstruct gatt_db_service *service;\n\tconst bt_uuid_t *type;\n\tuint8_t value[16];\n\tuint16_t len;\n\n\tif (num_handles < 1)\n\t\treturn NULL;\n\n\tservice = new0(struct gatt_db_service, 1);\n\tservice->attributes = new0(struct gatt_db_attribute *, num_handles);\n\n\tif (primary)\n\t\ttype = &primary_service_uuid;\n\telse\n\t\ttype = &secondary_service_uuid;\n\n\tlen = uuid_to_le(uuid, value);\n\n\tservice->attributes[0] = new_attribute(service, handle, type, value,\n\t\t\t\t\t\t\t\t\tlen);\n\tif (!service->attributes[0]) {\n\t\tgatt_db_service_destroy(service);\n\t\treturn NULL;\n\t}\n\n\tset_attribute_data(service->attributes[0], NULL, NULL, BT_ATT_PERM_READ, NULL);\n\n\treturn service;\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_uuid_cmp",
          "args": [
            "&value",
            "uuid"
          ],
          "line": 549
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_uuid_cmp",
          "args": [
            "&service->attributes[0]->uuid",
            "type"
          ],
          "line": 548
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gatt_db_attribute_get_service_uuid",
          "args": [
            "service->attributes[0]",
            "&value"
          ],
          "line": 544
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_attribute_get_service_uuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "1490-1519",
          "snippet": "bool gatt_db_attribute_get_service_uuid(const struct gatt_db_attribute *attrib,\n\t\t\t\t\t\t\tbt_uuid_t *uuid)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!attrib || !uuid)\n\t\treturn false;\n\n\tservice = attrib->service;\n\n\tif (service->attributes[0]->value_len == sizeof(uint16_t)) {\n\t\tuint16_t value;\n\n\t\tvalue = get_le16(service->attributes[0]->value);\n\t\tbt_uuid16_create(uuid, value);\n\n\t\treturn true;\n\t}\n\n\tif (service->attributes[0]->value_len == sizeof(uint128_t)) {\n\t\tuint128_t value;\n\n\t\tbswap_128(service->attributes[0]->value, &value);\n\t\tbt_uuid128_create(uuid, value);\n\n\t\treturn true;\n\t}\n\n\treturn false;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_attribute_get_service_uuid(const struct gatt_db_attribute *attrib,\n\t\t\t\t\t\t\tbt_uuid_t *uuid)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!attrib || !uuid)\n\t\treturn false;\n\n\tservice = attrib->service;\n\n\tif (service->attributes[0]->value_len == sizeof(uint16_t)) {\n\t\tuint16_t value;\n\n\t\tvalue = get_le16(service->attributes[0]->value);\n\t\tbt_uuid16_create(uuid, value);\n\n\t\treturn true;\n\t}\n\n\tif (service->attributes[0]->value_len == sizeof(uint128_t)) {\n\t\tuint128_t value;\n\n\t\tbswap_128(service->attributes[0]->value, &value);\n\t\tbt_uuid128_create(uuid, value);\n\n\t\treturn true;\n\t}\n\n\treturn false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "find_insert_loc",
          "args": [
            "db",
            "handle",
            "handle + num_handles - 1",
            "&after"
          ],
          "line": 534
        },
        "resolved": true,
        "details": {
          "function_name": "find_insert_loc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "485-516",
          "snippet": "static struct gatt_db_service *find_insert_loc(struct gatt_db *db,\n\t\t\t\t\t\tuint16_t start, uint16_t end,\n\t\t\t\t\t\tstruct gatt_db_service **after)\n{\n\tconst struct queue_entry *services_entry;\n\tstruct gatt_db_service *service;\n\tuint16_t cur_start, cur_end;\n\n\t*after = NULL;\n\n\tservices_entry = queue_get_entries(db->services);\n\n\twhile (services_entry) {\n\t\tservice = services_entry->data;\n\n\t\tgatt_db_service_get_handles(service, &cur_start, &cur_end);\n\n\t\tif (start >= cur_start && start <= cur_end)\n\t\t\treturn service;\n\n\t\tif (end >= cur_start && end <= cur_end)\n\t\t\treturn service;\n\n\t\tif (end < cur_start)\n\t\t\treturn NULL;\n\n\t\t*after = service;\n\t\tservices_entry = services_entry->next;\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic struct gatt_db_service *find_insert_loc(struct gatt_db *db,\n\t\t\t\t\t\tuint16_t start, uint16_t end,\n\t\t\t\t\t\tstruct gatt_db_service **after)\n{\n\tconst struct queue_entry *services_entry;\n\tstruct gatt_db_service *service;\n\tuint16_t cur_start, cur_end;\n\n\t*after = NULL;\n\n\tservices_entry = queue_get_entries(db->services);\n\n\twhile (services_entry) {\n\t\tservice = services_entry->data;\n\n\t\tgatt_db_service_get_handles(service, &cur_start, &cur_end);\n\n\t\tif (start >= cur_start && start <= cur_end)\n\t\t\treturn service;\n\n\t\tif (end >= cur_start && end <= cur_end)\n\t\t\treturn service;\n\n\t\tif (end < cur_start)\n\t\t\treturn NULL;\n\n\t\t*after = service;\n\t\tservices_entry = services_entry->next;\n\t}\n\n\treturn NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic const bt_uuid_t primary_service_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_PRIM_SVC_UUID };\nstatic const bt_uuid_t secondary_service_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_SND_SVC_UUID };\n\nstruct gatt_db_attribute *gatt_db_insert_service(struct gatt_db *db,\n\t\t\t\t\t\t\tuint16_t handle,\n\t\t\t\t\t\t\tconst bt_uuid_t *uuid,\n\t\t\t\t\t\t\tbool primary,\n\t\t\t\t\t\t\tuint16_t num_handles)\n{\n\tstruct gatt_db_service *service, *after;\n\n\tafter = NULL;\n\n\tif (!db || handle < 1)\n\t\treturn NULL;\n\n\tif (num_handles < 1 || (handle + num_handles - 1) > UINT16_MAX)\n\t\treturn NULL;\n\n\tservice = find_insert_loc(db, handle, handle + num_handles - 1, &after);\n\tif (service) {\n\t\tconst bt_uuid_t *type;\n\t\tbt_uuid_t value;\n\n\t\tif (primary)\n\t\t\ttype = &primary_service_uuid;\n\t\telse\n\t\t\ttype = &secondary_service_uuid;\n\n\t\tgatt_db_attribute_get_service_uuid(service->attributes[0],\n\t\t\t\t\t\t\t\t\t&value);\n\n\t\t/* Check if service match */\n\t\tif (!bt_uuid_cmp(&service->attributes[0]->uuid, type) &&\n\t\t\t\t!bt_uuid_cmp(&value, uuid) &&\n\t\t\t\tservice->num_handles == num_handles &&\n\t\t\t\tservice->attributes[0]->handle == handle)\n\t\t\treturn service->attributes[0];\n\n\t\treturn NULL;\n\t}\n\n\tservice = gatt_db_service_create(uuid, handle, primary, num_handles);\n\n\tif (!service)\n\t\treturn NULL;\n\n\tif (after) {\n\t\tif (!queue_push_after(db->services, after, service))\n\t\t\tgoto fail;\n\t} else if (!queue_push_head(db->services, service)) {\n\t\tgoto fail;\n\t}\n\n\tservice->db = db;\n\tservice->attributes[0]->handle = handle;\n\tservice->num_handles = num_handles;\n\n\t/* Fast-forward next_handle if the new service was added to the end */\n\tdb->next_handle = MAX(handle + num_handles, db->next_handle);\n\n\treturn service->attributes[0];\n\nfail:\n\tgatt_db_service_destroy(service);\n\treturn NULL;\n}"
  },
  {
    "function_name": "find_insert_loc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "485-516",
    "snippet": "static struct gatt_db_service *find_insert_loc(struct gatt_db *db,\n\t\t\t\t\t\tuint16_t start, uint16_t end,\n\t\t\t\t\t\tstruct gatt_db_service **after)\n{\n\tconst struct queue_entry *services_entry;\n\tstruct gatt_db_service *service;\n\tuint16_t cur_start, cur_end;\n\n\t*after = NULL;\n\n\tservices_entry = queue_get_entries(db->services);\n\n\twhile (services_entry) {\n\t\tservice = services_entry->data;\n\n\t\tgatt_db_service_get_handles(service, &cur_start, &cur_end);\n\n\t\tif (start >= cur_start && start <= cur_end)\n\t\t\treturn service;\n\n\t\tif (end >= cur_start && end <= cur_end)\n\t\t\treturn service;\n\n\t\tif (end < cur_start)\n\t\t\treturn NULL;\n\n\t\t*after = service;\n\t\tservices_entry = services_entry->next;\n\t}\n\n\treturn NULL;\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "gatt_db_service_get_handles",
          "args": [
            "service",
            "&cur_start",
            "&cur_end"
          ],
          "line": 500
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_service_get_handles",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "430-440",
          "snippet": "static void gatt_db_service_get_handles(const struct gatt_db_service *service,\n\t\t\t\t\t\t\tuint16_t *start_handle,\n\t\t\t\t\t\t\tuint16_t *end_handle)\n{\n\tif (start_handle)\n\t\t*start_handle = service->attributes[0]->handle;\n\n\tif (end_handle)\n\t\t*end_handle = service->attributes[0]->handle +\n\t\t\t\t\t\tservice->num_handles - 1;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void gatt_db_service_get_handles(const struct gatt_db_service *service,\n\t\t\t\t\t\t\tuint16_t *start_handle,\n\t\t\t\t\t\t\tuint16_t *end_handle)\n{\n\tif (start_handle)\n\t\t*start_handle = service->attributes[0]->handle;\n\n\tif (end_handle)\n\t\t*end_handle = service->attributes[0]->handle +\n\t\t\t\t\t\tservice->num_handles - 1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_get_entries",
          "args": [
            "db->services"
          ],
          "line": 495
        },
        "resolved": true,
        "details": {
          "function_name": "queue_get_entries",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "364-370",
          "snippet": "const struct queue_entry *queue_get_entries(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn NULL;\n\n\treturn queue->head;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nconst struct queue_entry *queue_get_entries(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn NULL;\n\n\treturn queue->head;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic struct gatt_db_service *find_insert_loc(struct gatt_db *db,\n\t\t\t\t\t\tuint16_t start, uint16_t end,\n\t\t\t\t\t\tstruct gatt_db_service **after)\n{\n\tconst struct queue_entry *services_entry;\n\tstruct gatt_db_service *service;\n\tuint16_t cur_start, cur_end;\n\n\t*after = NULL;\n\n\tservices_entry = queue_get_entries(db->services);\n\n\twhile (services_entry) {\n\t\tservice = services_entry->data;\n\n\t\tgatt_db_service_get_handles(service, &cur_start, &cur_end);\n\n\t\tif (start >= cur_start && start <= cur_end)\n\t\t\treturn service;\n\n\t\tif (end >= cur_start && end <= cur_end)\n\t\t\treturn service;\n\n\t\tif (end < cur_start)\n\t\t\treturn NULL;\n\n\t\t*after = service;\n\t\tservices_entry = services_entry->next;\n\t}\n\n\treturn NULL;\n}"
  },
  {
    "function_name": "gatt_db_clear_range",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "457-483",
    "snippet": "bool gatt_db_clear_range(struct gatt_db *db, uint16_t start_handle,\n\t\t\t\t\t\t\tuint16_t end_handle)\n{\n\tstruct clear_range range;\n\n\tif (!db || start_handle > end_handle)\n\t\treturn false;\n\n\t/* Check if it is a full clear */\n\tif (start_handle == 1 && end_handle == UINT16_MAX) {\n\t\tqueue_remove_all(db->services, NULL, NULL,\n\t\t\t\t\t\tgatt_db_service_destroy);\n\t\tgoto done;\n\t}\n\n\trange.start = start_handle;\n\trange.end = end_handle;\n\n\tqueue_remove_all(db->services, match_range, &range,\n\t\t\t\t\t\tgatt_db_service_destroy);\n\ndone:\n\tif (gatt_db_isempty(db))\n\t\tdb->next_handle = 0;\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "gatt_db_isempty",
          "args": [
            "db"
          ],
          "line": 479
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_isempty",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "327-333",
          "snippet": "bool gatt_db_isempty(struct gatt_db *db)\n{\n\tif (!db)\n\t\treturn true;\n\n\treturn queue_isempty(db->services);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_isempty(struct gatt_db *db)\n{\n\tif (!db)\n\t\treturn true;\n\n\treturn queue_isempty(db->services);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_remove_all",
          "args": [
            "db->services",
            "match_range",
            "&range",
            "gatt_db_service_destroy"
          ],
          "line": 475
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_all",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "318-362",
          "snippet": "unsigned int queue_remove_all(struct queue *queue, queue_match_func_t function,\n\t\t\t\tvoid *user_data, queue_destroy_func_t destroy)\n{\n\tstruct queue_entry *entry;\n\tunsigned int count = 0;\n\n\tif (!queue)\n\t\treturn 0;\n\n\tentry = queue->head;\n\n\tif (function) {\n\t\twhile (entry) {\n\t\t\tvoid *data;\n\t\t\tunsigned int entries = queue->entries;\n\n\t\t\tdata = queue_remove_if(queue, function, user_data);\n\t\t\tif (entries == queue->entries)\n\t\t\t\tbreak;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(data);\n\n\t\t\tcount++;\n\t\t}\n\t} else {\n\t\tqueue->head = NULL;\n\t\tqueue->tail = NULL;\n\t\tqueue->entries = 0;\n\n\t\twhile (entry) {\n\t\t\tstruct queue_entry *tmp = entry;\n\n\t\t\tentry = entry->next;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(tmp->data);\n\n\t\t\tfree(tmp);\n\t\t\tcount++;\n\t\t}\n\t}\n\n\treturn count;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nunsigned int queue_remove_all(struct queue *queue, queue_match_func_t function,\n\t\t\t\tvoid *user_data, queue_destroy_func_t destroy)\n{\n\tstruct queue_entry *entry;\n\tunsigned int count = 0;\n\n\tif (!queue)\n\t\treturn 0;\n\n\tentry = queue->head;\n\n\tif (function) {\n\t\twhile (entry) {\n\t\t\tvoid *data;\n\t\t\tunsigned int entries = queue->entries;\n\n\t\t\tdata = queue_remove_if(queue, function, user_data);\n\t\t\tif (entries == queue->entries)\n\t\t\t\tbreak;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(data);\n\n\t\t\tcount++;\n\t\t}\n\t} else {\n\t\tqueue->head = NULL;\n\t\tqueue->tail = NULL;\n\t\tqueue->entries = 0;\n\n\t\twhile (entry) {\n\t\t\tstruct queue_entry *tmp = entry;\n\n\t\t\tentry = entry->next;\n\n\t\t\tif (destroy)\n\t\t\t\tdestroy(tmp->data);\n\n\t\t\tfree(tmp);\n\t\t\tcount++;\n\t\t}\n\t}\n\n\treturn count;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_clear_range(struct gatt_db *db, uint16_t start_handle,\n\t\t\t\t\t\t\tuint16_t end_handle)\n{\n\tstruct clear_range range;\n\n\tif (!db || start_handle > end_handle)\n\t\treturn false;\n\n\t/* Check if it is a full clear */\n\tif (start_handle == 1 && end_handle == UINT16_MAX) {\n\t\tqueue_remove_all(db->services, NULL, NULL,\n\t\t\t\t\t\tgatt_db_service_destroy);\n\t\tgoto done;\n\t}\n\n\trange.start = start_handle;\n\trange.end = end_handle;\n\n\tqueue_remove_all(db->services, match_range, &range,\n\t\t\t\t\t\tgatt_db_service_destroy);\n\ndone:\n\tif (gatt_db_isempty(db))\n\t\tdb->next_handle = 0;\n\n\treturn true;\n}"
  },
  {
    "function_name": "match_range",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "446-455",
    "snippet": "static bool match_range(const void *a, const void *b)\n{\n\tconst struct gatt_db_service *service = a;\n\tconst struct clear_range *range = b;\n\tuint16_t svc_start, svc_end;\n\n\tgatt_db_service_get_handles(service, &svc_start, &svc_end);\n\n\treturn svc_start <= range->end && svc_end >= range->start;\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "gatt_db_service_get_handles",
          "args": [
            "service",
            "&svc_start",
            "&svc_end"
          ],
          "line": 452
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_service_get_handles",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "430-440",
          "snippet": "static void gatt_db_service_get_handles(const struct gatt_db_service *service,\n\t\t\t\t\t\t\tuint16_t *start_handle,\n\t\t\t\t\t\t\tuint16_t *end_handle)\n{\n\tif (start_handle)\n\t\t*start_handle = service->attributes[0]->handle;\n\n\tif (end_handle)\n\t\t*end_handle = service->attributes[0]->handle +\n\t\t\t\t\t\tservice->num_handles - 1;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void gatt_db_service_get_handles(const struct gatt_db_service *service,\n\t\t\t\t\t\t\tuint16_t *start_handle,\n\t\t\t\t\t\t\tuint16_t *end_handle)\n{\n\tif (start_handle)\n\t\t*start_handle = service->attributes[0]->handle;\n\n\tif (end_handle)\n\t\t*end_handle = service->attributes[0]->handle +\n\t\t\t\t\t\tservice->num_handles - 1;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic bool match_range(const void *a, const void *b)\n{\n\tconst struct gatt_db_service *service = a;\n\tconst struct clear_range *range = b;\n\tuint16_t svc_start, svc_end;\n\n\tgatt_db_service_get_handles(service, &svc_start, &svc_end);\n\n\treturn svc_start <= range->end && svc_end >= range->start;\n}"
  },
  {
    "function_name": "gatt_db_service_get_handles",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "430-440",
    "snippet": "static void gatt_db_service_get_handles(const struct gatt_db_service *service,\n\t\t\t\t\t\t\tuint16_t *start_handle,\n\t\t\t\t\t\t\tuint16_t *end_handle)\n{\n\tif (start_handle)\n\t\t*start_handle = service->attributes[0]->handle;\n\n\tif (end_handle)\n\t\t*end_handle = service->attributes[0]->handle +\n\t\t\t\t\t\tservice->num_handles - 1;\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void gatt_db_service_get_handles(const struct gatt_db_service *service,\n\t\t\t\t\t\t\tuint16_t *start_handle,\n\t\t\t\t\t\t\tuint16_t *end_handle)\n{\n\tif (start_handle)\n\t\t*start_handle = service->attributes[0]->handle;\n\n\tif (end_handle)\n\t\t*end_handle = service->attributes[0]->handle +\n\t\t\t\t\t\tservice->num_handles - 1;\n}"
  },
  {
    "function_name": "gatt_db_clear",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "425-428",
    "snippet": "bool gatt_db_clear(struct gatt_db *db)\n{\n\treturn gatt_db_clear_range(db, 1, UINT16_MAX);\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "gatt_db_clear_range",
          "args": [
            "db",
            "1",
            "UINT16_MAX"
          ],
          "line": 427
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_clear_range",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "457-483",
          "snippet": "bool gatt_db_clear_range(struct gatt_db *db, uint16_t start_handle,\n\t\t\t\t\t\t\tuint16_t end_handle)\n{\n\tstruct clear_range range;\n\n\tif (!db || start_handle > end_handle)\n\t\treturn false;\n\n\t/* Check if it is a full clear */\n\tif (start_handle == 1 && end_handle == UINT16_MAX) {\n\t\tqueue_remove_all(db->services, NULL, NULL,\n\t\t\t\t\t\tgatt_db_service_destroy);\n\t\tgoto done;\n\t}\n\n\trange.start = start_handle;\n\trange.end = end_handle;\n\n\tqueue_remove_all(db->services, match_range, &range,\n\t\t\t\t\t\tgatt_db_service_destroy);\n\ndone:\n\tif (gatt_db_isempty(db))\n\t\tdb->next_handle = 0;\n\n\treturn true;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_clear_range(struct gatt_db *db, uint16_t start_handle,\n\t\t\t\t\t\t\tuint16_t end_handle)\n{\n\tstruct clear_range range;\n\n\tif (!db || start_handle > end_handle)\n\t\treturn false;\n\n\t/* Check if it is a full clear */\n\tif (start_handle == 1 && end_handle == UINT16_MAX) {\n\t\tqueue_remove_all(db->services, NULL, NULL,\n\t\t\t\t\t\tgatt_db_service_destroy);\n\t\tgoto done;\n\t}\n\n\trange.start = start_handle;\n\trange.end = end_handle;\n\n\tqueue_remove_all(db->services, match_range, &range,\n\t\t\t\t\t\tgatt_db_service_destroy);\n\ndone:\n\tif (gatt_db_isempty(db))\n\t\tdb->next_handle = 0;\n\n\treturn true;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_clear(struct gatt_db *db)\n{\n\treturn gatt_db_clear_range(db, 1, UINT16_MAX);\n}"
  },
  {
    "function_name": "gatt_db_remove_service",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "408-423",
    "snippet": "bool gatt_db_remove_service(struct gatt_db *db,\n\t\t\t\t\tstruct gatt_db_attribute *attrib)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!db || !attrib)\n\t\treturn false;\n\n\tservice = attrib->service;\n\n\tqueue_remove(db->services, service);\n\n\tgatt_db_service_destroy(service);\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "gatt_db_service_destroy",
          "args": [
            "service"
          ],
          "line": 420
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_service_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "285-298",
          "snippet": "static void gatt_db_service_destroy(void *data)\n{\n\tstruct gatt_db_service *service = data;\n\tint i;\n\n\tif (service->active)\n\t\tnotify_service_changed(service->db, service, false);\n\n\tfor (i = 0; i < service->num_handles; i++)\n\t\tattribute_destroy(service->attributes[i]);\n\n\tfree(service->attributes);\n\tfree(service);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void gatt_db_service_destroy(void *data)\n{\n\tstruct gatt_db_service *service = data;\n\tint i;\n\n\tif (service->active)\n\t\tnotify_service_changed(service->db, service, false);\n\n\tfor (i = 0; i < service->num_handles; i++)\n\t\tattribute_destroy(service->attributes[i]);\n\n\tfree(service->attributes);\n\tfree(service);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_remove",
          "args": [
            "db->services",
            "service"
          ],
          "line": 418
        },
        "resolved": true,
        "details": {
          "function_name": "queue_remove_uuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/ad.c",
          "lines": "526-541",
          "snippet": "static bool queue_remove_uuid(struct queue *queue, bt_uuid_t *uuid)\n{\n\tbt_uuid_t *removed;\n\n\tif (!queue || !uuid)\n\t\treturn false;\n\n\tremoved = queue_remove_if(queue, uuid_match, uuid);\n\n\tif (removed) {\n\t\tfree(removed);\n\t\treturn true;\n\t}\n\n\treturn false;\n}",
          "includes": [
            "#include \"src/shared/util.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/eir.h\"",
            "#include \"src/shared/ad.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/util.h\"\n#include \"src/shared/queue.h\"\n#include \"src/eir.h\"\n#include \"src/shared/ad.h\"\n\nstatic bool queue_remove_uuid(struct queue *queue, bt_uuid_t *uuid)\n{\n\tbt_uuid_t *removed;\n\n\tif (!queue || !uuid)\n\t\treturn false;\n\n\tremoved = queue_remove_if(queue, uuid_match, uuid);\n\n\tif (removed) {\n\t\tfree(removed);\n\t\treturn true;\n\t}\n\n\treturn false;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_remove_service(struct gatt_db *db,\n\t\t\t\t\tstruct gatt_db_attribute *attrib)\n{\n\tstruct gatt_db_service *service;\n\n\tif (!db || !attrib)\n\t\treturn false;\n\n\tservice = attrib->service;\n\n\tqueue_remove(db->services, service);\n\n\tgatt_db_service_destroy(service);\n\n\treturn true;\n}"
  },
  {
    "function_name": "gatt_db_service_create",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "372-405",
    "snippet": "static struct gatt_db_service *gatt_db_service_create(const bt_uuid_t *uuid,\n\t\t\t\t\t\t\tuint16_t handle,\n\t\t\t\t\t\t\tbool primary,\n\t\t\t\t\t\t\tuint16_t num_handles)\n{\n\tstruct gatt_db_service *service;\n\tconst bt_uuid_t *type;\n\tuint8_t value[16];\n\tuint16_t len;\n\n\tif (num_handles < 1)\n\t\treturn NULL;\n\n\tservice = new0(struct gatt_db_service, 1);\n\tservice->attributes = new0(struct gatt_db_attribute *, num_handles);\n\n\tif (primary)\n\t\ttype = &primary_service_uuid;\n\telse\n\t\ttype = &secondary_service_uuid;\n\n\tlen = uuid_to_le(uuid, value);\n\n\tservice->attributes[0] = new_attribute(service, handle, type, value,\n\t\t\t\t\t\t\t\t\tlen);\n\tif (!service->attributes[0]) {\n\t\tgatt_db_service_destroy(service);\n\t\treturn NULL;\n\t}\n\n\tset_attribute_data(service->attributes[0], NULL, NULL, BT_ATT_PERM_READ, NULL);\n\n\treturn service;\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static const bt_uuid_t primary_service_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_PRIM_SVC_UUID };",
      "static const bt_uuid_t secondary_service_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_SND_SVC_UUID };"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "set_attribute_data",
          "args": [
            "service->attributes[0]",
            "NULL",
            "NULL",
            "BT_ATT_PERM_READ",
            "NULL"
          ],
          "line": 402
        },
        "resolved": true,
        "details": {
          "function_name": "set_attribute_data",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "118-128",
          "snippet": "static void set_attribute_data(struct gatt_db_attribute *attribute,\n\t\t\t\t\t\tgatt_db_read_t read_func,\n\t\t\t\t\t\tgatt_db_write_t write_func,\n\t\t\t\t\t\tuint32_t permissions,\n\t\t\t\t\t\tvoid *user_data)\n{\n\tattribute->permissions = permissions;\n\tattribute->read_func = read_func;\n\tattribute->write_func = write_func;\n\tattribute->user_data = user_data;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void set_attribute_data(struct gatt_db_attribute *attribute,\n\t\t\t\t\t\tgatt_db_read_t read_func,\n\t\t\t\t\t\tgatt_db_write_t write_func,\n\t\t\t\t\t\tuint32_t permissions,\n\t\t\t\t\t\tvoid *user_data)\n{\n\tattribute->permissions = permissions;\n\tattribute->read_func = read_func;\n\tattribute->write_func = write_func;\n\tattribute->user_data = user_data;\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_service_destroy",
          "args": [
            "service"
          ],
          "line": 398
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_service_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "285-298",
          "snippet": "static void gatt_db_service_destroy(void *data)\n{\n\tstruct gatt_db_service *service = data;\n\tint i;\n\n\tif (service->active)\n\t\tnotify_service_changed(service->db, service, false);\n\n\tfor (i = 0; i < service->num_handles; i++)\n\t\tattribute_destroy(service->attributes[i]);\n\n\tfree(service->attributes);\n\tfree(service);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void gatt_db_service_destroy(void *data)\n{\n\tstruct gatt_db_service *service = data;\n\tint i;\n\n\tif (service->active)\n\t\tnotify_service_changed(service->db, service, false);\n\n\tfor (i = 0; i < service->num_handles; i++)\n\t\tattribute_destroy(service->attributes[i]);\n\n\tfree(service->attributes);\n\tfree(service);\n}"
        }
      },
      {
        "call_info": {
          "callee": "new_attribute",
          "args": [
            "service",
            "handle",
            "type",
            "value",
            "len"
          ],
          "line": 395
        },
        "resolved": true,
        "details": {
          "function_name": "new_attribute",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "178-208",
          "snippet": "static struct gatt_db_attribute *new_attribute(struct gatt_db_service *service,\n\t\t\t\t\t\t\tuint16_t handle,\n\t\t\t\t\t\t\tconst bt_uuid_t *type,\n\t\t\t\t\t\t\tconst uint8_t *val,\n\t\t\t\t\t\t\tuint16_t len)\n{\n\tstruct gatt_db_attribute *attribute;\n\n\tattribute = new0(struct gatt_db_attribute, 1);\n\n\tattribute->service = service;\n\tattribute->handle = handle;\n\tattribute->uuid = *type;\n\tattribute->value_len = len;\n\tif (len) {\n\t\tattribute->value = malloc0(len);\n\t\tif (!attribute->value)\n\t\t\tgoto failed;\n\n\t\tmemcpy(attribute->value, val, len);\n\t}\n\n\tattribute->pending_reads = queue_new();\n\tattribute->pending_writes = queue_new();\n\n\treturn attribute;\n\nfailed:\n\tattribute_destroy(attribute);\n\treturn NULL;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic struct gatt_db_attribute *new_attribute(struct gatt_db_service *service,\n\t\t\t\t\t\t\tuint16_t handle,\n\t\t\t\t\t\t\tconst bt_uuid_t *type,\n\t\t\t\t\t\t\tconst uint8_t *val,\n\t\t\t\t\t\t\tuint16_t len)\n{\n\tstruct gatt_db_attribute *attribute;\n\n\tattribute = new0(struct gatt_db_attribute, 1);\n\n\tattribute->service = service;\n\tattribute->handle = handle;\n\tattribute->uuid = *type;\n\tattribute->value_len = len;\n\tif (len) {\n\t\tattribute->value = malloc0(len);\n\t\tif (!attribute->value)\n\t\t\tgoto failed;\n\n\t\tmemcpy(attribute->value, val, len);\n\t}\n\n\tattribute->pending_reads = queue_new();\n\tattribute->pending_writes = queue_new();\n\n\treturn attribute;\n\nfailed:\n\tattribute_destroy(attribute);\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "uuid_to_le",
          "args": [
            "uuid",
            "value"
          ],
          "line": 393
        },
        "resolved": true,
        "details": {
          "function_name": "uuid_to_le",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "335-347",
          "snippet": "static int uuid_to_le(const bt_uuid_t *uuid, uint8_t *dst)\n{\n\tbt_uuid_t uuid128;\n\n\tif (uuid->type == BT_UUID16) {\n\t\tput_le16(uuid->value.u16, dst);\n\t\treturn bt_uuid_len(uuid);\n\t}\n\n\tbt_uuid_to_uuid128(uuid, &uuid128);\n\tbswap_128(&uuid128.value.u128, dst);\n\treturn bt_uuid_len(&uuid128);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic int uuid_to_le(const bt_uuid_t *uuid, uint8_t *dst)\n{\n\tbt_uuid_t uuid128;\n\n\tif (uuid->type == BT_UUID16) {\n\t\tput_le16(uuid->value.u16, dst);\n\t\treturn bt_uuid_len(uuid);\n\t}\n\n\tbt_uuid_to_uuid128(uuid, &uuid128);\n\tbswap_128(&uuid128.value.u128, dst);\n\treturn bt_uuid_len(&uuid128);\n}"
        }
      },
      {
        "call_info": {
          "callee": "new0",
          "args": [
            "structgatt_db_attribute *, num_handles"
          ],
          "line": 386
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "new0",
          "args": [
            "structgatt_db_service",
            "1"
          ],
          "line": 385
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic const bt_uuid_t primary_service_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_PRIM_SVC_UUID };\nstatic const bt_uuid_t secondary_service_uuid = { .type = BT_UUID16,\n\t\t\t\t\t.value.u16 = GATT_SND_SVC_UUID };\n\nstatic struct gatt_db_service *gatt_db_service_create(const bt_uuid_t *uuid,\n\t\t\t\t\t\t\tuint16_t handle,\n\t\t\t\t\t\t\tbool primary,\n\t\t\t\t\t\t\tuint16_t num_handles)\n{\n\tstruct gatt_db_service *service;\n\tconst bt_uuid_t *type;\n\tuint8_t value[16];\n\tuint16_t len;\n\n\tif (num_handles < 1)\n\t\treturn NULL;\n\n\tservice = new0(struct gatt_db_service, 1);\n\tservice->attributes = new0(struct gatt_db_attribute *, num_handles);\n\n\tif (primary)\n\t\ttype = &primary_service_uuid;\n\telse\n\t\ttype = &secondary_service_uuid;\n\n\tlen = uuid_to_le(uuid, value);\n\n\tservice->attributes[0] = new_attribute(service, handle, type, value,\n\t\t\t\t\t\t\t\t\tlen);\n\tif (!service->attributes[0]) {\n\t\tgatt_db_service_destroy(service);\n\t\treturn NULL;\n\t}\n\n\tset_attribute_data(service->attributes[0], NULL, NULL, BT_ATT_PERM_READ, NULL);\n\n\treturn service;\n}"
  },
  {
    "function_name": "le_to_uuid",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "349-370",
    "snippet": "static bool le_to_uuid(const uint8_t *src, size_t len, bt_uuid_t *uuid)\n{\n\tuint128_t u128;\n\n\tif (len == 2) {\n\t\tbt_uuid16_create(uuid, get_le16(src));\n\t\treturn true;\n\t}\n\n\tif (len == 4) {\n\t\tbt_uuid32_create(uuid, get_le32(src));\n\t\treturn true;\n\t}\n\n\tif (len != 16)\n\t\treturn false;\n\n\tbswap_128(src, &u128);\n\tbt_uuid128_create(uuid, u128);\n\n\treturn true;\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bt_uuid128_create",
          "args": [
            "uuid",
            "u128"
          ],
          "line": 367
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bswap_128",
          "args": [
            "src",
            "&u128"
          ],
          "line": 366
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_uuid32_create",
          "args": [
            "uuid",
            "get_le32(src)"
          ],
          "line": 359
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_le32",
          "args": [
            "src"
          ],
          "line": 359
        },
        "resolved": true,
        "details": {
          "function_name": "get_le32",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/util.h",
          "lines": "139-142",
          "snippet": "static inline uint32_t get_le32(const void *ptr)\n{\n\treturn le32_to_cpu(get_unaligned((const uint32_t *) ptr));\n}",
          "includes": [
            "#include <string.h>",
            "#include <byteswap.h>",
            "#include <alloca.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <byteswap.h>\n#include <alloca.h>\n#include <stdlib.h>\n#include <stdint.h>\n\nstatic inline uint32_t get_le32(const void *ptr)\n{\n\treturn le32_to_cpu(get_unaligned((const uint32_t *) ptr));\n}"
        }
      },
      {
        "call_info": {
          "callee": "bt_uuid16_create",
          "args": [
            "uuid",
            "get_le16(src)"
          ],
          "line": 354
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_le16",
          "args": [
            "src"
          ],
          "line": 354
        },
        "resolved": true,
        "details": {
          "function_name": "get_le16",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/util.h",
          "lines": "129-132",
          "snippet": "static inline uint16_t get_le16(const void *ptr)\n{\n\treturn le16_to_cpu(get_unaligned((const uint16_t *) ptr));\n}",
          "includes": [
            "#include <string.h>",
            "#include <byteswap.h>",
            "#include <alloca.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <byteswap.h>\n#include <alloca.h>\n#include <stdlib.h>\n#include <stdint.h>\n\nstatic inline uint16_t get_le16(const void *ptr)\n{\n\treturn le16_to_cpu(get_unaligned((const uint16_t *) ptr));\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic bool le_to_uuid(const uint8_t *src, size_t len, bt_uuid_t *uuid)\n{\n\tuint128_t u128;\n\n\tif (len == 2) {\n\t\tbt_uuid16_create(uuid, get_le16(src));\n\t\treturn true;\n\t}\n\n\tif (len == 4) {\n\t\tbt_uuid32_create(uuid, get_le32(src));\n\t\treturn true;\n\t}\n\n\tif (len != 16)\n\t\treturn false;\n\n\tbswap_128(src, &u128);\n\tbt_uuid128_create(uuid, u128);\n\n\treturn true;\n}"
  },
  {
    "function_name": "uuid_to_le",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "335-347",
    "snippet": "static int uuid_to_le(const bt_uuid_t *uuid, uint8_t *dst)\n{\n\tbt_uuid_t uuid128;\n\n\tif (uuid->type == BT_UUID16) {\n\t\tput_le16(uuid->value.u16, dst);\n\t\treturn bt_uuid_len(uuid);\n\t}\n\n\tbt_uuid_to_uuid128(uuid, &uuid128);\n\tbswap_128(&uuid128.value.u128, dst);\n\treturn bt_uuid_len(&uuid128);\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bt_uuid_len",
          "args": [
            "&uuid128"
          ],
          "line": 346
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bswap_128",
          "args": [
            "&uuid128.value.u128",
            "dst"
          ],
          "line": 345
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_uuid_to_uuid128",
          "args": [
            "uuid",
            "&uuid128"
          ],
          "line": 344
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bt_uuid_len",
          "args": [
            "uuid"
          ],
          "line": 341
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "put_le16",
          "args": [
            "uuid->value.u16",
            "dst"
          ],
          "line": 340
        },
        "resolved": true,
        "details": {
          "function_name": "put_le16",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/util.h",
          "lines": "159-162",
          "snippet": "static inline void put_le16(uint16_t val, void *dst)\n{\n\tput_unaligned(cpu_to_le16(val), (uint16_t *) dst);\n}",
          "includes": [
            "#include <string.h>",
            "#include <byteswap.h>",
            "#include <alloca.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <byteswap.h>\n#include <alloca.h>\n#include <stdlib.h>\n#include <stdint.h>\n\nstatic inline void put_le16(uint16_t val, void *dst)\n{\n\tput_unaligned(cpu_to_le16(val), (uint16_t *) dst);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic int uuid_to_le(const bt_uuid_t *uuid, uint8_t *dst)\n{\n\tbt_uuid_t uuid128;\n\n\tif (uuid->type == BT_UUID16) {\n\t\tput_le16(uuid->value.u16, dst);\n\t\treturn bt_uuid_len(uuid);\n\t}\n\n\tbt_uuid_to_uuid128(uuid, &uuid128);\n\tbswap_128(&uuid128.value.u128, dst);\n\treturn bt_uuid_len(&uuid128);\n}"
  },
  {
    "function_name": "gatt_db_isempty",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "327-333",
    "snippet": "bool gatt_db_isempty(struct gatt_db *db)\n{\n\tif (!db)\n\t\treturn true;\n\n\treturn queue_isempty(db->services);\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "queue_isempty",
          "args": [
            "db->services"
          ],
          "line": 332
        },
        "resolved": true,
        "details": {
          "function_name": "queue_isempty",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "380-386",
          "snippet": "bool queue_isempty(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn true;\n\n\treturn queue->entries == 0;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_isempty(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn true;\n\n\treturn queue->entries == 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nbool gatt_db_isempty(struct gatt_db *db)\n{\n\tif (!db)\n\t\treturn true;\n\n\treturn queue_isempty(db->services);\n}"
  },
  {
    "function_name": "gatt_db_unref",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "316-325",
    "snippet": "void gatt_db_unref(struct gatt_db *db)\n{\n\tif (!db)\n\t\treturn;\n\n\tif (__sync_sub_and_fetch(&db->ref_count, 1))\n\t\treturn;\n\n\tgatt_db_destroy(db);\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "gatt_db_destroy",
          "args": [
            "db"
          ],
          "line": 324
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "300-314",
          "snippet": "static void gatt_db_destroy(struct gatt_db *db)\n{\n\tif (!db)\n\t\treturn;\n\n\t/*\n\t * Clear the notify list before clearing the services to prevent the\n\t * latter from sending service_removed events.\n\t */\n\tqueue_destroy(db->notify_list, notify_destroy);\n\tdb->notify_list = NULL;\n\n\tqueue_destroy(db->services, gatt_db_service_destroy);\n\tfree(db);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void gatt_db_destroy(struct gatt_db *db)\n{\n\tif (!db)\n\t\treturn;\n\n\t/*\n\t * Clear the notify list before clearing the services to prevent the\n\t * latter from sending service_removed events.\n\t */\n\tqueue_destroy(db->notify_list, notify_destroy);\n\tdb->notify_list = NULL;\n\n\tqueue_destroy(db->services, gatt_db_service_destroy);\n\tfree(db);\n}"
        }
      },
      {
        "call_info": {
          "callee": "__sync_sub_and_fetch",
          "args": [
            "&db->ref_count",
            "1"
          ],
          "line": 321
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nvoid gatt_db_unref(struct gatt_db *db)\n{\n\tif (!db)\n\t\treturn;\n\n\tif (__sync_sub_and_fetch(&db->ref_count, 1))\n\t\treturn;\n\n\tgatt_db_destroy(db);\n}"
  },
  {
    "function_name": "gatt_db_destroy",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "300-314",
    "snippet": "static void gatt_db_destroy(struct gatt_db *db)\n{\n\tif (!db)\n\t\treturn;\n\n\t/*\n\t * Clear the notify list before clearing the services to prevent the\n\t * latter from sending service_removed events.\n\t */\n\tqueue_destroy(db->notify_list, notify_destroy);\n\tdb->notify_list = NULL;\n\n\tqueue_destroy(db->services, gatt_db_service_destroy);\n\tfree(db);\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "db"
          ],
          "line": 313
        },
        "resolved": true,
        "details": {
          "function_name": "pending_write_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "158-163",
          "snippet": "static void pending_write_free(void *data)\n{\n\tstruct pending_write *p = data;\n\n\tpending_write_result(p, -ECANCELED);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void pending_write_free(void *data)\n{\n\tstruct pending_write *p = data;\n\n\tpending_write_result(p, -ECANCELED);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_destroy",
          "args": [
            "db->services",
            "gatt_db_service_destroy"
          ],
          "line": 312
        },
        "resolved": true,
        "details": {
          "function_name": "queue_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "68-76",
          "snippet": "void queue_destroy(struct queue *queue, queue_destroy_func_t destroy)\n{\n\tif (!queue)\n\t\treturn;\n\n\tqueue_remove_all(queue, NULL, NULL, destroy);\n\n\tqueue_unref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid queue_destroy(struct queue *queue, queue_destroy_func_t destroy)\n{\n\tif (!queue)\n\t\treturn;\n\n\tqueue_remove_all(queue, NULL, NULL, destroy);\n\n\tqueue_unref(queue);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void gatt_db_destroy(struct gatt_db *db)\n{\n\tif (!db)\n\t\treturn;\n\n\t/*\n\t * Clear the notify list before clearing the services to prevent the\n\t * latter from sending service_removed events.\n\t */\n\tqueue_destroy(db->notify_list, notify_destroy);\n\tdb->notify_list = NULL;\n\n\tqueue_destroy(db->services, gatt_db_service_destroy);\n\tfree(db);\n}"
  },
  {
    "function_name": "gatt_db_service_destroy",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "285-298",
    "snippet": "static void gatt_db_service_destroy(void *data)\n{\n\tstruct gatt_db_service *service = data;\n\tint i;\n\n\tif (service->active)\n\t\tnotify_service_changed(service->db, service, false);\n\n\tfor (i = 0; i < service->num_handles; i++)\n\t\tattribute_destroy(service->attributes[i]);\n\n\tfree(service->attributes);\n\tfree(service);\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "service"
          ],
          "line": 297
        },
        "resolved": true,
        "details": {
          "function_name": "pending_write_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "158-163",
          "snippet": "static void pending_write_free(void *data)\n{\n\tstruct pending_write *p = data;\n\n\tpending_write_result(p, -ECANCELED);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void pending_write_free(void *data)\n{\n\tstruct pending_write *p = data;\n\n\tpending_write_result(p, -ECANCELED);\n}"
        }
      },
      {
        "call_info": {
          "callee": "attribute_destroy",
          "args": [
            "service->attributes[i]"
          ],
          "line": 294
        },
        "resolved": true,
        "details": {
          "function_name": "attribute_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "165-176",
          "snippet": "static void attribute_destroy(struct gatt_db_attribute *attribute)\n{\n\t/* Attribute was not initialized by user */\n\tif (!attribute)\n\t\treturn;\n\n\tqueue_destroy(attribute->pending_reads, pending_read_free);\n\tqueue_destroy(attribute->pending_writes, pending_write_free);\n\n\tfree(attribute->value);\n\tfree(attribute);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void attribute_destroy(struct gatt_db_attribute *attribute)\n{\n\t/* Attribute was not initialized by user */\n\tif (!attribute)\n\t\treturn;\n\n\tqueue_destroy(attribute->pending_reads, pending_read_free);\n\tqueue_destroy(attribute->pending_writes, pending_write_free);\n\n\tfree(attribute->value);\n\tfree(attribute);\n}"
        }
      },
      {
        "call_info": {
          "callee": "notify_service_changed",
          "args": [
            "service->db",
            "service",
            "false"
          ],
          "line": 291
        },
        "resolved": true,
        "details": {
          "function_name": "notify_service_changed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "266-283",
          "snippet": "static void notify_service_changed(struct gatt_db *db,\n\t\t\t\t\t\tstruct gatt_db_service *service,\n\t\t\t\t\t\tbool added)\n{\n\tstruct notify_data data;\n\n\tif (queue_isempty(db->notify_list))\n\t\treturn;\n\n\tdata.attr = service->attributes[0];\n\tdata.added = added;\n\n\tgatt_db_ref(db);\n\n\tqueue_foreach(db->notify_list, handle_notify, &data);\n\n\tgatt_db_unref(db);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void notify_service_changed(struct gatt_db *db,\n\t\t\t\t\t\tstruct gatt_db_service *service,\n\t\t\t\t\t\tbool added)\n{\n\tstruct notify_data data;\n\n\tif (queue_isempty(db->notify_list))\n\t\treturn;\n\n\tdata.attr = service->attributes[0];\n\tdata.added = added;\n\n\tgatt_db_ref(db);\n\n\tqueue_foreach(db->notify_list, handle_notify, &data);\n\n\tgatt_db_unref(db);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void gatt_db_service_destroy(void *data)\n{\n\tstruct gatt_db_service *service = data;\n\tint i;\n\n\tif (service->active)\n\t\tnotify_service_changed(service->db, service, false);\n\n\tfor (i = 0; i < service->num_handles; i++)\n\t\tattribute_destroy(service->attributes[i]);\n\n\tfree(service->attributes);\n\tfree(service);\n}"
  },
  {
    "function_name": "notify_service_changed",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "266-283",
    "snippet": "static void notify_service_changed(struct gatt_db *db,\n\t\t\t\t\t\tstruct gatt_db_service *service,\n\t\t\t\t\t\tbool added)\n{\n\tstruct notify_data data;\n\n\tif (queue_isempty(db->notify_list))\n\t\treturn;\n\n\tdata.attr = service->attributes[0];\n\tdata.added = added;\n\n\tgatt_db_ref(db);\n\n\tqueue_foreach(db->notify_list, handle_notify, &data);\n\n\tgatt_db_unref(db);\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "gatt_db_unref",
          "args": [
            "db"
          ],
          "line": 282
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_unref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "316-325",
          "snippet": "void gatt_db_unref(struct gatt_db *db)\n{\n\tif (!db)\n\t\treturn;\n\n\tif (__sync_sub_and_fetch(&db->ref_count, 1))\n\t\treturn;\n\n\tgatt_db_destroy(db);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nvoid gatt_db_unref(struct gatt_db *db)\n{\n\tif (!db)\n\t\treturn;\n\n\tif (__sync_sub_and_fetch(&db->ref_count, 1))\n\t\treturn;\n\n\tgatt_db_destroy(db);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_foreach",
          "args": [
            "db->notify_list",
            "handle_notify",
            "&data"
          ],
          "line": 280
        },
        "resolved": true,
        "details": {
          "function_name": "queue_foreach",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "203-224",
          "snippet": "void queue_foreach(struct queue *queue, queue_foreach_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue || !function)\n\t\treturn;\n\n\tentry = queue->head;\n\tif (!entry)\n\t\treturn;\n\n\tqueue_ref(queue);\n\twhile (entry && queue->head && queue->ref_count > 1) {\n\t\tstruct queue_entry *next;\n\n\t\tnext = entry->next;\n\t\tfunction(entry->data, user_data);\n\t\tentry = next;\n\t}\n\tqueue_unref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid queue_foreach(struct queue *queue, queue_foreach_func_t function,\n\t\t\t\t\t\t\tvoid *user_data)\n{\n\tstruct queue_entry *entry;\n\n\tif (!queue || !function)\n\t\treturn;\n\n\tentry = queue->head;\n\tif (!entry)\n\t\treturn;\n\n\tqueue_ref(queue);\n\twhile (entry && queue->head && queue->ref_count > 1) {\n\t\tstruct queue_entry *next;\n\n\t\tnext = entry->next;\n\t\tfunction(entry->data, user_data);\n\t\tentry = next;\n\t}\n\tqueue_unref(queue);\n}"
        }
      },
      {
        "call_info": {
          "callee": "gatt_db_ref",
          "args": [
            "db"
          ],
          "line": 278
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_ref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "210-218",
          "snippet": "struct gatt_db *gatt_db_ref(struct gatt_db *db)\n{\n\tif (!db)\n\t\treturn NULL;\n\n\t__sync_fetch_and_add(&db->ref_count, 1);\n\n\treturn db;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstruct gatt_db *gatt_db_ref(struct gatt_db *db)\n{\n\tif (!db)\n\t\treturn NULL;\n\n\t__sync_fetch_and_add(&db->ref_count, 1);\n\n\treturn db;\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_isempty",
          "args": [
            "db->notify_list"
          ],
          "line": 272
        },
        "resolved": true,
        "details": {
          "function_name": "queue_isempty",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "380-386",
          "snippet": "bool queue_isempty(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn true;\n\n\treturn queue->entries == 0;\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nbool queue_isempty(struct queue *queue)\n{\n\tif (!queue)\n\t\treturn true;\n\n\treturn queue->entries == 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void notify_service_changed(struct gatt_db *db,\n\t\t\t\t\t\tstruct gatt_db_service *service,\n\t\t\t\t\t\tbool added)\n{\n\tstruct notify_data data;\n\n\tif (queue_isempty(db->notify_list))\n\t\treturn;\n\n\tdata.attr = service->attributes[0];\n\tdata.added = added;\n\n\tgatt_db_ref(db);\n\n\tqueue_foreach(db->notify_list, handle_notify, &data);\n\n\tgatt_db_unref(db);\n}"
  },
  {
    "function_name": "handle_notify",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "255-264",
    "snippet": "static void handle_notify(void *data, void *user_data)\n{\n\tstruct notify *notify = data;\n\tstruct notify_data *notify_data = user_data;\n\n\tif (notify_data->added)\n\t\tnotify->service_added(notify_data->attr, notify->user_data);\n\telse\n\t\tnotify->service_removed(notify_data->attr, notify->user_data);\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "notify->service_removed",
          "args": [
            "notify_data->attr",
            "notify->user_data"
          ],
          "line": 263
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "notify->service_added",
          "args": [
            "notify_data->attr",
            "notify->user_data"
          ],
          "line": 261
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void handle_notify(void *data, void *user_data)\n{\n\tstruct notify *notify = data;\n\tstruct notify_data *notify_data = user_data;\n\n\tif (notify_data->added)\n\t\tnotify->service_added(notify_data->attr, notify->user_data);\n\telse\n\t\tnotify->service_removed(notify_data->attr, notify->user_data);\n}"
  },
  {
    "function_name": "match_notify_id",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "242-248",
    "snippet": "static bool match_notify_id(const void *a, const void *b)\n{\n\tconst struct notify *notify = a;\n\tunsigned int id = PTR_TO_UINT(b);\n\n\treturn notify->id == id;\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "PTR_TO_UINT",
          "args": [
            "b"
          ],
          "line": 245
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic bool match_notify_id(const void *a, const void *b)\n{\n\tconst struct notify *notify = a;\n\tunsigned int id = PTR_TO_UINT(b);\n\n\treturn notify->id == id;\n}"
  },
  {
    "function_name": "notify_destroy",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "232-240",
    "snippet": "static void notify_destroy(void *data)\n{\n\tstruct notify *notify = data;\n\n\tif (notify->destroy)\n\t\tnotify->destroy(notify->user_data);\n\n\tfree(notify);\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "notify"
          ],
          "line": 239
        },
        "resolved": true,
        "details": {
          "function_name": "pending_write_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "158-163",
          "snippet": "static void pending_write_free(void *data)\n{\n\tstruct pending_write *p = data;\n\n\tpending_write_result(p, -ECANCELED);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void pending_write_free(void *data)\n{\n\tstruct pending_write *p = data;\n\n\tpending_write_result(p, -ECANCELED);\n}"
        }
      },
      {
        "call_info": {
          "callee": "notify->destroy",
          "args": [
            "notify->user_data"
          ],
          "line": 237
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void notify_destroy(void *data)\n{\n\tstruct notify *notify = data;\n\n\tif (notify->destroy)\n\t\tnotify->destroy(notify->user_data);\n\n\tfree(notify);\n}"
  },
  {
    "function_name": "gatt_db_new",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "220-230",
    "snippet": "struct gatt_db *gatt_db_new(void)\n{\n\tstruct gatt_db *db;\n\n\tdb = new0(struct gatt_db, 1);\n\tdb->services = queue_new();\n\tdb->notify_list = queue_new();\n\tdb->next_handle = 0x0001;\n\n\treturn gatt_db_ref(db);\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "gatt_db_ref",
          "args": [
            "db"
          ],
          "line": 229
        },
        "resolved": true,
        "details": {
          "function_name": "gatt_db_ref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "210-218",
          "snippet": "struct gatt_db *gatt_db_ref(struct gatt_db *db)\n{\n\tif (!db)\n\t\treturn NULL;\n\n\t__sync_fetch_and_add(&db->ref_count, 1);\n\n\treturn db;\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstruct gatt_db *gatt_db_ref(struct gatt_db *db)\n{\n\tif (!db)\n\t\treturn NULL;\n\n\t__sync_fetch_and_add(&db->ref_count, 1);\n\n\treturn db;\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_new",
          "args": [],
          "line": 226
        },
        "resolved": true,
        "details": {
          "function_name": "queue_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "56-66",
          "snippet": "struct queue *queue_new(void)\n{\n\tstruct queue *queue;\n\n\tqueue = new0(struct queue, 1);\n\tqueue->head = NULL;\n\tqueue->tail = NULL;\n\tqueue->entries = 0;\n\n\treturn queue_ref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nstruct queue *queue_new(void)\n{\n\tstruct queue *queue;\n\n\tqueue = new0(struct queue, 1);\n\tqueue->head = NULL;\n\tqueue->tail = NULL;\n\tqueue->entries = 0;\n\n\treturn queue_ref(queue);\n}"
        }
      },
      {
        "call_info": {
          "callee": "new0",
          "args": [
            "structgatt_db",
            "1"
          ],
          "line": 224
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstruct gatt_db *gatt_db_new(void)\n{\n\tstruct gatt_db *db;\n\n\tdb = new0(struct gatt_db, 1);\n\tdb->services = queue_new();\n\tdb->notify_list = queue_new();\n\tdb->next_handle = 0x0001;\n\n\treturn gatt_db_ref(db);\n}"
  },
  {
    "function_name": "gatt_db_ref",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "210-218",
    "snippet": "struct gatt_db *gatt_db_ref(struct gatt_db *db)\n{\n\tif (!db)\n\t\treturn NULL;\n\n\t__sync_fetch_and_add(&db->ref_count, 1);\n\n\treturn db;\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "__sync_fetch_and_add",
          "args": [
            "&db->ref_count",
            "1"
          ],
          "line": 215
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstruct gatt_db *gatt_db_ref(struct gatt_db *db)\n{\n\tif (!db)\n\t\treturn NULL;\n\n\t__sync_fetch_and_add(&db->ref_count, 1);\n\n\treturn db;\n}"
  },
  {
    "function_name": "new_attribute",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "178-208",
    "snippet": "static struct gatt_db_attribute *new_attribute(struct gatt_db_service *service,\n\t\t\t\t\t\t\tuint16_t handle,\n\t\t\t\t\t\t\tconst bt_uuid_t *type,\n\t\t\t\t\t\t\tconst uint8_t *val,\n\t\t\t\t\t\t\tuint16_t len)\n{\n\tstruct gatt_db_attribute *attribute;\n\n\tattribute = new0(struct gatt_db_attribute, 1);\n\n\tattribute->service = service;\n\tattribute->handle = handle;\n\tattribute->uuid = *type;\n\tattribute->value_len = len;\n\tif (len) {\n\t\tattribute->value = malloc0(len);\n\t\tif (!attribute->value)\n\t\t\tgoto failed;\n\n\t\tmemcpy(attribute->value, val, len);\n\t}\n\n\tattribute->pending_reads = queue_new();\n\tattribute->pending_writes = queue_new();\n\n\treturn attribute;\n\nfailed:\n\tattribute_destroy(attribute);\n\treturn NULL;\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "attribute_destroy",
          "args": [
            "attribute"
          ],
          "line": 206
        },
        "resolved": true,
        "details": {
          "function_name": "attribute_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "165-176",
          "snippet": "static void attribute_destroy(struct gatt_db_attribute *attribute)\n{\n\t/* Attribute was not initialized by user */\n\tif (!attribute)\n\t\treturn;\n\n\tqueue_destroy(attribute->pending_reads, pending_read_free);\n\tqueue_destroy(attribute->pending_writes, pending_write_free);\n\n\tfree(attribute->value);\n\tfree(attribute);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void attribute_destroy(struct gatt_db_attribute *attribute)\n{\n\t/* Attribute was not initialized by user */\n\tif (!attribute)\n\t\treturn;\n\n\tqueue_destroy(attribute->pending_reads, pending_read_free);\n\tqueue_destroy(attribute->pending_writes, pending_write_free);\n\n\tfree(attribute->value);\n\tfree(attribute);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_new",
          "args": [],
          "line": 201
        },
        "resolved": true,
        "details": {
          "function_name": "queue_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "56-66",
          "snippet": "struct queue *queue_new(void)\n{\n\tstruct queue *queue;\n\n\tqueue = new0(struct queue, 1);\n\tqueue->head = NULL;\n\tqueue->tail = NULL;\n\tqueue->entries = 0;\n\n\treturn queue_ref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nstruct queue *queue_new(void)\n{\n\tstruct queue *queue;\n\n\tqueue = new0(struct queue, 1);\n\tqueue->head = NULL;\n\tqueue->tail = NULL;\n\tqueue->entries = 0;\n\n\treturn queue_ref(queue);\n}"
        }
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "attribute->value",
            "val",
            "len"
          ],
          "line": 197
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "malloc0",
          "args": [
            "len"
          ],
          "line": 193
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "new0",
          "args": [
            "structgatt_db_attribute",
            "1"
          ],
          "line": 186
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic struct gatt_db_attribute *new_attribute(struct gatt_db_service *service,\n\t\t\t\t\t\t\tuint16_t handle,\n\t\t\t\t\t\t\tconst bt_uuid_t *type,\n\t\t\t\t\t\t\tconst uint8_t *val,\n\t\t\t\t\t\t\tuint16_t len)\n{\n\tstruct gatt_db_attribute *attribute;\n\n\tattribute = new0(struct gatt_db_attribute, 1);\n\n\tattribute->service = service;\n\tattribute->handle = handle;\n\tattribute->uuid = *type;\n\tattribute->value_len = len;\n\tif (len) {\n\t\tattribute->value = malloc0(len);\n\t\tif (!attribute->value)\n\t\t\tgoto failed;\n\n\t\tmemcpy(attribute->value, val, len);\n\t}\n\n\tattribute->pending_reads = queue_new();\n\tattribute->pending_writes = queue_new();\n\n\treturn attribute;\n\nfailed:\n\tattribute_destroy(attribute);\n\treturn NULL;\n}"
  },
  {
    "function_name": "attribute_destroy",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "165-176",
    "snippet": "static void attribute_destroy(struct gatt_db_attribute *attribute)\n{\n\t/* Attribute was not initialized by user */\n\tif (!attribute)\n\t\treturn;\n\n\tqueue_destroy(attribute->pending_reads, pending_read_free);\n\tqueue_destroy(attribute->pending_writes, pending_write_free);\n\n\tfree(attribute->value);\n\tfree(attribute);\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "attribute"
          ],
          "line": 175
        },
        "resolved": true,
        "details": {
          "function_name": "pending_write_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "158-163",
          "snippet": "static void pending_write_free(void *data)\n{\n\tstruct pending_write *p = data;\n\n\tpending_write_result(p, -ECANCELED);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void pending_write_free(void *data)\n{\n\tstruct pending_write *p = data;\n\n\tpending_write_result(p, -ECANCELED);\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue_destroy",
          "args": [
            "attribute->pending_writes",
            "pending_write_free"
          ],
          "line": 172
        },
        "resolved": true,
        "details": {
          "function_name": "queue_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/queue.c",
          "lines": "68-76",
          "snippet": "void queue_destroy(struct queue *queue, queue_destroy_func_t destroy)\n{\n\tif (!queue)\n\t\treturn;\n\n\tqueue_remove_all(queue, NULL, NULL, destroy);\n\n\tqueue_unref(queue);\n}",
          "includes": [
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include <config.h>\n\nvoid queue_destroy(struct queue *queue, queue_destroy_func_t destroy)\n{\n\tif (!queue)\n\t\treturn;\n\n\tqueue_remove_all(queue, NULL, NULL, destroy);\n\n\tqueue_unref(queue);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void attribute_destroy(struct gatt_db_attribute *attribute)\n{\n\t/* Attribute was not initialized by user */\n\tif (!attribute)\n\t\treturn;\n\n\tqueue_destroy(attribute->pending_reads, pending_read_free);\n\tqueue_destroy(attribute->pending_writes, pending_write_free);\n\n\tfree(attribute->value);\n\tfree(attribute);\n}"
  },
  {
    "function_name": "pending_write_free",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "158-163",
    "snippet": "static void pending_write_free(void *data)\n{\n\tstruct pending_write *p = data;\n\n\tpending_write_result(p, -ECANCELED);\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "pending_write_result",
          "args": [
            "p",
            "-ECANCELED"
          ],
          "line": 162
        },
        "resolved": true,
        "details": {
          "function_name": "pending_write_result",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "148-156",
          "snippet": "static void pending_write_result(struct pending_write *p, int err)\n{\n\tif (p->timeout_id > 0)\n\t\ttimeout_remove(p->timeout_id);\n\n\tp->func(p->attrib, err, p->user_data);\n\n\tfree(p);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void pending_write_result(struct pending_write *p, int err)\n{\n\tif (p->timeout_id > 0)\n\t\ttimeout_remove(p->timeout_id);\n\n\tp->func(p->attrib, err, p->user_data);\n\n\tfree(p);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void pending_write_free(void *data)\n{\n\tstruct pending_write *p = data;\n\n\tpending_write_result(p, -ECANCELED);\n}"
  },
  {
    "function_name": "pending_write_result",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "148-156",
    "snippet": "static void pending_write_result(struct pending_write *p, int err)\n{\n\tif (p->timeout_id > 0)\n\t\ttimeout_remove(p->timeout_id);\n\n\tp->func(p->attrib, err, p->user_data);\n\n\tfree(p);\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "p"
          ],
          "line": 155
        },
        "resolved": true,
        "details": {
          "function_name": "pending_write_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "158-163",
          "snippet": "static void pending_write_free(void *data)\n{\n\tstruct pending_write *p = data;\n\n\tpending_write_result(p, -ECANCELED);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void pending_write_free(void *data)\n{\n\tstruct pending_write *p = data;\n\n\tpending_write_result(p, -ECANCELED);\n}"
        }
      },
      {
        "call_info": {
          "callee": "p->func",
          "args": [
            "p->attrib",
            "err",
            "p->user_data"
          ],
          "line": 153
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "timeout_remove",
          "args": [
            "p->timeout_id"
          ],
          "line": 151
        },
        "resolved": true,
        "details": {
          "function_name": "timeout_remove",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/timeout-mainloop.c",
          "lines": "76-82",
          "snippet": "void timeout_remove(unsigned int id)\n{\n\tif (!id)\n\t\treturn;\n\n\tmainloop_remove_timeout((int) id);\n}",
          "includes": [
            "#include \"timeout.h\"",
            "#include \"util.h\"",
            "#include \"mainloop.h\"",
            "#include <stdlib.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"timeout.h\"\n#include \"util.h\"\n#include \"mainloop.h\"\n#include <stdlib.h>\n\nvoid timeout_remove(unsigned int id)\n{\n\tif (!id)\n\t\treturn;\n\n\tmainloop_remove_timeout((int) id);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void pending_write_result(struct pending_write *p, int err)\n{\n\tif (p->timeout_id > 0)\n\t\ttimeout_remove(p->timeout_id);\n\n\tp->func(p->attrib, err, p->user_data);\n\n\tfree(p);\n}"
  },
  {
    "function_name": "pending_read_free",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "141-146",
    "snippet": "static void pending_read_free(void *data)\n{\n\tstruct pending_read *p = data;\n\n\tpending_read_result(p, -ECANCELED, NULL, 0);\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "pending_read_result",
          "args": [
            "p",
            "-ECANCELED",
            "NULL",
            "0"
          ],
          "line": 145
        },
        "resolved": true,
        "details": {
          "function_name": "pending_read_result",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "130-139",
          "snippet": "static void pending_read_result(struct pending_read *p, int err,\n\t\t\t\t\tconst uint8_t *data, size_t length)\n{\n\tif (p->timeout_id > 0)\n\t\ttimeout_remove(p->timeout_id);\n\n\tp->func(p->attrib, err, data, length, p->user_data);\n\n\tfree(p);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void pending_read_result(struct pending_read *p, int err,\n\t\t\t\t\tconst uint8_t *data, size_t length)\n{\n\tif (p->timeout_id > 0)\n\t\ttimeout_remove(p->timeout_id);\n\n\tp->func(p->attrib, err, data, length, p->user_data);\n\n\tfree(p);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void pending_read_free(void *data)\n{\n\tstruct pending_read *p = data;\n\n\tpending_read_result(p, -ECANCELED, NULL, 0);\n}"
  },
  {
    "function_name": "pending_read_result",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "130-139",
    "snippet": "static void pending_read_result(struct pending_read *p, int err,\n\t\t\t\t\tconst uint8_t *data, size_t length)\n{\n\tif (p->timeout_id > 0)\n\t\ttimeout_remove(p->timeout_id);\n\n\tp->func(p->attrib, err, data, length, p->user_data);\n\n\tfree(p);\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "p"
          ],
          "line": 138
        },
        "resolved": true,
        "details": {
          "function_name": "pending_write_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
          "lines": "158-163",
          "snippet": "static void pending_write_free(void *data)\n{\n\tstruct pending_write *p = data;\n\n\tpending_write_result(p, -ECANCELED);\n}",
          "includes": [
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/timeout.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void pending_write_free(void *data)\n{\n\tstruct pending_write *p = data;\n\n\tpending_write_result(p, -ECANCELED);\n}"
        }
      },
      {
        "call_info": {
          "callee": "p->func",
          "args": [
            "p->attrib",
            "err",
            "data",
            "length",
            "p->user_data"
          ],
          "line": 136
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "timeout_remove",
          "args": [
            "p->timeout_id"
          ],
          "line": 134
        },
        "resolved": true,
        "details": {
          "function_name": "timeout_remove",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/timeout-mainloop.c",
          "lines": "76-82",
          "snippet": "void timeout_remove(unsigned int id)\n{\n\tif (!id)\n\t\treturn;\n\n\tmainloop_remove_timeout((int) id);\n}",
          "includes": [
            "#include \"timeout.h\"",
            "#include \"util.h\"",
            "#include \"mainloop.h\"",
            "#include <stdlib.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"timeout.h\"\n#include \"util.h\"\n#include \"mainloop.h\"\n#include <stdlib.h>\n\nvoid timeout_remove(unsigned int id)\n{\n\tif (!id)\n\t\treturn;\n\n\tmainloop_remove_timeout((int) id);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void pending_read_result(struct pending_read *p, int err,\n\t\t\t\t\tconst uint8_t *data, size_t length)\n{\n\tif (p->timeout_id > 0)\n\t\ttimeout_remove(p->timeout_id);\n\n\tp->func(p->attrib, err, data, length, p->user_data);\n\n\tfree(p);\n}"
  },
  {
    "function_name": "set_attribute_data",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/shared/gatt-db.c",
    "lines": "118-128",
    "snippet": "static void set_attribute_data(struct gatt_db_attribute *attribute,\n\t\t\t\t\t\tgatt_db_read_t read_func,\n\t\t\t\t\t\tgatt_db_write_t write_func,\n\t\t\t\t\t\tuint32_t permissions,\n\t\t\t\t\t\tvoid *user_data)\n{\n\tattribute->permissions = permissions;\n\tattribute->read_func = read_func;\n\tattribute->write_func = write_func;\n\tattribute->user_data = user_data;\n}",
    "includes": [
      "#include \"src/shared/gatt-db.h\"",
      "#include \"src/shared/att.h\"",
      "#include \"src/shared/timeout.h\"",
      "#include \"src/shared/queue.h\"",
      "#include \"src/shared/util.h\"",
      "#include \"lib/uuid.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <errno.h>",
      "#include <stdbool.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"src/shared/gatt-db.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/timeout.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/util.h\"\n#include \"lib/uuid.h\"\n#include \"lib/bluetooth.h\"\n#include <errno.h>\n#include <stdbool.h>\n#include <config.h>\n\nstatic void set_attribute_data(struct gatt_db_attribute *attribute,\n\t\t\t\t\t\tgatt_db_read_t read_func,\n\t\t\t\t\t\tgatt_db_write_t write_func,\n\t\t\t\t\t\tuint32_t permissions,\n\t\t\t\t\t\tvoid *user_data)\n{\n\tattribute->permissions = permissions;\n\tattribute->read_func = read_func;\n\tattribute->write_func = write_func;\n\tattribute->user_data = user_data;\n}"
  }
]