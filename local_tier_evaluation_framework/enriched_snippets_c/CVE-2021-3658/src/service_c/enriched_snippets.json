[
  {
    "function_name": "btd_service_disconnecting_complete",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
    "lines": "385-395",
    "snippet": "void btd_service_disconnecting_complete(struct btd_service *service, int err)\n{\n\tif (service->state != BTD_SERVICE_STATE_CONNECTED &&\n\t\t\tservice->state != BTD_SERVICE_STATE_DISCONNECTING)\n\t\treturn;\n\n\tif (err == 0)\n\t\tchange_state(service, BTD_SERVICE_STATE_DISCONNECTED, 0);\n\telse /* If disconnect fails, we assume it remains connected */\n\t\tchange_state(service, BTD_SERVICE_STATE_CONNECTED, err);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/stat.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "change_state",
          "args": [
            "service",
            "BTD_SERVICE_STATE_CONNECTED",
            "err"
          ],
          "line": 394
        },
        "resolved": true,
        "details": {
          "function_name": "change_state",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
          "lines": "85-111",
          "snippet": "static void change_state(struct btd_service *service, btd_service_state_t state,\n\t\t\t\t\t\t\t\t\tint err)\n{\n\tbtd_service_state_t old = service->state;\n\tchar addr[18];\n\tGSList *l;\n\n\tif (state == old)\n\t\treturn;\n\n\tbtd_assert(service->device != NULL);\n\tbtd_assert(service->profile != NULL);\n\n\tservice->state = state;\n\tservice->err = err;\n\n\tba2str(device_get_address(service->device), addr);\n\tDBG(\"%p: device %s profile %s state changed: %s -> %s (%d)\", service,\n\t\t\t\t\taddr, service->profile->name,\n\t\t\t\t\tstate2str(old), state2str(state), err);\n\n\tfor (l = state_callbacks; l != NULL; l = g_slist_next(l)) {\n\t\tstruct service_state_callback *cb = l->data;\n\n\t\tcb->cb(service, old, state, cb->user_data);\n\t}\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/stat.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static GSList *state_callbacks = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic GSList *state_callbacks = NULL;\n\nstatic void change_state(struct btd_service *service, btd_service_state_t state,\n\t\t\t\t\t\t\t\t\tint err)\n{\n\tbtd_service_state_t old = service->state;\n\tchar addr[18];\n\tGSList *l;\n\n\tif (state == old)\n\t\treturn;\n\n\tbtd_assert(service->device != NULL);\n\tbtd_assert(service->profile != NULL);\n\n\tservice->state = state;\n\tservice->err = err;\n\n\tba2str(device_get_address(service->device), addr);\n\tDBG(\"%p: device %s profile %s state changed: %s -> %s (%d)\", service,\n\t\t\t\t\taddr, service->profile->name,\n\t\t\t\t\tstate2str(old), state2str(state), err);\n\n\tfor (l = state_callbacks; l != NULL; l = g_slist_next(l)) {\n\t\tstruct service_state_callback *cb = l->data;\n\n\t\tcb->cb(service, old, state, cb->user_data);\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid btd_service_disconnecting_complete(struct btd_service *service, int err)\n{\n\tif (service->state != BTD_SERVICE_STATE_CONNECTED &&\n\t\t\tservice->state != BTD_SERVICE_STATE_DISCONNECTING)\n\t\treturn;\n\n\tif (err == 0)\n\t\tchange_state(service, BTD_SERVICE_STATE_DISCONNECTED, 0);\n\telse /* If disconnect fails, we assume it remains connected */\n\t\tchange_state(service, BTD_SERVICE_STATE_CONNECTED, err);\n}"
  },
  {
    "function_name": "btd_service_connecting_complete",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
    "lines": "373-383",
    "snippet": "void btd_service_connecting_complete(struct btd_service *service, int err)\n{\n\tif (service->state != BTD_SERVICE_STATE_DISCONNECTED &&\n\t\t\tservice->state != BTD_SERVICE_STATE_CONNECTING)\n\t\treturn;\n\n\tif (err == 0)\n\t\tchange_state(service, BTD_SERVICE_STATE_CONNECTED, 0);\n\telse\n\t\tchange_state(service, BTD_SERVICE_STATE_DISCONNECTED, err);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/stat.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "change_state",
          "args": [
            "service",
            "BTD_SERVICE_STATE_DISCONNECTED",
            "err"
          ],
          "line": 382
        },
        "resolved": true,
        "details": {
          "function_name": "change_state",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
          "lines": "85-111",
          "snippet": "static void change_state(struct btd_service *service, btd_service_state_t state,\n\t\t\t\t\t\t\t\t\tint err)\n{\n\tbtd_service_state_t old = service->state;\n\tchar addr[18];\n\tGSList *l;\n\n\tif (state == old)\n\t\treturn;\n\n\tbtd_assert(service->device != NULL);\n\tbtd_assert(service->profile != NULL);\n\n\tservice->state = state;\n\tservice->err = err;\n\n\tba2str(device_get_address(service->device), addr);\n\tDBG(\"%p: device %s profile %s state changed: %s -> %s (%d)\", service,\n\t\t\t\t\taddr, service->profile->name,\n\t\t\t\t\tstate2str(old), state2str(state), err);\n\n\tfor (l = state_callbacks; l != NULL; l = g_slist_next(l)) {\n\t\tstruct service_state_callback *cb = l->data;\n\n\t\tcb->cb(service, old, state, cb->user_data);\n\t}\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/stat.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static GSList *state_callbacks = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic GSList *state_callbacks = NULL;\n\nstatic void change_state(struct btd_service *service, btd_service_state_t state,\n\t\t\t\t\t\t\t\t\tint err)\n{\n\tbtd_service_state_t old = service->state;\n\tchar addr[18];\n\tGSList *l;\n\n\tif (state == old)\n\t\treturn;\n\n\tbtd_assert(service->device != NULL);\n\tbtd_assert(service->profile != NULL);\n\n\tservice->state = state;\n\tservice->err = err;\n\n\tba2str(device_get_address(service->device), addr);\n\tDBG(\"%p: device %s profile %s state changed: %s -> %s (%d)\", service,\n\t\t\t\t\taddr, service->profile->name,\n\t\t\t\t\tstate2str(old), state2str(state), err);\n\n\tfor (l = state_callbacks; l != NULL; l = g_slist_next(l)) {\n\t\tstruct service_state_callback *cb = l->data;\n\n\t\tcb->cb(service, old, state, cb->user_data);\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid btd_service_connecting_complete(struct btd_service *service, int err)\n{\n\tif (service->state != BTD_SERVICE_STATE_DISCONNECTED &&\n\t\t\tservice->state != BTD_SERVICE_STATE_CONNECTING)\n\t\treturn;\n\n\tif (err == 0)\n\t\tchange_state(service, BTD_SERVICE_STATE_CONNECTED, 0);\n\telse\n\t\tchange_state(service, BTD_SERVICE_STATE_DISCONNECTED, err);\n}"
  },
  {
    "function_name": "btd_service_remove_state_cb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
    "lines": "356-371",
    "snippet": "bool btd_service_remove_state_cb(unsigned int id)\n{\n\tGSList *l;\n\n\tfor (l = state_callbacks; l != NULL; l = g_slist_next(l)) {\n\t\tstruct service_state_callback *cb = l->data;\n\n\t\tif (cb && cb->id == id) {\n\t\t\tstate_callbacks = g_slist_remove(state_callbacks, cb);\n\t\t\tg_free(cb);\n\t\t\treturn true;\n\t\t}\n\t}\n\n\treturn false;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/stat.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static GSList *state_callbacks = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "cb"
          ],
          "line": 365
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_remove",
          "args": [
            "state_callbacks",
            "cb"
          ],
          "line": 364
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_next",
          "args": [
            "l"
          ],
          "line": 360
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic GSList *state_callbacks = NULL;\n\nbool btd_service_remove_state_cb(unsigned int id)\n{\n\tGSList *l;\n\n\tfor (l = state_callbacks; l != NULL; l = g_slist_next(l)) {\n\t\tstruct service_state_callback *cb = l->data;\n\n\t\tif (cb && cb->id == id) {\n\t\t\tstate_callbacks = g_slist_remove(state_callbacks, cb);\n\t\t\tg_free(cb);\n\t\t\treturn true;\n\t\t}\n\t}\n\n\treturn false;\n}"
  },
  {
    "function_name": "btd_service_add_state_cb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
    "lines": "341-354",
    "snippet": "unsigned int btd_service_add_state_cb(btd_service_state_cb cb, void *user_data)\n{\n\tstruct service_state_callback *state_cb;\n\tstatic unsigned int id = 0;\n\n\tstate_cb = g_new0(struct service_state_callback, 1);\n\tstate_cb->cb = cb;\n\tstate_cb->user_data = user_data;\n\tstate_cb->id = ++id;\n\n\tstate_callbacks = g_slist_append(state_callbacks, state_cb);\n\n\treturn state_cb->id;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/stat.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static GSList *state_callbacks = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_slist_append",
          "args": [
            "state_callbacks",
            "state_cb"
          ],
          "line": 351
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_new0",
          "args": [
            "structservice_state_callback",
            "1"
          ],
          "line": 346
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic GSList *state_callbacks = NULL;\n\nunsigned int btd_service_add_state_cb(btd_service_state_cb cb, void *user_data)\n{\n\tstruct service_state_callback *state_cb;\n\tstatic unsigned int id = 0;\n\n\tstate_cb = g_new0(struct service_state_callback, 1);\n\tstate_cb->cb = cb;\n\tstate_cb->user_data = user_data;\n\tstate_cb->id = ++id;\n\n\tstate_callbacks = g_slist_append(state_callbacks, state_cb);\n\n\treturn state_cb->id;\n}"
  },
  {
    "function_name": "btd_service_get_error",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
    "lines": "336-339",
    "snippet": "int btd_service_get_error(const struct btd_service *service)\n{\n\treturn service->err;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/stat.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nint btd_service_get_error(const struct btd_service *service)\n{\n\treturn service->err;\n}"
  },
  {
    "function_name": "btd_service_get_state",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
    "lines": "331-334",
    "snippet": "btd_service_state_t btd_service_get_state(const struct btd_service *service)\n{\n\treturn service->state;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/stat.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nbtd_service_state_t btd_service_get_state(const struct btd_service *service)\n{\n\treturn service->state;\n}"
  },
  {
    "function_name": "btd_service_get_user_data",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
    "lines": "326-329",
    "snippet": "void *btd_service_get_user_data(const struct btd_service *service)\n{\n\treturn service->user_data;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/stat.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid *btd_service_get_user_data(const struct btd_service *service)\n{\n\treturn service->user_data;\n}"
  },
  {
    "function_name": "btd_service_set_user_data",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
    "lines": "321-324",
    "snippet": "void btd_service_set_user_data(struct btd_service *service, void *user_data)\n{\n\tservice->user_data = user_data;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/stat.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid btd_service_set_user_data(struct btd_service *service, void *user_data)\n{\n\tservice->user_data = user_data;\n}"
  },
  {
    "function_name": "btd_service_get_profile",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
    "lines": "316-319",
    "snippet": "struct btd_profile *btd_service_get_profile(const struct btd_service *service)\n{\n\treturn service->profile;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/stat.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstruct btd_profile *btd_service_get_profile(const struct btd_service *service)\n{\n\treturn service->profile;\n}"
  },
  {
    "function_name": "btd_service_get_device",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
    "lines": "311-314",
    "snippet": "struct btd_device *btd_service_get_device(const struct btd_service *service)\n{\n\treturn service->device;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/stat.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstruct btd_device *btd_service_get_device(const struct btd_service *service)\n{\n\treturn service->device;\n}"
  },
  {
    "function_name": "btd_service_disconnect",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
    "lines": "271-309",
    "snippet": "int btd_service_disconnect(struct btd_service *service)\n{\n\tstruct btd_profile *profile = service->profile;\n\tchar addr[18];\n\tint err;\n\n\tif (!profile->disconnect)\n\t\treturn -ENOTSUP;\n\n\tswitch (service->state) {\n\tcase BTD_SERVICE_STATE_UNAVAILABLE:\n\t\treturn -EINVAL;\n\tcase BTD_SERVICE_STATE_DISCONNECTED:\n\tcase BTD_SERVICE_STATE_DISCONNECTING:\n\t\treturn -EALREADY;\n\tcase BTD_SERVICE_STATE_CONNECTING:\n\tcase BTD_SERVICE_STATE_CONNECTED:\n\t\tbreak;\n\t}\n\n\tchange_state(service, BTD_SERVICE_STATE_DISCONNECTING, 0);\n\n\terr = profile->disconnect(service);\n\tif (err == 0)\n\t\treturn 0;\n\n\tif (err == -ENOTCONN) {\n\t\tbtd_service_disconnecting_complete(service, 0);\n\t\treturn 0;\n\t}\n\n\tba2str(device_get_address(service->device), addr);\n\terror(\"%s profile disconnect failed for %s: %s\", profile->name, addr,\n\t\t\t\t\t\t\t\tstrerror(-err));\n\n\tbtd_service_disconnecting_complete(service, err);\n\n\treturn err;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/stat.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "btd_service_disconnecting_complete",
          "args": [
            "service",
            "err"
          ],
          "line": 306
        },
        "resolved": true,
        "details": {
          "function_name": "btd_service_disconnecting_complete",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
          "lines": "385-395",
          "snippet": "void btd_service_disconnecting_complete(struct btd_service *service, int err)\n{\n\tif (service->state != BTD_SERVICE_STATE_CONNECTED &&\n\t\t\tservice->state != BTD_SERVICE_STATE_DISCONNECTING)\n\t\treturn;\n\n\tif (err == 0)\n\t\tchange_state(service, BTD_SERVICE_STATE_DISCONNECTED, 0);\n\telse /* If disconnect fails, we assume it remains connected */\n\t\tchange_state(service, BTD_SERVICE_STATE_CONNECTED, err);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/stat.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid btd_service_disconnecting_complete(struct btd_service *service, int err)\n{\n\tif (service->state != BTD_SERVICE_STATE_CONNECTED &&\n\t\t\tservice->state != BTD_SERVICE_STATE_DISCONNECTING)\n\t\treturn;\n\n\tif (err == 0)\n\t\tchange_state(service, BTD_SERVICE_STATE_DISCONNECTED, 0);\n\telse /* If disconnect fails, we assume it remains connected */\n\t\tchange_state(service, BTD_SERVICE_STATE_CONNECTED, err);\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"%s profile disconnect failed for %s: %s\"",
            "profile->name",
            "addr",
            "strerror(-err)"
          ],
          "line": 303
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/log.c",
          "lines": "199-213",
          "snippet": "void btd_error(uint16_t index, const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_ERR, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(index, LOG_ERR, format, ap);\n\tva_end(ap);\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdarg.h>",
            "#include <syslog.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int logging_fd = -1;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"src/shared/util.h\"\n#include \"lib/hci.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int logging_fd = -1;\n\nvoid btd_error(uint16_t index, const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_ERR, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(index, LOG_ERR, format, ap);\n\tva_end(ap);\n}"
        }
      },
      {
        "call_info": {
          "callee": "strerror",
          "args": [
            "-err"
          ],
          "line": 304
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ba2str",
          "args": [
            "device_get_address(service->device)",
            "addr"
          ],
          "line": 302
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device_get_address",
          "args": [
            "service->device"
          ],
          "line": 302
        },
        "resolved": true,
        "details": {
          "function_name": "device_get_address",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5314-5317",
          "snippet": "const bdaddr_t *device_get_address(struct btd_device *device)\n{\n\treturn &device->bdaddr;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nconst bdaddr_t *device_get_address(struct btd_device *device)\n{\n\treturn &device->bdaddr;\n}"
        }
      },
      {
        "call_info": {
          "callee": "profile->disconnect",
          "args": [
            "service"
          ],
          "line": 293
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "change_state",
          "args": [
            "service",
            "BTD_SERVICE_STATE_DISCONNECTING",
            "0"
          ],
          "line": 291
        },
        "resolved": true,
        "details": {
          "function_name": "change_state",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
          "lines": "85-111",
          "snippet": "static void change_state(struct btd_service *service, btd_service_state_t state,\n\t\t\t\t\t\t\t\t\tint err)\n{\n\tbtd_service_state_t old = service->state;\n\tchar addr[18];\n\tGSList *l;\n\n\tif (state == old)\n\t\treturn;\n\n\tbtd_assert(service->device != NULL);\n\tbtd_assert(service->profile != NULL);\n\n\tservice->state = state;\n\tservice->err = err;\n\n\tba2str(device_get_address(service->device), addr);\n\tDBG(\"%p: device %s profile %s state changed: %s -> %s (%d)\", service,\n\t\t\t\t\taddr, service->profile->name,\n\t\t\t\t\tstate2str(old), state2str(state), err);\n\n\tfor (l = state_callbacks; l != NULL; l = g_slist_next(l)) {\n\t\tstruct service_state_callback *cb = l->data;\n\n\t\tcb->cb(service, old, state, cb->user_data);\n\t}\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/stat.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static GSList *state_callbacks = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic GSList *state_callbacks = NULL;\n\nstatic void change_state(struct btd_service *service, btd_service_state_t state,\n\t\t\t\t\t\t\t\t\tint err)\n{\n\tbtd_service_state_t old = service->state;\n\tchar addr[18];\n\tGSList *l;\n\n\tif (state == old)\n\t\treturn;\n\n\tbtd_assert(service->device != NULL);\n\tbtd_assert(service->profile != NULL);\n\n\tservice->state = state;\n\tservice->err = err;\n\n\tba2str(device_get_address(service->device), addr);\n\tDBG(\"%p: device %s profile %s state changed: %s -> %s (%d)\", service,\n\t\t\t\t\taddr, service->profile->name,\n\t\t\t\t\tstate2str(old), state2str(state), err);\n\n\tfor (l = state_callbacks; l != NULL; l = g_slist_next(l)) {\n\t\tstruct service_state_callback *cb = l->data;\n\n\t\tcb->cb(service, old, state, cb->user_data);\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nint btd_service_disconnect(struct btd_service *service)\n{\n\tstruct btd_profile *profile = service->profile;\n\tchar addr[18];\n\tint err;\n\n\tif (!profile->disconnect)\n\t\treturn -ENOTSUP;\n\n\tswitch (service->state) {\n\tcase BTD_SERVICE_STATE_UNAVAILABLE:\n\t\treturn -EINVAL;\n\tcase BTD_SERVICE_STATE_DISCONNECTED:\n\tcase BTD_SERVICE_STATE_DISCONNECTING:\n\t\treturn -EALREADY;\n\tcase BTD_SERVICE_STATE_CONNECTING:\n\tcase BTD_SERVICE_STATE_CONNECTED:\n\t\tbreak;\n\t}\n\n\tchange_state(service, BTD_SERVICE_STATE_DISCONNECTING, 0);\n\n\terr = profile->disconnect(service);\n\tif (err == 0)\n\t\treturn 0;\n\n\tif (err == -ENOTCONN) {\n\t\tbtd_service_disconnecting_complete(service, 0);\n\t\treturn 0;\n\t}\n\n\tba2str(device_get_address(service->device), addr);\n\terror(\"%s profile disconnect failed for %s: %s\", profile->name, addr,\n\t\t\t\t\t\t\t\tstrerror(-err));\n\n\tbtd_service_disconnecting_complete(service, err);\n\n\treturn err;\n}"
  },
  {
    "function_name": "btd_service_connect",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
    "lines": "236-269",
    "snippet": "int btd_service_connect(struct btd_service *service)\n{\n\tstruct btd_profile *profile = service->profile;\n\tchar addr[18];\n\tint err;\n\n\tif (!profile->connect)\n\t\treturn -ENOTSUP;\n\n\tswitch (service->state) {\n\tcase BTD_SERVICE_STATE_UNAVAILABLE:\n\t\treturn -EINVAL;\n\tcase BTD_SERVICE_STATE_DISCONNECTED:\n\t\tbreak;\n\tcase BTD_SERVICE_STATE_CONNECTING:\n\t\treturn 0;\n\tcase BTD_SERVICE_STATE_CONNECTED:\n\t\treturn -EALREADY;\n\tcase BTD_SERVICE_STATE_DISCONNECTING:\n\t\treturn -EBUSY;\n\t}\n\n\terr = profile->connect(service);\n\tif (err == 0) {\n\t\tchange_state(service, BTD_SERVICE_STATE_CONNECTING, 0);\n\t\treturn 0;\n\t}\n\n\tba2str(device_get_address(service->device), addr);\n\terror(\"%s profile connect failed for %s: %s\", profile->name, addr,\n\t\t\t\t\t\t\t\tstrerror(-err));\n\n\treturn err;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/stat.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"%s profile connect failed for %s: %s\"",
            "profile->name",
            "addr",
            "strerror(-err)"
          ],
          "line": 265
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/log.c",
          "lines": "199-213",
          "snippet": "void btd_error(uint16_t index, const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_ERR, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(index, LOG_ERR, format, ap);\n\tva_end(ap);\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdarg.h>",
            "#include <syslog.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int logging_fd = -1;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"src/shared/util.h\"\n#include \"lib/hci.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int logging_fd = -1;\n\nvoid btd_error(uint16_t index, const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_ERR, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(index, LOG_ERR, format, ap);\n\tva_end(ap);\n}"
        }
      },
      {
        "call_info": {
          "callee": "strerror",
          "args": [
            "-err"
          ],
          "line": 266
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ba2str",
          "args": [
            "device_get_address(service->device)",
            "addr"
          ],
          "line": 264
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device_get_address",
          "args": [
            "service->device"
          ],
          "line": 264
        },
        "resolved": true,
        "details": {
          "function_name": "device_get_address",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5314-5317",
          "snippet": "const bdaddr_t *device_get_address(struct btd_device *device)\n{\n\treturn &device->bdaddr;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nconst bdaddr_t *device_get_address(struct btd_device *device)\n{\n\treturn &device->bdaddr;\n}"
        }
      },
      {
        "call_info": {
          "callee": "change_state",
          "args": [
            "service",
            "BTD_SERVICE_STATE_CONNECTING",
            "0"
          ],
          "line": 260
        },
        "resolved": true,
        "details": {
          "function_name": "change_state",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
          "lines": "85-111",
          "snippet": "static void change_state(struct btd_service *service, btd_service_state_t state,\n\t\t\t\t\t\t\t\t\tint err)\n{\n\tbtd_service_state_t old = service->state;\n\tchar addr[18];\n\tGSList *l;\n\n\tif (state == old)\n\t\treturn;\n\n\tbtd_assert(service->device != NULL);\n\tbtd_assert(service->profile != NULL);\n\n\tservice->state = state;\n\tservice->err = err;\n\n\tba2str(device_get_address(service->device), addr);\n\tDBG(\"%p: device %s profile %s state changed: %s -> %s (%d)\", service,\n\t\t\t\t\taddr, service->profile->name,\n\t\t\t\t\tstate2str(old), state2str(state), err);\n\n\tfor (l = state_callbacks; l != NULL; l = g_slist_next(l)) {\n\t\tstruct service_state_callback *cb = l->data;\n\n\t\tcb->cb(service, old, state, cb->user_data);\n\t}\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/stat.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static GSList *state_callbacks = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic GSList *state_callbacks = NULL;\n\nstatic void change_state(struct btd_service *service, btd_service_state_t state,\n\t\t\t\t\t\t\t\t\tint err)\n{\n\tbtd_service_state_t old = service->state;\n\tchar addr[18];\n\tGSList *l;\n\n\tif (state == old)\n\t\treturn;\n\n\tbtd_assert(service->device != NULL);\n\tbtd_assert(service->profile != NULL);\n\n\tservice->state = state;\n\tservice->err = err;\n\n\tba2str(device_get_address(service->device), addr);\n\tDBG(\"%p: device %s profile %s state changed: %s -> %s (%d)\", service,\n\t\t\t\t\taddr, service->profile->name,\n\t\t\t\t\tstate2str(old), state2str(state), err);\n\n\tfor (l = state_callbacks; l != NULL; l = g_slist_next(l)) {\n\t\tstruct service_state_callback *cb = l->data;\n\n\t\tcb->cb(service, old, state, cb->user_data);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "profile->connect",
          "args": [
            "service"
          ],
          "line": 258
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nint btd_service_connect(struct btd_service *service)\n{\n\tstruct btd_profile *profile = service->profile;\n\tchar addr[18];\n\tint err;\n\n\tif (!profile->connect)\n\t\treturn -ENOTSUP;\n\n\tswitch (service->state) {\n\tcase BTD_SERVICE_STATE_UNAVAILABLE:\n\t\treturn -EINVAL;\n\tcase BTD_SERVICE_STATE_DISCONNECTED:\n\t\tbreak;\n\tcase BTD_SERVICE_STATE_CONNECTING:\n\t\treturn 0;\n\tcase BTD_SERVICE_STATE_CONNECTED:\n\t\treturn -EALREADY;\n\tcase BTD_SERVICE_STATE_DISCONNECTING:\n\t\treturn -EBUSY;\n\t}\n\n\terr = profile->connect(service);\n\tif (err == 0) {\n\t\tchange_state(service, BTD_SERVICE_STATE_CONNECTING, 0);\n\t\treturn 0;\n\t}\n\n\tba2str(device_get_address(service->device), addr);\n\terror(\"%s profile connect failed for %s: %s\", profile->name, addr,\n\t\t\t\t\t\t\t\tstrerror(-err));\n\n\treturn err;\n}"
  },
  {
    "function_name": "service_set_connecting",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
    "lines": "217-234",
    "snippet": "int service_set_connecting(struct btd_service *service)\n{\n\tswitch (service->state) {\n\tcase BTD_SERVICE_STATE_UNAVAILABLE:\n\t\treturn -EINVAL;\n\tcase BTD_SERVICE_STATE_DISCONNECTED:\n\t\tbreak;\n\tcase BTD_SERVICE_STATE_CONNECTING:\n\tcase BTD_SERVICE_STATE_CONNECTED:\n\t\treturn 0;\n\tcase BTD_SERVICE_STATE_DISCONNECTING:\n\t\treturn -EBUSY;\n\t}\n\n\tchange_state(service, BTD_SERVICE_STATE_CONNECTING, 0);\n\n\treturn 0;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/stat.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "change_state",
          "args": [
            "service",
            "BTD_SERVICE_STATE_CONNECTING",
            "0"
          ],
          "line": 231
        },
        "resolved": true,
        "details": {
          "function_name": "change_state",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
          "lines": "85-111",
          "snippet": "static void change_state(struct btd_service *service, btd_service_state_t state,\n\t\t\t\t\t\t\t\t\tint err)\n{\n\tbtd_service_state_t old = service->state;\n\tchar addr[18];\n\tGSList *l;\n\n\tif (state == old)\n\t\treturn;\n\n\tbtd_assert(service->device != NULL);\n\tbtd_assert(service->profile != NULL);\n\n\tservice->state = state;\n\tservice->err = err;\n\n\tba2str(device_get_address(service->device), addr);\n\tDBG(\"%p: device %s profile %s state changed: %s -> %s (%d)\", service,\n\t\t\t\t\taddr, service->profile->name,\n\t\t\t\t\tstate2str(old), state2str(state), err);\n\n\tfor (l = state_callbacks; l != NULL; l = g_slist_next(l)) {\n\t\tstruct service_state_callback *cb = l->data;\n\n\t\tcb->cb(service, old, state, cb->user_data);\n\t}\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/stat.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static GSList *state_callbacks = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic GSList *state_callbacks = NULL;\n\nstatic void change_state(struct btd_service *service, btd_service_state_t state,\n\t\t\t\t\t\t\t\t\tint err)\n{\n\tbtd_service_state_t old = service->state;\n\tchar addr[18];\n\tGSList *l;\n\n\tif (state == old)\n\t\treturn;\n\n\tbtd_assert(service->device != NULL);\n\tbtd_assert(service->profile != NULL);\n\n\tservice->state = state;\n\tservice->err = err;\n\n\tba2str(device_get_address(service->device), addr);\n\tDBG(\"%p: device %s profile %s state changed: %s -> %s (%d)\", service,\n\t\t\t\t\taddr, service->profile->name,\n\t\t\t\t\tstate2str(old), state2str(state), err);\n\n\tfor (l = state_callbacks; l != NULL; l = g_slist_next(l)) {\n\t\tstruct service_state_callback *cb = l->data;\n\n\t\tcb->cb(service, old, state, cb->user_data);\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nint service_set_connecting(struct btd_service *service)\n{\n\tswitch (service->state) {\n\tcase BTD_SERVICE_STATE_UNAVAILABLE:\n\t\treturn -EINVAL;\n\tcase BTD_SERVICE_STATE_DISCONNECTED:\n\t\tbreak;\n\tcase BTD_SERVICE_STATE_CONNECTING:\n\tcase BTD_SERVICE_STATE_CONNECTED:\n\t\treturn 0;\n\tcase BTD_SERVICE_STATE_DISCONNECTING:\n\t\treturn -EBUSY;\n\t}\n\n\tchange_state(service, BTD_SERVICE_STATE_CONNECTING, 0);\n\n\treturn 0;\n}"
  },
  {
    "function_name": "service_accept",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
    "lines": "182-215",
    "snippet": "int service_accept(struct btd_service *service)\n{\n\tchar addr[18];\n\tint err;\n\n\tswitch (service->state) {\n\tcase BTD_SERVICE_STATE_UNAVAILABLE:\n\t\treturn -EINVAL;\n\tcase BTD_SERVICE_STATE_DISCONNECTED:\n\t\tbreak;\n\tcase BTD_SERVICE_STATE_CONNECTING:\n\tcase BTD_SERVICE_STATE_CONNECTED:\n\t\treturn 0;\n\tcase BTD_SERVICE_STATE_DISCONNECTING:\n\t\treturn -EBUSY;\n\t}\n\n\tif (!service->profile->accept)\n\t\treturn -ENOSYS;\n\n\terr = service->profile->accept(service);\n\tif (!err)\n\t\tgoto done;\n\n\tba2str(device_get_address(service->device), addr);\n\terror(\"%s profile accept failed for %s\", service->profile->name, addr);\n\n\treturn err;\n\ndone:\n\tif (service->state == BTD_SERVICE_STATE_DISCONNECTED)\n\t\tchange_state(service, BTD_SERVICE_STATE_CONNECTING, 0);\n\treturn 0;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/stat.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "change_state",
          "args": [
            "service",
            "BTD_SERVICE_STATE_CONNECTING",
            "0"
          ],
          "line": 213
        },
        "resolved": true,
        "details": {
          "function_name": "change_state",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
          "lines": "85-111",
          "snippet": "static void change_state(struct btd_service *service, btd_service_state_t state,\n\t\t\t\t\t\t\t\t\tint err)\n{\n\tbtd_service_state_t old = service->state;\n\tchar addr[18];\n\tGSList *l;\n\n\tif (state == old)\n\t\treturn;\n\n\tbtd_assert(service->device != NULL);\n\tbtd_assert(service->profile != NULL);\n\n\tservice->state = state;\n\tservice->err = err;\n\n\tba2str(device_get_address(service->device), addr);\n\tDBG(\"%p: device %s profile %s state changed: %s -> %s (%d)\", service,\n\t\t\t\t\taddr, service->profile->name,\n\t\t\t\t\tstate2str(old), state2str(state), err);\n\n\tfor (l = state_callbacks; l != NULL; l = g_slist_next(l)) {\n\t\tstruct service_state_callback *cb = l->data;\n\n\t\tcb->cb(service, old, state, cb->user_data);\n\t}\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/stat.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static GSList *state_callbacks = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic GSList *state_callbacks = NULL;\n\nstatic void change_state(struct btd_service *service, btd_service_state_t state,\n\t\t\t\t\t\t\t\t\tint err)\n{\n\tbtd_service_state_t old = service->state;\n\tchar addr[18];\n\tGSList *l;\n\n\tif (state == old)\n\t\treturn;\n\n\tbtd_assert(service->device != NULL);\n\tbtd_assert(service->profile != NULL);\n\n\tservice->state = state;\n\tservice->err = err;\n\n\tba2str(device_get_address(service->device), addr);\n\tDBG(\"%p: device %s profile %s state changed: %s -> %s (%d)\", service,\n\t\t\t\t\taddr, service->profile->name,\n\t\t\t\t\tstate2str(old), state2str(state), err);\n\n\tfor (l = state_callbacks; l != NULL; l = g_slist_next(l)) {\n\t\tstruct service_state_callback *cb = l->data;\n\n\t\tcb->cb(service, old, state, cb->user_data);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"%s profile accept failed for %s\"",
            "service->profile->name",
            "addr"
          ],
          "line": 207
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/log.c",
          "lines": "199-213",
          "snippet": "void btd_error(uint16_t index, const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_ERR, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(index, LOG_ERR, format, ap);\n\tva_end(ap);\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdarg.h>",
            "#include <syslog.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int logging_fd = -1;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"src/shared/util.h\"\n#include \"lib/hci.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int logging_fd = -1;\n\nvoid btd_error(uint16_t index, const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_ERR, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(index, LOG_ERR, format, ap);\n\tva_end(ap);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ba2str",
          "args": [
            "device_get_address(service->device)",
            "addr"
          ],
          "line": 206
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device_get_address",
          "args": [
            "service->device"
          ],
          "line": 206
        },
        "resolved": true,
        "details": {
          "function_name": "device_get_address",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5314-5317",
          "snippet": "const bdaddr_t *device_get_address(struct btd_device *device)\n{\n\treturn &device->bdaddr;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nconst bdaddr_t *device_get_address(struct btd_device *device)\n{\n\treturn &device->bdaddr;\n}"
        }
      },
      {
        "call_info": {
          "callee": "service->profile->accept",
          "args": [
            "service"
          ],
          "line": 202
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nint service_accept(struct btd_service *service)\n{\n\tchar addr[18];\n\tint err;\n\n\tswitch (service->state) {\n\tcase BTD_SERVICE_STATE_UNAVAILABLE:\n\t\treturn -EINVAL;\n\tcase BTD_SERVICE_STATE_DISCONNECTED:\n\t\tbreak;\n\tcase BTD_SERVICE_STATE_CONNECTING:\n\tcase BTD_SERVICE_STATE_CONNECTED:\n\t\treturn 0;\n\tcase BTD_SERVICE_STATE_DISCONNECTING:\n\t\treturn -EBUSY;\n\t}\n\n\tif (!service->profile->accept)\n\t\treturn -ENOSYS;\n\n\terr = service->profile->accept(service);\n\tif (!err)\n\t\tgoto done;\n\n\tba2str(device_get_address(service->device), addr);\n\terror(\"%s profile accept failed for %s\", service->profile->name, addr);\n\n\treturn err;\n\ndone:\n\tif (service->state == BTD_SERVICE_STATE_DISCONNECTED)\n\t\tchange_state(service, BTD_SERVICE_STATE_CONNECTING, 0);\n\treturn 0;\n}"
  },
  {
    "function_name": "service_remove",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
    "lines": "172-180",
    "snippet": "void service_remove(struct btd_service *service)\n{\n\tchange_state(service, BTD_SERVICE_STATE_DISCONNECTED, -ECONNABORTED);\n\tchange_state(service, BTD_SERVICE_STATE_UNAVAILABLE, 0);\n\tservice->profile->device_remove(service);\n\tservice->device = NULL;\n\tservice->profile = NULL;\n\tbtd_service_unref(service);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/stat.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "btd_service_unref",
          "args": [
            "service"
          ],
          "line": 179
        },
        "resolved": true,
        "details": {
          "function_name": "btd_service_unref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
          "lines": "122-132",
          "snippet": "void btd_service_unref(struct btd_service *service)\n{\n\tservice->ref--;\n\n\tDBG(\"%p: ref=%d\", service, service->ref);\n\n\tif (service->ref > 0)\n\t\treturn;\n\n\tg_free(service);\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/stat.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid btd_service_unref(struct btd_service *service)\n{\n\tservice->ref--;\n\n\tDBG(\"%p: ref=%d\", service, service->ref);\n\n\tif (service->ref > 0)\n\t\treturn;\n\n\tg_free(service);\n}"
        }
      },
      {
        "call_info": {
          "callee": "service->profile->device_remove",
          "args": [
            "service"
          ],
          "line": 176
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "change_state",
          "args": [
            "service",
            "BTD_SERVICE_STATE_UNAVAILABLE",
            "0"
          ],
          "line": 175
        },
        "resolved": true,
        "details": {
          "function_name": "change_state",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
          "lines": "85-111",
          "snippet": "static void change_state(struct btd_service *service, btd_service_state_t state,\n\t\t\t\t\t\t\t\t\tint err)\n{\n\tbtd_service_state_t old = service->state;\n\tchar addr[18];\n\tGSList *l;\n\n\tif (state == old)\n\t\treturn;\n\n\tbtd_assert(service->device != NULL);\n\tbtd_assert(service->profile != NULL);\n\n\tservice->state = state;\n\tservice->err = err;\n\n\tba2str(device_get_address(service->device), addr);\n\tDBG(\"%p: device %s profile %s state changed: %s -> %s (%d)\", service,\n\t\t\t\t\taddr, service->profile->name,\n\t\t\t\t\tstate2str(old), state2str(state), err);\n\n\tfor (l = state_callbacks; l != NULL; l = g_slist_next(l)) {\n\t\tstruct service_state_callback *cb = l->data;\n\n\t\tcb->cb(service, old, state, cb->user_data);\n\t}\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/stat.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static GSList *state_callbacks = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic GSList *state_callbacks = NULL;\n\nstatic void change_state(struct btd_service *service, btd_service_state_t state,\n\t\t\t\t\t\t\t\t\tint err)\n{\n\tbtd_service_state_t old = service->state;\n\tchar addr[18];\n\tGSList *l;\n\n\tif (state == old)\n\t\treturn;\n\n\tbtd_assert(service->device != NULL);\n\tbtd_assert(service->profile != NULL);\n\n\tservice->state = state;\n\tservice->err = err;\n\n\tba2str(device_get_address(service->device), addr);\n\tDBG(\"%p: device %s profile %s state changed: %s -> %s (%d)\", service,\n\t\t\t\t\taddr, service->profile->name,\n\t\t\t\t\tstate2str(old), state2str(state), err);\n\n\tfor (l = state_callbacks; l != NULL; l = g_slist_next(l)) {\n\t\tstruct service_state_callback *cb = l->data;\n\n\t\tcb->cb(service, old, state, cb->user_data);\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid service_remove(struct btd_service *service)\n{\n\tchange_state(service, BTD_SERVICE_STATE_DISCONNECTED, -ECONNABORTED);\n\tchange_state(service, BTD_SERVICE_STATE_UNAVAILABLE, 0);\n\tservice->profile->device_remove(service);\n\tservice->device = NULL;\n\tservice->profile = NULL;\n\tbtd_service_unref(service);\n}"
  },
  {
    "function_name": "service_probe",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
    "lines": "153-170",
    "snippet": "int service_probe(struct btd_service *service)\n{\n\tchar addr[18];\n\tint err;\n\n\tbtd_assert(service->state == BTD_SERVICE_STATE_UNAVAILABLE);\n\n\terr = service->profile->device_probe(service);\n\tif (err == 0) {\n\t\tchange_state(service, BTD_SERVICE_STATE_DISCONNECTED, 0);\n\t\treturn 0;\n\t}\n\n\tba2str(device_get_address(service->device), addr);\n\terror(\"%s profile probe failed for %s\", service->profile->name, addr);\n\n\treturn err;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/stat.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"%s profile probe failed for %s\"",
            "service->profile->name",
            "addr"
          ],
          "line": 167
        },
        "resolved": true,
        "details": {
          "function_name": "btd_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/log.c",
          "lines": "199-213",
          "snippet": "void btd_error(uint16_t index, const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_ERR, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(index, LOG_ERR, format, ap);\n\tva_end(ap);\n}",
          "includes": [
            "#include \"log.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"lib/hci.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <sys/socket.h>",
            "#include <string.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdarg.h>",
            "#include <syslog.h>",
            "#include <errno.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int logging_fd = -1;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"log.h\"\n#include \"src/shared/util.h\"\n#include \"lib/hci.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <sys/socket.h>\n#include <string.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdarg.h>\n#include <syslog.h>\n#include <errno.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int logging_fd = -1;\n\nvoid btd_error(uint16_t index, const char *format, ...)\n{\n\tva_list ap;\n\n\tva_start(ap, format);\n\tvsyslog(LOG_ERR, format, ap);\n\tva_end(ap);\n\n\tif (logging_fd < 0)\n\t\treturn;\n\n\tva_start(ap, format);\n\tlogging_log(index, LOG_ERR, format, ap);\n\tva_end(ap);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ba2str",
          "args": [
            "device_get_address(service->device)",
            "addr"
          ],
          "line": 166
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device_get_address",
          "args": [
            "service->device"
          ],
          "line": 166
        },
        "resolved": true,
        "details": {
          "function_name": "device_get_address",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5314-5317",
          "snippet": "const bdaddr_t *device_get_address(struct btd_device *device)\n{\n\treturn &device->bdaddr;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nconst bdaddr_t *device_get_address(struct btd_device *device)\n{\n\treturn &device->bdaddr;\n}"
        }
      },
      {
        "call_info": {
          "callee": "change_state",
          "args": [
            "service",
            "BTD_SERVICE_STATE_DISCONNECTED",
            "0"
          ],
          "line": 162
        },
        "resolved": true,
        "details": {
          "function_name": "change_state",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
          "lines": "85-111",
          "snippet": "static void change_state(struct btd_service *service, btd_service_state_t state,\n\t\t\t\t\t\t\t\t\tint err)\n{\n\tbtd_service_state_t old = service->state;\n\tchar addr[18];\n\tGSList *l;\n\n\tif (state == old)\n\t\treturn;\n\n\tbtd_assert(service->device != NULL);\n\tbtd_assert(service->profile != NULL);\n\n\tservice->state = state;\n\tservice->err = err;\n\n\tba2str(device_get_address(service->device), addr);\n\tDBG(\"%p: device %s profile %s state changed: %s -> %s (%d)\", service,\n\t\t\t\t\taddr, service->profile->name,\n\t\t\t\t\tstate2str(old), state2str(state), err);\n\n\tfor (l = state_callbacks; l != NULL; l = g_slist_next(l)) {\n\t\tstruct service_state_callback *cb = l->data;\n\n\t\tcb->cb(service, old, state, cb->user_data);\n\t}\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/stat.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static GSList *state_callbacks = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic GSList *state_callbacks = NULL;\n\nstatic void change_state(struct btd_service *service, btd_service_state_t state,\n\t\t\t\t\t\t\t\t\tint err)\n{\n\tbtd_service_state_t old = service->state;\n\tchar addr[18];\n\tGSList *l;\n\n\tif (state == old)\n\t\treturn;\n\n\tbtd_assert(service->device != NULL);\n\tbtd_assert(service->profile != NULL);\n\n\tservice->state = state;\n\tservice->err = err;\n\n\tba2str(device_get_address(service->device), addr);\n\tDBG(\"%p: device %s profile %s state changed: %s -> %s (%d)\", service,\n\t\t\t\t\taddr, service->profile->name,\n\t\t\t\t\tstate2str(old), state2str(state), err);\n\n\tfor (l = state_callbacks; l != NULL; l = g_slist_next(l)) {\n\t\tstruct service_state_callback *cb = l->data;\n\n\t\tcb->cb(service, old, state, cb->user_data);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "service->profile->device_probe",
          "args": [
            "service"
          ],
          "line": 160
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_assert",
          "args": [
            "service->state == BTD_SERVICE_STATE_UNAVAILABLE"
          ],
          "line": 158
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nint service_probe(struct btd_service *service)\n{\n\tchar addr[18];\n\tint err;\n\n\tbtd_assert(service->state == BTD_SERVICE_STATE_UNAVAILABLE);\n\n\terr = service->profile->device_probe(service);\n\tif (err == 0) {\n\t\tchange_state(service, BTD_SERVICE_STATE_DISCONNECTED, 0);\n\t\treturn 0;\n\t}\n\n\tba2str(device_get_address(service->device), addr);\n\terror(\"%s profile probe failed for %s\", service->profile->name, addr);\n\n\treturn err;\n}"
  },
  {
    "function_name": "service_create",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
    "lines": "134-151",
    "snippet": "struct btd_service *service_create(struct btd_device *device,\n\t\t\t\t\t\tstruct btd_profile *profile)\n{\n\tstruct btd_service *service;\n\n\tservice = g_try_new0(struct btd_service, 1);\n\tif (!service) {\n\t\terror(\"service_create: failed to alloc memory\");\n\t\treturn NULL;\n\t}\n\n\tservice->ref = 1;\n\tservice->device = device; /* Weak ref */\n\tservice->profile = profile;\n\tservice->state = BTD_SERVICE_STATE_UNAVAILABLE;\n\n\treturn service;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/stat.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"service_create: failed to alloc memory\""
          ],
          "line": 141
        },
        "resolved": true,
        "details": {
          "function_name": "btd_service_get_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
          "lines": "336-339",
          "snippet": "int btd_service_get_error(const struct btd_service *service)\n{\n\treturn service->err;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/stat.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nint btd_service_get_error(const struct btd_service *service)\n{\n\treturn service->err;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_try_new0",
          "args": [
            "structbtd_service",
            "1"
          ],
          "line": 139
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstruct btd_service *service_create(struct btd_device *device,\n\t\t\t\t\t\tstruct btd_profile *profile)\n{\n\tstruct btd_service *service;\n\n\tservice = g_try_new0(struct btd_service, 1);\n\tif (!service) {\n\t\terror(\"service_create: failed to alloc memory\");\n\t\treturn NULL;\n\t}\n\n\tservice->ref = 1;\n\tservice->device = device; /* Weak ref */\n\tservice->profile = profile;\n\tservice->state = BTD_SERVICE_STATE_UNAVAILABLE;\n\n\treturn service;\n}"
  },
  {
    "function_name": "btd_service_unref",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
    "lines": "122-132",
    "snippet": "void btd_service_unref(struct btd_service *service)\n{\n\tservice->ref--;\n\n\tDBG(\"%p: ref=%d\", service, service->ref);\n\n\tif (service->ref > 0)\n\t\treturn;\n\n\tg_free(service);\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/stat.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "service"
          ],
          "line": 131
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"%p: ref=%d\"",
            "service",
            "service->ref"
          ],
          "line": 126
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nvoid btd_service_unref(struct btd_service *service)\n{\n\tservice->ref--;\n\n\tDBG(\"%p: ref=%d\", service, service->ref);\n\n\tif (service->ref > 0)\n\t\treturn;\n\n\tg_free(service);\n}"
  },
  {
    "function_name": "btd_service_ref",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
    "lines": "113-120",
    "snippet": "struct btd_service *btd_service_ref(struct btd_service *service)\n{\n\tservice->ref++;\n\n\tDBG(\"%p: ref=%d\", service, service->ref);\n\n\treturn service;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/stat.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"%p: ref=%d\"",
            "service",
            "service->ref"
          ],
          "line": 117
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstruct btd_service *btd_service_ref(struct btd_service *service)\n{\n\tservice->ref++;\n\n\tDBG(\"%p: ref=%d\", service, service->ref);\n\n\treturn service;\n}"
  },
  {
    "function_name": "change_state",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
    "lines": "85-111",
    "snippet": "static void change_state(struct btd_service *service, btd_service_state_t state,\n\t\t\t\t\t\t\t\t\tint err)\n{\n\tbtd_service_state_t old = service->state;\n\tchar addr[18];\n\tGSList *l;\n\n\tif (state == old)\n\t\treturn;\n\n\tbtd_assert(service->device != NULL);\n\tbtd_assert(service->profile != NULL);\n\n\tservice->state = state;\n\tservice->err = err;\n\n\tba2str(device_get_address(service->device), addr);\n\tDBG(\"%p: device %s profile %s state changed: %s -> %s (%d)\", service,\n\t\t\t\t\taddr, service->profile->name,\n\t\t\t\t\tstate2str(old), state2str(state), err);\n\n\tfor (l = state_callbacks; l != NULL; l = g_slist_next(l)) {\n\t\tstruct service_state_callback *cb = l->data;\n\n\t\tcb->cb(service, old, state, cb->user_data);\n\t}\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/stat.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static GSList *state_callbacks = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "cb->cb",
          "args": [
            "service",
            "old",
            "state",
            "cb->user_data"
          ],
          "line": 109
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_slist_next",
          "args": [
            "l"
          ],
          "line": 106
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DBG",
          "args": [
            "\"%p: device %s profile %s state changed: %s -> %s (%d)\"",
            "service",
            "addr",
            "service->profile->name",
            "state2str(old)",
            "state2str(state)",
            "err"
          ],
          "line": 102
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "state2str",
          "args": [
            "state"
          ],
          "line": 104
        },
        "resolved": true,
        "details": {
          "function_name": "state2str",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
          "lines": "67-83",
          "snippet": "static const char *state2str(btd_service_state_t state)\n{\n\tswitch (state) {\n\tcase BTD_SERVICE_STATE_UNAVAILABLE:\n\t\treturn \"unavailable\";\n\tcase BTD_SERVICE_STATE_DISCONNECTED:\n\t\treturn \"disconnected\";\n\tcase BTD_SERVICE_STATE_CONNECTING:\n\t\treturn \"connecting\";\n\tcase BTD_SERVICE_STATE_CONNECTED:\n\t\treturn \"connected\";\n\tcase BTD_SERVICE_STATE_DISCONNECTING:\n\t\treturn \"disconnecting\";\n\t}\n\n\treturn NULL;\n}",
          "includes": [
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"device.h\"",
            "#include \"adapter.h\"",
            "#include \"backtrace.h\"",
            "#include \"log.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <glib.h>",
            "#include <errno.h>",
            "#include <sys/ioctl.h>",
            "#include <sys/stat.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic const char *state2str(btd_service_state_t state)\n{\n\tswitch (state) {\n\tcase BTD_SERVICE_STATE_UNAVAILABLE:\n\t\treturn \"unavailable\";\n\tcase BTD_SERVICE_STATE_DISCONNECTED:\n\t\treturn \"disconnected\";\n\tcase BTD_SERVICE_STATE_CONNECTING:\n\t\treturn \"connecting\";\n\tcase BTD_SERVICE_STATE_CONNECTED:\n\t\treturn \"connected\";\n\tcase BTD_SERVICE_STATE_DISCONNECTING:\n\t\treturn \"disconnecting\";\n\t}\n\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ba2str",
          "args": [
            "device_get_address(service->device)",
            "addr"
          ],
          "line": 101
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device_get_address",
          "args": [
            "service->device"
          ],
          "line": 101
        },
        "resolved": true,
        "details": {
          "function_name": "device_get_address",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/device.c",
          "lines": "5314-5317",
          "snippet": "const bdaddr_t *device_get_address(struct btd_device *device)\n{\n\treturn &device->bdaddr;\n}",
          "includes": [
            "#include \"eir.h\"",
            "#include \"attrib-server.h\"",
            "#include \"storage.h\"",
            "#include \"textfile.h\"",
            "#include \"agent.h\"",
            "#include \"attrib/gatt.h\"",
            "#include \"sdp-client.h\"",
            "#include \"uuid-helper.h\"",
            "#include \"error.h\"",
            "#include \"dbus-common.h\"",
            "#include \"service.h\"",
            "#include \"profile.h\"",
            "#include \"gatt-client.h\"",
            "#include \"device.h\"",
            "#include \"attrib/gattrib.h\"",
            "#include \"gatt-database.h\"",
            "#include \"adapter.h\"",
            "#include \"hcid.h\"",
            "#include \"attrib/att.h\"",
            "#include \"lib/mgmt.h\"",
            "#include \"btio/btio.h\"",
            "#include \"src/shared/ad.h\"",
            "#include \"src/shared/gatt-server.h\"",
            "#include \"src/shared/gatt-client.h\"",
            "#include \"src/shared/gatt-db.h\"",
            "#include \"src/shared/queue.h\"",
            "#include \"src/shared/att.h\"",
            "#include \"src/shared/util.h\"",
            "#include \"log.h\"",
            "#include \"gdbus/gdbus.h\"",
            "#include \"lib/uuid.h\"",
            "#include \"lib/sdp_lib.h\"",
            "#include \"lib/sdp.h\"",
            "#include \"lib/bluetooth.h\"",
            "#include <dbus/dbus.h>",
            "#include <glib.h>",
            "#include <time.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <stdbool.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void gatt_client_init(struct btd_device *device);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"eir.h\"\n#include \"attrib-server.h\"\n#include \"storage.h\"\n#include \"textfile.h\"\n#include \"agent.h\"\n#include \"attrib/gatt.h\"\n#include \"sdp-client.h\"\n#include \"uuid-helper.h\"\n#include \"error.h\"\n#include \"dbus-common.h\"\n#include \"service.h\"\n#include \"profile.h\"\n#include \"gatt-client.h\"\n#include \"device.h\"\n#include \"attrib/gattrib.h\"\n#include \"gatt-database.h\"\n#include \"adapter.h\"\n#include \"hcid.h\"\n#include \"attrib/att.h\"\n#include \"lib/mgmt.h\"\n#include \"btio/btio.h\"\n#include \"src/shared/ad.h\"\n#include \"src/shared/gatt-server.h\"\n#include \"src/shared/gatt-client.h\"\n#include \"src/shared/gatt-db.h\"\n#include \"src/shared/queue.h\"\n#include \"src/shared/att.h\"\n#include \"src/shared/util.h\"\n#include \"log.h\"\n#include \"gdbus/gdbus.h\"\n#include \"lib/uuid.h\"\n#include \"lib/sdp_lib.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <dbus/dbus.h>\n#include <glib.h>\n#include <time.h>\n#include <dirent.h>\n#include <errno.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic void gatt_client_init(struct btd_device *device);\n\nconst bdaddr_t *device_get_address(struct btd_device *device)\n{\n\treturn &device->bdaddr;\n}"
        }
      },
      {
        "call_info": {
          "callee": "btd_assert",
          "args": [
            "service->profile != NULL"
          ],
          "line": 96
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "btd_assert",
          "args": [
            "service->device != NULL"
          ],
          "line": 95
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic GSList *state_callbacks = NULL;\n\nstatic void change_state(struct btd_service *service, btd_service_state_t state,\n\t\t\t\t\t\t\t\t\tint err)\n{\n\tbtd_service_state_t old = service->state;\n\tchar addr[18];\n\tGSList *l;\n\n\tif (state == old)\n\t\treturn;\n\n\tbtd_assert(service->device != NULL);\n\tbtd_assert(service->profile != NULL);\n\n\tservice->state = state;\n\tservice->err = err;\n\n\tba2str(device_get_address(service->device), addr);\n\tDBG(\"%p: device %s profile %s state changed: %s -> %s (%d)\", service,\n\t\t\t\t\taddr, service->profile->name,\n\t\t\t\t\tstate2str(old), state2str(state), err);\n\n\tfor (l = state_callbacks; l != NULL; l = g_slist_next(l)) {\n\t\tstruct service_state_callback *cb = l->data;\n\n\t\tcb->cb(service, old, state, cb->user_data);\n\t}\n}"
  },
  {
    "function_name": "state2str",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c_ICV/CVE-2021-3658/repo/src/service.c",
    "lines": "67-83",
    "snippet": "static const char *state2str(btd_service_state_t state)\n{\n\tswitch (state) {\n\tcase BTD_SERVICE_STATE_UNAVAILABLE:\n\t\treturn \"unavailable\";\n\tcase BTD_SERVICE_STATE_DISCONNECTED:\n\t\treturn \"disconnected\";\n\tcase BTD_SERVICE_STATE_CONNECTING:\n\t\treturn \"connecting\";\n\tcase BTD_SERVICE_STATE_CONNECTED:\n\t\treturn \"connected\";\n\tcase BTD_SERVICE_STATE_DISCONNECTING:\n\t\treturn \"disconnecting\";\n\t}\n\n\treturn NULL;\n}",
    "includes": [
      "#include \"service.h\"",
      "#include \"profile.h\"",
      "#include \"device.h\"",
      "#include \"adapter.h\"",
      "#include \"backtrace.h\"",
      "#include \"log.h\"",
      "#include \"lib/sdp.h\"",
      "#include \"lib/bluetooth.h\"",
      "#include <glib.h>",
      "#include <errno.h>",
      "#include <sys/ioctl.h>",
      "#include <sys/stat.h>",
      "#include <stdbool.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"service.h\"\n#include \"profile.h\"\n#include \"device.h\"\n#include \"adapter.h\"\n#include \"backtrace.h\"\n#include \"log.h\"\n#include \"lib/sdp.h\"\n#include \"lib/bluetooth.h\"\n#include <glib.h>\n#include <errno.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <stdbool.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic const char *state2str(btd_service_state_t state)\n{\n\tswitch (state) {\n\tcase BTD_SERVICE_STATE_UNAVAILABLE:\n\t\treturn \"unavailable\";\n\tcase BTD_SERVICE_STATE_DISCONNECTED:\n\t\treturn \"disconnected\";\n\tcase BTD_SERVICE_STATE_CONNECTING:\n\t\treturn \"connecting\";\n\tcase BTD_SERVICE_STATE_CONNECTED:\n\t\treturn \"connected\";\n\tcase BTD_SERVICE_STATE_DISCONNECTING:\n\t\treturn \"disconnecting\";\n\t}\n\n\treturn NULL;\n}"
  }
]