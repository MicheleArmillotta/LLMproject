[
  {
    "function_name": "unuse_mm",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18397/repo/mm/mmu_context.c",
    "lines": "53-63",
    "snippet": "void unuse_mm(struct mm_struct *mm)\n{\n\tstruct task_struct *tsk = current;\n\n\ttask_lock(tsk);\n\tsync_mm_rss(mm);\n\ttsk->mm = NULL;\n\t/* active_mm is still 'mm' */\n\tenter_lazy_tlb(mm, tsk);\n\ttask_unlock(tsk);\n}",
    "includes": [
      "#include <asm/mmu_context.h>",
      "#include <linux/export.h>",
      "#include <linux/mmu_context.h>",
      "#include <linux/sched/task.h>",
      "#include <linux/sched/mm.h>",
      "#include <linux/sched.h>",
      "#include <linux/mm.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "task_unlock",
          "args": [
            "tsk"
          ],
          "line": 62
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "enter_lazy_tlb",
          "args": [
            "mm",
            "tsk"
          ],
          "line": 61
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sync_mm_rss",
          "args": [
            "mm"
          ],
          "line": 58
        },
        "resolved": true,
        "details": {
          "function_name": "sync_mm_rss",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18397/repo/mm/memory.c",
          "lines": "144-155",
          "snippet": "void sync_mm_rss(struct mm_struct *mm)\n{\n\tint i;\n\n\tfor (i = 0; i < NR_MM_COUNTERS; i++) {\n\t\tif (current->rss_stat.count[i]) {\n\t\t\tadd_mm_counter(mm, i, current->rss_stat.count[i]);\n\t\t\tcurrent->rss_stat.count[i] = 0;\n\t\t}\n\t}\n\tcurrent->rss_stat.events = 0;\n}",
          "includes": [
            "#include \"internal.h\"",
            "#include <asm/pgtable.h>",
            "#include <asm/tlbflush.h>",
            "#include <asm/tlb.h>",
            "#include <linux/uaccess.h>",
            "#include <asm/pgalloc.h>",
            "#include <asm/mmu_context.h>",
            "#include <asm/io.h>",
            "#include <linux/oom.h>",
            "#include <linux/dax.h>",
            "#include <linux/userfaultfd_k.h>",
            "#include <linux/debugfs.h>",
            "#include <linux/dma-debug.h>",
            "#include <linux/string.h>",
            "#include <linux/migrate.h>",
            "#include <linux/gfp.h>",
            "#include <linux/elf.h>",
            "#include <linux/swapops.h>",
            "#include <linux/mmu_notifier.h>",
            "#include <linux/memcontrol.h>",
            "#include <linux/writeback.h>",
            "#include <linux/pfn_t.h>",
            "#include <linux/init.h>",
            "#include <linux/delayacct.h>",
            "#include <linux/export.h>",
            "#include <linux/rmap.h>",
            "#include <linux/ksm.h>",
            "#include <linux/memremap.h>",
            "#include <linux/pagemap.h>",
            "#include <linux/highmem.h>",
            "#include <linux/swap.h>",
            "#include <linux/mman.h>",
            "#include <linux/hugetlb.h>",
            "#include <linux/sched/task.h>",
            "#include <linux/sched/numa_balancing.h>",
            "#include <linux/sched/coredump.h>",
            "#include <linux/sched/mm.h>",
            "#include <linux/mm.h>",
            "#include <linux/kernel_stat.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"internal.h\"\n#include <asm/pgtable.h>\n#include <asm/tlbflush.h>\n#include <asm/tlb.h>\n#include <linux/uaccess.h>\n#include <asm/pgalloc.h>\n#include <asm/mmu_context.h>\n#include <asm/io.h>\n#include <linux/oom.h>\n#include <linux/dax.h>\n#include <linux/userfaultfd_k.h>\n#include <linux/debugfs.h>\n#include <linux/dma-debug.h>\n#include <linux/string.h>\n#include <linux/migrate.h>\n#include <linux/gfp.h>\n#include <linux/elf.h>\n#include <linux/swapops.h>\n#include <linux/mmu_notifier.h>\n#include <linux/memcontrol.h>\n#include <linux/writeback.h>\n#include <linux/pfn_t.h>\n#include <linux/init.h>\n#include <linux/delayacct.h>\n#include <linux/export.h>\n#include <linux/rmap.h>\n#include <linux/ksm.h>\n#include <linux/memremap.h>\n#include <linux/pagemap.h>\n#include <linux/highmem.h>\n#include <linux/swap.h>\n#include <linux/mman.h>\n#include <linux/hugetlb.h>\n#include <linux/sched/task.h>\n#include <linux/sched/numa_balancing.h>\n#include <linux/sched/coredump.h>\n#include <linux/sched/mm.h>\n#include <linux/mm.h>\n#include <linux/kernel_stat.h>\n\nvoid sync_mm_rss(struct mm_struct *mm)\n{\n\tint i;\n\n\tfor (i = 0; i < NR_MM_COUNTERS; i++) {\n\t\tif (current->rss_stat.count[i]) {\n\t\t\tadd_mm_counter(mm, i, current->rss_stat.count[i]);\n\t\t\tcurrent->rss_stat.count[i] = 0;\n\t\t}\n\t}\n\tcurrent->rss_stat.events = 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "task_lock",
          "args": [
            "tsk"
          ],
          "line": 57
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <asm/mmu_context.h>\n#include <linux/export.h>\n#include <linux/mmu_context.h>\n#include <linux/sched/task.h>\n#include <linux/sched/mm.h>\n#include <linux/sched.h>\n#include <linux/mm.h>\n\nvoid unuse_mm(struct mm_struct *mm)\n{\n\tstruct task_struct *tsk = current;\n\n\ttask_lock(tsk);\n\tsync_mm_rss(mm);\n\ttsk->mm = NULL;\n\t/* active_mm is still 'mm' */\n\tenter_lazy_tlb(mm, tsk);\n\ttask_unlock(tsk);\n}"
  },
  {
    "function_name": "use_mm",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18397/repo/mm/mmu_context.c",
    "lines": "22-42",
    "snippet": "void use_mm(struct mm_struct *mm)\n{\n\tstruct mm_struct *active_mm;\n\tstruct task_struct *tsk = current;\n\n\ttask_lock(tsk);\n\tactive_mm = tsk->active_mm;\n\tif (active_mm != mm) {\n\t\tmmgrab(mm);\n\t\ttsk->active_mm = mm;\n\t}\n\ttsk->mm = mm;\n\tswitch_mm(active_mm, mm, tsk);\n\ttask_unlock(tsk);\n#ifdef finish_arch_post_lock_switch\n\tfinish_arch_post_lock_switch();\n#endif\n\n\tif (active_mm != mm)\n\t\tmmdrop(active_mm);\n}",
    "includes": [
      "#include <asm/mmu_context.h>",
      "#include <linux/export.h>",
      "#include <linux/mmu_context.h>",
      "#include <linux/sched/task.h>",
      "#include <linux/sched/mm.h>",
      "#include <linux/sched.h>",
      "#include <linux/mm.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "mmdrop",
          "args": [
            "active_mm"
          ],
          "line": 41
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "finish_arch_post_lock_switch",
          "args": [],
          "line": 37
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "task_unlock",
          "args": [
            "tsk"
          ],
          "line": 35
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "switch_mm",
          "args": [
            "active_mm",
            "mm",
            "tsk"
          ],
          "line": 34
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mmgrab",
          "args": [
            "mm"
          ],
          "line": 30
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "task_lock",
          "args": [
            "tsk"
          ],
          "line": 27
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <asm/mmu_context.h>\n#include <linux/export.h>\n#include <linux/mmu_context.h>\n#include <linux/sched/task.h>\n#include <linux/sched/mm.h>\n#include <linux/sched.h>\n#include <linux/mm.h>\n\nvoid use_mm(struct mm_struct *mm)\n{\n\tstruct mm_struct *active_mm;\n\tstruct task_struct *tsk = current;\n\n\ttask_lock(tsk);\n\tactive_mm = tsk->active_mm;\n\tif (active_mm != mm) {\n\t\tmmgrab(mm);\n\t\ttsk->active_mm = mm;\n\t}\n\ttsk->mm = mm;\n\tswitch_mm(active_mm, mm, tsk);\n\ttask_unlock(tsk);\n#ifdef finish_arch_post_lock_switch\n\tfinish_arch_post_lock_switch();\n#endif\n\n\tif (active_mm != mm)\n\t\tmmdrop(active_mm);\n}"
  }
]