[
  {
    "function_name": "sparse_mem_map_populate",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18397/repo/mm/sparse-vmemmap.c",
    "lines": "248-263",
    "snippet": "struct page * __meminit sparse_mem_map_populate(unsigned long pnum, int nid,\n\t\tstruct vmem_altmap *altmap)\n{\n\tunsigned long start;\n\tunsigned long end;\n\tstruct page *map;\n\n\tmap = pfn_to_page(pnum * PAGES_PER_SECTION);\n\tstart = (unsigned long)map;\n\tend = (unsigned long)(map + PAGES_PER_SECTION);\n\n\tif (vmemmap_populate(start, end, nid, altmap))\n\t\treturn NULL;\n\n\treturn map;\n}",
    "includes": [
      "#include <asm/pgtable.h>",
      "#include <asm/pgalloc.h>",
      "#include <asm/dma.h>",
      "#include <linux/sched.h>",
      "#include <linux/vmalloc.h>",
      "#include <linux/spinlock.h>",
      "#include <linux/slab.h>",
      "#include <linux/highmem.h>",
      "#include <linux/memremap.h>",
      "#include <linux/memblock.h>",
      "#include <linux/mmzone.h>",
      "#include <linux/mm.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "vmemmap_populate",
          "args": [
            "start",
            "end",
            "nid",
            "altmap"
          ],
          "line": 259
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pfn_to_page",
          "args": [
            "pnum * PAGES_PER_SECTION"
          ],
          "line": 255
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <asm/pgtable.h>\n#include <asm/pgalloc.h>\n#include <asm/dma.h>\n#include <linux/sched.h>\n#include <linux/vmalloc.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n#include <linux/highmem.h>\n#include <linux/memremap.h>\n#include <linux/memblock.h>\n#include <linux/mmzone.h>\n#include <linux/mm.h>\n\nstruct page * __meminit sparse_mem_map_populate(unsigned long pnum, int nid,\n\t\tstruct vmem_altmap *altmap)\n{\n\tunsigned long start;\n\tunsigned long end;\n\tstruct page *map;\n\n\tmap = pfn_to_page(pnum * PAGES_PER_SECTION);\n\tstart = (unsigned long)map;\n\tend = (unsigned long)(map + PAGES_PER_SECTION);\n\n\tif (vmemmap_populate(start, end, nid, altmap))\n\t\treturn NULL;\n\n\treturn map;\n}"
  },
  {
    "function_name": "vmemmap_populate_basepages",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18397/repo/mm/sparse-vmemmap.c",
    "lines": "216-246",
    "snippet": "int __meminit vmemmap_populate_basepages(unsigned long start,\n\t\t\t\t\t unsigned long end, int node)\n{\n\tunsigned long addr = start;\n\tpgd_t *pgd;\n\tp4d_t *p4d;\n\tpud_t *pud;\n\tpmd_t *pmd;\n\tpte_t *pte;\n\n\tfor (; addr < end; addr += PAGE_SIZE) {\n\t\tpgd = vmemmap_pgd_populate(addr, node);\n\t\tif (!pgd)\n\t\t\treturn -ENOMEM;\n\t\tp4d = vmemmap_p4d_populate(pgd, addr, node);\n\t\tif (!p4d)\n\t\t\treturn -ENOMEM;\n\t\tpud = vmemmap_pud_populate(p4d, addr, node);\n\t\tif (!pud)\n\t\t\treturn -ENOMEM;\n\t\tpmd = vmemmap_pmd_populate(pud, addr, node);\n\t\tif (!pmd)\n\t\t\treturn -ENOMEM;\n\t\tpte = vmemmap_pte_populate(pmd, addr, node);\n\t\tif (!pte)\n\t\t\treturn -ENOMEM;\n\t\tvmemmap_verify(pte, node, addr, addr + PAGE_SIZE);\n\t}\n\n\treturn 0;\n}",
    "includes": [
      "#include <asm/pgtable.h>",
      "#include <asm/pgalloc.h>",
      "#include <asm/dma.h>",
      "#include <linux/sched.h>",
      "#include <linux/vmalloc.h>",
      "#include <linux/spinlock.h>",
      "#include <linux/slab.h>",
      "#include <linux/highmem.h>",
      "#include <linux/memremap.h>",
      "#include <linux/memblock.h>",
      "#include <linux/mmzone.h>",
      "#include <linux/mm.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "vmemmap_verify",
          "args": [
            "pte",
            "node",
            "addr",
            "addr + PAGE_SIZE"
          ],
          "line": 242
        },
        "resolved": true,
        "details": {
          "function_name": "vmemmap_verify",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18397/repo/mm/sparse-vmemmap.c",
          "lines": "132-141",
          "snippet": "void __meminit vmemmap_verify(pte_t *pte, int node,\n\t\t\t\tunsigned long start, unsigned long end)\n{\n\tunsigned long pfn = pte_pfn(*pte);\n\tint actual_node = early_pfn_to_nid(pfn);\n\n\tif (node_distance(actual_node, node) > LOCAL_DISTANCE)\n\t\tpr_warn(\"[%lx-%lx] potential offnode page_structs\\n\",\n\t\t\tstart, end - 1);\n}",
          "includes": [
            "#include <asm/pgtable.h>",
            "#include <asm/pgalloc.h>",
            "#include <asm/dma.h>",
            "#include <linux/sched.h>",
            "#include <linux/vmalloc.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/slab.h>",
            "#include <linux/highmem.h>",
            "#include <linux/memremap.h>",
            "#include <linux/memblock.h>",
            "#include <linux/mmzone.h>",
            "#include <linux/mm.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <asm/pgtable.h>\n#include <asm/pgalloc.h>\n#include <asm/dma.h>\n#include <linux/sched.h>\n#include <linux/vmalloc.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n#include <linux/highmem.h>\n#include <linux/memremap.h>\n#include <linux/memblock.h>\n#include <linux/mmzone.h>\n#include <linux/mm.h>\n\nvoid __meminit vmemmap_verify(pte_t *pte, int node,\n\t\t\t\tunsigned long start, unsigned long end)\n{\n\tunsigned long pfn = pte_pfn(*pte);\n\tint actual_node = early_pfn_to_nid(pfn);\n\n\tif (node_distance(actual_node, node) > LOCAL_DISTANCE)\n\t\tpr_warn(\"[%lx-%lx] potential offnode page_structs\\n\",\n\t\t\tstart, end - 1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "vmemmap_pte_populate",
          "args": [
            "pmd",
            "addr",
            "node"
          ],
          "line": 239
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "vmemmap_pmd_populate",
          "args": [
            "pud",
            "addr",
            "node"
          ],
          "line": 236
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "vmemmap_pud_populate",
          "args": [
            "p4d",
            "addr",
            "node"
          ],
          "line": 233
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "vmemmap_p4d_populate",
          "args": [
            "pgd",
            "addr",
            "node"
          ],
          "line": 230
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "vmemmap_pgd_populate",
          "args": [
            "addr",
            "node"
          ],
          "line": 227
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <asm/pgtable.h>\n#include <asm/pgalloc.h>\n#include <asm/dma.h>\n#include <linux/sched.h>\n#include <linux/vmalloc.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n#include <linux/highmem.h>\n#include <linux/memremap.h>\n#include <linux/memblock.h>\n#include <linux/mmzone.h>\n#include <linux/mm.h>\n\nint __meminit vmemmap_populate_basepages(unsigned long start,\n\t\t\t\t\t unsigned long end, int node)\n{\n\tunsigned long addr = start;\n\tpgd_t *pgd;\n\tp4d_t *p4d;\n\tpud_t *pud;\n\tpmd_t *pmd;\n\tpte_t *pte;\n\n\tfor (; addr < end; addr += PAGE_SIZE) {\n\t\tpgd = vmemmap_pgd_populate(addr, node);\n\t\tif (!pgd)\n\t\t\treturn -ENOMEM;\n\t\tp4d = vmemmap_p4d_populate(pgd, addr, node);\n\t\tif (!p4d)\n\t\t\treturn -ENOMEM;\n\t\tpud = vmemmap_pud_populate(p4d, addr, node);\n\t\tif (!pud)\n\t\t\treturn -ENOMEM;\n\t\tpmd = vmemmap_pmd_populate(pud, addr, node);\n\t\tif (!pmd)\n\t\t\treturn -ENOMEM;\n\t\tpte = vmemmap_pte_populate(pmd, addr, node);\n\t\tif (!pte)\n\t\t\treturn -ENOMEM;\n\t\tvmemmap_verify(pte, node, addr, addr + PAGE_SIZE);\n\t}\n\n\treturn 0;\n}"
  },
  {
    "function_name": "vmemmap_alloc_block_zero",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18397/repo/mm/sparse-vmemmap.c",
    "lines": "157-166",
    "snippet": "static void * __meminit vmemmap_alloc_block_zero(unsigned long size, int node)\n{\n\tvoid *p = vmemmap_alloc_block(size, node);\n\n\tif (!p)\n\t\treturn NULL;\n\tmemset(p, 0, size);\n\n\treturn p;\n}",
    "includes": [
      "#include <asm/pgtable.h>",
      "#include <asm/pgalloc.h>",
      "#include <asm/dma.h>",
      "#include <linux/sched.h>",
      "#include <linux/vmalloc.h>",
      "#include <linux/spinlock.h>",
      "#include <linux/slab.h>",
      "#include <linux/highmem.h>",
      "#include <linux/memremap.h>",
      "#include <linux/memblock.h>",
      "#include <linux/mmzone.h>",
      "#include <linux/mm.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "p",
            "0",
            "size"
          ],
          "line": 163
        },
        "resolved": true,
        "details": {
          "function_name": "memset",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18397/repo/mm/kasan/kasan.c",
          "lines": "283-288",
          "snippet": "void *memset(void *addr, int c, size_t len)\n{\n\tcheck_memory_region((unsigned long)addr, len, true, _RET_IP_);\n\n\treturn __memset(addr, c, len);\n}",
          "includes": [
            "#include \"../slab.h\"",
            "#include \"kasan.h\"",
            "#include <linux/bug.h>",
            "#include <linux/vmalloc.h>",
            "#include <linux/types.h>",
            "#include <linux/string.h>",
            "#include <linux/stacktrace.h>",
            "#include <linux/slab.h>",
            "#include <linux/sched/task_stack.h>",
            "#include <linux/sched.h>",
            "#include <linux/printk.h>",
            "#include <linux/module.h>",
            "#include <linux/mm.h>",
            "#include <linux/memory.h>",
            "#include <linux/memblock.h>",
            "#include <linux/linkage.h>",
            "#include <linux/kmemleak.h>",
            "#include <linux/kernel.h>",
            "#include <linux/kasan.h>",
            "#include <linux/init.h>",
            "#include <linux/interrupt.h>",
            "#include <linux/export.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "__alias(__asan_loadN)\nvoid __asan_loadN_noabort(unsigned long, size_t);",
            "__alias(__asan_storeN)\nvoid __asan_storeN_noabort(unsigned long, size_t);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"../slab.h\"\n#include \"kasan.h\"\n#include <linux/bug.h>\n#include <linux/vmalloc.h>\n#include <linux/types.h>\n#include <linux/string.h>\n#include <linux/stacktrace.h>\n#include <linux/slab.h>\n#include <linux/sched/task_stack.h>\n#include <linux/sched.h>\n#include <linux/printk.h>\n#include <linux/module.h>\n#include <linux/mm.h>\n#include <linux/memory.h>\n#include <linux/memblock.h>\n#include <linux/linkage.h>\n#include <linux/kmemleak.h>\n#include <linux/kernel.h>\n#include <linux/kasan.h>\n#include <linux/init.h>\n#include <linux/interrupt.h>\n#include <linux/export.h>\n\n__alias(__asan_loadN)\nvoid __asan_loadN_noabort(unsigned long, size_t);\n__alias(__asan_storeN)\nvoid __asan_storeN_noabort(unsigned long, size_t);\n\nvoid *memset(void *addr, int c, size_t len)\n{\n\tcheck_memory_region((unsigned long)addr, len, true, _RET_IP_);\n\n\treturn __memset(addr, c, len);\n}"
        }
      },
      {
        "call_info": {
          "callee": "vmemmap_alloc_block",
          "args": [
            "size",
            "node"
          ],
          "line": 159
        },
        "resolved": true,
        "details": {
          "function_name": "vmemmap_alloc_block_zero",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18397/repo/mm/sparse-vmemmap.c",
          "lines": "157-166",
          "snippet": "static void * __meminit vmemmap_alloc_block_zero(unsigned long size, int node)\n{\n\tvoid *p = vmemmap_alloc_block(size, node);\n\n\tif (!p)\n\t\treturn NULL;\n\tmemset(p, 0, size);\n\n\treturn p;\n}",
          "note": "cyclic_reference_detected"
        }
      }
    ],
    "contextual_snippet": "#include <asm/pgtable.h>\n#include <asm/pgalloc.h>\n#include <asm/dma.h>\n#include <linux/sched.h>\n#include <linux/vmalloc.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n#include <linux/highmem.h>\n#include <linux/memremap.h>\n#include <linux/memblock.h>\n#include <linux/mmzone.h>\n#include <linux/mm.h>\n\nstatic void * __meminit vmemmap_alloc_block_zero(unsigned long size, int node)\n{\n\tvoid *p = vmemmap_alloc_block(size, node);\n\n\tif (!p)\n\t\treturn NULL;\n\tmemset(p, 0, size);\n\n\treturn p;\n}"
  },
  {
    "function_name": "vmemmap_verify",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18397/repo/mm/sparse-vmemmap.c",
    "lines": "132-141",
    "snippet": "void __meminit vmemmap_verify(pte_t *pte, int node,\n\t\t\t\tunsigned long start, unsigned long end)\n{\n\tunsigned long pfn = pte_pfn(*pte);\n\tint actual_node = early_pfn_to_nid(pfn);\n\n\tif (node_distance(actual_node, node) > LOCAL_DISTANCE)\n\t\tpr_warn(\"[%lx-%lx] potential offnode page_structs\\n\",\n\t\t\tstart, end - 1);\n}",
    "includes": [
      "#include <asm/pgtable.h>",
      "#include <asm/pgalloc.h>",
      "#include <asm/dma.h>",
      "#include <linux/sched.h>",
      "#include <linux/vmalloc.h>",
      "#include <linux/spinlock.h>",
      "#include <linux/slab.h>",
      "#include <linux/highmem.h>",
      "#include <linux/memremap.h>",
      "#include <linux/memblock.h>",
      "#include <linux/mmzone.h>",
      "#include <linux/mm.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "pr_warn",
          "args": [
            "\"[%lx-%lx] potential offnode page_structs\\n\"",
            "start",
            "end - 1"
          ],
          "line": 139
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "node_distance",
          "args": [
            "actual_node",
            "node"
          ],
          "line": 138
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "early_pfn_to_nid",
          "args": [
            "pfn"
          ],
          "line": 136
        },
        "resolved": true,
        "details": {
          "function_name": "early_pfn_to_nid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18397/repo/mm/page_alloc.c",
          "lines": "1292-1304",
          "snippet": "int __meminit early_pfn_to_nid(unsigned long pfn)\n{\n\tstatic DEFINE_SPINLOCK(early_pfn_lock);\n\tint nid;\n\n\tspin_lock(&early_pfn_lock);\n\tnid = __early_pfn_to_nid(pfn, &early_pfnnid_cache);\n\tif (nid < 0)\n\t\tnid = first_online_node;\n\tspin_unlock(&early_pfn_lock);\n\n\treturn nid;\n}",
          "includes": [
            "#include \"internal.h\"",
            "#include <asm/div64.h>",
            "#include <asm/tlbflush.h>",
            "#include <asm/sections.h>",
            "#include <linux/psi.h>",
            "#include <linux/nmi.h>",
            "#include <linux/lockdep.h>",
            "#include <linux/ftrace.h>",
            "#include <linux/memcontrol.h>",
            "#include <linux/kthread.h>",
            "#include <linux/page_owner.h>",
            "#include <linux/sched/mm.h>",
            "#include <linux/sched/rt.h>",
            "#include <linux/hugetlb.h>",
            "#include <linux/migrate.h>",
            "#include <linux/mm_inline.h>",
            "#include <linux/prefetch.h>",
            "#include <trace/events/oom.h>",
            "#include <trace/events/kmem.h>",
            "#include <linux/compaction.h>",
            "#include <linux/kmemleak.h>",
            "#include <linux/debugobjects.h>",
            "#include <linux/page_ext.h>",
            "#include <linux/page-isolation.h>",
            "#include <linux/fault-inject.h>",
            "#include <linux/backing-dev.h>",
            "#include <linux/pfn.h>",
            "#include <linux/sort.h>",
            "#include <linux/stop_machine.h>",
            "#include <linux/memremap.h>",
            "#include <linux/mempolicy.h>",
            "#include <linux/vmstat.h>",
            "#include <linux/vmalloc.h>",
            "#include <linux/nodemask.h>",
            "#include <linux/memory_hotplug.h>",
            "#include <linux/cpuset.h>",
            "#include <linux/cpu.h>",
            "#include <linux/sysctl.h>",
            "#include <linux/topology.h>",
            "#include <linux/oom.h>",
            "#include <linux/ratelimit.h>",
            "#include <linux/slab.h>",
            "#include <linux/blkdev.h>",
            "#include <linux/pagevec.h>",
            "#include <linux/suspend.h>",
            "#include <linux/module.h>",
            "#include <linux/kasan.h>",
            "#include <linux/kernel.h>",
            "#include <linux/compiler.h>",
            "#include <linux/memblock.h>",
            "#include <linux/jiffies.h>",
            "#include <linux/pagemap.h>",
            "#include <linux/interrupt.h>",
            "#include <linux/swap.h>",
            "#include <linux/mm.h>",
            "#include <linux/stddef.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"internal.h\"\n#include <asm/div64.h>\n#include <asm/tlbflush.h>\n#include <asm/sections.h>\n#include <linux/psi.h>\n#include <linux/nmi.h>\n#include <linux/lockdep.h>\n#include <linux/ftrace.h>\n#include <linux/memcontrol.h>\n#include <linux/kthread.h>\n#include <linux/page_owner.h>\n#include <linux/sched/mm.h>\n#include <linux/sched/rt.h>\n#include <linux/hugetlb.h>\n#include <linux/migrate.h>\n#include <linux/mm_inline.h>\n#include <linux/prefetch.h>\n#include <trace/events/oom.h>\n#include <trace/events/kmem.h>\n#include <linux/compaction.h>\n#include <linux/kmemleak.h>\n#include <linux/debugobjects.h>\n#include <linux/page_ext.h>\n#include <linux/page-isolation.h>\n#include <linux/fault-inject.h>\n#include <linux/backing-dev.h>\n#include <linux/pfn.h>\n#include <linux/sort.h>\n#include <linux/stop_machine.h>\n#include <linux/memremap.h>\n#include <linux/mempolicy.h>\n#include <linux/vmstat.h>\n#include <linux/vmalloc.h>\n#include <linux/nodemask.h>\n#include <linux/memory_hotplug.h>\n#include <linux/cpuset.h>\n#include <linux/cpu.h>\n#include <linux/sysctl.h>\n#include <linux/topology.h>\n#include <linux/oom.h>\n#include <linux/ratelimit.h>\n#include <linux/slab.h>\n#include <linux/blkdev.h>\n#include <linux/pagevec.h>\n#include <linux/suspend.h>\n#include <linux/module.h>\n#include <linux/kasan.h>\n#include <linux/kernel.h>\n#include <linux/compiler.h>\n#include <linux/memblock.h>\n#include <linux/jiffies.h>\n#include <linux/pagemap.h>\n#include <linux/interrupt.h>\n#include <linux/swap.h>\n#include <linux/mm.h>\n#include <linux/stddef.h>\n\nint __meminit early_pfn_to_nid(unsigned long pfn)\n{\n\tstatic DEFINE_SPINLOCK(early_pfn_lock);\n\tint nid;\n\n\tspin_lock(&early_pfn_lock);\n\tnid = __early_pfn_to_nid(pfn, &early_pfnnid_cache);\n\tif (nid < 0)\n\t\tnid = first_online_node;\n\tspin_unlock(&early_pfn_lock);\n\n\treturn nid;\n}"
        }
      },
      {
        "call_info": {
          "callee": "pte_pfn",
          "args": [
            "*pte"
          ],
          "line": 135
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <asm/pgtable.h>\n#include <asm/pgalloc.h>\n#include <asm/dma.h>\n#include <linux/sched.h>\n#include <linux/vmalloc.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n#include <linux/highmem.h>\n#include <linux/memremap.h>\n#include <linux/memblock.h>\n#include <linux/mmzone.h>\n#include <linux/mm.h>\n\nvoid __meminit vmemmap_verify(pte_t *pte, int node,\n\t\t\t\tunsigned long start, unsigned long end)\n{\n\tunsigned long pfn = pte_pfn(*pte);\n\tint actual_node = early_pfn_to_nid(pfn);\n\n\tif (node_distance(actual_node, node) > LOCAL_DISTANCE)\n\t\tpr_warn(\"[%lx-%lx] potential offnode page_structs\\n\",\n\t\t\tstart, end - 1);\n}"
  },
  {
    "function_name": "altmap_alloc_block_buf",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18397/repo/mm/sparse-vmemmap.c",
    "lines": "105-130",
    "snippet": "void * __meminit altmap_alloc_block_buf(unsigned long size,\n\t\tstruct vmem_altmap *altmap)\n{\n\tunsigned long pfn, nr_pfns, nr_align;\n\n\tif (size & ~PAGE_MASK) {\n\t\tpr_warn_once(\"%s: allocations must be multiple of PAGE_SIZE (%ld)\\n\",\n\t\t\t\t__func__, size);\n\t\treturn NULL;\n\t}\n\n\tpfn = vmem_altmap_next_pfn(altmap);\n\tnr_pfns = size >> PAGE_SHIFT;\n\tnr_align = 1UL << find_first_bit(&nr_pfns, BITS_PER_LONG);\n\tnr_align = ALIGN(pfn, nr_align) - pfn;\n\tif (nr_pfns + nr_align > vmem_altmap_nr_free(altmap))\n\t\treturn NULL;\n\n\taltmap->alloc += nr_pfns;\n\taltmap->align += nr_align;\n\tpfn += nr_align;\n\n\tpr_debug(\"%s: pfn: %#lx alloc: %ld align: %ld nr: %#lx\\n\",\n\t\t\t__func__, pfn, altmap->alloc, altmap->align, nr_pfns);\n\treturn __va(__pfn_to_phys(pfn));\n}",
    "includes": [
      "#include <asm/pgtable.h>",
      "#include <asm/pgalloc.h>",
      "#include <asm/dma.h>",
      "#include <linux/sched.h>",
      "#include <linux/vmalloc.h>",
      "#include <linux/spinlock.h>",
      "#include <linux/slab.h>",
      "#include <linux/highmem.h>",
      "#include <linux/memremap.h>",
      "#include <linux/memblock.h>",
      "#include <linux/mmzone.h>",
      "#include <linux/mm.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "__va",
          "args": [
            "__pfn_to_phys(pfn)"
          ],
          "line": 129
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "__pfn_to_phys",
          "args": [
            "pfn"
          ],
          "line": 129
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pr_debug",
          "args": [
            "\"%s: pfn: %#lx alloc: %ld align: %ld nr: %#lx\\n\"",
            "__func__",
            "pfn",
            "altmap->alloc",
            "altmap->align",
            "nr_pfns"
          ],
          "line": 127
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "vmem_altmap_nr_free",
          "args": [
            "altmap"
          ],
          "line": 120
        },
        "resolved": true,
        "details": {
          "function_name": "vmem_altmap_nr_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18397/repo/mm/sparse-vmemmap.c",
          "lines": "89-96",
          "snippet": "static unsigned long __meminit vmem_altmap_nr_free(struct vmem_altmap *altmap)\n{\n\tunsigned long allocated = altmap->alloc + altmap->align;\n\n\tif (altmap->free > allocated)\n\t\treturn altmap->free - allocated;\n\treturn 0;\n}",
          "includes": [
            "#include <asm/pgtable.h>",
            "#include <asm/pgalloc.h>",
            "#include <asm/dma.h>",
            "#include <linux/sched.h>",
            "#include <linux/vmalloc.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/slab.h>",
            "#include <linux/highmem.h>",
            "#include <linux/memremap.h>",
            "#include <linux/memblock.h>",
            "#include <linux/mmzone.h>",
            "#include <linux/mm.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <asm/pgtable.h>\n#include <asm/pgalloc.h>\n#include <asm/dma.h>\n#include <linux/sched.h>\n#include <linux/vmalloc.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n#include <linux/highmem.h>\n#include <linux/memremap.h>\n#include <linux/memblock.h>\n#include <linux/mmzone.h>\n#include <linux/mm.h>\n\nstatic unsigned long __meminit vmem_altmap_nr_free(struct vmem_altmap *altmap)\n{\n\tunsigned long allocated = altmap->alloc + altmap->align;\n\n\tif (altmap->free > allocated)\n\t\treturn altmap->free - allocated;\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ALIGN",
          "args": [
            "pfn",
            "nr_align"
          ],
          "line": 119
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "find_first_bit",
          "args": [
            "&nr_pfns",
            "BITS_PER_LONG"
          ],
          "line": 118
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "vmem_altmap_next_pfn",
          "args": [
            "altmap"
          ],
          "line": 116
        },
        "resolved": true,
        "details": {
          "function_name": "vmem_altmap_next_pfn",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18397/repo/mm/sparse-vmemmap.c",
          "lines": "83-87",
          "snippet": "static unsigned long __meminit vmem_altmap_next_pfn(struct vmem_altmap *altmap)\n{\n\treturn altmap->base_pfn + altmap->reserve + altmap->alloc\n\t\t+ altmap->align;\n}",
          "includes": [
            "#include <asm/pgtable.h>",
            "#include <asm/pgalloc.h>",
            "#include <asm/dma.h>",
            "#include <linux/sched.h>",
            "#include <linux/vmalloc.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/slab.h>",
            "#include <linux/highmem.h>",
            "#include <linux/memremap.h>",
            "#include <linux/memblock.h>",
            "#include <linux/mmzone.h>",
            "#include <linux/mm.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <asm/pgtable.h>\n#include <asm/pgalloc.h>\n#include <asm/dma.h>\n#include <linux/sched.h>\n#include <linux/vmalloc.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n#include <linux/highmem.h>\n#include <linux/memremap.h>\n#include <linux/memblock.h>\n#include <linux/mmzone.h>\n#include <linux/mm.h>\n\nstatic unsigned long __meminit vmem_altmap_next_pfn(struct vmem_altmap *altmap)\n{\n\treturn altmap->base_pfn + altmap->reserve + altmap->alloc\n\t\t+ altmap->align;\n}"
        }
      },
      {
        "call_info": {
          "callee": "pr_warn_once",
          "args": [
            "\"%s: allocations must be multiple of PAGE_SIZE (%ld)\\n\"",
            "__func__",
            "size"
          ],
          "line": 111
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <asm/pgtable.h>\n#include <asm/pgalloc.h>\n#include <asm/dma.h>\n#include <linux/sched.h>\n#include <linux/vmalloc.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n#include <linux/highmem.h>\n#include <linux/memremap.h>\n#include <linux/memblock.h>\n#include <linux/mmzone.h>\n#include <linux/mm.h>\n\nvoid * __meminit altmap_alloc_block_buf(unsigned long size,\n\t\tstruct vmem_altmap *altmap)\n{\n\tunsigned long pfn, nr_pfns, nr_align;\n\n\tif (size & ~PAGE_MASK) {\n\t\tpr_warn_once(\"%s: allocations must be multiple of PAGE_SIZE (%ld)\\n\",\n\t\t\t\t__func__, size);\n\t\treturn NULL;\n\t}\n\n\tpfn = vmem_altmap_next_pfn(altmap);\n\tnr_pfns = size >> PAGE_SHIFT;\n\tnr_align = 1UL << find_first_bit(&nr_pfns, BITS_PER_LONG);\n\tnr_align = ALIGN(pfn, nr_align) - pfn;\n\tif (nr_pfns + nr_align > vmem_altmap_nr_free(altmap))\n\t\treturn NULL;\n\n\taltmap->alloc += nr_pfns;\n\taltmap->align += nr_align;\n\tpfn += nr_align;\n\n\tpr_debug(\"%s: pfn: %#lx alloc: %ld align: %ld nr: %#lx\\n\",\n\t\t\t__func__, pfn, altmap->alloc, altmap->align, nr_pfns);\n\treturn __va(__pfn_to_phys(pfn));\n}"
  },
  {
    "function_name": "vmem_altmap_nr_free",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18397/repo/mm/sparse-vmemmap.c",
    "lines": "89-96",
    "snippet": "static unsigned long __meminit vmem_altmap_nr_free(struct vmem_altmap *altmap)\n{\n\tunsigned long allocated = altmap->alloc + altmap->align;\n\n\tif (altmap->free > allocated)\n\t\treturn altmap->free - allocated;\n\treturn 0;\n}",
    "includes": [
      "#include <asm/pgtable.h>",
      "#include <asm/pgalloc.h>",
      "#include <asm/dma.h>",
      "#include <linux/sched.h>",
      "#include <linux/vmalloc.h>",
      "#include <linux/spinlock.h>",
      "#include <linux/slab.h>",
      "#include <linux/highmem.h>",
      "#include <linux/memremap.h>",
      "#include <linux/memblock.h>",
      "#include <linux/mmzone.h>",
      "#include <linux/mm.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include <asm/pgtable.h>\n#include <asm/pgalloc.h>\n#include <asm/dma.h>\n#include <linux/sched.h>\n#include <linux/vmalloc.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n#include <linux/highmem.h>\n#include <linux/memremap.h>\n#include <linux/memblock.h>\n#include <linux/mmzone.h>\n#include <linux/mm.h>\n\nstatic unsigned long __meminit vmem_altmap_nr_free(struct vmem_altmap *altmap)\n{\n\tunsigned long allocated = altmap->alloc + altmap->align;\n\n\tif (altmap->free > allocated)\n\t\treturn altmap->free - allocated;\n\treturn 0;\n}"
  },
  {
    "function_name": "vmem_altmap_next_pfn",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18397/repo/mm/sparse-vmemmap.c",
    "lines": "83-87",
    "snippet": "static unsigned long __meminit vmem_altmap_next_pfn(struct vmem_altmap *altmap)\n{\n\treturn altmap->base_pfn + altmap->reserve + altmap->alloc\n\t\t+ altmap->align;\n}",
    "includes": [
      "#include <asm/pgtable.h>",
      "#include <asm/pgalloc.h>",
      "#include <asm/dma.h>",
      "#include <linux/sched.h>",
      "#include <linux/vmalloc.h>",
      "#include <linux/spinlock.h>",
      "#include <linux/slab.h>",
      "#include <linux/highmem.h>",
      "#include <linux/memremap.h>",
      "#include <linux/memblock.h>",
      "#include <linux/mmzone.h>",
      "#include <linux/mm.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include <asm/pgtable.h>\n#include <asm/pgalloc.h>\n#include <asm/dma.h>\n#include <linux/sched.h>\n#include <linux/vmalloc.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n#include <linux/highmem.h>\n#include <linux/memremap.h>\n#include <linux/memblock.h>\n#include <linux/mmzone.h>\n#include <linux/mm.h>\n\nstatic unsigned long __meminit vmem_altmap_next_pfn(struct vmem_altmap *altmap)\n{\n\treturn altmap->base_pfn + altmap->reserve + altmap->alloc\n\t\t+ altmap->align;\n}"
  },
  {
    "function_name": "vmemmap_alloc_block_buf",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18397/repo/mm/sparse-vmemmap.c",
    "lines": "74-81",
    "snippet": "void * __meminit vmemmap_alloc_block_buf(unsigned long size, int node)\n{\n\tvoid *ptr = sparse_buffer_alloc(size);\n\n\tif (!ptr)\n\t\tptr = vmemmap_alloc_block(size, node);\n\treturn ptr;\n}",
    "includes": [
      "#include <asm/pgtable.h>",
      "#include <asm/pgalloc.h>",
      "#include <asm/dma.h>",
      "#include <linux/sched.h>",
      "#include <linux/vmalloc.h>",
      "#include <linux/spinlock.h>",
      "#include <linux/slab.h>",
      "#include <linux/highmem.h>",
      "#include <linux/memremap.h>",
      "#include <linux/memblock.h>",
      "#include <linux/mmzone.h>",
      "#include <linux/mm.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "vmemmap_alloc_block",
          "args": [
            "size",
            "node"
          ],
          "line": 79
        },
        "resolved": true,
        "details": {
          "function_name": "vmemmap_alloc_block_zero",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18397/repo/mm/sparse-vmemmap.c",
          "lines": "157-166",
          "snippet": "static void * __meminit vmemmap_alloc_block_zero(unsigned long size, int node)\n{\n\tvoid *p = vmemmap_alloc_block(size, node);\n\n\tif (!p)\n\t\treturn NULL;\n\tmemset(p, 0, size);\n\n\treturn p;\n}",
          "includes": [
            "#include <asm/pgtable.h>",
            "#include <asm/pgalloc.h>",
            "#include <asm/dma.h>",
            "#include <linux/sched.h>",
            "#include <linux/vmalloc.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/slab.h>",
            "#include <linux/highmem.h>",
            "#include <linux/memremap.h>",
            "#include <linux/memblock.h>",
            "#include <linux/mmzone.h>",
            "#include <linux/mm.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <asm/pgtable.h>\n#include <asm/pgalloc.h>\n#include <asm/dma.h>\n#include <linux/sched.h>\n#include <linux/vmalloc.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n#include <linux/highmem.h>\n#include <linux/memremap.h>\n#include <linux/memblock.h>\n#include <linux/mmzone.h>\n#include <linux/mm.h>\n\nstatic void * __meminit vmemmap_alloc_block_zero(unsigned long size, int node)\n{\n\tvoid *p = vmemmap_alloc_block(size, node);\n\n\tif (!p)\n\t\treturn NULL;\n\tmemset(p, 0, size);\n\n\treturn p;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sparse_buffer_alloc",
          "args": [
            "size"
          ],
          "line": 76
        },
        "resolved": true,
        "details": {
          "function_name": "sparse_buffer_alloc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18397/repo/mm/sparse.c",
          "lines": "424-436",
          "snippet": "void * __meminit sparse_buffer_alloc(unsigned long size)\n{\n\tvoid *ptr = NULL;\n\n\tif (sparsemap_buf) {\n\t\tptr = PTR_ALIGN(sparsemap_buf, size);\n\t\tif (ptr + size > sparsemap_buf_end)\n\t\t\tptr = NULL;\n\t\telse\n\t\t\tsparsemap_buf = ptr + size;\n\t}\n\treturn ptr;\n}",
          "includes": [
            "#include <asm/pgtable.h>",
            "#include <asm/pgalloc.h>",
            "#include <asm/dma.h>",
            "#include \"internal.h\"",
            "#include <linux/vmalloc.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/export.h>",
            "#include <linux/highmem.h>",
            "#include <linux/compiler.h>",
            "#include <linux/memblock.h>",
            "#include <linux/mmzone.h>",
            "#include <linux/slab.h>",
            "#include <linux/mm.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void *sparsemap_buf",
            "static void *sparsemap_buf_end"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <asm/pgtable.h>\n#include <asm/pgalloc.h>\n#include <asm/dma.h>\n#include \"internal.h\"\n#include <linux/vmalloc.h>\n#include <linux/spinlock.h>\n#include <linux/export.h>\n#include <linux/highmem.h>\n#include <linux/compiler.h>\n#include <linux/memblock.h>\n#include <linux/mmzone.h>\n#include <linux/slab.h>\n#include <linux/mm.h>\n\nstatic void *sparsemap_buf;\nstatic void *sparsemap_buf_end;\n\nvoid * __meminit sparse_buffer_alloc(unsigned long size)\n{\n\tvoid *ptr = NULL;\n\n\tif (sparsemap_buf) {\n\t\tptr = PTR_ALIGN(sparsemap_buf, size);\n\t\tif (ptr + size > sparsemap_buf_end)\n\t\t\tptr = NULL;\n\t\telse\n\t\t\tsparsemap_buf = ptr + size;\n\t}\n\treturn ptr;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <asm/pgtable.h>\n#include <asm/pgalloc.h>\n#include <asm/dma.h>\n#include <linux/sched.h>\n#include <linux/vmalloc.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n#include <linux/highmem.h>\n#include <linux/memremap.h>\n#include <linux/memblock.h>\n#include <linux/mmzone.h>\n#include <linux/mm.h>\n\nvoid * __meminit vmemmap_alloc_block_buf(unsigned long size, int node)\n{\n\tvoid *ptr = sparse_buffer_alloc(size);\n\n\tif (!ptr)\n\t\tptr = vmemmap_alloc_block(size, node);\n\treturn ptr;\n}"
  },
  {
    "function_name": "vmemmap_alloc_block",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18397/repo/mm/sparse-vmemmap.c",
    "lines": "49-71",
    "snippet": "void * __meminit vmemmap_alloc_block(unsigned long size, int node)\n{\n\t/* If the main allocator is up use that, fallback to bootmem. */\n\tif (slab_is_available()) {\n\t\tgfp_t gfp_mask = GFP_KERNEL|__GFP_RETRY_MAYFAIL|__GFP_NOWARN;\n\t\tint order = get_order(size);\n\t\tstatic bool warned;\n\t\tstruct page *page;\n\n\t\tpage = alloc_pages_node(node, gfp_mask, order);\n\t\tif (page)\n\t\t\treturn page_address(page);\n\n\t\tif (!warned) {\n\t\t\twarn_alloc(gfp_mask & ~__GFP_NOWARN, NULL,\n\t\t\t\t   \"vmemmap alloc failure: order:%u\", order);\n\t\t\twarned = true;\n\t\t}\n\t\treturn NULL;\n\t} else\n\t\treturn __earlyonly_bootmem_alloc(node, size, size,\n\t\t\t\t__pa(MAX_DMA_ADDRESS));\n}",
    "includes": [
      "#include <asm/pgtable.h>",
      "#include <asm/pgalloc.h>",
      "#include <asm/dma.h>",
      "#include <linux/sched.h>",
      "#include <linux/vmalloc.h>",
      "#include <linux/spinlock.h>",
      "#include <linux/slab.h>",
      "#include <linux/highmem.h>",
      "#include <linux/memremap.h>",
      "#include <linux/memblock.h>",
      "#include <linux/mmzone.h>",
      "#include <linux/mm.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "__earlyonly_bootmem_alloc",
          "args": [
            "node",
            "size",
            "size",
            "__pa(MAX_DMA_ADDRESS)"
          ],
          "line": 69
        },
        "resolved": true,
        "details": {
          "function_name": "__earlyonly_bootmem_alloc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18397/repo/mm/sparse-vmemmap.c",
          "lines": "40-47",
          "snippet": "static void * __ref __earlyonly_bootmem_alloc(int node,\n\t\t\t\tunsigned long size,\n\t\t\t\tunsigned long align,\n\t\t\t\tunsigned long goal)\n{\n\treturn memblock_alloc_try_nid_raw(size, align, goal,\n\t\t\t\t\t       MEMBLOCK_ALLOC_ACCESSIBLE, node);\n}",
          "includes": [
            "#include <asm/pgtable.h>",
            "#include <asm/pgalloc.h>",
            "#include <asm/dma.h>",
            "#include <linux/sched.h>",
            "#include <linux/vmalloc.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/slab.h>",
            "#include <linux/highmem.h>",
            "#include <linux/memremap.h>",
            "#include <linux/memblock.h>",
            "#include <linux/mmzone.h>",
            "#include <linux/mm.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <asm/pgtable.h>\n#include <asm/pgalloc.h>\n#include <asm/dma.h>\n#include <linux/sched.h>\n#include <linux/vmalloc.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n#include <linux/highmem.h>\n#include <linux/memremap.h>\n#include <linux/memblock.h>\n#include <linux/mmzone.h>\n#include <linux/mm.h>\n\nstatic void * __ref __earlyonly_bootmem_alloc(int node,\n\t\t\t\tunsigned long size,\n\t\t\t\tunsigned long align,\n\t\t\t\tunsigned long goal)\n{\n\treturn memblock_alloc_try_nid_raw(size, align, goal,\n\t\t\t\t\t       MEMBLOCK_ALLOC_ACCESSIBLE, node);\n}"
        }
      },
      {
        "call_info": {
          "callee": "__pa",
          "args": [
            "MAX_DMA_ADDRESS"
          ],
          "line": 70
        },
        "resolved": true,
        "details": {
          "function_name": "__page_mapcount",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18397/repo/mm/util.c",
          "lines": "536-552",
          "snippet": "int __page_mapcount(struct page *page)\n{\n\tint ret;\n\n\tret = atomic_read(&page->_mapcount) + 1;\n\t/*\n\t * For file THP page->_mapcount contains total number of mapping\n\t * of the page: no need to look into compound_mapcount.\n\t */\n\tif (!PageAnon(page) && !PageHuge(page))\n\t\treturn ret;\n\tpage = compound_head(page);\n\tret += atomic_read(compound_mapcount_ptr(page)) + 1;\n\tif (PageDoubleMap(page))\n\t\tret--;\n\treturn ret;\n}",
          "includes": [
            "#include \"internal.h\"",
            "#include <linux/uaccess.h>",
            "#include <linux/userfaultfd_k.h>",
            "#include <linux/vmalloc.h>",
            "#include <linux/hugetlb.h>",
            "#include <linux/mman.h>",
            "#include <linux/swapops.h>",
            "#include <linux/swap.h>",
            "#include <linux/security.h>",
            "#include <linux/sched/task_stack.h>",
            "#include <linux/sched/mm.h>",
            "#include <linux/sched.h>",
            "#include <linux/err.h>",
            "#include <linux/export.h>",
            "#include <linux/compiler.h>",
            "#include <linux/string.h>",
            "#include <linux/slab.h>",
            "#include <linux/mm.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"internal.h\"\n#include <linux/uaccess.h>\n#include <linux/userfaultfd_k.h>\n#include <linux/vmalloc.h>\n#include <linux/hugetlb.h>\n#include <linux/mman.h>\n#include <linux/swapops.h>\n#include <linux/swap.h>\n#include <linux/security.h>\n#include <linux/sched/task_stack.h>\n#include <linux/sched/mm.h>\n#include <linux/sched.h>\n#include <linux/err.h>\n#include <linux/export.h>\n#include <linux/compiler.h>\n#include <linux/string.h>\n#include <linux/slab.h>\n#include <linux/mm.h>\n\nint __page_mapcount(struct page *page)\n{\n\tint ret;\n\n\tret = atomic_read(&page->_mapcount) + 1;\n\t/*\n\t * For file THP page->_mapcount contains total number of mapping\n\t * of the page: no need to look into compound_mapcount.\n\t */\n\tif (!PageAnon(page) && !PageHuge(page))\n\t\treturn ret;\n\tpage = compound_head(page);\n\tret += atomic_read(compound_mapcount_ptr(page)) + 1;\n\tif (PageDoubleMap(page))\n\t\tret--;\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "warn_alloc",
          "args": [
            "gfp_mask & ~__GFP_NOWARN",
            "NULL",
            "\"vmemmap alloc failure: order:%u\"",
            "order"
          ],
          "line": 63
        },
        "resolved": true,
        "details": {
          "function_name": "warn_alloc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18397/repo/mm/page_alloc.c",
          "lines": "3403-3425",
          "snippet": "void warn_alloc(gfp_t gfp_mask, nodemask_t *nodemask, const char *fmt, ...)\n{\n\tstruct va_format vaf;\n\tva_list args;\n\tstatic DEFINE_RATELIMIT_STATE(nopage_rs, DEFAULT_RATELIMIT_INTERVAL,\n\t\t\t\t      DEFAULT_RATELIMIT_BURST);\n\n\tif ((gfp_mask & __GFP_NOWARN) || !__ratelimit(&nopage_rs))\n\t\treturn;\n\n\tva_start(args, fmt);\n\tvaf.fmt = fmt;\n\tvaf.va = &args;\n\tpr_warn(\"%s: %pV, mode:%#x(%pGg), nodemask=%*pbl\\n\",\n\t\t\tcurrent->comm, &vaf, gfp_mask, &gfp_mask,\n\t\t\tnodemask_pr_args(nodemask));\n\tva_end(args);\n\n\tcpuset_print_current_mems_allowed();\n\n\tdump_stack();\n\twarn_alloc_show_mem(gfp_mask, nodemask);\n}",
          "includes": [
            "#include \"internal.h\"",
            "#include <asm/div64.h>",
            "#include <asm/tlbflush.h>",
            "#include <asm/sections.h>",
            "#include <linux/psi.h>",
            "#include <linux/nmi.h>",
            "#include <linux/lockdep.h>",
            "#include <linux/ftrace.h>",
            "#include <linux/memcontrol.h>",
            "#include <linux/kthread.h>",
            "#include <linux/page_owner.h>",
            "#include <linux/sched/mm.h>",
            "#include <linux/sched/rt.h>",
            "#include <linux/hugetlb.h>",
            "#include <linux/migrate.h>",
            "#include <linux/mm_inline.h>",
            "#include <linux/prefetch.h>",
            "#include <trace/events/oom.h>",
            "#include <trace/events/kmem.h>",
            "#include <linux/compaction.h>",
            "#include <linux/kmemleak.h>",
            "#include <linux/debugobjects.h>",
            "#include <linux/page_ext.h>",
            "#include <linux/page-isolation.h>",
            "#include <linux/fault-inject.h>",
            "#include <linux/backing-dev.h>",
            "#include <linux/pfn.h>",
            "#include <linux/sort.h>",
            "#include <linux/stop_machine.h>",
            "#include <linux/memremap.h>",
            "#include <linux/mempolicy.h>",
            "#include <linux/vmstat.h>",
            "#include <linux/vmalloc.h>",
            "#include <linux/nodemask.h>",
            "#include <linux/memory_hotplug.h>",
            "#include <linux/cpuset.h>",
            "#include <linux/cpu.h>",
            "#include <linux/sysctl.h>",
            "#include <linux/topology.h>",
            "#include <linux/oom.h>",
            "#include <linux/ratelimit.h>",
            "#include <linux/slab.h>",
            "#include <linux/blkdev.h>",
            "#include <linux/pagevec.h>",
            "#include <linux/suspend.h>",
            "#include <linux/module.h>",
            "#include <linux/kasan.h>",
            "#include <linux/kernel.h>",
            "#include <linux/compiler.h>",
            "#include <linux/memblock.h>",
            "#include <linux/jiffies.h>",
            "#include <linux/pagemap.h>",
            "#include <linux/interrupt.h>",
            "#include <linux/swap.h>",
            "#include <linux/mm.h>",
            "#include <linux/stddef.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static __always_inline\nstruct",
            "static __always_inline struct"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"internal.h\"\n#include <asm/div64.h>\n#include <asm/tlbflush.h>\n#include <asm/sections.h>\n#include <linux/psi.h>\n#include <linux/nmi.h>\n#include <linux/lockdep.h>\n#include <linux/ftrace.h>\n#include <linux/memcontrol.h>\n#include <linux/kthread.h>\n#include <linux/page_owner.h>\n#include <linux/sched/mm.h>\n#include <linux/sched/rt.h>\n#include <linux/hugetlb.h>\n#include <linux/migrate.h>\n#include <linux/mm_inline.h>\n#include <linux/prefetch.h>\n#include <trace/events/oom.h>\n#include <trace/events/kmem.h>\n#include <linux/compaction.h>\n#include <linux/kmemleak.h>\n#include <linux/debugobjects.h>\n#include <linux/page_ext.h>\n#include <linux/page-isolation.h>\n#include <linux/fault-inject.h>\n#include <linux/backing-dev.h>\n#include <linux/pfn.h>\n#include <linux/sort.h>\n#include <linux/stop_machine.h>\n#include <linux/memremap.h>\n#include <linux/mempolicy.h>\n#include <linux/vmstat.h>\n#include <linux/vmalloc.h>\n#include <linux/nodemask.h>\n#include <linux/memory_hotplug.h>\n#include <linux/cpuset.h>\n#include <linux/cpu.h>\n#include <linux/sysctl.h>\n#include <linux/topology.h>\n#include <linux/oom.h>\n#include <linux/ratelimit.h>\n#include <linux/slab.h>\n#include <linux/blkdev.h>\n#include <linux/pagevec.h>\n#include <linux/suspend.h>\n#include <linux/module.h>\n#include <linux/kasan.h>\n#include <linux/kernel.h>\n#include <linux/compiler.h>\n#include <linux/memblock.h>\n#include <linux/jiffies.h>\n#include <linux/pagemap.h>\n#include <linux/interrupt.h>\n#include <linux/swap.h>\n#include <linux/mm.h>\n#include <linux/stddef.h>\n\nstatic __always_inline\nstruct;\nstatic __always_inline struct;\n\nvoid warn_alloc(gfp_t gfp_mask, nodemask_t *nodemask, const char *fmt, ...)\n{\n\tstruct va_format vaf;\n\tva_list args;\n\tstatic DEFINE_RATELIMIT_STATE(nopage_rs, DEFAULT_RATELIMIT_INTERVAL,\n\t\t\t\t      DEFAULT_RATELIMIT_BURST);\n\n\tif ((gfp_mask & __GFP_NOWARN) || !__ratelimit(&nopage_rs))\n\t\treturn;\n\n\tva_start(args, fmt);\n\tvaf.fmt = fmt;\n\tvaf.va = &args;\n\tpr_warn(\"%s: %pV, mode:%#x(%pGg), nodemask=%*pbl\\n\",\n\t\t\tcurrent->comm, &vaf, gfp_mask, &gfp_mask,\n\t\t\tnodemask_pr_args(nodemask));\n\tva_end(args);\n\n\tcpuset_print_current_mems_allowed();\n\n\tdump_stack();\n\twarn_alloc_show_mem(gfp_mask, nodemask);\n}"
        }
      },
      {
        "call_info": {
          "callee": "page_address",
          "args": [
            "page"
          ],
          "line": 60
        },
        "resolved": true,
        "details": {
          "function_name": "page_address",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18397/repo/mm/highmem.c",
          "lines": "409-434",
          "snippet": "void *page_address(const struct page *page)\n{\n\tunsigned long flags;\n\tvoid *ret;\n\tstruct page_address_slot *pas;\n\n\tif (!PageHighMem(page))\n\t\treturn lowmem_page_address(page);\n\n\tpas = page_slot(page);\n\tret = NULL;\n\tspin_lock_irqsave(&pas->lock, flags);\n\tif (!list_empty(&pas->lh)) {\n\t\tstruct page_address_map *pam;\n\n\t\tlist_for_each_entry(pam, &pas->lh, list) {\n\t\t\tif (pam->page == page) {\n\t\t\t\tret = pam->virtual;\n\t\t\t\tgoto done;\n\t\t\t}\n\t\t}\n\t}\ndone:\n\tspin_unlock_irqrestore(&pas->lock, flags);\n\treturn ret;\n}",
          "includes": [
            "#include <asm/tlbflush.h>",
            "#include <linux/kgdb.h>",
            "#include <linux/highmem.h>",
            "#include <linux/hash.h>",
            "#include <linux/init.h>",
            "#include <linux/blkdev.h>",
            "#include <linux/mempool.h>",
            "#include <linux/pagemap.h>",
            "#include <linux/bio.h>",
            "#include <linux/swap.h>",
            "#include <linux/export.h>",
            "#include <linux/mm.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <asm/tlbflush.h>\n#include <linux/kgdb.h>\n#include <linux/highmem.h>\n#include <linux/hash.h>\n#include <linux/init.h>\n#include <linux/blkdev.h>\n#include <linux/mempool.h>\n#include <linux/pagemap.h>\n#include <linux/bio.h>\n#include <linux/swap.h>\n#include <linux/export.h>\n#include <linux/mm.h>\n\nvoid *page_address(const struct page *page)\n{\n\tunsigned long flags;\n\tvoid *ret;\n\tstruct page_address_slot *pas;\n\n\tif (!PageHighMem(page))\n\t\treturn lowmem_page_address(page);\n\n\tpas = page_slot(page);\n\tret = NULL;\n\tspin_lock_irqsave(&pas->lock, flags);\n\tif (!list_empty(&pas->lh)) {\n\t\tstruct page_address_map *pam;\n\n\t\tlist_for_each_entry(pam, &pas->lh, list) {\n\t\t\tif (pam->page == page) {\n\t\t\t\tret = pam->virtual;\n\t\t\t\tgoto done;\n\t\t\t}\n\t\t}\n\t}\ndone:\n\tspin_unlock_irqrestore(&pas->lock, flags);\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "alloc_pages_node",
          "args": [
            "node",
            "gfp_mask",
            "order"
          ],
          "line": 58
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_order",
          "args": [
            "size"
          ],
          "line": 54
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "slab_is_available",
          "args": [],
          "line": 52
        },
        "resolved": true,
        "details": {
          "function_name": "slab_is_available",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18397/repo/mm/slab_common.c",
          "lines": "930-933",
          "snippet": "bool slab_is_available(void)\n{\n\treturn slab_state >= UP;\n}",
          "includes": [
            "#include \"slab.h\"",
            "#include <trace/events/kmem.h>",
            "#include <linux/memcontrol.h>",
            "#include <asm/page.h>",
            "#include <asm/tlbflush.h>",
            "#include <asm/cacheflush.h>",
            "#include <linux/proc_fs.h>",
            "#include <linux/seq_file.h>",
            "#include <linux/uaccess.h>",
            "#include <linux/cpu.h>",
            "#include <linux/module.h>",
            "#include <linux/compiler.h>",
            "#include <linux/cache.h>",
            "#include <linux/memory.h>",
            "#include <linux/interrupt.h>",
            "#include <linux/poison.h>",
            "#include <linux/mm.h>",
            "#include <linux/slab.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "enum slab_state slab_state;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"slab.h\"\n#include <trace/events/kmem.h>\n#include <linux/memcontrol.h>\n#include <asm/page.h>\n#include <asm/tlbflush.h>\n#include <asm/cacheflush.h>\n#include <linux/proc_fs.h>\n#include <linux/seq_file.h>\n#include <linux/uaccess.h>\n#include <linux/cpu.h>\n#include <linux/module.h>\n#include <linux/compiler.h>\n#include <linux/cache.h>\n#include <linux/memory.h>\n#include <linux/interrupt.h>\n#include <linux/poison.h>\n#include <linux/mm.h>\n#include <linux/slab.h>\n\nenum slab_state slab_state;\n\nbool slab_is_available(void)\n{\n\treturn slab_state >= UP;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <asm/pgtable.h>\n#include <asm/pgalloc.h>\n#include <asm/dma.h>\n#include <linux/sched.h>\n#include <linux/vmalloc.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n#include <linux/highmem.h>\n#include <linux/memremap.h>\n#include <linux/memblock.h>\n#include <linux/mmzone.h>\n#include <linux/mm.h>\n\nvoid * __meminit vmemmap_alloc_block(unsigned long size, int node)\n{\n\t/* If the main allocator is up use that, fallback to bootmem. */\n\tif (slab_is_available()) {\n\t\tgfp_t gfp_mask = GFP_KERNEL|__GFP_RETRY_MAYFAIL|__GFP_NOWARN;\n\t\tint order = get_order(size);\n\t\tstatic bool warned;\n\t\tstruct page *page;\n\n\t\tpage = alloc_pages_node(node, gfp_mask, order);\n\t\tif (page)\n\t\t\treturn page_address(page);\n\n\t\tif (!warned) {\n\t\t\twarn_alloc(gfp_mask & ~__GFP_NOWARN, NULL,\n\t\t\t\t   \"vmemmap alloc failure: order:%u\", order);\n\t\t\twarned = true;\n\t\t}\n\t\treturn NULL;\n\t} else\n\t\treturn __earlyonly_bootmem_alloc(node, size, size,\n\t\t\t\t__pa(MAX_DMA_ADDRESS));\n}"
  },
  {
    "function_name": "__earlyonly_bootmem_alloc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18397/repo/mm/sparse-vmemmap.c",
    "lines": "40-47",
    "snippet": "static void * __ref __earlyonly_bootmem_alloc(int node,\n\t\t\t\tunsigned long size,\n\t\t\t\tunsigned long align,\n\t\t\t\tunsigned long goal)\n{\n\treturn memblock_alloc_try_nid_raw(size, align, goal,\n\t\t\t\t\t       MEMBLOCK_ALLOC_ACCESSIBLE, node);\n}",
    "includes": [
      "#include <asm/pgtable.h>",
      "#include <asm/pgalloc.h>",
      "#include <asm/dma.h>",
      "#include <linux/sched.h>",
      "#include <linux/vmalloc.h>",
      "#include <linux/spinlock.h>",
      "#include <linux/slab.h>",
      "#include <linux/highmem.h>",
      "#include <linux/memremap.h>",
      "#include <linux/memblock.h>",
      "#include <linux/mmzone.h>",
      "#include <linux/mm.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "memblock_alloc_try_nid_raw",
          "args": [
            "size",
            "align",
            "goal",
            "MEMBLOCK_ALLOC_ACCESSIBLE",
            "node"
          ],
          "line": 45
        },
        "resolved": true,
        "details": {
          "function_name": "memblock_alloc_try_nid_raw",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18397/repo/mm/memblock.c",
          "lines": "1445-1462",
          "snippet": "void * __init memblock_alloc_try_nid_raw(\n\t\t\tphys_addr_t size, phys_addr_t align,\n\t\t\tphys_addr_t min_addr, phys_addr_t max_addr,\n\t\t\tint nid)\n{\n\tvoid *ptr;\n\n\tmemblock_dbg(\"%s: %llu bytes align=0x%llx nid=%d from=%pa max_addr=%pa %pF\\n\",\n\t\t     __func__, (u64)size, (u64)align, nid, &min_addr,\n\t\t     &max_addr, (void *)_RET_IP_);\n\n\tptr = memblock_alloc_internal(size, align,\n\t\t\t\t\t   min_addr, max_addr, nid);\n\tif (ptr && size > 0)\n\t\tpage_init_poison(ptr, size);\n\n\treturn ptr;\n}",
          "includes": [
            "#include \"internal.h\"",
            "#include <linux/io.h>",
            "#include <asm/sections.h>",
            "#include <linux/memblock.h>",
            "#include <linux/seq_file.h>",
            "#include <linux/kmemleak.h>",
            "#include <linux/debugfs.h>",
            "#include <linux/pfn.h>",
            "#include <linux/poison.h>",
            "#include <linux/bitops.h>",
            "#include <linux/init.h>",
            "#include <linux/slab.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"internal.h\"\n#include <linux/io.h>\n#include <asm/sections.h>\n#include <linux/memblock.h>\n#include <linux/seq_file.h>\n#include <linux/kmemleak.h>\n#include <linux/debugfs.h>\n#include <linux/pfn.h>\n#include <linux/poison.h>\n#include <linux/bitops.h>\n#include <linux/init.h>\n#include <linux/slab.h>\n#include <linux/kernel.h>\n\nvoid * __init memblock_alloc_try_nid_raw(\n\t\t\tphys_addr_t size, phys_addr_t align,\n\t\t\tphys_addr_t min_addr, phys_addr_t max_addr,\n\t\t\tint nid)\n{\n\tvoid *ptr;\n\n\tmemblock_dbg(\"%s: %llu bytes align=0x%llx nid=%d from=%pa max_addr=%pa %pF\\n\",\n\t\t     __func__, (u64)size, (u64)align, nid, &min_addr,\n\t\t     &max_addr, (void *)_RET_IP_);\n\n\tptr = memblock_alloc_internal(size, align,\n\t\t\t\t\t   min_addr, max_addr, nid);\n\tif (ptr && size > 0)\n\t\tpage_init_poison(ptr, size);\n\n\treturn ptr;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <asm/pgtable.h>\n#include <asm/pgalloc.h>\n#include <asm/dma.h>\n#include <linux/sched.h>\n#include <linux/vmalloc.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n#include <linux/highmem.h>\n#include <linux/memremap.h>\n#include <linux/memblock.h>\n#include <linux/mmzone.h>\n#include <linux/mm.h>\n\nstatic void * __ref __earlyonly_bootmem_alloc(int node,\n\t\t\t\tunsigned long size,\n\t\t\t\tunsigned long align,\n\t\t\t\tunsigned long goal)\n{\n\treturn memblock_alloc_try_nid_raw(size, align, goal,\n\t\t\t\t\t       MEMBLOCK_ALLOC_ACCESSIBLE, node);\n}"
  }
]