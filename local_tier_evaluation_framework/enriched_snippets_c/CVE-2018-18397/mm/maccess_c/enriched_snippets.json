[
  {
    "function_name": "strncpy_from_unsafe",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18397/repo/mm/maccess.c",
    "lines": "90-113",
    "snippet": "long strncpy_from_unsafe(char *dst, const void *unsafe_addr, long count)\n{\n\tmm_segment_t old_fs = get_fs();\n\tconst void *src = unsafe_addr;\n\tlong ret;\n\n\tif (unlikely(count <= 0))\n\t\treturn 0;\n\n\tset_fs(KERNEL_DS);\n\tpagefault_disable();\n\tcurrent->kernel_uaccess_faults_ok++;\n\n\tdo {\n\t\tret = __get_user(*dst++, (const char __user __force *)src++);\n\t} while (dst[-1] && ret == 0 && src - unsafe_addr < count);\n\n\tcurrent->kernel_uaccess_faults_ok--;\n\tdst[-1] = '\\0';\n\tpagefault_enable();\n\tset_fs(old_fs);\n\n\treturn ret ? -EFAULT : src - unsafe_addr;\n}",
    "includes": [
      "#include <linux/uaccess.h>",
      "#include <linux/mm.h>",
      "#include <linux/export.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "set_fs",
          "args": [
            "old_fs"
          ],
          "line": 110
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pagefault_enable",
          "args": [],
          "line": 109
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "__get_user",
          "args": [
            "*dst++",
            "(const char __user __force *)src++"
          ],
          "line": 104
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pagefault_disable",
          "args": [],
          "line": 100
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "set_fs",
          "args": [
            "KERNEL_DS"
          ],
          "line": 99
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "unlikely",
          "args": [
            "count <= 0"
          ],
          "line": 96
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_fs",
          "args": [],
          "line": 92
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/uaccess.h>\n#include <linux/mm.h>\n#include <linux/export.h>\n\nlong strncpy_from_unsafe(char *dst, const void *unsafe_addr, long count)\n{\n\tmm_segment_t old_fs = get_fs();\n\tconst void *src = unsafe_addr;\n\tlong ret;\n\n\tif (unlikely(count <= 0))\n\t\treturn 0;\n\n\tset_fs(KERNEL_DS);\n\tpagefault_disable();\n\tcurrent->kernel_uaccess_faults_ok++;\n\n\tdo {\n\t\tret = __get_user(*dst++, (const char __user __force *)src++);\n\t} while (dst[-1] && ret == 0 && src - unsafe_addr < count);\n\n\tcurrent->kernel_uaccess_faults_ok--;\n\tdst[-1] = '\\0';\n\tpagefault_enable();\n\tset_fs(old_fs);\n\n\treturn ret ? -EFAULT : src - unsafe_addr;\n}"
  },
  {
    "function_name": "__probe_kernel_write",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18397/repo/mm/maccess.c",
    "lines": "56-70",
    "snippet": "long __probe_kernel_write(void *dst, const void *src, size_t size)\n{\n\tlong ret;\n\tmm_segment_t old_fs = get_fs();\n\n\tset_fs(KERNEL_DS);\n\tpagefault_disable();\n\tcurrent->kernel_uaccess_faults_ok++;\n\tret = __copy_to_user_inatomic((__force void __user *)dst, src, size);\n\tcurrent->kernel_uaccess_faults_ok--;\n\tpagefault_enable();\n\tset_fs(old_fs);\n\n\treturn ret ? -EFAULT : 0;\n}",
    "includes": [
      "#include <linux/uaccess.h>",
      "#include <linux/mm.h>",
      "#include <linux/export.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "long __weak probe_kernel_write(void *dst, const void *src, size_t size)\n    __attribute__((alias(\"__probe_kernel_write\")));"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "set_fs",
          "args": [
            "old_fs"
          ],
          "line": 67
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pagefault_enable",
          "args": [],
          "line": 66
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "__copy_to_user_inatomic",
          "args": [
            "(__force void __user *)dst",
            "src",
            "size"
          ],
          "line": 64
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pagefault_disable",
          "args": [],
          "line": 62
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "set_fs",
          "args": [
            "KERNEL_DS"
          ],
          "line": 61
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_fs",
          "args": [],
          "line": 59
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/uaccess.h>\n#include <linux/mm.h>\n#include <linux/export.h>\n\nlong __weak probe_kernel_write(void *dst, const void *src, size_t size)\n    __attribute__((alias(\"__probe_kernel_write\")));\n\nlong __probe_kernel_write(void *dst, const void *src, size_t size)\n{\n\tlong ret;\n\tmm_segment_t old_fs = get_fs();\n\n\tset_fs(KERNEL_DS);\n\tpagefault_disable();\n\tcurrent->kernel_uaccess_faults_ok++;\n\tret = __copy_to_user_inatomic((__force void __user *)dst, src, size);\n\tcurrent->kernel_uaccess_faults_ok--;\n\tpagefault_enable();\n\tset_fs(old_fs);\n\n\treturn ret ? -EFAULT : 0;\n}"
  },
  {
    "function_name": "__probe_kernel_read",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18397/repo/mm/maccess.c",
    "lines": "26-41",
    "snippet": "long __probe_kernel_read(void *dst, const void *src, size_t size)\n{\n\tlong ret;\n\tmm_segment_t old_fs = get_fs();\n\n\tset_fs(KERNEL_DS);\n\tpagefault_disable();\n\tcurrent->kernel_uaccess_faults_ok++;\n\tret = __copy_from_user_inatomic(dst,\n\t\t\t(__force const void __user *)src, size);\n\tcurrent->kernel_uaccess_faults_ok--;\n\tpagefault_enable();\n\tset_fs(old_fs);\n\n\treturn ret ? -EFAULT : 0;\n}",
    "includes": [
      "#include <linux/uaccess.h>",
      "#include <linux/mm.h>",
      "#include <linux/export.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "long __weak probe_kernel_read(void *dst, const void *src, size_t size)\n    __attribute__((alias(\"__probe_kernel_read\")));"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "set_fs",
          "args": [
            "old_fs"
          ],
          "line": 38
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pagefault_enable",
          "args": [],
          "line": 37
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "__copy_from_user_inatomic",
          "args": [
            "dst",
            "(__force const void __user *)src",
            "size"
          ],
          "line": 34
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pagefault_disable",
          "args": [],
          "line": 32
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "set_fs",
          "args": [
            "KERNEL_DS"
          ],
          "line": 31
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_fs",
          "args": [],
          "line": 29
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/uaccess.h>\n#include <linux/mm.h>\n#include <linux/export.h>\n\nlong __weak probe_kernel_read(void *dst, const void *src, size_t size)\n    __attribute__((alias(\"__probe_kernel_read\")));\n\nlong __probe_kernel_read(void *dst, const void *src, size_t size)\n{\n\tlong ret;\n\tmm_segment_t old_fs = get_fs();\n\n\tset_fs(KERNEL_DS);\n\tpagefault_disable();\n\tcurrent->kernel_uaccess_faults_ok++;\n\tret = __copy_from_user_inatomic(dst,\n\t\t\t(__force const void __user *)src, size);\n\tcurrent->kernel_uaccess_faults_ok--;\n\tpagefault_enable();\n\tset_fs(old_fs);\n\n\treturn ret ? -EFAULT : 0;\n}"
  }
]