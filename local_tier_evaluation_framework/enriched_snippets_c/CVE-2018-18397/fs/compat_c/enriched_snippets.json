[
  {
    "function_name": "do_nfs4_super_data_conv",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18397/repo/fs/compat.c",
    "lines": "58-88",
    "snippet": "static int do_nfs4_super_data_conv(void *raw_data)\n{\n\tint version = *(compat_uint_t *) raw_data;\n\n\tif (version == 1) {\n\t\tstruct compat_nfs4_mount_data_v1 *raw = raw_data;\n\t\tstruct nfs4_mount_data *real = raw_data;\n\n\t\t/* copy the fields backwards */\n\t\treal->auth_flavours = compat_ptr(raw->auth_flavours);\n\t\treal->auth_flavourlen = raw->auth_flavourlen;\n\t\treal->proto = raw->proto;\n\t\treal->host_addr = compat_ptr(raw->host_addr);\n\t\treal->host_addrlen = raw->host_addrlen;\n\t\tcompat_nfs_string(&real->hostname, &raw->hostname);\n\t\tcompat_nfs_string(&real->mnt_path, &raw->mnt_path);\n\t\tcompat_nfs_string(&real->client_addr, &raw->client_addr);\n\t\treal->acdirmax = raw->acdirmax;\n\t\treal->acdirmin = raw->acdirmin;\n\t\treal->acregmax = raw->acregmax;\n\t\treal->acregmin = raw->acregmin;\n\t\treal->retrans = raw->retrans;\n\t\treal->timeo = raw->timeo;\n\t\treal->wsize = raw->wsize;\n\t\treal->rsize = raw->rsize;\n\t\treal->flags = raw->flags;\n\t\treal->version = raw->version;\n\t}\n\n\treturn 0;\n}",
    "includes": [
      "#include \"internal.h\"",
      "#include <linux/uaccess.h>",
      "#include <linux/slab.h>",
      "#include <linux/syscalls.h>",
      "#include <linux/nfs4_mount.h>",
      "#include <linux/compat.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "compat_nfs_string",
          "args": [
            "&real->client_addr",
            "&raw->client_addr"
          ],
          "line": 74
        },
        "resolved": true,
        "details": {
          "function_name": "compat_nfs_string",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18397/repo/fs/compat.c",
          "lines": "30-35",
          "snippet": "static inline void compat_nfs_string(struct nfs_string *dst,\n\t\t\t\t     struct compat_nfs_string *src)\n{\n\tdst->data = compat_ptr(src->data);\n\tdst->len = src->len;\n}",
          "includes": [
            "#include \"internal.h\"",
            "#include <linux/uaccess.h>",
            "#include <linux/slab.h>",
            "#include <linux/syscalls.h>",
            "#include <linux/nfs4_mount.h>",
            "#include <linux/compat.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"internal.h\"\n#include <linux/uaccess.h>\n#include <linux/slab.h>\n#include <linux/syscalls.h>\n#include <linux/nfs4_mount.h>\n#include <linux/compat.h>\n\nstatic inline void compat_nfs_string(struct nfs_string *dst,\n\t\t\t\t     struct compat_nfs_string *src)\n{\n\tdst->data = compat_ptr(src->data);\n\tdst->len = src->len;\n}"
        }
      },
      {
        "call_info": {
          "callee": "compat_ptr",
          "args": [
            "raw->host_addr"
          ],
          "line": 70
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "compat_ptr",
          "args": [
            "raw->auth_flavours"
          ],
          "line": 67
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"internal.h\"\n#include <linux/uaccess.h>\n#include <linux/slab.h>\n#include <linux/syscalls.h>\n#include <linux/nfs4_mount.h>\n#include <linux/compat.h>\n\nstatic int do_nfs4_super_data_conv(void *raw_data)\n{\n\tint version = *(compat_uint_t *) raw_data;\n\n\tif (version == 1) {\n\t\tstruct compat_nfs4_mount_data_v1 *raw = raw_data;\n\t\tstruct nfs4_mount_data *real = raw_data;\n\n\t\t/* copy the fields backwards */\n\t\treal->auth_flavours = compat_ptr(raw->auth_flavours);\n\t\treal->auth_flavourlen = raw->auth_flavourlen;\n\t\treal->proto = raw->proto;\n\t\treal->host_addr = compat_ptr(raw->host_addr);\n\t\treal->host_addrlen = raw->host_addrlen;\n\t\tcompat_nfs_string(&real->hostname, &raw->hostname);\n\t\tcompat_nfs_string(&real->mnt_path, &raw->mnt_path);\n\t\tcompat_nfs_string(&real->client_addr, &raw->client_addr);\n\t\treal->acdirmax = raw->acdirmax;\n\t\treal->acdirmin = raw->acdirmin;\n\t\treal->acregmax = raw->acregmax;\n\t\treal->acregmin = raw->acregmin;\n\t\treal->retrans = raw->retrans;\n\t\treal->timeo = raw->timeo;\n\t\treal->wsize = raw->wsize;\n\t\treal->rsize = raw->rsize;\n\t\treal->flags = raw->flags;\n\t\treal->version = raw->version;\n\t}\n\n\treturn 0;\n}"
  },
  {
    "function_name": "compat_nfs_string",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18397/repo/fs/compat.c",
    "lines": "30-35",
    "snippet": "static inline void compat_nfs_string(struct nfs_string *dst,\n\t\t\t\t     struct compat_nfs_string *src)\n{\n\tdst->data = compat_ptr(src->data);\n\tdst->len = src->len;\n}",
    "includes": [
      "#include \"internal.h\"",
      "#include <linux/uaccess.h>",
      "#include <linux/slab.h>",
      "#include <linux/syscalls.h>",
      "#include <linux/nfs4_mount.h>",
      "#include <linux/compat.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "compat_ptr",
          "args": [
            "src->data"
          ],
          "line": 33
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"internal.h\"\n#include <linux/uaccess.h>\n#include <linux/slab.h>\n#include <linux/syscalls.h>\n#include <linux/nfs4_mount.h>\n#include <linux/compat.h>\n\nstatic inline void compat_nfs_string(struct nfs_string *dst,\n\t\t\t\t     struct compat_nfs_string *src)\n{\n\tdst->data = compat_ptr(src->data);\n\tdst->len = src->len;\n}"
  },
  {
    "function_name": "mount",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18397/repo/fs/compat.c",
    "lines": "92-135",
    "snippet": "SYSCALL_DEFINE5(mount, const char __user *, dev_name,\n\t\t       const char __user *, dir_name,\n\t\t       const char __user *, type, compat_ulong_t, flags,\n\t\t       const void __user *, data)\n{\n\tchar *kernel_type;\n\tvoid *options;\n\tchar *kernel_dev;\n\tint retval;\n\n\tkernel_type = copy_mount_string(type);\n\tretval = PTR_ERR(kernel_type);\n\tif (IS_ERR(kernel_type))\n\t\tgoto out;\n\n\tkernel_dev = copy_mount_string(dev_name);\n\tretval = PTR_ERR(kernel_dev);\n\tif (IS_ERR(kernel_dev))\n\t\tgoto out1;\n\n\toptions = copy_mount_options(data);\n\tretval = PTR_ERR(options);\n\tif (IS_ERR(options))\n\t\tgoto out2;\n\n\tif (kernel_type && options) {\n\t\tif (!strcmp(kernel_type, NFS4_NAME)) {\n\t\t\tretval = -EINVAL;\n\t\t\tif (do_nfs4_super_data_conv(options))\n\t\t\t\tgoto out3;\n\t\t}\n\t}\n\n\tretval = do_mount(kernel_dev, dir_name, kernel_type, flags, options);\n\n out3:\n\tkfree(options);\n out2:\n\tkfree(kernel_dev);\n out1:\n\tkfree(kernel_type);\n out:\n\treturn retval;\n}",
    "includes": [
      "#include \"internal.h\"",
      "#include <linux/uaccess.h>",
      "#include <linux/slab.h>",
      "#include <linux/syscalls.h>",
      "#include <linux/nfs4_mount.h>",
      "#include <linux/compat.h>"
    ],
    "macros_used": [
      "#define NFS4_NAME\t\"nfs4\""
    ],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"internal.h\"\n#include <linux/uaccess.h>\n#include <linux/slab.h>\n#include <linux/syscalls.h>\n#include <linux/nfs4_mount.h>\n#include <linux/compat.h>\n\n#define NFS4_NAME\t\"nfs4\"\n\nSYSCALL_DEFINE5(mount, const char __user *, dev_name,\n\t\t       const char __user *, dir_name,\n\t\t       const char __user *, type, compat_ulong_t, flags,\n\t\t       const void __user *, data)\n{\n\tchar *kernel_type;\n\tvoid *options;\n\tchar *kernel_dev;\n\tint retval;\n\n\tkernel_type = copy_mount_string(type);\n\tretval = PTR_ERR(kernel_type);\n\tif (IS_ERR(kernel_type))\n\t\tgoto out;\n\n\tkernel_dev = copy_mount_string(dev_name);\n\tretval = PTR_ERR(kernel_dev);\n\tif (IS_ERR(kernel_dev))\n\t\tgoto out1;\n\n\toptions = copy_mount_options(data);\n\tretval = PTR_ERR(options);\n\tif (IS_ERR(options))\n\t\tgoto out2;\n\n\tif (kernel_type && options) {\n\t\tif (!strcmp(kernel_type, NFS4_NAME)) {\n\t\t\tretval = -EINVAL;\n\t\t\tif (do_nfs4_super_data_conv(options))\n\t\t\t\tgoto out3;\n\t\t}\n\t}\n\n\tretval = do_mount(kernel_dev, dir_name, kernel_type, flags, options);\n\n out3:\n\tkfree(options);\n out2:\n\tkfree(kernel_dev);\n out1:\n\tkfree(kernel_type);\n out:\n\treturn retval;\n}"
  }
]