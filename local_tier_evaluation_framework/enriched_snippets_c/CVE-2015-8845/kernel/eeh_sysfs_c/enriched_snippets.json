[
  {
    "function_name": "eeh_sysfs_remove_device",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2015-8845/repo/arch/powerpc/kernel/eeh_sysfs.c",
    "lines": "116-137",
    "snippet": "void eeh_sysfs_remove_device(struct pci_dev *pdev)\n{\n\tstruct eeh_dev *edev = pci_dev_to_eeh_dev(pdev);\n\n\t/*\n\t * The parent directory might have been removed. We needn't\n\t * continue for that case.\n\t */\n\tif (!pdev->dev.kobj.sd) {\n\t\tif (edev)\n\t\t\tedev->mode &= ~EEH_DEV_SYSFS;\n\t\treturn;\n\t}\n\n\tdevice_remove_file(&pdev->dev, &dev_attr_eeh_mode);\n\tdevice_remove_file(&pdev->dev, &dev_attr_eeh_config_addr);\n\tdevice_remove_file(&pdev->dev, &dev_attr_eeh_pe_config_addr);\n\tdevice_remove_file(&pdev->dev, &dev_attr_eeh_pe_state);\n\n\tif (edev)\n\t\tedev->mode &= ~EEH_DEV_SYSFS;\n}",
    "includes": [
      "#include <asm/pci-bridge.h>",
      "#include <asm/ppc-pci.h>",
      "#include <linux/stat.h>",
      "#include <linux/pci.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "device_remove_file",
          "args": [
            "&pdev->dev",
            "&dev_attr_eeh_pe_state"
          ],
          "line": 133
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device_remove_file",
          "args": [
            "&pdev->dev",
            "&dev_attr_eeh_pe_config_addr"
          ],
          "line": 132
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device_remove_file",
          "args": [
            "&pdev->dev",
            "&dev_attr_eeh_config_addr"
          ],
          "line": 131
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device_remove_file",
          "args": [
            "&pdev->dev",
            "&dev_attr_eeh_mode"
          ],
          "line": 130
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pci_dev_to_eeh_dev",
          "args": [
            "pdev"
          ],
          "line": 118
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <asm/pci-bridge.h>\n#include <asm/ppc-pci.h>\n#include <linux/stat.h>\n#include <linux/pci.h>\n\nvoid eeh_sysfs_remove_device(struct pci_dev *pdev)\n{\n\tstruct eeh_dev *edev = pci_dev_to_eeh_dev(pdev);\n\n\t/*\n\t * The parent directory might have been removed. We needn't\n\t * continue for that case.\n\t */\n\tif (!pdev->dev.kobj.sd) {\n\t\tif (edev)\n\t\t\tedev->mode &= ~EEH_DEV_SYSFS;\n\t\treturn;\n\t}\n\n\tdevice_remove_file(&pdev->dev, &dev_attr_eeh_mode);\n\tdevice_remove_file(&pdev->dev, &dev_attr_eeh_config_addr);\n\tdevice_remove_file(&pdev->dev, &dev_attr_eeh_pe_config_addr);\n\tdevice_remove_file(&pdev->dev, &dev_attr_eeh_pe_state);\n\n\tif (edev)\n\t\tedev->mode &= ~EEH_DEV_SYSFS;\n}"
  },
  {
    "function_name": "eeh_sysfs_add_device",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2015-8845/repo/arch/powerpc/kernel/eeh_sysfs.c",
    "lines": "94-114",
    "snippet": "void eeh_sysfs_add_device(struct pci_dev *pdev)\n{\n\tstruct eeh_dev *edev = pci_dev_to_eeh_dev(pdev);\n\tint rc=0;\n\n\tif (!eeh_enabled())\n\t\treturn;\n\n\tif (edev && (edev->mode & EEH_DEV_SYSFS))\n\t\treturn;\n\n\trc += device_create_file(&pdev->dev, &dev_attr_eeh_mode);\n\trc += device_create_file(&pdev->dev, &dev_attr_eeh_config_addr);\n\trc += device_create_file(&pdev->dev, &dev_attr_eeh_pe_config_addr);\n\trc += device_create_file(&pdev->dev, &dev_attr_eeh_pe_state);\n\n\tif (rc)\n\t\tpr_warn(\"EEH: Unable to create sysfs entries\\n\");\n\telse if (edev)\n\t\tedev->mode |= EEH_DEV_SYSFS;\n}",
    "includes": [
      "#include <asm/pci-bridge.h>",
      "#include <asm/ppc-pci.h>",
      "#include <linux/stat.h>",
      "#include <linux/pci.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "pr_warn",
          "args": [
            "\"EEH: Unable to create sysfs entries\\n\""
          ],
          "line": 111
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device_create_file",
          "args": [
            "&pdev->dev",
            "&dev_attr_eeh_pe_state"
          ],
          "line": 108
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device_create_file",
          "args": [
            "&pdev->dev",
            "&dev_attr_eeh_pe_config_addr"
          ],
          "line": 107
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device_create_file",
          "args": [
            "&pdev->dev",
            "&dev_attr_eeh_config_addr"
          ],
          "line": 106
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device_create_file",
          "args": [
            "&pdev->dev",
            "&dev_attr_eeh_mode"
          ],
          "line": 105
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "eeh_enabled",
          "args": [],
          "line": 99
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pci_dev_to_eeh_dev",
          "args": [
            "pdev"
          ],
          "line": 96
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <asm/pci-bridge.h>\n#include <asm/ppc-pci.h>\n#include <linux/stat.h>\n#include <linux/pci.h>\n\nvoid eeh_sysfs_add_device(struct pci_dev *pdev)\n{\n\tstruct eeh_dev *edev = pci_dev_to_eeh_dev(pdev);\n\tint rc=0;\n\n\tif (!eeh_enabled())\n\t\treturn;\n\n\tif (edev && (edev->mode & EEH_DEV_SYSFS))\n\t\treturn;\n\n\trc += device_create_file(&pdev->dev, &dev_attr_eeh_mode);\n\trc += device_create_file(&pdev->dev, &dev_attr_eeh_config_addr);\n\trc += device_create_file(&pdev->dev, &dev_attr_eeh_pe_config_addr);\n\trc += device_create_file(&pdev->dev, &dev_attr_eeh_pe_state);\n\n\tif (rc)\n\t\tpr_warn(\"EEH: Unable to create sysfs entries\\n\");\n\telse if (edev)\n\t\tedev->mode |= EEH_DEV_SYSFS;\n}"
  },
  {
    "function_name": "eeh_pe_state_store",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2015-8845/repo/arch/powerpc/kernel/eeh_sysfs.c",
    "lines": "72-90",
    "snippet": "static ssize_t eeh_pe_state_store(struct device *dev,\n\t\t\t\t  struct device_attribute *attr,\n\t\t\t\t  const char *buf, size_t count)\n{\n\tstruct pci_dev *pdev = to_pci_dev(dev);\n\tstruct eeh_dev *edev = pci_dev_to_eeh_dev(pdev);\n\n\tif (!edev || !edev->pe)\n\t\treturn -ENODEV;\n\n\t/* Nothing to do if it's not frozen */\n\tif (!(edev->pe->state & EEH_PE_ISOLATED))\n\t\treturn count;\n\n\tif (eeh_unfreeze_pe(edev->pe, true))\n\t\treturn -EIO;\n\n\treturn count;\n}",
    "includes": [
      "#include <asm/pci-bridge.h>",
      "#include <asm/ppc-pci.h>",
      "#include <linux/stat.h>",
      "#include <linux/pci.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "eeh_unfreeze_pe",
          "args": [
            "edev->pe",
            "true"
          ],
          "line": 86
        },
        "resolved": true,
        "details": {
          "function_name": "eeh_unfreeze_pe",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2015-8845/repo/arch/powerpc/kernel/eeh.c",
          "lines": "1265-1288",
          "snippet": "int eeh_unfreeze_pe(struct eeh_pe *pe, bool sw_state)\n{\n\tint ret;\n\n\tret = eeh_pci_enable(pe, EEH_OPT_THAW_MMIO);\n\tif (ret) {\n\t\tpr_warn(\"%s: Failure %d enabling IO on PHB#%x-PE#%x\\n\",\n\t\t\t__func__, ret, pe->phb->global_number, pe->addr);\n\t\treturn ret;\n\t}\n\n\tret = eeh_pci_enable(pe, EEH_OPT_THAW_DMA);\n\tif (ret) {\n\t\tpr_warn(\"%s: Failure %d enabling DMA on PHB#%x-PE#%x\\n\",\n\t\t\t__func__, ret, pe->phb->global_number, pe->addr);\n\t\treturn ret;\n\t}\n\n\t/* Clear software isolated state */\n\tif (sw_state && (pe->state & EEH_PE_ISOLATED))\n\t\teeh_pe_state_clear(pe, EEH_PE_ISOLATED);\n\n\treturn ret;\n}",
          "includes": [
            "#include <asm/rtas.h>",
            "#include <asm/ppc-pci.h>",
            "#include <asm/machdep.h>",
            "#include <asm/iommu.h>",
            "#include <asm/io.h>",
            "#include <asm/eeh_event.h>",
            "#include <asm/eeh.h>",
            "#include <asm/debug.h>",
            "#include <linux/atomic.h>",
            "#include <linux/of.h>",
            "#include <linux/export.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/seq_file.h>",
            "#include <linux/reboot.h>",
            "#include <linux/rbtree.h>",
            "#include <linux/proc_fs.h>",
            "#include <linux/iommu.h>",
            "#include <linux/pci.h>",
            "#include <linux/list.h>",
            "#include <linux/init.h>",
            "#include <linux/sched.h>",
            "#include <linux/debugfs.h>",
            "#include <linux/delay.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <asm/rtas.h>\n#include <asm/ppc-pci.h>\n#include <asm/machdep.h>\n#include <asm/iommu.h>\n#include <asm/io.h>\n#include <asm/eeh_event.h>\n#include <asm/eeh.h>\n#include <asm/debug.h>\n#include <linux/atomic.h>\n#include <linux/of.h>\n#include <linux/export.h>\n#include <linux/spinlock.h>\n#include <linux/seq_file.h>\n#include <linux/reboot.h>\n#include <linux/rbtree.h>\n#include <linux/proc_fs.h>\n#include <linux/iommu.h>\n#include <linux/pci.h>\n#include <linux/list.h>\n#include <linux/init.h>\n#include <linux/sched.h>\n#include <linux/debugfs.h>\n#include <linux/delay.h>\n\nint eeh_unfreeze_pe(struct eeh_pe *pe, bool sw_state)\n{\n\tint ret;\n\n\tret = eeh_pci_enable(pe, EEH_OPT_THAW_MMIO);\n\tif (ret) {\n\t\tpr_warn(\"%s: Failure %d enabling IO on PHB#%x-PE#%x\\n\",\n\t\t\t__func__, ret, pe->phb->global_number, pe->addr);\n\t\treturn ret;\n\t}\n\n\tret = eeh_pci_enable(pe, EEH_OPT_THAW_DMA);\n\tif (ret) {\n\t\tpr_warn(\"%s: Failure %d enabling DMA on PHB#%x-PE#%x\\n\",\n\t\t\t__func__, ret, pe->phb->global_number, pe->addr);\n\t\treturn ret;\n\t}\n\n\t/* Clear software isolated state */\n\tif (sw_state && (pe->state & EEH_PE_ISOLATED))\n\t\teeh_pe_state_clear(pe, EEH_PE_ISOLATED);\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "pci_dev_to_eeh_dev",
          "args": [
            "pdev"
          ],
          "line": 77
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "to_pci_dev",
          "args": [
            "dev"
          ],
          "line": 76
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <asm/pci-bridge.h>\n#include <asm/ppc-pci.h>\n#include <linux/stat.h>\n#include <linux/pci.h>\n\nstatic ssize_t eeh_pe_state_store(struct device *dev,\n\t\t\t\t  struct device_attribute *attr,\n\t\t\t\t  const char *buf, size_t count)\n{\n\tstruct pci_dev *pdev = to_pci_dev(dev);\n\tstruct eeh_dev *edev = pci_dev_to_eeh_dev(pdev);\n\n\tif (!edev || !edev->pe)\n\t\treturn -ENODEV;\n\n\t/* Nothing to do if it's not frozen */\n\tif (!(edev->pe->state & EEH_PE_ISOLATED))\n\t\treturn count;\n\n\tif (eeh_unfreeze_pe(edev->pe, true))\n\t\treturn -EIO;\n\n\treturn count;\n}"
  },
  {
    "function_name": "eeh_pe_state_show",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2015-8845/repo/arch/powerpc/kernel/eeh_sysfs.c",
    "lines": "57-70",
    "snippet": "static ssize_t eeh_pe_state_show(struct device *dev,\n\t\t\t\t struct device_attribute *attr, char *buf)\n{\n\tstruct pci_dev *pdev = to_pci_dev(dev);\n\tstruct eeh_dev *edev = pci_dev_to_eeh_dev(pdev);\n\tint state;\n\n\tif (!edev || !edev->pe)\n\t\treturn -ENODEV;\n\n\tstate = eeh_ops->get_state(edev->pe, NULL);\n\treturn sprintf(buf, \"0x%08x 0x%08x\\n\",\n\t\t       state, edev->pe->state);\n}",
    "includes": [
      "#include <asm/pci-bridge.h>",
      "#include <asm/ppc-pci.h>",
      "#include <linux/stat.h>",
      "#include <linux/pci.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            "buf",
            "\"0x%08x 0x%08x\\n\"",
            "state",
            "edev->pe->state"
          ],
          "line": 68
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "eeh_ops->get_state",
          "args": [
            "edev->pe",
            "NULL"
          ],
          "line": 67
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pci_dev_to_eeh_dev",
          "args": [
            "pdev"
          ],
          "line": 61
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "to_pci_dev",
          "args": [
            "dev"
          ],
          "line": 60
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <asm/pci-bridge.h>\n#include <asm/ppc-pci.h>\n#include <linux/stat.h>\n#include <linux/pci.h>\n\nstatic ssize_t eeh_pe_state_show(struct device *dev,\n\t\t\t\t struct device_attribute *attr, char *buf)\n{\n\tstruct pci_dev *pdev = to_pci_dev(dev);\n\tstruct eeh_dev *edev = pci_dev_to_eeh_dev(pdev);\n\tint state;\n\n\tif (!edev || !edev->pe)\n\t\treturn -ENODEV;\n\n\tstate = eeh_ops->get_state(edev->pe, NULL);\n\treturn sprintf(buf, \"0x%08x 0x%08x\\n\",\n\t\t       state, edev->pe->state);\n}"
  }
]