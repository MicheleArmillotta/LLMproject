[
  {
    "function_name": "save_stack_trace_tsk",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2015-8845/repo/arch/powerpc/kernel/stacktrace.c",
    "lines": "59-62",
    "snippet": "void save_stack_trace_tsk(struct task_struct *tsk, struct stack_trace *trace)\n{\n\tsave_context_stack(trace, tsk->thread.ksp, tsk, 0);\n}",
    "includes": [
      "#include <asm/processor.h>",
      "#include <asm/ptrace.h>",
      "#include <linux/stacktrace.h>",
      "#include <linux/sched.h>",
      "#include <linux/export.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "save_context_stack",
          "args": [
            "trace",
            "tsk->thread.ksp",
            "tsk",
            "0"
          ],
          "line": 61
        },
        "resolved": true,
        "details": {
          "function_name": "save_context_stack",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2015-8845/repo/arch/powerpc/kernel/stacktrace.c",
          "lines": "22-47",
          "snippet": "static void save_context_stack(struct stack_trace *trace, unsigned long sp,\n\t\t\tstruct task_struct *tsk, int savesched)\n{\n\tfor (;;) {\n\t\tunsigned long *stack = (unsigned long *) sp;\n\t\tunsigned long newsp, ip;\n\n\t\tif (!validate_sp(sp, tsk, STACK_FRAME_OVERHEAD))\n\t\t\treturn;\n\n\t\tnewsp = stack[0];\n\t\tip = stack[STACK_FRAME_LR_SAVE];\n\n\t\tif (savesched || !in_sched_functions(ip)) {\n\t\t\tif (!trace->skip)\n\t\t\t\ttrace->entries[trace->nr_entries++] = ip;\n\t\t\telse\n\t\t\t\ttrace->skip--;\n\t\t}\n\n\t\tif (trace->nr_entries >= trace->max_entries)\n\t\t\treturn;\n\n\t\tsp = newsp;\n\t}\n}",
          "includes": [
            "#include <asm/processor.h>",
            "#include <asm/ptrace.h>",
            "#include <linux/stacktrace.h>",
            "#include <linux/sched.h>",
            "#include <linux/export.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <asm/processor.h>\n#include <asm/ptrace.h>\n#include <linux/stacktrace.h>\n#include <linux/sched.h>\n#include <linux/export.h>\n\nstatic void save_context_stack(struct stack_trace *trace, unsigned long sp,\n\t\t\tstruct task_struct *tsk, int savesched)\n{\n\tfor (;;) {\n\t\tunsigned long *stack = (unsigned long *) sp;\n\t\tunsigned long newsp, ip;\n\n\t\tif (!validate_sp(sp, tsk, STACK_FRAME_OVERHEAD))\n\t\t\treturn;\n\n\t\tnewsp = stack[0];\n\t\tip = stack[STACK_FRAME_LR_SAVE];\n\n\t\tif (savesched || !in_sched_functions(ip)) {\n\t\t\tif (!trace->skip)\n\t\t\t\ttrace->entries[trace->nr_entries++] = ip;\n\t\t\telse\n\t\t\t\ttrace->skip--;\n\t\t}\n\n\t\tif (trace->nr_entries >= trace->max_entries)\n\t\t\treturn;\n\n\t\tsp = newsp;\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "#include <asm/processor.h>\n#include <asm/ptrace.h>\n#include <linux/stacktrace.h>\n#include <linux/sched.h>\n#include <linux/export.h>\n\nvoid save_stack_trace_tsk(struct task_struct *tsk, struct stack_trace *trace)\n{\n\tsave_context_stack(trace, tsk->thread.ksp, tsk, 0);\n}"
  },
  {
    "function_name": "save_stack_trace",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2015-8845/repo/arch/powerpc/kernel/stacktrace.c",
    "lines": "49-56",
    "snippet": "void save_stack_trace(struct stack_trace *trace)\n{\n\tunsigned long sp;\n\n\tsp = current_stack_pointer();\n\n\tsave_context_stack(trace, sp, current, 1);\n}",
    "includes": [
      "#include <asm/processor.h>",
      "#include <asm/ptrace.h>",
      "#include <linux/stacktrace.h>",
      "#include <linux/sched.h>",
      "#include <linux/export.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "save_context_stack",
          "args": [
            "trace",
            "sp",
            "current",
            "1"
          ],
          "line": 55
        },
        "resolved": true,
        "details": {
          "function_name": "save_context_stack",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2015-8845/repo/arch/powerpc/kernel/stacktrace.c",
          "lines": "22-47",
          "snippet": "static void save_context_stack(struct stack_trace *trace, unsigned long sp,\n\t\t\tstruct task_struct *tsk, int savesched)\n{\n\tfor (;;) {\n\t\tunsigned long *stack = (unsigned long *) sp;\n\t\tunsigned long newsp, ip;\n\n\t\tif (!validate_sp(sp, tsk, STACK_FRAME_OVERHEAD))\n\t\t\treturn;\n\n\t\tnewsp = stack[0];\n\t\tip = stack[STACK_FRAME_LR_SAVE];\n\n\t\tif (savesched || !in_sched_functions(ip)) {\n\t\t\tif (!trace->skip)\n\t\t\t\ttrace->entries[trace->nr_entries++] = ip;\n\t\t\telse\n\t\t\t\ttrace->skip--;\n\t\t}\n\n\t\tif (trace->nr_entries >= trace->max_entries)\n\t\t\treturn;\n\n\t\tsp = newsp;\n\t}\n}",
          "includes": [
            "#include <asm/processor.h>",
            "#include <asm/ptrace.h>",
            "#include <linux/stacktrace.h>",
            "#include <linux/sched.h>",
            "#include <linux/export.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <asm/processor.h>\n#include <asm/ptrace.h>\n#include <linux/stacktrace.h>\n#include <linux/sched.h>\n#include <linux/export.h>\n\nstatic void save_context_stack(struct stack_trace *trace, unsigned long sp,\n\t\t\tstruct task_struct *tsk, int savesched)\n{\n\tfor (;;) {\n\t\tunsigned long *stack = (unsigned long *) sp;\n\t\tunsigned long newsp, ip;\n\n\t\tif (!validate_sp(sp, tsk, STACK_FRAME_OVERHEAD))\n\t\t\treturn;\n\n\t\tnewsp = stack[0];\n\t\tip = stack[STACK_FRAME_LR_SAVE];\n\n\t\tif (savesched || !in_sched_functions(ip)) {\n\t\t\tif (!trace->skip)\n\t\t\t\ttrace->entries[trace->nr_entries++] = ip;\n\t\t\telse\n\t\t\t\ttrace->skip--;\n\t\t}\n\n\t\tif (trace->nr_entries >= trace->max_entries)\n\t\t\treturn;\n\n\t\tsp = newsp;\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "current_stack_pointer",
          "args": [],
          "line": 53
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <asm/processor.h>\n#include <asm/ptrace.h>\n#include <linux/stacktrace.h>\n#include <linux/sched.h>\n#include <linux/export.h>\n\nvoid save_stack_trace(struct stack_trace *trace)\n{\n\tunsigned long sp;\n\n\tsp = current_stack_pointer();\n\n\tsave_context_stack(trace, sp, current, 1);\n}"
  },
  {
    "function_name": "save_context_stack",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2015-8845/repo/arch/powerpc/kernel/stacktrace.c",
    "lines": "22-47",
    "snippet": "static void save_context_stack(struct stack_trace *trace, unsigned long sp,\n\t\t\tstruct task_struct *tsk, int savesched)\n{\n\tfor (;;) {\n\t\tunsigned long *stack = (unsigned long *) sp;\n\t\tunsigned long newsp, ip;\n\n\t\tif (!validate_sp(sp, tsk, STACK_FRAME_OVERHEAD))\n\t\t\treturn;\n\n\t\tnewsp = stack[0];\n\t\tip = stack[STACK_FRAME_LR_SAVE];\n\n\t\tif (savesched || !in_sched_functions(ip)) {\n\t\t\tif (!trace->skip)\n\t\t\t\ttrace->entries[trace->nr_entries++] = ip;\n\t\t\telse\n\t\t\t\ttrace->skip--;\n\t\t}\n\n\t\tif (trace->nr_entries >= trace->max_entries)\n\t\t\treturn;\n\n\t\tsp = newsp;\n\t}\n}",
    "includes": [
      "#include <asm/processor.h>",
      "#include <asm/ptrace.h>",
      "#include <linux/stacktrace.h>",
      "#include <linux/sched.h>",
      "#include <linux/export.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "in_sched_functions",
          "args": [
            "ip"
          ],
          "line": 35
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "validate_sp",
          "args": [
            "sp",
            "tsk",
            "STACK_FRAME_OVERHEAD"
          ],
          "line": 29
        },
        "resolved": true,
        "details": {
          "function_name": "validate_sp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2015-8845/repo/arch/powerpc/kernel/process.c",
          "lines": "1481-1491",
          "snippet": "int validate_sp(unsigned long sp, struct task_struct *p,\n\t\t       unsigned long nbytes)\n{\n\tunsigned long stack_page = (unsigned long)task_stack_page(p);\n\n\tif (sp >= stack_page + sizeof(struct thread_struct)\n\t    && sp <= stack_page + THREAD_SIZE - nbytes)\n\t\treturn 1;\n\n\treturn valid_irq_stack(sp, p, nbytes);\n}",
          "includes": [
            "#include <linux/kdebug.h>",
            "#include <linux/kprobes.h>",
            "#include <asm/code-patching.h>",
            "#include <asm/firmware.h>",
            "#include <asm/debug.h>",
            "#include <asm/tm.h>",
            "#include <asm/switch_to.h>",
            "#include <asm/syscalls.h>",
            "#include <asm/runlatch.h>",
            "#include <asm/time.h>",
            "#include <asm/machdep.h>",
            "#include <asm/prom.h>",
            "#include <asm/mmu.h>",
            "#include <asm/processor.h>",
            "#include <asm/io.h>",
            "#include <asm/pgtable.h>",
            "#include <linux/uaccess.h>",
            "#include <linux/hw_breakpoint.h>",
            "#include <linux/random.h>",
            "#include <linux/personality.h>",
            "#include <linux/kernel_stat.h>",
            "#include <linux/ftrace.h>",
            "#include <linux/utsname.h>",
            "#include <linux/hardirq.h>",
            "#include <linux/mqueue.h>",
            "#include <linux/kallsyms.h>",
            "#include <linux/export.h>",
            "#include <linux/init_task.h>",
            "#include <linux/prctl.h>",
            "#include <linux/elf.h>",
            "#include <linux/user.h>",
            "#include <linux/slab.h>",
            "#include <linux/ptrace.h>",
            "#include <linux/unistd.h>",
            "#include <linux/stddef.h>",
            "#include <linux/smp.h>",
            "#include <linux/mm.h>",
            "#include <linux/kernel.h>",
            "#include <linux/sched.h>",
            "#include <linux/errno.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/kdebug.h>\n#include <linux/kprobes.h>\n#include <asm/code-patching.h>\n#include <asm/firmware.h>\n#include <asm/debug.h>\n#include <asm/tm.h>\n#include <asm/switch_to.h>\n#include <asm/syscalls.h>\n#include <asm/runlatch.h>\n#include <asm/time.h>\n#include <asm/machdep.h>\n#include <asm/prom.h>\n#include <asm/mmu.h>\n#include <asm/processor.h>\n#include <asm/io.h>\n#include <asm/pgtable.h>\n#include <linux/uaccess.h>\n#include <linux/hw_breakpoint.h>\n#include <linux/random.h>\n#include <linux/personality.h>\n#include <linux/kernel_stat.h>\n#include <linux/ftrace.h>\n#include <linux/utsname.h>\n#include <linux/hardirq.h>\n#include <linux/mqueue.h>\n#include <linux/kallsyms.h>\n#include <linux/export.h>\n#include <linux/init_task.h>\n#include <linux/prctl.h>\n#include <linux/elf.h>\n#include <linux/user.h>\n#include <linux/slab.h>\n#include <linux/ptrace.h>\n#include <linux/unistd.h>\n#include <linux/stddef.h>\n#include <linux/smp.h>\n#include <linux/mm.h>\n#include <linux/kernel.h>\n#include <linux/sched.h>\n#include <linux/errno.h>\n\nint validate_sp(unsigned long sp, struct task_struct *p,\n\t\t       unsigned long nbytes)\n{\n\tunsigned long stack_page = (unsigned long)task_stack_page(p);\n\n\tif (sp >= stack_page + sizeof(struct thread_struct)\n\t    && sp <= stack_page + THREAD_SIZE - nbytes)\n\t\treturn 1;\n\n\treturn valid_irq_stack(sp, p, nbytes);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <asm/processor.h>\n#include <asm/ptrace.h>\n#include <linux/stacktrace.h>\n#include <linux/sched.h>\n#include <linux/export.h>\n\nstatic void save_context_stack(struct stack_trace *trace, unsigned long sp,\n\t\t\tstruct task_struct *tsk, int savesched)\n{\n\tfor (;;) {\n\t\tunsigned long *stack = (unsigned long *) sp;\n\t\tunsigned long newsp, ip;\n\n\t\tif (!validate_sp(sp, tsk, STACK_FRAME_OVERHEAD))\n\t\t\treturn;\n\n\t\tnewsp = stack[0];\n\t\tip = stack[STACK_FRAME_LR_SAVE];\n\n\t\tif (savesched || !in_sched_functions(ip)) {\n\t\t\tif (!trace->skip)\n\t\t\t\ttrace->entries[trace->nr_entries++] = ip;\n\t\t\telse\n\t\t\t\ttrace->skip--;\n\t\t}\n\n\t\tif (trace->nr_entries >= trace->max_entries)\n\t\t\treturn;\n\n\t\tsp = newsp;\n\t}\n}"
  }
]