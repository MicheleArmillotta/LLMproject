[
  {
    "function_name": "check_swiotlb_enabled",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2015-8845/repo/arch/powerpc/kernel/dma-swiotlb.c",
    "lines": "119-127",
    "snippet": "static int __init check_swiotlb_enabled(void)\n{\n\tif (ppc_swiotlb_enable)\n\t\tswiotlb_print_info();\n\telse\n\t\tswiotlb_free();\n\n\treturn 0;\n}",
    "includes": [
      "#include <asm/dma.h>",
      "#include <asm/swiotlb.h>",
      "#include <asm/machdep.h>",
      "#include <linux/pci.h>",
      "#include <linux/platform_device.h>",
      "#include <linux/of_platform.h>",
      "#include <linux/pfn.h>",
      "#include <linux/memblock.h>",
      "#include <linux/dma-mapping.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "unsigned int ppc_swiotlb_enable;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "swiotlb_free",
          "args": [],
          "line": 124
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "swiotlb_print_info",
          "args": [],
          "line": 122
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <asm/dma.h>\n#include <asm/swiotlb.h>\n#include <asm/machdep.h>\n#include <linux/pci.h>\n#include <linux/platform_device.h>\n#include <linux/of_platform.h>\n#include <linux/pfn.h>\n#include <linux/memblock.h>\n#include <linux/dma-mapping.h>\n\nunsigned int ppc_swiotlb_enable;\n\nstatic int __init check_swiotlb_enabled(void)\n{\n\tif (ppc_swiotlb_enable)\n\t\tswiotlb_print_info();\n\telse\n\t\tswiotlb_free();\n\n\treturn 0;\n}"
  },
  {
    "function_name": "swiotlb_detect_4g",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2015-8845/repo/arch/powerpc/kernel/dma-swiotlb.c",
    "lines": "109-117",
    "snippet": "void __init swiotlb_detect_4g(void)\n{\n\tif ((memblock_end_of_DRAM() - 1) > 0xffffffff) {\n\t\tppc_swiotlb_enable = 1;\n#ifdef CONFIG_ZONE_DMA32\n\t\tlimit_zone_pfn(ZONE_DMA32, (1ULL << 32) >> PAGE_SHIFT);\n#endif\n\t}\n}",
    "includes": [
      "#include <asm/dma.h>",
      "#include <asm/swiotlb.h>",
      "#include <asm/machdep.h>",
      "#include <linux/pci.h>",
      "#include <linux/platform_device.h>",
      "#include <linux/of_platform.h>",
      "#include <linux/pfn.h>",
      "#include <linux/memblock.h>",
      "#include <linux/dma-mapping.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "unsigned int ppc_swiotlb_enable;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "limit_zone_pfn",
          "args": [
            "ZONE_DMA32",
            "(1ULL << 32) >> PAGE_SHIFT"
          ],
          "line": 114
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memblock_end_of_DRAM",
          "args": [],
          "line": 111
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <asm/dma.h>\n#include <asm/swiotlb.h>\n#include <asm/machdep.h>\n#include <linux/pci.h>\n#include <linux/platform_device.h>\n#include <linux/of_platform.h>\n#include <linux/pfn.h>\n#include <linux/memblock.h>\n#include <linux/dma-mapping.h>\n\nunsigned int ppc_swiotlb_enable;\n\nvoid __init swiotlb_detect_4g(void)\n{\n\tif ((memblock_end_of_DRAM() - 1) > 0xffffffff) {\n\t\tppc_swiotlb_enable = 1;\n#ifdef CONFIG_ZONE_DMA32\n\t\tlimit_zone_pfn(ZONE_DMA32, (1ULL << 32) >> PAGE_SHIFT);\n#endif\n\t}\n}"
  },
  {
    "function_name": "swiotlb_setup_bus_notifier",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2015-8845/repo/arch/powerpc/kernel/dma-swiotlb.c",
    "lines": "102-107",
    "snippet": "int __init swiotlb_setup_bus_notifier(void)\n{\n\tbus_register_notifier(&platform_bus_type,\n\t\t\t      &ppc_swiotlb_plat_bus_notifier);\n\treturn 0;\n}",
    "includes": [
      "#include <asm/dma.h>",
      "#include <asm/swiotlb.h>",
      "#include <asm/machdep.h>",
      "#include <linux/pci.h>",
      "#include <linux/platform_device.h>",
      "#include <linux/of_platform.h>",
      "#include <linux/pfn.h>",
      "#include <linux/memblock.h>",
      "#include <linux/dma-mapping.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static struct notifier_block ppc_swiotlb_plat_bus_notifier = {\n\t.notifier_call = ppc_swiotlb_bus_notify,\n\t.priority = 0,\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "bus_register_notifier",
          "args": [
            "&platform_bus_type",
            "&ppc_swiotlb_plat_bus_notifier"
          ],
          "line": 104
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <asm/dma.h>\n#include <asm/swiotlb.h>\n#include <asm/machdep.h>\n#include <linux/pci.h>\n#include <linux/platform_device.h>\n#include <linux/of_platform.h>\n#include <linux/pfn.h>\n#include <linux/memblock.h>\n#include <linux/dma-mapping.h>\n\nstatic struct notifier_block ppc_swiotlb_plat_bus_notifier = {\n\t.notifier_call = ppc_swiotlb_bus_notify,\n\t.priority = 0,\n};\n\nint __init swiotlb_setup_bus_notifier(void)\n{\n\tbus_register_notifier(&platform_bus_type,\n\t\t\t      &ppc_swiotlb_plat_bus_notifier);\n\treturn 0;\n}"
  },
  {
    "function_name": "ppc_swiotlb_bus_notify",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2015-8845/repo/arch/powerpc/kernel/dma-swiotlb.c",
    "lines": "77-95",
    "snippet": "static int ppc_swiotlb_bus_notify(struct notifier_block *nb,\n\t\t\t\t  unsigned long action, void *data)\n{\n\tstruct device *dev = data;\n\tstruct dev_archdata *sd;\n\n\t/* We are only intereted in device addition */\n\tif (action != BUS_NOTIFY_ADD_DEVICE)\n\t\treturn 0;\n\n\tsd = &dev->archdata;\n\tsd->max_direct_dma_addr = 0;\n\n\t/* May need to bounce if the device can't address all of DRAM */\n\tif ((dma_get_mask(dev) + 1) < memblock_end_of_DRAM())\n\t\tset_dma_ops(dev, &swiotlb_dma_ops);\n\n\treturn NOTIFY_DONE;\n}",
    "includes": [
      "#include <asm/dma.h>",
      "#include <asm/swiotlb.h>",
      "#include <asm/machdep.h>",
      "#include <linux/pci.h>",
      "#include <linux/platform_device.h>",
      "#include <linux/of_platform.h>",
      "#include <linux/pfn.h>",
      "#include <linux/memblock.h>",
      "#include <linux/dma-mapping.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "struct dma_map_ops swiotlb_dma_ops = {\n\t.alloc = __dma_direct_alloc_coherent,\n\t.free = __dma_direct_free_coherent,\n\t.mmap = dma_direct_mmap_coherent,\n\t.map_sg = swiotlb_map_sg_attrs,\n\t.unmap_sg = swiotlb_unmap_sg_attrs,\n\t.dma_supported = swiotlb_dma_supported,\n\t.map_page = swiotlb_map_page,\n\t.unmap_page = swiotlb_unmap_page,\n\t.sync_single_for_cpu = swiotlb_sync_single_for_cpu,\n\t.sync_single_for_device = swiotlb_sync_single_for_device,\n\t.sync_sg_for_cpu = swiotlb_sync_sg_for_cpu,\n\t.sync_sg_for_device = swiotlb_sync_sg_for_device,\n\t.mapping_error = swiotlb_dma_mapping_error,\n\t.get_required_mask = swiotlb_powerpc_get_required,\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "set_dma_ops",
          "args": [
            "dev",
            "&swiotlb_dma_ops"
          ],
          "line": 92
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memblock_end_of_DRAM",
          "args": [],
          "line": 91
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dma_get_mask",
          "args": [
            "dev"
          ],
          "line": 91
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <asm/dma.h>\n#include <asm/swiotlb.h>\n#include <asm/machdep.h>\n#include <linux/pci.h>\n#include <linux/platform_device.h>\n#include <linux/of_platform.h>\n#include <linux/pfn.h>\n#include <linux/memblock.h>\n#include <linux/dma-mapping.h>\n\nstruct dma_map_ops swiotlb_dma_ops = {\n\t.alloc = __dma_direct_alloc_coherent,\n\t.free = __dma_direct_free_coherent,\n\t.mmap = dma_direct_mmap_coherent,\n\t.map_sg = swiotlb_map_sg_attrs,\n\t.unmap_sg = swiotlb_unmap_sg_attrs,\n\t.dma_supported = swiotlb_dma_supported,\n\t.map_page = swiotlb_map_page,\n\t.unmap_page = swiotlb_unmap_page,\n\t.sync_single_for_cpu = swiotlb_sync_single_for_cpu,\n\t.sync_single_for_device = swiotlb_sync_single_for_device,\n\t.sync_sg_for_cpu = swiotlb_sync_sg_for_cpu,\n\t.sync_sg_for_device = swiotlb_sync_sg_for_device,\n\t.mapping_error = swiotlb_dma_mapping_error,\n\t.get_required_mask = swiotlb_powerpc_get_required,\n};\n\nstatic int ppc_swiotlb_bus_notify(struct notifier_block *nb,\n\t\t\t\t  unsigned long action, void *data)\n{\n\tstruct device *dev = data;\n\tstruct dev_archdata *sd;\n\n\t/* We are only intereted in device addition */\n\tif (action != BUS_NOTIFY_ADD_DEVICE)\n\t\treturn 0;\n\n\tsd = &dev->archdata;\n\tsd->max_direct_dma_addr = 0;\n\n\t/* May need to bounce if the device can't address all of DRAM */\n\tif ((dma_get_mask(dev) + 1) < memblock_end_of_DRAM())\n\t\tset_dma_ops(dev, &swiotlb_dma_ops);\n\n\treturn NOTIFY_DONE;\n}"
  },
  {
    "function_name": "pci_dma_dev_setup_swiotlb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2015-8845/repo/arch/powerpc/kernel/dma-swiotlb.c",
    "lines": "66-75",
    "snippet": "void pci_dma_dev_setup_swiotlb(struct pci_dev *pdev)\n{\n\tstruct pci_controller *hose;\n\tstruct dev_archdata *sd;\n\n\those = pci_bus_to_host(pdev->bus);\n\tsd = &pdev->dev.archdata;\n\tsd->max_direct_dma_addr =\n\t\those->dma_window_base_cur + hose->dma_window_size;\n}",
    "includes": [
      "#include <asm/dma.h>",
      "#include <asm/swiotlb.h>",
      "#include <asm/machdep.h>",
      "#include <linux/pci.h>",
      "#include <linux/platform_device.h>",
      "#include <linux/of_platform.h>",
      "#include <linux/pfn.h>",
      "#include <linux/memblock.h>",
      "#include <linux/dma-mapping.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "pci_bus_to_host",
          "args": [
            "pdev->bus"
          ],
          "line": 71
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <asm/dma.h>\n#include <asm/swiotlb.h>\n#include <asm/machdep.h>\n#include <linux/pci.h>\n#include <linux/platform_device.h>\n#include <linux/of_platform.h>\n#include <linux/pfn.h>\n#include <linux/memblock.h>\n#include <linux/dma-mapping.h>\n\nvoid pci_dma_dev_setup_swiotlb(struct pci_dev *pdev)\n{\n\tstruct pci_controller *hose;\n\tstruct dev_archdata *sd;\n\n\those = pci_bus_to_host(pdev->bus);\n\tsd = &pdev->dev.archdata;\n\tsd->max_direct_dma_addr =\n\t\those->dma_window_base_cur + hose->dma_window_size;\n}"
  },
  {
    "function_name": "swiotlb_powerpc_get_required",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2015-8845/repo/arch/powerpc/kernel/dma-swiotlb.c",
    "lines": "27-40",
    "snippet": "static u64 swiotlb_powerpc_get_required(struct device *dev)\n{\n\tu64 end, mask, max_direct_dma_addr = dev->archdata.max_direct_dma_addr;\n\n\tend = memblock_end_of_DRAM();\n\tif (max_direct_dma_addr && end > max_direct_dma_addr)\n\t\tend = max_direct_dma_addr;\n\tend += get_dma_offset(dev);\n\n\tmask = 1ULL << (fls64(end) - 1);\n\tmask += mask - 1;\n\n\treturn mask;\n}",
    "includes": [
      "#include <asm/dma.h>",
      "#include <asm/swiotlb.h>",
      "#include <asm/machdep.h>",
      "#include <linux/pci.h>",
      "#include <linux/platform_device.h>",
      "#include <linux/of_platform.h>",
      "#include <linux/pfn.h>",
      "#include <linux/memblock.h>",
      "#include <linux/dma-mapping.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "fls64",
          "args": [
            "end"
          ],
          "line": 36
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_dma_offset",
          "args": [
            "dev"
          ],
          "line": 34
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memblock_end_of_DRAM",
          "args": [],
          "line": 31
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <asm/dma.h>\n#include <asm/swiotlb.h>\n#include <asm/machdep.h>\n#include <linux/pci.h>\n#include <linux/platform_device.h>\n#include <linux/of_platform.h>\n#include <linux/pfn.h>\n#include <linux/memblock.h>\n#include <linux/dma-mapping.h>\n\nstatic u64 swiotlb_powerpc_get_required(struct device *dev)\n{\n\tu64 end, mask, max_direct_dma_addr = dev->archdata.max_direct_dma_addr;\n\n\tend = memblock_end_of_DRAM();\n\tif (max_direct_dma_addr && end > max_direct_dma_addr)\n\t\tend = max_direct_dma_addr;\n\tend += get_dma_offset(dev);\n\n\tmask = 1ULL << (fls64(end) - 1);\n\tmask += mask - 1;\n\n\treturn mask;\n}"
  }
]