[
  {
    "function_name": "property_list_service_disable_ssl",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
    "lines": "270-275",
    "snippet": "LIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_disable_ssl(property_list_service_client_t client)\n{\n\tif (!client || !client->parent)\n\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\treturn service_to_property_list_service_error(service_disable_ssl(client->parent));\n}",
    "includes": [
      "#include \"endianness.h\"",
      "#include \"common/debug.h\"",
      "#include \"property_list_service.h\"",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "service_to_property_list_service_error",
          "args": [
            "service_disable_ssl(client->parent)"
          ],
          "line": 274
        },
        "resolved": true,
        "details": {
          "function_name": "service_to_property_list_service_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
          "lines": "40-55",
          "snippet": "static property_list_service_error_t service_to_property_list_service_error(service_error_t err)\n{\n\tswitch (err) {\n\t\tcase SERVICE_E_SUCCESS:\n\t\t\treturn PROPERTY_LIST_SERVICE_E_SUCCESS;\n\t\tcase SERVICE_E_INVALID_ARG:\n\t\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\t\tcase SERVICE_E_MUX_ERROR:\n\t\t\treturn PROPERTY_LIST_SERVICE_E_MUX_ERROR;\n\t\tcase SERVICE_E_SSL_ERROR:\n\t\t\treturn PROPERTY_LIST_SERVICE_E_SSL_ERROR;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn PROPERTY_LIST_SERVICE_E_UNKNOWN_ERROR;\n}",
          "includes": [
            "#include \"endianness.h\"",
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic property_list_service_error_t service_to_property_list_service_error(service_error_t err)\n{\n\tswitch (err) {\n\t\tcase SERVICE_E_SUCCESS:\n\t\t\treturn PROPERTY_LIST_SERVICE_E_SUCCESS;\n\t\tcase SERVICE_E_INVALID_ARG:\n\t\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\t\tcase SERVICE_E_MUX_ERROR:\n\t\t\treturn PROPERTY_LIST_SERVICE_E_MUX_ERROR;\n\t\tcase SERVICE_E_SSL_ERROR:\n\t\t\treturn PROPERTY_LIST_SERVICE_E_SSL_ERROR;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn PROPERTY_LIST_SERVICE_E_UNKNOWN_ERROR;\n}"
        }
      },
      {
        "call_info": {
          "callee": "service_disable_ssl",
          "args": [
            "client->parent"
          ],
          "line": 274
        },
        "resolved": true,
        "details": {
          "function_name": "property_list_service_disable_ssl",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
          "lines": "270-275",
          "snippet": "LIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_disable_ssl(property_list_service_client_t client)\n{\n\tif (!client || !client->parent)\n\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\treturn service_to_property_list_service_error(service_disable_ssl(client->parent));\n}",
          "note": "cyclic_reference_detected"
        }
      }
    ],
    "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_disable_ssl(property_list_service_client_t client)\n{\n\tif (!client || !client->parent)\n\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\treturn service_to_property_list_service_error(service_disable_ssl(client->parent));\n}"
  },
  {
    "function_name": "property_list_service_enable_ssl",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
    "lines": "263-268",
    "snippet": "LIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_enable_ssl(property_list_service_client_t client)\n{\n\tif (!client || !client->parent)\n\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\treturn service_to_property_list_service_error(service_enable_ssl(client->parent));\n}",
    "includes": [
      "#include \"endianness.h\"",
      "#include \"common/debug.h\"",
      "#include \"property_list_service.h\"",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "service_to_property_list_service_error",
          "args": [
            "service_enable_ssl(client->parent)"
          ],
          "line": 267
        },
        "resolved": true,
        "details": {
          "function_name": "service_to_property_list_service_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
          "lines": "40-55",
          "snippet": "static property_list_service_error_t service_to_property_list_service_error(service_error_t err)\n{\n\tswitch (err) {\n\t\tcase SERVICE_E_SUCCESS:\n\t\t\treturn PROPERTY_LIST_SERVICE_E_SUCCESS;\n\t\tcase SERVICE_E_INVALID_ARG:\n\t\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\t\tcase SERVICE_E_MUX_ERROR:\n\t\t\treturn PROPERTY_LIST_SERVICE_E_MUX_ERROR;\n\t\tcase SERVICE_E_SSL_ERROR:\n\t\t\treturn PROPERTY_LIST_SERVICE_E_SSL_ERROR;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn PROPERTY_LIST_SERVICE_E_UNKNOWN_ERROR;\n}",
          "includes": [
            "#include \"endianness.h\"",
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic property_list_service_error_t service_to_property_list_service_error(service_error_t err)\n{\n\tswitch (err) {\n\t\tcase SERVICE_E_SUCCESS:\n\t\t\treturn PROPERTY_LIST_SERVICE_E_SUCCESS;\n\t\tcase SERVICE_E_INVALID_ARG:\n\t\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\t\tcase SERVICE_E_MUX_ERROR:\n\t\t\treturn PROPERTY_LIST_SERVICE_E_MUX_ERROR;\n\t\tcase SERVICE_E_SSL_ERROR:\n\t\t\treturn PROPERTY_LIST_SERVICE_E_SSL_ERROR;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn PROPERTY_LIST_SERVICE_E_UNKNOWN_ERROR;\n}"
        }
      },
      {
        "call_info": {
          "callee": "service_enable_ssl",
          "args": [
            "client->parent"
          ],
          "line": 267
        },
        "resolved": true,
        "details": {
          "function_name": "property_list_service_enable_ssl",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
          "lines": "263-268",
          "snippet": "LIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_enable_ssl(property_list_service_client_t client)\n{\n\tif (!client || !client->parent)\n\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\treturn service_to_property_list_service_error(service_enable_ssl(client->parent));\n}",
          "note": "cyclic_reference_detected"
        }
      }
    ],
    "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_enable_ssl(property_list_service_client_t client)\n{\n\tif (!client || !client->parent)\n\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\treturn service_to_property_list_service_error(service_enable_ssl(client->parent));\n}"
  },
  {
    "function_name": "property_list_service_receive_plist",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
    "lines": "258-261",
    "snippet": "LIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_receive_plist(property_list_service_client_t client, plist_t *plist)\n{\n\treturn internal_plist_receive_timeout(client, plist, 10000);\n}",
    "includes": [
      "#include \"endianness.h\"",
      "#include \"common/debug.h\"",
      "#include \"property_list_service.h\"",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "internal_plist_receive_timeout",
          "args": [
            "client",
            "plist",
            "10000"
          ],
          "line": 260
        },
        "resolved": true,
        "details": {
          "function_name": "internal_plist_receive_timeout",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
          "lines": "176-251",
          "snippet": "static property_list_service_error_t internal_plist_receive_timeout(property_list_service_client_t client, plist_t *plist, unsigned int timeout)\n{\n\tproperty_list_service_error_t res = PROPERTY_LIST_SERVICE_E_UNKNOWN_ERROR;\n\tuint32_t pktlen = 0;\n\tuint32_t bytes = 0;\n\n\tif (!client || (client && !client->parent) || !plist) {\n\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\t}\n\n\t*plist = NULL;\n\tservice_error_t serr = service_receive_with_timeout(client->parent, (char*)&pktlen, sizeof(pktlen), &bytes, timeout);\n\tif ((serr == SERVICE_E_SUCCESS) && (bytes == 0)) {\n\t\treturn PROPERTY_LIST_SERVICE_E_RECEIVE_TIMEOUT;\n\t}\n\tdebug_info(\"initial read=%i\", bytes);\n\tif (bytes < 4) {\n\t\tdebug_info(\"initial read failed!\");\n\t\treturn PROPERTY_LIST_SERVICE_E_MUX_ERROR;\n\t} else {\n\t\tpktlen = be32toh(pktlen);\n\t\tif (pktlen < (1 << 24)) { /* prevent huge buffers */\n\t\t\tuint32_t curlen = 0;\n\t\t\tchar *content = NULL;\n\t\t\tdebug_info(\"%d bytes following\", pktlen);\n\t\t\tcontent = (char*)malloc(pktlen);\n\t\t\tif (!content) {\n\t\t\t\tdebug_info(\"out of memory when allocating %d bytes\", pktlen);\n\t\t\t\treturn PROPERTY_LIST_SERVICE_E_UNKNOWN_ERROR;\n\t\t\t}\n\n\t\t\twhile (curlen < pktlen) {\n\t\t\t\tservice_receive(client->parent, content+curlen, pktlen-curlen, &bytes);\n\t\t\t\tif (bytes <= 0) {\n\t\t\t\t\tres = PROPERTY_LIST_SERVICE_E_MUX_ERROR;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tdebug_info(\"received %d bytes\", bytes);\n\t\t\t\tcurlen += bytes;\n\t\t\t}\n\t\t\tif (curlen < pktlen) {\n\t\t\t\tdebug_info(\"received incomplete packet (%d of %d bytes)\", curlen, pktlen);\n\t\t\t\tif (curlen > 0) {\n\t\t\t\t\tdebug_info(\"incomplete packet following:\");\n\t\t\t\t\tdebug_buffer(content, curlen);\n\t\t\t\t}\n\t\t\t\tfree(content);\n\t\t\t\treturn res;\n\t\t\t}\n\t\t\tif ((pktlen > 8) && !memcmp(content, \"bplist00\", 8)) {\n\t\t\t\tplist_from_bin(content, pktlen, plist);\n\t\t\t} else if ((pktlen > 5) && !memcmp(content, \"<?xml\", 5)) {\n\t\t\t\t/* iOS 4.3+ hack: plist data might contain invalid characters, thus we convert those to spaces */\n\t\t\t\tfor (bytes = 0; bytes < pktlen-1; bytes++) {\n\t\t\t\t\tif ((content[bytes] >= 0) && (content[bytes] < 0x20) && (content[bytes] != 0x09) && (content[bytes] != 0x0a) && (content[bytes] != 0x0d))\n\t\t\t\t\t\tcontent[bytes] = 0x20;\n\t\t\t\t}\n\t\t\t\tplist_from_xml(content, pktlen, plist);\n\t\t\t} else {\n\t\t\t\tdebug_info(\"WARNING: received unexpected non-plist content\");\n\t\t\t\tdebug_buffer(content, pktlen);\n\t\t\t}\n\t\t\tif (*plist) {\n\t\t\t\tdebug_plist(*plist);\n\t\t\t\tres = PROPERTY_LIST_SERVICE_E_SUCCESS;\n\t\t\t} else {\n\t\t\t\tres = PROPERTY_LIST_SERVICE_E_PLIST_ERROR;\n\t\t\t}\n\t\t\tfree(content);\n\t\t\tcontent = NULL;\n\t\t} else {\n\t\t\tres = PROPERTY_LIST_SERVICE_E_UNKNOWN_ERROR;\n\t\t}\n\t}\n\treturn res;\n}",
          "includes": [
            "#include \"endianness.h\"",
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic property_list_service_error_t internal_plist_receive_timeout(property_list_service_client_t client, plist_t *plist, unsigned int timeout)\n{\n\tproperty_list_service_error_t res = PROPERTY_LIST_SERVICE_E_UNKNOWN_ERROR;\n\tuint32_t pktlen = 0;\n\tuint32_t bytes = 0;\n\n\tif (!client || (client && !client->parent) || !plist) {\n\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\t}\n\n\t*plist = NULL;\n\tservice_error_t serr = service_receive_with_timeout(client->parent, (char*)&pktlen, sizeof(pktlen), &bytes, timeout);\n\tif ((serr == SERVICE_E_SUCCESS) && (bytes == 0)) {\n\t\treturn PROPERTY_LIST_SERVICE_E_RECEIVE_TIMEOUT;\n\t}\n\tdebug_info(\"initial read=%i\", bytes);\n\tif (bytes < 4) {\n\t\tdebug_info(\"initial read failed!\");\n\t\treturn PROPERTY_LIST_SERVICE_E_MUX_ERROR;\n\t} else {\n\t\tpktlen = be32toh(pktlen);\n\t\tif (pktlen < (1 << 24)) { /* prevent huge buffers */\n\t\t\tuint32_t curlen = 0;\n\t\t\tchar *content = NULL;\n\t\t\tdebug_info(\"%d bytes following\", pktlen);\n\t\t\tcontent = (char*)malloc(pktlen);\n\t\t\tif (!content) {\n\t\t\t\tdebug_info(\"out of memory when allocating %d bytes\", pktlen);\n\t\t\t\treturn PROPERTY_LIST_SERVICE_E_UNKNOWN_ERROR;\n\t\t\t}\n\n\t\t\twhile (curlen < pktlen) {\n\t\t\t\tservice_receive(client->parent, content+curlen, pktlen-curlen, &bytes);\n\t\t\t\tif (bytes <= 0) {\n\t\t\t\t\tres = PROPERTY_LIST_SERVICE_E_MUX_ERROR;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tdebug_info(\"received %d bytes\", bytes);\n\t\t\t\tcurlen += bytes;\n\t\t\t}\n\t\t\tif (curlen < pktlen) {\n\t\t\t\tdebug_info(\"received incomplete packet (%d of %d bytes)\", curlen, pktlen);\n\t\t\t\tif (curlen > 0) {\n\t\t\t\t\tdebug_info(\"incomplete packet following:\");\n\t\t\t\t\tdebug_buffer(content, curlen);\n\t\t\t\t}\n\t\t\t\tfree(content);\n\t\t\t\treturn res;\n\t\t\t}\n\t\t\tif ((pktlen > 8) && !memcmp(content, \"bplist00\", 8)) {\n\t\t\t\tplist_from_bin(content, pktlen, plist);\n\t\t\t} else if ((pktlen > 5) && !memcmp(content, \"<?xml\", 5)) {\n\t\t\t\t/* iOS 4.3+ hack: plist data might contain invalid characters, thus we convert those to spaces */\n\t\t\t\tfor (bytes = 0; bytes < pktlen-1; bytes++) {\n\t\t\t\t\tif ((content[bytes] >= 0) && (content[bytes] < 0x20) && (content[bytes] != 0x09) && (content[bytes] != 0x0a) && (content[bytes] != 0x0d))\n\t\t\t\t\t\tcontent[bytes] = 0x20;\n\t\t\t\t}\n\t\t\t\tplist_from_xml(content, pktlen, plist);\n\t\t\t} else {\n\t\t\t\tdebug_info(\"WARNING: received unexpected non-plist content\");\n\t\t\t\tdebug_buffer(content, pktlen);\n\t\t\t}\n\t\t\tif (*plist) {\n\t\t\t\tdebug_plist(*plist);\n\t\t\t\tres = PROPERTY_LIST_SERVICE_E_SUCCESS;\n\t\t\t} else {\n\t\t\t\tres = PROPERTY_LIST_SERVICE_E_PLIST_ERROR;\n\t\t\t}\n\t\t\tfree(content);\n\t\t\tcontent = NULL;\n\t\t} else {\n\t\t\tres = PROPERTY_LIST_SERVICE_E_UNKNOWN_ERROR;\n\t\t}\n\t}\n\treturn res;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_receive_plist(property_list_service_client_t client, plist_t *plist)\n{\n\treturn internal_plist_receive_timeout(client, plist, 10000);\n}"
  },
  {
    "function_name": "property_list_service_receive_plist_with_timeout",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
    "lines": "253-256",
    "snippet": "LIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_receive_plist_with_timeout(property_list_service_client_t client, plist_t *plist, unsigned int timeout)\n{\n\treturn internal_plist_receive_timeout(client, plist, timeout);\n}",
    "includes": [
      "#include \"endianness.h\"",
      "#include \"common/debug.h\"",
      "#include \"property_list_service.h\"",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "internal_plist_receive_timeout",
          "args": [
            "client",
            "plist",
            "timeout"
          ],
          "line": 255
        },
        "resolved": true,
        "details": {
          "function_name": "internal_plist_receive_timeout",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
          "lines": "176-251",
          "snippet": "static property_list_service_error_t internal_plist_receive_timeout(property_list_service_client_t client, plist_t *plist, unsigned int timeout)\n{\n\tproperty_list_service_error_t res = PROPERTY_LIST_SERVICE_E_UNKNOWN_ERROR;\n\tuint32_t pktlen = 0;\n\tuint32_t bytes = 0;\n\n\tif (!client || (client && !client->parent) || !plist) {\n\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\t}\n\n\t*plist = NULL;\n\tservice_error_t serr = service_receive_with_timeout(client->parent, (char*)&pktlen, sizeof(pktlen), &bytes, timeout);\n\tif ((serr == SERVICE_E_SUCCESS) && (bytes == 0)) {\n\t\treturn PROPERTY_LIST_SERVICE_E_RECEIVE_TIMEOUT;\n\t}\n\tdebug_info(\"initial read=%i\", bytes);\n\tif (bytes < 4) {\n\t\tdebug_info(\"initial read failed!\");\n\t\treturn PROPERTY_LIST_SERVICE_E_MUX_ERROR;\n\t} else {\n\t\tpktlen = be32toh(pktlen);\n\t\tif (pktlen < (1 << 24)) { /* prevent huge buffers */\n\t\t\tuint32_t curlen = 0;\n\t\t\tchar *content = NULL;\n\t\t\tdebug_info(\"%d bytes following\", pktlen);\n\t\t\tcontent = (char*)malloc(pktlen);\n\t\t\tif (!content) {\n\t\t\t\tdebug_info(\"out of memory when allocating %d bytes\", pktlen);\n\t\t\t\treturn PROPERTY_LIST_SERVICE_E_UNKNOWN_ERROR;\n\t\t\t}\n\n\t\t\twhile (curlen < pktlen) {\n\t\t\t\tservice_receive(client->parent, content+curlen, pktlen-curlen, &bytes);\n\t\t\t\tif (bytes <= 0) {\n\t\t\t\t\tres = PROPERTY_LIST_SERVICE_E_MUX_ERROR;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tdebug_info(\"received %d bytes\", bytes);\n\t\t\t\tcurlen += bytes;\n\t\t\t}\n\t\t\tif (curlen < pktlen) {\n\t\t\t\tdebug_info(\"received incomplete packet (%d of %d bytes)\", curlen, pktlen);\n\t\t\t\tif (curlen > 0) {\n\t\t\t\t\tdebug_info(\"incomplete packet following:\");\n\t\t\t\t\tdebug_buffer(content, curlen);\n\t\t\t\t}\n\t\t\t\tfree(content);\n\t\t\t\treturn res;\n\t\t\t}\n\t\t\tif ((pktlen > 8) && !memcmp(content, \"bplist00\", 8)) {\n\t\t\t\tplist_from_bin(content, pktlen, plist);\n\t\t\t} else if ((pktlen > 5) && !memcmp(content, \"<?xml\", 5)) {\n\t\t\t\t/* iOS 4.3+ hack: plist data might contain invalid characters, thus we convert those to spaces */\n\t\t\t\tfor (bytes = 0; bytes < pktlen-1; bytes++) {\n\t\t\t\t\tif ((content[bytes] >= 0) && (content[bytes] < 0x20) && (content[bytes] != 0x09) && (content[bytes] != 0x0a) && (content[bytes] != 0x0d))\n\t\t\t\t\t\tcontent[bytes] = 0x20;\n\t\t\t\t}\n\t\t\t\tplist_from_xml(content, pktlen, plist);\n\t\t\t} else {\n\t\t\t\tdebug_info(\"WARNING: received unexpected non-plist content\");\n\t\t\t\tdebug_buffer(content, pktlen);\n\t\t\t}\n\t\t\tif (*plist) {\n\t\t\t\tdebug_plist(*plist);\n\t\t\t\tres = PROPERTY_LIST_SERVICE_E_SUCCESS;\n\t\t\t} else {\n\t\t\t\tres = PROPERTY_LIST_SERVICE_E_PLIST_ERROR;\n\t\t\t}\n\t\t\tfree(content);\n\t\t\tcontent = NULL;\n\t\t} else {\n\t\t\tres = PROPERTY_LIST_SERVICE_E_UNKNOWN_ERROR;\n\t\t}\n\t}\n\treturn res;\n}",
          "includes": [
            "#include \"endianness.h\"",
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic property_list_service_error_t internal_plist_receive_timeout(property_list_service_client_t client, plist_t *plist, unsigned int timeout)\n{\n\tproperty_list_service_error_t res = PROPERTY_LIST_SERVICE_E_UNKNOWN_ERROR;\n\tuint32_t pktlen = 0;\n\tuint32_t bytes = 0;\n\n\tif (!client || (client && !client->parent) || !plist) {\n\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\t}\n\n\t*plist = NULL;\n\tservice_error_t serr = service_receive_with_timeout(client->parent, (char*)&pktlen, sizeof(pktlen), &bytes, timeout);\n\tif ((serr == SERVICE_E_SUCCESS) && (bytes == 0)) {\n\t\treturn PROPERTY_LIST_SERVICE_E_RECEIVE_TIMEOUT;\n\t}\n\tdebug_info(\"initial read=%i\", bytes);\n\tif (bytes < 4) {\n\t\tdebug_info(\"initial read failed!\");\n\t\treturn PROPERTY_LIST_SERVICE_E_MUX_ERROR;\n\t} else {\n\t\tpktlen = be32toh(pktlen);\n\t\tif (pktlen < (1 << 24)) { /* prevent huge buffers */\n\t\t\tuint32_t curlen = 0;\n\t\t\tchar *content = NULL;\n\t\t\tdebug_info(\"%d bytes following\", pktlen);\n\t\t\tcontent = (char*)malloc(pktlen);\n\t\t\tif (!content) {\n\t\t\t\tdebug_info(\"out of memory when allocating %d bytes\", pktlen);\n\t\t\t\treturn PROPERTY_LIST_SERVICE_E_UNKNOWN_ERROR;\n\t\t\t}\n\n\t\t\twhile (curlen < pktlen) {\n\t\t\t\tservice_receive(client->parent, content+curlen, pktlen-curlen, &bytes);\n\t\t\t\tif (bytes <= 0) {\n\t\t\t\t\tres = PROPERTY_LIST_SERVICE_E_MUX_ERROR;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tdebug_info(\"received %d bytes\", bytes);\n\t\t\t\tcurlen += bytes;\n\t\t\t}\n\t\t\tif (curlen < pktlen) {\n\t\t\t\tdebug_info(\"received incomplete packet (%d of %d bytes)\", curlen, pktlen);\n\t\t\t\tif (curlen > 0) {\n\t\t\t\t\tdebug_info(\"incomplete packet following:\");\n\t\t\t\t\tdebug_buffer(content, curlen);\n\t\t\t\t}\n\t\t\t\tfree(content);\n\t\t\t\treturn res;\n\t\t\t}\n\t\t\tif ((pktlen > 8) && !memcmp(content, \"bplist00\", 8)) {\n\t\t\t\tplist_from_bin(content, pktlen, plist);\n\t\t\t} else if ((pktlen > 5) && !memcmp(content, \"<?xml\", 5)) {\n\t\t\t\t/* iOS 4.3+ hack: plist data might contain invalid characters, thus we convert those to spaces */\n\t\t\t\tfor (bytes = 0; bytes < pktlen-1; bytes++) {\n\t\t\t\t\tif ((content[bytes] >= 0) && (content[bytes] < 0x20) && (content[bytes] != 0x09) && (content[bytes] != 0x0a) && (content[bytes] != 0x0d))\n\t\t\t\t\t\tcontent[bytes] = 0x20;\n\t\t\t\t}\n\t\t\t\tplist_from_xml(content, pktlen, plist);\n\t\t\t} else {\n\t\t\t\tdebug_info(\"WARNING: received unexpected non-plist content\");\n\t\t\t\tdebug_buffer(content, pktlen);\n\t\t\t}\n\t\t\tif (*plist) {\n\t\t\t\tdebug_plist(*plist);\n\t\t\t\tres = PROPERTY_LIST_SERVICE_E_SUCCESS;\n\t\t\t} else {\n\t\t\t\tres = PROPERTY_LIST_SERVICE_E_PLIST_ERROR;\n\t\t\t}\n\t\t\tfree(content);\n\t\t\tcontent = NULL;\n\t\t} else {\n\t\t\tres = PROPERTY_LIST_SERVICE_E_UNKNOWN_ERROR;\n\t\t}\n\t}\n\treturn res;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_receive_plist_with_timeout(property_list_service_client_t client, plist_t *plist, unsigned int timeout)\n{\n\treturn internal_plist_receive_timeout(client, plist, timeout);\n}"
  },
  {
    "function_name": "internal_plist_receive_timeout",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
    "lines": "176-251",
    "snippet": "static property_list_service_error_t internal_plist_receive_timeout(property_list_service_client_t client, plist_t *plist, unsigned int timeout)\n{\n\tproperty_list_service_error_t res = PROPERTY_LIST_SERVICE_E_UNKNOWN_ERROR;\n\tuint32_t pktlen = 0;\n\tuint32_t bytes = 0;\n\n\tif (!client || (client && !client->parent) || !plist) {\n\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\t}\n\n\t*plist = NULL;\n\tservice_error_t serr = service_receive_with_timeout(client->parent, (char*)&pktlen, sizeof(pktlen), &bytes, timeout);\n\tif ((serr == SERVICE_E_SUCCESS) && (bytes == 0)) {\n\t\treturn PROPERTY_LIST_SERVICE_E_RECEIVE_TIMEOUT;\n\t}\n\tdebug_info(\"initial read=%i\", bytes);\n\tif (bytes < 4) {\n\t\tdebug_info(\"initial read failed!\");\n\t\treturn PROPERTY_LIST_SERVICE_E_MUX_ERROR;\n\t} else {\n\t\tpktlen = be32toh(pktlen);\n\t\tif (pktlen < (1 << 24)) { /* prevent huge buffers */\n\t\t\tuint32_t curlen = 0;\n\t\t\tchar *content = NULL;\n\t\t\tdebug_info(\"%d bytes following\", pktlen);\n\t\t\tcontent = (char*)malloc(pktlen);\n\t\t\tif (!content) {\n\t\t\t\tdebug_info(\"out of memory when allocating %d bytes\", pktlen);\n\t\t\t\treturn PROPERTY_LIST_SERVICE_E_UNKNOWN_ERROR;\n\t\t\t}\n\n\t\t\twhile (curlen < pktlen) {\n\t\t\t\tservice_receive(client->parent, content+curlen, pktlen-curlen, &bytes);\n\t\t\t\tif (bytes <= 0) {\n\t\t\t\t\tres = PROPERTY_LIST_SERVICE_E_MUX_ERROR;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tdebug_info(\"received %d bytes\", bytes);\n\t\t\t\tcurlen += bytes;\n\t\t\t}\n\t\t\tif (curlen < pktlen) {\n\t\t\t\tdebug_info(\"received incomplete packet (%d of %d bytes)\", curlen, pktlen);\n\t\t\t\tif (curlen > 0) {\n\t\t\t\t\tdebug_info(\"incomplete packet following:\");\n\t\t\t\t\tdebug_buffer(content, curlen);\n\t\t\t\t}\n\t\t\t\tfree(content);\n\t\t\t\treturn res;\n\t\t\t}\n\t\t\tif ((pktlen > 8) && !memcmp(content, \"bplist00\", 8)) {\n\t\t\t\tplist_from_bin(content, pktlen, plist);\n\t\t\t} else if ((pktlen > 5) && !memcmp(content, \"<?xml\", 5)) {\n\t\t\t\t/* iOS 4.3+ hack: plist data might contain invalid characters, thus we convert those to spaces */\n\t\t\t\tfor (bytes = 0; bytes < pktlen-1; bytes++) {\n\t\t\t\t\tif ((content[bytes] >= 0) && (content[bytes] < 0x20) && (content[bytes] != 0x09) && (content[bytes] != 0x0a) && (content[bytes] != 0x0d))\n\t\t\t\t\t\tcontent[bytes] = 0x20;\n\t\t\t\t}\n\t\t\t\tplist_from_xml(content, pktlen, plist);\n\t\t\t} else {\n\t\t\t\tdebug_info(\"WARNING: received unexpected non-plist content\");\n\t\t\t\tdebug_buffer(content, pktlen);\n\t\t\t}\n\t\t\tif (*plist) {\n\t\t\t\tdebug_plist(*plist);\n\t\t\t\tres = PROPERTY_LIST_SERVICE_E_SUCCESS;\n\t\t\t} else {\n\t\t\t\tres = PROPERTY_LIST_SERVICE_E_PLIST_ERROR;\n\t\t\t}\n\t\t\tfree(content);\n\t\t\tcontent = NULL;\n\t\t} else {\n\t\t\tres = PROPERTY_LIST_SERVICE_E_UNKNOWN_ERROR;\n\t\t}\n\t}\n\treturn res;\n}",
    "includes": [
      "#include \"endianness.h\"",
      "#include \"common/debug.h\"",
      "#include \"property_list_service.h\"",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "content"
          ],
          "line": 244
        },
        "resolved": true,
        "details": {
          "function_name": "property_list_service_client_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
          "lines": "77-88",
          "snippet": "LIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_client_free(property_list_service_client_t client)\n{\n\tif (!client)\n\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\n\tproperty_list_service_error_t err = service_to_property_list_service_error(service_client_free(client->parent));\n\n\tfree(client);\n\tclient = NULL;\n\n\treturn err;\n}",
          "includes": [
            "#include \"endianness.h\"",
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_client_free(property_list_service_client_t client)\n{\n\tif (!client)\n\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\n\tproperty_list_service_error_t err = service_to_property_list_service_error(service_client_free(client->parent));\n\n\tfree(client);\n\tclient = NULL;\n\n\treturn err;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_plist",
          "args": [
            "*plist"
          ],
          "line": 239
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_buffer",
          "args": [
            "content",
            "pktlen"
          ],
          "line": 236
        },
        "resolved": true,
        "details": {
          "function_name": "debug_buffer",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/common/debug.c",
          "lines": "101-134",
          "snippet": "void debug_buffer(const char *data, const int length)\n{\n#ifndef STRIP_DEBUG_CODE\n\tint i;\n\tint j;\n\tunsigned char c;\n\n\tif (debug_level) {\n\t\tfor (i = 0; i < length; i += 16) {\n\t\t\tfprintf(stderr, \"%04x: \", i);\n\t\t\tfor (j = 0; j < 16; j++) {\n\t\t\t\tif (i + j >= length) {\n\t\t\t\t\tfprintf(stderr, \"   \");\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tfprintf(stderr, \"%02x \", *(data + i + j) & 0xff);\n\t\t\t}\n\t\t\tfprintf(stderr, \"  | \");\n\t\t\tfor (j = 0; j < 16; j++) {\n\t\t\t\tif (i + j >= length)\n\t\t\t\t\tbreak;\n\t\t\t\tc = *(data + i + j);\n\t\t\t\tif ((c < 32) || (c > 127)) {\n\t\t\t\t\tfprintf(stderr, \".\");\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tfprintf(stderr, \"%c\", c);\n\t\t\t}\n\t\t\tfprintf(stderr, \"\\n\");\n\t\t}\n\t\tfprintf(stderr, \"\\n\");\n\t}\n#endif\n}",
          "includes": [
            "#include \"asprintf.h\"",
            "#include \"src/idevice.h\"",
            "#include \"libimobiledevice/libimobiledevice.h\"",
            "#include \"debug.h\"",
            "#include <time.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int debug_level;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"asprintf.h\"\n#include \"src/idevice.h\"\n#include \"libimobiledevice/libimobiledevice.h\"\n#include \"debug.h\"\n#include <time.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <config.h>\n\nstatic int debug_level;\n\nvoid debug_buffer(const char *data, const int length)\n{\n#ifndef STRIP_DEBUG_CODE\n\tint i;\n\tint j;\n\tunsigned char c;\n\n\tif (debug_level) {\n\t\tfor (i = 0; i < length; i += 16) {\n\t\t\tfprintf(stderr, \"%04x: \", i);\n\t\t\tfor (j = 0; j < 16; j++) {\n\t\t\t\tif (i + j >= length) {\n\t\t\t\t\tfprintf(stderr, \"   \");\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tfprintf(stderr, \"%02x \", *(data + i + j) & 0xff);\n\t\t\t}\n\t\t\tfprintf(stderr, \"  | \");\n\t\t\tfor (j = 0; j < 16; j++) {\n\t\t\t\tif (i + j >= length)\n\t\t\t\t\tbreak;\n\t\t\t\tc = *(data + i + j);\n\t\t\t\tif ((c < 32) || (c > 127)) {\n\t\t\t\t\tfprintf(stderr, \".\");\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tfprintf(stderr, \"%c\", c);\n\t\t\t}\n\t\t\tfprintf(stderr, \"\\n\");\n\t\t}\n\t\tfprintf(stderr, \"\\n\");\n\t}\n#endif\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"WARNING: received unexpected non-plist content\""
          ],
          "line": 235
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_from_xml",
          "args": [
            "content",
            "pktlen",
            "plist"
          ],
          "line": 233
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcmp",
          "args": [
            "content",
            "\"<?xml\"",
            "5"
          ],
          "line": 227
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_from_bin",
          "args": [
            "content",
            "pktlen",
            "plist"
          ],
          "line": 226
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcmp",
          "args": [
            "content",
            "\"bplist00\"",
            "8"
          ],
          "line": 225
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"incomplete packet following:\""
          ],
          "line": 219
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"received incomplete packet (%d of %d bytes)\"",
            "curlen",
            "pktlen"
          ],
          "line": 217
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"received %d bytes\"",
            "bytes"
          ],
          "line": 213
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "service_receive",
          "args": [
            "client->parent",
            "content+curlen",
            "pktlen-curlen",
            "&bytes"
          ],
          "line": 208
        },
        "resolved": true,
        "details": {
          "function_name": "service_receive",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/service.c",
          "lines": "172-175",
          "snippet": "LIBIMOBILEDEVICE_API service_error_t service_receive(service_client_t client, char* data, uint32_t size, uint32_t *received)\n{\n\treturn service_receive_with_timeout(client, data, size, received, 10000);\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API service_error_t service_receive(service_client_t client, char* data, uint32_t size, uint32_t *received)\n{\n\treturn service_receive_with_timeout(client, data, size, received, 10000);\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"out of memory when allocating %d bytes\"",
            "pktlen"
          ],
          "line": 203
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "malloc",
          "args": [
            "pktlen"
          ],
          "line": 201
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"%d bytes following\"",
            "pktlen"
          ],
          "line": 200
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "be32toh",
          "args": [
            "pktlen"
          ],
          "line": 196
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"initial read failed!\""
          ],
          "line": 193
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"initial read=%i\"",
            "bytes"
          ],
          "line": 191
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "service_receive_with_timeout",
          "args": [
            "client->parent",
            "(char*)&pktlen",
            "sizeof(pktlen)",
            "&bytes",
            "timeout"
          ],
          "line": 187
        },
        "resolved": true,
        "details": {
          "function_name": "service_receive_with_timeout",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/service.c",
          "lines": "152-170",
          "snippet": "LIBIMOBILEDEVICE_API service_error_t service_receive_with_timeout(service_client_t client, char* data, uint32_t size, uint32_t *received, unsigned int timeout)\n{\n\tservice_error_t res = SERVICE_E_UNKNOWN_ERROR;\n\tint bytes = 0;\n\n\tif (!client || (client && !client->connection) || !data || (size == 0)) {\n\t\treturn SERVICE_E_INVALID_ARG;\n\t}\n\n\tres = idevice_to_service_error(idevice_connection_receive_timeout(client->connection, data, size, (uint32_t*)&bytes, timeout));\n\tif (bytes <= 0) {\n\t\tdebug_info(\"could not read data\");\n\t}\n\tif (received) {\n\t\t*received = (uint32_t)bytes;\n\t}\n\n\treturn res;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API service_error_t service_receive_with_timeout(service_client_t client, char* data, uint32_t size, uint32_t *received, unsigned int timeout)\n{\n\tservice_error_t res = SERVICE_E_UNKNOWN_ERROR;\n\tint bytes = 0;\n\n\tif (!client || (client && !client->connection) || !data || (size == 0)) {\n\t\treturn SERVICE_E_INVALID_ARG;\n\t}\n\n\tres = idevice_to_service_error(idevice_connection_receive_timeout(client->connection, data, size, (uint32_t*)&bytes, timeout));\n\tif (bytes <= 0) {\n\t\tdebug_info(\"could not read data\");\n\t}\n\tif (received) {\n\t\t*received = (uint32_t)bytes;\n\t}\n\n\treturn res;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic property_list_service_error_t internal_plist_receive_timeout(property_list_service_client_t client, plist_t *plist, unsigned int timeout)\n{\n\tproperty_list_service_error_t res = PROPERTY_LIST_SERVICE_E_UNKNOWN_ERROR;\n\tuint32_t pktlen = 0;\n\tuint32_t bytes = 0;\n\n\tif (!client || (client && !client->parent) || !plist) {\n\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\t}\n\n\t*plist = NULL;\n\tservice_error_t serr = service_receive_with_timeout(client->parent, (char*)&pktlen, sizeof(pktlen), &bytes, timeout);\n\tif ((serr == SERVICE_E_SUCCESS) && (bytes == 0)) {\n\t\treturn PROPERTY_LIST_SERVICE_E_RECEIVE_TIMEOUT;\n\t}\n\tdebug_info(\"initial read=%i\", bytes);\n\tif (bytes < 4) {\n\t\tdebug_info(\"initial read failed!\");\n\t\treturn PROPERTY_LIST_SERVICE_E_MUX_ERROR;\n\t} else {\n\t\tpktlen = be32toh(pktlen);\n\t\tif (pktlen < (1 << 24)) { /* prevent huge buffers */\n\t\t\tuint32_t curlen = 0;\n\t\t\tchar *content = NULL;\n\t\t\tdebug_info(\"%d bytes following\", pktlen);\n\t\t\tcontent = (char*)malloc(pktlen);\n\t\t\tif (!content) {\n\t\t\t\tdebug_info(\"out of memory when allocating %d bytes\", pktlen);\n\t\t\t\treturn PROPERTY_LIST_SERVICE_E_UNKNOWN_ERROR;\n\t\t\t}\n\n\t\t\twhile (curlen < pktlen) {\n\t\t\t\tservice_receive(client->parent, content+curlen, pktlen-curlen, &bytes);\n\t\t\t\tif (bytes <= 0) {\n\t\t\t\t\tres = PROPERTY_LIST_SERVICE_E_MUX_ERROR;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tdebug_info(\"received %d bytes\", bytes);\n\t\t\t\tcurlen += bytes;\n\t\t\t}\n\t\t\tif (curlen < pktlen) {\n\t\t\t\tdebug_info(\"received incomplete packet (%d of %d bytes)\", curlen, pktlen);\n\t\t\t\tif (curlen > 0) {\n\t\t\t\t\tdebug_info(\"incomplete packet following:\");\n\t\t\t\t\tdebug_buffer(content, curlen);\n\t\t\t\t}\n\t\t\t\tfree(content);\n\t\t\t\treturn res;\n\t\t\t}\n\t\t\tif ((pktlen > 8) && !memcmp(content, \"bplist00\", 8)) {\n\t\t\t\tplist_from_bin(content, pktlen, plist);\n\t\t\t} else if ((pktlen > 5) && !memcmp(content, \"<?xml\", 5)) {\n\t\t\t\t/* iOS 4.3+ hack: plist data might contain invalid characters, thus we convert those to spaces */\n\t\t\t\tfor (bytes = 0; bytes < pktlen-1; bytes++) {\n\t\t\t\t\tif ((content[bytes] >= 0) && (content[bytes] < 0x20) && (content[bytes] != 0x09) && (content[bytes] != 0x0a) && (content[bytes] != 0x0d))\n\t\t\t\t\t\tcontent[bytes] = 0x20;\n\t\t\t\t}\n\t\t\t\tplist_from_xml(content, pktlen, plist);\n\t\t\t} else {\n\t\t\t\tdebug_info(\"WARNING: received unexpected non-plist content\");\n\t\t\t\tdebug_buffer(content, pktlen);\n\t\t\t}\n\t\t\tif (*plist) {\n\t\t\t\tdebug_plist(*plist);\n\t\t\t\tres = PROPERTY_LIST_SERVICE_E_SUCCESS;\n\t\t\t} else {\n\t\t\t\tres = PROPERTY_LIST_SERVICE_E_PLIST_ERROR;\n\t\t\t}\n\t\t\tfree(content);\n\t\t\tcontent = NULL;\n\t\t} else {\n\t\t\tres = PROPERTY_LIST_SERVICE_E_UNKNOWN_ERROR;\n\t\t}\n\t}\n\treturn res;\n}"
  },
  {
    "function_name": "property_list_service_send_binary_plist",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
    "lines": "155-158",
    "snippet": "LIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_send_binary_plist(property_list_service_client_t client, plist_t plist)\n{\n\treturn internal_plist_send(client, plist, 1);\n}",
    "includes": [
      "#include \"endianness.h\"",
      "#include \"common/debug.h\"",
      "#include \"property_list_service.h\"",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "internal_plist_send",
          "args": [
            "client",
            "plist",
            "1"
          ],
          "line": 157
        },
        "resolved": true,
        "details": {
          "function_name": "internal_plist_send",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
          "lines": "104-148",
          "snippet": "static property_list_service_error_t internal_plist_send(property_list_service_client_t client, plist_t plist, int binary)\n{\n\tproperty_list_service_error_t res = PROPERTY_LIST_SERVICE_E_UNKNOWN_ERROR;\n\tchar *content = NULL;\n\tuint32_t length = 0;\n\tuint32_t nlen = 0;\n\tint bytes = 0;\n\n\tif (!client || (client && !client->parent) || !plist) {\n\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\t}\n\n\tif (binary) {\n\t\tplist_to_bin(plist, &content, &length);\n\t} else {\n\t\tplist_to_xml(plist, &content, &length);\n\t}\n\n\tif (!content || length == 0) {\n\t\treturn PROPERTY_LIST_SERVICE_E_PLIST_ERROR;\n\t}\n\n\tnlen = htobe32(length);\n\tdebug_info(\"sending %d bytes\", length);\n\tservice_send(client->parent, (const char*)&nlen, sizeof(nlen), (uint32_t*)&bytes);\n\tif (bytes == sizeof(nlen)) {\n\t\tservice_send(client->parent, content, length, (uint32_t*)&bytes);\n\t\tif (bytes > 0) {\n\t\t\tdebug_info(\"sent %d bytes\", bytes);\n\t\t\tdebug_plist(plist);\n\t\t\tif ((uint32_t)bytes == length) {\n\t\t\t\tres = PROPERTY_LIST_SERVICE_E_SUCCESS;\n\t\t\t} else {\n\t\t\t\tdebug_info(\"ERROR: Could not send all data (%d of %d)!\", bytes, length);\n\t\t\t}\n\t\t}\n\t}\n\tif (bytes <= 0) {\n\t\tdebug_info(\"ERROR: sending to device failed.\");\n\t}\n\n\tfree(content);\n\n\treturn res;\n}",
          "includes": [
            "#include \"endianness.h\"",
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic property_list_service_error_t internal_plist_send(property_list_service_client_t client, plist_t plist, int binary)\n{\n\tproperty_list_service_error_t res = PROPERTY_LIST_SERVICE_E_UNKNOWN_ERROR;\n\tchar *content = NULL;\n\tuint32_t length = 0;\n\tuint32_t nlen = 0;\n\tint bytes = 0;\n\n\tif (!client || (client && !client->parent) || !plist) {\n\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\t}\n\n\tif (binary) {\n\t\tplist_to_bin(plist, &content, &length);\n\t} else {\n\t\tplist_to_xml(plist, &content, &length);\n\t}\n\n\tif (!content || length == 0) {\n\t\treturn PROPERTY_LIST_SERVICE_E_PLIST_ERROR;\n\t}\n\n\tnlen = htobe32(length);\n\tdebug_info(\"sending %d bytes\", length);\n\tservice_send(client->parent, (const char*)&nlen, sizeof(nlen), (uint32_t*)&bytes);\n\tif (bytes == sizeof(nlen)) {\n\t\tservice_send(client->parent, content, length, (uint32_t*)&bytes);\n\t\tif (bytes > 0) {\n\t\t\tdebug_info(\"sent %d bytes\", bytes);\n\t\t\tdebug_plist(plist);\n\t\t\tif ((uint32_t)bytes == length) {\n\t\t\t\tres = PROPERTY_LIST_SERVICE_E_SUCCESS;\n\t\t\t} else {\n\t\t\t\tdebug_info(\"ERROR: Could not send all data (%d of %d)!\", bytes, length);\n\t\t\t}\n\t\t}\n\t}\n\tif (bytes <= 0) {\n\t\tdebug_info(\"ERROR: sending to device failed.\");\n\t}\n\n\tfree(content);\n\n\treturn res;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_send_binary_plist(property_list_service_client_t client, plist_t plist)\n{\n\treturn internal_plist_send(client, plist, 1);\n}"
  },
  {
    "function_name": "property_list_service_send_xml_plist",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
    "lines": "150-153",
    "snippet": "LIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_send_xml_plist(property_list_service_client_t client, plist_t plist)\n{\n\treturn internal_plist_send(client, plist, 0);\n}",
    "includes": [
      "#include \"endianness.h\"",
      "#include \"common/debug.h\"",
      "#include \"property_list_service.h\"",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "internal_plist_send",
          "args": [
            "client",
            "plist",
            "0"
          ],
          "line": 152
        },
        "resolved": true,
        "details": {
          "function_name": "internal_plist_send",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
          "lines": "104-148",
          "snippet": "static property_list_service_error_t internal_plist_send(property_list_service_client_t client, plist_t plist, int binary)\n{\n\tproperty_list_service_error_t res = PROPERTY_LIST_SERVICE_E_UNKNOWN_ERROR;\n\tchar *content = NULL;\n\tuint32_t length = 0;\n\tuint32_t nlen = 0;\n\tint bytes = 0;\n\n\tif (!client || (client && !client->parent) || !plist) {\n\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\t}\n\n\tif (binary) {\n\t\tplist_to_bin(plist, &content, &length);\n\t} else {\n\t\tplist_to_xml(plist, &content, &length);\n\t}\n\n\tif (!content || length == 0) {\n\t\treturn PROPERTY_LIST_SERVICE_E_PLIST_ERROR;\n\t}\n\n\tnlen = htobe32(length);\n\tdebug_info(\"sending %d bytes\", length);\n\tservice_send(client->parent, (const char*)&nlen, sizeof(nlen), (uint32_t*)&bytes);\n\tif (bytes == sizeof(nlen)) {\n\t\tservice_send(client->parent, content, length, (uint32_t*)&bytes);\n\t\tif (bytes > 0) {\n\t\t\tdebug_info(\"sent %d bytes\", bytes);\n\t\t\tdebug_plist(plist);\n\t\t\tif ((uint32_t)bytes == length) {\n\t\t\t\tres = PROPERTY_LIST_SERVICE_E_SUCCESS;\n\t\t\t} else {\n\t\t\t\tdebug_info(\"ERROR: Could not send all data (%d of %d)!\", bytes, length);\n\t\t\t}\n\t\t}\n\t}\n\tif (bytes <= 0) {\n\t\tdebug_info(\"ERROR: sending to device failed.\");\n\t}\n\n\tfree(content);\n\n\treturn res;\n}",
          "includes": [
            "#include \"endianness.h\"",
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic property_list_service_error_t internal_plist_send(property_list_service_client_t client, plist_t plist, int binary)\n{\n\tproperty_list_service_error_t res = PROPERTY_LIST_SERVICE_E_UNKNOWN_ERROR;\n\tchar *content = NULL;\n\tuint32_t length = 0;\n\tuint32_t nlen = 0;\n\tint bytes = 0;\n\n\tif (!client || (client && !client->parent) || !plist) {\n\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\t}\n\n\tif (binary) {\n\t\tplist_to_bin(plist, &content, &length);\n\t} else {\n\t\tplist_to_xml(plist, &content, &length);\n\t}\n\n\tif (!content || length == 0) {\n\t\treturn PROPERTY_LIST_SERVICE_E_PLIST_ERROR;\n\t}\n\n\tnlen = htobe32(length);\n\tdebug_info(\"sending %d bytes\", length);\n\tservice_send(client->parent, (const char*)&nlen, sizeof(nlen), (uint32_t*)&bytes);\n\tif (bytes == sizeof(nlen)) {\n\t\tservice_send(client->parent, content, length, (uint32_t*)&bytes);\n\t\tif (bytes > 0) {\n\t\t\tdebug_info(\"sent %d bytes\", bytes);\n\t\t\tdebug_plist(plist);\n\t\t\tif ((uint32_t)bytes == length) {\n\t\t\t\tres = PROPERTY_LIST_SERVICE_E_SUCCESS;\n\t\t\t} else {\n\t\t\t\tdebug_info(\"ERROR: Could not send all data (%d of %d)!\", bytes, length);\n\t\t\t}\n\t\t}\n\t}\n\tif (bytes <= 0) {\n\t\tdebug_info(\"ERROR: sending to device failed.\");\n\t}\n\n\tfree(content);\n\n\treturn res;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_send_xml_plist(property_list_service_client_t client, plist_t plist)\n{\n\treturn internal_plist_send(client, plist, 0);\n}"
  },
  {
    "function_name": "internal_plist_send",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
    "lines": "104-148",
    "snippet": "static property_list_service_error_t internal_plist_send(property_list_service_client_t client, plist_t plist, int binary)\n{\n\tproperty_list_service_error_t res = PROPERTY_LIST_SERVICE_E_UNKNOWN_ERROR;\n\tchar *content = NULL;\n\tuint32_t length = 0;\n\tuint32_t nlen = 0;\n\tint bytes = 0;\n\n\tif (!client || (client && !client->parent) || !plist) {\n\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\t}\n\n\tif (binary) {\n\t\tplist_to_bin(plist, &content, &length);\n\t} else {\n\t\tplist_to_xml(plist, &content, &length);\n\t}\n\n\tif (!content || length == 0) {\n\t\treturn PROPERTY_LIST_SERVICE_E_PLIST_ERROR;\n\t}\n\n\tnlen = htobe32(length);\n\tdebug_info(\"sending %d bytes\", length);\n\tservice_send(client->parent, (const char*)&nlen, sizeof(nlen), (uint32_t*)&bytes);\n\tif (bytes == sizeof(nlen)) {\n\t\tservice_send(client->parent, content, length, (uint32_t*)&bytes);\n\t\tif (bytes > 0) {\n\t\t\tdebug_info(\"sent %d bytes\", bytes);\n\t\t\tdebug_plist(plist);\n\t\t\tif ((uint32_t)bytes == length) {\n\t\t\t\tres = PROPERTY_LIST_SERVICE_E_SUCCESS;\n\t\t\t} else {\n\t\t\t\tdebug_info(\"ERROR: Could not send all data (%d of %d)!\", bytes, length);\n\t\t\t}\n\t\t}\n\t}\n\tif (bytes <= 0) {\n\t\tdebug_info(\"ERROR: sending to device failed.\");\n\t}\n\n\tfree(content);\n\n\treturn res;\n}",
    "includes": [
      "#include \"endianness.h\"",
      "#include \"common/debug.h\"",
      "#include \"property_list_service.h\"",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "content"
          ],
          "line": 145
        },
        "resolved": true,
        "details": {
          "function_name": "property_list_service_client_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
          "lines": "77-88",
          "snippet": "LIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_client_free(property_list_service_client_t client)\n{\n\tif (!client)\n\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\n\tproperty_list_service_error_t err = service_to_property_list_service_error(service_client_free(client->parent));\n\n\tfree(client);\n\tclient = NULL;\n\n\treturn err;\n}",
          "includes": [
            "#include \"endianness.h\"",
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_client_free(property_list_service_client_t client)\n{\n\tif (!client)\n\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\n\tproperty_list_service_error_t err = service_to_property_list_service_error(service_client_free(client->parent));\n\n\tfree(client);\n\tclient = NULL;\n\n\treturn err;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"ERROR: sending to device failed.\""
          ],
          "line": 142
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"ERROR: Could not send all data (%d of %d)!\"",
            "bytes",
            "length"
          ],
          "line": 137
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_plist",
          "args": [
            "plist"
          ],
          "line": 133
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"sent %d bytes\"",
            "bytes"
          ],
          "line": 132
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "service_send",
          "args": [
            "client->parent",
            "content",
            "length",
            "(uint32_t*)&bytes"
          ],
          "line": 130
        },
        "resolved": true,
        "details": {
          "function_name": "service_send",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/service.c",
          "lines": "131-150",
          "snippet": "LIBIMOBILEDEVICE_API service_error_t service_send(service_client_t client, const char* data, uint32_t size, uint32_t *sent)\n{\n\tservice_error_t res = SERVICE_E_UNKNOWN_ERROR;\n\tint bytes = 0;\n\n\tif (!client || (client && !client->connection) || !data || (size == 0)) {\n\t\treturn SERVICE_E_INVALID_ARG;\n\t}\n\n\tdebug_info(\"sending %d bytes\", size);\n\tres = idevice_to_service_error(idevice_connection_send(client->connection, data, size, (uint32_t*)&bytes));\n\tif (bytes <= 0) {\n\t\tdebug_info(\"ERROR: sending to device failed.\");\n\t}\n\tif (sent) {\n\t\t*sent = (uint32_t)bytes;\n\t}\n\n\treturn res;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API service_error_t service_send(service_client_t client, const char* data, uint32_t size, uint32_t *sent)\n{\n\tservice_error_t res = SERVICE_E_UNKNOWN_ERROR;\n\tint bytes = 0;\n\n\tif (!client || (client && !client->connection) || !data || (size == 0)) {\n\t\treturn SERVICE_E_INVALID_ARG;\n\t}\n\n\tdebug_info(\"sending %d bytes\", size);\n\tres = idevice_to_service_error(idevice_connection_send(client->connection, data, size, (uint32_t*)&bytes));\n\tif (bytes <= 0) {\n\t\tdebug_info(\"ERROR: sending to device failed.\");\n\t}\n\tif (sent) {\n\t\t*sent = (uint32_t)bytes;\n\t}\n\n\treturn res;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"sending %d bytes\"",
            "length"
          ],
          "line": 127
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "htobe32",
          "args": [
            "length"
          ],
          "line": 126
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_to_xml",
          "args": [
            "plist",
            "&content",
            "&length"
          ],
          "line": 119
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_to_bin",
          "args": [
            "plist",
            "&content",
            "&length"
          ],
          "line": 117
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic property_list_service_error_t internal_plist_send(property_list_service_client_t client, plist_t plist, int binary)\n{\n\tproperty_list_service_error_t res = PROPERTY_LIST_SERVICE_E_UNKNOWN_ERROR;\n\tchar *content = NULL;\n\tuint32_t length = 0;\n\tuint32_t nlen = 0;\n\tint bytes = 0;\n\n\tif (!client || (client && !client->parent) || !plist) {\n\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\t}\n\n\tif (binary) {\n\t\tplist_to_bin(plist, &content, &length);\n\t} else {\n\t\tplist_to_xml(plist, &content, &length);\n\t}\n\n\tif (!content || length == 0) {\n\t\treturn PROPERTY_LIST_SERVICE_E_PLIST_ERROR;\n\t}\n\n\tnlen = htobe32(length);\n\tdebug_info(\"sending %d bytes\", length);\n\tservice_send(client->parent, (const char*)&nlen, sizeof(nlen), (uint32_t*)&bytes);\n\tif (bytes == sizeof(nlen)) {\n\t\tservice_send(client->parent, content, length, (uint32_t*)&bytes);\n\t\tif (bytes > 0) {\n\t\t\tdebug_info(\"sent %d bytes\", bytes);\n\t\t\tdebug_plist(plist);\n\t\t\tif ((uint32_t)bytes == length) {\n\t\t\t\tres = PROPERTY_LIST_SERVICE_E_SUCCESS;\n\t\t\t} else {\n\t\t\t\tdebug_info(\"ERROR: Could not send all data (%d of %d)!\", bytes, length);\n\t\t\t}\n\t\t}\n\t}\n\tif (bytes <= 0) {\n\t\tdebug_info(\"ERROR: sending to device failed.\");\n\t}\n\n\tfree(content);\n\n\treturn res;\n}"
  },
  {
    "function_name": "property_list_service_client_free",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
    "lines": "77-88",
    "snippet": "LIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_client_free(property_list_service_client_t client)\n{\n\tif (!client)\n\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\n\tproperty_list_service_error_t err = service_to_property_list_service_error(service_client_free(client->parent));\n\n\tfree(client);\n\tclient = NULL;\n\n\treturn err;\n}",
    "includes": [
      "#include \"endianness.h\"",
      "#include \"common/debug.h\"",
      "#include \"property_list_service.h\"",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "client"
          ],
          "line": 84
        },
        "resolved": true,
        "details": {
          "function_name": "property_list_service_client_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
          "lines": "77-88",
          "snippet": "LIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_client_free(property_list_service_client_t client)\n{\n\tif (!client)\n\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\n\tproperty_list_service_error_t err = service_to_property_list_service_error(service_client_free(client->parent));\n\n\tfree(client);\n\tclient = NULL;\n\n\treturn err;\n}",
          "note": "cyclic_reference_detected"
        }
      },
      {
        "call_info": {
          "callee": "service_to_property_list_service_error",
          "args": [
            "service_client_free(client->parent)"
          ],
          "line": 82
        },
        "resolved": true,
        "details": {
          "function_name": "service_to_property_list_service_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
          "lines": "40-55",
          "snippet": "static property_list_service_error_t service_to_property_list_service_error(service_error_t err)\n{\n\tswitch (err) {\n\t\tcase SERVICE_E_SUCCESS:\n\t\t\treturn PROPERTY_LIST_SERVICE_E_SUCCESS;\n\t\tcase SERVICE_E_INVALID_ARG:\n\t\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\t\tcase SERVICE_E_MUX_ERROR:\n\t\t\treturn PROPERTY_LIST_SERVICE_E_MUX_ERROR;\n\t\tcase SERVICE_E_SSL_ERROR:\n\t\t\treturn PROPERTY_LIST_SERVICE_E_SSL_ERROR;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn PROPERTY_LIST_SERVICE_E_UNKNOWN_ERROR;\n}",
          "includes": [
            "#include \"endianness.h\"",
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic property_list_service_error_t service_to_property_list_service_error(service_error_t err)\n{\n\tswitch (err) {\n\t\tcase SERVICE_E_SUCCESS:\n\t\t\treturn PROPERTY_LIST_SERVICE_E_SUCCESS;\n\t\tcase SERVICE_E_INVALID_ARG:\n\t\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\t\tcase SERVICE_E_MUX_ERROR:\n\t\t\treturn PROPERTY_LIST_SERVICE_E_MUX_ERROR;\n\t\tcase SERVICE_E_SSL_ERROR:\n\t\t\treturn PROPERTY_LIST_SERVICE_E_SSL_ERROR;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn PROPERTY_LIST_SERVICE_E_UNKNOWN_ERROR;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_client_free(property_list_service_client_t client)\n{\n\tif (!client)\n\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\n\tproperty_list_service_error_t err = service_to_property_list_service_error(service_client_free(client->parent));\n\n\tfree(client);\n\tclient = NULL;\n\n\treturn err;\n}"
  },
  {
    "function_name": "property_list_service_client_new",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
    "lines": "57-75",
    "snippet": "LIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_client_new(idevice_t device, lockdownd_service_descriptor_t service, property_list_service_client_t *client)\n{\n\tif (!device || !service || service->port == 0 || !client || *client)\n\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\n\tservice_client_t parent = NULL;\n\tservice_error_t rerr = service_client_new(device, service, &parent);\n\tif (rerr != SERVICE_E_SUCCESS) {\n\t\treturn service_to_property_list_service_error(rerr);\n\t}\n\n\t/* create client object */\n\tproperty_list_service_client_t client_loc = (property_list_service_client_t)malloc(sizeof(struct property_list_service_client_private));\n\tclient_loc->parent = parent;\n\n\t/* all done, return success */\n\t*client = client_loc;\n\treturn PROPERTY_LIST_SERVICE_E_SUCCESS;\n}",
    "includes": [
      "#include \"endianness.h\"",
      "#include \"common/debug.h\"",
      "#include \"property_list_service.h\"",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "malloc",
          "args": [
            "sizeof(struct property_list_service_client_private)"
          ],
          "line": 69
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "service_to_property_list_service_error",
          "args": [
            "rerr"
          ],
          "line": 65
        },
        "resolved": true,
        "details": {
          "function_name": "service_to_property_list_service_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
          "lines": "40-55",
          "snippet": "static property_list_service_error_t service_to_property_list_service_error(service_error_t err)\n{\n\tswitch (err) {\n\t\tcase SERVICE_E_SUCCESS:\n\t\t\treturn PROPERTY_LIST_SERVICE_E_SUCCESS;\n\t\tcase SERVICE_E_INVALID_ARG:\n\t\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\t\tcase SERVICE_E_MUX_ERROR:\n\t\t\treturn PROPERTY_LIST_SERVICE_E_MUX_ERROR;\n\t\tcase SERVICE_E_SSL_ERROR:\n\t\t\treturn PROPERTY_LIST_SERVICE_E_SSL_ERROR;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn PROPERTY_LIST_SERVICE_E_UNKNOWN_ERROR;\n}",
          "includes": [
            "#include \"endianness.h\"",
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic property_list_service_error_t service_to_property_list_service_error(service_error_t err)\n{\n\tswitch (err) {\n\t\tcase SERVICE_E_SUCCESS:\n\t\t\treturn PROPERTY_LIST_SERVICE_E_SUCCESS;\n\t\tcase SERVICE_E_INVALID_ARG:\n\t\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\t\tcase SERVICE_E_MUX_ERROR:\n\t\t\treturn PROPERTY_LIST_SERVICE_E_MUX_ERROR;\n\t\tcase SERVICE_E_SSL_ERROR:\n\t\t\treturn PROPERTY_LIST_SERVICE_E_SSL_ERROR;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn PROPERTY_LIST_SERVICE_E_UNKNOWN_ERROR;\n}"
        }
      },
      {
        "call_info": {
          "callee": "service_client_new",
          "args": [
            "device",
            "service",
            "&parent"
          ],
          "line": 63
        },
        "resolved": true,
        "details": {
          "function_name": "property_list_service_client_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
          "lines": "57-75",
          "snippet": "LIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_client_new(idevice_t device, lockdownd_service_descriptor_t service, property_list_service_client_t *client)\n{\n\tif (!device || !service || service->port == 0 || !client || *client)\n\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\n\tservice_client_t parent = NULL;\n\tservice_error_t rerr = service_client_new(device, service, &parent);\n\tif (rerr != SERVICE_E_SUCCESS) {\n\t\treturn service_to_property_list_service_error(rerr);\n\t}\n\n\t/* create client object */\n\tproperty_list_service_client_t client_loc = (property_list_service_client_t)malloc(sizeof(struct property_list_service_client_private));\n\tclient_loc->parent = parent;\n\n\t/* all done, return success */\n\t*client = client_loc;\n\treturn PROPERTY_LIST_SERVICE_E_SUCCESS;\n}",
          "note": "cyclic_reference_detected"
        }
      }
    ],
    "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_client_new(idevice_t device, lockdownd_service_descriptor_t service, property_list_service_client_t *client)\n{\n\tif (!device || !service || service->port == 0 || !client || *client)\n\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\n\tservice_client_t parent = NULL;\n\tservice_error_t rerr = service_client_new(device, service, &parent);\n\tif (rerr != SERVICE_E_SUCCESS) {\n\t\treturn service_to_property_list_service_error(rerr);\n\t}\n\n\t/* create client object */\n\tproperty_list_service_client_t client_loc = (property_list_service_client_t)malloc(sizeof(struct property_list_service_client_private));\n\tclient_loc->parent = parent;\n\n\t/* all done, return success */\n\t*client = client_loc;\n\treturn PROPERTY_LIST_SERVICE_E_SUCCESS;\n}"
  },
  {
    "function_name": "service_to_property_list_service_error",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
    "lines": "40-55",
    "snippet": "static property_list_service_error_t service_to_property_list_service_error(service_error_t err)\n{\n\tswitch (err) {\n\t\tcase SERVICE_E_SUCCESS:\n\t\t\treturn PROPERTY_LIST_SERVICE_E_SUCCESS;\n\t\tcase SERVICE_E_INVALID_ARG:\n\t\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\t\tcase SERVICE_E_MUX_ERROR:\n\t\t\treturn PROPERTY_LIST_SERVICE_E_MUX_ERROR;\n\t\tcase SERVICE_E_SSL_ERROR:\n\t\t\treturn PROPERTY_LIST_SERVICE_E_SSL_ERROR;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn PROPERTY_LIST_SERVICE_E_UNKNOWN_ERROR;\n}",
    "includes": [
      "#include \"endianness.h\"",
      "#include \"common/debug.h\"",
      "#include \"property_list_service.h\"",
      "#include <string.h>",
      "#include <stdlib.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic property_list_service_error_t service_to_property_list_service_error(service_error_t err)\n{\n\tswitch (err) {\n\t\tcase SERVICE_E_SUCCESS:\n\t\t\treturn PROPERTY_LIST_SERVICE_E_SUCCESS;\n\t\tcase SERVICE_E_INVALID_ARG:\n\t\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\t\tcase SERVICE_E_MUX_ERROR:\n\t\t\treturn PROPERTY_LIST_SERVICE_E_MUX_ERROR;\n\t\tcase SERVICE_E_SSL_ERROR:\n\t\t\treturn PROPERTY_LIST_SERVICE_E_SSL_ERROR;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn PROPERTY_LIST_SERVICE_E_UNKNOWN_ERROR;\n}"
  }
]