[
  {
    "function_name": "thread_once",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/common/thread.c",
    "lines": "92-106",
    "snippet": "void thread_once(thread_once_t *once_control, void (*init_routine)(void))\n{\n#ifdef WIN32\n\twhile (InterlockedExchange(&(once_control->lock), 1) != 0) {\n\t\tSleep(1);\n\t}\n\tif (!once_control->state) {\n\t\tonce_control->state = 1;\n\t\tinit_routine();\n\t}\n\tInterlockedExchange(&(once_control->lock), 0);\n#else\n\tpthread_once(once_control, init_routine);\n#endif\n}",
    "includes": [
      "#include \"thread.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "pthread_once",
          "args": [
            "once_control",
            "init_routine"
          ],
          "line": 104
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "InterlockedExchange",
          "args": [
            "&(once_control->lock)",
            "0"
          ],
          "line": 102
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "init_routine",
          "args": [],
          "line": 100
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Sleep",
          "args": [
            "1"
          ],
          "line": 96
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "InterlockedExchange",
          "args": [
            "&(once_control->lock)",
            "1"
          ],
          "line": 95
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"thread.h\"\n\nvoid thread_once(thread_once_t *once_control, void (*init_routine)(void))\n{\n#ifdef WIN32\n\twhile (InterlockedExchange(&(once_control->lock), 1) != 0) {\n\t\tSleep(1);\n\t}\n\tif (!once_control->state) {\n\t\tonce_control->state = 1;\n\t\tinit_routine();\n\t}\n\tInterlockedExchange(&(once_control->lock), 0);\n#else\n\tpthread_once(once_control, init_routine);\n#endif\n}"
  },
  {
    "function_name": "mutex_unlock",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/common/thread.c",
    "lines": "83-90",
    "snippet": "void mutex_unlock(mutex_t* mutex)\n{\n#ifdef WIN32\n\tLeaveCriticalSection(mutex);\n#else\n\tpthread_mutex_unlock(mutex);\n#endif\n}",
    "includes": [
      "#include \"thread.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "pthread_mutex_unlock",
          "args": [
            "mutex"
          ],
          "line": 88
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "LeaveCriticalSection",
          "args": [
            "mutex"
          ],
          "line": 86
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"thread.h\"\n\nvoid mutex_unlock(mutex_t* mutex)\n{\n#ifdef WIN32\n\tLeaveCriticalSection(mutex);\n#else\n\tpthread_mutex_unlock(mutex);\n#endif\n}"
  },
  {
    "function_name": "mutex_lock",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/common/thread.c",
    "lines": "74-81",
    "snippet": "void mutex_lock(mutex_t* mutex)\n{\n#ifdef WIN32\n\tEnterCriticalSection(mutex);\n#else\n\tpthread_mutex_lock(mutex);\n#endif\n}",
    "includes": [
      "#include \"thread.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "pthread_mutex_lock",
          "args": [
            "mutex"
          ],
          "line": 79
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "EnterCriticalSection",
          "args": [
            "mutex"
          ],
          "line": 77
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"thread.h\"\n\nvoid mutex_lock(mutex_t* mutex)\n{\n#ifdef WIN32\n\tEnterCriticalSection(mutex);\n#else\n\tpthread_mutex_lock(mutex);\n#endif\n}"
  },
  {
    "function_name": "mutex_destroy",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/common/thread.c",
    "lines": "65-72",
    "snippet": "void mutex_destroy(mutex_t* mutex)\n{\n#ifdef WIN32\n\tDeleteCriticalSection(mutex);\n#else\n\tpthread_mutex_destroy(mutex);\n#endif\n}",
    "includes": [
      "#include \"thread.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "pthread_mutex_destroy",
          "args": [
            "mutex"
          ],
          "line": 70
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DeleteCriticalSection",
          "args": [
            "mutex"
          ],
          "line": 68
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"thread.h\"\n\nvoid mutex_destroy(mutex_t* mutex)\n{\n#ifdef WIN32\n\tDeleteCriticalSection(mutex);\n#else\n\tpthread_mutex_destroy(mutex);\n#endif\n}"
  },
  {
    "function_name": "mutex_init",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/common/thread.c",
    "lines": "56-63",
    "snippet": "void mutex_init(mutex_t* mutex)\n{\n#ifdef WIN32\n\tInitializeCriticalSection(mutex);\n#else\n\tpthread_mutex_init(mutex, NULL);\n#endif\n}",
    "includes": [
      "#include \"thread.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "pthread_mutex_init",
          "args": [
            "mutex",
            "NULL"
          ],
          "line": 61
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "InitializeCriticalSection",
          "args": [
            "mutex"
          ],
          "line": 59
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"thread.h\"\n\nvoid mutex_init(mutex_t* mutex)\n{\n#ifdef WIN32\n\tInitializeCriticalSection(mutex);\n#else\n\tpthread_mutex_init(mutex, NULL);\n#endif\n}"
  },
  {
    "function_name": "thread_join",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/common/thread.c",
    "lines": "46-54",
    "snippet": "void thread_join(thread_t thread)\n{\n\t/* wait for thread to complete */\n#ifdef WIN32\n\tWaitForSingleObject(thread, INFINITE);\n#else\n\tpthread_join(thread, NULL);\n#endif\n}",
    "includes": [
      "#include \"thread.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "pthread_join",
          "args": [
            "thread",
            "NULL"
          ],
          "line": 52
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "WaitForSingleObject",
          "args": [
            "thread",
            "INFINITE"
          ],
          "line": 50
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"thread.h\"\n\nvoid thread_join(thread_t thread)\n{\n\t/* wait for thread to complete */\n#ifdef WIN32\n\tWaitForSingleObject(thread, INFINITE);\n#else\n\tpthread_join(thread, NULL);\n#endif\n}"
  },
  {
    "function_name": "thread_free",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/common/thread.c",
    "lines": "39-44",
    "snippet": "void thread_free(thread_t thread)\n{\n#ifdef WIN32\n\tCloseHandle(thread);\n#endif\n}",
    "includes": [
      "#include \"thread.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "CloseHandle",
          "args": [
            "thread"
          ],
          "line": 42
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"thread.h\"\n\nvoid thread_free(thread_t thread)\n{\n#ifdef WIN32\n\tCloseHandle(thread);\n#endif\n}"
  },
  {
    "function_name": "thread_new",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/common/thread.c",
    "lines": "24-37",
    "snippet": "int thread_new(thread_t *thread, thread_func_t thread_func, void* data)\n{\n#ifdef WIN32\n\tHANDLE th = CreateThread(NULL, 0, (LPTHREAD_START_ROUTINE)thread_func, data, 0, NULL);\n\tif (th == NULL) {\n\t\treturn -1;\n\t}\n\t*thread = th;\n\treturn 0;\n#else\n\tint res = pthread_create(thread, NULL, thread_func, data);\n\treturn res;\n#endif\n}",
    "includes": [
      "#include \"thread.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "pthread_create",
          "args": [
            "thread",
            "NULL",
            "thread_func",
            "data"
          ],
          "line": 34
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "CreateThread",
          "args": [
            "NULL",
            "0",
            "(LPTHREAD_START_ROUTINE)thread_func",
            "data",
            "0",
            "NULL"
          ],
          "line": 27
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"thread.h\"\n\nint thread_new(thread_t *thread, thread_func_t thread_func, void* data)\n{\n#ifdef WIN32\n\tHANDLE th = CreateThread(NULL, 0, (LPTHREAD_START_ROUTINE)thread_func, data, 0, NULL);\n\tif (th == NULL) {\n\t\treturn -1;\n\t}\n\t*thread = th;\n\treturn 0;\n#else\n\tint res = pthread_create(thread, NULL, thread_func, data);\n\treturn res;\n#endif\n}"
  }
]