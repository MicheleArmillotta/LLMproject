[
  {
    "function_name": "device_link_service_receive",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/device_link_service.c",
    "lines": "452-462",
    "snippet": "device_link_service_error_t device_link_service_receive(device_link_service_client_t client, plist_t *plist)\n{\n\tif (!client || !plist || (plist && *plist)) {\n\t\treturn DEVICE_LINK_SERVICE_E_INVALID_ARG;\n\t}\n\n\tif (property_list_service_receive_plist(client->parent, plist) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\treturn DEVICE_LINK_SERVICE_E_MUX_ERROR;\n\t}\n\treturn DEVICE_LINK_SERVICE_E_SUCCESS;\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"property_list_service.h\"",
      "#include \"device_link_service.h\"",
      "#include <stdlib.h>",
      "#include <string.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "property_list_service_receive_plist",
          "args": [
            "client->parent",
            "plist"
          ],
          "line": 458
        },
        "resolved": true,
        "details": {
          "function_name": "property_list_service_receive_plist",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
          "lines": "258-261",
          "snippet": "LIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_receive_plist(property_list_service_client_t client, plist_t *plist)\n{\n\treturn internal_plist_receive_timeout(client, plist, 10000);\n}",
          "includes": [
            "#include \"endianness.h\"",
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_receive_plist(property_list_service_client_t client, plist_t *plist)\n{\n\treturn internal_plist_receive_timeout(client, plist, 10000);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"device_link_service.h\"\n#include <stdlib.h>\n#include <string.h>\n\ndevice_link_service_error_t device_link_service_receive(device_link_service_client_t client, plist_t *plist)\n{\n\tif (!client || !plist || (plist && *plist)) {\n\t\treturn DEVICE_LINK_SERVICE_E_INVALID_ARG;\n\t}\n\n\tif (property_list_service_receive_plist(client->parent, plist) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\treturn DEVICE_LINK_SERVICE_E_MUX_ERROR;\n\t}\n\treturn DEVICE_LINK_SERVICE_E_SUCCESS;\n}"
  },
  {
    "function_name": "device_link_service_send",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/device_link_service.c",
    "lines": "430-439",
    "snippet": "device_link_service_error_t device_link_service_send(device_link_service_client_t client, plist_t plist)\n{\n\tif (!client || !plist) {\n\t\treturn DEVICE_LINK_SERVICE_E_INVALID_ARG;\n\t}\n\tif (property_list_service_send_binary_plist(client->parent, plist) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\treturn DEVICE_LINK_SERVICE_E_MUX_ERROR;\n\t}\n\treturn DEVICE_LINK_SERVICE_E_SUCCESS;\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"property_list_service.h\"",
      "#include \"device_link_service.h\"",
      "#include <stdlib.h>",
      "#include <string.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "property_list_service_send_binary_plist",
          "args": [
            "client->parent",
            "plist"
          ],
          "line": 435
        },
        "resolved": true,
        "details": {
          "function_name": "property_list_service_send_binary_plist",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
          "lines": "155-158",
          "snippet": "LIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_send_binary_plist(property_list_service_client_t client, plist_t plist)\n{\n\treturn internal_plist_send(client, plist, 1);\n}",
          "includes": [
            "#include \"endianness.h\"",
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_send_binary_plist(property_list_service_client_t client, plist_t plist)\n{\n\treturn internal_plist_send(client, plist, 1);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"device_link_service.h\"\n#include <stdlib.h>\n#include <string.h>\n\ndevice_link_service_error_t device_link_service_send(device_link_service_client_t client, plist_t plist)\n{\n\tif (!client || !plist) {\n\t\treturn DEVICE_LINK_SERVICE_E_INVALID_ARG;\n\t}\n\tif (property_list_service_send_binary_plist(client->parent, plist) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\treturn DEVICE_LINK_SERVICE_E_MUX_ERROR;\n\t}\n\treturn DEVICE_LINK_SERVICE_E_SUCCESS;\n}"
  },
  {
    "function_name": "device_link_service_receive_process_message",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/device_link_service.c",
    "lines": "375-417",
    "snippet": "device_link_service_error_t device_link_service_receive_process_message(device_link_service_client_t client, plist_t *message)\n{\n\tif (!client || !client->parent || !message)\n\t\treturn DEVICE_LINK_SERVICE_E_INVALID_ARG;\n\n\tplist_t pmsg = NULL;\n\tif (property_list_service_receive_plist(client->parent, &pmsg) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\treturn DEVICE_LINK_SERVICE_E_MUX_ERROR;\n\t}\n\n\tdevice_link_service_error_t err = DEVICE_LINK_SERVICE_E_UNKNOWN_ERROR;\n\n\tchar *msg = NULL;\n\tdevice_link_service_get_message(pmsg, &msg);\n\tif (!msg || strcmp(msg, \"DLMessageProcessMessage\")) {\n\t\tdebug_info(\"Did not receive DLMessageProcessMessage as expected!\");\n\t\terr = DEVICE_LINK_SERVICE_E_PLIST_ERROR;\n\t\tgoto leave;\n\t}\n\n\tif (plist_array_get_size(pmsg) != 2) {\n\t\tdebug_info(\"Malformed plist received for DLMessageProcessMessage\");\n\t\terr = DEVICE_LINK_SERVICE_E_PLIST_ERROR;\n\t\tgoto leave;\n\t}\n\n\tplist_t msg_loc = plist_array_get_item(pmsg, 1);\n\tif (msg_loc) {\n\t\t*message = plist_copy(msg_loc);\n\t\terr = DEVICE_LINK_SERVICE_E_SUCCESS;\n\t} else {\n\t\t*message = NULL;\n\t\terr = DEVICE_LINK_SERVICE_E_PLIST_ERROR;\n\t}\n\nleave:\n\tif (msg)\n\t\tfree(msg);\n\tif (pmsg)\n\t\tplist_free(pmsg);\n\n\treturn err;\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"property_list_service.h\"",
      "#include \"device_link_service.h\"",
      "#include <stdlib.h>",
      "#include <string.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "pmsg"
          ],
          "line": 414
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "msg"
          ],
          "line": 412
        },
        "resolved": true,
        "details": {
          "function_name": "device_link_service_client_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/device_link_service.c",
          "lines": "119-129",
          "snippet": "device_link_service_error_t device_link_service_client_free(device_link_service_client_t client)\n{\n\tif (!client)\n\t\treturn DEVICE_LINK_SERVICE_E_INVALID_ARG;\n\n\tif (property_list_service_client_free(client->parent) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\treturn DEVICE_LINK_SERVICE_E_UNKNOWN_ERROR;\n\t}\n\tfree(client);\n\treturn DEVICE_LINK_SERVICE_E_SUCCESS;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include \"device_link_service.h\"",
            "#include <stdlib.h>",
            "#include <string.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"device_link_service.h\"\n#include <stdlib.h>\n#include <string.h>\n\ndevice_link_service_error_t device_link_service_client_free(device_link_service_client_t client)\n{\n\tif (!client)\n\t\treturn DEVICE_LINK_SERVICE_E_INVALID_ARG;\n\n\tif (property_list_service_client_free(client->parent) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\treturn DEVICE_LINK_SERVICE_E_UNKNOWN_ERROR;\n\t}\n\tfree(client);\n\treturn DEVICE_LINK_SERVICE_E_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_copy",
          "args": [
            "msg_loc"
          ],
          "line": 403
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_array_get_item",
          "args": [
            "pmsg",
            "1"
          ],
          "line": 401
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"Malformed plist received for DLMessageProcessMessage\""
          ],
          "line": 396
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_array_get_size",
          "args": [
            "pmsg"
          ],
          "line": 395
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"Did not receive DLMessageProcessMessage as expected!\""
          ],
          "line": 390
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "msg",
            "\"DLMessageProcessMessage\""
          ],
          "line": 389
        },
        "resolved": true,
        "details": {
          "function_name": "plist_strcmp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/tools/idevicebackup.c",
          "lines": "296-309",
          "snippet": "static int plist_strcmp(plist_t node, const char *str)\n{\n\tchar *buffer = NULL;\n\tint ret = 0;\n\n\tif (plist_get_node_type(node) != PLIST_STRING)\n\t\treturn ret;\n\n\tplist_get_string_val(node, &buffer);\n\tret = strcmp(buffer, str);\n\tfree(buffer);\n\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"common/utils.h\"",
            "#include <libimobiledevice/afc.h>",
            "#include <libimobiledevice/notification_proxy.h>",
            "#include <libimobiledevice/mobilebackup.h>",
            "#include <libimobiledevice/lockdown.h>",
            "#include <libimobiledevice/libimobiledevice.h>",
            "#include <time.h>",
            "#include <ctype.h>",
            "#include <unistd.h>",
            "#include <gcrypt.h>",
            "#include <openssl/sha.h>",
            "#include <signal.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"common/utils.h\"\n#include <libimobiledevice/afc.h>\n#include <libimobiledevice/notification_proxy.h>\n#include <libimobiledevice/mobilebackup.h>\n#include <libimobiledevice/lockdown.h>\n#include <libimobiledevice/libimobiledevice.h>\n#include <time.h>\n#include <ctype.h>\n#include <unistd.h>\n#include <gcrypt.h>\n#include <openssl/sha.h>\n#include <signal.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int plist_strcmp(plist_t node, const char *str)\n{\n\tchar *buffer = NULL;\n\tint ret = 0;\n\n\tif (plist_get_node_type(node) != PLIST_STRING)\n\t\treturn ret;\n\n\tplist_get_string_val(node, &buffer);\n\tret = strcmp(buffer, str);\n\tfree(buffer);\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "device_link_service_get_message",
          "args": [
            "pmsg",
            "&msg"
          ],
          "line": 388
        },
        "resolved": true,
        "details": {
          "function_name": "device_link_service_get_message",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/device_link_service.c",
          "lines": "40-71",
          "snippet": "static int device_link_service_get_message(plist_t dl_msg, char **message)\n{\n\tplist_t cmd = NULL;\n\tchar *cmd_str = NULL;\n\n\t/* sanity check */\n\tif ((plist_get_node_type(dl_msg) != PLIST_ARRAY) || (plist_array_get_size(dl_msg) < 1)) {\n\t\treturn 0;\n\t}\n\n\t/* get dl command */\n\tcmd = plist_array_get_item(dl_msg, 0);\n\tif (!cmd || (plist_get_node_type(cmd) != PLIST_STRING)) {\n\t\treturn 0;\n\t}\n\n\tplist_get_string_val(cmd, &cmd_str);\n\tif (!cmd_str) {\n\t\treturn 0;\n\t}\n\n\tif ((strlen(cmd_str) < 9) || (strncmp(cmd_str, \"DL\", 2))) {\n\t\tfree(cmd_str);\n\t\treturn 0;\n\t}\n\n\tif (message)\n\t\t*message = cmd_str;\n\n\t/* we got a DL* message */\n\treturn 1;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include \"device_link_service.h\"",
            "#include <stdlib.h>",
            "#include <string.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"device_link_service.h\"\n#include <stdlib.h>\n#include <string.h>\n\nstatic int device_link_service_get_message(plist_t dl_msg, char **message)\n{\n\tplist_t cmd = NULL;\n\tchar *cmd_str = NULL;\n\n\t/* sanity check */\n\tif ((plist_get_node_type(dl_msg) != PLIST_ARRAY) || (plist_array_get_size(dl_msg) < 1)) {\n\t\treturn 0;\n\t}\n\n\t/* get dl command */\n\tcmd = plist_array_get_item(dl_msg, 0);\n\tif (!cmd || (plist_get_node_type(cmd) != PLIST_STRING)) {\n\t\treturn 0;\n\t}\n\n\tplist_get_string_val(cmd, &cmd_str);\n\tif (!cmd_str) {\n\t\treturn 0;\n\t}\n\n\tif ((strlen(cmd_str) < 9) || (strncmp(cmd_str, \"DL\", 2))) {\n\t\tfree(cmd_str);\n\t\treturn 0;\n\t}\n\n\tif (message)\n\t\t*message = cmd_str;\n\n\t/* we got a DL* message */\n\treturn 1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "property_list_service_receive_plist",
          "args": [
            "client->parent",
            "&pmsg"
          ],
          "line": 381
        },
        "resolved": true,
        "details": {
          "function_name": "property_list_service_receive_plist",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
          "lines": "258-261",
          "snippet": "LIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_receive_plist(property_list_service_client_t client, plist_t *plist)\n{\n\treturn internal_plist_receive_timeout(client, plist, 10000);\n}",
          "includes": [
            "#include \"endianness.h\"",
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_receive_plist(property_list_service_client_t client, plist_t *plist)\n{\n\treturn internal_plist_receive_timeout(client, plist, 10000);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"device_link_service.h\"\n#include <stdlib.h>\n#include <string.h>\n\ndevice_link_service_error_t device_link_service_receive_process_message(device_link_service_client_t client, plist_t *message)\n{\n\tif (!client || !client->parent || !message)\n\t\treturn DEVICE_LINK_SERVICE_E_INVALID_ARG;\n\n\tplist_t pmsg = NULL;\n\tif (property_list_service_receive_plist(client->parent, &pmsg) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\treturn DEVICE_LINK_SERVICE_E_MUX_ERROR;\n\t}\n\n\tdevice_link_service_error_t err = DEVICE_LINK_SERVICE_E_UNKNOWN_ERROR;\n\n\tchar *msg = NULL;\n\tdevice_link_service_get_message(pmsg, &msg);\n\tif (!msg || strcmp(msg, \"DLMessageProcessMessage\")) {\n\t\tdebug_info(\"Did not receive DLMessageProcessMessage as expected!\");\n\t\terr = DEVICE_LINK_SERVICE_E_PLIST_ERROR;\n\t\tgoto leave;\n\t}\n\n\tif (plist_array_get_size(pmsg) != 2) {\n\t\tdebug_info(\"Malformed plist received for DLMessageProcessMessage\");\n\t\terr = DEVICE_LINK_SERVICE_E_PLIST_ERROR;\n\t\tgoto leave;\n\t}\n\n\tplist_t msg_loc = plist_array_get_item(pmsg, 1);\n\tif (msg_loc) {\n\t\t*message = plist_copy(msg_loc);\n\t\terr = DEVICE_LINK_SERVICE_E_SUCCESS;\n\t} else {\n\t\t*message = NULL;\n\t\terr = DEVICE_LINK_SERVICE_E_PLIST_ERROR;\n\t}\n\nleave:\n\tif (msg)\n\t\tfree(msg);\n\tif (pmsg)\n\t\tplist_free(pmsg);\n\n\treturn err;\n}"
  },
  {
    "function_name": "device_link_service_receive_message",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/device_link_service.c",
    "lines": "345-360",
    "snippet": "device_link_service_error_t device_link_service_receive_message(device_link_service_client_t client, plist_t *msg_plist, char **dlmessage)\n{\n\tif (!client || !client->parent || !msg_plist)\n\t\treturn DEVICE_LINK_SERVICE_E_INVALID_ARG;\n\n\t*msg_plist = NULL;\n\tif (property_list_service_receive_plist(client->parent, msg_plist) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\treturn DEVICE_LINK_SERVICE_E_MUX_ERROR;\n\t}\n\n\tif (!device_link_service_get_message(*msg_plist, dlmessage)) {\n\t\tdebug_info(\"Did not receive a DL* message as expected!\");\n\t\treturn DEVICE_LINK_SERVICE_E_PLIST_ERROR;\n\t}\n\treturn DEVICE_LINK_SERVICE_E_SUCCESS;\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"property_list_service.h\"",
      "#include \"device_link_service.h\"",
      "#include <stdlib.h>",
      "#include <string.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"Did not receive a DL* message as expected!\""
          ],
          "line": 356
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device_link_service_get_message",
          "args": [
            "*msg_plist",
            "dlmessage"
          ],
          "line": 355
        },
        "resolved": true,
        "details": {
          "function_name": "device_link_service_get_message",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/device_link_service.c",
          "lines": "40-71",
          "snippet": "static int device_link_service_get_message(plist_t dl_msg, char **message)\n{\n\tplist_t cmd = NULL;\n\tchar *cmd_str = NULL;\n\n\t/* sanity check */\n\tif ((plist_get_node_type(dl_msg) != PLIST_ARRAY) || (plist_array_get_size(dl_msg) < 1)) {\n\t\treturn 0;\n\t}\n\n\t/* get dl command */\n\tcmd = plist_array_get_item(dl_msg, 0);\n\tif (!cmd || (plist_get_node_type(cmd) != PLIST_STRING)) {\n\t\treturn 0;\n\t}\n\n\tplist_get_string_val(cmd, &cmd_str);\n\tif (!cmd_str) {\n\t\treturn 0;\n\t}\n\n\tif ((strlen(cmd_str) < 9) || (strncmp(cmd_str, \"DL\", 2))) {\n\t\tfree(cmd_str);\n\t\treturn 0;\n\t}\n\n\tif (message)\n\t\t*message = cmd_str;\n\n\t/* we got a DL* message */\n\treturn 1;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include \"device_link_service.h\"",
            "#include <stdlib.h>",
            "#include <string.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"device_link_service.h\"\n#include <stdlib.h>\n#include <string.h>\n\nstatic int device_link_service_get_message(plist_t dl_msg, char **message)\n{\n\tplist_t cmd = NULL;\n\tchar *cmd_str = NULL;\n\n\t/* sanity check */\n\tif ((plist_get_node_type(dl_msg) != PLIST_ARRAY) || (plist_array_get_size(dl_msg) < 1)) {\n\t\treturn 0;\n\t}\n\n\t/* get dl command */\n\tcmd = plist_array_get_item(dl_msg, 0);\n\tif (!cmd || (plist_get_node_type(cmd) != PLIST_STRING)) {\n\t\treturn 0;\n\t}\n\n\tplist_get_string_val(cmd, &cmd_str);\n\tif (!cmd_str) {\n\t\treturn 0;\n\t}\n\n\tif ((strlen(cmd_str) < 9) || (strncmp(cmd_str, \"DL\", 2))) {\n\t\tfree(cmd_str);\n\t\treturn 0;\n\t}\n\n\tif (message)\n\t\t*message = cmd_str;\n\n\t/* we got a DL* message */\n\treturn 1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "property_list_service_receive_plist",
          "args": [
            "client->parent",
            "msg_plist"
          ],
          "line": 351
        },
        "resolved": true,
        "details": {
          "function_name": "property_list_service_receive_plist",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
          "lines": "258-261",
          "snippet": "LIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_receive_plist(property_list_service_client_t client, plist_t *plist)\n{\n\treturn internal_plist_receive_timeout(client, plist, 10000);\n}",
          "includes": [
            "#include \"endianness.h\"",
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_receive_plist(property_list_service_client_t client, plist_t *plist)\n{\n\treturn internal_plist_receive_timeout(client, plist, 10000);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"device_link_service.h\"\n#include <stdlib.h>\n#include <string.h>\n\ndevice_link_service_error_t device_link_service_receive_message(device_link_service_client_t client, plist_t *msg_plist, char **dlmessage)\n{\n\tif (!client || !client->parent || !msg_plist)\n\t\treturn DEVICE_LINK_SERVICE_E_INVALID_ARG;\n\n\t*msg_plist = NULL;\n\tif (property_list_service_receive_plist(client->parent, msg_plist) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\treturn DEVICE_LINK_SERVICE_E_MUX_ERROR;\n\t}\n\n\tif (!device_link_service_get_message(*msg_plist, dlmessage)) {\n\t\tdebug_info(\"Did not receive a DL* message as expected!\");\n\t\treturn DEVICE_LINK_SERVICE_E_PLIST_ERROR;\n\t}\n\treturn DEVICE_LINK_SERVICE_E_SUCCESS;\n}"
  },
  {
    "function_name": "device_link_service_send_process_message",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/device_link_service.c",
    "lines": "308-326",
    "snippet": "device_link_service_error_t device_link_service_send_process_message(device_link_service_client_t client, plist_t message)\n{\n\tif (!client || !client->parent || !message)\n\t\treturn DEVICE_LINK_SERVICE_E_INVALID_ARG;\n\n\tif (plist_get_node_type(message) != PLIST_DICT)\n\t\treturn DEVICE_LINK_SERVICE_E_INVALID_ARG;\n\n\tplist_t array = plist_new_array();\n\tplist_array_append_item(array, plist_new_string(\"DLMessageProcessMessage\"));\n\tplist_array_append_item(array, plist_copy(message));\n\n\tdevice_link_service_error_t err = DEVICE_LINK_SERVICE_E_SUCCESS;\n\tif (property_list_service_send_binary_plist(client->parent, array) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\terr = DEVICE_LINK_SERVICE_E_MUX_ERROR;\n\t}\n\tplist_free(array);\n\treturn err;\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"property_list_service.h\"",
      "#include \"device_link_service.h\"",
      "#include <stdlib.h>",
      "#include <string.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "array"
          ],
          "line": 324
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "property_list_service_send_binary_plist",
          "args": [
            "client->parent",
            "array"
          ],
          "line": 321
        },
        "resolved": true,
        "details": {
          "function_name": "property_list_service_send_binary_plist",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
          "lines": "155-158",
          "snippet": "LIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_send_binary_plist(property_list_service_client_t client, plist_t plist)\n{\n\treturn internal_plist_send(client, plist, 1);\n}",
          "includes": [
            "#include \"endianness.h\"",
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_send_binary_plist(property_list_service_client_t client, plist_t plist)\n{\n\treturn internal_plist_send(client, plist, 1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_array_append_item",
          "args": [
            "array",
            "plist_copy(message)"
          ],
          "line": 318
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_copy",
          "args": [
            "message"
          ],
          "line": 318
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_array_append_item",
          "args": [
            "array",
            "plist_new_string(\"DLMessageProcessMessage\")"
          ],
          "line": 317
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "\"DLMessageProcessMessage\""
          ],
          "line": 317
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_array",
          "args": [],
          "line": 316
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_get_node_type",
          "args": [
            "message"
          ],
          "line": 313
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"device_link_service.h\"\n#include <stdlib.h>\n#include <string.h>\n\ndevice_link_service_error_t device_link_service_send_process_message(device_link_service_client_t client, plist_t message)\n{\n\tif (!client || !client->parent || !message)\n\t\treturn DEVICE_LINK_SERVICE_E_INVALID_ARG;\n\n\tif (plist_get_node_type(message) != PLIST_DICT)\n\t\treturn DEVICE_LINK_SERVICE_E_INVALID_ARG;\n\n\tplist_t array = plist_new_array();\n\tplist_array_append_item(array, plist_new_string(\"DLMessageProcessMessage\"));\n\tplist_array_append_item(array, plist_copy(message));\n\n\tdevice_link_service_error_t err = DEVICE_LINK_SERVICE_E_SUCCESS;\n\tif (property_list_service_send_binary_plist(client->parent, array) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\terr = DEVICE_LINK_SERVICE_E_MUX_ERROR;\n\t}\n\tplist_free(array);\n\treturn err;\n}"
  },
  {
    "function_name": "device_link_service_send_ping",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/device_link_service.c",
    "lines": "280-295",
    "snippet": "device_link_service_error_t device_link_service_send_ping(device_link_service_client_t client, const char *message)\n{\n\tif (!client || !client->parent || !message)\n\t\treturn DEVICE_LINK_SERVICE_E_INVALID_ARG;\n\n\tplist_t array = plist_new_array();\n\tplist_array_append_item(array, plist_new_string(\"DLMessagePing\"));\n\tplist_array_append_item(array, plist_new_string(message));\n\n\tdevice_link_service_error_t err = DEVICE_LINK_SERVICE_E_SUCCESS;\n\tif (property_list_service_send_binary_plist(client->parent, array) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\terr = DEVICE_LINK_SERVICE_E_MUX_ERROR;\n\t}\n\tplist_free(array);\n\treturn err;\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"property_list_service.h\"",
      "#include \"device_link_service.h\"",
      "#include <stdlib.h>",
      "#include <string.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "array"
          ],
          "line": 293
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "property_list_service_send_binary_plist",
          "args": [
            "client->parent",
            "array"
          ],
          "line": 290
        },
        "resolved": true,
        "details": {
          "function_name": "property_list_service_send_binary_plist",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
          "lines": "155-158",
          "snippet": "LIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_send_binary_plist(property_list_service_client_t client, plist_t plist)\n{\n\treturn internal_plist_send(client, plist, 1);\n}",
          "includes": [
            "#include \"endianness.h\"",
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_send_binary_plist(property_list_service_client_t client, plist_t plist)\n{\n\treturn internal_plist_send(client, plist, 1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_array_append_item",
          "args": [
            "array",
            "plist_new_string(message)"
          ],
          "line": 287
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "message"
          ],
          "line": 287
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_array_append_item",
          "args": [
            "array",
            "plist_new_string(\"DLMessagePing\")"
          ],
          "line": 286
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "\"DLMessagePing\""
          ],
          "line": 286
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_array",
          "args": [],
          "line": 285
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"device_link_service.h\"\n#include <stdlib.h>\n#include <string.h>\n\ndevice_link_service_error_t device_link_service_send_ping(device_link_service_client_t client, const char *message)\n{\n\tif (!client || !client->parent || !message)\n\t\treturn DEVICE_LINK_SERVICE_E_INVALID_ARG;\n\n\tplist_t array = plist_new_array();\n\tplist_array_append_item(array, plist_new_string(\"DLMessagePing\"));\n\tplist_array_append_item(array, plist_new_string(message));\n\n\tdevice_link_service_error_t err = DEVICE_LINK_SERVICE_E_SUCCESS;\n\tif (property_list_service_send_binary_plist(client->parent, array) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\terr = DEVICE_LINK_SERVICE_E_MUX_ERROR;\n\t}\n\tplist_free(array);\n\treturn err;\n}"
  },
  {
    "function_name": "device_link_service_disconnect",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/device_link_service.c",
    "lines": "249-267",
    "snippet": "device_link_service_error_t device_link_service_disconnect(device_link_service_client_t client, const char *message)\n{\n\tif (!client)\n\t\treturn DEVICE_LINK_SERVICE_E_INVALID_ARG;\n\n\tplist_t array = plist_new_array();\n\tplist_array_append_item(array, plist_new_string(\"DLMessageDisconnect\"));\n\tif (message)\n\t\tplist_array_append_item(array, plist_new_string(message));\n\telse\n\t\tplist_array_append_item(array, plist_new_string(\"___EmptyParameterString___\"));\n\n\tdevice_link_service_error_t err = DEVICE_LINK_SERVICE_E_SUCCESS;\n\tif (property_list_service_send_binary_plist(client->parent, array) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\terr = DEVICE_LINK_SERVICE_E_MUX_ERROR;\n\t}\n\tplist_free(array);\n\treturn err;\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"property_list_service.h\"",
      "#include \"device_link_service.h\"",
      "#include <stdlib.h>",
      "#include <string.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "array"
          ],
          "line": 265
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "property_list_service_send_binary_plist",
          "args": [
            "client->parent",
            "array"
          ],
          "line": 262
        },
        "resolved": true,
        "details": {
          "function_name": "property_list_service_send_binary_plist",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
          "lines": "155-158",
          "snippet": "LIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_send_binary_plist(property_list_service_client_t client, plist_t plist)\n{\n\treturn internal_plist_send(client, plist, 1);\n}",
          "includes": [
            "#include \"endianness.h\"",
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_send_binary_plist(property_list_service_client_t client, plist_t plist)\n{\n\treturn internal_plist_send(client, plist, 1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_array_append_item",
          "args": [
            "array",
            "plist_new_string(\"___EmptyParameterString___\")"
          ],
          "line": 259
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "\"___EmptyParameterString___\""
          ],
          "line": 259
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_array_append_item",
          "args": [
            "array",
            "plist_new_string(message)"
          ],
          "line": 257
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "message"
          ],
          "line": 257
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_array_append_item",
          "args": [
            "array",
            "plist_new_string(\"DLMessageDisconnect\")"
          ],
          "line": 255
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "\"DLMessageDisconnect\""
          ],
          "line": 255
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_array",
          "args": [],
          "line": 254
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"device_link_service.h\"\n#include <stdlib.h>\n#include <string.h>\n\ndevice_link_service_error_t device_link_service_disconnect(device_link_service_client_t client, const char *message)\n{\n\tif (!client)\n\t\treturn DEVICE_LINK_SERVICE_E_INVALID_ARG;\n\n\tplist_t array = plist_new_array();\n\tplist_array_append_item(array, plist_new_string(\"DLMessageDisconnect\"));\n\tif (message)\n\t\tplist_array_append_item(array, plist_new_string(message));\n\telse\n\t\tplist_array_append_item(array, plist_new_string(\"___EmptyParameterString___\"));\n\n\tdevice_link_service_error_t err = DEVICE_LINK_SERVICE_E_SUCCESS;\n\tif (property_list_service_send_binary_plist(client->parent, array) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\terr = DEVICE_LINK_SERVICE_E_MUX_ERROR;\n\t}\n\tplist_free(array);\n\treturn err;\n}"
  },
  {
    "function_name": "device_link_service_version_exchange",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/device_link_service.c",
    "lines": "148-236",
    "snippet": "device_link_service_error_t device_link_service_version_exchange(device_link_service_client_t client, uint64_t version_major, uint64_t version_minor)\n{\n\tif (!client)\n\t\treturn DEVICE_LINK_SERVICE_E_INVALID_ARG;\n\n\tdevice_link_service_error_t err = DEVICE_LINK_SERVICE_E_UNKNOWN_ERROR;\n\n\t/* perform version exchange */\n\tplist_t array = NULL;\n\tchar *msg = NULL;\n\n\t/* receive DLMessageVersionExchange from device */\n\tif (property_list_service_receive_plist(client->parent, &array) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tdebug_info(\"Did not receive initial message from device!\");\n\t\terr = DEVICE_LINK_SERVICE_E_MUX_ERROR;\n\t\tgoto leave;\n\t}\n\tdevice_link_service_get_message(array, &msg);\n\tif (!msg || strcmp(msg, \"DLMessageVersionExchange\")) {\n\t\tdebug_info(\"Did not receive DLMessageVersionExchange from device!\");\n\t\terr = DEVICE_LINK_SERVICE_E_PLIST_ERROR;\n\t\tgoto leave;\n\t}\n\tfree(msg);\n\tmsg = NULL;\n\n\t/* get major and minor version number */\n\tif (plist_array_get_size(array) < 3) {\n\t\tdebug_info(\"DLMessageVersionExchange has unexpected format!\");\n\t\terr = DEVICE_LINK_SERVICE_E_PLIST_ERROR;\n\t\tgoto leave;\n\t}\n\tplist_t maj = plist_array_get_item(array, 1);\n\tplist_t min = plist_array_get_item(array, 2);\n\tuint64_t vmajor = 0;\n\tuint64_t vminor = 0;\n\tif (maj) {\n\t\tplist_get_uint_val(maj, &vmajor);\n\t}\n\tif (min) {\n\t\tplist_get_uint_val(min, &vminor);\n\t}\n\tif (vmajor > version_major) {\n\t\tdebug_info(\"Version mismatch: device=(%lld,%lld) > expected=(%lld,%lld)\", vmajor, vminor, version_major, version_minor);\n\t\terr = DEVICE_LINK_SERVICE_E_BAD_VERSION;\n\t\tgoto leave;\n\t} else if ((vmajor == version_major) && (vminor > version_minor)) {\n\t\tdebug_info(\"WARNING: Version mismatch: device=(%lld,%lld) > expected=(%lld,%lld)\", vmajor, vminor, version_major, version_minor);\n\t\terr = DEVICE_LINK_SERVICE_E_BAD_VERSION;\n\t\tgoto leave;\n\t}\n\tplist_free(array);\n\n\t/* version is ok, send reply */\n\tarray = plist_new_array();\n\tplist_array_append_item(array, plist_new_string(\"DLMessageVersionExchange\"));\n\tplist_array_append_item(array, plist_new_string(\"DLVersionsOk\"));\n\tplist_array_append_item(array, plist_new_uint(version_major));\n\tif (property_list_service_send_binary_plist(client->parent, array) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tdebug_info(\"Error when sending DLVersionsOk\");\n\t\terr = DEVICE_LINK_SERVICE_E_MUX_ERROR;\n\t\tgoto leave;\n\t}\n\tplist_free(array);\n\n\t/* receive DeviceReady message */\n\tarray = NULL;\n\tif (property_list_service_receive_plist(client->parent, &array) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tdebug_info(\"Error when receiving DLMessageDeviceReady!\");\n\t\terr = DEVICE_LINK_SERVICE_E_MUX_ERROR;\n\t\tgoto leave;\n\t}\n\tdevice_link_service_get_message(array, &msg);\n\tif (!msg || strcmp(msg, \"DLMessageDeviceReady\")) {\n\t\tdebug_info(\"Did not get DLMessageDeviceReady!\");\n\t\terr = DEVICE_LINK_SERVICE_E_PLIST_ERROR;\n\t\tgoto leave;\n\t}\n\terr = DEVICE_LINK_SERVICE_E_SUCCESS;\n\nleave:\n\tif (msg) {\n\t\tfree(msg);\n\t}\n\tif (array) {\n\t\tplist_free(array);\n\t}\n\treturn err;\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"property_list_service.h\"",
      "#include \"device_link_service.h\"",
      "#include <stdlib.h>",
      "#include <string.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "array"
          ],
          "line": 233
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "msg"
          ],
          "line": 230
        },
        "resolved": true,
        "details": {
          "function_name": "device_link_service_client_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/device_link_service.c",
          "lines": "119-129",
          "snippet": "device_link_service_error_t device_link_service_client_free(device_link_service_client_t client)\n{\n\tif (!client)\n\t\treturn DEVICE_LINK_SERVICE_E_INVALID_ARG;\n\n\tif (property_list_service_client_free(client->parent) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\treturn DEVICE_LINK_SERVICE_E_UNKNOWN_ERROR;\n\t}\n\tfree(client);\n\treturn DEVICE_LINK_SERVICE_E_SUCCESS;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include \"device_link_service.h\"",
            "#include <stdlib.h>",
            "#include <string.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"device_link_service.h\"\n#include <stdlib.h>\n#include <string.h>\n\ndevice_link_service_error_t device_link_service_client_free(device_link_service_client_t client)\n{\n\tif (!client)\n\t\treturn DEVICE_LINK_SERVICE_E_INVALID_ARG;\n\n\tif (property_list_service_client_free(client->parent) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\treturn DEVICE_LINK_SERVICE_E_UNKNOWN_ERROR;\n\t}\n\tfree(client);\n\treturn DEVICE_LINK_SERVICE_E_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"Did not get DLMessageDeviceReady!\""
          ],
          "line": 222
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "msg",
            "\"DLMessageDeviceReady\""
          ],
          "line": 221
        },
        "resolved": true,
        "details": {
          "function_name": "plist_strcmp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/tools/idevicebackup.c",
          "lines": "296-309",
          "snippet": "static int plist_strcmp(plist_t node, const char *str)\n{\n\tchar *buffer = NULL;\n\tint ret = 0;\n\n\tif (plist_get_node_type(node) != PLIST_STRING)\n\t\treturn ret;\n\n\tplist_get_string_val(node, &buffer);\n\tret = strcmp(buffer, str);\n\tfree(buffer);\n\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"common/utils.h\"",
            "#include <libimobiledevice/afc.h>",
            "#include <libimobiledevice/notification_proxy.h>",
            "#include <libimobiledevice/mobilebackup.h>",
            "#include <libimobiledevice/lockdown.h>",
            "#include <libimobiledevice/libimobiledevice.h>",
            "#include <time.h>",
            "#include <ctype.h>",
            "#include <unistd.h>",
            "#include <gcrypt.h>",
            "#include <openssl/sha.h>",
            "#include <signal.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"common/utils.h\"\n#include <libimobiledevice/afc.h>\n#include <libimobiledevice/notification_proxy.h>\n#include <libimobiledevice/mobilebackup.h>\n#include <libimobiledevice/lockdown.h>\n#include <libimobiledevice/libimobiledevice.h>\n#include <time.h>\n#include <ctype.h>\n#include <unistd.h>\n#include <gcrypt.h>\n#include <openssl/sha.h>\n#include <signal.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int plist_strcmp(plist_t node, const char *str)\n{\n\tchar *buffer = NULL;\n\tint ret = 0;\n\n\tif (plist_get_node_type(node) != PLIST_STRING)\n\t\treturn ret;\n\n\tplist_get_string_val(node, &buffer);\n\tret = strcmp(buffer, str);\n\tfree(buffer);\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "device_link_service_get_message",
          "args": [
            "array",
            "&msg"
          ],
          "line": 220
        },
        "resolved": true,
        "details": {
          "function_name": "device_link_service_get_message",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/device_link_service.c",
          "lines": "40-71",
          "snippet": "static int device_link_service_get_message(plist_t dl_msg, char **message)\n{\n\tplist_t cmd = NULL;\n\tchar *cmd_str = NULL;\n\n\t/* sanity check */\n\tif ((plist_get_node_type(dl_msg) != PLIST_ARRAY) || (plist_array_get_size(dl_msg) < 1)) {\n\t\treturn 0;\n\t}\n\n\t/* get dl command */\n\tcmd = plist_array_get_item(dl_msg, 0);\n\tif (!cmd || (plist_get_node_type(cmd) != PLIST_STRING)) {\n\t\treturn 0;\n\t}\n\n\tplist_get_string_val(cmd, &cmd_str);\n\tif (!cmd_str) {\n\t\treturn 0;\n\t}\n\n\tif ((strlen(cmd_str) < 9) || (strncmp(cmd_str, \"DL\", 2))) {\n\t\tfree(cmd_str);\n\t\treturn 0;\n\t}\n\n\tif (message)\n\t\t*message = cmd_str;\n\n\t/* we got a DL* message */\n\treturn 1;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include \"device_link_service.h\"",
            "#include <stdlib.h>",
            "#include <string.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"device_link_service.h\"\n#include <stdlib.h>\n#include <string.h>\n\nstatic int device_link_service_get_message(plist_t dl_msg, char **message)\n{\n\tplist_t cmd = NULL;\n\tchar *cmd_str = NULL;\n\n\t/* sanity check */\n\tif ((plist_get_node_type(dl_msg) != PLIST_ARRAY) || (plist_array_get_size(dl_msg) < 1)) {\n\t\treturn 0;\n\t}\n\n\t/* get dl command */\n\tcmd = plist_array_get_item(dl_msg, 0);\n\tif (!cmd || (plist_get_node_type(cmd) != PLIST_STRING)) {\n\t\treturn 0;\n\t}\n\n\tplist_get_string_val(cmd, &cmd_str);\n\tif (!cmd_str) {\n\t\treturn 0;\n\t}\n\n\tif ((strlen(cmd_str) < 9) || (strncmp(cmd_str, \"DL\", 2))) {\n\t\tfree(cmd_str);\n\t\treturn 0;\n\t}\n\n\tif (message)\n\t\t*message = cmd_str;\n\n\t/* we got a DL* message */\n\treturn 1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"Error when receiving DLMessageDeviceReady!\""
          ],
          "line": 216
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "property_list_service_receive_plist",
          "args": [
            "client->parent",
            "&array"
          ],
          "line": 215
        },
        "resolved": true,
        "details": {
          "function_name": "property_list_service_receive_plist",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
          "lines": "258-261",
          "snippet": "LIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_receive_plist(property_list_service_client_t client, plist_t *plist)\n{\n\treturn internal_plist_receive_timeout(client, plist, 10000);\n}",
          "includes": [
            "#include \"endianness.h\"",
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_receive_plist(property_list_service_client_t client, plist_t *plist)\n{\n\treturn internal_plist_receive_timeout(client, plist, 10000);\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "array"
          ],
          "line": 211
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"Error when sending DLVersionsOk\""
          ],
          "line": 207
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "property_list_service_send_binary_plist",
          "args": [
            "client->parent",
            "array"
          ],
          "line": 206
        },
        "resolved": true,
        "details": {
          "function_name": "property_list_service_send_binary_plist",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
          "lines": "155-158",
          "snippet": "LIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_send_binary_plist(property_list_service_client_t client, plist_t plist)\n{\n\treturn internal_plist_send(client, plist, 1);\n}",
          "includes": [
            "#include \"endianness.h\"",
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_send_binary_plist(property_list_service_client_t client, plist_t plist)\n{\n\treturn internal_plist_send(client, plist, 1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_array_append_item",
          "args": [
            "array",
            "plist_new_uint(version_major)"
          ],
          "line": 205
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_uint",
          "args": [
            "version_major"
          ],
          "line": 205
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_array_append_item",
          "args": [
            "array",
            "plist_new_string(\"DLVersionsOk\")"
          ],
          "line": 204
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "\"DLVersionsOk\""
          ],
          "line": 204
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_array_append_item",
          "args": [
            "array",
            "plist_new_string(\"DLMessageVersionExchange\")"
          ],
          "line": 203
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "\"DLMessageVersionExchange\""
          ],
          "line": 203
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_array",
          "args": [],
          "line": 202
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "array"
          ],
          "line": 199
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"WARNING: Version mismatch: device=(%lld,%lld) > expected=(%lld,%lld)\"",
            "vmajor",
            "vminor",
            "version_major",
            "version_minor"
          ],
          "line": 195
        },
        "resolved": true,
        "details": {
          "function_name": "debug_info_real",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/common/debug.c",
          "lines": "81-99",
          "snippet": "void debug_info_real(const char *func, const char *file, int line, const char *format, ...)\n{\n#ifndef STRIP_DEBUG_CODE\n\tva_list args;\n\tchar *buffer = NULL;\n\n\tif (!debug_level)\n\t\treturn;\n\n\t/* run the real fprintf */\n\tva_start(args, format);\n\t(void)vasprintf(&buffer, format, args);\n\tva_end(args);\n\n\tdebug_print_line(func, file, line, buffer);\n\n\tfree(buffer);\n#endif\n}",
          "includes": [
            "#include \"asprintf.h\"",
            "#include \"src/idevice.h\"",
            "#include \"libimobiledevice/libimobiledevice.h\"",
            "#include \"debug.h\"",
            "#include <time.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int debug_level;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"asprintf.h\"\n#include \"src/idevice.h\"\n#include \"libimobiledevice/libimobiledevice.h\"\n#include \"debug.h\"\n#include <time.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <config.h>\n\nstatic int debug_level;\n\nvoid debug_info_real(const char *func, const char *file, int line, const char *format, ...)\n{\n#ifndef STRIP_DEBUG_CODE\n\tva_list args;\n\tchar *buffer = NULL;\n\n\tif (!debug_level)\n\t\treturn;\n\n\t/* run the real fprintf */\n\tva_start(args, format);\n\t(void)vasprintf(&buffer, format, args);\n\tva_end(args);\n\n\tdebug_print_line(func, file, line, buffer);\n\n\tfree(buffer);\n#endif\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_get_uint_val",
          "args": [
            "min",
            "&vminor"
          ],
          "line": 188
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_get_uint_val",
          "args": [
            "maj",
            "&vmajor"
          ],
          "line": 185
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_array_get_item",
          "args": [
            "array",
            "2"
          ],
          "line": 181
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_array_get_item",
          "args": [
            "array",
            "1"
          ],
          "line": 180
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"DLMessageVersionExchange has unexpected format!\""
          ],
          "line": 176
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_array_get_size",
          "args": [
            "array"
          ],
          "line": 175
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"Did not receive DLMessageVersionExchange from device!\""
          ],
          "line": 167
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"Did not receive initial message from device!\""
          ],
          "line": 161
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"device_link_service.h\"\n#include <stdlib.h>\n#include <string.h>\n\ndevice_link_service_error_t device_link_service_version_exchange(device_link_service_client_t client, uint64_t version_major, uint64_t version_minor)\n{\n\tif (!client)\n\t\treturn DEVICE_LINK_SERVICE_E_INVALID_ARG;\n\n\tdevice_link_service_error_t err = DEVICE_LINK_SERVICE_E_UNKNOWN_ERROR;\n\n\t/* perform version exchange */\n\tplist_t array = NULL;\n\tchar *msg = NULL;\n\n\t/* receive DLMessageVersionExchange from device */\n\tif (property_list_service_receive_plist(client->parent, &array) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tdebug_info(\"Did not receive initial message from device!\");\n\t\terr = DEVICE_LINK_SERVICE_E_MUX_ERROR;\n\t\tgoto leave;\n\t}\n\tdevice_link_service_get_message(array, &msg);\n\tif (!msg || strcmp(msg, \"DLMessageVersionExchange\")) {\n\t\tdebug_info(\"Did not receive DLMessageVersionExchange from device!\");\n\t\terr = DEVICE_LINK_SERVICE_E_PLIST_ERROR;\n\t\tgoto leave;\n\t}\n\tfree(msg);\n\tmsg = NULL;\n\n\t/* get major and minor version number */\n\tif (plist_array_get_size(array) < 3) {\n\t\tdebug_info(\"DLMessageVersionExchange has unexpected format!\");\n\t\terr = DEVICE_LINK_SERVICE_E_PLIST_ERROR;\n\t\tgoto leave;\n\t}\n\tplist_t maj = plist_array_get_item(array, 1);\n\tplist_t min = plist_array_get_item(array, 2);\n\tuint64_t vmajor = 0;\n\tuint64_t vminor = 0;\n\tif (maj) {\n\t\tplist_get_uint_val(maj, &vmajor);\n\t}\n\tif (min) {\n\t\tplist_get_uint_val(min, &vminor);\n\t}\n\tif (vmajor > version_major) {\n\t\tdebug_info(\"Version mismatch: device=(%lld,%lld) > expected=(%lld,%lld)\", vmajor, vminor, version_major, version_minor);\n\t\terr = DEVICE_LINK_SERVICE_E_BAD_VERSION;\n\t\tgoto leave;\n\t} else if ((vmajor == version_major) && (vminor > version_minor)) {\n\t\tdebug_info(\"WARNING: Version mismatch: device=(%lld,%lld) > expected=(%lld,%lld)\", vmajor, vminor, version_major, version_minor);\n\t\terr = DEVICE_LINK_SERVICE_E_BAD_VERSION;\n\t\tgoto leave;\n\t}\n\tplist_free(array);\n\n\t/* version is ok, send reply */\n\tarray = plist_new_array();\n\tplist_array_append_item(array, plist_new_string(\"DLMessageVersionExchange\"));\n\tplist_array_append_item(array, plist_new_string(\"DLVersionsOk\"));\n\tplist_array_append_item(array, plist_new_uint(version_major));\n\tif (property_list_service_send_binary_plist(client->parent, array) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tdebug_info(\"Error when sending DLVersionsOk\");\n\t\terr = DEVICE_LINK_SERVICE_E_MUX_ERROR;\n\t\tgoto leave;\n\t}\n\tplist_free(array);\n\n\t/* receive DeviceReady message */\n\tarray = NULL;\n\tif (property_list_service_receive_plist(client->parent, &array) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tdebug_info(\"Error when receiving DLMessageDeviceReady!\");\n\t\terr = DEVICE_LINK_SERVICE_E_MUX_ERROR;\n\t\tgoto leave;\n\t}\n\tdevice_link_service_get_message(array, &msg);\n\tif (!msg || strcmp(msg, \"DLMessageDeviceReady\")) {\n\t\tdebug_info(\"Did not get DLMessageDeviceReady!\");\n\t\terr = DEVICE_LINK_SERVICE_E_PLIST_ERROR;\n\t\tgoto leave;\n\t}\n\terr = DEVICE_LINK_SERVICE_E_SUCCESS;\n\nleave:\n\tif (msg) {\n\t\tfree(msg);\n\t}\n\tif (array) {\n\t\tplist_free(array);\n\t}\n\treturn err;\n}"
  },
  {
    "function_name": "device_link_service_client_free",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/device_link_service.c",
    "lines": "119-129",
    "snippet": "device_link_service_error_t device_link_service_client_free(device_link_service_client_t client)\n{\n\tif (!client)\n\t\treturn DEVICE_LINK_SERVICE_E_INVALID_ARG;\n\n\tif (property_list_service_client_free(client->parent) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\treturn DEVICE_LINK_SERVICE_E_UNKNOWN_ERROR;\n\t}\n\tfree(client);\n\treturn DEVICE_LINK_SERVICE_E_SUCCESS;\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"property_list_service.h\"",
      "#include \"device_link_service.h\"",
      "#include <stdlib.h>",
      "#include <string.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "client"
          ],
          "line": 127
        },
        "resolved": true,
        "details": {
          "function_name": "device_link_service_client_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/device_link_service.c",
          "lines": "119-129",
          "snippet": "device_link_service_error_t device_link_service_client_free(device_link_service_client_t client)\n{\n\tif (!client)\n\t\treturn DEVICE_LINK_SERVICE_E_INVALID_ARG;\n\n\tif (property_list_service_client_free(client->parent) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\treturn DEVICE_LINK_SERVICE_E_UNKNOWN_ERROR;\n\t}\n\tfree(client);\n\treturn DEVICE_LINK_SERVICE_E_SUCCESS;\n}",
          "note": "cyclic_reference_detected"
        }
      },
      {
        "call_info": {
          "callee": "property_list_service_client_free",
          "args": [
            "client->parent"
          ],
          "line": 124
        },
        "resolved": true,
        "details": {
          "function_name": "property_list_service_client_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
          "lines": "77-88",
          "snippet": "LIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_client_free(property_list_service_client_t client)\n{\n\tif (!client)\n\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\n\tproperty_list_service_error_t err = service_to_property_list_service_error(service_client_free(client->parent));\n\n\tfree(client);\n\tclient = NULL;\n\n\treturn err;\n}",
          "includes": [
            "#include \"endianness.h\"",
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_client_free(property_list_service_client_t client)\n{\n\tif (!client)\n\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\n\tproperty_list_service_error_t err = service_to_property_list_service_error(service_client_free(client->parent));\n\n\tfree(client);\n\tclient = NULL;\n\n\treturn err;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"device_link_service.h\"\n#include <stdlib.h>\n#include <string.h>\n\ndevice_link_service_error_t device_link_service_client_free(device_link_service_client_t client)\n{\n\tif (!client)\n\t\treturn DEVICE_LINK_SERVICE_E_INVALID_ARG;\n\n\tif (property_list_service_client_free(client->parent) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\treturn DEVICE_LINK_SERVICE_E_UNKNOWN_ERROR;\n\t}\n\tfree(client);\n\treturn DEVICE_LINK_SERVICE_E_SUCCESS;\n}"
  },
  {
    "function_name": "device_link_service_client_new",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/device_link_service.c",
    "lines": "85-107",
    "snippet": "device_link_service_error_t device_link_service_client_new(idevice_t device, lockdownd_service_descriptor_t service, device_link_service_client_t *client)\n{\n\tif (!device || !service || service->port == 0 || !client || *client) {\n\t\treturn DEVICE_LINK_SERVICE_E_INVALID_ARG;\n\t}\n\n\tproperty_list_service_client_t plistclient = NULL;\n\tif (property_list_service_client_new(device, service, &plistclient) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\treturn DEVICE_LINK_SERVICE_E_MUX_ERROR;\n\t}\n\n\t/* create client object */\n\tdevice_link_service_client_t client_loc = (device_link_service_client_t) malloc(sizeof(struct device_link_service_client_private));\n\tclient_loc->parent = plistclient;\n\n\t/* enable SSL if requested */\n\tif (service->ssl_enabled)\n\t\tproperty_list_service_enable_ssl(client_loc->parent);\n\n\t/* all done, return success */\n\t*client = client_loc;\n\treturn DEVICE_LINK_SERVICE_E_SUCCESS;\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"property_list_service.h\"",
      "#include \"device_link_service.h\"",
      "#include <stdlib.h>",
      "#include <string.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "property_list_service_enable_ssl",
          "args": [
            "client_loc->parent"
          ],
          "line": 102
        },
        "resolved": true,
        "details": {
          "function_name": "property_list_service_enable_ssl",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
          "lines": "263-268",
          "snippet": "LIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_enable_ssl(property_list_service_client_t client)\n{\n\tif (!client || !client->parent)\n\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\treturn service_to_property_list_service_error(service_enable_ssl(client->parent));\n}",
          "includes": [
            "#include \"endianness.h\"",
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_enable_ssl(property_list_service_client_t client)\n{\n\tif (!client || !client->parent)\n\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\treturn service_to_property_list_service_error(service_enable_ssl(client->parent));\n}"
        }
      },
      {
        "call_info": {
          "callee": "malloc",
          "args": [
            "sizeof(struct device_link_service_client_private)"
          ],
          "line": 97
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "property_list_service_client_new",
          "args": [
            "device",
            "service",
            "&plistclient"
          ],
          "line": 92
        },
        "resolved": true,
        "details": {
          "function_name": "property_list_service_client_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
          "lines": "57-75",
          "snippet": "LIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_client_new(idevice_t device, lockdownd_service_descriptor_t service, property_list_service_client_t *client)\n{\n\tif (!device || !service || service->port == 0 || !client || *client)\n\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\n\tservice_client_t parent = NULL;\n\tservice_error_t rerr = service_client_new(device, service, &parent);\n\tif (rerr != SERVICE_E_SUCCESS) {\n\t\treturn service_to_property_list_service_error(rerr);\n\t}\n\n\t/* create client object */\n\tproperty_list_service_client_t client_loc = (property_list_service_client_t)malloc(sizeof(struct property_list_service_client_private));\n\tclient_loc->parent = parent;\n\n\t/* all done, return success */\n\t*client = client_loc;\n\treturn PROPERTY_LIST_SERVICE_E_SUCCESS;\n}",
          "includes": [
            "#include \"endianness.h\"",
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_client_new(idevice_t device, lockdownd_service_descriptor_t service, property_list_service_client_t *client)\n{\n\tif (!device || !service || service->port == 0 || !client || *client)\n\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\n\tservice_client_t parent = NULL;\n\tservice_error_t rerr = service_client_new(device, service, &parent);\n\tif (rerr != SERVICE_E_SUCCESS) {\n\t\treturn service_to_property_list_service_error(rerr);\n\t}\n\n\t/* create client object */\n\tproperty_list_service_client_t client_loc = (property_list_service_client_t)malloc(sizeof(struct property_list_service_client_private));\n\tclient_loc->parent = parent;\n\n\t/* all done, return success */\n\t*client = client_loc;\n\treturn PROPERTY_LIST_SERVICE_E_SUCCESS;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"device_link_service.h\"\n#include <stdlib.h>\n#include <string.h>\n\ndevice_link_service_error_t device_link_service_client_new(idevice_t device, lockdownd_service_descriptor_t service, device_link_service_client_t *client)\n{\n\tif (!device || !service || service->port == 0 || !client || *client) {\n\t\treturn DEVICE_LINK_SERVICE_E_INVALID_ARG;\n\t}\n\n\tproperty_list_service_client_t plistclient = NULL;\n\tif (property_list_service_client_new(device, service, &plistclient) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\treturn DEVICE_LINK_SERVICE_E_MUX_ERROR;\n\t}\n\n\t/* create client object */\n\tdevice_link_service_client_t client_loc = (device_link_service_client_t) malloc(sizeof(struct device_link_service_client_private));\n\tclient_loc->parent = plistclient;\n\n\t/* enable SSL if requested */\n\tif (service->ssl_enabled)\n\t\tproperty_list_service_enable_ssl(client_loc->parent);\n\n\t/* all done, return success */\n\t*client = client_loc;\n\treturn DEVICE_LINK_SERVICE_E_SUCCESS;\n}"
  },
  {
    "function_name": "device_link_service_get_message",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/device_link_service.c",
    "lines": "40-71",
    "snippet": "static int device_link_service_get_message(plist_t dl_msg, char **message)\n{\n\tplist_t cmd = NULL;\n\tchar *cmd_str = NULL;\n\n\t/* sanity check */\n\tif ((plist_get_node_type(dl_msg) != PLIST_ARRAY) || (plist_array_get_size(dl_msg) < 1)) {\n\t\treturn 0;\n\t}\n\n\t/* get dl command */\n\tcmd = plist_array_get_item(dl_msg, 0);\n\tif (!cmd || (plist_get_node_type(cmd) != PLIST_STRING)) {\n\t\treturn 0;\n\t}\n\n\tplist_get_string_val(cmd, &cmd_str);\n\tif (!cmd_str) {\n\t\treturn 0;\n\t}\n\n\tif ((strlen(cmd_str) < 9) || (strncmp(cmd_str, \"DL\", 2))) {\n\t\tfree(cmd_str);\n\t\treturn 0;\n\t}\n\n\tif (message)\n\t\t*message = cmd_str;\n\n\t/* we got a DL* message */\n\treturn 1;\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"property_list_service.h\"",
      "#include \"device_link_service.h\"",
      "#include <stdlib.h>",
      "#include <string.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "cmd_str"
          ],
          "line": 62
        },
        "resolved": true,
        "details": {
          "function_name": "device_link_service_client_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/device_link_service.c",
          "lines": "119-129",
          "snippet": "device_link_service_error_t device_link_service_client_free(device_link_service_client_t client)\n{\n\tif (!client)\n\t\treturn DEVICE_LINK_SERVICE_E_INVALID_ARG;\n\n\tif (property_list_service_client_free(client->parent) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\treturn DEVICE_LINK_SERVICE_E_UNKNOWN_ERROR;\n\t}\n\tfree(client);\n\treturn DEVICE_LINK_SERVICE_E_SUCCESS;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include \"device_link_service.h\"",
            "#include <stdlib.h>",
            "#include <string.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"device_link_service.h\"\n#include <stdlib.h>\n#include <string.h>\n\ndevice_link_service_error_t device_link_service_client_free(device_link_service_client_t client)\n{\n\tif (!client)\n\t\treturn DEVICE_LINK_SERVICE_E_INVALID_ARG;\n\n\tif (property_list_service_client_free(client->parent) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\treturn DEVICE_LINK_SERVICE_E_UNKNOWN_ERROR;\n\t}\n\tfree(client);\n\treturn DEVICE_LINK_SERVICE_E_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strncmp",
          "args": [
            "cmd_str",
            "\"DL\"",
            "2"
          ],
          "line": 61
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "cmd_str"
          ],
          "line": 61
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_get_string_val",
          "args": [
            "cmd",
            "&cmd_str"
          ],
          "line": 56
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_get_node_type",
          "args": [
            "cmd"
          ],
          "line": 52
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_array_get_item",
          "args": [
            "dl_msg",
            "0"
          ],
          "line": 51
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_array_get_size",
          "args": [
            "dl_msg"
          ],
          "line": 46
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_get_node_type",
          "args": [
            "dl_msg"
          ],
          "line": 46
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"device_link_service.h\"\n#include <stdlib.h>\n#include <string.h>\n\nstatic int device_link_service_get_message(plist_t dl_msg, char **message)\n{\n\tplist_t cmd = NULL;\n\tchar *cmd_str = NULL;\n\n\t/* sanity check */\n\tif ((plist_get_node_type(dl_msg) != PLIST_ARRAY) || (plist_array_get_size(dl_msg) < 1)) {\n\t\treturn 0;\n\t}\n\n\t/* get dl command */\n\tcmd = plist_array_get_item(dl_msg, 0);\n\tif (!cmd || (plist_get_node_type(cmd) != PLIST_STRING)) {\n\t\treturn 0;\n\t}\n\n\tplist_get_string_val(cmd, &cmd_str);\n\tif (!cmd_str) {\n\t\treturn 0;\n\t}\n\n\tif ((strlen(cmd_str) < 9) || (strncmp(cmd_str, \"DL\", 2))) {\n\t\tfree(cmd_str);\n\t\treturn 0;\n\t}\n\n\tif (message)\n\t\t*message = cmd_str;\n\n\t/* we got a DL* message */\n\treturn 1;\n}"
  }
]