[
  {
    "function_name": "mobilebackup_send_error",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/mobilebackup.c",
    "lines": "409-424",
    "snippet": "LIBIMOBILEDEVICE_API mobilebackup_error_t mobilebackup_send_error(mobilebackup_client_t client, const char *reason)\n{\n\tif (!client || !client->parent || !reason)\n\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\n\tmobilebackup_error_t err;\n\n\t/* construct error plist */\n\tplist_t dict = plist_new_dict();\n\tplist_dict_set_item(dict, \"BackupErrorReasonKey\", plist_new_string(reason));\n\n\terr = mobilebackup_send_message(client, \"BackupMessageError\", dict);\n\tplist_free(dict);\n\n\treturn err;\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"device_link_service.h\"",
      "#include \"mobilebackup.h\"",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <plist/plist.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "dict"
          ],
          "line": 421
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mobilebackup_send_message",
          "args": [
            "client",
            "\"BackupMessageError\"",
            "dict"
          ],
          "line": 420
        },
        "resolved": true,
        "details": {
          "function_name": "mobilebackup_send_message",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/mobilebackup.c",
          "lines": "137-167",
          "snippet": "static mobilebackup_error_t mobilebackup_send_message(mobilebackup_client_t client, const char *message, plist_t options)\n{\n\tif (!client || !client->parent || (!message && !options))\n\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\n\tif (options && (plist_get_node_type(options) != PLIST_DICT)) {\n\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\t}\n\n\tmobilebackup_error_t err;\n\n\tif (message) {\n\t\tplist_t dict = NULL;\n\t\tif (options) {\n\t\t\tdict = plist_copy(options);\n\t\t} else {\n\t\t\tdict = plist_new_dict();\n\t\t}\n\t\tplist_dict_set_item(dict, \"BackupMessageTypeKey\", plist_new_string(message));\n\n\t\t/* send it as DLMessageProcessMessage */\n\t\terr = mobilebackup_error(device_link_service_send_process_message(client->parent, dict));\n\t\tplist_free(dict);\n\t} else {\n\t\terr = mobilebackup_error(device_link_service_send_process_message(client->parent, options));\n\t}\n\tif (err != MOBILEBACKUP_E_SUCCESS) {\n\t\tdebug_info(\"ERROR: Could not send message '%s' (%d)!\", message, err);\n\t}\n\treturn err;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"device_link_service.h\"",
            "#include \"mobilebackup.h\"",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <plist/plist.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"device_link_service.h\"\n#include \"mobilebackup.h\"\n#include <stdlib.h>\n#include <string.h>\n#include <plist/plist.h>\n\nstatic mobilebackup_error_t mobilebackup_send_message(mobilebackup_client_t client, const char *message, plist_t options)\n{\n\tif (!client || !client->parent || (!message && !options))\n\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\n\tif (options && (plist_get_node_type(options) != PLIST_DICT)) {\n\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\t}\n\n\tmobilebackup_error_t err;\n\n\tif (message) {\n\t\tplist_t dict = NULL;\n\t\tif (options) {\n\t\t\tdict = plist_copy(options);\n\t\t} else {\n\t\t\tdict = plist_new_dict();\n\t\t}\n\t\tplist_dict_set_item(dict, \"BackupMessageTypeKey\", plist_new_string(message));\n\n\t\t/* send it as DLMessageProcessMessage */\n\t\terr = mobilebackup_error(device_link_service_send_process_message(client->parent, dict));\n\t\tplist_free(dict);\n\t} else {\n\t\terr = mobilebackup_error(device_link_service_send_process_message(client->parent, options));\n\t}\n\tif (err != MOBILEBACKUP_E_SUCCESS) {\n\t\tdebug_info(\"ERROR: Could not send message '%s' (%d)!\", message, err);\n\t}\n\treturn err;\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"BackupErrorReasonKey\"",
            "plist_new_string(reason)"
          ],
          "line": 418
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "reason"
          ],
          "line": 418
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_dict",
          "args": [],
          "line": 417
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"device_link_service.h\"\n#include \"mobilebackup.h\"\n#include <stdlib.h>\n#include <string.h>\n#include <plist/plist.h>\n\nLIBIMOBILEDEVICE_API mobilebackup_error_t mobilebackup_send_error(mobilebackup_client_t client, const char *reason)\n{\n\tif (!client || !client->parent || !reason)\n\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\n\tmobilebackup_error_t err;\n\n\t/* construct error plist */\n\tplist_t dict = plist_new_dict();\n\tplist_dict_set_item(dict, \"BackupErrorReasonKey\", plist_new_string(reason));\n\n\terr = mobilebackup_send_message(client, \"BackupMessageError\", dict);\n\tplist_free(dict);\n\n\treturn err;\n}"
  },
  {
    "function_name": "mobilebackup_send_restore_complete",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/mobilebackup.c",
    "lines": "364-407",
    "snippet": "LIBIMOBILEDEVICE_API mobilebackup_error_t mobilebackup_send_restore_complete(mobilebackup_client_t client)\n{\n\tmobilebackup_error_t err = mobilebackup_send_message(client, \"BackupMessageRestoreComplete\", NULL);\n\tif (err != MOBILEBACKUP_E_SUCCESS) {\n\t\treturn err;\n\t}\n\tplist_t dlmsg = NULL;\n\terr = mobilebackup_receive(client, &dlmsg);\n\tif ((err != MOBILEBACKUP_E_SUCCESS) || !dlmsg || (plist_get_node_type(dlmsg) != PLIST_ARRAY) || (plist_array_get_size(dlmsg) != 2)) {\n\t\tif (dlmsg) {\n\t\t\tdebug_info(\"ERROR: Did not receive DLMessageDisconnect:\");\n\t\t\tdebug_plist(dlmsg);\n\t\t\tplist_free(dlmsg);\n\t\t}\n\t\tif (err == MOBILEBACKUP_E_SUCCESS) {\n\t\t\terr = MOBILEBACKUP_E_PLIST_ERROR;\n\t\t}\n\t\treturn err;\n\t}\n\tplist_t node = plist_array_get_item (dlmsg, 0);\n\tchar *msg = NULL;\n\tif (node && (plist_get_node_type(node) == PLIST_STRING)) {\n\t\tplist_get_string_val(node, &msg);\n\t}\n\n\tif (msg && !strcmp(msg, \"DLMessageDisconnect\")) {\n\t\terr = MOBILEBACKUP_E_SUCCESS;\n\t\t/* we need to do this here, otherwise mobilebackup_client_free\n\t\t   will fail */\n\t\tdevice_link_service_client_free(client->parent);\n\t\tclient->parent = NULL;\n\t} else {\n\t\tdebug_info(\"ERROR: Malformed plist received:\");\n\t\tdebug_plist(dlmsg);\n\t\terr = MOBILEBACKUP_E_PLIST_ERROR;\n\t}\n\n\tplist_free(dlmsg);\n\n\tif (msg)\n\t\tfree(msg);\n\n\treturn err;\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"device_link_service.h\"",
      "#include \"mobilebackup.h\"",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <plist/plist.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "msg"
          ],
          "line": 404
        },
        "resolved": true,
        "details": {
          "function_name": "mobilebackup_client_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/mobilebackup.c",
          "lines": "97-108",
          "snippet": "LIBIMOBILEDEVICE_API mobilebackup_error_t mobilebackup_client_free(mobilebackup_client_t client)\n{\n\tif (!client)\n\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\tmobilebackup_error_t err = MOBILEBACKUP_E_SUCCESS;\n\tif (client->parent) {\n\t\tdevice_link_service_disconnect(client->parent, NULL);\n\t\terr = mobilebackup_error(device_link_service_client_free(client->parent));\n\t}\n\tfree(client);\n\treturn err;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"device_link_service.h\"",
            "#include \"mobilebackup.h\"",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <plist/plist.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"device_link_service.h\"\n#include \"mobilebackup.h\"\n#include <stdlib.h>\n#include <string.h>\n#include <plist/plist.h>\n\nLIBIMOBILEDEVICE_API mobilebackup_error_t mobilebackup_client_free(mobilebackup_client_t client)\n{\n\tif (!client)\n\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\tmobilebackup_error_t err = MOBILEBACKUP_E_SUCCESS;\n\tif (client->parent) {\n\t\tdevice_link_service_disconnect(client->parent, NULL);\n\t\terr = mobilebackup_error(device_link_service_client_free(client->parent));\n\t}\n\tfree(client);\n\treturn err;\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "dlmsg"
          ],
          "line": 401
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_plist",
          "args": [
            "dlmsg"
          ],
          "line": 397
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"ERROR: Malformed plist received:\""
          ],
          "line": 396
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device_link_service_client_free",
          "args": [
            "client->parent"
          ],
          "line": 393
        },
        "resolved": true,
        "details": {
          "function_name": "device_link_service_client_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/device_link_service.c",
          "lines": "119-129",
          "snippet": "device_link_service_error_t device_link_service_client_free(device_link_service_client_t client)\n{\n\tif (!client)\n\t\treturn DEVICE_LINK_SERVICE_E_INVALID_ARG;\n\n\tif (property_list_service_client_free(client->parent) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\treturn DEVICE_LINK_SERVICE_E_UNKNOWN_ERROR;\n\t}\n\tfree(client);\n\treturn DEVICE_LINK_SERVICE_E_SUCCESS;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include \"device_link_service.h\"",
            "#include <stdlib.h>",
            "#include <string.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"device_link_service.h\"\n#include <stdlib.h>\n#include <string.h>\n\ndevice_link_service_error_t device_link_service_client_free(device_link_service_client_t client)\n{\n\tif (!client)\n\t\treturn DEVICE_LINK_SERVICE_E_INVALID_ARG;\n\n\tif (property_list_service_client_free(client->parent) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\treturn DEVICE_LINK_SERVICE_E_UNKNOWN_ERROR;\n\t}\n\tfree(client);\n\treturn DEVICE_LINK_SERVICE_E_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "msg",
            "\"DLMessageDisconnect\""
          ],
          "line": 389
        },
        "resolved": true,
        "details": {
          "function_name": "plist_strcmp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/tools/idevicebackup.c",
          "lines": "296-309",
          "snippet": "static int plist_strcmp(plist_t node, const char *str)\n{\n\tchar *buffer = NULL;\n\tint ret = 0;\n\n\tif (plist_get_node_type(node) != PLIST_STRING)\n\t\treturn ret;\n\n\tplist_get_string_val(node, &buffer);\n\tret = strcmp(buffer, str);\n\tfree(buffer);\n\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"common/utils.h\"",
            "#include <libimobiledevice/afc.h>",
            "#include <libimobiledevice/notification_proxy.h>",
            "#include <libimobiledevice/mobilebackup.h>",
            "#include <libimobiledevice/lockdown.h>",
            "#include <libimobiledevice/libimobiledevice.h>",
            "#include <time.h>",
            "#include <ctype.h>",
            "#include <unistd.h>",
            "#include <gcrypt.h>",
            "#include <openssl/sha.h>",
            "#include <signal.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"common/utils.h\"\n#include <libimobiledevice/afc.h>\n#include <libimobiledevice/notification_proxy.h>\n#include <libimobiledevice/mobilebackup.h>\n#include <libimobiledevice/lockdown.h>\n#include <libimobiledevice/libimobiledevice.h>\n#include <time.h>\n#include <ctype.h>\n#include <unistd.h>\n#include <gcrypt.h>\n#include <openssl/sha.h>\n#include <signal.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int plist_strcmp(plist_t node, const char *str)\n{\n\tchar *buffer = NULL;\n\tint ret = 0;\n\n\tif (plist_get_node_type(node) != PLIST_STRING)\n\t\treturn ret;\n\n\tplist_get_string_val(node, &buffer);\n\tret = strcmp(buffer, str);\n\tfree(buffer);\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_get_string_val",
          "args": [
            "node",
            "&msg"
          ],
          "line": 386
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_get_node_type",
          "args": [
            "node"
          ],
          "line": 385
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_array_get_item",
          "args": [
            "dlmsg",
            "0"
          ],
          "line": 383
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "dlmsg"
          ],
          "line": 376
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_plist",
          "args": [
            "dlmsg"
          ],
          "line": 375
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"ERROR: Did not receive DLMessageDisconnect:\""
          ],
          "line": 374
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_array_get_size",
          "args": [
            "dlmsg"
          ],
          "line": 372
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_get_node_type",
          "args": [
            "dlmsg"
          ],
          "line": 372
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mobilebackup_receive",
          "args": [
            "client",
            "&dlmsg"
          ],
          "line": 371
        },
        "resolved": true,
        "details": {
          "function_name": "mobilebackup_receive_restore_application_received",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/mobilebackup.c",
          "lines": "359-362",
          "snippet": "LIBIMOBILEDEVICE_API mobilebackup_error_t mobilebackup_receive_restore_application_received(mobilebackup_client_t client, plist_t *result)\n{\n\treturn mobilebackup_receive_message(client, \"BackupMessageRestoreApplicationReceived\", result);\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"device_link_service.h\"",
            "#include \"mobilebackup.h\"",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <plist/plist.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"device_link_service.h\"\n#include \"mobilebackup.h\"\n#include <stdlib.h>\n#include <string.h>\n#include <plist/plist.h>\n\nLIBIMOBILEDEVICE_API mobilebackup_error_t mobilebackup_receive_restore_application_received(mobilebackup_client_t client, plist_t *result)\n{\n\treturn mobilebackup_receive_message(client, \"BackupMessageRestoreApplicationReceived\", result);\n}"
        }
      },
      {
        "call_info": {
          "callee": "mobilebackup_send_message",
          "args": [
            "client",
            "\"BackupMessageRestoreComplete\"",
            "NULL"
          ],
          "line": 366
        },
        "resolved": true,
        "details": {
          "function_name": "mobilebackup_send_message",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/mobilebackup.c",
          "lines": "137-167",
          "snippet": "static mobilebackup_error_t mobilebackup_send_message(mobilebackup_client_t client, const char *message, plist_t options)\n{\n\tif (!client || !client->parent || (!message && !options))\n\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\n\tif (options && (plist_get_node_type(options) != PLIST_DICT)) {\n\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\t}\n\n\tmobilebackup_error_t err;\n\n\tif (message) {\n\t\tplist_t dict = NULL;\n\t\tif (options) {\n\t\t\tdict = plist_copy(options);\n\t\t} else {\n\t\t\tdict = plist_new_dict();\n\t\t}\n\t\tplist_dict_set_item(dict, \"BackupMessageTypeKey\", plist_new_string(message));\n\n\t\t/* send it as DLMessageProcessMessage */\n\t\terr = mobilebackup_error(device_link_service_send_process_message(client->parent, dict));\n\t\tplist_free(dict);\n\t} else {\n\t\terr = mobilebackup_error(device_link_service_send_process_message(client->parent, options));\n\t}\n\tif (err != MOBILEBACKUP_E_SUCCESS) {\n\t\tdebug_info(\"ERROR: Could not send message '%s' (%d)!\", message, err);\n\t}\n\treturn err;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"device_link_service.h\"",
            "#include \"mobilebackup.h\"",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <plist/plist.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"device_link_service.h\"\n#include \"mobilebackup.h\"\n#include <stdlib.h>\n#include <string.h>\n#include <plist/plist.h>\n\nstatic mobilebackup_error_t mobilebackup_send_message(mobilebackup_client_t client, const char *message, plist_t options)\n{\n\tif (!client || !client->parent || (!message && !options))\n\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\n\tif (options && (plist_get_node_type(options) != PLIST_DICT)) {\n\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\t}\n\n\tmobilebackup_error_t err;\n\n\tif (message) {\n\t\tplist_t dict = NULL;\n\t\tif (options) {\n\t\t\tdict = plist_copy(options);\n\t\t} else {\n\t\t\tdict = plist_new_dict();\n\t\t}\n\t\tplist_dict_set_item(dict, \"BackupMessageTypeKey\", plist_new_string(message));\n\n\t\t/* send it as DLMessageProcessMessage */\n\t\terr = mobilebackup_error(device_link_service_send_process_message(client->parent, dict));\n\t\tplist_free(dict);\n\t} else {\n\t\terr = mobilebackup_error(device_link_service_send_process_message(client->parent, options));\n\t}\n\tif (err != MOBILEBACKUP_E_SUCCESS) {\n\t\tdebug_info(\"ERROR: Could not send message '%s' (%d)!\", message, err);\n\t}\n\treturn err;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"device_link_service.h\"\n#include \"mobilebackup.h\"\n#include <stdlib.h>\n#include <string.h>\n#include <plist/plist.h>\n\nLIBIMOBILEDEVICE_API mobilebackup_error_t mobilebackup_send_restore_complete(mobilebackup_client_t client)\n{\n\tmobilebackup_error_t err = mobilebackup_send_message(client, \"BackupMessageRestoreComplete\", NULL);\n\tif (err != MOBILEBACKUP_E_SUCCESS) {\n\t\treturn err;\n\t}\n\tplist_t dlmsg = NULL;\n\terr = mobilebackup_receive(client, &dlmsg);\n\tif ((err != MOBILEBACKUP_E_SUCCESS) || !dlmsg || (plist_get_node_type(dlmsg) != PLIST_ARRAY) || (plist_array_get_size(dlmsg) != 2)) {\n\t\tif (dlmsg) {\n\t\t\tdebug_info(\"ERROR: Did not receive DLMessageDisconnect:\");\n\t\t\tdebug_plist(dlmsg);\n\t\t\tplist_free(dlmsg);\n\t\t}\n\t\tif (err == MOBILEBACKUP_E_SUCCESS) {\n\t\t\terr = MOBILEBACKUP_E_PLIST_ERROR;\n\t\t}\n\t\treturn err;\n\t}\n\tplist_t node = plist_array_get_item (dlmsg, 0);\n\tchar *msg = NULL;\n\tif (node && (plist_get_node_type(node) == PLIST_STRING)) {\n\t\tplist_get_string_val(node, &msg);\n\t}\n\n\tif (msg && !strcmp(msg, \"DLMessageDisconnect\")) {\n\t\terr = MOBILEBACKUP_E_SUCCESS;\n\t\t/* we need to do this here, otherwise mobilebackup_client_free\n\t\t   will fail */\n\t\tdevice_link_service_client_free(client->parent);\n\t\tclient->parent = NULL;\n\t} else {\n\t\tdebug_info(\"ERROR: Malformed plist received:\");\n\t\tdebug_plist(dlmsg);\n\t\terr = MOBILEBACKUP_E_PLIST_ERROR;\n\t}\n\n\tplist_free(dlmsg);\n\n\tif (msg)\n\t\tfree(msg);\n\n\treturn err;\n}"
  },
  {
    "function_name": "mobilebackup_receive_restore_application_received",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/mobilebackup.c",
    "lines": "359-362",
    "snippet": "LIBIMOBILEDEVICE_API mobilebackup_error_t mobilebackup_receive_restore_application_received(mobilebackup_client_t client, plist_t *result)\n{\n\treturn mobilebackup_receive_message(client, \"BackupMessageRestoreApplicationReceived\", result);\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"device_link_service.h\"",
      "#include \"mobilebackup.h\"",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <plist/plist.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "mobilebackup_receive_message",
          "args": [
            "client",
            "\"BackupMessageRestoreApplicationReceived\"",
            "result"
          ],
          "line": 361
        },
        "resolved": true,
        "details": {
          "function_name": "mobilebackup_receive_message",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/mobilebackup.c",
          "lines": "188-233",
          "snippet": "static mobilebackup_error_t mobilebackup_receive_message(mobilebackup_client_t client, const char *message, plist_t *result)\n{\n\tif (!client || !client->parent || !message)\n\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\n\tif (result)\n\t\t*result = NULL;\n\tmobilebackup_error_t err;\n\n\tplist_t dict = NULL;\n\n\t/* receive DLMessageProcessMessage */\n\terr = mobilebackup_error(device_link_service_receive_process_message(client->parent, &dict));\n\tif (err != MOBILEBACKUP_E_SUCCESS) {\n\t\tgoto leave;\n\t}\n\n\tplist_t node = plist_dict_get_item(dict, \"BackupMessageTypeKey\");\n\tif (!node) {\n\t\tdebug_info(\"ERROR: BackupMessageTypeKey not found in plist!\");\n\t\terr = MOBILEBACKUP_E_PLIST_ERROR;\n\t\tgoto leave;\n\t}\n\n\tchar *str = NULL;\n\tplist_get_string_val(node, &str);\n\tif (str && (strcmp(str, message) == 0)) {\n\t\terr = MOBILEBACKUP_E_SUCCESS;\n\t} else {\n\t\tdebug_info(\"ERROR: BackupMessageTypeKey value does not match '%s'!\", message);\n\t\terr = MOBILEBACKUP_E_REPLY_NOT_OK;\n\t}\n\tif (str)\n\t\tfree(str);\n\n\tif (result) {\n\t\t*result = dict;\n\t\tdict = NULL;\n\t}\nleave:\n\tif (dict) {\n\t\tplist_free(dict);\n\t}\n\n\treturn err;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"device_link_service.h\"",
            "#include \"mobilebackup.h\"",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <plist/plist.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"device_link_service.h\"\n#include \"mobilebackup.h\"\n#include <stdlib.h>\n#include <string.h>\n#include <plist/plist.h>\n\nstatic mobilebackup_error_t mobilebackup_receive_message(mobilebackup_client_t client, const char *message, plist_t *result)\n{\n\tif (!client || !client->parent || !message)\n\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\n\tif (result)\n\t\t*result = NULL;\n\tmobilebackup_error_t err;\n\n\tplist_t dict = NULL;\n\n\t/* receive DLMessageProcessMessage */\n\terr = mobilebackup_error(device_link_service_receive_process_message(client->parent, &dict));\n\tif (err != MOBILEBACKUP_E_SUCCESS) {\n\t\tgoto leave;\n\t}\n\n\tplist_t node = plist_dict_get_item(dict, \"BackupMessageTypeKey\");\n\tif (!node) {\n\t\tdebug_info(\"ERROR: BackupMessageTypeKey not found in plist!\");\n\t\terr = MOBILEBACKUP_E_PLIST_ERROR;\n\t\tgoto leave;\n\t}\n\n\tchar *str = NULL;\n\tplist_get_string_val(node, &str);\n\tif (str && (strcmp(str, message) == 0)) {\n\t\terr = MOBILEBACKUP_E_SUCCESS;\n\t} else {\n\t\tdebug_info(\"ERROR: BackupMessageTypeKey value does not match '%s'!\", message);\n\t\terr = MOBILEBACKUP_E_REPLY_NOT_OK;\n\t}\n\tif (str)\n\t\tfree(str);\n\n\tif (result) {\n\t\t*result = dict;\n\t\tdict = NULL;\n\t}\nleave:\n\tif (dict) {\n\t\tplist_free(dict);\n\t}\n\n\treturn err;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"device_link_service.h\"\n#include \"mobilebackup.h\"\n#include <stdlib.h>\n#include <string.h>\n#include <plist/plist.h>\n\nLIBIMOBILEDEVICE_API mobilebackup_error_t mobilebackup_receive_restore_application_received(mobilebackup_client_t client, plist_t *result)\n{\n\treturn mobilebackup_receive_message(client, \"BackupMessageRestoreApplicationReceived\", result);\n}"
  },
  {
    "function_name": "mobilebackup_receive_restore_file_received",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/mobilebackup.c",
    "lines": "354-357",
    "snippet": "LIBIMOBILEDEVICE_API mobilebackup_error_t mobilebackup_receive_restore_file_received(mobilebackup_client_t client, plist_t *result)\n{\n\treturn mobilebackup_receive_message(client, \"BackupMessageRestoreFileReceived\", result);\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"device_link_service.h\"",
      "#include \"mobilebackup.h\"",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <plist/plist.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "mobilebackup_receive_message",
          "args": [
            "client",
            "\"BackupMessageRestoreFileReceived\"",
            "result"
          ],
          "line": 356
        },
        "resolved": true,
        "details": {
          "function_name": "mobilebackup_receive_message",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/mobilebackup.c",
          "lines": "188-233",
          "snippet": "static mobilebackup_error_t mobilebackup_receive_message(mobilebackup_client_t client, const char *message, plist_t *result)\n{\n\tif (!client || !client->parent || !message)\n\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\n\tif (result)\n\t\t*result = NULL;\n\tmobilebackup_error_t err;\n\n\tplist_t dict = NULL;\n\n\t/* receive DLMessageProcessMessage */\n\terr = mobilebackup_error(device_link_service_receive_process_message(client->parent, &dict));\n\tif (err != MOBILEBACKUP_E_SUCCESS) {\n\t\tgoto leave;\n\t}\n\n\tplist_t node = plist_dict_get_item(dict, \"BackupMessageTypeKey\");\n\tif (!node) {\n\t\tdebug_info(\"ERROR: BackupMessageTypeKey not found in plist!\");\n\t\terr = MOBILEBACKUP_E_PLIST_ERROR;\n\t\tgoto leave;\n\t}\n\n\tchar *str = NULL;\n\tplist_get_string_val(node, &str);\n\tif (str && (strcmp(str, message) == 0)) {\n\t\terr = MOBILEBACKUP_E_SUCCESS;\n\t} else {\n\t\tdebug_info(\"ERROR: BackupMessageTypeKey value does not match '%s'!\", message);\n\t\terr = MOBILEBACKUP_E_REPLY_NOT_OK;\n\t}\n\tif (str)\n\t\tfree(str);\n\n\tif (result) {\n\t\t*result = dict;\n\t\tdict = NULL;\n\t}\nleave:\n\tif (dict) {\n\t\tplist_free(dict);\n\t}\n\n\treturn err;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"device_link_service.h\"",
            "#include \"mobilebackup.h\"",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <plist/plist.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"device_link_service.h\"\n#include \"mobilebackup.h\"\n#include <stdlib.h>\n#include <string.h>\n#include <plist/plist.h>\n\nstatic mobilebackup_error_t mobilebackup_receive_message(mobilebackup_client_t client, const char *message, plist_t *result)\n{\n\tif (!client || !client->parent || !message)\n\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\n\tif (result)\n\t\t*result = NULL;\n\tmobilebackup_error_t err;\n\n\tplist_t dict = NULL;\n\n\t/* receive DLMessageProcessMessage */\n\terr = mobilebackup_error(device_link_service_receive_process_message(client->parent, &dict));\n\tif (err != MOBILEBACKUP_E_SUCCESS) {\n\t\tgoto leave;\n\t}\n\n\tplist_t node = plist_dict_get_item(dict, \"BackupMessageTypeKey\");\n\tif (!node) {\n\t\tdebug_info(\"ERROR: BackupMessageTypeKey not found in plist!\");\n\t\terr = MOBILEBACKUP_E_PLIST_ERROR;\n\t\tgoto leave;\n\t}\n\n\tchar *str = NULL;\n\tplist_get_string_val(node, &str);\n\tif (str && (strcmp(str, message) == 0)) {\n\t\terr = MOBILEBACKUP_E_SUCCESS;\n\t} else {\n\t\tdebug_info(\"ERROR: BackupMessageTypeKey value does not match '%s'!\", message);\n\t\terr = MOBILEBACKUP_E_REPLY_NOT_OK;\n\t}\n\tif (str)\n\t\tfree(str);\n\n\tif (result) {\n\t\t*result = dict;\n\t\tdict = NULL;\n\t}\nleave:\n\tif (dict) {\n\t\tplist_free(dict);\n\t}\n\n\treturn err;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"device_link_service.h\"\n#include \"mobilebackup.h\"\n#include <stdlib.h>\n#include <string.h>\n#include <plist/plist.h>\n\nLIBIMOBILEDEVICE_API mobilebackup_error_t mobilebackup_receive_restore_file_received(mobilebackup_client_t client, plist_t *result)\n{\n\treturn mobilebackup_receive_message(client, \"BackupMessageRestoreFileReceived\", result);\n}"
  },
  {
    "function_name": "mobilebackup_request_restore",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/mobilebackup.c",
    "lines": "300-352",
    "snippet": "LIBIMOBILEDEVICE_API mobilebackup_error_t mobilebackup_request_restore(mobilebackup_client_t client, plist_t backup_manifest, mobilebackup_flags_t flags, const char *proto_version)\n{\n\tif (!client || !client->parent || !backup_manifest || !proto_version)\n\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\n\tif (backup_manifest && (plist_get_node_type(backup_manifest) != PLIST_DICT))\n\t\treturn MOBILEBACKUP_E_PLIST_ERROR;\n\n\tmobilebackup_error_t err;\n\n\t/* construct request plist */\n\tplist_t dict = plist_new_dict();\n\tplist_dict_set_item(dict, \"BackupManifestKey\", plist_copy(backup_manifest));\n\tplist_dict_set_item(dict, \"BackupMessageTypeKey\", plist_new_string(\"kBackupMessageRestoreRequest\"));\n\tplist_dict_set_item(dict, \"BackupProtocolVersion\", plist_new_string(proto_version));\n\t/* add flags */\n\tplist_dict_set_item(dict, \"BackupNotifySpringBoard\", plist_new_bool(IS_FLAG_SET(flags, MB_RESTORE_NOTIFY_SPRINGBOARD)));\n\tplist_dict_set_item(dict, \"BackupPreserveSettings\", plist_new_bool(IS_FLAG_SET(flags, MB_RESTORE_PRESERVE_SETTINGS)));\n\tplist_dict_set_item(dict, \"BackupPreserveCameraRoll\", plist_new_bool(IS_FLAG_SET(flags, MB_RESTORE_PRESERVE_CAMERA_ROLL)));\n\n\t/* send request */\n\terr = mobilebackup_send_message(client, NULL, dict);\n\tplist_free(dict);\n\tdict = NULL;\n\tif (err != MOBILEBACKUP_E_SUCCESS) {\n\t\tdebug_info(\"ERROR: Could not send restore request message (%d)!\", err);\n\t\tgoto leave;\n\t}\n\n\t/* now receive and hopefully get a BackupMessageRestoreReplyOK */\n\terr = mobilebackup_receive_message(client, \"BackupMessageRestoreReplyOK\", &dict);\n\tif (err != MOBILEBACKUP_E_SUCCESS) {\n\t\tdebug_info(\"ERROR: Could not receive RestoreReplyOK message (%d)!\", err);\n\t\tgoto leave;\n\t}\n\n\tplist_t node = plist_dict_get_item(dict, \"BackupProtocolVersion\");\n\tif (node) {\n\t\tchar *str = NULL;\n\t\tplist_get_string_val(node, &str);\n\t\tif (str) {\n\t\t\tif (strcmp(str, proto_version) != 0) {\n\t\t\t\terr = MOBILEBACKUP_E_BAD_VERSION;\n\t\t\t}\n\t\t\tfree(str);\n\t\t}\n\t}\n\nleave:\n\tif (dict)\n\t\tplist_free(dict);\n\treturn err;\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"device_link_service.h\"",
      "#include \"mobilebackup.h\"",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <plist/plist.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "dict"
          ],
          "line": 350
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "str"
          ],
          "line": 344
        },
        "resolved": true,
        "details": {
          "function_name": "mobilebackup_client_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/mobilebackup.c",
          "lines": "97-108",
          "snippet": "LIBIMOBILEDEVICE_API mobilebackup_error_t mobilebackup_client_free(mobilebackup_client_t client)\n{\n\tif (!client)\n\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\tmobilebackup_error_t err = MOBILEBACKUP_E_SUCCESS;\n\tif (client->parent) {\n\t\tdevice_link_service_disconnect(client->parent, NULL);\n\t\terr = mobilebackup_error(device_link_service_client_free(client->parent));\n\t}\n\tfree(client);\n\treturn err;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"device_link_service.h\"",
            "#include \"mobilebackup.h\"",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <plist/plist.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"device_link_service.h\"\n#include \"mobilebackup.h\"\n#include <stdlib.h>\n#include <string.h>\n#include <plist/plist.h>\n\nLIBIMOBILEDEVICE_API mobilebackup_error_t mobilebackup_client_free(mobilebackup_client_t client)\n{\n\tif (!client)\n\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\tmobilebackup_error_t err = MOBILEBACKUP_E_SUCCESS;\n\tif (client->parent) {\n\t\tdevice_link_service_disconnect(client->parent, NULL);\n\t\terr = mobilebackup_error(device_link_service_client_free(client->parent));\n\t}\n\tfree(client);\n\treturn err;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "str",
            "proto_version"
          ],
          "line": 341
        },
        "resolved": true,
        "details": {
          "function_name": "plist_strcmp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/tools/idevicebackup.c",
          "lines": "296-309",
          "snippet": "static int plist_strcmp(plist_t node, const char *str)\n{\n\tchar *buffer = NULL;\n\tint ret = 0;\n\n\tif (plist_get_node_type(node) != PLIST_STRING)\n\t\treturn ret;\n\n\tplist_get_string_val(node, &buffer);\n\tret = strcmp(buffer, str);\n\tfree(buffer);\n\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"common/utils.h\"",
            "#include <libimobiledevice/afc.h>",
            "#include <libimobiledevice/notification_proxy.h>",
            "#include <libimobiledevice/mobilebackup.h>",
            "#include <libimobiledevice/lockdown.h>",
            "#include <libimobiledevice/libimobiledevice.h>",
            "#include <time.h>",
            "#include <ctype.h>",
            "#include <unistd.h>",
            "#include <gcrypt.h>",
            "#include <openssl/sha.h>",
            "#include <signal.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"common/utils.h\"\n#include <libimobiledevice/afc.h>\n#include <libimobiledevice/notification_proxy.h>\n#include <libimobiledevice/mobilebackup.h>\n#include <libimobiledevice/lockdown.h>\n#include <libimobiledevice/libimobiledevice.h>\n#include <time.h>\n#include <ctype.h>\n#include <unistd.h>\n#include <gcrypt.h>\n#include <openssl/sha.h>\n#include <signal.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int plist_strcmp(plist_t node, const char *str)\n{\n\tchar *buffer = NULL;\n\tint ret = 0;\n\n\tif (plist_get_node_type(node) != PLIST_STRING)\n\t\treturn ret;\n\n\tplist_get_string_val(node, &buffer);\n\tret = strcmp(buffer, str);\n\tfree(buffer);\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_get_string_val",
          "args": [
            "node",
            "&str"
          ],
          "line": 339
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_get_item",
          "args": [
            "dict",
            "\"BackupProtocolVersion\""
          ],
          "line": 336
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"ERROR: Could not receive RestoreReplyOK message (%d)!\"",
            "err"
          ],
          "line": 332
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mobilebackup_receive_message",
          "args": [
            "client",
            "\"BackupMessageRestoreReplyOK\"",
            "&dict"
          ],
          "line": 330
        },
        "resolved": true,
        "details": {
          "function_name": "mobilebackup_receive_message",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/mobilebackup.c",
          "lines": "188-233",
          "snippet": "static mobilebackup_error_t mobilebackup_receive_message(mobilebackup_client_t client, const char *message, plist_t *result)\n{\n\tif (!client || !client->parent || !message)\n\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\n\tif (result)\n\t\t*result = NULL;\n\tmobilebackup_error_t err;\n\n\tplist_t dict = NULL;\n\n\t/* receive DLMessageProcessMessage */\n\terr = mobilebackup_error(device_link_service_receive_process_message(client->parent, &dict));\n\tif (err != MOBILEBACKUP_E_SUCCESS) {\n\t\tgoto leave;\n\t}\n\n\tplist_t node = plist_dict_get_item(dict, \"BackupMessageTypeKey\");\n\tif (!node) {\n\t\tdebug_info(\"ERROR: BackupMessageTypeKey not found in plist!\");\n\t\terr = MOBILEBACKUP_E_PLIST_ERROR;\n\t\tgoto leave;\n\t}\n\n\tchar *str = NULL;\n\tplist_get_string_val(node, &str);\n\tif (str && (strcmp(str, message) == 0)) {\n\t\terr = MOBILEBACKUP_E_SUCCESS;\n\t} else {\n\t\tdebug_info(\"ERROR: BackupMessageTypeKey value does not match '%s'!\", message);\n\t\terr = MOBILEBACKUP_E_REPLY_NOT_OK;\n\t}\n\tif (str)\n\t\tfree(str);\n\n\tif (result) {\n\t\t*result = dict;\n\t\tdict = NULL;\n\t}\nleave:\n\tif (dict) {\n\t\tplist_free(dict);\n\t}\n\n\treturn err;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"device_link_service.h\"",
            "#include \"mobilebackup.h\"",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <plist/plist.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"device_link_service.h\"\n#include \"mobilebackup.h\"\n#include <stdlib.h>\n#include <string.h>\n#include <plist/plist.h>\n\nstatic mobilebackup_error_t mobilebackup_receive_message(mobilebackup_client_t client, const char *message, plist_t *result)\n{\n\tif (!client || !client->parent || !message)\n\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\n\tif (result)\n\t\t*result = NULL;\n\tmobilebackup_error_t err;\n\n\tplist_t dict = NULL;\n\n\t/* receive DLMessageProcessMessage */\n\terr = mobilebackup_error(device_link_service_receive_process_message(client->parent, &dict));\n\tif (err != MOBILEBACKUP_E_SUCCESS) {\n\t\tgoto leave;\n\t}\n\n\tplist_t node = plist_dict_get_item(dict, \"BackupMessageTypeKey\");\n\tif (!node) {\n\t\tdebug_info(\"ERROR: BackupMessageTypeKey not found in plist!\");\n\t\terr = MOBILEBACKUP_E_PLIST_ERROR;\n\t\tgoto leave;\n\t}\n\n\tchar *str = NULL;\n\tplist_get_string_val(node, &str);\n\tif (str && (strcmp(str, message) == 0)) {\n\t\terr = MOBILEBACKUP_E_SUCCESS;\n\t} else {\n\t\tdebug_info(\"ERROR: BackupMessageTypeKey value does not match '%s'!\", message);\n\t\terr = MOBILEBACKUP_E_REPLY_NOT_OK;\n\t}\n\tif (str)\n\t\tfree(str);\n\n\tif (result) {\n\t\t*result = dict;\n\t\tdict = NULL;\n\t}\nleave:\n\tif (dict) {\n\t\tplist_free(dict);\n\t}\n\n\treturn err;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"ERROR: Could not send restore request message (%d)!\"",
            "err"
          ],
          "line": 325
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "dict"
          ],
          "line": 322
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mobilebackup_send_message",
          "args": [
            "client",
            "NULL",
            "dict"
          ],
          "line": 321
        },
        "resolved": true,
        "details": {
          "function_name": "mobilebackup_send_message",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/mobilebackup.c",
          "lines": "137-167",
          "snippet": "static mobilebackup_error_t mobilebackup_send_message(mobilebackup_client_t client, const char *message, plist_t options)\n{\n\tif (!client || !client->parent || (!message && !options))\n\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\n\tif (options && (plist_get_node_type(options) != PLIST_DICT)) {\n\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\t}\n\n\tmobilebackup_error_t err;\n\n\tif (message) {\n\t\tplist_t dict = NULL;\n\t\tif (options) {\n\t\t\tdict = plist_copy(options);\n\t\t} else {\n\t\t\tdict = plist_new_dict();\n\t\t}\n\t\tplist_dict_set_item(dict, \"BackupMessageTypeKey\", plist_new_string(message));\n\n\t\t/* send it as DLMessageProcessMessage */\n\t\terr = mobilebackup_error(device_link_service_send_process_message(client->parent, dict));\n\t\tplist_free(dict);\n\t} else {\n\t\terr = mobilebackup_error(device_link_service_send_process_message(client->parent, options));\n\t}\n\tif (err != MOBILEBACKUP_E_SUCCESS) {\n\t\tdebug_info(\"ERROR: Could not send message '%s' (%d)!\", message, err);\n\t}\n\treturn err;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"device_link_service.h\"",
            "#include \"mobilebackup.h\"",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <plist/plist.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"device_link_service.h\"\n#include \"mobilebackup.h\"\n#include <stdlib.h>\n#include <string.h>\n#include <plist/plist.h>\n\nstatic mobilebackup_error_t mobilebackup_send_message(mobilebackup_client_t client, const char *message, plist_t options)\n{\n\tif (!client || !client->parent || (!message && !options))\n\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\n\tif (options && (plist_get_node_type(options) != PLIST_DICT)) {\n\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\t}\n\n\tmobilebackup_error_t err;\n\n\tif (message) {\n\t\tplist_t dict = NULL;\n\t\tif (options) {\n\t\t\tdict = plist_copy(options);\n\t\t} else {\n\t\t\tdict = plist_new_dict();\n\t\t}\n\t\tplist_dict_set_item(dict, \"BackupMessageTypeKey\", plist_new_string(message));\n\n\t\t/* send it as DLMessageProcessMessage */\n\t\terr = mobilebackup_error(device_link_service_send_process_message(client->parent, dict));\n\t\tplist_free(dict);\n\t} else {\n\t\terr = mobilebackup_error(device_link_service_send_process_message(client->parent, options));\n\t}\n\tif (err != MOBILEBACKUP_E_SUCCESS) {\n\t\tdebug_info(\"ERROR: Could not send message '%s' (%d)!\", message, err);\n\t}\n\treturn err;\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"BackupPreserveCameraRoll\"",
            "plist_new_bool(IS_FLAG_SET(flags, MB_RESTORE_PRESERVE_CAMERA_ROLL))"
          ],
          "line": 318
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_bool",
          "args": [
            "IS_FLAG_SET(flags, MB_RESTORE_PRESERVE_CAMERA_ROLL)"
          ],
          "line": 318
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "IS_FLAG_SET",
          "args": [
            "flags",
            "MB_RESTORE_PRESERVE_CAMERA_ROLL"
          ],
          "line": 318
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"BackupPreserveSettings\"",
            "plist_new_bool(IS_FLAG_SET(flags, MB_RESTORE_PRESERVE_SETTINGS))"
          ],
          "line": 317
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_bool",
          "args": [
            "IS_FLAG_SET(flags, MB_RESTORE_PRESERVE_SETTINGS)"
          ],
          "line": 317
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "IS_FLAG_SET",
          "args": [
            "flags",
            "MB_RESTORE_PRESERVE_SETTINGS"
          ],
          "line": 317
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"BackupNotifySpringBoard\"",
            "plist_new_bool(IS_FLAG_SET(flags, MB_RESTORE_NOTIFY_SPRINGBOARD))"
          ],
          "line": 316
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_bool",
          "args": [
            "IS_FLAG_SET(flags, MB_RESTORE_NOTIFY_SPRINGBOARD)"
          ],
          "line": 316
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "IS_FLAG_SET",
          "args": [
            "flags",
            "MB_RESTORE_NOTIFY_SPRINGBOARD"
          ],
          "line": 316
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"BackupProtocolVersion\"",
            "plist_new_string(proto_version)"
          ],
          "line": 314
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "proto_version"
          ],
          "line": 314
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"BackupMessageTypeKey\"",
            "plist_new_string(\"kBackupMessageRestoreRequest\")"
          ],
          "line": 313
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "\"kBackupMessageRestoreRequest\""
          ],
          "line": 313
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"BackupManifestKey\"",
            "plist_copy(backup_manifest)"
          ],
          "line": 312
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_copy",
          "args": [
            "backup_manifest"
          ],
          "line": 312
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_dict",
          "args": [],
          "line": 311
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_get_node_type",
          "args": [
            "backup_manifest"
          ],
          "line": 305
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"device_link_service.h\"\n#include \"mobilebackup.h\"\n#include <stdlib.h>\n#include <string.h>\n#include <plist/plist.h>\n\nLIBIMOBILEDEVICE_API mobilebackup_error_t mobilebackup_request_restore(mobilebackup_client_t client, plist_t backup_manifest, mobilebackup_flags_t flags, const char *proto_version)\n{\n\tif (!client || !client->parent || !backup_manifest || !proto_version)\n\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\n\tif (backup_manifest && (plist_get_node_type(backup_manifest) != PLIST_DICT))\n\t\treturn MOBILEBACKUP_E_PLIST_ERROR;\n\n\tmobilebackup_error_t err;\n\n\t/* construct request plist */\n\tplist_t dict = plist_new_dict();\n\tplist_dict_set_item(dict, \"BackupManifestKey\", plist_copy(backup_manifest));\n\tplist_dict_set_item(dict, \"BackupMessageTypeKey\", plist_new_string(\"kBackupMessageRestoreRequest\"));\n\tplist_dict_set_item(dict, \"BackupProtocolVersion\", plist_new_string(proto_version));\n\t/* add flags */\n\tplist_dict_set_item(dict, \"BackupNotifySpringBoard\", plist_new_bool(IS_FLAG_SET(flags, MB_RESTORE_NOTIFY_SPRINGBOARD)));\n\tplist_dict_set_item(dict, \"BackupPreserveSettings\", plist_new_bool(IS_FLAG_SET(flags, MB_RESTORE_PRESERVE_SETTINGS)));\n\tplist_dict_set_item(dict, \"BackupPreserveCameraRoll\", plist_new_bool(IS_FLAG_SET(flags, MB_RESTORE_PRESERVE_CAMERA_ROLL)));\n\n\t/* send request */\n\terr = mobilebackup_send_message(client, NULL, dict);\n\tplist_free(dict);\n\tdict = NULL;\n\tif (err != MOBILEBACKUP_E_SUCCESS) {\n\t\tdebug_info(\"ERROR: Could not send restore request message (%d)!\", err);\n\t\tgoto leave;\n\t}\n\n\t/* now receive and hopefully get a BackupMessageRestoreReplyOK */\n\terr = mobilebackup_receive_message(client, \"BackupMessageRestoreReplyOK\", &dict);\n\tif (err != MOBILEBACKUP_E_SUCCESS) {\n\t\tdebug_info(\"ERROR: Could not receive RestoreReplyOK message (%d)!\", err);\n\t\tgoto leave;\n\t}\n\n\tplist_t node = plist_dict_get_item(dict, \"BackupProtocolVersion\");\n\tif (node) {\n\t\tchar *str = NULL;\n\t\tplist_get_string_val(node, &str);\n\t\tif (str) {\n\t\t\tif (strcmp(str, proto_version) != 0) {\n\t\t\t\terr = MOBILEBACKUP_E_BAD_VERSION;\n\t\t\t}\n\t\t\tfree(str);\n\t\t}\n\t}\n\nleave:\n\tif (dict)\n\t\tplist_free(dict);\n\treturn err;\n}"
  },
  {
    "function_name": "mobilebackup_send_backup_file_received",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/mobilebackup.c",
    "lines": "295-298",
    "snippet": "LIBIMOBILEDEVICE_API mobilebackup_error_t mobilebackup_send_backup_file_received(mobilebackup_client_t client)\n{\n\treturn mobilebackup_send_message(client, \"kBackupMessageBackupFileReceived\", NULL);\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"device_link_service.h\"",
      "#include \"mobilebackup.h\"",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <plist/plist.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "mobilebackup_send_message",
          "args": [
            "client",
            "\"kBackupMessageBackupFileReceived\"",
            "NULL"
          ],
          "line": 297
        },
        "resolved": true,
        "details": {
          "function_name": "mobilebackup_send_message",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/mobilebackup.c",
          "lines": "137-167",
          "snippet": "static mobilebackup_error_t mobilebackup_send_message(mobilebackup_client_t client, const char *message, plist_t options)\n{\n\tif (!client || !client->parent || (!message && !options))\n\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\n\tif (options && (plist_get_node_type(options) != PLIST_DICT)) {\n\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\t}\n\n\tmobilebackup_error_t err;\n\n\tif (message) {\n\t\tplist_t dict = NULL;\n\t\tif (options) {\n\t\t\tdict = plist_copy(options);\n\t\t} else {\n\t\t\tdict = plist_new_dict();\n\t\t}\n\t\tplist_dict_set_item(dict, \"BackupMessageTypeKey\", plist_new_string(message));\n\n\t\t/* send it as DLMessageProcessMessage */\n\t\terr = mobilebackup_error(device_link_service_send_process_message(client->parent, dict));\n\t\tplist_free(dict);\n\t} else {\n\t\terr = mobilebackup_error(device_link_service_send_process_message(client->parent, options));\n\t}\n\tif (err != MOBILEBACKUP_E_SUCCESS) {\n\t\tdebug_info(\"ERROR: Could not send message '%s' (%d)!\", message, err);\n\t}\n\treturn err;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"device_link_service.h\"",
            "#include \"mobilebackup.h\"",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <plist/plist.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"device_link_service.h\"\n#include \"mobilebackup.h\"\n#include <stdlib.h>\n#include <string.h>\n#include <plist/plist.h>\n\nstatic mobilebackup_error_t mobilebackup_send_message(mobilebackup_client_t client, const char *message, plist_t options)\n{\n\tif (!client || !client->parent || (!message && !options))\n\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\n\tif (options && (plist_get_node_type(options) != PLIST_DICT)) {\n\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\t}\n\n\tmobilebackup_error_t err;\n\n\tif (message) {\n\t\tplist_t dict = NULL;\n\t\tif (options) {\n\t\t\tdict = plist_copy(options);\n\t\t} else {\n\t\t\tdict = plist_new_dict();\n\t\t}\n\t\tplist_dict_set_item(dict, \"BackupMessageTypeKey\", plist_new_string(message));\n\n\t\t/* send it as DLMessageProcessMessage */\n\t\terr = mobilebackup_error(device_link_service_send_process_message(client->parent, dict));\n\t\tplist_free(dict);\n\t} else {\n\t\terr = mobilebackup_error(device_link_service_send_process_message(client->parent, options));\n\t}\n\tif (err != MOBILEBACKUP_E_SUCCESS) {\n\t\tdebug_info(\"ERROR: Could not send message '%s' (%d)!\", message, err);\n\t}\n\treturn err;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"device_link_service.h\"\n#include \"mobilebackup.h\"\n#include <stdlib.h>\n#include <string.h>\n#include <plist/plist.h>\n\nLIBIMOBILEDEVICE_API mobilebackup_error_t mobilebackup_send_backup_file_received(mobilebackup_client_t client)\n{\n\treturn mobilebackup_send_message(client, \"kBackupMessageBackupFileReceived\", NULL);\n}"
  },
  {
    "function_name": "mobilebackup_request_backup",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/mobilebackup.c",
    "lines": "235-293",
    "snippet": "LIBIMOBILEDEVICE_API mobilebackup_error_t mobilebackup_request_backup(mobilebackup_client_t client, plist_t backup_manifest, const char *base_path, const char *proto_version)\n{\n\tif (!client || !client->parent || !base_path || !proto_version)\n\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\n\tif (backup_manifest && (plist_get_node_type(backup_manifest) != PLIST_DICT))\n\t\treturn MOBILEBACKUP_E_PLIST_ERROR;\n\n\tmobilebackup_error_t err;\n\n\t/* construct request plist */\n\tplist_t dict = plist_new_dict();\n\tif (backup_manifest)\n\t\tplist_dict_set_item(dict, \"BackupManifestKey\", plist_copy(backup_manifest));\n\tplist_dict_set_item(dict, \"BackupComputerBasePathKey\", plist_new_string(base_path));\n\tplist_dict_set_item(dict, \"BackupMessageTypeKey\", plist_new_string(\"BackupMessageBackupRequest\"));\n\tplist_dict_set_item(dict, \"BackupProtocolVersion\", plist_new_string(proto_version));\n\n\t/* send request */\n\terr = mobilebackup_send_message(client, NULL, dict);\n\tplist_free(dict);\n\tdict = NULL;\n\tif (err != MOBILEBACKUP_E_SUCCESS) {\n\t\tdebug_info(\"ERROR: Could not send backup request message (%d)!\", err);\n\t\tgoto leave;\n\t}\n\n\t/* now receive and hopefully get a BackupMessageBackupReplyOK */\n\terr = mobilebackup_receive_message(client, \"BackupMessageBackupReplyOK\", &dict);\n\tif (err != MOBILEBACKUP_E_SUCCESS) {\n\t\tdebug_info(\"ERROR: Could not receive BackupReplyOK message (%d)!\", err);\n\t\tgoto leave;\n\t}\n\n\tplist_t node = plist_dict_get_item(dict, \"BackupProtocolVersion\");\n\tif (node) {\n\t\tchar *str = NULL;\n\t\tplist_get_string_val(node, &str);\n\t\tif (str) {\n\t\t\tif (strcmp(str, proto_version) != 0) {\n\t\t\t\terr = MOBILEBACKUP_E_BAD_VERSION;\n\t\t\t}\n\t\t\tfree(str);\n\t\t}\n\t}\n\tif (err != MOBILEBACKUP_E_SUCCESS)\n\t\tgoto leave;\n\n\t/* BackupMessageBackupReplyOK received, send it back */\n\terr = mobilebackup_send_message(client, NULL, dict);\n\tif (err != MOBILEBACKUP_E_SUCCESS) {\n\t\tdebug_info(\"ERROR: Could not send BackupReplyOK ACK (%d)\", err);\n\t}\n\nleave:\n\tif (dict)\n\t\tplist_free(dict);\n\treturn err;\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"device_link_service.h\"",
      "#include \"mobilebackup.h\"",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <plist/plist.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "dict"
          ],
          "line": 291
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"ERROR: Could not send BackupReplyOK ACK (%d)\"",
            "err"
          ],
          "line": 286
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mobilebackup_send_message",
          "args": [
            "client",
            "NULL",
            "dict"
          ],
          "line": 284
        },
        "resolved": true,
        "details": {
          "function_name": "mobilebackup_send_message",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/mobilebackup.c",
          "lines": "137-167",
          "snippet": "static mobilebackup_error_t mobilebackup_send_message(mobilebackup_client_t client, const char *message, plist_t options)\n{\n\tif (!client || !client->parent || (!message && !options))\n\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\n\tif (options && (plist_get_node_type(options) != PLIST_DICT)) {\n\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\t}\n\n\tmobilebackup_error_t err;\n\n\tif (message) {\n\t\tplist_t dict = NULL;\n\t\tif (options) {\n\t\t\tdict = plist_copy(options);\n\t\t} else {\n\t\t\tdict = plist_new_dict();\n\t\t}\n\t\tplist_dict_set_item(dict, \"BackupMessageTypeKey\", plist_new_string(message));\n\n\t\t/* send it as DLMessageProcessMessage */\n\t\terr = mobilebackup_error(device_link_service_send_process_message(client->parent, dict));\n\t\tplist_free(dict);\n\t} else {\n\t\terr = mobilebackup_error(device_link_service_send_process_message(client->parent, options));\n\t}\n\tif (err != MOBILEBACKUP_E_SUCCESS) {\n\t\tdebug_info(\"ERROR: Could not send message '%s' (%d)!\", message, err);\n\t}\n\treturn err;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"device_link_service.h\"",
            "#include \"mobilebackup.h\"",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <plist/plist.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"device_link_service.h\"\n#include \"mobilebackup.h\"\n#include <stdlib.h>\n#include <string.h>\n#include <plist/plist.h>\n\nstatic mobilebackup_error_t mobilebackup_send_message(mobilebackup_client_t client, const char *message, plist_t options)\n{\n\tif (!client || !client->parent || (!message && !options))\n\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\n\tif (options && (plist_get_node_type(options) != PLIST_DICT)) {\n\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\t}\n\n\tmobilebackup_error_t err;\n\n\tif (message) {\n\t\tplist_t dict = NULL;\n\t\tif (options) {\n\t\t\tdict = plist_copy(options);\n\t\t} else {\n\t\t\tdict = plist_new_dict();\n\t\t}\n\t\tplist_dict_set_item(dict, \"BackupMessageTypeKey\", plist_new_string(message));\n\n\t\t/* send it as DLMessageProcessMessage */\n\t\terr = mobilebackup_error(device_link_service_send_process_message(client->parent, dict));\n\t\tplist_free(dict);\n\t} else {\n\t\terr = mobilebackup_error(device_link_service_send_process_message(client->parent, options));\n\t}\n\tif (err != MOBILEBACKUP_E_SUCCESS) {\n\t\tdebug_info(\"ERROR: Could not send message '%s' (%d)!\", message, err);\n\t}\n\treturn err;\n}"
        }
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "str"
          ],
          "line": 277
        },
        "resolved": true,
        "details": {
          "function_name": "mobilebackup_client_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/mobilebackup.c",
          "lines": "97-108",
          "snippet": "LIBIMOBILEDEVICE_API mobilebackup_error_t mobilebackup_client_free(mobilebackup_client_t client)\n{\n\tif (!client)\n\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\tmobilebackup_error_t err = MOBILEBACKUP_E_SUCCESS;\n\tif (client->parent) {\n\t\tdevice_link_service_disconnect(client->parent, NULL);\n\t\terr = mobilebackup_error(device_link_service_client_free(client->parent));\n\t}\n\tfree(client);\n\treturn err;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"device_link_service.h\"",
            "#include \"mobilebackup.h\"",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <plist/plist.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"device_link_service.h\"\n#include \"mobilebackup.h\"\n#include <stdlib.h>\n#include <string.h>\n#include <plist/plist.h>\n\nLIBIMOBILEDEVICE_API mobilebackup_error_t mobilebackup_client_free(mobilebackup_client_t client)\n{\n\tif (!client)\n\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\tmobilebackup_error_t err = MOBILEBACKUP_E_SUCCESS;\n\tif (client->parent) {\n\t\tdevice_link_service_disconnect(client->parent, NULL);\n\t\terr = mobilebackup_error(device_link_service_client_free(client->parent));\n\t}\n\tfree(client);\n\treturn err;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "str",
            "proto_version"
          ],
          "line": 274
        },
        "resolved": true,
        "details": {
          "function_name": "plist_strcmp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/tools/idevicebackup.c",
          "lines": "296-309",
          "snippet": "static int plist_strcmp(plist_t node, const char *str)\n{\n\tchar *buffer = NULL;\n\tint ret = 0;\n\n\tif (plist_get_node_type(node) != PLIST_STRING)\n\t\treturn ret;\n\n\tplist_get_string_val(node, &buffer);\n\tret = strcmp(buffer, str);\n\tfree(buffer);\n\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"common/utils.h\"",
            "#include <libimobiledevice/afc.h>",
            "#include <libimobiledevice/notification_proxy.h>",
            "#include <libimobiledevice/mobilebackup.h>",
            "#include <libimobiledevice/lockdown.h>",
            "#include <libimobiledevice/libimobiledevice.h>",
            "#include <time.h>",
            "#include <ctype.h>",
            "#include <unistd.h>",
            "#include <gcrypt.h>",
            "#include <openssl/sha.h>",
            "#include <signal.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"common/utils.h\"\n#include <libimobiledevice/afc.h>\n#include <libimobiledevice/notification_proxy.h>\n#include <libimobiledevice/mobilebackup.h>\n#include <libimobiledevice/lockdown.h>\n#include <libimobiledevice/libimobiledevice.h>\n#include <time.h>\n#include <ctype.h>\n#include <unistd.h>\n#include <gcrypt.h>\n#include <openssl/sha.h>\n#include <signal.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int plist_strcmp(plist_t node, const char *str)\n{\n\tchar *buffer = NULL;\n\tint ret = 0;\n\n\tif (plist_get_node_type(node) != PLIST_STRING)\n\t\treturn ret;\n\n\tplist_get_string_val(node, &buffer);\n\tret = strcmp(buffer, str);\n\tfree(buffer);\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_get_string_val",
          "args": [
            "node",
            "&str"
          ],
          "line": 272
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_get_item",
          "args": [
            "dict",
            "\"BackupProtocolVersion\""
          ],
          "line": 269
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"ERROR: Could not receive BackupReplyOK message (%d)!\"",
            "err"
          ],
          "line": 265
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mobilebackup_receive_message",
          "args": [
            "client",
            "\"BackupMessageBackupReplyOK\"",
            "&dict"
          ],
          "line": 263
        },
        "resolved": true,
        "details": {
          "function_name": "mobilebackup_receive_message",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/mobilebackup.c",
          "lines": "188-233",
          "snippet": "static mobilebackup_error_t mobilebackup_receive_message(mobilebackup_client_t client, const char *message, plist_t *result)\n{\n\tif (!client || !client->parent || !message)\n\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\n\tif (result)\n\t\t*result = NULL;\n\tmobilebackup_error_t err;\n\n\tplist_t dict = NULL;\n\n\t/* receive DLMessageProcessMessage */\n\terr = mobilebackup_error(device_link_service_receive_process_message(client->parent, &dict));\n\tif (err != MOBILEBACKUP_E_SUCCESS) {\n\t\tgoto leave;\n\t}\n\n\tplist_t node = plist_dict_get_item(dict, \"BackupMessageTypeKey\");\n\tif (!node) {\n\t\tdebug_info(\"ERROR: BackupMessageTypeKey not found in plist!\");\n\t\terr = MOBILEBACKUP_E_PLIST_ERROR;\n\t\tgoto leave;\n\t}\n\n\tchar *str = NULL;\n\tplist_get_string_val(node, &str);\n\tif (str && (strcmp(str, message) == 0)) {\n\t\terr = MOBILEBACKUP_E_SUCCESS;\n\t} else {\n\t\tdebug_info(\"ERROR: BackupMessageTypeKey value does not match '%s'!\", message);\n\t\terr = MOBILEBACKUP_E_REPLY_NOT_OK;\n\t}\n\tif (str)\n\t\tfree(str);\n\n\tif (result) {\n\t\t*result = dict;\n\t\tdict = NULL;\n\t}\nleave:\n\tif (dict) {\n\t\tplist_free(dict);\n\t}\n\n\treturn err;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"device_link_service.h\"",
            "#include \"mobilebackup.h\"",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <plist/plist.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"device_link_service.h\"\n#include \"mobilebackup.h\"\n#include <stdlib.h>\n#include <string.h>\n#include <plist/plist.h>\n\nstatic mobilebackup_error_t mobilebackup_receive_message(mobilebackup_client_t client, const char *message, plist_t *result)\n{\n\tif (!client || !client->parent || !message)\n\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\n\tif (result)\n\t\t*result = NULL;\n\tmobilebackup_error_t err;\n\n\tplist_t dict = NULL;\n\n\t/* receive DLMessageProcessMessage */\n\terr = mobilebackup_error(device_link_service_receive_process_message(client->parent, &dict));\n\tif (err != MOBILEBACKUP_E_SUCCESS) {\n\t\tgoto leave;\n\t}\n\n\tplist_t node = plist_dict_get_item(dict, \"BackupMessageTypeKey\");\n\tif (!node) {\n\t\tdebug_info(\"ERROR: BackupMessageTypeKey not found in plist!\");\n\t\terr = MOBILEBACKUP_E_PLIST_ERROR;\n\t\tgoto leave;\n\t}\n\n\tchar *str = NULL;\n\tplist_get_string_val(node, &str);\n\tif (str && (strcmp(str, message) == 0)) {\n\t\terr = MOBILEBACKUP_E_SUCCESS;\n\t} else {\n\t\tdebug_info(\"ERROR: BackupMessageTypeKey value does not match '%s'!\", message);\n\t\terr = MOBILEBACKUP_E_REPLY_NOT_OK;\n\t}\n\tif (str)\n\t\tfree(str);\n\n\tif (result) {\n\t\t*result = dict;\n\t\tdict = NULL;\n\t}\nleave:\n\tif (dict) {\n\t\tplist_free(dict);\n\t}\n\n\treturn err;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"ERROR: Could not send backup request message (%d)!\"",
            "err"
          ],
          "line": 258
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "dict"
          ],
          "line": 255
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"BackupProtocolVersion\"",
            "plist_new_string(proto_version)"
          ],
          "line": 251
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "proto_version"
          ],
          "line": 251
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"BackupMessageTypeKey\"",
            "plist_new_string(\"BackupMessageBackupRequest\")"
          ],
          "line": 250
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "\"BackupMessageBackupRequest\""
          ],
          "line": 250
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"BackupComputerBasePathKey\"",
            "plist_new_string(base_path)"
          ],
          "line": 249
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "base_path"
          ],
          "line": 249
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"BackupManifestKey\"",
            "plist_copy(backup_manifest)"
          ],
          "line": 248
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_copy",
          "args": [
            "backup_manifest"
          ],
          "line": 248
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_dict",
          "args": [],
          "line": 246
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_get_node_type",
          "args": [
            "backup_manifest"
          ],
          "line": 240
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"device_link_service.h\"\n#include \"mobilebackup.h\"\n#include <stdlib.h>\n#include <string.h>\n#include <plist/plist.h>\n\nLIBIMOBILEDEVICE_API mobilebackup_error_t mobilebackup_request_backup(mobilebackup_client_t client, plist_t backup_manifest, const char *base_path, const char *proto_version)\n{\n\tif (!client || !client->parent || !base_path || !proto_version)\n\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\n\tif (backup_manifest && (plist_get_node_type(backup_manifest) != PLIST_DICT))\n\t\treturn MOBILEBACKUP_E_PLIST_ERROR;\n\n\tmobilebackup_error_t err;\n\n\t/* construct request plist */\n\tplist_t dict = plist_new_dict();\n\tif (backup_manifest)\n\t\tplist_dict_set_item(dict, \"BackupManifestKey\", plist_copy(backup_manifest));\n\tplist_dict_set_item(dict, \"BackupComputerBasePathKey\", plist_new_string(base_path));\n\tplist_dict_set_item(dict, \"BackupMessageTypeKey\", plist_new_string(\"BackupMessageBackupRequest\"));\n\tplist_dict_set_item(dict, \"BackupProtocolVersion\", plist_new_string(proto_version));\n\n\t/* send request */\n\terr = mobilebackup_send_message(client, NULL, dict);\n\tplist_free(dict);\n\tdict = NULL;\n\tif (err != MOBILEBACKUP_E_SUCCESS) {\n\t\tdebug_info(\"ERROR: Could not send backup request message (%d)!\", err);\n\t\tgoto leave;\n\t}\n\n\t/* now receive and hopefully get a BackupMessageBackupReplyOK */\n\terr = mobilebackup_receive_message(client, \"BackupMessageBackupReplyOK\", &dict);\n\tif (err != MOBILEBACKUP_E_SUCCESS) {\n\t\tdebug_info(\"ERROR: Could not receive BackupReplyOK message (%d)!\", err);\n\t\tgoto leave;\n\t}\n\n\tplist_t node = plist_dict_get_item(dict, \"BackupProtocolVersion\");\n\tif (node) {\n\t\tchar *str = NULL;\n\t\tplist_get_string_val(node, &str);\n\t\tif (str) {\n\t\t\tif (strcmp(str, proto_version) != 0) {\n\t\t\t\terr = MOBILEBACKUP_E_BAD_VERSION;\n\t\t\t}\n\t\t\tfree(str);\n\t\t}\n\t}\n\tif (err != MOBILEBACKUP_E_SUCCESS)\n\t\tgoto leave;\n\n\t/* BackupMessageBackupReplyOK received, send it back */\n\terr = mobilebackup_send_message(client, NULL, dict);\n\tif (err != MOBILEBACKUP_E_SUCCESS) {\n\t\tdebug_info(\"ERROR: Could not send BackupReplyOK ACK (%d)\", err);\n\t}\n\nleave:\n\tif (dict)\n\t\tplist_free(dict);\n\treturn err;\n}"
  },
  {
    "function_name": "mobilebackup_receive_message",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/mobilebackup.c",
    "lines": "188-233",
    "snippet": "static mobilebackup_error_t mobilebackup_receive_message(mobilebackup_client_t client, const char *message, plist_t *result)\n{\n\tif (!client || !client->parent || !message)\n\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\n\tif (result)\n\t\t*result = NULL;\n\tmobilebackup_error_t err;\n\n\tplist_t dict = NULL;\n\n\t/* receive DLMessageProcessMessage */\n\terr = mobilebackup_error(device_link_service_receive_process_message(client->parent, &dict));\n\tif (err != MOBILEBACKUP_E_SUCCESS) {\n\t\tgoto leave;\n\t}\n\n\tplist_t node = plist_dict_get_item(dict, \"BackupMessageTypeKey\");\n\tif (!node) {\n\t\tdebug_info(\"ERROR: BackupMessageTypeKey not found in plist!\");\n\t\terr = MOBILEBACKUP_E_PLIST_ERROR;\n\t\tgoto leave;\n\t}\n\n\tchar *str = NULL;\n\tplist_get_string_val(node, &str);\n\tif (str && (strcmp(str, message) == 0)) {\n\t\terr = MOBILEBACKUP_E_SUCCESS;\n\t} else {\n\t\tdebug_info(\"ERROR: BackupMessageTypeKey value does not match '%s'!\", message);\n\t\terr = MOBILEBACKUP_E_REPLY_NOT_OK;\n\t}\n\tif (str)\n\t\tfree(str);\n\n\tif (result) {\n\t\t*result = dict;\n\t\tdict = NULL;\n\t}\nleave:\n\tif (dict) {\n\t\tplist_free(dict);\n\t}\n\n\treturn err;\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"device_link_service.h\"",
      "#include \"mobilebackup.h\"",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <plist/plist.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "dict"
          ],
          "line": 229
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "str"
          ],
          "line": 221
        },
        "resolved": true,
        "details": {
          "function_name": "mobilebackup_client_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/mobilebackup.c",
          "lines": "97-108",
          "snippet": "LIBIMOBILEDEVICE_API mobilebackup_error_t mobilebackup_client_free(mobilebackup_client_t client)\n{\n\tif (!client)\n\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\tmobilebackup_error_t err = MOBILEBACKUP_E_SUCCESS;\n\tif (client->parent) {\n\t\tdevice_link_service_disconnect(client->parent, NULL);\n\t\terr = mobilebackup_error(device_link_service_client_free(client->parent));\n\t}\n\tfree(client);\n\treturn err;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"device_link_service.h\"",
            "#include \"mobilebackup.h\"",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <plist/plist.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"device_link_service.h\"\n#include \"mobilebackup.h\"\n#include <stdlib.h>\n#include <string.h>\n#include <plist/plist.h>\n\nLIBIMOBILEDEVICE_API mobilebackup_error_t mobilebackup_client_free(mobilebackup_client_t client)\n{\n\tif (!client)\n\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\tmobilebackup_error_t err = MOBILEBACKUP_E_SUCCESS;\n\tif (client->parent) {\n\t\tdevice_link_service_disconnect(client->parent, NULL);\n\t\terr = mobilebackup_error(device_link_service_client_free(client->parent));\n\t}\n\tfree(client);\n\treturn err;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"ERROR: BackupMessageTypeKey value does not match '%s'!\"",
            "message"
          ],
          "line": 217
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "str",
            "message"
          ],
          "line": 214
        },
        "resolved": true,
        "details": {
          "function_name": "plist_strcmp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/tools/idevicebackup.c",
          "lines": "296-309",
          "snippet": "static int plist_strcmp(plist_t node, const char *str)\n{\n\tchar *buffer = NULL;\n\tint ret = 0;\n\n\tif (plist_get_node_type(node) != PLIST_STRING)\n\t\treturn ret;\n\n\tplist_get_string_val(node, &buffer);\n\tret = strcmp(buffer, str);\n\tfree(buffer);\n\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"common/utils.h\"",
            "#include <libimobiledevice/afc.h>",
            "#include <libimobiledevice/notification_proxy.h>",
            "#include <libimobiledevice/mobilebackup.h>",
            "#include <libimobiledevice/lockdown.h>",
            "#include <libimobiledevice/libimobiledevice.h>",
            "#include <time.h>",
            "#include <ctype.h>",
            "#include <unistd.h>",
            "#include <gcrypt.h>",
            "#include <openssl/sha.h>",
            "#include <signal.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"common/utils.h\"\n#include <libimobiledevice/afc.h>\n#include <libimobiledevice/notification_proxy.h>\n#include <libimobiledevice/mobilebackup.h>\n#include <libimobiledevice/lockdown.h>\n#include <libimobiledevice/libimobiledevice.h>\n#include <time.h>\n#include <ctype.h>\n#include <unistd.h>\n#include <gcrypt.h>\n#include <openssl/sha.h>\n#include <signal.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int plist_strcmp(plist_t node, const char *str)\n{\n\tchar *buffer = NULL;\n\tint ret = 0;\n\n\tif (plist_get_node_type(node) != PLIST_STRING)\n\t\treturn ret;\n\n\tplist_get_string_val(node, &buffer);\n\tret = strcmp(buffer, str);\n\tfree(buffer);\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_get_string_val",
          "args": [
            "node",
            "&str"
          ],
          "line": 213
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"ERROR: BackupMessageTypeKey not found in plist!\""
          ],
          "line": 207
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_get_item",
          "args": [
            "dict",
            "\"BackupMessageTypeKey\""
          ],
          "line": 205
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mobilebackup_error",
          "args": [
            "device_link_service_receive_process_message(client->parent, &dict)"
          ],
          "line": 200
        },
        "resolved": true,
        "details": {
          "function_name": "mobilebackup_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/mobilebackup.c",
          "lines": "44-61",
          "snippet": "static mobilebackup_error_t mobilebackup_error(device_link_service_error_t err)\n{\n\tswitch (err) {\n\t\tcase DEVICE_LINK_SERVICE_E_SUCCESS:\n\t\t\treturn MOBILEBACKUP_E_SUCCESS;\n\t\tcase DEVICE_LINK_SERVICE_E_INVALID_ARG:\n\t\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\t\tcase DEVICE_LINK_SERVICE_E_PLIST_ERROR:\n\t\t\treturn MOBILEBACKUP_E_PLIST_ERROR;\n\t\tcase DEVICE_LINK_SERVICE_E_MUX_ERROR:\n\t\t\treturn MOBILEBACKUP_E_MUX_ERROR;\n\t\tcase DEVICE_LINK_SERVICE_E_BAD_VERSION:\n\t\t\treturn MOBILEBACKUP_E_BAD_VERSION;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn MOBILEBACKUP_E_UNKNOWN_ERROR;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"device_link_service.h\"",
            "#include \"mobilebackup.h\"",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <plist/plist.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"device_link_service.h\"\n#include \"mobilebackup.h\"\n#include <stdlib.h>\n#include <string.h>\n#include <plist/plist.h>\n\nstatic mobilebackup_error_t mobilebackup_error(device_link_service_error_t err)\n{\n\tswitch (err) {\n\t\tcase DEVICE_LINK_SERVICE_E_SUCCESS:\n\t\t\treturn MOBILEBACKUP_E_SUCCESS;\n\t\tcase DEVICE_LINK_SERVICE_E_INVALID_ARG:\n\t\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\t\tcase DEVICE_LINK_SERVICE_E_PLIST_ERROR:\n\t\t\treturn MOBILEBACKUP_E_PLIST_ERROR;\n\t\tcase DEVICE_LINK_SERVICE_E_MUX_ERROR:\n\t\t\treturn MOBILEBACKUP_E_MUX_ERROR;\n\t\tcase DEVICE_LINK_SERVICE_E_BAD_VERSION:\n\t\t\treturn MOBILEBACKUP_E_BAD_VERSION;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn MOBILEBACKUP_E_UNKNOWN_ERROR;\n}"
        }
      },
      {
        "call_info": {
          "callee": "device_link_service_receive_process_message",
          "args": [
            "client->parent",
            "&dict"
          ],
          "line": 200
        },
        "resolved": true,
        "details": {
          "function_name": "device_link_service_receive_process_message",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/device_link_service.c",
          "lines": "375-417",
          "snippet": "device_link_service_error_t device_link_service_receive_process_message(device_link_service_client_t client, plist_t *message)\n{\n\tif (!client || !client->parent || !message)\n\t\treturn DEVICE_LINK_SERVICE_E_INVALID_ARG;\n\n\tplist_t pmsg = NULL;\n\tif (property_list_service_receive_plist(client->parent, &pmsg) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\treturn DEVICE_LINK_SERVICE_E_MUX_ERROR;\n\t}\n\n\tdevice_link_service_error_t err = DEVICE_LINK_SERVICE_E_UNKNOWN_ERROR;\n\n\tchar *msg = NULL;\n\tdevice_link_service_get_message(pmsg, &msg);\n\tif (!msg || strcmp(msg, \"DLMessageProcessMessage\")) {\n\t\tdebug_info(\"Did not receive DLMessageProcessMessage as expected!\");\n\t\terr = DEVICE_LINK_SERVICE_E_PLIST_ERROR;\n\t\tgoto leave;\n\t}\n\n\tif (plist_array_get_size(pmsg) != 2) {\n\t\tdebug_info(\"Malformed plist received for DLMessageProcessMessage\");\n\t\terr = DEVICE_LINK_SERVICE_E_PLIST_ERROR;\n\t\tgoto leave;\n\t}\n\n\tplist_t msg_loc = plist_array_get_item(pmsg, 1);\n\tif (msg_loc) {\n\t\t*message = plist_copy(msg_loc);\n\t\terr = DEVICE_LINK_SERVICE_E_SUCCESS;\n\t} else {\n\t\t*message = NULL;\n\t\terr = DEVICE_LINK_SERVICE_E_PLIST_ERROR;\n\t}\n\nleave:\n\tif (msg)\n\t\tfree(msg);\n\tif (pmsg)\n\t\tplist_free(pmsg);\n\n\treturn err;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include \"device_link_service.h\"",
            "#include <stdlib.h>",
            "#include <string.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"device_link_service.h\"\n#include <stdlib.h>\n#include <string.h>\n\ndevice_link_service_error_t device_link_service_receive_process_message(device_link_service_client_t client, plist_t *message)\n{\n\tif (!client || !client->parent || !message)\n\t\treturn DEVICE_LINK_SERVICE_E_INVALID_ARG;\n\n\tplist_t pmsg = NULL;\n\tif (property_list_service_receive_plist(client->parent, &pmsg) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\treturn DEVICE_LINK_SERVICE_E_MUX_ERROR;\n\t}\n\n\tdevice_link_service_error_t err = DEVICE_LINK_SERVICE_E_UNKNOWN_ERROR;\n\n\tchar *msg = NULL;\n\tdevice_link_service_get_message(pmsg, &msg);\n\tif (!msg || strcmp(msg, \"DLMessageProcessMessage\")) {\n\t\tdebug_info(\"Did not receive DLMessageProcessMessage as expected!\");\n\t\terr = DEVICE_LINK_SERVICE_E_PLIST_ERROR;\n\t\tgoto leave;\n\t}\n\n\tif (plist_array_get_size(pmsg) != 2) {\n\t\tdebug_info(\"Malformed plist received for DLMessageProcessMessage\");\n\t\terr = DEVICE_LINK_SERVICE_E_PLIST_ERROR;\n\t\tgoto leave;\n\t}\n\n\tplist_t msg_loc = plist_array_get_item(pmsg, 1);\n\tif (msg_loc) {\n\t\t*message = plist_copy(msg_loc);\n\t\terr = DEVICE_LINK_SERVICE_E_SUCCESS;\n\t} else {\n\t\t*message = NULL;\n\t\terr = DEVICE_LINK_SERVICE_E_PLIST_ERROR;\n\t}\n\nleave:\n\tif (msg)\n\t\tfree(msg);\n\tif (pmsg)\n\t\tplist_free(pmsg);\n\n\treturn err;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"device_link_service.h\"\n#include \"mobilebackup.h\"\n#include <stdlib.h>\n#include <string.h>\n#include <plist/plist.h>\n\nstatic mobilebackup_error_t mobilebackup_receive_message(mobilebackup_client_t client, const char *message, plist_t *result)\n{\n\tif (!client || !client->parent || !message)\n\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\n\tif (result)\n\t\t*result = NULL;\n\tmobilebackup_error_t err;\n\n\tplist_t dict = NULL;\n\n\t/* receive DLMessageProcessMessage */\n\terr = mobilebackup_error(device_link_service_receive_process_message(client->parent, &dict));\n\tif (err != MOBILEBACKUP_E_SUCCESS) {\n\t\tgoto leave;\n\t}\n\n\tplist_t node = plist_dict_get_item(dict, \"BackupMessageTypeKey\");\n\tif (!node) {\n\t\tdebug_info(\"ERROR: BackupMessageTypeKey not found in plist!\");\n\t\terr = MOBILEBACKUP_E_PLIST_ERROR;\n\t\tgoto leave;\n\t}\n\n\tchar *str = NULL;\n\tplist_get_string_val(node, &str);\n\tif (str && (strcmp(str, message) == 0)) {\n\t\terr = MOBILEBACKUP_E_SUCCESS;\n\t} else {\n\t\tdebug_info(\"ERROR: BackupMessageTypeKey value does not match '%s'!\", message);\n\t\terr = MOBILEBACKUP_E_REPLY_NOT_OK;\n\t}\n\tif (str)\n\t\tfree(str);\n\n\tif (result) {\n\t\t*result = dict;\n\t\tdict = NULL;\n\t}\nleave:\n\tif (dict) {\n\t\tplist_free(dict);\n\t}\n\n\treturn err;\n}"
  },
  {
    "function_name": "mobilebackup_send_message",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/mobilebackup.c",
    "lines": "137-167",
    "snippet": "static mobilebackup_error_t mobilebackup_send_message(mobilebackup_client_t client, const char *message, plist_t options)\n{\n\tif (!client || !client->parent || (!message && !options))\n\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\n\tif (options && (plist_get_node_type(options) != PLIST_DICT)) {\n\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\t}\n\n\tmobilebackup_error_t err;\n\n\tif (message) {\n\t\tplist_t dict = NULL;\n\t\tif (options) {\n\t\t\tdict = plist_copy(options);\n\t\t} else {\n\t\t\tdict = plist_new_dict();\n\t\t}\n\t\tplist_dict_set_item(dict, \"BackupMessageTypeKey\", plist_new_string(message));\n\n\t\t/* send it as DLMessageProcessMessage */\n\t\terr = mobilebackup_error(device_link_service_send_process_message(client->parent, dict));\n\t\tplist_free(dict);\n\t} else {\n\t\terr = mobilebackup_error(device_link_service_send_process_message(client->parent, options));\n\t}\n\tif (err != MOBILEBACKUP_E_SUCCESS) {\n\t\tdebug_info(\"ERROR: Could not send message '%s' (%d)!\", message, err);\n\t}\n\treturn err;\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"device_link_service.h\"",
      "#include \"mobilebackup.h\"",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <plist/plist.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"ERROR: Could not send message '%s' (%d)!\"",
            "message",
            "err"
          ],
          "line": 164
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mobilebackup_error",
          "args": [
            "device_link_service_send_process_message(client->parent, options)"
          ],
          "line": 161
        },
        "resolved": true,
        "details": {
          "function_name": "mobilebackup_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/mobilebackup.c",
          "lines": "44-61",
          "snippet": "static mobilebackup_error_t mobilebackup_error(device_link_service_error_t err)\n{\n\tswitch (err) {\n\t\tcase DEVICE_LINK_SERVICE_E_SUCCESS:\n\t\t\treturn MOBILEBACKUP_E_SUCCESS;\n\t\tcase DEVICE_LINK_SERVICE_E_INVALID_ARG:\n\t\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\t\tcase DEVICE_LINK_SERVICE_E_PLIST_ERROR:\n\t\t\treturn MOBILEBACKUP_E_PLIST_ERROR;\n\t\tcase DEVICE_LINK_SERVICE_E_MUX_ERROR:\n\t\t\treturn MOBILEBACKUP_E_MUX_ERROR;\n\t\tcase DEVICE_LINK_SERVICE_E_BAD_VERSION:\n\t\t\treturn MOBILEBACKUP_E_BAD_VERSION;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn MOBILEBACKUP_E_UNKNOWN_ERROR;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"device_link_service.h\"",
            "#include \"mobilebackup.h\"",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <plist/plist.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"device_link_service.h\"\n#include \"mobilebackup.h\"\n#include <stdlib.h>\n#include <string.h>\n#include <plist/plist.h>\n\nstatic mobilebackup_error_t mobilebackup_error(device_link_service_error_t err)\n{\n\tswitch (err) {\n\t\tcase DEVICE_LINK_SERVICE_E_SUCCESS:\n\t\t\treturn MOBILEBACKUP_E_SUCCESS;\n\t\tcase DEVICE_LINK_SERVICE_E_INVALID_ARG:\n\t\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\t\tcase DEVICE_LINK_SERVICE_E_PLIST_ERROR:\n\t\t\treturn MOBILEBACKUP_E_PLIST_ERROR;\n\t\tcase DEVICE_LINK_SERVICE_E_MUX_ERROR:\n\t\t\treturn MOBILEBACKUP_E_MUX_ERROR;\n\t\tcase DEVICE_LINK_SERVICE_E_BAD_VERSION:\n\t\t\treturn MOBILEBACKUP_E_BAD_VERSION;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn MOBILEBACKUP_E_UNKNOWN_ERROR;\n}"
        }
      },
      {
        "call_info": {
          "callee": "device_link_service_send_process_message",
          "args": [
            "client->parent",
            "options"
          ],
          "line": 161
        },
        "resolved": true,
        "details": {
          "function_name": "device_link_service_send_process_message",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/device_link_service.c",
          "lines": "308-326",
          "snippet": "device_link_service_error_t device_link_service_send_process_message(device_link_service_client_t client, plist_t message)\n{\n\tif (!client || !client->parent || !message)\n\t\treturn DEVICE_LINK_SERVICE_E_INVALID_ARG;\n\n\tif (plist_get_node_type(message) != PLIST_DICT)\n\t\treturn DEVICE_LINK_SERVICE_E_INVALID_ARG;\n\n\tplist_t array = plist_new_array();\n\tplist_array_append_item(array, plist_new_string(\"DLMessageProcessMessage\"));\n\tplist_array_append_item(array, plist_copy(message));\n\n\tdevice_link_service_error_t err = DEVICE_LINK_SERVICE_E_SUCCESS;\n\tif (property_list_service_send_binary_plist(client->parent, array) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\terr = DEVICE_LINK_SERVICE_E_MUX_ERROR;\n\t}\n\tplist_free(array);\n\treturn err;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include \"device_link_service.h\"",
            "#include <stdlib.h>",
            "#include <string.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"device_link_service.h\"\n#include <stdlib.h>\n#include <string.h>\n\ndevice_link_service_error_t device_link_service_send_process_message(device_link_service_client_t client, plist_t message)\n{\n\tif (!client || !client->parent || !message)\n\t\treturn DEVICE_LINK_SERVICE_E_INVALID_ARG;\n\n\tif (plist_get_node_type(message) != PLIST_DICT)\n\t\treturn DEVICE_LINK_SERVICE_E_INVALID_ARG;\n\n\tplist_t array = plist_new_array();\n\tplist_array_append_item(array, plist_new_string(\"DLMessageProcessMessage\"));\n\tplist_array_append_item(array, plist_copy(message));\n\n\tdevice_link_service_error_t err = DEVICE_LINK_SERVICE_E_SUCCESS;\n\tif (property_list_service_send_binary_plist(client->parent, array) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\terr = DEVICE_LINK_SERVICE_E_MUX_ERROR;\n\t}\n\tplist_free(array);\n\treturn err;\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "dict"
          ],
          "line": 159
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"BackupMessageTypeKey\"",
            "plist_new_string(message)"
          ],
          "line": 155
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "message"
          ],
          "line": 155
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_dict",
          "args": [],
          "line": 153
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_copy",
          "args": [
            "options"
          ],
          "line": 151
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_get_node_type",
          "args": [
            "options"
          ],
          "line": 142
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"device_link_service.h\"\n#include \"mobilebackup.h\"\n#include <stdlib.h>\n#include <string.h>\n#include <plist/plist.h>\n\nstatic mobilebackup_error_t mobilebackup_send_message(mobilebackup_client_t client, const char *message, plist_t options)\n{\n\tif (!client || !client->parent || (!message && !options))\n\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\n\tif (options && (plist_get_node_type(options) != PLIST_DICT)) {\n\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\t}\n\n\tmobilebackup_error_t err;\n\n\tif (message) {\n\t\tplist_t dict = NULL;\n\t\tif (options) {\n\t\t\tdict = plist_copy(options);\n\t\t} else {\n\t\t\tdict = plist_new_dict();\n\t\t}\n\t\tplist_dict_set_item(dict, \"BackupMessageTypeKey\", plist_new_string(message));\n\n\t\t/* send it as DLMessageProcessMessage */\n\t\terr = mobilebackup_error(device_link_service_send_process_message(client->parent, dict));\n\t\tplist_free(dict);\n\t} else {\n\t\terr = mobilebackup_error(device_link_service_send_process_message(client->parent, options));\n\t}\n\tif (err != MOBILEBACKUP_E_SUCCESS) {\n\t\tdebug_info(\"ERROR: Could not send message '%s' (%d)!\", message, err);\n\t}\n\treturn err;\n}"
  },
  {
    "function_name": "mobilebackup_send",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/mobilebackup.c",
    "lines": "118-123",
    "snippet": "LIBIMOBILEDEVICE_API mobilebackup_error_t mobilebackup_send(mobilebackup_client_t client, plist_t plist)\n{\n\tif (!client || !plist)\n\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\treturn mobilebackup_error(device_link_service_send(client->parent, plist));\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"device_link_service.h\"",
      "#include \"mobilebackup.h\"",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <plist/plist.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "mobilebackup_error",
          "args": [
            "device_link_service_send(client->parent, plist)"
          ],
          "line": 122
        },
        "resolved": true,
        "details": {
          "function_name": "mobilebackup_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/mobilebackup.c",
          "lines": "44-61",
          "snippet": "static mobilebackup_error_t mobilebackup_error(device_link_service_error_t err)\n{\n\tswitch (err) {\n\t\tcase DEVICE_LINK_SERVICE_E_SUCCESS:\n\t\t\treturn MOBILEBACKUP_E_SUCCESS;\n\t\tcase DEVICE_LINK_SERVICE_E_INVALID_ARG:\n\t\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\t\tcase DEVICE_LINK_SERVICE_E_PLIST_ERROR:\n\t\t\treturn MOBILEBACKUP_E_PLIST_ERROR;\n\t\tcase DEVICE_LINK_SERVICE_E_MUX_ERROR:\n\t\t\treturn MOBILEBACKUP_E_MUX_ERROR;\n\t\tcase DEVICE_LINK_SERVICE_E_BAD_VERSION:\n\t\t\treturn MOBILEBACKUP_E_BAD_VERSION;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn MOBILEBACKUP_E_UNKNOWN_ERROR;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"device_link_service.h\"",
            "#include \"mobilebackup.h\"",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <plist/plist.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"device_link_service.h\"\n#include \"mobilebackup.h\"\n#include <stdlib.h>\n#include <string.h>\n#include <plist/plist.h>\n\nstatic mobilebackup_error_t mobilebackup_error(device_link_service_error_t err)\n{\n\tswitch (err) {\n\t\tcase DEVICE_LINK_SERVICE_E_SUCCESS:\n\t\t\treturn MOBILEBACKUP_E_SUCCESS;\n\t\tcase DEVICE_LINK_SERVICE_E_INVALID_ARG:\n\t\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\t\tcase DEVICE_LINK_SERVICE_E_PLIST_ERROR:\n\t\t\treturn MOBILEBACKUP_E_PLIST_ERROR;\n\t\tcase DEVICE_LINK_SERVICE_E_MUX_ERROR:\n\t\t\treturn MOBILEBACKUP_E_MUX_ERROR;\n\t\tcase DEVICE_LINK_SERVICE_E_BAD_VERSION:\n\t\t\treturn MOBILEBACKUP_E_BAD_VERSION;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn MOBILEBACKUP_E_UNKNOWN_ERROR;\n}"
        }
      },
      {
        "call_info": {
          "callee": "device_link_service_send",
          "args": [
            "client->parent",
            "plist"
          ],
          "line": 122
        },
        "resolved": true,
        "details": {
          "function_name": "device_link_service_send",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/device_link_service.c",
          "lines": "430-439",
          "snippet": "device_link_service_error_t device_link_service_send(device_link_service_client_t client, plist_t plist)\n{\n\tif (!client || !plist) {\n\t\treturn DEVICE_LINK_SERVICE_E_INVALID_ARG;\n\t}\n\tif (property_list_service_send_binary_plist(client->parent, plist) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\treturn DEVICE_LINK_SERVICE_E_MUX_ERROR;\n\t}\n\treturn DEVICE_LINK_SERVICE_E_SUCCESS;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include \"device_link_service.h\"",
            "#include <stdlib.h>",
            "#include <string.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"device_link_service.h\"\n#include <stdlib.h>\n#include <string.h>\n\ndevice_link_service_error_t device_link_service_send(device_link_service_client_t client, plist_t plist)\n{\n\tif (!client || !plist) {\n\t\treturn DEVICE_LINK_SERVICE_E_INVALID_ARG;\n\t}\n\tif (property_list_service_send_binary_plist(client->parent, plist) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\treturn DEVICE_LINK_SERVICE_E_MUX_ERROR;\n\t}\n\treturn DEVICE_LINK_SERVICE_E_SUCCESS;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"device_link_service.h\"\n#include \"mobilebackup.h\"\n#include <stdlib.h>\n#include <string.h>\n#include <plist/plist.h>\n\nLIBIMOBILEDEVICE_API mobilebackup_error_t mobilebackup_send(mobilebackup_client_t client, plist_t plist)\n{\n\tif (!client || !plist)\n\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\treturn mobilebackup_error(device_link_service_send(client->parent, plist));\n}"
  },
  {
    "function_name": "mobilebackup_receive",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/mobilebackup.c",
    "lines": "110-116",
    "snippet": "LIBIMOBILEDEVICE_API mobilebackup_error_t mobilebackup_receive(mobilebackup_client_t client, plist_t * plist)\n{\n\tif (!client)\n\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\tmobilebackup_error_t ret = mobilebackup_error(device_link_service_receive(client->parent, plist));\n\treturn ret;\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"device_link_service.h\"",
      "#include \"mobilebackup.h\"",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <plist/plist.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "mobilebackup_error",
          "args": [
            "device_link_service_receive(client->parent, plist)"
          ],
          "line": 114
        },
        "resolved": true,
        "details": {
          "function_name": "mobilebackup_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/mobilebackup.c",
          "lines": "44-61",
          "snippet": "static mobilebackup_error_t mobilebackup_error(device_link_service_error_t err)\n{\n\tswitch (err) {\n\t\tcase DEVICE_LINK_SERVICE_E_SUCCESS:\n\t\t\treturn MOBILEBACKUP_E_SUCCESS;\n\t\tcase DEVICE_LINK_SERVICE_E_INVALID_ARG:\n\t\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\t\tcase DEVICE_LINK_SERVICE_E_PLIST_ERROR:\n\t\t\treturn MOBILEBACKUP_E_PLIST_ERROR;\n\t\tcase DEVICE_LINK_SERVICE_E_MUX_ERROR:\n\t\t\treturn MOBILEBACKUP_E_MUX_ERROR;\n\t\tcase DEVICE_LINK_SERVICE_E_BAD_VERSION:\n\t\t\treturn MOBILEBACKUP_E_BAD_VERSION;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn MOBILEBACKUP_E_UNKNOWN_ERROR;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"device_link_service.h\"",
            "#include \"mobilebackup.h\"",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <plist/plist.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"device_link_service.h\"\n#include \"mobilebackup.h\"\n#include <stdlib.h>\n#include <string.h>\n#include <plist/plist.h>\n\nstatic mobilebackup_error_t mobilebackup_error(device_link_service_error_t err)\n{\n\tswitch (err) {\n\t\tcase DEVICE_LINK_SERVICE_E_SUCCESS:\n\t\t\treturn MOBILEBACKUP_E_SUCCESS;\n\t\tcase DEVICE_LINK_SERVICE_E_INVALID_ARG:\n\t\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\t\tcase DEVICE_LINK_SERVICE_E_PLIST_ERROR:\n\t\t\treturn MOBILEBACKUP_E_PLIST_ERROR;\n\t\tcase DEVICE_LINK_SERVICE_E_MUX_ERROR:\n\t\t\treturn MOBILEBACKUP_E_MUX_ERROR;\n\t\tcase DEVICE_LINK_SERVICE_E_BAD_VERSION:\n\t\t\treturn MOBILEBACKUP_E_BAD_VERSION;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn MOBILEBACKUP_E_UNKNOWN_ERROR;\n}"
        }
      },
      {
        "call_info": {
          "callee": "device_link_service_receive",
          "args": [
            "client->parent",
            "plist"
          ],
          "line": 114
        },
        "resolved": true,
        "details": {
          "function_name": "device_link_service_receive",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/device_link_service.c",
          "lines": "452-462",
          "snippet": "device_link_service_error_t device_link_service_receive(device_link_service_client_t client, plist_t *plist)\n{\n\tif (!client || !plist || (plist && *plist)) {\n\t\treturn DEVICE_LINK_SERVICE_E_INVALID_ARG;\n\t}\n\n\tif (property_list_service_receive_plist(client->parent, plist) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\treturn DEVICE_LINK_SERVICE_E_MUX_ERROR;\n\t}\n\treturn DEVICE_LINK_SERVICE_E_SUCCESS;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include \"device_link_service.h\"",
            "#include <stdlib.h>",
            "#include <string.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"device_link_service.h\"\n#include <stdlib.h>\n#include <string.h>\n\ndevice_link_service_error_t device_link_service_receive(device_link_service_client_t client, plist_t *plist)\n{\n\tif (!client || !plist || (plist && *plist)) {\n\t\treturn DEVICE_LINK_SERVICE_E_INVALID_ARG;\n\t}\n\n\tif (property_list_service_receive_plist(client->parent, plist) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\treturn DEVICE_LINK_SERVICE_E_MUX_ERROR;\n\t}\n\treturn DEVICE_LINK_SERVICE_E_SUCCESS;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"device_link_service.h\"\n#include \"mobilebackup.h\"\n#include <stdlib.h>\n#include <string.h>\n#include <plist/plist.h>\n\nLIBIMOBILEDEVICE_API mobilebackup_error_t mobilebackup_receive(mobilebackup_client_t client, plist_t * plist)\n{\n\tif (!client)\n\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\tmobilebackup_error_t ret = mobilebackup_error(device_link_service_receive(client->parent, plist));\n\treturn ret;\n}"
  },
  {
    "function_name": "mobilebackup_client_free",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/mobilebackup.c",
    "lines": "97-108",
    "snippet": "LIBIMOBILEDEVICE_API mobilebackup_error_t mobilebackup_client_free(mobilebackup_client_t client)\n{\n\tif (!client)\n\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\tmobilebackup_error_t err = MOBILEBACKUP_E_SUCCESS;\n\tif (client->parent) {\n\t\tdevice_link_service_disconnect(client->parent, NULL);\n\t\terr = mobilebackup_error(device_link_service_client_free(client->parent));\n\t}\n\tfree(client);\n\treturn err;\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"device_link_service.h\"",
      "#include \"mobilebackup.h\"",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <plist/plist.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "client"
          ],
          "line": 106
        },
        "resolved": true,
        "details": {
          "function_name": "mobilebackup_client_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/mobilebackup.c",
          "lines": "97-108",
          "snippet": "LIBIMOBILEDEVICE_API mobilebackup_error_t mobilebackup_client_free(mobilebackup_client_t client)\n{\n\tif (!client)\n\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\tmobilebackup_error_t err = MOBILEBACKUP_E_SUCCESS;\n\tif (client->parent) {\n\t\tdevice_link_service_disconnect(client->parent, NULL);\n\t\terr = mobilebackup_error(device_link_service_client_free(client->parent));\n\t}\n\tfree(client);\n\treturn err;\n}",
          "note": "cyclic_reference_detected"
        }
      },
      {
        "call_info": {
          "callee": "mobilebackup_error",
          "args": [
            "device_link_service_client_free(client->parent)"
          ],
          "line": 104
        },
        "resolved": true,
        "details": {
          "function_name": "mobilebackup_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/mobilebackup.c",
          "lines": "44-61",
          "snippet": "static mobilebackup_error_t mobilebackup_error(device_link_service_error_t err)\n{\n\tswitch (err) {\n\t\tcase DEVICE_LINK_SERVICE_E_SUCCESS:\n\t\t\treturn MOBILEBACKUP_E_SUCCESS;\n\t\tcase DEVICE_LINK_SERVICE_E_INVALID_ARG:\n\t\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\t\tcase DEVICE_LINK_SERVICE_E_PLIST_ERROR:\n\t\t\treturn MOBILEBACKUP_E_PLIST_ERROR;\n\t\tcase DEVICE_LINK_SERVICE_E_MUX_ERROR:\n\t\t\treturn MOBILEBACKUP_E_MUX_ERROR;\n\t\tcase DEVICE_LINK_SERVICE_E_BAD_VERSION:\n\t\t\treturn MOBILEBACKUP_E_BAD_VERSION;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn MOBILEBACKUP_E_UNKNOWN_ERROR;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"device_link_service.h\"",
            "#include \"mobilebackup.h\"",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <plist/plist.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"device_link_service.h\"\n#include \"mobilebackup.h\"\n#include <stdlib.h>\n#include <string.h>\n#include <plist/plist.h>\n\nstatic mobilebackup_error_t mobilebackup_error(device_link_service_error_t err)\n{\n\tswitch (err) {\n\t\tcase DEVICE_LINK_SERVICE_E_SUCCESS:\n\t\t\treturn MOBILEBACKUP_E_SUCCESS;\n\t\tcase DEVICE_LINK_SERVICE_E_INVALID_ARG:\n\t\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\t\tcase DEVICE_LINK_SERVICE_E_PLIST_ERROR:\n\t\t\treturn MOBILEBACKUP_E_PLIST_ERROR;\n\t\tcase DEVICE_LINK_SERVICE_E_MUX_ERROR:\n\t\t\treturn MOBILEBACKUP_E_MUX_ERROR;\n\t\tcase DEVICE_LINK_SERVICE_E_BAD_VERSION:\n\t\t\treturn MOBILEBACKUP_E_BAD_VERSION;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn MOBILEBACKUP_E_UNKNOWN_ERROR;\n}"
        }
      },
      {
        "call_info": {
          "callee": "device_link_service_client_free",
          "args": [
            "client->parent"
          ],
          "line": 104
        },
        "resolved": true,
        "details": {
          "function_name": "device_link_service_client_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/device_link_service.c",
          "lines": "119-129",
          "snippet": "device_link_service_error_t device_link_service_client_free(device_link_service_client_t client)\n{\n\tif (!client)\n\t\treturn DEVICE_LINK_SERVICE_E_INVALID_ARG;\n\n\tif (property_list_service_client_free(client->parent) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\treturn DEVICE_LINK_SERVICE_E_UNKNOWN_ERROR;\n\t}\n\tfree(client);\n\treturn DEVICE_LINK_SERVICE_E_SUCCESS;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include \"device_link_service.h\"",
            "#include <stdlib.h>",
            "#include <string.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"device_link_service.h\"\n#include <stdlib.h>\n#include <string.h>\n\ndevice_link_service_error_t device_link_service_client_free(device_link_service_client_t client)\n{\n\tif (!client)\n\t\treturn DEVICE_LINK_SERVICE_E_INVALID_ARG;\n\n\tif (property_list_service_client_free(client->parent) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\treturn DEVICE_LINK_SERVICE_E_UNKNOWN_ERROR;\n\t}\n\tfree(client);\n\treturn DEVICE_LINK_SERVICE_E_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "device_link_service_disconnect",
          "args": [
            "client->parent",
            "NULL"
          ],
          "line": 103
        },
        "resolved": true,
        "details": {
          "function_name": "device_link_service_disconnect",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/device_link_service.c",
          "lines": "249-267",
          "snippet": "device_link_service_error_t device_link_service_disconnect(device_link_service_client_t client, const char *message)\n{\n\tif (!client)\n\t\treturn DEVICE_LINK_SERVICE_E_INVALID_ARG;\n\n\tplist_t array = plist_new_array();\n\tplist_array_append_item(array, plist_new_string(\"DLMessageDisconnect\"));\n\tif (message)\n\t\tplist_array_append_item(array, plist_new_string(message));\n\telse\n\t\tplist_array_append_item(array, plist_new_string(\"___EmptyParameterString___\"));\n\n\tdevice_link_service_error_t err = DEVICE_LINK_SERVICE_E_SUCCESS;\n\tif (property_list_service_send_binary_plist(client->parent, array) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\terr = DEVICE_LINK_SERVICE_E_MUX_ERROR;\n\t}\n\tplist_free(array);\n\treturn err;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include \"device_link_service.h\"",
            "#include <stdlib.h>",
            "#include <string.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"device_link_service.h\"\n#include <stdlib.h>\n#include <string.h>\n\ndevice_link_service_error_t device_link_service_disconnect(device_link_service_client_t client, const char *message)\n{\n\tif (!client)\n\t\treturn DEVICE_LINK_SERVICE_E_INVALID_ARG;\n\n\tplist_t array = plist_new_array();\n\tplist_array_append_item(array, plist_new_string(\"DLMessageDisconnect\"));\n\tif (message)\n\t\tplist_array_append_item(array, plist_new_string(message));\n\telse\n\t\tplist_array_append_item(array, plist_new_string(\"___EmptyParameterString___\"));\n\n\tdevice_link_service_error_t err = DEVICE_LINK_SERVICE_E_SUCCESS;\n\tif (property_list_service_send_binary_plist(client->parent, array) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\terr = DEVICE_LINK_SERVICE_E_MUX_ERROR;\n\t}\n\tplist_free(array);\n\treturn err;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"device_link_service.h\"\n#include \"mobilebackup.h\"\n#include <stdlib.h>\n#include <string.h>\n#include <plist/plist.h>\n\nLIBIMOBILEDEVICE_API mobilebackup_error_t mobilebackup_client_free(mobilebackup_client_t client)\n{\n\tif (!client)\n\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\tmobilebackup_error_t err = MOBILEBACKUP_E_SUCCESS;\n\tif (client->parent) {\n\t\tdevice_link_service_disconnect(client->parent, NULL);\n\t\terr = mobilebackup_error(device_link_service_client_free(client->parent));\n\t}\n\tfree(client);\n\treturn err;\n}"
  },
  {
    "function_name": "mobilebackup_client_start_service",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/mobilebackup.c",
    "lines": "90-95",
    "snippet": "LIBIMOBILEDEVICE_API mobilebackup_error_t mobilebackup_client_start_service(idevice_t device, mobilebackup_client_t * client, const char* label)\n{\n\tmobilebackup_error_t err = MOBILEBACKUP_E_UNKNOWN_ERROR;\n\tservice_client_factory_start_service(device, MOBILEBACKUP_SERVICE_NAME, (void**)client, label, SERVICE_CONSTRUCTOR(mobilebackup_client_new), &err);\n\treturn err;\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"device_link_service.h\"",
      "#include \"mobilebackup.h\"",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <plist/plist.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "service_client_factory_start_service",
          "args": [
            "device",
            "MOBILEBACKUP_SERVICE_NAME",
            "(void**)client",
            "label",
            "SERVICE_CONSTRUCTOR(mobilebackup_client_new)",
            "&err"
          ],
          "line": 93
        },
        "resolved": true,
        "details": {
          "function_name": "service_client_factory_start_service",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/service.c",
          "lines": "79-116",
          "snippet": "LIBIMOBILEDEVICE_API service_error_t service_client_factory_start_service(idevice_t device, const char* service_name, void **client, const char* label, int32_t (*constructor_func)(idevice_t, lockdownd_service_descriptor_t, void**), int32_t *error_code)\n{\n\t*client = NULL;\n\n\tlockdownd_client_t lckd = NULL;\n\tif (LOCKDOWN_E_SUCCESS != lockdownd_client_new_with_handshake(device, &lckd, label)) {\n\t\tdebug_info(\"Could not create a lockdown client.\");\n\t\treturn SERVICE_E_START_SERVICE_ERROR;\n\t}\n\n\tlockdownd_service_descriptor_t service = NULL;\n\tlockdownd_start_service(lckd, service_name, &service);\n\tlockdownd_client_free(lckd);\n\n\tif (!service || service->port == 0) {\n\t\tdebug_info(\"Could not start service %s!\", service_name);\n\t\treturn SERVICE_E_START_SERVICE_ERROR;\n\t}\n\n\tint32_t ec;\n\tif (constructor_func) {\n\t\tec = (int32_t)constructor_func(device, service, client);\n\t} else {\n\t\tec = service_client_new(device, service, (service_client_t*)client);\n\t}\n\tif (error_code) {\n\t\t*error_code = ec;\n\t}\n\n\tif (ec != SERVICE_E_SUCCESS) {\n\t\tdebug_info(\"Could not connect to service %s! Port: %i, error: %i\", service_name, service->port, ec);\n\t}\n\n\tlockdownd_service_descriptor_free(service);\n\tservice = NULL;\n\n\treturn (ec == SERVICE_E_SUCCESS) ? SERVICE_E_SUCCESS : SERVICE_E_START_SERVICE_ERROR;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API service_error_t service_client_factory_start_service(idevice_t device, const char* service_name, void **client, const char* label, int32_t (*constructor_func)(idevice_t, lockdownd_service_descriptor_t, void**), int32_t *error_code)\n{\n\t*client = NULL;\n\n\tlockdownd_client_t lckd = NULL;\n\tif (LOCKDOWN_E_SUCCESS != lockdownd_client_new_with_handshake(device, &lckd, label)) {\n\t\tdebug_info(\"Could not create a lockdown client.\");\n\t\treturn SERVICE_E_START_SERVICE_ERROR;\n\t}\n\n\tlockdownd_service_descriptor_t service = NULL;\n\tlockdownd_start_service(lckd, service_name, &service);\n\tlockdownd_client_free(lckd);\n\n\tif (!service || service->port == 0) {\n\t\tdebug_info(\"Could not start service %s!\", service_name);\n\t\treturn SERVICE_E_START_SERVICE_ERROR;\n\t}\n\n\tint32_t ec;\n\tif (constructor_func) {\n\t\tec = (int32_t)constructor_func(device, service, client);\n\t} else {\n\t\tec = service_client_new(device, service, (service_client_t*)client);\n\t}\n\tif (error_code) {\n\t\t*error_code = ec;\n\t}\n\n\tif (ec != SERVICE_E_SUCCESS) {\n\t\tdebug_info(\"Could not connect to service %s! Port: %i, error: %i\", service_name, service->port, ec);\n\t}\n\n\tlockdownd_service_descriptor_free(service);\n\tservice = NULL;\n\n\treturn (ec == SERVICE_E_SUCCESS) ? SERVICE_E_SUCCESS : SERVICE_E_START_SERVICE_ERROR;\n}"
        }
      },
      {
        "call_info": {
          "callee": "SERVICE_CONSTRUCTOR",
          "args": [
            "mobilebackup_client_new"
          ],
          "line": 93
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"device_link_service.h\"\n#include \"mobilebackup.h\"\n#include <stdlib.h>\n#include <string.h>\n#include <plist/plist.h>\n\nLIBIMOBILEDEVICE_API mobilebackup_error_t mobilebackup_client_start_service(idevice_t device, mobilebackup_client_t * client, const char* label)\n{\n\tmobilebackup_error_t err = MOBILEBACKUP_E_UNKNOWN_ERROR;\n\tservice_client_factory_start_service(device, MOBILEBACKUP_SERVICE_NAME, (void**)client, label, SERVICE_CONSTRUCTOR(mobilebackup_client_new), &err);\n\treturn err;\n}"
  },
  {
    "function_name": "mobilebackup_client_new",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/mobilebackup.c",
    "lines": "63-88",
    "snippet": "LIBIMOBILEDEVICE_API mobilebackup_error_t mobilebackup_client_new(idevice_t device, lockdownd_service_descriptor_t service, mobilebackup_client_t * client)\n{\n\tif (!device || !service || service->port == 0 || !client || *client)\n\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\n\tdevice_link_service_client_t dlclient = NULL;\n\tmobilebackup_error_t ret = mobilebackup_error(device_link_service_client_new(device, service, &dlclient));\n\tif (ret != MOBILEBACKUP_E_SUCCESS) {\n\t\treturn ret;\n\t}\n\n\tmobilebackup_client_t client_loc = (mobilebackup_client_t) malloc(sizeof(struct mobilebackup_client_private));\n\tclient_loc->parent = dlclient;\n\n\t/* perform handshake */\n\tret = mobilebackup_error(device_link_service_version_exchange(dlclient, MBACKUP_VERSION_INT1, MBACKUP_VERSION_INT2));\n\tif (ret != MOBILEBACKUP_E_SUCCESS) {\n\t\tdebug_info(\"version exchange failed, error %d\", ret);\n\t\tmobilebackup_client_free(client_loc);\n\t\treturn ret;\n\t}\n\n\t*client = client_loc;\n\n\treturn ret;\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"device_link_service.h\"",
      "#include \"mobilebackup.h\"",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <plist/plist.h>"
    ],
    "macros_used": [
      "#define MBACKUP_VERSION_INT2 0",
      "#define MBACKUP_VERSION_INT1 100"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "mobilebackup_client_free",
          "args": [
            "client_loc"
          ],
          "line": 81
        },
        "resolved": true,
        "details": {
          "function_name": "mobilebackup_client_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/mobilebackup.c",
          "lines": "97-108",
          "snippet": "LIBIMOBILEDEVICE_API mobilebackup_error_t mobilebackup_client_free(mobilebackup_client_t client)\n{\n\tif (!client)\n\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\tmobilebackup_error_t err = MOBILEBACKUP_E_SUCCESS;\n\tif (client->parent) {\n\t\tdevice_link_service_disconnect(client->parent, NULL);\n\t\terr = mobilebackup_error(device_link_service_client_free(client->parent));\n\t}\n\tfree(client);\n\treturn err;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"device_link_service.h\"",
            "#include \"mobilebackup.h\"",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <plist/plist.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"device_link_service.h\"\n#include \"mobilebackup.h\"\n#include <stdlib.h>\n#include <string.h>\n#include <plist/plist.h>\n\nLIBIMOBILEDEVICE_API mobilebackup_error_t mobilebackup_client_free(mobilebackup_client_t client)\n{\n\tif (!client)\n\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\tmobilebackup_error_t err = MOBILEBACKUP_E_SUCCESS;\n\tif (client->parent) {\n\t\tdevice_link_service_disconnect(client->parent, NULL);\n\t\terr = mobilebackup_error(device_link_service_client_free(client->parent));\n\t}\n\tfree(client);\n\treturn err;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"version exchange failed, error %d\"",
            "ret"
          ],
          "line": 80
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mobilebackup_error",
          "args": [
            "device_link_service_version_exchange(dlclient, MBACKUP_VERSION_INT1, MBACKUP_VERSION_INT2)"
          ],
          "line": 78
        },
        "resolved": true,
        "details": {
          "function_name": "mobilebackup_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/mobilebackup.c",
          "lines": "44-61",
          "snippet": "static mobilebackup_error_t mobilebackup_error(device_link_service_error_t err)\n{\n\tswitch (err) {\n\t\tcase DEVICE_LINK_SERVICE_E_SUCCESS:\n\t\t\treturn MOBILEBACKUP_E_SUCCESS;\n\t\tcase DEVICE_LINK_SERVICE_E_INVALID_ARG:\n\t\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\t\tcase DEVICE_LINK_SERVICE_E_PLIST_ERROR:\n\t\t\treturn MOBILEBACKUP_E_PLIST_ERROR;\n\t\tcase DEVICE_LINK_SERVICE_E_MUX_ERROR:\n\t\t\treturn MOBILEBACKUP_E_MUX_ERROR;\n\t\tcase DEVICE_LINK_SERVICE_E_BAD_VERSION:\n\t\t\treturn MOBILEBACKUP_E_BAD_VERSION;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn MOBILEBACKUP_E_UNKNOWN_ERROR;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"device_link_service.h\"",
            "#include \"mobilebackup.h\"",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <plist/plist.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"device_link_service.h\"\n#include \"mobilebackup.h\"\n#include <stdlib.h>\n#include <string.h>\n#include <plist/plist.h>\n\nstatic mobilebackup_error_t mobilebackup_error(device_link_service_error_t err)\n{\n\tswitch (err) {\n\t\tcase DEVICE_LINK_SERVICE_E_SUCCESS:\n\t\t\treturn MOBILEBACKUP_E_SUCCESS;\n\t\tcase DEVICE_LINK_SERVICE_E_INVALID_ARG:\n\t\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\t\tcase DEVICE_LINK_SERVICE_E_PLIST_ERROR:\n\t\t\treturn MOBILEBACKUP_E_PLIST_ERROR;\n\t\tcase DEVICE_LINK_SERVICE_E_MUX_ERROR:\n\t\t\treturn MOBILEBACKUP_E_MUX_ERROR;\n\t\tcase DEVICE_LINK_SERVICE_E_BAD_VERSION:\n\t\t\treturn MOBILEBACKUP_E_BAD_VERSION;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn MOBILEBACKUP_E_UNKNOWN_ERROR;\n}"
        }
      },
      {
        "call_info": {
          "callee": "device_link_service_version_exchange",
          "args": [
            "dlclient",
            "MBACKUP_VERSION_INT1",
            "MBACKUP_VERSION_INT2"
          ],
          "line": 78
        },
        "resolved": true,
        "details": {
          "function_name": "device_link_service_version_exchange",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/device_link_service.c",
          "lines": "148-236",
          "snippet": "device_link_service_error_t device_link_service_version_exchange(device_link_service_client_t client, uint64_t version_major, uint64_t version_minor)\n{\n\tif (!client)\n\t\treturn DEVICE_LINK_SERVICE_E_INVALID_ARG;\n\n\tdevice_link_service_error_t err = DEVICE_LINK_SERVICE_E_UNKNOWN_ERROR;\n\n\t/* perform version exchange */\n\tplist_t array = NULL;\n\tchar *msg = NULL;\n\n\t/* receive DLMessageVersionExchange from device */\n\tif (property_list_service_receive_plist(client->parent, &array) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tdebug_info(\"Did not receive initial message from device!\");\n\t\terr = DEVICE_LINK_SERVICE_E_MUX_ERROR;\n\t\tgoto leave;\n\t}\n\tdevice_link_service_get_message(array, &msg);\n\tif (!msg || strcmp(msg, \"DLMessageVersionExchange\")) {\n\t\tdebug_info(\"Did not receive DLMessageVersionExchange from device!\");\n\t\terr = DEVICE_LINK_SERVICE_E_PLIST_ERROR;\n\t\tgoto leave;\n\t}\n\tfree(msg);\n\tmsg = NULL;\n\n\t/* get major and minor version number */\n\tif (plist_array_get_size(array) < 3) {\n\t\tdebug_info(\"DLMessageVersionExchange has unexpected format!\");\n\t\terr = DEVICE_LINK_SERVICE_E_PLIST_ERROR;\n\t\tgoto leave;\n\t}\n\tplist_t maj = plist_array_get_item(array, 1);\n\tplist_t min = plist_array_get_item(array, 2);\n\tuint64_t vmajor = 0;\n\tuint64_t vminor = 0;\n\tif (maj) {\n\t\tplist_get_uint_val(maj, &vmajor);\n\t}\n\tif (min) {\n\t\tplist_get_uint_val(min, &vminor);\n\t}\n\tif (vmajor > version_major) {\n\t\tdebug_info(\"Version mismatch: device=(%lld,%lld) > expected=(%lld,%lld)\", vmajor, vminor, version_major, version_minor);\n\t\terr = DEVICE_LINK_SERVICE_E_BAD_VERSION;\n\t\tgoto leave;\n\t} else if ((vmajor == version_major) && (vminor > version_minor)) {\n\t\tdebug_info(\"WARNING: Version mismatch: device=(%lld,%lld) > expected=(%lld,%lld)\", vmajor, vminor, version_major, version_minor);\n\t\terr = DEVICE_LINK_SERVICE_E_BAD_VERSION;\n\t\tgoto leave;\n\t}\n\tplist_free(array);\n\n\t/* version is ok, send reply */\n\tarray = plist_new_array();\n\tplist_array_append_item(array, plist_new_string(\"DLMessageVersionExchange\"));\n\tplist_array_append_item(array, plist_new_string(\"DLVersionsOk\"));\n\tplist_array_append_item(array, plist_new_uint(version_major));\n\tif (property_list_service_send_binary_plist(client->parent, array) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tdebug_info(\"Error when sending DLVersionsOk\");\n\t\terr = DEVICE_LINK_SERVICE_E_MUX_ERROR;\n\t\tgoto leave;\n\t}\n\tplist_free(array);\n\n\t/* receive DeviceReady message */\n\tarray = NULL;\n\tif (property_list_service_receive_plist(client->parent, &array) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tdebug_info(\"Error when receiving DLMessageDeviceReady!\");\n\t\terr = DEVICE_LINK_SERVICE_E_MUX_ERROR;\n\t\tgoto leave;\n\t}\n\tdevice_link_service_get_message(array, &msg);\n\tif (!msg || strcmp(msg, \"DLMessageDeviceReady\")) {\n\t\tdebug_info(\"Did not get DLMessageDeviceReady!\");\n\t\terr = DEVICE_LINK_SERVICE_E_PLIST_ERROR;\n\t\tgoto leave;\n\t}\n\terr = DEVICE_LINK_SERVICE_E_SUCCESS;\n\nleave:\n\tif (msg) {\n\t\tfree(msg);\n\t}\n\tif (array) {\n\t\tplist_free(array);\n\t}\n\treturn err;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include \"device_link_service.h\"",
            "#include <stdlib.h>",
            "#include <string.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"device_link_service.h\"\n#include <stdlib.h>\n#include <string.h>\n\ndevice_link_service_error_t device_link_service_version_exchange(device_link_service_client_t client, uint64_t version_major, uint64_t version_minor)\n{\n\tif (!client)\n\t\treturn DEVICE_LINK_SERVICE_E_INVALID_ARG;\n\n\tdevice_link_service_error_t err = DEVICE_LINK_SERVICE_E_UNKNOWN_ERROR;\n\n\t/* perform version exchange */\n\tplist_t array = NULL;\n\tchar *msg = NULL;\n\n\t/* receive DLMessageVersionExchange from device */\n\tif (property_list_service_receive_plist(client->parent, &array) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tdebug_info(\"Did not receive initial message from device!\");\n\t\terr = DEVICE_LINK_SERVICE_E_MUX_ERROR;\n\t\tgoto leave;\n\t}\n\tdevice_link_service_get_message(array, &msg);\n\tif (!msg || strcmp(msg, \"DLMessageVersionExchange\")) {\n\t\tdebug_info(\"Did not receive DLMessageVersionExchange from device!\");\n\t\terr = DEVICE_LINK_SERVICE_E_PLIST_ERROR;\n\t\tgoto leave;\n\t}\n\tfree(msg);\n\tmsg = NULL;\n\n\t/* get major and minor version number */\n\tif (plist_array_get_size(array) < 3) {\n\t\tdebug_info(\"DLMessageVersionExchange has unexpected format!\");\n\t\terr = DEVICE_LINK_SERVICE_E_PLIST_ERROR;\n\t\tgoto leave;\n\t}\n\tplist_t maj = plist_array_get_item(array, 1);\n\tplist_t min = plist_array_get_item(array, 2);\n\tuint64_t vmajor = 0;\n\tuint64_t vminor = 0;\n\tif (maj) {\n\t\tplist_get_uint_val(maj, &vmajor);\n\t}\n\tif (min) {\n\t\tplist_get_uint_val(min, &vminor);\n\t}\n\tif (vmajor > version_major) {\n\t\tdebug_info(\"Version mismatch: device=(%lld,%lld) > expected=(%lld,%lld)\", vmajor, vminor, version_major, version_minor);\n\t\terr = DEVICE_LINK_SERVICE_E_BAD_VERSION;\n\t\tgoto leave;\n\t} else if ((vmajor == version_major) && (vminor > version_minor)) {\n\t\tdebug_info(\"WARNING: Version mismatch: device=(%lld,%lld) > expected=(%lld,%lld)\", vmajor, vminor, version_major, version_minor);\n\t\terr = DEVICE_LINK_SERVICE_E_BAD_VERSION;\n\t\tgoto leave;\n\t}\n\tplist_free(array);\n\n\t/* version is ok, send reply */\n\tarray = plist_new_array();\n\tplist_array_append_item(array, plist_new_string(\"DLMessageVersionExchange\"));\n\tplist_array_append_item(array, plist_new_string(\"DLVersionsOk\"));\n\tplist_array_append_item(array, plist_new_uint(version_major));\n\tif (property_list_service_send_binary_plist(client->parent, array) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tdebug_info(\"Error when sending DLVersionsOk\");\n\t\terr = DEVICE_LINK_SERVICE_E_MUX_ERROR;\n\t\tgoto leave;\n\t}\n\tplist_free(array);\n\n\t/* receive DeviceReady message */\n\tarray = NULL;\n\tif (property_list_service_receive_plist(client->parent, &array) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tdebug_info(\"Error when receiving DLMessageDeviceReady!\");\n\t\terr = DEVICE_LINK_SERVICE_E_MUX_ERROR;\n\t\tgoto leave;\n\t}\n\tdevice_link_service_get_message(array, &msg);\n\tif (!msg || strcmp(msg, \"DLMessageDeviceReady\")) {\n\t\tdebug_info(\"Did not get DLMessageDeviceReady!\");\n\t\terr = DEVICE_LINK_SERVICE_E_PLIST_ERROR;\n\t\tgoto leave;\n\t}\n\terr = DEVICE_LINK_SERVICE_E_SUCCESS;\n\nleave:\n\tif (msg) {\n\t\tfree(msg);\n\t}\n\tif (array) {\n\t\tplist_free(array);\n\t}\n\treturn err;\n}"
        }
      },
      {
        "call_info": {
          "callee": "malloc",
          "args": [
            "sizeof(struct mobilebackup_client_private)"
          ],
          "line": 74
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device_link_service_client_new",
          "args": [
            "device",
            "service",
            "&dlclient"
          ],
          "line": 69
        },
        "resolved": true,
        "details": {
          "function_name": "device_link_service_client_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/device_link_service.c",
          "lines": "85-107",
          "snippet": "device_link_service_error_t device_link_service_client_new(idevice_t device, lockdownd_service_descriptor_t service, device_link_service_client_t *client)\n{\n\tif (!device || !service || service->port == 0 || !client || *client) {\n\t\treturn DEVICE_LINK_SERVICE_E_INVALID_ARG;\n\t}\n\n\tproperty_list_service_client_t plistclient = NULL;\n\tif (property_list_service_client_new(device, service, &plistclient) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\treturn DEVICE_LINK_SERVICE_E_MUX_ERROR;\n\t}\n\n\t/* create client object */\n\tdevice_link_service_client_t client_loc = (device_link_service_client_t) malloc(sizeof(struct device_link_service_client_private));\n\tclient_loc->parent = plistclient;\n\n\t/* enable SSL if requested */\n\tif (service->ssl_enabled)\n\t\tproperty_list_service_enable_ssl(client_loc->parent);\n\n\t/* all done, return success */\n\t*client = client_loc;\n\treturn DEVICE_LINK_SERVICE_E_SUCCESS;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include \"device_link_service.h\"",
            "#include <stdlib.h>",
            "#include <string.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"device_link_service.h\"\n#include <stdlib.h>\n#include <string.h>\n\ndevice_link_service_error_t device_link_service_client_new(idevice_t device, lockdownd_service_descriptor_t service, device_link_service_client_t *client)\n{\n\tif (!device || !service || service->port == 0 || !client || *client) {\n\t\treturn DEVICE_LINK_SERVICE_E_INVALID_ARG;\n\t}\n\n\tproperty_list_service_client_t plistclient = NULL;\n\tif (property_list_service_client_new(device, service, &plistclient) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\treturn DEVICE_LINK_SERVICE_E_MUX_ERROR;\n\t}\n\n\t/* create client object */\n\tdevice_link_service_client_t client_loc = (device_link_service_client_t) malloc(sizeof(struct device_link_service_client_private));\n\tclient_loc->parent = plistclient;\n\n\t/* enable SSL if requested */\n\tif (service->ssl_enabled)\n\t\tproperty_list_service_enable_ssl(client_loc->parent);\n\n\t/* all done, return success */\n\t*client = client_loc;\n\treturn DEVICE_LINK_SERVICE_E_SUCCESS;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"device_link_service.h\"\n#include \"mobilebackup.h\"\n#include <stdlib.h>\n#include <string.h>\n#include <plist/plist.h>\n\n#define MBACKUP_VERSION_INT2 0\n#define MBACKUP_VERSION_INT1 100\n\nLIBIMOBILEDEVICE_API mobilebackup_error_t mobilebackup_client_new(idevice_t device, lockdownd_service_descriptor_t service, mobilebackup_client_t * client)\n{\n\tif (!device || !service || service->port == 0 || !client || *client)\n\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\n\tdevice_link_service_client_t dlclient = NULL;\n\tmobilebackup_error_t ret = mobilebackup_error(device_link_service_client_new(device, service, &dlclient));\n\tif (ret != MOBILEBACKUP_E_SUCCESS) {\n\t\treturn ret;\n\t}\n\n\tmobilebackup_client_t client_loc = (mobilebackup_client_t) malloc(sizeof(struct mobilebackup_client_private));\n\tclient_loc->parent = dlclient;\n\n\t/* perform handshake */\n\tret = mobilebackup_error(device_link_service_version_exchange(dlclient, MBACKUP_VERSION_INT1, MBACKUP_VERSION_INT2));\n\tif (ret != MOBILEBACKUP_E_SUCCESS) {\n\t\tdebug_info(\"version exchange failed, error %d\", ret);\n\t\tmobilebackup_client_free(client_loc);\n\t\treturn ret;\n\t}\n\n\t*client = client_loc;\n\n\treturn ret;\n}"
  },
  {
    "function_name": "mobilebackup_error",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/mobilebackup.c",
    "lines": "44-61",
    "snippet": "static mobilebackup_error_t mobilebackup_error(device_link_service_error_t err)\n{\n\tswitch (err) {\n\t\tcase DEVICE_LINK_SERVICE_E_SUCCESS:\n\t\t\treturn MOBILEBACKUP_E_SUCCESS;\n\t\tcase DEVICE_LINK_SERVICE_E_INVALID_ARG:\n\t\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\t\tcase DEVICE_LINK_SERVICE_E_PLIST_ERROR:\n\t\t\treturn MOBILEBACKUP_E_PLIST_ERROR;\n\t\tcase DEVICE_LINK_SERVICE_E_MUX_ERROR:\n\t\t\treturn MOBILEBACKUP_E_MUX_ERROR;\n\t\tcase DEVICE_LINK_SERVICE_E_BAD_VERSION:\n\t\t\treturn MOBILEBACKUP_E_BAD_VERSION;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn MOBILEBACKUP_E_UNKNOWN_ERROR;\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"device_link_service.h\"",
      "#include \"mobilebackup.h\"",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <plist/plist.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"device_link_service.h\"\n#include \"mobilebackup.h\"\n#include <stdlib.h>\n#include <string.h>\n#include <plist/plist.h>\n\nstatic mobilebackup_error_t mobilebackup_error(device_link_service_error_t err)\n{\n\tswitch (err) {\n\t\tcase DEVICE_LINK_SERVICE_E_SUCCESS:\n\t\t\treturn MOBILEBACKUP_E_SUCCESS;\n\t\tcase DEVICE_LINK_SERVICE_E_INVALID_ARG:\n\t\t\treturn MOBILEBACKUP_E_INVALID_ARG;\n\t\tcase DEVICE_LINK_SERVICE_E_PLIST_ERROR:\n\t\t\treturn MOBILEBACKUP_E_PLIST_ERROR;\n\t\tcase DEVICE_LINK_SERVICE_E_MUX_ERROR:\n\t\t\treturn MOBILEBACKUP_E_MUX_ERROR;\n\t\tcase DEVICE_LINK_SERVICE_E_BAD_VERSION:\n\t\t\treturn MOBILEBACKUP_E_BAD_VERSION;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn MOBILEBACKUP_E_UNKNOWN_ERROR;\n}"
  }
]