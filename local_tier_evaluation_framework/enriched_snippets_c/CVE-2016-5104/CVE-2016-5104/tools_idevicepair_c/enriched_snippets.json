[
  {
    "function_name": "main",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/tools/idevicepair.c",
    "lines": "119-294",
    "snippet": "int main(int argc, char **argv)\n{\n\tlockdownd_client_t client = NULL;\n\tidevice_t device = NULL;\n\tidevice_error_t ret = IDEVICE_E_UNKNOWN_ERROR;\n\tlockdownd_error_t lerr;\n\tint result;\n\n\tchar *type = NULL;\n\tchar *cmd;\n\ttypedef enum {\n\t\tOP_NONE = 0, OP_PAIR, OP_VALIDATE, OP_UNPAIR, OP_LIST, OP_HOSTID, OP_SYSTEMBUID\n\t} op_t;\n\top_t op = OP_NONE;\n\n\tparse_opts(argc, argv);\n\n\tif ((argc - optind) < 1) {\n\t\tprintf(\"ERROR: You need to specify a COMMAND!\\n\");\n\t\tprint_usage(argc, argv);\n\t\texit(EXIT_FAILURE);\n\t}\n\n\tcmd = (argv+optind)[0];\n\n\tif (!strcmp(cmd, \"pair\")) {\n\t\top = OP_PAIR;\n\t} else if (!strcmp(cmd, \"validate\")) {\n\t\top = OP_VALIDATE;\n\t} else if (!strcmp(cmd, \"unpair\")) {\n\t\top = OP_UNPAIR;\n\t} else if (!strcmp(cmd, \"list\")) {\n\t\top = OP_LIST;\n\t} else if (!strcmp(cmd, \"hostid\")) {\n\t\top = OP_HOSTID;\n\t} else if (!strcmp(cmd, \"systembuid\")) {\n\t\top = OP_SYSTEMBUID;\n\t} else {\n\t\tprintf(\"ERROR: Invalid command '%s' specified\\n\", cmd);\n\t\tprint_usage(argc, argv);\n\t\texit(EXIT_FAILURE);\n\t}\n\n\tif (op == OP_SYSTEMBUID) {\n\t\tchar *systembuid = NULL;\n\t\tuserpref_read_system_buid(&systembuid);\n\n\t\tprintf(\"%s\\n\", systembuid);\n\n\t\tif (systembuid)\n\t\t\tfree(systembuid);\n\n\t\treturn EXIT_SUCCESS;\n\t}\n\n\tif (op == OP_LIST) {\n\t\tunsigned int i;\n\t\tchar **udids = NULL;\n\t\tunsigned int count = 0;\n\t\tuserpref_get_paired_udids(&udids, &count);\n\t\tfor (i = 0; i < count; i++) {\n\t\t\tprintf(\"%s\\n\", udids[i]);\n\t\t\tfree(udids[i]);\n\t\t}\n\t\tif (udids)\n\t\t\tfree(udids);\n\t\tif (udid)\n\t\t\tfree(udid);\n\t\treturn EXIT_SUCCESS;\n\t}\n\n\tif (udid) {\n\t\tret = idevice_new(&device, udid);\n\t\tfree(udid);\n\t\tudid = NULL;\n\t\tif (ret != IDEVICE_E_SUCCESS) {\n\t\t\tprintf(\"No device found with udid %s, is it plugged in?\\n\", udid);\n\t\t\treturn EXIT_FAILURE;\n\t\t}\n\t} else {\n\t\tret = idevice_new(&device, NULL);\n\t\tif (ret != IDEVICE_E_SUCCESS) {\n\t\t\tprintf(\"No device found, is it plugged in?\\n\");\n\t\t\treturn EXIT_FAILURE;\n\t\t}\n\t}\n\n\tret = idevice_get_udid(device, &udid);\n\tif (ret != IDEVICE_E_SUCCESS) {\n\t\tprintf(\"ERROR: Could not get device udid, error code %d\\n\", ret);\n\t\tresult = EXIT_FAILURE;\n\t\tgoto leave;\n\t}\n\n\tif (op == OP_HOSTID) {\n\t\tplist_t pair_record = NULL;\n\t\tchar *hostid = NULL;\n\n\t\tuserpref_read_pair_record(udid, &pair_record);\n\t\tpair_record_get_host_id(pair_record, &hostid);\n\n\t\tprintf(\"%s\\n\", hostid);\n\n\t\tif (hostid)\n\t\t\tfree(hostid);\n\n\t\tif (pair_record)\n\t\t\tplist_free(pair_record);\n\n\t\treturn EXIT_SUCCESS;\n\t}\n\n\tlerr = lockdownd_client_new(device, &client, \"idevicepair\");\n\tif (lerr != LOCKDOWN_E_SUCCESS) {\n\t\tidevice_free(device);\n\t\tprintf(\"ERROR: Could not connect to lockdownd, error code %d\\n\", lerr);\n\t\treturn EXIT_FAILURE;\n\t}\n\n\tresult = EXIT_SUCCESS;\n\n\tlerr = lockdownd_query_type(client, &type);\n\tif (lerr != LOCKDOWN_E_SUCCESS) {\n\t\tprintf(\"QueryType failed, error code %d\\n\", lerr);\n\t\tresult = EXIT_FAILURE;\n\t\tgoto leave;\n\t} else {\n\t\tif (strcmp(\"com.apple.mobile.lockdown\", type)) {\n\t\t\tprintf(\"WARNING: QueryType request returned '%s'\\n\", type);\n\t\t}\n\t\tif (type) {\n\t\t\tfree(type);\n\t\t}\n\t}\n\n\tswitch(op) {\n\t\tdefault:\n\t\tcase OP_PAIR:\n\t\tlerr = lockdownd_pair(client, NULL);\n\t\tif (lerr == LOCKDOWN_E_SUCCESS) {\n\t\t\tprintf(\"SUCCESS: Paired with device %s\\n\", udid);\n\t\t} else {\n\t\t\tresult = EXIT_FAILURE;\n\t\t\tprint_error_message(lerr);\n\t\t}\n\t\tbreak;\n\n\t\tcase OP_VALIDATE:\n\t\tlerr = lockdownd_validate_pair(client, NULL);\n\t\tif (lerr == LOCKDOWN_E_SUCCESS) {\n\t\t\tprintf(\"SUCCESS: Validated pairing with device %s\\n\", udid);\n\t\t} else {\n\t\t\tresult = EXIT_FAILURE;\n\t\t\tprint_error_message(lerr);\n\t\t}\n\t\tbreak;\n\n\t\tcase OP_UNPAIR:\n\t\tlerr = lockdownd_unpair(client, NULL);\n\t\tif (lerr == LOCKDOWN_E_SUCCESS) {\n\t\t\tprintf(\"SUCCESS: Unpaired with device %s\\n\", udid);\n\t\t} else {\n\t\t\tresult = EXIT_FAILURE;\n\t\t\tprint_error_message(lerr);\n\t\t}\n\t\tbreak;\n\t}\n\nleave:\n\tlockdownd_client_free(client);\n\tidevice_free(device);\n\tif (udid) {\n\t\tfree(udid);\n\t}\n\treturn result;\n}",
    "includes": [
      "#include <libimobiledevice/lockdown.h>",
      "#include <libimobiledevice/libimobiledevice.h>",
      "#include \"common/userpref.h\"",
      "#include <getopt.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static char *udid = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "udid"
          ],
          "line": 291
        },
        "resolved": true,
        "details": {
          "function_name": "thread_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/common/thread.c",
          "lines": "39-44",
          "snippet": "void thread_free(thread_t thread)\n{\n#ifdef WIN32\n\tCloseHandle(thread);\n#endif\n}",
          "includes": [
            "#include \"thread.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"thread.h\"\n\nvoid thread_free(thread_t thread)\n{\n#ifdef WIN32\n\tCloseHandle(thread);\n#endif\n}"
        }
      },
      {
        "call_info": {
          "callee": "idevice_free",
          "args": [
            "device"
          ],
          "line": 289
        },
        "resolved": true,
        "details": {
          "function_name": "idevice_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/idevice.c",
          "lines": "247-265",
          "snippet": "LIBIMOBILEDEVICE_API idevice_error_t idevice_free(idevice_t device)\n{\n\tif (!device)\n\t\treturn IDEVICE_E_INVALID_ARG;\n\tidevice_error_t ret = IDEVICE_E_UNKNOWN_ERROR;\n\n\tret = IDEVICE_E_SUCCESS;\n\n\tfree(device->udid);\n\n\tif (device->conn_type == CONNECTION_USBMUXD) {\n\t\tdevice->conn_data = 0;\n\t}\n\tif (device->conn_data) {\n\t\tfree(device->conn_data);\n\t}\n\tfree(device);\n\treturn ret;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"common/thread.h\"",
            "#include \"common/userpref.h\"",
            "#include \"idevice.h\"",
            "#include <gnutls/gnutls.h>",
            "#include <openssl/ssl.h>",
            "#include <openssl/err.h>",
            "#include <usbmuxd.h>",
            "#include <windows.h>",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "LIBIMOBILEDEVICE_API idevice_error_t"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"common/thread.h\"\n#include \"common/userpref.h\"\n#include \"idevice.h\"\n#include <gnutls/gnutls.h>\n#include <openssl/ssl.h>\n#include <openssl/err.h>\n#include <usbmuxd.h>\n#include <windows.h>\n#include <errno.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API idevice_error_t;\n\nLIBIMOBILEDEVICE_API idevice_error_t idevice_free(idevice_t device)\n{\n\tif (!device)\n\t\treturn IDEVICE_E_INVALID_ARG;\n\tidevice_error_t ret = IDEVICE_E_UNKNOWN_ERROR;\n\n\tret = IDEVICE_E_SUCCESS;\n\n\tfree(device->udid);\n\n\tif (device->conn_type == CONNECTION_USBMUXD) {\n\t\tdevice->conn_data = 0;\n\t}\n\tif (device->conn_data) {\n\t\tfree(device->conn_data);\n\t}\n\tfree(device);\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lockdownd_client_free",
          "args": [
            "client"
          ],
          "line": 288
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_client_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "322-336",
          "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_client_free(lockdownd_client_t client)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tif (client->session_id) {\n\t\tlockdownd_stop_session(client, client->session_id);\n\t}\n\n\tret = lockdownd_client_free_simple(client);\n\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_client_free(lockdownd_client_t client)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tif (client->session_id) {\n\t\tlockdownd_stop_session(client, client->session_id);\n\t}\n\n\tret = lockdownd_client_free_simple(client);\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "print_error_message",
          "args": [
            "lerr"
          ],
          "line": 282
        },
        "resolved": true,
        "details": {
          "function_name": "print_error_message",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/tools/idevicepair.c",
          "lines": "38-57",
          "snippet": "static void print_error_message(lockdownd_error_t err)\n{\n\tswitch (err) {\n\t\tcase LOCKDOWN_E_PASSWORD_PROTECTED:\n\t\t\tprintf(\"ERROR: Could not validate with device %s because a passcode is set. Please enter the passcode on the device and retry.\\n\", udid);\n\t\t\tbreak;\n\t\tcase LOCKDOWN_E_INVALID_HOST_ID:\n\t\t\tprintf(\"ERROR: Device %s is not paired with this host\\n\", udid);\n\t\t\tbreak;\n\t\tcase LOCKDOWN_E_PAIRING_DIALOG_RESPONSE_PENDING:\n\t\t\tprintf(\"ERROR: Please accept the trust dialog on the screen of device %s, then attempt to pair again.\\n\", udid);\n\t\t\tbreak;\n\t\tcase LOCKDOWN_E_USER_DENIED_PAIRING:\n\t\t\tprintf(\"ERROR: Device %s said that the user denied the trust dialog.\\n\", udid);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tprintf(\"ERROR: Device %s returned unhandled error code %d\\n\", udid, err);\n\t\t\tbreak;\n\t}\n}",
          "includes": [
            "#include <libimobiledevice/lockdown.h>",
            "#include <libimobiledevice/libimobiledevice.h>",
            "#include \"common/userpref.h\"",
            "#include <getopt.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static char *udid = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <libimobiledevice/lockdown.h>\n#include <libimobiledevice/libimobiledevice.h>\n#include \"common/userpref.h\"\n#include <getopt.h>\n#include <stdlib.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic char *udid = NULL;\n\nstatic void print_error_message(lockdownd_error_t err)\n{\n\tswitch (err) {\n\t\tcase LOCKDOWN_E_PASSWORD_PROTECTED:\n\t\t\tprintf(\"ERROR: Could not validate with device %s because a passcode is set. Please enter the passcode on the device and retry.\\n\", udid);\n\t\t\tbreak;\n\t\tcase LOCKDOWN_E_INVALID_HOST_ID:\n\t\t\tprintf(\"ERROR: Device %s is not paired with this host\\n\", udid);\n\t\t\tbreak;\n\t\tcase LOCKDOWN_E_PAIRING_DIALOG_RESPONSE_PENDING:\n\t\t\tprintf(\"ERROR: Please accept the trust dialog on the screen of device %s, then attempt to pair again.\\n\", udid);\n\t\t\tbreak;\n\t\tcase LOCKDOWN_E_USER_DENIED_PAIRING:\n\t\t\tprintf(\"ERROR: Device %s said that the user denied the trust dialog.\\n\", udid);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tprintf(\"ERROR: Device %s returned unhandled error code %d\\n\", udid, err);\n\t\t\tbreak;\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"SUCCESS: Unpaired with device %s\\n\"",
            "udid"
          ],
          "line": 279
        },
        "resolved": true,
        "details": {
          "function_name": "asprintf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/include/asprintf.h",
          "lines": "23-31",
          "snippet": "static inline int asprintf(char **PTR, const char *TEMPLATE, ...)\n{\n\tint res;\n\tva_list AP;\n\tva_start(AP, TEMPLATE);\n\tres = vasprintf(PTR, TEMPLATE, AP);\n\tva_end(AP);\n\treturn res;\n}",
          "includes": [
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <config.h>\n\nstatic inline int asprintf(char **PTR, const char *TEMPLATE, ...)\n{\n\tint res;\n\tva_list AP;\n\tva_start(AP, TEMPLATE);\n\tres = vasprintf(PTR, TEMPLATE, AP);\n\tva_end(AP);\n\treturn res;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lockdownd_unpair",
          "args": [
            "client",
            "NULL"
          ],
          "line": 277
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_unpair",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "1048-1051",
          "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_unpair(lockdownd_client_t client, lockdownd_pair_record_t pair_record)\n{\n\treturn lockdownd_do_pair(client, pair_record, \"Unpair\", NULL, NULL);\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_unpair(lockdownd_client_t client, lockdownd_pair_record_t pair_record)\n{\n\treturn lockdownd_do_pair(client, pair_record, \"Unpair\", NULL, NULL);\n}"
        }
      },
      {
        "call_info": {
          "callee": "lockdownd_validate_pair",
          "args": [
            "client",
            "NULL"
          ],
          "line": 267
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_validate_pair",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "1043-1046",
          "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_validate_pair(lockdownd_client_t client, lockdownd_pair_record_t pair_record)\n{\n\treturn lockdownd_do_pair(client, pair_record, \"ValidatePair\", NULL, NULL);\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_validate_pair(lockdownd_client_t client, lockdownd_pair_record_t pair_record)\n{\n\treturn lockdownd_do_pair(client, pair_record, \"ValidatePair\", NULL, NULL);\n}"
        }
      },
      {
        "call_info": {
          "callee": "lockdownd_pair",
          "args": [
            "client",
            "NULL"
          ],
          "line": 257
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_pair",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "1025-1036",
          "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_pair(lockdownd_client_t client, lockdownd_pair_record_t pair_record)\n{\n\n\tplist_t options = plist_new_dict();\n\tplist_dict_set_item(options, \"ExtendedPairingErrors\", plist_new_bool(1));\n\n\tlockdownd_error_t ret = lockdownd_do_pair(client, pair_record, \"Pair\", options, NULL);\n\n\tplist_free(options);\n\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_pair(lockdownd_client_t client, lockdownd_pair_record_t pair_record)\n{\n\n\tplist_t options = plist_new_dict();\n\tplist_dict_set_item(options, \"ExtendedPairingErrors\", plist_new_bool(1));\n\n\tlockdownd_error_t ret = lockdownd_do_pair(client, pair_record, \"Pair\", options, NULL);\n\n\tplist_free(options);\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "\"com.apple.mobile.lockdown\"",
            "type"
          ],
          "line": 246
        },
        "resolved": true,
        "details": {
          "function_name": "plist_strcmp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/tools/idevicebackup.c",
          "lines": "296-309",
          "snippet": "static int plist_strcmp(plist_t node, const char *str)\n{\n\tchar *buffer = NULL;\n\tint ret = 0;\n\n\tif (plist_get_node_type(node) != PLIST_STRING)\n\t\treturn ret;\n\n\tplist_get_string_val(node, &buffer);\n\tret = strcmp(buffer, str);\n\tfree(buffer);\n\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"common/utils.h\"",
            "#include <libimobiledevice/afc.h>",
            "#include <libimobiledevice/notification_proxy.h>",
            "#include <libimobiledevice/mobilebackup.h>",
            "#include <libimobiledevice/lockdown.h>",
            "#include <libimobiledevice/libimobiledevice.h>",
            "#include <time.h>",
            "#include <ctype.h>",
            "#include <unistd.h>",
            "#include <gcrypt.h>",
            "#include <openssl/sha.h>",
            "#include <signal.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"common/utils.h\"\n#include <libimobiledevice/afc.h>\n#include <libimobiledevice/notification_proxy.h>\n#include <libimobiledevice/mobilebackup.h>\n#include <libimobiledevice/lockdown.h>\n#include <libimobiledevice/libimobiledevice.h>\n#include <time.h>\n#include <ctype.h>\n#include <unistd.h>\n#include <gcrypt.h>\n#include <openssl/sha.h>\n#include <signal.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int plist_strcmp(plist_t node, const char *str)\n{\n\tchar *buffer = NULL;\n\tint ret = 0;\n\n\tif (plist_get_node_type(node) != PLIST_STRING)\n\t\treturn ret;\n\n\tplist_get_string_val(node, &buffer);\n\tret = strcmp(buffer, str);\n\tfree(buffer);\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lockdownd_query_type",
          "args": [
            "client",
            "&type"
          ],
          "line": 240
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_query_type",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "381-424",
          "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_query_type(lockdownd_client_t client, char **type)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tplist_t dict = plist_new_dict();\n\tplist_dict_add_label(dict, client->label);\n\tplist_dict_set_item(dict,\"Request\", plist_new_string(\"QueryType\"));\n\n\tdebug_info(\"called\");\n\tret = lockdownd_send(client, dict);\n\n\tplist_free(dict);\n\tdict = NULL;\n\n\tret = lockdownd_receive(client, &dict);\n\n\tif (LOCKDOWN_E_SUCCESS != ret)\n\t\treturn ret;\n\n\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\tplist_t type_node = plist_dict_get_item(dict, \"Type\");\n\tif (type_node && (plist_get_node_type(type_node) == PLIST_STRING)) {\n\t\tchar* typestr = NULL;\n\t\tplist_get_string_val(type_node, &typestr);\n\t\tdebug_info(\"success with type %s\", typestr);\n\t\t/* return the type if requested */\n\t\tif (type != NULL) {\n\t\t\t*type = typestr;\n\t\t} else {\n\t\t\tfree(typestr);\n\t\t}\n\t\tret = LOCKDOWN_E_SUCCESS;\n\t} else {\n\t\tdebug_info(\"hmm. QueryType response does not contain a type?!\");\n\t\tdebug_plist(dict);\n\t}\n\tplist_free(dict);\n\tdict = NULL;\n\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_query_type(lockdownd_client_t client, char **type)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tplist_t dict = plist_new_dict();\n\tplist_dict_add_label(dict, client->label);\n\tplist_dict_set_item(dict,\"Request\", plist_new_string(\"QueryType\"));\n\n\tdebug_info(\"called\");\n\tret = lockdownd_send(client, dict);\n\n\tplist_free(dict);\n\tdict = NULL;\n\n\tret = lockdownd_receive(client, &dict);\n\n\tif (LOCKDOWN_E_SUCCESS != ret)\n\t\treturn ret;\n\n\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\tplist_t type_node = plist_dict_get_item(dict, \"Type\");\n\tif (type_node && (plist_get_node_type(type_node) == PLIST_STRING)) {\n\t\tchar* typestr = NULL;\n\t\tplist_get_string_val(type_node, &typestr);\n\t\tdebug_info(\"success with type %s\", typestr);\n\t\t/* return the type if requested */\n\t\tif (type != NULL) {\n\t\t\t*type = typestr;\n\t\t} else {\n\t\t\tfree(typestr);\n\t\t}\n\t\tret = LOCKDOWN_E_SUCCESS;\n\t} else {\n\t\tdebug_info(\"hmm. QueryType response does not contain a type?!\");\n\t\tdebug_plist(dict);\n\t}\n\tplist_free(dict);\n\tdict = NULL;\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lockdownd_client_new",
          "args": [
            "device",
            "&client",
            "\"idevicepair\""
          ],
          "line": 231
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_client_new_with_handshake",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "671-753",
          "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_client_new_with_handshake(idevice_t device, lockdownd_client_t *client, const char *label)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_SUCCESS;\n\tlockdownd_client_t client_loc = NULL;\n\tplist_t pair_record = NULL;\n\tchar *host_id = NULL;\n\tchar *type = NULL;\n\n\tret = lockdownd_client_new(device, &client_loc, label);\n\tif (LOCKDOWN_E_SUCCESS != ret) {\n\t\tdebug_info(\"failed to create lockdownd client.\");\n\t\treturn ret;\n\t}\n\n\t/* perform handshake */\n\tif (LOCKDOWN_E_SUCCESS != lockdownd_query_type(client_loc, &type)) {\n\t\tdebug_info(\"QueryType failed in the lockdownd client.\");\n\t\tret = LOCKDOWN_E_NOT_ENOUGH_DATA;\n\t} else {\n\t\tif (strcmp(\"com.apple.mobile.lockdown\", type)) {\n\t\t\tdebug_info(\"Warning QueryType request returned \\\"%s\\\".\", type);\n\t\t}\n\t}\n\tfree(type);\n\n\tuserpref_read_pair_record(client_loc->udid, &pair_record);\n\tif (pair_record) {\n\t\tpair_record_get_host_id(pair_record, &host_id);\n\t}\n\tif (LOCKDOWN_E_SUCCESS == ret && !host_id) {\n\t\tret = LOCKDOWN_E_INVALID_CONF;\n\t}\n\n\tif (LOCKDOWN_E_SUCCESS == ret && !pair_record) {\n\t\t/* attempt pairing */\n\t\tret = lockdownd_pair(client_loc, NULL);\n\t}\n\n\tplist_free(pair_record);\n\tpair_record = NULL;\n\n\t/* in any case, we need to validate pairing to receive trusted host status */\n\tret = lockdownd_validate_pair(client_loc, NULL);\n\n\t/* if not paired yet, let's do it now */\n\tif (LOCKDOWN_E_INVALID_HOST_ID == ret) {\n\t\tfree(host_id);\n\t\thost_id = NULL;\n\t\tret = lockdownd_pair(client_loc, NULL);\n\t\tif (LOCKDOWN_E_SUCCESS == ret) {\n\t\t\tret = lockdownd_validate_pair(client_loc, NULL);\n\t\t} else if (LOCKDOWN_E_PAIRING_DIALOG_RESPONSE_PENDING == ret) {\n\t\t\tdebug_info(\"Device shows the pairing dialog.\");\n\t\t}\n\t}\n\n\tif (LOCKDOWN_E_SUCCESS == ret) {\n\t\tif (!host_id) {\n\t\t\tuserpref_read_pair_record(client_loc->udid, &pair_record);\n\t\t\tif (pair_record) {\n\t\t\t\tpair_record_get_host_id(pair_record, &host_id);\n\t\t\t\tplist_free(pair_record);\n\t\t\t}\n\t\t}\n\n\t\tret = lockdownd_start_session(client_loc, host_id, NULL, NULL);\n\t\tif (LOCKDOWN_E_SUCCESS != ret) {\n\t\t\tdebug_info(\"Session opening failed.\");\n\t\t}\n\n\t}\n\n\tif (LOCKDOWN_E_SUCCESS == ret) {\n\t\t*client = client_loc;\n\t} else {\n\t\tlockdownd_client_free(client_loc);\n\t}\n\tfree(host_id);\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_client_new_with_handshake(idevice_t device, lockdownd_client_t *client, const char *label)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_SUCCESS;\n\tlockdownd_client_t client_loc = NULL;\n\tplist_t pair_record = NULL;\n\tchar *host_id = NULL;\n\tchar *type = NULL;\n\n\tret = lockdownd_client_new(device, &client_loc, label);\n\tif (LOCKDOWN_E_SUCCESS != ret) {\n\t\tdebug_info(\"failed to create lockdownd client.\");\n\t\treturn ret;\n\t}\n\n\t/* perform handshake */\n\tif (LOCKDOWN_E_SUCCESS != lockdownd_query_type(client_loc, &type)) {\n\t\tdebug_info(\"QueryType failed in the lockdownd client.\");\n\t\tret = LOCKDOWN_E_NOT_ENOUGH_DATA;\n\t} else {\n\t\tif (strcmp(\"com.apple.mobile.lockdown\", type)) {\n\t\t\tdebug_info(\"Warning QueryType request returned \\\"%s\\\".\", type);\n\t\t}\n\t}\n\tfree(type);\n\n\tuserpref_read_pair_record(client_loc->udid, &pair_record);\n\tif (pair_record) {\n\t\tpair_record_get_host_id(pair_record, &host_id);\n\t}\n\tif (LOCKDOWN_E_SUCCESS == ret && !host_id) {\n\t\tret = LOCKDOWN_E_INVALID_CONF;\n\t}\n\n\tif (LOCKDOWN_E_SUCCESS == ret && !pair_record) {\n\t\t/* attempt pairing */\n\t\tret = lockdownd_pair(client_loc, NULL);\n\t}\n\n\tplist_free(pair_record);\n\tpair_record = NULL;\n\n\t/* in any case, we need to validate pairing to receive trusted host status */\n\tret = lockdownd_validate_pair(client_loc, NULL);\n\n\t/* if not paired yet, let's do it now */\n\tif (LOCKDOWN_E_INVALID_HOST_ID == ret) {\n\t\tfree(host_id);\n\t\thost_id = NULL;\n\t\tret = lockdownd_pair(client_loc, NULL);\n\t\tif (LOCKDOWN_E_SUCCESS == ret) {\n\t\t\tret = lockdownd_validate_pair(client_loc, NULL);\n\t\t} else if (LOCKDOWN_E_PAIRING_DIALOG_RESPONSE_PENDING == ret) {\n\t\t\tdebug_info(\"Device shows the pairing dialog.\");\n\t\t}\n\t}\n\n\tif (LOCKDOWN_E_SUCCESS == ret) {\n\t\tif (!host_id) {\n\t\t\tuserpref_read_pair_record(client_loc->udid, &pair_record);\n\t\t\tif (pair_record) {\n\t\t\t\tpair_record_get_host_id(pair_record, &host_id);\n\t\t\t\tplist_free(pair_record);\n\t\t\t}\n\t\t}\n\n\t\tret = lockdownd_start_session(client_loc, host_id, NULL, NULL);\n\t\tif (LOCKDOWN_E_SUCCESS != ret) {\n\t\t\tdebug_info(\"Session opening failed.\");\n\t\t}\n\n\t}\n\n\tif (LOCKDOWN_E_SUCCESS == ret) {\n\t\t*client = client_loc;\n\t} else {\n\t\tlockdownd_client_free(client_loc);\n\t}\n\tfree(host_id);\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "pair_record"
          ],
          "line": 226
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pair_record_get_host_id",
          "args": [
            "pair_record",
            "&hostid"
          ],
          "line": 218
        },
        "resolved": true,
        "details": {
          "function_name": "pair_record_get_host_id",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/common/userpref.c",
          "lines": "874-883",
          "snippet": "userpref_error_t pair_record_get_host_id(plist_t pair_record, char** host_id)\n{\n\tplist_t node = plist_dict_get_item(pair_record, USERPREF_HOST_ID_KEY);\n\n\tif (node && plist_get_node_type(node) == PLIST_STRING) {\n\t\tplist_get_string_val(node, host_id);\n\t}\n\n\treturn USERPREF_E_SUCCESS;\n}",
          "includes": [
            "#include \"utils.h\"",
            "#include \"debug.h\"",
            "#include \"userpref.h\"",
            "#include <shlobj.h>",
            "#include <errno.h>",
            "#include <sys/stat.h>",
            "#include <libgen.h>",
            "#include <dirent.h>",
            "#include <libtasn1.h>",
            "#include <gcrypt.h>",
            "#include <gnutls/x509.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/gnutls.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/rsa.h>",
            "#include <openssl/pem.h>",
            "#include <usbmuxd.h>",
            "#include <unistd.h>",
            "#include <pwd.h>",
            "#include <sys/types.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"utils.h\"\n#include \"debug.h\"\n#include \"userpref.h\"\n#include <shlobj.h>\n#include <errno.h>\n#include <sys/stat.h>\n#include <libgen.h>\n#include <dirent.h>\n#include <libtasn1.h>\n#include <gcrypt.h>\n#include <gnutls/x509.h>\n#include <gnutls/crypto.h>\n#include <gnutls/gnutls.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/rsa.h>\n#include <openssl/pem.h>\n#include <usbmuxd.h>\n#include <unistd.h>\n#include <pwd.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nuserpref_error_t pair_record_get_host_id(plist_t pair_record, char** host_id)\n{\n\tplist_t node = plist_dict_get_item(pair_record, USERPREF_HOST_ID_KEY);\n\n\tif (node && plist_get_node_type(node) == PLIST_STRING) {\n\t\tplist_get_string_val(node, host_id);\n\t}\n\n\treturn USERPREF_E_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "userpref_read_pair_record",
          "args": [
            "udid",
            "&pair_record"
          ],
          "line": 217
        },
        "resolved": true,
        "details": {
          "function_name": "userpref_read_pair_record",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/common/userpref.c",
          "lines": "333-357",
          "snippet": "userpref_error_t userpref_read_pair_record(const char *udid, plist_t *pair_record)\n{\n\tchar* record_data = NULL;\n\tuint32_t record_size = 0;\n\n\tint res = usbmuxd_read_pair_record(udid, &record_data, &record_size);\n\n\tif (res < 0) {\n\t\tif (record_data)\n\t\t\tfree(record_data);\n\n\t\treturn USERPREF_E_INVALID_CONF;\n\t}\n\n\t*pair_record = NULL;\n\tif (memcmp(record_data, \"bplist00\", 8) == 0) {\n\t\tplist_from_bin(record_data, record_size, pair_record);\n\t} else {\n\t\tplist_from_xml(record_data, record_size, pair_record);\n\t}\n\n\tfree(record_data);\n\n\treturn res == 0 ? USERPREF_E_SUCCESS: USERPREF_E_UNKNOWN_ERROR;\n}",
          "includes": [
            "#include \"utils.h\"",
            "#include \"debug.h\"",
            "#include \"userpref.h\"",
            "#include <shlobj.h>",
            "#include <errno.h>",
            "#include <sys/stat.h>",
            "#include <libgen.h>",
            "#include <dirent.h>",
            "#include <libtasn1.h>",
            "#include <gcrypt.h>",
            "#include <gnutls/x509.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/gnutls.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/rsa.h>",
            "#include <openssl/pem.h>",
            "#include <usbmuxd.h>",
            "#include <unistd.h>",
            "#include <pwd.h>",
            "#include <sys/types.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"utils.h\"\n#include \"debug.h\"\n#include \"userpref.h\"\n#include <shlobj.h>\n#include <errno.h>\n#include <sys/stat.h>\n#include <libgen.h>\n#include <dirent.h>\n#include <libtasn1.h>\n#include <gcrypt.h>\n#include <gnutls/x509.h>\n#include <gnutls/crypto.h>\n#include <gnutls/gnutls.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/rsa.h>\n#include <openssl/pem.h>\n#include <usbmuxd.h>\n#include <unistd.h>\n#include <pwd.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nuserpref_error_t userpref_read_pair_record(const char *udid, plist_t *pair_record)\n{\n\tchar* record_data = NULL;\n\tuint32_t record_size = 0;\n\n\tint res = usbmuxd_read_pair_record(udid, &record_data, &record_size);\n\n\tif (res < 0) {\n\t\tif (record_data)\n\t\t\tfree(record_data);\n\n\t\treturn USERPREF_E_INVALID_CONF;\n\t}\n\n\t*pair_record = NULL;\n\tif (memcmp(record_data, \"bplist00\", 8) == 0) {\n\t\tplist_from_bin(record_data, record_size, pair_record);\n\t} else {\n\t\tplist_from_xml(record_data, record_size, pair_record);\n\t}\n\n\tfree(record_data);\n\n\treturn res == 0 ? USERPREF_E_SUCCESS: USERPREF_E_UNKNOWN_ERROR;\n}"
        }
      },
      {
        "call_info": {
          "callee": "idevice_get_udid",
          "args": [
            "device",
            "&udid"
          ],
          "line": 206
        },
        "resolved": true,
        "details": {
          "function_name": "idevice_get_udid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/idevice.c",
          "lines": "480-487",
          "snippet": "LIBIMOBILEDEVICE_API idevice_error_t idevice_get_udid(idevice_t device, char **udid)\n{\n\tif (!device || !udid)\n\t\treturn IDEVICE_E_INVALID_ARG;\n\n\t*udid = strdup(device->udid);\n\treturn IDEVICE_E_SUCCESS;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"common/thread.h\"",
            "#include \"common/userpref.h\"",
            "#include \"idevice.h\"",
            "#include <gnutls/gnutls.h>",
            "#include <openssl/ssl.h>",
            "#include <openssl/err.h>",
            "#include <usbmuxd.h>",
            "#include <windows.h>",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "LIBIMOBILEDEVICE_API idevice_error_t"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"common/thread.h\"\n#include \"common/userpref.h\"\n#include \"idevice.h\"\n#include <gnutls/gnutls.h>\n#include <openssl/ssl.h>\n#include <openssl/err.h>\n#include <usbmuxd.h>\n#include <windows.h>\n#include <errno.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API idevice_error_t;\n\nLIBIMOBILEDEVICE_API idevice_error_t idevice_get_udid(idevice_t device, char **udid)\n{\n\tif (!device || !udid)\n\t\treturn IDEVICE_E_INVALID_ARG;\n\n\t*udid = strdup(device->udid);\n\treturn IDEVICE_E_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"No device found, is it plugged in?\\n\""
          ],
          "line": 201
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "idevice_new",
          "args": [
            "&device",
            "NULL"
          ],
          "line": 199
        },
        "resolved": true,
        "details": {
          "function_name": "idevice_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/idevice.c",
          "lines": "230-245",
          "snippet": "LIBIMOBILEDEVICE_API idevice_error_t idevice_new(idevice_t * device, const char *udid)\n{\n\tusbmuxd_device_info_t muxdev;\n\tint res = usbmuxd_get_device_by_udid(udid, &muxdev);\n\tif (res > 0) {\n\t\tidevice_t dev = (idevice_t) malloc(sizeof(struct idevice_private));\n\t\tdev->udid = strdup(muxdev.udid);\n\t\tdev->conn_type = CONNECTION_USBMUXD;\n\t\tdev->conn_data = (void*)(long)muxdev.handle;\n\t\t*device = dev;\n\t\treturn IDEVICE_E_SUCCESS;\n\t}\n\t/* other connection types could follow here */\n\n\treturn IDEVICE_E_NO_DEVICE;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"common/thread.h\"",
            "#include \"common/userpref.h\"",
            "#include \"idevice.h\"",
            "#include <gnutls/gnutls.h>",
            "#include <openssl/ssl.h>",
            "#include <openssl/err.h>",
            "#include <usbmuxd.h>",
            "#include <windows.h>",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "LIBIMOBILEDEVICE_API idevice_error_t"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"common/thread.h\"\n#include \"common/userpref.h\"\n#include \"idevice.h\"\n#include <gnutls/gnutls.h>\n#include <openssl/ssl.h>\n#include <openssl/err.h>\n#include <usbmuxd.h>\n#include <windows.h>\n#include <errno.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API idevice_error_t;\n\nLIBIMOBILEDEVICE_API idevice_error_t idevice_new(idevice_t * device, const char *udid)\n{\n\tusbmuxd_device_info_t muxdev;\n\tint res = usbmuxd_get_device_by_udid(udid, &muxdev);\n\tif (res > 0) {\n\t\tidevice_t dev = (idevice_t) malloc(sizeof(struct idevice_private));\n\t\tdev->udid = strdup(muxdev.udid);\n\t\tdev->conn_type = CONNECTION_USBMUXD;\n\t\tdev->conn_data = (void*)(long)muxdev.handle;\n\t\t*device = dev;\n\t\treturn IDEVICE_E_SUCCESS;\n\t}\n\t/* other connection types could follow here */\n\n\treturn IDEVICE_E_NO_DEVICE;\n}"
        }
      },
      {
        "call_info": {
          "callee": "userpref_get_paired_udids",
          "args": [
            "&udids",
            "&count"
          ],
          "line": 178
        },
        "resolved": true,
        "details": {
          "function_name": "userpref_get_paired_udids",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/common/userpref.c",
          "lines": "238-299",
          "snippet": "userpref_error_t userpref_get_paired_udids(char ***list, unsigned int *count)\n{\n\tstruct slist_t {\n\t\tchar *name;\n\t\tvoid *next;\n\t};\n\tDIR *config_dir;\n\tconst char *config_path = NULL;\n\tstruct slist_t *udids = NULL;\n\tunsigned int i;\n\tunsigned int found = 0;\n\n\tif (!list || (list && *list)) {\n\t\tdebug_info(\"ERROR: The list parameter needs to point to NULL!\");\n\t\treturn USERPREF_E_INVALID_ARG;\n\t}\n\n\tif (count) {\n\t\t*count = 0;\n\t}\n\n\tconfig_path = userpref_get_config_dir();\n\tconfig_dir = opendir(config_path);\n\tif (config_dir) {\n\t\tstruct dirent *entry;\n\t\tstruct slist_t *listp = udids;\n\t\twhile ((entry = readdir(config_dir))) {\n\t\t\tchar *ext = strstr(entry->d_name, USERPREF_CONFIG_EXTENSION);\n\t\t\tif (ext && ((ext - entry->d_name) == 40) && (strlen(entry->d_name) == (40 + strlen(ext)))) {\n\t\t\t\tstruct slist_t *ne = (struct slist_t*)malloc(sizeof(struct slist_t));\n\t\t\t\tne->name = (char*)malloc(41);\n\t\t\t\tstrncpy(ne->name, entry->d_name, 40);\n\t\t\t\tne->name[40] = 0;\n\t\t\t\tne->next = NULL;\n\t\t\t\tif (!listp) {\n\t\t\t\t\tlistp = ne;\n\t\t\t\t\tudids = listp;\n\t\t\t\t} else {\n\t\t\t\t\tlistp->next = ne;\n\t\t\t\t\tlistp = listp->next;\n\t\t\t\t}\n\t\t\t\tfound++;\n\t\t\t}\n\t\t}\n\t\tclosedir(config_dir);\n\t}\n\t*list = (char**)malloc(sizeof(char*) * (found+1));\n\ti = 0;\n\twhile (udids) {\n\t\t(*list)[i++] = udids->name;\n\t\tstruct slist_t *old = udids;\n\t\tudids = udids->next;\n\t\tfree(old);\n\t}\n\t(*list)[i] = NULL;\n\n\tif (count) {\n\t\t*count = found;\n\t}\n\n\treturn USERPREF_E_SUCCESS;\n}",
          "includes": [
            "#include \"utils.h\"",
            "#include \"debug.h\"",
            "#include \"userpref.h\"",
            "#include <shlobj.h>",
            "#include <errno.h>",
            "#include <sys/stat.h>",
            "#include <libgen.h>",
            "#include <dirent.h>",
            "#include <libtasn1.h>",
            "#include <gcrypt.h>",
            "#include <gnutls/x509.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/gnutls.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/rsa.h>",
            "#include <openssl/pem.h>",
            "#include <usbmuxd.h>",
            "#include <unistd.h>",
            "#include <pwd.h>",
            "#include <sys/types.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define USERPREF_CONFIG_EXTENSION \".plist\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"utils.h\"\n#include \"debug.h\"\n#include \"userpref.h\"\n#include <shlobj.h>\n#include <errno.h>\n#include <sys/stat.h>\n#include <libgen.h>\n#include <dirent.h>\n#include <libtasn1.h>\n#include <gcrypt.h>\n#include <gnutls/x509.h>\n#include <gnutls/crypto.h>\n#include <gnutls/gnutls.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/rsa.h>\n#include <openssl/pem.h>\n#include <usbmuxd.h>\n#include <unistd.h>\n#include <pwd.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\n#define USERPREF_CONFIG_EXTENSION \".plist\"\n\nuserpref_error_t userpref_get_paired_udids(char ***list, unsigned int *count)\n{\n\tstruct slist_t {\n\t\tchar *name;\n\t\tvoid *next;\n\t};\n\tDIR *config_dir;\n\tconst char *config_path = NULL;\n\tstruct slist_t *udids = NULL;\n\tunsigned int i;\n\tunsigned int found = 0;\n\n\tif (!list || (list && *list)) {\n\t\tdebug_info(\"ERROR: The list parameter needs to point to NULL!\");\n\t\treturn USERPREF_E_INVALID_ARG;\n\t}\n\n\tif (count) {\n\t\t*count = 0;\n\t}\n\n\tconfig_path = userpref_get_config_dir();\n\tconfig_dir = opendir(config_path);\n\tif (config_dir) {\n\t\tstruct dirent *entry;\n\t\tstruct slist_t *listp = udids;\n\t\twhile ((entry = readdir(config_dir))) {\n\t\t\tchar *ext = strstr(entry->d_name, USERPREF_CONFIG_EXTENSION);\n\t\t\tif (ext && ((ext - entry->d_name) == 40) && (strlen(entry->d_name) == (40 + strlen(ext)))) {\n\t\t\t\tstruct slist_t *ne = (struct slist_t*)malloc(sizeof(struct slist_t));\n\t\t\t\tne->name = (char*)malloc(41);\n\t\t\t\tstrncpy(ne->name, entry->d_name, 40);\n\t\t\t\tne->name[40] = 0;\n\t\t\t\tne->next = NULL;\n\t\t\t\tif (!listp) {\n\t\t\t\t\tlistp = ne;\n\t\t\t\t\tudids = listp;\n\t\t\t\t} else {\n\t\t\t\t\tlistp->next = ne;\n\t\t\t\t\tlistp = listp->next;\n\t\t\t\t}\n\t\t\t\tfound++;\n\t\t\t}\n\t\t}\n\t\tclosedir(config_dir);\n\t}\n\t*list = (char**)malloc(sizeof(char*) * (found+1));\n\ti = 0;\n\twhile (udids) {\n\t\t(*list)[i++] = udids->name;\n\t\tstruct slist_t *old = udids;\n\t\tudids = udids->next;\n\t\tfree(old);\n\t}\n\t(*list)[i] = NULL;\n\n\tif (count) {\n\t\t*count = found;\n\t}\n\n\treturn USERPREF_E_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "userpref_read_system_buid",
          "args": [
            "&systembuid"
          ],
          "line": 164
        },
        "resolved": true,
        "details": {
          "function_name": "userpref_read_system_buid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/common/userpref.c",
          "lines": "183-192",
          "snippet": "int userpref_read_system_buid(char **system_buid)\n{\n\tint res = usbmuxd_read_buid(system_buid);\n\tif (res == 0) {\n\t\tdebug_info(\"using %s as %s\", *system_buid, USERPREF_SYSTEM_BUID_KEY);\n\t} else {\n\t\tdebug_info(\"could not read system buid, error %d\", res);\n\t}\n\treturn res;\n}",
          "includes": [
            "#include \"utils.h\"",
            "#include \"debug.h\"",
            "#include \"userpref.h\"",
            "#include <shlobj.h>",
            "#include <errno.h>",
            "#include <sys/stat.h>",
            "#include <libgen.h>",
            "#include <dirent.h>",
            "#include <libtasn1.h>",
            "#include <gcrypt.h>",
            "#include <gnutls/x509.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/gnutls.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/rsa.h>",
            "#include <openssl/pem.h>",
            "#include <usbmuxd.h>",
            "#include <unistd.h>",
            "#include <pwd.h>",
            "#include <sys/types.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"utils.h\"\n#include \"debug.h\"\n#include \"userpref.h\"\n#include <shlobj.h>\n#include <errno.h>\n#include <sys/stat.h>\n#include <libgen.h>\n#include <dirent.h>\n#include <libtasn1.h>\n#include <gcrypt.h>\n#include <gnutls/x509.h>\n#include <gnutls/crypto.h>\n#include <gnutls/gnutls.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/rsa.h>\n#include <openssl/pem.h>\n#include <usbmuxd.h>\n#include <unistd.h>\n#include <pwd.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nint userpref_read_system_buid(char **system_buid)\n{\n\tint res = usbmuxd_read_buid(system_buid);\n\tif (res == 0) {\n\t\tdebug_info(\"using %s as %s\", *system_buid, USERPREF_SYSTEM_BUID_KEY);\n\t} else {\n\t\tdebug_info(\"could not read system buid, error %d\", res);\n\t}\n\treturn res;\n}"
        }
      },
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "EXIT_FAILURE"
          ],
          "line": 159
        },
        "resolved": true,
        "details": {
          "function_name": "clean_exit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/tools/idevicebackup2.c",
          "lines": "1108-1112",
          "snippet": "static void clean_exit(int sig)\n{\n\tfprintf(stderr, \"Exiting...\\n\");\n\tquit_flag++;\n}",
          "includes": [
            "#include <sys/stat.h>",
            "#include <sys/statvfs.h>",
            "#include <termios.h>",
            "#include <conio.h>",
            "#include <windows.h>",
            "#include <endianness.h>",
            "#include \"common/utils.h\"",
            "#include <libimobiledevice/afc.h>",
            "#include <libimobiledevice/notification_proxy.h>",
            "#include <libimobiledevice/mobilebackup2.h>",
            "#include <libimobiledevice/lockdown.h>",
            "#include <libimobiledevice/libimobiledevice.h>",
            "#include <time.h>",
            "#include <ctype.h>",
            "#include <libgen.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <signal.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int quit_flag = 0;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <sys/stat.h>\n#include <sys/statvfs.h>\n#include <termios.h>\n#include <conio.h>\n#include <windows.h>\n#include <endianness.h>\n#include \"common/utils.h\"\n#include <libimobiledevice/afc.h>\n#include <libimobiledevice/notification_proxy.h>\n#include <libimobiledevice/mobilebackup2.h>\n#include <libimobiledevice/lockdown.h>\n#include <libimobiledevice/libimobiledevice.h>\n#include <time.h>\n#include <ctype.h>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <signal.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int quit_flag = 0;\n\nstatic void clean_exit(int sig)\n{\n\tfprintf(stderr, \"Exiting...\\n\");\n\tquit_flag++;\n}"
        }
      },
      {
        "call_info": {
          "callee": "print_usage",
          "args": [
            "argc",
            "argv"
          ],
          "line": 158
        },
        "resolved": true,
        "details": {
          "function_name": "print_usage",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/tools/idevicepair.c",
          "lines": "59-79",
          "snippet": "static void print_usage(int argc, char **argv)\n{\n\tchar *name = NULL;\n\n\tname = strrchr(argv[0], '/');\n\tprintf(\"\\n%s - Manage host pairings with devices and usbmuxd.\\n\\n\", (name ? name + 1: argv[0]));\n\tprintf(\"Usage: %s [OPTIONS] COMMAND\\n\\n\", (name ? name + 1: argv[0]));\n\tprintf(\" Where COMMAND is one of:\\n\");\n\tprintf(\"  systembuid   print the system buid of the usbmuxd host\\n\");\n\tprintf(\"  hostid       print the host id for target device\\n\");\n\tprintf(\"  pair         pair device with this host\\n\");\n\tprintf(\"  validate     validate if device is paired with this host\\n\");\n\tprintf(\"  unpair       unpair device with this host\\n\");\n\tprintf(\"  list         list devices paired with this host\\n\\n\");\n\tprintf(\" The following OPTIONS are accepted:\\n\");\n\tprintf(\"  -d, --debug      enable communication debugging\\n\");\n\tprintf(\"  -u, --udid UDID  target specific device by its 40-digit device UDID\\n\");\n\tprintf(\"  -h, --help       prints usage information\\n\");\n\tprintf(\"\\n\");\n\tprintf(\"Homepage: <\" PACKAGE_URL \">\\n\");\n}",
          "includes": [
            "#include <libimobiledevice/lockdown.h>",
            "#include <libimobiledevice/libimobiledevice.h>",
            "#include \"common/userpref.h\"",
            "#include <getopt.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static char *udid = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <libimobiledevice/lockdown.h>\n#include <libimobiledevice/libimobiledevice.h>\n#include \"common/userpref.h\"\n#include <getopt.h>\n#include <stdlib.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic char *udid = NULL;\n\nstatic void print_usage(int argc, char **argv)\n{\n\tchar *name = NULL;\n\n\tname = strrchr(argv[0], '/');\n\tprintf(\"\\n%s - Manage host pairings with devices and usbmuxd.\\n\\n\", (name ? name + 1: argv[0]));\n\tprintf(\"Usage: %s [OPTIONS] COMMAND\\n\\n\", (name ? name + 1: argv[0]));\n\tprintf(\" Where COMMAND is one of:\\n\");\n\tprintf(\"  systembuid   print the system buid of the usbmuxd host\\n\");\n\tprintf(\"  hostid       print the host id for target device\\n\");\n\tprintf(\"  pair         pair device with this host\\n\");\n\tprintf(\"  validate     validate if device is paired with this host\\n\");\n\tprintf(\"  unpair       unpair device with this host\\n\");\n\tprintf(\"  list         list devices paired with this host\\n\\n\");\n\tprintf(\" The following OPTIONS are accepted:\\n\");\n\tprintf(\"  -d, --debug      enable communication debugging\\n\");\n\tprintf(\"  -u, --udid UDID  target specific device by its 40-digit device UDID\\n\");\n\tprintf(\"  -h, --help       prints usage information\\n\");\n\tprintf(\"\\n\");\n\tprintf(\"Homepage: <\" PACKAGE_URL \">\\n\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"ERROR: You need to specify a COMMAND!\\n\""
          ],
          "line": 137
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "parse_opts",
          "args": [
            "argc",
            "argv"
          ],
          "line": 134
        },
        "resolved": true,
        "details": {
          "function_name": "parse_opts",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/tools/idevicepair.c",
          "lines": "81-117",
          "snippet": "static void parse_opts(int argc, char **argv)\n{\n\tstatic struct option longopts[] = {\n\t\t{\"help\", 0, NULL, 'h'},\n\t\t{\"udid\", 1, NULL, 'u'},\n\t\t{\"debug\", 0, NULL, 'd'},\n\t\t{NULL, 0, NULL, 0}\n\t};\n\tint c;\n\n\twhile (1) {\n\t\tc = getopt_long(argc, argv, \"hu:d\", longopts, (int*)0);\n\t\tif (c == -1) {\n\t\t\tbreak;\n\t\t}\n\n\t\tswitch (c) {\n\t\tcase 'h':\n\t\t\tprint_usage(argc, argv);\n\t\t\texit(EXIT_SUCCESS);\n\t\tcase 'u':\n\t\t\tif (strlen(optarg) != 40) {\n\t\t\t\tprintf(\"%s: invalid UDID specified (length != 40)\\n\", argv[0]);\n\t\t\t\tprint_usage(argc, argv);\n\t\t\t\texit(2);\n\t\t\t}\n\t\t\tudid = strdup(optarg);\n\t\t\tbreak;\n\t\tcase 'd':\n\t\t\tidevice_set_debug_level(1);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tprint_usage(argc, argv);\n\t\t\texit(EXIT_SUCCESS);\n\t\t}\n\t}\n}",
          "includes": [
            "#include <libimobiledevice/lockdown.h>",
            "#include <libimobiledevice/libimobiledevice.h>",
            "#include \"common/userpref.h\"",
            "#include <getopt.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static char *udid = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <libimobiledevice/lockdown.h>\n#include <libimobiledevice/libimobiledevice.h>\n#include \"common/userpref.h\"\n#include <getopt.h>\n#include <stdlib.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic char *udid = NULL;\n\nstatic void parse_opts(int argc, char **argv)\n{\n\tstatic struct option longopts[] = {\n\t\t{\"help\", 0, NULL, 'h'},\n\t\t{\"udid\", 1, NULL, 'u'},\n\t\t{\"debug\", 0, NULL, 'd'},\n\t\t{NULL, 0, NULL, 0}\n\t};\n\tint c;\n\n\twhile (1) {\n\t\tc = getopt_long(argc, argv, \"hu:d\", longopts, (int*)0);\n\t\tif (c == -1) {\n\t\t\tbreak;\n\t\t}\n\n\t\tswitch (c) {\n\t\tcase 'h':\n\t\t\tprint_usage(argc, argv);\n\t\t\texit(EXIT_SUCCESS);\n\t\tcase 'u':\n\t\t\tif (strlen(optarg) != 40) {\n\t\t\t\tprintf(\"%s: invalid UDID specified (length != 40)\\n\", argv[0]);\n\t\t\t\tprint_usage(argc, argv);\n\t\t\t\texit(2);\n\t\t\t}\n\t\t\tudid = strdup(optarg);\n\t\t\tbreak;\n\t\tcase 'd':\n\t\t\tidevice_set_debug_level(1);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tprint_usage(argc, argv);\n\t\t\texit(EXIT_SUCCESS);\n\t\t}\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "#include <libimobiledevice/lockdown.h>\n#include <libimobiledevice/libimobiledevice.h>\n#include \"common/userpref.h\"\n#include <getopt.h>\n#include <stdlib.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic char *udid = NULL;\n\nint main(int argc, char **argv)\n{\n\tlockdownd_client_t client = NULL;\n\tidevice_t device = NULL;\n\tidevice_error_t ret = IDEVICE_E_UNKNOWN_ERROR;\n\tlockdownd_error_t lerr;\n\tint result;\n\n\tchar *type = NULL;\n\tchar *cmd;\n\ttypedef enum {\n\t\tOP_NONE = 0, OP_PAIR, OP_VALIDATE, OP_UNPAIR, OP_LIST, OP_HOSTID, OP_SYSTEMBUID\n\t} op_t;\n\top_t op = OP_NONE;\n\n\tparse_opts(argc, argv);\n\n\tif ((argc - optind) < 1) {\n\t\tprintf(\"ERROR: You need to specify a COMMAND!\\n\");\n\t\tprint_usage(argc, argv);\n\t\texit(EXIT_FAILURE);\n\t}\n\n\tcmd = (argv+optind)[0];\n\n\tif (!strcmp(cmd, \"pair\")) {\n\t\top = OP_PAIR;\n\t} else if (!strcmp(cmd, \"validate\")) {\n\t\top = OP_VALIDATE;\n\t} else if (!strcmp(cmd, \"unpair\")) {\n\t\top = OP_UNPAIR;\n\t} else if (!strcmp(cmd, \"list\")) {\n\t\top = OP_LIST;\n\t} else if (!strcmp(cmd, \"hostid\")) {\n\t\top = OP_HOSTID;\n\t} else if (!strcmp(cmd, \"systembuid\")) {\n\t\top = OP_SYSTEMBUID;\n\t} else {\n\t\tprintf(\"ERROR: Invalid command '%s' specified\\n\", cmd);\n\t\tprint_usage(argc, argv);\n\t\texit(EXIT_FAILURE);\n\t}\n\n\tif (op == OP_SYSTEMBUID) {\n\t\tchar *systembuid = NULL;\n\t\tuserpref_read_system_buid(&systembuid);\n\n\t\tprintf(\"%s\\n\", systembuid);\n\n\t\tif (systembuid)\n\t\t\tfree(systembuid);\n\n\t\treturn EXIT_SUCCESS;\n\t}\n\n\tif (op == OP_LIST) {\n\t\tunsigned int i;\n\t\tchar **udids = NULL;\n\t\tunsigned int count = 0;\n\t\tuserpref_get_paired_udids(&udids, &count);\n\t\tfor (i = 0; i < count; i++) {\n\t\t\tprintf(\"%s\\n\", udids[i]);\n\t\t\tfree(udids[i]);\n\t\t}\n\t\tif (udids)\n\t\t\tfree(udids);\n\t\tif (udid)\n\t\t\tfree(udid);\n\t\treturn EXIT_SUCCESS;\n\t}\n\n\tif (udid) {\n\t\tret = idevice_new(&device, udid);\n\t\tfree(udid);\n\t\tudid = NULL;\n\t\tif (ret != IDEVICE_E_SUCCESS) {\n\t\t\tprintf(\"No device found with udid %s, is it plugged in?\\n\", udid);\n\t\t\treturn EXIT_FAILURE;\n\t\t}\n\t} else {\n\t\tret = idevice_new(&device, NULL);\n\t\tif (ret != IDEVICE_E_SUCCESS) {\n\t\t\tprintf(\"No device found, is it plugged in?\\n\");\n\t\t\treturn EXIT_FAILURE;\n\t\t}\n\t}\n\n\tret = idevice_get_udid(device, &udid);\n\tif (ret != IDEVICE_E_SUCCESS) {\n\t\tprintf(\"ERROR: Could not get device udid, error code %d\\n\", ret);\n\t\tresult = EXIT_FAILURE;\n\t\tgoto leave;\n\t}\n\n\tif (op == OP_HOSTID) {\n\t\tplist_t pair_record = NULL;\n\t\tchar *hostid = NULL;\n\n\t\tuserpref_read_pair_record(udid, &pair_record);\n\t\tpair_record_get_host_id(pair_record, &hostid);\n\n\t\tprintf(\"%s\\n\", hostid);\n\n\t\tif (hostid)\n\t\t\tfree(hostid);\n\n\t\tif (pair_record)\n\t\t\tplist_free(pair_record);\n\n\t\treturn EXIT_SUCCESS;\n\t}\n\n\tlerr = lockdownd_client_new(device, &client, \"idevicepair\");\n\tif (lerr != LOCKDOWN_E_SUCCESS) {\n\t\tidevice_free(device);\n\t\tprintf(\"ERROR: Could not connect to lockdownd, error code %d\\n\", lerr);\n\t\treturn EXIT_FAILURE;\n\t}\n\n\tresult = EXIT_SUCCESS;\n\n\tlerr = lockdownd_query_type(client, &type);\n\tif (lerr != LOCKDOWN_E_SUCCESS) {\n\t\tprintf(\"QueryType failed, error code %d\\n\", lerr);\n\t\tresult = EXIT_FAILURE;\n\t\tgoto leave;\n\t} else {\n\t\tif (strcmp(\"com.apple.mobile.lockdown\", type)) {\n\t\t\tprintf(\"WARNING: QueryType request returned '%s'\\n\", type);\n\t\t}\n\t\tif (type) {\n\t\t\tfree(type);\n\t\t}\n\t}\n\n\tswitch(op) {\n\t\tdefault:\n\t\tcase OP_PAIR:\n\t\tlerr = lockdownd_pair(client, NULL);\n\t\tif (lerr == LOCKDOWN_E_SUCCESS) {\n\t\t\tprintf(\"SUCCESS: Paired with device %s\\n\", udid);\n\t\t} else {\n\t\t\tresult = EXIT_FAILURE;\n\t\t\tprint_error_message(lerr);\n\t\t}\n\t\tbreak;\n\n\t\tcase OP_VALIDATE:\n\t\tlerr = lockdownd_validate_pair(client, NULL);\n\t\tif (lerr == LOCKDOWN_E_SUCCESS) {\n\t\t\tprintf(\"SUCCESS: Validated pairing with device %s\\n\", udid);\n\t\t} else {\n\t\t\tresult = EXIT_FAILURE;\n\t\t\tprint_error_message(lerr);\n\t\t}\n\t\tbreak;\n\n\t\tcase OP_UNPAIR:\n\t\tlerr = lockdownd_unpair(client, NULL);\n\t\tif (lerr == LOCKDOWN_E_SUCCESS) {\n\t\t\tprintf(\"SUCCESS: Unpaired with device %s\\n\", udid);\n\t\t} else {\n\t\t\tresult = EXIT_FAILURE;\n\t\t\tprint_error_message(lerr);\n\t\t}\n\t\tbreak;\n\t}\n\nleave:\n\tlockdownd_client_free(client);\n\tidevice_free(device);\n\tif (udid) {\n\t\tfree(udid);\n\t}\n\treturn result;\n}"
  },
  {
    "function_name": "parse_opts",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/tools/idevicepair.c",
    "lines": "81-117",
    "snippet": "static void parse_opts(int argc, char **argv)\n{\n\tstatic struct option longopts[] = {\n\t\t{\"help\", 0, NULL, 'h'},\n\t\t{\"udid\", 1, NULL, 'u'},\n\t\t{\"debug\", 0, NULL, 'd'},\n\t\t{NULL, 0, NULL, 0}\n\t};\n\tint c;\n\n\twhile (1) {\n\t\tc = getopt_long(argc, argv, \"hu:d\", longopts, (int*)0);\n\t\tif (c == -1) {\n\t\t\tbreak;\n\t\t}\n\n\t\tswitch (c) {\n\t\tcase 'h':\n\t\t\tprint_usage(argc, argv);\n\t\t\texit(EXIT_SUCCESS);\n\t\tcase 'u':\n\t\t\tif (strlen(optarg) != 40) {\n\t\t\t\tprintf(\"%s: invalid UDID specified (length != 40)\\n\", argv[0]);\n\t\t\t\tprint_usage(argc, argv);\n\t\t\t\texit(2);\n\t\t\t}\n\t\t\tudid = strdup(optarg);\n\t\t\tbreak;\n\t\tcase 'd':\n\t\t\tidevice_set_debug_level(1);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tprint_usage(argc, argv);\n\t\t\texit(EXIT_SUCCESS);\n\t\t}\n\t}\n}",
    "includes": [
      "#include <libimobiledevice/lockdown.h>",
      "#include <libimobiledevice/libimobiledevice.h>",
      "#include \"common/userpref.h\"",
      "#include <getopt.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static char *udid = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "EXIT_SUCCESS"
          ],
          "line": 114
        },
        "resolved": true,
        "details": {
          "function_name": "clean_exit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/tools/idevicebackup2.c",
          "lines": "1108-1112",
          "snippet": "static void clean_exit(int sig)\n{\n\tfprintf(stderr, \"Exiting...\\n\");\n\tquit_flag++;\n}",
          "includes": [
            "#include <sys/stat.h>",
            "#include <sys/statvfs.h>",
            "#include <termios.h>",
            "#include <conio.h>",
            "#include <windows.h>",
            "#include <endianness.h>",
            "#include \"common/utils.h\"",
            "#include <libimobiledevice/afc.h>",
            "#include <libimobiledevice/notification_proxy.h>",
            "#include <libimobiledevice/mobilebackup2.h>",
            "#include <libimobiledevice/lockdown.h>",
            "#include <libimobiledevice/libimobiledevice.h>",
            "#include <time.h>",
            "#include <ctype.h>",
            "#include <libgen.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <signal.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int quit_flag = 0;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <sys/stat.h>\n#include <sys/statvfs.h>\n#include <termios.h>\n#include <conio.h>\n#include <windows.h>\n#include <endianness.h>\n#include \"common/utils.h\"\n#include <libimobiledevice/afc.h>\n#include <libimobiledevice/notification_proxy.h>\n#include <libimobiledevice/mobilebackup2.h>\n#include <libimobiledevice/lockdown.h>\n#include <libimobiledevice/libimobiledevice.h>\n#include <time.h>\n#include <ctype.h>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <signal.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int quit_flag = 0;\n\nstatic void clean_exit(int sig)\n{\n\tfprintf(stderr, \"Exiting...\\n\");\n\tquit_flag++;\n}"
        }
      },
      {
        "call_info": {
          "callee": "print_usage",
          "args": [
            "argc",
            "argv"
          ],
          "line": 113
        },
        "resolved": true,
        "details": {
          "function_name": "print_usage",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/tools/idevicepair.c",
          "lines": "59-79",
          "snippet": "static void print_usage(int argc, char **argv)\n{\n\tchar *name = NULL;\n\n\tname = strrchr(argv[0], '/');\n\tprintf(\"\\n%s - Manage host pairings with devices and usbmuxd.\\n\\n\", (name ? name + 1: argv[0]));\n\tprintf(\"Usage: %s [OPTIONS] COMMAND\\n\\n\", (name ? name + 1: argv[0]));\n\tprintf(\" Where COMMAND is one of:\\n\");\n\tprintf(\"  systembuid   print the system buid of the usbmuxd host\\n\");\n\tprintf(\"  hostid       print the host id for target device\\n\");\n\tprintf(\"  pair         pair device with this host\\n\");\n\tprintf(\"  validate     validate if device is paired with this host\\n\");\n\tprintf(\"  unpair       unpair device with this host\\n\");\n\tprintf(\"  list         list devices paired with this host\\n\\n\");\n\tprintf(\" The following OPTIONS are accepted:\\n\");\n\tprintf(\"  -d, --debug      enable communication debugging\\n\");\n\tprintf(\"  -u, --udid UDID  target specific device by its 40-digit device UDID\\n\");\n\tprintf(\"  -h, --help       prints usage information\\n\");\n\tprintf(\"\\n\");\n\tprintf(\"Homepage: <\" PACKAGE_URL \">\\n\");\n}",
          "includes": [
            "#include <libimobiledevice/lockdown.h>",
            "#include <libimobiledevice/libimobiledevice.h>",
            "#include \"common/userpref.h\"",
            "#include <getopt.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static char *udid = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <libimobiledevice/lockdown.h>\n#include <libimobiledevice/libimobiledevice.h>\n#include \"common/userpref.h\"\n#include <getopt.h>\n#include <stdlib.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic char *udid = NULL;\n\nstatic void print_usage(int argc, char **argv)\n{\n\tchar *name = NULL;\n\n\tname = strrchr(argv[0], '/');\n\tprintf(\"\\n%s - Manage host pairings with devices and usbmuxd.\\n\\n\", (name ? name + 1: argv[0]));\n\tprintf(\"Usage: %s [OPTIONS] COMMAND\\n\\n\", (name ? name + 1: argv[0]));\n\tprintf(\" Where COMMAND is one of:\\n\");\n\tprintf(\"  systembuid   print the system buid of the usbmuxd host\\n\");\n\tprintf(\"  hostid       print the host id for target device\\n\");\n\tprintf(\"  pair         pair device with this host\\n\");\n\tprintf(\"  validate     validate if device is paired with this host\\n\");\n\tprintf(\"  unpair       unpair device with this host\\n\");\n\tprintf(\"  list         list devices paired with this host\\n\\n\");\n\tprintf(\" The following OPTIONS are accepted:\\n\");\n\tprintf(\"  -d, --debug      enable communication debugging\\n\");\n\tprintf(\"  -u, --udid UDID  target specific device by its 40-digit device UDID\\n\");\n\tprintf(\"  -h, --help       prints usage information\\n\");\n\tprintf(\"\\n\");\n\tprintf(\"Homepage: <\" PACKAGE_URL \">\\n\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "idevice_set_debug_level",
          "args": [
            "1"
          ],
          "line": 110
        },
        "resolved": true,
        "details": {
          "function_name": "idevice_set_debug_level",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/idevice.c",
          "lines": "225-228",
          "snippet": "LIBIMOBILEDEVICE_API void idevice_set_debug_level(int level)\n{\n\tinternal_set_debug_level(level);\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"common/thread.h\"",
            "#include \"common/userpref.h\"",
            "#include \"idevice.h\"",
            "#include <gnutls/gnutls.h>",
            "#include <openssl/ssl.h>",
            "#include <openssl/err.h>",
            "#include <usbmuxd.h>",
            "#include <windows.h>",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"common/thread.h\"\n#include \"common/userpref.h\"\n#include \"idevice.h\"\n#include <gnutls/gnutls.h>\n#include <openssl/ssl.h>\n#include <openssl/err.h>\n#include <usbmuxd.h>\n#include <windows.h>\n#include <errno.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API void idevice_set_debug_level(int level)\n{\n\tinternal_set_debug_level(level);\n}"
        }
      },
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "optarg"
          ],
          "line": 107
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"%s: invalid UDID specified (length != 40)\\n\"",
            "argv[0]"
          ],
          "line": 103
        },
        "resolved": true,
        "details": {
          "function_name": "asprintf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/include/asprintf.h",
          "lines": "23-31",
          "snippet": "static inline int asprintf(char **PTR, const char *TEMPLATE, ...)\n{\n\tint res;\n\tva_list AP;\n\tva_start(AP, TEMPLATE);\n\tres = vasprintf(PTR, TEMPLATE, AP);\n\tva_end(AP);\n\treturn res;\n}",
          "includes": [
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <config.h>\n\nstatic inline int asprintf(char **PTR, const char *TEMPLATE, ...)\n{\n\tint res;\n\tva_list AP;\n\tva_start(AP, TEMPLATE);\n\tres = vasprintf(PTR, TEMPLATE, AP);\n\tva_end(AP);\n\treturn res;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "optarg"
          ],
          "line": 102
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getopt_long",
          "args": [
            "argc",
            "argv",
            "\"hu:d\"",
            "longopts",
            "(int*)0"
          ],
          "line": 92
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <libimobiledevice/lockdown.h>\n#include <libimobiledevice/libimobiledevice.h>\n#include \"common/userpref.h\"\n#include <getopt.h>\n#include <stdlib.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic char *udid = NULL;\n\nstatic void parse_opts(int argc, char **argv)\n{\n\tstatic struct option longopts[] = {\n\t\t{\"help\", 0, NULL, 'h'},\n\t\t{\"udid\", 1, NULL, 'u'},\n\t\t{\"debug\", 0, NULL, 'd'},\n\t\t{NULL, 0, NULL, 0}\n\t};\n\tint c;\n\n\twhile (1) {\n\t\tc = getopt_long(argc, argv, \"hu:d\", longopts, (int*)0);\n\t\tif (c == -1) {\n\t\t\tbreak;\n\t\t}\n\n\t\tswitch (c) {\n\t\tcase 'h':\n\t\t\tprint_usage(argc, argv);\n\t\t\texit(EXIT_SUCCESS);\n\t\tcase 'u':\n\t\t\tif (strlen(optarg) != 40) {\n\t\t\t\tprintf(\"%s: invalid UDID specified (length != 40)\\n\", argv[0]);\n\t\t\t\tprint_usage(argc, argv);\n\t\t\t\texit(2);\n\t\t\t}\n\t\t\tudid = strdup(optarg);\n\t\t\tbreak;\n\t\tcase 'd':\n\t\t\tidevice_set_debug_level(1);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tprint_usage(argc, argv);\n\t\t\texit(EXIT_SUCCESS);\n\t\t}\n\t}\n}"
  },
  {
    "function_name": "print_usage",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/tools/idevicepair.c",
    "lines": "59-79",
    "snippet": "static void print_usage(int argc, char **argv)\n{\n\tchar *name = NULL;\n\n\tname = strrchr(argv[0], '/');\n\tprintf(\"\\n%s - Manage host pairings with devices and usbmuxd.\\n\\n\", (name ? name + 1: argv[0]));\n\tprintf(\"Usage: %s [OPTIONS] COMMAND\\n\\n\", (name ? name + 1: argv[0]));\n\tprintf(\" Where COMMAND is one of:\\n\");\n\tprintf(\"  systembuid   print the system buid of the usbmuxd host\\n\");\n\tprintf(\"  hostid       print the host id for target device\\n\");\n\tprintf(\"  pair         pair device with this host\\n\");\n\tprintf(\"  validate     validate if device is paired with this host\\n\");\n\tprintf(\"  unpair       unpair device with this host\\n\");\n\tprintf(\"  list         list devices paired with this host\\n\\n\");\n\tprintf(\" The following OPTIONS are accepted:\\n\");\n\tprintf(\"  -d, --debug      enable communication debugging\\n\");\n\tprintf(\"  -u, --udid UDID  target specific device by its 40-digit device UDID\\n\");\n\tprintf(\"  -h, --help       prints usage information\\n\");\n\tprintf(\"\\n\");\n\tprintf(\"Homepage: <\" PACKAGE_URL \">\\n\");\n}",
    "includes": [
      "#include <libimobiledevice/lockdown.h>",
      "#include <libimobiledevice/libimobiledevice.h>",
      "#include \"common/userpref.h\"",
      "#include <getopt.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static char *udid = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"Homepage: <\" PACKAGE_URL \">\\n\""
          ],
          "line": 78
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"\\n\""
          ],
          "line": 77
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"  -h, --help       prints usage information\\n\""
          ],
          "line": 76
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"  -u, --udid UDID  target specific device by its 40-digit device UDID\\n\""
          ],
          "line": 75
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"  -d, --debug      enable communication debugging\\n\""
          ],
          "line": 74
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\" The following OPTIONS are accepted:\\n\""
          ],
          "line": 73
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"  list         list devices paired with this host\\n\\n\""
          ],
          "line": 72
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"  unpair       unpair device with this host\\n\""
          ],
          "line": 71
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"  validate     validate if device is paired with this host\\n\""
          ],
          "line": 70
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"  pair         pair device with this host\\n\""
          ],
          "line": 69
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"  hostid       print the host id for target device\\n\""
          ],
          "line": 68
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"  systembuid   print the system buid of the usbmuxd host\\n\""
          ],
          "line": 67
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\" Where COMMAND is one of:\\n\""
          ],
          "line": 66
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"Usage: %s [OPTIONS] COMMAND\\n\\n\"",
            "(name ? name + 1: argv[0])"
          ],
          "line": 65
        },
        "resolved": true,
        "details": {
          "function_name": "asprintf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/include/asprintf.h",
          "lines": "23-31",
          "snippet": "static inline int asprintf(char **PTR, const char *TEMPLATE, ...)\n{\n\tint res;\n\tva_list AP;\n\tva_start(AP, TEMPLATE);\n\tres = vasprintf(PTR, TEMPLATE, AP);\n\tva_end(AP);\n\treturn res;\n}",
          "includes": [
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <config.h>\n\nstatic inline int asprintf(char **PTR, const char *TEMPLATE, ...)\n{\n\tint res;\n\tva_list AP;\n\tva_start(AP, TEMPLATE);\n\tres = vasprintf(PTR, TEMPLATE, AP);\n\tva_end(AP);\n\treturn res;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strrchr",
          "args": [
            "argv[0]",
            "'/'"
          ],
          "line": 63
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <libimobiledevice/lockdown.h>\n#include <libimobiledevice/libimobiledevice.h>\n#include \"common/userpref.h\"\n#include <getopt.h>\n#include <stdlib.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic char *udid = NULL;\n\nstatic void print_usage(int argc, char **argv)\n{\n\tchar *name = NULL;\n\n\tname = strrchr(argv[0], '/');\n\tprintf(\"\\n%s - Manage host pairings with devices and usbmuxd.\\n\\n\", (name ? name + 1: argv[0]));\n\tprintf(\"Usage: %s [OPTIONS] COMMAND\\n\\n\", (name ? name + 1: argv[0]));\n\tprintf(\" Where COMMAND is one of:\\n\");\n\tprintf(\"  systembuid   print the system buid of the usbmuxd host\\n\");\n\tprintf(\"  hostid       print the host id for target device\\n\");\n\tprintf(\"  pair         pair device with this host\\n\");\n\tprintf(\"  validate     validate if device is paired with this host\\n\");\n\tprintf(\"  unpair       unpair device with this host\\n\");\n\tprintf(\"  list         list devices paired with this host\\n\\n\");\n\tprintf(\" The following OPTIONS are accepted:\\n\");\n\tprintf(\"  -d, --debug      enable communication debugging\\n\");\n\tprintf(\"  -u, --udid UDID  target specific device by its 40-digit device UDID\\n\");\n\tprintf(\"  -h, --help       prints usage information\\n\");\n\tprintf(\"\\n\");\n\tprintf(\"Homepage: <\" PACKAGE_URL \">\\n\");\n}"
  },
  {
    "function_name": "print_error_message",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/tools/idevicepair.c",
    "lines": "38-57",
    "snippet": "static void print_error_message(lockdownd_error_t err)\n{\n\tswitch (err) {\n\t\tcase LOCKDOWN_E_PASSWORD_PROTECTED:\n\t\t\tprintf(\"ERROR: Could not validate with device %s because a passcode is set. Please enter the passcode on the device and retry.\\n\", udid);\n\t\t\tbreak;\n\t\tcase LOCKDOWN_E_INVALID_HOST_ID:\n\t\t\tprintf(\"ERROR: Device %s is not paired with this host\\n\", udid);\n\t\t\tbreak;\n\t\tcase LOCKDOWN_E_PAIRING_DIALOG_RESPONSE_PENDING:\n\t\t\tprintf(\"ERROR: Please accept the trust dialog on the screen of device %s, then attempt to pair again.\\n\", udid);\n\t\t\tbreak;\n\t\tcase LOCKDOWN_E_USER_DENIED_PAIRING:\n\t\t\tprintf(\"ERROR: Device %s said that the user denied the trust dialog.\\n\", udid);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tprintf(\"ERROR: Device %s returned unhandled error code %d\\n\", udid, err);\n\t\t\tbreak;\n\t}\n}",
    "includes": [
      "#include <libimobiledevice/lockdown.h>",
      "#include <libimobiledevice/libimobiledevice.h>",
      "#include \"common/userpref.h\"",
      "#include <getopt.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static char *udid = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"ERROR: Device %s returned unhandled error code %d\\n\"",
            "udid",
            "err"
          ],
          "line": 54
        },
        "resolved": true,
        "details": {
          "function_name": "asprintf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/include/asprintf.h",
          "lines": "23-31",
          "snippet": "static inline int asprintf(char **PTR, const char *TEMPLATE, ...)\n{\n\tint res;\n\tva_list AP;\n\tva_start(AP, TEMPLATE);\n\tres = vasprintf(PTR, TEMPLATE, AP);\n\tva_end(AP);\n\treturn res;\n}",
          "includes": [
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <config.h>\n\nstatic inline int asprintf(char **PTR, const char *TEMPLATE, ...)\n{\n\tint res;\n\tva_list AP;\n\tva_start(AP, TEMPLATE);\n\tres = vasprintf(PTR, TEMPLATE, AP);\n\tva_end(AP);\n\treturn res;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <libimobiledevice/lockdown.h>\n#include <libimobiledevice/libimobiledevice.h>\n#include \"common/userpref.h\"\n#include <getopt.h>\n#include <stdlib.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic char *udid = NULL;\n\nstatic void print_error_message(lockdownd_error_t err)\n{\n\tswitch (err) {\n\t\tcase LOCKDOWN_E_PASSWORD_PROTECTED:\n\t\t\tprintf(\"ERROR: Could not validate with device %s because a passcode is set. Please enter the passcode on the device and retry.\\n\", udid);\n\t\t\tbreak;\n\t\tcase LOCKDOWN_E_INVALID_HOST_ID:\n\t\t\tprintf(\"ERROR: Device %s is not paired with this host\\n\", udid);\n\t\t\tbreak;\n\t\tcase LOCKDOWN_E_PAIRING_DIALOG_RESPONSE_PENDING:\n\t\t\tprintf(\"ERROR: Please accept the trust dialog on the screen of device %s, then attempt to pair again.\\n\", udid);\n\t\t\tbreak;\n\t\tcase LOCKDOWN_E_USER_DENIED_PAIRING:\n\t\t\tprintf(\"ERROR: Device %s said that the user denied the trust dialog.\\n\", udid);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tprintf(\"ERROR: Device %s returned unhandled error code %d\\n\", udid, err);\n\t\t\tbreak;\n\t}\n}"
  }
]