[
  {
    "function_name": "debugserver_client_set_argv",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/debugserver.c",
    "lines": "557-625",
    "snippet": "LIBIMOBILEDEVICE_API debugserver_error_t debugserver_client_set_argv(debugserver_client_t client, int argc, char* argv[], char** response)\n{\n\tif (!client || !argc)\n\t\treturn DEBUGSERVER_E_INVALID_ARG;\n\n\tdebugserver_error_t result = DEBUGSERVER_E_UNKNOWN_ERROR;\n\tchar *pkt = NULL;\n\tint pkt_len = 0;\n\tint i = 0;\n\n\t/* calculate total length */\n\twhile (i < argc && argv && argv[i]) {\n\t\tchar *prefix = NULL;\n\t\tasprintf(&prefix, \",%d,%d,\", (int)strlen(argv[i]) * 2, i);\n\t\tpkt_len += (int)strlen(prefix) + (int)strlen(argv[i]) * 2;\n\t\tfree(prefix);\n\t\ti++;\n\t}\n\n\t/* allocate packet and initialize it */\n\tpkt = (char *) malloc(pkt_len + 1);\n\tmemset(pkt, 0, pkt_len + 1);\n\n\tchar *pktp = pkt;\n\n\ti = 0;\n\twhile (i < argc && argv && argv[i]) {\n\t\tdebug_info(\"argv[%d] = \\\"%s\\\"\", i, argv[i]);\n\n\t\tchar *prefix = NULL;\n\t\tchar *m = NULL;\n\t\tint arg_len = strlen(argv[i]);\n\t\tint arg_hexlen = arg_len * 2;\n\n\t\tasprintf(&prefix, \",%d,%d,\", arg_hexlen, i);\n\n\t\tm = (char *) malloc(arg_hexlen);\n\t\tchar *p = m;\n\t\tchar *q = (char*)argv[i];\n\t\twhile (*q) {\n\t\t\t*p++ = debugserver_int2hex(*q >> 4);\n\t\t\t*p++ = debugserver_int2hex(*q & 0xf);\n\t\t\tq++;\n\t\t}\n\n\t\tmemcpy(pktp, prefix, strlen(prefix));\n\t\tpktp += strlen(prefix);\n\n\t\tmemcpy(pktp, m, arg_hexlen);\n\t\tpktp += arg_hexlen;\n\n\t\tfree(prefix);\n\t\tfree(m);\n\n\t\ti++;\n\t}\n\n\tpkt[0] = 'A';\n\n\tdebugserver_command_t command = NULL;\n\tdebugserver_command_new(pkt, 0, NULL, &command);\n\tresult = debugserver_client_send_command(client, command, response);\n\tdebugserver_command_free(command);\n\n\tif (pkt)\n\t\tfree(pkt);\n\n\treturn result;\n}",
    "includes": [
      "#include \"asprintf.h\"",
      "#include \"common/utils.h\"",
      "#include \"common/debug.h\"",
      "#include \"lockdown.h\"",
      "#include \"debugserver.h\"",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "pkt"
          ],
          "line": 622
        },
        "resolved": true,
        "details": {
          "function_name": "debugserver_command_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/debugserver.c",
          "lines": "181-203",
          "snippet": "LIBIMOBILEDEVICE_API debugserver_error_t debugserver_command_free(debugserver_command_t command)\n{\n\tint i;\n\tdebugserver_error_t res = DEBUGSERVER_E_UNKNOWN_ERROR;\n\n\tif (!command)\n\t\treturn DEBUGSERVER_E_INVALID_ARG;\n\n\tif (command) {\n\t\tif (command->name)\n\t\t\tfree(command->name);\n\t\tif (command->argv && command->argc) {\n\t\t\tfor (i = 0; i < command->argc; i++) {\n\t\t\t\tfree(command->argv[i]);\n\t\t\t}\n\t\t\tfree(command->argv);\n\t\t}\n\t\tfree(command);\n\t\tres = DEBUGSERVER_E_SUCCESS;\n\t}\n\n\treturn res;\n}",
          "includes": [
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/debug.h\"",
            "#include \"lockdown.h\"",
            "#include \"debugserver.h\"",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"debugserver.h\"\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API debugserver_error_t debugserver_command_free(debugserver_command_t command)\n{\n\tint i;\n\tdebugserver_error_t res = DEBUGSERVER_E_UNKNOWN_ERROR;\n\n\tif (!command)\n\t\treturn DEBUGSERVER_E_INVALID_ARG;\n\n\tif (command) {\n\t\tif (command->name)\n\t\t\tfree(command->name);\n\t\tif (command->argv && command->argc) {\n\t\t\tfor (i = 0; i < command->argc; i++) {\n\t\t\t\tfree(command->argv[i]);\n\t\t\t}\n\t\t\tfree(command->argv);\n\t\t}\n\t\tfree(command);\n\t\tres = DEBUGSERVER_E_SUCCESS;\n\t}\n\n\treturn res;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debugserver_client_send_command",
          "args": [
            "client",
            "command",
            "response"
          ],
          "line": 618
        },
        "resolved": true,
        "details": {
          "function_name": "debugserver_client_send_command",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/debugserver.c",
          "lines": "472-536",
          "snippet": "LIBIMOBILEDEVICE_API debugserver_error_t debugserver_client_send_command(debugserver_client_t client, debugserver_command_t command, char** response)\n{\n\tdebugserver_error_t res = DEBUGSERVER_E_SUCCESS;\n\tint i;\n\tuint32_t bytes = 0;\n\n\tchar* send_buffer = NULL;\n\tuint32_t send_buffer_size = 0;\n\n\tchar* command_arguments = NULL;\n\n\t/* concat all arguments */\n\tchar* tmp = NULL;\n\tchar* newtmp = NULL;\n\tfor (i = 0; i < command->argc; i++) {\n\t\tdebug_info(\"argv[%d]: %s\", i, command->argv[i]);\n\t\tif (!tmp) {\n\t\t\ttmp = strdup(command->argv[i]);\n\t\t} else {\n\t\t\tnewtmp = string_concat(tmp, command->argv[i], NULL);\n\t\t\tfree(tmp);\n\t\t\ttmp = newtmp;\n\t\t}\n\t}\n\tcommand_arguments = tmp;\n\ttmp = NULL;\n\n\tdebug_info(\"command_arguments(%d): %s\", command->argc, command_arguments);\n\n\t/* encode command arguments, add checksum if required and assemble entire command */\n\tdebugserver_format_command(\"$\", command->name, command_arguments, !client->noack_mode, &send_buffer, &send_buffer_size);\n\n\tdebug_info(\"sending encoded command: %s\", send_buffer);\n\n\tres = debugserver_client_send(client, send_buffer, send_buffer_size, &bytes);\n\tdebug_info(\"command result: %d\", res);\n\tif (res != DEBUGSERVER_E_SUCCESS) {\n\t\tgoto cleanup;\n\t}\n\n\t/* receive response */\n\tres = debugserver_client_receive_response(client, response);\n\tdebug_info(\"response result: %d\", res);\n\tif (res != DEBUGSERVER_E_SUCCESS) {\n\t\tgoto cleanup;\n\t}\n\n\tif (response) {\n\t\tdebug_info(\"received response: %s\", *response);\n\t}\n\n\t/* disable sending ack on the client */\n\tif (!strncmp(command->name, \"QStartNoAckMode\", 16)) {\n\t\tdebugserver_client_set_ack_mode(client, 0);\n\t}\n\ncleanup:\n\tif (command_arguments)\n\t\tfree(command_arguments);\n\n\tif (send_buffer)\n\t\tfree(send_buffer);\n\n\treturn res;\n}",
          "includes": [
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/debug.h\"",
            "#include \"lockdown.h\"",
            "#include \"debugserver.h\"",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"debugserver.h\"\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API debugserver_error_t debugserver_client_send_command(debugserver_client_t client, debugserver_command_t command, char** response)\n{\n\tdebugserver_error_t res = DEBUGSERVER_E_SUCCESS;\n\tint i;\n\tuint32_t bytes = 0;\n\n\tchar* send_buffer = NULL;\n\tuint32_t send_buffer_size = 0;\n\n\tchar* command_arguments = NULL;\n\n\t/* concat all arguments */\n\tchar* tmp = NULL;\n\tchar* newtmp = NULL;\n\tfor (i = 0; i < command->argc; i++) {\n\t\tdebug_info(\"argv[%d]: %s\", i, command->argv[i]);\n\t\tif (!tmp) {\n\t\t\ttmp = strdup(command->argv[i]);\n\t\t} else {\n\t\t\tnewtmp = string_concat(tmp, command->argv[i], NULL);\n\t\t\tfree(tmp);\n\t\t\ttmp = newtmp;\n\t\t}\n\t}\n\tcommand_arguments = tmp;\n\ttmp = NULL;\n\n\tdebug_info(\"command_arguments(%d): %s\", command->argc, command_arguments);\n\n\t/* encode command arguments, add checksum if required and assemble entire command */\n\tdebugserver_format_command(\"$\", command->name, command_arguments, !client->noack_mode, &send_buffer, &send_buffer_size);\n\n\tdebug_info(\"sending encoded command: %s\", send_buffer);\n\n\tres = debugserver_client_send(client, send_buffer, send_buffer_size, &bytes);\n\tdebug_info(\"command result: %d\", res);\n\tif (res != DEBUGSERVER_E_SUCCESS) {\n\t\tgoto cleanup;\n\t}\n\n\t/* receive response */\n\tres = debugserver_client_receive_response(client, response);\n\tdebug_info(\"response result: %d\", res);\n\tif (res != DEBUGSERVER_E_SUCCESS) {\n\t\tgoto cleanup;\n\t}\n\n\tif (response) {\n\t\tdebug_info(\"received response: %s\", *response);\n\t}\n\n\t/* disable sending ack on the client */\n\tif (!strncmp(command->name, \"QStartNoAckMode\", 16)) {\n\t\tdebugserver_client_set_ack_mode(client, 0);\n\t}\n\ncleanup:\n\tif (command_arguments)\n\t\tfree(command_arguments);\n\n\tif (send_buffer)\n\t\tfree(send_buffer);\n\n\treturn res;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debugserver_command_new",
          "args": [
            "pkt",
            "0",
            "NULL",
            "&command"
          ],
          "line": 617
        },
        "resolved": true,
        "details": {
          "function_name": "debugserver_command_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/debugserver.c",
          "lines": "156-179",
          "snippet": "LIBIMOBILEDEVICE_API debugserver_error_t debugserver_command_new(const char* name, int argc, char* argv[], debugserver_command_t* command)\n{\n\tint i;\n\tdebugserver_command_t tmp = (debugserver_command_t) malloc(sizeof(struct debugserver_command_private));\n\n\t/* copy name */\n\ttmp->name = strdup(name);\n\n\t/* copy arguments */\n\ttmp->argc = argc;\n\ttmp->argv = NULL;\n\tif (argc > 0) {\n\t\ttmp->argv = malloc(sizeof(char*) * (argc + 2));\n\t\tfor (i = 0; i < argc; i++) {\n\t\t\ttmp->argv[i] = strdup(argv[i]);\n\t\t}\n\t\ttmp->argv[i+1] = NULL;\n\t}\n\n\t/* return */\n\t*command = tmp;\n\n\treturn DEBUGSERVER_E_SUCCESS;\n}",
          "includes": [
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/debug.h\"",
            "#include \"lockdown.h\"",
            "#include \"debugserver.h\"",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"debugserver.h\"\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API debugserver_error_t debugserver_command_new(const char* name, int argc, char* argv[], debugserver_command_t* command)\n{\n\tint i;\n\tdebugserver_command_t tmp = (debugserver_command_t) malloc(sizeof(struct debugserver_command_private));\n\n\t/* copy name */\n\ttmp->name = strdup(name);\n\n\t/* copy arguments */\n\ttmp->argc = argc;\n\ttmp->argv = NULL;\n\tif (argc > 0) {\n\t\ttmp->argv = malloc(sizeof(char*) * (argc + 2));\n\t\tfor (i = 0; i < argc; i++) {\n\t\t\ttmp->argv[i] = strdup(argv[i]);\n\t\t}\n\t\ttmp->argv[i+1] = NULL;\n\t}\n\n\t/* return */\n\t*command = tmp;\n\n\treturn DEBUGSERVER_E_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "pktp",
            "m",
            "arg_hexlen"
          ],
          "line": 605
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "prefix"
          ],
          "line": 603
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "pktp",
            "prefix",
            "strlen(prefix)"
          ],
          "line": 602
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "prefix"
          ],
          "line": 602
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debugserver_int2hex",
          "args": [
            "*q & 0xf"
          ],
          "line": 598
        },
        "resolved": true,
        "details": {
          "function_name": "debugserver_int2hex",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/debugserver.c",
          "lines": "217-221",
          "snippet": "static char debugserver_int2hex(int x)\n{\n\tconst char *hexchars = \"0123456789ABCDEF\";\n\treturn hexchars[x];\n}",
          "includes": [
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/debug.h\"",
            "#include \"lockdown.h\"",
            "#include \"debugserver.h\"",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"debugserver.h\"\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic char debugserver_int2hex(int x)\n{\n\tconst char *hexchars = \"0123456789ABCDEF\";\n\treturn hexchars[x];\n}"
        }
      },
      {
        "call_info": {
          "callee": "malloc",
          "args": [
            "arg_hexlen"
          ],
          "line": 593
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "asprintf",
          "args": [
            "&prefix",
            "\",%d,%d,\"",
            "arg_hexlen",
            "i"
          ],
          "line": 591
        },
        "resolved": true,
        "details": {
          "function_name": "asprintf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/include/asprintf.h",
          "lines": "23-31",
          "snippet": "static inline int asprintf(char **PTR, const char *TEMPLATE, ...)\n{\n\tint res;\n\tva_list AP;\n\tva_start(AP, TEMPLATE);\n\tres = vasprintf(PTR, TEMPLATE, AP);\n\tva_end(AP);\n\treturn res;\n}",
          "includes": [
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <config.h>\n\nstatic inline int asprintf(char **PTR, const char *TEMPLATE, ...)\n{\n\tint res;\n\tva_list AP;\n\tva_start(AP, TEMPLATE);\n\tres = vasprintf(PTR, TEMPLATE, AP);\n\tva_end(AP);\n\treturn res;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "argv[i]"
          ],
          "line": 588
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"argv[%d] = \\\"%s\\\"\"",
            "i",
            "argv[i]"
          ],
          "line": 584
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "pkt",
            "0",
            "pkt_len + 1"
          ],
          "line": 578
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "malloc",
          "args": [
            "pkt_len + 1"
          ],
          "line": 577
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "argv[i]"
          ],
          "line": 571
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "prefix"
          ],
          "line": 571
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "argv[i]"
          ],
          "line": 570
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"debugserver.h\"\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API debugserver_error_t debugserver_client_set_argv(debugserver_client_t client, int argc, char* argv[], char** response)\n{\n\tif (!client || !argc)\n\t\treturn DEBUGSERVER_E_INVALID_ARG;\n\n\tdebugserver_error_t result = DEBUGSERVER_E_UNKNOWN_ERROR;\n\tchar *pkt = NULL;\n\tint pkt_len = 0;\n\tint i = 0;\n\n\t/* calculate total length */\n\twhile (i < argc && argv && argv[i]) {\n\t\tchar *prefix = NULL;\n\t\tasprintf(&prefix, \",%d,%d,\", (int)strlen(argv[i]) * 2, i);\n\t\tpkt_len += (int)strlen(prefix) + (int)strlen(argv[i]) * 2;\n\t\tfree(prefix);\n\t\ti++;\n\t}\n\n\t/* allocate packet and initialize it */\n\tpkt = (char *) malloc(pkt_len + 1);\n\tmemset(pkt, 0, pkt_len + 1);\n\n\tchar *pktp = pkt;\n\n\ti = 0;\n\twhile (i < argc && argv && argv[i]) {\n\t\tdebug_info(\"argv[%d] = \\\"%s\\\"\", i, argv[i]);\n\n\t\tchar *prefix = NULL;\n\t\tchar *m = NULL;\n\t\tint arg_len = strlen(argv[i]);\n\t\tint arg_hexlen = arg_len * 2;\n\n\t\tasprintf(&prefix, \",%d,%d,\", arg_hexlen, i);\n\n\t\tm = (char *) malloc(arg_hexlen);\n\t\tchar *p = m;\n\t\tchar *q = (char*)argv[i];\n\t\twhile (*q) {\n\t\t\t*p++ = debugserver_int2hex(*q >> 4);\n\t\t\t*p++ = debugserver_int2hex(*q & 0xf);\n\t\t\tq++;\n\t\t}\n\n\t\tmemcpy(pktp, prefix, strlen(prefix));\n\t\tpktp += strlen(prefix);\n\n\t\tmemcpy(pktp, m, arg_hexlen);\n\t\tpktp += arg_hexlen;\n\n\t\tfree(prefix);\n\t\tfree(m);\n\n\t\ti++;\n\t}\n\n\tpkt[0] = 'A';\n\n\tdebugserver_command_t command = NULL;\n\tdebugserver_command_new(pkt, 0, NULL, &command);\n\tresult = debugserver_client_send_command(client, command, response);\n\tdebugserver_command_free(command);\n\n\tif (pkt)\n\t\tfree(pkt);\n\n\treturn result;\n}"
  },
  {
    "function_name": "debugserver_client_set_environment_hex_encoded",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/debugserver.c",
    "lines": "538-555",
    "snippet": "LIBIMOBILEDEVICE_API debugserver_error_t debugserver_client_set_environment_hex_encoded(debugserver_client_t client, const char* env, char** response)\n{\n\tif (!client || !env)\n\t\treturn DEBUGSERVER_E_INVALID_ARG;\n\n\tdebugserver_error_t result = DEBUGSERVER_E_UNKNOWN_ERROR;\n\tchar* env_tmp = strdup(env);\n\tchar* env_arg[2] = { env_tmp, NULL };\n\n\tdebugserver_command_t command = NULL;\n\tdebugserver_command_new(\"QEnvironmentHexEncoded:\", 1, env_arg, &command);\n\tresult = debugserver_client_send_command(client, command, response);\n\tdebugserver_command_free(command);\n\n\tfree(env_tmp);\n\n\treturn result;\n}",
    "includes": [
      "#include \"asprintf.h\"",
      "#include \"common/utils.h\"",
      "#include \"common/debug.h\"",
      "#include \"lockdown.h\"",
      "#include \"debugserver.h\"",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "env_tmp"
          ],
          "line": 552
        },
        "resolved": true,
        "details": {
          "function_name": "debugserver_command_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/debugserver.c",
          "lines": "181-203",
          "snippet": "LIBIMOBILEDEVICE_API debugserver_error_t debugserver_command_free(debugserver_command_t command)\n{\n\tint i;\n\tdebugserver_error_t res = DEBUGSERVER_E_UNKNOWN_ERROR;\n\n\tif (!command)\n\t\treturn DEBUGSERVER_E_INVALID_ARG;\n\n\tif (command) {\n\t\tif (command->name)\n\t\t\tfree(command->name);\n\t\tif (command->argv && command->argc) {\n\t\t\tfor (i = 0; i < command->argc; i++) {\n\t\t\t\tfree(command->argv[i]);\n\t\t\t}\n\t\t\tfree(command->argv);\n\t\t}\n\t\tfree(command);\n\t\tres = DEBUGSERVER_E_SUCCESS;\n\t}\n\n\treturn res;\n}",
          "includes": [
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/debug.h\"",
            "#include \"lockdown.h\"",
            "#include \"debugserver.h\"",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"debugserver.h\"\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API debugserver_error_t debugserver_command_free(debugserver_command_t command)\n{\n\tint i;\n\tdebugserver_error_t res = DEBUGSERVER_E_UNKNOWN_ERROR;\n\n\tif (!command)\n\t\treturn DEBUGSERVER_E_INVALID_ARG;\n\n\tif (command) {\n\t\tif (command->name)\n\t\t\tfree(command->name);\n\t\tif (command->argv && command->argc) {\n\t\t\tfor (i = 0; i < command->argc; i++) {\n\t\t\t\tfree(command->argv[i]);\n\t\t\t}\n\t\t\tfree(command->argv);\n\t\t}\n\t\tfree(command);\n\t\tres = DEBUGSERVER_E_SUCCESS;\n\t}\n\n\treturn res;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debugserver_client_send_command",
          "args": [
            "client",
            "command",
            "response"
          ],
          "line": 549
        },
        "resolved": true,
        "details": {
          "function_name": "debugserver_client_send_command",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/debugserver.c",
          "lines": "472-536",
          "snippet": "LIBIMOBILEDEVICE_API debugserver_error_t debugserver_client_send_command(debugserver_client_t client, debugserver_command_t command, char** response)\n{\n\tdebugserver_error_t res = DEBUGSERVER_E_SUCCESS;\n\tint i;\n\tuint32_t bytes = 0;\n\n\tchar* send_buffer = NULL;\n\tuint32_t send_buffer_size = 0;\n\n\tchar* command_arguments = NULL;\n\n\t/* concat all arguments */\n\tchar* tmp = NULL;\n\tchar* newtmp = NULL;\n\tfor (i = 0; i < command->argc; i++) {\n\t\tdebug_info(\"argv[%d]: %s\", i, command->argv[i]);\n\t\tif (!tmp) {\n\t\t\ttmp = strdup(command->argv[i]);\n\t\t} else {\n\t\t\tnewtmp = string_concat(tmp, command->argv[i], NULL);\n\t\t\tfree(tmp);\n\t\t\ttmp = newtmp;\n\t\t}\n\t}\n\tcommand_arguments = tmp;\n\ttmp = NULL;\n\n\tdebug_info(\"command_arguments(%d): %s\", command->argc, command_arguments);\n\n\t/* encode command arguments, add checksum if required and assemble entire command */\n\tdebugserver_format_command(\"$\", command->name, command_arguments, !client->noack_mode, &send_buffer, &send_buffer_size);\n\n\tdebug_info(\"sending encoded command: %s\", send_buffer);\n\n\tres = debugserver_client_send(client, send_buffer, send_buffer_size, &bytes);\n\tdebug_info(\"command result: %d\", res);\n\tif (res != DEBUGSERVER_E_SUCCESS) {\n\t\tgoto cleanup;\n\t}\n\n\t/* receive response */\n\tres = debugserver_client_receive_response(client, response);\n\tdebug_info(\"response result: %d\", res);\n\tif (res != DEBUGSERVER_E_SUCCESS) {\n\t\tgoto cleanup;\n\t}\n\n\tif (response) {\n\t\tdebug_info(\"received response: %s\", *response);\n\t}\n\n\t/* disable sending ack on the client */\n\tif (!strncmp(command->name, \"QStartNoAckMode\", 16)) {\n\t\tdebugserver_client_set_ack_mode(client, 0);\n\t}\n\ncleanup:\n\tif (command_arguments)\n\t\tfree(command_arguments);\n\n\tif (send_buffer)\n\t\tfree(send_buffer);\n\n\treturn res;\n}",
          "includes": [
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/debug.h\"",
            "#include \"lockdown.h\"",
            "#include \"debugserver.h\"",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"debugserver.h\"\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API debugserver_error_t debugserver_client_send_command(debugserver_client_t client, debugserver_command_t command, char** response)\n{\n\tdebugserver_error_t res = DEBUGSERVER_E_SUCCESS;\n\tint i;\n\tuint32_t bytes = 0;\n\n\tchar* send_buffer = NULL;\n\tuint32_t send_buffer_size = 0;\n\n\tchar* command_arguments = NULL;\n\n\t/* concat all arguments */\n\tchar* tmp = NULL;\n\tchar* newtmp = NULL;\n\tfor (i = 0; i < command->argc; i++) {\n\t\tdebug_info(\"argv[%d]: %s\", i, command->argv[i]);\n\t\tif (!tmp) {\n\t\t\ttmp = strdup(command->argv[i]);\n\t\t} else {\n\t\t\tnewtmp = string_concat(tmp, command->argv[i], NULL);\n\t\t\tfree(tmp);\n\t\t\ttmp = newtmp;\n\t\t}\n\t}\n\tcommand_arguments = tmp;\n\ttmp = NULL;\n\n\tdebug_info(\"command_arguments(%d): %s\", command->argc, command_arguments);\n\n\t/* encode command arguments, add checksum if required and assemble entire command */\n\tdebugserver_format_command(\"$\", command->name, command_arguments, !client->noack_mode, &send_buffer, &send_buffer_size);\n\n\tdebug_info(\"sending encoded command: %s\", send_buffer);\n\n\tres = debugserver_client_send(client, send_buffer, send_buffer_size, &bytes);\n\tdebug_info(\"command result: %d\", res);\n\tif (res != DEBUGSERVER_E_SUCCESS) {\n\t\tgoto cleanup;\n\t}\n\n\t/* receive response */\n\tres = debugserver_client_receive_response(client, response);\n\tdebug_info(\"response result: %d\", res);\n\tif (res != DEBUGSERVER_E_SUCCESS) {\n\t\tgoto cleanup;\n\t}\n\n\tif (response) {\n\t\tdebug_info(\"received response: %s\", *response);\n\t}\n\n\t/* disable sending ack on the client */\n\tif (!strncmp(command->name, \"QStartNoAckMode\", 16)) {\n\t\tdebugserver_client_set_ack_mode(client, 0);\n\t}\n\ncleanup:\n\tif (command_arguments)\n\t\tfree(command_arguments);\n\n\tif (send_buffer)\n\t\tfree(send_buffer);\n\n\treturn res;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debugserver_command_new",
          "args": [
            "\"QEnvironmentHexEncoded:\"",
            "1",
            "env_arg",
            "&command"
          ],
          "line": 548
        },
        "resolved": true,
        "details": {
          "function_name": "debugserver_command_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/debugserver.c",
          "lines": "156-179",
          "snippet": "LIBIMOBILEDEVICE_API debugserver_error_t debugserver_command_new(const char* name, int argc, char* argv[], debugserver_command_t* command)\n{\n\tint i;\n\tdebugserver_command_t tmp = (debugserver_command_t) malloc(sizeof(struct debugserver_command_private));\n\n\t/* copy name */\n\ttmp->name = strdup(name);\n\n\t/* copy arguments */\n\ttmp->argc = argc;\n\ttmp->argv = NULL;\n\tif (argc > 0) {\n\t\ttmp->argv = malloc(sizeof(char*) * (argc + 2));\n\t\tfor (i = 0; i < argc; i++) {\n\t\t\ttmp->argv[i] = strdup(argv[i]);\n\t\t}\n\t\ttmp->argv[i+1] = NULL;\n\t}\n\n\t/* return */\n\t*command = tmp;\n\n\treturn DEBUGSERVER_E_SUCCESS;\n}",
          "includes": [
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/debug.h\"",
            "#include \"lockdown.h\"",
            "#include \"debugserver.h\"",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"debugserver.h\"\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API debugserver_error_t debugserver_command_new(const char* name, int argc, char* argv[], debugserver_command_t* command)\n{\n\tint i;\n\tdebugserver_command_t tmp = (debugserver_command_t) malloc(sizeof(struct debugserver_command_private));\n\n\t/* copy name */\n\ttmp->name = strdup(name);\n\n\t/* copy arguments */\n\ttmp->argc = argc;\n\ttmp->argv = NULL;\n\tif (argc > 0) {\n\t\ttmp->argv = malloc(sizeof(char*) * (argc + 2));\n\t\tfor (i = 0; i < argc; i++) {\n\t\t\ttmp->argv[i] = strdup(argv[i]);\n\t\t}\n\t\ttmp->argv[i+1] = NULL;\n\t}\n\n\t/* return */\n\t*command = tmp;\n\n\treturn DEBUGSERVER_E_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "env"
          ],
          "line": 544
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"debugserver.h\"\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API debugserver_error_t debugserver_client_set_environment_hex_encoded(debugserver_client_t client, const char* env, char** response)\n{\n\tif (!client || !env)\n\t\treturn DEBUGSERVER_E_INVALID_ARG;\n\n\tdebugserver_error_t result = DEBUGSERVER_E_UNKNOWN_ERROR;\n\tchar* env_tmp = strdup(env);\n\tchar* env_arg[2] = { env_tmp, NULL };\n\n\tdebugserver_command_t command = NULL;\n\tdebugserver_command_new(\"QEnvironmentHexEncoded:\", 1, env_arg, &command);\n\tresult = debugserver_client_send_command(client, command, response);\n\tdebugserver_command_free(command);\n\n\tfree(env_tmp);\n\n\treturn result;\n}"
  },
  {
    "function_name": "debugserver_client_send_command",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/debugserver.c",
    "lines": "472-536",
    "snippet": "LIBIMOBILEDEVICE_API debugserver_error_t debugserver_client_send_command(debugserver_client_t client, debugserver_command_t command, char** response)\n{\n\tdebugserver_error_t res = DEBUGSERVER_E_SUCCESS;\n\tint i;\n\tuint32_t bytes = 0;\n\n\tchar* send_buffer = NULL;\n\tuint32_t send_buffer_size = 0;\n\n\tchar* command_arguments = NULL;\n\n\t/* concat all arguments */\n\tchar* tmp = NULL;\n\tchar* newtmp = NULL;\n\tfor (i = 0; i < command->argc; i++) {\n\t\tdebug_info(\"argv[%d]: %s\", i, command->argv[i]);\n\t\tif (!tmp) {\n\t\t\ttmp = strdup(command->argv[i]);\n\t\t} else {\n\t\t\tnewtmp = string_concat(tmp, command->argv[i], NULL);\n\t\t\tfree(tmp);\n\t\t\ttmp = newtmp;\n\t\t}\n\t}\n\tcommand_arguments = tmp;\n\ttmp = NULL;\n\n\tdebug_info(\"command_arguments(%d): %s\", command->argc, command_arguments);\n\n\t/* encode command arguments, add checksum if required and assemble entire command */\n\tdebugserver_format_command(\"$\", command->name, command_arguments, !client->noack_mode, &send_buffer, &send_buffer_size);\n\n\tdebug_info(\"sending encoded command: %s\", send_buffer);\n\n\tres = debugserver_client_send(client, send_buffer, send_buffer_size, &bytes);\n\tdebug_info(\"command result: %d\", res);\n\tif (res != DEBUGSERVER_E_SUCCESS) {\n\t\tgoto cleanup;\n\t}\n\n\t/* receive response */\n\tres = debugserver_client_receive_response(client, response);\n\tdebug_info(\"response result: %d\", res);\n\tif (res != DEBUGSERVER_E_SUCCESS) {\n\t\tgoto cleanup;\n\t}\n\n\tif (response) {\n\t\tdebug_info(\"received response: %s\", *response);\n\t}\n\n\t/* disable sending ack on the client */\n\tif (!strncmp(command->name, \"QStartNoAckMode\", 16)) {\n\t\tdebugserver_client_set_ack_mode(client, 0);\n\t}\n\ncleanup:\n\tif (command_arguments)\n\t\tfree(command_arguments);\n\n\tif (send_buffer)\n\t\tfree(send_buffer);\n\n\treturn res;\n}",
    "includes": [
      "#include \"asprintf.h\"",
      "#include \"common/utils.h\"",
      "#include \"common/debug.h\"",
      "#include \"lockdown.h\"",
      "#include \"debugserver.h\"",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "send_buffer"
          ],
          "line": 533
        },
        "resolved": true,
        "details": {
          "function_name": "debugserver_command_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/debugserver.c",
          "lines": "181-203",
          "snippet": "LIBIMOBILEDEVICE_API debugserver_error_t debugserver_command_free(debugserver_command_t command)\n{\n\tint i;\n\tdebugserver_error_t res = DEBUGSERVER_E_UNKNOWN_ERROR;\n\n\tif (!command)\n\t\treturn DEBUGSERVER_E_INVALID_ARG;\n\n\tif (command) {\n\t\tif (command->name)\n\t\t\tfree(command->name);\n\t\tif (command->argv && command->argc) {\n\t\t\tfor (i = 0; i < command->argc; i++) {\n\t\t\t\tfree(command->argv[i]);\n\t\t\t}\n\t\t\tfree(command->argv);\n\t\t}\n\t\tfree(command);\n\t\tres = DEBUGSERVER_E_SUCCESS;\n\t}\n\n\treturn res;\n}",
          "includes": [
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/debug.h\"",
            "#include \"lockdown.h\"",
            "#include \"debugserver.h\"",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"debugserver.h\"\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API debugserver_error_t debugserver_command_free(debugserver_command_t command)\n{\n\tint i;\n\tdebugserver_error_t res = DEBUGSERVER_E_UNKNOWN_ERROR;\n\n\tif (!command)\n\t\treturn DEBUGSERVER_E_INVALID_ARG;\n\n\tif (command) {\n\t\tif (command->name)\n\t\t\tfree(command->name);\n\t\tif (command->argv && command->argc) {\n\t\t\tfor (i = 0; i < command->argc; i++) {\n\t\t\t\tfree(command->argv[i]);\n\t\t\t}\n\t\t\tfree(command->argv);\n\t\t}\n\t\tfree(command);\n\t\tres = DEBUGSERVER_E_SUCCESS;\n\t}\n\n\treturn res;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debugserver_client_set_ack_mode",
          "args": [
            "client",
            "0"
          ],
          "line": 525
        },
        "resolved": true,
        "details": {
          "function_name": "debugserver_client_set_ack_mode",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/debugserver.c",
          "lines": "334-344",
          "snippet": "LIBIMOBILEDEVICE_API debugserver_error_t debugserver_client_set_ack_mode(debugserver_client_t client, int enabled)\n{\n\tif (!client)\n\t\treturn DEBUGSERVER_E_INVALID_ARG;\n\n\tclient->noack_mode = (enabled == 0)? 1: 0;\n\n\tdebug_info(\"ack mode: %s\", client->noack_mode == 0 ? \"on\": \"off\");\n\n\treturn DEBUGSERVER_E_SUCCESS;\n}",
          "includes": [
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/debug.h\"",
            "#include \"lockdown.h\"",
            "#include \"debugserver.h\"",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"debugserver.h\"\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API debugserver_error_t debugserver_client_set_ack_mode(debugserver_client_t client, int enabled)\n{\n\tif (!client)\n\t\treturn DEBUGSERVER_E_INVALID_ARG;\n\n\tclient->noack_mode = (enabled == 0)? 1: 0;\n\n\tdebug_info(\"ack mode: %s\", client->noack_mode == 0 ? \"on\": \"off\");\n\n\treturn DEBUGSERVER_E_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strncmp",
          "args": [
            "command->name",
            "\"QStartNoAckMode\"",
            "16"
          ],
          "line": 524
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"received response: %s\"",
            "*response"
          ],
          "line": 520
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"response result: %d\"",
            "res"
          ],
          "line": 514
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debugserver_client_receive_response",
          "args": [
            "client",
            "response"
          ],
          "line": 513
        },
        "resolved": true,
        "details": {
          "function_name": "debugserver_client_receive_response",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/debugserver.c",
          "lines": "370-470",
          "snippet": "LIBIMOBILEDEVICE_API debugserver_error_t debugserver_client_receive_response(debugserver_client_t client, char** response)\n{\n\tdebugserver_error_t res = DEBUGSERVER_E_SUCCESS;\n\n\tint should_receive = 1;\n\tint skip_prefix = 0;\n\tchar* command_prefix = strdup(\"$\");\n\n\tchar* buffer = NULL;\n\tuint32_t buffer_size = 0;\n\n\tif (response)\n\t\t*response = NULL;\n\n\tif (!client->noack_mode) {\n\t\tchar ack[2] = {'+', '\\0'};\n\t\tdebug_info(\"attempting to receive ACK %c\", *ack);\n\t\tshould_receive = debugserver_client_receive_internal_check(client, ack);\n\t\tdebug_info(\"received char: %c\", *ack);\n\t\tif (strncmp(ack, command_prefix, sizeof(char)) == 0) {\n\t\t\tshould_receive = 1;\n\t\t\tskip_prefix = 1;\n\t\t\tbuffer = strdup(command_prefix);\n\t\t\tbuffer_size += sizeof(char);\n\t\t\tdebug_info(\"received ACK\");\n\t\t}\n\t}\n\n\tdebug_info(\"should_receive: %d, skip_prefix: %d\", should_receive, skip_prefix);\n\n\tif (should_receive && !skip_prefix) {\n\t\tdebug_info(\"attempting to receive prefix\");\n\t\tshould_receive = debugserver_client_receive_internal_check(client, command_prefix);\n\t\tdebug_info(\"received command_prefix: %c\", *command_prefix);\n\t\tif (should_receive) {\n\t\t\tif (buffer) {\n\t\t\t\tmemcpy(buffer, command_prefix, sizeof(char));\n\t\t\t} else {\n\t\t\t\tbuffer = strdup(command_prefix);\n\t\t\t\tbuffer_size += sizeof(char);\n\t\t\t}\n\t\t}\n\t}\n\n\tdebug_info(\"buffer: %*s, should_receive: %d, skip_prefix: %d\", buffer_size, buffer, should_receive, skip_prefix);\n\n\tif (should_receive) {\n\t\tuint32_t checksum_length = DEBUGSERVER_CHECKSUM_HASH_LENGTH;\n\t\tint receiving_checksum_response = 0;\n\t\tdebug_info(\"attempting to read up response until checksum\");\n\t\twhile ((checksum_length > 0)) {\n\t\t\tchar data[2] = {'#', '\\0'};\n\t\t\tif (debugserver_client_receive_internal_check(client, data)) {\n\t\t\t\treceiving_checksum_response = 1;\n\t\t\t}\n\t\t\tif (receiving_checksum_response) {\n\t\t\t\tchecksum_length--;\n\t\t\t}\n\t\t\tchar* newbuffer = string_concat(buffer, data, NULL);\n\t\t\tbuffer_size += sizeof(char);\n\t\t\tfree(buffer);\n\t\t\tbuffer = NULL;\n\t\t\tbuffer = newbuffer;\n\t\t\tnewbuffer = NULL;\n\t\t}\n\t\tdebug_info(\"validating response checksum...\");\n\t\tint valid_response = debugserver_response_is_checksum_valid(buffer, buffer_size);\n\t\tif (valid_response) {\n\t\t\tif (response) {\n\t\t\t\t/* assemble response string */\n\t\t\t\tuint32_t response_size = sizeof(char) * (buffer_size - DEBUGSERVER_CHECKSUM_HASH_LENGTH - 1);\n\t\t\t\t*response = (char*)malloc(response_size + 1);\n\t\t\t\tmemcpy(*response, buffer + 1, response_size);\n\t\t\t\t(*response)[response_size] = '\\0';\n\t\t\t}\n\t\t\tif (!client->noack_mode) {\n\t\t\t\t/* confirm valid command */\n\t\t\t\tdebugserver_client_send_ack(client);\n\t\t\t}\n\t\t} else {\n\t\t\t/* response was invalid */\n\t\t\tres = DEBUGSERVER_E_RESPONSE_ERROR;\n\t\t\tif (!client->noack_mode) {\n\t\t\t\t/* report invalid command */\n\t\t\t\tdebugserver_client_send_noack(client);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (response) {\n\t\tdebug_info(\"response: %s\", *response);\n\t}\n\n\tif (buffer)\n\t\tfree(buffer);\n\n\tif (command_prefix)\n\t\tfree(command_prefix);\n\n\treturn res;\n}",
          "includes": [
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/debug.h\"",
            "#include \"lockdown.h\"",
            "#include \"debugserver.h\"",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"debugserver.h\"\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API debugserver_error_t debugserver_client_receive_response(debugserver_client_t client, char** response)\n{\n\tdebugserver_error_t res = DEBUGSERVER_E_SUCCESS;\n\n\tint should_receive = 1;\n\tint skip_prefix = 0;\n\tchar* command_prefix = strdup(\"$\");\n\n\tchar* buffer = NULL;\n\tuint32_t buffer_size = 0;\n\n\tif (response)\n\t\t*response = NULL;\n\n\tif (!client->noack_mode) {\n\t\tchar ack[2] = {'+', '\\0'};\n\t\tdebug_info(\"attempting to receive ACK %c\", *ack);\n\t\tshould_receive = debugserver_client_receive_internal_check(client, ack);\n\t\tdebug_info(\"received char: %c\", *ack);\n\t\tif (strncmp(ack, command_prefix, sizeof(char)) == 0) {\n\t\t\tshould_receive = 1;\n\t\t\tskip_prefix = 1;\n\t\t\tbuffer = strdup(command_prefix);\n\t\t\tbuffer_size += sizeof(char);\n\t\t\tdebug_info(\"received ACK\");\n\t\t}\n\t}\n\n\tdebug_info(\"should_receive: %d, skip_prefix: %d\", should_receive, skip_prefix);\n\n\tif (should_receive && !skip_prefix) {\n\t\tdebug_info(\"attempting to receive prefix\");\n\t\tshould_receive = debugserver_client_receive_internal_check(client, command_prefix);\n\t\tdebug_info(\"received command_prefix: %c\", *command_prefix);\n\t\tif (should_receive) {\n\t\t\tif (buffer) {\n\t\t\t\tmemcpy(buffer, command_prefix, sizeof(char));\n\t\t\t} else {\n\t\t\t\tbuffer = strdup(command_prefix);\n\t\t\t\tbuffer_size += sizeof(char);\n\t\t\t}\n\t\t}\n\t}\n\n\tdebug_info(\"buffer: %*s, should_receive: %d, skip_prefix: %d\", buffer_size, buffer, should_receive, skip_prefix);\n\n\tif (should_receive) {\n\t\tuint32_t checksum_length = DEBUGSERVER_CHECKSUM_HASH_LENGTH;\n\t\tint receiving_checksum_response = 0;\n\t\tdebug_info(\"attempting to read up response until checksum\");\n\t\twhile ((checksum_length > 0)) {\n\t\t\tchar data[2] = {'#', '\\0'};\n\t\t\tif (debugserver_client_receive_internal_check(client, data)) {\n\t\t\t\treceiving_checksum_response = 1;\n\t\t\t}\n\t\t\tif (receiving_checksum_response) {\n\t\t\t\tchecksum_length--;\n\t\t\t}\n\t\t\tchar* newbuffer = string_concat(buffer, data, NULL);\n\t\t\tbuffer_size += sizeof(char);\n\t\t\tfree(buffer);\n\t\t\tbuffer = NULL;\n\t\t\tbuffer = newbuffer;\n\t\t\tnewbuffer = NULL;\n\t\t}\n\t\tdebug_info(\"validating response checksum...\");\n\t\tint valid_response = debugserver_response_is_checksum_valid(buffer, buffer_size);\n\t\tif (valid_response) {\n\t\t\tif (response) {\n\t\t\t\t/* assemble response string */\n\t\t\t\tuint32_t response_size = sizeof(char) * (buffer_size - DEBUGSERVER_CHECKSUM_HASH_LENGTH - 1);\n\t\t\t\t*response = (char*)malloc(response_size + 1);\n\t\t\t\tmemcpy(*response, buffer + 1, response_size);\n\t\t\t\t(*response)[response_size] = '\\0';\n\t\t\t}\n\t\t\tif (!client->noack_mode) {\n\t\t\t\t/* confirm valid command */\n\t\t\t\tdebugserver_client_send_ack(client);\n\t\t\t}\n\t\t} else {\n\t\t\t/* response was invalid */\n\t\t\tres = DEBUGSERVER_E_RESPONSE_ERROR;\n\t\t\tif (!client->noack_mode) {\n\t\t\t\t/* report invalid command */\n\t\t\t\tdebugserver_client_send_noack(client);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (response) {\n\t\tdebug_info(\"response: %s\", *response);\n\t}\n\n\tif (buffer)\n\t\tfree(buffer);\n\n\tif (command_prefix)\n\t\tfree(command_prefix);\n\n\treturn res;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"command result: %d\"",
            "res"
          ],
          "line": 507
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debugserver_client_send",
          "args": [
            "client",
            "send_buffer",
            "send_buffer_size",
            "&bytes"
          ],
          "line": 506
        },
        "resolved": true,
        "details": {
          "function_name": "debugserver_client_send",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/debugserver.c",
          "lines": "110-129",
          "snippet": "LIBIMOBILEDEVICE_API debugserver_error_t debugserver_client_send(debugserver_client_t client, const char* data, uint32_t size, uint32_t *sent)\n{\n\tdebugserver_error_t res = DEBUGSERVER_E_UNKNOWN_ERROR;\n\tint bytes = 0;\n\n\tif (!client || !data || (size == 0)) {\n\t\treturn DEBUGSERVER_E_INVALID_ARG;\n\t}\n\n\tdebug_info(\"sending %d bytes\", size);\n\tres = debugserver_error(service_send(client->parent, data, size, (uint32_t*)&bytes));\n\tif (bytes <= 0) {\n\t\tdebug_info(\"ERROR: sending to device failed.\");\n\t}\n\tif (sent) {\n\t\t*sent = (uint32_t)bytes;\n\t}\n\n\treturn res;\n}",
          "includes": [
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/debug.h\"",
            "#include \"lockdown.h\"",
            "#include \"debugserver.h\"",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"debugserver.h\"\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API debugserver_error_t debugserver_client_send(debugserver_client_t client, const char* data, uint32_t size, uint32_t *sent)\n{\n\tdebugserver_error_t res = DEBUGSERVER_E_UNKNOWN_ERROR;\n\tint bytes = 0;\n\n\tif (!client || !data || (size == 0)) {\n\t\treturn DEBUGSERVER_E_INVALID_ARG;\n\t}\n\n\tdebug_info(\"sending %d bytes\", size);\n\tres = debugserver_error(service_send(client->parent, data, size, (uint32_t*)&bytes));\n\tif (bytes <= 0) {\n\t\tdebug_info(\"ERROR: sending to device failed.\");\n\t}\n\tif (sent) {\n\t\t*sent = (uint32_t)bytes;\n\t}\n\n\treturn res;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"sending encoded command: %s\"",
            "send_buffer"
          ],
          "line": 504
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debugserver_format_command",
          "args": [
            "\"$\"",
            "command->name",
            "command_arguments",
            "!client->noack_mode",
            "&send_buffer",
            "&send_buffer_size"
          ],
          "line": 502
        },
        "resolved": true,
        "details": {
          "function_name": "debugserver_format_command",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/debugserver.c",
          "lines": "288-320",
          "snippet": "static void debugserver_format_command(const char* prefix, const char* command, const char* arguments, int calculate_checksum, char** buffer, uint32_t* size)\n{\n\tchar checksum_hash[DEBUGSERVER_CHECKSUM_HASH_LENGTH + 1] = {'#', '0', '0', '\\0'};\n\tchar* encoded = NULL;\n\tuint32_t encoded_length = 0;\n\n\tif (arguments) {\n\t\t/* arguments must be hex encoded */\n\t\tdebugserver_encode_string(arguments, &encoded, &encoded_length);\n\t} else {\n\t\tencoded = NULL;\n\t}\n\n\tchar* encoded_command = string_concat(command, encoded, NULL);\n\tencoded_length = strlen(encoded_command);\n\n\tif (calculate_checksum) {\n\t\tuint32_t checksum = debugserver_get_checksum_for_buffer(encoded_command, encoded_length);\n\t\tchecksum_hash[1] = DEBUGSERVER_HEX_ENCODE_FIRST_BYTE(checksum);\n\t\tchecksum_hash[2] = DEBUGSERVER_HEX_ENCODE_SECOND_BYTE(checksum);\n\t}\n\n\t*buffer = string_concat(prefix, encoded_command, checksum_hash, NULL);\n\t*size = strlen(prefix) + strlen(encoded_command) + DEBUGSERVER_CHECKSUM_HASH_LENGTH;\n\n\tdebug_info(\"formatted command: %s size: %d checksum: 0x%s\", *buffer, *size, checksum_hash);\n\n\tif (encoded_command)\n\t\tfree(encoded_command);\n\n\tif (encoded)\n\t\tfree(encoded);\n}",
          "includes": [
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/debug.h\"",
            "#include \"lockdown.h\"",
            "#include \"debugserver.h\"",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"debugserver.h\"\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic void debugserver_format_command(const char* prefix, const char* command, const char* arguments, int calculate_checksum, char** buffer, uint32_t* size)\n{\n\tchar checksum_hash[DEBUGSERVER_CHECKSUM_HASH_LENGTH + 1] = {'#', '0', '0', '\\0'};\n\tchar* encoded = NULL;\n\tuint32_t encoded_length = 0;\n\n\tif (arguments) {\n\t\t/* arguments must be hex encoded */\n\t\tdebugserver_encode_string(arguments, &encoded, &encoded_length);\n\t} else {\n\t\tencoded = NULL;\n\t}\n\n\tchar* encoded_command = string_concat(command, encoded, NULL);\n\tencoded_length = strlen(encoded_command);\n\n\tif (calculate_checksum) {\n\t\tuint32_t checksum = debugserver_get_checksum_for_buffer(encoded_command, encoded_length);\n\t\tchecksum_hash[1] = DEBUGSERVER_HEX_ENCODE_FIRST_BYTE(checksum);\n\t\tchecksum_hash[2] = DEBUGSERVER_HEX_ENCODE_SECOND_BYTE(checksum);\n\t}\n\n\t*buffer = string_concat(prefix, encoded_command, checksum_hash, NULL);\n\t*size = strlen(prefix) + strlen(encoded_command) + DEBUGSERVER_CHECKSUM_HASH_LENGTH;\n\n\tdebug_info(\"formatted command: %s size: %d checksum: 0x%s\", *buffer, *size, checksum_hash);\n\n\tif (encoded_command)\n\t\tfree(encoded_command);\n\n\tif (encoded)\n\t\tfree(encoded);\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"command_arguments(%d): %s\"",
            "command->argc",
            "command_arguments"
          ],
          "line": 499
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "string_concat",
          "args": [
            "tmp",
            "command->argv[i]",
            "NULL"
          ],
          "line": 491
        },
        "resolved": true,
        "details": {
          "function_name": "string_concat",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/common/utils.c",
          "lines": "70-112",
          "snippet": "char *string_concat(const char *str, ...)\n{\n\tsize_t len;\n\tva_list args;\n\tchar *s;\n\tchar *result;\n\tchar *dest;\n\n\tif (!str)\n\t\treturn NULL;\n\n\t/* Compute final length */\n\n\tlen = strlen(str) + 1; /* plus 1 for the null terminator */\n\n\tva_start(args, str);\n\ts = va_arg(args, char *);\n\twhile (s) {\n\t\tlen += strlen(s);\n\t\ts = va_arg(args, char*);\n\t}\n\tva_end(args);\n\n\t/* Concat each string */\n\n\tresult = malloc(len);\n\tif (!result)\n\t\treturn NULL; /* errno remains set */\n\n\tdest = result;\n\n\tdest = stpcpy(dest, str);\n\n\tva_start(args, str);\n\ts = va_arg(args, char *);\n\twhile (s) {\n\t\tdest = stpcpy(dest, s);\n\t\ts = va_arg(args, char *);\n\t}\n\tva_end(args);\n\n\treturn result;\n}",
          "includes": [
            "#include \"utils.h\"",
            "#include <ctype.h>",
            "#include <inttypes.h>",
            "#include <sys/time.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"utils.h\"\n#include <ctype.h>\n#include <inttypes.h>\n#include <sys/time.h>\n#include <time.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <config.h>\n\nchar *string_concat(const char *str, ...)\n{\n\tsize_t len;\n\tva_list args;\n\tchar *s;\n\tchar *result;\n\tchar *dest;\n\n\tif (!str)\n\t\treturn NULL;\n\n\t/* Compute final length */\n\n\tlen = strlen(str) + 1; /* plus 1 for the null terminator */\n\n\tva_start(args, str);\n\ts = va_arg(args, char *);\n\twhile (s) {\n\t\tlen += strlen(s);\n\t\ts = va_arg(args, char*);\n\t}\n\tva_end(args);\n\n\t/* Concat each string */\n\n\tresult = malloc(len);\n\tif (!result)\n\t\treturn NULL; /* errno remains set */\n\n\tdest = result;\n\n\tdest = stpcpy(dest, str);\n\n\tva_start(args, str);\n\ts = va_arg(args, char *);\n\twhile (s) {\n\t\tdest = stpcpy(dest, s);\n\t\ts = va_arg(args, char *);\n\t}\n\tva_end(args);\n\n\treturn result;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "command->argv[i]"
          ],
          "line": 489
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"argv[%d]: %s\"",
            "i",
            "command->argv[i]"
          ],
          "line": 487
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"debugserver.h\"\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API debugserver_error_t debugserver_client_send_command(debugserver_client_t client, debugserver_command_t command, char** response)\n{\n\tdebugserver_error_t res = DEBUGSERVER_E_SUCCESS;\n\tint i;\n\tuint32_t bytes = 0;\n\n\tchar* send_buffer = NULL;\n\tuint32_t send_buffer_size = 0;\n\n\tchar* command_arguments = NULL;\n\n\t/* concat all arguments */\n\tchar* tmp = NULL;\n\tchar* newtmp = NULL;\n\tfor (i = 0; i < command->argc; i++) {\n\t\tdebug_info(\"argv[%d]: %s\", i, command->argv[i]);\n\t\tif (!tmp) {\n\t\t\ttmp = strdup(command->argv[i]);\n\t\t} else {\n\t\t\tnewtmp = string_concat(tmp, command->argv[i], NULL);\n\t\t\tfree(tmp);\n\t\t\ttmp = newtmp;\n\t\t}\n\t}\n\tcommand_arguments = tmp;\n\ttmp = NULL;\n\n\tdebug_info(\"command_arguments(%d): %s\", command->argc, command_arguments);\n\n\t/* encode command arguments, add checksum if required and assemble entire command */\n\tdebugserver_format_command(\"$\", command->name, command_arguments, !client->noack_mode, &send_buffer, &send_buffer_size);\n\n\tdebug_info(\"sending encoded command: %s\", send_buffer);\n\n\tres = debugserver_client_send(client, send_buffer, send_buffer_size, &bytes);\n\tdebug_info(\"command result: %d\", res);\n\tif (res != DEBUGSERVER_E_SUCCESS) {\n\t\tgoto cleanup;\n\t}\n\n\t/* receive response */\n\tres = debugserver_client_receive_response(client, response);\n\tdebug_info(\"response result: %d\", res);\n\tif (res != DEBUGSERVER_E_SUCCESS) {\n\t\tgoto cleanup;\n\t}\n\n\tif (response) {\n\t\tdebug_info(\"received response: %s\", *response);\n\t}\n\n\t/* disable sending ack on the client */\n\tif (!strncmp(command->name, \"QStartNoAckMode\", 16)) {\n\t\tdebugserver_client_set_ack_mode(client, 0);\n\t}\n\ncleanup:\n\tif (command_arguments)\n\t\tfree(command_arguments);\n\n\tif (send_buffer)\n\t\tfree(send_buffer);\n\n\treturn res;\n}"
  },
  {
    "function_name": "debugserver_client_receive_response",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/debugserver.c",
    "lines": "370-470",
    "snippet": "LIBIMOBILEDEVICE_API debugserver_error_t debugserver_client_receive_response(debugserver_client_t client, char** response)\n{\n\tdebugserver_error_t res = DEBUGSERVER_E_SUCCESS;\n\n\tint should_receive = 1;\n\tint skip_prefix = 0;\n\tchar* command_prefix = strdup(\"$\");\n\n\tchar* buffer = NULL;\n\tuint32_t buffer_size = 0;\n\n\tif (response)\n\t\t*response = NULL;\n\n\tif (!client->noack_mode) {\n\t\tchar ack[2] = {'+', '\\0'};\n\t\tdebug_info(\"attempting to receive ACK %c\", *ack);\n\t\tshould_receive = debugserver_client_receive_internal_check(client, ack);\n\t\tdebug_info(\"received char: %c\", *ack);\n\t\tif (strncmp(ack, command_prefix, sizeof(char)) == 0) {\n\t\t\tshould_receive = 1;\n\t\t\tskip_prefix = 1;\n\t\t\tbuffer = strdup(command_prefix);\n\t\t\tbuffer_size += sizeof(char);\n\t\t\tdebug_info(\"received ACK\");\n\t\t}\n\t}\n\n\tdebug_info(\"should_receive: %d, skip_prefix: %d\", should_receive, skip_prefix);\n\n\tif (should_receive && !skip_prefix) {\n\t\tdebug_info(\"attempting to receive prefix\");\n\t\tshould_receive = debugserver_client_receive_internal_check(client, command_prefix);\n\t\tdebug_info(\"received command_prefix: %c\", *command_prefix);\n\t\tif (should_receive) {\n\t\t\tif (buffer) {\n\t\t\t\tmemcpy(buffer, command_prefix, sizeof(char));\n\t\t\t} else {\n\t\t\t\tbuffer = strdup(command_prefix);\n\t\t\t\tbuffer_size += sizeof(char);\n\t\t\t}\n\t\t}\n\t}\n\n\tdebug_info(\"buffer: %*s, should_receive: %d, skip_prefix: %d\", buffer_size, buffer, should_receive, skip_prefix);\n\n\tif (should_receive) {\n\t\tuint32_t checksum_length = DEBUGSERVER_CHECKSUM_HASH_LENGTH;\n\t\tint receiving_checksum_response = 0;\n\t\tdebug_info(\"attempting to read up response until checksum\");\n\t\twhile ((checksum_length > 0)) {\n\t\t\tchar data[2] = {'#', '\\0'};\n\t\t\tif (debugserver_client_receive_internal_check(client, data)) {\n\t\t\t\treceiving_checksum_response = 1;\n\t\t\t}\n\t\t\tif (receiving_checksum_response) {\n\t\t\t\tchecksum_length--;\n\t\t\t}\n\t\t\tchar* newbuffer = string_concat(buffer, data, NULL);\n\t\t\tbuffer_size += sizeof(char);\n\t\t\tfree(buffer);\n\t\t\tbuffer = NULL;\n\t\t\tbuffer = newbuffer;\n\t\t\tnewbuffer = NULL;\n\t\t}\n\t\tdebug_info(\"validating response checksum...\");\n\t\tint valid_response = debugserver_response_is_checksum_valid(buffer, buffer_size);\n\t\tif (valid_response) {\n\t\t\tif (response) {\n\t\t\t\t/* assemble response string */\n\t\t\t\tuint32_t response_size = sizeof(char) * (buffer_size - DEBUGSERVER_CHECKSUM_HASH_LENGTH - 1);\n\t\t\t\t*response = (char*)malloc(response_size + 1);\n\t\t\t\tmemcpy(*response, buffer + 1, response_size);\n\t\t\t\t(*response)[response_size] = '\\0';\n\t\t\t}\n\t\t\tif (!client->noack_mode) {\n\t\t\t\t/* confirm valid command */\n\t\t\t\tdebugserver_client_send_ack(client);\n\t\t\t}\n\t\t} else {\n\t\t\t/* response was invalid */\n\t\t\tres = DEBUGSERVER_E_RESPONSE_ERROR;\n\t\t\tif (!client->noack_mode) {\n\t\t\t\t/* report invalid command */\n\t\t\t\tdebugserver_client_send_noack(client);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (response) {\n\t\tdebug_info(\"response: %s\", *response);\n\t}\n\n\tif (buffer)\n\t\tfree(buffer);\n\n\tif (command_prefix)\n\t\tfree(command_prefix);\n\n\treturn res;\n}",
    "includes": [
      "#include \"asprintf.h\"",
      "#include \"common/utils.h\"",
      "#include \"common/debug.h\"",
      "#include \"lockdown.h\"",
      "#include \"debugserver.h\"",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "command_prefix"
          ],
          "line": 467
        },
        "resolved": true,
        "details": {
          "function_name": "debugserver_command_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/debugserver.c",
          "lines": "181-203",
          "snippet": "LIBIMOBILEDEVICE_API debugserver_error_t debugserver_command_free(debugserver_command_t command)\n{\n\tint i;\n\tdebugserver_error_t res = DEBUGSERVER_E_UNKNOWN_ERROR;\n\n\tif (!command)\n\t\treturn DEBUGSERVER_E_INVALID_ARG;\n\n\tif (command) {\n\t\tif (command->name)\n\t\t\tfree(command->name);\n\t\tif (command->argv && command->argc) {\n\t\t\tfor (i = 0; i < command->argc; i++) {\n\t\t\t\tfree(command->argv[i]);\n\t\t\t}\n\t\t\tfree(command->argv);\n\t\t}\n\t\tfree(command);\n\t\tres = DEBUGSERVER_E_SUCCESS;\n\t}\n\n\treturn res;\n}",
          "includes": [
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/debug.h\"",
            "#include \"lockdown.h\"",
            "#include \"debugserver.h\"",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"debugserver.h\"\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API debugserver_error_t debugserver_command_free(debugserver_command_t command)\n{\n\tint i;\n\tdebugserver_error_t res = DEBUGSERVER_E_UNKNOWN_ERROR;\n\n\tif (!command)\n\t\treturn DEBUGSERVER_E_INVALID_ARG;\n\n\tif (command) {\n\t\tif (command->name)\n\t\t\tfree(command->name);\n\t\tif (command->argv && command->argc) {\n\t\t\tfor (i = 0; i < command->argc; i++) {\n\t\t\t\tfree(command->argv[i]);\n\t\t\t}\n\t\t\tfree(command->argv);\n\t\t}\n\t\tfree(command);\n\t\tres = DEBUGSERVER_E_SUCCESS;\n\t}\n\n\treturn res;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"response: %s\"",
            "*response"
          ],
          "line": 460
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debugserver_client_send_noack",
          "args": [
            "client"
          ],
          "line": 454
        },
        "resolved": true,
        "details": {
          "function_name": "debugserver_client_send_noack",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/debugserver.c",
          "lines": "328-332",
          "snippet": "static debugserver_error_t debugserver_client_send_noack(debugserver_client_t client)\n{\n\tdebug_info(\"sending !ACK\");\n\treturn debugserver_client_send(client, \"-\", sizeof(char), NULL);\n}",
          "includes": [
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/debug.h\"",
            "#include \"lockdown.h\"",
            "#include \"debugserver.h\"",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"debugserver.h\"\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic debugserver_error_t debugserver_client_send_noack(debugserver_client_t client)\n{\n\tdebug_info(\"sending !ACK\");\n\treturn debugserver_client_send(client, \"-\", sizeof(char), NULL);\n}"
        }
      },
      {
        "call_info": {
          "callee": "debugserver_client_send_ack",
          "args": [
            "client"
          ],
          "line": 447
        },
        "resolved": true,
        "details": {
          "function_name": "debugserver_client_send_ack",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/debugserver.c",
          "lines": "322-326",
          "snippet": "static debugserver_error_t debugserver_client_send_ack(debugserver_client_t client)\n{\n\tdebug_info(\"sending ACK\");\n\treturn debugserver_client_send(client, \"+\", sizeof(char), NULL);\n}",
          "includes": [
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/debug.h\"",
            "#include \"lockdown.h\"",
            "#include \"debugserver.h\"",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"debugserver.h\"\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic debugserver_error_t debugserver_client_send_ack(debugserver_client_t client)\n{\n\tdebug_info(\"sending ACK\");\n\treturn debugserver_client_send(client, \"+\", sizeof(char), NULL);\n}"
        }
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "*response",
            "buffer + 1",
            "response_size"
          ],
          "line": 442
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "malloc",
          "args": [
            "response_size + 1"
          ],
          "line": 441
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debugserver_response_is_checksum_valid",
          "args": [
            "buffer",
            "buffer_size"
          ],
          "line": 436
        },
        "resolved": true,
        "details": {
          "function_name": "debugserver_response_is_checksum_valid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/debugserver.c",
          "lines": "240-257",
          "snippet": "static int debugserver_response_is_checksum_valid(const char* response, uint32_t size)\n{\n\tuint32_t checksum = 0;\n\tif ((size - DEBUGSERVER_CHECKSUM_HASH_LENGTH - 1) > 0)\n\t\tchecksum = debugserver_get_checksum_for_buffer(&response[1], size - DEBUGSERVER_CHECKSUM_HASH_LENGTH - 1);\n\n\tdebug_info(\"checksum: 0x%x\", checksum);\n\n\tif ((unsigned)debugserver_hex2int(response[size - 2]) != DEBUGSERVER_HEX_DECODE_FIRST_BYTE(checksum))\n\t\treturn 0;\n\n\tif ((unsigned)debugserver_hex2int(response[size - 1]) != DEBUGSERVER_HEX_DECODE_SECOND_BYTE(checksum))\n\t\treturn 0;\n\n\tdebug_info(\"valid checksum\");\n\n\treturn 1;\n}",
          "includes": [
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/debug.h\"",
            "#include \"lockdown.h\"",
            "#include \"debugserver.h\"",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"debugserver.h\"\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic int debugserver_response_is_checksum_valid(const char* response, uint32_t size)\n{\n\tuint32_t checksum = 0;\n\tif ((size - DEBUGSERVER_CHECKSUM_HASH_LENGTH - 1) > 0)\n\t\tchecksum = debugserver_get_checksum_for_buffer(&response[1], size - DEBUGSERVER_CHECKSUM_HASH_LENGTH - 1);\n\n\tdebug_info(\"checksum: 0x%x\", checksum);\n\n\tif ((unsigned)debugserver_hex2int(response[size - 2]) != DEBUGSERVER_HEX_DECODE_FIRST_BYTE(checksum))\n\t\treturn 0;\n\n\tif ((unsigned)debugserver_hex2int(response[size - 1]) != DEBUGSERVER_HEX_DECODE_SECOND_BYTE(checksum))\n\t\treturn 0;\n\n\tdebug_info(\"valid checksum\");\n\n\treturn 1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"validating response checksum...\""
          ],
          "line": 435
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "string_concat",
          "args": [
            "buffer",
            "data",
            "NULL"
          ],
          "line": 428
        },
        "resolved": true,
        "details": {
          "function_name": "string_concat",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/common/utils.c",
          "lines": "70-112",
          "snippet": "char *string_concat(const char *str, ...)\n{\n\tsize_t len;\n\tva_list args;\n\tchar *s;\n\tchar *result;\n\tchar *dest;\n\n\tif (!str)\n\t\treturn NULL;\n\n\t/* Compute final length */\n\n\tlen = strlen(str) + 1; /* plus 1 for the null terminator */\n\n\tva_start(args, str);\n\ts = va_arg(args, char *);\n\twhile (s) {\n\t\tlen += strlen(s);\n\t\ts = va_arg(args, char*);\n\t}\n\tva_end(args);\n\n\t/* Concat each string */\n\n\tresult = malloc(len);\n\tif (!result)\n\t\treturn NULL; /* errno remains set */\n\n\tdest = result;\n\n\tdest = stpcpy(dest, str);\n\n\tva_start(args, str);\n\ts = va_arg(args, char *);\n\twhile (s) {\n\t\tdest = stpcpy(dest, s);\n\t\ts = va_arg(args, char *);\n\t}\n\tva_end(args);\n\n\treturn result;\n}",
          "includes": [
            "#include \"utils.h\"",
            "#include <ctype.h>",
            "#include <inttypes.h>",
            "#include <sys/time.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"utils.h\"\n#include <ctype.h>\n#include <inttypes.h>\n#include <sys/time.h>\n#include <time.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <config.h>\n\nchar *string_concat(const char *str, ...)\n{\n\tsize_t len;\n\tva_list args;\n\tchar *s;\n\tchar *result;\n\tchar *dest;\n\n\tif (!str)\n\t\treturn NULL;\n\n\t/* Compute final length */\n\n\tlen = strlen(str) + 1; /* plus 1 for the null terminator */\n\n\tva_start(args, str);\n\ts = va_arg(args, char *);\n\twhile (s) {\n\t\tlen += strlen(s);\n\t\ts = va_arg(args, char*);\n\t}\n\tva_end(args);\n\n\t/* Concat each string */\n\n\tresult = malloc(len);\n\tif (!result)\n\t\treturn NULL; /* errno remains set */\n\n\tdest = result;\n\n\tdest = stpcpy(dest, str);\n\n\tva_start(args, str);\n\ts = va_arg(args, char *);\n\twhile (s) {\n\t\tdest = stpcpy(dest, s);\n\t\ts = va_arg(args, char *);\n\t}\n\tva_end(args);\n\n\treturn result;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debugserver_client_receive_internal_check",
          "args": [
            "client",
            "data"
          ],
          "line": 422
        },
        "resolved": true,
        "details": {
          "function_name": "debugserver_client_receive_internal_check",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/debugserver.c",
          "lines": "346-368",
          "snippet": "static int debugserver_client_receive_internal_check(debugserver_client_t client, char* received_char)\n{\n\tdebugserver_error_t res = DEBUGSERVER_E_SUCCESS;\n\tint did_receive_char = 0;\n\tchar buffer = 0;\n\tuint32_t bytes = 0;\n\n\t/* we loop here as we expect an answer */\n\tres = debugserver_client_receive_with_timeout(client, &buffer, sizeof(char), &bytes, 1000);\n\tif (res == DEBUGSERVER_E_SUCCESS && received_char[0] != 0) {\n\t\tif (memcmp(&buffer, received_char, sizeof(char)) == 0) {\n\t\t\tdid_receive_char = 1;\n\t\t}\n\t} else {\n\t\tdid_receive_char = 0;\n\t}\n\n\tif (!did_receive_char) {\n\t\tmemcpy(received_char, &buffer, sizeof(char));\n\t}\n\n\treturn did_receive_char;\n}",
          "includes": [
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/debug.h\"",
            "#include \"lockdown.h\"",
            "#include \"debugserver.h\"",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"debugserver.h\"\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic int debugserver_client_receive_internal_check(debugserver_client_t client, char* received_char)\n{\n\tdebugserver_error_t res = DEBUGSERVER_E_SUCCESS;\n\tint did_receive_char = 0;\n\tchar buffer = 0;\n\tuint32_t bytes = 0;\n\n\t/* we loop here as we expect an answer */\n\tres = debugserver_client_receive_with_timeout(client, &buffer, sizeof(char), &bytes, 1000);\n\tif (res == DEBUGSERVER_E_SUCCESS && received_char[0] != 0) {\n\t\tif (memcmp(&buffer, received_char, sizeof(char)) == 0) {\n\t\t\tdid_receive_char = 1;\n\t\t}\n\t} else {\n\t\tdid_receive_char = 0;\n\t}\n\n\tif (!did_receive_char) {\n\t\tmemcpy(received_char, &buffer, sizeof(char));\n\t}\n\n\treturn did_receive_char;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"attempting to read up response until checksum\""
          ],
          "line": 419
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"buffer: %*s, should_receive: %d, skip_prefix: %d\"",
            "buffer_size",
            "buffer",
            "should_receive",
            "skip_prefix"
          ],
          "line": 414
        },
        "resolved": true,
        "details": {
          "function_name": "debug_info_real",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/common/debug.c",
          "lines": "81-99",
          "snippet": "void debug_info_real(const char *func, const char *file, int line, const char *format, ...)\n{\n#ifndef STRIP_DEBUG_CODE\n\tva_list args;\n\tchar *buffer = NULL;\n\n\tif (!debug_level)\n\t\treturn;\n\n\t/* run the real fprintf */\n\tva_start(args, format);\n\t(void)vasprintf(&buffer, format, args);\n\tva_end(args);\n\n\tdebug_print_line(func, file, line, buffer);\n\n\tfree(buffer);\n#endif\n}",
          "includes": [
            "#include \"asprintf.h\"",
            "#include \"src/idevice.h\"",
            "#include \"libimobiledevice/libimobiledevice.h\"",
            "#include \"debug.h\"",
            "#include <time.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int debug_level;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"asprintf.h\"\n#include \"src/idevice.h\"\n#include \"libimobiledevice/libimobiledevice.h\"\n#include \"debug.h\"\n#include <time.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <config.h>\n\nstatic int debug_level;\n\nvoid debug_info_real(const char *func, const char *file, int line, const char *format, ...)\n{\n#ifndef STRIP_DEBUG_CODE\n\tva_list args;\n\tchar *buffer = NULL;\n\n\tif (!debug_level)\n\t\treturn;\n\n\t/* run the real fprintf */\n\tva_start(args, format);\n\t(void)vasprintf(&buffer, format, args);\n\tva_end(args);\n\n\tdebug_print_line(func, file, line, buffer);\n\n\tfree(buffer);\n#endif\n}"
        }
      },
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "command_prefix"
          ],
          "line": 408
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "buffer",
            "command_prefix",
            "sizeof(char)"
          ],
          "line": 406
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"received command_prefix: %c\"",
            "*command_prefix"
          ],
          "line": 403
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"attempting to receive prefix\""
          ],
          "line": 401
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"should_receive: %d, skip_prefix: %d\"",
            "should_receive",
            "skip_prefix"
          ],
          "line": 398
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"received ACK\""
          ],
          "line": 394
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "command_prefix"
          ],
          "line": 392
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strncmp",
          "args": [
            "ack",
            "command_prefix",
            "sizeof(char)"
          ],
          "line": 389
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"received char: %c\"",
            "*ack"
          ],
          "line": 388
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"attempting to receive ACK %c\"",
            "*ack"
          ],
          "line": 386
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "\"$\""
          ],
          "line": 376
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"debugserver.h\"\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API debugserver_error_t debugserver_client_receive_response(debugserver_client_t client, char** response)\n{\n\tdebugserver_error_t res = DEBUGSERVER_E_SUCCESS;\n\n\tint should_receive = 1;\n\tint skip_prefix = 0;\n\tchar* command_prefix = strdup(\"$\");\n\n\tchar* buffer = NULL;\n\tuint32_t buffer_size = 0;\n\n\tif (response)\n\t\t*response = NULL;\n\n\tif (!client->noack_mode) {\n\t\tchar ack[2] = {'+', '\\0'};\n\t\tdebug_info(\"attempting to receive ACK %c\", *ack);\n\t\tshould_receive = debugserver_client_receive_internal_check(client, ack);\n\t\tdebug_info(\"received char: %c\", *ack);\n\t\tif (strncmp(ack, command_prefix, sizeof(char)) == 0) {\n\t\t\tshould_receive = 1;\n\t\t\tskip_prefix = 1;\n\t\t\tbuffer = strdup(command_prefix);\n\t\t\tbuffer_size += sizeof(char);\n\t\t\tdebug_info(\"received ACK\");\n\t\t}\n\t}\n\n\tdebug_info(\"should_receive: %d, skip_prefix: %d\", should_receive, skip_prefix);\n\n\tif (should_receive && !skip_prefix) {\n\t\tdebug_info(\"attempting to receive prefix\");\n\t\tshould_receive = debugserver_client_receive_internal_check(client, command_prefix);\n\t\tdebug_info(\"received command_prefix: %c\", *command_prefix);\n\t\tif (should_receive) {\n\t\t\tif (buffer) {\n\t\t\t\tmemcpy(buffer, command_prefix, sizeof(char));\n\t\t\t} else {\n\t\t\t\tbuffer = strdup(command_prefix);\n\t\t\t\tbuffer_size += sizeof(char);\n\t\t\t}\n\t\t}\n\t}\n\n\tdebug_info(\"buffer: %*s, should_receive: %d, skip_prefix: %d\", buffer_size, buffer, should_receive, skip_prefix);\n\n\tif (should_receive) {\n\t\tuint32_t checksum_length = DEBUGSERVER_CHECKSUM_HASH_LENGTH;\n\t\tint receiving_checksum_response = 0;\n\t\tdebug_info(\"attempting to read up response until checksum\");\n\t\twhile ((checksum_length > 0)) {\n\t\t\tchar data[2] = {'#', '\\0'};\n\t\t\tif (debugserver_client_receive_internal_check(client, data)) {\n\t\t\t\treceiving_checksum_response = 1;\n\t\t\t}\n\t\t\tif (receiving_checksum_response) {\n\t\t\t\tchecksum_length--;\n\t\t\t}\n\t\t\tchar* newbuffer = string_concat(buffer, data, NULL);\n\t\t\tbuffer_size += sizeof(char);\n\t\t\tfree(buffer);\n\t\t\tbuffer = NULL;\n\t\t\tbuffer = newbuffer;\n\t\t\tnewbuffer = NULL;\n\t\t}\n\t\tdebug_info(\"validating response checksum...\");\n\t\tint valid_response = debugserver_response_is_checksum_valid(buffer, buffer_size);\n\t\tif (valid_response) {\n\t\t\tif (response) {\n\t\t\t\t/* assemble response string */\n\t\t\t\tuint32_t response_size = sizeof(char) * (buffer_size - DEBUGSERVER_CHECKSUM_HASH_LENGTH - 1);\n\t\t\t\t*response = (char*)malloc(response_size + 1);\n\t\t\t\tmemcpy(*response, buffer + 1, response_size);\n\t\t\t\t(*response)[response_size] = '\\0';\n\t\t\t}\n\t\t\tif (!client->noack_mode) {\n\t\t\t\t/* confirm valid command */\n\t\t\t\tdebugserver_client_send_ack(client);\n\t\t\t}\n\t\t} else {\n\t\t\t/* response was invalid */\n\t\t\tres = DEBUGSERVER_E_RESPONSE_ERROR;\n\t\t\tif (!client->noack_mode) {\n\t\t\t\t/* report invalid command */\n\t\t\t\tdebugserver_client_send_noack(client);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (response) {\n\t\tdebug_info(\"response: %s\", *response);\n\t}\n\n\tif (buffer)\n\t\tfree(buffer);\n\n\tif (command_prefix)\n\t\tfree(command_prefix);\n\n\treturn res;\n}"
  },
  {
    "function_name": "debugserver_client_receive_internal_check",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/debugserver.c",
    "lines": "346-368",
    "snippet": "static int debugserver_client_receive_internal_check(debugserver_client_t client, char* received_char)\n{\n\tdebugserver_error_t res = DEBUGSERVER_E_SUCCESS;\n\tint did_receive_char = 0;\n\tchar buffer = 0;\n\tuint32_t bytes = 0;\n\n\t/* we loop here as we expect an answer */\n\tres = debugserver_client_receive_with_timeout(client, &buffer, sizeof(char), &bytes, 1000);\n\tif (res == DEBUGSERVER_E_SUCCESS && received_char[0] != 0) {\n\t\tif (memcmp(&buffer, received_char, sizeof(char)) == 0) {\n\t\t\tdid_receive_char = 1;\n\t\t}\n\t} else {\n\t\tdid_receive_char = 0;\n\t}\n\n\tif (!did_receive_char) {\n\t\tmemcpy(received_char, &buffer, sizeof(char));\n\t}\n\n\treturn did_receive_char;\n}",
    "includes": [
      "#include \"asprintf.h\"",
      "#include \"common/utils.h\"",
      "#include \"common/debug.h\"",
      "#include \"lockdown.h\"",
      "#include \"debugserver.h\"",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "received_char",
            "&buffer",
            "sizeof(char)"
          ],
          "line": 364
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcmp",
          "args": [
            "&buffer",
            "received_char",
            "sizeof(char)"
          ],
          "line": 356
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debugserver_client_receive_with_timeout",
          "args": [
            "client",
            "&buffer",
            "sizeof(char)",
            "&bytes",
            "1000"
          ],
          "line": 354
        },
        "resolved": true,
        "details": {
          "function_name": "debugserver_client_receive_with_timeout",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/debugserver.c",
          "lines": "131-149",
          "snippet": "LIBIMOBILEDEVICE_API debugserver_error_t debugserver_client_receive_with_timeout(debugserver_client_t client, char* data, uint32_t size, uint32_t *received, unsigned int timeout)\n{\n\tdebugserver_error_t res = DEBUGSERVER_E_UNKNOWN_ERROR;\n\tint bytes = 0;\n\n\tif (!client || !data || (size == 0)) {\n\t\treturn DEBUGSERVER_E_INVALID_ARG;\n\t}\n\n\tres = debugserver_error(service_receive_with_timeout(client->parent, data, size, (uint32_t*)&bytes, timeout));\n\tif (bytes <= 0) {\n\t\tdebug_info(\"Could not read data, error %d\", res);\n\t}\n\tif (received) {\n\t\t*received = (uint32_t)bytes;\n\t}\n\n\treturn res;\n}",
          "includes": [
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/debug.h\"",
            "#include \"lockdown.h\"",
            "#include \"debugserver.h\"",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"debugserver.h\"\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API debugserver_error_t debugserver_client_receive_with_timeout(debugserver_client_t client, char* data, uint32_t size, uint32_t *received, unsigned int timeout)\n{\n\tdebugserver_error_t res = DEBUGSERVER_E_UNKNOWN_ERROR;\n\tint bytes = 0;\n\n\tif (!client || !data || (size == 0)) {\n\t\treturn DEBUGSERVER_E_INVALID_ARG;\n\t}\n\n\tres = debugserver_error(service_receive_with_timeout(client->parent, data, size, (uint32_t*)&bytes, timeout));\n\tif (bytes <= 0) {\n\t\tdebug_info(\"Could not read data, error %d\", res);\n\t}\n\tif (received) {\n\t\t*received = (uint32_t)bytes;\n\t}\n\n\treturn res;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"debugserver.h\"\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic int debugserver_client_receive_internal_check(debugserver_client_t client, char* received_char)\n{\n\tdebugserver_error_t res = DEBUGSERVER_E_SUCCESS;\n\tint did_receive_char = 0;\n\tchar buffer = 0;\n\tuint32_t bytes = 0;\n\n\t/* we loop here as we expect an answer */\n\tres = debugserver_client_receive_with_timeout(client, &buffer, sizeof(char), &bytes, 1000);\n\tif (res == DEBUGSERVER_E_SUCCESS && received_char[0] != 0) {\n\t\tif (memcmp(&buffer, received_char, sizeof(char)) == 0) {\n\t\t\tdid_receive_char = 1;\n\t\t}\n\t} else {\n\t\tdid_receive_char = 0;\n\t}\n\n\tif (!did_receive_char) {\n\t\tmemcpy(received_char, &buffer, sizeof(char));\n\t}\n\n\treturn did_receive_char;\n}"
  },
  {
    "function_name": "debugserver_client_set_ack_mode",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/debugserver.c",
    "lines": "334-344",
    "snippet": "LIBIMOBILEDEVICE_API debugserver_error_t debugserver_client_set_ack_mode(debugserver_client_t client, int enabled)\n{\n\tif (!client)\n\t\treturn DEBUGSERVER_E_INVALID_ARG;\n\n\tclient->noack_mode = (enabled == 0)? 1: 0;\n\n\tdebug_info(\"ack mode: %s\", client->noack_mode == 0 ? \"on\": \"off\");\n\n\treturn DEBUGSERVER_E_SUCCESS;\n}",
    "includes": [
      "#include \"asprintf.h\"",
      "#include \"common/utils.h\"",
      "#include \"common/debug.h\"",
      "#include \"lockdown.h\"",
      "#include \"debugserver.h\"",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"ack mode: %s\"",
            "client->noack_mode == 0 ? \"on\": \"off\""
          ],
          "line": 341
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"debugserver.h\"\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API debugserver_error_t debugserver_client_set_ack_mode(debugserver_client_t client, int enabled)\n{\n\tif (!client)\n\t\treturn DEBUGSERVER_E_INVALID_ARG;\n\n\tclient->noack_mode = (enabled == 0)? 1: 0;\n\n\tdebug_info(\"ack mode: %s\", client->noack_mode == 0 ? \"on\": \"off\");\n\n\treturn DEBUGSERVER_E_SUCCESS;\n}"
  },
  {
    "function_name": "debugserver_client_send_noack",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/debugserver.c",
    "lines": "328-332",
    "snippet": "static debugserver_error_t debugserver_client_send_noack(debugserver_client_t client)\n{\n\tdebug_info(\"sending !ACK\");\n\treturn debugserver_client_send(client, \"-\", sizeof(char), NULL);\n}",
    "includes": [
      "#include \"asprintf.h\"",
      "#include \"common/utils.h\"",
      "#include \"common/debug.h\"",
      "#include \"lockdown.h\"",
      "#include \"debugserver.h\"",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "debugserver_client_send",
          "args": [
            "client",
            "\"-\"",
            "sizeof(char)",
            "NULL"
          ],
          "line": 331
        },
        "resolved": true,
        "details": {
          "function_name": "debugserver_client_send",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/debugserver.c",
          "lines": "110-129",
          "snippet": "LIBIMOBILEDEVICE_API debugserver_error_t debugserver_client_send(debugserver_client_t client, const char* data, uint32_t size, uint32_t *sent)\n{\n\tdebugserver_error_t res = DEBUGSERVER_E_UNKNOWN_ERROR;\n\tint bytes = 0;\n\n\tif (!client || !data || (size == 0)) {\n\t\treturn DEBUGSERVER_E_INVALID_ARG;\n\t}\n\n\tdebug_info(\"sending %d bytes\", size);\n\tres = debugserver_error(service_send(client->parent, data, size, (uint32_t*)&bytes));\n\tif (bytes <= 0) {\n\t\tdebug_info(\"ERROR: sending to device failed.\");\n\t}\n\tif (sent) {\n\t\t*sent = (uint32_t)bytes;\n\t}\n\n\treturn res;\n}",
          "includes": [
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/debug.h\"",
            "#include \"lockdown.h\"",
            "#include \"debugserver.h\"",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"debugserver.h\"\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API debugserver_error_t debugserver_client_send(debugserver_client_t client, const char* data, uint32_t size, uint32_t *sent)\n{\n\tdebugserver_error_t res = DEBUGSERVER_E_UNKNOWN_ERROR;\n\tint bytes = 0;\n\n\tif (!client || !data || (size == 0)) {\n\t\treturn DEBUGSERVER_E_INVALID_ARG;\n\t}\n\n\tdebug_info(\"sending %d bytes\", size);\n\tres = debugserver_error(service_send(client->parent, data, size, (uint32_t*)&bytes));\n\tif (bytes <= 0) {\n\t\tdebug_info(\"ERROR: sending to device failed.\");\n\t}\n\tif (sent) {\n\t\t*sent = (uint32_t)bytes;\n\t}\n\n\treturn res;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"sending !ACK\""
          ],
          "line": 330
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"debugserver.h\"\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic debugserver_error_t debugserver_client_send_noack(debugserver_client_t client)\n{\n\tdebug_info(\"sending !ACK\");\n\treturn debugserver_client_send(client, \"-\", sizeof(char), NULL);\n}"
  },
  {
    "function_name": "debugserver_client_send_ack",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/debugserver.c",
    "lines": "322-326",
    "snippet": "static debugserver_error_t debugserver_client_send_ack(debugserver_client_t client)\n{\n\tdebug_info(\"sending ACK\");\n\treturn debugserver_client_send(client, \"+\", sizeof(char), NULL);\n}",
    "includes": [
      "#include \"asprintf.h\"",
      "#include \"common/utils.h\"",
      "#include \"common/debug.h\"",
      "#include \"lockdown.h\"",
      "#include \"debugserver.h\"",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "debugserver_client_send",
          "args": [
            "client",
            "\"+\"",
            "sizeof(char)",
            "NULL"
          ],
          "line": 325
        },
        "resolved": true,
        "details": {
          "function_name": "debugserver_client_send",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/debugserver.c",
          "lines": "110-129",
          "snippet": "LIBIMOBILEDEVICE_API debugserver_error_t debugserver_client_send(debugserver_client_t client, const char* data, uint32_t size, uint32_t *sent)\n{\n\tdebugserver_error_t res = DEBUGSERVER_E_UNKNOWN_ERROR;\n\tint bytes = 0;\n\n\tif (!client || !data || (size == 0)) {\n\t\treturn DEBUGSERVER_E_INVALID_ARG;\n\t}\n\n\tdebug_info(\"sending %d bytes\", size);\n\tres = debugserver_error(service_send(client->parent, data, size, (uint32_t*)&bytes));\n\tif (bytes <= 0) {\n\t\tdebug_info(\"ERROR: sending to device failed.\");\n\t}\n\tif (sent) {\n\t\t*sent = (uint32_t)bytes;\n\t}\n\n\treturn res;\n}",
          "includes": [
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/debug.h\"",
            "#include \"lockdown.h\"",
            "#include \"debugserver.h\"",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"debugserver.h\"\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API debugserver_error_t debugserver_client_send(debugserver_client_t client, const char* data, uint32_t size, uint32_t *sent)\n{\n\tdebugserver_error_t res = DEBUGSERVER_E_UNKNOWN_ERROR;\n\tint bytes = 0;\n\n\tif (!client || !data || (size == 0)) {\n\t\treturn DEBUGSERVER_E_INVALID_ARG;\n\t}\n\n\tdebug_info(\"sending %d bytes\", size);\n\tres = debugserver_error(service_send(client->parent, data, size, (uint32_t*)&bytes));\n\tif (bytes <= 0) {\n\t\tdebug_info(\"ERROR: sending to device failed.\");\n\t}\n\tif (sent) {\n\t\t*sent = (uint32_t)bytes;\n\t}\n\n\treturn res;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"sending ACK\""
          ],
          "line": 324
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"debugserver.h\"\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic debugserver_error_t debugserver_client_send_ack(debugserver_client_t client)\n{\n\tdebug_info(\"sending ACK\");\n\treturn debugserver_client_send(client, \"+\", sizeof(char), NULL);\n}"
  },
  {
    "function_name": "debugserver_format_command",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/debugserver.c",
    "lines": "288-320",
    "snippet": "static void debugserver_format_command(const char* prefix, const char* command, const char* arguments, int calculate_checksum, char** buffer, uint32_t* size)\n{\n\tchar checksum_hash[DEBUGSERVER_CHECKSUM_HASH_LENGTH + 1] = {'#', '0', '0', '\\0'};\n\tchar* encoded = NULL;\n\tuint32_t encoded_length = 0;\n\n\tif (arguments) {\n\t\t/* arguments must be hex encoded */\n\t\tdebugserver_encode_string(arguments, &encoded, &encoded_length);\n\t} else {\n\t\tencoded = NULL;\n\t}\n\n\tchar* encoded_command = string_concat(command, encoded, NULL);\n\tencoded_length = strlen(encoded_command);\n\n\tif (calculate_checksum) {\n\t\tuint32_t checksum = debugserver_get_checksum_for_buffer(encoded_command, encoded_length);\n\t\tchecksum_hash[1] = DEBUGSERVER_HEX_ENCODE_FIRST_BYTE(checksum);\n\t\tchecksum_hash[2] = DEBUGSERVER_HEX_ENCODE_SECOND_BYTE(checksum);\n\t}\n\n\t*buffer = string_concat(prefix, encoded_command, checksum_hash, NULL);\n\t*size = strlen(prefix) + strlen(encoded_command) + DEBUGSERVER_CHECKSUM_HASH_LENGTH;\n\n\tdebug_info(\"formatted command: %s size: %d checksum: 0x%s\", *buffer, *size, checksum_hash);\n\n\tif (encoded_command)\n\t\tfree(encoded_command);\n\n\tif (encoded)\n\t\tfree(encoded);\n}",
    "includes": [
      "#include \"asprintf.h\"",
      "#include \"common/utils.h\"",
      "#include \"common/debug.h\"",
      "#include \"lockdown.h\"",
      "#include \"debugserver.h\"",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "encoded"
          ],
          "line": 319
        },
        "resolved": true,
        "details": {
          "function_name": "debugserver_command_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/debugserver.c",
          "lines": "181-203",
          "snippet": "LIBIMOBILEDEVICE_API debugserver_error_t debugserver_command_free(debugserver_command_t command)\n{\n\tint i;\n\tdebugserver_error_t res = DEBUGSERVER_E_UNKNOWN_ERROR;\n\n\tif (!command)\n\t\treturn DEBUGSERVER_E_INVALID_ARG;\n\n\tif (command) {\n\t\tif (command->name)\n\t\t\tfree(command->name);\n\t\tif (command->argv && command->argc) {\n\t\t\tfor (i = 0; i < command->argc; i++) {\n\t\t\t\tfree(command->argv[i]);\n\t\t\t}\n\t\t\tfree(command->argv);\n\t\t}\n\t\tfree(command);\n\t\tres = DEBUGSERVER_E_SUCCESS;\n\t}\n\n\treturn res;\n}",
          "includes": [
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/debug.h\"",
            "#include \"lockdown.h\"",
            "#include \"debugserver.h\"",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"debugserver.h\"\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API debugserver_error_t debugserver_command_free(debugserver_command_t command)\n{\n\tint i;\n\tdebugserver_error_t res = DEBUGSERVER_E_UNKNOWN_ERROR;\n\n\tif (!command)\n\t\treturn DEBUGSERVER_E_INVALID_ARG;\n\n\tif (command) {\n\t\tif (command->name)\n\t\t\tfree(command->name);\n\t\tif (command->argv && command->argc) {\n\t\t\tfor (i = 0; i < command->argc; i++) {\n\t\t\t\tfree(command->argv[i]);\n\t\t\t}\n\t\t\tfree(command->argv);\n\t\t}\n\t\tfree(command);\n\t\tres = DEBUGSERVER_E_SUCCESS;\n\t}\n\n\treturn res;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"formatted command: %s size: %d checksum: 0x%s\"",
            "*buffer",
            "*size",
            "checksum_hash"
          ],
          "line": 313
        },
        "resolved": true,
        "details": {
          "function_name": "debug_info_real",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/common/debug.c",
          "lines": "81-99",
          "snippet": "void debug_info_real(const char *func, const char *file, int line, const char *format, ...)\n{\n#ifndef STRIP_DEBUG_CODE\n\tva_list args;\n\tchar *buffer = NULL;\n\n\tif (!debug_level)\n\t\treturn;\n\n\t/* run the real fprintf */\n\tva_start(args, format);\n\t(void)vasprintf(&buffer, format, args);\n\tva_end(args);\n\n\tdebug_print_line(func, file, line, buffer);\n\n\tfree(buffer);\n#endif\n}",
          "includes": [
            "#include \"asprintf.h\"",
            "#include \"src/idevice.h\"",
            "#include \"libimobiledevice/libimobiledevice.h\"",
            "#include \"debug.h\"",
            "#include <time.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int debug_level;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"asprintf.h\"\n#include \"src/idevice.h\"\n#include \"libimobiledevice/libimobiledevice.h\"\n#include \"debug.h\"\n#include <time.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <config.h>\n\nstatic int debug_level;\n\nvoid debug_info_real(const char *func, const char *file, int line, const char *format, ...)\n{\n#ifndef STRIP_DEBUG_CODE\n\tva_list args;\n\tchar *buffer = NULL;\n\n\tif (!debug_level)\n\t\treturn;\n\n\t/* run the real fprintf */\n\tva_start(args, format);\n\t(void)vasprintf(&buffer, format, args);\n\tva_end(args);\n\n\tdebug_print_line(func, file, line, buffer);\n\n\tfree(buffer);\n#endif\n}"
        }
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "encoded_command"
          ],
          "line": 311
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "prefix"
          ],
          "line": 311
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "string_concat",
          "args": [
            "prefix",
            "encoded_command",
            "checksum_hash",
            "NULL"
          ],
          "line": 310
        },
        "resolved": true,
        "details": {
          "function_name": "string_concat",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/common/utils.c",
          "lines": "70-112",
          "snippet": "char *string_concat(const char *str, ...)\n{\n\tsize_t len;\n\tva_list args;\n\tchar *s;\n\tchar *result;\n\tchar *dest;\n\n\tif (!str)\n\t\treturn NULL;\n\n\t/* Compute final length */\n\n\tlen = strlen(str) + 1; /* plus 1 for the null terminator */\n\n\tva_start(args, str);\n\ts = va_arg(args, char *);\n\twhile (s) {\n\t\tlen += strlen(s);\n\t\ts = va_arg(args, char*);\n\t}\n\tva_end(args);\n\n\t/* Concat each string */\n\n\tresult = malloc(len);\n\tif (!result)\n\t\treturn NULL; /* errno remains set */\n\n\tdest = result;\n\n\tdest = stpcpy(dest, str);\n\n\tva_start(args, str);\n\ts = va_arg(args, char *);\n\twhile (s) {\n\t\tdest = stpcpy(dest, s);\n\t\ts = va_arg(args, char *);\n\t}\n\tva_end(args);\n\n\treturn result;\n}",
          "includes": [
            "#include \"utils.h\"",
            "#include <ctype.h>",
            "#include <inttypes.h>",
            "#include <sys/time.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"utils.h\"\n#include <ctype.h>\n#include <inttypes.h>\n#include <sys/time.h>\n#include <time.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <config.h>\n\nchar *string_concat(const char *str, ...)\n{\n\tsize_t len;\n\tva_list args;\n\tchar *s;\n\tchar *result;\n\tchar *dest;\n\n\tif (!str)\n\t\treturn NULL;\n\n\t/* Compute final length */\n\n\tlen = strlen(str) + 1; /* plus 1 for the null terminator */\n\n\tva_start(args, str);\n\ts = va_arg(args, char *);\n\twhile (s) {\n\t\tlen += strlen(s);\n\t\ts = va_arg(args, char*);\n\t}\n\tva_end(args);\n\n\t/* Concat each string */\n\n\tresult = malloc(len);\n\tif (!result)\n\t\treturn NULL; /* errno remains set */\n\n\tdest = result;\n\n\tdest = stpcpy(dest, str);\n\n\tva_start(args, str);\n\ts = va_arg(args, char *);\n\twhile (s) {\n\t\tdest = stpcpy(dest, s);\n\t\ts = va_arg(args, char *);\n\t}\n\tva_end(args);\n\n\treturn result;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DEBUGSERVER_HEX_ENCODE_SECOND_BYTE",
          "args": [
            "checksum"
          ],
          "line": 307
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DEBUGSERVER_HEX_ENCODE_FIRST_BYTE",
          "args": [
            "checksum"
          ],
          "line": 306
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debugserver_get_checksum_for_buffer",
          "args": [
            "encoded_command",
            "encoded_length"
          ],
          "line": 305
        },
        "resolved": true,
        "details": {
          "function_name": "debugserver_get_checksum_for_buffer",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/debugserver.c",
          "lines": "228-238",
          "snippet": "static uint32_t debugserver_get_checksum_for_buffer(const char* buffer, uint32_t size)\n{\n\tuint32_t checksum = 0;\n\tuint32_t i;\n\n\tfor (i = 0; i < size; i++) {\n\t\tchecksum += buffer[i];\n\t}\n\n\treturn checksum;\n}",
          "includes": [
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/debug.h\"",
            "#include \"lockdown.h\"",
            "#include \"debugserver.h\"",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"debugserver.h\"\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic uint32_t debugserver_get_checksum_for_buffer(const char* buffer, uint32_t size)\n{\n\tuint32_t checksum = 0;\n\tuint32_t i;\n\n\tfor (i = 0; i < size; i++) {\n\t\tchecksum += buffer[i];\n\t}\n\n\treturn checksum;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "encoded_command"
          ],
          "line": 302
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debugserver_encode_string",
          "args": [
            "arguments",
            "&encoded",
            "&encoded_length"
          ],
          "line": 296
        },
        "resolved": true,
        "details": {
          "function_name": "debugserver_encode_string",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/debugserver.c",
          "lines": "259-273",
          "snippet": "LIBIMOBILEDEVICE_API void debugserver_encode_string(const char* buffer, char** encoded_buffer, uint32_t* encoded_length)\n{\n\tuint32_t position;\n\tuint32_t index;\n\tuint32_t length = strlen(buffer);\n\t*encoded_length = (2 * length) + DEBUGSERVER_CHECKSUM_HASH_LENGTH + 1;\n\n\t*encoded_buffer = malloc(sizeof(char) * (*encoded_length));\n\tmemset(*encoded_buffer, '\\0', *encoded_length);\n\tfor (position = 0, index = 0; index < length; index++) {\n\t\tposition = (index * (2 * sizeof(char)));\n\t\t(*encoded_buffer)[position] = DEBUGSERVER_HEX_ENCODE_FIRST_BYTE(buffer[index]);\n\t\t(*encoded_buffer)[position + 1] = DEBUGSERVER_HEX_ENCODE_SECOND_BYTE(buffer[index]);\n\t}\n}",
          "includes": [
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/debug.h\"",
            "#include \"lockdown.h\"",
            "#include \"debugserver.h\"",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"debugserver.h\"\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API void debugserver_encode_string(const char* buffer, char** encoded_buffer, uint32_t* encoded_length)\n{\n\tuint32_t position;\n\tuint32_t index;\n\tuint32_t length = strlen(buffer);\n\t*encoded_length = (2 * length) + DEBUGSERVER_CHECKSUM_HASH_LENGTH + 1;\n\n\t*encoded_buffer = malloc(sizeof(char) * (*encoded_length));\n\tmemset(*encoded_buffer, '\\0', *encoded_length);\n\tfor (position = 0, index = 0; index < length; index++) {\n\t\tposition = (index * (2 * sizeof(char)));\n\t\t(*encoded_buffer)[position] = DEBUGSERVER_HEX_ENCODE_FIRST_BYTE(buffer[index]);\n\t\t(*encoded_buffer)[position + 1] = DEBUGSERVER_HEX_ENCODE_SECOND_BYTE(buffer[index]);\n\t}\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"debugserver.h\"\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic void debugserver_format_command(const char* prefix, const char* command, const char* arguments, int calculate_checksum, char** buffer, uint32_t* size)\n{\n\tchar checksum_hash[DEBUGSERVER_CHECKSUM_HASH_LENGTH + 1] = {'#', '0', '0', '\\0'};\n\tchar* encoded = NULL;\n\tuint32_t encoded_length = 0;\n\n\tif (arguments) {\n\t\t/* arguments must be hex encoded */\n\t\tdebugserver_encode_string(arguments, &encoded, &encoded_length);\n\t} else {\n\t\tencoded = NULL;\n\t}\n\n\tchar* encoded_command = string_concat(command, encoded, NULL);\n\tencoded_length = strlen(encoded_command);\n\n\tif (calculate_checksum) {\n\t\tuint32_t checksum = debugserver_get_checksum_for_buffer(encoded_command, encoded_length);\n\t\tchecksum_hash[1] = DEBUGSERVER_HEX_ENCODE_FIRST_BYTE(checksum);\n\t\tchecksum_hash[2] = DEBUGSERVER_HEX_ENCODE_SECOND_BYTE(checksum);\n\t}\n\n\t*buffer = string_concat(prefix, encoded_command, checksum_hash, NULL);\n\t*size = strlen(prefix) + strlen(encoded_command) + DEBUGSERVER_CHECKSUM_HASH_LENGTH;\n\n\tdebug_info(\"formatted command: %s size: %d checksum: 0x%s\", *buffer, *size, checksum_hash);\n\n\tif (encoded_command)\n\t\tfree(encoded_command);\n\n\tif (encoded)\n\t\tfree(encoded);\n}"
  },
  {
    "function_name": "debugserver_decode_string",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/debugserver.c",
    "lines": "275-286",
    "snippet": "LIBIMOBILEDEVICE_API void debugserver_decode_string(const char *encoded_buffer, size_t encoded_length, char** buffer)\n{\n\t*buffer = malloc(sizeof(char) * ((encoded_length / 2)+1));\n\tchar* t = *buffer;\n\tconst char *f = encoded_buffer;\n\tconst char *fend = f + encoded_length;\n\twhile (f < fend) {\n\t\t*t++ = debugserver_hex2int(*f) << 4 | debugserver_hex2int(f[1]);\n\t\tf += 2;\n\t}\n\t*t = '\\0';\n}",
    "includes": [
      "#include \"asprintf.h\"",
      "#include \"common/utils.h\"",
      "#include \"common/debug.h\"",
      "#include \"lockdown.h\"",
      "#include \"debugserver.h\"",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "debugserver_hex2int",
          "args": [
            "f[1]"
          ],
          "line": 282
        },
        "resolved": true,
        "details": {
          "function_name": "debugserver_hex2int",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/debugserver.c",
          "lines": "205-215",
          "snippet": "static int debugserver_hex2int(char c)\n{\n\tif (c >= '0' && c <= '9')\n\t\treturn c - '0';\n\telse if (c >= 'a' && c <= 'f')\n\t\treturn 10 + c - 'a';\n\telse if (c >= 'A' && c <= 'F')\n\t\treturn 10 + c - 'A';\n\telse\n\t\treturn c;\n}",
          "includes": [
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/debug.h\"",
            "#include \"lockdown.h\"",
            "#include \"debugserver.h\"",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"debugserver.h\"\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic int debugserver_hex2int(char c)\n{\n\tif (c >= '0' && c <= '9')\n\t\treturn c - '0';\n\telse if (c >= 'a' && c <= 'f')\n\t\treturn 10 + c - 'a';\n\telse if (c >= 'A' && c <= 'F')\n\t\treturn 10 + c - 'A';\n\telse\n\t\treturn c;\n}"
        }
      },
      {
        "call_info": {
          "callee": "malloc",
          "args": [
            "sizeof(char) * ((encoded_length / 2)+1)"
          ],
          "line": 277
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"debugserver.h\"\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API void debugserver_decode_string(const char *encoded_buffer, size_t encoded_length, char** buffer)\n{\n\t*buffer = malloc(sizeof(char) * ((encoded_length / 2)+1));\n\tchar* t = *buffer;\n\tconst char *f = encoded_buffer;\n\tconst char *fend = f + encoded_length;\n\twhile (f < fend) {\n\t\t*t++ = debugserver_hex2int(*f) << 4 | debugserver_hex2int(f[1]);\n\t\tf += 2;\n\t}\n\t*t = '\\0';\n}"
  },
  {
    "function_name": "debugserver_encode_string",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/debugserver.c",
    "lines": "259-273",
    "snippet": "LIBIMOBILEDEVICE_API void debugserver_encode_string(const char* buffer, char** encoded_buffer, uint32_t* encoded_length)\n{\n\tuint32_t position;\n\tuint32_t index;\n\tuint32_t length = strlen(buffer);\n\t*encoded_length = (2 * length) + DEBUGSERVER_CHECKSUM_HASH_LENGTH + 1;\n\n\t*encoded_buffer = malloc(sizeof(char) * (*encoded_length));\n\tmemset(*encoded_buffer, '\\0', *encoded_length);\n\tfor (position = 0, index = 0; index < length; index++) {\n\t\tposition = (index * (2 * sizeof(char)));\n\t\t(*encoded_buffer)[position] = DEBUGSERVER_HEX_ENCODE_FIRST_BYTE(buffer[index]);\n\t\t(*encoded_buffer)[position + 1] = DEBUGSERVER_HEX_ENCODE_SECOND_BYTE(buffer[index]);\n\t}\n}",
    "includes": [
      "#include \"asprintf.h\"",
      "#include \"common/utils.h\"",
      "#include \"common/debug.h\"",
      "#include \"lockdown.h\"",
      "#include \"debugserver.h\"",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "DEBUGSERVER_HEX_ENCODE_SECOND_BYTE",
          "args": [
            "buffer[index]"
          ],
          "line": 271
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DEBUGSERVER_HEX_ENCODE_FIRST_BYTE",
          "args": [
            "buffer[index]"
          ],
          "line": 270
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "*encoded_buffer",
            "'\\0'",
            "*encoded_length"
          ],
          "line": 267
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "malloc",
          "args": [
            "sizeof(char) * (*encoded_length)"
          ],
          "line": 266
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "buffer"
          ],
          "line": 263
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"debugserver.h\"\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API void debugserver_encode_string(const char* buffer, char** encoded_buffer, uint32_t* encoded_length)\n{\n\tuint32_t position;\n\tuint32_t index;\n\tuint32_t length = strlen(buffer);\n\t*encoded_length = (2 * length) + DEBUGSERVER_CHECKSUM_HASH_LENGTH + 1;\n\n\t*encoded_buffer = malloc(sizeof(char) * (*encoded_length));\n\tmemset(*encoded_buffer, '\\0', *encoded_length);\n\tfor (position = 0, index = 0; index < length; index++) {\n\t\tposition = (index * (2 * sizeof(char)));\n\t\t(*encoded_buffer)[position] = DEBUGSERVER_HEX_ENCODE_FIRST_BYTE(buffer[index]);\n\t\t(*encoded_buffer)[position + 1] = DEBUGSERVER_HEX_ENCODE_SECOND_BYTE(buffer[index]);\n\t}\n}"
  },
  {
    "function_name": "debugserver_response_is_checksum_valid",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/debugserver.c",
    "lines": "240-257",
    "snippet": "static int debugserver_response_is_checksum_valid(const char* response, uint32_t size)\n{\n\tuint32_t checksum = 0;\n\tif ((size - DEBUGSERVER_CHECKSUM_HASH_LENGTH - 1) > 0)\n\t\tchecksum = debugserver_get_checksum_for_buffer(&response[1], size - DEBUGSERVER_CHECKSUM_HASH_LENGTH - 1);\n\n\tdebug_info(\"checksum: 0x%x\", checksum);\n\n\tif ((unsigned)debugserver_hex2int(response[size - 2]) != DEBUGSERVER_HEX_DECODE_FIRST_BYTE(checksum))\n\t\treturn 0;\n\n\tif ((unsigned)debugserver_hex2int(response[size - 1]) != DEBUGSERVER_HEX_DECODE_SECOND_BYTE(checksum))\n\t\treturn 0;\n\n\tdebug_info(\"valid checksum\");\n\n\treturn 1;\n}",
    "includes": [
      "#include \"asprintf.h\"",
      "#include \"common/utils.h\"",
      "#include \"common/debug.h\"",
      "#include \"lockdown.h\"",
      "#include \"debugserver.h\"",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"valid checksum\""
          ],
          "line": 254
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DEBUGSERVER_HEX_DECODE_SECOND_BYTE",
          "args": [
            "checksum"
          ],
          "line": 251
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debugserver_hex2int",
          "args": [
            "response[size - 1]"
          ],
          "line": 251
        },
        "resolved": true,
        "details": {
          "function_name": "debugserver_hex2int",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/debugserver.c",
          "lines": "205-215",
          "snippet": "static int debugserver_hex2int(char c)\n{\n\tif (c >= '0' && c <= '9')\n\t\treturn c - '0';\n\telse if (c >= 'a' && c <= 'f')\n\t\treturn 10 + c - 'a';\n\telse if (c >= 'A' && c <= 'F')\n\t\treturn 10 + c - 'A';\n\telse\n\t\treturn c;\n}",
          "includes": [
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/debug.h\"",
            "#include \"lockdown.h\"",
            "#include \"debugserver.h\"",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"debugserver.h\"\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic int debugserver_hex2int(char c)\n{\n\tif (c >= '0' && c <= '9')\n\t\treturn c - '0';\n\telse if (c >= 'a' && c <= 'f')\n\t\treturn 10 + c - 'a';\n\telse if (c >= 'A' && c <= 'F')\n\t\treturn 10 + c - 'A';\n\telse\n\t\treturn c;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DEBUGSERVER_HEX_DECODE_FIRST_BYTE",
          "args": [
            "checksum"
          ],
          "line": 248
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"checksum: 0x%x\"",
            "checksum"
          ],
          "line": 246
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debugserver_get_checksum_for_buffer",
          "args": [
            "&response[1]",
            "size - DEBUGSERVER_CHECKSUM_HASH_LENGTH - 1"
          ],
          "line": 244
        },
        "resolved": true,
        "details": {
          "function_name": "debugserver_get_checksum_for_buffer",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/debugserver.c",
          "lines": "228-238",
          "snippet": "static uint32_t debugserver_get_checksum_for_buffer(const char* buffer, uint32_t size)\n{\n\tuint32_t checksum = 0;\n\tuint32_t i;\n\n\tfor (i = 0; i < size; i++) {\n\t\tchecksum += buffer[i];\n\t}\n\n\treturn checksum;\n}",
          "includes": [
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/debug.h\"",
            "#include \"lockdown.h\"",
            "#include \"debugserver.h\"",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"debugserver.h\"\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic uint32_t debugserver_get_checksum_for_buffer(const char* buffer, uint32_t size)\n{\n\tuint32_t checksum = 0;\n\tuint32_t i;\n\n\tfor (i = 0; i < size; i++) {\n\t\tchecksum += buffer[i];\n\t}\n\n\treturn checksum;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"debugserver.h\"\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic int debugserver_response_is_checksum_valid(const char* response, uint32_t size)\n{\n\tuint32_t checksum = 0;\n\tif ((size - DEBUGSERVER_CHECKSUM_HASH_LENGTH - 1) > 0)\n\t\tchecksum = debugserver_get_checksum_for_buffer(&response[1], size - DEBUGSERVER_CHECKSUM_HASH_LENGTH - 1);\n\n\tdebug_info(\"checksum: 0x%x\", checksum);\n\n\tif ((unsigned)debugserver_hex2int(response[size - 2]) != DEBUGSERVER_HEX_DECODE_FIRST_BYTE(checksum))\n\t\treturn 0;\n\n\tif ((unsigned)debugserver_hex2int(response[size - 1]) != DEBUGSERVER_HEX_DECODE_SECOND_BYTE(checksum))\n\t\treturn 0;\n\n\tdebug_info(\"valid checksum\");\n\n\treturn 1;\n}"
  },
  {
    "function_name": "debugserver_get_checksum_for_buffer",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/debugserver.c",
    "lines": "228-238",
    "snippet": "static uint32_t debugserver_get_checksum_for_buffer(const char* buffer, uint32_t size)\n{\n\tuint32_t checksum = 0;\n\tuint32_t i;\n\n\tfor (i = 0; i < size; i++) {\n\t\tchecksum += buffer[i];\n\t}\n\n\treturn checksum;\n}",
    "includes": [
      "#include \"asprintf.h\"",
      "#include \"common/utils.h\"",
      "#include \"common/debug.h\"",
      "#include \"lockdown.h\"",
      "#include \"debugserver.h\"",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"debugserver.h\"\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic uint32_t debugserver_get_checksum_for_buffer(const char* buffer, uint32_t size)\n{\n\tuint32_t checksum = 0;\n\tuint32_t i;\n\n\tfor (i = 0; i < size; i++) {\n\t\tchecksum += buffer[i];\n\t}\n\n\treturn checksum;\n}"
  },
  {
    "function_name": "debugserver_int2hex",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/debugserver.c",
    "lines": "217-221",
    "snippet": "static char debugserver_int2hex(int x)\n{\n\tconst char *hexchars = \"0123456789ABCDEF\";\n\treturn hexchars[x];\n}",
    "includes": [
      "#include \"asprintf.h\"",
      "#include \"common/utils.h\"",
      "#include \"common/debug.h\"",
      "#include \"lockdown.h\"",
      "#include \"debugserver.h\"",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"debugserver.h\"\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic char debugserver_int2hex(int x)\n{\n\tconst char *hexchars = \"0123456789ABCDEF\";\n\treturn hexchars[x];\n}"
  },
  {
    "function_name": "debugserver_hex2int",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/debugserver.c",
    "lines": "205-215",
    "snippet": "static int debugserver_hex2int(char c)\n{\n\tif (c >= '0' && c <= '9')\n\t\treturn c - '0';\n\telse if (c >= 'a' && c <= 'f')\n\t\treturn 10 + c - 'a';\n\telse if (c >= 'A' && c <= 'F')\n\t\treturn 10 + c - 'A';\n\telse\n\t\treturn c;\n}",
    "includes": [
      "#include \"asprintf.h\"",
      "#include \"common/utils.h\"",
      "#include \"common/debug.h\"",
      "#include \"lockdown.h\"",
      "#include \"debugserver.h\"",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"debugserver.h\"\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic int debugserver_hex2int(char c)\n{\n\tif (c >= '0' && c <= '9')\n\t\treturn c - '0';\n\telse if (c >= 'a' && c <= 'f')\n\t\treturn 10 + c - 'a';\n\telse if (c >= 'A' && c <= 'F')\n\t\treturn 10 + c - 'A';\n\telse\n\t\treturn c;\n}"
  },
  {
    "function_name": "debugserver_command_free",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/debugserver.c",
    "lines": "181-203",
    "snippet": "LIBIMOBILEDEVICE_API debugserver_error_t debugserver_command_free(debugserver_command_t command)\n{\n\tint i;\n\tdebugserver_error_t res = DEBUGSERVER_E_UNKNOWN_ERROR;\n\n\tif (!command)\n\t\treturn DEBUGSERVER_E_INVALID_ARG;\n\n\tif (command) {\n\t\tif (command->name)\n\t\t\tfree(command->name);\n\t\tif (command->argv && command->argc) {\n\t\t\tfor (i = 0; i < command->argc; i++) {\n\t\t\t\tfree(command->argv[i]);\n\t\t\t}\n\t\t\tfree(command->argv);\n\t\t}\n\t\tfree(command);\n\t\tres = DEBUGSERVER_E_SUCCESS;\n\t}\n\n\treturn res;\n}",
    "includes": [
      "#include \"asprintf.h\"",
      "#include \"common/utils.h\"",
      "#include \"common/debug.h\"",
      "#include \"lockdown.h\"",
      "#include \"debugserver.h\"",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "command"
          ],
          "line": 198
        },
        "resolved": true,
        "details": {
          "function_name": "debugserver_command_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/debugserver.c",
          "lines": "181-203",
          "snippet": "LIBIMOBILEDEVICE_API debugserver_error_t debugserver_command_free(debugserver_command_t command)\n{\n\tint i;\n\tdebugserver_error_t res = DEBUGSERVER_E_UNKNOWN_ERROR;\n\n\tif (!command)\n\t\treturn DEBUGSERVER_E_INVALID_ARG;\n\n\tif (command) {\n\t\tif (command->name)\n\t\t\tfree(command->name);\n\t\tif (command->argv && command->argc) {\n\t\t\tfor (i = 0; i < command->argc; i++) {\n\t\t\t\tfree(command->argv[i]);\n\t\t\t}\n\t\t\tfree(command->argv);\n\t\t}\n\t\tfree(command);\n\t\tres = DEBUGSERVER_E_SUCCESS;\n\t}\n\n\treturn res;\n}",
          "note": "cyclic_reference_detected"
        }
      }
    ],
    "contextual_snippet": "#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"debugserver.h\"\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API debugserver_error_t debugserver_command_free(debugserver_command_t command)\n{\n\tint i;\n\tdebugserver_error_t res = DEBUGSERVER_E_UNKNOWN_ERROR;\n\n\tif (!command)\n\t\treturn DEBUGSERVER_E_INVALID_ARG;\n\n\tif (command) {\n\t\tif (command->name)\n\t\t\tfree(command->name);\n\t\tif (command->argv && command->argc) {\n\t\t\tfor (i = 0; i < command->argc; i++) {\n\t\t\t\tfree(command->argv[i]);\n\t\t\t}\n\t\t\tfree(command->argv);\n\t\t}\n\t\tfree(command);\n\t\tres = DEBUGSERVER_E_SUCCESS;\n\t}\n\n\treturn res;\n}"
  },
  {
    "function_name": "debugserver_command_new",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/debugserver.c",
    "lines": "156-179",
    "snippet": "LIBIMOBILEDEVICE_API debugserver_error_t debugserver_command_new(const char* name, int argc, char* argv[], debugserver_command_t* command)\n{\n\tint i;\n\tdebugserver_command_t tmp = (debugserver_command_t) malloc(sizeof(struct debugserver_command_private));\n\n\t/* copy name */\n\ttmp->name = strdup(name);\n\n\t/* copy arguments */\n\ttmp->argc = argc;\n\ttmp->argv = NULL;\n\tif (argc > 0) {\n\t\ttmp->argv = malloc(sizeof(char*) * (argc + 2));\n\t\tfor (i = 0; i < argc; i++) {\n\t\t\ttmp->argv[i] = strdup(argv[i]);\n\t\t}\n\t\ttmp->argv[i+1] = NULL;\n\t}\n\n\t/* return */\n\t*command = tmp;\n\n\treturn DEBUGSERVER_E_SUCCESS;\n}",
    "includes": [
      "#include \"asprintf.h\"",
      "#include \"common/utils.h\"",
      "#include \"common/debug.h\"",
      "#include \"lockdown.h\"",
      "#include \"debugserver.h\"",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "argv[i]"
          ],
          "line": 170
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "malloc",
          "args": [
            "sizeof(char*) * (argc + 2)"
          ],
          "line": 168
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "name"
          ],
          "line": 162
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "malloc",
          "args": [
            "sizeof(struct debugserver_command_private)"
          ],
          "line": 159
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"debugserver.h\"\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API debugserver_error_t debugserver_command_new(const char* name, int argc, char* argv[], debugserver_command_t* command)\n{\n\tint i;\n\tdebugserver_command_t tmp = (debugserver_command_t) malloc(sizeof(struct debugserver_command_private));\n\n\t/* copy name */\n\ttmp->name = strdup(name);\n\n\t/* copy arguments */\n\ttmp->argc = argc;\n\ttmp->argv = NULL;\n\tif (argc > 0) {\n\t\ttmp->argv = malloc(sizeof(char*) * (argc + 2));\n\t\tfor (i = 0; i < argc; i++) {\n\t\t\ttmp->argv[i] = strdup(argv[i]);\n\t\t}\n\t\ttmp->argv[i+1] = NULL;\n\t}\n\n\t/* return */\n\t*command = tmp;\n\n\treturn DEBUGSERVER_E_SUCCESS;\n}"
  },
  {
    "function_name": "debugserver_client_receive",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/debugserver.c",
    "lines": "151-154",
    "snippet": "LIBIMOBILEDEVICE_API debugserver_error_t debugserver_client_receive(debugserver_client_t client, char* data, uint32_t size, uint32_t *received)\n{\n\treturn debugserver_client_receive_with_timeout(client, data, size, received, 1000);\n}",
    "includes": [
      "#include \"asprintf.h\"",
      "#include \"common/utils.h\"",
      "#include \"common/debug.h\"",
      "#include \"lockdown.h\"",
      "#include \"debugserver.h\"",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "debugserver_client_receive_with_timeout",
          "args": [
            "client",
            "data",
            "size",
            "received",
            "1000"
          ],
          "line": 153
        },
        "resolved": true,
        "details": {
          "function_name": "debugserver_client_receive_with_timeout",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/debugserver.c",
          "lines": "131-149",
          "snippet": "LIBIMOBILEDEVICE_API debugserver_error_t debugserver_client_receive_with_timeout(debugserver_client_t client, char* data, uint32_t size, uint32_t *received, unsigned int timeout)\n{\n\tdebugserver_error_t res = DEBUGSERVER_E_UNKNOWN_ERROR;\n\tint bytes = 0;\n\n\tif (!client || !data || (size == 0)) {\n\t\treturn DEBUGSERVER_E_INVALID_ARG;\n\t}\n\n\tres = debugserver_error(service_receive_with_timeout(client->parent, data, size, (uint32_t*)&bytes, timeout));\n\tif (bytes <= 0) {\n\t\tdebug_info(\"Could not read data, error %d\", res);\n\t}\n\tif (received) {\n\t\t*received = (uint32_t)bytes;\n\t}\n\n\treturn res;\n}",
          "includes": [
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/debug.h\"",
            "#include \"lockdown.h\"",
            "#include \"debugserver.h\"",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"debugserver.h\"\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API debugserver_error_t debugserver_client_receive_with_timeout(debugserver_client_t client, char* data, uint32_t size, uint32_t *received, unsigned int timeout)\n{\n\tdebugserver_error_t res = DEBUGSERVER_E_UNKNOWN_ERROR;\n\tint bytes = 0;\n\n\tif (!client || !data || (size == 0)) {\n\t\treturn DEBUGSERVER_E_INVALID_ARG;\n\t}\n\n\tres = debugserver_error(service_receive_with_timeout(client->parent, data, size, (uint32_t*)&bytes, timeout));\n\tif (bytes <= 0) {\n\t\tdebug_info(\"Could not read data, error %d\", res);\n\t}\n\tif (received) {\n\t\t*received = (uint32_t)bytes;\n\t}\n\n\treturn res;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"debugserver.h\"\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API debugserver_error_t debugserver_client_receive(debugserver_client_t client, char* data, uint32_t size, uint32_t *received)\n{\n\treturn debugserver_client_receive_with_timeout(client, data, size, received, 1000);\n}"
  },
  {
    "function_name": "debugserver_client_receive_with_timeout",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/debugserver.c",
    "lines": "131-149",
    "snippet": "LIBIMOBILEDEVICE_API debugserver_error_t debugserver_client_receive_with_timeout(debugserver_client_t client, char* data, uint32_t size, uint32_t *received, unsigned int timeout)\n{\n\tdebugserver_error_t res = DEBUGSERVER_E_UNKNOWN_ERROR;\n\tint bytes = 0;\n\n\tif (!client || !data || (size == 0)) {\n\t\treturn DEBUGSERVER_E_INVALID_ARG;\n\t}\n\n\tres = debugserver_error(service_receive_with_timeout(client->parent, data, size, (uint32_t*)&bytes, timeout));\n\tif (bytes <= 0) {\n\t\tdebug_info(\"Could not read data, error %d\", res);\n\t}\n\tif (received) {\n\t\t*received = (uint32_t)bytes;\n\t}\n\n\treturn res;\n}",
    "includes": [
      "#include \"asprintf.h\"",
      "#include \"common/utils.h\"",
      "#include \"common/debug.h\"",
      "#include \"lockdown.h\"",
      "#include \"debugserver.h\"",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"Could not read data, error %d\"",
            "res"
          ],
          "line": 142
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debugserver_error",
          "args": [
            "service_receive_with_timeout(client->parent, data, size, (uint32_t*)&bytes, timeout)"
          ],
          "line": 140
        },
        "resolved": true,
        "details": {
          "function_name": "debugserver_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/debugserver.c",
          "lines": "46-61",
          "snippet": "static debugserver_error_t debugserver_error(service_error_t err)\n{\n\tswitch (err) {\n\t\tcase SERVICE_E_SUCCESS:\n\t\t\treturn DEBUGSERVER_E_SUCCESS;\n\t\tcase SERVICE_E_INVALID_ARG:\n\t\t\treturn DEBUGSERVER_E_INVALID_ARG;\n\t\tcase SERVICE_E_MUX_ERROR:\n\t\t\treturn DEBUGSERVER_E_MUX_ERROR;\n\t\tcase SERVICE_E_SSL_ERROR:\n\t\t\treturn DEBUGSERVER_E_SSL_ERROR;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn DEBUGSERVER_E_UNKNOWN_ERROR;\n}",
          "includes": [
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/debug.h\"",
            "#include \"lockdown.h\"",
            "#include \"debugserver.h\"",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"debugserver.h\"\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic debugserver_error_t debugserver_error(service_error_t err)\n{\n\tswitch (err) {\n\t\tcase SERVICE_E_SUCCESS:\n\t\t\treturn DEBUGSERVER_E_SUCCESS;\n\t\tcase SERVICE_E_INVALID_ARG:\n\t\t\treturn DEBUGSERVER_E_INVALID_ARG;\n\t\tcase SERVICE_E_MUX_ERROR:\n\t\t\treturn DEBUGSERVER_E_MUX_ERROR;\n\t\tcase SERVICE_E_SSL_ERROR:\n\t\t\treturn DEBUGSERVER_E_SSL_ERROR;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn DEBUGSERVER_E_UNKNOWN_ERROR;\n}"
        }
      },
      {
        "call_info": {
          "callee": "service_receive_with_timeout",
          "args": [
            "client->parent",
            "data",
            "size",
            "(uint32_t*)&bytes",
            "timeout"
          ],
          "line": 140
        },
        "resolved": true,
        "details": {
          "function_name": "service_receive_with_timeout",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/service.c",
          "lines": "152-170",
          "snippet": "LIBIMOBILEDEVICE_API service_error_t service_receive_with_timeout(service_client_t client, char* data, uint32_t size, uint32_t *received, unsigned int timeout)\n{\n\tservice_error_t res = SERVICE_E_UNKNOWN_ERROR;\n\tint bytes = 0;\n\n\tif (!client || (client && !client->connection) || !data || (size == 0)) {\n\t\treturn SERVICE_E_INVALID_ARG;\n\t}\n\n\tres = idevice_to_service_error(idevice_connection_receive_timeout(client->connection, data, size, (uint32_t*)&bytes, timeout));\n\tif (bytes <= 0) {\n\t\tdebug_info(\"could not read data\");\n\t}\n\tif (received) {\n\t\t*received = (uint32_t)bytes;\n\t}\n\n\treturn res;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API service_error_t service_receive_with_timeout(service_client_t client, char* data, uint32_t size, uint32_t *received, unsigned int timeout)\n{\n\tservice_error_t res = SERVICE_E_UNKNOWN_ERROR;\n\tint bytes = 0;\n\n\tif (!client || (client && !client->connection) || !data || (size == 0)) {\n\t\treturn SERVICE_E_INVALID_ARG;\n\t}\n\n\tres = idevice_to_service_error(idevice_connection_receive_timeout(client->connection, data, size, (uint32_t*)&bytes, timeout));\n\tif (bytes <= 0) {\n\t\tdebug_info(\"could not read data\");\n\t}\n\tif (received) {\n\t\t*received = (uint32_t)bytes;\n\t}\n\n\treturn res;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"debugserver.h\"\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API debugserver_error_t debugserver_client_receive_with_timeout(debugserver_client_t client, char* data, uint32_t size, uint32_t *received, unsigned int timeout)\n{\n\tdebugserver_error_t res = DEBUGSERVER_E_UNKNOWN_ERROR;\n\tint bytes = 0;\n\n\tif (!client || !data || (size == 0)) {\n\t\treturn DEBUGSERVER_E_INVALID_ARG;\n\t}\n\n\tres = debugserver_error(service_receive_with_timeout(client->parent, data, size, (uint32_t*)&bytes, timeout));\n\tif (bytes <= 0) {\n\t\tdebug_info(\"Could not read data, error %d\", res);\n\t}\n\tif (received) {\n\t\t*received = (uint32_t)bytes;\n\t}\n\n\treturn res;\n}"
  },
  {
    "function_name": "debugserver_client_send",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/debugserver.c",
    "lines": "110-129",
    "snippet": "LIBIMOBILEDEVICE_API debugserver_error_t debugserver_client_send(debugserver_client_t client, const char* data, uint32_t size, uint32_t *sent)\n{\n\tdebugserver_error_t res = DEBUGSERVER_E_UNKNOWN_ERROR;\n\tint bytes = 0;\n\n\tif (!client || !data || (size == 0)) {\n\t\treturn DEBUGSERVER_E_INVALID_ARG;\n\t}\n\n\tdebug_info(\"sending %d bytes\", size);\n\tres = debugserver_error(service_send(client->parent, data, size, (uint32_t*)&bytes));\n\tif (bytes <= 0) {\n\t\tdebug_info(\"ERROR: sending to device failed.\");\n\t}\n\tif (sent) {\n\t\t*sent = (uint32_t)bytes;\n\t}\n\n\treturn res;\n}",
    "includes": [
      "#include \"asprintf.h\"",
      "#include \"common/utils.h\"",
      "#include \"common/debug.h\"",
      "#include \"lockdown.h\"",
      "#include \"debugserver.h\"",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"ERROR: sending to device failed.\""
          ],
          "line": 122
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debugserver_error",
          "args": [
            "service_send(client->parent, data, size, (uint32_t*)&bytes)"
          ],
          "line": 120
        },
        "resolved": true,
        "details": {
          "function_name": "debugserver_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/debugserver.c",
          "lines": "46-61",
          "snippet": "static debugserver_error_t debugserver_error(service_error_t err)\n{\n\tswitch (err) {\n\t\tcase SERVICE_E_SUCCESS:\n\t\t\treturn DEBUGSERVER_E_SUCCESS;\n\t\tcase SERVICE_E_INVALID_ARG:\n\t\t\treturn DEBUGSERVER_E_INVALID_ARG;\n\t\tcase SERVICE_E_MUX_ERROR:\n\t\t\treturn DEBUGSERVER_E_MUX_ERROR;\n\t\tcase SERVICE_E_SSL_ERROR:\n\t\t\treturn DEBUGSERVER_E_SSL_ERROR;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn DEBUGSERVER_E_UNKNOWN_ERROR;\n}",
          "includes": [
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/debug.h\"",
            "#include \"lockdown.h\"",
            "#include \"debugserver.h\"",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"debugserver.h\"\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic debugserver_error_t debugserver_error(service_error_t err)\n{\n\tswitch (err) {\n\t\tcase SERVICE_E_SUCCESS:\n\t\t\treturn DEBUGSERVER_E_SUCCESS;\n\t\tcase SERVICE_E_INVALID_ARG:\n\t\t\treturn DEBUGSERVER_E_INVALID_ARG;\n\t\tcase SERVICE_E_MUX_ERROR:\n\t\t\treturn DEBUGSERVER_E_MUX_ERROR;\n\t\tcase SERVICE_E_SSL_ERROR:\n\t\t\treturn DEBUGSERVER_E_SSL_ERROR;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn DEBUGSERVER_E_UNKNOWN_ERROR;\n}"
        }
      },
      {
        "call_info": {
          "callee": "service_send",
          "args": [
            "client->parent",
            "data",
            "size",
            "(uint32_t*)&bytes"
          ],
          "line": 120
        },
        "resolved": true,
        "details": {
          "function_name": "service_send",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/service.c",
          "lines": "131-150",
          "snippet": "LIBIMOBILEDEVICE_API service_error_t service_send(service_client_t client, const char* data, uint32_t size, uint32_t *sent)\n{\n\tservice_error_t res = SERVICE_E_UNKNOWN_ERROR;\n\tint bytes = 0;\n\n\tif (!client || (client && !client->connection) || !data || (size == 0)) {\n\t\treturn SERVICE_E_INVALID_ARG;\n\t}\n\n\tdebug_info(\"sending %d bytes\", size);\n\tres = idevice_to_service_error(idevice_connection_send(client->connection, data, size, (uint32_t*)&bytes));\n\tif (bytes <= 0) {\n\t\tdebug_info(\"ERROR: sending to device failed.\");\n\t}\n\tif (sent) {\n\t\t*sent = (uint32_t)bytes;\n\t}\n\n\treturn res;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API service_error_t service_send(service_client_t client, const char* data, uint32_t size, uint32_t *sent)\n{\n\tservice_error_t res = SERVICE_E_UNKNOWN_ERROR;\n\tint bytes = 0;\n\n\tif (!client || (client && !client->connection) || !data || (size == 0)) {\n\t\treturn SERVICE_E_INVALID_ARG;\n\t}\n\n\tdebug_info(\"sending %d bytes\", size);\n\tres = idevice_to_service_error(idevice_connection_send(client->connection, data, size, (uint32_t*)&bytes));\n\tif (bytes <= 0) {\n\t\tdebug_info(\"ERROR: sending to device failed.\");\n\t}\n\tif (sent) {\n\t\t*sent = (uint32_t)bytes;\n\t}\n\n\treturn res;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"sending %d bytes\"",
            "size"
          ],
          "line": 119
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"debugserver.h\"\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API debugserver_error_t debugserver_client_send(debugserver_client_t client, const char* data, uint32_t size, uint32_t *sent)\n{\n\tdebugserver_error_t res = DEBUGSERVER_E_UNKNOWN_ERROR;\n\tint bytes = 0;\n\n\tif (!client || !data || (size == 0)) {\n\t\treturn DEBUGSERVER_E_INVALID_ARG;\n\t}\n\n\tdebug_info(\"sending %d bytes\", size);\n\tres = debugserver_error(service_send(client->parent, data, size, (uint32_t*)&bytes));\n\tif (bytes <= 0) {\n\t\tdebug_info(\"ERROR: sending to device failed.\");\n\t}\n\tif (sent) {\n\t\t*sent = (uint32_t)bytes;\n\t}\n\n\treturn res;\n}"
  },
  {
    "function_name": "debugserver_client_free",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/debugserver.c",
    "lines": "98-108",
    "snippet": "LIBIMOBILEDEVICE_API debugserver_error_t debugserver_client_free(debugserver_client_t client)\n{\n\tif (!client)\n\t\treturn DEBUGSERVER_E_INVALID_ARG;\n\n\tdebugserver_error_t err = debugserver_error(service_client_free(client->parent));\n\tclient->parent = NULL;\n\tfree(client);\n\n\treturn err;\n}",
    "includes": [
      "#include \"asprintf.h\"",
      "#include \"common/utils.h\"",
      "#include \"common/debug.h\"",
      "#include \"lockdown.h\"",
      "#include \"debugserver.h\"",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "client"
          ],
          "line": 105
        },
        "resolved": true,
        "details": {
          "function_name": "debugserver_command_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/debugserver.c",
          "lines": "181-203",
          "snippet": "LIBIMOBILEDEVICE_API debugserver_error_t debugserver_command_free(debugserver_command_t command)\n{\n\tint i;\n\tdebugserver_error_t res = DEBUGSERVER_E_UNKNOWN_ERROR;\n\n\tif (!command)\n\t\treturn DEBUGSERVER_E_INVALID_ARG;\n\n\tif (command) {\n\t\tif (command->name)\n\t\t\tfree(command->name);\n\t\tif (command->argv && command->argc) {\n\t\t\tfor (i = 0; i < command->argc; i++) {\n\t\t\t\tfree(command->argv[i]);\n\t\t\t}\n\t\t\tfree(command->argv);\n\t\t}\n\t\tfree(command);\n\t\tres = DEBUGSERVER_E_SUCCESS;\n\t}\n\n\treturn res;\n}",
          "includes": [
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/debug.h\"",
            "#include \"lockdown.h\"",
            "#include \"debugserver.h\"",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"debugserver.h\"\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API debugserver_error_t debugserver_command_free(debugserver_command_t command)\n{\n\tint i;\n\tdebugserver_error_t res = DEBUGSERVER_E_UNKNOWN_ERROR;\n\n\tif (!command)\n\t\treturn DEBUGSERVER_E_INVALID_ARG;\n\n\tif (command) {\n\t\tif (command->name)\n\t\t\tfree(command->name);\n\t\tif (command->argv && command->argc) {\n\t\t\tfor (i = 0; i < command->argc; i++) {\n\t\t\t\tfree(command->argv[i]);\n\t\t\t}\n\t\t\tfree(command->argv);\n\t\t}\n\t\tfree(command);\n\t\tres = DEBUGSERVER_E_SUCCESS;\n\t}\n\n\treturn res;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debugserver_error",
          "args": [
            "service_client_free(client->parent)"
          ],
          "line": 103
        },
        "resolved": true,
        "details": {
          "function_name": "debugserver_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/debugserver.c",
          "lines": "46-61",
          "snippet": "static debugserver_error_t debugserver_error(service_error_t err)\n{\n\tswitch (err) {\n\t\tcase SERVICE_E_SUCCESS:\n\t\t\treturn DEBUGSERVER_E_SUCCESS;\n\t\tcase SERVICE_E_INVALID_ARG:\n\t\t\treturn DEBUGSERVER_E_INVALID_ARG;\n\t\tcase SERVICE_E_MUX_ERROR:\n\t\t\treturn DEBUGSERVER_E_MUX_ERROR;\n\t\tcase SERVICE_E_SSL_ERROR:\n\t\t\treturn DEBUGSERVER_E_SSL_ERROR;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn DEBUGSERVER_E_UNKNOWN_ERROR;\n}",
          "includes": [
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/debug.h\"",
            "#include \"lockdown.h\"",
            "#include \"debugserver.h\"",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"debugserver.h\"\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic debugserver_error_t debugserver_error(service_error_t err)\n{\n\tswitch (err) {\n\t\tcase SERVICE_E_SUCCESS:\n\t\t\treturn DEBUGSERVER_E_SUCCESS;\n\t\tcase SERVICE_E_INVALID_ARG:\n\t\t\treturn DEBUGSERVER_E_INVALID_ARG;\n\t\tcase SERVICE_E_MUX_ERROR:\n\t\t\treturn DEBUGSERVER_E_MUX_ERROR;\n\t\tcase SERVICE_E_SSL_ERROR:\n\t\t\treturn DEBUGSERVER_E_SSL_ERROR;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn DEBUGSERVER_E_UNKNOWN_ERROR;\n}"
        }
      },
      {
        "call_info": {
          "callee": "service_client_free",
          "args": [
            "client->parent"
          ],
          "line": 103
        },
        "resolved": true,
        "details": {
          "function_name": "device_link_service_client_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/device_link_service.c",
          "lines": "119-129",
          "snippet": "device_link_service_error_t device_link_service_client_free(device_link_service_client_t client)\n{\n\tif (!client)\n\t\treturn DEVICE_LINK_SERVICE_E_INVALID_ARG;\n\n\tif (property_list_service_client_free(client->parent) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\treturn DEVICE_LINK_SERVICE_E_UNKNOWN_ERROR;\n\t}\n\tfree(client);\n\treturn DEVICE_LINK_SERVICE_E_SUCCESS;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include \"device_link_service.h\"",
            "#include <stdlib.h>",
            "#include <string.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"device_link_service.h\"\n#include <stdlib.h>\n#include <string.h>\n\ndevice_link_service_error_t device_link_service_client_free(device_link_service_client_t client)\n{\n\tif (!client)\n\t\treturn DEVICE_LINK_SERVICE_E_INVALID_ARG;\n\n\tif (property_list_service_client_free(client->parent) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\treturn DEVICE_LINK_SERVICE_E_UNKNOWN_ERROR;\n\t}\n\tfree(client);\n\treturn DEVICE_LINK_SERVICE_E_SUCCESS;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"debugserver.h\"\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API debugserver_error_t debugserver_client_free(debugserver_client_t client)\n{\n\tif (!client)\n\t\treturn DEBUGSERVER_E_INVALID_ARG;\n\n\tdebugserver_error_t err = debugserver_error(service_client_free(client->parent));\n\tclient->parent = NULL;\n\tfree(client);\n\n\treturn err;\n}"
  },
  {
    "function_name": "debugserver_client_start_service",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/debugserver.c",
    "lines": "91-96",
    "snippet": "LIBIMOBILEDEVICE_API debugserver_error_t debugserver_client_start_service(idevice_t device, debugserver_client_t * client, const char* label)\n{\n\tdebugserver_error_t err = DEBUGSERVER_E_UNKNOWN_ERROR;\n\tservice_client_factory_start_service(device, DEBUGSERVER_SERVICE_NAME, (void**)client, label, SERVICE_CONSTRUCTOR(debugserver_client_new), &err);\n\treturn err;\n}",
    "includes": [
      "#include \"asprintf.h\"",
      "#include \"common/utils.h\"",
      "#include \"common/debug.h\"",
      "#include \"lockdown.h\"",
      "#include \"debugserver.h\"",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "service_client_factory_start_service",
          "args": [
            "device",
            "DEBUGSERVER_SERVICE_NAME",
            "(void**)client",
            "label",
            "SERVICE_CONSTRUCTOR(debugserver_client_new)",
            "&err"
          ],
          "line": 94
        },
        "resolved": true,
        "details": {
          "function_name": "service_client_factory_start_service",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/service.c",
          "lines": "79-116",
          "snippet": "LIBIMOBILEDEVICE_API service_error_t service_client_factory_start_service(idevice_t device, const char* service_name, void **client, const char* label, int32_t (*constructor_func)(idevice_t, lockdownd_service_descriptor_t, void**), int32_t *error_code)\n{\n\t*client = NULL;\n\n\tlockdownd_client_t lckd = NULL;\n\tif (LOCKDOWN_E_SUCCESS != lockdownd_client_new_with_handshake(device, &lckd, label)) {\n\t\tdebug_info(\"Could not create a lockdown client.\");\n\t\treturn SERVICE_E_START_SERVICE_ERROR;\n\t}\n\n\tlockdownd_service_descriptor_t service = NULL;\n\tlockdownd_start_service(lckd, service_name, &service);\n\tlockdownd_client_free(lckd);\n\n\tif (!service || service->port == 0) {\n\t\tdebug_info(\"Could not start service %s!\", service_name);\n\t\treturn SERVICE_E_START_SERVICE_ERROR;\n\t}\n\n\tint32_t ec;\n\tif (constructor_func) {\n\t\tec = (int32_t)constructor_func(device, service, client);\n\t} else {\n\t\tec = service_client_new(device, service, (service_client_t*)client);\n\t}\n\tif (error_code) {\n\t\t*error_code = ec;\n\t}\n\n\tif (ec != SERVICE_E_SUCCESS) {\n\t\tdebug_info(\"Could not connect to service %s! Port: %i, error: %i\", service_name, service->port, ec);\n\t}\n\n\tlockdownd_service_descriptor_free(service);\n\tservice = NULL;\n\n\treturn (ec == SERVICE_E_SUCCESS) ? SERVICE_E_SUCCESS : SERVICE_E_START_SERVICE_ERROR;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API service_error_t service_client_factory_start_service(idevice_t device, const char* service_name, void **client, const char* label, int32_t (*constructor_func)(idevice_t, lockdownd_service_descriptor_t, void**), int32_t *error_code)\n{\n\t*client = NULL;\n\n\tlockdownd_client_t lckd = NULL;\n\tif (LOCKDOWN_E_SUCCESS != lockdownd_client_new_with_handshake(device, &lckd, label)) {\n\t\tdebug_info(\"Could not create a lockdown client.\");\n\t\treturn SERVICE_E_START_SERVICE_ERROR;\n\t}\n\n\tlockdownd_service_descriptor_t service = NULL;\n\tlockdownd_start_service(lckd, service_name, &service);\n\tlockdownd_client_free(lckd);\n\n\tif (!service || service->port == 0) {\n\t\tdebug_info(\"Could not start service %s!\", service_name);\n\t\treturn SERVICE_E_START_SERVICE_ERROR;\n\t}\n\n\tint32_t ec;\n\tif (constructor_func) {\n\t\tec = (int32_t)constructor_func(device, service, client);\n\t} else {\n\t\tec = service_client_new(device, service, (service_client_t*)client);\n\t}\n\tif (error_code) {\n\t\t*error_code = ec;\n\t}\n\n\tif (ec != SERVICE_E_SUCCESS) {\n\t\tdebug_info(\"Could not connect to service %s! Port: %i, error: %i\", service_name, service->port, ec);\n\t}\n\n\tlockdownd_service_descriptor_free(service);\n\tservice = NULL;\n\n\treturn (ec == SERVICE_E_SUCCESS) ? SERVICE_E_SUCCESS : SERVICE_E_START_SERVICE_ERROR;\n}"
        }
      },
      {
        "call_info": {
          "callee": "SERVICE_CONSTRUCTOR",
          "args": [
            "debugserver_client_new"
          ],
          "line": 94
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"debugserver.h\"\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API debugserver_error_t debugserver_client_start_service(idevice_t device, debugserver_client_t * client, const char* label)\n{\n\tdebugserver_error_t err = DEBUGSERVER_E_UNKNOWN_ERROR;\n\tservice_client_factory_start_service(device, DEBUGSERVER_SERVICE_NAME, (void**)client, label, SERVICE_CONSTRUCTOR(debugserver_client_new), &err);\n\treturn err;\n}"
  },
  {
    "function_name": "debugserver_client_new",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/debugserver.c",
    "lines": "63-89",
    "snippet": "LIBIMOBILEDEVICE_API debugserver_error_t debugserver_client_new(idevice_t device, lockdownd_service_descriptor_t service, debugserver_client_t* client)\n{\n\t*client = NULL;\n\n\tif (!device || !service || service->port == 0 || !client || *client) {\n\t\tdebug_info(\"Incorrect parameter passed to debugserver_client_new.\");\n\t\treturn DEBUGSERVER_E_INVALID_ARG;\n\t}\n\n\tdebug_info(\"Creating debugserver_client, port = %d.\", service->port);\n\n\tservice_client_t parent = NULL;\n\tdebugserver_error_t ret = debugserver_error(service_client_new(device, service, &parent));\n\tif (ret != DEBUGSERVER_E_SUCCESS) {\n\t\tdebug_info(\"Creating base service client failed. Error: %i\", ret);\n\t\treturn ret;\n\t}\n\n\tdebugserver_client_t client_loc = (debugserver_client_t) malloc(sizeof(struct debugserver_client_private));\n\tclient_loc->parent = parent;\n\tclient_loc->noack_mode = 0;\n\n\t*client = client_loc;\n\n\tdebug_info(\"debugserver_client successfully created.\");\n\treturn DEBUGSERVER_E_SUCCESS;\n}",
    "includes": [
      "#include \"asprintf.h\"",
      "#include \"common/utils.h\"",
      "#include \"common/debug.h\"",
      "#include \"lockdown.h\"",
      "#include \"debugserver.h\"",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"debugserver_client successfully created.\""
          ],
          "line": 87
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "malloc",
          "args": [
            "sizeof(struct debugserver_client_private)"
          ],
          "line": 81
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"Creating base service client failed. Error: %i\"",
            "ret"
          ],
          "line": 77
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debugserver_error",
          "args": [
            "service_client_new(device, service, &parent)"
          ],
          "line": 75
        },
        "resolved": true,
        "details": {
          "function_name": "debugserver_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/debugserver.c",
          "lines": "46-61",
          "snippet": "static debugserver_error_t debugserver_error(service_error_t err)\n{\n\tswitch (err) {\n\t\tcase SERVICE_E_SUCCESS:\n\t\t\treturn DEBUGSERVER_E_SUCCESS;\n\t\tcase SERVICE_E_INVALID_ARG:\n\t\t\treturn DEBUGSERVER_E_INVALID_ARG;\n\t\tcase SERVICE_E_MUX_ERROR:\n\t\t\treturn DEBUGSERVER_E_MUX_ERROR;\n\t\tcase SERVICE_E_SSL_ERROR:\n\t\t\treturn DEBUGSERVER_E_SSL_ERROR;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn DEBUGSERVER_E_UNKNOWN_ERROR;\n}",
          "includes": [
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/debug.h\"",
            "#include \"lockdown.h\"",
            "#include \"debugserver.h\"",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"debugserver.h\"\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic debugserver_error_t debugserver_error(service_error_t err)\n{\n\tswitch (err) {\n\t\tcase SERVICE_E_SUCCESS:\n\t\t\treturn DEBUGSERVER_E_SUCCESS;\n\t\tcase SERVICE_E_INVALID_ARG:\n\t\t\treturn DEBUGSERVER_E_INVALID_ARG;\n\t\tcase SERVICE_E_MUX_ERROR:\n\t\t\treturn DEBUGSERVER_E_MUX_ERROR;\n\t\tcase SERVICE_E_SSL_ERROR:\n\t\t\treturn DEBUGSERVER_E_SSL_ERROR;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn DEBUGSERVER_E_UNKNOWN_ERROR;\n}"
        }
      },
      {
        "call_info": {
          "callee": "service_client_new",
          "args": [
            "device",
            "service",
            "&parent"
          ],
          "line": 75
        },
        "resolved": true,
        "details": {
          "function_name": "device_link_service_client_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/device_link_service.c",
          "lines": "85-107",
          "snippet": "device_link_service_error_t device_link_service_client_new(idevice_t device, lockdownd_service_descriptor_t service, device_link_service_client_t *client)\n{\n\tif (!device || !service || service->port == 0 || !client || *client) {\n\t\treturn DEVICE_LINK_SERVICE_E_INVALID_ARG;\n\t}\n\n\tproperty_list_service_client_t plistclient = NULL;\n\tif (property_list_service_client_new(device, service, &plistclient) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\treturn DEVICE_LINK_SERVICE_E_MUX_ERROR;\n\t}\n\n\t/* create client object */\n\tdevice_link_service_client_t client_loc = (device_link_service_client_t) malloc(sizeof(struct device_link_service_client_private));\n\tclient_loc->parent = plistclient;\n\n\t/* enable SSL if requested */\n\tif (service->ssl_enabled)\n\t\tproperty_list_service_enable_ssl(client_loc->parent);\n\n\t/* all done, return success */\n\t*client = client_loc;\n\treturn DEVICE_LINK_SERVICE_E_SUCCESS;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include \"device_link_service.h\"",
            "#include <stdlib.h>",
            "#include <string.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"device_link_service.h\"\n#include <stdlib.h>\n#include <string.h>\n\ndevice_link_service_error_t device_link_service_client_new(idevice_t device, lockdownd_service_descriptor_t service, device_link_service_client_t *client)\n{\n\tif (!device || !service || service->port == 0 || !client || *client) {\n\t\treturn DEVICE_LINK_SERVICE_E_INVALID_ARG;\n\t}\n\n\tproperty_list_service_client_t plistclient = NULL;\n\tif (property_list_service_client_new(device, service, &plistclient) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\treturn DEVICE_LINK_SERVICE_E_MUX_ERROR;\n\t}\n\n\t/* create client object */\n\tdevice_link_service_client_t client_loc = (device_link_service_client_t) malloc(sizeof(struct device_link_service_client_private));\n\tclient_loc->parent = plistclient;\n\n\t/* enable SSL if requested */\n\tif (service->ssl_enabled)\n\t\tproperty_list_service_enable_ssl(client_loc->parent);\n\n\t/* all done, return success */\n\t*client = client_loc;\n\treturn DEVICE_LINK_SERVICE_E_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"Creating debugserver_client, port = %d.\"",
            "service->port"
          ],
          "line": 72
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"Incorrect parameter passed to debugserver_client_new.\""
          ],
          "line": 68
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"debugserver.h\"\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API debugserver_error_t debugserver_client_new(idevice_t device, lockdownd_service_descriptor_t service, debugserver_client_t* client)\n{\n\t*client = NULL;\n\n\tif (!device || !service || service->port == 0 || !client || *client) {\n\t\tdebug_info(\"Incorrect parameter passed to debugserver_client_new.\");\n\t\treturn DEBUGSERVER_E_INVALID_ARG;\n\t}\n\n\tdebug_info(\"Creating debugserver_client, port = %d.\", service->port);\n\n\tservice_client_t parent = NULL;\n\tdebugserver_error_t ret = debugserver_error(service_client_new(device, service, &parent));\n\tif (ret != DEBUGSERVER_E_SUCCESS) {\n\t\tdebug_info(\"Creating base service client failed. Error: %i\", ret);\n\t\treturn ret;\n\t}\n\n\tdebugserver_client_t client_loc = (debugserver_client_t) malloc(sizeof(struct debugserver_client_private));\n\tclient_loc->parent = parent;\n\tclient_loc->noack_mode = 0;\n\n\t*client = client_loc;\n\n\tdebug_info(\"debugserver_client successfully created.\");\n\treturn DEBUGSERVER_E_SUCCESS;\n}"
  },
  {
    "function_name": "debugserver_error",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/debugserver.c",
    "lines": "46-61",
    "snippet": "static debugserver_error_t debugserver_error(service_error_t err)\n{\n\tswitch (err) {\n\t\tcase SERVICE_E_SUCCESS:\n\t\t\treturn DEBUGSERVER_E_SUCCESS;\n\t\tcase SERVICE_E_INVALID_ARG:\n\t\t\treturn DEBUGSERVER_E_INVALID_ARG;\n\t\tcase SERVICE_E_MUX_ERROR:\n\t\t\treturn DEBUGSERVER_E_MUX_ERROR;\n\t\tcase SERVICE_E_SSL_ERROR:\n\t\t\treturn DEBUGSERVER_E_SSL_ERROR;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn DEBUGSERVER_E_UNKNOWN_ERROR;\n}",
    "includes": [
      "#include \"asprintf.h\"",
      "#include \"common/utils.h\"",
      "#include \"common/debug.h\"",
      "#include \"lockdown.h\"",
      "#include \"debugserver.h\"",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"debugserver.h\"\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic debugserver_error_t debugserver_error(service_error_t err)\n{\n\tswitch (err) {\n\t\tcase SERVICE_E_SUCCESS:\n\t\t\treturn DEBUGSERVER_E_SUCCESS;\n\t\tcase SERVICE_E_INVALID_ARG:\n\t\t\treturn DEBUGSERVER_E_INVALID_ARG;\n\t\tcase SERVICE_E_MUX_ERROR:\n\t\t\treturn DEBUGSERVER_E_MUX_ERROR;\n\t\tcase SERVICE_E_SSL_ERROR:\n\t\t\treturn DEBUGSERVER_E_SSL_ERROR;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn DEBUGSERVER_E_UNKNOWN_ERROR;\n}"
  }
]