[
  {
    "function_name": "restored_reboot",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/restore.c",
    "lines": "393-423",
    "snippet": "LIBIMOBILEDEVICE_API restored_error_t restored_reboot(restored_client_t client)\n{\n\tif (!client)\n\t\treturn RESTORE_E_INVALID_ARG;\n\n\tplist_t dict = NULL;\n\trestored_error_t ret = RESTORE_E_UNKNOWN_ERROR;\n\n\tdict = plist_new_dict();\n\tplist_dict_add_label(dict, client->label);\n\tplist_dict_set_item(dict,\"Request\", plist_new_string(\"Reboot\"));\n\n\t/* send to device */\n\tret = restored_send(client, dict);\n\tplist_free(dict);\n\tdict = NULL;\n\n\tif (RESTORE_E_SUCCESS != ret)\n\t\treturn ret;\n\n\tret = restored_receive(client, &dict);\n\tif (RESTORE_E_SUCCESS != ret)\n\t\treturn ret;\n\n\tif (!dict)\n\t\treturn RESTORE_E_PLIST_ERROR;\n\n\tplist_free(dict);\n\tdict = NULL;\n\treturn ret;\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"idevice.h\"",
      "#include \"restore.h\"",
      "#include \"property_list_service.h\"",
      "#include <plist/plist.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <errno.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "dict"
          ],
          "line": 420
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "restored_receive",
          "args": [
            "client",
            "&dict"
          ],
          "line": 413
        },
        "resolved": true,
        "details": {
          "function_name": "restored_receive",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/restore.c",
          "lines": "132-149",
          "snippet": "LIBIMOBILEDEVICE_API restored_error_t restored_receive(restored_client_t client, plist_t *plist)\n{\n\tif (!client || !plist || (plist && *plist))\n\t\treturn RESTORE_E_INVALID_ARG;\n\n\trestored_error_t ret = RESTORE_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_receive_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = RESTORE_E_UNKNOWN_ERROR;\n\t}\n\n\tif (!*plist)\n\t\tret = RESTORE_E_PLIST_ERROR;\n\n\treturn ret;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"restore.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <errno.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"restore.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <stdlib.h>\n#include <string.h>\n#include <errno.h>\n\nLIBIMOBILEDEVICE_API restored_error_t restored_receive(restored_client_t client, plist_t *plist)\n{\n\tif (!client || !plist || (plist && *plist))\n\t\treturn RESTORE_E_INVALID_ARG;\n\n\trestored_error_t ret = RESTORE_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_receive_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = RESTORE_E_UNKNOWN_ERROR;\n\t}\n\n\tif (!*plist)\n\t\tret = RESTORE_E_PLIST_ERROR;\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "dict"
          ],
          "line": 407
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "restored_send",
          "args": [
            "client",
            "dict"
          ],
          "line": 406
        },
        "resolved": true,
        "details": {
          "function_name": "restored_send",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/restore.c",
          "lines": "151-164",
          "snippet": "LIBIMOBILEDEVICE_API restored_error_t restored_send(restored_client_t client, plist_t plist)\n{\n\tif (!client || !plist)\n\t\treturn RESTORE_E_INVALID_ARG;\n\n\trestored_error_t ret = RESTORE_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_send_xml_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = RESTORE_E_UNKNOWN_ERROR;\n\t}\n\treturn ret;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"restore.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <errno.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"restore.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <stdlib.h>\n#include <string.h>\n#include <errno.h>\n\nLIBIMOBILEDEVICE_API restored_error_t restored_send(restored_client_t client, plist_t plist)\n{\n\tif (!client || !plist)\n\t\treturn RESTORE_E_INVALID_ARG;\n\n\trestored_error_t ret = RESTORE_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_send_xml_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = RESTORE_E_UNKNOWN_ERROR;\n\t}\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"Request\"",
            "plist_new_string(\"Reboot\")"
          ],
          "line": 403
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "\"Reboot\""
          ],
          "line": 403
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_add_label",
          "args": [
            "dict",
            "client->label"
          ],
          "line": 402
        },
        "resolved": true,
        "details": {
          "function_name": "plist_dict_add_label",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/restore.c",
          "lines": "84-90",
          "snippet": "static void plist_dict_add_label(plist_t plist, const char *label)\n{\n\tif (plist && label) {\n\t\tif (plist_get_node_type(plist) == PLIST_DICT)\n\t\t\tplist_dict_set_item(plist, \"Label\", plist_new_string(label));\n\t}\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"restore.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <errno.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"restore.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <stdlib.h>\n#include <string.h>\n#include <errno.h>\n\nstatic void plist_dict_add_label(plist_t plist, const char *label)\n{\n\tif (plist && label) {\n\t\tif (plist_get_node_type(plist) == PLIST_DICT)\n\t\t\tplist_dict_set_item(plist, \"Label\", plist_new_string(label));\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_new_dict",
          "args": [],
          "line": 401
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"restore.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <stdlib.h>\n#include <string.h>\n#include <errno.h>\n\nLIBIMOBILEDEVICE_API restored_error_t restored_reboot(restored_client_t client)\n{\n\tif (!client)\n\t\treturn RESTORE_E_INVALID_ARG;\n\n\tplist_t dict = NULL;\n\trestored_error_t ret = RESTORE_E_UNKNOWN_ERROR;\n\n\tdict = plist_new_dict();\n\tplist_dict_add_label(dict, client->label);\n\tplist_dict_set_item(dict,\"Request\", plist_new_string(\"Reboot\"));\n\n\t/* send to device */\n\tret = restored_send(client, dict);\n\tplist_free(dict);\n\tdict = NULL;\n\n\tif (RESTORE_E_SUCCESS != ret)\n\t\treturn ret;\n\n\tret = restored_receive(client, &dict);\n\tif (RESTORE_E_SUCCESS != ret)\n\t\treturn ret;\n\n\tif (!dict)\n\t\treturn RESTORE_E_PLIST_ERROR;\n\n\tplist_free(dict);\n\tdict = NULL;\n\treturn ret;\n}"
  },
  {
    "function_name": "restored_start_restore",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/restore.c",
    "lines": "369-391",
    "snippet": "LIBIMOBILEDEVICE_API restored_error_t restored_start_restore(restored_client_t client, plist_t options, uint64_t version)\n{\n\tif (!client)\n\t\treturn RESTORE_E_INVALID_ARG;\n\n\tplist_t dict = NULL;\n\trestored_error_t ret = RESTORE_E_UNKNOWN_ERROR;\n\n\tdict = plist_new_dict();\n\tplist_dict_add_label(dict, client->label);\n\tplist_dict_set_item(dict,\"Request\", plist_new_string(\"StartRestore\"));\n\tif (options) {\n\t\tplist_dict_set_item(dict, \"RestoreOptions\", plist_copy(options));\n\t}\n\tplist_dict_set_item(dict,\"RestoreProtocolVersion\", plist_new_uint(version));\n\n\t/* send to device */\n\tret = restored_send(client, dict);\n\tplist_free(dict);\n\tdict = NULL;\n\n\treturn ret;\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"idevice.h\"",
      "#include \"restore.h\"",
      "#include \"property_list_service.h\"",
      "#include <plist/plist.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <errno.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "dict"
          ],
          "line": 387
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "restored_send",
          "args": [
            "client",
            "dict"
          ],
          "line": 386
        },
        "resolved": true,
        "details": {
          "function_name": "restored_send",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/restore.c",
          "lines": "151-164",
          "snippet": "LIBIMOBILEDEVICE_API restored_error_t restored_send(restored_client_t client, plist_t plist)\n{\n\tif (!client || !plist)\n\t\treturn RESTORE_E_INVALID_ARG;\n\n\trestored_error_t ret = RESTORE_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_send_xml_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = RESTORE_E_UNKNOWN_ERROR;\n\t}\n\treturn ret;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"restore.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <errno.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"restore.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <stdlib.h>\n#include <string.h>\n#include <errno.h>\n\nLIBIMOBILEDEVICE_API restored_error_t restored_send(restored_client_t client, plist_t plist)\n{\n\tif (!client || !plist)\n\t\treturn RESTORE_E_INVALID_ARG;\n\n\trestored_error_t ret = RESTORE_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_send_xml_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = RESTORE_E_UNKNOWN_ERROR;\n\t}\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"RestoreProtocolVersion\"",
            "plist_new_uint(version)"
          ],
          "line": 383
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_uint",
          "args": [
            "version"
          ],
          "line": 383
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"RestoreOptions\"",
            "plist_copy(options)"
          ],
          "line": 381
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_copy",
          "args": [
            "options"
          ],
          "line": 381
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"Request\"",
            "plist_new_string(\"StartRestore\")"
          ],
          "line": 379
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "\"StartRestore\""
          ],
          "line": 379
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_add_label",
          "args": [
            "dict",
            "client->label"
          ],
          "line": 378
        },
        "resolved": true,
        "details": {
          "function_name": "plist_dict_add_label",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/restore.c",
          "lines": "84-90",
          "snippet": "static void plist_dict_add_label(plist_t plist, const char *label)\n{\n\tif (plist && label) {\n\t\tif (plist_get_node_type(plist) == PLIST_DICT)\n\t\t\tplist_dict_set_item(plist, \"Label\", plist_new_string(label));\n\t}\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"restore.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <errno.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"restore.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <stdlib.h>\n#include <string.h>\n#include <errno.h>\n\nstatic void plist_dict_add_label(plist_t plist, const char *label)\n{\n\tif (plist && label) {\n\t\tif (plist_get_node_type(plist) == PLIST_DICT)\n\t\t\tplist_dict_set_item(plist, \"Label\", plist_new_string(label));\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_new_dict",
          "args": [],
          "line": 377
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"restore.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <stdlib.h>\n#include <string.h>\n#include <errno.h>\n\nLIBIMOBILEDEVICE_API restored_error_t restored_start_restore(restored_client_t client, plist_t options, uint64_t version)\n{\n\tif (!client)\n\t\treturn RESTORE_E_INVALID_ARG;\n\n\tplist_t dict = NULL;\n\trestored_error_t ret = RESTORE_E_UNKNOWN_ERROR;\n\n\tdict = plist_new_dict();\n\tplist_dict_add_label(dict, client->label);\n\tplist_dict_set_item(dict,\"Request\", plist_new_string(\"StartRestore\"));\n\tif (options) {\n\t\tplist_dict_set_item(dict, \"RestoreOptions\", plist_copy(options));\n\t}\n\tplist_dict_set_item(dict,\"RestoreProtocolVersion\", plist_new_uint(version));\n\n\t/* send to device */\n\tret = restored_send(client, dict);\n\tplist_free(dict);\n\tdict = NULL;\n\n\treturn ret;\n}"
  },
  {
    "function_name": "restored_goodbye",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/restore.c",
    "lines": "337-367",
    "snippet": "LIBIMOBILEDEVICE_API restored_error_t restored_goodbye(restored_client_t client)\n{\n\tif (!client)\n\t\treturn RESTORE_E_INVALID_ARG;\n\n\trestored_error_t ret = RESTORE_E_UNKNOWN_ERROR;\n\n\tplist_t dict = plist_new_dict();\n\tplist_dict_add_label(dict, client->label);\n\tplist_dict_set_item(dict,\"Request\", plist_new_string(\"Goodbye\"));\n\n\tdebug_info(\"called\");\n\n\tret = restored_send(client, dict);\n\tplist_free(dict);\n\tdict = NULL;\n\n\tret = restored_receive(client, &dict);\n\tif (!dict) {\n\t\tdebug_info(\"did not get goodbye response back\");\n\t\treturn RESTORE_E_PLIST_ERROR;\n\t}\n\n\tif (restored_check_result(dict) == RESULT_SUCCESS) {\n\t\tdebug_info(\"success\");\n\t\tret = RESTORE_E_SUCCESS;\n\t}\n\tplist_free(dict);\n\tdict = NULL;\n\treturn ret;\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"idevice.h\"",
      "#include \"restore.h\"",
      "#include \"property_list_service.h\"",
      "#include <plist/plist.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <errno.h>"
    ],
    "macros_used": [
      "#define RESULT_SUCCESS 0"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "dict"
          ],
          "line": 364
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"success\""
          ],
          "line": 361
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "restored_check_result",
          "args": [
            "dict"
          ],
          "line": 360
        },
        "resolved": true,
        "details": {
          "function_name": "restored_check_result",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/restore.c",
          "lines": "46-75",
          "snippet": "static int restored_check_result(plist_t dict)\n{\n\tint ret = -1;\n\tplist_t result_node = plist_dict_get_item(dict, \"Result\");\n\tif (!result_node) {\n\t\treturn ret;\n\t}\n\n\tplist_type result_type = plist_get_node_type(result_node);\n\n\tif (result_type == PLIST_STRING) {\n\n\t\tchar *result_value = NULL;\n\n\t\tplist_get_string_val(result_node, &result_value);\n\n\t\tif (result_value) {\n\t\t\tif (!strcmp(result_value, \"Success\")) {\n\t\t\t\tret = RESULT_SUCCESS;\n\t\t\t} else if (!strcmp(result_value, \"Failure\")) {\n\t\t\t\tret = RESULT_FAILURE;\n\t\t\t} else {\n\t\t\t\tdebug_info(\"ERROR: unknown result value '%s'\", result_value);\n\t\t\t}\n\t\t}\n\t\tif (result_value)\n\t\t\tfree(result_value);\n\t}\n\treturn ret;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"restore.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <errno.h>"
          ],
          "macros_used": [
            "#define RESULT_FAILURE 1",
            "#define RESULT_SUCCESS 0"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"restore.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <stdlib.h>\n#include <string.h>\n#include <errno.h>\n\n#define RESULT_FAILURE 1\n#define RESULT_SUCCESS 0\n\nstatic int restored_check_result(plist_t dict)\n{\n\tint ret = -1;\n\tplist_t result_node = plist_dict_get_item(dict, \"Result\");\n\tif (!result_node) {\n\t\treturn ret;\n\t}\n\n\tplist_type result_type = plist_get_node_type(result_node);\n\n\tif (result_type == PLIST_STRING) {\n\n\t\tchar *result_value = NULL;\n\n\t\tplist_get_string_val(result_node, &result_value);\n\n\t\tif (result_value) {\n\t\t\tif (!strcmp(result_value, \"Success\")) {\n\t\t\t\tret = RESULT_SUCCESS;\n\t\t\t} else if (!strcmp(result_value, \"Failure\")) {\n\t\t\t\tret = RESULT_FAILURE;\n\t\t\t} else {\n\t\t\t\tdebug_info(\"ERROR: unknown result value '%s'\", result_value);\n\t\t\t}\n\t\t}\n\t\tif (result_value)\n\t\t\tfree(result_value);\n\t}\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"did not get goodbye response back\""
          ],
          "line": 356
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "restored_receive",
          "args": [
            "client",
            "&dict"
          ],
          "line": 354
        },
        "resolved": true,
        "details": {
          "function_name": "restored_receive",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/restore.c",
          "lines": "132-149",
          "snippet": "LIBIMOBILEDEVICE_API restored_error_t restored_receive(restored_client_t client, plist_t *plist)\n{\n\tif (!client || !plist || (plist && *plist))\n\t\treturn RESTORE_E_INVALID_ARG;\n\n\trestored_error_t ret = RESTORE_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_receive_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = RESTORE_E_UNKNOWN_ERROR;\n\t}\n\n\tif (!*plist)\n\t\tret = RESTORE_E_PLIST_ERROR;\n\n\treturn ret;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"restore.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <errno.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"restore.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <stdlib.h>\n#include <string.h>\n#include <errno.h>\n\nLIBIMOBILEDEVICE_API restored_error_t restored_receive(restored_client_t client, plist_t *plist)\n{\n\tif (!client || !plist || (plist && *plist))\n\t\treturn RESTORE_E_INVALID_ARG;\n\n\trestored_error_t ret = RESTORE_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_receive_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = RESTORE_E_UNKNOWN_ERROR;\n\t}\n\n\tif (!*plist)\n\t\tret = RESTORE_E_PLIST_ERROR;\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "dict"
          ],
          "line": 351
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "restored_send",
          "args": [
            "client",
            "dict"
          ],
          "line": 350
        },
        "resolved": true,
        "details": {
          "function_name": "restored_send",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/restore.c",
          "lines": "151-164",
          "snippet": "LIBIMOBILEDEVICE_API restored_error_t restored_send(restored_client_t client, plist_t plist)\n{\n\tif (!client || !plist)\n\t\treturn RESTORE_E_INVALID_ARG;\n\n\trestored_error_t ret = RESTORE_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_send_xml_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = RESTORE_E_UNKNOWN_ERROR;\n\t}\n\treturn ret;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"restore.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <errno.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"restore.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <stdlib.h>\n#include <string.h>\n#include <errno.h>\n\nLIBIMOBILEDEVICE_API restored_error_t restored_send(restored_client_t client, plist_t plist)\n{\n\tif (!client || !plist)\n\t\treturn RESTORE_E_INVALID_ARG;\n\n\trestored_error_t ret = RESTORE_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_send_xml_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = RESTORE_E_UNKNOWN_ERROR;\n\t}\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"called\""
          ],
          "line": 348
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"Request\"",
            "plist_new_string(\"Goodbye\")"
          ],
          "line": 346
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "\"Goodbye\""
          ],
          "line": 346
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_add_label",
          "args": [
            "dict",
            "client->label"
          ],
          "line": 345
        },
        "resolved": true,
        "details": {
          "function_name": "plist_dict_add_label",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/restore.c",
          "lines": "84-90",
          "snippet": "static void plist_dict_add_label(plist_t plist, const char *label)\n{\n\tif (plist && label) {\n\t\tif (plist_get_node_type(plist) == PLIST_DICT)\n\t\t\tplist_dict_set_item(plist, \"Label\", plist_new_string(label));\n\t}\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"restore.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <errno.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"restore.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <stdlib.h>\n#include <string.h>\n#include <errno.h>\n\nstatic void plist_dict_add_label(plist_t plist, const char *label)\n{\n\tif (plist && label) {\n\t\tif (plist_get_node_type(plist) == PLIST_DICT)\n\t\t\tplist_dict_set_item(plist, \"Label\", plist_new_string(label));\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_new_dict",
          "args": [],
          "line": 344
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"restore.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <stdlib.h>\n#include <string.h>\n#include <errno.h>\n\n#define RESULT_SUCCESS 0\n\nLIBIMOBILEDEVICE_API restored_error_t restored_goodbye(restored_client_t client)\n{\n\tif (!client)\n\t\treturn RESTORE_E_INVALID_ARG;\n\n\trestored_error_t ret = RESTORE_E_UNKNOWN_ERROR;\n\n\tplist_t dict = plist_new_dict();\n\tplist_dict_add_label(dict, client->label);\n\tplist_dict_set_item(dict,\"Request\", plist_new_string(\"Goodbye\"));\n\n\tdebug_info(\"called\");\n\n\tret = restored_send(client, dict);\n\tplist_free(dict);\n\tdict = NULL;\n\n\tret = restored_receive(client, &dict);\n\tif (!dict) {\n\t\tdebug_info(\"did not get goodbye response back\");\n\t\treturn RESTORE_E_PLIST_ERROR;\n\t}\n\n\tif (restored_check_result(dict) == RESULT_SUCCESS) {\n\t\tdebug_info(\"success\");\n\t\tret = RESTORE_E_SUCCESS;\n\t}\n\tplist_free(dict);\n\tdict = NULL;\n\treturn ret;\n}"
  },
  {
    "function_name": "restored_client_new",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/restore.c",
    "lines": "294-335",
    "snippet": "LIBIMOBILEDEVICE_API restored_error_t restored_client_new(idevice_t device, restored_client_t *client, const char *label)\n{\n\tif (!client)\n\t\treturn RESTORE_E_INVALID_ARG;\n\n\trestored_error_t ret = RESTORE_E_SUCCESS;\n\tidevice_error_t idev_ret;\n\n\tstatic struct lockdownd_service_descriptor service = {\n\t\t.port = 0xf27e,\n\t\t.ssl_enabled = 0\n\t};\n\n\tproperty_list_service_client_t plistclient = NULL;\n\tif (property_list_service_client_new(device, (lockdownd_service_descriptor_t)&service, &plistclient) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tdebug_info(\"could not connect to restored (device %s)\", device->udid);\n\t\treturn RESTORE_E_MUX_ERROR;\n\t}\n\n\trestored_client_t client_loc = (restored_client_t) malloc(sizeof(struct restored_client_private));\n\tclient_loc->parent = plistclient;\n\tclient_loc->udid = NULL;\n\tclient_loc->label = NULL;\n\tclient_loc->info = NULL;\n\tif (label != NULL)\n\t\tclient_loc->label = strdup(label);\n\n\tidev_ret = idevice_get_udid(device, &client_loc->udid);\n\tif (IDEVICE_E_SUCCESS != idev_ret) {\n\t\tdebug_info(\"failed to get device udid.\");\n\t\tret = RESTORE_E_DEVICE_ERROR;\n\t}\n\tdebug_info(\"device udid: %s\", client_loc->udid);\n\n\tif (RESTORE_E_SUCCESS == ret) {\n\t\t*client = client_loc;\n\t} else {\n\t\trestored_client_free(client_loc);\n\t}\n\n\treturn ret;\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"idevice.h\"",
      "#include \"restore.h\"",
      "#include \"property_list_service.h\"",
      "#include <plist/plist.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <errno.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "restored_client_free",
          "args": [
            "client_loc"
          ],
          "line": 331
        },
        "resolved": true,
        "details": {
          "function_name": "restored_client_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/restore.c",
          "lines": "92-120",
          "snippet": "LIBIMOBILEDEVICE_API restored_error_t restored_client_free(restored_client_t client)\n{\n\tif (!client)\n\t\treturn RESTORE_E_INVALID_ARG;\n\n\trestored_error_t ret = RESTORE_E_UNKNOWN_ERROR;\n\n\tif (client->parent) {\n\t\trestored_goodbye(client);\n\n\t\tif (property_list_service_client_free(client->parent) == PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\t\tret = RESTORE_E_SUCCESS;\n\t\t}\n\t}\n\n\tif (client->udid) {\n\t\tfree(client->udid);\n\t}\n\tif (client->label) {\n\t\tfree(client->label);\n\t}\n\n\tif (client->info) {\n\t\tplist_free(client->info);\n\t}\n\n\tfree(client);\n\treturn ret;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"restore.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <errno.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"restore.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <stdlib.h>\n#include <string.h>\n#include <errno.h>\n\nLIBIMOBILEDEVICE_API restored_error_t restored_client_free(restored_client_t client)\n{\n\tif (!client)\n\t\treturn RESTORE_E_INVALID_ARG;\n\n\trestored_error_t ret = RESTORE_E_UNKNOWN_ERROR;\n\n\tif (client->parent) {\n\t\trestored_goodbye(client);\n\n\t\tif (property_list_service_client_free(client->parent) == PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\t\tret = RESTORE_E_SUCCESS;\n\t\t}\n\t}\n\n\tif (client->udid) {\n\t\tfree(client->udid);\n\t}\n\tif (client->label) {\n\t\tfree(client->label);\n\t}\n\n\tif (client->info) {\n\t\tplist_free(client->info);\n\t}\n\n\tfree(client);\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"device udid: %s\"",
            "client_loc->udid"
          ],
          "line": 326
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"failed to get device udid.\""
          ],
          "line": 323
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "idevice_get_udid",
          "args": [
            "device",
            "&client_loc->udid"
          ],
          "line": 321
        },
        "resolved": true,
        "details": {
          "function_name": "idevice_get_udid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/idevice.c",
          "lines": "480-487",
          "snippet": "LIBIMOBILEDEVICE_API idevice_error_t idevice_get_udid(idevice_t device, char **udid)\n{\n\tif (!device || !udid)\n\t\treturn IDEVICE_E_INVALID_ARG;\n\n\t*udid = strdup(device->udid);\n\treturn IDEVICE_E_SUCCESS;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"common/thread.h\"",
            "#include \"common/userpref.h\"",
            "#include \"idevice.h\"",
            "#include <gnutls/gnutls.h>",
            "#include <openssl/ssl.h>",
            "#include <openssl/err.h>",
            "#include <usbmuxd.h>",
            "#include <windows.h>",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "LIBIMOBILEDEVICE_API idevice_error_t"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"common/thread.h\"\n#include \"common/userpref.h\"\n#include \"idevice.h\"\n#include <gnutls/gnutls.h>\n#include <openssl/ssl.h>\n#include <openssl/err.h>\n#include <usbmuxd.h>\n#include <windows.h>\n#include <errno.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API idevice_error_t;\n\nLIBIMOBILEDEVICE_API idevice_error_t idevice_get_udid(idevice_t device, char **udid)\n{\n\tif (!device || !udid)\n\t\treturn IDEVICE_E_INVALID_ARG;\n\n\t*udid = strdup(device->udid);\n\treturn IDEVICE_E_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "label"
          ],
          "line": 319
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "malloc",
          "args": [
            "sizeof(struct restored_client_private)"
          ],
          "line": 313
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"could not connect to restored (device %s)\"",
            "device->udid"
          ],
          "line": 309
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "property_list_service_client_new",
          "args": [
            "device",
            "(lockdownd_service_descriptor_t)&service",
            "&plistclient"
          ],
          "line": 308
        },
        "resolved": true,
        "details": {
          "function_name": "property_list_service_client_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
          "lines": "57-75",
          "snippet": "LIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_client_new(idevice_t device, lockdownd_service_descriptor_t service, property_list_service_client_t *client)\n{\n\tif (!device || !service || service->port == 0 || !client || *client)\n\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\n\tservice_client_t parent = NULL;\n\tservice_error_t rerr = service_client_new(device, service, &parent);\n\tif (rerr != SERVICE_E_SUCCESS) {\n\t\treturn service_to_property_list_service_error(rerr);\n\t}\n\n\t/* create client object */\n\tproperty_list_service_client_t client_loc = (property_list_service_client_t)malloc(sizeof(struct property_list_service_client_private));\n\tclient_loc->parent = parent;\n\n\t/* all done, return success */\n\t*client = client_loc;\n\treturn PROPERTY_LIST_SERVICE_E_SUCCESS;\n}",
          "includes": [
            "#include \"endianness.h\"",
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_client_new(idevice_t device, lockdownd_service_descriptor_t service, property_list_service_client_t *client)\n{\n\tif (!device || !service || service->port == 0 || !client || *client)\n\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\n\tservice_client_t parent = NULL;\n\tservice_error_t rerr = service_client_new(device, service, &parent);\n\tif (rerr != SERVICE_E_SUCCESS) {\n\t\treturn service_to_property_list_service_error(rerr);\n\t}\n\n\t/* create client object */\n\tproperty_list_service_client_t client_loc = (property_list_service_client_t)malloc(sizeof(struct property_list_service_client_private));\n\tclient_loc->parent = parent;\n\n\t/* all done, return success */\n\t*client = client_loc;\n\treturn PROPERTY_LIST_SERVICE_E_SUCCESS;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"restore.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <stdlib.h>\n#include <string.h>\n#include <errno.h>\n\nLIBIMOBILEDEVICE_API restored_error_t restored_client_new(idevice_t device, restored_client_t *client, const char *label)\n{\n\tif (!client)\n\t\treturn RESTORE_E_INVALID_ARG;\n\n\trestored_error_t ret = RESTORE_E_SUCCESS;\n\tidevice_error_t idev_ret;\n\n\tstatic struct lockdownd_service_descriptor service = {\n\t\t.port = 0xf27e,\n\t\t.ssl_enabled = 0\n\t};\n\n\tproperty_list_service_client_t plistclient = NULL;\n\tif (property_list_service_client_new(device, (lockdownd_service_descriptor_t)&service, &plistclient) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tdebug_info(\"could not connect to restored (device %s)\", device->udid);\n\t\treturn RESTORE_E_MUX_ERROR;\n\t}\n\n\trestored_client_t client_loc = (restored_client_t) malloc(sizeof(struct restored_client_private));\n\tclient_loc->parent = plistclient;\n\tclient_loc->udid = NULL;\n\tclient_loc->label = NULL;\n\tclient_loc->info = NULL;\n\tif (label != NULL)\n\t\tclient_loc->label = strdup(label);\n\n\tidev_ret = idevice_get_udid(device, &client_loc->udid);\n\tif (IDEVICE_E_SUCCESS != idev_ret) {\n\t\tdebug_info(\"failed to get device udid.\");\n\t\tret = RESTORE_E_DEVICE_ERROR;\n\t}\n\tdebug_info(\"device udid: %s\", client_loc->udid);\n\n\tif (RESTORE_E_SUCCESS == ret) {\n\t\t*client = client_loc;\n\t} else {\n\t\trestored_client_free(client_loc);\n\t}\n\n\treturn ret;\n}"
  },
  {
    "function_name": "restored_get_value",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/restore.c",
    "lines": "267-292",
    "snippet": "LIBIMOBILEDEVICE_API restored_error_t restored_get_value(restored_client_t client, const char *key, plist_t *value)\n{\n\tif (!client || !value || (value && *value))\n\t\treturn RESTORE_E_INVALID_ARG;\n\n\tif (!client->info)\n\t\treturn RESTORE_E_NOT_ENOUGH_DATA;\n\n\trestored_error_t ret = RESTORE_E_SUCCESS;\n\tplist_t item = NULL;\n\n\tif (!key) {\n\t\t*value = plist_copy(client->info);\n\t\treturn RESTORE_E_SUCCESS;\n\t} else {\n\t\titem = plist_dict_get_item(client->info, key);\n\t}\n\n\tif (item) {\n\t\t*value = plist_copy(item);\n\t} else {\n\t\tret = RESTORE_E_PLIST_ERROR;\n\t}\n\n\treturn ret;\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"idevice.h\"",
      "#include \"restore.h\"",
      "#include \"property_list_service.h\"",
      "#include <plist/plist.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <errno.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "plist_copy",
          "args": [
            "item"
          ],
          "line": 286
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_get_item",
          "args": [
            "client->info",
            "key"
          ],
          "line": 282
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_copy",
          "args": [
            "client->info"
          ],
          "line": 279
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"restore.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <stdlib.h>\n#include <string.h>\n#include <errno.h>\n\nLIBIMOBILEDEVICE_API restored_error_t restored_get_value(restored_client_t client, const char *key, plist_t *value)\n{\n\tif (!client || !value || (value && *value))\n\t\treturn RESTORE_E_INVALID_ARG;\n\n\tif (!client->info)\n\t\treturn RESTORE_E_NOT_ENOUGH_DATA;\n\n\trestored_error_t ret = RESTORE_E_SUCCESS;\n\tplist_t item = NULL;\n\n\tif (!key) {\n\t\t*value = plist_copy(client->info);\n\t\treturn RESTORE_E_SUCCESS;\n\t} else {\n\t\titem = plist_dict_get_item(client->info, key);\n\t}\n\n\tif (item) {\n\t\t*value = plist_copy(item);\n\t} else {\n\t\tret = RESTORE_E_PLIST_ERROR;\n\t}\n\n\treturn ret;\n}"
  },
  {
    "function_name": "restored_query_value",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/restore.c",
    "lines": "225-265",
    "snippet": "LIBIMOBILEDEVICE_API restored_error_t restored_query_value(restored_client_t client, const char *key, plist_t *value)\n{\n\tif (!client || !key)\n\t\treturn RESTORE_E_INVALID_ARG;\n\n\tplist_t dict = NULL;\n\trestored_error_t ret = RESTORE_E_UNKNOWN_ERROR;\n\n\t/* setup request plist */\n\tdict = plist_new_dict();\n\tplist_dict_add_label(dict, client->label);\n\tif (key) {\n\t\tplist_dict_set_item(dict,\"QueryKey\", plist_new_string(key));\n\t}\n\tplist_dict_set_item(dict,\"Request\", plist_new_string(\"QueryValue\"));\n\n\t/* send to device */\n\tret = restored_send(client, dict);\n\n\tplist_free(dict);\n\tdict = NULL;\n\n\tif (ret != RESTORE_E_SUCCESS)\n\t\treturn ret;\n\n\t/* Now get device's answer */\n\tret = restored_receive(client, &dict);\n\tif (ret != RESTORE_E_SUCCESS)\n\t\treturn ret;\n\n\tplist_t value_node = plist_dict_get_item(dict, key);\n\tif (value_node) {\n\t\tdebug_info(\"has a value\");\n\t\t*value = plist_copy(value_node);\n\t} else {\n\t\tret = RESTORE_E_PLIST_ERROR;\n\t}\n\n\tplist_free(dict);\n\treturn ret;\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"idevice.h\"",
      "#include \"restore.h\"",
      "#include \"property_list_service.h\"",
      "#include <plist/plist.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <errno.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "dict"
          ],
          "line": 263
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_copy",
          "args": [
            "value_node"
          ],
          "line": 258
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"has a value\""
          ],
          "line": 257
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_get_item",
          "args": [
            "dict",
            "key"
          ],
          "line": 255
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "restored_receive",
          "args": [
            "client",
            "&dict"
          ],
          "line": 251
        },
        "resolved": true,
        "details": {
          "function_name": "restored_receive",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/restore.c",
          "lines": "132-149",
          "snippet": "LIBIMOBILEDEVICE_API restored_error_t restored_receive(restored_client_t client, plist_t *plist)\n{\n\tif (!client || !plist || (plist && *plist))\n\t\treturn RESTORE_E_INVALID_ARG;\n\n\trestored_error_t ret = RESTORE_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_receive_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = RESTORE_E_UNKNOWN_ERROR;\n\t}\n\n\tif (!*plist)\n\t\tret = RESTORE_E_PLIST_ERROR;\n\n\treturn ret;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"restore.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <errno.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"restore.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <stdlib.h>\n#include <string.h>\n#include <errno.h>\n\nLIBIMOBILEDEVICE_API restored_error_t restored_receive(restored_client_t client, plist_t *plist)\n{\n\tif (!client || !plist || (plist && *plist))\n\t\treturn RESTORE_E_INVALID_ARG;\n\n\trestored_error_t ret = RESTORE_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_receive_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = RESTORE_E_UNKNOWN_ERROR;\n\t}\n\n\tif (!*plist)\n\t\tret = RESTORE_E_PLIST_ERROR;\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "dict"
          ],
          "line": 244
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "restored_send",
          "args": [
            "client",
            "dict"
          ],
          "line": 242
        },
        "resolved": true,
        "details": {
          "function_name": "restored_send",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/restore.c",
          "lines": "151-164",
          "snippet": "LIBIMOBILEDEVICE_API restored_error_t restored_send(restored_client_t client, plist_t plist)\n{\n\tif (!client || !plist)\n\t\treturn RESTORE_E_INVALID_ARG;\n\n\trestored_error_t ret = RESTORE_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_send_xml_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = RESTORE_E_UNKNOWN_ERROR;\n\t}\n\treturn ret;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"restore.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <errno.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"restore.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <stdlib.h>\n#include <string.h>\n#include <errno.h>\n\nLIBIMOBILEDEVICE_API restored_error_t restored_send(restored_client_t client, plist_t plist)\n{\n\tif (!client || !plist)\n\t\treturn RESTORE_E_INVALID_ARG;\n\n\trestored_error_t ret = RESTORE_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_send_xml_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = RESTORE_E_UNKNOWN_ERROR;\n\t}\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"Request\"",
            "plist_new_string(\"QueryValue\")"
          ],
          "line": 239
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "\"QueryValue\""
          ],
          "line": 239
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"QueryKey\"",
            "plist_new_string(key)"
          ],
          "line": 237
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "key"
          ],
          "line": 237
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_add_label",
          "args": [
            "dict",
            "client->label"
          ],
          "line": 235
        },
        "resolved": true,
        "details": {
          "function_name": "plist_dict_add_label",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/restore.c",
          "lines": "84-90",
          "snippet": "static void plist_dict_add_label(plist_t plist, const char *label)\n{\n\tif (plist && label) {\n\t\tif (plist_get_node_type(plist) == PLIST_DICT)\n\t\t\tplist_dict_set_item(plist, \"Label\", plist_new_string(label));\n\t}\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"restore.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <errno.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"restore.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <stdlib.h>\n#include <string.h>\n#include <errno.h>\n\nstatic void plist_dict_add_label(plist_t plist, const char *label)\n{\n\tif (plist && label) {\n\t\tif (plist_get_node_type(plist) == PLIST_DICT)\n\t\t\tplist_dict_set_item(plist, \"Label\", plist_new_string(label));\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_new_dict",
          "args": [],
          "line": 234
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"restore.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <stdlib.h>\n#include <string.h>\n#include <errno.h>\n\nLIBIMOBILEDEVICE_API restored_error_t restored_query_value(restored_client_t client, const char *key, plist_t *value)\n{\n\tif (!client || !key)\n\t\treturn RESTORE_E_INVALID_ARG;\n\n\tplist_t dict = NULL;\n\trestored_error_t ret = RESTORE_E_UNKNOWN_ERROR;\n\n\t/* setup request plist */\n\tdict = plist_new_dict();\n\tplist_dict_add_label(dict, client->label);\n\tif (key) {\n\t\tplist_dict_set_item(dict,\"QueryKey\", plist_new_string(key));\n\t}\n\tplist_dict_set_item(dict,\"Request\", plist_new_string(\"QueryValue\"));\n\n\t/* send to device */\n\tret = restored_send(client, dict);\n\n\tplist_free(dict);\n\tdict = NULL;\n\n\tif (ret != RESTORE_E_SUCCESS)\n\t\treturn ret;\n\n\t/* Now get device's answer */\n\tret = restored_receive(client, &dict);\n\tif (ret != RESTORE_E_SUCCESS)\n\t\treturn ret;\n\n\tplist_t value_node = plist_dict_get_item(dict, key);\n\tif (value_node) {\n\t\tdebug_info(\"has a value\");\n\t\t*value = plist_copy(value_node);\n\t} else {\n\t\tret = RESTORE_E_PLIST_ERROR;\n\t}\n\n\tplist_free(dict);\n\treturn ret;\n}"
  },
  {
    "function_name": "restored_query_type",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/restore.c",
    "lines": "166-223",
    "snippet": "LIBIMOBILEDEVICE_API restored_error_t restored_query_type(restored_client_t client, char **type, uint64_t *version)\n{\n\tif (!client)\n\t\treturn RESTORE_E_INVALID_ARG;\n\n\trestored_error_t ret = RESTORE_E_UNKNOWN_ERROR;\n\n\tplist_t dict = plist_new_dict();\n\tplist_dict_add_label(dict, client->label);\n\tplist_dict_set_item(dict,\"Request\", plist_new_string(\"QueryType\"));\n\n\tdebug_info(\"called\");\n\tret = restored_send(client, dict);\n\n\tplist_free(dict);\n\tdict = NULL;\n\n\tret = restored_receive(client, &dict);\n\n\tif (RESTORE_E_SUCCESS != ret)\n\t\treturn ret;\n\n\tret = RESTORE_E_UNKNOWN_ERROR;\n\tplist_t type_node = plist_dict_get_item(dict, \"Type\");\n\tif (type_node && (plist_get_node_type(type_node) == PLIST_STRING)) {\n\t\tchar* typestr = NULL;\n\n\t\t/* save our device information info */\n\t\tclient->info = dict;\n\n\t\tplist_get_string_val(type_node, &typestr);\n\t\tdebug_info(\"success with type %s\", typestr);\n\t\t/* return the type if requested */\n\t\tif (type) {\n\t\t\t*type = typestr;\n\t\t} else {\n\t\t\tfree(typestr);\n\t\t}\n\n\t\t/* fetch the restore protocol version */\n\t\tif (version) {\n\t\t\tplist_t version_node = plist_dict_get_item(dict, \"RestoreProtocolVersion\");\n\t\t\tif (version_node && PLIST_UINT == plist_get_node_type(version_node)) {\n\t\t\t\tplist_get_uint_val(version_node, version);\n\t\t\t\tdebug_info(\"restored protocol version %llu\", *version);\n\t\t\t} else {\n\t\t\t\treturn RESTORE_E_UNKNOWN_ERROR;\n\t\t\t}\n\t\t}\n\t\tret = RESTORE_E_SUCCESS;\n\t} else {\n\t\tdebug_info(\"hmm. QueryType response does not contain a type?!\");\n\t\tdebug_plist(dict);\n\t\tplist_free(dict);\n\t}\n\n\treturn ret;\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"idevice.h\"",
      "#include \"restore.h\"",
      "#include \"property_list_service.h\"",
      "#include <plist/plist.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <errno.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "dict"
          ],
          "line": 219
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_plist",
          "args": [
            "dict"
          ],
          "line": 218
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"hmm. QueryType response does not contain a type?!\""
          ],
          "line": 217
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"restored protocol version %llu\"",
            "*version"
          ],
          "line": 210
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_get_uint_val",
          "args": [
            "version_node",
            "version"
          ],
          "line": 209
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_get_node_type",
          "args": [
            "version_node"
          ],
          "line": 208
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_get_item",
          "args": [
            "dict",
            "\"RestoreProtocolVersion\""
          ],
          "line": 207
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "typestr"
          ],
          "line": 202
        },
        "resolved": true,
        "details": {
          "function_name": "restored_client_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/restore.c",
          "lines": "92-120",
          "snippet": "LIBIMOBILEDEVICE_API restored_error_t restored_client_free(restored_client_t client)\n{\n\tif (!client)\n\t\treturn RESTORE_E_INVALID_ARG;\n\n\trestored_error_t ret = RESTORE_E_UNKNOWN_ERROR;\n\n\tif (client->parent) {\n\t\trestored_goodbye(client);\n\n\t\tif (property_list_service_client_free(client->parent) == PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\t\tret = RESTORE_E_SUCCESS;\n\t\t}\n\t}\n\n\tif (client->udid) {\n\t\tfree(client->udid);\n\t}\n\tif (client->label) {\n\t\tfree(client->label);\n\t}\n\n\tif (client->info) {\n\t\tplist_free(client->info);\n\t}\n\n\tfree(client);\n\treturn ret;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"restore.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <errno.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"restore.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <stdlib.h>\n#include <string.h>\n#include <errno.h>\n\nLIBIMOBILEDEVICE_API restored_error_t restored_client_free(restored_client_t client)\n{\n\tif (!client)\n\t\treturn RESTORE_E_INVALID_ARG;\n\n\trestored_error_t ret = RESTORE_E_UNKNOWN_ERROR;\n\n\tif (client->parent) {\n\t\trestored_goodbye(client);\n\n\t\tif (property_list_service_client_free(client->parent) == PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\t\tret = RESTORE_E_SUCCESS;\n\t\t}\n\t}\n\n\tif (client->udid) {\n\t\tfree(client->udid);\n\t}\n\tif (client->label) {\n\t\tfree(client->label);\n\t}\n\n\tif (client->info) {\n\t\tplist_free(client->info);\n\t}\n\n\tfree(client);\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"success with type %s\"",
            "typestr"
          ],
          "line": 197
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_get_string_val",
          "args": [
            "type_node",
            "&typestr"
          ],
          "line": 196
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_get_node_type",
          "args": [
            "type_node"
          ],
          "line": 190
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_get_item",
          "args": [
            "dict",
            "\"Type\""
          ],
          "line": 189
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "restored_receive",
          "args": [
            "client",
            "&dict"
          ],
          "line": 183
        },
        "resolved": true,
        "details": {
          "function_name": "restored_receive",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/restore.c",
          "lines": "132-149",
          "snippet": "LIBIMOBILEDEVICE_API restored_error_t restored_receive(restored_client_t client, plist_t *plist)\n{\n\tif (!client || !plist || (plist && *plist))\n\t\treturn RESTORE_E_INVALID_ARG;\n\n\trestored_error_t ret = RESTORE_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_receive_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = RESTORE_E_UNKNOWN_ERROR;\n\t}\n\n\tif (!*plist)\n\t\tret = RESTORE_E_PLIST_ERROR;\n\n\treturn ret;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"restore.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <errno.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"restore.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <stdlib.h>\n#include <string.h>\n#include <errno.h>\n\nLIBIMOBILEDEVICE_API restored_error_t restored_receive(restored_client_t client, plist_t *plist)\n{\n\tif (!client || !plist || (plist && *plist))\n\t\treturn RESTORE_E_INVALID_ARG;\n\n\trestored_error_t ret = RESTORE_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_receive_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = RESTORE_E_UNKNOWN_ERROR;\n\t}\n\n\tif (!*plist)\n\t\tret = RESTORE_E_PLIST_ERROR;\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "dict"
          ],
          "line": 180
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "restored_send",
          "args": [
            "client",
            "dict"
          ],
          "line": 178
        },
        "resolved": true,
        "details": {
          "function_name": "restored_send",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/restore.c",
          "lines": "151-164",
          "snippet": "LIBIMOBILEDEVICE_API restored_error_t restored_send(restored_client_t client, plist_t plist)\n{\n\tif (!client || !plist)\n\t\treturn RESTORE_E_INVALID_ARG;\n\n\trestored_error_t ret = RESTORE_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_send_xml_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = RESTORE_E_UNKNOWN_ERROR;\n\t}\n\treturn ret;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"restore.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <errno.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"restore.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <stdlib.h>\n#include <string.h>\n#include <errno.h>\n\nLIBIMOBILEDEVICE_API restored_error_t restored_send(restored_client_t client, plist_t plist)\n{\n\tif (!client || !plist)\n\t\treturn RESTORE_E_INVALID_ARG;\n\n\trestored_error_t ret = RESTORE_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_send_xml_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = RESTORE_E_UNKNOWN_ERROR;\n\t}\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"called\""
          ],
          "line": 177
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"Request\"",
            "plist_new_string(\"QueryType\")"
          ],
          "line": 175
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "\"QueryType\""
          ],
          "line": 175
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_add_label",
          "args": [
            "dict",
            "client->label"
          ],
          "line": 174
        },
        "resolved": true,
        "details": {
          "function_name": "plist_dict_add_label",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/restore.c",
          "lines": "84-90",
          "snippet": "static void plist_dict_add_label(plist_t plist, const char *label)\n{\n\tif (plist && label) {\n\t\tif (plist_get_node_type(plist) == PLIST_DICT)\n\t\t\tplist_dict_set_item(plist, \"Label\", plist_new_string(label));\n\t}\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"restore.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <errno.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"restore.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <stdlib.h>\n#include <string.h>\n#include <errno.h>\n\nstatic void plist_dict_add_label(plist_t plist, const char *label)\n{\n\tif (plist && label) {\n\t\tif (plist_get_node_type(plist) == PLIST_DICT)\n\t\t\tplist_dict_set_item(plist, \"Label\", plist_new_string(label));\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_new_dict",
          "args": [],
          "line": 173
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"restore.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <stdlib.h>\n#include <string.h>\n#include <errno.h>\n\nLIBIMOBILEDEVICE_API restored_error_t restored_query_type(restored_client_t client, char **type, uint64_t *version)\n{\n\tif (!client)\n\t\treturn RESTORE_E_INVALID_ARG;\n\n\trestored_error_t ret = RESTORE_E_UNKNOWN_ERROR;\n\n\tplist_t dict = plist_new_dict();\n\tplist_dict_add_label(dict, client->label);\n\tplist_dict_set_item(dict,\"Request\", plist_new_string(\"QueryType\"));\n\n\tdebug_info(\"called\");\n\tret = restored_send(client, dict);\n\n\tplist_free(dict);\n\tdict = NULL;\n\n\tret = restored_receive(client, &dict);\n\n\tif (RESTORE_E_SUCCESS != ret)\n\t\treturn ret;\n\n\tret = RESTORE_E_UNKNOWN_ERROR;\n\tplist_t type_node = plist_dict_get_item(dict, \"Type\");\n\tif (type_node && (plist_get_node_type(type_node) == PLIST_STRING)) {\n\t\tchar* typestr = NULL;\n\n\t\t/* save our device information info */\n\t\tclient->info = dict;\n\n\t\tplist_get_string_val(type_node, &typestr);\n\t\tdebug_info(\"success with type %s\", typestr);\n\t\t/* return the type if requested */\n\t\tif (type) {\n\t\t\t*type = typestr;\n\t\t} else {\n\t\t\tfree(typestr);\n\t\t}\n\n\t\t/* fetch the restore protocol version */\n\t\tif (version) {\n\t\t\tplist_t version_node = plist_dict_get_item(dict, \"RestoreProtocolVersion\");\n\t\t\tif (version_node && PLIST_UINT == plist_get_node_type(version_node)) {\n\t\t\t\tplist_get_uint_val(version_node, version);\n\t\t\t\tdebug_info(\"restored protocol version %llu\", *version);\n\t\t\t} else {\n\t\t\t\treturn RESTORE_E_UNKNOWN_ERROR;\n\t\t\t}\n\t\t}\n\t\tret = RESTORE_E_SUCCESS;\n\t} else {\n\t\tdebug_info(\"hmm. QueryType response does not contain a type?!\");\n\t\tdebug_plist(dict);\n\t\tplist_free(dict);\n\t}\n\n\treturn ret;\n}"
  },
  {
    "function_name": "restored_send",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/restore.c",
    "lines": "151-164",
    "snippet": "LIBIMOBILEDEVICE_API restored_error_t restored_send(restored_client_t client, plist_t plist)\n{\n\tif (!client || !plist)\n\t\treturn RESTORE_E_INVALID_ARG;\n\n\trestored_error_t ret = RESTORE_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_send_xml_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = RESTORE_E_UNKNOWN_ERROR;\n\t}\n\treturn ret;\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"idevice.h\"",
      "#include \"restore.h\"",
      "#include \"property_list_service.h\"",
      "#include <plist/plist.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <errno.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "property_list_service_send_xml_plist",
          "args": [
            "client->parent",
            "plist"
          ],
          "line": 159
        },
        "resolved": true,
        "details": {
          "function_name": "property_list_service_send_xml_plist",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
          "lines": "150-153",
          "snippet": "LIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_send_xml_plist(property_list_service_client_t client, plist_t plist)\n{\n\treturn internal_plist_send(client, plist, 0);\n}",
          "includes": [
            "#include \"endianness.h\"",
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_send_xml_plist(property_list_service_client_t client, plist_t plist)\n{\n\treturn internal_plist_send(client, plist, 0);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"restore.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <stdlib.h>\n#include <string.h>\n#include <errno.h>\n\nLIBIMOBILEDEVICE_API restored_error_t restored_send(restored_client_t client, plist_t plist)\n{\n\tif (!client || !plist)\n\t\treturn RESTORE_E_INVALID_ARG;\n\n\trestored_error_t ret = RESTORE_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_send_xml_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = RESTORE_E_UNKNOWN_ERROR;\n\t}\n\treturn ret;\n}"
  },
  {
    "function_name": "restored_receive",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/restore.c",
    "lines": "132-149",
    "snippet": "LIBIMOBILEDEVICE_API restored_error_t restored_receive(restored_client_t client, plist_t *plist)\n{\n\tif (!client || !plist || (plist && *plist))\n\t\treturn RESTORE_E_INVALID_ARG;\n\n\trestored_error_t ret = RESTORE_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_receive_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = RESTORE_E_UNKNOWN_ERROR;\n\t}\n\n\tif (!*plist)\n\t\tret = RESTORE_E_PLIST_ERROR;\n\n\treturn ret;\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"idevice.h\"",
      "#include \"restore.h\"",
      "#include \"property_list_service.h\"",
      "#include <plist/plist.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <errno.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "property_list_service_receive_plist",
          "args": [
            "client->parent",
            "plist"
          ],
          "line": 140
        },
        "resolved": true,
        "details": {
          "function_name": "property_list_service_receive_plist",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
          "lines": "258-261",
          "snippet": "LIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_receive_plist(property_list_service_client_t client, plist_t *plist)\n{\n\treturn internal_plist_receive_timeout(client, plist, 10000);\n}",
          "includes": [
            "#include \"endianness.h\"",
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_receive_plist(property_list_service_client_t client, plist_t *plist)\n{\n\treturn internal_plist_receive_timeout(client, plist, 10000);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"restore.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <stdlib.h>\n#include <string.h>\n#include <errno.h>\n\nLIBIMOBILEDEVICE_API restored_error_t restored_receive(restored_client_t client, plist_t *plist)\n{\n\tif (!client || !plist || (plist && *plist))\n\t\treturn RESTORE_E_INVALID_ARG;\n\n\trestored_error_t ret = RESTORE_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_receive_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = RESTORE_E_UNKNOWN_ERROR;\n\t}\n\n\tif (!*plist)\n\t\tret = RESTORE_E_PLIST_ERROR;\n\n\treturn ret;\n}"
  },
  {
    "function_name": "restored_client_set_label",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/restore.c",
    "lines": "122-130",
    "snippet": "LIBIMOBILEDEVICE_API void restored_client_set_label(restored_client_t client, const char *label)\n{\n\tif (client) {\n\t\tif (client->label)\n\t\t\tfree(client->label);\n\n\t\tclient->label = (label != NULL) ? strdup(label): NULL;\n\t}\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"idevice.h\"",
      "#include \"restore.h\"",
      "#include \"property_list_service.h\"",
      "#include <plist/plist.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <errno.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "label"
          ],
          "line": 128
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "client->label"
          ],
          "line": 126
        },
        "resolved": true,
        "details": {
          "function_name": "restored_client_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/restore.c",
          "lines": "92-120",
          "snippet": "LIBIMOBILEDEVICE_API restored_error_t restored_client_free(restored_client_t client)\n{\n\tif (!client)\n\t\treturn RESTORE_E_INVALID_ARG;\n\n\trestored_error_t ret = RESTORE_E_UNKNOWN_ERROR;\n\n\tif (client->parent) {\n\t\trestored_goodbye(client);\n\n\t\tif (property_list_service_client_free(client->parent) == PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\t\tret = RESTORE_E_SUCCESS;\n\t\t}\n\t}\n\n\tif (client->udid) {\n\t\tfree(client->udid);\n\t}\n\tif (client->label) {\n\t\tfree(client->label);\n\t}\n\n\tif (client->info) {\n\t\tplist_free(client->info);\n\t}\n\n\tfree(client);\n\treturn ret;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"restore.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <errno.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"restore.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <stdlib.h>\n#include <string.h>\n#include <errno.h>\n\nLIBIMOBILEDEVICE_API restored_error_t restored_client_free(restored_client_t client)\n{\n\tif (!client)\n\t\treturn RESTORE_E_INVALID_ARG;\n\n\trestored_error_t ret = RESTORE_E_UNKNOWN_ERROR;\n\n\tif (client->parent) {\n\t\trestored_goodbye(client);\n\n\t\tif (property_list_service_client_free(client->parent) == PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\t\tret = RESTORE_E_SUCCESS;\n\t\t}\n\t}\n\n\tif (client->udid) {\n\t\tfree(client->udid);\n\t}\n\tif (client->label) {\n\t\tfree(client->label);\n\t}\n\n\tif (client->info) {\n\t\tplist_free(client->info);\n\t}\n\n\tfree(client);\n\treturn ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"restore.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <stdlib.h>\n#include <string.h>\n#include <errno.h>\n\nLIBIMOBILEDEVICE_API void restored_client_set_label(restored_client_t client, const char *label)\n{\n\tif (client) {\n\t\tif (client->label)\n\t\t\tfree(client->label);\n\n\t\tclient->label = (label != NULL) ? strdup(label): NULL;\n\t}\n}"
  },
  {
    "function_name": "restored_client_free",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/restore.c",
    "lines": "92-120",
    "snippet": "LIBIMOBILEDEVICE_API restored_error_t restored_client_free(restored_client_t client)\n{\n\tif (!client)\n\t\treturn RESTORE_E_INVALID_ARG;\n\n\trestored_error_t ret = RESTORE_E_UNKNOWN_ERROR;\n\n\tif (client->parent) {\n\t\trestored_goodbye(client);\n\n\t\tif (property_list_service_client_free(client->parent) == PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\t\tret = RESTORE_E_SUCCESS;\n\t\t}\n\t}\n\n\tif (client->udid) {\n\t\tfree(client->udid);\n\t}\n\tif (client->label) {\n\t\tfree(client->label);\n\t}\n\n\tif (client->info) {\n\t\tplist_free(client->info);\n\t}\n\n\tfree(client);\n\treturn ret;\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"idevice.h\"",
      "#include \"restore.h\"",
      "#include \"property_list_service.h\"",
      "#include <plist/plist.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <errno.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "client"
          ],
          "line": 118
        },
        "resolved": true,
        "details": {
          "function_name": "restored_client_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/restore.c",
          "lines": "92-120",
          "snippet": "LIBIMOBILEDEVICE_API restored_error_t restored_client_free(restored_client_t client)\n{\n\tif (!client)\n\t\treturn RESTORE_E_INVALID_ARG;\n\n\trestored_error_t ret = RESTORE_E_UNKNOWN_ERROR;\n\n\tif (client->parent) {\n\t\trestored_goodbye(client);\n\n\t\tif (property_list_service_client_free(client->parent) == PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\t\tret = RESTORE_E_SUCCESS;\n\t\t}\n\t}\n\n\tif (client->udid) {\n\t\tfree(client->udid);\n\t}\n\tif (client->label) {\n\t\tfree(client->label);\n\t}\n\n\tif (client->info) {\n\t\tplist_free(client->info);\n\t}\n\n\tfree(client);\n\treturn ret;\n}",
          "note": "cyclic_reference_detected"
        }
      },
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "client->info"
          ],
          "line": 115
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "property_list_service_client_free",
          "args": [
            "client->parent"
          ],
          "line": 102
        },
        "resolved": true,
        "details": {
          "function_name": "property_list_service_client_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
          "lines": "77-88",
          "snippet": "LIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_client_free(property_list_service_client_t client)\n{\n\tif (!client)\n\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\n\tproperty_list_service_error_t err = service_to_property_list_service_error(service_client_free(client->parent));\n\n\tfree(client);\n\tclient = NULL;\n\n\treturn err;\n}",
          "includes": [
            "#include \"endianness.h\"",
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_client_free(property_list_service_client_t client)\n{\n\tif (!client)\n\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\n\tproperty_list_service_error_t err = service_to_property_list_service_error(service_client_free(client->parent));\n\n\tfree(client);\n\tclient = NULL;\n\n\treturn err;\n}"
        }
      },
      {
        "call_info": {
          "callee": "restored_goodbye",
          "args": [
            "client"
          ],
          "line": 100
        },
        "resolved": true,
        "details": {
          "function_name": "restored_goodbye",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/restore.c",
          "lines": "337-367",
          "snippet": "LIBIMOBILEDEVICE_API restored_error_t restored_goodbye(restored_client_t client)\n{\n\tif (!client)\n\t\treturn RESTORE_E_INVALID_ARG;\n\n\trestored_error_t ret = RESTORE_E_UNKNOWN_ERROR;\n\n\tplist_t dict = plist_new_dict();\n\tplist_dict_add_label(dict, client->label);\n\tplist_dict_set_item(dict,\"Request\", plist_new_string(\"Goodbye\"));\n\n\tdebug_info(\"called\");\n\n\tret = restored_send(client, dict);\n\tplist_free(dict);\n\tdict = NULL;\n\n\tret = restored_receive(client, &dict);\n\tif (!dict) {\n\t\tdebug_info(\"did not get goodbye response back\");\n\t\treturn RESTORE_E_PLIST_ERROR;\n\t}\n\n\tif (restored_check_result(dict) == RESULT_SUCCESS) {\n\t\tdebug_info(\"success\");\n\t\tret = RESTORE_E_SUCCESS;\n\t}\n\tplist_free(dict);\n\tdict = NULL;\n\treturn ret;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"restore.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <errno.h>"
          ],
          "macros_used": [
            "#define RESULT_SUCCESS 0"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"restore.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <stdlib.h>\n#include <string.h>\n#include <errno.h>\n\n#define RESULT_SUCCESS 0\n\nLIBIMOBILEDEVICE_API restored_error_t restored_goodbye(restored_client_t client)\n{\n\tif (!client)\n\t\treturn RESTORE_E_INVALID_ARG;\n\n\trestored_error_t ret = RESTORE_E_UNKNOWN_ERROR;\n\n\tplist_t dict = plist_new_dict();\n\tplist_dict_add_label(dict, client->label);\n\tplist_dict_set_item(dict,\"Request\", plist_new_string(\"Goodbye\"));\n\n\tdebug_info(\"called\");\n\n\tret = restored_send(client, dict);\n\tplist_free(dict);\n\tdict = NULL;\n\n\tret = restored_receive(client, &dict);\n\tif (!dict) {\n\t\tdebug_info(\"did not get goodbye response back\");\n\t\treturn RESTORE_E_PLIST_ERROR;\n\t}\n\n\tif (restored_check_result(dict) == RESULT_SUCCESS) {\n\t\tdebug_info(\"success\");\n\t\tret = RESTORE_E_SUCCESS;\n\t}\n\tplist_free(dict);\n\tdict = NULL;\n\treturn ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"restore.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <stdlib.h>\n#include <string.h>\n#include <errno.h>\n\nLIBIMOBILEDEVICE_API restored_error_t restored_client_free(restored_client_t client)\n{\n\tif (!client)\n\t\treturn RESTORE_E_INVALID_ARG;\n\n\trestored_error_t ret = RESTORE_E_UNKNOWN_ERROR;\n\n\tif (client->parent) {\n\t\trestored_goodbye(client);\n\n\t\tif (property_list_service_client_free(client->parent) == PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\t\tret = RESTORE_E_SUCCESS;\n\t\t}\n\t}\n\n\tif (client->udid) {\n\t\tfree(client->udid);\n\t}\n\tif (client->label) {\n\t\tfree(client->label);\n\t}\n\n\tif (client->info) {\n\t\tplist_free(client->info);\n\t}\n\n\tfree(client);\n\treturn ret;\n}"
  },
  {
    "function_name": "plist_dict_add_label",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/restore.c",
    "lines": "84-90",
    "snippet": "static void plist_dict_add_label(plist_t plist, const char *label)\n{\n\tif (plist && label) {\n\t\tif (plist_get_node_type(plist) == PLIST_DICT)\n\t\t\tplist_dict_set_item(plist, \"Label\", plist_new_string(label));\n\t}\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"idevice.h\"",
      "#include \"restore.h\"",
      "#include \"property_list_service.h\"",
      "#include <plist/plist.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <errno.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "plist",
            "\"Label\"",
            "plist_new_string(label)"
          ],
          "line": 88
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "label"
          ],
          "line": 88
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_get_node_type",
          "args": [
            "plist"
          ],
          "line": 87
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"restore.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <stdlib.h>\n#include <string.h>\n#include <errno.h>\n\nstatic void plist_dict_add_label(plist_t plist, const char *label)\n{\n\tif (plist && label) {\n\t\tif (plist_get_node_type(plist) == PLIST_DICT)\n\t\t\tplist_dict_set_item(plist, \"Label\", plist_new_string(label));\n\t}\n}"
  },
  {
    "function_name": "restored_check_result",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/restore.c",
    "lines": "46-75",
    "snippet": "static int restored_check_result(plist_t dict)\n{\n\tint ret = -1;\n\tplist_t result_node = plist_dict_get_item(dict, \"Result\");\n\tif (!result_node) {\n\t\treturn ret;\n\t}\n\n\tplist_type result_type = plist_get_node_type(result_node);\n\n\tif (result_type == PLIST_STRING) {\n\n\t\tchar *result_value = NULL;\n\n\t\tplist_get_string_val(result_node, &result_value);\n\n\t\tif (result_value) {\n\t\t\tif (!strcmp(result_value, \"Success\")) {\n\t\t\t\tret = RESULT_SUCCESS;\n\t\t\t} else if (!strcmp(result_value, \"Failure\")) {\n\t\t\t\tret = RESULT_FAILURE;\n\t\t\t} else {\n\t\t\t\tdebug_info(\"ERROR: unknown result value '%s'\", result_value);\n\t\t\t}\n\t\t}\n\t\tif (result_value)\n\t\t\tfree(result_value);\n\t}\n\treturn ret;\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"idevice.h\"",
      "#include \"restore.h\"",
      "#include \"property_list_service.h\"",
      "#include <plist/plist.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <errno.h>"
    ],
    "macros_used": [
      "#define RESULT_FAILURE 1",
      "#define RESULT_SUCCESS 0"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "result_value"
          ],
          "line": 72
        },
        "resolved": true,
        "details": {
          "function_name": "restored_client_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/restore.c",
          "lines": "92-120",
          "snippet": "LIBIMOBILEDEVICE_API restored_error_t restored_client_free(restored_client_t client)\n{\n\tif (!client)\n\t\treturn RESTORE_E_INVALID_ARG;\n\n\trestored_error_t ret = RESTORE_E_UNKNOWN_ERROR;\n\n\tif (client->parent) {\n\t\trestored_goodbye(client);\n\n\t\tif (property_list_service_client_free(client->parent) == PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\t\tret = RESTORE_E_SUCCESS;\n\t\t}\n\t}\n\n\tif (client->udid) {\n\t\tfree(client->udid);\n\t}\n\tif (client->label) {\n\t\tfree(client->label);\n\t}\n\n\tif (client->info) {\n\t\tplist_free(client->info);\n\t}\n\n\tfree(client);\n\treturn ret;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"restore.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <errno.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"restore.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <stdlib.h>\n#include <string.h>\n#include <errno.h>\n\nLIBIMOBILEDEVICE_API restored_error_t restored_client_free(restored_client_t client)\n{\n\tif (!client)\n\t\treturn RESTORE_E_INVALID_ARG;\n\n\trestored_error_t ret = RESTORE_E_UNKNOWN_ERROR;\n\n\tif (client->parent) {\n\t\trestored_goodbye(client);\n\n\t\tif (property_list_service_client_free(client->parent) == PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\t\tret = RESTORE_E_SUCCESS;\n\t\t}\n\t}\n\n\tif (client->udid) {\n\t\tfree(client->udid);\n\t}\n\tif (client->label) {\n\t\tfree(client->label);\n\t}\n\n\tif (client->info) {\n\t\tplist_free(client->info);\n\t}\n\n\tfree(client);\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"ERROR: unknown result value '%s'\"",
            "result_value"
          ],
          "line": 68
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "result_value",
            "\"Failure\""
          ],
          "line": 65
        },
        "resolved": true,
        "details": {
          "function_name": "plist_strcmp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/tools/idevicebackup.c",
          "lines": "296-309",
          "snippet": "static int plist_strcmp(plist_t node, const char *str)\n{\n\tchar *buffer = NULL;\n\tint ret = 0;\n\n\tif (plist_get_node_type(node) != PLIST_STRING)\n\t\treturn ret;\n\n\tplist_get_string_val(node, &buffer);\n\tret = strcmp(buffer, str);\n\tfree(buffer);\n\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"common/utils.h\"",
            "#include <libimobiledevice/afc.h>",
            "#include <libimobiledevice/notification_proxy.h>",
            "#include <libimobiledevice/mobilebackup.h>",
            "#include <libimobiledevice/lockdown.h>",
            "#include <libimobiledevice/libimobiledevice.h>",
            "#include <time.h>",
            "#include <ctype.h>",
            "#include <unistd.h>",
            "#include <gcrypt.h>",
            "#include <openssl/sha.h>",
            "#include <signal.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"common/utils.h\"\n#include <libimobiledevice/afc.h>\n#include <libimobiledevice/notification_proxy.h>\n#include <libimobiledevice/mobilebackup.h>\n#include <libimobiledevice/lockdown.h>\n#include <libimobiledevice/libimobiledevice.h>\n#include <time.h>\n#include <ctype.h>\n#include <unistd.h>\n#include <gcrypt.h>\n#include <openssl/sha.h>\n#include <signal.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int plist_strcmp(plist_t node, const char *str)\n{\n\tchar *buffer = NULL;\n\tint ret = 0;\n\n\tif (plist_get_node_type(node) != PLIST_STRING)\n\t\treturn ret;\n\n\tplist_get_string_val(node, &buffer);\n\tret = strcmp(buffer, str);\n\tfree(buffer);\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_get_string_val",
          "args": [
            "result_node",
            "&result_value"
          ],
          "line": 60
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_get_node_type",
          "args": [
            "result_node"
          ],
          "line": 54
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_get_item",
          "args": [
            "dict",
            "\"Result\""
          ],
          "line": 49
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"restore.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <stdlib.h>\n#include <string.h>\n#include <errno.h>\n\n#define RESULT_FAILURE 1\n#define RESULT_SUCCESS 0\n\nstatic int restored_check_result(plist_t dict)\n{\n\tint ret = -1;\n\tplist_t result_node = plist_dict_get_item(dict, \"Result\");\n\tif (!result_node) {\n\t\treturn ret;\n\t}\n\n\tplist_type result_type = plist_get_node_type(result_node);\n\n\tif (result_type == PLIST_STRING) {\n\n\t\tchar *result_value = NULL;\n\n\t\tplist_get_string_val(result_node, &result_value);\n\n\t\tif (result_value) {\n\t\t\tif (!strcmp(result_value, \"Success\")) {\n\t\t\t\tret = RESULT_SUCCESS;\n\t\t\t} else if (!strcmp(result_value, \"Failure\")) {\n\t\t\t\tret = RESULT_FAILURE;\n\t\t\t} else {\n\t\t\t\tdebug_info(\"ERROR: unknown result value '%s'\", result_value);\n\t\t\t}\n\t\t}\n\t\tif (result_value)\n\t\t\tfree(result_value);\n\t}\n\treturn ret;\n}"
  }
]