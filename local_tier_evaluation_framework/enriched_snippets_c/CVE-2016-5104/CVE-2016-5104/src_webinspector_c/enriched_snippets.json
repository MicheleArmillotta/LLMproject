[
  {
    "function_name": "webinspector_receive_with_timeout",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/webinspector.c",
    "lines": "168-259",
    "snippet": "LIBIMOBILEDEVICE_API webinspector_error_t webinspector_receive_with_timeout(webinspector_client_t client, plist_t * plist, uint32_t timeout_ms)\n{\n\twebinspector_error_t res = WEBINSPECTOR_E_UNKNOWN_ERROR;\n\tplist_t message = NULL;\n\tplist_t key = NULL;\n\n\tint is_final_message = 1;\n\n\tchar* buffer = NULL;\n\tuint64_t length = 0;\n\n\tchar* packet = NULL;\n\tchar* newpacket = NULL;\n\tuint64_t packet_length = 0;\n\n\tdebug_info(\"Receiving webinspector message...\");\n\n\tdo {\n\t\t/* receive message */\n\t\tres = webinspector_error(property_list_service_receive_plist_with_timeout(client->parent, &message, timeout_ms));\n\t\tif (res != WEBINSPECTOR_E_SUCCESS || !message) {\n\t\t\tdebug_info(\"Could not receive message, error %d\", res);\n\t\t\tplist_free(message);\n\t\t\treturn WEBINSPECTOR_E_MUX_ERROR;\n\t\t}\n\n\t\t/* get message key */\n\t\tkey = plist_dict_get_item(message, \"WIRFinalMessageKey\");\n\t\tif (!key) {\n\t\t\tkey = plist_dict_get_item(message, \"WIRPartialMessageKey\");\n\t\t\tif (!key) {\n\t\t\t\tdebug_info(\"ERROR: Unable to read message key.\");\n\t\t\t\tplist_free(message);\n\t\t\t\treturn WEBINSPECTOR_E_PLIST_ERROR;\n\t\t\t}\n\t\t\tis_final_message = 0;\n\t\t} else {\n\t\t\tis_final_message = 1;\n\t\t}\n\n\t\t/* read partial data */\n\t\tplist_get_data_val(key, &buffer, &length);\n\t\tif (!buffer || length == 0 || length > 0xFFFFFFFF) {\n\t\t\tdebug_info(\"ERROR: Unable to get the inner plist binary data.\");\n\t\t\tfree(packet);\n\t\t\tfree(buffer);\n\t\t\treturn WEBINSPECTOR_E_PLIST_ERROR;\n\t\t}\n\n\t\t/* (re)allocate packet data */\n\t\tif (!packet) {\n\t\t\tpacket = (char*)malloc(length * sizeof(char));\n\t\t} else {\n\t\t\tnewpacket = (char*)realloc(packet, (packet_length + length) * sizeof(char));\n\t\t\tpacket = newpacket;\n\t\t}\n\n\t\t/* copy partial data into final packet data */\n\t\tmemcpy(packet + packet_length, buffer, length);\n\n\t\t/* cleanup buffer */\n\t\tfree(buffer);\n\t\tbuffer = NULL;\n\n\t\tif (message) {\n\t\t\tplist_free(message);\n\t\t\tmessage = NULL;\n\t\t}\n\n\t\t/* adjust packet length */\n\t\tpacket_length += length;\n\t\tlength = 0;\n\t} while(!is_final_message);\n\n\t/* read final message */\n\tif (packet_length) {\n\t\tplist_from_bin(packet, (uint32_t)packet_length, plist);\n\t\tif (!*plist) {\n\t\t\tdebug_info(\"Error restoring the final plist.\");\n\t\t\tfree(packet);\n\t\t\treturn WEBINSPECTOR_E_PLIST_ERROR;\n\t\t}\n\n\t\tdebug_plist(*plist);\n\t}\n\n\tif (packet) {\n\t\tfree(packet);\n\t}\n\n\treturn res;\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"lockdown.h\"",
      "#include \"webinspector.h\"",
      "#include <plist/plist.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "packet"
          ],
          "line": 255
        },
        "resolved": true,
        "details": {
          "function_name": "webinspector_client_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/webinspector.c",
          "lines": "95-104",
          "snippet": "LIBIMOBILEDEVICE_API webinspector_error_t webinspector_client_free(webinspector_client_t client)\n{\n\tif (!client)\n\t\treturn WEBINSPECTOR_E_INVALID_ARG;\n\n\twebinspector_error_t err = webinspector_error(property_list_service_client_free(client->parent));\n\tfree(client);\n\n\treturn err;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"lockdown.h\"",
            "#include \"webinspector.h\"",
            "#include <plist/plist.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"webinspector.h\"\n#include <plist/plist.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API webinspector_error_t webinspector_client_free(webinspector_client_t client)\n{\n\tif (!client)\n\t\treturn WEBINSPECTOR_E_INVALID_ARG;\n\n\twebinspector_error_t err = webinspector_error(property_list_service_client_free(client->parent));\n\tfree(client);\n\n\treturn err;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_plist",
          "args": [
            "*plist"
          ],
          "line": 251
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"Error restoring the final plist.\""
          ],
          "line": 246
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_from_bin",
          "args": [
            "packet",
            "(uint32_t)packet_length",
            "plist"
          ],
          "line": 244
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "message"
          ],
          "line": 233
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "packet + packet_length",
            "buffer",
            "length"
          ],
          "line": 226
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "realloc",
          "args": [
            "packet",
            "(packet_length + length) * sizeof(char)"
          ],
          "line": 221
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "malloc",
          "args": [
            "length * sizeof(char)"
          ],
          "line": 219
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"ERROR: Unable to get the inner plist binary data.\""
          ],
          "line": 211
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_get_data_val",
          "args": [
            "key",
            "&buffer",
            "&length"
          ],
          "line": 209
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "message"
          ],
          "line": 200
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"ERROR: Unable to read message key.\""
          ],
          "line": 199
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_get_item",
          "args": [
            "message",
            "\"WIRPartialMessageKey\""
          ],
          "line": 197
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_get_item",
          "args": [
            "message",
            "\"WIRFinalMessageKey\""
          ],
          "line": 195
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "message"
          ],
          "line": 190
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"Could not receive message, error %d\"",
            "res"
          ],
          "line": 189
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "webinspector_error",
          "args": [
            "property_list_service_receive_plist_with_timeout(client->parent, &message, timeout_ms)"
          ],
          "line": 187
        },
        "resolved": true,
        "details": {
          "function_name": "webinspector_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/webinspector.c",
          "lines": "42-59",
          "snippet": "static webinspector_error_t webinspector_error(property_list_service_error_t err)\n{\n\tswitch (err) {\n\t\tcase PROPERTY_LIST_SERVICE_E_SUCCESS:\n\t\t\treturn WEBINSPECTOR_E_SUCCESS;\n\t\tcase PROPERTY_LIST_SERVICE_E_INVALID_ARG:\n\t\t\treturn WEBINSPECTOR_E_INVALID_ARG;\n\t\tcase PROPERTY_LIST_SERVICE_E_PLIST_ERROR:\n\t\t\treturn WEBINSPECTOR_E_PLIST_ERROR;\n\t\tcase PROPERTY_LIST_SERVICE_E_MUX_ERROR:\n\t\t\treturn WEBINSPECTOR_E_MUX_ERROR;\n\t\tcase PROPERTY_LIST_SERVICE_E_SSL_ERROR:\n\t\t\treturn WEBINSPECTOR_E_SSL_ERROR;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn WEBINSPECTOR_E_UNKNOWN_ERROR;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"lockdown.h\"",
            "#include \"webinspector.h\"",
            "#include <plist/plist.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"webinspector.h\"\n#include <plist/plist.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic webinspector_error_t webinspector_error(property_list_service_error_t err)\n{\n\tswitch (err) {\n\t\tcase PROPERTY_LIST_SERVICE_E_SUCCESS:\n\t\t\treturn WEBINSPECTOR_E_SUCCESS;\n\t\tcase PROPERTY_LIST_SERVICE_E_INVALID_ARG:\n\t\t\treturn WEBINSPECTOR_E_INVALID_ARG;\n\t\tcase PROPERTY_LIST_SERVICE_E_PLIST_ERROR:\n\t\t\treturn WEBINSPECTOR_E_PLIST_ERROR;\n\t\tcase PROPERTY_LIST_SERVICE_E_MUX_ERROR:\n\t\t\treturn WEBINSPECTOR_E_MUX_ERROR;\n\t\tcase PROPERTY_LIST_SERVICE_E_SSL_ERROR:\n\t\t\treturn WEBINSPECTOR_E_SSL_ERROR;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn WEBINSPECTOR_E_UNKNOWN_ERROR;\n}"
        }
      },
      {
        "call_info": {
          "callee": "property_list_service_receive_plist_with_timeout",
          "args": [
            "client->parent",
            "&message",
            "timeout_ms"
          ],
          "line": 187
        },
        "resolved": true,
        "details": {
          "function_name": "property_list_service_receive_plist_with_timeout",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
          "lines": "253-256",
          "snippet": "LIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_receive_plist_with_timeout(property_list_service_client_t client, plist_t *plist, unsigned int timeout)\n{\n\treturn internal_plist_receive_timeout(client, plist, timeout);\n}",
          "includes": [
            "#include \"endianness.h\"",
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_receive_plist_with_timeout(property_list_service_client_t client, plist_t *plist, unsigned int timeout)\n{\n\treturn internal_plist_receive_timeout(client, plist, timeout);\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"Receiving webinspector message...\""
          ],
          "line": 183
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"webinspector.h\"\n#include <plist/plist.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API webinspector_error_t webinspector_receive_with_timeout(webinspector_client_t client, plist_t * plist, uint32_t timeout_ms)\n{\n\twebinspector_error_t res = WEBINSPECTOR_E_UNKNOWN_ERROR;\n\tplist_t message = NULL;\n\tplist_t key = NULL;\n\n\tint is_final_message = 1;\n\n\tchar* buffer = NULL;\n\tuint64_t length = 0;\n\n\tchar* packet = NULL;\n\tchar* newpacket = NULL;\n\tuint64_t packet_length = 0;\n\n\tdebug_info(\"Receiving webinspector message...\");\n\n\tdo {\n\t\t/* receive message */\n\t\tres = webinspector_error(property_list_service_receive_plist_with_timeout(client->parent, &message, timeout_ms));\n\t\tif (res != WEBINSPECTOR_E_SUCCESS || !message) {\n\t\t\tdebug_info(\"Could not receive message, error %d\", res);\n\t\t\tplist_free(message);\n\t\t\treturn WEBINSPECTOR_E_MUX_ERROR;\n\t\t}\n\n\t\t/* get message key */\n\t\tkey = plist_dict_get_item(message, \"WIRFinalMessageKey\");\n\t\tif (!key) {\n\t\t\tkey = plist_dict_get_item(message, \"WIRPartialMessageKey\");\n\t\t\tif (!key) {\n\t\t\t\tdebug_info(\"ERROR: Unable to read message key.\");\n\t\t\t\tplist_free(message);\n\t\t\t\treturn WEBINSPECTOR_E_PLIST_ERROR;\n\t\t\t}\n\t\t\tis_final_message = 0;\n\t\t} else {\n\t\t\tis_final_message = 1;\n\t\t}\n\n\t\t/* read partial data */\n\t\tplist_get_data_val(key, &buffer, &length);\n\t\tif (!buffer || length == 0 || length > 0xFFFFFFFF) {\n\t\t\tdebug_info(\"ERROR: Unable to get the inner plist binary data.\");\n\t\t\tfree(packet);\n\t\t\tfree(buffer);\n\t\t\treturn WEBINSPECTOR_E_PLIST_ERROR;\n\t\t}\n\n\t\t/* (re)allocate packet data */\n\t\tif (!packet) {\n\t\t\tpacket = (char*)malloc(length * sizeof(char));\n\t\t} else {\n\t\t\tnewpacket = (char*)realloc(packet, (packet_length + length) * sizeof(char));\n\t\t\tpacket = newpacket;\n\t\t}\n\n\t\t/* copy partial data into final packet data */\n\t\tmemcpy(packet + packet_length, buffer, length);\n\n\t\t/* cleanup buffer */\n\t\tfree(buffer);\n\t\tbuffer = NULL;\n\n\t\tif (message) {\n\t\t\tplist_free(message);\n\t\t\tmessage = NULL;\n\t\t}\n\n\t\t/* adjust packet length */\n\t\tpacket_length += length;\n\t\tlength = 0;\n\t} while(!is_final_message);\n\n\t/* read final message */\n\tif (packet_length) {\n\t\tplist_from_bin(packet, (uint32_t)packet_length, plist);\n\t\tif (!*plist) {\n\t\t\tdebug_info(\"Error restoring the final plist.\");\n\t\t\tfree(packet);\n\t\t\treturn WEBINSPECTOR_E_PLIST_ERROR;\n\t\t}\n\n\t\tdebug_plist(*plist);\n\t}\n\n\tif (packet) {\n\t\tfree(packet);\n\t}\n\n\treturn res;\n}"
  },
  {
    "function_name": "webinspector_receive",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/webinspector.c",
    "lines": "163-166",
    "snippet": "LIBIMOBILEDEVICE_API webinspector_error_t webinspector_receive(webinspector_client_t client, plist_t * plist)\n{\n\treturn webinspector_receive_with_timeout(client, plist, 5000);\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"lockdown.h\"",
      "#include \"webinspector.h\"",
      "#include <plist/plist.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "webinspector_receive_with_timeout",
          "args": [
            "client",
            "plist",
            "5000"
          ],
          "line": 165
        },
        "resolved": true,
        "details": {
          "function_name": "webinspector_receive_with_timeout",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/webinspector.c",
          "lines": "168-259",
          "snippet": "LIBIMOBILEDEVICE_API webinspector_error_t webinspector_receive_with_timeout(webinspector_client_t client, plist_t * plist, uint32_t timeout_ms)\n{\n\twebinspector_error_t res = WEBINSPECTOR_E_UNKNOWN_ERROR;\n\tplist_t message = NULL;\n\tplist_t key = NULL;\n\n\tint is_final_message = 1;\n\n\tchar* buffer = NULL;\n\tuint64_t length = 0;\n\n\tchar* packet = NULL;\n\tchar* newpacket = NULL;\n\tuint64_t packet_length = 0;\n\n\tdebug_info(\"Receiving webinspector message...\");\n\n\tdo {\n\t\t/* receive message */\n\t\tres = webinspector_error(property_list_service_receive_plist_with_timeout(client->parent, &message, timeout_ms));\n\t\tif (res != WEBINSPECTOR_E_SUCCESS || !message) {\n\t\t\tdebug_info(\"Could not receive message, error %d\", res);\n\t\t\tplist_free(message);\n\t\t\treturn WEBINSPECTOR_E_MUX_ERROR;\n\t\t}\n\n\t\t/* get message key */\n\t\tkey = plist_dict_get_item(message, \"WIRFinalMessageKey\");\n\t\tif (!key) {\n\t\t\tkey = plist_dict_get_item(message, \"WIRPartialMessageKey\");\n\t\t\tif (!key) {\n\t\t\t\tdebug_info(\"ERROR: Unable to read message key.\");\n\t\t\t\tplist_free(message);\n\t\t\t\treturn WEBINSPECTOR_E_PLIST_ERROR;\n\t\t\t}\n\t\t\tis_final_message = 0;\n\t\t} else {\n\t\t\tis_final_message = 1;\n\t\t}\n\n\t\t/* read partial data */\n\t\tplist_get_data_val(key, &buffer, &length);\n\t\tif (!buffer || length == 0 || length > 0xFFFFFFFF) {\n\t\t\tdebug_info(\"ERROR: Unable to get the inner plist binary data.\");\n\t\t\tfree(packet);\n\t\t\tfree(buffer);\n\t\t\treturn WEBINSPECTOR_E_PLIST_ERROR;\n\t\t}\n\n\t\t/* (re)allocate packet data */\n\t\tif (!packet) {\n\t\t\tpacket = (char*)malloc(length * sizeof(char));\n\t\t} else {\n\t\t\tnewpacket = (char*)realloc(packet, (packet_length + length) * sizeof(char));\n\t\t\tpacket = newpacket;\n\t\t}\n\n\t\t/* copy partial data into final packet data */\n\t\tmemcpy(packet + packet_length, buffer, length);\n\n\t\t/* cleanup buffer */\n\t\tfree(buffer);\n\t\tbuffer = NULL;\n\n\t\tif (message) {\n\t\t\tplist_free(message);\n\t\t\tmessage = NULL;\n\t\t}\n\n\t\t/* adjust packet length */\n\t\tpacket_length += length;\n\t\tlength = 0;\n\t} while(!is_final_message);\n\n\t/* read final message */\n\tif (packet_length) {\n\t\tplist_from_bin(packet, (uint32_t)packet_length, plist);\n\t\tif (!*plist) {\n\t\t\tdebug_info(\"Error restoring the final plist.\");\n\t\t\tfree(packet);\n\t\t\treturn WEBINSPECTOR_E_PLIST_ERROR;\n\t\t}\n\n\t\tdebug_plist(*plist);\n\t}\n\n\tif (packet) {\n\t\tfree(packet);\n\t}\n\n\treturn res;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"lockdown.h\"",
            "#include \"webinspector.h\"",
            "#include <plist/plist.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"webinspector.h\"\n#include <plist/plist.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API webinspector_error_t webinspector_receive_with_timeout(webinspector_client_t client, plist_t * plist, uint32_t timeout_ms)\n{\n\twebinspector_error_t res = WEBINSPECTOR_E_UNKNOWN_ERROR;\n\tplist_t message = NULL;\n\tplist_t key = NULL;\n\n\tint is_final_message = 1;\n\n\tchar* buffer = NULL;\n\tuint64_t length = 0;\n\n\tchar* packet = NULL;\n\tchar* newpacket = NULL;\n\tuint64_t packet_length = 0;\n\n\tdebug_info(\"Receiving webinspector message...\");\n\n\tdo {\n\t\t/* receive message */\n\t\tres = webinspector_error(property_list_service_receive_plist_with_timeout(client->parent, &message, timeout_ms));\n\t\tif (res != WEBINSPECTOR_E_SUCCESS || !message) {\n\t\t\tdebug_info(\"Could not receive message, error %d\", res);\n\t\t\tplist_free(message);\n\t\t\treturn WEBINSPECTOR_E_MUX_ERROR;\n\t\t}\n\n\t\t/* get message key */\n\t\tkey = plist_dict_get_item(message, \"WIRFinalMessageKey\");\n\t\tif (!key) {\n\t\t\tkey = plist_dict_get_item(message, \"WIRPartialMessageKey\");\n\t\t\tif (!key) {\n\t\t\t\tdebug_info(\"ERROR: Unable to read message key.\");\n\t\t\t\tplist_free(message);\n\t\t\t\treturn WEBINSPECTOR_E_PLIST_ERROR;\n\t\t\t}\n\t\t\tis_final_message = 0;\n\t\t} else {\n\t\t\tis_final_message = 1;\n\t\t}\n\n\t\t/* read partial data */\n\t\tplist_get_data_val(key, &buffer, &length);\n\t\tif (!buffer || length == 0 || length > 0xFFFFFFFF) {\n\t\t\tdebug_info(\"ERROR: Unable to get the inner plist binary data.\");\n\t\t\tfree(packet);\n\t\t\tfree(buffer);\n\t\t\treturn WEBINSPECTOR_E_PLIST_ERROR;\n\t\t}\n\n\t\t/* (re)allocate packet data */\n\t\tif (!packet) {\n\t\t\tpacket = (char*)malloc(length * sizeof(char));\n\t\t} else {\n\t\t\tnewpacket = (char*)realloc(packet, (packet_length + length) * sizeof(char));\n\t\t\tpacket = newpacket;\n\t\t}\n\n\t\t/* copy partial data into final packet data */\n\t\tmemcpy(packet + packet_length, buffer, length);\n\n\t\t/* cleanup buffer */\n\t\tfree(buffer);\n\t\tbuffer = NULL;\n\n\t\tif (message) {\n\t\t\tplist_free(message);\n\t\t\tmessage = NULL;\n\t\t}\n\n\t\t/* adjust packet length */\n\t\tpacket_length += length;\n\t\tlength = 0;\n\t} while(!is_final_message);\n\n\t/* read final message */\n\tif (packet_length) {\n\t\tplist_from_bin(packet, (uint32_t)packet_length, plist);\n\t\tif (!*plist) {\n\t\t\tdebug_info(\"Error restoring the final plist.\");\n\t\t\tfree(packet);\n\t\t\treturn WEBINSPECTOR_E_PLIST_ERROR;\n\t\t}\n\n\t\tdebug_plist(*plist);\n\t}\n\n\tif (packet) {\n\t\tfree(packet);\n\t}\n\n\treturn res;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"webinspector.h\"\n#include <plist/plist.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API webinspector_error_t webinspector_receive(webinspector_client_t client, plist_t * plist)\n{\n\treturn webinspector_receive_with_timeout(client, plist, 5000);\n}"
  },
  {
    "function_name": "webinspector_send",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/webinspector.c",
    "lines": "106-161",
    "snippet": "LIBIMOBILEDEVICE_API webinspector_error_t webinspector_send(webinspector_client_t client, plist_t plist)\n{\n\twebinspector_error_t res = WEBINSPECTOR_E_UNKNOWN_ERROR;\n\n\tuint32_t offset = 0;\n\tint is_final_message = 0;\n\n\tchar *packet = NULL;\n\tuint32_t packet_length = 0;\n\n\tdebug_info(\"Sending webinspector message...\");\n\tdebug_plist(plist);\n\n\t/* convert plist to packet */\n\tplist_to_bin(plist, &packet, &packet_length);\n\tif (!packet || packet_length == 0) {\n\t\tdebug_info(\"Error converting plist to binary.\");\n\t\treturn res;\n\t}\n\n\tdo {\n\t\t/* determine if we need to send partial messages */\n\t\tif (packet_length < WEBINSPECTOR_PARTIAL_PACKET_CHUNK_SIZE) {\n\t\t\tis_final_message = 1;\n\t\t} else {\n\t\t\t/* send partial packet */\n\t\t\tis_final_message = 0;\n\t\t}\n\n\t\tplist_t outplist = plist_new_dict();\n\t\tif (!is_final_message) {\n\t\t\t/* split packet into partial chunks */\n\t\t\tplist_dict_set_item(outplist, \"WIRPartialMessageKey\", plist_new_data(packet + offset, WEBINSPECTOR_PARTIAL_PACKET_CHUNK_SIZE));\n\t\t\toffset += WEBINSPECTOR_PARTIAL_PACKET_CHUNK_SIZE;\n\t\t\tpacket_length -= WEBINSPECTOR_PARTIAL_PACKET_CHUNK_SIZE;\n\t\t} else {\n\t\t\t/* send final chunk */\n\t\t\tplist_dict_set_item(outplist, \"WIRFinalMessageKey\", plist_new_data(packet + offset, packet_length));\n\t\t\toffset += packet_length;\n\t\t\tpacket_length -= packet_length;\n\t\t}\n\n\t\tres = webinspector_error(property_list_service_send_binary_plist(client->parent, outplist));\n\t\tplist_free(outplist);\n\t\toutplist = NULL;\n\t\tif (res != WEBINSPECTOR_E_SUCCESS) {\n\t\t\tdebug_info(\"Sending plist failed with error %d\", res);\n\t\t\treturn res;\n\t\t}\n\t} while(packet_length > 0);\n\n\tfree(packet);\n\tpacket = NULL;\n\n\treturn res;\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"lockdown.h\"",
      "#include \"webinspector.h\"",
      "#include <plist/plist.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "packet"
          ],
          "line": 157
        },
        "resolved": true,
        "details": {
          "function_name": "webinspector_client_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/webinspector.c",
          "lines": "95-104",
          "snippet": "LIBIMOBILEDEVICE_API webinspector_error_t webinspector_client_free(webinspector_client_t client)\n{\n\tif (!client)\n\t\treturn WEBINSPECTOR_E_INVALID_ARG;\n\n\twebinspector_error_t err = webinspector_error(property_list_service_client_free(client->parent));\n\tfree(client);\n\n\treturn err;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"lockdown.h\"",
            "#include \"webinspector.h\"",
            "#include <plist/plist.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"webinspector.h\"\n#include <plist/plist.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API webinspector_error_t webinspector_client_free(webinspector_client_t client)\n{\n\tif (!client)\n\t\treturn WEBINSPECTOR_E_INVALID_ARG;\n\n\twebinspector_error_t err = webinspector_error(property_list_service_client_free(client->parent));\n\tfree(client);\n\n\treturn err;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"Sending plist failed with error %d\"",
            "res"
          ],
          "line": 152
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "outplist"
          ],
          "line": 149
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "webinspector_error",
          "args": [
            "property_list_service_send_binary_plist(client->parent, outplist)"
          ],
          "line": 148
        },
        "resolved": true,
        "details": {
          "function_name": "webinspector_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/webinspector.c",
          "lines": "42-59",
          "snippet": "static webinspector_error_t webinspector_error(property_list_service_error_t err)\n{\n\tswitch (err) {\n\t\tcase PROPERTY_LIST_SERVICE_E_SUCCESS:\n\t\t\treturn WEBINSPECTOR_E_SUCCESS;\n\t\tcase PROPERTY_LIST_SERVICE_E_INVALID_ARG:\n\t\t\treturn WEBINSPECTOR_E_INVALID_ARG;\n\t\tcase PROPERTY_LIST_SERVICE_E_PLIST_ERROR:\n\t\t\treturn WEBINSPECTOR_E_PLIST_ERROR;\n\t\tcase PROPERTY_LIST_SERVICE_E_MUX_ERROR:\n\t\t\treturn WEBINSPECTOR_E_MUX_ERROR;\n\t\tcase PROPERTY_LIST_SERVICE_E_SSL_ERROR:\n\t\t\treturn WEBINSPECTOR_E_SSL_ERROR;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn WEBINSPECTOR_E_UNKNOWN_ERROR;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"lockdown.h\"",
            "#include \"webinspector.h\"",
            "#include <plist/plist.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"webinspector.h\"\n#include <plist/plist.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic webinspector_error_t webinspector_error(property_list_service_error_t err)\n{\n\tswitch (err) {\n\t\tcase PROPERTY_LIST_SERVICE_E_SUCCESS:\n\t\t\treturn WEBINSPECTOR_E_SUCCESS;\n\t\tcase PROPERTY_LIST_SERVICE_E_INVALID_ARG:\n\t\t\treturn WEBINSPECTOR_E_INVALID_ARG;\n\t\tcase PROPERTY_LIST_SERVICE_E_PLIST_ERROR:\n\t\t\treturn WEBINSPECTOR_E_PLIST_ERROR;\n\t\tcase PROPERTY_LIST_SERVICE_E_MUX_ERROR:\n\t\t\treturn WEBINSPECTOR_E_MUX_ERROR;\n\t\tcase PROPERTY_LIST_SERVICE_E_SSL_ERROR:\n\t\t\treturn WEBINSPECTOR_E_SSL_ERROR;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn WEBINSPECTOR_E_UNKNOWN_ERROR;\n}"
        }
      },
      {
        "call_info": {
          "callee": "property_list_service_send_binary_plist",
          "args": [
            "client->parent",
            "outplist"
          ],
          "line": 148
        },
        "resolved": true,
        "details": {
          "function_name": "property_list_service_send_binary_plist",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
          "lines": "155-158",
          "snippet": "LIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_send_binary_plist(property_list_service_client_t client, plist_t plist)\n{\n\treturn internal_plist_send(client, plist, 1);\n}",
          "includes": [
            "#include \"endianness.h\"",
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_send_binary_plist(property_list_service_client_t client, plist_t plist)\n{\n\treturn internal_plist_send(client, plist, 1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "outplist",
            "\"WIRFinalMessageKey\"",
            "plist_new_data(packet + offset, packet_length)"
          ],
          "line": 143
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_data",
          "args": [
            "packet + offset",
            "packet_length"
          ],
          "line": 143
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "outplist",
            "\"WIRPartialMessageKey\"",
            "plist_new_data(packet + offset, WEBINSPECTOR_PARTIAL_PACKET_CHUNK_SIZE)"
          ],
          "line": 138
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_data",
          "args": [
            "packet + offset",
            "WEBINSPECTOR_PARTIAL_PACKET_CHUNK_SIZE"
          ],
          "line": 138
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_dict",
          "args": [],
          "line": 135
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"Error converting plist to binary.\""
          ],
          "line": 122
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_to_bin",
          "args": [
            "plist",
            "&packet",
            "&packet_length"
          ],
          "line": 120
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_plist",
          "args": [
            "plist"
          ],
          "line": 117
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"Sending webinspector message...\""
          ],
          "line": 116
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"webinspector.h\"\n#include <plist/plist.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API webinspector_error_t webinspector_send(webinspector_client_t client, plist_t plist)\n{\n\twebinspector_error_t res = WEBINSPECTOR_E_UNKNOWN_ERROR;\n\n\tuint32_t offset = 0;\n\tint is_final_message = 0;\n\n\tchar *packet = NULL;\n\tuint32_t packet_length = 0;\n\n\tdebug_info(\"Sending webinspector message...\");\n\tdebug_plist(plist);\n\n\t/* convert plist to packet */\n\tplist_to_bin(plist, &packet, &packet_length);\n\tif (!packet || packet_length == 0) {\n\t\tdebug_info(\"Error converting plist to binary.\");\n\t\treturn res;\n\t}\n\n\tdo {\n\t\t/* determine if we need to send partial messages */\n\t\tif (packet_length < WEBINSPECTOR_PARTIAL_PACKET_CHUNK_SIZE) {\n\t\t\tis_final_message = 1;\n\t\t} else {\n\t\t\t/* send partial packet */\n\t\t\tis_final_message = 0;\n\t\t}\n\n\t\tplist_t outplist = plist_new_dict();\n\t\tif (!is_final_message) {\n\t\t\t/* split packet into partial chunks */\n\t\t\tplist_dict_set_item(outplist, \"WIRPartialMessageKey\", plist_new_data(packet + offset, WEBINSPECTOR_PARTIAL_PACKET_CHUNK_SIZE));\n\t\t\toffset += WEBINSPECTOR_PARTIAL_PACKET_CHUNK_SIZE;\n\t\t\tpacket_length -= WEBINSPECTOR_PARTIAL_PACKET_CHUNK_SIZE;\n\t\t} else {\n\t\t\t/* send final chunk */\n\t\t\tplist_dict_set_item(outplist, \"WIRFinalMessageKey\", plist_new_data(packet + offset, packet_length));\n\t\t\toffset += packet_length;\n\t\t\tpacket_length -= packet_length;\n\t\t}\n\n\t\tres = webinspector_error(property_list_service_send_binary_plist(client->parent, outplist));\n\t\tplist_free(outplist);\n\t\toutplist = NULL;\n\t\tif (res != WEBINSPECTOR_E_SUCCESS) {\n\t\t\tdebug_info(\"Sending plist failed with error %d\", res);\n\t\t\treturn res;\n\t\t}\n\t} while(packet_length > 0);\n\n\tfree(packet);\n\tpacket = NULL;\n\n\treturn res;\n}"
  },
  {
    "function_name": "webinspector_client_free",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/webinspector.c",
    "lines": "95-104",
    "snippet": "LIBIMOBILEDEVICE_API webinspector_error_t webinspector_client_free(webinspector_client_t client)\n{\n\tif (!client)\n\t\treturn WEBINSPECTOR_E_INVALID_ARG;\n\n\twebinspector_error_t err = webinspector_error(property_list_service_client_free(client->parent));\n\tfree(client);\n\n\treturn err;\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"lockdown.h\"",
      "#include \"webinspector.h\"",
      "#include <plist/plist.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "client"
          ],
          "line": 101
        },
        "resolved": true,
        "details": {
          "function_name": "webinspector_client_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/webinspector.c",
          "lines": "95-104",
          "snippet": "LIBIMOBILEDEVICE_API webinspector_error_t webinspector_client_free(webinspector_client_t client)\n{\n\tif (!client)\n\t\treturn WEBINSPECTOR_E_INVALID_ARG;\n\n\twebinspector_error_t err = webinspector_error(property_list_service_client_free(client->parent));\n\tfree(client);\n\n\treturn err;\n}",
          "note": "cyclic_reference_detected"
        }
      },
      {
        "call_info": {
          "callee": "webinspector_error",
          "args": [
            "property_list_service_client_free(client->parent)"
          ],
          "line": 100
        },
        "resolved": true,
        "details": {
          "function_name": "webinspector_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/webinspector.c",
          "lines": "42-59",
          "snippet": "static webinspector_error_t webinspector_error(property_list_service_error_t err)\n{\n\tswitch (err) {\n\t\tcase PROPERTY_LIST_SERVICE_E_SUCCESS:\n\t\t\treturn WEBINSPECTOR_E_SUCCESS;\n\t\tcase PROPERTY_LIST_SERVICE_E_INVALID_ARG:\n\t\t\treturn WEBINSPECTOR_E_INVALID_ARG;\n\t\tcase PROPERTY_LIST_SERVICE_E_PLIST_ERROR:\n\t\t\treturn WEBINSPECTOR_E_PLIST_ERROR;\n\t\tcase PROPERTY_LIST_SERVICE_E_MUX_ERROR:\n\t\t\treturn WEBINSPECTOR_E_MUX_ERROR;\n\t\tcase PROPERTY_LIST_SERVICE_E_SSL_ERROR:\n\t\t\treturn WEBINSPECTOR_E_SSL_ERROR;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn WEBINSPECTOR_E_UNKNOWN_ERROR;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"lockdown.h\"",
            "#include \"webinspector.h\"",
            "#include <plist/plist.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"webinspector.h\"\n#include <plist/plist.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic webinspector_error_t webinspector_error(property_list_service_error_t err)\n{\n\tswitch (err) {\n\t\tcase PROPERTY_LIST_SERVICE_E_SUCCESS:\n\t\t\treturn WEBINSPECTOR_E_SUCCESS;\n\t\tcase PROPERTY_LIST_SERVICE_E_INVALID_ARG:\n\t\t\treturn WEBINSPECTOR_E_INVALID_ARG;\n\t\tcase PROPERTY_LIST_SERVICE_E_PLIST_ERROR:\n\t\t\treturn WEBINSPECTOR_E_PLIST_ERROR;\n\t\tcase PROPERTY_LIST_SERVICE_E_MUX_ERROR:\n\t\t\treturn WEBINSPECTOR_E_MUX_ERROR;\n\t\tcase PROPERTY_LIST_SERVICE_E_SSL_ERROR:\n\t\t\treturn WEBINSPECTOR_E_SSL_ERROR;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn WEBINSPECTOR_E_UNKNOWN_ERROR;\n}"
        }
      },
      {
        "call_info": {
          "callee": "property_list_service_client_free",
          "args": [
            "client->parent"
          ],
          "line": 100
        },
        "resolved": true,
        "details": {
          "function_name": "property_list_service_client_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
          "lines": "77-88",
          "snippet": "LIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_client_free(property_list_service_client_t client)\n{\n\tif (!client)\n\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\n\tproperty_list_service_error_t err = service_to_property_list_service_error(service_client_free(client->parent));\n\n\tfree(client);\n\tclient = NULL;\n\n\treturn err;\n}",
          "includes": [
            "#include \"endianness.h\"",
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_client_free(property_list_service_client_t client)\n{\n\tif (!client)\n\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\n\tproperty_list_service_error_t err = service_to_property_list_service_error(service_client_free(client->parent));\n\n\tfree(client);\n\tclient = NULL;\n\n\treturn err;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"webinspector.h\"\n#include <plist/plist.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API webinspector_error_t webinspector_client_free(webinspector_client_t client)\n{\n\tif (!client)\n\t\treturn WEBINSPECTOR_E_INVALID_ARG;\n\n\twebinspector_error_t err = webinspector_error(property_list_service_client_free(client->parent));\n\tfree(client);\n\n\treturn err;\n}"
  },
  {
    "function_name": "webinspector_client_start_service",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/webinspector.c",
    "lines": "88-93",
    "snippet": "LIBIMOBILEDEVICE_API webinspector_error_t webinspector_client_start_service(idevice_t device, webinspector_client_t * client, const char* label)\n{\n\twebinspector_error_t err = WEBINSPECTOR_E_UNKNOWN_ERROR;\n\tservice_client_factory_start_service(device, WEBINSPECTOR_SERVICE_NAME, (void**)client, label, SERVICE_CONSTRUCTOR(webinspector_client_new), &err);\n\treturn err;\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"lockdown.h\"",
      "#include \"webinspector.h\"",
      "#include <plist/plist.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "service_client_factory_start_service",
          "args": [
            "device",
            "WEBINSPECTOR_SERVICE_NAME",
            "(void**)client",
            "label",
            "SERVICE_CONSTRUCTOR(webinspector_client_new)",
            "&err"
          ],
          "line": 91
        },
        "resolved": true,
        "details": {
          "function_name": "service_client_factory_start_service",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/service.c",
          "lines": "79-116",
          "snippet": "LIBIMOBILEDEVICE_API service_error_t service_client_factory_start_service(idevice_t device, const char* service_name, void **client, const char* label, int32_t (*constructor_func)(idevice_t, lockdownd_service_descriptor_t, void**), int32_t *error_code)\n{\n\t*client = NULL;\n\n\tlockdownd_client_t lckd = NULL;\n\tif (LOCKDOWN_E_SUCCESS != lockdownd_client_new_with_handshake(device, &lckd, label)) {\n\t\tdebug_info(\"Could not create a lockdown client.\");\n\t\treturn SERVICE_E_START_SERVICE_ERROR;\n\t}\n\n\tlockdownd_service_descriptor_t service = NULL;\n\tlockdownd_start_service(lckd, service_name, &service);\n\tlockdownd_client_free(lckd);\n\n\tif (!service || service->port == 0) {\n\t\tdebug_info(\"Could not start service %s!\", service_name);\n\t\treturn SERVICE_E_START_SERVICE_ERROR;\n\t}\n\n\tint32_t ec;\n\tif (constructor_func) {\n\t\tec = (int32_t)constructor_func(device, service, client);\n\t} else {\n\t\tec = service_client_new(device, service, (service_client_t*)client);\n\t}\n\tif (error_code) {\n\t\t*error_code = ec;\n\t}\n\n\tif (ec != SERVICE_E_SUCCESS) {\n\t\tdebug_info(\"Could not connect to service %s! Port: %i, error: %i\", service_name, service->port, ec);\n\t}\n\n\tlockdownd_service_descriptor_free(service);\n\tservice = NULL;\n\n\treturn (ec == SERVICE_E_SUCCESS) ? SERVICE_E_SUCCESS : SERVICE_E_START_SERVICE_ERROR;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API service_error_t service_client_factory_start_service(idevice_t device, const char* service_name, void **client, const char* label, int32_t (*constructor_func)(idevice_t, lockdownd_service_descriptor_t, void**), int32_t *error_code)\n{\n\t*client = NULL;\n\n\tlockdownd_client_t lckd = NULL;\n\tif (LOCKDOWN_E_SUCCESS != lockdownd_client_new_with_handshake(device, &lckd, label)) {\n\t\tdebug_info(\"Could not create a lockdown client.\");\n\t\treturn SERVICE_E_START_SERVICE_ERROR;\n\t}\n\n\tlockdownd_service_descriptor_t service = NULL;\n\tlockdownd_start_service(lckd, service_name, &service);\n\tlockdownd_client_free(lckd);\n\n\tif (!service || service->port == 0) {\n\t\tdebug_info(\"Could not start service %s!\", service_name);\n\t\treturn SERVICE_E_START_SERVICE_ERROR;\n\t}\n\n\tint32_t ec;\n\tif (constructor_func) {\n\t\tec = (int32_t)constructor_func(device, service, client);\n\t} else {\n\t\tec = service_client_new(device, service, (service_client_t*)client);\n\t}\n\tif (error_code) {\n\t\t*error_code = ec;\n\t}\n\n\tif (ec != SERVICE_E_SUCCESS) {\n\t\tdebug_info(\"Could not connect to service %s! Port: %i, error: %i\", service_name, service->port, ec);\n\t}\n\n\tlockdownd_service_descriptor_free(service);\n\tservice = NULL;\n\n\treturn (ec == SERVICE_E_SUCCESS) ? SERVICE_E_SUCCESS : SERVICE_E_START_SERVICE_ERROR;\n}"
        }
      },
      {
        "call_info": {
          "callee": "SERVICE_CONSTRUCTOR",
          "args": [
            "webinspector_client_new"
          ],
          "line": 91
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"webinspector.h\"\n#include <plist/plist.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API webinspector_error_t webinspector_client_start_service(idevice_t device, webinspector_client_t * client, const char* label)\n{\n\twebinspector_error_t err = WEBINSPECTOR_E_UNKNOWN_ERROR;\n\tservice_client_factory_start_service(device, WEBINSPECTOR_SERVICE_NAME, (void**)client, label, SERVICE_CONSTRUCTOR(webinspector_client_new), &err);\n\treturn err;\n}"
  },
  {
    "function_name": "webinspector_client_new",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/webinspector.c",
    "lines": "61-86",
    "snippet": "LIBIMOBILEDEVICE_API webinspector_error_t webinspector_client_new(idevice_t device, lockdownd_service_descriptor_t service, webinspector_client_t * client)\n{\n\t*client = NULL;\n\n\tif (!device || !service || service->port == 0 || !client || *client) {\n\t\tdebug_info(\"Incorrect parameter passed to webinspector_client_new.\");\n\t\treturn WEBINSPECTOR_E_INVALID_ARG;\n\t}\n\n\tdebug_info(\"Creating webinspector_client, port = %d.\", service->port);\n\n\tproperty_list_service_client_t plclient = NULL;\n\twebinspector_error_t ret = webinspector_error(property_list_service_client_new(device, service, &plclient));\n\tif (ret != WEBINSPECTOR_E_SUCCESS) {\n\t\tdebug_info(\"Creating a property list client failed. Error: %i\", ret);\n\t\treturn ret;\n\t}\n\n\twebinspector_client_t client_loc = (webinspector_client_t) malloc(sizeof(struct webinspector_client_private));\n\tclient_loc->parent = plclient;\n\n\t*client = client_loc;\n\n\tdebug_info(\"webinspector_client successfully created.\");\n\treturn 0;\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"lockdown.h\"",
      "#include \"webinspector.h\"",
      "#include <plist/plist.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"webinspector_client successfully created.\""
          ],
          "line": 84
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "malloc",
          "args": [
            "sizeof(struct webinspector_client_private)"
          ],
          "line": 79
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"Creating a property list client failed. Error: %i\"",
            "ret"
          ],
          "line": 75
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "webinspector_error",
          "args": [
            "property_list_service_client_new(device, service, &plclient)"
          ],
          "line": 73
        },
        "resolved": true,
        "details": {
          "function_name": "webinspector_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/webinspector.c",
          "lines": "42-59",
          "snippet": "static webinspector_error_t webinspector_error(property_list_service_error_t err)\n{\n\tswitch (err) {\n\t\tcase PROPERTY_LIST_SERVICE_E_SUCCESS:\n\t\t\treturn WEBINSPECTOR_E_SUCCESS;\n\t\tcase PROPERTY_LIST_SERVICE_E_INVALID_ARG:\n\t\t\treturn WEBINSPECTOR_E_INVALID_ARG;\n\t\tcase PROPERTY_LIST_SERVICE_E_PLIST_ERROR:\n\t\t\treturn WEBINSPECTOR_E_PLIST_ERROR;\n\t\tcase PROPERTY_LIST_SERVICE_E_MUX_ERROR:\n\t\t\treturn WEBINSPECTOR_E_MUX_ERROR;\n\t\tcase PROPERTY_LIST_SERVICE_E_SSL_ERROR:\n\t\t\treturn WEBINSPECTOR_E_SSL_ERROR;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn WEBINSPECTOR_E_UNKNOWN_ERROR;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"lockdown.h\"",
            "#include \"webinspector.h\"",
            "#include <plist/plist.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"webinspector.h\"\n#include <plist/plist.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic webinspector_error_t webinspector_error(property_list_service_error_t err)\n{\n\tswitch (err) {\n\t\tcase PROPERTY_LIST_SERVICE_E_SUCCESS:\n\t\t\treturn WEBINSPECTOR_E_SUCCESS;\n\t\tcase PROPERTY_LIST_SERVICE_E_INVALID_ARG:\n\t\t\treturn WEBINSPECTOR_E_INVALID_ARG;\n\t\tcase PROPERTY_LIST_SERVICE_E_PLIST_ERROR:\n\t\t\treturn WEBINSPECTOR_E_PLIST_ERROR;\n\t\tcase PROPERTY_LIST_SERVICE_E_MUX_ERROR:\n\t\t\treturn WEBINSPECTOR_E_MUX_ERROR;\n\t\tcase PROPERTY_LIST_SERVICE_E_SSL_ERROR:\n\t\t\treturn WEBINSPECTOR_E_SSL_ERROR;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn WEBINSPECTOR_E_UNKNOWN_ERROR;\n}"
        }
      },
      {
        "call_info": {
          "callee": "property_list_service_client_new",
          "args": [
            "device",
            "service",
            "&plclient"
          ],
          "line": 73
        },
        "resolved": true,
        "details": {
          "function_name": "property_list_service_client_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
          "lines": "57-75",
          "snippet": "LIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_client_new(idevice_t device, lockdownd_service_descriptor_t service, property_list_service_client_t *client)\n{\n\tif (!device || !service || service->port == 0 || !client || *client)\n\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\n\tservice_client_t parent = NULL;\n\tservice_error_t rerr = service_client_new(device, service, &parent);\n\tif (rerr != SERVICE_E_SUCCESS) {\n\t\treturn service_to_property_list_service_error(rerr);\n\t}\n\n\t/* create client object */\n\tproperty_list_service_client_t client_loc = (property_list_service_client_t)malloc(sizeof(struct property_list_service_client_private));\n\tclient_loc->parent = parent;\n\n\t/* all done, return success */\n\t*client = client_loc;\n\treturn PROPERTY_LIST_SERVICE_E_SUCCESS;\n}",
          "includes": [
            "#include \"endianness.h\"",
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_client_new(idevice_t device, lockdownd_service_descriptor_t service, property_list_service_client_t *client)\n{\n\tif (!device || !service || service->port == 0 || !client || *client)\n\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\n\tservice_client_t parent = NULL;\n\tservice_error_t rerr = service_client_new(device, service, &parent);\n\tif (rerr != SERVICE_E_SUCCESS) {\n\t\treturn service_to_property_list_service_error(rerr);\n\t}\n\n\t/* create client object */\n\tproperty_list_service_client_t client_loc = (property_list_service_client_t)malloc(sizeof(struct property_list_service_client_private));\n\tclient_loc->parent = parent;\n\n\t/* all done, return success */\n\t*client = client_loc;\n\treturn PROPERTY_LIST_SERVICE_E_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"Creating webinspector_client, port = %d.\"",
            "service->port"
          ],
          "line": 70
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"Incorrect parameter passed to webinspector_client_new.\""
          ],
          "line": 66
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"webinspector.h\"\n#include <plist/plist.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API webinspector_error_t webinspector_client_new(idevice_t device, lockdownd_service_descriptor_t service, webinspector_client_t * client)\n{\n\t*client = NULL;\n\n\tif (!device || !service || service->port == 0 || !client || *client) {\n\t\tdebug_info(\"Incorrect parameter passed to webinspector_client_new.\");\n\t\treturn WEBINSPECTOR_E_INVALID_ARG;\n\t}\n\n\tdebug_info(\"Creating webinspector_client, port = %d.\", service->port);\n\n\tproperty_list_service_client_t plclient = NULL;\n\twebinspector_error_t ret = webinspector_error(property_list_service_client_new(device, service, &plclient));\n\tif (ret != WEBINSPECTOR_E_SUCCESS) {\n\t\tdebug_info(\"Creating a property list client failed. Error: %i\", ret);\n\t\treturn ret;\n\t}\n\n\twebinspector_client_t client_loc = (webinspector_client_t) malloc(sizeof(struct webinspector_client_private));\n\tclient_loc->parent = plclient;\n\n\t*client = client_loc;\n\n\tdebug_info(\"webinspector_client successfully created.\");\n\treturn 0;\n}"
  },
  {
    "function_name": "webinspector_error",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/webinspector.c",
    "lines": "42-59",
    "snippet": "static webinspector_error_t webinspector_error(property_list_service_error_t err)\n{\n\tswitch (err) {\n\t\tcase PROPERTY_LIST_SERVICE_E_SUCCESS:\n\t\t\treturn WEBINSPECTOR_E_SUCCESS;\n\t\tcase PROPERTY_LIST_SERVICE_E_INVALID_ARG:\n\t\t\treturn WEBINSPECTOR_E_INVALID_ARG;\n\t\tcase PROPERTY_LIST_SERVICE_E_PLIST_ERROR:\n\t\t\treturn WEBINSPECTOR_E_PLIST_ERROR;\n\t\tcase PROPERTY_LIST_SERVICE_E_MUX_ERROR:\n\t\t\treturn WEBINSPECTOR_E_MUX_ERROR;\n\t\tcase PROPERTY_LIST_SERVICE_E_SSL_ERROR:\n\t\t\treturn WEBINSPECTOR_E_SSL_ERROR;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn WEBINSPECTOR_E_UNKNOWN_ERROR;\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"lockdown.h\"",
      "#include \"webinspector.h\"",
      "#include <plist/plist.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"webinspector.h\"\n#include <plist/plist.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic webinspector_error_t webinspector_error(property_list_service_error_t err)\n{\n\tswitch (err) {\n\t\tcase PROPERTY_LIST_SERVICE_E_SUCCESS:\n\t\t\treturn WEBINSPECTOR_E_SUCCESS;\n\t\tcase PROPERTY_LIST_SERVICE_E_INVALID_ARG:\n\t\t\treturn WEBINSPECTOR_E_INVALID_ARG;\n\t\tcase PROPERTY_LIST_SERVICE_E_PLIST_ERROR:\n\t\t\treturn WEBINSPECTOR_E_PLIST_ERROR;\n\t\tcase PROPERTY_LIST_SERVICE_E_MUX_ERROR:\n\t\t\treturn WEBINSPECTOR_E_MUX_ERROR;\n\t\tcase PROPERTY_LIST_SERVICE_E_SSL_ERROR:\n\t\t\treturn WEBINSPECTOR_E_SSL_ERROR;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn WEBINSPECTOR_E_UNKNOWN_ERROR;\n}"
  }
]