[
  {
    "function_name": "np_set_notify_callback",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/notification_proxy.c",
    "lines": "339-374",
    "snippet": "LIBIMOBILEDEVICE_API np_error_t np_set_notify_callback( np_client_t client, np_notify_cb_t notify_cb, void *user_data )\n{\n\tif (!client)\n\t\treturn NP_E_INVALID_ARG;\n\n\tnp_error_t res = NP_E_UNKNOWN_ERROR;\n\n\tnp_lock(client);\n\tif (client->notifier) {\n\t\tdebug_info(\"callback already set, removing\");\n\t\tproperty_list_service_client_t parent = client->parent;\n\t\tclient->parent = NULL;\n\t\tthread_join(client->notifier);\n\t\tthread_free(client->notifier);\n\t\tclient->notifier = (thread_t)NULL;\n\t\tclient->parent = parent;\n\t}\n\n\tif (notify_cb) {\n\t\tstruct np_thread *npt = (struct np_thread*)malloc(sizeof(struct np_thread));\n\t\tif (npt) {\n\t\t\tnpt->client = client;\n\t\t\tnpt->cbfunc = notify_cb;\n\t\t\tnpt->user_data = user_data;\n\n\t\t\tif (thread_new(&client->notifier, np_notifier, npt) == 0) {\n\t\t\t\tres = NP_E_SUCCESS;\n\t\t\t}\n\t\t}\n\t} else {\n\t\tdebug_info(\"no callback set\");\n\t}\n\tnp_unlock(client);\n\n\treturn res;\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"property_list_service.h\"",
      "#include \"notification_proxy.h\"",
      "#include <plist/plist.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <string.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "np_unlock",
          "args": [
            "client"
          ],
          "line": 371
        },
        "resolved": true,
        "details": {
          "function_name": "np_unlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/notification_proxy.c",
          "lines": "57-61",
          "snippet": "static void np_unlock(np_client_t client)\n{\n\tdebug_info(\"Unlocked\");\n\tmutex_unlock(&client->mutex);\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include \"notification_proxy.h\"",
            "#include <plist/plist.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <string.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"notification_proxy.h\"\n#include <plist/plist.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <string.h>\n\nstatic void np_unlock(np_client_t client)\n{\n\tdebug_info(\"Unlocked\");\n\tmutex_unlock(&client->mutex);\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"no callback set\""
          ],
          "line": 369
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "thread_new",
          "args": [
            "&client->notifier",
            "np_notifier",
            "npt"
          ],
          "line": 364
        },
        "resolved": true,
        "details": {
          "function_name": "thread_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/common/thread.c",
          "lines": "24-37",
          "snippet": "int thread_new(thread_t *thread, thread_func_t thread_func, void* data)\n{\n#ifdef WIN32\n\tHANDLE th = CreateThread(NULL, 0, (LPTHREAD_START_ROUTINE)thread_func, data, 0, NULL);\n\tif (th == NULL) {\n\t\treturn -1;\n\t}\n\t*thread = th;\n\treturn 0;\n#else\n\tint res = pthread_create(thread, NULL, thread_func, data);\n\treturn res;\n#endif\n}",
          "includes": [
            "#include \"thread.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"thread.h\"\n\nint thread_new(thread_t *thread, thread_func_t thread_func, void* data)\n{\n#ifdef WIN32\n\tHANDLE th = CreateThread(NULL, 0, (LPTHREAD_START_ROUTINE)thread_func, data, 0, NULL);\n\tif (th == NULL) {\n\t\treturn -1;\n\t}\n\t*thread = th;\n\treturn 0;\n#else\n\tint res = pthread_create(thread, NULL, thread_func, data);\n\treturn res;\n#endif\n}"
        }
      },
      {
        "call_info": {
          "callee": "malloc",
          "args": [
            "sizeof(struct np_thread)"
          ],
          "line": 358
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "thread_free",
          "args": [
            "client->notifier"
          ],
          "line": 352
        },
        "resolved": true,
        "details": {
          "function_name": "thread_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/common/thread.c",
          "lines": "39-44",
          "snippet": "void thread_free(thread_t thread)\n{\n#ifdef WIN32\n\tCloseHandle(thread);\n#endif\n}",
          "includes": [
            "#include \"thread.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"thread.h\"\n\nvoid thread_free(thread_t thread)\n{\n#ifdef WIN32\n\tCloseHandle(thread);\n#endif\n}"
        }
      },
      {
        "call_info": {
          "callee": "thread_join",
          "args": [
            "client->notifier"
          ],
          "line": 351
        },
        "resolved": true,
        "details": {
          "function_name": "thread_join",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/common/thread.c",
          "lines": "46-54",
          "snippet": "void thread_join(thread_t thread)\n{\n\t/* wait for thread to complete */\n#ifdef WIN32\n\tWaitForSingleObject(thread, INFINITE);\n#else\n\tpthread_join(thread, NULL);\n#endif\n}",
          "includes": [
            "#include \"thread.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"thread.h\"\n\nvoid thread_join(thread_t thread)\n{\n\t/* wait for thread to complete */\n#ifdef WIN32\n\tWaitForSingleObject(thread, INFINITE);\n#else\n\tpthread_join(thread, NULL);\n#endif\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"callback already set, removing\""
          ],
          "line": 348
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "np_lock",
          "args": [
            "client"
          ],
          "line": 346
        },
        "resolved": true,
        "details": {
          "function_name": "np_lock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/notification_proxy.c",
          "lines": "46-50",
          "snippet": "static void np_lock(np_client_t client)\n{\n\tdebug_info(\"Locked\");\n\tmutex_lock(&client->mutex);\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include \"notification_proxy.h\"",
            "#include <plist/plist.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <string.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"notification_proxy.h\"\n#include <plist/plist.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <string.h>\n\nstatic void np_lock(np_client_t client)\n{\n\tdebug_info(\"Locked\");\n\tmutex_lock(&client->mutex);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"notification_proxy.h\"\n#include <plist/plist.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <string.h>\n\nLIBIMOBILEDEVICE_API np_error_t np_set_notify_callback( np_client_t client, np_notify_cb_t notify_cb, void *user_data )\n{\n\tif (!client)\n\t\treturn NP_E_INVALID_ARG;\n\n\tnp_error_t res = NP_E_UNKNOWN_ERROR;\n\n\tnp_lock(client);\n\tif (client->notifier) {\n\t\tdebug_info(\"callback already set, removing\");\n\t\tproperty_list_service_client_t parent = client->parent;\n\t\tclient->parent = NULL;\n\t\tthread_join(client->notifier);\n\t\tthread_free(client->notifier);\n\t\tclient->notifier = (thread_t)NULL;\n\t\tclient->parent = parent;\n\t}\n\n\tif (notify_cb) {\n\t\tstruct np_thread *npt = (struct np_thread*)malloc(sizeof(struct np_thread));\n\t\tif (npt) {\n\t\t\tnpt->client = client;\n\t\t\tnpt->cbfunc = notify_cb;\n\t\t\tnpt->user_data = user_data;\n\n\t\t\tif (thread_new(&client->notifier, np_notifier, npt) == 0) {\n\t\t\t\tres = NP_E_SUCCESS;\n\t\t\t}\n\t\t}\n\t} else {\n\t\tdebug_info(\"no callback set\");\n\t}\n\tnp_unlock(client);\n\n\treturn res;\n}"
  },
  {
    "function_name": "np_notifier",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/notification_proxy.c",
    "lines": "312-337",
    "snippet": "void* np_notifier( void* arg )\n{\n\tchar *notification = NULL;\n\tstruct np_thread *npt = (struct np_thread*)arg;\n\n\tif (!npt) return NULL;\n\n\tdebug_info(\"starting callback.\");\n\twhile (npt->client->parent) {\n\t\tif (np_get_notification(npt->client, &notification) < 0) {\n\t\t\tnpt->cbfunc(\"\", npt->user_data);\n\t\t\tbreak;\n\t\t}\n\t\tif (notification) {\n\t\t\tnpt->cbfunc(notification, npt->user_data);\n\t\t\tfree(notification);\n\t\t\tnotification = NULL;\n\t\t}\n\t\tsleep(1);\n\t}\n\tif (npt) {\n\t\tfree(npt);\n\t}\n\n\treturn NULL;\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"property_list_service.h\"",
      "#include \"notification_proxy.h\"",
      "#include <plist/plist.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <string.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "npt"
          ],
          "line": 333
        },
        "resolved": true,
        "details": {
          "function_name": "np_client_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/notification_proxy.c",
          "lines": "114-166",
          "snippet": "LIBIMOBILEDEVICE_API np_error_t np_client_free(np_client_t client)\n{\n\tplist_t dict;\n\tproperty_list_service_client_t parent;\n\n\tif (!client)\n\t\treturn NP_E_INVALID_ARG;\n\n\tdict = plist_new_dict();\n\tplist_dict_set_item(dict,\"Command\", plist_new_string(\"Shutdown\"));\n\tproperty_list_service_send_xml_plist(client->parent, dict);\n\tplist_free(dict);\n\n\tparent = client->parent;\n\t/* notifies the client->notifier thread that it should terminate */\n\tclient->parent = NULL;\n\n\tif (client->notifier) {\n\t\tdebug_info(\"joining np callback\");\n\t\tthread_join(client->notifier);\n\t\tthread_free(client->notifier);\n\t\tclient->notifier = (thread_t)NULL;\n\t} else {\n\t\tdict = NULL;\n\t\tproperty_list_service_receive_plist(parent, &dict);\n\t\tif (dict) {\n#ifndef STRIP_DEBUG_CODE\n\t\t\tchar *cmd_value = NULL;\n\t\t\tplist_t cmd_value_node = plist_dict_get_item(dict, \"Command\");\n\t\t\tif (plist_get_node_type(cmd_value_node) == PLIST_STRING) {\n\t\t\t\tplist_get_string_val(cmd_value_node, &cmd_value);\n\t\t\t}\n\t\t\tif (cmd_value && !strcmp(cmd_value, \"ProxyDeath\")) {\n\t\t\t\t// this is the expected answer\n\t\t\t} else {\n\t\t\t\tdebug_info(\"Did not get ProxyDeath but:\");\n\t\t\t\tdebug_plist(dict);\n\t\t\t}\n\t\t\tif (cmd_value) {\n\t\t\t\tfree(cmd_value);\n\t\t\t}\n#endif\n\t\t\tplist_free(dict);\n\t\t}\n\t}\n\n\tproperty_list_service_client_free(parent);\n\n\tmutex_destroy(&client->mutex);\n\tfree(client);\n\n\treturn NP_E_SUCCESS;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include \"notification_proxy.h\"",
            "#include <plist/plist.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <string.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"notification_proxy.h\"\n#include <plist/plist.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <string.h>\n\nLIBIMOBILEDEVICE_API np_error_t np_client_free(np_client_t client)\n{\n\tplist_t dict;\n\tproperty_list_service_client_t parent;\n\n\tif (!client)\n\t\treturn NP_E_INVALID_ARG;\n\n\tdict = plist_new_dict();\n\tplist_dict_set_item(dict,\"Command\", plist_new_string(\"Shutdown\"));\n\tproperty_list_service_send_xml_plist(client->parent, dict);\n\tplist_free(dict);\n\n\tparent = client->parent;\n\t/* notifies the client->notifier thread that it should terminate */\n\tclient->parent = NULL;\n\n\tif (client->notifier) {\n\t\tdebug_info(\"joining np callback\");\n\t\tthread_join(client->notifier);\n\t\tthread_free(client->notifier);\n\t\tclient->notifier = (thread_t)NULL;\n\t} else {\n\t\tdict = NULL;\n\t\tproperty_list_service_receive_plist(parent, &dict);\n\t\tif (dict) {\n#ifndef STRIP_DEBUG_CODE\n\t\t\tchar *cmd_value = NULL;\n\t\t\tplist_t cmd_value_node = plist_dict_get_item(dict, \"Command\");\n\t\t\tif (plist_get_node_type(cmd_value_node) == PLIST_STRING) {\n\t\t\t\tplist_get_string_val(cmd_value_node, &cmd_value);\n\t\t\t}\n\t\t\tif (cmd_value && !strcmp(cmd_value, \"ProxyDeath\")) {\n\t\t\t\t// this is the expected answer\n\t\t\t} else {\n\t\t\t\tdebug_info(\"Did not get ProxyDeath but:\");\n\t\t\t\tdebug_plist(dict);\n\t\t\t}\n\t\t\tif (cmd_value) {\n\t\t\t\tfree(cmd_value);\n\t\t\t}\n#endif\n\t\t\tplist_free(dict);\n\t\t}\n\t}\n\n\tproperty_list_service_client_free(parent);\n\n\tmutex_destroy(&client->mutex);\n\tfree(client);\n\n\treturn NP_E_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sleep",
          "args": [
            "1"
          ],
          "line": 330
        },
        "resolved": true,
        "details": {
          "function_name": "diagnostics_relay_sleep",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/diagnostics_relay.c",
          "lines": "199-229",
          "snippet": "LIBIMOBILEDEVICE_API diagnostics_relay_error_t diagnostics_relay_sleep(diagnostics_relay_client_t client)\n{\n\tif (!client)\n\t\treturn DIAGNOSTICS_RELAY_E_INVALID_ARG;\n\n\tdiagnostics_relay_error_t ret = DIAGNOSTICS_RELAY_E_UNKNOWN_ERROR;\n\n\tplist_t dict = plist_new_dict();\n\n\tplist_dict_set_item(dict,\"Request\", plist_new_string(\"Sleep\"));\n\tret = diagnostics_relay_send(client, dict);\n\tplist_free(dict);\n\tdict = NULL;\n\n\tret = diagnostics_relay_receive(client, &dict);\n\tif (!dict) {\n\t\treturn DIAGNOSTICS_RELAY_E_PLIST_ERROR;\n\t}\n\n\tint check = diagnostics_relay_check_result(dict);\n\tif (check == RESULT_SUCCESS) {\n\t\tret = DIAGNOSTICS_RELAY_E_SUCCESS;\n\t} else if (check == RESULT_UNKNOWN_REQUEST) {\n\t\tret = DIAGNOSTICS_RELAY_E_UNKNOWN_REQUEST;\n\t} else {\n\t\tret = DIAGNOSTICS_RELAY_E_UNKNOWN_ERROR;\n\t}\n\n\tplist_free(dict);\n\treturn ret;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include \"diagnostics_relay.h\"",
            "#include <stdlib.h>",
            "#include <string.h>"
          ],
          "macros_used": [
            "#define RESULT_UNKNOWN_REQUEST 2",
            "#define RESULT_SUCCESS 0"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"diagnostics_relay.h\"\n#include <stdlib.h>\n#include <string.h>\n\n#define RESULT_UNKNOWN_REQUEST 2\n#define RESULT_SUCCESS 0\n\nLIBIMOBILEDEVICE_API diagnostics_relay_error_t diagnostics_relay_sleep(diagnostics_relay_client_t client)\n{\n\tif (!client)\n\t\treturn DIAGNOSTICS_RELAY_E_INVALID_ARG;\n\n\tdiagnostics_relay_error_t ret = DIAGNOSTICS_RELAY_E_UNKNOWN_ERROR;\n\n\tplist_t dict = plist_new_dict();\n\n\tplist_dict_set_item(dict,\"Request\", plist_new_string(\"Sleep\"));\n\tret = diagnostics_relay_send(client, dict);\n\tplist_free(dict);\n\tdict = NULL;\n\n\tret = diagnostics_relay_receive(client, &dict);\n\tif (!dict) {\n\t\treturn DIAGNOSTICS_RELAY_E_PLIST_ERROR;\n\t}\n\n\tint check = diagnostics_relay_check_result(dict);\n\tif (check == RESULT_SUCCESS) {\n\t\tret = DIAGNOSTICS_RELAY_E_SUCCESS;\n\t} else if (check == RESULT_UNKNOWN_REQUEST) {\n\t\tret = DIAGNOSTICS_RELAY_E_UNKNOWN_REQUEST;\n\t} else {\n\t\tret = DIAGNOSTICS_RELAY_E_UNKNOWN_ERROR;\n\t}\n\n\tplist_free(dict);\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "npt->cbfunc",
          "args": [
            "notification",
            "npt->user_data"
          ],
          "line": 326
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "npt->cbfunc",
          "args": [
            "\"\"",
            "npt->user_data"
          ],
          "line": 322
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "np_get_notification",
          "args": [
            "npt->client",
            "&notification"
          ],
          "line": 321
        },
        "resolved": true,
        "details": {
          "function_name": "np_get_notification",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/notification_proxy.c",
          "lines": "248-307",
          "snippet": "static int np_get_notification(np_client_t client, char **notification)\n{\n\tint res = 0;\n\tplist_t dict = NULL;\n\n\tif (!client || !client->parent || *notification)\n\t\treturn -1;\n\n\tnp_lock(client);\n\n\tproperty_list_service_error_t perr = property_list_service_receive_plist_with_timeout(client->parent, &dict, 500);\n\tif (perr == PROPERTY_LIST_SERVICE_E_RECEIVE_TIMEOUT) {\n\t\tdebug_info(\"NotificationProxy: no notification received!\");\n\t\tres = 0;\n\t} else if (perr != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tdebug_info(\"NotificationProxy: error %d occured!\", perr);\n\t\tres = perr;\n\t}\n\tif (dict) {\n\t\tchar *cmd_value = NULL;\n\t\tplist_t cmd_value_node = plist_dict_get_item(dict, \"Command\");\n\n\t\tif (plist_get_node_type(cmd_value_node) == PLIST_STRING) {\n\t\t\tplist_get_string_val(cmd_value_node, &cmd_value);\n\t\t}\n\n\t\tif (cmd_value && !strcmp(cmd_value, \"RelayNotification\")) {\n\t\t\tchar *name_value = NULL;\n\t\t\tplist_t name_value_node = plist_dict_get_item(dict, \"Name\");\n\n\t\t\tif (plist_get_node_type(name_value_node) == PLIST_STRING) {\n\t\t\t\tplist_get_string_val(name_value_node, &name_value);\n\t\t\t}\n\n\t\t\tres = -2;\n\t\t\tif (name_value_node && name_value) {\n\t\t\t\t*notification = name_value;\n\t\t\t\tdebug_info(\"got notification %s\", __func__, name_value);\n\t\t\t\tres = 0;\n\t\t\t}\n\t\t} else if (cmd_value && !strcmp(cmd_value, \"ProxyDeath\")) {\n\t\t\tdebug_info(\"NotificationProxy died!\");\n\t\t\tres = -1;\n\t\t} else if (cmd_value) {\n\t\t\tdebug_info(\"unknown NotificationProxy command '%s' received!\", cmd_value);\n\t\t\tres = -1;\n\t\t} else {\n\t\t\tres = -2;\n\t\t}\n\t\tif (cmd_value) {\n\t\t\tfree(cmd_value);\n\t\t}\n\t\tplist_free(dict);\n\t\tdict = NULL;\n\t}\n\n\tnp_unlock(client);\n\n\treturn res;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include \"notification_proxy.h\"",
            "#include <plist/plist.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <string.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"notification_proxy.h\"\n#include <plist/plist.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <string.h>\n\nstatic int np_get_notification(np_client_t client, char **notification)\n{\n\tint res = 0;\n\tplist_t dict = NULL;\n\n\tif (!client || !client->parent || *notification)\n\t\treturn -1;\n\n\tnp_lock(client);\n\n\tproperty_list_service_error_t perr = property_list_service_receive_plist_with_timeout(client->parent, &dict, 500);\n\tif (perr == PROPERTY_LIST_SERVICE_E_RECEIVE_TIMEOUT) {\n\t\tdebug_info(\"NotificationProxy: no notification received!\");\n\t\tres = 0;\n\t} else if (perr != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tdebug_info(\"NotificationProxy: error %d occured!\", perr);\n\t\tres = perr;\n\t}\n\tif (dict) {\n\t\tchar *cmd_value = NULL;\n\t\tplist_t cmd_value_node = plist_dict_get_item(dict, \"Command\");\n\n\t\tif (plist_get_node_type(cmd_value_node) == PLIST_STRING) {\n\t\t\tplist_get_string_val(cmd_value_node, &cmd_value);\n\t\t}\n\n\t\tif (cmd_value && !strcmp(cmd_value, \"RelayNotification\")) {\n\t\t\tchar *name_value = NULL;\n\t\t\tplist_t name_value_node = plist_dict_get_item(dict, \"Name\");\n\n\t\t\tif (plist_get_node_type(name_value_node) == PLIST_STRING) {\n\t\t\t\tplist_get_string_val(name_value_node, &name_value);\n\t\t\t}\n\n\t\t\tres = -2;\n\t\t\tif (name_value_node && name_value) {\n\t\t\t\t*notification = name_value;\n\t\t\t\tdebug_info(\"got notification %s\", __func__, name_value);\n\t\t\t\tres = 0;\n\t\t\t}\n\t\t} else if (cmd_value && !strcmp(cmd_value, \"ProxyDeath\")) {\n\t\t\tdebug_info(\"NotificationProxy died!\");\n\t\t\tres = -1;\n\t\t} else if (cmd_value) {\n\t\t\tdebug_info(\"unknown NotificationProxy command '%s' received!\", cmd_value);\n\t\t\tres = -1;\n\t\t} else {\n\t\t\tres = -2;\n\t\t}\n\t\tif (cmd_value) {\n\t\t\tfree(cmd_value);\n\t\t}\n\t\tplist_free(dict);\n\t\tdict = NULL;\n\t}\n\n\tnp_unlock(client);\n\n\treturn res;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"starting callback.\""
          ],
          "line": 319
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"notification_proxy.h\"\n#include <plist/plist.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <string.h>\n\nvoid* np_notifier( void* arg )\n{\n\tchar *notification = NULL;\n\tstruct np_thread *npt = (struct np_thread*)arg;\n\n\tif (!npt) return NULL;\n\n\tdebug_info(\"starting callback.\");\n\twhile (npt->client->parent) {\n\t\tif (np_get_notification(npt->client, &notification) < 0) {\n\t\t\tnpt->cbfunc(\"\", npt->user_data);\n\t\t\tbreak;\n\t\t}\n\t\tif (notification) {\n\t\t\tnpt->cbfunc(notification, npt->user_data);\n\t\t\tfree(notification);\n\t\t\tnotification = NULL;\n\t\t}\n\t\tsleep(1);\n\t}\n\tif (npt) {\n\t\tfree(npt);\n\t}\n\n\treturn NULL;\n}"
  },
  {
    "function_name": "np_get_notification",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/notification_proxy.c",
    "lines": "248-307",
    "snippet": "static int np_get_notification(np_client_t client, char **notification)\n{\n\tint res = 0;\n\tplist_t dict = NULL;\n\n\tif (!client || !client->parent || *notification)\n\t\treturn -1;\n\n\tnp_lock(client);\n\n\tproperty_list_service_error_t perr = property_list_service_receive_plist_with_timeout(client->parent, &dict, 500);\n\tif (perr == PROPERTY_LIST_SERVICE_E_RECEIVE_TIMEOUT) {\n\t\tdebug_info(\"NotificationProxy: no notification received!\");\n\t\tres = 0;\n\t} else if (perr != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tdebug_info(\"NotificationProxy: error %d occured!\", perr);\n\t\tres = perr;\n\t}\n\tif (dict) {\n\t\tchar *cmd_value = NULL;\n\t\tplist_t cmd_value_node = plist_dict_get_item(dict, \"Command\");\n\n\t\tif (plist_get_node_type(cmd_value_node) == PLIST_STRING) {\n\t\t\tplist_get_string_val(cmd_value_node, &cmd_value);\n\t\t}\n\n\t\tif (cmd_value && !strcmp(cmd_value, \"RelayNotification\")) {\n\t\t\tchar *name_value = NULL;\n\t\t\tplist_t name_value_node = plist_dict_get_item(dict, \"Name\");\n\n\t\t\tif (plist_get_node_type(name_value_node) == PLIST_STRING) {\n\t\t\t\tplist_get_string_val(name_value_node, &name_value);\n\t\t\t}\n\n\t\t\tres = -2;\n\t\t\tif (name_value_node && name_value) {\n\t\t\t\t*notification = name_value;\n\t\t\t\tdebug_info(\"got notification %s\", __func__, name_value);\n\t\t\t\tres = 0;\n\t\t\t}\n\t\t} else if (cmd_value && !strcmp(cmd_value, \"ProxyDeath\")) {\n\t\t\tdebug_info(\"NotificationProxy died!\");\n\t\t\tres = -1;\n\t\t} else if (cmd_value) {\n\t\t\tdebug_info(\"unknown NotificationProxy command '%s' received!\", cmd_value);\n\t\t\tres = -1;\n\t\t} else {\n\t\t\tres = -2;\n\t\t}\n\t\tif (cmd_value) {\n\t\t\tfree(cmd_value);\n\t\t}\n\t\tplist_free(dict);\n\t\tdict = NULL;\n\t}\n\n\tnp_unlock(client);\n\n\treturn res;\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"property_list_service.h\"",
      "#include \"notification_proxy.h\"",
      "#include <plist/plist.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <string.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "np_unlock",
          "args": [
            "client"
          ],
          "line": 304
        },
        "resolved": true,
        "details": {
          "function_name": "np_unlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/notification_proxy.c",
          "lines": "57-61",
          "snippet": "static void np_unlock(np_client_t client)\n{\n\tdebug_info(\"Unlocked\");\n\tmutex_unlock(&client->mutex);\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include \"notification_proxy.h\"",
            "#include <plist/plist.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <string.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"notification_proxy.h\"\n#include <plist/plist.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <string.h>\n\nstatic void np_unlock(np_client_t client)\n{\n\tdebug_info(\"Unlocked\");\n\tmutex_unlock(&client->mutex);\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "dict"
          ],
          "line": 300
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "cmd_value"
          ],
          "line": 298
        },
        "resolved": true,
        "details": {
          "function_name": "np_client_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/notification_proxy.c",
          "lines": "114-166",
          "snippet": "LIBIMOBILEDEVICE_API np_error_t np_client_free(np_client_t client)\n{\n\tplist_t dict;\n\tproperty_list_service_client_t parent;\n\n\tif (!client)\n\t\treturn NP_E_INVALID_ARG;\n\n\tdict = plist_new_dict();\n\tplist_dict_set_item(dict,\"Command\", plist_new_string(\"Shutdown\"));\n\tproperty_list_service_send_xml_plist(client->parent, dict);\n\tplist_free(dict);\n\n\tparent = client->parent;\n\t/* notifies the client->notifier thread that it should terminate */\n\tclient->parent = NULL;\n\n\tif (client->notifier) {\n\t\tdebug_info(\"joining np callback\");\n\t\tthread_join(client->notifier);\n\t\tthread_free(client->notifier);\n\t\tclient->notifier = (thread_t)NULL;\n\t} else {\n\t\tdict = NULL;\n\t\tproperty_list_service_receive_plist(parent, &dict);\n\t\tif (dict) {\n#ifndef STRIP_DEBUG_CODE\n\t\t\tchar *cmd_value = NULL;\n\t\t\tplist_t cmd_value_node = plist_dict_get_item(dict, \"Command\");\n\t\t\tif (plist_get_node_type(cmd_value_node) == PLIST_STRING) {\n\t\t\t\tplist_get_string_val(cmd_value_node, &cmd_value);\n\t\t\t}\n\t\t\tif (cmd_value && !strcmp(cmd_value, \"ProxyDeath\")) {\n\t\t\t\t// this is the expected answer\n\t\t\t} else {\n\t\t\t\tdebug_info(\"Did not get ProxyDeath but:\");\n\t\t\t\tdebug_plist(dict);\n\t\t\t}\n\t\t\tif (cmd_value) {\n\t\t\t\tfree(cmd_value);\n\t\t\t}\n#endif\n\t\t\tplist_free(dict);\n\t\t}\n\t}\n\n\tproperty_list_service_client_free(parent);\n\n\tmutex_destroy(&client->mutex);\n\tfree(client);\n\n\treturn NP_E_SUCCESS;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include \"notification_proxy.h\"",
            "#include <plist/plist.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <string.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"notification_proxy.h\"\n#include <plist/plist.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <string.h>\n\nLIBIMOBILEDEVICE_API np_error_t np_client_free(np_client_t client)\n{\n\tplist_t dict;\n\tproperty_list_service_client_t parent;\n\n\tif (!client)\n\t\treturn NP_E_INVALID_ARG;\n\n\tdict = plist_new_dict();\n\tplist_dict_set_item(dict,\"Command\", plist_new_string(\"Shutdown\"));\n\tproperty_list_service_send_xml_plist(client->parent, dict);\n\tplist_free(dict);\n\n\tparent = client->parent;\n\t/* notifies the client->notifier thread that it should terminate */\n\tclient->parent = NULL;\n\n\tif (client->notifier) {\n\t\tdebug_info(\"joining np callback\");\n\t\tthread_join(client->notifier);\n\t\tthread_free(client->notifier);\n\t\tclient->notifier = (thread_t)NULL;\n\t} else {\n\t\tdict = NULL;\n\t\tproperty_list_service_receive_plist(parent, &dict);\n\t\tif (dict) {\n#ifndef STRIP_DEBUG_CODE\n\t\t\tchar *cmd_value = NULL;\n\t\t\tplist_t cmd_value_node = plist_dict_get_item(dict, \"Command\");\n\t\t\tif (plist_get_node_type(cmd_value_node) == PLIST_STRING) {\n\t\t\t\tplist_get_string_val(cmd_value_node, &cmd_value);\n\t\t\t}\n\t\t\tif (cmd_value && !strcmp(cmd_value, \"ProxyDeath\")) {\n\t\t\t\t// this is the expected answer\n\t\t\t} else {\n\t\t\t\tdebug_info(\"Did not get ProxyDeath but:\");\n\t\t\t\tdebug_plist(dict);\n\t\t\t}\n\t\t\tif (cmd_value) {\n\t\t\t\tfree(cmd_value);\n\t\t\t}\n#endif\n\t\t\tplist_free(dict);\n\t\t}\n\t}\n\n\tproperty_list_service_client_free(parent);\n\n\tmutex_destroy(&client->mutex);\n\tfree(client);\n\n\treturn NP_E_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"unknown NotificationProxy command '%s' received!\"",
            "cmd_value"
          ],
          "line": 292
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"NotificationProxy died!\""
          ],
          "line": 289
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "cmd_value",
            "\"ProxyDeath\""
          ],
          "line": 288
        },
        "resolved": true,
        "details": {
          "function_name": "plist_strcmp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/tools/idevicebackup.c",
          "lines": "296-309",
          "snippet": "static int plist_strcmp(plist_t node, const char *str)\n{\n\tchar *buffer = NULL;\n\tint ret = 0;\n\n\tif (plist_get_node_type(node) != PLIST_STRING)\n\t\treturn ret;\n\n\tplist_get_string_val(node, &buffer);\n\tret = strcmp(buffer, str);\n\tfree(buffer);\n\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"common/utils.h\"",
            "#include <libimobiledevice/afc.h>",
            "#include <libimobiledevice/notification_proxy.h>",
            "#include <libimobiledevice/mobilebackup.h>",
            "#include <libimobiledevice/lockdown.h>",
            "#include <libimobiledevice/libimobiledevice.h>",
            "#include <time.h>",
            "#include <ctype.h>",
            "#include <unistd.h>",
            "#include <gcrypt.h>",
            "#include <openssl/sha.h>",
            "#include <signal.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"common/utils.h\"\n#include <libimobiledevice/afc.h>\n#include <libimobiledevice/notification_proxy.h>\n#include <libimobiledevice/mobilebackup.h>\n#include <libimobiledevice/lockdown.h>\n#include <libimobiledevice/libimobiledevice.h>\n#include <time.h>\n#include <ctype.h>\n#include <unistd.h>\n#include <gcrypt.h>\n#include <openssl/sha.h>\n#include <signal.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int plist_strcmp(plist_t node, const char *str)\n{\n\tchar *buffer = NULL;\n\tint ret = 0;\n\n\tif (plist_get_node_type(node) != PLIST_STRING)\n\t\treturn ret;\n\n\tplist_get_string_val(node, &buffer);\n\tret = strcmp(buffer, str);\n\tfree(buffer);\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"got notification %s\"",
            "__func__",
            "name_value"
          ],
          "line": 285
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_get_string_val",
          "args": [
            "name_value_node",
            "&name_value"
          ],
          "line": 279
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_get_node_type",
          "args": [
            "name_value_node"
          ],
          "line": 278
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_get_item",
          "args": [
            "dict",
            "\"Name\""
          ],
          "line": 276
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_get_string_val",
          "args": [
            "cmd_value_node",
            "&cmd_value"
          ],
          "line": 271
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_get_node_type",
          "args": [
            "cmd_value_node"
          ],
          "line": 270
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_get_item",
          "args": [
            "dict",
            "\"Command\""
          ],
          "line": 268
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"NotificationProxy: error %d occured!\"",
            "perr"
          ],
          "line": 263
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"NotificationProxy: no notification received!\""
          ],
          "line": 260
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "property_list_service_receive_plist_with_timeout",
          "args": [
            "client->parent",
            "&dict",
            "500"
          ],
          "line": 258
        },
        "resolved": true,
        "details": {
          "function_name": "property_list_service_receive_plist_with_timeout",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
          "lines": "253-256",
          "snippet": "LIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_receive_plist_with_timeout(property_list_service_client_t client, plist_t *plist, unsigned int timeout)\n{\n\treturn internal_plist_receive_timeout(client, plist, timeout);\n}",
          "includes": [
            "#include \"endianness.h\"",
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_receive_plist_with_timeout(property_list_service_client_t client, plist_t *plist, unsigned int timeout)\n{\n\treturn internal_plist_receive_timeout(client, plist, timeout);\n}"
        }
      },
      {
        "call_info": {
          "callee": "np_lock",
          "args": [
            "client"
          ],
          "line": 256
        },
        "resolved": true,
        "details": {
          "function_name": "np_lock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/notification_proxy.c",
          "lines": "46-50",
          "snippet": "static void np_lock(np_client_t client)\n{\n\tdebug_info(\"Locked\");\n\tmutex_lock(&client->mutex);\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include \"notification_proxy.h\"",
            "#include <plist/plist.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <string.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"notification_proxy.h\"\n#include <plist/plist.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <string.h>\n\nstatic void np_lock(np_client_t client)\n{\n\tdebug_info(\"Locked\");\n\tmutex_lock(&client->mutex);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"notification_proxy.h\"\n#include <plist/plist.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <string.h>\n\nstatic int np_get_notification(np_client_t client, char **notification)\n{\n\tint res = 0;\n\tplist_t dict = NULL;\n\n\tif (!client || !client->parent || *notification)\n\t\treturn -1;\n\n\tnp_lock(client);\n\n\tproperty_list_service_error_t perr = property_list_service_receive_plist_with_timeout(client->parent, &dict, 500);\n\tif (perr == PROPERTY_LIST_SERVICE_E_RECEIVE_TIMEOUT) {\n\t\tdebug_info(\"NotificationProxy: no notification received!\");\n\t\tres = 0;\n\t} else if (perr != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tdebug_info(\"NotificationProxy: error %d occured!\", perr);\n\t\tres = perr;\n\t}\n\tif (dict) {\n\t\tchar *cmd_value = NULL;\n\t\tplist_t cmd_value_node = plist_dict_get_item(dict, \"Command\");\n\n\t\tif (plist_get_node_type(cmd_value_node) == PLIST_STRING) {\n\t\t\tplist_get_string_val(cmd_value_node, &cmd_value);\n\t\t}\n\n\t\tif (cmd_value && !strcmp(cmd_value, \"RelayNotification\")) {\n\t\t\tchar *name_value = NULL;\n\t\t\tplist_t name_value_node = plist_dict_get_item(dict, \"Name\");\n\n\t\t\tif (plist_get_node_type(name_value_node) == PLIST_STRING) {\n\t\t\t\tplist_get_string_val(name_value_node, &name_value);\n\t\t\t}\n\n\t\t\tres = -2;\n\t\t\tif (name_value_node && name_value) {\n\t\t\t\t*notification = name_value;\n\t\t\t\tdebug_info(\"got notification %s\", __func__, name_value);\n\t\t\t\tres = 0;\n\t\t\t}\n\t\t} else if (cmd_value && !strcmp(cmd_value, \"ProxyDeath\")) {\n\t\t\tdebug_info(\"NotificationProxy died!\");\n\t\t\tres = -1;\n\t\t} else if (cmd_value) {\n\t\t\tdebug_info(\"unknown NotificationProxy command '%s' received!\", cmd_value);\n\t\t\tres = -1;\n\t\t} else {\n\t\t\tres = -2;\n\t\t}\n\t\tif (cmd_value) {\n\t\t\tfree(cmd_value);\n\t\t}\n\t\tplist_free(dict);\n\t\tdict = NULL;\n\t}\n\n\tnp_unlock(client);\n\n\treturn res;\n}"
  },
  {
    "function_name": "np_observe_notifications",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/notification_proxy.c",
    "lines": "210-233",
    "snippet": "LIBIMOBILEDEVICE_API np_error_t np_observe_notifications(np_client_t client, const char **notification_spec)\n{\n\tint i = 0;\n\tnp_error_t res = NP_E_UNKNOWN_ERROR;\n\tconst char **notifications = notification_spec;\n\n\tif (!client) {\n\t\treturn NP_E_INVALID_ARG;\n\t}\n\n\tif (!notifications) {\n\t\treturn NP_E_INVALID_ARG;\n\t}\n\n\twhile (notifications[i]) {\n\t\tres = np_observe_notification(client, notifications[i]);\n\t\tif (res != NP_E_SUCCESS) {\n\t\t\tbreak;\n\t\t}\n\t\ti++;\n\t}\n\n\treturn res;\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"property_list_service.h\"",
      "#include \"notification_proxy.h\"",
      "#include <plist/plist.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <string.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "np_observe_notification",
          "args": [
            "client",
            "notifications[i]"
          ],
          "line": 225
        },
        "resolved": true,
        "details": {
          "function_name": "np_observe_notifications",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/notification_proxy.c",
          "lines": "210-233",
          "snippet": "LIBIMOBILEDEVICE_API np_error_t np_observe_notifications(np_client_t client, const char **notification_spec)\n{\n\tint i = 0;\n\tnp_error_t res = NP_E_UNKNOWN_ERROR;\n\tconst char **notifications = notification_spec;\n\n\tif (!client) {\n\t\treturn NP_E_INVALID_ARG;\n\t}\n\n\tif (!notifications) {\n\t\treturn NP_E_INVALID_ARG;\n\t}\n\n\twhile (notifications[i]) {\n\t\tres = np_observe_notification(client, notifications[i]);\n\t\tif (res != NP_E_SUCCESS) {\n\t\t\tbreak;\n\t\t}\n\t\ti++;\n\t}\n\n\treturn res;\n}",
          "note": "cyclic_reference_detected"
        }
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"notification_proxy.h\"\n#include <plist/plist.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <string.h>\n\nLIBIMOBILEDEVICE_API np_error_t np_observe_notifications(np_client_t client, const char **notification_spec)\n{\n\tint i = 0;\n\tnp_error_t res = NP_E_UNKNOWN_ERROR;\n\tconst char **notifications = notification_spec;\n\n\tif (!client) {\n\t\treturn NP_E_INVALID_ARG;\n\t}\n\n\tif (!notifications) {\n\t\treturn NP_E_INVALID_ARG;\n\t}\n\n\twhile (notifications[i]) {\n\t\tres = np_observe_notification(client, notifications[i]);\n\t\tif (res != NP_E_SUCCESS) {\n\t\t\tbreak;\n\t\t}\n\t\ti++;\n\t}\n\n\treturn res;\n}"
  },
  {
    "function_name": "np_observe_notification",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/notification_proxy.c",
    "lines": "189-208",
    "snippet": "LIBIMOBILEDEVICE_API np_error_t np_observe_notification( np_client_t client, const char *notification )\n{\n\tif (!client || !notification) {\n\t\treturn NP_E_INVALID_ARG;\n\t}\n\tnp_lock(client);\n\n\tplist_t dict = plist_new_dict();\n\tplist_dict_set_item(dict,\"Command\", plist_new_string(\"ObserveNotification\"));\n\tplist_dict_set_item(dict,\"Name\", plist_new_string(notification));\n\n\tnp_error_t res = np_error(property_list_service_send_xml_plist(client->parent, dict));\n\tif (res != NP_E_SUCCESS) {\n\t\tdebug_info(\"Error sending XML plist to device!\");\n\t}\n\tplist_free(dict);\n\n\tnp_unlock(client);\n\treturn res;\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"property_list_service.h\"",
      "#include \"notification_proxy.h\"",
      "#include <plist/plist.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <string.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "np_unlock",
          "args": [
            "client"
          ],
          "line": 206
        },
        "resolved": true,
        "details": {
          "function_name": "np_unlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/notification_proxy.c",
          "lines": "57-61",
          "snippet": "static void np_unlock(np_client_t client)\n{\n\tdebug_info(\"Unlocked\");\n\tmutex_unlock(&client->mutex);\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include \"notification_proxy.h\"",
            "#include <plist/plist.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <string.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"notification_proxy.h\"\n#include <plist/plist.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <string.h>\n\nstatic void np_unlock(np_client_t client)\n{\n\tdebug_info(\"Unlocked\");\n\tmutex_unlock(&client->mutex);\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "dict"
          ],
          "line": 204
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"Error sending XML plist to device!\""
          ],
          "line": 202
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "np_error",
          "args": [
            "property_list_service_send_xml_plist(client->parent, dict)"
          ],
          "line": 200
        },
        "resolved": true,
        "details": {
          "function_name": "np_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/notification_proxy.c",
          "lines": "72-87",
          "snippet": "static np_error_t np_error(property_list_service_error_t err)\n{\n\tswitch (err) {\n\t\tcase PROPERTY_LIST_SERVICE_E_SUCCESS:\n\t\t\treturn NP_E_SUCCESS;\n\t\tcase PROPERTY_LIST_SERVICE_E_INVALID_ARG:\n\t\t\treturn NP_E_INVALID_ARG;\n\t\tcase PROPERTY_LIST_SERVICE_E_PLIST_ERROR:\n\t\t\treturn NP_E_PLIST_ERROR;\n\t\tcase PROPERTY_LIST_SERVICE_E_MUX_ERROR:\n\t\t\treturn NP_E_CONN_FAILED;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn NP_E_UNKNOWN_ERROR;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include \"notification_proxy.h\"",
            "#include <plist/plist.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <string.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"notification_proxy.h\"\n#include <plist/plist.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <string.h>\n\nstatic np_error_t np_error(property_list_service_error_t err)\n{\n\tswitch (err) {\n\t\tcase PROPERTY_LIST_SERVICE_E_SUCCESS:\n\t\t\treturn NP_E_SUCCESS;\n\t\tcase PROPERTY_LIST_SERVICE_E_INVALID_ARG:\n\t\t\treturn NP_E_INVALID_ARG;\n\t\tcase PROPERTY_LIST_SERVICE_E_PLIST_ERROR:\n\t\t\treturn NP_E_PLIST_ERROR;\n\t\tcase PROPERTY_LIST_SERVICE_E_MUX_ERROR:\n\t\t\treturn NP_E_CONN_FAILED;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn NP_E_UNKNOWN_ERROR;\n}"
        }
      },
      {
        "call_info": {
          "callee": "property_list_service_send_xml_plist",
          "args": [
            "client->parent",
            "dict"
          ],
          "line": 200
        },
        "resolved": true,
        "details": {
          "function_name": "property_list_service_send_xml_plist",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
          "lines": "150-153",
          "snippet": "LIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_send_xml_plist(property_list_service_client_t client, plist_t plist)\n{\n\treturn internal_plist_send(client, plist, 0);\n}",
          "includes": [
            "#include \"endianness.h\"",
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_send_xml_plist(property_list_service_client_t client, plist_t plist)\n{\n\treturn internal_plist_send(client, plist, 0);\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"Name\"",
            "plist_new_string(notification)"
          ],
          "line": 198
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "notification"
          ],
          "line": 198
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"Command\"",
            "plist_new_string(\"ObserveNotification\")"
          ],
          "line": 197
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "\"ObserveNotification\""
          ],
          "line": 197
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_dict",
          "args": [],
          "line": 196
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "np_lock",
          "args": [
            "client"
          ],
          "line": 194
        },
        "resolved": true,
        "details": {
          "function_name": "np_lock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/notification_proxy.c",
          "lines": "46-50",
          "snippet": "static void np_lock(np_client_t client)\n{\n\tdebug_info(\"Locked\");\n\tmutex_lock(&client->mutex);\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include \"notification_proxy.h\"",
            "#include <plist/plist.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <string.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"notification_proxy.h\"\n#include <plist/plist.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <string.h>\n\nstatic void np_lock(np_client_t client)\n{\n\tdebug_info(\"Locked\");\n\tmutex_lock(&client->mutex);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"notification_proxy.h\"\n#include <plist/plist.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <string.h>\n\nLIBIMOBILEDEVICE_API np_error_t np_observe_notification( np_client_t client, const char *notification )\n{\n\tif (!client || !notification) {\n\t\treturn NP_E_INVALID_ARG;\n\t}\n\tnp_lock(client);\n\n\tplist_t dict = plist_new_dict();\n\tplist_dict_set_item(dict,\"Command\", plist_new_string(\"ObserveNotification\"));\n\tplist_dict_set_item(dict,\"Name\", plist_new_string(notification));\n\n\tnp_error_t res = np_error(property_list_service_send_xml_plist(client->parent, dict));\n\tif (res != NP_E_SUCCESS) {\n\t\tdebug_info(\"Error sending XML plist to device!\");\n\t}\n\tplist_free(dict);\n\n\tnp_unlock(client);\n\treturn res;\n}"
  },
  {
    "function_name": "np_post_notification",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/notification_proxy.c",
    "lines": "168-187",
    "snippet": "LIBIMOBILEDEVICE_API np_error_t np_post_notification(np_client_t client, const char *notification)\n{\n\tif (!client || !notification) {\n\t\treturn NP_E_INVALID_ARG;\n\t}\n\tnp_lock(client);\n\n\tplist_t dict = plist_new_dict();\n\tplist_dict_set_item(dict,\"Command\", plist_new_string(\"PostNotification\"));\n\tplist_dict_set_item(dict,\"Name\", plist_new_string(notification));\n\n\tnp_error_t res = np_error(property_list_service_send_xml_plist(client->parent, dict));\n\tplist_free(dict);\n\n\tif (res != NP_E_SUCCESS) {\n\t\tdebug_info(\"Error sending XML plist to device!\");\n\t}\n\tnp_unlock(client);\n\treturn res;\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"property_list_service.h\"",
      "#include \"notification_proxy.h\"",
      "#include <plist/plist.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <string.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "np_unlock",
          "args": [
            "client"
          ],
          "line": 185
        },
        "resolved": true,
        "details": {
          "function_name": "np_unlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/notification_proxy.c",
          "lines": "57-61",
          "snippet": "static void np_unlock(np_client_t client)\n{\n\tdebug_info(\"Unlocked\");\n\tmutex_unlock(&client->mutex);\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include \"notification_proxy.h\"",
            "#include <plist/plist.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <string.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"notification_proxy.h\"\n#include <plist/plist.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <string.h>\n\nstatic void np_unlock(np_client_t client)\n{\n\tdebug_info(\"Unlocked\");\n\tmutex_unlock(&client->mutex);\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"Error sending XML plist to device!\""
          ],
          "line": 183
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "dict"
          ],
          "line": 180
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "np_error",
          "args": [
            "property_list_service_send_xml_plist(client->parent, dict)"
          ],
          "line": 179
        },
        "resolved": true,
        "details": {
          "function_name": "np_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/notification_proxy.c",
          "lines": "72-87",
          "snippet": "static np_error_t np_error(property_list_service_error_t err)\n{\n\tswitch (err) {\n\t\tcase PROPERTY_LIST_SERVICE_E_SUCCESS:\n\t\t\treturn NP_E_SUCCESS;\n\t\tcase PROPERTY_LIST_SERVICE_E_INVALID_ARG:\n\t\t\treturn NP_E_INVALID_ARG;\n\t\tcase PROPERTY_LIST_SERVICE_E_PLIST_ERROR:\n\t\t\treturn NP_E_PLIST_ERROR;\n\t\tcase PROPERTY_LIST_SERVICE_E_MUX_ERROR:\n\t\t\treturn NP_E_CONN_FAILED;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn NP_E_UNKNOWN_ERROR;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include \"notification_proxy.h\"",
            "#include <plist/plist.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <string.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"notification_proxy.h\"\n#include <plist/plist.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <string.h>\n\nstatic np_error_t np_error(property_list_service_error_t err)\n{\n\tswitch (err) {\n\t\tcase PROPERTY_LIST_SERVICE_E_SUCCESS:\n\t\t\treturn NP_E_SUCCESS;\n\t\tcase PROPERTY_LIST_SERVICE_E_INVALID_ARG:\n\t\t\treturn NP_E_INVALID_ARG;\n\t\tcase PROPERTY_LIST_SERVICE_E_PLIST_ERROR:\n\t\t\treturn NP_E_PLIST_ERROR;\n\t\tcase PROPERTY_LIST_SERVICE_E_MUX_ERROR:\n\t\t\treturn NP_E_CONN_FAILED;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn NP_E_UNKNOWN_ERROR;\n}"
        }
      },
      {
        "call_info": {
          "callee": "property_list_service_send_xml_plist",
          "args": [
            "client->parent",
            "dict"
          ],
          "line": 179
        },
        "resolved": true,
        "details": {
          "function_name": "property_list_service_send_xml_plist",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
          "lines": "150-153",
          "snippet": "LIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_send_xml_plist(property_list_service_client_t client, plist_t plist)\n{\n\treturn internal_plist_send(client, plist, 0);\n}",
          "includes": [
            "#include \"endianness.h\"",
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_send_xml_plist(property_list_service_client_t client, plist_t plist)\n{\n\treturn internal_plist_send(client, plist, 0);\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"Name\"",
            "plist_new_string(notification)"
          ],
          "line": 177
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "notification"
          ],
          "line": 177
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"Command\"",
            "plist_new_string(\"PostNotification\")"
          ],
          "line": 176
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "\"PostNotification\""
          ],
          "line": 176
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_dict",
          "args": [],
          "line": 175
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "np_lock",
          "args": [
            "client"
          ],
          "line": 173
        },
        "resolved": true,
        "details": {
          "function_name": "np_lock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/notification_proxy.c",
          "lines": "46-50",
          "snippet": "static void np_lock(np_client_t client)\n{\n\tdebug_info(\"Locked\");\n\tmutex_lock(&client->mutex);\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include \"notification_proxy.h\"",
            "#include <plist/plist.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <string.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"notification_proxy.h\"\n#include <plist/plist.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <string.h>\n\nstatic void np_lock(np_client_t client)\n{\n\tdebug_info(\"Locked\");\n\tmutex_lock(&client->mutex);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"notification_proxy.h\"\n#include <plist/plist.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <string.h>\n\nLIBIMOBILEDEVICE_API np_error_t np_post_notification(np_client_t client, const char *notification)\n{\n\tif (!client || !notification) {\n\t\treturn NP_E_INVALID_ARG;\n\t}\n\tnp_lock(client);\n\n\tplist_t dict = plist_new_dict();\n\tplist_dict_set_item(dict,\"Command\", plist_new_string(\"PostNotification\"));\n\tplist_dict_set_item(dict,\"Name\", plist_new_string(notification));\n\n\tnp_error_t res = np_error(property_list_service_send_xml_plist(client->parent, dict));\n\tplist_free(dict);\n\n\tif (res != NP_E_SUCCESS) {\n\t\tdebug_info(\"Error sending XML plist to device!\");\n\t}\n\tnp_unlock(client);\n\treturn res;\n}"
  },
  {
    "function_name": "np_client_free",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/notification_proxy.c",
    "lines": "114-166",
    "snippet": "LIBIMOBILEDEVICE_API np_error_t np_client_free(np_client_t client)\n{\n\tplist_t dict;\n\tproperty_list_service_client_t parent;\n\n\tif (!client)\n\t\treturn NP_E_INVALID_ARG;\n\n\tdict = plist_new_dict();\n\tplist_dict_set_item(dict,\"Command\", plist_new_string(\"Shutdown\"));\n\tproperty_list_service_send_xml_plist(client->parent, dict);\n\tplist_free(dict);\n\n\tparent = client->parent;\n\t/* notifies the client->notifier thread that it should terminate */\n\tclient->parent = NULL;\n\n\tif (client->notifier) {\n\t\tdebug_info(\"joining np callback\");\n\t\tthread_join(client->notifier);\n\t\tthread_free(client->notifier);\n\t\tclient->notifier = (thread_t)NULL;\n\t} else {\n\t\tdict = NULL;\n\t\tproperty_list_service_receive_plist(parent, &dict);\n\t\tif (dict) {\n#ifndef STRIP_DEBUG_CODE\n\t\t\tchar *cmd_value = NULL;\n\t\t\tplist_t cmd_value_node = plist_dict_get_item(dict, \"Command\");\n\t\t\tif (plist_get_node_type(cmd_value_node) == PLIST_STRING) {\n\t\t\t\tplist_get_string_val(cmd_value_node, &cmd_value);\n\t\t\t}\n\t\t\tif (cmd_value && !strcmp(cmd_value, \"ProxyDeath\")) {\n\t\t\t\t// this is the expected answer\n\t\t\t} else {\n\t\t\t\tdebug_info(\"Did not get ProxyDeath but:\");\n\t\t\t\tdebug_plist(dict);\n\t\t\t}\n\t\t\tif (cmd_value) {\n\t\t\t\tfree(cmd_value);\n\t\t\t}\n#endif\n\t\t\tplist_free(dict);\n\t\t}\n\t}\n\n\tproperty_list_service_client_free(parent);\n\n\tmutex_destroy(&client->mutex);\n\tfree(client);\n\n\treturn NP_E_SUCCESS;\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"property_list_service.h\"",
      "#include \"notification_proxy.h\"",
      "#include <plist/plist.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <string.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "client"
          ],
          "line": 163
        },
        "resolved": true,
        "details": {
          "function_name": "np_client_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/notification_proxy.c",
          "lines": "114-166",
          "snippet": "LIBIMOBILEDEVICE_API np_error_t np_client_free(np_client_t client)\n{\n\tplist_t dict;\n\tproperty_list_service_client_t parent;\n\n\tif (!client)\n\t\treturn NP_E_INVALID_ARG;\n\n\tdict = plist_new_dict();\n\tplist_dict_set_item(dict,\"Command\", plist_new_string(\"Shutdown\"));\n\tproperty_list_service_send_xml_plist(client->parent, dict);\n\tplist_free(dict);\n\n\tparent = client->parent;\n\t/* notifies the client->notifier thread that it should terminate */\n\tclient->parent = NULL;\n\n\tif (client->notifier) {\n\t\tdebug_info(\"joining np callback\");\n\t\tthread_join(client->notifier);\n\t\tthread_free(client->notifier);\n\t\tclient->notifier = (thread_t)NULL;\n\t} else {\n\t\tdict = NULL;\n\t\tproperty_list_service_receive_plist(parent, &dict);\n\t\tif (dict) {\n#ifndef STRIP_DEBUG_CODE\n\t\t\tchar *cmd_value = NULL;\n\t\t\tplist_t cmd_value_node = plist_dict_get_item(dict, \"Command\");\n\t\t\tif (plist_get_node_type(cmd_value_node) == PLIST_STRING) {\n\t\t\t\tplist_get_string_val(cmd_value_node, &cmd_value);\n\t\t\t}\n\t\t\tif (cmd_value && !strcmp(cmd_value, \"ProxyDeath\")) {\n\t\t\t\t// this is the expected answer\n\t\t\t} else {\n\t\t\t\tdebug_info(\"Did not get ProxyDeath but:\");\n\t\t\t\tdebug_plist(dict);\n\t\t\t}\n\t\t\tif (cmd_value) {\n\t\t\t\tfree(cmd_value);\n\t\t\t}\n#endif\n\t\t\tplist_free(dict);\n\t\t}\n\t}\n\n\tproperty_list_service_client_free(parent);\n\n\tmutex_destroy(&client->mutex);\n\tfree(client);\n\n\treturn NP_E_SUCCESS;\n}",
          "note": "cyclic_reference_detected"
        }
      },
      {
        "call_info": {
          "callee": "mutex_destroy",
          "args": [
            "&client->mutex"
          ],
          "line": 162
        },
        "resolved": true,
        "details": {
          "function_name": "mutex_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/common/thread.c",
          "lines": "65-72",
          "snippet": "void mutex_destroy(mutex_t* mutex)\n{\n#ifdef WIN32\n\tDeleteCriticalSection(mutex);\n#else\n\tpthread_mutex_destroy(mutex);\n#endif\n}",
          "includes": [
            "#include \"thread.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"thread.h\"\n\nvoid mutex_destroy(mutex_t* mutex)\n{\n#ifdef WIN32\n\tDeleteCriticalSection(mutex);\n#else\n\tpthread_mutex_destroy(mutex);\n#endif\n}"
        }
      },
      {
        "call_info": {
          "callee": "property_list_service_client_free",
          "args": [
            "parent"
          ],
          "line": 160
        },
        "resolved": true,
        "details": {
          "function_name": "property_list_service_client_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
          "lines": "77-88",
          "snippet": "LIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_client_free(property_list_service_client_t client)\n{\n\tif (!client)\n\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\n\tproperty_list_service_error_t err = service_to_property_list_service_error(service_client_free(client->parent));\n\n\tfree(client);\n\tclient = NULL;\n\n\treturn err;\n}",
          "includes": [
            "#include \"endianness.h\"",
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_client_free(property_list_service_client_t client)\n{\n\tif (!client)\n\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\n\tproperty_list_service_error_t err = service_to_property_list_service_error(service_client_free(client->parent));\n\n\tfree(client);\n\tclient = NULL;\n\n\treturn err;\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "dict"
          ],
          "line": 156
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_plist",
          "args": [
            "dict"
          ],
          "line": 150
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"Did not get ProxyDeath but:\""
          ],
          "line": 149
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "cmd_value",
            "\"ProxyDeath\""
          ],
          "line": 146
        },
        "resolved": true,
        "details": {
          "function_name": "plist_strcmp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/tools/idevicebackup.c",
          "lines": "296-309",
          "snippet": "static int plist_strcmp(plist_t node, const char *str)\n{\n\tchar *buffer = NULL;\n\tint ret = 0;\n\n\tif (plist_get_node_type(node) != PLIST_STRING)\n\t\treturn ret;\n\n\tplist_get_string_val(node, &buffer);\n\tret = strcmp(buffer, str);\n\tfree(buffer);\n\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"common/utils.h\"",
            "#include <libimobiledevice/afc.h>",
            "#include <libimobiledevice/notification_proxy.h>",
            "#include <libimobiledevice/mobilebackup.h>",
            "#include <libimobiledevice/lockdown.h>",
            "#include <libimobiledevice/libimobiledevice.h>",
            "#include <time.h>",
            "#include <ctype.h>",
            "#include <unistd.h>",
            "#include <gcrypt.h>",
            "#include <openssl/sha.h>",
            "#include <signal.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"common/utils.h\"\n#include <libimobiledevice/afc.h>\n#include <libimobiledevice/notification_proxy.h>\n#include <libimobiledevice/mobilebackup.h>\n#include <libimobiledevice/lockdown.h>\n#include <libimobiledevice/libimobiledevice.h>\n#include <time.h>\n#include <ctype.h>\n#include <unistd.h>\n#include <gcrypt.h>\n#include <openssl/sha.h>\n#include <signal.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int plist_strcmp(plist_t node, const char *str)\n{\n\tchar *buffer = NULL;\n\tint ret = 0;\n\n\tif (plist_get_node_type(node) != PLIST_STRING)\n\t\treturn ret;\n\n\tplist_get_string_val(node, &buffer);\n\tret = strcmp(buffer, str);\n\tfree(buffer);\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_get_string_val",
          "args": [
            "cmd_value_node",
            "&cmd_value"
          ],
          "line": 144
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_get_node_type",
          "args": [
            "cmd_value_node"
          ],
          "line": 143
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_get_item",
          "args": [
            "dict",
            "\"Command\""
          ],
          "line": 142
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "property_list_service_receive_plist",
          "args": [
            "parent",
            "&dict"
          ],
          "line": 138
        },
        "resolved": true,
        "details": {
          "function_name": "property_list_service_receive_plist",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
          "lines": "258-261",
          "snippet": "LIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_receive_plist(property_list_service_client_t client, plist_t *plist)\n{\n\treturn internal_plist_receive_timeout(client, plist, 10000);\n}",
          "includes": [
            "#include \"endianness.h\"",
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_receive_plist(property_list_service_client_t client, plist_t *plist)\n{\n\treturn internal_plist_receive_timeout(client, plist, 10000);\n}"
        }
      },
      {
        "call_info": {
          "callee": "thread_free",
          "args": [
            "client->notifier"
          ],
          "line": 134
        },
        "resolved": true,
        "details": {
          "function_name": "thread_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/common/thread.c",
          "lines": "39-44",
          "snippet": "void thread_free(thread_t thread)\n{\n#ifdef WIN32\n\tCloseHandle(thread);\n#endif\n}",
          "includes": [
            "#include \"thread.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"thread.h\"\n\nvoid thread_free(thread_t thread)\n{\n#ifdef WIN32\n\tCloseHandle(thread);\n#endif\n}"
        }
      },
      {
        "call_info": {
          "callee": "thread_join",
          "args": [
            "client->notifier"
          ],
          "line": 133
        },
        "resolved": true,
        "details": {
          "function_name": "thread_join",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/common/thread.c",
          "lines": "46-54",
          "snippet": "void thread_join(thread_t thread)\n{\n\t/* wait for thread to complete */\n#ifdef WIN32\n\tWaitForSingleObject(thread, INFINITE);\n#else\n\tpthread_join(thread, NULL);\n#endif\n}",
          "includes": [
            "#include \"thread.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"thread.h\"\n\nvoid thread_join(thread_t thread)\n{\n\t/* wait for thread to complete */\n#ifdef WIN32\n\tWaitForSingleObject(thread, INFINITE);\n#else\n\tpthread_join(thread, NULL);\n#endif\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"joining np callback\""
          ],
          "line": 132
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "dict"
          ],
          "line": 125
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "property_list_service_send_xml_plist",
          "args": [
            "client->parent",
            "dict"
          ],
          "line": 124
        },
        "resolved": true,
        "details": {
          "function_name": "property_list_service_send_xml_plist",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
          "lines": "150-153",
          "snippet": "LIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_send_xml_plist(property_list_service_client_t client, plist_t plist)\n{\n\treturn internal_plist_send(client, plist, 0);\n}",
          "includes": [
            "#include \"endianness.h\"",
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_send_xml_plist(property_list_service_client_t client, plist_t plist)\n{\n\treturn internal_plist_send(client, plist, 0);\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"Command\"",
            "plist_new_string(\"Shutdown\")"
          ],
          "line": 123
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "\"Shutdown\""
          ],
          "line": 123
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_dict",
          "args": [],
          "line": 122
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"notification_proxy.h\"\n#include <plist/plist.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <string.h>\n\nLIBIMOBILEDEVICE_API np_error_t np_client_free(np_client_t client)\n{\n\tplist_t dict;\n\tproperty_list_service_client_t parent;\n\n\tif (!client)\n\t\treturn NP_E_INVALID_ARG;\n\n\tdict = plist_new_dict();\n\tplist_dict_set_item(dict,\"Command\", plist_new_string(\"Shutdown\"));\n\tproperty_list_service_send_xml_plist(client->parent, dict);\n\tplist_free(dict);\n\n\tparent = client->parent;\n\t/* notifies the client->notifier thread that it should terminate */\n\tclient->parent = NULL;\n\n\tif (client->notifier) {\n\t\tdebug_info(\"joining np callback\");\n\t\tthread_join(client->notifier);\n\t\tthread_free(client->notifier);\n\t\tclient->notifier = (thread_t)NULL;\n\t} else {\n\t\tdict = NULL;\n\t\tproperty_list_service_receive_plist(parent, &dict);\n\t\tif (dict) {\n#ifndef STRIP_DEBUG_CODE\n\t\t\tchar *cmd_value = NULL;\n\t\t\tplist_t cmd_value_node = plist_dict_get_item(dict, \"Command\");\n\t\t\tif (plist_get_node_type(cmd_value_node) == PLIST_STRING) {\n\t\t\t\tplist_get_string_val(cmd_value_node, &cmd_value);\n\t\t\t}\n\t\t\tif (cmd_value && !strcmp(cmd_value, \"ProxyDeath\")) {\n\t\t\t\t// this is the expected answer\n\t\t\t} else {\n\t\t\t\tdebug_info(\"Did not get ProxyDeath but:\");\n\t\t\t\tdebug_plist(dict);\n\t\t\t}\n\t\t\tif (cmd_value) {\n\t\t\t\tfree(cmd_value);\n\t\t\t}\n#endif\n\t\t\tplist_free(dict);\n\t\t}\n\t}\n\n\tproperty_list_service_client_free(parent);\n\n\tmutex_destroy(&client->mutex);\n\tfree(client);\n\n\treturn NP_E_SUCCESS;\n}"
  },
  {
    "function_name": "np_client_start_service",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/notification_proxy.c",
    "lines": "107-112",
    "snippet": "LIBIMOBILEDEVICE_API np_error_t np_client_start_service(idevice_t device, np_client_t* client, const char* label)\n{\n\tnp_error_t err = NP_E_UNKNOWN_ERROR;\n\tservice_client_factory_start_service(device, NP_SERVICE_NAME, (void**)client, label, SERVICE_CONSTRUCTOR(np_client_new), &err);\n\treturn err;\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"property_list_service.h\"",
      "#include \"notification_proxy.h\"",
      "#include <plist/plist.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <string.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "service_client_factory_start_service",
          "args": [
            "device",
            "NP_SERVICE_NAME",
            "(void**)client",
            "label",
            "SERVICE_CONSTRUCTOR(np_client_new)",
            "&err"
          ],
          "line": 110
        },
        "resolved": true,
        "details": {
          "function_name": "service_client_factory_start_service",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/service.c",
          "lines": "79-116",
          "snippet": "LIBIMOBILEDEVICE_API service_error_t service_client_factory_start_service(idevice_t device, const char* service_name, void **client, const char* label, int32_t (*constructor_func)(idevice_t, lockdownd_service_descriptor_t, void**), int32_t *error_code)\n{\n\t*client = NULL;\n\n\tlockdownd_client_t lckd = NULL;\n\tif (LOCKDOWN_E_SUCCESS != lockdownd_client_new_with_handshake(device, &lckd, label)) {\n\t\tdebug_info(\"Could not create a lockdown client.\");\n\t\treturn SERVICE_E_START_SERVICE_ERROR;\n\t}\n\n\tlockdownd_service_descriptor_t service = NULL;\n\tlockdownd_start_service(lckd, service_name, &service);\n\tlockdownd_client_free(lckd);\n\n\tif (!service || service->port == 0) {\n\t\tdebug_info(\"Could not start service %s!\", service_name);\n\t\treturn SERVICE_E_START_SERVICE_ERROR;\n\t}\n\n\tint32_t ec;\n\tif (constructor_func) {\n\t\tec = (int32_t)constructor_func(device, service, client);\n\t} else {\n\t\tec = service_client_new(device, service, (service_client_t*)client);\n\t}\n\tif (error_code) {\n\t\t*error_code = ec;\n\t}\n\n\tif (ec != SERVICE_E_SUCCESS) {\n\t\tdebug_info(\"Could not connect to service %s! Port: %i, error: %i\", service_name, service->port, ec);\n\t}\n\n\tlockdownd_service_descriptor_free(service);\n\tservice = NULL;\n\n\treturn (ec == SERVICE_E_SUCCESS) ? SERVICE_E_SUCCESS : SERVICE_E_START_SERVICE_ERROR;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API service_error_t service_client_factory_start_service(idevice_t device, const char* service_name, void **client, const char* label, int32_t (*constructor_func)(idevice_t, lockdownd_service_descriptor_t, void**), int32_t *error_code)\n{\n\t*client = NULL;\n\n\tlockdownd_client_t lckd = NULL;\n\tif (LOCKDOWN_E_SUCCESS != lockdownd_client_new_with_handshake(device, &lckd, label)) {\n\t\tdebug_info(\"Could not create a lockdown client.\");\n\t\treturn SERVICE_E_START_SERVICE_ERROR;\n\t}\n\n\tlockdownd_service_descriptor_t service = NULL;\n\tlockdownd_start_service(lckd, service_name, &service);\n\tlockdownd_client_free(lckd);\n\n\tif (!service || service->port == 0) {\n\t\tdebug_info(\"Could not start service %s!\", service_name);\n\t\treturn SERVICE_E_START_SERVICE_ERROR;\n\t}\n\n\tint32_t ec;\n\tif (constructor_func) {\n\t\tec = (int32_t)constructor_func(device, service, client);\n\t} else {\n\t\tec = service_client_new(device, service, (service_client_t*)client);\n\t}\n\tif (error_code) {\n\t\t*error_code = ec;\n\t}\n\n\tif (ec != SERVICE_E_SUCCESS) {\n\t\tdebug_info(\"Could not connect to service %s! Port: %i, error: %i\", service_name, service->port, ec);\n\t}\n\n\tlockdownd_service_descriptor_free(service);\n\tservice = NULL;\n\n\treturn (ec == SERVICE_E_SUCCESS) ? SERVICE_E_SUCCESS : SERVICE_E_START_SERVICE_ERROR;\n}"
        }
      },
      {
        "call_info": {
          "callee": "SERVICE_CONSTRUCTOR",
          "args": [
            "np_client_new"
          ],
          "line": 110
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"notification_proxy.h\"\n#include <plist/plist.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <string.h>\n\nLIBIMOBILEDEVICE_API np_error_t np_client_start_service(idevice_t device, np_client_t* client, const char* label)\n{\n\tnp_error_t err = NP_E_UNKNOWN_ERROR;\n\tservice_client_factory_start_service(device, NP_SERVICE_NAME, (void**)client, label, SERVICE_CONSTRUCTOR(np_client_new), &err);\n\treturn err;\n}"
  },
  {
    "function_name": "np_client_new",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/notification_proxy.c",
    "lines": "89-105",
    "snippet": "LIBIMOBILEDEVICE_API np_error_t np_client_new(idevice_t device, lockdownd_service_descriptor_t service, np_client_t *client)\n{\n\tproperty_list_service_client_t plistclient = NULL;\n\tnp_error_t err = np_error(property_list_service_client_new(device, service, &plistclient));\n\tif (err != NP_E_SUCCESS) {\n\t\treturn err;\n\t}\n\n\tnp_client_t client_loc = (np_client_t) malloc(sizeof(struct np_client_private));\n\tclient_loc->parent = plistclient;\n\n\tmutex_init(&client_loc->mutex);\n\tclient_loc->notifier = (thread_t)NULL;\n\n\t*client = client_loc;\n\treturn NP_E_SUCCESS;\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"property_list_service.h\"",
      "#include \"notification_proxy.h\"",
      "#include <plist/plist.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <string.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "mutex_init",
          "args": [
            "&client_loc->mutex"
          ],
          "line": 100
        },
        "resolved": true,
        "details": {
          "function_name": "mutex_init",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/common/thread.c",
          "lines": "56-63",
          "snippet": "void mutex_init(mutex_t* mutex)\n{\n#ifdef WIN32\n\tInitializeCriticalSection(mutex);\n#else\n\tpthread_mutex_init(mutex, NULL);\n#endif\n}",
          "includes": [
            "#include \"thread.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"thread.h\"\n\nvoid mutex_init(mutex_t* mutex)\n{\n#ifdef WIN32\n\tInitializeCriticalSection(mutex);\n#else\n\tpthread_mutex_init(mutex, NULL);\n#endif\n}"
        }
      },
      {
        "call_info": {
          "callee": "malloc",
          "args": [
            "sizeof(struct np_client_private)"
          ],
          "line": 97
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "np_error",
          "args": [
            "property_list_service_client_new(device, service, &plistclient)"
          ],
          "line": 92
        },
        "resolved": true,
        "details": {
          "function_name": "np_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/notification_proxy.c",
          "lines": "72-87",
          "snippet": "static np_error_t np_error(property_list_service_error_t err)\n{\n\tswitch (err) {\n\t\tcase PROPERTY_LIST_SERVICE_E_SUCCESS:\n\t\t\treturn NP_E_SUCCESS;\n\t\tcase PROPERTY_LIST_SERVICE_E_INVALID_ARG:\n\t\t\treturn NP_E_INVALID_ARG;\n\t\tcase PROPERTY_LIST_SERVICE_E_PLIST_ERROR:\n\t\t\treturn NP_E_PLIST_ERROR;\n\t\tcase PROPERTY_LIST_SERVICE_E_MUX_ERROR:\n\t\t\treturn NP_E_CONN_FAILED;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn NP_E_UNKNOWN_ERROR;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include \"notification_proxy.h\"",
            "#include <plist/plist.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <string.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"notification_proxy.h\"\n#include <plist/plist.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <string.h>\n\nstatic np_error_t np_error(property_list_service_error_t err)\n{\n\tswitch (err) {\n\t\tcase PROPERTY_LIST_SERVICE_E_SUCCESS:\n\t\t\treturn NP_E_SUCCESS;\n\t\tcase PROPERTY_LIST_SERVICE_E_INVALID_ARG:\n\t\t\treturn NP_E_INVALID_ARG;\n\t\tcase PROPERTY_LIST_SERVICE_E_PLIST_ERROR:\n\t\t\treturn NP_E_PLIST_ERROR;\n\t\tcase PROPERTY_LIST_SERVICE_E_MUX_ERROR:\n\t\t\treturn NP_E_CONN_FAILED;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn NP_E_UNKNOWN_ERROR;\n}"
        }
      },
      {
        "call_info": {
          "callee": "property_list_service_client_new",
          "args": [
            "device",
            "service",
            "&plistclient"
          ],
          "line": 92
        },
        "resolved": true,
        "details": {
          "function_name": "property_list_service_client_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
          "lines": "57-75",
          "snippet": "LIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_client_new(idevice_t device, lockdownd_service_descriptor_t service, property_list_service_client_t *client)\n{\n\tif (!device || !service || service->port == 0 || !client || *client)\n\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\n\tservice_client_t parent = NULL;\n\tservice_error_t rerr = service_client_new(device, service, &parent);\n\tif (rerr != SERVICE_E_SUCCESS) {\n\t\treturn service_to_property_list_service_error(rerr);\n\t}\n\n\t/* create client object */\n\tproperty_list_service_client_t client_loc = (property_list_service_client_t)malloc(sizeof(struct property_list_service_client_private));\n\tclient_loc->parent = parent;\n\n\t/* all done, return success */\n\t*client = client_loc;\n\treturn PROPERTY_LIST_SERVICE_E_SUCCESS;\n}",
          "includes": [
            "#include \"endianness.h\"",
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_client_new(idevice_t device, lockdownd_service_descriptor_t service, property_list_service_client_t *client)\n{\n\tif (!device || !service || service->port == 0 || !client || *client)\n\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\n\tservice_client_t parent = NULL;\n\tservice_error_t rerr = service_client_new(device, service, &parent);\n\tif (rerr != SERVICE_E_SUCCESS) {\n\t\treturn service_to_property_list_service_error(rerr);\n\t}\n\n\t/* create client object */\n\tproperty_list_service_client_t client_loc = (property_list_service_client_t)malloc(sizeof(struct property_list_service_client_private));\n\tclient_loc->parent = parent;\n\n\t/* all done, return success */\n\t*client = client_loc;\n\treturn PROPERTY_LIST_SERVICE_E_SUCCESS;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"notification_proxy.h\"\n#include <plist/plist.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <string.h>\n\nLIBIMOBILEDEVICE_API np_error_t np_client_new(idevice_t device, lockdownd_service_descriptor_t service, np_client_t *client)\n{\n\tproperty_list_service_client_t plistclient = NULL;\n\tnp_error_t err = np_error(property_list_service_client_new(device, service, &plistclient));\n\tif (err != NP_E_SUCCESS) {\n\t\treturn err;\n\t}\n\n\tnp_client_t client_loc = (np_client_t) malloc(sizeof(struct np_client_private));\n\tclient_loc->parent = plistclient;\n\n\tmutex_init(&client_loc->mutex);\n\tclient_loc->notifier = (thread_t)NULL;\n\n\t*client = client_loc;\n\treturn NP_E_SUCCESS;\n}"
  },
  {
    "function_name": "np_error",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/notification_proxy.c",
    "lines": "72-87",
    "snippet": "static np_error_t np_error(property_list_service_error_t err)\n{\n\tswitch (err) {\n\t\tcase PROPERTY_LIST_SERVICE_E_SUCCESS:\n\t\t\treturn NP_E_SUCCESS;\n\t\tcase PROPERTY_LIST_SERVICE_E_INVALID_ARG:\n\t\t\treturn NP_E_INVALID_ARG;\n\t\tcase PROPERTY_LIST_SERVICE_E_PLIST_ERROR:\n\t\t\treturn NP_E_PLIST_ERROR;\n\t\tcase PROPERTY_LIST_SERVICE_E_MUX_ERROR:\n\t\t\treturn NP_E_CONN_FAILED;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn NP_E_UNKNOWN_ERROR;\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"property_list_service.h\"",
      "#include \"notification_proxy.h\"",
      "#include <plist/plist.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <string.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"notification_proxy.h\"\n#include <plist/plist.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <string.h>\n\nstatic np_error_t np_error(property_list_service_error_t err)\n{\n\tswitch (err) {\n\t\tcase PROPERTY_LIST_SERVICE_E_SUCCESS:\n\t\t\treturn NP_E_SUCCESS;\n\t\tcase PROPERTY_LIST_SERVICE_E_INVALID_ARG:\n\t\t\treturn NP_E_INVALID_ARG;\n\t\tcase PROPERTY_LIST_SERVICE_E_PLIST_ERROR:\n\t\t\treturn NP_E_PLIST_ERROR;\n\t\tcase PROPERTY_LIST_SERVICE_E_MUX_ERROR:\n\t\t\treturn NP_E_CONN_FAILED;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn NP_E_UNKNOWN_ERROR;\n}"
  },
  {
    "function_name": "np_unlock",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/notification_proxy.c",
    "lines": "57-61",
    "snippet": "static void np_unlock(np_client_t client)\n{\n\tdebug_info(\"Unlocked\");\n\tmutex_unlock(&client->mutex);\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"property_list_service.h\"",
      "#include \"notification_proxy.h\"",
      "#include <plist/plist.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <string.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "mutex_unlock",
          "args": [
            "&client->mutex"
          ],
          "line": 60
        },
        "resolved": true,
        "details": {
          "function_name": "mutex_unlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/common/thread.c",
          "lines": "83-90",
          "snippet": "void mutex_unlock(mutex_t* mutex)\n{\n#ifdef WIN32\n\tLeaveCriticalSection(mutex);\n#else\n\tpthread_mutex_unlock(mutex);\n#endif\n}",
          "includes": [
            "#include \"thread.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"thread.h\"\n\nvoid mutex_unlock(mutex_t* mutex)\n{\n#ifdef WIN32\n\tLeaveCriticalSection(mutex);\n#else\n\tpthread_mutex_unlock(mutex);\n#endif\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"Unlocked\""
          ],
          "line": 59
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"notification_proxy.h\"\n#include <plist/plist.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <string.h>\n\nstatic void np_unlock(np_client_t client)\n{\n\tdebug_info(\"Unlocked\");\n\tmutex_unlock(&client->mutex);\n}"
  },
  {
    "function_name": "np_lock",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/notification_proxy.c",
    "lines": "46-50",
    "snippet": "static void np_lock(np_client_t client)\n{\n\tdebug_info(\"Locked\");\n\tmutex_lock(&client->mutex);\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"property_list_service.h\"",
      "#include \"notification_proxy.h\"",
      "#include <plist/plist.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <string.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "mutex_lock",
          "args": [
            "&client->mutex"
          ],
          "line": 49
        },
        "resolved": true,
        "details": {
          "function_name": "mutex_lock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/common/thread.c",
          "lines": "74-81",
          "snippet": "void mutex_lock(mutex_t* mutex)\n{\n#ifdef WIN32\n\tEnterCriticalSection(mutex);\n#else\n\tpthread_mutex_lock(mutex);\n#endif\n}",
          "includes": [
            "#include \"thread.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"thread.h\"\n\nvoid mutex_lock(mutex_t* mutex)\n{\n#ifdef WIN32\n\tEnterCriticalSection(mutex);\n#else\n\tpthread_mutex_lock(mutex);\n#endif\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"Locked\""
          ],
          "line": 48
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"notification_proxy.h\"\n#include <plist/plist.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <string.h>\n\nstatic void np_lock(np_client_t client)\n{\n\tdebug_info(\"Locked\");\n\tmutex_lock(&client->mutex);\n}"
  }
]