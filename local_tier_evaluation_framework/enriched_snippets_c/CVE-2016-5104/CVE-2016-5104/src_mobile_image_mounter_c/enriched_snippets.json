[
  {
    "function_name": "mobile_image_mounter_hangup",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/mobile_image_mounter.c",
    "lines": "287-318",
    "snippet": "LIBIMOBILEDEVICE_API mobile_image_mounter_error_t mobile_image_mounter_hangup(mobile_image_mounter_client_t client)\n{\n\tif (!client) {\n\t\treturn MOBILE_IMAGE_MOUNTER_E_INVALID_ARG;\n\t}\n\tmobile_image_mounter_lock(client);\n\n\tplist_t dict = plist_new_dict();\n\tplist_dict_set_item(dict, \"Command\", plist_new_string(\"Hangup\"));\n\n\tmobile_image_mounter_error_t res = mobile_image_mounter_error(property_list_service_send_xml_plist(client->parent, dict));\n\tplist_free(dict);\n\n\tif (res != MOBILE_IMAGE_MOUNTER_E_SUCCESS) {\n\t\tdebug_info(\"%s: Error sending XML plist to device!\", __func__);\n\t\tgoto leave_unlock;\n\t}\n\n\tdict = NULL;\n\tres = mobile_image_mounter_error(property_list_service_receive_plist(client->parent, &dict));\n\tif (res != MOBILE_IMAGE_MOUNTER_E_SUCCESS) {\n\t\tdebug_info(\"%s: Error receiving response from device!\", __func__);\n\t}\n\tif (dict) {\n\t\tdebug_plist(dict);\n\t\tplist_free(dict);\n\t}\n\nleave_unlock:\n\tmobile_image_mounter_unlock(client);\n\treturn res;\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"property_list_service.h\"",
      "#include \"mobile_image_mounter.h\"",
      "#include <plist/plist.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <string.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "mobile_image_mounter_unlock",
          "args": [
            "client"
          ],
          "line": 316
        },
        "resolved": true,
        "details": {
          "function_name": "mobile_image_mounter_unlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/mobile_image_mounter.c",
          "lines": "46-49",
          "snippet": "static void mobile_image_mounter_unlock(mobile_image_mounter_client_t client)\n{\n\tmutex_unlock(&client->mutex);\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include \"mobile_image_mounter.h\"",
            "#include <plist/plist.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <string.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"mobile_image_mounter.h\"\n#include <plist/plist.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <string.h>\n\nstatic void mobile_image_mounter_unlock(mobile_image_mounter_client_t client)\n{\n\tmutex_unlock(&client->mutex);\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "dict"
          ],
          "line": 312
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_plist",
          "args": [
            "dict"
          ],
          "line": 311
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"%s: Error receiving response from device!\"",
            "__func__"
          ],
          "line": 308
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mobile_image_mounter_error",
          "args": [
            "property_list_service_receive_plist(client->parent, &dict)"
          ],
          "line": 306
        },
        "resolved": true,
        "details": {
          "function_name": "mobile_image_mounter_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/mobile_image_mounter.c",
          "lines": "61-76",
          "snippet": "static mobile_image_mounter_error_t mobile_image_mounter_error(property_list_service_error_t err)\n{\n\tswitch (err) {\n\t\tcase PROPERTY_LIST_SERVICE_E_SUCCESS:\n\t\t\treturn MOBILE_IMAGE_MOUNTER_E_SUCCESS;\n\t\tcase PROPERTY_LIST_SERVICE_E_INVALID_ARG:\n\t\t\treturn MOBILE_IMAGE_MOUNTER_E_INVALID_ARG;\n\t\tcase PROPERTY_LIST_SERVICE_E_PLIST_ERROR:\n\t\t\treturn MOBILE_IMAGE_MOUNTER_E_PLIST_ERROR;\n\t\tcase PROPERTY_LIST_SERVICE_E_MUX_ERROR:\n\t\t\treturn MOBILE_IMAGE_MOUNTER_E_CONN_FAILED;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn MOBILE_IMAGE_MOUNTER_E_UNKNOWN_ERROR;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include \"mobile_image_mounter.h\"",
            "#include <plist/plist.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <string.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"mobile_image_mounter.h\"\n#include <plist/plist.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <string.h>\n\nstatic mobile_image_mounter_error_t mobile_image_mounter_error(property_list_service_error_t err)\n{\n\tswitch (err) {\n\t\tcase PROPERTY_LIST_SERVICE_E_SUCCESS:\n\t\t\treturn MOBILE_IMAGE_MOUNTER_E_SUCCESS;\n\t\tcase PROPERTY_LIST_SERVICE_E_INVALID_ARG:\n\t\t\treturn MOBILE_IMAGE_MOUNTER_E_INVALID_ARG;\n\t\tcase PROPERTY_LIST_SERVICE_E_PLIST_ERROR:\n\t\t\treturn MOBILE_IMAGE_MOUNTER_E_PLIST_ERROR;\n\t\tcase PROPERTY_LIST_SERVICE_E_MUX_ERROR:\n\t\t\treturn MOBILE_IMAGE_MOUNTER_E_CONN_FAILED;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn MOBILE_IMAGE_MOUNTER_E_UNKNOWN_ERROR;\n}"
        }
      },
      {
        "call_info": {
          "callee": "property_list_service_receive_plist",
          "args": [
            "client->parent",
            "&dict"
          ],
          "line": 306
        },
        "resolved": true,
        "details": {
          "function_name": "property_list_service_receive_plist",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
          "lines": "258-261",
          "snippet": "LIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_receive_plist(property_list_service_client_t client, plist_t *plist)\n{\n\treturn internal_plist_receive_timeout(client, plist, 10000);\n}",
          "includes": [
            "#include \"endianness.h\"",
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_receive_plist(property_list_service_client_t client, plist_t *plist)\n{\n\treturn internal_plist_receive_timeout(client, plist, 10000);\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"%s: Error sending XML plist to device!\"",
            "__func__"
          ],
          "line": 301
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "dict"
          ],
          "line": 298
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "property_list_service_send_xml_plist",
          "args": [
            "client->parent",
            "dict"
          ],
          "line": 297
        },
        "resolved": true,
        "details": {
          "function_name": "property_list_service_send_xml_plist",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
          "lines": "150-153",
          "snippet": "LIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_send_xml_plist(property_list_service_client_t client, plist_t plist)\n{\n\treturn internal_plist_send(client, plist, 0);\n}",
          "includes": [
            "#include \"endianness.h\"",
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_send_xml_plist(property_list_service_client_t client, plist_t plist)\n{\n\treturn internal_plist_send(client, plist, 0);\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"Command\"",
            "plist_new_string(\"Hangup\")"
          ],
          "line": 295
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "\"Hangup\""
          ],
          "line": 295
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_dict",
          "args": [],
          "line": 294
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mobile_image_mounter_lock",
          "args": [
            "client"
          ],
          "line": 292
        },
        "resolved": true,
        "details": {
          "function_name": "mobile_image_mounter_lock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/mobile_image_mounter.c",
          "lines": "36-39",
          "snippet": "static void mobile_image_mounter_lock(mobile_image_mounter_client_t client)\n{\n\tmutex_lock(&client->mutex);\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include \"mobile_image_mounter.h\"",
            "#include <plist/plist.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <string.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"mobile_image_mounter.h\"\n#include <plist/plist.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <string.h>\n\nstatic void mobile_image_mounter_lock(mobile_image_mounter_client_t client)\n{\n\tmutex_lock(&client->mutex);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"mobile_image_mounter.h\"\n#include <plist/plist.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <string.h>\n\nLIBIMOBILEDEVICE_API mobile_image_mounter_error_t mobile_image_mounter_hangup(mobile_image_mounter_client_t client)\n{\n\tif (!client) {\n\t\treturn MOBILE_IMAGE_MOUNTER_E_INVALID_ARG;\n\t}\n\tmobile_image_mounter_lock(client);\n\n\tplist_t dict = plist_new_dict();\n\tplist_dict_set_item(dict, \"Command\", plist_new_string(\"Hangup\"));\n\n\tmobile_image_mounter_error_t res = mobile_image_mounter_error(property_list_service_send_xml_plist(client->parent, dict));\n\tplist_free(dict);\n\n\tif (res != MOBILE_IMAGE_MOUNTER_E_SUCCESS) {\n\t\tdebug_info(\"%s: Error sending XML plist to device!\", __func__);\n\t\tgoto leave_unlock;\n\t}\n\n\tdict = NULL;\n\tres = mobile_image_mounter_error(property_list_service_receive_plist(client->parent, &dict));\n\tif (res != MOBILE_IMAGE_MOUNTER_E_SUCCESS) {\n\t\tdebug_info(\"%s: Error receiving response from device!\", __func__);\n\t}\n\tif (dict) {\n\t\tdebug_plist(dict);\n\t\tplist_free(dict);\n\t}\n\nleave_unlock:\n\tmobile_image_mounter_unlock(client);\n\treturn res;\n}"
  },
  {
    "function_name": "mobile_image_mounter_mount_image",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/mobile_image_mounter.c",
    "lines": "255-285",
    "snippet": "LIBIMOBILEDEVICE_API mobile_image_mounter_error_t mobile_image_mounter_mount_image(mobile_image_mounter_client_t client, const char *image_path, const char *signature, uint16_t signature_size, const char *image_type, plist_t *result)\n{\n\tif (!client || !image_path || !image_type || !result) {\n\t\treturn MOBILE_IMAGE_MOUNTER_E_INVALID_ARG;\n\t}\n\tmobile_image_mounter_lock(client);\n\n\tplist_t dict = plist_new_dict();\n\tplist_dict_set_item(dict, \"Command\", plist_new_string(\"MountImage\"));\n\tplist_dict_set_item(dict, \"ImagePath\", plist_new_string(image_path));\n\tif (signature && signature_size != 0)\n\t\tplist_dict_set_item(dict, \"ImageSignature\", plist_new_data(signature, signature_size));\n\tplist_dict_set_item(dict, \"ImageType\", plist_new_string(image_type));\n\n\tmobile_image_mounter_error_t res = mobile_image_mounter_error(property_list_service_send_xml_plist(client->parent, dict));\n\tplist_free(dict);\n\n\tif (res != MOBILE_IMAGE_MOUNTER_E_SUCCESS) {\n\t\tdebug_info(\"%s: Error sending XML plist to device!\", __func__);\n\t\tgoto leave_unlock;\n\t}\n\n\tres = mobile_image_mounter_error(property_list_service_receive_plist(client->parent, result));\n\tif (res != MOBILE_IMAGE_MOUNTER_E_SUCCESS) {\n\t\tdebug_info(\"%s: Error receiving response from device!\", __func__);\n\t}\n\nleave_unlock:\n\tmobile_image_mounter_unlock(client);\n\treturn res;\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"property_list_service.h\"",
      "#include \"mobile_image_mounter.h\"",
      "#include <plist/plist.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <string.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "mobile_image_mounter_unlock",
          "args": [
            "client"
          ],
          "line": 283
        },
        "resolved": true,
        "details": {
          "function_name": "mobile_image_mounter_unlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/mobile_image_mounter.c",
          "lines": "46-49",
          "snippet": "static void mobile_image_mounter_unlock(mobile_image_mounter_client_t client)\n{\n\tmutex_unlock(&client->mutex);\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include \"mobile_image_mounter.h\"",
            "#include <plist/plist.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <string.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"mobile_image_mounter.h\"\n#include <plist/plist.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <string.h>\n\nstatic void mobile_image_mounter_unlock(mobile_image_mounter_client_t client)\n{\n\tmutex_unlock(&client->mutex);\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"%s: Error receiving response from device!\"",
            "__func__"
          ],
          "line": 279
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mobile_image_mounter_error",
          "args": [
            "property_list_service_receive_plist(client->parent, result)"
          ],
          "line": 277
        },
        "resolved": true,
        "details": {
          "function_name": "mobile_image_mounter_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/mobile_image_mounter.c",
          "lines": "61-76",
          "snippet": "static mobile_image_mounter_error_t mobile_image_mounter_error(property_list_service_error_t err)\n{\n\tswitch (err) {\n\t\tcase PROPERTY_LIST_SERVICE_E_SUCCESS:\n\t\t\treturn MOBILE_IMAGE_MOUNTER_E_SUCCESS;\n\t\tcase PROPERTY_LIST_SERVICE_E_INVALID_ARG:\n\t\t\treturn MOBILE_IMAGE_MOUNTER_E_INVALID_ARG;\n\t\tcase PROPERTY_LIST_SERVICE_E_PLIST_ERROR:\n\t\t\treturn MOBILE_IMAGE_MOUNTER_E_PLIST_ERROR;\n\t\tcase PROPERTY_LIST_SERVICE_E_MUX_ERROR:\n\t\t\treturn MOBILE_IMAGE_MOUNTER_E_CONN_FAILED;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn MOBILE_IMAGE_MOUNTER_E_UNKNOWN_ERROR;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include \"mobile_image_mounter.h\"",
            "#include <plist/plist.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <string.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"mobile_image_mounter.h\"\n#include <plist/plist.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <string.h>\n\nstatic mobile_image_mounter_error_t mobile_image_mounter_error(property_list_service_error_t err)\n{\n\tswitch (err) {\n\t\tcase PROPERTY_LIST_SERVICE_E_SUCCESS:\n\t\t\treturn MOBILE_IMAGE_MOUNTER_E_SUCCESS;\n\t\tcase PROPERTY_LIST_SERVICE_E_INVALID_ARG:\n\t\t\treturn MOBILE_IMAGE_MOUNTER_E_INVALID_ARG;\n\t\tcase PROPERTY_LIST_SERVICE_E_PLIST_ERROR:\n\t\t\treturn MOBILE_IMAGE_MOUNTER_E_PLIST_ERROR;\n\t\tcase PROPERTY_LIST_SERVICE_E_MUX_ERROR:\n\t\t\treturn MOBILE_IMAGE_MOUNTER_E_CONN_FAILED;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn MOBILE_IMAGE_MOUNTER_E_UNKNOWN_ERROR;\n}"
        }
      },
      {
        "call_info": {
          "callee": "property_list_service_receive_plist",
          "args": [
            "client->parent",
            "result"
          ],
          "line": 277
        },
        "resolved": true,
        "details": {
          "function_name": "property_list_service_receive_plist",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
          "lines": "258-261",
          "snippet": "LIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_receive_plist(property_list_service_client_t client, plist_t *plist)\n{\n\treturn internal_plist_receive_timeout(client, plist, 10000);\n}",
          "includes": [
            "#include \"endianness.h\"",
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_receive_plist(property_list_service_client_t client, plist_t *plist)\n{\n\treturn internal_plist_receive_timeout(client, plist, 10000);\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"%s: Error sending XML plist to device!\"",
            "__func__"
          ],
          "line": 273
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "dict"
          ],
          "line": 270
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "property_list_service_send_xml_plist",
          "args": [
            "client->parent",
            "dict"
          ],
          "line": 269
        },
        "resolved": true,
        "details": {
          "function_name": "property_list_service_send_xml_plist",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
          "lines": "150-153",
          "snippet": "LIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_send_xml_plist(property_list_service_client_t client, plist_t plist)\n{\n\treturn internal_plist_send(client, plist, 0);\n}",
          "includes": [
            "#include \"endianness.h\"",
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_send_xml_plist(property_list_service_client_t client, plist_t plist)\n{\n\treturn internal_plist_send(client, plist, 0);\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"ImageType\"",
            "plist_new_string(image_type)"
          ],
          "line": 267
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "image_type"
          ],
          "line": 267
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"ImageSignature\"",
            "plist_new_data(signature, signature_size)"
          ],
          "line": 266
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_data",
          "args": [
            "signature",
            "signature_size"
          ],
          "line": 266
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"ImagePath\"",
            "plist_new_string(image_path)"
          ],
          "line": 264
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "image_path"
          ],
          "line": 264
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"Command\"",
            "plist_new_string(\"MountImage\")"
          ],
          "line": 263
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "\"MountImage\""
          ],
          "line": 263
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_dict",
          "args": [],
          "line": 262
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mobile_image_mounter_lock",
          "args": [
            "client"
          ],
          "line": 260
        },
        "resolved": true,
        "details": {
          "function_name": "mobile_image_mounter_lock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/mobile_image_mounter.c",
          "lines": "36-39",
          "snippet": "static void mobile_image_mounter_lock(mobile_image_mounter_client_t client)\n{\n\tmutex_lock(&client->mutex);\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include \"mobile_image_mounter.h\"",
            "#include <plist/plist.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <string.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"mobile_image_mounter.h\"\n#include <plist/plist.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <string.h>\n\nstatic void mobile_image_mounter_lock(mobile_image_mounter_client_t client)\n{\n\tmutex_lock(&client->mutex);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"mobile_image_mounter.h\"\n#include <plist/plist.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <string.h>\n\nLIBIMOBILEDEVICE_API mobile_image_mounter_error_t mobile_image_mounter_mount_image(mobile_image_mounter_client_t client, const char *image_path, const char *signature, uint16_t signature_size, const char *image_type, plist_t *result)\n{\n\tif (!client || !image_path || !image_type || !result) {\n\t\treturn MOBILE_IMAGE_MOUNTER_E_INVALID_ARG;\n\t}\n\tmobile_image_mounter_lock(client);\n\n\tplist_t dict = plist_new_dict();\n\tplist_dict_set_item(dict, \"Command\", plist_new_string(\"MountImage\"));\n\tplist_dict_set_item(dict, \"ImagePath\", plist_new_string(image_path));\n\tif (signature && signature_size != 0)\n\t\tplist_dict_set_item(dict, \"ImageSignature\", plist_new_data(signature, signature_size));\n\tplist_dict_set_item(dict, \"ImageType\", plist_new_string(image_type));\n\n\tmobile_image_mounter_error_t res = mobile_image_mounter_error(property_list_service_send_xml_plist(client->parent, dict));\n\tplist_free(dict);\n\n\tif (res != MOBILE_IMAGE_MOUNTER_E_SUCCESS) {\n\t\tdebug_info(\"%s: Error sending XML plist to device!\", __func__);\n\t\tgoto leave_unlock;\n\t}\n\n\tres = mobile_image_mounter_error(property_list_service_receive_plist(client->parent, result));\n\tif (res != MOBILE_IMAGE_MOUNTER_E_SUCCESS) {\n\t\tdebug_info(\"%s: Error receiving response from device!\", __func__);\n\t}\n\nleave_unlock:\n\tmobile_image_mounter_unlock(client);\n\treturn res;\n}"
  },
  {
    "function_name": "mobile_image_mounter_upload_image",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/mobile_image_mounter.c",
    "lines": "144-253",
    "snippet": "LIBIMOBILEDEVICE_API mobile_image_mounter_error_t mobile_image_mounter_upload_image(mobile_image_mounter_client_t client, const char *image_type, size_t image_size, const char *signature, uint16_t signature_size, mobile_image_mounter_upload_cb_t upload_cb, void* userdata)\n{\n\tif (!client || !image_type || (image_size == 0) || !upload_cb) {\n\t\treturn MOBILE_IMAGE_MOUNTER_E_INVALID_ARG;\n\t}\n\tmobile_image_mounter_lock(client);\n\tplist_t result = NULL;\n\n\tplist_t dict = plist_new_dict();\n\tplist_dict_set_item(dict, \"Command\", plist_new_string(\"ReceiveBytes\"));\n\tif (signature && signature_size != 0)\n\t\tplist_dict_set_item(dict, \"ImageSignature\", plist_new_data(signature, signature_size));\n\tplist_dict_set_item(dict, \"ImageSize\", plist_new_uint(image_size));\n\tplist_dict_set_item(dict, \"ImageType\", plist_new_string(image_type));\n\n\tmobile_image_mounter_error_t res = mobile_image_mounter_error(property_list_service_send_xml_plist(client->parent, dict));\n\tplist_free(dict);\n\n\tif (res != MOBILE_IMAGE_MOUNTER_E_SUCCESS) {\n\t\tdebug_info(\"Error sending XML plist to device!\");\n\t\tgoto leave_unlock;\n\t}\n\n\tres = mobile_image_mounter_error(property_list_service_receive_plist(client->parent, &result));\n\tif (res != MOBILE_IMAGE_MOUNTER_E_SUCCESS) {\n\t\tdebug_info(\"Error receiving response from device!\");\n\t\tgoto leave_unlock;\n\t}\n\tres = MOBILE_IMAGE_MOUNTER_E_COMMAND_FAILED;\n\n\tchar* strval = NULL;\n\tplist_t node = plist_dict_get_item(result, \"Status\");\n\tif (node && plist_get_node_type(node) == PLIST_STRING) {\n\t\tplist_get_string_val(node, &strval);\n\t}\n\tif (!strval) {\n\t\tdebug_info(\"Error: Unexpected response received!\");\n\t\tgoto leave_unlock;\n\t}\n\tif (strcmp(strval, \"ReceiveBytesAck\") != 0) {\n\t\tdebug_info(\"Error: didn't get ReceiveBytesAck but %s\", strval);\n\t\tfree(strval);\n\t\tgoto leave_unlock;\n\t}\n\tfree(strval);\n\n\tsize_t tx = 0;\n\tsize_t bufsize = 65536;\n\tunsigned char *buf = (unsigned char*)malloc(bufsize);\n\tif (!buf) {\n\t\tdebug_info(\"Out of memory\");\n\t\tres = MOBILE_IMAGE_MOUNTER_E_UNKNOWN_ERROR;\n\t\tgoto leave_unlock;\n\t}\n\tdebug_info(\"uploading image (%d bytes)\", (int)image_size);\n\twhile (tx < image_size) {\n\t\tsize_t remaining = image_size - tx;\n\t\tsize_t amount = (remaining < bufsize) ? remaining : bufsize;\n\t\tssize_t r = upload_cb(buf, amount, userdata);\n\t\tif (r < 0) {\n\t\t\tdebug_info(\"upload_cb returned %d\", (int)r);\n\t\t\tbreak;\n\t\t}\n\t\tuint32_t sent = 0;\n\t\tif (service_send(client->parent->parent, (const char*)buf, (uint32_t)r, &sent) != SERVICE_E_SUCCESS) {\n\t\t\tdebug_info(\"service_send failed\");\n\t\t\tbreak;\n\t\t}\n\t\ttx += r;\n\t}\n\tfree(buf);\n\tif (tx < image_size) {\n\t\tdebug_info(\"Error: failed to upload image\");\n\t\tgoto leave_unlock;\n\t}\n\tdebug_info(\"image uploaded\");\n\n\tres = mobile_image_mounter_error(property_list_service_receive_plist(client->parent, &result));\n\tif (res != MOBILE_IMAGE_MOUNTER_E_SUCCESS) {\n\t\tdebug_info(\"Error receiving response from device!\");\n\t\tgoto leave_unlock;\n\t}\n\tres = MOBILE_IMAGE_MOUNTER_E_COMMAND_FAILED;\n\n\tstrval = NULL;\n\tnode = plist_dict_get_item(result, \"Status\");\n\tif (node && plist_get_node_type(node) == PLIST_STRING) {\n\t\tplist_get_string_val(node, &strval);\n\t}\n\tif (!strval) {\n\t\tdebug_info(\"Error: Unexpected response received!\");\n\t\tgoto leave_unlock;\n\t}\n\tif (strcmp(strval, \"Complete\") != 0) {\n\t\tdebug_info(\"Error: didn't get Complete but %s\", strval);\n\t\tfree(strval);\n\t\tgoto leave_unlock;\n\t} else {\n\t\tres = MOBILE_IMAGE_MOUNTER_E_SUCCESS;\n\t}\n\tfree(strval);\n\n\nleave_unlock:\n\tmobile_image_mounter_unlock(client);\n\tif (result)\n\t\tplist_free(result);\n\treturn res;\n\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"property_list_service.h\"",
      "#include \"mobile_image_mounter.h\"",
      "#include <plist/plist.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <string.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "result"
          ],
          "line": 250
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mobile_image_mounter_unlock",
          "args": [
            "client"
          ],
          "line": 248
        },
        "resolved": true,
        "details": {
          "function_name": "mobile_image_mounter_unlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/mobile_image_mounter.c",
          "lines": "46-49",
          "snippet": "static void mobile_image_mounter_unlock(mobile_image_mounter_client_t client)\n{\n\tmutex_unlock(&client->mutex);\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include \"mobile_image_mounter.h\"",
            "#include <plist/plist.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <string.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"mobile_image_mounter.h\"\n#include <plist/plist.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <string.h>\n\nstatic void mobile_image_mounter_unlock(mobile_image_mounter_client_t client)\n{\n\tmutex_unlock(&client->mutex);\n}"
        }
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "strval"
          ],
          "line": 244
        },
        "resolved": true,
        "details": {
          "function_name": "mobile_image_mounter_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/mobile_image_mounter.c",
          "lines": "102-113",
          "snippet": "LIBIMOBILEDEVICE_API mobile_image_mounter_error_t mobile_image_mounter_free(mobile_image_mounter_client_t client)\n{\n\tif (!client)\n\t\treturn MOBILE_IMAGE_MOUNTER_E_INVALID_ARG;\n\n\tproperty_list_service_client_free(client->parent);\n\tclient->parent = NULL;\n\tmutex_destroy(&client->mutex);\n\tfree(client);\n\n\treturn MOBILE_IMAGE_MOUNTER_E_SUCCESS;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include \"mobile_image_mounter.h\"",
            "#include <plist/plist.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <string.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"mobile_image_mounter.h\"\n#include <plist/plist.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <string.h>\n\nLIBIMOBILEDEVICE_API mobile_image_mounter_error_t mobile_image_mounter_free(mobile_image_mounter_client_t client)\n{\n\tif (!client)\n\t\treturn MOBILE_IMAGE_MOUNTER_E_INVALID_ARG;\n\n\tproperty_list_service_client_free(client->parent);\n\tclient->parent = NULL;\n\tmutex_destroy(&client->mutex);\n\tfree(client);\n\n\treturn MOBILE_IMAGE_MOUNTER_E_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"Error: didn't get Complete but %s\"",
            "strval"
          ],
          "line": 238
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "strval",
            "\"Complete\""
          ],
          "line": 237
        },
        "resolved": true,
        "details": {
          "function_name": "plist_strcmp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/tools/idevicebackup.c",
          "lines": "296-309",
          "snippet": "static int plist_strcmp(plist_t node, const char *str)\n{\n\tchar *buffer = NULL;\n\tint ret = 0;\n\n\tif (plist_get_node_type(node) != PLIST_STRING)\n\t\treturn ret;\n\n\tplist_get_string_val(node, &buffer);\n\tret = strcmp(buffer, str);\n\tfree(buffer);\n\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"common/utils.h\"",
            "#include <libimobiledevice/afc.h>",
            "#include <libimobiledevice/notification_proxy.h>",
            "#include <libimobiledevice/mobilebackup.h>",
            "#include <libimobiledevice/lockdown.h>",
            "#include <libimobiledevice/libimobiledevice.h>",
            "#include <time.h>",
            "#include <ctype.h>",
            "#include <unistd.h>",
            "#include <gcrypt.h>",
            "#include <openssl/sha.h>",
            "#include <signal.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"common/utils.h\"\n#include <libimobiledevice/afc.h>\n#include <libimobiledevice/notification_proxy.h>\n#include <libimobiledevice/mobilebackup.h>\n#include <libimobiledevice/lockdown.h>\n#include <libimobiledevice/libimobiledevice.h>\n#include <time.h>\n#include <ctype.h>\n#include <unistd.h>\n#include <gcrypt.h>\n#include <openssl/sha.h>\n#include <signal.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int plist_strcmp(plist_t node, const char *str)\n{\n\tchar *buffer = NULL;\n\tint ret = 0;\n\n\tif (plist_get_node_type(node) != PLIST_STRING)\n\t\treturn ret;\n\n\tplist_get_string_val(node, &buffer);\n\tret = strcmp(buffer, str);\n\tfree(buffer);\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"Error: Unexpected response received!\""
          ],
          "line": 234
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_get_string_val",
          "args": [
            "node",
            "&strval"
          ],
          "line": 231
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_get_node_type",
          "args": [
            "node"
          ],
          "line": 230
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_get_item",
          "args": [
            "result",
            "\"Status\""
          ],
          "line": 229
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"Error receiving response from device!\""
          ],
          "line": 223
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mobile_image_mounter_error",
          "args": [
            "property_list_service_receive_plist(client->parent, &result)"
          ],
          "line": 221
        },
        "resolved": true,
        "details": {
          "function_name": "mobile_image_mounter_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/mobile_image_mounter.c",
          "lines": "61-76",
          "snippet": "static mobile_image_mounter_error_t mobile_image_mounter_error(property_list_service_error_t err)\n{\n\tswitch (err) {\n\t\tcase PROPERTY_LIST_SERVICE_E_SUCCESS:\n\t\t\treturn MOBILE_IMAGE_MOUNTER_E_SUCCESS;\n\t\tcase PROPERTY_LIST_SERVICE_E_INVALID_ARG:\n\t\t\treturn MOBILE_IMAGE_MOUNTER_E_INVALID_ARG;\n\t\tcase PROPERTY_LIST_SERVICE_E_PLIST_ERROR:\n\t\t\treturn MOBILE_IMAGE_MOUNTER_E_PLIST_ERROR;\n\t\tcase PROPERTY_LIST_SERVICE_E_MUX_ERROR:\n\t\t\treturn MOBILE_IMAGE_MOUNTER_E_CONN_FAILED;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn MOBILE_IMAGE_MOUNTER_E_UNKNOWN_ERROR;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include \"mobile_image_mounter.h\"",
            "#include <plist/plist.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <string.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"mobile_image_mounter.h\"\n#include <plist/plist.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <string.h>\n\nstatic mobile_image_mounter_error_t mobile_image_mounter_error(property_list_service_error_t err)\n{\n\tswitch (err) {\n\t\tcase PROPERTY_LIST_SERVICE_E_SUCCESS:\n\t\t\treturn MOBILE_IMAGE_MOUNTER_E_SUCCESS;\n\t\tcase PROPERTY_LIST_SERVICE_E_INVALID_ARG:\n\t\t\treturn MOBILE_IMAGE_MOUNTER_E_INVALID_ARG;\n\t\tcase PROPERTY_LIST_SERVICE_E_PLIST_ERROR:\n\t\t\treturn MOBILE_IMAGE_MOUNTER_E_PLIST_ERROR;\n\t\tcase PROPERTY_LIST_SERVICE_E_MUX_ERROR:\n\t\t\treturn MOBILE_IMAGE_MOUNTER_E_CONN_FAILED;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn MOBILE_IMAGE_MOUNTER_E_UNKNOWN_ERROR;\n}"
        }
      },
      {
        "call_info": {
          "callee": "property_list_service_receive_plist",
          "args": [
            "client->parent",
            "&result"
          ],
          "line": 221
        },
        "resolved": true,
        "details": {
          "function_name": "property_list_service_receive_plist",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
          "lines": "258-261",
          "snippet": "LIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_receive_plist(property_list_service_client_t client, plist_t *plist)\n{\n\treturn internal_plist_receive_timeout(client, plist, 10000);\n}",
          "includes": [
            "#include \"endianness.h\"",
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_receive_plist(property_list_service_client_t client, plist_t *plist)\n{\n\treturn internal_plist_receive_timeout(client, plist, 10000);\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"image uploaded\""
          ],
          "line": 219
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"Error: failed to upload image\""
          ],
          "line": 216
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"service_send failed\""
          ],
          "line": 209
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "service_send",
          "args": [
            "client->parent->parent",
            "(const char*)buf",
            "(uint32_t)r",
            "&sent"
          ],
          "line": 208
        },
        "resolved": true,
        "details": {
          "function_name": "service_send",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/service.c",
          "lines": "131-150",
          "snippet": "LIBIMOBILEDEVICE_API service_error_t service_send(service_client_t client, const char* data, uint32_t size, uint32_t *sent)\n{\n\tservice_error_t res = SERVICE_E_UNKNOWN_ERROR;\n\tint bytes = 0;\n\n\tif (!client || (client && !client->connection) || !data || (size == 0)) {\n\t\treturn SERVICE_E_INVALID_ARG;\n\t}\n\n\tdebug_info(\"sending %d bytes\", size);\n\tres = idevice_to_service_error(idevice_connection_send(client->connection, data, size, (uint32_t*)&bytes));\n\tif (bytes <= 0) {\n\t\tdebug_info(\"ERROR: sending to device failed.\");\n\t}\n\tif (sent) {\n\t\t*sent = (uint32_t)bytes;\n\t}\n\n\treturn res;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API service_error_t service_send(service_client_t client, const char* data, uint32_t size, uint32_t *sent)\n{\n\tservice_error_t res = SERVICE_E_UNKNOWN_ERROR;\n\tint bytes = 0;\n\n\tif (!client || (client && !client->connection) || !data || (size == 0)) {\n\t\treturn SERVICE_E_INVALID_ARG;\n\t}\n\n\tdebug_info(\"sending %d bytes\", size);\n\tres = idevice_to_service_error(idevice_connection_send(client->connection, data, size, (uint32_t*)&bytes));\n\tif (bytes <= 0) {\n\t\tdebug_info(\"ERROR: sending to device failed.\");\n\t}\n\tif (sent) {\n\t\t*sent = (uint32_t)bytes;\n\t}\n\n\treturn res;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"upload_cb returned %d\"",
            "(int)r"
          ],
          "line": 204
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "upload_cb",
          "args": [
            "buf",
            "amount",
            "userdata"
          ],
          "line": 202
        },
        "resolved": true,
        "details": {
          "function_name": "mim_upload_cb",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/tools/ideviceimagemounter.c",
          "lines": "137-140",
          "snippet": "static ssize_t mim_upload_cb(void* buf, size_t size, void* userdata)\n{\n\treturn fread(buf, 1, size, (FILE*)userdata);\n}",
          "includes": [
            "#include \"common/utils.h\"",
            "#include <asprintf.h>",
            "#include <libimobiledevice/mobile_image_mounter.h>",
            "#include <libimobiledevice/notification_proxy.h>",
            "#include <libimobiledevice/afc.h>",
            "#include <libimobiledevice/lockdown.h>",
            "#include <libimobiledevice/libimobiledevice.h>",
            "#include <inttypes.h>",
            "#include <sys/time.h>",
            "#include <time.h>",
            "#include <libgen.h>",
            "#include <errno.h>",
            "#include <getopt.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/utils.h\"\n#include <asprintf.h>\n#include <libimobiledevice/mobile_image_mounter.h>\n#include <libimobiledevice/notification_proxy.h>\n#include <libimobiledevice/afc.h>\n#include <libimobiledevice/lockdown.h>\n#include <libimobiledevice/libimobiledevice.h>\n#include <inttypes.h>\n#include <sys/time.h>\n#include <time.h>\n#include <libgen.h>\n#include <errno.h>\n#include <getopt.h>\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic ssize_t mim_upload_cb(void* buf, size_t size, void* userdata)\n{\n\treturn fread(buf, 1, size, (FILE*)userdata);\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"uploading image (%d bytes)\"",
            "(int)image_size"
          ],
          "line": 198
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"Out of memory\""
          ],
          "line": 194
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "malloc",
          "args": [
            "bufsize"
          ],
          "line": 192
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"Error: didn't get ReceiveBytesAck but %s\"",
            "strval"
          ],
          "line": 184
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"Error: Unexpected response received!\""
          ],
          "line": 180
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_get_string_val",
          "args": [
            "node",
            "&strval"
          ],
          "line": 177
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_get_node_type",
          "args": [
            "node"
          ],
          "line": 176
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_get_item",
          "args": [
            "result",
            "\"Status\""
          ],
          "line": 175
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"Error receiving response from device!\""
          ],
          "line": 169
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"Error sending XML plist to device!\""
          ],
          "line": 163
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "dict"
          ],
          "line": 160
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "property_list_service_send_xml_plist",
          "args": [
            "client->parent",
            "dict"
          ],
          "line": 159
        },
        "resolved": true,
        "details": {
          "function_name": "property_list_service_send_xml_plist",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
          "lines": "150-153",
          "snippet": "LIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_send_xml_plist(property_list_service_client_t client, plist_t plist)\n{\n\treturn internal_plist_send(client, plist, 0);\n}",
          "includes": [
            "#include \"endianness.h\"",
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_send_xml_plist(property_list_service_client_t client, plist_t plist)\n{\n\treturn internal_plist_send(client, plist, 0);\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"ImageType\"",
            "plist_new_string(image_type)"
          ],
          "line": 157
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "image_type"
          ],
          "line": 157
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"ImageSize\"",
            "plist_new_uint(image_size)"
          ],
          "line": 156
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_uint",
          "args": [
            "image_size"
          ],
          "line": 156
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"ImageSignature\"",
            "plist_new_data(signature, signature_size)"
          ],
          "line": 155
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_data",
          "args": [
            "signature",
            "signature_size"
          ],
          "line": 155
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"Command\"",
            "plist_new_string(\"ReceiveBytes\")"
          ],
          "line": 153
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "\"ReceiveBytes\""
          ],
          "line": 153
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_dict",
          "args": [],
          "line": 152
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mobile_image_mounter_lock",
          "args": [
            "client"
          ],
          "line": 149
        },
        "resolved": true,
        "details": {
          "function_name": "mobile_image_mounter_lock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/mobile_image_mounter.c",
          "lines": "36-39",
          "snippet": "static void mobile_image_mounter_lock(mobile_image_mounter_client_t client)\n{\n\tmutex_lock(&client->mutex);\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include \"mobile_image_mounter.h\"",
            "#include <plist/plist.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <string.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"mobile_image_mounter.h\"\n#include <plist/plist.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <string.h>\n\nstatic void mobile_image_mounter_lock(mobile_image_mounter_client_t client)\n{\n\tmutex_lock(&client->mutex);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"mobile_image_mounter.h\"\n#include <plist/plist.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <string.h>\n\nLIBIMOBILEDEVICE_API mobile_image_mounter_error_t mobile_image_mounter_upload_image(mobile_image_mounter_client_t client, const char *image_type, size_t image_size, const char *signature, uint16_t signature_size, mobile_image_mounter_upload_cb_t upload_cb, void* userdata)\n{\n\tif (!client || !image_type || (image_size == 0) || !upload_cb) {\n\t\treturn MOBILE_IMAGE_MOUNTER_E_INVALID_ARG;\n\t}\n\tmobile_image_mounter_lock(client);\n\tplist_t result = NULL;\n\n\tplist_t dict = plist_new_dict();\n\tplist_dict_set_item(dict, \"Command\", plist_new_string(\"ReceiveBytes\"));\n\tif (signature && signature_size != 0)\n\t\tplist_dict_set_item(dict, \"ImageSignature\", plist_new_data(signature, signature_size));\n\tplist_dict_set_item(dict, \"ImageSize\", plist_new_uint(image_size));\n\tplist_dict_set_item(dict, \"ImageType\", plist_new_string(image_type));\n\n\tmobile_image_mounter_error_t res = mobile_image_mounter_error(property_list_service_send_xml_plist(client->parent, dict));\n\tplist_free(dict);\n\n\tif (res != MOBILE_IMAGE_MOUNTER_E_SUCCESS) {\n\t\tdebug_info(\"Error sending XML plist to device!\");\n\t\tgoto leave_unlock;\n\t}\n\n\tres = mobile_image_mounter_error(property_list_service_receive_plist(client->parent, &result));\n\tif (res != MOBILE_IMAGE_MOUNTER_E_SUCCESS) {\n\t\tdebug_info(\"Error receiving response from device!\");\n\t\tgoto leave_unlock;\n\t}\n\tres = MOBILE_IMAGE_MOUNTER_E_COMMAND_FAILED;\n\n\tchar* strval = NULL;\n\tplist_t node = plist_dict_get_item(result, \"Status\");\n\tif (node && plist_get_node_type(node) == PLIST_STRING) {\n\t\tplist_get_string_val(node, &strval);\n\t}\n\tif (!strval) {\n\t\tdebug_info(\"Error: Unexpected response received!\");\n\t\tgoto leave_unlock;\n\t}\n\tif (strcmp(strval, \"ReceiveBytesAck\") != 0) {\n\t\tdebug_info(\"Error: didn't get ReceiveBytesAck but %s\", strval);\n\t\tfree(strval);\n\t\tgoto leave_unlock;\n\t}\n\tfree(strval);\n\n\tsize_t tx = 0;\n\tsize_t bufsize = 65536;\n\tunsigned char *buf = (unsigned char*)malloc(bufsize);\n\tif (!buf) {\n\t\tdebug_info(\"Out of memory\");\n\t\tres = MOBILE_IMAGE_MOUNTER_E_UNKNOWN_ERROR;\n\t\tgoto leave_unlock;\n\t}\n\tdebug_info(\"uploading image (%d bytes)\", (int)image_size);\n\twhile (tx < image_size) {\n\t\tsize_t remaining = image_size - tx;\n\t\tsize_t amount = (remaining < bufsize) ? remaining : bufsize;\n\t\tssize_t r = upload_cb(buf, amount, userdata);\n\t\tif (r < 0) {\n\t\t\tdebug_info(\"upload_cb returned %d\", (int)r);\n\t\t\tbreak;\n\t\t}\n\t\tuint32_t sent = 0;\n\t\tif (service_send(client->parent->parent, (const char*)buf, (uint32_t)r, &sent) != SERVICE_E_SUCCESS) {\n\t\t\tdebug_info(\"service_send failed\");\n\t\t\tbreak;\n\t\t}\n\t\ttx += r;\n\t}\n\tfree(buf);\n\tif (tx < image_size) {\n\t\tdebug_info(\"Error: failed to upload image\");\n\t\tgoto leave_unlock;\n\t}\n\tdebug_info(\"image uploaded\");\n\n\tres = mobile_image_mounter_error(property_list_service_receive_plist(client->parent, &result));\n\tif (res != MOBILE_IMAGE_MOUNTER_E_SUCCESS) {\n\t\tdebug_info(\"Error receiving response from device!\");\n\t\tgoto leave_unlock;\n\t}\n\tres = MOBILE_IMAGE_MOUNTER_E_COMMAND_FAILED;\n\n\tstrval = NULL;\n\tnode = plist_dict_get_item(result, \"Status\");\n\tif (node && plist_get_node_type(node) == PLIST_STRING) {\n\t\tplist_get_string_val(node, &strval);\n\t}\n\tif (!strval) {\n\t\tdebug_info(\"Error: Unexpected response received!\");\n\t\tgoto leave_unlock;\n\t}\n\tif (strcmp(strval, \"Complete\") != 0) {\n\t\tdebug_info(\"Error: didn't get Complete but %s\", strval);\n\t\tfree(strval);\n\t\tgoto leave_unlock;\n\t} else {\n\t\tres = MOBILE_IMAGE_MOUNTER_E_SUCCESS;\n\t}\n\tfree(strval);\n\n\nleave_unlock:\n\tmobile_image_mounter_unlock(client);\n\tif (result)\n\t\tplist_free(result);\n\treturn res;\n\n}"
  },
  {
    "function_name": "mobile_image_mounter_lookup_image",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/mobile_image_mounter.c",
    "lines": "115-142",
    "snippet": "LIBIMOBILEDEVICE_API mobile_image_mounter_error_t mobile_image_mounter_lookup_image(mobile_image_mounter_client_t client, const char *image_type, plist_t *result)\n{\n\tif (!client || !image_type || !result) {\n\t\treturn MOBILE_IMAGE_MOUNTER_E_INVALID_ARG;\n\t}\n\tmobile_image_mounter_lock(client);\n\n\tplist_t dict = plist_new_dict();\n\tplist_dict_set_item(dict,\"Command\", plist_new_string(\"LookupImage\"));\n\tplist_dict_set_item(dict,\"ImageType\", plist_new_string(image_type));\n\n\tmobile_image_mounter_error_t res = mobile_image_mounter_error(property_list_service_send_xml_plist(client->parent, dict));\n\tplist_free(dict);\n\n\tif (res != MOBILE_IMAGE_MOUNTER_E_SUCCESS) {\n\t\tdebug_info(\"%s: Error sending XML plist to device!\", __func__);\n\t\tgoto leave_unlock;\n\t}\n\n\tres = mobile_image_mounter_error(property_list_service_receive_plist(client->parent, result));\n\tif (res != MOBILE_IMAGE_MOUNTER_E_SUCCESS) {\n\t\tdebug_info(\"%s: Error receiving response from device!\", __func__);\n\t}\n\nleave_unlock:\n\tmobile_image_mounter_unlock(client);\n\treturn res;\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"property_list_service.h\"",
      "#include \"mobile_image_mounter.h\"",
      "#include <plist/plist.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <string.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "mobile_image_mounter_unlock",
          "args": [
            "client"
          ],
          "line": 140
        },
        "resolved": true,
        "details": {
          "function_name": "mobile_image_mounter_unlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/mobile_image_mounter.c",
          "lines": "46-49",
          "snippet": "static void mobile_image_mounter_unlock(mobile_image_mounter_client_t client)\n{\n\tmutex_unlock(&client->mutex);\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include \"mobile_image_mounter.h\"",
            "#include <plist/plist.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <string.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"mobile_image_mounter.h\"\n#include <plist/plist.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <string.h>\n\nstatic void mobile_image_mounter_unlock(mobile_image_mounter_client_t client)\n{\n\tmutex_unlock(&client->mutex);\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"%s: Error receiving response from device!\"",
            "__func__"
          ],
          "line": 136
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mobile_image_mounter_error",
          "args": [
            "property_list_service_receive_plist(client->parent, result)"
          ],
          "line": 134
        },
        "resolved": true,
        "details": {
          "function_name": "mobile_image_mounter_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/mobile_image_mounter.c",
          "lines": "61-76",
          "snippet": "static mobile_image_mounter_error_t mobile_image_mounter_error(property_list_service_error_t err)\n{\n\tswitch (err) {\n\t\tcase PROPERTY_LIST_SERVICE_E_SUCCESS:\n\t\t\treturn MOBILE_IMAGE_MOUNTER_E_SUCCESS;\n\t\tcase PROPERTY_LIST_SERVICE_E_INVALID_ARG:\n\t\t\treturn MOBILE_IMAGE_MOUNTER_E_INVALID_ARG;\n\t\tcase PROPERTY_LIST_SERVICE_E_PLIST_ERROR:\n\t\t\treturn MOBILE_IMAGE_MOUNTER_E_PLIST_ERROR;\n\t\tcase PROPERTY_LIST_SERVICE_E_MUX_ERROR:\n\t\t\treturn MOBILE_IMAGE_MOUNTER_E_CONN_FAILED;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn MOBILE_IMAGE_MOUNTER_E_UNKNOWN_ERROR;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include \"mobile_image_mounter.h\"",
            "#include <plist/plist.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <string.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"mobile_image_mounter.h\"\n#include <plist/plist.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <string.h>\n\nstatic mobile_image_mounter_error_t mobile_image_mounter_error(property_list_service_error_t err)\n{\n\tswitch (err) {\n\t\tcase PROPERTY_LIST_SERVICE_E_SUCCESS:\n\t\t\treturn MOBILE_IMAGE_MOUNTER_E_SUCCESS;\n\t\tcase PROPERTY_LIST_SERVICE_E_INVALID_ARG:\n\t\t\treturn MOBILE_IMAGE_MOUNTER_E_INVALID_ARG;\n\t\tcase PROPERTY_LIST_SERVICE_E_PLIST_ERROR:\n\t\t\treturn MOBILE_IMAGE_MOUNTER_E_PLIST_ERROR;\n\t\tcase PROPERTY_LIST_SERVICE_E_MUX_ERROR:\n\t\t\treturn MOBILE_IMAGE_MOUNTER_E_CONN_FAILED;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn MOBILE_IMAGE_MOUNTER_E_UNKNOWN_ERROR;\n}"
        }
      },
      {
        "call_info": {
          "callee": "property_list_service_receive_plist",
          "args": [
            "client->parent",
            "result"
          ],
          "line": 134
        },
        "resolved": true,
        "details": {
          "function_name": "property_list_service_receive_plist",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
          "lines": "258-261",
          "snippet": "LIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_receive_plist(property_list_service_client_t client, plist_t *plist)\n{\n\treturn internal_plist_receive_timeout(client, plist, 10000);\n}",
          "includes": [
            "#include \"endianness.h\"",
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_receive_plist(property_list_service_client_t client, plist_t *plist)\n{\n\treturn internal_plist_receive_timeout(client, plist, 10000);\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"%s: Error sending XML plist to device!\"",
            "__func__"
          ],
          "line": 130
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "dict"
          ],
          "line": 127
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "property_list_service_send_xml_plist",
          "args": [
            "client->parent",
            "dict"
          ],
          "line": 126
        },
        "resolved": true,
        "details": {
          "function_name": "property_list_service_send_xml_plist",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
          "lines": "150-153",
          "snippet": "LIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_send_xml_plist(property_list_service_client_t client, plist_t plist)\n{\n\treturn internal_plist_send(client, plist, 0);\n}",
          "includes": [
            "#include \"endianness.h\"",
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_send_xml_plist(property_list_service_client_t client, plist_t plist)\n{\n\treturn internal_plist_send(client, plist, 0);\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"ImageType\"",
            "plist_new_string(image_type)"
          ],
          "line": 124
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "image_type"
          ],
          "line": 124
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"Command\"",
            "plist_new_string(\"LookupImage\")"
          ],
          "line": 123
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "\"LookupImage\""
          ],
          "line": 123
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_dict",
          "args": [],
          "line": 122
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mobile_image_mounter_lock",
          "args": [
            "client"
          ],
          "line": 120
        },
        "resolved": true,
        "details": {
          "function_name": "mobile_image_mounter_lock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/mobile_image_mounter.c",
          "lines": "36-39",
          "snippet": "static void mobile_image_mounter_lock(mobile_image_mounter_client_t client)\n{\n\tmutex_lock(&client->mutex);\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include \"mobile_image_mounter.h\"",
            "#include <plist/plist.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <string.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"mobile_image_mounter.h\"\n#include <plist/plist.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <string.h>\n\nstatic void mobile_image_mounter_lock(mobile_image_mounter_client_t client)\n{\n\tmutex_lock(&client->mutex);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"mobile_image_mounter.h\"\n#include <plist/plist.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <string.h>\n\nLIBIMOBILEDEVICE_API mobile_image_mounter_error_t mobile_image_mounter_lookup_image(mobile_image_mounter_client_t client, const char *image_type, plist_t *result)\n{\n\tif (!client || !image_type || !result) {\n\t\treturn MOBILE_IMAGE_MOUNTER_E_INVALID_ARG;\n\t}\n\tmobile_image_mounter_lock(client);\n\n\tplist_t dict = plist_new_dict();\n\tplist_dict_set_item(dict,\"Command\", plist_new_string(\"LookupImage\"));\n\tplist_dict_set_item(dict,\"ImageType\", plist_new_string(image_type));\n\n\tmobile_image_mounter_error_t res = mobile_image_mounter_error(property_list_service_send_xml_plist(client->parent, dict));\n\tplist_free(dict);\n\n\tif (res != MOBILE_IMAGE_MOUNTER_E_SUCCESS) {\n\t\tdebug_info(\"%s: Error sending XML plist to device!\", __func__);\n\t\tgoto leave_unlock;\n\t}\n\n\tres = mobile_image_mounter_error(property_list_service_receive_plist(client->parent, result));\n\tif (res != MOBILE_IMAGE_MOUNTER_E_SUCCESS) {\n\t\tdebug_info(\"%s: Error receiving response from device!\", __func__);\n\t}\n\nleave_unlock:\n\tmobile_image_mounter_unlock(client);\n\treturn res;\n}"
  },
  {
    "function_name": "mobile_image_mounter_free",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/mobile_image_mounter.c",
    "lines": "102-113",
    "snippet": "LIBIMOBILEDEVICE_API mobile_image_mounter_error_t mobile_image_mounter_free(mobile_image_mounter_client_t client)\n{\n\tif (!client)\n\t\treturn MOBILE_IMAGE_MOUNTER_E_INVALID_ARG;\n\n\tproperty_list_service_client_free(client->parent);\n\tclient->parent = NULL;\n\tmutex_destroy(&client->mutex);\n\tfree(client);\n\n\treturn MOBILE_IMAGE_MOUNTER_E_SUCCESS;\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"property_list_service.h\"",
      "#include \"mobile_image_mounter.h\"",
      "#include <plist/plist.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <string.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "client"
          ],
          "line": 110
        },
        "resolved": true,
        "details": {
          "function_name": "mobile_image_mounter_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/mobile_image_mounter.c",
          "lines": "102-113",
          "snippet": "LIBIMOBILEDEVICE_API mobile_image_mounter_error_t mobile_image_mounter_free(mobile_image_mounter_client_t client)\n{\n\tif (!client)\n\t\treturn MOBILE_IMAGE_MOUNTER_E_INVALID_ARG;\n\n\tproperty_list_service_client_free(client->parent);\n\tclient->parent = NULL;\n\tmutex_destroy(&client->mutex);\n\tfree(client);\n\n\treturn MOBILE_IMAGE_MOUNTER_E_SUCCESS;\n}",
          "note": "cyclic_reference_detected"
        }
      },
      {
        "call_info": {
          "callee": "mutex_destroy",
          "args": [
            "&client->mutex"
          ],
          "line": 109
        },
        "resolved": true,
        "details": {
          "function_name": "mutex_destroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/common/thread.c",
          "lines": "65-72",
          "snippet": "void mutex_destroy(mutex_t* mutex)\n{\n#ifdef WIN32\n\tDeleteCriticalSection(mutex);\n#else\n\tpthread_mutex_destroy(mutex);\n#endif\n}",
          "includes": [
            "#include \"thread.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"thread.h\"\n\nvoid mutex_destroy(mutex_t* mutex)\n{\n#ifdef WIN32\n\tDeleteCriticalSection(mutex);\n#else\n\tpthread_mutex_destroy(mutex);\n#endif\n}"
        }
      },
      {
        "call_info": {
          "callee": "property_list_service_client_free",
          "args": [
            "client->parent"
          ],
          "line": 107
        },
        "resolved": true,
        "details": {
          "function_name": "property_list_service_client_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
          "lines": "77-88",
          "snippet": "LIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_client_free(property_list_service_client_t client)\n{\n\tif (!client)\n\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\n\tproperty_list_service_error_t err = service_to_property_list_service_error(service_client_free(client->parent));\n\n\tfree(client);\n\tclient = NULL;\n\n\treturn err;\n}",
          "includes": [
            "#include \"endianness.h\"",
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_client_free(property_list_service_client_t client)\n{\n\tif (!client)\n\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\n\tproperty_list_service_error_t err = service_to_property_list_service_error(service_client_free(client->parent));\n\n\tfree(client);\n\tclient = NULL;\n\n\treturn err;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"mobile_image_mounter.h\"\n#include <plist/plist.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <string.h>\n\nLIBIMOBILEDEVICE_API mobile_image_mounter_error_t mobile_image_mounter_free(mobile_image_mounter_client_t client)\n{\n\tif (!client)\n\t\treturn MOBILE_IMAGE_MOUNTER_E_INVALID_ARG;\n\n\tproperty_list_service_client_free(client->parent);\n\tclient->parent = NULL;\n\tmutex_destroy(&client->mutex);\n\tfree(client);\n\n\treturn MOBILE_IMAGE_MOUNTER_E_SUCCESS;\n}"
  },
  {
    "function_name": "mobile_image_mounter_start_service",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/mobile_image_mounter.c",
    "lines": "95-100",
    "snippet": "LIBIMOBILEDEVICE_API mobile_image_mounter_error_t mobile_image_mounter_start_service(idevice_t device, mobile_image_mounter_client_t * client, const char* label)\n{\n\tmobile_image_mounter_error_t err = MOBILE_IMAGE_MOUNTER_E_UNKNOWN_ERROR;\n\tservice_client_factory_start_service(device, MOBILE_IMAGE_MOUNTER_SERVICE_NAME, (void**)client, label, SERVICE_CONSTRUCTOR(mobile_image_mounter_new), &err);\n\treturn err;\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"property_list_service.h\"",
      "#include \"mobile_image_mounter.h\"",
      "#include <plist/plist.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <string.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "service_client_factory_start_service",
          "args": [
            "device",
            "MOBILE_IMAGE_MOUNTER_SERVICE_NAME",
            "(void**)client",
            "label",
            "SERVICE_CONSTRUCTOR(mobile_image_mounter_new)",
            "&err"
          ],
          "line": 98
        },
        "resolved": true,
        "details": {
          "function_name": "service_client_factory_start_service",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/service.c",
          "lines": "79-116",
          "snippet": "LIBIMOBILEDEVICE_API service_error_t service_client_factory_start_service(idevice_t device, const char* service_name, void **client, const char* label, int32_t (*constructor_func)(idevice_t, lockdownd_service_descriptor_t, void**), int32_t *error_code)\n{\n\t*client = NULL;\n\n\tlockdownd_client_t lckd = NULL;\n\tif (LOCKDOWN_E_SUCCESS != lockdownd_client_new_with_handshake(device, &lckd, label)) {\n\t\tdebug_info(\"Could not create a lockdown client.\");\n\t\treturn SERVICE_E_START_SERVICE_ERROR;\n\t}\n\n\tlockdownd_service_descriptor_t service = NULL;\n\tlockdownd_start_service(lckd, service_name, &service);\n\tlockdownd_client_free(lckd);\n\n\tif (!service || service->port == 0) {\n\t\tdebug_info(\"Could not start service %s!\", service_name);\n\t\treturn SERVICE_E_START_SERVICE_ERROR;\n\t}\n\n\tint32_t ec;\n\tif (constructor_func) {\n\t\tec = (int32_t)constructor_func(device, service, client);\n\t} else {\n\t\tec = service_client_new(device, service, (service_client_t*)client);\n\t}\n\tif (error_code) {\n\t\t*error_code = ec;\n\t}\n\n\tif (ec != SERVICE_E_SUCCESS) {\n\t\tdebug_info(\"Could not connect to service %s! Port: %i, error: %i\", service_name, service->port, ec);\n\t}\n\n\tlockdownd_service_descriptor_free(service);\n\tservice = NULL;\n\n\treturn (ec == SERVICE_E_SUCCESS) ? SERVICE_E_SUCCESS : SERVICE_E_START_SERVICE_ERROR;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API service_error_t service_client_factory_start_service(idevice_t device, const char* service_name, void **client, const char* label, int32_t (*constructor_func)(idevice_t, lockdownd_service_descriptor_t, void**), int32_t *error_code)\n{\n\t*client = NULL;\n\n\tlockdownd_client_t lckd = NULL;\n\tif (LOCKDOWN_E_SUCCESS != lockdownd_client_new_with_handshake(device, &lckd, label)) {\n\t\tdebug_info(\"Could not create a lockdown client.\");\n\t\treturn SERVICE_E_START_SERVICE_ERROR;\n\t}\n\n\tlockdownd_service_descriptor_t service = NULL;\n\tlockdownd_start_service(lckd, service_name, &service);\n\tlockdownd_client_free(lckd);\n\n\tif (!service || service->port == 0) {\n\t\tdebug_info(\"Could not start service %s!\", service_name);\n\t\treturn SERVICE_E_START_SERVICE_ERROR;\n\t}\n\n\tint32_t ec;\n\tif (constructor_func) {\n\t\tec = (int32_t)constructor_func(device, service, client);\n\t} else {\n\t\tec = service_client_new(device, service, (service_client_t*)client);\n\t}\n\tif (error_code) {\n\t\t*error_code = ec;\n\t}\n\n\tif (ec != SERVICE_E_SUCCESS) {\n\t\tdebug_info(\"Could not connect to service %s! Port: %i, error: %i\", service_name, service->port, ec);\n\t}\n\n\tlockdownd_service_descriptor_free(service);\n\tservice = NULL;\n\n\treturn (ec == SERVICE_E_SUCCESS) ? SERVICE_E_SUCCESS : SERVICE_E_START_SERVICE_ERROR;\n}"
        }
      },
      {
        "call_info": {
          "callee": "SERVICE_CONSTRUCTOR",
          "args": [
            "mobile_image_mounter_new"
          ],
          "line": 98
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"mobile_image_mounter.h\"\n#include <plist/plist.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <string.h>\n\nLIBIMOBILEDEVICE_API mobile_image_mounter_error_t mobile_image_mounter_start_service(idevice_t device, mobile_image_mounter_client_t * client, const char* label)\n{\n\tmobile_image_mounter_error_t err = MOBILE_IMAGE_MOUNTER_E_UNKNOWN_ERROR;\n\tservice_client_factory_start_service(device, MOBILE_IMAGE_MOUNTER_SERVICE_NAME, (void**)client, label, SERVICE_CONSTRUCTOR(mobile_image_mounter_new), &err);\n\treturn err;\n}"
  },
  {
    "function_name": "mobile_image_mounter_new",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/mobile_image_mounter.c",
    "lines": "78-93",
    "snippet": "LIBIMOBILEDEVICE_API mobile_image_mounter_error_t mobile_image_mounter_new(idevice_t device, lockdownd_service_descriptor_t service, mobile_image_mounter_client_t *client)\n{\n\tproperty_list_service_client_t plistclient = NULL;\n\tmobile_image_mounter_error_t err = mobile_image_mounter_error(property_list_service_client_new(device, service, &plistclient));\n\tif (err != MOBILE_IMAGE_MOUNTER_E_SUCCESS) {\n\t\treturn err;\n\t}\n\n\tmobile_image_mounter_client_t client_loc = (mobile_image_mounter_client_t) malloc(sizeof(struct mobile_image_mounter_client_private));\n\tclient_loc->parent = plistclient;\n\n\tmutex_init(&client_loc->mutex);\n\n\t*client = client_loc;\n\treturn MOBILE_IMAGE_MOUNTER_E_SUCCESS;\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"property_list_service.h\"",
      "#include \"mobile_image_mounter.h\"",
      "#include <plist/plist.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <string.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "mutex_init",
          "args": [
            "&client_loc->mutex"
          ],
          "line": 89
        },
        "resolved": true,
        "details": {
          "function_name": "mutex_init",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/common/thread.c",
          "lines": "56-63",
          "snippet": "void mutex_init(mutex_t* mutex)\n{\n#ifdef WIN32\n\tInitializeCriticalSection(mutex);\n#else\n\tpthread_mutex_init(mutex, NULL);\n#endif\n}",
          "includes": [
            "#include \"thread.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"thread.h\"\n\nvoid mutex_init(mutex_t* mutex)\n{\n#ifdef WIN32\n\tInitializeCriticalSection(mutex);\n#else\n\tpthread_mutex_init(mutex, NULL);\n#endif\n}"
        }
      },
      {
        "call_info": {
          "callee": "malloc",
          "args": [
            "sizeof(struct mobile_image_mounter_client_private)"
          ],
          "line": 86
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mobile_image_mounter_error",
          "args": [
            "property_list_service_client_new(device, service, &plistclient)"
          ],
          "line": 81
        },
        "resolved": true,
        "details": {
          "function_name": "mobile_image_mounter_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/mobile_image_mounter.c",
          "lines": "61-76",
          "snippet": "static mobile_image_mounter_error_t mobile_image_mounter_error(property_list_service_error_t err)\n{\n\tswitch (err) {\n\t\tcase PROPERTY_LIST_SERVICE_E_SUCCESS:\n\t\t\treturn MOBILE_IMAGE_MOUNTER_E_SUCCESS;\n\t\tcase PROPERTY_LIST_SERVICE_E_INVALID_ARG:\n\t\t\treturn MOBILE_IMAGE_MOUNTER_E_INVALID_ARG;\n\t\tcase PROPERTY_LIST_SERVICE_E_PLIST_ERROR:\n\t\t\treturn MOBILE_IMAGE_MOUNTER_E_PLIST_ERROR;\n\t\tcase PROPERTY_LIST_SERVICE_E_MUX_ERROR:\n\t\t\treturn MOBILE_IMAGE_MOUNTER_E_CONN_FAILED;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn MOBILE_IMAGE_MOUNTER_E_UNKNOWN_ERROR;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include \"mobile_image_mounter.h\"",
            "#include <plist/plist.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <string.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"mobile_image_mounter.h\"\n#include <plist/plist.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <string.h>\n\nstatic mobile_image_mounter_error_t mobile_image_mounter_error(property_list_service_error_t err)\n{\n\tswitch (err) {\n\t\tcase PROPERTY_LIST_SERVICE_E_SUCCESS:\n\t\t\treturn MOBILE_IMAGE_MOUNTER_E_SUCCESS;\n\t\tcase PROPERTY_LIST_SERVICE_E_INVALID_ARG:\n\t\t\treturn MOBILE_IMAGE_MOUNTER_E_INVALID_ARG;\n\t\tcase PROPERTY_LIST_SERVICE_E_PLIST_ERROR:\n\t\t\treturn MOBILE_IMAGE_MOUNTER_E_PLIST_ERROR;\n\t\tcase PROPERTY_LIST_SERVICE_E_MUX_ERROR:\n\t\t\treturn MOBILE_IMAGE_MOUNTER_E_CONN_FAILED;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn MOBILE_IMAGE_MOUNTER_E_UNKNOWN_ERROR;\n}"
        }
      },
      {
        "call_info": {
          "callee": "property_list_service_client_new",
          "args": [
            "device",
            "service",
            "&plistclient"
          ],
          "line": 81
        },
        "resolved": true,
        "details": {
          "function_name": "property_list_service_client_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
          "lines": "57-75",
          "snippet": "LIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_client_new(idevice_t device, lockdownd_service_descriptor_t service, property_list_service_client_t *client)\n{\n\tif (!device || !service || service->port == 0 || !client || *client)\n\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\n\tservice_client_t parent = NULL;\n\tservice_error_t rerr = service_client_new(device, service, &parent);\n\tif (rerr != SERVICE_E_SUCCESS) {\n\t\treturn service_to_property_list_service_error(rerr);\n\t}\n\n\t/* create client object */\n\tproperty_list_service_client_t client_loc = (property_list_service_client_t)malloc(sizeof(struct property_list_service_client_private));\n\tclient_loc->parent = parent;\n\n\t/* all done, return success */\n\t*client = client_loc;\n\treturn PROPERTY_LIST_SERVICE_E_SUCCESS;\n}",
          "includes": [
            "#include \"endianness.h\"",
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_client_new(idevice_t device, lockdownd_service_descriptor_t service, property_list_service_client_t *client)\n{\n\tif (!device || !service || service->port == 0 || !client || *client)\n\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\n\tservice_client_t parent = NULL;\n\tservice_error_t rerr = service_client_new(device, service, &parent);\n\tif (rerr != SERVICE_E_SUCCESS) {\n\t\treturn service_to_property_list_service_error(rerr);\n\t}\n\n\t/* create client object */\n\tproperty_list_service_client_t client_loc = (property_list_service_client_t)malloc(sizeof(struct property_list_service_client_private));\n\tclient_loc->parent = parent;\n\n\t/* all done, return success */\n\t*client = client_loc;\n\treturn PROPERTY_LIST_SERVICE_E_SUCCESS;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"mobile_image_mounter.h\"\n#include <plist/plist.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <string.h>\n\nLIBIMOBILEDEVICE_API mobile_image_mounter_error_t mobile_image_mounter_new(idevice_t device, lockdownd_service_descriptor_t service, mobile_image_mounter_client_t *client)\n{\n\tproperty_list_service_client_t plistclient = NULL;\n\tmobile_image_mounter_error_t err = mobile_image_mounter_error(property_list_service_client_new(device, service, &plistclient));\n\tif (err != MOBILE_IMAGE_MOUNTER_E_SUCCESS) {\n\t\treturn err;\n\t}\n\n\tmobile_image_mounter_client_t client_loc = (mobile_image_mounter_client_t) malloc(sizeof(struct mobile_image_mounter_client_private));\n\tclient_loc->parent = plistclient;\n\n\tmutex_init(&client_loc->mutex);\n\n\t*client = client_loc;\n\treturn MOBILE_IMAGE_MOUNTER_E_SUCCESS;\n}"
  },
  {
    "function_name": "mobile_image_mounter_error",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/mobile_image_mounter.c",
    "lines": "61-76",
    "snippet": "static mobile_image_mounter_error_t mobile_image_mounter_error(property_list_service_error_t err)\n{\n\tswitch (err) {\n\t\tcase PROPERTY_LIST_SERVICE_E_SUCCESS:\n\t\t\treturn MOBILE_IMAGE_MOUNTER_E_SUCCESS;\n\t\tcase PROPERTY_LIST_SERVICE_E_INVALID_ARG:\n\t\t\treturn MOBILE_IMAGE_MOUNTER_E_INVALID_ARG;\n\t\tcase PROPERTY_LIST_SERVICE_E_PLIST_ERROR:\n\t\t\treturn MOBILE_IMAGE_MOUNTER_E_PLIST_ERROR;\n\t\tcase PROPERTY_LIST_SERVICE_E_MUX_ERROR:\n\t\t\treturn MOBILE_IMAGE_MOUNTER_E_CONN_FAILED;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn MOBILE_IMAGE_MOUNTER_E_UNKNOWN_ERROR;\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"property_list_service.h\"",
      "#include \"mobile_image_mounter.h\"",
      "#include <plist/plist.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <string.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"mobile_image_mounter.h\"\n#include <plist/plist.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <string.h>\n\nstatic mobile_image_mounter_error_t mobile_image_mounter_error(property_list_service_error_t err)\n{\n\tswitch (err) {\n\t\tcase PROPERTY_LIST_SERVICE_E_SUCCESS:\n\t\t\treturn MOBILE_IMAGE_MOUNTER_E_SUCCESS;\n\t\tcase PROPERTY_LIST_SERVICE_E_INVALID_ARG:\n\t\t\treturn MOBILE_IMAGE_MOUNTER_E_INVALID_ARG;\n\t\tcase PROPERTY_LIST_SERVICE_E_PLIST_ERROR:\n\t\t\treturn MOBILE_IMAGE_MOUNTER_E_PLIST_ERROR;\n\t\tcase PROPERTY_LIST_SERVICE_E_MUX_ERROR:\n\t\t\treturn MOBILE_IMAGE_MOUNTER_E_CONN_FAILED;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn MOBILE_IMAGE_MOUNTER_E_UNKNOWN_ERROR;\n}"
  },
  {
    "function_name": "mobile_image_mounter_unlock",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/mobile_image_mounter.c",
    "lines": "46-49",
    "snippet": "static void mobile_image_mounter_unlock(mobile_image_mounter_client_t client)\n{\n\tmutex_unlock(&client->mutex);\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"property_list_service.h\"",
      "#include \"mobile_image_mounter.h\"",
      "#include <plist/plist.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <string.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "mutex_unlock",
          "args": [
            "&client->mutex"
          ],
          "line": 48
        },
        "resolved": true,
        "details": {
          "function_name": "mutex_unlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/common/thread.c",
          "lines": "83-90",
          "snippet": "void mutex_unlock(mutex_t* mutex)\n{\n#ifdef WIN32\n\tLeaveCriticalSection(mutex);\n#else\n\tpthread_mutex_unlock(mutex);\n#endif\n}",
          "includes": [
            "#include \"thread.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"thread.h\"\n\nvoid mutex_unlock(mutex_t* mutex)\n{\n#ifdef WIN32\n\tLeaveCriticalSection(mutex);\n#else\n\tpthread_mutex_unlock(mutex);\n#endif\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"mobile_image_mounter.h\"\n#include <plist/plist.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <string.h>\n\nstatic void mobile_image_mounter_unlock(mobile_image_mounter_client_t client)\n{\n\tmutex_unlock(&client->mutex);\n}"
  },
  {
    "function_name": "mobile_image_mounter_lock",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/mobile_image_mounter.c",
    "lines": "36-39",
    "snippet": "static void mobile_image_mounter_lock(mobile_image_mounter_client_t client)\n{\n\tmutex_lock(&client->mutex);\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"property_list_service.h\"",
      "#include \"mobile_image_mounter.h\"",
      "#include <plist/plist.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <string.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "mutex_lock",
          "args": [
            "&client->mutex"
          ],
          "line": 38
        },
        "resolved": true,
        "details": {
          "function_name": "mutex_lock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/common/thread.c",
          "lines": "74-81",
          "snippet": "void mutex_lock(mutex_t* mutex)\n{\n#ifdef WIN32\n\tEnterCriticalSection(mutex);\n#else\n\tpthread_mutex_lock(mutex);\n#endif\n}",
          "includes": [
            "#include \"thread.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"thread.h\"\n\nvoid mutex_lock(mutex_t* mutex)\n{\n#ifdef WIN32\n\tEnterCriticalSection(mutex);\n#else\n\tpthread_mutex_lock(mutex);\n#endif\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"mobile_image_mounter.h\"\n#include <plist/plist.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <string.h>\n\nstatic void mobile_image_mounter_lock(mobile_image_mounter_client_t client)\n{\n\tmutex_lock(&client->mutex);\n}"
  }
]