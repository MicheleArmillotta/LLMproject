[
  {
    "function_name": "lockdownd_service_descriptor_free",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
    "lines": "1522-1528",
    "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_service_descriptor_free(lockdownd_service_descriptor_t service)\n{\n\tif (service)\n\t\tfree(service);\n\n\treturn LOCKDOWN_E_SUCCESS;\n}",
    "includes": [
      "#include <windows.h>",
      "#include \"asprintf.h\"",
      "#include \"common/utils.h\"",
      "#include \"common/userpref.h\"",
      "#include \"common/debug.h\"",
      "#include \"idevice.h\"",
      "#include \"lockdown.h\"",
      "#include \"property_list_service.h\"",
      "#include <plist/plist.h>",
      "#include <gnutls/crypto.h>",
      "#include <gnutls/x509.h>",
      "#include <libtasn1.h>",
      "#include <openssl/x509v3.h>",
      "#include <openssl/x509.h>",
      "#include <openssl/pem.h>",
      "#include <unistd.h>",
      "#include <ctype.h>",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "service"
          ],
          "line": 1525
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_service_descriptor_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "1522-1528",
          "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_service_descriptor_free(lockdownd_service_descriptor_t service)\n{\n\tif (service)\n\t\tfree(service);\n\n\treturn LOCKDOWN_E_SUCCESS;\n}",
          "note": "cyclic_reference_detected"
        }
      }
    ],
    "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_service_descriptor_free(lockdownd_service_descriptor_t service)\n{\n\tif (service)\n\t\tfree(service);\n\n\treturn LOCKDOWN_E_SUCCESS;\n}"
  },
  {
    "function_name": "lockdownd_data_classes_free",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
    "lines": "1510-1520",
    "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_data_classes_free(char **classes)\n{\n\tif (classes) {\n\t\tint i = 0;\n\t\twhile (classes[i++]) {\n\t\t\tfree(classes[i]);\n\t\t}\n\t\tfree(classes);\n\t}\n\treturn LOCKDOWN_E_SUCCESS;\n}",
    "includes": [
      "#include <windows.h>",
      "#include \"asprintf.h\"",
      "#include \"common/utils.h\"",
      "#include \"common/userpref.h\"",
      "#include \"common/debug.h\"",
      "#include \"idevice.h\"",
      "#include \"lockdown.h\"",
      "#include \"property_list_service.h\"",
      "#include <plist/plist.h>",
      "#include <gnutls/crypto.h>",
      "#include <gnutls/x509.h>",
      "#include <libtasn1.h>",
      "#include <openssl/x509v3.h>",
      "#include <openssl/x509.h>",
      "#include <openssl/pem.h>",
      "#include <unistd.h>",
      "#include <ctype.h>",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "classes"
          ],
          "line": 1517
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_service_descriptor_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "1522-1528",
          "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_service_descriptor_free(lockdownd_service_descriptor_t service)\n{\n\tif (service)\n\t\tfree(service);\n\n\treturn LOCKDOWN_E_SUCCESS;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_service_descriptor_free(lockdownd_service_descriptor_t service)\n{\n\tif (service)\n\t\tfree(service);\n\n\treturn LOCKDOWN_E_SUCCESS;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_data_classes_free(char **classes)\n{\n\tif (classes) {\n\t\tint i = 0;\n\t\twhile (classes[i++]) {\n\t\t\tfree(classes[i]);\n\t\t}\n\t\tfree(classes);\n\t}\n\treturn LOCKDOWN_E_SUCCESS;\n}"
  },
  {
    "function_name": "lockdownd_get_sync_data_classes",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
    "lines": "1455-1508",
    "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_get_sync_data_classes(lockdownd_client_t client, char ***classes, int *count)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tif (!client->session_id)\n\t\treturn LOCKDOWN_E_NO_RUNNING_SESSION;\n\n\tplist_t dict = NULL;\n\tlockdownd_error_t err = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tplist_t value = NULL;\n\n\tchar **newlist = NULL;\n\tchar *val = NULL;\n\n\t*classes = NULL;\n\t*count = 0;\n\n\terr = lockdownd_get_value(client, \"com.apple.mobile.iTunes\", \"SyncDataClasses\", &dict);\n\tif (err != LOCKDOWN_E_SUCCESS) {\n\t\tif (dict) {\n\t\t\tplist_free(dict);\n\t\t}\n\t\treturn err;\n\t}\n\n\tif (plist_get_node_type(dict) != PLIST_ARRAY) {\n\t\tplist_free(dict);\n\t\treturn LOCKDOWN_E_PLIST_ERROR;\n\t}\n\n\twhile((value = plist_array_get_item(dict, *count)) != NULL) {\n\t\tplist_get_string_val(value, &val);\n\t\tnewlist = realloc(*classes, sizeof(char*) * (*count+1));\n\t\tstr_remove_spaces(val);\n\t\tif (asprintf(&newlist[*count], \"com.apple.%s\", val) < 0) {\n\t\t\tdebug_info(\"ERROR: asprintf failed\");\n\t\t}\n\t\tfree(val);\n\t\tval = NULL;\n\t\t*classes = newlist;\n\t\t*count = *count+1;\n\t}\n\n\tnewlist = realloc(*classes, sizeof(char*) * (*count+1));\n\tnewlist[*count] = NULL;\n\t*classes = newlist;\n\n\tif (dict) {\n\t\tplist_free(dict);\n\t}\n\treturn LOCKDOWN_E_SUCCESS;\n}",
    "includes": [
      "#include <windows.h>",
      "#include \"asprintf.h\"",
      "#include \"common/utils.h\"",
      "#include \"common/userpref.h\"",
      "#include \"common/debug.h\"",
      "#include \"idevice.h\"",
      "#include \"lockdown.h\"",
      "#include \"property_list_service.h\"",
      "#include <plist/plist.h>",
      "#include <gnutls/crypto.h>",
      "#include <gnutls/x509.h>",
      "#include <libtasn1.h>",
      "#include <openssl/x509v3.h>",
      "#include <openssl/x509.h>",
      "#include <openssl/pem.h>",
      "#include <unistd.h>",
      "#include <ctype.h>",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "dict"
          ],
          "line": 1505
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "realloc",
          "args": [
            "*classes",
            "sizeof(char*) * (*count+1)"
          ],
          "line": 1500
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "val"
          ],
          "line": 1494
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_service_descriptor_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "1522-1528",
          "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_service_descriptor_free(lockdownd_service_descriptor_t service)\n{\n\tif (service)\n\t\tfree(service);\n\n\treturn LOCKDOWN_E_SUCCESS;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_service_descriptor_free(lockdownd_service_descriptor_t service)\n{\n\tif (service)\n\t\tfree(service);\n\n\treturn LOCKDOWN_E_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"ERROR: asprintf failed\""
          ],
          "line": 1492
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "asprintf",
          "args": [
            "&newlist[*count]",
            "\"com.apple.%s\"",
            "val"
          ],
          "line": 1491
        },
        "resolved": true,
        "details": {
          "function_name": "asprintf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/include/asprintf.h",
          "lines": "23-31",
          "snippet": "static inline int asprintf(char **PTR, const char *TEMPLATE, ...)\n{\n\tint res;\n\tva_list AP;\n\tva_start(AP, TEMPLATE);\n\tres = vasprintf(PTR, TEMPLATE, AP);\n\tva_end(AP);\n\treturn res;\n}",
          "includes": [
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <config.h>\n\nstatic inline int asprintf(char **PTR, const char *TEMPLATE, ...)\n{\n\tint res;\n\tva_list AP;\n\tva_start(AP, TEMPLATE);\n\tres = vasprintf(PTR, TEMPLATE, AP);\n\tva_end(AP);\n\treturn res;\n}"
        }
      },
      {
        "call_info": {
          "callee": "str_remove_spaces",
          "args": [
            "val"
          ],
          "line": 1490
        },
        "resolved": true,
        "details": {
          "function_name": "str_remove_spaces",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "1443-1453",
          "snippet": "static void str_remove_spaces(char *source)\n{\n\tchar *dest = source;\n\twhile (*source != 0) {\n\t\tif (!isspace(*source)) {\n\t\t\t*dest++ = *source; /* copy */\n\t\t}\n\t\tsource++;\n\t}\n\t*dest = 0;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic void str_remove_spaces(char *source)\n{\n\tchar *dest = source;\n\twhile (*source != 0) {\n\t\tif (!isspace(*source)) {\n\t\t\t*dest++ = *source; /* copy */\n\t\t}\n\t\tsource++;\n\t}\n\t*dest = 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "realloc",
          "args": [
            "*classes",
            "sizeof(char*) * (*count+1)"
          ],
          "line": 1489
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_get_string_val",
          "args": [
            "value",
            "&val"
          ],
          "line": 1488
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_array_get_item",
          "args": [
            "dict",
            "*count"
          ],
          "line": 1487
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "dict"
          ],
          "line": 1483
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_get_node_type",
          "args": [
            "dict"
          ],
          "line": 1482
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "dict"
          ],
          "line": 1477
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lockdownd_get_value",
          "args": [
            "client",
            "\"com.apple.mobile.iTunes\"",
            "\"SyncDataClasses\"",
            "&dict"
          ],
          "line": 1474
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_get_value",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "426-478",
          "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_get_value(lockdownd_client_t client, const char *domain, const char *key, plist_t *value)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tplist_t dict = NULL;\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\t/* setup request plist */\n\tdict = plist_new_dict();\n\tplist_dict_add_label(dict, client->label);\n\tif (domain) {\n\t\tplist_dict_set_item(dict,\"Domain\", plist_new_string(domain));\n\t}\n\tif (key) {\n\t\tplist_dict_set_item(dict,\"Key\", plist_new_string(key));\n\t}\n\tplist_dict_set_item(dict,\"Request\", plist_new_string(\"GetValue\"));\n\n\t/* send to device */\n\tret = lockdownd_send(client, dict);\n\n\tplist_free(dict);\n\tdict = NULL;\n\n\tif (ret != LOCKDOWN_E_SUCCESS)\n\t\treturn ret;\n\n\t/* Now get device's answer */\n\tret = lockdownd_receive(client, &dict);\n\tif (ret != LOCKDOWN_E_SUCCESS)\n\t\treturn ret;\n\n\tret = lockdown_check_result(dict, \"GetValue\");\n\tif (ret == LOCKDOWN_E_SUCCESS) {\n\t\tdebug_info(\"success\");\n\t}\n\n\tif (ret != LOCKDOWN_E_SUCCESS) {\n\t\tplist_free(dict);\n\t\treturn ret;\n\t}\n\n\tplist_t value_node = plist_dict_get_item(dict, \"Value\");\n\n\tif (value_node) {\n\t\tdebug_info(\"has a value\");\n\t\t*value = plist_copy(value_node);\n\t}\n\n\tplist_free(dict);\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_get_value(lockdownd_client_t client, const char *domain, const char *key, plist_t *value)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tplist_t dict = NULL;\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\t/* setup request plist */\n\tdict = plist_new_dict();\n\tplist_dict_add_label(dict, client->label);\n\tif (domain) {\n\t\tplist_dict_set_item(dict,\"Domain\", plist_new_string(domain));\n\t}\n\tif (key) {\n\t\tplist_dict_set_item(dict,\"Key\", plist_new_string(key));\n\t}\n\tplist_dict_set_item(dict,\"Request\", plist_new_string(\"GetValue\"));\n\n\t/* send to device */\n\tret = lockdownd_send(client, dict);\n\n\tplist_free(dict);\n\tdict = NULL;\n\n\tif (ret != LOCKDOWN_E_SUCCESS)\n\t\treturn ret;\n\n\t/* Now get device's answer */\n\tret = lockdownd_receive(client, &dict);\n\tif (ret != LOCKDOWN_E_SUCCESS)\n\t\treturn ret;\n\n\tret = lockdown_check_result(dict, \"GetValue\");\n\tif (ret == LOCKDOWN_E_SUCCESS) {\n\t\tdebug_info(\"success\");\n\t}\n\n\tif (ret != LOCKDOWN_E_SUCCESS) {\n\t\tplist_free(dict);\n\t\treturn ret;\n\t}\n\n\tplist_t value_node = plist_dict_get_item(dict, \"Value\");\n\n\tif (value_node) {\n\t\tdebug_info(\"has a value\");\n\t\t*value = plist_copy(value_node);\n\t}\n\n\tplist_free(dict);\n\treturn ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_get_sync_data_classes(lockdownd_client_t client, char ***classes, int *count)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tif (!client->session_id)\n\t\treturn LOCKDOWN_E_NO_RUNNING_SESSION;\n\n\tplist_t dict = NULL;\n\tlockdownd_error_t err = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tplist_t value = NULL;\n\n\tchar **newlist = NULL;\n\tchar *val = NULL;\n\n\t*classes = NULL;\n\t*count = 0;\n\n\terr = lockdownd_get_value(client, \"com.apple.mobile.iTunes\", \"SyncDataClasses\", &dict);\n\tif (err != LOCKDOWN_E_SUCCESS) {\n\t\tif (dict) {\n\t\t\tplist_free(dict);\n\t\t}\n\t\treturn err;\n\t}\n\n\tif (plist_get_node_type(dict) != PLIST_ARRAY) {\n\t\tplist_free(dict);\n\t\treturn LOCKDOWN_E_PLIST_ERROR;\n\t}\n\n\twhile((value = plist_array_get_item(dict, *count)) != NULL) {\n\t\tplist_get_string_val(value, &val);\n\t\tnewlist = realloc(*classes, sizeof(char*) * (*count+1));\n\t\tstr_remove_spaces(val);\n\t\tif (asprintf(&newlist[*count], \"com.apple.%s\", val) < 0) {\n\t\t\tdebug_info(\"ERROR: asprintf failed\");\n\t\t}\n\t\tfree(val);\n\t\tval = NULL;\n\t\t*classes = newlist;\n\t\t*count = *count+1;\n\t}\n\n\tnewlist = realloc(*classes, sizeof(char*) * (*count+1));\n\tnewlist[*count] = NULL;\n\t*classes = newlist;\n\n\tif (dict) {\n\t\tplist_free(dict);\n\t}\n\treturn LOCKDOWN_E_SUCCESS;\n}"
  },
  {
    "function_name": "str_remove_spaces",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
    "lines": "1443-1453",
    "snippet": "static void str_remove_spaces(char *source)\n{\n\tchar *dest = source;\n\twhile (*source != 0) {\n\t\tif (!isspace(*source)) {\n\t\t\t*dest++ = *source; /* copy */\n\t\t}\n\t\tsource++;\n\t}\n\t*dest = 0;\n}",
    "includes": [
      "#include <windows.h>",
      "#include \"asprintf.h\"",
      "#include \"common/utils.h\"",
      "#include \"common/userpref.h\"",
      "#include \"common/debug.h\"",
      "#include \"idevice.h\"",
      "#include \"lockdown.h\"",
      "#include \"property_list_service.h\"",
      "#include <plist/plist.h>",
      "#include <gnutls/crypto.h>",
      "#include <gnutls/x509.h>",
      "#include <libtasn1.h>",
      "#include <openssl/x509v3.h>",
      "#include <openssl/x509.h>",
      "#include <openssl/pem.h>",
      "#include <unistd.h>",
      "#include <ctype.h>",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "isspace",
          "args": [
            "*source"
          ],
          "line": 1447
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic void str_remove_spaces(char *source)\n{\n\tchar *dest = source;\n\twhile (*source != 0) {\n\t\tif (!isspace(*source)) {\n\t\t\t*dest++ = *source; /* copy */\n\t\t}\n\t\tsource++;\n\t}\n\t*dest = 0;\n}"
  },
  {
    "function_name": "lockdownd_deactivate",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
    "lines": "1408-1441",
    "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_deactivate(lockdownd_client_t client)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tif (!client->session_id)\n\t\treturn LOCKDOWN_E_NO_RUNNING_SESSION;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tplist_t dict = plist_new_dict();\n\tplist_dict_add_label(dict, client->label);\n\tplist_dict_set_item(dict,\"Request\", plist_new_string(\"Deactivate\"));\n\n\tret = lockdownd_send(client, dict);\n\tplist_free(dict);\n\tdict = NULL;\n\n\tret = lockdownd_receive(client, &dict);\n\tif (!dict) {\n\t\tdebug_info(\"LOCKDOWN_E_PLIST_ERROR\");\n\t\treturn LOCKDOWN_E_PLIST_ERROR;\n\t}\n\n\tret = lockdown_check_result(dict, \"Deactivate\");\n\tif (ret == LOCKDOWN_E_SUCCESS) {\n\t\tdebug_info(\"success\");\n\t}\n\n\tplist_free(dict);\n\tdict = NULL;\n\n\treturn ret;\n}",
    "includes": [
      "#include <windows.h>",
      "#include \"asprintf.h\"",
      "#include \"common/utils.h\"",
      "#include \"common/userpref.h\"",
      "#include \"common/debug.h\"",
      "#include \"idevice.h\"",
      "#include \"lockdown.h\"",
      "#include \"property_list_service.h\"",
      "#include <plist/plist.h>",
      "#include <gnutls/crypto.h>",
      "#include <gnutls/x509.h>",
      "#include <libtasn1.h>",
      "#include <openssl/x509v3.h>",
      "#include <openssl/x509.h>",
      "#include <openssl/pem.h>",
      "#include <unistd.h>",
      "#include <ctype.h>",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "dict"
          ],
          "line": 1437
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"success\""
          ],
          "line": 1434
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lockdown_check_result",
          "args": [
            "dict",
            "\"Deactivate\""
          ],
          "line": 1432
        },
        "resolved": true,
        "details": {
          "function_name": "lockdown_check_result",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "150-223",
          "snippet": "static lockdownd_error_t lockdown_check_result(plist_t dict, const char *query_match)\n{\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tplist_t query_node = plist_dict_get_item(dict, \"Request\");\n\tif (!query_node) {\n\t\treturn ret;\n\t}\n\n\tif (plist_get_node_type(query_node) != PLIST_STRING) {\n\t\treturn ret;\n\t} else {\n\t\tchar *query_value = NULL;\n\n\t\tplist_get_string_val(query_node, &query_value);\n\t\tif (!query_value) {\n\t\t\treturn ret;\n\t\t}\n\n\t\tif (query_match && (strcmp(query_value, query_match) != 0)) {\n\t\t\tfree(query_value);\n\t\t\treturn ret;\n\t\t}\n\n\t\tfree(query_value);\n\t}\n\n\tplist_t result_node = plist_dict_get_item(dict, \"Result\");\n\tif (!result_node) {\n\t\t/* iOS 5: the 'Result' key is not present anymore.\n\t\t   But we need to check for the 'Error' key. */\n\t\tplist_t err_node = plist_dict_get_item(dict, \"Error\");\n\t\tif (err_node) {\n\t\t\tif (plist_get_node_type(err_node) == PLIST_STRING) {\n\t\t\t\tchar *err_value = NULL;\n\n\t\t\t\tplist_get_string_val(err_node, &err_value);\n\t\t\t\tif (err_value) {\n\t\t\t\t\tdebug_info(\"ERROR: %s\", err_value);\n\t\t\t\t\tret = lockdownd_strtoerr(err_value);\n\t\t\t\t\tfree(err_value);\n\t\t\t\t} else {\n\t\t\t\t\tdebug_info(\"ERROR: unknown error occured\");\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn ret;\n\t\t}\n\n\t\tret = LOCKDOWN_E_SUCCESS;\n\n\t\treturn ret;\n\t}\n\n\tplist_type result_type = plist_get_node_type(result_node);\n\tif (result_type == PLIST_STRING) {\n\t\tchar *result_value = NULL;\n\n\t\tplist_get_string_val(result_node, &result_value);\n\t\tif (result_value) {\n\t\t\tif (!strcmp(result_value, \"Success\")) {\n\t\t\t\tret = LOCKDOWN_E_SUCCESS;\n\t\t\t} else if (!strcmp(result_value, \"Failure\")) {\n\t\t\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t\t\t} else {\n\t\t\t\tdebug_info(\"ERROR: unknown result value '%s'\", result_value);\n\t\t\t}\n\t\t}\n\n\t\tif (result_value)\n\t\t\tfree(result_value);\n\t}\n\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic lockdownd_error_t lockdown_check_result(plist_t dict, const char *query_match)\n{\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tplist_t query_node = plist_dict_get_item(dict, \"Request\");\n\tif (!query_node) {\n\t\treturn ret;\n\t}\n\n\tif (plist_get_node_type(query_node) != PLIST_STRING) {\n\t\treturn ret;\n\t} else {\n\t\tchar *query_value = NULL;\n\n\t\tplist_get_string_val(query_node, &query_value);\n\t\tif (!query_value) {\n\t\t\treturn ret;\n\t\t}\n\n\t\tif (query_match && (strcmp(query_value, query_match) != 0)) {\n\t\t\tfree(query_value);\n\t\t\treturn ret;\n\t\t}\n\n\t\tfree(query_value);\n\t}\n\n\tplist_t result_node = plist_dict_get_item(dict, \"Result\");\n\tif (!result_node) {\n\t\t/* iOS 5: the 'Result' key is not present anymore.\n\t\t   But we need to check for the 'Error' key. */\n\t\tplist_t err_node = plist_dict_get_item(dict, \"Error\");\n\t\tif (err_node) {\n\t\t\tif (plist_get_node_type(err_node) == PLIST_STRING) {\n\t\t\t\tchar *err_value = NULL;\n\n\t\t\t\tplist_get_string_val(err_node, &err_value);\n\t\t\t\tif (err_value) {\n\t\t\t\t\tdebug_info(\"ERROR: %s\", err_value);\n\t\t\t\t\tret = lockdownd_strtoerr(err_value);\n\t\t\t\t\tfree(err_value);\n\t\t\t\t} else {\n\t\t\t\t\tdebug_info(\"ERROR: unknown error occured\");\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn ret;\n\t\t}\n\n\t\tret = LOCKDOWN_E_SUCCESS;\n\n\t\treturn ret;\n\t}\n\n\tplist_type result_type = plist_get_node_type(result_node);\n\tif (result_type == PLIST_STRING) {\n\t\tchar *result_value = NULL;\n\n\t\tplist_get_string_val(result_node, &result_value);\n\t\tif (result_value) {\n\t\t\tif (!strcmp(result_value, \"Success\")) {\n\t\t\t\tret = LOCKDOWN_E_SUCCESS;\n\t\t\t} else if (!strcmp(result_value, \"Failure\")) {\n\t\t\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t\t\t} else {\n\t\t\t\tdebug_info(\"ERROR: unknown result value '%s'\", result_value);\n\t\t\t}\n\t\t}\n\n\t\tif (result_value)\n\t\t\tfree(result_value);\n\t}\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"LOCKDOWN_E_PLIST_ERROR\""
          ],
          "line": 1428
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lockdownd_receive",
          "args": [
            "client",
            "&dict"
          ],
          "line": 1426
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_receive",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "348-364",
          "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_receive(lockdownd_client_t client, plist_t *plist)\n{\n\tif (!client || !plist || (plist && *plist))\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\tlockdownd_error_t ret = LOCKDOWN_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_receive_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t}\n\n\tif (!*plist)\n\t\tret = LOCKDOWN_E_PLIST_ERROR;\n\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_receive(lockdownd_client_t client, plist_t *plist)\n{\n\tif (!client || !plist || (plist && *plist))\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\tlockdownd_error_t ret = LOCKDOWN_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_receive_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t}\n\n\tif (!*plist)\n\t\tret = LOCKDOWN_E_PLIST_ERROR;\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "dict"
          ],
          "line": 1423
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lockdownd_send",
          "args": [
            "client",
            "dict"
          ],
          "line": 1422
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_send",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "366-379",
          "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_send(lockdownd_client_t client, plist_t plist)\n{\n\tif (!client || !plist)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_send_xml_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t}\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_send(lockdownd_client_t client, plist_t plist)\n{\n\tif (!client || !plist)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_send_xml_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t}\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"Request\"",
            "plist_new_string(\"Deactivate\")"
          ],
          "line": 1420
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "\"Deactivate\""
          ],
          "line": 1420
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_add_label",
          "args": [
            "dict",
            "client->label"
          ],
          "line": 1419
        },
        "resolved": true,
        "details": {
          "function_name": "plist_dict_add_label",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "232-238",
          "snippet": "static void plist_dict_add_label(plist_t plist, const char *label)\n{\n\tif (plist && label) {\n\t\tif (plist_get_node_type(plist) == PLIST_DICT)\n\t\t\tplist_dict_set_item(plist, \"Label\", plist_new_string(label));\n\t}\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic void plist_dict_add_label(plist_t plist, const char *label)\n{\n\tif (plist && label) {\n\t\tif (plist_get_node_type(plist) == PLIST_DICT)\n\t\t\tplist_dict_set_item(plist, \"Label\", plist_new_string(label));\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_new_dict",
          "args": [],
          "line": 1418
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_deactivate(lockdownd_client_t client)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tif (!client->session_id)\n\t\treturn LOCKDOWN_E_NO_RUNNING_SESSION;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tplist_t dict = plist_new_dict();\n\tplist_dict_add_label(dict, client->label);\n\tplist_dict_set_item(dict,\"Request\", plist_new_string(\"Deactivate\"));\n\n\tret = lockdownd_send(client, dict);\n\tplist_free(dict);\n\tdict = NULL;\n\n\tret = lockdownd_receive(client, &dict);\n\tif (!dict) {\n\t\tdebug_info(\"LOCKDOWN_E_PLIST_ERROR\");\n\t\treturn LOCKDOWN_E_PLIST_ERROR;\n\t}\n\n\tret = lockdown_check_result(dict, \"Deactivate\");\n\tif (ret == LOCKDOWN_E_SUCCESS) {\n\t\tdebug_info(\"success\");\n\t}\n\n\tplist_free(dict);\n\tdict = NULL;\n\n\treturn ret;\n}"
  },
  {
    "function_name": "lockdownd_activate",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
    "lines": "1369-1406",
    "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_activate(lockdownd_client_t client, plist_t activation_record)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tif (!client->session_id)\n\t\treturn LOCKDOWN_E_NO_RUNNING_SESSION;\n\n\tif (!activation_record)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tplist_t dict = plist_new_dict();\n\tplist_dict_add_label(dict, client->label);\n\tplist_dict_set_item(dict,\"Request\", plist_new_string(\"Activate\"));\n\tplist_dict_set_item(dict,\"ActivationRecord\", plist_copy(activation_record));\n\n\tret = lockdownd_send(client, dict);\n\tplist_free(dict);\n\tdict = NULL;\n\n\tret = lockdownd_receive(client, &dict);\n\tif (!dict) {\n\t\tdebug_info(\"LOCKDOWN_E_PLIST_ERROR\");\n\t\treturn LOCKDOWN_E_PLIST_ERROR;\n\t}\n\n\tret = lockdown_check_result(dict, \"Activate\");\n\tif (ret == LOCKDOWN_E_SUCCESS) {\n\t\tdebug_info(\"success\");\n\t}\n\n\tplist_free(dict);\n\tdict = NULL;\n\n\treturn ret;\n}",
    "includes": [
      "#include <windows.h>",
      "#include \"asprintf.h\"",
      "#include \"common/utils.h\"",
      "#include \"common/userpref.h\"",
      "#include \"common/debug.h\"",
      "#include \"idevice.h\"",
      "#include \"lockdown.h\"",
      "#include \"property_list_service.h\"",
      "#include <plist/plist.h>",
      "#include <gnutls/crypto.h>",
      "#include <gnutls/x509.h>",
      "#include <libtasn1.h>",
      "#include <openssl/x509v3.h>",
      "#include <openssl/x509.h>",
      "#include <openssl/pem.h>",
      "#include <unistd.h>",
      "#include <ctype.h>",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "dict"
          ],
          "line": 1402
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"success\""
          ],
          "line": 1399
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lockdown_check_result",
          "args": [
            "dict",
            "\"Activate\""
          ],
          "line": 1397
        },
        "resolved": true,
        "details": {
          "function_name": "lockdown_check_result",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "150-223",
          "snippet": "static lockdownd_error_t lockdown_check_result(plist_t dict, const char *query_match)\n{\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tplist_t query_node = plist_dict_get_item(dict, \"Request\");\n\tif (!query_node) {\n\t\treturn ret;\n\t}\n\n\tif (plist_get_node_type(query_node) != PLIST_STRING) {\n\t\treturn ret;\n\t} else {\n\t\tchar *query_value = NULL;\n\n\t\tplist_get_string_val(query_node, &query_value);\n\t\tif (!query_value) {\n\t\t\treturn ret;\n\t\t}\n\n\t\tif (query_match && (strcmp(query_value, query_match) != 0)) {\n\t\t\tfree(query_value);\n\t\t\treturn ret;\n\t\t}\n\n\t\tfree(query_value);\n\t}\n\n\tplist_t result_node = plist_dict_get_item(dict, \"Result\");\n\tif (!result_node) {\n\t\t/* iOS 5: the 'Result' key is not present anymore.\n\t\t   But we need to check for the 'Error' key. */\n\t\tplist_t err_node = plist_dict_get_item(dict, \"Error\");\n\t\tif (err_node) {\n\t\t\tif (plist_get_node_type(err_node) == PLIST_STRING) {\n\t\t\t\tchar *err_value = NULL;\n\n\t\t\t\tplist_get_string_val(err_node, &err_value);\n\t\t\t\tif (err_value) {\n\t\t\t\t\tdebug_info(\"ERROR: %s\", err_value);\n\t\t\t\t\tret = lockdownd_strtoerr(err_value);\n\t\t\t\t\tfree(err_value);\n\t\t\t\t} else {\n\t\t\t\t\tdebug_info(\"ERROR: unknown error occured\");\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn ret;\n\t\t}\n\n\t\tret = LOCKDOWN_E_SUCCESS;\n\n\t\treturn ret;\n\t}\n\n\tplist_type result_type = plist_get_node_type(result_node);\n\tif (result_type == PLIST_STRING) {\n\t\tchar *result_value = NULL;\n\n\t\tplist_get_string_val(result_node, &result_value);\n\t\tif (result_value) {\n\t\t\tif (!strcmp(result_value, \"Success\")) {\n\t\t\t\tret = LOCKDOWN_E_SUCCESS;\n\t\t\t} else if (!strcmp(result_value, \"Failure\")) {\n\t\t\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t\t\t} else {\n\t\t\t\tdebug_info(\"ERROR: unknown result value '%s'\", result_value);\n\t\t\t}\n\t\t}\n\n\t\tif (result_value)\n\t\t\tfree(result_value);\n\t}\n\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic lockdownd_error_t lockdown_check_result(plist_t dict, const char *query_match)\n{\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tplist_t query_node = plist_dict_get_item(dict, \"Request\");\n\tif (!query_node) {\n\t\treturn ret;\n\t}\n\n\tif (plist_get_node_type(query_node) != PLIST_STRING) {\n\t\treturn ret;\n\t} else {\n\t\tchar *query_value = NULL;\n\n\t\tplist_get_string_val(query_node, &query_value);\n\t\tif (!query_value) {\n\t\t\treturn ret;\n\t\t}\n\n\t\tif (query_match && (strcmp(query_value, query_match) != 0)) {\n\t\t\tfree(query_value);\n\t\t\treturn ret;\n\t\t}\n\n\t\tfree(query_value);\n\t}\n\n\tplist_t result_node = plist_dict_get_item(dict, \"Result\");\n\tif (!result_node) {\n\t\t/* iOS 5: the 'Result' key is not present anymore.\n\t\t   But we need to check for the 'Error' key. */\n\t\tplist_t err_node = plist_dict_get_item(dict, \"Error\");\n\t\tif (err_node) {\n\t\t\tif (plist_get_node_type(err_node) == PLIST_STRING) {\n\t\t\t\tchar *err_value = NULL;\n\n\t\t\t\tplist_get_string_val(err_node, &err_value);\n\t\t\t\tif (err_value) {\n\t\t\t\t\tdebug_info(\"ERROR: %s\", err_value);\n\t\t\t\t\tret = lockdownd_strtoerr(err_value);\n\t\t\t\t\tfree(err_value);\n\t\t\t\t} else {\n\t\t\t\t\tdebug_info(\"ERROR: unknown error occured\");\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn ret;\n\t\t}\n\n\t\tret = LOCKDOWN_E_SUCCESS;\n\n\t\treturn ret;\n\t}\n\n\tplist_type result_type = plist_get_node_type(result_node);\n\tif (result_type == PLIST_STRING) {\n\t\tchar *result_value = NULL;\n\n\t\tplist_get_string_val(result_node, &result_value);\n\t\tif (result_value) {\n\t\t\tif (!strcmp(result_value, \"Success\")) {\n\t\t\t\tret = LOCKDOWN_E_SUCCESS;\n\t\t\t} else if (!strcmp(result_value, \"Failure\")) {\n\t\t\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t\t\t} else {\n\t\t\t\tdebug_info(\"ERROR: unknown result value '%s'\", result_value);\n\t\t\t}\n\t\t}\n\n\t\tif (result_value)\n\t\t\tfree(result_value);\n\t}\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"LOCKDOWN_E_PLIST_ERROR\""
          ],
          "line": 1393
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lockdownd_receive",
          "args": [
            "client",
            "&dict"
          ],
          "line": 1391
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_receive",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "348-364",
          "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_receive(lockdownd_client_t client, plist_t *plist)\n{\n\tif (!client || !plist || (plist && *plist))\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\tlockdownd_error_t ret = LOCKDOWN_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_receive_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t}\n\n\tif (!*plist)\n\t\tret = LOCKDOWN_E_PLIST_ERROR;\n\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_receive(lockdownd_client_t client, plist_t *plist)\n{\n\tif (!client || !plist || (plist && *plist))\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\tlockdownd_error_t ret = LOCKDOWN_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_receive_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t}\n\n\tif (!*plist)\n\t\tret = LOCKDOWN_E_PLIST_ERROR;\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "dict"
          ],
          "line": 1388
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lockdownd_send",
          "args": [
            "client",
            "dict"
          ],
          "line": 1387
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_send",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "366-379",
          "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_send(lockdownd_client_t client, plist_t plist)\n{\n\tif (!client || !plist)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_send_xml_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t}\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_send(lockdownd_client_t client, plist_t plist)\n{\n\tif (!client || !plist)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_send_xml_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t}\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"ActivationRecord\"",
            "plist_copy(activation_record)"
          ],
          "line": 1385
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_copy",
          "args": [
            "activation_record"
          ],
          "line": 1385
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"Request\"",
            "plist_new_string(\"Activate\")"
          ],
          "line": 1384
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "\"Activate\""
          ],
          "line": 1384
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_add_label",
          "args": [
            "dict",
            "client->label"
          ],
          "line": 1383
        },
        "resolved": true,
        "details": {
          "function_name": "plist_dict_add_label",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "232-238",
          "snippet": "static void plist_dict_add_label(plist_t plist, const char *label)\n{\n\tif (plist && label) {\n\t\tif (plist_get_node_type(plist) == PLIST_DICT)\n\t\t\tplist_dict_set_item(plist, \"Label\", plist_new_string(label));\n\t}\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic void plist_dict_add_label(plist_t plist, const char *label)\n{\n\tif (plist && label) {\n\t\tif (plist_get_node_type(plist) == PLIST_DICT)\n\t\t\tplist_dict_set_item(plist, \"Label\", plist_new_string(label));\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_new_dict",
          "args": [],
          "line": 1382
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_activate(lockdownd_client_t client, plist_t activation_record)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tif (!client->session_id)\n\t\treturn LOCKDOWN_E_NO_RUNNING_SESSION;\n\n\tif (!activation_record)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tplist_t dict = plist_new_dict();\n\tplist_dict_add_label(dict, client->label);\n\tplist_dict_set_item(dict,\"Request\", plist_new_string(\"Activate\"));\n\tplist_dict_set_item(dict,\"ActivationRecord\", plist_copy(activation_record));\n\n\tret = lockdownd_send(client, dict);\n\tplist_free(dict);\n\tdict = NULL;\n\n\tret = lockdownd_receive(client, &dict);\n\tif (!dict) {\n\t\tdebug_info(\"LOCKDOWN_E_PLIST_ERROR\");\n\t\treturn LOCKDOWN_E_PLIST_ERROR;\n\t}\n\n\tret = lockdown_check_result(dict, \"Activate\");\n\tif (ret == LOCKDOWN_E_SUCCESS) {\n\t\tdebug_info(\"success\");\n\t}\n\n\tplist_free(dict);\n\tdict = NULL;\n\n\treturn ret;\n}"
  },
  {
    "function_name": "lockdownd_start_service_with_escrow_bag",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
    "lines": "1364-1367",
    "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_start_service_with_escrow_bag(lockdownd_client_t client, const char *identifier, lockdownd_service_descriptor_t *service)\n{\n\treturn lockdownd_do_start_service(client, identifier, 1, service);\n}",
    "includes": [
      "#include <windows.h>",
      "#include \"asprintf.h\"",
      "#include \"common/utils.h\"",
      "#include \"common/userpref.h\"",
      "#include \"common/debug.h\"",
      "#include \"idevice.h\"",
      "#include \"lockdown.h\"",
      "#include \"property_list_service.h\"",
      "#include <plist/plist.h>",
      "#include <gnutls/crypto.h>",
      "#include <gnutls/x509.h>",
      "#include <libtasn1.h>",
      "#include <openssl/x509v3.h>",
      "#include <openssl/x509.h>",
      "#include <openssl/pem.h>",
      "#include <unistd.h>",
      "#include <ctype.h>",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "lockdownd_do_start_service",
          "args": [
            "client",
            "identifier",
            "1",
            "service"
          ],
          "line": 1366
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_do_start_service",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "1278-1357",
          "snippet": "static lockdownd_error_t lockdownd_do_start_service(lockdownd_client_t client, const char *identifier, int send_escrow_bag, lockdownd_service_descriptor_t *service)\n{\n\tif (!client || !identifier || !service)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tif (*service) {\n\t\t// reset fields if service descriptor is reused\n\t\t(*service)->port = 0;\n\t\t(*service)->ssl_enabled = 0;\n\t}\n\n\tplist_t dict = NULL;\n\tuint16_t port_loc = 0;\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\t/* create StartService request */\n\tret = lockdownd_build_start_service_request(client, identifier, send_escrow_bag, &dict);\n\tif (LOCKDOWN_E_SUCCESS != ret)\n\t\treturn ret;\n\n\t/* send to device */\n\tret = lockdownd_send(client, dict);\n\tplist_free(dict);\n\tdict = NULL;\n\n\tif (LOCKDOWN_E_SUCCESS != ret)\n\t\treturn ret;\n\n\tret = lockdownd_receive(client, &dict);\n\n\tif (LOCKDOWN_E_SUCCESS != ret)\n\t\treturn ret;\n\n\tif (!dict)\n\t\treturn LOCKDOWN_E_PLIST_ERROR;\n\n\tret = lockdown_check_result(dict, \"StartService\");\n\tif (ret == LOCKDOWN_E_SUCCESS) {\n\t\tif (*service == NULL)\n\t\t\t*service = (lockdownd_service_descriptor_t)malloc(sizeof(struct lockdownd_service_descriptor));\n\t\t(*service)->port = 0;\n\t\t(*service)->ssl_enabled = 0;\n\n\t\t/* read service port number */\n\t\tplist_t node = plist_dict_get_item(dict, \"Port\");\n\t\tif (node && (plist_get_node_type(node) == PLIST_UINT)) {\n\t\t\tuint64_t port_value = 0;\n\t\t\tplist_get_uint_val(node, &port_value);\n\n\t\t\tif (port_value) {\n\t\t\t\tport_loc = port_value;\n\t\t\t\tret = LOCKDOWN_E_SUCCESS;\n\t\t\t}\n\t\t\tif (port_loc && ret == LOCKDOWN_E_SUCCESS) {\n\t\t\t\t(*service)->port = port_loc;\n\t\t\t}\n\t\t}\n\n\t\t/* check if the service requires SSL */\n\t\tnode = plist_dict_get_item(dict, \"EnableServiceSSL\");\n\t\tif (node && (plist_get_node_type(node) == PLIST_BOOLEAN)) {\n\t\t\tuint8_t b = 0;\n\t\t\tplist_get_bool_val(node, &b);\n\t\t\t(*service)->ssl_enabled = b;\n\t\t}\n\t} else {\n\t\tplist_t error_node = plist_dict_get_item(dict, \"Error\");\n\t\tif (error_node && PLIST_STRING == plist_get_node_type(error_node)) {\n\t\t\tchar *error = NULL;\n\t\t\tplist_get_string_val(error_node, &error);\n\t\t\tret = lockdownd_strtoerr(error);\n\t\t\tfree(error);\n\t\t}\n\t}\n\n\tplist_free(dict);\n\tdict = NULL;\n\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic lockdownd_error_t lockdownd_do_start_service(lockdownd_client_t client, const char *identifier, int send_escrow_bag, lockdownd_service_descriptor_t *service)\n{\n\tif (!client || !identifier || !service)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tif (*service) {\n\t\t// reset fields if service descriptor is reused\n\t\t(*service)->port = 0;\n\t\t(*service)->ssl_enabled = 0;\n\t}\n\n\tplist_t dict = NULL;\n\tuint16_t port_loc = 0;\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\t/* create StartService request */\n\tret = lockdownd_build_start_service_request(client, identifier, send_escrow_bag, &dict);\n\tif (LOCKDOWN_E_SUCCESS != ret)\n\t\treturn ret;\n\n\t/* send to device */\n\tret = lockdownd_send(client, dict);\n\tplist_free(dict);\n\tdict = NULL;\n\n\tif (LOCKDOWN_E_SUCCESS != ret)\n\t\treturn ret;\n\n\tret = lockdownd_receive(client, &dict);\n\n\tif (LOCKDOWN_E_SUCCESS != ret)\n\t\treturn ret;\n\n\tif (!dict)\n\t\treturn LOCKDOWN_E_PLIST_ERROR;\n\n\tret = lockdown_check_result(dict, \"StartService\");\n\tif (ret == LOCKDOWN_E_SUCCESS) {\n\t\tif (*service == NULL)\n\t\t\t*service = (lockdownd_service_descriptor_t)malloc(sizeof(struct lockdownd_service_descriptor));\n\t\t(*service)->port = 0;\n\t\t(*service)->ssl_enabled = 0;\n\n\t\t/* read service port number */\n\t\tplist_t node = plist_dict_get_item(dict, \"Port\");\n\t\tif (node && (plist_get_node_type(node) == PLIST_UINT)) {\n\t\t\tuint64_t port_value = 0;\n\t\t\tplist_get_uint_val(node, &port_value);\n\n\t\t\tif (port_value) {\n\t\t\t\tport_loc = port_value;\n\t\t\t\tret = LOCKDOWN_E_SUCCESS;\n\t\t\t}\n\t\t\tif (port_loc && ret == LOCKDOWN_E_SUCCESS) {\n\t\t\t\t(*service)->port = port_loc;\n\t\t\t}\n\t\t}\n\n\t\t/* check if the service requires SSL */\n\t\tnode = plist_dict_get_item(dict, \"EnableServiceSSL\");\n\t\tif (node && (plist_get_node_type(node) == PLIST_BOOLEAN)) {\n\t\t\tuint8_t b = 0;\n\t\t\tplist_get_bool_val(node, &b);\n\t\t\t(*service)->ssl_enabled = b;\n\t\t}\n\t} else {\n\t\tplist_t error_node = plist_dict_get_item(dict, \"Error\");\n\t\tif (error_node && PLIST_STRING == plist_get_node_type(error_node)) {\n\t\t\tchar *error = NULL;\n\t\t\tplist_get_string_val(error_node, &error);\n\t\t\tret = lockdownd_strtoerr(error);\n\t\t\tfree(error);\n\t\t}\n\t}\n\n\tplist_free(dict);\n\tdict = NULL;\n\n\treturn ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_start_service_with_escrow_bag(lockdownd_client_t client, const char *identifier, lockdownd_service_descriptor_t *service)\n{\n\treturn lockdownd_do_start_service(client, identifier, 1, service);\n}"
  },
  {
    "function_name": "lockdownd_start_service",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
    "lines": "1359-1362",
    "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_start_service(lockdownd_client_t client, const char *identifier, lockdownd_service_descriptor_t *service)\n{\n\treturn lockdownd_do_start_service(client, identifier, 0, service);\n}",
    "includes": [
      "#include <windows.h>",
      "#include \"asprintf.h\"",
      "#include \"common/utils.h\"",
      "#include \"common/userpref.h\"",
      "#include \"common/debug.h\"",
      "#include \"idevice.h\"",
      "#include \"lockdown.h\"",
      "#include \"property_list_service.h\"",
      "#include <plist/plist.h>",
      "#include <gnutls/crypto.h>",
      "#include <gnutls/x509.h>",
      "#include <libtasn1.h>",
      "#include <openssl/x509v3.h>",
      "#include <openssl/x509.h>",
      "#include <openssl/pem.h>",
      "#include <unistd.h>",
      "#include <ctype.h>",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "lockdownd_do_start_service",
          "args": [
            "client",
            "identifier",
            "0",
            "service"
          ],
          "line": 1361
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_do_start_service",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "1278-1357",
          "snippet": "static lockdownd_error_t lockdownd_do_start_service(lockdownd_client_t client, const char *identifier, int send_escrow_bag, lockdownd_service_descriptor_t *service)\n{\n\tif (!client || !identifier || !service)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tif (*service) {\n\t\t// reset fields if service descriptor is reused\n\t\t(*service)->port = 0;\n\t\t(*service)->ssl_enabled = 0;\n\t}\n\n\tplist_t dict = NULL;\n\tuint16_t port_loc = 0;\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\t/* create StartService request */\n\tret = lockdownd_build_start_service_request(client, identifier, send_escrow_bag, &dict);\n\tif (LOCKDOWN_E_SUCCESS != ret)\n\t\treturn ret;\n\n\t/* send to device */\n\tret = lockdownd_send(client, dict);\n\tplist_free(dict);\n\tdict = NULL;\n\n\tif (LOCKDOWN_E_SUCCESS != ret)\n\t\treturn ret;\n\n\tret = lockdownd_receive(client, &dict);\n\n\tif (LOCKDOWN_E_SUCCESS != ret)\n\t\treturn ret;\n\n\tif (!dict)\n\t\treturn LOCKDOWN_E_PLIST_ERROR;\n\n\tret = lockdown_check_result(dict, \"StartService\");\n\tif (ret == LOCKDOWN_E_SUCCESS) {\n\t\tif (*service == NULL)\n\t\t\t*service = (lockdownd_service_descriptor_t)malloc(sizeof(struct lockdownd_service_descriptor));\n\t\t(*service)->port = 0;\n\t\t(*service)->ssl_enabled = 0;\n\n\t\t/* read service port number */\n\t\tplist_t node = plist_dict_get_item(dict, \"Port\");\n\t\tif (node && (plist_get_node_type(node) == PLIST_UINT)) {\n\t\t\tuint64_t port_value = 0;\n\t\t\tplist_get_uint_val(node, &port_value);\n\n\t\t\tif (port_value) {\n\t\t\t\tport_loc = port_value;\n\t\t\t\tret = LOCKDOWN_E_SUCCESS;\n\t\t\t}\n\t\t\tif (port_loc && ret == LOCKDOWN_E_SUCCESS) {\n\t\t\t\t(*service)->port = port_loc;\n\t\t\t}\n\t\t}\n\n\t\t/* check if the service requires SSL */\n\t\tnode = plist_dict_get_item(dict, \"EnableServiceSSL\");\n\t\tif (node && (plist_get_node_type(node) == PLIST_BOOLEAN)) {\n\t\t\tuint8_t b = 0;\n\t\t\tplist_get_bool_val(node, &b);\n\t\t\t(*service)->ssl_enabled = b;\n\t\t}\n\t} else {\n\t\tplist_t error_node = plist_dict_get_item(dict, \"Error\");\n\t\tif (error_node && PLIST_STRING == plist_get_node_type(error_node)) {\n\t\t\tchar *error = NULL;\n\t\t\tplist_get_string_val(error_node, &error);\n\t\t\tret = lockdownd_strtoerr(error);\n\t\t\tfree(error);\n\t\t}\n\t}\n\n\tplist_free(dict);\n\tdict = NULL;\n\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic lockdownd_error_t lockdownd_do_start_service(lockdownd_client_t client, const char *identifier, int send_escrow_bag, lockdownd_service_descriptor_t *service)\n{\n\tif (!client || !identifier || !service)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tif (*service) {\n\t\t// reset fields if service descriptor is reused\n\t\t(*service)->port = 0;\n\t\t(*service)->ssl_enabled = 0;\n\t}\n\n\tplist_t dict = NULL;\n\tuint16_t port_loc = 0;\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\t/* create StartService request */\n\tret = lockdownd_build_start_service_request(client, identifier, send_escrow_bag, &dict);\n\tif (LOCKDOWN_E_SUCCESS != ret)\n\t\treturn ret;\n\n\t/* send to device */\n\tret = lockdownd_send(client, dict);\n\tplist_free(dict);\n\tdict = NULL;\n\n\tif (LOCKDOWN_E_SUCCESS != ret)\n\t\treturn ret;\n\n\tret = lockdownd_receive(client, &dict);\n\n\tif (LOCKDOWN_E_SUCCESS != ret)\n\t\treturn ret;\n\n\tif (!dict)\n\t\treturn LOCKDOWN_E_PLIST_ERROR;\n\n\tret = lockdown_check_result(dict, \"StartService\");\n\tif (ret == LOCKDOWN_E_SUCCESS) {\n\t\tif (*service == NULL)\n\t\t\t*service = (lockdownd_service_descriptor_t)malloc(sizeof(struct lockdownd_service_descriptor));\n\t\t(*service)->port = 0;\n\t\t(*service)->ssl_enabled = 0;\n\n\t\t/* read service port number */\n\t\tplist_t node = plist_dict_get_item(dict, \"Port\");\n\t\tif (node && (plist_get_node_type(node) == PLIST_UINT)) {\n\t\t\tuint64_t port_value = 0;\n\t\t\tplist_get_uint_val(node, &port_value);\n\n\t\t\tif (port_value) {\n\t\t\t\tport_loc = port_value;\n\t\t\t\tret = LOCKDOWN_E_SUCCESS;\n\t\t\t}\n\t\t\tif (port_loc && ret == LOCKDOWN_E_SUCCESS) {\n\t\t\t\t(*service)->port = port_loc;\n\t\t\t}\n\t\t}\n\n\t\t/* check if the service requires SSL */\n\t\tnode = plist_dict_get_item(dict, \"EnableServiceSSL\");\n\t\tif (node && (plist_get_node_type(node) == PLIST_BOOLEAN)) {\n\t\t\tuint8_t b = 0;\n\t\t\tplist_get_bool_val(node, &b);\n\t\t\t(*service)->ssl_enabled = b;\n\t\t}\n\t} else {\n\t\tplist_t error_node = plist_dict_get_item(dict, \"Error\");\n\t\tif (error_node && PLIST_STRING == plist_get_node_type(error_node)) {\n\t\t\tchar *error = NULL;\n\t\t\tplist_get_string_val(error_node, &error);\n\t\t\tret = lockdownd_strtoerr(error);\n\t\t\tfree(error);\n\t\t}\n\t}\n\n\tplist_free(dict);\n\tdict = NULL;\n\n\treturn ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_start_service(lockdownd_client_t client, const char *identifier, lockdownd_service_descriptor_t *service)\n{\n\treturn lockdownd_do_start_service(client, identifier, 0, service);\n}"
  },
  {
    "function_name": "lockdownd_do_start_service",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
    "lines": "1278-1357",
    "snippet": "static lockdownd_error_t lockdownd_do_start_service(lockdownd_client_t client, const char *identifier, int send_escrow_bag, lockdownd_service_descriptor_t *service)\n{\n\tif (!client || !identifier || !service)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tif (*service) {\n\t\t// reset fields if service descriptor is reused\n\t\t(*service)->port = 0;\n\t\t(*service)->ssl_enabled = 0;\n\t}\n\n\tplist_t dict = NULL;\n\tuint16_t port_loc = 0;\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\t/* create StartService request */\n\tret = lockdownd_build_start_service_request(client, identifier, send_escrow_bag, &dict);\n\tif (LOCKDOWN_E_SUCCESS != ret)\n\t\treturn ret;\n\n\t/* send to device */\n\tret = lockdownd_send(client, dict);\n\tplist_free(dict);\n\tdict = NULL;\n\n\tif (LOCKDOWN_E_SUCCESS != ret)\n\t\treturn ret;\n\n\tret = lockdownd_receive(client, &dict);\n\n\tif (LOCKDOWN_E_SUCCESS != ret)\n\t\treturn ret;\n\n\tif (!dict)\n\t\treturn LOCKDOWN_E_PLIST_ERROR;\n\n\tret = lockdown_check_result(dict, \"StartService\");\n\tif (ret == LOCKDOWN_E_SUCCESS) {\n\t\tif (*service == NULL)\n\t\t\t*service = (lockdownd_service_descriptor_t)malloc(sizeof(struct lockdownd_service_descriptor));\n\t\t(*service)->port = 0;\n\t\t(*service)->ssl_enabled = 0;\n\n\t\t/* read service port number */\n\t\tplist_t node = plist_dict_get_item(dict, \"Port\");\n\t\tif (node && (plist_get_node_type(node) == PLIST_UINT)) {\n\t\t\tuint64_t port_value = 0;\n\t\t\tplist_get_uint_val(node, &port_value);\n\n\t\t\tif (port_value) {\n\t\t\t\tport_loc = port_value;\n\t\t\t\tret = LOCKDOWN_E_SUCCESS;\n\t\t\t}\n\t\t\tif (port_loc && ret == LOCKDOWN_E_SUCCESS) {\n\t\t\t\t(*service)->port = port_loc;\n\t\t\t}\n\t\t}\n\n\t\t/* check if the service requires SSL */\n\t\tnode = plist_dict_get_item(dict, \"EnableServiceSSL\");\n\t\tif (node && (plist_get_node_type(node) == PLIST_BOOLEAN)) {\n\t\t\tuint8_t b = 0;\n\t\t\tplist_get_bool_val(node, &b);\n\t\t\t(*service)->ssl_enabled = b;\n\t\t}\n\t} else {\n\t\tplist_t error_node = plist_dict_get_item(dict, \"Error\");\n\t\tif (error_node && PLIST_STRING == plist_get_node_type(error_node)) {\n\t\t\tchar *error = NULL;\n\t\t\tplist_get_string_val(error_node, &error);\n\t\t\tret = lockdownd_strtoerr(error);\n\t\t\tfree(error);\n\t\t}\n\t}\n\n\tplist_free(dict);\n\tdict = NULL;\n\n\treturn ret;\n}",
    "includes": [
      "#include <windows.h>",
      "#include \"asprintf.h\"",
      "#include \"common/utils.h\"",
      "#include \"common/userpref.h\"",
      "#include \"common/debug.h\"",
      "#include \"idevice.h\"",
      "#include \"lockdown.h\"",
      "#include \"property_list_service.h\"",
      "#include <plist/plist.h>",
      "#include <gnutls/crypto.h>",
      "#include <gnutls/x509.h>",
      "#include <libtasn1.h>",
      "#include <openssl/x509v3.h>",
      "#include <openssl/x509.h>",
      "#include <openssl/pem.h>",
      "#include <unistd.h>",
      "#include <ctype.h>",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "dict"
          ],
          "line": 1353
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "error"
          ],
          "line": 1349
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_service_descriptor_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "1522-1528",
          "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_service_descriptor_free(lockdownd_service_descriptor_t service)\n{\n\tif (service)\n\t\tfree(service);\n\n\treturn LOCKDOWN_E_SUCCESS;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_service_descriptor_free(lockdownd_service_descriptor_t service)\n{\n\tif (service)\n\t\tfree(service);\n\n\treturn LOCKDOWN_E_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lockdownd_strtoerr",
          "args": [
            "error"
          ],
          "line": 1348
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_strtoerr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "69-136",
          "snippet": "static lockdownd_error_t lockdownd_strtoerr(const char* name)\n{\n\tlockdownd_error_t err = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tif (strcmp(name, \"InvalidResponse\") == 0) {\n\t\terr = LOCKDOWN_E_INVALID_RESPONSE;\n\t} else if (strcmp(name, \"MissingKey\") == 0) {\n\t\terr = LOCKDOWN_E_MISSING_KEY;\n\t} else if (strcmp(name, \"MissingValue\") == 0) {\n\t\terr = LOCKDOWN_E_MISSING_VALUE;\n\t} else if (strcmp(name, \"GetProhibited\") == 0) {\n\t\terr = LOCKDOWN_E_GET_PROHIBITED;\n\t} else if (strcmp(name, \"SetProhibited\") == 0) {\n\t\terr = LOCKDOWN_E_SET_PROHIBITED;\n\t} else if (strcmp(name, \"RemoveProhibited\") == 0) {\n\t\terr = LOCKDOWN_E_REMOVE_PROHIBITED;\n\t} else if (strcmp(name, \"ImmutableValue\") == 0) {\n\t\terr = LOCKDOWN_E_IMMUTABLE_VALUE;\n\t} else if (strcmp(name, \"PasswordProtected\") == 0) {\n\t\terr = LOCKDOWN_E_PASSWORD_PROTECTED;\n\t} else if (strcmp(name, \"UserDeniedPairing\") == 0) {\n\t\terr = LOCKDOWN_E_USER_DENIED_PAIRING;\n\t} else if (strcmp(name, \"PairingDialogResponsePending\") == 0) {\n\t\terr = LOCKDOWN_E_PAIRING_DIALOG_RESPONSE_PENDING;\n\t} else if (strcmp(name, \"MissingHostID\") == 0) {\n\t\terr = LOCKDOWN_E_MISSING_HOST_ID;\n\t} else if (strcmp(name, \"InvalidHostID\") == 0) {\n\t\terr = LOCKDOWN_E_INVALID_HOST_ID;\n\t} else if (strcmp(name, \"SessionActive\") == 0) {\n\t\terr = LOCKDOWN_E_SESSION_ACTIVE;\n\t} else if (strcmp(name, \"SessionInactive\") == 0) {\n\t\terr = LOCKDOWN_E_SESSION_INACTIVE;\n\t} else if (strcmp(name, \"MissingSessionID\") == 0) {\n\t\terr = LOCKDOWN_E_MISSING_SESSION_ID;\n\t} else if (strcmp(name, \"InvalidSessionID\") == 0) {\n\t\terr = LOCKDOWN_E_INVALID_SESSION_ID;\n\t} else if (strcmp(name, \"MissingService\") == 0) {\n\t\terr = LOCKDOWN_E_MISSING_SERVICE;\n\t} else if (strcmp(name, \"InvalidService\") == 0) {\n\t\terr = LOCKDOWN_E_INVALID_SERVICE;\n\t} else if (strcmp(name, \"ServiceLimit\") == 0) {\n\t\terr = LOCKDOWN_E_SERVICE_LIMIT;\n\t} else if (strcmp(name, \"MissingPairRecord\") == 0) {\n\t\terr = LOCKDOWN_E_MISSING_PAIR_RECORD;\n\t} else if (strcmp(name, \"SavePairRecordFailed\") == 0) {\n\t\terr = LOCKDOWN_E_SAVE_PAIR_RECORD_FAILED;\n\t} else if (strcmp(name, \"InvalidPairRecord\") == 0) {\n\t\terr = LOCKDOWN_E_INVALID_PAIR_RECORD;\n\t} else if (strcmp(name, \"InvalidActivationRecord\") == 0) {\n\t\terr = LOCKDOWN_E_INVALID_ACTIVATION_RECORD;\n\t} else if (strcmp(name, \"MissingActivationRecord\") == 0) {\n\t\terr = LOCKDOWN_E_MISSING_ACTIVATION_RECORD;\n\t} else if (strcmp(name, \"ServiceProhibited\") == 0) {\n\t\terr = LOCKDOWN_E_SERVICE_PROHIBITED;\n\t} else if (strcmp(name, \"EscrowLocked\") == 0) {\n\t\terr = LOCKDOWN_E_ESCROW_LOCKED;\n\t} else if (strcmp(name, \"PairingProhibitedOverThisConnection\") == 0) {\n\t\terr = LOCKDOWN_E_PAIRING_PROHIBITED_OVER_THIS_CONNECTION;\n\t} else if (strcmp(name, \"FMiPProtected\") == 0) {\n\t\terr = LOCKDOWN_E_FMIP_PROTECTED;\n\t} else if (strcmp(name, \"MCProtected\") == 0) {\n\t\terr = LOCKDOWN_E_MC_PROTECTED;\n\t} else if (strcmp(name, \"MCChallengeRequired\") == 0) {\n\t\terr = LOCKDOWN_E_MC_CHALLENGE_REQUIRED;\n\t}\n\n\treturn err;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic lockdownd_error_t lockdownd_strtoerr(const char* name)\n{\n\tlockdownd_error_t err = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tif (strcmp(name, \"InvalidResponse\") == 0) {\n\t\terr = LOCKDOWN_E_INVALID_RESPONSE;\n\t} else if (strcmp(name, \"MissingKey\") == 0) {\n\t\terr = LOCKDOWN_E_MISSING_KEY;\n\t} else if (strcmp(name, \"MissingValue\") == 0) {\n\t\terr = LOCKDOWN_E_MISSING_VALUE;\n\t} else if (strcmp(name, \"GetProhibited\") == 0) {\n\t\terr = LOCKDOWN_E_GET_PROHIBITED;\n\t} else if (strcmp(name, \"SetProhibited\") == 0) {\n\t\terr = LOCKDOWN_E_SET_PROHIBITED;\n\t} else if (strcmp(name, \"RemoveProhibited\") == 0) {\n\t\terr = LOCKDOWN_E_REMOVE_PROHIBITED;\n\t} else if (strcmp(name, \"ImmutableValue\") == 0) {\n\t\terr = LOCKDOWN_E_IMMUTABLE_VALUE;\n\t} else if (strcmp(name, \"PasswordProtected\") == 0) {\n\t\terr = LOCKDOWN_E_PASSWORD_PROTECTED;\n\t} else if (strcmp(name, \"UserDeniedPairing\") == 0) {\n\t\terr = LOCKDOWN_E_USER_DENIED_PAIRING;\n\t} else if (strcmp(name, \"PairingDialogResponsePending\") == 0) {\n\t\terr = LOCKDOWN_E_PAIRING_DIALOG_RESPONSE_PENDING;\n\t} else if (strcmp(name, \"MissingHostID\") == 0) {\n\t\terr = LOCKDOWN_E_MISSING_HOST_ID;\n\t} else if (strcmp(name, \"InvalidHostID\") == 0) {\n\t\terr = LOCKDOWN_E_INVALID_HOST_ID;\n\t} else if (strcmp(name, \"SessionActive\") == 0) {\n\t\terr = LOCKDOWN_E_SESSION_ACTIVE;\n\t} else if (strcmp(name, \"SessionInactive\") == 0) {\n\t\terr = LOCKDOWN_E_SESSION_INACTIVE;\n\t} else if (strcmp(name, \"MissingSessionID\") == 0) {\n\t\terr = LOCKDOWN_E_MISSING_SESSION_ID;\n\t} else if (strcmp(name, \"InvalidSessionID\") == 0) {\n\t\terr = LOCKDOWN_E_INVALID_SESSION_ID;\n\t} else if (strcmp(name, \"MissingService\") == 0) {\n\t\terr = LOCKDOWN_E_MISSING_SERVICE;\n\t} else if (strcmp(name, \"InvalidService\") == 0) {\n\t\terr = LOCKDOWN_E_INVALID_SERVICE;\n\t} else if (strcmp(name, \"ServiceLimit\") == 0) {\n\t\terr = LOCKDOWN_E_SERVICE_LIMIT;\n\t} else if (strcmp(name, \"MissingPairRecord\") == 0) {\n\t\terr = LOCKDOWN_E_MISSING_PAIR_RECORD;\n\t} else if (strcmp(name, \"SavePairRecordFailed\") == 0) {\n\t\terr = LOCKDOWN_E_SAVE_PAIR_RECORD_FAILED;\n\t} else if (strcmp(name, \"InvalidPairRecord\") == 0) {\n\t\terr = LOCKDOWN_E_INVALID_PAIR_RECORD;\n\t} else if (strcmp(name, \"InvalidActivationRecord\") == 0) {\n\t\terr = LOCKDOWN_E_INVALID_ACTIVATION_RECORD;\n\t} else if (strcmp(name, \"MissingActivationRecord\") == 0) {\n\t\terr = LOCKDOWN_E_MISSING_ACTIVATION_RECORD;\n\t} else if (strcmp(name, \"ServiceProhibited\") == 0) {\n\t\terr = LOCKDOWN_E_SERVICE_PROHIBITED;\n\t} else if (strcmp(name, \"EscrowLocked\") == 0) {\n\t\terr = LOCKDOWN_E_ESCROW_LOCKED;\n\t} else if (strcmp(name, \"PairingProhibitedOverThisConnection\") == 0) {\n\t\terr = LOCKDOWN_E_PAIRING_PROHIBITED_OVER_THIS_CONNECTION;\n\t} else if (strcmp(name, \"FMiPProtected\") == 0) {\n\t\terr = LOCKDOWN_E_FMIP_PROTECTED;\n\t} else if (strcmp(name, \"MCProtected\") == 0) {\n\t\terr = LOCKDOWN_E_MC_PROTECTED;\n\t} else if (strcmp(name, \"MCChallengeRequired\") == 0) {\n\t\terr = LOCKDOWN_E_MC_CHALLENGE_REQUIRED;\n\t}\n\n\treturn err;\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_get_string_val",
          "args": [
            "error_node",
            "&error"
          ],
          "line": 1347
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_get_node_type",
          "args": [
            "error_node"
          ],
          "line": 1345
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_get_item",
          "args": [
            "dict",
            "\"Error\""
          ],
          "line": 1344
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_get_bool_val",
          "args": [
            "node",
            "&b"
          ],
          "line": 1340
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_get_node_type",
          "args": [
            "node"
          ],
          "line": 1338
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_get_item",
          "args": [
            "dict",
            "\"EnableServiceSSL\""
          ],
          "line": 1337
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_get_uint_val",
          "args": [
            "node",
            "&port_value"
          ],
          "line": 1325
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_get_node_type",
          "args": [
            "node"
          ],
          "line": 1323
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_get_item",
          "args": [
            "dict",
            "\"Port\""
          ],
          "line": 1322
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "malloc",
          "args": [
            "sizeof(struct lockdownd_service_descriptor)"
          ],
          "line": 1317
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lockdown_check_result",
          "args": [
            "dict",
            "\"StartService\""
          ],
          "line": 1314
        },
        "resolved": true,
        "details": {
          "function_name": "lockdown_check_result",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "150-223",
          "snippet": "static lockdownd_error_t lockdown_check_result(plist_t dict, const char *query_match)\n{\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tplist_t query_node = plist_dict_get_item(dict, \"Request\");\n\tif (!query_node) {\n\t\treturn ret;\n\t}\n\n\tif (plist_get_node_type(query_node) != PLIST_STRING) {\n\t\treturn ret;\n\t} else {\n\t\tchar *query_value = NULL;\n\n\t\tplist_get_string_val(query_node, &query_value);\n\t\tif (!query_value) {\n\t\t\treturn ret;\n\t\t}\n\n\t\tif (query_match && (strcmp(query_value, query_match) != 0)) {\n\t\t\tfree(query_value);\n\t\t\treturn ret;\n\t\t}\n\n\t\tfree(query_value);\n\t}\n\n\tplist_t result_node = plist_dict_get_item(dict, \"Result\");\n\tif (!result_node) {\n\t\t/* iOS 5: the 'Result' key is not present anymore.\n\t\t   But we need to check for the 'Error' key. */\n\t\tplist_t err_node = plist_dict_get_item(dict, \"Error\");\n\t\tif (err_node) {\n\t\t\tif (plist_get_node_type(err_node) == PLIST_STRING) {\n\t\t\t\tchar *err_value = NULL;\n\n\t\t\t\tplist_get_string_val(err_node, &err_value);\n\t\t\t\tif (err_value) {\n\t\t\t\t\tdebug_info(\"ERROR: %s\", err_value);\n\t\t\t\t\tret = lockdownd_strtoerr(err_value);\n\t\t\t\t\tfree(err_value);\n\t\t\t\t} else {\n\t\t\t\t\tdebug_info(\"ERROR: unknown error occured\");\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn ret;\n\t\t}\n\n\t\tret = LOCKDOWN_E_SUCCESS;\n\n\t\treturn ret;\n\t}\n\n\tplist_type result_type = plist_get_node_type(result_node);\n\tif (result_type == PLIST_STRING) {\n\t\tchar *result_value = NULL;\n\n\t\tplist_get_string_val(result_node, &result_value);\n\t\tif (result_value) {\n\t\t\tif (!strcmp(result_value, \"Success\")) {\n\t\t\t\tret = LOCKDOWN_E_SUCCESS;\n\t\t\t} else if (!strcmp(result_value, \"Failure\")) {\n\t\t\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t\t\t} else {\n\t\t\t\tdebug_info(\"ERROR: unknown result value '%s'\", result_value);\n\t\t\t}\n\t\t}\n\n\t\tif (result_value)\n\t\t\tfree(result_value);\n\t}\n\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic lockdownd_error_t lockdown_check_result(plist_t dict, const char *query_match)\n{\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tplist_t query_node = plist_dict_get_item(dict, \"Request\");\n\tif (!query_node) {\n\t\treturn ret;\n\t}\n\n\tif (plist_get_node_type(query_node) != PLIST_STRING) {\n\t\treturn ret;\n\t} else {\n\t\tchar *query_value = NULL;\n\n\t\tplist_get_string_val(query_node, &query_value);\n\t\tif (!query_value) {\n\t\t\treturn ret;\n\t\t}\n\n\t\tif (query_match && (strcmp(query_value, query_match) != 0)) {\n\t\t\tfree(query_value);\n\t\t\treturn ret;\n\t\t}\n\n\t\tfree(query_value);\n\t}\n\n\tplist_t result_node = plist_dict_get_item(dict, \"Result\");\n\tif (!result_node) {\n\t\t/* iOS 5: the 'Result' key is not present anymore.\n\t\t   But we need to check for the 'Error' key. */\n\t\tplist_t err_node = plist_dict_get_item(dict, \"Error\");\n\t\tif (err_node) {\n\t\t\tif (plist_get_node_type(err_node) == PLIST_STRING) {\n\t\t\t\tchar *err_value = NULL;\n\n\t\t\t\tplist_get_string_val(err_node, &err_value);\n\t\t\t\tif (err_value) {\n\t\t\t\t\tdebug_info(\"ERROR: %s\", err_value);\n\t\t\t\t\tret = lockdownd_strtoerr(err_value);\n\t\t\t\t\tfree(err_value);\n\t\t\t\t} else {\n\t\t\t\t\tdebug_info(\"ERROR: unknown error occured\");\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn ret;\n\t\t}\n\n\t\tret = LOCKDOWN_E_SUCCESS;\n\n\t\treturn ret;\n\t}\n\n\tplist_type result_type = plist_get_node_type(result_node);\n\tif (result_type == PLIST_STRING) {\n\t\tchar *result_value = NULL;\n\n\t\tplist_get_string_val(result_node, &result_value);\n\t\tif (result_value) {\n\t\t\tif (!strcmp(result_value, \"Success\")) {\n\t\t\t\tret = LOCKDOWN_E_SUCCESS;\n\t\t\t} else if (!strcmp(result_value, \"Failure\")) {\n\t\t\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t\t\t} else {\n\t\t\t\tdebug_info(\"ERROR: unknown result value '%s'\", result_value);\n\t\t\t}\n\t\t}\n\n\t\tif (result_value)\n\t\t\tfree(result_value);\n\t}\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lockdownd_receive",
          "args": [
            "client",
            "&dict"
          ],
          "line": 1306
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_receive",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "348-364",
          "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_receive(lockdownd_client_t client, plist_t *plist)\n{\n\tif (!client || !plist || (plist && *plist))\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\tlockdownd_error_t ret = LOCKDOWN_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_receive_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t}\n\n\tif (!*plist)\n\t\tret = LOCKDOWN_E_PLIST_ERROR;\n\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_receive(lockdownd_client_t client, plist_t *plist)\n{\n\tif (!client || !plist || (plist && *plist))\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\tlockdownd_error_t ret = LOCKDOWN_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_receive_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t}\n\n\tif (!*plist)\n\t\tret = LOCKDOWN_E_PLIST_ERROR;\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "dict"
          ],
          "line": 1300
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lockdownd_send",
          "args": [
            "client",
            "dict"
          ],
          "line": 1299
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_send",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "366-379",
          "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_send(lockdownd_client_t client, plist_t plist)\n{\n\tif (!client || !plist)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_send_xml_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t}\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_send(lockdownd_client_t client, plist_t plist)\n{\n\tif (!client || !plist)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_send_xml_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t}\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lockdownd_build_start_service_request",
          "args": [
            "client",
            "identifier",
            "send_escrow_bag",
            "&dict"
          ],
          "line": 1294
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_build_start_service_request",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "1226-1262",
          "snippet": "static lockdownd_error_t lockdownd_build_start_service_request(lockdownd_client_t client, const char *identifier, int send_escrow_bag, plist_t *request)\n{\n\tplist_t dict = plist_new_dict();\n\n\t/* create the basic request params */\n\tplist_dict_add_label(dict, client->label);\n\tplist_dict_set_item(dict, \"Request\", plist_new_string(\"StartService\"));\n\tplist_dict_set_item(dict, \"Service\", plist_new_string(identifier));\n\n\t/* if needed - get the escrow bag for the device and send it with the request */\n\tif (send_escrow_bag) {\n\t\t/* get the pairing record */\n\t\tplist_t pair_record = NULL;\n\t\tuserpref_read_pair_record(client->udid, &pair_record);\n\t\tif (!pair_record) {\n\t\t\tdebug_info(\"ERROR: failed to read pair record for device: %s\", client->udid);\n\t\t\tplist_free(dict);\n\t\t\treturn LOCKDOWN_E_INVALID_CONF;\n\t\t}\n\n\t\t/* try to read the escrow bag from the record */\n\t\tplist_t escrow_bag = plist_dict_get_item(pair_record, USERPREF_ESCROW_BAG_KEY);\n\t\tif (!escrow_bag || (PLIST_DATA != plist_get_node_type(escrow_bag))) {\n\t\t\tdebug_info(\"ERROR: Failed to retrieve the escrow bag from the device's record\");\n\t\t\tplist_free(dict);\n\t\t\tplist_free(pair_record);\n\t\t\treturn LOCKDOWN_E_INVALID_CONF;\n\t\t}\n\n\t\tdebug_info(\"Adding escrow bag to StartService for %s\", identifier);\n\t\tplist_dict_set_item(dict, USERPREF_ESCROW_BAG_KEY, plist_copy(escrow_bag));\n\t\tplist_free(pair_record);\n\t}\n\n\t*request = dict;\n\treturn LOCKDOWN_E_SUCCESS;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic lockdownd_error_t lockdownd_build_start_service_request(lockdownd_client_t client, const char *identifier, int send_escrow_bag, plist_t *request)\n{\n\tplist_t dict = plist_new_dict();\n\n\t/* create the basic request params */\n\tplist_dict_add_label(dict, client->label);\n\tplist_dict_set_item(dict, \"Request\", plist_new_string(\"StartService\"));\n\tplist_dict_set_item(dict, \"Service\", plist_new_string(identifier));\n\n\t/* if needed - get the escrow bag for the device and send it with the request */\n\tif (send_escrow_bag) {\n\t\t/* get the pairing record */\n\t\tplist_t pair_record = NULL;\n\t\tuserpref_read_pair_record(client->udid, &pair_record);\n\t\tif (!pair_record) {\n\t\t\tdebug_info(\"ERROR: failed to read pair record for device: %s\", client->udid);\n\t\t\tplist_free(dict);\n\t\t\treturn LOCKDOWN_E_INVALID_CONF;\n\t\t}\n\n\t\t/* try to read the escrow bag from the record */\n\t\tplist_t escrow_bag = plist_dict_get_item(pair_record, USERPREF_ESCROW_BAG_KEY);\n\t\tif (!escrow_bag || (PLIST_DATA != plist_get_node_type(escrow_bag))) {\n\t\t\tdebug_info(\"ERROR: Failed to retrieve the escrow bag from the device's record\");\n\t\t\tplist_free(dict);\n\t\t\tplist_free(pair_record);\n\t\t\treturn LOCKDOWN_E_INVALID_CONF;\n\t\t}\n\n\t\tdebug_info(\"Adding escrow bag to StartService for %s\", identifier);\n\t\tplist_dict_set_item(dict, USERPREF_ESCROW_BAG_KEY, plist_copy(escrow_bag));\n\t\tplist_free(pair_record);\n\t}\n\n\t*request = dict;\n\treturn LOCKDOWN_E_SUCCESS;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic lockdownd_error_t lockdownd_do_start_service(lockdownd_client_t client, const char *identifier, int send_escrow_bag, lockdownd_service_descriptor_t *service)\n{\n\tif (!client || !identifier || !service)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tif (*service) {\n\t\t// reset fields if service descriptor is reused\n\t\t(*service)->port = 0;\n\t\t(*service)->ssl_enabled = 0;\n\t}\n\n\tplist_t dict = NULL;\n\tuint16_t port_loc = 0;\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\t/* create StartService request */\n\tret = lockdownd_build_start_service_request(client, identifier, send_escrow_bag, &dict);\n\tif (LOCKDOWN_E_SUCCESS != ret)\n\t\treturn ret;\n\n\t/* send to device */\n\tret = lockdownd_send(client, dict);\n\tplist_free(dict);\n\tdict = NULL;\n\n\tif (LOCKDOWN_E_SUCCESS != ret)\n\t\treturn ret;\n\n\tret = lockdownd_receive(client, &dict);\n\n\tif (LOCKDOWN_E_SUCCESS != ret)\n\t\treturn ret;\n\n\tif (!dict)\n\t\treturn LOCKDOWN_E_PLIST_ERROR;\n\n\tret = lockdown_check_result(dict, \"StartService\");\n\tif (ret == LOCKDOWN_E_SUCCESS) {\n\t\tif (*service == NULL)\n\t\t\t*service = (lockdownd_service_descriptor_t)malloc(sizeof(struct lockdownd_service_descriptor));\n\t\t(*service)->port = 0;\n\t\t(*service)->ssl_enabled = 0;\n\n\t\t/* read service port number */\n\t\tplist_t node = plist_dict_get_item(dict, \"Port\");\n\t\tif (node && (plist_get_node_type(node) == PLIST_UINT)) {\n\t\t\tuint64_t port_value = 0;\n\t\t\tplist_get_uint_val(node, &port_value);\n\n\t\t\tif (port_value) {\n\t\t\t\tport_loc = port_value;\n\t\t\t\tret = LOCKDOWN_E_SUCCESS;\n\t\t\t}\n\t\t\tif (port_loc && ret == LOCKDOWN_E_SUCCESS) {\n\t\t\t\t(*service)->port = port_loc;\n\t\t\t}\n\t\t}\n\n\t\t/* check if the service requires SSL */\n\t\tnode = plist_dict_get_item(dict, \"EnableServiceSSL\");\n\t\tif (node && (plist_get_node_type(node) == PLIST_BOOLEAN)) {\n\t\t\tuint8_t b = 0;\n\t\t\tplist_get_bool_val(node, &b);\n\t\t\t(*service)->ssl_enabled = b;\n\t\t}\n\t} else {\n\t\tplist_t error_node = plist_dict_get_item(dict, \"Error\");\n\t\tif (error_node && PLIST_STRING == plist_get_node_type(error_node)) {\n\t\t\tchar *error = NULL;\n\t\t\tplist_get_string_val(error_node, &error);\n\t\t\tret = lockdownd_strtoerr(error);\n\t\t\tfree(error);\n\t\t}\n\t}\n\n\tplist_free(dict);\n\tdict = NULL;\n\n\treturn ret;\n}"
  },
  {
    "function_name": "lockdownd_build_start_service_request",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
    "lines": "1226-1262",
    "snippet": "static lockdownd_error_t lockdownd_build_start_service_request(lockdownd_client_t client, const char *identifier, int send_escrow_bag, plist_t *request)\n{\n\tplist_t dict = plist_new_dict();\n\n\t/* create the basic request params */\n\tplist_dict_add_label(dict, client->label);\n\tplist_dict_set_item(dict, \"Request\", plist_new_string(\"StartService\"));\n\tplist_dict_set_item(dict, \"Service\", plist_new_string(identifier));\n\n\t/* if needed - get the escrow bag for the device and send it with the request */\n\tif (send_escrow_bag) {\n\t\t/* get the pairing record */\n\t\tplist_t pair_record = NULL;\n\t\tuserpref_read_pair_record(client->udid, &pair_record);\n\t\tif (!pair_record) {\n\t\t\tdebug_info(\"ERROR: failed to read pair record for device: %s\", client->udid);\n\t\t\tplist_free(dict);\n\t\t\treturn LOCKDOWN_E_INVALID_CONF;\n\t\t}\n\n\t\t/* try to read the escrow bag from the record */\n\t\tplist_t escrow_bag = plist_dict_get_item(pair_record, USERPREF_ESCROW_BAG_KEY);\n\t\tif (!escrow_bag || (PLIST_DATA != plist_get_node_type(escrow_bag))) {\n\t\t\tdebug_info(\"ERROR: Failed to retrieve the escrow bag from the device's record\");\n\t\t\tplist_free(dict);\n\t\t\tplist_free(pair_record);\n\t\t\treturn LOCKDOWN_E_INVALID_CONF;\n\t\t}\n\n\t\tdebug_info(\"Adding escrow bag to StartService for %s\", identifier);\n\t\tplist_dict_set_item(dict, USERPREF_ESCROW_BAG_KEY, plist_copy(escrow_bag));\n\t\tplist_free(pair_record);\n\t}\n\n\t*request = dict;\n\treturn LOCKDOWN_E_SUCCESS;\n}",
    "includes": [
      "#include <windows.h>",
      "#include \"asprintf.h\"",
      "#include \"common/utils.h\"",
      "#include \"common/userpref.h\"",
      "#include \"common/debug.h\"",
      "#include \"idevice.h\"",
      "#include \"lockdown.h\"",
      "#include \"property_list_service.h\"",
      "#include <plist/plist.h>",
      "#include <gnutls/crypto.h>",
      "#include <gnutls/x509.h>",
      "#include <libtasn1.h>",
      "#include <openssl/x509v3.h>",
      "#include <openssl/x509.h>",
      "#include <openssl/pem.h>",
      "#include <unistd.h>",
      "#include <ctype.h>",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "pair_record"
          ],
          "line": 1257
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "USERPREF_ESCROW_BAG_KEY",
            "plist_copy(escrow_bag)"
          ],
          "line": 1256
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_copy",
          "args": [
            "escrow_bag"
          ],
          "line": 1256
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"Adding escrow bag to StartService for %s\"",
            "identifier"
          ],
          "line": 1255
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "pair_record"
          ],
          "line": 1251
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "dict"
          ],
          "line": 1250
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"ERROR: Failed to retrieve the escrow bag from the device's record\""
          ],
          "line": 1249
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_get_node_type",
          "args": [
            "escrow_bag"
          ],
          "line": 1248
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_get_item",
          "args": [
            "pair_record",
            "USERPREF_ESCROW_BAG_KEY"
          ],
          "line": 1247
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "dict"
          ],
          "line": 1242
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"ERROR: failed to read pair record for device: %s\"",
            "client->udid"
          ],
          "line": 1241
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "userpref_read_pair_record",
          "args": [
            "client->udid",
            "&pair_record"
          ],
          "line": 1239
        },
        "resolved": true,
        "details": {
          "function_name": "userpref_read_pair_record",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/common/userpref.c",
          "lines": "333-357",
          "snippet": "userpref_error_t userpref_read_pair_record(const char *udid, plist_t *pair_record)\n{\n\tchar* record_data = NULL;\n\tuint32_t record_size = 0;\n\n\tint res = usbmuxd_read_pair_record(udid, &record_data, &record_size);\n\n\tif (res < 0) {\n\t\tif (record_data)\n\t\t\tfree(record_data);\n\n\t\treturn USERPREF_E_INVALID_CONF;\n\t}\n\n\t*pair_record = NULL;\n\tif (memcmp(record_data, \"bplist00\", 8) == 0) {\n\t\tplist_from_bin(record_data, record_size, pair_record);\n\t} else {\n\t\tplist_from_xml(record_data, record_size, pair_record);\n\t}\n\n\tfree(record_data);\n\n\treturn res == 0 ? USERPREF_E_SUCCESS: USERPREF_E_UNKNOWN_ERROR;\n}",
          "includes": [
            "#include \"utils.h\"",
            "#include \"debug.h\"",
            "#include \"userpref.h\"",
            "#include <shlobj.h>",
            "#include <errno.h>",
            "#include <sys/stat.h>",
            "#include <libgen.h>",
            "#include <dirent.h>",
            "#include <libtasn1.h>",
            "#include <gcrypt.h>",
            "#include <gnutls/x509.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/gnutls.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/rsa.h>",
            "#include <openssl/pem.h>",
            "#include <usbmuxd.h>",
            "#include <unistd.h>",
            "#include <pwd.h>",
            "#include <sys/types.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"utils.h\"\n#include \"debug.h\"\n#include \"userpref.h\"\n#include <shlobj.h>\n#include <errno.h>\n#include <sys/stat.h>\n#include <libgen.h>\n#include <dirent.h>\n#include <libtasn1.h>\n#include <gcrypt.h>\n#include <gnutls/x509.h>\n#include <gnutls/crypto.h>\n#include <gnutls/gnutls.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/rsa.h>\n#include <openssl/pem.h>\n#include <usbmuxd.h>\n#include <unistd.h>\n#include <pwd.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nuserpref_error_t userpref_read_pair_record(const char *udid, plist_t *pair_record)\n{\n\tchar* record_data = NULL;\n\tuint32_t record_size = 0;\n\n\tint res = usbmuxd_read_pair_record(udid, &record_data, &record_size);\n\n\tif (res < 0) {\n\t\tif (record_data)\n\t\t\tfree(record_data);\n\n\t\treturn USERPREF_E_INVALID_CONF;\n\t}\n\n\t*pair_record = NULL;\n\tif (memcmp(record_data, \"bplist00\", 8) == 0) {\n\t\tplist_from_bin(record_data, record_size, pair_record);\n\t} else {\n\t\tplist_from_xml(record_data, record_size, pair_record);\n\t}\n\n\tfree(record_data);\n\n\treturn res == 0 ? USERPREF_E_SUCCESS: USERPREF_E_UNKNOWN_ERROR;\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"Service\"",
            "plist_new_string(identifier)"
          ],
          "line": 1233
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "identifier"
          ],
          "line": 1233
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"Request\"",
            "plist_new_string(\"StartService\")"
          ],
          "line": 1232
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "\"StartService\""
          ],
          "line": 1232
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_add_label",
          "args": [
            "dict",
            "client->label"
          ],
          "line": 1231
        },
        "resolved": true,
        "details": {
          "function_name": "plist_dict_add_label",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "232-238",
          "snippet": "static void plist_dict_add_label(plist_t plist, const char *label)\n{\n\tif (plist && label) {\n\t\tif (plist_get_node_type(plist) == PLIST_DICT)\n\t\t\tplist_dict_set_item(plist, \"Label\", plist_new_string(label));\n\t}\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic void plist_dict_add_label(plist_t plist, const char *label)\n{\n\tif (plist && label) {\n\t\tif (plist_get_node_type(plist) == PLIST_DICT)\n\t\t\tplist_dict_set_item(plist, \"Label\", plist_new_string(label));\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_new_dict",
          "args": [],
          "line": 1228
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic lockdownd_error_t lockdownd_build_start_service_request(lockdownd_client_t client, const char *identifier, int send_escrow_bag, plist_t *request)\n{\n\tplist_t dict = plist_new_dict();\n\n\t/* create the basic request params */\n\tplist_dict_add_label(dict, client->label);\n\tplist_dict_set_item(dict, \"Request\", plist_new_string(\"StartService\"));\n\tplist_dict_set_item(dict, \"Service\", plist_new_string(identifier));\n\n\t/* if needed - get the escrow bag for the device and send it with the request */\n\tif (send_escrow_bag) {\n\t\t/* get the pairing record */\n\t\tplist_t pair_record = NULL;\n\t\tuserpref_read_pair_record(client->udid, &pair_record);\n\t\tif (!pair_record) {\n\t\t\tdebug_info(\"ERROR: failed to read pair record for device: %s\", client->udid);\n\t\t\tplist_free(dict);\n\t\t\treturn LOCKDOWN_E_INVALID_CONF;\n\t\t}\n\n\t\t/* try to read the escrow bag from the record */\n\t\tplist_t escrow_bag = plist_dict_get_item(pair_record, USERPREF_ESCROW_BAG_KEY);\n\t\tif (!escrow_bag || (PLIST_DATA != plist_get_node_type(escrow_bag))) {\n\t\t\tdebug_info(\"ERROR: Failed to retrieve the escrow bag from the device's record\");\n\t\t\tplist_free(dict);\n\t\t\tplist_free(pair_record);\n\t\t\treturn LOCKDOWN_E_INVALID_CONF;\n\t\t}\n\n\t\tdebug_info(\"Adding escrow bag to StartService for %s\", identifier);\n\t\tplist_dict_set_item(dict, USERPREF_ESCROW_BAG_KEY, plist_copy(escrow_bag));\n\t\tplist_free(pair_record);\n\t}\n\n\t*request = dict;\n\treturn LOCKDOWN_E_SUCCESS;\n}"
  },
  {
    "function_name": "lockdownd_start_session",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
    "lines": "1117-1212",
    "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_start_session(lockdownd_client_t client, const char *host_id, char **session_id, int *ssl_enabled)\n{\n\tlockdownd_error_t ret = LOCKDOWN_E_SUCCESS;\n\tproperty_list_service_error_t plret;\n\tplist_t dict = NULL;\n\n\tif (!client || !host_id)\n\t\tret = LOCKDOWN_E_INVALID_ARG;\n\n\t/* if we have a running session, stop current one first */\n\tif (client->session_id) {\n\t\tlockdownd_stop_session(client, client->session_id);\n\t}\n\n\t/* setup request plist */\n\tdict = plist_new_dict();\n\tplist_dict_add_label(dict, client->label);\n\tplist_dict_set_item(dict,\"Request\", plist_new_string(\"StartSession\"));\n\n\t/* add host id */\n\tif (host_id) {\n\t\tplist_dict_set_item(dict, \"HostID\", plist_new_string(host_id));\n\t}\n\n\t/* add system buid */\n\tchar *system_buid = NULL;\n\tuserpref_read_system_buid(&system_buid);\n\tif (system_buid) {\n\t\tplist_dict_set_item(dict, \"SystemBUID\", plist_new_string(system_buid));\n\t\tif (system_buid) {\n\t\t\tfree(system_buid);\n\t\t\tsystem_buid = NULL;\n\t\t}\n\t}\n\n\tret = lockdownd_send(client, dict);\n\tplist_free(dict);\n\tdict = NULL;\n\n\tif (ret != LOCKDOWN_E_SUCCESS)\n\t\treturn ret;\n\n\tret = lockdownd_receive(client, &dict);\n\n\tif (!dict)\n\t\treturn LOCKDOWN_E_PLIST_ERROR;\n\n\tret = lockdown_check_result(dict, \"StartSession\");\n\tif (ret == LOCKDOWN_E_SUCCESS) {\n\t\tuint8_t use_ssl = 0;\n\n\t\tplist_t enable_ssl = plist_dict_get_item(dict, \"EnableSessionSSL\");\n\t\tif (enable_ssl && (plist_get_node_type(enable_ssl) == PLIST_BOOLEAN)) {\n\t\t\tplist_get_bool_val(enable_ssl, &use_ssl);\n\t\t}\n\t\tdebug_info(\"Session startup OK\");\n\n\t\tif (ssl_enabled != NULL)\n\t\t\t*ssl_enabled = use_ssl;\n\n\t\t/* store session id, we need it for StopSession */\n\t\tplist_t session_node = plist_dict_get_item(dict, \"SessionID\");\n\t\tif (session_node && (plist_get_node_type(session_node) == PLIST_STRING)) {\n\t\t\tplist_get_string_val(session_node, &client->session_id);\n\t\t}\n\n\t\tif (client->session_id) {\n\t\t\tdebug_info(\"SessionID: %s\", client->session_id);\n\t\t\tif (session_id != NULL)\n\t\t\t\t*session_id = strdup(client->session_id);\n\t\t} else {\n\t\t\tdebug_info(\"Failed to get SessionID!\");\n\t\t}\n\n\t\tdebug_info(\"Enable SSL Session: %s\", (use_ssl?\"true\":\"false\"));\n\n\t\tif (use_ssl) {\n\t\t\tplret = property_list_service_enable_ssl(client->parent);\n\t\t\tif (plret == PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\t\t\tret = LOCKDOWN_E_SUCCESS;\n\t\t\t\tclient->ssl_enabled = 1;\n\t\t\t} else {\n\t\t\t\tret = LOCKDOWN_E_SSL_ERROR;\n\t\t\t\tclient->ssl_enabled = 0;\n\t\t\t}\n\t\t} else {\n\t\t\tclient->ssl_enabled = 0;\n\t\t\tret = LOCKDOWN_E_SUCCESS;\n\t\t}\n\t}\n\n\tplist_free(dict);\n\tdict = NULL;\n\n\treturn ret;\n}",
    "includes": [
      "#include <windows.h>",
      "#include \"asprintf.h\"",
      "#include \"common/utils.h\"",
      "#include \"common/userpref.h\"",
      "#include \"common/debug.h\"",
      "#include \"idevice.h\"",
      "#include \"lockdown.h\"",
      "#include \"property_list_service.h\"",
      "#include <plist/plist.h>",
      "#include <gnutls/crypto.h>",
      "#include <gnutls/x509.h>",
      "#include <libtasn1.h>",
      "#include <openssl/x509v3.h>",
      "#include <openssl/x509.h>",
      "#include <openssl/pem.h>",
      "#include <unistd.h>",
      "#include <ctype.h>",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "dict"
          ],
          "line": 1208
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "property_list_service_enable_ssl",
          "args": [
            "client->parent"
          ],
          "line": 1194
        },
        "resolved": true,
        "details": {
          "function_name": "property_list_service_enable_ssl",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
          "lines": "263-268",
          "snippet": "LIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_enable_ssl(property_list_service_client_t client)\n{\n\tif (!client || !client->parent)\n\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\treturn service_to_property_list_service_error(service_enable_ssl(client->parent));\n}",
          "includes": [
            "#include \"endianness.h\"",
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_enable_ssl(property_list_service_client_t client)\n{\n\tif (!client || !client->parent)\n\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\treturn service_to_property_list_service_error(service_enable_ssl(client->parent));\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"Enable SSL Session: %s\"",
            "(use_ssl?\"true\":\"false\")"
          ],
          "line": 1191
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"Failed to get SessionID!\""
          ],
          "line": 1188
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "client->session_id"
          ],
          "line": 1186
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"SessionID: %s\"",
            "client->session_id"
          ],
          "line": 1184
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_get_string_val",
          "args": [
            "session_node",
            "&client->session_id"
          ],
          "line": 1180
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_get_node_type",
          "args": [
            "session_node"
          ],
          "line": 1179
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_get_item",
          "args": [
            "dict",
            "\"SessionID\""
          ],
          "line": 1178
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"Session startup OK\""
          ],
          "line": 1172
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_get_bool_val",
          "args": [
            "enable_ssl",
            "&use_ssl"
          ],
          "line": 1170
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_get_node_type",
          "args": [
            "enable_ssl"
          ],
          "line": 1169
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_get_item",
          "args": [
            "dict",
            "\"EnableSessionSSL\""
          ],
          "line": 1168
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lockdown_check_result",
          "args": [
            "dict",
            "\"StartSession\""
          ],
          "line": 1164
        },
        "resolved": true,
        "details": {
          "function_name": "lockdown_check_result",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "150-223",
          "snippet": "static lockdownd_error_t lockdown_check_result(plist_t dict, const char *query_match)\n{\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tplist_t query_node = plist_dict_get_item(dict, \"Request\");\n\tif (!query_node) {\n\t\treturn ret;\n\t}\n\n\tif (plist_get_node_type(query_node) != PLIST_STRING) {\n\t\treturn ret;\n\t} else {\n\t\tchar *query_value = NULL;\n\n\t\tplist_get_string_val(query_node, &query_value);\n\t\tif (!query_value) {\n\t\t\treturn ret;\n\t\t}\n\n\t\tif (query_match && (strcmp(query_value, query_match) != 0)) {\n\t\t\tfree(query_value);\n\t\t\treturn ret;\n\t\t}\n\n\t\tfree(query_value);\n\t}\n\n\tplist_t result_node = plist_dict_get_item(dict, \"Result\");\n\tif (!result_node) {\n\t\t/* iOS 5: the 'Result' key is not present anymore.\n\t\t   But we need to check for the 'Error' key. */\n\t\tplist_t err_node = plist_dict_get_item(dict, \"Error\");\n\t\tif (err_node) {\n\t\t\tif (plist_get_node_type(err_node) == PLIST_STRING) {\n\t\t\t\tchar *err_value = NULL;\n\n\t\t\t\tplist_get_string_val(err_node, &err_value);\n\t\t\t\tif (err_value) {\n\t\t\t\t\tdebug_info(\"ERROR: %s\", err_value);\n\t\t\t\t\tret = lockdownd_strtoerr(err_value);\n\t\t\t\t\tfree(err_value);\n\t\t\t\t} else {\n\t\t\t\t\tdebug_info(\"ERROR: unknown error occured\");\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn ret;\n\t\t}\n\n\t\tret = LOCKDOWN_E_SUCCESS;\n\n\t\treturn ret;\n\t}\n\n\tplist_type result_type = plist_get_node_type(result_node);\n\tif (result_type == PLIST_STRING) {\n\t\tchar *result_value = NULL;\n\n\t\tplist_get_string_val(result_node, &result_value);\n\t\tif (result_value) {\n\t\t\tif (!strcmp(result_value, \"Success\")) {\n\t\t\t\tret = LOCKDOWN_E_SUCCESS;\n\t\t\t} else if (!strcmp(result_value, \"Failure\")) {\n\t\t\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t\t\t} else {\n\t\t\t\tdebug_info(\"ERROR: unknown result value '%s'\", result_value);\n\t\t\t}\n\t\t}\n\n\t\tif (result_value)\n\t\t\tfree(result_value);\n\t}\n\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic lockdownd_error_t lockdown_check_result(plist_t dict, const char *query_match)\n{\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tplist_t query_node = plist_dict_get_item(dict, \"Request\");\n\tif (!query_node) {\n\t\treturn ret;\n\t}\n\n\tif (plist_get_node_type(query_node) != PLIST_STRING) {\n\t\treturn ret;\n\t} else {\n\t\tchar *query_value = NULL;\n\n\t\tplist_get_string_val(query_node, &query_value);\n\t\tif (!query_value) {\n\t\t\treturn ret;\n\t\t}\n\n\t\tif (query_match && (strcmp(query_value, query_match) != 0)) {\n\t\t\tfree(query_value);\n\t\t\treturn ret;\n\t\t}\n\n\t\tfree(query_value);\n\t}\n\n\tplist_t result_node = plist_dict_get_item(dict, \"Result\");\n\tif (!result_node) {\n\t\t/* iOS 5: the 'Result' key is not present anymore.\n\t\t   But we need to check for the 'Error' key. */\n\t\tplist_t err_node = plist_dict_get_item(dict, \"Error\");\n\t\tif (err_node) {\n\t\t\tif (plist_get_node_type(err_node) == PLIST_STRING) {\n\t\t\t\tchar *err_value = NULL;\n\n\t\t\t\tplist_get_string_val(err_node, &err_value);\n\t\t\t\tif (err_value) {\n\t\t\t\t\tdebug_info(\"ERROR: %s\", err_value);\n\t\t\t\t\tret = lockdownd_strtoerr(err_value);\n\t\t\t\t\tfree(err_value);\n\t\t\t\t} else {\n\t\t\t\t\tdebug_info(\"ERROR: unknown error occured\");\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn ret;\n\t\t}\n\n\t\tret = LOCKDOWN_E_SUCCESS;\n\n\t\treturn ret;\n\t}\n\n\tplist_type result_type = plist_get_node_type(result_node);\n\tif (result_type == PLIST_STRING) {\n\t\tchar *result_value = NULL;\n\n\t\tplist_get_string_val(result_node, &result_value);\n\t\tif (result_value) {\n\t\t\tif (!strcmp(result_value, \"Success\")) {\n\t\t\t\tret = LOCKDOWN_E_SUCCESS;\n\t\t\t} else if (!strcmp(result_value, \"Failure\")) {\n\t\t\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t\t\t} else {\n\t\t\t\tdebug_info(\"ERROR: unknown result value '%s'\", result_value);\n\t\t\t}\n\t\t}\n\n\t\tif (result_value)\n\t\t\tfree(result_value);\n\t}\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lockdownd_receive",
          "args": [
            "client",
            "&dict"
          ],
          "line": 1159
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_receive",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "348-364",
          "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_receive(lockdownd_client_t client, plist_t *plist)\n{\n\tif (!client || !plist || (plist && *plist))\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\tlockdownd_error_t ret = LOCKDOWN_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_receive_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t}\n\n\tif (!*plist)\n\t\tret = LOCKDOWN_E_PLIST_ERROR;\n\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_receive(lockdownd_client_t client, plist_t *plist)\n{\n\tif (!client || !plist || (plist && *plist))\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\tlockdownd_error_t ret = LOCKDOWN_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_receive_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t}\n\n\tif (!*plist)\n\t\tret = LOCKDOWN_E_PLIST_ERROR;\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "dict"
          ],
          "line": 1153
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lockdownd_send",
          "args": [
            "client",
            "dict"
          ],
          "line": 1152
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_send",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "366-379",
          "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_send(lockdownd_client_t client, plist_t plist)\n{\n\tif (!client || !plist)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_send_xml_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t}\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_send(lockdownd_client_t client, plist_t plist)\n{\n\tif (!client || !plist)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_send_xml_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t}\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "system_buid"
          ],
          "line": 1147
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_service_descriptor_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "1522-1528",
          "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_service_descriptor_free(lockdownd_service_descriptor_t service)\n{\n\tif (service)\n\t\tfree(service);\n\n\treturn LOCKDOWN_E_SUCCESS;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_service_descriptor_free(lockdownd_service_descriptor_t service)\n{\n\tif (service)\n\t\tfree(service);\n\n\treturn LOCKDOWN_E_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"SystemBUID\"",
            "plist_new_string(system_buid)"
          ],
          "line": 1145
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "system_buid"
          ],
          "line": 1145
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "userpref_read_system_buid",
          "args": [
            "&system_buid"
          ],
          "line": 1143
        },
        "resolved": true,
        "details": {
          "function_name": "userpref_read_system_buid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/common/userpref.c",
          "lines": "183-192",
          "snippet": "int userpref_read_system_buid(char **system_buid)\n{\n\tint res = usbmuxd_read_buid(system_buid);\n\tif (res == 0) {\n\t\tdebug_info(\"using %s as %s\", *system_buid, USERPREF_SYSTEM_BUID_KEY);\n\t} else {\n\t\tdebug_info(\"could not read system buid, error %d\", res);\n\t}\n\treturn res;\n}",
          "includes": [
            "#include \"utils.h\"",
            "#include \"debug.h\"",
            "#include \"userpref.h\"",
            "#include <shlobj.h>",
            "#include <errno.h>",
            "#include <sys/stat.h>",
            "#include <libgen.h>",
            "#include <dirent.h>",
            "#include <libtasn1.h>",
            "#include <gcrypt.h>",
            "#include <gnutls/x509.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/gnutls.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/rsa.h>",
            "#include <openssl/pem.h>",
            "#include <usbmuxd.h>",
            "#include <unistd.h>",
            "#include <pwd.h>",
            "#include <sys/types.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"utils.h\"\n#include \"debug.h\"\n#include \"userpref.h\"\n#include <shlobj.h>\n#include <errno.h>\n#include <sys/stat.h>\n#include <libgen.h>\n#include <dirent.h>\n#include <libtasn1.h>\n#include <gcrypt.h>\n#include <gnutls/x509.h>\n#include <gnutls/crypto.h>\n#include <gnutls/gnutls.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/rsa.h>\n#include <openssl/pem.h>\n#include <usbmuxd.h>\n#include <unistd.h>\n#include <pwd.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nint userpref_read_system_buid(char **system_buid)\n{\n\tint res = usbmuxd_read_buid(system_buid);\n\tif (res == 0) {\n\t\tdebug_info(\"using %s as %s\", *system_buid, USERPREF_SYSTEM_BUID_KEY);\n\t} else {\n\t\tdebug_info(\"could not read system buid, error %d\", res);\n\t}\n\treturn res;\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"HostID\"",
            "plist_new_string(host_id)"
          ],
          "line": 1138
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "host_id"
          ],
          "line": 1138
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"Request\"",
            "plist_new_string(\"StartSession\")"
          ],
          "line": 1134
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "\"StartSession\""
          ],
          "line": 1134
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_add_label",
          "args": [
            "dict",
            "client->label"
          ],
          "line": 1133
        },
        "resolved": true,
        "details": {
          "function_name": "plist_dict_add_label",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "232-238",
          "snippet": "static void plist_dict_add_label(plist_t plist, const char *label)\n{\n\tif (plist && label) {\n\t\tif (plist_get_node_type(plist) == PLIST_DICT)\n\t\t\tplist_dict_set_item(plist, \"Label\", plist_new_string(label));\n\t}\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic void plist_dict_add_label(plist_t plist, const char *label)\n{\n\tif (plist && label) {\n\t\tif (plist_get_node_type(plist) == PLIST_DICT)\n\t\t\tplist_dict_set_item(plist, \"Label\", plist_new_string(label));\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_new_dict",
          "args": [],
          "line": 1132
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lockdownd_stop_session",
          "args": [
            "client",
            "client->session_id"
          ],
          "line": 1128
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_stop_session",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "240-290",
          "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_stop_session(lockdownd_client_t client, const char *session_id)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tif (!session_id) {\n\t\tdebug_info(\"no session_id given, cannot stop session\");\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\t}\n\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tplist_t dict = plist_new_dict();\n\tplist_dict_add_label(dict, client->label);\n\tplist_dict_set_item(dict,\"Request\", plist_new_string(\"StopSession\"));\n\tplist_dict_set_item(dict,\"SessionID\", plist_new_string(session_id));\n\n\tdebug_info(\"stopping session %s\", session_id);\n\n\tret = lockdownd_send(client, dict);\n\n\tplist_free(dict);\n\tdict = NULL;\n\n\tret = lockdownd_receive(client, &dict);\n\n\tif (!dict) {\n\t\tdebug_info(\"LOCKDOWN_E_PLIST_ERROR\");\n\t\treturn LOCKDOWN_E_PLIST_ERROR;\n\t}\n\n\tret = lockdown_check_result(dict, \"StopSession\");\n\tif (ret == LOCKDOWN_E_SUCCESS) {\n\t\tdebug_info(\"success\");\n\t}\n\n\tplist_free(dict);\n\tdict = NULL;\n\n\tif (client->session_id) {\n\t\tfree(client->session_id);\n\t\tclient->session_id = NULL;\n\t}\n\n\tif (client->ssl_enabled) {\n\t\tproperty_list_service_disable_ssl(client->parent);\n\t\tclient->ssl_enabled = 0;\n\t}\n\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_stop_session(lockdownd_client_t client, const char *session_id)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tif (!session_id) {\n\t\tdebug_info(\"no session_id given, cannot stop session\");\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\t}\n\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tplist_t dict = plist_new_dict();\n\tplist_dict_add_label(dict, client->label);\n\tplist_dict_set_item(dict,\"Request\", plist_new_string(\"StopSession\"));\n\tplist_dict_set_item(dict,\"SessionID\", plist_new_string(session_id));\n\n\tdebug_info(\"stopping session %s\", session_id);\n\n\tret = lockdownd_send(client, dict);\n\n\tplist_free(dict);\n\tdict = NULL;\n\n\tret = lockdownd_receive(client, &dict);\n\n\tif (!dict) {\n\t\tdebug_info(\"LOCKDOWN_E_PLIST_ERROR\");\n\t\treturn LOCKDOWN_E_PLIST_ERROR;\n\t}\n\n\tret = lockdown_check_result(dict, \"StopSession\");\n\tif (ret == LOCKDOWN_E_SUCCESS) {\n\t\tdebug_info(\"success\");\n\t}\n\n\tplist_free(dict);\n\tdict = NULL;\n\n\tif (client->session_id) {\n\t\tfree(client->session_id);\n\t\tclient->session_id = NULL;\n\t}\n\n\tif (client->ssl_enabled) {\n\t\tproperty_list_service_disable_ssl(client->parent);\n\t\tclient->ssl_enabled = 0;\n\t}\n\n\treturn ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_start_session(lockdownd_client_t client, const char *host_id, char **session_id, int *ssl_enabled)\n{\n\tlockdownd_error_t ret = LOCKDOWN_E_SUCCESS;\n\tproperty_list_service_error_t plret;\n\tplist_t dict = NULL;\n\n\tif (!client || !host_id)\n\t\tret = LOCKDOWN_E_INVALID_ARG;\n\n\t/* if we have a running session, stop current one first */\n\tif (client->session_id) {\n\t\tlockdownd_stop_session(client, client->session_id);\n\t}\n\n\t/* setup request plist */\n\tdict = plist_new_dict();\n\tplist_dict_add_label(dict, client->label);\n\tplist_dict_set_item(dict,\"Request\", plist_new_string(\"StartSession\"));\n\n\t/* add host id */\n\tif (host_id) {\n\t\tplist_dict_set_item(dict, \"HostID\", plist_new_string(host_id));\n\t}\n\n\t/* add system buid */\n\tchar *system_buid = NULL;\n\tuserpref_read_system_buid(&system_buid);\n\tif (system_buid) {\n\t\tplist_dict_set_item(dict, \"SystemBUID\", plist_new_string(system_buid));\n\t\tif (system_buid) {\n\t\t\tfree(system_buid);\n\t\t\tsystem_buid = NULL;\n\t\t}\n\t}\n\n\tret = lockdownd_send(client, dict);\n\tplist_free(dict);\n\tdict = NULL;\n\n\tif (ret != LOCKDOWN_E_SUCCESS)\n\t\treturn ret;\n\n\tret = lockdownd_receive(client, &dict);\n\n\tif (!dict)\n\t\treturn LOCKDOWN_E_PLIST_ERROR;\n\n\tret = lockdown_check_result(dict, \"StartSession\");\n\tif (ret == LOCKDOWN_E_SUCCESS) {\n\t\tuint8_t use_ssl = 0;\n\n\t\tplist_t enable_ssl = plist_dict_get_item(dict, \"EnableSessionSSL\");\n\t\tif (enable_ssl && (plist_get_node_type(enable_ssl) == PLIST_BOOLEAN)) {\n\t\t\tplist_get_bool_val(enable_ssl, &use_ssl);\n\t\t}\n\t\tdebug_info(\"Session startup OK\");\n\n\t\tif (ssl_enabled != NULL)\n\t\t\t*ssl_enabled = use_ssl;\n\n\t\t/* store session id, we need it for StopSession */\n\t\tplist_t session_node = plist_dict_get_item(dict, \"SessionID\");\n\t\tif (session_node && (plist_get_node_type(session_node) == PLIST_STRING)) {\n\t\t\tplist_get_string_val(session_node, &client->session_id);\n\t\t}\n\n\t\tif (client->session_id) {\n\t\t\tdebug_info(\"SessionID: %s\", client->session_id);\n\t\t\tif (session_id != NULL)\n\t\t\t\t*session_id = strdup(client->session_id);\n\t\t} else {\n\t\t\tdebug_info(\"Failed to get SessionID!\");\n\t\t}\n\n\t\tdebug_info(\"Enable SSL Session: %s\", (use_ssl?\"true\":\"false\"));\n\n\t\tif (use_ssl) {\n\t\t\tplret = property_list_service_enable_ssl(client->parent);\n\t\t\tif (plret == PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\t\t\tret = LOCKDOWN_E_SUCCESS;\n\t\t\t\tclient->ssl_enabled = 1;\n\t\t\t} else {\n\t\t\t\tret = LOCKDOWN_E_SSL_ERROR;\n\t\t\t\tclient->ssl_enabled = 0;\n\t\t\t}\n\t\t} else {\n\t\t\tclient->ssl_enabled = 0;\n\t\t\tret = LOCKDOWN_E_SUCCESS;\n\t\t}\n\t}\n\n\tplist_free(dict);\n\tdict = NULL;\n\n\treturn ret;\n}"
  },
  {
    "function_name": "lockdownd_goodbye",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
    "lines": "1083-1115",
    "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_goodbye(lockdownd_client_t client)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tplist_t dict = plist_new_dict();\n\tplist_dict_add_label(dict, client->label);\n\tplist_dict_set_item(dict,\"Request\", plist_new_string(\"Goodbye\"));\n\n\tdebug_info(\"called\");\n\n\tret = lockdownd_send(client, dict);\n\tplist_free(dict);\n\tdict = NULL;\n\n\tret = lockdownd_receive(client, &dict);\n\tif (!dict) {\n\t\tdebug_info(\"did not get goodbye response back\");\n\t\treturn LOCKDOWN_E_PLIST_ERROR;\n\t}\n\n\tret = lockdown_check_result(dict, \"Goodbye\");\n\tif (ret == LOCKDOWN_E_SUCCESS) {\n\t\tdebug_info(\"success\");\n\t}\n\n\tplist_free(dict);\n\tdict = NULL;\n\n\treturn ret;\n}",
    "includes": [
      "#include <windows.h>",
      "#include \"asprintf.h\"",
      "#include \"common/utils.h\"",
      "#include \"common/userpref.h\"",
      "#include \"common/debug.h\"",
      "#include \"idevice.h\"",
      "#include \"lockdown.h\"",
      "#include \"property_list_service.h\"",
      "#include <plist/plist.h>",
      "#include <gnutls/crypto.h>",
      "#include <gnutls/x509.h>",
      "#include <libtasn1.h>",
      "#include <openssl/x509v3.h>",
      "#include <openssl/x509.h>",
      "#include <openssl/pem.h>",
      "#include <unistd.h>",
      "#include <ctype.h>",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "dict"
          ],
          "line": 1111
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"success\""
          ],
          "line": 1108
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lockdown_check_result",
          "args": [
            "dict",
            "\"Goodbye\""
          ],
          "line": 1106
        },
        "resolved": true,
        "details": {
          "function_name": "lockdown_check_result",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "150-223",
          "snippet": "static lockdownd_error_t lockdown_check_result(plist_t dict, const char *query_match)\n{\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tplist_t query_node = plist_dict_get_item(dict, \"Request\");\n\tif (!query_node) {\n\t\treturn ret;\n\t}\n\n\tif (plist_get_node_type(query_node) != PLIST_STRING) {\n\t\treturn ret;\n\t} else {\n\t\tchar *query_value = NULL;\n\n\t\tplist_get_string_val(query_node, &query_value);\n\t\tif (!query_value) {\n\t\t\treturn ret;\n\t\t}\n\n\t\tif (query_match && (strcmp(query_value, query_match) != 0)) {\n\t\t\tfree(query_value);\n\t\t\treturn ret;\n\t\t}\n\n\t\tfree(query_value);\n\t}\n\n\tplist_t result_node = plist_dict_get_item(dict, \"Result\");\n\tif (!result_node) {\n\t\t/* iOS 5: the 'Result' key is not present anymore.\n\t\t   But we need to check for the 'Error' key. */\n\t\tplist_t err_node = plist_dict_get_item(dict, \"Error\");\n\t\tif (err_node) {\n\t\t\tif (plist_get_node_type(err_node) == PLIST_STRING) {\n\t\t\t\tchar *err_value = NULL;\n\n\t\t\t\tplist_get_string_val(err_node, &err_value);\n\t\t\t\tif (err_value) {\n\t\t\t\t\tdebug_info(\"ERROR: %s\", err_value);\n\t\t\t\t\tret = lockdownd_strtoerr(err_value);\n\t\t\t\t\tfree(err_value);\n\t\t\t\t} else {\n\t\t\t\t\tdebug_info(\"ERROR: unknown error occured\");\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn ret;\n\t\t}\n\n\t\tret = LOCKDOWN_E_SUCCESS;\n\n\t\treturn ret;\n\t}\n\n\tplist_type result_type = plist_get_node_type(result_node);\n\tif (result_type == PLIST_STRING) {\n\t\tchar *result_value = NULL;\n\n\t\tplist_get_string_val(result_node, &result_value);\n\t\tif (result_value) {\n\t\t\tif (!strcmp(result_value, \"Success\")) {\n\t\t\t\tret = LOCKDOWN_E_SUCCESS;\n\t\t\t} else if (!strcmp(result_value, \"Failure\")) {\n\t\t\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t\t\t} else {\n\t\t\t\tdebug_info(\"ERROR: unknown result value '%s'\", result_value);\n\t\t\t}\n\t\t}\n\n\t\tif (result_value)\n\t\t\tfree(result_value);\n\t}\n\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic lockdownd_error_t lockdown_check_result(plist_t dict, const char *query_match)\n{\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tplist_t query_node = plist_dict_get_item(dict, \"Request\");\n\tif (!query_node) {\n\t\treturn ret;\n\t}\n\n\tif (plist_get_node_type(query_node) != PLIST_STRING) {\n\t\treturn ret;\n\t} else {\n\t\tchar *query_value = NULL;\n\n\t\tplist_get_string_val(query_node, &query_value);\n\t\tif (!query_value) {\n\t\t\treturn ret;\n\t\t}\n\n\t\tif (query_match && (strcmp(query_value, query_match) != 0)) {\n\t\t\tfree(query_value);\n\t\t\treturn ret;\n\t\t}\n\n\t\tfree(query_value);\n\t}\n\n\tplist_t result_node = plist_dict_get_item(dict, \"Result\");\n\tif (!result_node) {\n\t\t/* iOS 5: the 'Result' key is not present anymore.\n\t\t   But we need to check for the 'Error' key. */\n\t\tplist_t err_node = plist_dict_get_item(dict, \"Error\");\n\t\tif (err_node) {\n\t\t\tif (plist_get_node_type(err_node) == PLIST_STRING) {\n\t\t\t\tchar *err_value = NULL;\n\n\t\t\t\tplist_get_string_val(err_node, &err_value);\n\t\t\t\tif (err_value) {\n\t\t\t\t\tdebug_info(\"ERROR: %s\", err_value);\n\t\t\t\t\tret = lockdownd_strtoerr(err_value);\n\t\t\t\t\tfree(err_value);\n\t\t\t\t} else {\n\t\t\t\t\tdebug_info(\"ERROR: unknown error occured\");\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn ret;\n\t\t}\n\n\t\tret = LOCKDOWN_E_SUCCESS;\n\n\t\treturn ret;\n\t}\n\n\tplist_type result_type = plist_get_node_type(result_node);\n\tif (result_type == PLIST_STRING) {\n\t\tchar *result_value = NULL;\n\n\t\tplist_get_string_val(result_node, &result_value);\n\t\tif (result_value) {\n\t\t\tif (!strcmp(result_value, \"Success\")) {\n\t\t\t\tret = LOCKDOWN_E_SUCCESS;\n\t\t\t} else if (!strcmp(result_value, \"Failure\")) {\n\t\t\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t\t\t} else {\n\t\t\t\tdebug_info(\"ERROR: unknown result value '%s'\", result_value);\n\t\t\t}\n\t\t}\n\n\t\tif (result_value)\n\t\t\tfree(result_value);\n\t}\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"did not get goodbye response back\""
          ],
          "line": 1102
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lockdownd_receive",
          "args": [
            "client",
            "&dict"
          ],
          "line": 1100
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_receive",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "348-364",
          "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_receive(lockdownd_client_t client, plist_t *plist)\n{\n\tif (!client || !plist || (plist && *plist))\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\tlockdownd_error_t ret = LOCKDOWN_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_receive_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t}\n\n\tif (!*plist)\n\t\tret = LOCKDOWN_E_PLIST_ERROR;\n\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_receive(lockdownd_client_t client, plist_t *plist)\n{\n\tif (!client || !plist || (plist && *plist))\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\tlockdownd_error_t ret = LOCKDOWN_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_receive_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t}\n\n\tif (!*plist)\n\t\tret = LOCKDOWN_E_PLIST_ERROR;\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "dict"
          ],
          "line": 1097
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lockdownd_send",
          "args": [
            "client",
            "dict"
          ],
          "line": 1096
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_send",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "366-379",
          "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_send(lockdownd_client_t client, plist_t plist)\n{\n\tif (!client || !plist)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_send_xml_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t}\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_send(lockdownd_client_t client, plist_t plist)\n{\n\tif (!client || !plist)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_send_xml_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t}\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"called\""
          ],
          "line": 1094
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"Request\"",
            "plist_new_string(\"Goodbye\")"
          ],
          "line": 1092
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "\"Goodbye\""
          ],
          "line": 1092
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_add_label",
          "args": [
            "dict",
            "client->label"
          ],
          "line": 1091
        },
        "resolved": true,
        "details": {
          "function_name": "plist_dict_add_label",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "232-238",
          "snippet": "static void plist_dict_add_label(plist_t plist, const char *label)\n{\n\tif (plist && label) {\n\t\tif (plist_get_node_type(plist) == PLIST_DICT)\n\t\t\tplist_dict_set_item(plist, \"Label\", plist_new_string(label));\n\t}\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic void plist_dict_add_label(plist_t plist, const char *label)\n{\n\tif (plist && label) {\n\t\tif (plist_get_node_type(plist) == PLIST_DICT)\n\t\t\tplist_dict_set_item(plist, \"Label\", plist_new_string(label));\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_new_dict",
          "args": [],
          "line": 1090
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_goodbye(lockdownd_client_t client)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tplist_t dict = plist_new_dict();\n\tplist_dict_add_label(dict, client->label);\n\tplist_dict_set_item(dict,\"Request\", plist_new_string(\"Goodbye\"));\n\n\tdebug_info(\"called\");\n\n\tret = lockdownd_send(client, dict);\n\tplist_free(dict);\n\tdict = NULL;\n\n\tret = lockdownd_receive(client, &dict);\n\tif (!dict) {\n\t\tdebug_info(\"did not get goodbye response back\");\n\t\treturn LOCKDOWN_E_PLIST_ERROR;\n\t}\n\n\tret = lockdown_check_result(dict, \"Goodbye\");\n\tif (ret == LOCKDOWN_E_SUCCESS) {\n\t\tdebug_info(\"success\");\n\t}\n\n\tplist_free(dict);\n\tdict = NULL;\n\n\treturn ret;\n}"
  },
  {
    "function_name": "lockdownd_enter_recovery",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
    "lines": "1053-1081",
    "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_enter_recovery(lockdownd_client_t client)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tplist_t dict = plist_new_dict();\n\tplist_dict_add_label(dict, client->label);\n\tplist_dict_set_item(dict,\"Request\", plist_new_string(\"EnterRecovery\"));\n\n\tdebug_info(\"telling device to enter recovery mode\");\n\n\tret = lockdownd_send(client, dict);\n\tplist_free(dict);\n\tdict = NULL;\n\n\tret = lockdownd_receive(client, &dict);\n\n\tret = lockdown_check_result(dict, \"EnterRecovery\");\n\tif (ret == LOCKDOWN_E_SUCCESS) {\n\t\tdebug_info(\"success\");\n\t}\n\n\tplist_free(dict);\n\tdict = NULL;\n\n\treturn ret;\n}",
    "includes": [
      "#include <windows.h>",
      "#include \"asprintf.h\"",
      "#include \"common/utils.h\"",
      "#include \"common/userpref.h\"",
      "#include \"common/debug.h\"",
      "#include \"idevice.h\"",
      "#include \"lockdown.h\"",
      "#include \"property_list_service.h\"",
      "#include <plist/plist.h>",
      "#include <gnutls/crypto.h>",
      "#include <gnutls/x509.h>",
      "#include <libtasn1.h>",
      "#include <openssl/x509v3.h>",
      "#include <openssl/x509.h>",
      "#include <openssl/pem.h>",
      "#include <unistd.h>",
      "#include <ctype.h>",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "dict"
          ],
          "line": 1077
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"success\""
          ],
          "line": 1074
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lockdown_check_result",
          "args": [
            "dict",
            "\"EnterRecovery\""
          ],
          "line": 1072
        },
        "resolved": true,
        "details": {
          "function_name": "lockdown_check_result",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "150-223",
          "snippet": "static lockdownd_error_t lockdown_check_result(plist_t dict, const char *query_match)\n{\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tplist_t query_node = plist_dict_get_item(dict, \"Request\");\n\tif (!query_node) {\n\t\treturn ret;\n\t}\n\n\tif (plist_get_node_type(query_node) != PLIST_STRING) {\n\t\treturn ret;\n\t} else {\n\t\tchar *query_value = NULL;\n\n\t\tplist_get_string_val(query_node, &query_value);\n\t\tif (!query_value) {\n\t\t\treturn ret;\n\t\t}\n\n\t\tif (query_match && (strcmp(query_value, query_match) != 0)) {\n\t\t\tfree(query_value);\n\t\t\treturn ret;\n\t\t}\n\n\t\tfree(query_value);\n\t}\n\n\tplist_t result_node = plist_dict_get_item(dict, \"Result\");\n\tif (!result_node) {\n\t\t/* iOS 5: the 'Result' key is not present anymore.\n\t\t   But we need to check for the 'Error' key. */\n\t\tplist_t err_node = plist_dict_get_item(dict, \"Error\");\n\t\tif (err_node) {\n\t\t\tif (plist_get_node_type(err_node) == PLIST_STRING) {\n\t\t\t\tchar *err_value = NULL;\n\n\t\t\t\tplist_get_string_val(err_node, &err_value);\n\t\t\t\tif (err_value) {\n\t\t\t\t\tdebug_info(\"ERROR: %s\", err_value);\n\t\t\t\t\tret = lockdownd_strtoerr(err_value);\n\t\t\t\t\tfree(err_value);\n\t\t\t\t} else {\n\t\t\t\t\tdebug_info(\"ERROR: unknown error occured\");\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn ret;\n\t\t}\n\n\t\tret = LOCKDOWN_E_SUCCESS;\n\n\t\treturn ret;\n\t}\n\n\tplist_type result_type = plist_get_node_type(result_node);\n\tif (result_type == PLIST_STRING) {\n\t\tchar *result_value = NULL;\n\n\t\tplist_get_string_val(result_node, &result_value);\n\t\tif (result_value) {\n\t\t\tif (!strcmp(result_value, \"Success\")) {\n\t\t\t\tret = LOCKDOWN_E_SUCCESS;\n\t\t\t} else if (!strcmp(result_value, \"Failure\")) {\n\t\t\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t\t\t} else {\n\t\t\t\tdebug_info(\"ERROR: unknown result value '%s'\", result_value);\n\t\t\t}\n\t\t}\n\n\t\tif (result_value)\n\t\t\tfree(result_value);\n\t}\n\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic lockdownd_error_t lockdown_check_result(plist_t dict, const char *query_match)\n{\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tplist_t query_node = plist_dict_get_item(dict, \"Request\");\n\tif (!query_node) {\n\t\treturn ret;\n\t}\n\n\tif (plist_get_node_type(query_node) != PLIST_STRING) {\n\t\treturn ret;\n\t} else {\n\t\tchar *query_value = NULL;\n\n\t\tplist_get_string_val(query_node, &query_value);\n\t\tif (!query_value) {\n\t\t\treturn ret;\n\t\t}\n\n\t\tif (query_match && (strcmp(query_value, query_match) != 0)) {\n\t\t\tfree(query_value);\n\t\t\treturn ret;\n\t\t}\n\n\t\tfree(query_value);\n\t}\n\n\tplist_t result_node = plist_dict_get_item(dict, \"Result\");\n\tif (!result_node) {\n\t\t/* iOS 5: the 'Result' key is not present anymore.\n\t\t   But we need to check for the 'Error' key. */\n\t\tplist_t err_node = plist_dict_get_item(dict, \"Error\");\n\t\tif (err_node) {\n\t\t\tif (plist_get_node_type(err_node) == PLIST_STRING) {\n\t\t\t\tchar *err_value = NULL;\n\n\t\t\t\tplist_get_string_val(err_node, &err_value);\n\t\t\t\tif (err_value) {\n\t\t\t\t\tdebug_info(\"ERROR: %s\", err_value);\n\t\t\t\t\tret = lockdownd_strtoerr(err_value);\n\t\t\t\t\tfree(err_value);\n\t\t\t\t} else {\n\t\t\t\t\tdebug_info(\"ERROR: unknown error occured\");\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn ret;\n\t\t}\n\n\t\tret = LOCKDOWN_E_SUCCESS;\n\n\t\treturn ret;\n\t}\n\n\tplist_type result_type = plist_get_node_type(result_node);\n\tif (result_type == PLIST_STRING) {\n\t\tchar *result_value = NULL;\n\n\t\tplist_get_string_val(result_node, &result_value);\n\t\tif (result_value) {\n\t\t\tif (!strcmp(result_value, \"Success\")) {\n\t\t\t\tret = LOCKDOWN_E_SUCCESS;\n\t\t\t} else if (!strcmp(result_value, \"Failure\")) {\n\t\t\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t\t\t} else {\n\t\t\t\tdebug_info(\"ERROR: unknown result value '%s'\", result_value);\n\t\t\t}\n\t\t}\n\n\t\tif (result_value)\n\t\t\tfree(result_value);\n\t}\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lockdownd_receive",
          "args": [
            "client",
            "&dict"
          ],
          "line": 1070
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_receive",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "348-364",
          "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_receive(lockdownd_client_t client, plist_t *plist)\n{\n\tif (!client || !plist || (plist && *plist))\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\tlockdownd_error_t ret = LOCKDOWN_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_receive_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t}\n\n\tif (!*plist)\n\t\tret = LOCKDOWN_E_PLIST_ERROR;\n\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_receive(lockdownd_client_t client, plist_t *plist)\n{\n\tif (!client || !plist || (plist && *plist))\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\tlockdownd_error_t ret = LOCKDOWN_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_receive_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t}\n\n\tif (!*plist)\n\t\tret = LOCKDOWN_E_PLIST_ERROR;\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "dict"
          ],
          "line": 1067
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lockdownd_send",
          "args": [
            "client",
            "dict"
          ],
          "line": 1066
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_send",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "366-379",
          "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_send(lockdownd_client_t client, plist_t plist)\n{\n\tif (!client || !plist)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_send_xml_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t}\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_send(lockdownd_client_t client, plist_t plist)\n{\n\tif (!client || !plist)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_send_xml_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t}\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"telling device to enter recovery mode\""
          ],
          "line": 1064
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"Request\"",
            "plist_new_string(\"EnterRecovery\")"
          ],
          "line": 1062
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "\"EnterRecovery\""
          ],
          "line": 1062
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_add_label",
          "args": [
            "dict",
            "client->label"
          ],
          "line": 1061
        },
        "resolved": true,
        "details": {
          "function_name": "plist_dict_add_label",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "232-238",
          "snippet": "static void plist_dict_add_label(plist_t plist, const char *label)\n{\n\tif (plist && label) {\n\t\tif (plist_get_node_type(plist) == PLIST_DICT)\n\t\t\tplist_dict_set_item(plist, \"Label\", plist_new_string(label));\n\t}\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic void plist_dict_add_label(plist_t plist, const char *label)\n{\n\tif (plist && label) {\n\t\tif (plist_get_node_type(plist) == PLIST_DICT)\n\t\t\tplist_dict_set_item(plist, \"Label\", plist_new_string(label));\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_new_dict",
          "args": [],
          "line": 1060
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_enter_recovery(lockdownd_client_t client)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tplist_t dict = plist_new_dict();\n\tplist_dict_add_label(dict, client->label);\n\tplist_dict_set_item(dict,\"Request\", plist_new_string(\"EnterRecovery\"));\n\n\tdebug_info(\"telling device to enter recovery mode\");\n\n\tret = lockdownd_send(client, dict);\n\tplist_free(dict);\n\tdict = NULL;\n\n\tret = lockdownd_receive(client, &dict);\n\n\tret = lockdown_check_result(dict, \"EnterRecovery\");\n\tif (ret == LOCKDOWN_E_SUCCESS) {\n\t\tdebug_info(\"success\");\n\t}\n\n\tplist_free(dict);\n\tdict = NULL;\n\n\treturn ret;\n}"
  },
  {
    "function_name": "lockdownd_unpair",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
    "lines": "1048-1051",
    "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_unpair(lockdownd_client_t client, lockdownd_pair_record_t pair_record)\n{\n\treturn lockdownd_do_pair(client, pair_record, \"Unpair\", NULL, NULL);\n}",
    "includes": [
      "#include <windows.h>",
      "#include \"asprintf.h\"",
      "#include \"common/utils.h\"",
      "#include \"common/userpref.h\"",
      "#include \"common/debug.h\"",
      "#include \"idevice.h\"",
      "#include \"lockdown.h\"",
      "#include \"property_list_service.h\"",
      "#include <plist/plist.h>",
      "#include <gnutls/crypto.h>",
      "#include <gnutls/x509.h>",
      "#include <libtasn1.h>",
      "#include <openssl/x509v3.h>",
      "#include <openssl/x509.h>",
      "#include <openssl/pem.h>",
      "#include <unistd.h>",
      "#include <ctype.h>",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "lockdownd_do_pair",
          "args": [
            "client",
            "pair_record",
            "\"Unpair\"",
            "NULL",
            "NULL"
          ],
          "line": 1050
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_do_pair",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "860-1023",
          "snippet": "static lockdownd_error_t lockdownd_do_pair(lockdownd_client_t client, lockdownd_pair_record_t pair_record, const char *verb, plist_t options, plist_t *result)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\tplist_t dict = NULL;\n\tplist_t pair_record_plist = NULL;\n\tplist_t wifi_node = NULL;\n\tint pairing_mode = 0; /* 0 = libimobiledevice, 1 = external */\n\n\tif (pair_record && pair_record->system_buid && pair_record->host_id) {\n\t\t/* valid pair_record passed? */\n\t\tif (!pair_record->device_certificate || !pair_record->host_certificate || !pair_record->root_certificate) {\n\t\t\treturn LOCKDOWN_E_PLIST_ERROR;\n\t\t}\n\n\t\t/* use passed pair_record */\n\t\tpair_record_plist = lockdownd_pair_record_to_plist(pair_record);\n\n\t\tpairing_mode = 1;\n\t} else {\n\t\t/* generate a new pair record if pairing */\n\t\tif (!strcmp(\"Pair\", verb)) {\n\t\t\tret = pair_record_generate(client, &pair_record_plist);\n\n\t\t\tif (ret != LOCKDOWN_E_SUCCESS) {\n\t\t\t\tif (pair_record_plist)\n\t\t\t\t\tplist_free(pair_record_plist);\n\t\t\t\treturn ret;\n\t\t\t}\n\n\t\t\t/* get wifi mac now, if we get it later we fail on iOS 7 which causes a reconnect */\n\t\t\tlockdownd_get_value(client, NULL, \"WiFiAddress\", &wifi_node);\n\t\t} else {\n\t\t\t/* use existing pair record */\n\t\t\tif (userpref_has_pair_record(client->udid)) {\n\t\t\t\tuserpref_read_pair_record(client->udid, &pair_record_plist);\n\t\t\t\tif (!pair_record_plist) {\n\t\t\t\t\treturn LOCKDOWN_E_INVALID_CONF;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn LOCKDOWN_E_INVALID_HOST_ID;\n\t\t\t}\n\t\t}\n\t}\n\n\tplist_t request_pair_record = plist_copy(pair_record_plist);\n\n\t/* remove stuff that is private */\n\tplist_dict_remove_item(request_pair_record, USERPREF_ROOT_PRIVATE_KEY_KEY);\n\tplist_dict_remove_item(request_pair_record, USERPREF_HOST_PRIVATE_KEY_KEY);\n\n\t/* setup pair request plist */\n\tdict = plist_new_dict();\n\tplist_dict_add_label(dict, client->label);\n\tplist_dict_set_item(dict, \"PairRecord\", request_pair_record);\n\tplist_dict_set_item(dict, \"Request\", plist_new_string(verb));\n\tplist_dict_set_item(dict, \"ProtocolVersion\", plist_new_string(LOCKDOWN_PROTOCOL_VERSION));\n\n\tif (options) {\n\t\tplist_dict_set_item(dict, \"PairingOptions\", plist_copy(options));\n\t}\n\n\t/* send to device */\n\tret = lockdownd_send(client, dict);\n\tplist_free(dict);\n\tdict = NULL;\n\n\tif (ret != LOCKDOWN_E_SUCCESS) {\n\t\tplist_free(pair_record_plist);\n\t\tif (wifi_node)\n\t\t\tplist_free(wifi_node);\n\t\treturn ret;\n\t}\n\n\t/* Now get device's answer */\n\tret = lockdownd_receive(client, &dict);\n\n\tif (ret != LOCKDOWN_E_SUCCESS) {\n\t\tplist_free(pair_record_plist);\n\t\tif (wifi_node)\n\t\t\tplist_free(wifi_node);\n\t\treturn ret;\n\t}\n\n\tif (strcmp(verb, \"Unpair\") == 0) {\n\t\t/* workaround for Unpair giving back ValidatePair,\n\t\t * seems to be a bug in the device's fw */\n\t\tif (lockdown_check_result(dict, NULL) != LOCKDOWN_E_SUCCESS) {\n\t\t\tret = LOCKDOWN_E_PAIRING_FAILED;\n\t\t}\n\t} else {\n\t\tif (lockdown_check_result(dict, verb) != LOCKDOWN_E_SUCCESS) {\n\t\t\tret = LOCKDOWN_E_PAIRING_FAILED;\n\t\t}\n\t}\n\n\t/* if pairing succeeded */\n\tif (ret == LOCKDOWN_E_SUCCESS) {\n\t\tdebug_info(\"%s success\", verb);\n\t\tif (!pairing_mode) {\n\t\t\tdebug_info(\"internal pairing mode\");\n\t\t\tif (!strcmp(\"Unpair\", verb)) {\n\t\t\t\t/* remove public key from config */\n\t\t\t\tuserpref_delete_pair_record(client->udid);\n\t\t\t} else {\n\t\t\t\tif (!strcmp(\"Pair\", verb)) {\n\t\t\t\t\t/* add returned escrow bag if available */\n\t\t\t\t\tplist_t extra_node = plist_dict_get_item(dict, USERPREF_ESCROW_BAG_KEY);\n\t\t\t\t\tif (extra_node && plist_get_node_type(extra_node) == PLIST_DATA) {\n\t\t\t\t\t\tdebug_info(\"Saving EscrowBag from response in pair record\");\n\t\t\t\t\t\tplist_dict_set_item(pair_record_plist, USERPREF_ESCROW_BAG_KEY, plist_copy(extra_node));\n\t\t\t\t\t}\n\n\t\t\t\t\t/* save previously retrieved wifi mac address in pair record */\n\t\t\t\t\tif (wifi_node) {\n\t\t\t\t\t\tdebug_info(\"Saving WiFiAddress from device in pair record\");\n\t\t\t\t\t\tplist_dict_set_item(pair_record_plist, USERPREF_WIFI_MAC_ADDRESS_KEY, plist_copy(wifi_node));\n\t\t\t\t\t\tplist_free(wifi_node);\n\t\t\t\t\t\twifi_node = NULL;\n\t\t\t\t\t}\n\n\t\t\t\t\tuserpref_save_pair_record(client->udid, pair_record_plist);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tdebug_info(\"external pairing mode\");\n\t\t}\n\t} else {\n\t\tdebug_info(\"%s failure\", verb);\n\t\tplist_t error_node = NULL;\n\t\t/* verify error condition */\n\t\terror_node = plist_dict_get_item(dict, \"Error\");\n\t\tif (error_node) {\n\t\t\tchar *value = NULL;\n\t\t\tplist_get_string_val(error_node, &value);\n\t\t\tif (value) {\n\t\t\t\t/* the first pairing fails if the device is password protected */\n\t\t\t\tret = lockdownd_strtoerr(value);\n\t\t\t\tfree(value);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (pair_record_plist) {\n\t\tplist_free(pair_record_plist);\n\t\tpair_record_plist = NULL;\n\t}\n\n\tif (wifi_node) {\n\t\tplist_free(wifi_node);\n\t\twifi_node = NULL;\n\t}\n\n\tif (result) {\n\t\t*result = dict;\n\t} else {\n\t\tplist_free(dict);\n\t\tdict = NULL;\n\t}\n\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic lockdownd_error_t lockdownd_do_pair(lockdownd_client_t client, lockdownd_pair_record_t pair_record, const char *verb, plist_t options, plist_t *result)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\tplist_t dict = NULL;\n\tplist_t pair_record_plist = NULL;\n\tplist_t wifi_node = NULL;\n\tint pairing_mode = 0; /* 0 = libimobiledevice, 1 = external */\n\n\tif (pair_record && pair_record->system_buid && pair_record->host_id) {\n\t\t/* valid pair_record passed? */\n\t\tif (!pair_record->device_certificate || !pair_record->host_certificate || !pair_record->root_certificate) {\n\t\t\treturn LOCKDOWN_E_PLIST_ERROR;\n\t\t}\n\n\t\t/* use passed pair_record */\n\t\tpair_record_plist = lockdownd_pair_record_to_plist(pair_record);\n\n\t\tpairing_mode = 1;\n\t} else {\n\t\t/* generate a new pair record if pairing */\n\t\tif (!strcmp(\"Pair\", verb)) {\n\t\t\tret = pair_record_generate(client, &pair_record_plist);\n\n\t\t\tif (ret != LOCKDOWN_E_SUCCESS) {\n\t\t\t\tif (pair_record_plist)\n\t\t\t\t\tplist_free(pair_record_plist);\n\t\t\t\treturn ret;\n\t\t\t}\n\n\t\t\t/* get wifi mac now, if we get it later we fail on iOS 7 which causes a reconnect */\n\t\t\tlockdownd_get_value(client, NULL, \"WiFiAddress\", &wifi_node);\n\t\t} else {\n\t\t\t/* use existing pair record */\n\t\t\tif (userpref_has_pair_record(client->udid)) {\n\t\t\t\tuserpref_read_pair_record(client->udid, &pair_record_plist);\n\t\t\t\tif (!pair_record_plist) {\n\t\t\t\t\treturn LOCKDOWN_E_INVALID_CONF;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn LOCKDOWN_E_INVALID_HOST_ID;\n\t\t\t}\n\t\t}\n\t}\n\n\tplist_t request_pair_record = plist_copy(pair_record_plist);\n\n\t/* remove stuff that is private */\n\tplist_dict_remove_item(request_pair_record, USERPREF_ROOT_PRIVATE_KEY_KEY);\n\tplist_dict_remove_item(request_pair_record, USERPREF_HOST_PRIVATE_KEY_KEY);\n\n\t/* setup pair request plist */\n\tdict = plist_new_dict();\n\tplist_dict_add_label(dict, client->label);\n\tplist_dict_set_item(dict, \"PairRecord\", request_pair_record);\n\tplist_dict_set_item(dict, \"Request\", plist_new_string(verb));\n\tplist_dict_set_item(dict, \"ProtocolVersion\", plist_new_string(LOCKDOWN_PROTOCOL_VERSION));\n\n\tif (options) {\n\t\tplist_dict_set_item(dict, \"PairingOptions\", plist_copy(options));\n\t}\n\n\t/* send to device */\n\tret = lockdownd_send(client, dict);\n\tplist_free(dict);\n\tdict = NULL;\n\n\tif (ret != LOCKDOWN_E_SUCCESS) {\n\t\tplist_free(pair_record_plist);\n\t\tif (wifi_node)\n\t\t\tplist_free(wifi_node);\n\t\treturn ret;\n\t}\n\n\t/* Now get device's answer */\n\tret = lockdownd_receive(client, &dict);\n\n\tif (ret != LOCKDOWN_E_SUCCESS) {\n\t\tplist_free(pair_record_plist);\n\t\tif (wifi_node)\n\t\t\tplist_free(wifi_node);\n\t\treturn ret;\n\t}\n\n\tif (strcmp(verb, \"Unpair\") == 0) {\n\t\t/* workaround for Unpair giving back ValidatePair,\n\t\t * seems to be a bug in the device's fw */\n\t\tif (lockdown_check_result(dict, NULL) != LOCKDOWN_E_SUCCESS) {\n\t\t\tret = LOCKDOWN_E_PAIRING_FAILED;\n\t\t}\n\t} else {\n\t\tif (lockdown_check_result(dict, verb) != LOCKDOWN_E_SUCCESS) {\n\t\t\tret = LOCKDOWN_E_PAIRING_FAILED;\n\t\t}\n\t}\n\n\t/* if pairing succeeded */\n\tif (ret == LOCKDOWN_E_SUCCESS) {\n\t\tdebug_info(\"%s success\", verb);\n\t\tif (!pairing_mode) {\n\t\t\tdebug_info(\"internal pairing mode\");\n\t\t\tif (!strcmp(\"Unpair\", verb)) {\n\t\t\t\t/* remove public key from config */\n\t\t\t\tuserpref_delete_pair_record(client->udid);\n\t\t\t} else {\n\t\t\t\tif (!strcmp(\"Pair\", verb)) {\n\t\t\t\t\t/* add returned escrow bag if available */\n\t\t\t\t\tplist_t extra_node = plist_dict_get_item(dict, USERPREF_ESCROW_BAG_KEY);\n\t\t\t\t\tif (extra_node && plist_get_node_type(extra_node) == PLIST_DATA) {\n\t\t\t\t\t\tdebug_info(\"Saving EscrowBag from response in pair record\");\n\t\t\t\t\t\tplist_dict_set_item(pair_record_plist, USERPREF_ESCROW_BAG_KEY, plist_copy(extra_node));\n\t\t\t\t\t}\n\n\t\t\t\t\t/* save previously retrieved wifi mac address in pair record */\n\t\t\t\t\tif (wifi_node) {\n\t\t\t\t\t\tdebug_info(\"Saving WiFiAddress from device in pair record\");\n\t\t\t\t\t\tplist_dict_set_item(pair_record_plist, USERPREF_WIFI_MAC_ADDRESS_KEY, plist_copy(wifi_node));\n\t\t\t\t\t\tplist_free(wifi_node);\n\t\t\t\t\t\twifi_node = NULL;\n\t\t\t\t\t}\n\n\t\t\t\t\tuserpref_save_pair_record(client->udid, pair_record_plist);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tdebug_info(\"external pairing mode\");\n\t\t}\n\t} else {\n\t\tdebug_info(\"%s failure\", verb);\n\t\tplist_t error_node = NULL;\n\t\t/* verify error condition */\n\t\terror_node = plist_dict_get_item(dict, \"Error\");\n\t\tif (error_node) {\n\t\t\tchar *value = NULL;\n\t\t\tplist_get_string_val(error_node, &value);\n\t\t\tif (value) {\n\t\t\t\t/* the first pairing fails if the device is password protected */\n\t\t\t\tret = lockdownd_strtoerr(value);\n\t\t\t\tfree(value);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (pair_record_plist) {\n\t\tplist_free(pair_record_plist);\n\t\tpair_record_plist = NULL;\n\t}\n\n\tif (wifi_node) {\n\t\tplist_free(wifi_node);\n\t\twifi_node = NULL;\n\t}\n\n\tif (result) {\n\t\t*result = dict;\n\t} else {\n\t\tplist_free(dict);\n\t\tdict = NULL;\n\t}\n\n\treturn ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_unpair(lockdownd_client_t client, lockdownd_pair_record_t pair_record)\n{\n\treturn lockdownd_do_pair(client, pair_record, \"Unpair\", NULL, NULL);\n}"
  },
  {
    "function_name": "lockdownd_validate_pair",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
    "lines": "1043-1046",
    "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_validate_pair(lockdownd_client_t client, lockdownd_pair_record_t pair_record)\n{\n\treturn lockdownd_do_pair(client, pair_record, \"ValidatePair\", NULL, NULL);\n}",
    "includes": [
      "#include <windows.h>",
      "#include \"asprintf.h\"",
      "#include \"common/utils.h\"",
      "#include \"common/userpref.h\"",
      "#include \"common/debug.h\"",
      "#include \"idevice.h\"",
      "#include \"lockdown.h\"",
      "#include \"property_list_service.h\"",
      "#include <plist/plist.h>",
      "#include <gnutls/crypto.h>",
      "#include <gnutls/x509.h>",
      "#include <libtasn1.h>",
      "#include <openssl/x509v3.h>",
      "#include <openssl/x509.h>",
      "#include <openssl/pem.h>",
      "#include <unistd.h>",
      "#include <ctype.h>",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "lockdownd_do_pair",
          "args": [
            "client",
            "pair_record",
            "\"ValidatePair\"",
            "NULL",
            "NULL"
          ],
          "line": 1045
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_do_pair",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "860-1023",
          "snippet": "static lockdownd_error_t lockdownd_do_pair(lockdownd_client_t client, lockdownd_pair_record_t pair_record, const char *verb, plist_t options, plist_t *result)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\tplist_t dict = NULL;\n\tplist_t pair_record_plist = NULL;\n\tplist_t wifi_node = NULL;\n\tint pairing_mode = 0; /* 0 = libimobiledevice, 1 = external */\n\n\tif (pair_record && pair_record->system_buid && pair_record->host_id) {\n\t\t/* valid pair_record passed? */\n\t\tif (!pair_record->device_certificate || !pair_record->host_certificate || !pair_record->root_certificate) {\n\t\t\treturn LOCKDOWN_E_PLIST_ERROR;\n\t\t}\n\n\t\t/* use passed pair_record */\n\t\tpair_record_plist = lockdownd_pair_record_to_plist(pair_record);\n\n\t\tpairing_mode = 1;\n\t} else {\n\t\t/* generate a new pair record if pairing */\n\t\tif (!strcmp(\"Pair\", verb)) {\n\t\t\tret = pair_record_generate(client, &pair_record_plist);\n\n\t\t\tif (ret != LOCKDOWN_E_SUCCESS) {\n\t\t\t\tif (pair_record_plist)\n\t\t\t\t\tplist_free(pair_record_plist);\n\t\t\t\treturn ret;\n\t\t\t}\n\n\t\t\t/* get wifi mac now, if we get it later we fail on iOS 7 which causes a reconnect */\n\t\t\tlockdownd_get_value(client, NULL, \"WiFiAddress\", &wifi_node);\n\t\t} else {\n\t\t\t/* use existing pair record */\n\t\t\tif (userpref_has_pair_record(client->udid)) {\n\t\t\t\tuserpref_read_pair_record(client->udid, &pair_record_plist);\n\t\t\t\tif (!pair_record_plist) {\n\t\t\t\t\treturn LOCKDOWN_E_INVALID_CONF;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn LOCKDOWN_E_INVALID_HOST_ID;\n\t\t\t}\n\t\t}\n\t}\n\n\tplist_t request_pair_record = plist_copy(pair_record_plist);\n\n\t/* remove stuff that is private */\n\tplist_dict_remove_item(request_pair_record, USERPREF_ROOT_PRIVATE_KEY_KEY);\n\tplist_dict_remove_item(request_pair_record, USERPREF_HOST_PRIVATE_KEY_KEY);\n\n\t/* setup pair request plist */\n\tdict = plist_new_dict();\n\tplist_dict_add_label(dict, client->label);\n\tplist_dict_set_item(dict, \"PairRecord\", request_pair_record);\n\tplist_dict_set_item(dict, \"Request\", plist_new_string(verb));\n\tplist_dict_set_item(dict, \"ProtocolVersion\", plist_new_string(LOCKDOWN_PROTOCOL_VERSION));\n\n\tif (options) {\n\t\tplist_dict_set_item(dict, \"PairingOptions\", plist_copy(options));\n\t}\n\n\t/* send to device */\n\tret = lockdownd_send(client, dict);\n\tplist_free(dict);\n\tdict = NULL;\n\n\tif (ret != LOCKDOWN_E_SUCCESS) {\n\t\tplist_free(pair_record_plist);\n\t\tif (wifi_node)\n\t\t\tplist_free(wifi_node);\n\t\treturn ret;\n\t}\n\n\t/* Now get device's answer */\n\tret = lockdownd_receive(client, &dict);\n\n\tif (ret != LOCKDOWN_E_SUCCESS) {\n\t\tplist_free(pair_record_plist);\n\t\tif (wifi_node)\n\t\t\tplist_free(wifi_node);\n\t\treturn ret;\n\t}\n\n\tif (strcmp(verb, \"Unpair\") == 0) {\n\t\t/* workaround for Unpair giving back ValidatePair,\n\t\t * seems to be a bug in the device's fw */\n\t\tif (lockdown_check_result(dict, NULL) != LOCKDOWN_E_SUCCESS) {\n\t\t\tret = LOCKDOWN_E_PAIRING_FAILED;\n\t\t}\n\t} else {\n\t\tif (lockdown_check_result(dict, verb) != LOCKDOWN_E_SUCCESS) {\n\t\t\tret = LOCKDOWN_E_PAIRING_FAILED;\n\t\t}\n\t}\n\n\t/* if pairing succeeded */\n\tif (ret == LOCKDOWN_E_SUCCESS) {\n\t\tdebug_info(\"%s success\", verb);\n\t\tif (!pairing_mode) {\n\t\t\tdebug_info(\"internal pairing mode\");\n\t\t\tif (!strcmp(\"Unpair\", verb)) {\n\t\t\t\t/* remove public key from config */\n\t\t\t\tuserpref_delete_pair_record(client->udid);\n\t\t\t} else {\n\t\t\t\tif (!strcmp(\"Pair\", verb)) {\n\t\t\t\t\t/* add returned escrow bag if available */\n\t\t\t\t\tplist_t extra_node = plist_dict_get_item(dict, USERPREF_ESCROW_BAG_KEY);\n\t\t\t\t\tif (extra_node && plist_get_node_type(extra_node) == PLIST_DATA) {\n\t\t\t\t\t\tdebug_info(\"Saving EscrowBag from response in pair record\");\n\t\t\t\t\t\tplist_dict_set_item(pair_record_plist, USERPREF_ESCROW_BAG_KEY, plist_copy(extra_node));\n\t\t\t\t\t}\n\n\t\t\t\t\t/* save previously retrieved wifi mac address in pair record */\n\t\t\t\t\tif (wifi_node) {\n\t\t\t\t\t\tdebug_info(\"Saving WiFiAddress from device in pair record\");\n\t\t\t\t\t\tplist_dict_set_item(pair_record_plist, USERPREF_WIFI_MAC_ADDRESS_KEY, plist_copy(wifi_node));\n\t\t\t\t\t\tplist_free(wifi_node);\n\t\t\t\t\t\twifi_node = NULL;\n\t\t\t\t\t}\n\n\t\t\t\t\tuserpref_save_pair_record(client->udid, pair_record_plist);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tdebug_info(\"external pairing mode\");\n\t\t}\n\t} else {\n\t\tdebug_info(\"%s failure\", verb);\n\t\tplist_t error_node = NULL;\n\t\t/* verify error condition */\n\t\terror_node = plist_dict_get_item(dict, \"Error\");\n\t\tif (error_node) {\n\t\t\tchar *value = NULL;\n\t\t\tplist_get_string_val(error_node, &value);\n\t\t\tif (value) {\n\t\t\t\t/* the first pairing fails if the device is password protected */\n\t\t\t\tret = lockdownd_strtoerr(value);\n\t\t\t\tfree(value);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (pair_record_plist) {\n\t\tplist_free(pair_record_plist);\n\t\tpair_record_plist = NULL;\n\t}\n\n\tif (wifi_node) {\n\t\tplist_free(wifi_node);\n\t\twifi_node = NULL;\n\t}\n\n\tif (result) {\n\t\t*result = dict;\n\t} else {\n\t\tplist_free(dict);\n\t\tdict = NULL;\n\t}\n\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic lockdownd_error_t lockdownd_do_pair(lockdownd_client_t client, lockdownd_pair_record_t pair_record, const char *verb, plist_t options, plist_t *result)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\tplist_t dict = NULL;\n\tplist_t pair_record_plist = NULL;\n\tplist_t wifi_node = NULL;\n\tint pairing_mode = 0; /* 0 = libimobiledevice, 1 = external */\n\n\tif (pair_record && pair_record->system_buid && pair_record->host_id) {\n\t\t/* valid pair_record passed? */\n\t\tif (!pair_record->device_certificate || !pair_record->host_certificate || !pair_record->root_certificate) {\n\t\t\treturn LOCKDOWN_E_PLIST_ERROR;\n\t\t}\n\n\t\t/* use passed pair_record */\n\t\tpair_record_plist = lockdownd_pair_record_to_plist(pair_record);\n\n\t\tpairing_mode = 1;\n\t} else {\n\t\t/* generate a new pair record if pairing */\n\t\tif (!strcmp(\"Pair\", verb)) {\n\t\t\tret = pair_record_generate(client, &pair_record_plist);\n\n\t\t\tif (ret != LOCKDOWN_E_SUCCESS) {\n\t\t\t\tif (pair_record_plist)\n\t\t\t\t\tplist_free(pair_record_plist);\n\t\t\t\treturn ret;\n\t\t\t}\n\n\t\t\t/* get wifi mac now, if we get it later we fail on iOS 7 which causes a reconnect */\n\t\t\tlockdownd_get_value(client, NULL, \"WiFiAddress\", &wifi_node);\n\t\t} else {\n\t\t\t/* use existing pair record */\n\t\t\tif (userpref_has_pair_record(client->udid)) {\n\t\t\t\tuserpref_read_pair_record(client->udid, &pair_record_plist);\n\t\t\t\tif (!pair_record_plist) {\n\t\t\t\t\treturn LOCKDOWN_E_INVALID_CONF;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn LOCKDOWN_E_INVALID_HOST_ID;\n\t\t\t}\n\t\t}\n\t}\n\n\tplist_t request_pair_record = plist_copy(pair_record_plist);\n\n\t/* remove stuff that is private */\n\tplist_dict_remove_item(request_pair_record, USERPREF_ROOT_PRIVATE_KEY_KEY);\n\tplist_dict_remove_item(request_pair_record, USERPREF_HOST_PRIVATE_KEY_KEY);\n\n\t/* setup pair request plist */\n\tdict = plist_new_dict();\n\tplist_dict_add_label(dict, client->label);\n\tplist_dict_set_item(dict, \"PairRecord\", request_pair_record);\n\tplist_dict_set_item(dict, \"Request\", plist_new_string(verb));\n\tplist_dict_set_item(dict, \"ProtocolVersion\", plist_new_string(LOCKDOWN_PROTOCOL_VERSION));\n\n\tif (options) {\n\t\tplist_dict_set_item(dict, \"PairingOptions\", plist_copy(options));\n\t}\n\n\t/* send to device */\n\tret = lockdownd_send(client, dict);\n\tplist_free(dict);\n\tdict = NULL;\n\n\tif (ret != LOCKDOWN_E_SUCCESS) {\n\t\tplist_free(pair_record_plist);\n\t\tif (wifi_node)\n\t\t\tplist_free(wifi_node);\n\t\treturn ret;\n\t}\n\n\t/* Now get device's answer */\n\tret = lockdownd_receive(client, &dict);\n\n\tif (ret != LOCKDOWN_E_SUCCESS) {\n\t\tplist_free(pair_record_plist);\n\t\tif (wifi_node)\n\t\t\tplist_free(wifi_node);\n\t\treturn ret;\n\t}\n\n\tif (strcmp(verb, \"Unpair\") == 0) {\n\t\t/* workaround for Unpair giving back ValidatePair,\n\t\t * seems to be a bug in the device's fw */\n\t\tif (lockdown_check_result(dict, NULL) != LOCKDOWN_E_SUCCESS) {\n\t\t\tret = LOCKDOWN_E_PAIRING_FAILED;\n\t\t}\n\t} else {\n\t\tif (lockdown_check_result(dict, verb) != LOCKDOWN_E_SUCCESS) {\n\t\t\tret = LOCKDOWN_E_PAIRING_FAILED;\n\t\t}\n\t}\n\n\t/* if pairing succeeded */\n\tif (ret == LOCKDOWN_E_SUCCESS) {\n\t\tdebug_info(\"%s success\", verb);\n\t\tif (!pairing_mode) {\n\t\t\tdebug_info(\"internal pairing mode\");\n\t\t\tif (!strcmp(\"Unpair\", verb)) {\n\t\t\t\t/* remove public key from config */\n\t\t\t\tuserpref_delete_pair_record(client->udid);\n\t\t\t} else {\n\t\t\t\tif (!strcmp(\"Pair\", verb)) {\n\t\t\t\t\t/* add returned escrow bag if available */\n\t\t\t\t\tplist_t extra_node = plist_dict_get_item(dict, USERPREF_ESCROW_BAG_KEY);\n\t\t\t\t\tif (extra_node && plist_get_node_type(extra_node) == PLIST_DATA) {\n\t\t\t\t\t\tdebug_info(\"Saving EscrowBag from response in pair record\");\n\t\t\t\t\t\tplist_dict_set_item(pair_record_plist, USERPREF_ESCROW_BAG_KEY, plist_copy(extra_node));\n\t\t\t\t\t}\n\n\t\t\t\t\t/* save previously retrieved wifi mac address in pair record */\n\t\t\t\t\tif (wifi_node) {\n\t\t\t\t\t\tdebug_info(\"Saving WiFiAddress from device in pair record\");\n\t\t\t\t\t\tplist_dict_set_item(pair_record_plist, USERPREF_WIFI_MAC_ADDRESS_KEY, plist_copy(wifi_node));\n\t\t\t\t\t\tplist_free(wifi_node);\n\t\t\t\t\t\twifi_node = NULL;\n\t\t\t\t\t}\n\n\t\t\t\t\tuserpref_save_pair_record(client->udid, pair_record_plist);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tdebug_info(\"external pairing mode\");\n\t\t}\n\t} else {\n\t\tdebug_info(\"%s failure\", verb);\n\t\tplist_t error_node = NULL;\n\t\t/* verify error condition */\n\t\terror_node = plist_dict_get_item(dict, \"Error\");\n\t\tif (error_node) {\n\t\t\tchar *value = NULL;\n\t\t\tplist_get_string_val(error_node, &value);\n\t\t\tif (value) {\n\t\t\t\t/* the first pairing fails if the device is password protected */\n\t\t\t\tret = lockdownd_strtoerr(value);\n\t\t\t\tfree(value);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (pair_record_plist) {\n\t\tplist_free(pair_record_plist);\n\t\tpair_record_plist = NULL;\n\t}\n\n\tif (wifi_node) {\n\t\tplist_free(wifi_node);\n\t\twifi_node = NULL;\n\t}\n\n\tif (result) {\n\t\t*result = dict;\n\t} else {\n\t\tplist_free(dict);\n\t\tdict = NULL;\n\t}\n\n\treturn ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_validate_pair(lockdownd_client_t client, lockdownd_pair_record_t pair_record)\n{\n\treturn lockdownd_do_pair(client, pair_record, \"ValidatePair\", NULL, NULL);\n}"
  },
  {
    "function_name": "lockdownd_pair_with_options",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
    "lines": "1038-1041",
    "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_pair_with_options(lockdownd_client_t client, lockdownd_pair_record_t pair_record, plist_t options, plist_t *response)\n{\n\treturn lockdownd_do_pair(client, pair_record, \"Pair\", options, response);\n}",
    "includes": [
      "#include <windows.h>",
      "#include \"asprintf.h\"",
      "#include \"common/utils.h\"",
      "#include \"common/userpref.h\"",
      "#include \"common/debug.h\"",
      "#include \"idevice.h\"",
      "#include \"lockdown.h\"",
      "#include \"property_list_service.h\"",
      "#include <plist/plist.h>",
      "#include <gnutls/crypto.h>",
      "#include <gnutls/x509.h>",
      "#include <libtasn1.h>",
      "#include <openssl/x509v3.h>",
      "#include <openssl/x509.h>",
      "#include <openssl/pem.h>",
      "#include <unistd.h>",
      "#include <ctype.h>",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "lockdownd_do_pair",
          "args": [
            "client",
            "pair_record",
            "\"Pair\"",
            "options",
            "response"
          ],
          "line": 1040
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_do_pair",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "860-1023",
          "snippet": "static lockdownd_error_t lockdownd_do_pair(lockdownd_client_t client, lockdownd_pair_record_t pair_record, const char *verb, plist_t options, plist_t *result)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\tplist_t dict = NULL;\n\tplist_t pair_record_plist = NULL;\n\tplist_t wifi_node = NULL;\n\tint pairing_mode = 0; /* 0 = libimobiledevice, 1 = external */\n\n\tif (pair_record && pair_record->system_buid && pair_record->host_id) {\n\t\t/* valid pair_record passed? */\n\t\tif (!pair_record->device_certificate || !pair_record->host_certificate || !pair_record->root_certificate) {\n\t\t\treturn LOCKDOWN_E_PLIST_ERROR;\n\t\t}\n\n\t\t/* use passed pair_record */\n\t\tpair_record_plist = lockdownd_pair_record_to_plist(pair_record);\n\n\t\tpairing_mode = 1;\n\t} else {\n\t\t/* generate a new pair record if pairing */\n\t\tif (!strcmp(\"Pair\", verb)) {\n\t\t\tret = pair_record_generate(client, &pair_record_plist);\n\n\t\t\tif (ret != LOCKDOWN_E_SUCCESS) {\n\t\t\t\tif (pair_record_plist)\n\t\t\t\t\tplist_free(pair_record_plist);\n\t\t\t\treturn ret;\n\t\t\t}\n\n\t\t\t/* get wifi mac now, if we get it later we fail on iOS 7 which causes a reconnect */\n\t\t\tlockdownd_get_value(client, NULL, \"WiFiAddress\", &wifi_node);\n\t\t} else {\n\t\t\t/* use existing pair record */\n\t\t\tif (userpref_has_pair_record(client->udid)) {\n\t\t\t\tuserpref_read_pair_record(client->udid, &pair_record_plist);\n\t\t\t\tif (!pair_record_plist) {\n\t\t\t\t\treturn LOCKDOWN_E_INVALID_CONF;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn LOCKDOWN_E_INVALID_HOST_ID;\n\t\t\t}\n\t\t}\n\t}\n\n\tplist_t request_pair_record = plist_copy(pair_record_plist);\n\n\t/* remove stuff that is private */\n\tplist_dict_remove_item(request_pair_record, USERPREF_ROOT_PRIVATE_KEY_KEY);\n\tplist_dict_remove_item(request_pair_record, USERPREF_HOST_PRIVATE_KEY_KEY);\n\n\t/* setup pair request plist */\n\tdict = plist_new_dict();\n\tplist_dict_add_label(dict, client->label);\n\tplist_dict_set_item(dict, \"PairRecord\", request_pair_record);\n\tplist_dict_set_item(dict, \"Request\", plist_new_string(verb));\n\tplist_dict_set_item(dict, \"ProtocolVersion\", plist_new_string(LOCKDOWN_PROTOCOL_VERSION));\n\n\tif (options) {\n\t\tplist_dict_set_item(dict, \"PairingOptions\", plist_copy(options));\n\t}\n\n\t/* send to device */\n\tret = lockdownd_send(client, dict);\n\tplist_free(dict);\n\tdict = NULL;\n\n\tif (ret != LOCKDOWN_E_SUCCESS) {\n\t\tplist_free(pair_record_plist);\n\t\tif (wifi_node)\n\t\t\tplist_free(wifi_node);\n\t\treturn ret;\n\t}\n\n\t/* Now get device's answer */\n\tret = lockdownd_receive(client, &dict);\n\n\tif (ret != LOCKDOWN_E_SUCCESS) {\n\t\tplist_free(pair_record_plist);\n\t\tif (wifi_node)\n\t\t\tplist_free(wifi_node);\n\t\treturn ret;\n\t}\n\n\tif (strcmp(verb, \"Unpair\") == 0) {\n\t\t/* workaround for Unpair giving back ValidatePair,\n\t\t * seems to be a bug in the device's fw */\n\t\tif (lockdown_check_result(dict, NULL) != LOCKDOWN_E_SUCCESS) {\n\t\t\tret = LOCKDOWN_E_PAIRING_FAILED;\n\t\t}\n\t} else {\n\t\tif (lockdown_check_result(dict, verb) != LOCKDOWN_E_SUCCESS) {\n\t\t\tret = LOCKDOWN_E_PAIRING_FAILED;\n\t\t}\n\t}\n\n\t/* if pairing succeeded */\n\tif (ret == LOCKDOWN_E_SUCCESS) {\n\t\tdebug_info(\"%s success\", verb);\n\t\tif (!pairing_mode) {\n\t\t\tdebug_info(\"internal pairing mode\");\n\t\t\tif (!strcmp(\"Unpair\", verb)) {\n\t\t\t\t/* remove public key from config */\n\t\t\t\tuserpref_delete_pair_record(client->udid);\n\t\t\t} else {\n\t\t\t\tif (!strcmp(\"Pair\", verb)) {\n\t\t\t\t\t/* add returned escrow bag if available */\n\t\t\t\t\tplist_t extra_node = plist_dict_get_item(dict, USERPREF_ESCROW_BAG_KEY);\n\t\t\t\t\tif (extra_node && plist_get_node_type(extra_node) == PLIST_DATA) {\n\t\t\t\t\t\tdebug_info(\"Saving EscrowBag from response in pair record\");\n\t\t\t\t\t\tplist_dict_set_item(pair_record_plist, USERPREF_ESCROW_BAG_KEY, plist_copy(extra_node));\n\t\t\t\t\t}\n\n\t\t\t\t\t/* save previously retrieved wifi mac address in pair record */\n\t\t\t\t\tif (wifi_node) {\n\t\t\t\t\t\tdebug_info(\"Saving WiFiAddress from device in pair record\");\n\t\t\t\t\t\tplist_dict_set_item(pair_record_plist, USERPREF_WIFI_MAC_ADDRESS_KEY, plist_copy(wifi_node));\n\t\t\t\t\t\tplist_free(wifi_node);\n\t\t\t\t\t\twifi_node = NULL;\n\t\t\t\t\t}\n\n\t\t\t\t\tuserpref_save_pair_record(client->udid, pair_record_plist);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tdebug_info(\"external pairing mode\");\n\t\t}\n\t} else {\n\t\tdebug_info(\"%s failure\", verb);\n\t\tplist_t error_node = NULL;\n\t\t/* verify error condition */\n\t\terror_node = plist_dict_get_item(dict, \"Error\");\n\t\tif (error_node) {\n\t\t\tchar *value = NULL;\n\t\t\tplist_get_string_val(error_node, &value);\n\t\t\tif (value) {\n\t\t\t\t/* the first pairing fails if the device is password protected */\n\t\t\t\tret = lockdownd_strtoerr(value);\n\t\t\t\tfree(value);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (pair_record_plist) {\n\t\tplist_free(pair_record_plist);\n\t\tpair_record_plist = NULL;\n\t}\n\n\tif (wifi_node) {\n\t\tplist_free(wifi_node);\n\t\twifi_node = NULL;\n\t}\n\n\tif (result) {\n\t\t*result = dict;\n\t} else {\n\t\tplist_free(dict);\n\t\tdict = NULL;\n\t}\n\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic lockdownd_error_t lockdownd_do_pair(lockdownd_client_t client, lockdownd_pair_record_t pair_record, const char *verb, plist_t options, plist_t *result)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\tplist_t dict = NULL;\n\tplist_t pair_record_plist = NULL;\n\tplist_t wifi_node = NULL;\n\tint pairing_mode = 0; /* 0 = libimobiledevice, 1 = external */\n\n\tif (pair_record && pair_record->system_buid && pair_record->host_id) {\n\t\t/* valid pair_record passed? */\n\t\tif (!pair_record->device_certificate || !pair_record->host_certificate || !pair_record->root_certificate) {\n\t\t\treturn LOCKDOWN_E_PLIST_ERROR;\n\t\t}\n\n\t\t/* use passed pair_record */\n\t\tpair_record_plist = lockdownd_pair_record_to_plist(pair_record);\n\n\t\tpairing_mode = 1;\n\t} else {\n\t\t/* generate a new pair record if pairing */\n\t\tif (!strcmp(\"Pair\", verb)) {\n\t\t\tret = pair_record_generate(client, &pair_record_plist);\n\n\t\t\tif (ret != LOCKDOWN_E_SUCCESS) {\n\t\t\t\tif (pair_record_plist)\n\t\t\t\t\tplist_free(pair_record_plist);\n\t\t\t\treturn ret;\n\t\t\t}\n\n\t\t\t/* get wifi mac now, if we get it later we fail on iOS 7 which causes a reconnect */\n\t\t\tlockdownd_get_value(client, NULL, \"WiFiAddress\", &wifi_node);\n\t\t} else {\n\t\t\t/* use existing pair record */\n\t\t\tif (userpref_has_pair_record(client->udid)) {\n\t\t\t\tuserpref_read_pair_record(client->udid, &pair_record_plist);\n\t\t\t\tif (!pair_record_plist) {\n\t\t\t\t\treturn LOCKDOWN_E_INVALID_CONF;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn LOCKDOWN_E_INVALID_HOST_ID;\n\t\t\t}\n\t\t}\n\t}\n\n\tplist_t request_pair_record = plist_copy(pair_record_plist);\n\n\t/* remove stuff that is private */\n\tplist_dict_remove_item(request_pair_record, USERPREF_ROOT_PRIVATE_KEY_KEY);\n\tplist_dict_remove_item(request_pair_record, USERPREF_HOST_PRIVATE_KEY_KEY);\n\n\t/* setup pair request plist */\n\tdict = plist_new_dict();\n\tplist_dict_add_label(dict, client->label);\n\tplist_dict_set_item(dict, \"PairRecord\", request_pair_record);\n\tplist_dict_set_item(dict, \"Request\", plist_new_string(verb));\n\tplist_dict_set_item(dict, \"ProtocolVersion\", plist_new_string(LOCKDOWN_PROTOCOL_VERSION));\n\n\tif (options) {\n\t\tplist_dict_set_item(dict, \"PairingOptions\", plist_copy(options));\n\t}\n\n\t/* send to device */\n\tret = lockdownd_send(client, dict);\n\tplist_free(dict);\n\tdict = NULL;\n\n\tif (ret != LOCKDOWN_E_SUCCESS) {\n\t\tplist_free(pair_record_plist);\n\t\tif (wifi_node)\n\t\t\tplist_free(wifi_node);\n\t\treturn ret;\n\t}\n\n\t/* Now get device's answer */\n\tret = lockdownd_receive(client, &dict);\n\n\tif (ret != LOCKDOWN_E_SUCCESS) {\n\t\tplist_free(pair_record_plist);\n\t\tif (wifi_node)\n\t\t\tplist_free(wifi_node);\n\t\treturn ret;\n\t}\n\n\tif (strcmp(verb, \"Unpair\") == 0) {\n\t\t/* workaround for Unpair giving back ValidatePair,\n\t\t * seems to be a bug in the device's fw */\n\t\tif (lockdown_check_result(dict, NULL) != LOCKDOWN_E_SUCCESS) {\n\t\t\tret = LOCKDOWN_E_PAIRING_FAILED;\n\t\t}\n\t} else {\n\t\tif (lockdown_check_result(dict, verb) != LOCKDOWN_E_SUCCESS) {\n\t\t\tret = LOCKDOWN_E_PAIRING_FAILED;\n\t\t}\n\t}\n\n\t/* if pairing succeeded */\n\tif (ret == LOCKDOWN_E_SUCCESS) {\n\t\tdebug_info(\"%s success\", verb);\n\t\tif (!pairing_mode) {\n\t\t\tdebug_info(\"internal pairing mode\");\n\t\t\tif (!strcmp(\"Unpair\", verb)) {\n\t\t\t\t/* remove public key from config */\n\t\t\t\tuserpref_delete_pair_record(client->udid);\n\t\t\t} else {\n\t\t\t\tif (!strcmp(\"Pair\", verb)) {\n\t\t\t\t\t/* add returned escrow bag if available */\n\t\t\t\t\tplist_t extra_node = plist_dict_get_item(dict, USERPREF_ESCROW_BAG_KEY);\n\t\t\t\t\tif (extra_node && plist_get_node_type(extra_node) == PLIST_DATA) {\n\t\t\t\t\t\tdebug_info(\"Saving EscrowBag from response in pair record\");\n\t\t\t\t\t\tplist_dict_set_item(pair_record_plist, USERPREF_ESCROW_BAG_KEY, plist_copy(extra_node));\n\t\t\t\t\t}\n\n\t\t\t\t\t/* save previously retrieved wifi mac address in pair record */\n\t\t\t\t\tif (wifi_node) {\n\t\t\t\t\t\tdebug_info(\"Saving WiFiAddress from device in pair record\");\n\t\t\t\t\t\tplist_dict_set_item(pair_record_plist, USERPREF_WIFI_MAC_ADDRESS_KEY, plist_copy(wifi_node));\n\t\t\t\t\t\tplist_free(wifi_node);\n\t\t\t\t\t\twifi_node = NULL;\n\t\t\t\t\t}\n\n\t\t\t\t\tuserpref_save_pair_record(client->udid, pair_record_plist);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tdebug_info(\"external pairing mode\");\n\t\t}\n\t} else {\n\t\tdebug_info(\"%s failure\", verb);\n\t\tplist_t error_node = NULL;\n\t\t/* verify error condition */\n\t\terror_node = plist_dict_get_item(dict, \"Error\");\n\t\tif (error_node) {\n\t\t\tchar *value = NULL;\n\t\t\tplist_get_string_val(error_node, &value);\n\t\t\tif (value) {\n\t\t\t\t/* the first pairing fails if the device is password protected */\n\t\t\t\tret = lockdownd_strtoerr(value);\n\t\t\t\tfree(value);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (pair_record_plist) {\n\t\tplist_free(pair_record_plist);\n\t\tpair_record_plist = NULL;\n\t}\n\n\tif (wifi_node) {\n\t\tplist_free(wifi_node);\n\t\twifi_node = NULL;\n\t}\n\n\tif (result) {\n\t\t*result = dict;\n\t} else {\n\t\tplist_free(dict);\n\t\tdict = NULL;\n\t}\n\n\treturn ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_pair_with_options(lockdownd_client_t client, lockdownd_pair_record_t pair_record, plist_t options, plist_t *response)\n{\n\treturn lockdownd_do_pair(client, pair_record, \"Pair\", options, response);\n}"
  },
  {
    "function_name": "lockdownd_pair",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
    "lines": "1025-1036",
    "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_pair(lockdownd_client_t client, lockdownd_pair_record_t pair_record)\n{\n\n\tplist_t options = plist_new_dict();\n\tplist_dict_set_item(options, \"ExtendedPairingErrors\", plist_new_bool(1));\n\n\tlockdownd_error_t ret = lockdownd_do_pair(client, pair_record, \"Pair\", options, NULL);\n\n\tplist_free(options);\n\n\treturn ret;\n}",
    "includes": [
      "#include <windows.h>",
      "#include \"asprintf.h\"",
      "#include \"common/utils.h\"",
      "#include \"common/userpref.h\"",
      "#include \"common/debug.h\"",
      "#include \"idevice.h\"",
      "#include \"lockdown.h\"",
      "#include \"property_list_service.h\"",
      "#include <plist/plist.h>",
      "#include <gnutls/crypto.h>",
      "#include <gnutls/x509.h>",
      "#include <libtasn1.h>",
      "#include <openssl/x509v3.h>",
      "#include <openssl/x509.h>",
      "#include <openssl/pem.h>",
      "#include <unistd.h>",
      "#include <ctype.h>",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "options"
          ],
          "line": 1033
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lockdownd_do_pair",
          "args": [
            "client",
            "pair_record",
            "\"Pair\"",
            "options",
            "NULL"
          ],
          "line": 1031
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_do_pair",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "860-1023",
          "snippet": "static lockdownd_error_t lockdownd_do_pair(lockdownd_client_t client, lockdownd_pair_record_t pair_record, const char *verb, plist_t options, plist_t *result)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\tplist_t dict = NULL;\n\tplist_t pair_record_plist = NULL;\n\tplist_t wifi_node = NULL;\n\tint pairing_mode = 0; /* 0 = libimobiledevice, 1 = external */\n\n\tif (pair_record && pair_record->system_buid && pair_record->host_id) {\n\t\t/* valid pair_record passed? */\n\t\tif (!pair_record->device_certificate || !pair_record->host_certificate || !pair_record->root_certificate) {\n\t\t\treturn LOCKDOWN_E_PLIST_ERROR;\n\t\t}\n\n\t\t/* use passed pair_record */\n\t\tpair_record_plist = lockdownd_pair_record_to_plist(pair_record);\n\n\t\tpairing_mode = 1;\n\t} else {\n\t\t/* generate a new pair record if pairing */\n\t\tif (!strcmp(\"Pair\", verb)) {\n\t\t\tret = pair_record_generate(client, &pair_record_plist);\n\n\t\t\tif (ret != LOCKDOWN_E_SUCCESS) {\n\t\t\t\tif (pair_record_plist)\n\t\t\t\t\tplist_free(pair_record_plist);\n\t\t\t\treturn ret;\n\t\t\t}\n\n\t\t\t/* get wifi mac now, if we get it later we fail on iOS 7 which causes a reconnect */\n\t\t\tlockdownd_get_value(client, NULL, \"WiFiAddress\", &wifi_node);\n\t\t} else {\n\t\t\t/* use existing pair record */\n\t\t\tif (userpref_has_pair_record(client->udid)) {\n\t\t\t\tuserpref_read_pair_record(client->udid, &pair_record_plist);\n\t\t\t\tif (!pair_record_plist) {\n\t\t\t\t\treturn LOCKDOWN_E_INVALID_CONF;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn LOCKDOWN_E_INVALID_HOST_ID;\n\t\t\t}\n\t\t}\n\t}\n\n\tplist_t request_pair_record = plist_copy(pair_record_plist);\n\n\t/* remove stuff that is private */\n\tplist_dict_remove_item(request_pair_record, USERPREF_ROOT_PRIVATE_KEY_KEY);\n\tplist_dict_remove_item(request_pair_record, USERPREF_HOST_PRIVATE_KEY_KEY);\n\n\t/* setup pair request plist */\n\tdict = plist_new_dict();\n\tplist_dict_add_label(dict, client->label);\n\tplist_dict_set_item(dict, \"PairRecord\", request_pair_record);\n\tplist_dict_set_item(dict, \"Request\", plist_new_string(verb));\n\tplist_dict_set_item(dict, \"ProtocolVersion\", plist_new_string(LOCKDOWN_PROTOCOL_VERSION));\n\n\tif (options) {\n\t\tplist_dict_set_item(dict, \"PairingOptions\", plist_copy(options));\n\t}\n\n\t/* send to device */\n\tret = lockdownd_send(client, dict);\n\tplist_free(dict);\n\tdict = NULL;\n\n\tif (ret != LOCKDOWN_E_SUCCESS) {\n\t\tplist_free(pair_record_plist);\n\t\tif (wifi_node)\n\t\t\tplist_free(wifi_node);\n\t\treturn ret;\n\t}\n\n\t/* Now get device's answer */\n\tret = lockdownd_receive(client, &dict);\n\n\tif (ret != LOCKDOWN_E_SUCCESS) {\n\t\tplist_free(pair_record_plist);\n\t\tif (wifi_node)\n\t\t\tplist_free(wifi_node);\n\t\treturn ret;\n\t}\n\n\tif (strcmp(verb, \"Unpair\") == 0) {\n\t\t/* workaround for Unpair giving back ValidatePair,\n\t\t * seems to be a bug in the device's fw */\n\t\tif (lockdown_check_result(dict, NULL) != LOCKDOWN_E_SUCCESS) {\n\t\t\tret = LOCKDOWN_E_PAIRING_FAILED;\n\t\t}\n\t} else {\n\t\tif (lockdown_check_result(dict, verb) != LOCKDOWN_E_SUCCESS) {\n\t\t\tret = LOCKDOWN_E_PAIRING_FAILED;\n\t\t}\n\t}\n\n\t/* if pairing succeeded */\n\tif (ret == LOCKDOWN_E_SUCCESS) {\n\t\tdebug_info(\"%s success\", verb);\n\t\tif (!pairing_mode) {\n\t\t\tdebug_info(\"internal pairing mode\");\n\t\t\tif (!strcmp(\"Unpair\", verb)) {\n\t\t\t\t/* remove public key from config */\n\t\t\t\tuserpref_delete_pair_record(client->udid);\n\t\t\t} else {\n\t\t\t\tif (!strcmp(\"Pair\", verb)) {\n\t\t\t\t\t/* add returned escrow bag if available */\n\t\t\t\t\tplist_t extra_node = plist_dict_get_item(dict, USERPREF_ESCROW_BAG_KEY);\n\t\t\t\t\tif (extra_node && plist_get_node_type(extra_node) == PLIST_DATA) {\n\t\t\t\t\t\tdebug_info(\"Saving EscrowBag from response in pair record\");\n\t\t\t\t\t\tplist_dict_set_item(pair_record_plist, USERPREF_ESCROW_BAG_KEY, plist_copy(extra_node));\n\t\t\t\t\t}\n\n\t\t\t\t\t/* save previously retrieved wifi mac address in pair record */\n\t\t\t\t\tif (wifi_node) {\n\t\t\t\t\t\tdebug_info(\"Saving WiFiAddress from device in pair record\");\n\t\t\t\t\t\tplist_dict_set_item(pair_record_plist, USERPREF_WIFI_MAC_ADDRESS_KEY, plist_copy(wifi_node));\n\t\t\t\t\t\tplist_free(wifi_node);\n\t\t\t\t\t\twifi_node = NULL;\n\t\t\t\t\t}\n\n\t\t\t\t\tuserpref_save_pair_record(client->udid, pair_record_plist);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tdebug_info(\"external pairing mode\");\n\t\t}\n\t} else {\n\t\tdebug_info(\"%s failure\", verb);\n\t\tplist_t error_node = NULL;\n\t\t/* verify error condition */\n\t\terror_node = plist_dict_get_item(dict, \"Error\");\n\t\tif (error_node) {\n\t\t\tchar *value = NULL;\n\t\t\tplist_get_string_val(error_node, &value);\n\t\t\tif (value) {\n\t\t\t\t/* the first pairing fails if the device is password protected */\n\t\t\t\tret = lockdownd_strtoerr(value);\n\t\t\t\tfree(value);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (pair_record_plist) {\n\t\tplist_free(pair_record_plist);\n\t\tpair_record_plist = NULL;\n\t}\n\n\tif (wifi_node) {\n\t\tplist_free(wifi_node);\n\t\twifi_node = NULL;\n\t}\n\n\tif (result) {\n\t\t*result = dict;\n\t} else {\n\t\tplist_free(dict);\n\t\tdict = NULL;\n\t}\n\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic lockdownd_error_t lockdownd_do_pair(lockdownd_client_t client, lockdownd_pair_record_t pair_record, const char *verb, plist_t options, plist_t *result)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\tplist_t dict = NULL;\n\tplist_t pair_record_plist = NULL;\n\tplist_t wifi_node = NULL;\n\tint pairing_mode = 0; /* 0 = libimobiledevice, 1 = external */\n\n\tif (pair_record && pair_record->system_buid && pair_record->host_id) {\n\t\t/* valid pair_record passed? */\n\t\tif (!pair_record->device_certificate || !pair_record->host_certificate || !pair_record->root_certificate) {\n\t\t\treturn LOCKDOWN_E_PLIST_ERROR;\n\t\t}\n\n\t\t/* use passed pair_record */\n\t\tpair_record_plist = lockdownd_pair_record_to_plist(pair_record);\n\n\t\tpairing_mode = 1;\n\t} else {\n\t\t/* generate a new pair record if pairing */\n\t\tif (!strcmp(\"Pair\", verb)) {\n\t\t\tret = pair_record_generate(client, &pair_record_plist);\n\n\t\t\tif (ret != LOCKDOWN_E_SUCCESS) {\n\t\t\t\tif (pair_record_plist)\n\t\t\t\t\tplist_free(pair_record_plist);\n\t\t\t\treturn ret;\n\t\t\t}\n\n\t\t\t/* get wifi mac now, if we get it later we fail on iOS 7 which causes a reconnect */\n\t\t\tlockdownd_get_value(client, NULL, \"WiFiAddress\", &wifi_node);\n\t\t} else {\n\t\t\t/* use existing pair record */\n\t\t\tif (userpref_has_pair_record(client->udid)) {\n\t\t\t\tuserpref_read_pair_record(client->udid, &pair_record_plist);\n\t\t\t\tif (!pair_record_plist) {\n\t\t\t\t\treturn LOCKDOWN_E_INVALID_CONF;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn LOCKDOWN_E_INVALID_HOST_ID;\n\t\t\t}\n\t\t}\n\t}\n\n\tplist_t request_pair_record = plist_copy(pair_record_plist);\n\n\t/* remove stuff that is private */\n\tplist_dict_remove_item(request_pair_record, USERPREF_ROOT_PRIVATE_KEY_KEY);\n\tplist_dict_remove_item(request_pair_record, USERPREF_HOST_PRIVATE_KEY_KEY);\n\n\t/* setup pair request plist */\n\tdict = plist_new_dict();\n\tplist_dict_add_label(dict, client->label);\n\tplist_dict_set_item(dict, \"PairRecord\", request_pair_record);\n\tplist_dict_set_item(dict, \"Request\", plist_new_string(verb));\n\tplist_dict_set_item(dict, \"ProtocolVersion\", plist_new_string(LOCKDOWN_PROTOCOL_VERSION));\n\n\tif (options) {\n\t\tplist_dict_set_item(dict, \"PairingOptions\", plist_copy(options));\n\t}\n\n\t/* send to device */\n\tret = lockdownd_send(client, dict);\n\tplist_free(dict);\n\tdict = NULL;\n\n\tif (ret != LOCKDOWN_E_SUCCESS) {\n\t\tplist_free(pair_record_plist);\n\t\tif (wifi_node)\n\t\t\tplist_free(wifi_node);\n\t\treturn ret;\n\t}\n\n\t/* Now get device's answer */\n\tret = lockdownd_receive(client, &dict);\n\n\tif (ret != LOCKDOWN_E_SUCCESS) {\n\t\tplist_free(pair_record_plist);\n\t\tif (wifi_node)\n\t\t\tplist_free(wifi_node);\n\t\treturn ret;\n\t}\n\n\tif (strcmp(verb, \"Unpair\") == 0) {\n\t\t/* workaround for Unpair giving back ValidatePair,\n\t\t * seems to be a bug in the device's fw */\n\t\tif (lockdown_check_result(dict, NULL) != LOCKDOWN_E_SUCCESS) {\n\t\t\tret = LOCKDOWN_E_PAIRING_FAILED;\n\t\t}\n\t} else {\n\t\tif (lockdown_check_result(dict, verb) != LOCKDOWN_E_SUCCESS) {\n\t\t\tret = LOCKDOWN_E_PAIRING_FAILED;\n\t\t}\n\t}\n\n\t/* if pairing succeeded */\n\tif (ret == LOCKDOWN_E_SUCCESS) {\n\t\tdebug_info(\"%s success\", verb);\n\t\tif (!pairing_mode) {\n\t\t\tdebug_info(\"internal pairing mode\");\n\t\t\tif (!strcmp(\"Unpair\", verb)) {\n\t\t\t\t/* remove public key from config */\n\t\t\t\tuserpref_delete_pair_record(client->udid);\n\t\t\t} else {\n\t\t\t\tif (!strcmp(\"Pair\", verb)) {\n\t\t\t\t\t/* add returned escrow bag if available */\n\t\t\t\t\tplist_t extra_node = plist_dict_get_item(dict, USERPREF_ESCROW_BAG_KEY);\n\t\t\t\t\tif (extra_node && plist_get_node_type(extra_node) == PLIST_DATA) {\n\t\t\t\t\t\tdebug_info(\"Saving EscrowBag from response in pair record\");\n\t\t\t\t\t\tplist_dict_set_item(pair_record_plist, USERPREF_ESCROW_BAG_KEY, plist_copy(extra_node));\n\t\t\t\t\t}\n\n\t\t\t\t\t/* save previously retrieved wifi mac address in pair record */\n\t\t\t\t\tif (wifi_node) {\n\t\t\t\t\t\tdebug_info(\"Saving WiFiAddress from device in pair record\");\n\t\t\t\t\t\tplist_dict_set_item(pair_record_plist, USERPREF_WIFI_MAC_ADDRESS_KEY, plist_copy(wifi_node));\n\t\t\t\t\t\tplist_free(wifi_node);\n\t\t\t\t\t\twifi_node = NULL;\n\t\t\t\t\t}\n\n\t\t\t\t\tuserpref_save_pair_record(client->udid, pair_record_plist);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tdebug_info(\"external pairing mode\");\n\t\t}\n\t} else {\n\t\tdebug_info(\"%s failure\", verb);\n\t\tplist_t error_node = NULL;\n\t\t/* verify error condition */\n\t\terror_node = plist_dict_get_item(dict, \"Error\");\n\t\tif (error_node) {\n\t\t\tchar *value = NULL;\n\t\t\tplist_get_string_val(error_node, &value);\n\t\t\tif (value) {\n\t\t\t\t/* the first pairing fails if the device is password protected */\n\t\t\t\tret = lockdownd_strtoerr(value);\n\t\t\t\tfree(value);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (pair_record_plist) {\n\t\tplist_free(pair_record_plist);\n\t\tpair_record_plist = NULL;\n\t}\n\n\tif (wifi_node) {\n\t\tplist_free(wifi_node);\n\t\twifi_node = NULL;\n\t}\n\n\tif (result) {\n\t\t*result = dict;\n\t} else {\n\t\tplist_free(dict);\n\t\tdict = NULL;\n\t}\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "options",
            "\"ExtendedPairingErrors\"",
            "plist_new_bool(1)"
          ],
          "line": 1029
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_bool",
          "args": [
            "1"
          ],
          "line": 1029
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_dict",
          "args": [],
          "line": 1028
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_pair(lockdownd_client_t client, lockdownd_pair_record_t pair_record)\n{\n\n\tplist_t options = plist_new_dict();\n\tplist_dict_set_item(options, \"ExtendedPairingErrors\", plist_new_bool(1));\n\n\tlockdownd_error_t ret = lockdownd_do_pair(client, pair_record, \"Pair\", options, NULL);\n\n\tplist_free(options);\n\n\treturn ret;\n}"
  },
  {
    "function_name": "lockdownd_do_pair",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
    "lines": "860-1023",
    "snippet": "static lockdownd_error_t lockdownd_do_pair(lockdownd_client_t client, lockdownd_pair_record_t pair_record, const char *verb, plist_t options, plist_t *result)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\tplist_t dict = NULL;\n\tplist_t pair_record_plist = NULL;\n\tplist_t wifi_node = NULL;\n\tint pairing_mode = 0; /* 0 = libimobiledevice, 1 = external */\n\n\tif (pair_record && pair_record->system_buid && pair_record->host_id) {\n\t\t/* valid pair_record passed? */\n\t\tif (!pair_record->device_certificate || !pair_record->host_certificate || !pair_record->root_certificate) {\n\t\t\treturn LOCKDOWN_E_PLIST_ERROR;\n\t\t}\n\n\t\t/* use passed pair_record */\n\t\tpair_record_plist = lockdownd_pair_record_to_plist(pair_record);\n\n\t\tpairing_mode = 1;\n\t} else {\n\t\t/* generate a new pair record if pairing */\n\t\tif (!strcmp(\"Pair\", verb)) {\n\t\t\tret = pair_record_generate(client, &pair_record_plist);\n\n\t\t\tif (ret != LOCKDOWN_E_SUCCESS) {\n\t\t\t\tif (pair_record_plist)\n\t\t\t\t\tplist_free(pair_record_plist);\n\t\t\t\treturn ret;\n\t\t\t}\n\n\t\t\t/* get wifi mac now, if we get it later we fail on iOS 7 which causes a reconnect */\n\t\t\tlockdownd_get_value(client, NULL, \"WiFiAddress\", &wifi_node);\n\t\t} else {\n\t\t\t/* use existing pair record */\n\t\t\tif (userpref_has_pair_record(client->udid)) {\n\t\t\t\tuserpref_read_pair_record(client->udid, &pair_record_plist);\n\t\t\t\tif (!pair_record_plist) {\n\t\t\t\t\treturn LOCKDOWN_E_INVALID_CONF;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn LOCKDOWN_E_INVALID_HOST_ID;\n\t\t\t}\n\t\t}\n\t}\n\n\tplist_t request_pair_record = plist_copy(pair_record_plist);\n\n\t/* remove stuff that is private */\n\tplist_dict_remove_item(request_pair_record, USERPREF_ROOT_PRIVATE_KEY_KEY);\n\tplist_dict_remove_item(request_pair_record, USERPREF_HOST_PRIVATE_KEY_KEY);\n\n\t/* setup pair request plist */\n\tdict = plist_new_dict();\n\tplist_dict_add_label(dict, client->label);\n\tplist_dict_set_item(dict, \"PairRecord\", request_pair_record);\n\tplist_dict_set_item(dict, \"Request\", plist_new_string(verb));\n\tplist_dict_set_item(dict, \"ProtocolVersion\", plist_new_string(LOCKDOWN_PROTOCOL_VERSION));\n\n\tif (options) {\n\t\tplist_dict_set_item(dict, \"PairingOptions\", plist_copy(options));\n\t}\n\n\t/* send to device */\n\tret = lockdownd_send(client, dict);\n\tplist_free(dict);\n\tdict = NULL;\n\n\tif (ret != LOCKDOWN_E_SUCCESS) {\n\t\tplist_free(pair_record_plist);\n\t\tif (wifi_node)\n\t\t\tplist_free(wifi_node);\n\t\treturn ret;\n\t}\n\n\t/* Now get device's answer */\n\tret = lockdownd_receive(client, &dict);\n\n\tif (ret != LOCKDOWN_E_SUCCESS) {\n\t\tplist_free(pair_record_plist);\n\t\tif (wifi_node)\n\t\t\tplist_free(wifi_node);\n\t\treturn ret;\n\t}\n\n\tif (strcmp(verb, \"Unpair\") == 0) {\n\t\t/* workaround for Unpair giving back ValidatePair,\n\t\t * seems to be a bug in the device's fw */\n\t\tif (lockdown_check_result(dict, NULL) != LOCKDOWN_E_SUCCESS) {\n\t\t\tret = LOCKDOWN_E_PAIRING_FAILED;\n\t\t}\n\t} else {\n\t\tif (lockdown_check_result(dict, verb) != LOCKDOWN_E_SUCCESS) {\n\t\t\tret = LOCKDOWN_E_PAIRING_FAILED;\n\t\t}\n\t}\n\n\t/* if pairing succeeded */\n\tif (ret == LOCKDOWN_E_SUCCESS) {\n\t\tdebug_info(\"%s success\", verb);\n\t\tif (!pairing_mode) {\n\t\t\tdebug_info(\"internal pairing mode\");\n\t\t\tif (!strcmp(\"Unpair\", verb)) {\n\t\t\t\t/* remove public key from config */\n\t\t\t\tuserpref_delete_pair_record(client->udid);\n\t\t\t} else {\n\t\t\t\tif (!strcmp(\"Pair\", verb)) {\n\t\t\t\t\t/* add returned escrow bag if available */\n\t\t\t\t\tplist_t extra_node = plist_dict_get_item(dict, USERPREF_ESCROW_BAG_KEY);\n\t\t\t\t\tif (extra_node && plist_get_node_type(extra_node) == PLIST_DATA) {\n\t\t\t\t\t\tdebug_info(\"Saving EscrowBag from response in pair record\");\n\t\t\t\t\t\tplist_dict_set_item(pair_record_plist, USERPREF_ESCROW_BAG_KEY, plist_copy(extra_node));\n\t\t\t\t\t}\n\n\t\t\t\t\t/* save previously retrieved wifi mac address in pair record */\n\t\t\t\t\tif (wifi_node) {\n\t\t\t\t\t\tdebug_info(\"Saving WiFiAddress from device in pair record\");\n\t\t\t\t\t\tplist_dict_set_item(pair_record_plist, USERPREF_WIFI_MAC_ADDRESS_KEY, plist_copy(wifi_node));\n\t\t\t\t\t\tplist_free(wifi_node);\n\t\t\t\t\t\twifi_node = NULL;\n\t\t\t\t\t}\n\n\t\t\t\t\tuserpref_save_pair_record(client->udid, pair_record_plist);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tdebug_info(\"external pairing mode\");\n\t\t}\n\t} else {\n\t\tdebug_info(\"%s failure\", verb);\n\t\tplist_t error_node = NULL;\n\t\t/* verify error condition */\n\t\terror_node = plist_dict_get_item(dict, \"Error\");\n\t\tif (error_node) {\n\t\t\tchar *value = NULL;\n\t\t\tplist_get_string_val(error_node, &value);\n\t\t\tif (value) {\n\t\t\t\t/* the first pairing fails if the device is password protected */\n\t\t\t\tret = lockdownd_strtoerr(value);\n\t\t\t\tfree(value);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (pair_record_plist) {\n\t\tplist_free(pair_record_plist);\n\t\tpair_record_plist = NULL;\n\t}\n\n\tif (wifi_node) {\n\t\tplist_free(wifi_node);\n\t\twifi_node = NULL;\n\t}\n\n\tif (result) {\n\t\t*result = dict;\n\t} else {\n\t\tplist_free(dict);\n\t\tdict = NULL;\n\t}\n\n\treturn ret;\n}",
    "includes": [
      "#include <windows.h>",
      "#include \"asprintf.h\"",
      "#include \"common/utils.h\"",
      "#include \"common/userpref.h\"",
      "#include \"common/debug.h\"",
      "#include \"idevice.h\"",
      "#include \"lockdown.h\"",
      "#include \"property_list_service.h\"",
      "#include <plist/plist.h>",
      "#include <gnutls/crypto.h>",
      "#include <gnutls/x509.h>",
      "#include <libtasn1.h>",
      "#include <openssl/x509v3.h>",
      "#include <openssl/x509.h>",
      "#include <openssl/pem.h>",
      "#include <unistd.h>",
      "#include <ctype.h>",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "dict"
          ],
          "line": 1018
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "wifi_node"
          ],
          "line": 1011
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "pair_record_plist"
          ],
          "line": 1006
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "value"
          ],
          "line": 1000
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_service_descriptor_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "1522-1528",
          "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_service_descriptor_free(lockdownd_service_descriptor_t service)\n{\n\tif (service)\n\t\tfree(service);\n\n\treturn LOCKDOWN_E_SUCCESS;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_service_descriptor_free(lockdownd_service_descriptor_t service)\n{\n\tif (service)\n\t\tfree(service);\n\n\treturn LOCKDOWN_E_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lockdownd_strtoerr",
          "args": [
            "value"
          ],
          "line": 999
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_strtoerr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "69-136",
          "snippet": "static lockdownd_error_t lockdownd_strtoerr(const char* name)\n{\n\tlockdownd_error_t err = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tif (strcmp(name, \"InvalidResponse\") == 0) {\n\t\terr = LOCKDOWN_E_INVALID_RESPONSE;\n\t} else if (strcmp(name, \"MissingKey\") == 0) {\n\t\terr = LOCKDOWN_E_MISSING_KEY;\n\t} else if (strcmp(name, \"MissingValue\") == 0) {\n\t\terr = LOCKDOWN_E_MISSING_VALUE;\n\t} else if (strcmp(name, \"GetProhibited\") == 0) {\n\t\terr = LOCKDOWN_E_GET_PROHIBITED;\n\t} else if (strcmp(name, \"SetProhibited\") == 0) {\n\t\terr = LOCKDOWN_E_SET_PROHIBITED;\n\t} else if (strcmp(name, \"RemoveProhibited\") == 0) {\n\t\terr = LOCKDOWN_E_REMOVE_PROHIBITED;\n\t} else if (strcmp(name, \"ImmutableValue\") == 0) {\n\t\terr = LOCKDOWN_E_IMMUTABLE_VALUE;\n\t} else if (strcmp(name, \"PasswordProtected\") == 0) {\n\t\terr = LOCKDOWN_E_PASSWORD_PROTECTED;\n\t} else if (strcmp(name, \"UserDeniedPairing\") == 0) {\n\t\terr = LOCKDOWN_E_USER_DENIED_PAIRING;\n\t} else if (strcmp(name, \"PairingDialogResponsePending\") == 0) {\n\t\terr = LOCKDOWN_E_PAIRING_DIALOG_RESPONSE_PENDING;\n\t} else if (strcmp(name, \"MissingHostID\") == 0) {\n\t\terr = LOCKDOWN_E_MISSING_HOST_ID;\n\t} else if (strcmp(name, \"InvalidHostID\") == 0) {\n\t\terr = LOCKDOWN_E_INVALID_HOST_ID;\n\t} else if (strcmp(name, \"SessionActive\") == 0) {\n\t\terr = LOCKDOWN_E_SESSION_ACTIVE;\n\t} else if (strcmp(name, \"SessionInactive\") == 0) {\n\t\terr = LOCKDOWN_E_SESSION_INACTIVE;\n\t} else if (strcmp(name, \"MissingSessionID\") == 0) {\n\t\terr = LOCKDOWN_E_MISSING_SESSION_ID;\n\t} else if (strcmp(name, \"InvalidSessionID\") == 0) {\n\t\terr = LOCKDOWN_E_INVALID_SESSION_ID;\n\t} else if (strcmp(name, \"MissingService\") == 0) {\n\t\terr = LOCKDOWN_E_MISSING_SERVICE;\n\t} else if (strcmp(name, \"InvalidService\") == 0) {\n\t\terr = LOCKDOWN_E_INVALID_SERVICE;\n\t} else if (strcmp(name, \"ServiceLimit\") == 0) {\n\t\terr = LOCKDOWN_E_SERVICE_LIMIT;\n\t} else if (strcmp(name, \"MissingPairRecord\") == 0) {\n\t\terr = LOCKDOWN_E_MISSING_PAIR_RECORD;\n\t} else if (strcmp(name, \"SavePairRecordFailed\") == 0) {\n\t\terr = LOCKDOWN_E_SAVE_PAIR_RECORD_FAILED;\n\t} else if (strcmp(name, \"InvalidPairRecord\") == 0) {\n\t\terr = LOCKDOWN_E_INVALID_PAIR_RECORD;\n\t} else if (strcmp(name, \"InvalidActivationRecord\") == 0) {\n\t\terr = LOCKDOWN_E_INVALID_ACTIVATION_RECORD;\n\t} else if (strcmp(name, \"MissingActivationRecord\") == 0) {\n\t\terr = LOCKDOWN_E_MISSING_ACTIVATION_RECORD;\n\t} else if (strcmp(name, \"ServiceProhibited\") == 0) {\n\t\terr = LOCKDOWN_E_SERVICE_PROHIBITED;\n\t} else if (strcmp(name, \"EscrowLocked\") == 0) {\n\t\terr = LOCKDOWN_E_ESCROW_LOCKED;\n\t} else if (strcmp(name, \"PairingProhibitedOverThisConnection\") == 0) {\n\t\terr = LOCKDOWN_E_PAIRING_PROHIBITED_OVER_THIS_CONNECTION;\n\t} else if (strcmp(name, \"FMiPProtected\") == 0) {\n\t\terr = LOCKDOWN_E_FMIP_PROTECTED;\n\t} else if (strcmp(name, \"MCProtected\") == 0) {\n\t\terr = LOCKDOWN_E_MC_PROTECTED;\n\t} else if (strcmp(name, \"MCChallengeRequired\") == 0) {\n\t\terr = LOCKDOWN_E_MC_CHALLENGE_REQUIRED;\n\t}\n\n\treturn err;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic lockdownd_error_t lockdownd_strtoerr(const char* name)\n{\n\tlockdownd_error_t err = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tif (strcmp(name, \"InvalidResponse\") == 0) {\n\t\terr = LOCKDOWN_E_INVALID_RESPONSE;\n\t} else if (strcmp(name, \"MissingKey\") == 0) {\n\t\terr = LOCKDOWN_E_MISSING_KEY;\n\t} else if (strcmp(name, \"MissingValue\") == 0) {\n\t\terr = LOCKDOWN_E_MISSING_VALUE;\n\t} else if (strcmp(name, \"GetProhibited\") == 0) {\n\t\terr = LOCKDOWN_E_GET_PROHIBITED;\n\t} else if (strcmp(name, \"SetProhibited\") == 0) {\n\t\terr = LOCKDOWN_E_SET_PROHIBITED;\n\t} else if (strcmp(name, \"RemoveProhibited\") == 0) {\n\t\terr = LOCKDOWN_E_REMOVE_PROHIBITED;\n\t} else if (strcmp(name, \"ImmutableValue\") == 0) {\n\t\terr = LOCKDOWN_E_IMMUTABLE_VALUE;\n\t} else if (strcmp(name, \"PasswordProtected\") == 0) {\n\t\terr = LOCKDOWN_E_PASSWORD_PROTECTED;\n\t} else if (strcmp(name, \"UserDeniedPairing\") == 0) {\n\t\terr = LOCKDOWN_E_USER_DENIED_PAIRING;\n\t} else if (strcmp(name, \"PairingDialogResponsePending\") == 0) {\n\t\terr = LOCKDOWN_E_PAIRING_DIALOG_RESPONSE_PENDING;\n\t} else if (strcmp(name, \"MissingHostID\") == 0) {\n\t\terr = LOCKDOWN_E_MISSING_HOST_ID;\n\t} else if (strcmp(name, \"InvalidHostID\") == 0) {\n\t\terr = LOCKDOWN_E_INVALID_HOST_ID;\n\t} else if (strcmp(name, \"SessionActive\") == 0) {\n\t\terr = LOCKDOWN_E_SESSION_ACTIVE;\n\t} else if (strcmp(name, \"SessionInactive\") == 0) {\n\t\terr = LOCKDOWN_E_SESSION_INACTIVE;\n\t} else if (strcmp(name, \"MissingSessionID\") == 0) {\n\t\terr = LOCKDOWN_E_MISSING_SESSION_ID;\n\t} else if (strcmp(name, \"InvalidSessionID\") == 0) {\n\t\terr = LOCKDOWN_E_INVALID_SESSION_ID;\n\t} else if (strcmp(name, \"MissingService\") == 0) {\n\t\terr = LOCKDOWN_E_MISSING_SERVICE;\n\t} else if (strcmp(name, \"InvalidService\") == 0) {\n\t\terr = LOCKDOWN_E_INVALID_SERVICE;\n\t} else if (strcmp(name, \"ServiceLimit\") == 0) {\n\t\terr = LOCKDOWN_E_SERVICE_LIMIT;\n\t} else if (strcmp(name, \"MissingPairRecord\") == 0) {\n\t\terr = LOCKDOWN_E_MISSING_PAIR_RECORD;\n\t} else if (strcmp(name, \"SavePairRecordFailed\") == 0) {\n\t\terr = LOCKDOWN_E_SAVE_PAIR_RECORD_FAILED;\n\t} else if (strcmp(name, \"InvalidPairRecord\") == 0) {\n\t\terr = LOCKDOWN_E_INVALID_PAIR_RECORD;\n\t} else if (strcmp(name, \"InvalidActivationRecord\") == 0) {\n\t\terr = LOCKDOWN_E_INVALID_ACTIVATION_RECORD;\n\t} else if (strcmp(name, \"MissingActivationRecord\") == 0) {\n\t\terr = LOCKDOWN_E_MISSING_ACTIVATION_RECORD;\n\t} else if (strcmp(name, \"ServiceProhibited\") == 0) {\n\t\terr = LOCKDOWN_E_SERVICE_PROHIBITED;\n\t} else if (strcmp(name, \"EscrowLocked\") == 0) {\n\t\terr = LOCKDOWN_E_ESCROW_LOCKED;\n\t} else if (strcmp(name, \"PairingProhibitedOverThisConnection\") == 0) {\n\t\terr = LOCKDOWN_E_PAIRING_PROHIBITED_OVER_THIS_CONNECTION;\n\t} else if (strcmp(name, \"FMiPProtected\") == 0) {\n\t\terr = LOCKDOWN_E_FMIP_PROTECTED;\n\t} else if (strcmp(name, \"MCProtected\") == 0) {\n\t\terr = LOCKDOWN_E_MC_PROTECTED;\n\t} else if (strcmp(name, \"MCChallengeRequired\") == 0) {\n\t\terr = LOCKDOWN_E_MC_CHALLENGE_REQUIRED;\n\t}\n\n\treturn err;\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_get_string_val",
          "args": [
            "error_node",
            "&value"
          ],
          "line": 996
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_get_item",
          "args": [
            "dict",
            "\"Error\""
          ],
          "line": 993
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"%s failure\"",
            "verb"
          ],
          "line": 990
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"external pairing mode\""
          ],
          "line": 987
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "userpref_save_pair_record",
          "args": [
            "client->udid",
            "pair_record_plist"
          ],
          "line": 983
        },
        "resolved": true,
        "details": {
          "function_name": "userpref_save_pair_record",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/common/userpref.c",
          "lines": "310-322",
          "snippet": "userpref_error_t userpref_save_pair_record(const char *udid, plist_t pair_record)\n{\n\tchar* record_data = NULL;\n\tuint32_t record_size = 0;\n\n\tplist_to_bin(pair_record, &record_data, &record_size);\n\n\tint res = usbmuxd_save_pair_record(udid, record_data, record_size);\n\n\tfree(record_data);\n\n\treturn res == 0 ? USERPREF_E_SUCCESS: USERPREF_E_UNKNOWN_ERROR;\n}",
          "includes": [
            "#include \"utils.h\"",
            "#include \"debug.h\"",
            "#include \"userpref.h\"",
            "#include <shlobj.h>",
            "#include <errno.h>",
            "#include <sys/stat.h>",
            "#include <libgen.h>",
            "#include <dirent.h>",
            "#include <libtasn1.h>",
            "#include <gcrypt.h>",
            "#include <gnutls/x509.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/gnutls.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/rsa.h>",
            "#include <openssl/pem.h>",
            "#include <usbmuxd.h>",
            "#include <unistd.h>",
            "#include <pwd.h>",
            "#include <sys/types.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"utils.h\"\n#include \"debug.h\"\n#include \"userpref.h\"\n#include <shlobj.h>\n#include <errno.h>\n#include <sys/stat.h>\n#include <libgen.h>\n#include <dirent.h>\n#include <libtasn1.h>\n#include <gcrypt.h>\n#include <gnutls/x509.h>\n#include <gnutls/crypto.h>\n#include <gnutls/gnutls.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/rsa.h>\n#include <openssl/pem.h>\n#include <usbmuxd.h>\n#include <unistd.h>\n#include <pwd.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nuserpref_error_t userpref_save_pair_record(const char *udid, plist_t pair_record)\n{\n\tchar* record_data = NULL;\n\tuint32_t record_size = 0;\n\n\tplist_to_bin(pair_record, &record_data, &record_size);\n\n\tint res = usbmuxd_save_pair_record(udid, record_data, record_size);\n\n\tfree(record_data);\n\n\treturn res == 0 ? USERPREF_E_SUCCESS: USERPREF_E_UNKNOWN_ERROR;\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "wifi_node"
          ],
          "line": 979
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "pair_record_plist",
            "USERPREF_WIFI_MAC_ADDRESS_KEY",
            "plist_copy(wifi_node)"
          ],
          "line": 978
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_copy",
          "args": [
            "wifi_node"
          ],
          "line": 978
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"Saving WiFiAddress from device in pair record\""
          ],
          "line": 977
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "pair_record_plist",
            "USERPREF_ESCROW_BAG_KEY",
            "plist_copy(extra_node)"
          ],
          "line": 972
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_copy",
          "args": [
            "extra_node"
          ],
          "line": 972
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"Saving EscrowBag from response in pair record\""
          ],
          "line": 971
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_get_node_type",
          "args": [
            "extra_node"
          ],
          "line": 970
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_get_item",
          "args": [
            "dict",
            "USERPREF_ESCROW_BAG_KEY"
          ],
          "line": 969
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "\"Pair\"",
            "verb"
          ],
          "line": 967
        },
        "resolved": true,
        "details": {
          "function_name": "plist_strcmp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/tools/idevicebackup.c",
          "lines": "296-309",
          "snippet": "static int plist_strcmp(plist_t node, const char *str)\n{\n\tchar *buffer = NULL;\n\tint ret = 0;\n\n\tif (plist_get_node_type(node) != PLIST_STRING)\n\t\treturn ret;\n\n\tplist_get_string_val(node, &buffer);\n\tret = strcmp(buffer, str);\n\tfree(buffer);\n\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"common/utils.h\"",
            "#include <libimobiledevice/afc.h>",
            "#include <libimobiledevice/notification_proxy.h>",
            "#include <libimobiledevice/mobilebackup.h>",
            "#include <libimobiledevice/lockdown.h>",
            "#include <libimobiledevice/libimobiledevice.h>",
            "#include <time.h>",
            "#include <ctype.h>",
            "#include <unistd.h>",
            "#include <gcrypt.h>",
            "#include <openssl/sha.h>",
            "#include <signal.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"common/utils.h\"\n#include <libimobiledevice/afc.h>\n#include <libimobiledevice/notification_proxy.h>\n#include <libimobiledevice/mobilebackup.h>\n#include <libimobiledevice/lockdown.h>\n#include <libimobiledevice/libimobiledevice.h>\n#include <time.h>\n#include <ctype.h>\n#include <unistd.h>\n#include <gcrypt.h>\n#include <openssl/sha.h>\n#include <signal.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int plist_strcmp(plist_t node, const char *str)\n{\n\tchar *buffer = NULL;\n\tint ret = 0;\n\n\tif (plist_get_node_type(node) != PLIST_STRING)\n\t\treturn ret;\n\n\tplist_get_string_val(node, &buffer);\n\tret = strcmp(buffer, str);\n\tfree(buffer);\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "userpref_delete_pair_record",
          "args": [
            "client->udid"
          ],
          "line": 965
        },
        "resolved": true,
        "details": {
          "function_name": "userpref_delete_pair_record",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/common/userpref.c",
          "lines": "366-371",
          "snippet": "userpref_error_t userpref_delete_pair_record(const char *udid)\n{\n\tint res = usbmuxd_delete_pair_record(udid);\n\n\treturn res == 0 ? USERPREF_E_SUCCESS: USERPREF_E_UNKNOWN_ERROR;\n}",
          "includes": [
            "#include \"utils.h\"",
            "#include \"debug.h\"",
            "#include \"userpref.h\"",
            "#include <shlobj.h>",
            "#include <errno.h>",
            "#include <sys/stat.h>",
            "#include <libgen.h>",
            "#include <dirent.h>",
            "#include <libtasn1.h>",
            "#include <gcrypt.h>",
            "#include <gnutls/x509.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/gnutls.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/rsa.h>",
            "#include <openssl/pem.h>",
            "#include <usbmuxd.h>",
            "#include <unistd.h>",
            "#include <pwd.h>",
            "#include <sys/types.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"utils.h\"\n#include \"debug.h\"\n#include \"userpref.h\"\n#include <shlobj.h>\n#include <errno.h>\n#include <sys/stat.h>\n#include <libgen.h>\n#include <dirent.h>\n#include <libtasn1.h>\n#include <gcrypt.h>\n#include <gnutls/x509.h>\n#include <gnutls/crypto.h>\n#include <gnutls/gnutls.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/rsa.h>\n#include <openssl/pem.h>\n#include <usbmuxd.h>\n#include <unistd.h>\n#include <pwd.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nuserpref_error_t userpref_delete_pair_record(const char *udid)\n{\n\tint res = usbmuxd_delete_pair_record(udid);\n\n\treturn res == 0 ? USERPREF_E_SUCCESS: USERPREF_E_UNKNOWN_ERROR;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"internal pairing mode\""
          ],
          "line": 962
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"%s success\"",
            "verb"
          ],
          "line": 960
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lockdown_check_result",
          "args": [
            "dict",
            "verb"
          ],
          "line": 953
        },
        "resolved": true,
        "details": {
          "function_name": "lockdown_check_result",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "150-223",
          "snippet": "static lockdownd_error_t lockdown_check_result(plist_t dict, const char *query_match)\n{\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tplist_t query_node = plist_dict_get_item(dict, \"Request\");\n\tif (!query_node) {\n\t\treturn ret;\n\t}\n\n\tif (plist_get_node_type(query_node) != PLIST_STRING) {\n\t\treturn ret;\n\t} else {\n\t\tchar *query_value = NULL;\n\n\t\tplist_get_string_val(query_node, &query_value);\n\t\tif (!query_value) {\n\t\t\treturn ret;\n\t\t}\n\n\t\tif (query_match && (strcmp(query_value, query_match) != 0)) {\n\t\t\tfree(query_value);\n\t\t\treturn ret;\n\t\t}\n\n\t\tfree(query_value);\n\t}\n\n\tplist_t result_node = plist_dict_get_item(dict, \"Result\");\n\tif (!result_node) {\n\t\t/* iOS 5: the 'Result' key is not present anymore.\n\t\t   But we need to check for the 'Error' key. */\n\t\tplist_t err_node = plist_dict_get_item(dict, \"Error\");\n\t\tif (err_node) {\n\t\t\tif (plist_get_node_type(err_node) == PLIST_STRING) {\n\t\t\t\tchar *err_value = NULL;\n\n\t\t\t\tplist_get_string_val(err_node, &err_value);\n\t\t\t\tif (err_value) {\n\t\t\t\t\tdebug_info(\"ERROR: %s\", err_value);\n\t\t\t\t\tret = lockdownd_strtoerr(err_value);\n\t\t\t\t\tfree(err_value);\n\t\t\t\t} else {\n\t\t\t\t\tdebug_info(\"ERROR: unknown error occured\");\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn ret;\n\t\t}\n\n\t\tret = LOCKDOWN_E_SUCCESS;\n\n\t\treturn ret;\n\t}\n\n\tplist_type result_type = plist_get_node_type(result_node);\n\tif (result_type == PLIST_STRING) {\n\t\tchar *result_value = NULL;\n\n\t\tplist_get_string_val(result_node, &result_value);\n\t\tif (result_value) {\n\t\t\tif (!strcmp(result_value, \"Success\")) {\n\t\t\t\tret = LOCKDOWN_E_SUCCESS;\n\t\t\t} else if (!strcmp(result_value, \"Failure\")) {\n\t\t\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t\t\t} else {\n\t\t\t\tdebug_info(\"ERROR: unknown result value '%s'\", result_value);\n\t\t\t}\n\t\t}\n\n\t\tif (result_value)\n\t\t\tfree(result_value);\n\t}\n\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic lockdownd_error_t lockdown_check_result(plist_t dict, const char *query_match)\n{\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tplist_t query_node = plist_dict_get_item(dict, \"Request\");\n\tif (!query_node) {\n\t\treturn ret;\n\t}\n\n\tif (plist_get_node_type(query_node) != PLIST_STRING) {\n\t\treturn ret;\n\t} else {\n\t\tchar *query_value = NULL;\n\n\t\tplist_get_string_val(query_node, &query_value);\n\t\tif (!query_value) {\n\t\t\treturn ret;\n\t\t}\n\n\t\tif (query_match && (strcmp(query_value, query_match) != 0)) {\n\t\t\tfree(query_value);\n\t\t\treturn ret;\n\t\t}\n\n\t\tfree(query_value);\n\t}\n\n\tplist_t result_node = plist_dict_get_item(dict, \"Result\");\n\tif (!result_node) {\n\t\t/* iOS 5: the 'Result' key is not present anymore.\n\t\t   But we need to check for the 'Error' key. */\n\t\tplist_t err_node = plist_dict_get_item(dict, \"Error\");\n\t\tif (err_node) {\n\t\t\tif (plist_get_node_type(err_node) == PLIST_STRING) {\n\t\t\t\tchar *err_value = NULL;\n\n\t\t\t\tplist_get_string_val(err_node, &err_value);\n\t\t\t\tif (err_value) {\n\t\t\t\t\tdebug_info(\"ERROR: %s\", err_value);\n\t\t\t\t\tret = lockdownd_strtoerr(err_value);\n\t\t\t\t\tfree(err_value);\n\t\t\t\t} else {\n\t\t\t\t\tdebug_info(\"ERROR: unknown error occured\");\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn ret;\n\t\t}\n\n\t\tret = LOCKDOWN_E_SUCCESS;\n\n\t\treturn ret;\n\t}\n\n\tplist_type result_type = plist_get_node_type(result_node);\n\tif (result_type == PLIST_STRING) {\n\t\tchar *result_value = NULL;\n\n\t\tplist_get_string_val(result_node, &result_value);\n\t\tif (result_value) {\n\t\t\tif (!strcmp(result_value, \"Success\")) {\n\t\t\t\tret = LOCKDOWN_E_SUCCESS;\n\t\t\t} else if (!strcmp(result_value, \"Failure\")) {\n\t\t\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t\t\t} else {\n\t\t\t\tdebug_info(\"ERROR: unknown result value '%s'\", result_value);\n\t\t\t}\n\t\t}\n\n\t\tif (result_value)\n\t\t\tfree(result_value);\n\t}\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "wifi_node"
          ],
          "line": 942
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "pair_record_plist"
          ],
          "line": 940
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lockdownd_receive",
          "args": [
            "client",
            "&dict"
          ],
          "line": 937
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_receive",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "348-364",
          "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_receive(lockdownd_client_t client, plist_t *plist)\n{\n\tif (!client || !plist || (plist && *plist))\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\tlockdownd_error_t ret = LOCKDOWN_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_receive_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t}\n\n\tif (!*plist)\n\t\tret = LOCKDOWN_E_PLIST_ERROR;\n\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_receive(lockdownd_client_t client, plist_t *plist)\n{\n\tif (!client || !plist || (plist && *plist))\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\tlockdownd_error_t ret = LOCKDOWN_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_receive_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t}\n\n\tif (!*plist)\n\t\tret = LOCKDOWN_E_PLIST_ERROR;\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "wifi_node"
          ],
          "line": 932
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "pair_record_plist"
          ],
          "line": 930
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "dict"
          ],
          "line": 926
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lockdownd_send",
          "args": [
            "client",
            "dict"
          ],
          "line": 925
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_send",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "366-379",
          "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_send(lockdownd_client_t client, plist_t plist)\n{\n\tif (!client || !plist)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_send_xml_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t}\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_send(lockdownd_client_t client, plist_t plist)\n{\n\tif (!client || !plist)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_send_xml_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t}\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"PairingOptions\"",
            "plist_copy(options)"
          ],
          "line": 921
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_copy",
          "args": [
            "options"
          ],
          "line": 921
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"ProtocolVersion\"",
            "plist_new_string(LOCKDOWN_PROTOCOL_VERSION)"
          ],
          "line": 918
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "LOCKDOWN_PROTOCOL_VERSION"
          ],
          "line": 918
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"Request\"",
            "plist_new_string(verb)"
          ],
          "line": 917
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "verb"
          ],
          "line": 917
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"PairRecord\"",
            "request_pair_record"
          ],
          "line": 916
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_add_label",
          "args": [
            "dict",
            "client->label"
          ],
          "line": 915
        },
        "resolved": true,
        "details": {
          "function_name": "plist_dict_add_label",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "232-238",
          "snippet": "static void plist_dict_add_label(plist_t plist, const char *label)\n{\n\tif (plist && label) {\n\t\tif (plist_get_node_type(plist) == PLIST_DICT)\n\t\t\tplist_dict_set_item(plist, \"Label\", plist_new_string(label));\n\t}\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic void plist_dict_add_label(plist_t plist, const char *label)\n{\n\tif (plist && label) {\n\t\tif (plist_get_node_type(plist) == PLIST_DICT)\n\t\t\tplist_dict_set_item(plist, \"Label\", plist_new_string(label));\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_new_dict",
          "args": [],
          "line": 914
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_remove_item",
          "args": [
            "request_pair_record",
            "USERPREF_HOST_PRIVATE_KEY_KEY"
          ],
          "line": 911
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_remove_item",
          "args": [
            "request_pair_record",
            "USERPREF_ROOT_PRIVATE_KEY_KEY"
          ],
          "line": 910
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_copy",
          "args": [
            "pair_record_plist"
          ],
          "line": 907
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "userpref_read_pair_record",
          "args": [
            "client->udid",
            "&pair_record_plist"
          ],
          "line": 897
        },
        "resolved": true,
        "details": {
          "function_name": "userpref_read_pair_record",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/common/userpref.c",
          "lines": "333-357",
          "snippet": "userpref_error_t userpref_read_pair_record(const char *udid, plist_t *pair_record)\n{\n\tchar* record_data = NULL;\n\tuint32_t record_size = 0;\n\n\tint res = usbmuxd_read_pair_record(udid, &record_data, &record_size);\n\n\tif (res < 0) {\n\t\tif (record_data)\n\t\t\tfree(record_data);\n\n\t\treturn USERPREF_E_INVALID_CONF;\n\t}\n\n\t*pair_record = NULL;\n\tif (memcmp(record_data, \"bplist00\", 8) == 0) {\n\t\tplist_from_bin(record_data, record_size, pair_record);\n\t} else {\n\t\tplist_from_xml(record_data, record_size, pair_record);\n\t}\n\n\tfree(record_data);\n\n\treturn res == 0 ? USERPREF_E_SUCCESS: USERPREF_E_UNKNOWN_ERROR;\n}",
          "includes": [
            "#include \"utils.h\"",
            "#include \"debug.h\"",
            "#include \"userpref.h\"",
            "#include <shlobj.h>",
            "#include <errno.h>",
            "#include <sys/stat.h>",
            "#include <libgen.h>",
            "#include <dirent.h>",
            "#include <libtasn1.h>",
            "#include <gcrypt.h>",
            "#include <gnutls/x509.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/gnutls.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/rsa.h>",
            "#include <openssl/pem.h>",
            "#include <usbmuxd.h>",
            "#include <unistd.h>",
            "#include <pwd.h>",
            "#include <sys/types.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"utils.h\"\n#include \"debug.h\"\n#include \"userpref.h\"\n#include <shlobj.h>\n#include <errno.h>\n#include <sys/stat.h>\n#include <libgen.h>\n#include <dirent.h>\n#include <libtasn1.h>\n#include <gcrypt.h>\n#include <gnutls/x509.h>\n#include <gnutls/crypto.h>\n#include <gnutls/gnutls.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/rsa.h>\n#include <openssl/pem.h>\n#include <usbmuxd.h>\n#include <unistd.h>\n#include <pwd.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nuserpref_error_t userpref_read_pair_record(const char *udid, plist_t *pair_record)\n{\n\tchar* record_data = NULL;\n\tuint32_t record_size = 0;\n\n\tint res = usbmuxd_read_pair_record(udid, &record_data, &record_size);\n\n\tif (res < 0) {\n\t\tif (record_data)\n\t\t\tfree(record_data);\n\n\t\treturn USERPREF_E_INVALID_CONF;\n\t}\n\n\t*pair_record = NULL;\n\tif (memcmp(record_data, \"bplist00\", 8) == 0) {\n\t\tplist_from_bin(record_data, record_size, pair_record);\n\t} else {\n\t\tplist_from_xml(record_data, record_size, pair_record);\n\t}\n\n\tfree(record_data);\n\n\treturn res == 0 ? USERPREF_E_SUCCESS: USERPREF_E_UNKNOWN_ERROR;\n}"
        }
      },
      {
        "call_info": {
          "callee": "userpref_has_pair_record",
          "args": [
            "client->udid"
          ],
          "line": 896
        },
        "resolved": true,
        "details": {
          "function_name": "userpref_has_pair_record",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/common/userpref.c",
          "lines": "202-221",
          "snippet": "int userpref_has_pair_record(const char *udid)\n{\n\tint ret = 0;\n\tconst char *config_path = NULL;\n\tchar *config_file = NULL;\n\tstruct stat st;\n\n\tif (!udid) return 0;\n\n\t/* first get config file */\n\tconfig_path = userpref_get_config_dir();\n\tconfig_file = string_concat(config_path, DIR_SEP_S, udid, USERPREF_CONFIG_EXTENSION, NULL);\n\n\tif ((stat(config_file, &st) == 0) && S_ISREG(st.st_mode))\n\t\tret = 1;\n\n\tfree(config_file);\n\n\treturn ret;\n}",
          "includes": [
            "#include \"utils.h\"",
            "#include \"debug.h\"",
            "#include \"userpref.h\"",
            "#include <shlobj.h>",
            "#include <errno.h>",
            "#include <sys/stat.h>",
            "#include <libgen.h>",
            "#include <dirent.h>",
            "#include <libtasn1.h>",
            "#include <gcrypt.h>",
            "#include <gnutls/x509.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/gnutls.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/rsa.h>",
            "#include <openssl/pem.h>",
            "#include <usbmuxd.h>",
            "#include <unistd.h>",
            "#include <pwd.h>",
            "#include <sys/types.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define USERPREF_CONFIG_EXTENSION \".plist\"",
            "#define DIR_SEP_S \"/\"",
            "#define DIR_SEP_S \"\\\\\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"utils.h\"\n#include \"debug.h\"\n#include \"userpref.h\"\n#include <shlobj.h>\n#include <errno.h>\n#include <sys/stat.h>\n#include <libgen.h>\n#include <dirent.h>\n#include <libtasn1.h>\n#include <gcrypt.h>\n#include <gnutls/x509.h>\n#include <gnutls/crypto.h>\n#include <gnutls/gnutls.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/rsa.h>\n#include <openssl/pem.h>\n#include <usbmuxd.h>\n#include <unistd.h>\n#include <pwd.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\n#define USERPREF_CONFIG_EXTENSION \".plist\"\n#define DIR_SEP_S \"/\"\n#define DIR_SEP_S \"\\\\\"\n\nint userpref_has_pair_record(const char *udid)\n{\n\tint ret = 0;\n\tconst char *config_path = NULL;\n\tchar *config_file = NULL;\n\tstruct stat st;\n\n\tif (!udid) return 0;\n\n\t/* first get config file */\n\tconfig_path = userpref_get_config_dir();\n\tconfig_file = string_concat(config_path, DIR_SEP_S, udid, USERPREF_CONFIG_EXTENSION, NULL);\n\n\tif ((stat(config_file, &st) == 0) && S_ISREG(st.st_mode))\n\t\tret = 1;\n\n\tfree(config_file);\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lockdownd_get_value",
          "args": [
            "client",
            "NULL",
            "\"WiFiAddress\"",
            "&wifi_node"
          ],
          "line": 893
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_get_value",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "426-478",
          "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_get_value(lockdownd_client_t client, const char *domain, const char *key, plist_t *value)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tplist_t dict = NULL;\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\t/* setup request plist */\n\tdict = plist_new_dict();\n\tplist_dict_add_label(dict, client->label);\n\tif (domain) {\n\t\tplist_dict_set_item(dict,\"Domain\", plist_new_string(domain));\n\t}\n\tif (key) {\n\t\tplist_dict_set_item(dict,\"Key\", plist_new_string(key));\n\t}\n\tplist_dict_set_item(dict,\"Request\", plist_new_string(\"GetValue\"));\n\n\t/* send to device */\n\tret = lockdownd_send(client, dict);\n\n\tplist_free(dict);\n\tdict = NULL;\n\n\tif (ret != LOCKDOWN_E_SUCCESS)\n\t\treturn ret;\n\n\t/* Now get device's answer */\n\tret = lockdownd_receive(client, &dict);\n\tif (ret != LOCKDOWN_E_SUCCESS)\n\t\treturn ret;\n\n\tret = lockdown_check_result(dict, \"GetValue\");\n\tif (ret == LOCKDOWN_E_SUCCESS) {\n\t\tdebug_info(\"success\");\n\t}\n\n\tif (ret != LOCKDOWN_E_SUCCESS) {\n\t\tplist_free(dict);\n\t\treturn ret;\n\t}\n\n\tplist_t value_node = plist_dict_get_item(dict, \"Value\");\n\n\tif (value_node) {\n\t\tdebug_info(\"has a value\");\n\t\t*value = plist_copy(value_node);\n\t}\n\n\tplist_free(dict);\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_get_value(lockdownd_client_t client, const char *domain, const char *key, plist_t *value)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tplist_t dict = NULL;\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\t/* setup request plist */\n\tdict = plist_new_dict();\n\tplist_dict_add_label(dict, client->label);\n\tif (domain) {\n\t\tplist_dict_set_item(dict,\"Domain\", plist_new_string(domain));\n\t}\n\tif (key) {\n\t\tplist_dict_set_item(dict,\"Key\", plist_new_string(key));\n\t}\n\tplist_dict_set_item(dict,\"Request\", plist_new_string(\"GetValue\"));\n\n\t/* send to device */\n\tret = lockdownd_send(client, dict);\n\n\tplist_free(dict);\n\tdict = NULL;\n\n\tif (ret != LOCKDOWN_E_SUCCESS)\n\t\treturn ret;\n\n\t/* Now get device's answer */\n\tret = lockdownd_receive(client, &dict);\n\tif (ret != LOCKDOWN_E_SUCCESS)\n\t\treturn ret;\n\n\tret = lockdown_check_result(dict, \"GetValue\");\n\tif (ret == LOCKDOWN_E_SUCCESS) {\n\t\tdebug_info(\"success\");\n\t}\n\n\tif (ret != LOCKDOWN_E_SUCCESS) {\n\t\tplist_free(dict);\n\t\treturn ret;\n\t}\n\n\tplist_t value_node = plist_dict_get_item(dict, \"Value\");\n\n\tif (value_node) {\n\t\tdebug_info(\"has a value\");\n\t\t*value = plist_copy(value_node);\n\t}\n\n\tplist_free(dict);\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "pair_record_plist"
          ],
          "line": 888
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pair_record_generate",
          "args": [
            "client",
            "&pair_record_plist"
          ],
          "line": 884
        },
        "resolved": true,
        "details": {
          "function_name": "pair_record_generate",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "788-841",
          "snippet": "static lockdownd_error_t pair_record_generate(lockdownd_client_t client, plist_t *pair_record)\n{\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tkey_data_t public_key = { NULL, 0 };\n\tchar* host_id = NULL;\n\tchar* system_buid = NULL;\n\n\t/* retrieve device public key */\n\tret = lockdownd_get_device_public_key_as_key_data(client, &public_key);\n\tif (ret != LOCKDOWN_E_SUCCESS) {\n\t\tdebug_info(\"device refused to send public key.\");\n\t\tgoto leave;\n\t}\n\tdebug_info(\"device public key follows:\\n%.*s\", public_key.size, public_key.data);\n\n\t*pair_record = plist_new_dict();\n\n\t/* generate keys and certificates into pair record */\n\tuserpref_error_t uret = USERPREF_E_SUCCESS;\n\turet = pair_record_generate_keys_and_certs(*pair_record, public_key);\n\tswitch(uret) {\n\t\tcase USERPREF_E_INVALID_ARG:\n\t\t\tret = LOCKDOWN_E_INVALID_ARG;\n\t\t\tbreak;\n\t\tcase USERPREF_E_INVALID_CONF:\n\t\t\tret = LOCKDOWN_E_INVALID_CONF;\n\t\t\tbreak;\n\t\tcase USERPREF_E_SSL_ERROR:\n\t\t\tret = LOCKDOWN_E_SSL_ERROR;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\n\t/* set SystemBUID */\n\tuserpref_read_system_buid(&system_buid);\n\tif (system_buid) {\n\t\tplist_dict_set_item(*pair_record, USERPREF_SYSTEM_BUID_KEY, plist_new_string(system_buid));\n\t}\n\n\t/* set HostID */\n\thost_id = generate_uuid();\n\tpair_record_set_host_id(*pair_record, host_id);\n\nleave:\n\tif (host_id)\n\t\tfree(host_id);\n\tif (system_buid)\n\t\tfree(system_buid);\n\tif (public_key.data)\n\t\tfree(public_key.data);\n\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic lockdownd_error_t pair_record_generate(lockdownd_client_t client, plist_t *pair_record)\n{\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tkey_data_t public_key = { NULL, 0 };\n\tchar* host_id = NULL;\n\tchar* system_buid = NULL;\n\n\t/* retrieve device public key */\n\tret = lockdownd_get_device_public_key_as_key_data(client, &public_key);\n\tif (ret != LOCKDOWN_E_SUCCESS) {\n\t\tdebug_info(\"device refused to send public key.\");\n\t\tgoto leave;\n\t}\n\tdebug_info(\"device public key follows:\\n%.*s\", public_key.size, public_key.data);\n\n\t*pair_record = plist_new_dict();\n\n\t/* generate keys and certificates into pair record */\n\tuserpref_error_t uret = USERPREF_E_SUCCESS;\n\turet = pair_record_generate_keys_and_certs(*pair_record, public_key);\n\tswitch(uret) {\n\t\tcase USERPREF_E_INVALID_ARG:\n\t\t\tret = LOCKDOWN_E_INVALID_ARG;\n\t\t\tbreak;\n\t\tcase USERPREF_E_INVALID_CONF:\n\t\t\tret = LOCKDOWN_E_INVALID_CONF;\n\t\t\tbreak;\n\t\tcase USERPREF_E_SSL_ERROR:\n\t\t\tret = LOCKDOWN_E_SSL_ERROR;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\n\t/* set SystemBUID */\n\tuserpref_read_system_buid(&system_buid);\n\tif (system_buid) {\n\t\tplist_dict_set_item(*pair_record, USERPREF_SYSTEM_BUID_KEY, plist_new_string(system_buid));\n\t}\n\n\t/* set HostID */\n\thost_id = generate_uuid();\n\tpair_record_set_host_id(*pair_record, host_id);\n\nleave:\n\tif (host_id)\n\t\tfree(host_id);\n\tif (system_buid)\n\t\tfree(system_buid);\n\tif (public_key.data)\n\t\tfree(public_key.data);\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lockdownd_pair_record_to_plist",
          "args": [
            "pair_record"
          ],
          "line": 878
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_pair_record_to_plist",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "763-777",
          "snippet": "static plist_t lockdownd_pair_record_to_plist(lockdownd_pair_record_t pair_record)\n{\n\tif (!pair_record)\n\t\treturn NULL;\n\n\t/* setup request plist */\n\tplist_t dict = plist_new_dict();\n\tplist_dict_set_item(dict, \"DeviceCertificate\", plist_new_data(pair_record->device_certificate, strlen(pair_record->device_certificate)));\n\tplist_dict_set_item(dict, \"HostCertificate\", plist_new_data(pair_record->host_certificate, strlen(pair_record->host_certificate)));\n\tplist_dict_set_item(dict, \"HostID\", plist_new_string(pair_record->host_id));\n\tplist_dict_set_item(dict, \"RootCertificate\", plist_new_data(pair_record->root_certificate, strlen(pair_record->root_certificate)));\n\tplist_dict_set_item(dict, \"SystemBUID\", plist_new_string(pair_record->system_buid));\n\n\treturn dict;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic plist_t lockdownd_pair_record_to_plist(lockdownd_pair_record_t pair_record)\n{\n\tif (!pair_record)\n\t\treturn NULL;\n\n\t/* setup request plist */\n\tplist_t dict = plist_new_dict();\n\tplist_dict_set_item(dict, \"DeviceCertificate\", plist_new_data(pair_record->device_certificate, strlen(pair_record->device_certificate)));\n\tplist_dict_set_item(dict, \"HostCertificate\", plist_new_data(pair_record->host_certificate, strlen(pair_record->host_certificate)));\n\tplist_dict_set_item(dict, \"HostID\", plist_new_string(pair_record->host_id));\n\tplist_dict_set_item(dict, \"RootCertificate\", plist_new_data(pair_record->root_certificate, strlen(pair_record->root_certificate)));\n\tplist_dict_set_item(dict, \"SystemBUID\", plist_new_string(pair_record->system_buid));\n\n\treturn dict;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic lockdownd_error_t lockdownd_do_pair(lockdownd_client_t client, lockdownd_pair_record_t pair_record, const char *verb, plist_t options, plist_t *result)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\tplist_t dict = NULL;\n\tplist_t pair_record_plist = NULL;\n\tplist_t wifi_node = NULL;\n\tint pairing_mode = 0; /* 0 = libimobiledevice, 1 = external */\n\n\tif (pair_record && pair_record->system_buid && pair_record->host_id) {\n\t\t/* valid pair_record passed? */\n\t\tif (!pair_record->device_certificate || !pair_record->host_certificate || !pair_record->root_certificate) {\n\t\t\treturn LOCKDOWN_E_PLIST_ERROR;\n\t\t}\n\n\t\t/* use passed pair_record */\n\t\tpair_record_plist = lockdownd_pair_record_to_plist(pair_record);\n\n\t\tpairing_mode = 1;\n\t} else {\n\t\t/* generate a new pair record if pairing */\n\t\tif (!strcmp(\"Pair\", verb)) {\n\t\t\tret = pair_record_generate(client, &pair_record_plist);\n\n\t\t\tif (ret != LOCKDOWN_E_SUCCESS) {\n\t\t\t\tif (pair_record_plist)\n\t\t\t\t\tplist_free(pair_record_plist);\n\t\t\t\treturn ret;\n\t\t\t}\n\n\t\t\t/* get wifi mac now, if we get it later we fail on iOS 7 which causes a reconnect */\n\t\t\tlockdownd_get_value(client, NULL, \"WiFiAddress\", &wifi_node);\n\t\t} else {\n\t\t\t/* use existing pair record */\n\t\t\tif (userpref_has_pair_record(client->udid)) {\n\t\t\t\tuserpref_read_pair_record(client->udid, &pair_record_plist);\n\t\t\t\tif (!pair_record_plist) {\n\t\t\t\t\treturn LOCKDOWN_E_INVALID_CONF;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn LOCKDOWN_E_INVALID_HOST_ID;\n\t\t\t}\n\t\t}\n\t}\n\n\tplist_t request_pair_record = plist_copy(pair_record_plist);\n\n\t/* remove stuff that is private */\n\tplist_dict_remove_item(request_pair_record, USERPREF_ROOT_PRIVATE_KEY_KEY);\n\tplist_dict_remove_item(request_pair_record, USERPREF_HOST_PRIVATE_KEY_KEY);\n\n\t/* setup pair request plist */\n\tdict = plist_new_dict();\n\tplist_dict_add_label(dict, client->label);\n\tplist_dict_set_item(dict, \"PairRecord\", request_pair_record);\n\tplist_dict_set_item(dict, \"Request\", plist_new_string(verb));\n\tplist_dict_set_item(dict, \"ProtocolVersion\", plist_new_string(LOCKDOWN_PROTOCOL_VERSION));\n\n\tif (options) {\n\t\tplist_dict_set_item(dict, \"PairingOptions\", plist_copy(options));\n\t}\n\n\t/* send to device */\n\tret = lockdownd_send(client, dict);\n\tplist_free(dict);\n\tdict = NULL;\n\n\tif (ret != LOCKDOWN_E_SUCCESS) {\n\t\tplist_free(pair_record_plist);\n\t\tif (wifi_node)\n\t\t\tplist_free(wifi_node);\n\t\treturn ret;\n\t}\n\n\t/* Now get device's answer */\n\tret = lockdownd_receive(client, &dict);\n\n\tif (ret != LOCKDOWN_E_SUCCESS) {\n\t\tplist_free(pair_record_plist);\n\t\tif (wifi_node)\n\t\t\tplist_free(wifi_node);\n\t\treturn ret;\n\t}\n\n\tif (strcmp(verb, \"Unpair\") == 0) {\n\t\t/* workaround for Unpair giving back ValidatePair,\n\t\t * seems to be a bug in the device's fw */\n\t\tif (lockdown_check_result(dict, NULL) != LOCKDOWN_E_SUCCESS) {\n\t\t\tret = LOCKDOWN_E_PAIRING_FAILED;\n\t\t}\n\t} else {\n\t\tif (lockdown_check_result(dict, verb) != LOCKDOWN_E_SUCCESS) {\n\t\t\tret = LOCKDOWN_E_PAIRING_FAILED;\n\t\t}\n\t}\n\n\t/* if pairing succeeded */\n\tif (ret == LOCKDOWN_E_SUCCESS) {\n\t\tdebug_info(\"%s success\", verb);\n\t\tif (!pairing_mode) {\n\t\t\tdebug_info(\"internal pairing mode\");\n\t\t\tif (!strcmp(\"Unpair\", verb)) {\n\t\t\t\t/* remove public key from config */\n\t\t\t\tuserpref_delete_pair_record(client->udid);\n\t\t\t} else {\n\t\t\t\tif (!strcmp(\"Pair\", verb)) {\n\t\t\t\t\t/* add returned escrow bag if available */\n\t\t\t\t\tplist_t extra_node = plist_dict_get_item(dict, USERPREF_ESCROW_BAG_KEY);\n\t\t\t\t\tif (extra_node && plist_get_node_type(extra_node) == PLIST_DATA) {\n\t\t\t\t\t\tdebug_info(\"Saving EscrowBag from response in pair record\");\n\t\t\t\t\t\tplist_dict_set_item(pair_record_plist, USERPREF_ESCROW_BAG_KEY, plist_copy(extra_node));\n\t\t\t\t\t}\n\n\t\t\t\t\t/* save previously retrieved wifi mac address in pair record */\n\t\t\t\t\tif (wifi_node) {\n\t\t\t\t\t\tdebug_info(\"Saving WiFiAddress from device in pair record\");\n\t\t\t\t\t\tplist_dict_set_item(pair_record_plist, USERPREF_WIFI_MAC_ADDRESS_KEY, plist_copy(wifi_node));\n\t\t\t\t\t\tplist_free(wifi_node);\n\t\t\t\t\t\twifi_node = NULL;\n\t\t\t\t\t}\n\n\t\t\t\t\tuserpref_save_pair_record(client->udid, pair_record_plist);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tdebug_info(\"external pairing mode\");\n\t\t}\n\t} else {\n\t\tdebug_info(\"%s failure\", verb);\n\t\tplist_t error_node = NULL;\n\t\t/* verify error condition */\n\t\terror_node = plist_dict_get_item(dict, \"Error\");\n\t\tif (error_node) {\n\t\t\tchar *value = NULL;\n\t\t\tplist_get_string_val(error_node, &value);\n\t\t\tif (value) {\n\t\t\t\t/* the first pairing fails if the device is password protected */\n\t\t\t\tret = lockdownd_strtoerr(value);\n\t\t\t\tfree(value);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (pair_record_plist) {\n\t\tplist_free(pair_record_plist);\n\t\tpair_record_plist = NULL;\n\t}\n\n\tif (wifi_node) {\n\t\tplist_free(wifi_node);\n\t\twifi_node = NULL;\n\t}\n\n\tif (result) {\n\t\t*result = dict;\n\t} else {\n\t\tplist_free(dict);\n\t\tdict = NULL;\n\t}\n\n\treturn ret;\n}"
  },
  {
    "function_name": "pair_record_generate",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
    "lines": "788-841",
    "snippet": "static lockdownd_error_t pair_record_generate(lockdownd_client_t client, plist_t *pair_record)\n{\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tkey_data_t public_key = { NULL, 0 };\n\tchar* host_id = NULL;\n\tchar* system_buid = NULL;\n\n\t/* retrieve device public key */\n\tret = lockdownd_get_device_public_key_as_key_data(client, &public_key);\n\tif (ret != LOCKDOWN_E_SUCCESS) {\n\t\tdebug_info(\"device refused to send public key.\");\n\t\tgoto leave;\n\t}\n\tdebug_info(\"device public key follows:\\n%.*s\", public_key.size, public_key.data);\n\n\t*pair_record = plist_new_dict();\n\n\t/* generate keys and certificates into pair record */\n\tuserpref_error_t uret = USERPREF_E_SUCCESS;\n\turet = pair_record_generate_keys_and_certs(*pair_record, public_key);\n\tswitch(uret) {\n\t\tcase USERPREF_E_INVALID_ARG:\n\t\t\tret = LOCKDOWN_E_INVALID_ARG;\n\t\t\tbreak;\n\t\tcase USERPREF_E_INVALID_CONF:\n\t\t\tret = LOCKDOWN_E_INVALID_CONF;\n\t\t\tbreak;\n\t\tcase USERPREF_E_SSL_ERROR:\n\t\t\tret = LOCKDOWN_E_SSL_ERROR;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\n\t/* set SystemBUID */\n\tuserpref_read_system_buid(&system_buid);\n\tif (system_buid) {\n\t\tplist_dict_set_item(*pair_record, USERPREF_SYSTEM_BUID_KEY, plist_new_string(system_buid));\n\t}\n\n\t/* set HostID */\n\thost_id = generate_uuid();\n\tpair_record_set_host_id(*pair_record, host_id);\n\nleave:\n\tif (host_id)\n\t\tfree(host_id);\n\tif (system_buid)\n\t\tfree(system_buid);\n\tif (public_key.data)\n\t\tfree(public_key.data);\n\n\treturn ret;\n}",
    "includes": [
      "#include <windows.h>",
      "#include \"asprintf.h\"",
      "#include \"common/utils.h\"",
      "#include \"common/userpref.h\"",
      "#include \"common/debug.h\"",
      "#include \"idevice.h\"",
      "#include \"lockdown.h\"",
      "#include \"property_list_service.h\"",
      "#include <plist/plist.h>",
      "#include <gnutls/crypto.h>",
      "#include <gnutls/x509.h>",
      "#include <libtasn1.h>",
      "#include <openssl/x509v3.h>",
      "#include <openssl/x509.h>",
      "#include <openssl/pem.h>",
      "#include <unistd.h>",
      "#include <ctype.h>",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "public_key.data"
          ],
          "line": 838
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_service_descriptor_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "1522-1528",
          "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_service_descriptor_free(lockdownd_service_descriptor_t service)\n{\n\tif (service)\n\t\tfree(service);\n\n\treturn LOCKDOWN_E_SUCCESS;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_service_descriptor_free(lockdownd_service_descriptor_t service)\n{\n\tif (service)\n\t\tfree(service);\n\n\treturn LOCKDOWN_E_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "pair_record_set_host_id",
          "args": [
            "*pair_record",
            "host_id"
          ],
          "line": 830
        },
        "resolved": true,
        "details": {
          "function_name": "pair_record_set_host_id",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/common/userpref.c",
          "lines": "885-890",
          "snippet": "userpref_error_t pair_record_set_host_id(plist_t pair_record, const char* host_id)\n{\n\tplist_dict_set_item(pair_record, USERPREF_HOST_ID_KEY, plist_new_string(host_id));\n\n\treturn USERPREF_E_SUCCESS;\n}",
          "includes": [
            "#include \"utils.h\"",
            "#include \"debug.h\"",
            "#include \"userpref.h\"",
            "#include <shlobj.h>",
            "#include <errno.h>",
            "#include <sys/stat.h>",
            "#include <libgen.h>",
            "#include <dirent.h>",
            "#include <libtasn1.h>",
            "#include <gcrypt.h>",
            "#include <gnutls/x509.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/gnutls.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/rsa.h>",
            "#include <openssl/pem.h>",
            "#include <usbmuxd.h>",
            "#include <unistd.h>",
            "#include <pwd.h>",
            "#include <sys/types.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"utils.h\"\n#include \"debug.h\"\n#include \"userpref.h\"\n#include <shlobj.h>\n#include <errno.h>\n#include <sys/stat.h>\n#include <libgen.h>\n#include <dirent.h>\n#include <libtasn1.h>\n#include <gcrypt.h>\n#include <gnutls/x509.h>\n#include <gnutls/crypto.h>\n#include <gnutls/gnutls.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/rsa.h>\n#include <openssl/pem.h>\n#include <usbmuxd.h>\n#include <unistd.h>\n#include <pwd.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nuserpref_error_t pair_record_set_host_id(plist_t pair_record, const char* host_id)\n{\n\tplist_dict_set_item(pair_record, USERPREF_HOST_ID_KEY, plist_new_string(host_id));\n\n\treturn USERPREF_E_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "generate_uuid",
          "args": [],
          "line": 829
        },
        "resolved": true,
        "details": {
          "function_name": "generate_uuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/common/utils.c",
          "lines": "180-201",
          "snippet": "char *generate_uuid()\n{\n\tconst char *chars = \"ABCDEF0123456789\";\n\tint i = 0;\n\tchar *uuid = (char *) malloc(sizeof(char) * 37);\n\n\tsrand(time(NULL));\n\n\tfor (i = 0; i < 36; i++) {\n\t\tif (i == 8 || i == 13 || i == 18 || i == 23) {\n\t\t\tuuid[i] = '-';\n\t\t\tcontinue;\n\t\t} else {\n\t\t\tuuid[i] = chars[get_rand(0, 16)];\n\t\t}\n\t}\n\n\t/* make it a real string */\n\tuuid[36] = '\\0';\n\n\treturn uuid;\n}",
          "includes": [
            "#include \"utils.h\"",
            "#include <ctype.h>",
            "#include <inttypes.h>",
            "#include <sys/time.h>",
            "#include <time.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"utils.h\"\n#include <ctype.h>\n#include <inttypes.h>\n#include <sys/time.h>\n#include <time.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdarg.h>\n#include <config.h>\n\nchar *generate_uuid()\n{\n\tconst char *chars = \"ABCDEF0123456789\";\n\tint i = 0;\n\tchar *uuid = (char *) malloc(sizeof(char) * 37);\n\n\tsrand(time(NULL));\n\n\tfor (i = 0; i < 36; i++) {\n\t\tif (i == 8 || i == 13 || i == 18 || i == 23) {\n\t\t\tuuid[i] = '-';\n\t\t\tcontinue;\n\t\t} else {\n\t\t\tuuid[i] = chars[get_rand(0, 16)];\n\t\t}\n\t}\n\n\t/* make it a real string */\n\tuuid[36] = '\\0';\n\n\treturn uuid;\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "*pair_record",
            "USERPREF_SYSTEM_BUID_KEY",
            "plist_new_string(system_buid)"
          ],
          "line": 825
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "system_buid"
          ],
          "line": 825
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "userpref_read_system_buid",
          "args": [
            "&system_buid"
          ],
          "line": 823
        },
        "resolved": true,
        "details": {
          "function_name": "userpref_read_system_buid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/common/userpref.c",
          "lines": "183-192",
          "snippet": "int userpref_read_system_buid(char **system_buid)\n{\n\tint res = usbmuxd_read_buid(system_buid);\n\tif (res == 0) {\n\t\tdebug_info(\"using %s as %s\", *system_buid, USERPREF_SYSTEM_BUID_KEY);\n\t} else {\n\t\tdebug_info(\"could not read system buid, error %d\", res);\n\t}\n\treturn res;\n}",
          "includes": [
            "#include \"utils.h\"",
            "#include \"debug.h\"",
            "#include \"userpref.h\"",
            "#include <shlobj.h>",
            "#include <errno.h>",
            "#include <sys/stat.h>",
            "#include <libgen.h>",
            "#include <dirent.h>",
            "#include <libtasn1.h>",
            "#include <gcrypt.h>",
            "#include <gnutls/x509.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/gnutls.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/rsa.h>",
            "#include <openssl/pem.h>",
            "#include <usbmuxd.h>",
            "#include <unistd.h>",
            "#include <pwd.h>",
            "#include <sys/types.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"utils.h\"\n#include \"debug.h\"\n#include \"userpref.h\"\n#include <shlobj.h>\n#include <errno.h>\n#include <sys/stat.h>\n#include <libgen.h>\n#include <dirent.h>\n#include <libtasn1.h>\n#include <gcrypt.h>\n#include <gnutls/x509.h>\n#include <gnutls/crypto.h>\n#include <gnutls/gnutls.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/rsa.h>\n#include <openssl/pem.h>\n#include <usbmuxd.h>\n#include <unistd.h>\n#include <pwd.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nint userpref_read_system_buid(char **system_buid)\n{\n\tint res = usbmuxd_read_buid(system_buid);\n\tif (res == 0) {\n\t\tdebug_info(\"using %s as %s\", *system_buid, USERPREF_SYSTEM_BUID_KEY);\n\t} else {\n\t\tdebug_info(\"could not read system buid, error %d\", res);\n\t}\n\treturn res;\n}"
        }
      },
      {
        "call_info": {
          "callee": "pair_record_generate_keys_and_certs",
          "args": [
            "*pair_record",
            "public_key"
          ],
          "line": 808
        },
        "resolved": true,
        "details": {
          "function_name": "pair_record_generate_keys_and_certs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/common/userpref.c",
          "lines": "405-798",
          "snippet": "userpref_error_t pair_record_generate_keys_and_certs(plist_t pair_record, key_data_t public_key)\n{\n\tuserpref_error_t ret = USERPREF_E_SSL_ERROR;\n\n\tkey_data_t dev_cert_pem = { NULL, 0 };\n\tkey_data_t root_key_pem = { NULL, 0 };\n\tkey_data_t root_cert_pem = { NULL, 0 };\n\tkey_data_t host_key_pem = { NULL, 0 };\n\tkey_data_t host_cert_pem = { NULL, 0 };\n\n\tif (!pair_record || !public_key.data)\n\t\treturn USERPREF_E_INVALID_ARG;\n\n\tdebug_info(\"Generating keys and certificates...\");\n\n#ifdef HAVE_OPENSSL\n\tBIGNUM *e = BN_new();\n\tRSA* root_keypair = RSA_new();\n\tRSA* host_keypair = RSA_new();\n\n\tBN_set_word(e, 65537);\n\n\tRSA_generate_key_ex(root_keypair, 2048, e, NULL);\n\tRSA_generate_key_ex(host_keypair, 2048, e, NULL);\n\n\tBN_free(e);\n\n\tEVP_PKEY* root_pkey = EVP_PKEY_new();\n\tEVP_PKEY_assign_RSA(root_pkey, root_keypair);\n\n\tEVP_PKEY* host_pkey = EVP_PKEY_new();\n\tEVP_PKEY_assign_RSA(host_pkey, host_keypair);\n\n\t/* generate root certificate */\n\tX509* root_cert = X509_new();\n\t{\n\t\t/* set serial number */\n\t\tASN1_INTEGER* sn = ASN1_INTEGER_new();\n\t\tASN1_INTEGER_set(sn, 0);\n\t\tX509_set_serialNumber(root_cert, sn);\n\t\tASN1_INTEGER_free(sn);\n\n\t\t/* set version */\n\t\tX509_set_version(root_cert, 2);\n\n\t\t/* set x509v3 basic constraints */\n\t\tX509_add_ext_helper(root_cert, NID_basic_constraints, (char*)\"critical,CA:TRUE\");\n\n\t\t/* set key validity */\n\t\tASN1_TIME* asn1time = ASN1_TIME_new();\n\t\tASN1_TIME_set(asn1time, time(NULL));\n\t\tX509_set_notBefore(root_cert, asn1time);\n\t\tASN1_TIME_set(asn1time, time(NULL) + (60 * 60 * 24 * 365 * 10));\n\t\tX509_set_notAfter(root_cert, asn1time);\n\t\tASN1_TIME_free(asn1time);\n\n\t\t/* use root public key for root cert */\n\t\tX509_set_pubkey(root_cert, root_pkey);\n\n\t\t/* sign root cert with root private key */\n\t\tX509_sign(root_cert, root_pkey, EVP_sha1());\n\t}\n\n\t/* create host certificate */\n\tX509* host_cert = X509_new();\n\t{\n\t\t/* set serial number */\n\t\tASN1_INTEGER* sn = ASN1_INTEGER_new();\n\t\tASN1_INTEGER_set(sn, 0);\n\t\tX509_set_serialNumber(host_cert, sn);\n\t\tASN1_INTEGER_free(sn);\n\n\t\t/* set version */\n\t\tX509_set_version(host_cert, 2);\n\n\t\t/* set x509v3 basic constraints */\n\t\tX509_add_ext_helper(host_cert, NID_basic_constraints, (char*)\"critical,CA:FALSE\");\n\n\t\t/* set x509v3 key usage */\n\t\tX509_add_ext_helper(host_cert, NID_key_usage, (char*)\"critical,digitalSignature,keyEncipherment\");\n\n\t\t/* set key validity */\n\t\tASN1_TIME* asn1time = ASN1_TIME_new();\n\t\tASN1_TIME_set(asn1time, time(NULL));\n\t\tX509_set_notBefore(host_cert, asn1time);\n\t\tASN1_TIME_set(asn1time, time(NULL) + (60 * 60 * 24 * 365 * 10));\n\t\tX509_set_notAfter(host_cert, asn1time);\n\t\tASN1_TIME_free(asn1time);\n\n\t\t/* use host public key for host cert */\n\t\tX509_set_pubkey(host_cert, host_pkey);\n\n\t\t/* sign host cert with root private key */\n\t\tX509_sign(host_cert, root_pkey, EVP_sha1());\n\t}\n\n\tif (root_cert && root_pkey && host_cert && host_pkey) {\n\t\tBIO* membp;\n\t\tchar *bdata;\n\n\t\tmembp = BIO_new(BIO_s_mem());\n\t\tif (PEM_write_bio_X509(membp, root_cert) > 0) {\n\t\t\troot_cert_pem.size = BIO_get_mem_data(membp, &bdata);\n\t\t\troot_cert_pem.data = (unsigned char*)malloc(root_cert_pem.size);\n\t\t\tif (root_cert_pem.data) {\n\t\t\t\tmemcpy(root_cert_pem.data, bdata, root_cert_pem.size);\n\t\t\t}\n\t\t\tBIO_free(membp);\n\t\t\tmembp = NULL;\n\t\t}\n\t\tmembp = BIO_new(BIO_s_mem());\n\t\tif (PEM_write_bio_PrivateKey(membp, root_pkey, NULL, NULL, 0, 0, NULL) > 0) {\n\t\t\troot_key_pem.size = BIO_get_mem_data(membp, &bdata);\n\t\t\troot_key_pem.data = (unsigned char*)malloc(root_key_pem.size);\n\t\t\tif (root_key_pem.data) {\n\t\t\t\tmemcpy(root_key_pem.data, bdata, root_key_pem.size);\n\t\t\t}\n\t\t\tBIO_free(membp);\n\t\t\tmembp = NULL;\n\t\t}\n\t\tmembp = BIO_new(BIO_s_mem());\n\t\tif (PEM_write_bio_X509(membp, host_cert) > 0) {\n\t\t\thost_cert_pem.size = BIO_get_mem_data(membp, &bdata);\n\t\t\thost_cert_pem.data = (unsigned char*)malloc(host_cert_pem.size);\n\t\t\tif (host_cert_pem.data) {\n\t\t\t\tmemcpy(host_cert_pem.data, bdata, host_cert_pem.size);\n\t\t\t}\n\t\t\tBIO_free(membp);\n\t\t\tmembp = NULL;\n\t\t}\n\t\tmembp = BIO_new(BIO_s_mem());\n\t\tif (PEM_write_bio_PrivateKey(membp, host_pkey, NULL, NULL, 0, 0, NULL) > 0) {\n\t\t\thost_key_pem.size = BIO_get_mem_data(membp, &bdata);\n\t\t\thost_key_pem.data = (unsigned char*)malloc(host_key_pem.size);\n\t\t\tif (host_key_pem.data) {\n\t\t\t\tmemcpy(host_key_pem.data, bdata, host_key_pem.size);\n\t\t\t}\n\t\t\tBIO_free(membp);\n\t\t\tmembp = NULL;\n\t\t}\n\t}\n\n\tRSA *pubkey = NULL;\n\t{\n\t\tBIO *membp = BIO_new_mem_buf(public_key.data, public_key.size);\n\t\tif (!PEM_read_bio_RSAPublicKey(membp, &pubkey, NULL, NULL)) {\n\t\t\tdebug_info(\"WARNING: Could not read public key\");\n\t\t}\n\t\tBIO_free(membp);\n\t}\n\n\tX509* dev_cert = X509_new();\n\tif (pubkey && dev_cert) {\n\t\t/* generate device certificate */\n\t\tASN1_INTEGER* sn = ASN1_INTEGER_new();\n\t\tASN1_INTEGER_set(sn, 0);\n\t\tX509_set_serialNumber(dev_cert, sn);\n\t\tASN1_INTEGER_free(sn);\n\t\tX509_set_version(dev_cert, 2);\n\n\t\tX509_add_ext_helper(dev_cert, NID_basic_constraints, (char*)\"critical,CA:FALSE\");\n\n\t\tASN1_TIME* asn1time = ASN1_TIME_new();\n\t\tASN1_TIME_set(asn1time, time(NULL));\n\t\tX509_set_notBefore(dev_cert, asn1time);\n\t\tASN1_TIME_set(asn1time, time(NULL) + (60 * 60 * 24 * 365 * 10));\n\t\tX509_set_notAfter(dev_cert, asn1time);\n\t\tASN1_TIME_free(asn1time);\n\n\t\tEVP_PKEY* pkey = EVP_PKEY_new();\n\t\tEVP_PKEY_assign_RSA(pkey, pubkey);\n\t\tX509_set_pubkey(dev_cert, pkey);\n\t\tEVP_PKEY_free(pkey);\n\n\t\tX509_add_ext_helper(dev_cert, NID_subject_key_identifier, (char*)\"hash\");\n\t\tX509_add_ext_helper(dev_cert, NID_key_usage, (char*)\"critical,digitalSignature,keyEncipherment\");\n\n\t\t/* sign device certificate with root private key */\n\t\tif (X509_sign(dev_cert, root_pkey, EVP_sha1())) {\n\t\t\t/* if signing succeeded, export in PEM format */\n\t\t\tBIO* membp = BIO_new(BIO_s_mem());\n\t\t\tif (PEM_write_bio_X509(membp, dev_cert) > 0) {\n\t\t\t\tchar *bdata = NULL;\n\t\t\t\tdev_cert_pem.size = BIO_get_mem_data(membp, &bdata);\n\t\t\t\tdev_cert_pem.data = (unsigned char*)malloc(dev_cert_pem.size);\n\t\t\t\tif (dev_cert_pem.data) {\n\t\t\t\t\tmemcpy(dev_cert_pem.data, bdata, dev_cert_pem.size);\n\t\t\t\t}\n\t\t\t\tBIO_free(membp);\n\t\t\t\tmembp = NULL;\n\t\t\t}\n\t\t} else {\n\t\t\tdebug_info(\"ERROR: Signing device certificate with root private key failed!\");\n\t\t}\n\t}\n\n\tX509V3_EXT_cleanup();\n\tX509_free(dev_cert);\n\n\tEVP_PKEY_free(root_pkey);\n\tEVP_PKEY_free(host_pkey);\n\n\tX509_free(host_cert);\n\tX509_free(root_cert);\n#else\n\tgnutls_x509_privkey_t root_privkey;\n\tgnutls_x509_crt_t root_cert;\n\tgnutls_x509_privkey_t host_privkey;\n\tgnutls_x509_crt_t host_cert;\n\n\t/* use less secure random to speed up key generation */\n\tgcry_control(GCRYCTL_ENABLE_QUICK_RANDOM);\n\n\tgnutls_x509_privkey_init(&root_privkey);\n\tgnutls_x509_privkey_init(&host_privkey);\n\n\tgnutls_x509_crt_init(&root_cert);\n\tgnutls_x509_crt_init(&host_cert);\n\n\t/* generate root key */\n\tgnutls_x509_privkey_generate(root_privkey, GNUTLS_PK_RSA, 2048, 0);\n\tgnutls_x509_privkey_generate(host_privkey, GNUTLS_PK_RSA, 2048, 0);\n\n\t/* generate certificates */\n\tgnutls_x509_crt_set_key(root_cert, root_privkey);\n\tgnutls_x509_crt_set_serial(root_cert, \"\\x00\", 1);\n\tgnutls_x509_crt_set_version(root_cert, 3);\n\tgnutls_x509_crt_set_ca_status(root_cert, 1);\n\tgnutls_x509_crt_set_activation_time(root_cert, time(NULL));\n\tgnutls_x509_crt_set_expiration_time(root_cert, time(NULL) + (60 * 60 * 24 * 365 * 10));\n\tgnutls_x509_crt_sign(root_cert, root_cert, root_privkey);\n\n\tgnutls_x509_crt_set_key(host_cert, host_privkey);\n\tgnutls_x509_crt_set_serial(host_cert, \"\\x00\", 1);\n\tgnutls_x509_crt_set_version(host_cert, 3);\n\tgnutls_x509_crt_set_ca_status(host_cert, 0);\n\tgnutls_x509_crt_set_key_usage(host_cert, GNUTLS_KEY_KEY_ENCIPHERMENT | GNUTLS_KEY_DIGITAL_SIGNATURE);\n\tgnutls_x509_crt_set_activation_time(host_cert, time(NULL));\n\tgnutls_x509_crt_set_expiration_time(host_cert, time(NULL) + (60 * 60 * 24 * 365 * 10));\n\tgnutls_x509_crt_sign(host_cert, root_cert, root_privkey);\n\n\t/* export to PEM format */\n\tsize_t root_key_export_size = 0;\n\tsize_t host_key_export_size = 0;\n\n\tgnutls_x509_privkey_export(root_privkey, GNUTLS_X509_FMT_PEM, NULL, &root_key_export_size);\n\tgnutls_x509_privkey_export(host_privkey, GNUTLS_X509_FMT_PEM, NULL, &host_key_export_size);\n\n\troot_key_pem.data = gnutls_malloc(root_key_export_size);\n\thost_key_pem.data = gnutls_malloc(host_key_export_size);\n\n\tgnutls_x509_privkey_export(root_privkey, GNUTLS_X509_FMT_PEM, root_key_pem.data, &root_key_export_size);\n\troot_key_pem.size = root_key_export_size;\n\tgnutls_x509_privkey_export(host_privkey, GNUTLS_X509_FMT_PEM, host_key_pem.data, &host_key_export_size);\n\thost_key_pem.size = host_key_export_size;\n\n\tsize_t root_cert_export_size = 0;\n\tsize_t host_cert_export_size = 0;\n\n\tgnutls_x509_crt_export(root_cert, GNUTLS_X509_FMT_PEM, NULL, &root_cert_export_size);\n\tgnutls_x509_crt_export(host_cert, GNUTLS_X509_FMT_PEM, NULL, &host_cert_export_size);\n\n\troot_cert_pem.data = gnutls_malloc(root_cert_export_size);\n\thost_cert_pem.data = gnutls_malloc(host_cert_export_size);\n\n\tgnutls_x509_crt_export(root_cert, GNUTLS_X509_FMT_PEM, root_cert_pem.data, &root_cert_export_size);\n\troot_cert_pem.size = root_cert_export_size;\n\tgnutls_x509_crt_export(host_cert, GNUTLS_X509_FMT_PEM, host_cert_pem.data, &host_cert_export_size);\n\thost_cert_pem.size = host_cert_export_size;\n\n\tret = USERPREF_E_UNKNOWN_ERROR;\n\n\tgnutls_datum_t modulus = { NULL, 0 };\n\tgnutls_datum_t exponent = { NULL, 0 };\n\n\t/* now decode the PEM encoded key */\n\tgnutls_datum_t der_pub_key;\n\tif (GNUTLS_E_SUCCESS == gnutls_pem_base64_decode_alloc(\"RSA PUBLIC KEY\", &public_key, &der_pub_key)) {\n\n\t\t/* initalize asn.1 parser */\n\t\tASN1_TYPE pkcs1 = ASN1_TYPE_EMPTY;\n\t\tif (ASN1_SUCCESS == asn1_array2tree(pkcs1_asn1_tab, &pkcs1, NULL)) {\n\n\t\t\tASN1_TYPE asn1_pub_key = ASN1_TYPE_EMPTY;\n\t\t\tasn1_create_element(pkcs1, \"PKCS1.RSAPublicKey\", &asn1_pub_key);\n\n\t\t\tif (ASN1_SUCCESS == asn1_der_decoding(&asn1_pub_key, der_pub_key.data, der_pub_key.size, NULL)) {\n\n\t\t\t\t/* get size to read */\n\t\t\t\tint ret1 = asn1_read_value(asn1_pub_key, \"modulus\", NULL, (int*)&modulus.size);\n\t\t\t\tint ret2 = asn1_read_value(asn1_pub_key, \"publicExponent\", NULL, (int*)&exponent.size);\n\n\t\t\t\tmodulus.data = gnutls_malloc(modulus.size);\n\t\t\t\texponent.data = gnutls_malloc(exponent.size);\n\n\t\t\t\tret1 = asn1_read_value(asn1_pub_key, \"modulus\", modulus.data, (int*)&modulus.size);\n\t\t\t\tret2 = asn1_read_value(asn1_pub_key, \"publicExponent\", exponent.data, (int*)&exponent.size);\n\t\t\t\tif (ASN1_SUCCESS == ret1 && ASN1_SUCCESS == ret2)\n\t\t\t\t\tret = USERPREF_E_SUCCESS;\n\t\t\t}\n\t\t\tif (asn1_pub_key)\n\t\t\t\tasn1_delete_structure(&asn1_pub_key);\n\t\t}\n\t\tif (pkcs1)\n\t\t\tasn1_delete_structure(&pkcs1);\n\t} else {\n\t\tdebug_info(\"WARNING: Could not read public key\");\n\t}\n\n\t/* now generate certificates */\n\tif (USERPREF_E_SUCCESS == ret && 0 != modulus.size && 0 != exponent.size) {\n\t\tgnutls_datum_t essentially_null = { (unsigned char*)strdup(\"abababababababab\"), strlen(\"abababababababab\") };\n\n\t\tgnutls_x509_privkey_t fake_privkey;\n\t\tgnutls_x509_crt_t dev_cert;\n\n\t\tgnutls_x509_privkey_init(&fake_privkey);\n\t\tgnutls_x509_crt_init(&dev_cert);\n\n\t\tif (GNUTLS_E_SUCCESS == gnutls_x509_privkey_import_rsa_raw(fake_privkey, &modulus, &exponent, &essentially_null, &essentially_null, &essentially_null, &essentially_null)) {\n\t\t\t/* generate device certificate */\n\t\t\tgnutls_x509_crt_set_key(dev_cert, fake_privkey);\n\t\t\tgnutls_x509_crt_set_serial(dev_cert, \"\\x00\", 1);\n\t\t\tgnutls_x509_crt_set_version(dev_cert, 3);\n\t\t\tgnutls_x509_crt_set_ca_status(dev_cert, 0);\n\t\t\tgnutls_x509_crt_set_activation_time(dev_cert, time(NULL));\n\t\t\tgnutls_x509_crt_set_expiration_time(dev_cert, time(NULL) + (60 * 60 * 24 * 365 * 10));\n\n\t\t\t/* use custom hash generation for compatibility with the \"Apple ecosystem\" */\n\t\t\tconst gnutls_digest_algorithm_t dig_sha1 = GNUTLS_DIG_SHA1;\n\t\t\tsize_t hash_size = gnutls_hash_get_len(dig_sha1);\n\t\t\tunsigned char hash[hash_size];\n\t\t\tif (gnutls_hash_fast(dig_sha1, der_pub_key.data, der_pub_key.size, (unsigned char*)&hash) < 0) {\n\t\t\t\tdebug_info(\"ERROR: Failed to generate SHA1 for public key\");\n\t\t\t} else {\n\t\t\t\tgnutls_x509_crt_set_subject_key_id(dev_cert, hash, hash_size);\n\t\t\t}\n\n\t\t\tgnutls_x509_crt_set_key_usage(dev_cert, GNUTLS_KEY_DIGITAL_SIGNATURE | GNUTLS_KEY_KEY_ENCIPHERMENT);\n\t\t\tgnutls_x509_crt_sign(dev_cert, root_cert, root_privkey);\n\n\t\t\tif (USERPREF_E_SUCCESS == ret) {\n\t\t\t\t/* if everything went well, export in PEM format */\n\t\t\t\tsize_t export_size = 0;\n\t\t\t\tgnutls_x509_crt_export(dev_cert, GNUTLS_X509_FMT_PEM, NULL, &export_size);\n\t\t\t\tdev_cert_pem.data = gnutls_malloc(export_size);\n\t\t\t\tgnutls_x509_crt_export(dev_cert, GNUTLS_X509_FMT_PEM, dev_cert_pem.data, &export_size);\n\t\t\t\tdev_cert_pem.size = export_size;\n\t\t\t} else {\n\t\t\t\tdebug_info(\"ERROR: Signing device certificate with root private key failed!\");\n\t\t\t}\n\t\t}\n\n\t\tif (essentially_null.data)\n\t\t\tfree(essentially_null.data);\n\n\t\tgnutls_x509_crt_deinit(dev_cert);\n\t\tgnutls_x509_privkey_deinit(fake_privkey);\n\t}\n\n\tgnutls_x509_crt_deinit(root_cert);\n\tgnutls_x509_crt_deinit(host_cert);\n\tgnutls_x509_privkey_deinit(root_privkey);\n\tgnutls_x509_privkey_deinit(host_privkey);\n\n\tgnutls_free(modulus.data);\n\tgnutls_free(exponent.data);\n\n\tgnutls_free(der_pub_key.data);\n#endif\n\tif (NULL != root_cert_pem.data && 0 != root_cert_pem.size &&\n\t\tNULL != host_cert_pem.data && 0 != host_cert_pem.size)\n\t\tret = USERPREF_E_SUCCESS;\n\n\t/* now set keys and certificates */\n\tpair_record_set_item_from_key_data(pair_record, USERPREF_DEVICE_CERTIFICATE_KEY, &dev_cert_pem);\n\tpair_record_set_item_from_key_data(pair_record, USERPREF_HOST_PRIVATE_KEY_KEY, &host_key_pem);\n\tpair_record_set_item_from_key_data(pair_record, USERPREF_HOST_CERTIFICATE_KEY, &host_cert_pem);\n\tpair_record_set_item_from_key_data(pair_record, USERPREF_ROOT_PRIVATE_KEY_KEY, &root_key_pem);\n\tpair_record_set_item_from_key_data(pair_record, USERPREF_ROOT_CERTIFICATE_KEY, &root_cert_pem);\n\n\tif (dev_cert_pem.data)\n\t\tfree(dev_cert_pem.data);\n\tif (root_key_pem.data)\n\t\tfree(root_key_pem.data);\n\tif (root_cert_pem.data)\n\t\tfree(root_cert_pem.data);\n\tif (host_key_pem.data)\n\t\tfree(host_key_pem.data);\n\tif (host_cert_pem.data)\n\t\tfree(host_cert_pem.data);\n\n\treturn ret;\n}",
          "includes": [
            "#include \"utils.h\"",
            "#include \"debug.h\"",
            "#include \"userpref.h\"",
            "#include <shlobj.h>",
            "#include <errno.h>",
            "#include <sys/stat.h>",
            "#include <libgen.h>",
            "#include <dirent.h>",
            "#include <libtasn1.h>",
            "#include <gcrypt.h>",
            "#include <gnutls/x509.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/gnutls.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/rsa.h>",
            "#include <openssl/pem.h>",
            "#include <usbmuxd.h>",
            "#include <unistd.h>",
            "#include <pwd.h>",
            "#include <sys/types.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"utils.h\"\n#include \"debug.h\"\n#include \"userpref.h\"\n#include <shlobj.h>\n#include <errno.h>\n#include <sys/stat.h>\n#include <libgen.h>\n#include <dirent.h>\n#include <libtasn1.h>\n#include <gcrypt.h>\n#include <gnutls/x509.h>\n#include <gnutls/crypto.h>\n#include <gnutls/gnutls.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/rsa.h>\n#include <openssl/pem.h>\n#include <usbmuxd.h>\n#include <unistd.h>\n#include <pwd.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nuserpref_error_t pair_record_generate_keys_and_certs(plist_t pair_record, key_data_t public_key)\n{\n\tuserpref_error_t ret = USERPREF_E_SSL_ERROR;\n\n\tkey_data_t dev_cert_pem = { NULL, 0 };\n\tkey_data_t root_key_pem = { NULL, 0 };\n\tkey_data_t root_cert_pem = { NULL, 0 };\n\tkey_data_t host_key_pem = { NULL, 0 };\n\tkey_data_t host_cert_pem = { NULL, 0 };\n\n\tif (!pair_record || !public_key.data)\n\t\treturn USERPREF_E_INVALID_ARG;\n\n\tdebug_info(\"Generating keys and certificates...\");\n\n#ifdef HAVE_OPENSSL\n\tBIGNUM *e = BN_new();\n\tRSA* root_keypair = RSA_new();\n\tRSA* host_keypair = RSA_new();\n\n\tBN_set_word(e, 65537);\n\n\tRSA_generate_key_ex(root_keypair, 2048, e, NULL);\n\tRSA_generate_key_ex(host_keypair, 2048, e, NULL);\n\n\tBN_free(e);\n\n\tEVP_PKEY* root_pkey = EVP_PKEY_new();\n\tEVP_PKEY_assign_RSA(root_pkey, root_keypair);\n\n\tEVP_PKEY* host_pkey = EVP_PKEY_new();\n\tEVP_PKEY_assign_RSA(host_pkey, host_keypair);\n\n\t/* generate root certificate */\n\tX509* root_cert = X509_new();\n\t{\n\t\t/* set serial number */\n\t\tASN1_INTEGER* sn = ASN1_INTEGER_new();\n\t\tASN1_INTEGER_set(sn, 0);\n\t\tX509_set_serialNumber(root_cert, sn);\n\t\tASN1_INTEGER_free(sn);\n\n\t\t/* set version */\n\t\tX509_set_version(root_cert, 2);\n\n\t\t/* set x509v3 basic constraints */\n\t\tX509_add_ext_helper(root_cert, NID_basic_constraints, (char*)\"critical,CA:TRUE\");\n\n\t\t/* set key validity */\n\t\tASN1_TIME* asn1time = ASN1_TIME_new();\n\t\tASN1_TIME_set(asn1time, time(NULL));\n\t\tX509_set_notBefore(root_cert, asn1time);\n\t\tASN1_TIME_set(asn1time, time(NULL) + (60 * 60 * 24 * 365 * 10));\n\t\tX509_set_notAfter(root_cert, asn1time);\n\t\tASN1_TIME_free(asn1time);\n\n\t\t/* use root public key for root cert */\n\t\tX509_set_pubkey(root_cert, root_pkey);\n\n\t\t/* sign root cert with root private key */\n\t\tX509_sign(root_cert, root_pkey, EVP_sha1());\n\t}\n\n\t/* create host certificate */\n\tX509* host_cert = X509_new();\n\t{\n\t\t/* set serial number */\n\t\tASN1_INTEGER* sn = ASN1_INTEGER_new();\n\t\tASN1_INTEGER_set(sn, 0);\n\t\tX509_set_serialNumber(host_cert, sn);\n\t\tASN1_INTEGER_free(sn);\n\n\t\t/* set version */\n\t\tX509_set_version(host_cert, 2);\n\n\t\t/* set x509v3 basic constraints */\n\t\tX509_add_ext_helper(host_cert, NID_basic_constraints, (char*)\"critical,CA:FALSE\");\n\n\t\t/* set x509v3 key usage */\n\t\tX509_add_ext_helper(host_cert, NID_key_usage, (char*)\"critical,digitalSignature,keyEncipherment\");\n\n\t\t/* set key validity */\n\t\tASN1_TIME* asn1time = ASN1_TIME_new();\n\t\tASN1_TIME_set(asn1time, time(NULL));\n\t\tX509_set_notBefore(host_cert, asn1time);\n\t\tASN1_TIME_set(asn1time, time(NULL) + (60 * 60 * 24 * 365 * 10));\n\t\tX509_set_notAfter(host_cert, asn1time);\n\t\tASN1_TIME_free(asn1time);\n\n\t\t/* use host public key for host cert */\n\t\tX509_set_pubkey(host_cert, host_pkey);\n\n\t\t/* sign host cert with root private key */\n\t\tX509_sign(host_cert, root_pkey, EVP_sha1());\n\t}\n\n\tif (root_cert && root_pkey && host_cert && host_pkey) {\n\t\tBIO* membp;\n\t\tchar *bdata;\n\n\t\tmembp = BIO_new(BIO_s_mem());\n\t\tif (PEM_write_bio_X509(membp, root_cert) > 0) {\n\t\t\troot_cert_pem.size = BIO_get_mem_data(membp, &bdata);\n\t\t\troot_cert_pem.data = (unsigned char*)malloc(root_cert_pem.size);\n\t\t\tif (root_cert_pem.data) {\n\t\t\t\tmemcpy(root_cert_pem.data, bdata, root_cert_pem.size);\n\t\t\t}\n\t\t\tBIO_free(membp);\n\t\t\tmembp = NULL;\n\t\t}\n\t\tmembp = BIO_new(BIO_s_mem());\n\t\tif (PEM_write_bio_PrivateKey(membp, root_pkey, NULL, NULL, 0, 0, NULL) > 0) {\n\t\t\troot_key_pem.size = BIO_get_mem_data(membp, &bdata);\n\t\t\troot_key_pem.data = (unsigned char*)malloc(root_key_pem.size);\n\t\t\tif (root_key_pem.data) {\n\t\t\t\tmemcpy(root_key_pem.data, bdata, root_key_pem.size);\n\t\t\t}\n\t\t\tBIO_free(membp);\n\t\t\tmembp = NULL;\n\t\t}\n\t\tmembp = BIO_new(BIO_s_mem());\n\t\tif (PEM_write_bio_X509(membp, host_cert) > 0) {\n\t\t\thost_cert_pem.size = BIO_get_mem_data(membp, &bdata);\n\t\t\thost_cert_pem.data = (unsigned char*)malloc(host_cert_pem.size);\n\t\t\tif (host_cert_pem.data) {\n\t\t\t\tmemcpy(host_cert_pem.data, bdata, host_cert_pem.size);\n\t\t\t}\n\t\t\tBIO_free(membp);\n\t\t\tmembp = NULL;\n\t\t}\n\t\tmembp = BIO_new(BIO_s_mem());\n\t\tif (PEM_write_bio_PrivateKey(membp, host_pkey, NULL, NULL, 0, 0, NULL) > 0) {\n\t\t\thost_key_pem.size = BIO_get_mem_data(membp, &bdata);\n\t\t\thost_key_pem.data = (unsigned char*)malloc(host_key_pem.size);\n\t\t\tif (host_key_pem.data) {\n\t\t\t\tmemcpy(host_key_pem.data, bdata, host_key_pem.size);\n\t\t\t}\n\t\t\tBIO_free(membp);\n\t\t\tmembp = NULL;\n\t\t}\n\t}\n\n\tRSA *pubkey = NULL;\n\t{\n\t\tBIO *membp = BIO_new_mem_buf(public_key.data, public_key.size);\n\t\tif (!PEM_read_bio_RSAPublicKey(membp, &pubkey, NULL, NULL)) {\n\t\t\tdebug_info(\"WARNING: Could not read public key\");\n\t\t}\n\t\tBIO_free(membp);\n\t}\n\n\tX509* dev_cert = X509_new();\n\tif (pubkey && dev_cert) {\n\t\t/* generate device certificate */\n\t\tASN1_INTEGER* sn = ASN1_INTEGER_new();\n\t\tASN1_INTEGER_set(sn, 0);\n\t\tX509_set_serialNumber(dev_cert, sn);\n\t\tASN1_INTEGER_free(sn);\n\t\tX509_set_version(dev_cert, 2);\n\n\t\tX509_add_ext_helper(dev_cert, NID_basic_constraints, (char*)\"critical,CA:FALSE\");\n\n\t\tASN1_TIME* asn1time = ASN1_TIME_new();\n\t\tASN1_TIME_set(asn1time, time(NULL));\n\t\tX509_set_notBefore(dev_cert, asn1time);\n\t\tASN1_TIME_set(asn1time, time(NULL) + (60 * 60 * 24 * 365 * 10));\n\t\tX509_set_notAfter(dev_cert, asn1time);\n\t\tASN1_TIME_free(asn1time);\n\n\t\tEVP_PKEY* pkey = EVP_PKEY_new();\n\t\tEVP_PKEY_assign_RSA(pkey, pubkey);\n\t\tX509_set_pubkey(dev_cert, pkey);\n\t\tEVP_PKEY_free(pkey);\n\n\t\tX509_add_ext_helper(dev_cert, NID_subject_key_identifier, (char*)\"hash\");\n\t\tX509_add_ext_helper(dev_cert, NID_key_usage, (char*)\"critical,digitalSignature,keyEncipherment\");\n\n\t\t/* sign device certificate with root private key */\n\t\tif (X509_sign(dev_cert, root_pkey, EVP_sha1())) {\n\t\t\t/* if signing succeeded, export in PEM format */\n\t\t\tBIO* membp = BIO_new(BIO_s_mem());\n\t\t\tif (PEM_write_bio_X509(membp, dev_cert) > 0) {\n\t\t\t\tchar *bdata = NULL;\n\t\t\t\tdev_cert_pem.size = BIO_get_mem_data(membp, &bdata);\n\t\t\t\tdev_cert_pem.data = (unsigned char*)malloc(dev_cert_pem.size);\n\t\t\t\tif (dev_cert_pem.data) {\n\t\t\t\t\tmemcpy(dev_cert_pem.data, bdata, dev_cert_pem.size);\n\t\t\t\t}\n\t\t\t\tBIO_free(membp);\n\t\t\t\tmembp = NULL;\n\t\t\t}\n\t\t} else {\n\t\t\tdebug_info(\"ERROR: Signing device certificate with root private key failed!\");\n\t\t}\n\t}\n\n\tX509V3_EXT_cleanup();\n\tX509_free(dev_cert);\n\n\tEVP_PKEY_free(root_pkey);\n\tEVP_PKEY_free(host_pkey);\n\n\tX509_free(host_cert);\n\tX509_free(root_cert);\n#else\n\tgnutls_x509_privkey_t root_privkey;\n\tgnutls_x509_crt_t root_cert;\n\tgnutls_x509_privkey_t host_privkey;\n\tgnutls_x509_crt_t host_cert;\n\n\t/* use less secure random to speed up key generation */\n\tgcry_control(GCRYCTL_ENABLE_QUICK_RANDOM);\n\n\tgnutls_x509_privkey_init(&root_privkey);\n\tgnutls_x509_privkey_init(&host_privkey);\n\n\tgnutls_x509_crt_init(&root_cert);\n\tgnutls_x509_crt_init(&host_cert);\n\n\t/* generate root key */\n\tgnutls_x509_privkey_generate(root_privkey, GNUTLS_PK_RSA, 2048, 0);\n\tgnutls_x509_privkey_generate(host_privkey, GNUTLS_PK_RSA, 2048, 0);\n\n\t/* generate certificates */\n\tgnutls_x509_crt_set_key(root_cert, root_privkey);\n\tgnutls_x509_crt_set_serial(root_cert, \"\\x00\", 1);\n\tgnutls_x509_crt_set_version(root_cert, 3);\n\tgnutls_x509_crt_set_ca_status(root_cert, 1);\n\tgnutls_x509_crt_set_activation_time(root_cert, time(NULL));\n\tgnutls_x509_crt_set_expiration_time(root_cert, time(NULL) + (60 * 60 * 24 * 365 * 10));\n\tgnutls_x509_crt_sign(root_cert, root_cert, root_privkey);\n\n\tgnutls_x509_crt_set_key(host_cert, host_privkey);\n\tgnutls_x509_crt_set_serial(host_cert, \"\\x00\", 1);\n\tgnutls_x509_crt_set_version(host_cert, 3);\n\tgnutls_x509_crt_set_ca_status(host_cert, 0);\n\tgnutls_x509_crt_set_key_usage(host_cert, GNUTLS_KEY_KEY_ENCIPHERMENT | GNUTLS_KEY_DIGITAL_SIGNATURE);\n\tgnutls_x509_crt_set_activation_time(host_cert, time(NULL));\n\tgnutls_x509_crt_set_expiration_time(host_cert, time(NULL) + (60 * 60 * 24 * 365 * 10));\n\tgnutls_x509_crt_sign(host_cert, root_cert, root_privkey);\n\n\t/* export to PEM format */\n\tsize_t root_key_export_size = 0;\n\tsize_t host_key_export_size = 0;\n\n\tgnutls_x509_privkey_export(root_privkey, GNUTLS_X509_FMT_PEM, NULL, &root_key_export_size);\n\tgnutls_x509_privkey_export(host_privkey, GNUTLS_X509_FMT_PEM, NULL, &host_key_export_size);\n\n\troot_key_pem.data = gnutls_malloc(root_key_export_size);\n\thost_key_pem.data = gnutls_malloc(host_key_export_size);\n\n\tgnutls_x509_privkey_export(root_privkey, GNUTLS_X509_FMT_PEM, root_key_pem.data, &root_key_export_size);\n\troot_key_pem.size = root_key_export_size;\n\tgnutls_x509_privkey_export(host_privkey, GNUTLS_X509_FMT_PEM, host_key_pem.data, &host_key_export_size);\n\thost_key_pem.size = host_key_export_size;\n\n\tsize_t root_cert_export_size = 0;\n\tsize_t host_cert_export_size = 0;\n\n\tgnutls_x509_crt_export(root_cert, GNUTLS_X509_FMT_PEM, NULL, &root_cert_export_size);\n\tgnutls_x509_crt_export(host_cert, GNUTLS_X509_FMT_PEM, NULL, &host_cert_export_size);\n\n\troot_cert_pem.data = gnutls_malloc(root_cert_export_size);\n\thost_cert_pem.data = gnutls_malloc(host_cert_export_size);\n\n\tgnutls_x509_crt_export(root_cert, GNUTLS_X509_FMT_PEM, root_cert_pem.data, &root_cert_export_size);\n\troot_cert_pem.size = root_cert_export_size;\n\tgnutls_x509_crt_export(host_cert, GNUTLS_X509_FMT_PEM, host_cert_pem.data, &host_cert_export_size);\n\thost_cert_pem.size = host_cert_export_size;\n\n\tret = USERPREF_E_UNKNOWN_ERROR;\n\n\tgnutls_datum_t modulus = { NULL, 0 };\n\tgnutls_datum_t exponent = { NULL, 0 };\n\n\t/* now decode the PEM encoded key */\n\tgnutls_datum_t der_pub_key;\n\tif (GNUTLS_E_SUCCESS == gnutls_pem_base64_decode_alloc(\"RSA PUBLIC KEY\", &public_key, &der_pub_key)) {\n\n\t\t/* initalize asn.1 parser */\n\t\tASN1_TYPE pkcs1 = ASN1_TYPE_EMPTY;\n\t\tif (ASN1_SUCCESS == asn1_array2tree(pkcs1_asn1_tab, &pkcs1, NULL)) {\n\n\t\t\tASN1_TYPE asn1_pub_key = ASN1_TYPE_EMPTY;\n\t\t\tasn1_create_element(pkcs1, \"PKCS1.RSAPublicKey\", &asn1_pub_key);\n\n\t\t\tif (ASN1_SUCCESS == asn1_der_decoding(&asn1_pub_key, der_pub_key.data, der_pub_key.size, NULL)) {\n\n\t\t\t\t/* get size to read */\n\t\t\t\tint ret1 = asn1_read_value(asn1_pub_key, \"modulus\", NULL, (int*)&modulus.size);\n\t\t\t\tint ret2 = asn1_read_value(asn1_pub_key, \"publicExponent\", NULL, (int*)&exponent.size);\n\n\t\t\t\tmodulus.data = gnutls_malloc(modulus.size);\n\t\t\t\texponent.data = gnutls_malloc(exponent.size);\n\n\t\t\t\tret1 = asn1_read_value(asn1_pub_key, \"modulus\", modulus.data, (int*)&modulus.size);\n\t\t\t\tret2 = asn1_read_value(asn1_pub_key, \"publicExponent\", exponent.data, (int*)&exponent.size);\n\t\t\t\tif (ASN1_SUCCESS == ret1 && ASN1_SUCCESS == ret2)\n\t\t\t\t\tret = USERPREF_E_SUCCESS;\n\t\t\t}\n\t\t\tif (asn1_pub_key)\n\t\t\t\tasn1_delete_structure(&asn1_pub_key);\n\t\t}\n\t\tif (pkcs1)\n\t\t\tasn1_delete_structure(&pkcs1);\n\t} else {\n\t\tdebug_info(\"WARNING: Could not read public key\");\n\t}\n\n\t/* now generate certificates */\n\tif (USERPREF_E_SUCCESS == ret && 0 != modulus.size && 0 != exponent.size) {\n\t\tgnutls_datum_t essentially_null = { (unsigned char*)strdup(\"abababababababab\"), strlen(\"abababababababab\") };\n\n\t\tgnutls_x509_privkey_t fake_privkey;\n\t\tgnutls_x509_crt_t dev_cert;\n\n\t\tgnutls_x509_privkey_init(&fake_privkey);\n\t\tgnutls_x509_crt_init(&dev_cert);\n\n\t\tif (GNUTLS_E_SUCCESS == gnutls_x509_privkey_import_rsa_raw(fake_privkey, &modulus, &exponent, &essentially_null, &essentially_null, &essentially_null, &essentially_null)) {\n\t\t\t/* generate device certificate */\n\t\t\tgnutls_x509_crt_set_key(dev_cert, fake_privkey);\n\t\t\tgnutls_x509_crt_set_serial(dev_cert, \"\\x00\", 1);\n\t\t\tgnutls_x509_crt_set_version(dev_cert, 3);\n\t\t\tgnutls_x509_crt_set_ca_status(dev_cert, 0);\n\t\t\tgnutls_x509_crt_set_activation_time(dev_cert, time(NULL));\n\t\t\tgnutls_x509_crt_set_expiration_time(dev_cert, time(NULL) + (60 * 60 * 24 * 365 * 10));\n\n\t\t\t/* use custom hash generation for compatibility with the \"Apple ecosystem\" */\n\t\t\tconst gnutls_digest_algorithm_t dig_sha1 = GNUTLS_DIG_SHA1;\n\t\t\tsize_t hash_size = gnutls_hash_get_len(dig_sha1);\n\t\t\tunsigned char hash[hash_size];\n\t\t\tif (gnutls_hash_fast(dig_sha1, der_pub_key.data, der_pub_key.size, (unsigned char*)&hash) < 0) {\n\t\t\t\tdebug_info(\"ERROR: Failed to generate SHA1 for public key\");\n\t\t\t} else {\n\t\t\t\tgnutls_x509_crt_set_subject_key_id(dev_cert, hash, hash_size);\n\t\t\t}\n\n\t\t\tgnutls_x509_crt_set_key_usage(dev_cert, GNUTLS_KEY_DIGITAL_SIGNATURE | GNUTLS_KEY_KEY_ENCIPHERMENT);\n\t\t\tgnutls_x509_crt_sign(dev_cert, root_cert, root_privkey);\n\n\t\t\tif (USERPREF_E_SUCCESS == ret) {\n\t\t\t\t/* if everything went well, export in PEM format */\n\t\t\t\tsize_t export_size = 0;\n\t\t\t\tgnutls_x509_crt_export(dev_cert, GNUTLS_X509_FMT_PEM, NULL, &export_size);\n\t\t\t\tdev_cert_pem.data = gnutls_malloc(export_size);\n\t\t\t\tgnutls_x509_crt_export(dev_cert, GNUTLS_X509_FMT_PEM, dev_cert_pem.data, &export_size);\n\t\t\t\tdev_cert_pem.size = export_size;\n\t\t\t} else {\n\t\t\t\tdebug_info(\"ERROR: Signing device certificate with root private key failed!\");\n\t\t\t}\n\t\t}\n\n\t\tif (essentially_null.data)\n\t\t\tfree(essentially_null.data);\n\n\t\tgnutls_x509_crt_deinit(dev_cert);\n\t\tgnutls_x509_privkey_deinit(fake_privkey);\n\t}\n\n\tgnutls_x509_crt_deinit(root_cert);\n\tgnutls_x509_crt_deinit(host_cert);\n\tgnutls_x509_privkey_deinit(root_privkey);\n\tgnutls_x509_privkey_deinit(host_privkey);\n\n\tgnutls_free(modulus.data);\n\tgnutls_free(exponent.data);\n\n\tgnutls_free(der_pub_key.data);\n#endif\n\tif (NULL != root_cert_pem.data && 0 != root_cert_pem.size &&\n\t\tNULL != host_cert_pem.data && 0 != host_cert_pem.size)\n\t\tret = USERPREF_E_SUCCESS;\n\n\t/* now set keys and certificates */\n\tpair_record_set_item_from_key_data(pair_record, USERPREF_DEVICE_CERTIFICATE_KEY, &dev_cert_pem);\n\tpair_record_set_item_from_key_data(pair_record, USERPREF_HOST_PRIVATE_KEY_KEY, &host_key_pem);\n\tpair_record_set_item_from_key_data(pair_record, USERPREF_HOST_CERTIFICATE_KEY, &host_cert_pem);\n\tpair_record_set_item_from_key_data(pair_record, USERPREF_ROOT_PRIVATE_KEY_KEY, &root_key_pem);\n\tpair_record_set_item_from_key_data(pair_record, USERPREF_ROOT_CERTIFICATE_KEY, &root_cert_pem);\n\n\tif (dev_cert_pem.data)\n\t\tfree(dev_cert_pem.data);\n\tif (root_key_pem.data)\n\t\tfree(root_key_pem.data);\n\tif (root_cert_pem.data)\n\t\tfree(root_cert_pem.data);\n\tif (host_key_pem.data)\n\t\tfree(host_key_pem.data);\n\tif (host_cert_pem.data)\n\t\tfree(host_cert_pem.data);\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_new_dict",
          "args": [],
          "line": 804
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"device public key follows:\\n%.*s\"",
            "public_key.size",
            "public_key.data"
          ],
          "line": 802
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"device refused to send public key.\""
          ],
          "line": 799
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lockdownd_get_device_public_key_as_key_data",
          "args": [
            "client",
            "&public_key"
          ],
          "line": 797
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_get_device_public_key_as_key_data",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "600-619",
          "snippet": "static lockdownd_error_t lockdownd_get_device_public_key_as_key_data(lockdownd_client_t client, key_data_t *public_key)\n{\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\tplist_t value = NULL;\n\tchar *value_value = NULL;\n\tuint64_t size = 0;\n\n\tret = lockdownd_get_value(client, NULL, \"DevicePublicKey\", &value);\n\tif (ret != LOCKDOWN_E_SUCCESS) {\n\t\treturn ret;\n\t}\n\tplist_get_data_val(value, &value_value, &size);\n\tpublic_key->data = (unsigned char*)value_value;\n\tpublic_key->size = size;\n\n\tplist_free(value);\n\tvalue = NULL;\n\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic lockdownd_error_t lockdownd_get_device_public_key_as_key_data(lockdownd_client_t client, key_data_t *public_key)\n{\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\tplist_t value = NULL;\n\tchar *value_value = NULL;\n\tuint64_t size = 0;\n\n\tret = lockdownd_get_value(client, NULL, \"DevicePublicKey\", &value);\n\tif (ret != LOCKDOWN_E_SUCCESS) {\n\t\treturn ret;\n\t}\n\tplist_get_data_val(value, &value_value, &size);\n\tpublic_key->data = (unsigned char*)value_value;\n\tpublic_key->size = size;\n\n\tplist_free(value);\n\tvalue = NULL;\n\n\treturn ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic lockdownd_error_t pair_record_generate(lockdownd_client_t client, plist_t *pair_record)\n{\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tkey_data_t public_key = { NULL, 0 };\n\tchar* host_id = NULL;\n\tchar* system_buid = NULL;\n\n\t/* retrieve device public key */\n\tret = lockdownd_get_device_public_key_as_key_data(client, &public_key);\n\tif (ret != LOCKDOWN_E_SUCCESS) {\n\t\tdebug_info(\"device refused to send public key.\");\n\t\tgoto leave;\n\t}\n\tdebug_info(\"device public key follows:\\n%.*s\", public_key.size, public_key.data);\n\n\t*pair_record = plist_new_dict();\n\n\t/* generate keys and certificates into pair record */\n\tuserpref_error_t uret = USERPREF_E_SUCCESS;\n\turet = pair_record_generate_keys_and_certs(*pair_record, public_key);\n\tswitch(uret) {\n\t\tcase USERPREF_E_INVALID_ARG:\n\t\t\tret = LOCKDOWN_E_INVALID_ARG;\n\t\t\tbreak;\n\t\tcase USERPREF_E_INVALID_CONF:\n\t\t\tret = LOCKDOWN_E_INVALID_CONF;\n\t\t\tbreak;\n\t\tcase USERPREF_E_SSL_ERROR:\n\t\t\tret = LOCKDOWN_E_SSL_ERROR;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\n\t/* set SystemBUID */\n\tuserpref_read_system_buid(&system_buid);\n\tif (system_buid) {\n\t\tplist_dict_set_item(*pair_record, USERPREF_SYSTEM_BUID_KEY, plist_new_string(system_buid));\n\t}\n\n\t/* set HostID */\n\thost_id = generate_uuid();\n\tpair_record_set_host_id(*pair_record, host_id);\n\nleave:\n\tif (host_id)\n\t\tfree(host_id);\n\tif (system_buid)\n\t\tfree(system_buid);\n\tif (public_key.data)\n\t\tfree(public_key.data);\n\n\treturn ret;\n}"
  },
  {
    "function_name": "lockdownd_pair_record_to_plist",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
    "lines": "763-777",
    "snippet": "static plist_t lockdownd_pair_record_to_plist(lockdownd_pair_record_t pair_record)\n{\n\tif (!pair_record)\n\t\treturn NULL;\n\n\t/* setup request plist */\n\tplist_t dict = plist_new_dict();\n\tplist_dict_set_item(dict, \"DeviceCertificate\", plist_new_data(pair_record->device_certificate, strlen(pair_record->device_certificate)));\n\tplist_dict_set_item(dict, \"HostCertificate\", plist_new_data(pair_record->host_certificate, strlen(pair_record->host_certificate)));\n\tplist_dict_set_item(dict, \"HostID\", plist_new_string(pair_record->host_id));\n\tplist_dict_set_item(dict, \"RootCertificate\", plist_new_data(pair_record->root_certificate, strlen(pair_record->root_certificate)));\n\tplist_dict_set_item(dict, \"SystemBUID\", plist_new_string(pair_record->system_buid));\n\n\treturn dict;\n}",
    "includes": [
      "#include <windows.h>",
      "#include \"asprintf.h\"",
      "#include \"common/utils.h\"",
      "#include \"common/userpref.h\"",
      "#include \"common/debug.h\"",
      "#include \"idevice.h\"",
      "#include \"lockdown.h\"",
      "#include \"property_list_service.h\"",
      "#include <plist/plist.h>",
      "#include <gnutls/crypto.h>",
      "#include <gnutls/x509.h>",
      "#include <libtasn1.h>",
      "#include <openssl/x509v3.h>",
      "#include <openssl/x509.h>",
      "#include <openssl/pem.h>",
      "#include <unistd.h>",
      "#include <ctype.h>",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"SystemBUID\"",
            "plist_new_string(pair_record->system_buid)"
          ],
          "line": 774
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "pair_record->system_buid"
          ],
          "line": 774
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"RootCertificate\"",
            "plist_new_data(pair_record->root_certificate, strlen(pair_record->root_certificate))"
          ],
          "line": 773
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_data",
          "args": [
            "pair_record->root_certificate",
            "strlen(pair_record->root_certificate)"
          ],
          "line": 773
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "pair_record->root_certificate"
          ],
          "line": 773
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"HostID\"",
            "plist_new_string(pair_record->host_id)"
          ],
          "line": 772
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "pair_record->host_id"
          ],
          "line": 772
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"HostCertificate\"",
            "plist_new_data(pair_record->host_certificate, strlen(pair_record->host_certificate))"
          ],
          "line": 771
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_data",
          "args": [
            "pair_record->host_certificate",
            "strlen(pair_record->host_certificate)"
          ],
          "line": 771
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "pair_record->host_certificate"
          ],
          "line": 771
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"DeviceCertificate\"",
            "plist_new_data(pair_record->device_certificate, strlen(pair_record->device_certificate))"
          ],
          "line": 770
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_data",
          "args": [
            "pair_record->device_certificate",
            "strlen(pair_record->device_certificate)"
          ],
          "line": 770
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "pair_record->device_certificate"
          ],
          "line": 770
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_dict",
          "args": [],
          "line": 769
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic plist_t lockdownd_pair_record_to_plist(lockdownd_pair_record_t pair_record)\n{\n\tif (!pair_record)\n\t\treturn NULL;\n\n\t/* setup request plist */\n\tplist_t dict = plist_new_dict();\n\tplist_dict_set_item(dict, \"DeviceCertificate\", plist_new_data(pair_record->device_certificate, strlen(pair_record->device_certificate)));\n\tplist_dict_set_item(dict, \"HostCertificate\", plist_new_data(pair_record->host_certificate, strlen(pair_record->host_certificate)));\n\tplist_dict_set_item(dict, \"HostID\", plist_new_string(pair_record->host_id));\n\tplist_dict_set_item(dict, \"RootCertificate\", plist_new_data(pair_record->root_certificate, strlen(pair_record->root_certificate)));\n\tplist_dict_set_item(dict, \"SystemBUID\", plist_new_string(pair_record->system_buid));\n\n\treturn dict;\n}"
  },
  {
    "function_name": "lockdownd_client_new_with_handshake",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
    "lines": "671-753",
    "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_client_new_with_handshake(idevice_t device, lockdownd_client_t *client, const char *label)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_SUCCESS;\n\tlockdownd_client_t client_loc = NULL;\n\tplist_t pair_record = NULL;\n\tchar *host_id = NULL;\n\tchar *type = NULL;\n\n\tret = lockdownd_client_new(device, &client_loc, label);\n\tif (LOCKDOWN_E_SUCCESS != ret) {\n\t\tdebug_info(\"failed to create lockdownd client.\");\n\t\treturn ret;\n\t}\n\n\t/* perform handshake */\n\tif (LOCKDOWN_E_SUCCESS != lockdownd_query_type(client_loc, &type)) {\n\t\tdebug_info(\"QueryType failed in the lockdownd client.\");\n\t\tret = LOCKDOWN_E_NOT_ENOUGH_DATA;\n\t} else {\n\t\tif (strcmp(\"com.apple.mobile.lockdown\", type)) {\n\t\t\tdebug_info(\"Warning QueryType request returned \\\"%s\\\".\", type);\n\t\t}\n\t}\n\tfree(type);\n\n\tuserpref_read_pair_record(client_loc->udid, &pair_record);\n\tif (pair_record) {\n\t\tpair_record_get_host_id(pair_record, &host_id);\n\t}\n\tif (LOCKDOWN_E_SUCCESS == ret && !host_id) {\n\t\tret = LOCKDOWN_E_INVALID_CONF;\n\t}\n\n\tif (LOCKDOWN_E_SUCCESS == ret && !pair_record) {\n\t\t/* attempt pairing */\n\t\tret = lockdownd_pair(client_loc, NULL);\n\t}\n\n\tplist_free(pair_record);\n\tpair_record = NULL;\n\n\t/* in any case, we need to validate pairing to receive trusted host status */\n\tret = lockdownd_validate_pair(client_loc, NULL);\n\n\t/* if not paired yet, let's do it now */\n\tif (LOCKDOWN_E_INVALID_HOST_ID == ret) {\n\t\tfree(host_id);\n\t\thost_id = NULL;\n\t\tret = lockdownd_pair(client_loc, NULL);\n\t\tif (LOCKDOWN_E_SUCCESS == ret) {\n\t\t\tret = lockdownd_validate_pair(client_loc, NULL);\n\t\t} else if (LOCKDOWN_E_PAIRING_DIALOG_RESPONSE_PENDING == ret) {\n\t\t\tdebug_info(\"Device shows the pairing dialog.\");\n\t\t}\n\t}\n\n\tif (LOCKDOWN_E_SUCCESS == ret) {\n\t\tif (!host_id) {\n\t\t\tuserpref_read_pair_record(client_loc->udid, &pair_record);\n\t\t\tif (pair_record) {\n\t\t\t\tpair_record_get_host_id(pair_record, &host_id);\n\t\t\t\tplist_free(pair_record);\n\t\t\t}\n\t\t}\n\n\t\tret = lockdownd_start_session(client_loc, host_id, NULL, NULL);\n\t\tif (LOCKDOWN_E_SUCCESS != ret) {\n\t\t\tdebug_info(\"Session opening failed.\");\n\t\t}\n\n\t}\n\n\tif (LOCKDOWN_E_SUCCESS == ret) {\n\t\t*client = client_loc;\n\t} else {\n\t\tlockdownd_client_free(client_loc);\n\t}\n\tfree(host_id);\n\treturn ret;\n}",
    "includes": [
      "#include <windows.h>",
      "#include \"asprintf.h\"",
      "#include \"common/utils.h\"",
      "#include \"common/userpref.h\"",
      "#include \"common/debug.h\"",
      "#include \"idevice.h\"",
      "#include \"lockdown.h\"",
      "#include \"property_list_service.h\"",
      "#include <plist/plist.h>",
      "#include <gnutls/crypto.h>",
      "#include <gnutls/x509.h>",
      "#include <libtasn1.h>",
      "#include <openssl/x509v3.h>",
      "#include <openssl/x509.h>",
      "#include <openssl/pem.h>",
      "#include <unistd.h>",
      "#include <ctype.h>",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "host_id"
          ],
          "line": 751
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_service_descriptor_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "1522-1528",
          "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_service_descriptor_free(lockdownd_service_descriptor_t service)\n{\n\tif (service)\n\t\tfree(service);\n\n\treturn LOCKDOWN_E_SUCCESS;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_service_descriptor_free(lockdownd_service_descriptor_t service)\n{\n\tif (service)\n\t\tfree(service);\n\n\treturn LOCKDOWN_E_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lockdownd_client_free",
          "args": [
            "client_loc"
          ],
          "line": 749
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_client_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "322-336",
          "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_client_free(lockdownd_client_t client)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tif (client->session_id) {\n\t\tlockdownd_stop_session(client, client->session_id);\n\t}\n\n\tret = lockdownd_client_free_simple(client);\n\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_client_free(lockdownd_client_t client)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tif (client->session_id) {\n\t\tlockdownd_stop_session(client, client->session_id);\n\t}\n\n\tret = lockdownd_client_free_simple(client);\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"Session opening failed.\""
          ],
          "line": 741
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lockdownd_start_session",
          "args": [
            "client_loc",
            "host_id",
            "NULL",
            "NULL"
          ],
          "line": 739
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_start_session",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "1117-1212",
          "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_start_session(lockdownd_client_t client, const char *host_id, char **session_id, int *ssl_enabled)\n{\n\tlockdownd_error_t ret = LOCKDOWN_E_SUCCESS;\n\tproperty_list_service_error_t plret;\n\tplist_t dict = NULL;\n\n\tif (!client || !host_id)\n\t\tret = LOCKDOWN_E_INVALID_ARG;\n\n\t/* if we have a running session, stop current one first */\n\tif (client->session_id) {\n\t\tlockdownd_stop_session(client, client->session_id);\n\t}\n\n\t/* setup request plist */\n\tdict = plist_new_dict();\n\tplist_dict_add_label(dict, client->label);\n\tplist_dict_set_item(dict,\"Request\", plist_new_string(\"StartSession\"));\n\n\t/* add host id */\n\tif (host_id) {\n\t\tplist_dict_set_item(dict, \"HostID\", plist_new_string(host_id));\n\t}\n\n\t/* add system buid */\n\tchar *system_buid = NULL;\n\tuserpref_read_system_buid(&system_buid);\n\tif (system_buid) {\n\t\tplist_dict_set_item(dict, \"SystemBUID\", plist_new_string(system_buid));\n\t\tif (system_buid) {\n\t\t\tfree(system_buid);\n\t\t\tsystem_buid = NULL;\n\t\t}\n\t}\n\n\tret = lockdownd_send(client, dict);\n\tplist_free(dict);\n\tdict = NULL;\n\n\tif (ret != LOCKDOWN_E_SUCCESS)\n\t\treturn ret;\n\n\tret = lockdownd_receive(client, &dict);\n\n\tif (!dict)\n\t\treturn LOCKDOWN_E_PLIST_ERROR;\n\n\tret = lockdown_check_result(dict, \"StartSession\");\n\tif (ret == LOCKDOWN_E_SUCCESS) {\n\t\tuint8_t use_ssl = 0;\n\n\t\tplist_t enable_ssl = plist_dict_get_item(dict, \"EnableSessionSSL\");\n\t\tif (enable_ssl && (plist_get_node_type(enable_ssl) == PLIST_BOOLEAN)) {\n\t\t\tplist_get_bool_val(enable_ssl, &use_ssl);\n\t\t}\n\t\tdebug_info(\"Session startup OK\");\n\n\t\tif (ssl_enabled != NULL)\n\t\t\t*ssl_enabled = use_ssl;\n\n\t\t/* store session id, we need it for StopSession */\n\t\tplist_t session_node = plist_dict_get_item(dict, \"SessionID\");\n\t\tif (session_node && (plist_get_node_type(session_node) == PLIST_STRING)) {\n\t\t\tplist_get_string_val(session_node, &client->session_id);\n\t\t}\n\n\t\tif (client->session_id) {\n\t\t\tdebug_info(\"SessionID: %s\", client->session_id);\n\t\t\tif (session_id != NULL)\n\t\t\t\t*session_id = strdup(client->session_id);\n\t\t} else {\n\t\t\tdebug_info(\"Failed to get SessionID!\");\n\t\t}\n\n\t\tdebug_info(\"Enable SSL Session: %s\", (use_ssl?\"true\":\"false\"));\n\n\t\tif (use_ssl) {\n\t\t\tplret = property_list_service_enable_ssl(client->parent);\n\t\t\tif (plret == PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\t\t\tret = LOCKDOWN_E_SUCCESS;\n\t\t\t\tclient->ssl_enabled = 1;\n\t\t\t} else {\n\t\t\t\tret = LOCKDOWN_E_SSL_ERROR;\n\t\t\t\tclient->ssl_enabled = 0;\n\t\t\t}\n\t\t} else {\n\t\t\tclient->ssl_enabled = 0;\n\t\t\tret = LOCKDOWN_E_SUCCESS;\n\t\t}\n\t}\n\n\tplist_free(dict);\n\tdict = NULL;\n\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_start_session(lockdownd_client_t client, const char *host_id, char **session_id, int *ssl_enabled)\n{\n\tlockdownd_error_t ret = LOCKDOWN_E_SUCCESS;\n\tproperty_list_service_error_t plret;\n\tplist_t dict = NULL;\n\n\tif (!client || !host_id)\n\t\tret = LOCKDOWN_E_INVALID_ARG;\n\n\t/* if we have a running session, stop current one first */\n\tif (client->session_id) {\n\t\tlockdownd_stop_session(client, client->session_id);\n\t}\n\n\t/* setup request plist */\n\tdict = plist_new_dict();\n\tplist_dict_add_label(dict, client->label);\n\tplist_dict_set_item(dict,\"Request\", plist_new_string(\"StartSession\"));\n\n\t/* add host id */\n\tif (host_id) {\n\t\tplist_dict_set_item(dict, \"HostID\", plist_new_string(host_id));\n\t}\n\n\t/* add system buid */\n\tchar *system_buid = NULL;\n\tuserpref_read_system_buid(&system_buid);\n\tif (system_buid) {\n\t\tplist_dict_set_item(dict, \"SystemBUID\", plist_new_string(system_buid));\n\t\tif (system_buid) {\n\t\t\tfree(system_buid);\n\t\t\tsystem_buid = NULL;\n\t\t}\n\t}\n\n\tret = lockdownd_send(client, dict);\n\tplist_free(dict);\n\tdict = NULL;\n\n\tif (ret != LOCKDOWN_E_SUCCESS)\n\t\treturn ret;\n\n\tret = lockdownd_receive(client, &dict);\n\n\tif (!dict)\n\t\treturn LOCKDOWN_E_PLIST_ERROR;\n\n\tret = lockdown_check_result(dict, \"StartSession\");\n\tif (ret == LOCKDOWN_E_SUCCESS) {\n\t\tuint8_t use_ssl = 0;\n\n\t\tplist_t enable_ssl = plist_dict_get_item(dict, \"EnableSessionSSL\");\n\t\tif (enable_ssl && (plist_get_node_type(enable_ssl) == PLIST_BOOLEAN)) {\n\t\t\tplist_get_bool_val(enable_ssl, &use_ssl);\n\t\t}\n\t\tdebug_info(\"Session startup OK\");\n\n\t\tif (ssl_enabled != NULL)\n\t\t\t*ssl_enabled = use_ssl;\n\n\t\t/* store session id, we need it for StopSession */\n\t\tplist_t session_node = plist_dict_get_item(dict, \"SessionID\");\n\t\tif (session_node && (plist_get_node_type(session_node) == PLIST_STRING)) {\n\t\t\tplist_get_string_val(session_node, &client->session_id);\n\t\t}\n\n\t\tif (client->session_id) {\n\t\t\tdebug_info(\"SessionID: %s\", client->session_id);\n\t\t\tif (session_id != NULL)\n\t\t\t\t*session_id = strdup(client->session_id);\n\t\t} else {\n\t\t\tdebug_info(\"Failed to get SessionID!\");\n\t\t}\n\n\t\tdebug_info(\"Enable SSL Session: %s\", (use_ssl?\"true\":\"false\"));\n\n\t\tif (use_ssl) {\n\t\t\tplret = property_list_service_enable_ssl(client->parent);\n\t\t\tif (plret == PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\t\t\tret = LOCKDOWN_E_SUCCESS;\n\t\t\t\tclient->ssl_enabled = 1;\n\t\t\t} else {\n\t\t\t\tret = LOCKDOWN_E_SSL_ERROR;\n\t\t\t\tclient->ssl_enabled = 0;\n\t\t\t}\n\t\t} else {\n\t\t\tclient->ssl_enabled = 0;\n\t\t\tret = LOCKDOWN_E_SUCCESS;\n\t\t}\n\t}\n\n\tplist_free(dict);\n\tdict = NULL;\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "pair_record"
          ],
          "line": 735
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pair_record_get_host_id",
          "args": [
            "pair_record",
            "&host_id"
          ],
          "line": 734
        },
        "resolved": true,
        "details": {
          "function_name": "pair_record_get_host_id",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/common/userpref.c",
          "lines": "874-883",
          "snippet": "userpref_error_t pair_record_get_host_id(plist_t pair_record, char** host_id)\n{\n\tplist_t node = plist_dict_get_item(pair_record, USERPREF_HOST_ID_KEY);\n\n\tif (node && plist_get_node_type(node) == PLIST_STRING) {\n\t\tplist_get_string_val(node, host_id);\n\t}\n\n\treturn USERPREF_E_SUCCESS;\n}",
          "includes": [
            "#include \"utils.h\"",
            "#include \"debug.h\"",
            "#include \"userpref.h\"",
            "#include <shlobj.h>",
            "#include <errno.h>",
            "#include <sys/stat.h>",
            "#include <libgen.h>",
            "#include <dirent.h>",
            "#include <libtasn1.h>",
            "#include <gcrypt.h>",
            "#include <gnutls/x509.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/gnutls.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/rsa.h>",
            "#include <openssl/pem.h>",
            "#include <usbmuxd.h>",
            "#include <unistd.h>",
            "#include <pwd.h>",
            "#include <sys/types.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"utils.h\"\n#include \"debug.h\"\n#include \"userpref.h\"\n#include <shlobj.h>\n#include <errno.h>\n#include <sys/stat.h>\n#include <libgen.h>\n#include <dirent.h>\n#include <libtasn1.h>\n#include <gcrypt.h>\n#include <gnutls/x509.h>\n#include <gnutls/crypto.h>\n#include <gnutls/gnutls.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/rsa.h>\n#include <openssl/pem.h>\n#include <usbmuxd.h>\n#include <unistd.h>\n#include <pwd.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nuserpref_error_t pair_record_get_host_id(plist_t pair_record, char** host_id)\n{\n\tplist_t node = plist_dict_get_item(pair_record, USERPREF_HOST_ID_KEY);\n\n\tif (node && plist_get_node_type(node) == PLIST_STRING) {\n\t\tplist_get_string_val(node, host_id);\n\t}\n\n\treturn USERPREF_E_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "userpref_read_pair_record",
          "args": [
            "client_loc->udid",
            "&pair_record"
          ],
          "line": 732
        },
        "resolved": true,
        "details": {
          "function_name": "userpref_read_pair_record",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/common/userpref.c",
          "lines": "333-357",
          "snippet": "userpref_error_t userpref_read_pair_record(const char *udid, plist_t *pair_record)\n{\n\tchar* record_data = NULL;\n\tuint32_t record_size = 0;\n\n\tint res = usbmuxd_read_pair_record(udid, &record_data, &record_size);\n\n\tif (res < 0) {\n\t\tif (record_data)\n\t\t\tfree(record_data);\n\n\t\treturn USERPREF_E_INVALID_CONF;\n\t}\n\n\t*pair_record = NULL;\n\tif (memcmp(record_data, \"bplist00\", 8) == 0) {\n\t\tplist_from_bin(record_data, record_size, pair_record);\n\t} else {\n\t\tplist_from_xml(record_data, record_size, pair_record);\n\t}\n\n\tfree(record_data);\n\n\treturn res == 0 ? USERPREF_E_SUCCESS: USERPREF_E_UNKNOWN_ERROR;\n}",
          "includes": [
            "#include \"utils.h\"",
            "#include \"debug.h\"",
            "#include \"userpref.h\"",
            "#include <shlobj.h>",
            "#include <errno.h>",
            "#include <sys/stat.h>",
            "#include <libgen.h>",
            "#include <dirent.h>",
            "#include <libtasn1.h>",
            "#include <gcrypt.h>",
            "#include <gnutls/x509.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/gnutls.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/rsa.h>",
            "#include <openssl/pem.h>",
            "#include <usbmuxd.h>",
            "#include <unistd.h>",
            "#include <pwd.h>",
            "#include <sys/types.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <stdint.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"utils.h\"\n#include \"debug.h\"\n#include \"userpref.h\"\n#include <shlobj.h>\n#include <errno.h>\n#include <sys/stat.h>\n#include <libgen.h>\n#include <dirent.h>\n#include <libtasn1.h>\n#include <gcrypt.h>\n#include <gnutls/x509.h>\n#include <gnutls/crypto.h>\n#include <gnutls/gnutls.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/rsa.h>\n#include <openssl/pem.h>\n#include <usbmuxd.h>\n#include <unistd.h>\n#include <pwd.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdint.h>\n#include <stdio.h>\n#include <config.h>\n\nuserpref_error_t userpref_read_pair_record(const char *udid, plist_t *pair_record)\n{\n\tchar* record_data = NULL;\n\tuint32_t record_size = 0;\n\n\tint res = usbmuxd_read_pair_record(udid, &record_data, &record_size);\n\n\tif (res < 0) {\n\t\tif (record_data)\n\t\t\tfree(record_data);\n\n\t\treturn USERPREF_E_INVALID_CONF;\n\t}\n\n\t*pair_record = NULL;\n\tif (memcmp(record_data, \"bplist00\", 8) == 0) {\n\t\tplist_from_bin(record_data, record_size, pair_record);\n\t} else {\n\t\tplist_from_xml(record_data, record_size, pair_record);\n\t}\n\n\tfree(record_data);\n\n\treturn res == 0 ? USERPREF_E_SUCCESS: USERPREF_E_UNKNOWN_ERROR;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"Device shows the pairing dialog.\""
          ],
          "line": 726
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lockdownd_validate_pair",
          "args": [
            "client_loc",
            "NULL"
          ],
          "line": 724
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_validate_pair",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "1043-1046",
          "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_validate_pair(lockdownd_client_t client, lockdownd_pair_record_t pair_record)\n{\n\treturn lockdownd_do_pair(client, pair_record, \"ValidatePair\", NULL, NULL);\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_validate_pair(lockdownd_client_t client, lockdownd_pair_record_t pair_record)\n{\n\treturn lockdownd_do_pair(client, pair_record, \"ValidatePair\", NULL, NULL);\n}"
        }
      },
      {
        "call_info": {
          "callee": "lockdownd_pair",
          "args": [
            "client_loc",
            "NULL"
          ],
          "line": 722
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_pair",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "1025-1036",
          "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_pair(lockdownd_client_t client, lockdownd_pair_record_t pair_record)\n{\n\n\tplist_t options = plist_new_dict();\n\tplist_dict_set_item(options, \"ExtendedPairingErrors\", plist_new_bool(1));\n\n\tlockdownd_error_t ret = lockdownd_do_pair(client, pair_record, \"Pair\", options, NULL);\n\n\tplist_free(options);\n\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_pair(lockdownd_client_t client, lockdownd_pair_record_t pair_record)\n{\n\n\tplist_t options = plist_new_dict();\n\tplist_dict_set_item(options, \"ExtendedPairingErrors\", plist_new_bool(1));\n\n\tlockdownd_error_t ret = lockdownd_do_pair(client, pair_record, \"Pair\", options, NULL);\n\n\tplist_free(options);\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "pair_record"
          ],
          "line": 712
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"Warning QueryType request returned \\\"%s\\\".\"",
            "type"
          ],
          "line": 694
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "\"com.apple.mobile.lockdown\"",
            "type"
          ],
          "line": 693
        },
        "resolved": true,
        "details": {
          "function_name": "plist_strcmp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/tools/idevicebackup.c",
          "lines": "296-309",
          "snippet": "static int plist_strcmp(plist_t node, const char *str)\n{\n\tchar *buffer = NULL;\n\tint ret = 0;\n\n\tif (plist_get_node_type(node) != PLIST_STRING)\n\t\treturn ret;\n\n\tplist_get_string_val(node, &buffer);\n\tret = strcmp(buffer, str);\n\tfree(buffer);\n\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"common/utils.h\"",
            "#include <libimobiledevice/afc.h>",
            "#include <libimobiledevice/notification_proxy.h>",
            "#include <libimobiledevice/mobilebackup.h>",
            "#include <libimobiledevice/lockdown.h>",
            "#include <libimobiledevice/libimobiledevice.h>",
            "#include <time.h>",
            "#include <ctype.h>",
            "#include <unistd.h>",
            "#include <gcrypt.h>",
            "#include <openssl/sha.h>",
            "#include <signal.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"common/utils.h\"\n#include <libimobiledevice/afc.h>\n#include <libimobiledevice/notification_proxy.h>\n#include <libimobiledevice/mobilebackup.h>\n#include <libimobiledevice/lockdown.h>\n#include <libimobiledevice/libimobiledevice.h>\n#include <time.h>\n#include <ctype.h>\n#include <unistd.h>\n#include <gcrypt.h>\n#include <openssl/sha.h>\n#include <signal.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int plist_strcmp(plist_t node, const char *str)\n{\n\tchar *buffer = NULL;\n\tint ret = 0;\n\n\tif (plist_get_node_type(node) != PLIST_STRING)\n\t\treturn ret;\n\n\tplist_get_string_val(node, &buffer);\n\tret = strcmp(buffer, str);\n\tfree(buffer);\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"QueryType failed in the lockdownd client.\""
          ],
          "line": 690
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lockdownd_query_type",
          "args": [
            "client_loc",
            "&type"
          ],
          "line": 689
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_query_type",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "381-424",
          "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_query_type(lockdownd_client_t client, char **type)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tplist_t dict = plist_new_dict();\n\tplist_dict_add_label(dict, client->label);\n\tplist_dict_set_item(dict,\"Request\", plist_new_string(\"QueryType\"));\n\n\tdebug_info(\"called\");\n\tret = lockdownd_send(client, dict);\n\n\tplist_free(dict);\n\tdict = NULL;\n\n\tret = lockdownd_receive(client, &dict);\n\n\tif (LOCKDOWN_E_SUCCESS != ret)\n\t\treturn ret;\n\n\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\tplist_t type_node = plist_dict_get_item(dict, \"Type\");\n\tif (type_node && (plist_get_node_type(type_node) == PLIST_STRING)) {\n\t\tchar* typestr = NULL;\n\t\tplist_get_string_val(type_node, &typestr);\n\t\tdebug_info(\"success with type %s\", typestr);\n\t\t/* return the type if requested */\n\t\tif (type != NULL) {\n\t\t\t*type = typestr;\n\t\t} else {\n\t\t\tfree(typestr);\n\t\t}\n\t\tret = LOCKDOWN_E_SUCCESS;\n\t} else {\n\t\tdebug_info(\"hmm. QueryType response does not contain a type?!\");\n\t\tdebug_plist(dict);\n\t}\n\tplist_free(dict);\n\tdict = NULL;\n\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_query_type(lockdownd_client_t client, char **type)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tplist_t dict = plist_new_dict();\n\tplist_dict_add_label(dict, client->label);\n\tplist_dict_set_item(dict,\"Request\", plist_new_string(\"QueryType\"));\n\n\tdebug_info(\"called\");\n\tret = lockdownd_send(client, dict);\n\n\tplist_free(dict);\n\tdict = NULL;\n\n\tret = lockdownd_receive(client, &dict);\n\n\tif (LOCKDOWN_E_SUCCESS != ret)\n\t\treturn ret;\n\n\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\tplist_t type_node = plist_dict_get_item(dict, \"Type\");\n\tif (type_node && (plist_get_node_type(type_node) == PLIST_STRING)) {\n\t\tchar* typestr = NULL;\n\t\tplist_get_string_val(type_node, &typestr);\n\t\tdebug_info(\"success with type %s\", typestr);\n\t\t/* return the type if requested */\n\t\tif (type != NULL) {\n\t\t\t*type = typestr;\n\t\t} else {\n\t\t\tfree(typestr);\n\t\t}\n\t\tret = LOCKDOWN_E_SUCCESS;\n\t} else {\n\t\tdebug_info(\"hmm. QueryType response does not contain a type?!\");\n\t\tdebug_plist(dict);\n\t}\n\tplist_free(dict);\n\tdict = NULL;\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"failed to create lockdownd client.\""
          ],
          "line": 684
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lockdownd_client_new",
          "args": [
            "device",
            "&client_loc",
            "label"
          ],
          "line": 682
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_client_new_with_handshake",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "671-753",
          "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_client_new_with_handshake(idevice_t device, lockdownd_client_t *client, const char *label)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_SUCCESS;\n\tlockdownd_client_t client_loc = NULL;\n\tplist_t pair_record = NULL;\n\tchar *host_id = NULL;\n\tchar *type = NULL;\n\n\tret = lockdownd_client_new(device, &client_loc, label);\n\tif (LOCKDOWN_E_SUCCESS != ret) {\n\t\tdebug_info(\"failed to create lockdownd client.\");\n\t\treturn ret;\n\t}\n\n\t/* perform handshake */\n\tif (LOCKDOWN_E_SUCCESS != lockdownd_query_type(client_loc, &type)) {\n\t\tdebug_info(\"QueryType failed in the lockdownd client.\");\n\t\tret = LOCKDOWN_E_NOT_ENOUGH_DATA;\n\t} else {\n\t\tif (strcmp(\"com.apple.mobile.lockdown\", type)) {\n\t\t\tdebug_info(\"Warning QueryType request returned \\\"%s\\\".\", type);\n\t\t}\n\t}\n\tfree(type);\n\n\tuserpref_read_pair_record(client_loc->udid, &pair_record);\n\tif (pair_record) {\n\t\tpair_record_get_host_id(pair_record, &host_id);\n\t}\n\tif (LOCKDOWN_E_SUCCESS == ret && !host_id) {\n\t\tret = LOCKDOWN_E_INVALID_CONF;\n\t}\n\n\tif (LOCKDOWN_E_SUCCESS == ret && !pair_record) {\n\t\t/* attempt pairing */\n\t\tret = lockdownd_pair(client_loc, NULL);\n\t}\n\n\tplist_free(pair_record);\n\tpair_record = NULL;\n\n\t/* in any case, we need to validate pairing to receive trusted host status */\n\tret = lockdownd_validate_pair(client_loc, NULL);\n\n\t/* if not paired yet, let's do it now */\n\tif (LOCKDOWN_E_INVALID_HOST_ID == ret) {\n\t\tfree(host_id);\n\t\thost_id = NULL;\n\t\tret = lockdownd_pair(client_loc, NULL);\n\t\tif (LOCKDOWN_E_SUCCESS == ret) {\n\t\t\tret = lockdownd_validate_pair(client_loc, NULL);\n\t\t} else if (LOCKDOWN_E_PAIRING_DIALOG_RESPONSE_PENDING == ret) {\n\t\t\tdebug_info(\"Device shows the pairing dialog.\");\n\t\t}\n\t}\n\n\tif (LOCKDOWN_E_SUCCESS == ret) {\n\t\tif (!host_id) {\n\t\t\tuserpref_read_pair_record(client_loc->udid, &pair_record);\n\t\t\tif (pair_record) {\n\t\t\t\tpair_record_get_host_id(pair_record, &host_id);\n\t\t\t\tplist_free(pair_record);\n\t\t\t}\n\t\t}\n\n\t\tret = lockdownd_start_session(client_loc, host_id, NULL, NULL);\n\t\tif (LOCKDOWN_E_SUCCESS != ret) {\n\t\t\tdebug_info(\"Session opening failed.\");\n\t\t}\n\n\t}\n\n\tif (LOCKDOWN_E_SUCCESS == ret) {\n\t\t*client = client_loc;\n\t} else {\n\t\tlockdownd_client_free(client_loc);\n\t}\n\tfree(host_id);\n\treturn ret;\n}",
          "note": "cyclic_reference_detected"
        }
      }
    ],
    "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_client_new_with_handshake(idevice_t device, lockdownd_client_t *client, const char *label)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_SUCCESS;\n\tlockdownd_client_t client_loc = NULL;\n\tplist_t pair_record = NULL;\n\tchar *host_id = NULL;\n\tchar *type = NULL;\n\n\tret = lockdownd_client_new(device, &client_loc, label);\n\tif (LOCKDOWN_E_SUCCESS != ret) {\n\t\tdebug_info(\"failed to create lockdownd client.\");\n\t\treturn ret;\n\t}\n\n\t/* perform handshake */\n\tif (LOCKDOWN_E_SUCCESS != lockdownd_query_type(client_loc, &type)) {\n\t\tdebug_info(\"QueryType failed in the lockdownd client.\");\n\t\tret = LOCKDOWN_E_NOT_ENOUGH_DATA;\n\t} else {\n\t\tif (strcmp(\"com.apple.mobile.lockdown\", type)) {\n\t\t\tdebug_info(\"Warning QueryType request returned \\\"%s\\\".\", type);\n\t\t}\n\t}\n\tfree(type);\n\n\tuserpref_read_pair_record(client_loc->udid, &pair_record);\n\tif (pair_record) {\n\t\tpair_record_get_host_id(pair_record, &host_id);\n\t}\n\tif (LOCKDOWN_E_SUCCESS == ret && !host_id) {\n\t\tret = LOCKDOWN_E_INVALID_CONF;\n\t}\n\n\tif (LOCKDOWN_E_SUCCESS == ret && !pair_record) {\n\t\t/* attempt pairing */\n\t\tret = lockdownd_pair(client_loc, NULL);\n\t}\n\n\tplist_free(pair_record);\n\tpair_record = NULL;\n\n\t/* in any case, we need to validate pairing to receive trusted host status */\n\tret = lockdownd_validate_pair(client_loc, NULL);\n\n\t/* if not paired yet, let's do it now */\n\tif (LOCKDOWN_E_INVALID_HOST_ID == ret) {\n\t\tfree(host_id);\n\t\thost_id = NULL;\n\t\tret = lockdownd_pair(client_loc, NULL);\n\t\tif (LOCKDOWN_E_SUCCESS == ret) {\n\t\t\tret = lockdownd_validate_pair(client_loc, NULL);\n\t\t} else if (LOCKDOWN_E_PAIRING_DIALOG_RESPONSE_PENDING == ret) {\n\t\t\tdebug_info(\"Device shows the pairing dialog.\");\n\t\t}\n\t}\n\n\tif (LOCKDOWN_E_SUCCESS == ret) {\n\t\tif (!host_id) {\n\t\t\tuserpref_read_pair_record(client_loc->udid, &pair_record);\n\t\t\tif (pair_record) {\n\t\t\t\tpair_record_get_host_id(pair_record, &host_id);\n\t\t\t\tplist_free(pair_record);\n\t\t\t}\n\t\t}\n\n\t\tret = lockdownd_start_session(client_loc, host_id, NULL, NULL);\n\t\tif (LOCKDOWN_E_SUCCESS != ret) {\n\t\t\tdebug_info(\"Session opening failed.\");\n\t\t}\n\n\t}\n\n\tif (LOCKDOWN_E_SUCCESS == ret) {\n\t\t*client = client_loc;\n\t} else {\n\t\tlockdownd_client_free(client_loc);\n\t}\n\tfree(host_id);\n\treturn ret;\n}"
  },
  {
    "function_name": "lockdownd_client_new",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
    "lines": "638-669",
    "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_client_new(idevice_t device, lockdownd_client_t *client, const char *label)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tstatic struct lockdownd_service_descriptor service = {\n\t\t.port = 0xf27e,\n\t\t.ssl_enabled = 0\n\t};\n\n\tproperty_list_service_client_t plistclient = NULL;\n\tif (property_list_service_client_new(device, (lockdownd_service_descriptor_t)&service, &plistclient) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tdebug_info(\"could not connect to lockdownd (device %s)\", device->udid);\n\t\treturn LOCKDOWN_E_MUX_ERROR;\n\t}\n\n\tlockdownd_client_t client_loc = (lockdownd_client_t) malloc(sizeof(struct lockdownd_client_private));\n\tclient_loc->parent = plistclient;\n\tclient_loc->ssl_enabled = 0;\n\tclient_loc->session_id = NULL;\n\n\tif (idevice_get_udid(device, &client_loc->udid) != IDEVICE_E_SUCCESS) {\n\t\tdebug_info(\"failed to get device udid.\");\n\t}\n\tdebug_info(\"device udid: %s\", client_loc->udid);\n\n\tclient_loc->label = label ? strdup(label) : NULL;\n\n\t*client = client_loc;\n\n\treturn LOCKDOWN_E_SUCCESS;\n}",
    "includes": [
      "#include <windows.h>",
      "#include \"asprintf.h\"",
      "#include \"common/utils.h\"",
      "#include \"common/userpref.h\"",
      "#include \"common/debug.h\"",
      "#include \"idevice.h\"",
      "#include \"lockdown.h\"",
      "#include \"property_list_service.h\"",
      "#include <plist/plist.h>",
      "#include <gnutls/crypto.h>",
      "#include <gnutls/x509.h>",
      "#include <libtasn1.h>",
      "#include <openssl/x509v3.h>",
      "#include <openssl/x509.h>",
      "#include <openssl/pem.h>",
      "#include <unistd.h>",
      "#include <ctype.h>",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "label"
          ],
          "line": 664
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"device udid: %s\"",
            "client_loc->udid"
          ],
          "line": 662
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"failed to get device udid.\""
          ],
          "line": 660
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "idevice_get_udid",
          "args": [
            "device",
            "&client_loc->udid"
          ],
          "line": 659
        },
        "resolved": true,
        "details": {
          "function_name": "idevice_get_udid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/idevice.c",
          "lines": "480-487",
          "snippet": "LIBIMOBILEDEVICE_API idevice_error_t idevice_get_udid(idevice_t device, char **udid)\n{\n\tif (!device || !udid)\n\t\treturn IDEVICE_E_INVALID_ARG;\n\n\t*udid = strdup(device->udid);\n\treturn IDEVICE_E_SUCCESS;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"common/thread.h\"",
            "#include \"common/userpref.h\"",
            "#include \"idevice.h\"",
            "#include <gnutls/gnutls.h>",
            "#include <openssl/ssl.h>",
            "#include <openssl/err.h>",
            "#include <usbmuxd.h>",
            "#include <windows.h>",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "LIBIMOBILEDEVICE_API idevice_error_t"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"common/thread.h\"\n#include \"common/userpref.h\"\n#include \"idevice.h\"\n#include <gnutls/gnutls.h>\n#include <openssl/ssl.h>\n#include <openssl/err.h>\n#include <usbmuxd.h>\n#include <windows.h>\n#include <errno.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API idevice_error_t;\n\nLIBIMOBILEDEVICE_API idevice_error_t idevice_get_udid(idevice_t device, char **udid)\n{\n\tif (!device || !udid)\n\t\treturn IDEVICE_E_INVALID_ARG;\n\n\t*udid = strdup(device->udid);\n\treturn IDEVICE_E_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "malloc",
          "args": [
            "sizeof(struct lockdownd_client_private)"
          ],
          "line": 654
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"could not connect to lockdownd (device %s)\"",
            "device->udid"
          ],
          "line": 650
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "property_list_service_client_new",
          "args": [
            "device",
            "(lockdownd_service_descriptor_t)&service",
            "&plistclient"
          ],
          "line": 649
        },
        "resolved": true,
        "details": {
          "function_name": "property_list_service_client_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
          "lines": "57-75",
          "snippet": "LIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_client_new(idevice_t device, lockdownd_service_descriptor_t service, property_list_service_client_t *client)\n{\n\tif (!device || !service || service->port == 0 || !client || *client)\n\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\n\tservice_client_t parent = NULL;\n\tservice_error_t rerr = service_client_new(device, service, &parent);\n\tif (rerr != SERVICE_E_SUCCESS) {\n\t\treturn service_to_property_list_service_error(rerr);\n\t}\n\n\t/* create client object */\n\tproperty_list_service_client_t client_loc = (property_list_service_client_t)malloc(sizeof(struct property_list_service_client_private));\n\tclient_loc->parent = parent;\n\n\t/* all done, return success */\n\t*client = client_loc;\n\treturn PROPERTY_LIST_SERVICE_E_SUCCESS;\n}",
          "includes": [
            "#include \"endianness.h\"",
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_client_new(idevice_t device, lockdownd_service_descriptor_t service, property_list_service_client_t *client)\n{\n\tif (!device || !service || service->port == 0 || !client || *client)\n\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\n\tservice_client_t parent = NULL;\n\tservice_error_t rerr = service_client_new(device, service, &parent);\n\tif (rerr != SERVICE_E_SUCCESS) {\n\t\treturn service_to_property_list_service_error(rerr);\n\t}\n\n\t/* create client object */\n\tproperty_list_service_client_t client_loc = (property_list_service_client_t)malloc(sizeof(struct property_list_service_client_private));\n\tclient_loc->parent = parent;\n\n\t/* all done, return success */\n\t*client = client_loc;\n\treturn PROPERTY_LIST_SERVICE_E_SUCCESS;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_client_new(idevice_t device, lockdownd_client_t *client, const char *label)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tstatic struct lockdownd_service_descriptor service = {\n\t\t.port = 0xf27e,\n\t\t.ssl_enabled = 0\n\t};\n\n\tproperty_list_service_client_t plistclient = NULL;\n\tif (property_list_service_client_new(device, (lockdownd_service_descriptor_t)&service, &plistclient) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tdebug_info(\"could not connect to lockdownd (device %s)\", device->udid);\n\t\treturn LOCKDOWN_E_MUX_ERROR;\n\t}\n\n\tlockdownd_client_t client_loc = (lockdownd_client_t) malloc(sizeof(struct lockdownd_client_private));\n\tclient_loc->parent = plistclient;\n\tclient_loc->ssl_enabled = 0;\n\tclient_loc->session_id = NULL;\n\n\tif (idevice_get_udid(device, &client_loc->udid) != IDEVICE_E_SUCCESS) {\n\t\tdebug_info(\"failed to get device udid.\");\n\t}\n\tdebug_info(\"device udid: %s\", client_loc->udid);\n\n\tclient_loc->label = label ? strdup(label) : NULL;\n\n\t*client = client_loc;\n\n\treturn LOCKDOWN_E_SUCCESS;\n}"
  },
  {
    "function_name": "lockdownd_get_device_name",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
    "lines": "621-636",
    "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_get_device_name(lockdownd_client_t client, char **device_name)\n{\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\tplist_t value = NULL;\n\n\tret = lockdownd_get_value(client, NULL, \"DeviceName\", &value);\n\tif (ret != LOCKDOWN_E_SUCCESS) {\n\t\treturn ret;\n\t}\n\tplist_get_string_val(value, device_name);\n\n\tplist_free(value);\n\tvalue = NULL;\n\n\treturn ret;\n}",
    "includes": [
      "#include <windows.h>",
      "#include \"asprintf.h\"",
      "#include \"common/utils.h\"",
      "#include \"common/userpref.h\"",
      "#include \"common/debug.h\"",
      "#include \"idevice.h\"",
      "#include \"lockdown.h\"",
      "#include \"property_list_service.h\"",
      "#include <plist/plist.h>",
      "#include <gnutls/crypto.h>",
      "#include <gnutls/x509.h>",
      "#include <libtasn1.h>",
      "#include <openssl/x509v3.h>",
      "#include <openssl/x509.h>",
      "#include <openssl/pem.h>",
      "#include <unistd.h>",
      "#include <ctype.h>",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "value"
          ],
          "line": 632
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_get_string_val",
          "args": [
            "value",
            "device_name"
          ],
          "line": 630
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lockdownd_get_value",
          "args": [
            "client",
            "NULL",
            "\"DeviceName\"",
            "&value"
          ],
          "line": 626
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_get_value",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "426-478",
          "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_get_value(lockdownd_client_t client, const char *domain, const char *key, plist_t *value)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tplist_t dict = NULL;\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\t/* setup request plist */\n\tdict = plist_new_dict();\n\tplist_dict_add_label(dict, client->label);\n\tif (domain) {\n\t\tplist_dict_set_item(dict,\"Domain\", plist_new_string(domain));\n\t}\n\tif (key) {\n\t\tplist_dict_set_item(dict,\"Key\", plist_new_string(key));\n\t}\n\tplist_dict_set_item(dict,\"Request\", plist_new_string(\"GetValue\"));\n\n\t/* send to device */\n\tret = lockdownd_send(client, dict);\n\n\tplist_free(dict);\n\tdict = NULL;\n\n\tif (ret != LOCKDOWN_E_SUCCESS)\n\t\treturn ret;\n\n\t/* Now get device's answer */\n\tret = lockdownd_receive(client, &dict);\n\tif (ret != LOCKDOWN_E_SUCCESS)\n\t\treturn ret;\n\n\tret = lockdown_check_result(dict, \"GetValue\");\n\tif (ret == LOCKDOWN_E_SUCCESS) {\n\t\tdebug_info(\"success\");\n\t}\n\n\tif (ret != LOCKDOWN_E_SUCCESS) {\n\t\tplist_free(dict);\n\t\treturn ret;\n\t}\n\n\tplist_t value_node = plist_dict_get_item(dict, \"Value\");\n\n\tif (value_node) {\n\t\tdebug_info(\"has a value\");\n\t\t*value = plist_copy(value_node);\n\t}\n\n\tplist_free(dict);\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_get_value(lockdownd_client_t client, const char *domain, const char *key, plist_t *value)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tplist_t dict = NULL;\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\t/* setup request plist */\n\tdict = plist_new_dict();\n\tplist_dict_add_label(dict, client->label);\n\tif (domain) {\n\t\tplist_dict_set_item(dict,\"Domain\", plist_new_string(domain));\n\t}\n\tif (key) {\n\t\tplist_dict_set_item(dict,\"Key\", plist_new_string(key));\n\t}\n\tplist_dict_set_item(dict,\"Request\", plist_new_string(\"GetValue\"));\n\n\t/* send to device */\n\tret = lockdownd_send(client, dict);\n\n\tplist_free(dict);\n\tdict = NULL;\n\n\tif (ret != LOCKDOWN_E_SUCCESS)\n\t\treturn ret;\n\n\t/* Now get device's answer */\n\tret = lockdownd_receive(client, &dict);\n\tif (ret != LOCKDOWN_E_SUCCESS)\n\t\treturn ret;\n\n\tret = lockdown_check_result(dict, \"GetValue\");\n\tif (ret == LOCKDOWN_E_SUCCESS) {\n\t\tdebug_info(\"success\");\n\t}\n\n\tif (ret != LOCKDOWN_E_SUCCESS) {\n\t\tplist_free(dict);\n\t\treturn ret;\n\t}\n\n\tplist_t value_node = plist_dict_get_item(dict, \"Value\");\n\n\tif (value_node) {\n\t\tdebug_info(\"has a value\");\n\t\t*value = plist_copy(value_node);\n\t}\n\n\tplist_free(dict);\n\treturn ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_get_device_name(lockdownd_client_t client, char **device_name)\n{\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\tplist_t value = NULL;\n\n\tret = lockdownd_get_value(client, NULL, \"DeviceName\", &value);\n\tif (ret != LOCKDOWN_E_SUCCESS) {\n\t\treturn ret;\n\t}\n\tplist_get_string_val(value, device_name);\n\n\tplist_free(value);\n\tvalue = NULL;\n\n\treturn ret;\n}"
  },
  {
    "function_name": "lockdownd_get_device_public_key_as_key_data",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
    "lines": "600-619",
    "snippet": "static lockdownd_error_t lockdownd_get_device_public_key_as_key_data(lockdownd_client_t client, key_data_t *public_key)\n{\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\tplist_t value = NULL;\n\tchar *value_value = NULL;\n\tuint64_t size = 0;\n\n\tret = lockdownd_get_value(client, NULL, \"DevicePublicKey\", &value);\n\tif (ret != LOCKDOWN_E_SUCCESS) {\n\t\treturn ret;\n\t}\n\tplist_get_data_val(value, &value_value, &size);\n\tpublic_key->data = (unsigned char*)value_value;\n\tpublic_key->size = size;\n\n\tplist_free(value);\n\tvalue = NULL;\n\n\treturn ret;\n}",
    "includes": [
      "#include <windows.h>",
      "#include \"asprintf.h\"",
      "#include \"common/utils.h\"",
      "#include \"common/userpref.h\"",
      "#include \"common/debug.h\"",
      "#include \"idevice.h\"",
      "#include \"lockdown.h\"",
      "#include \"property_list_service.h\"",
      "#include <plist/plist.h>",
      "#include <gnutls/crypto.h>",
      "#include <gnutls/x509.h>",
      "#include <libtasn1.h>",
      "#include <openssl/x509v3.h>",
      "#include <openssl/x509.h>",
      "#include <openssl/pem.h>",
      "#include <unistd.h>",
      "#include <ctype.h>",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "value"
          ],
          "line": 615
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_get_data_val",
          "args": [
            "value",
            "&value_value",
            "&size"
          ],
          "line": 611
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lockdownd_get_value",
          "args": [
            "client",
            "NULL",
            "\"DevicePublicKey\"",
            "&value"
          ],
          "line": 607
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_get_value",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "426-478",
          "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_get_value(lockdownd_client_t client, const char *domain, const char *key, plist_t *value)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tplist_t dict = NULL;\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\t/* setup request plist */\n\tdict = plist_new_dict();\n\tplist_dict_add_label(dict, client->label);\n\tif (domain) {\n\t\tplist_dict_set_item(dict,\"Domain\", plist_new_string(domain));\n\t}\n\tif (key) {\n\t\tplist_dict_set_item(dict,\"Key\", plist_new_string(key));\n\t}\n\tplist_dict_set_item(dict,\"Request\", plist_new_string(\"GetValue\"));\n\n\t/* send to device */\n\tret = lockdownd_send(client, dict);\n\n\tplist_free(dict);\n\tdict = NULL;\n\n\tif (ret != LOCKDOWN_E_SUCCESS)\n\t\treturn ret;\n\n\t/* Now get device's answer */\n\tret = lockdownd_receive(client, &dict);\n\tif (ret != LOCKDOWN_E_SUCCESS)\n\t\treturn ret;\n\n\tret = lockdown_check_result(dict, \"GetValue\");\n\tif (ret == LOCKDOWN_E_SUCCESS) {\n\t\tdebug_info(\"success\");\n\t}\n\n\tif (ret != LOCKDOWN_E_SUCCESS) {\n\t\tplist_free(dict);\n\t\treturn ret;\n\t}\n\n\tplist_t value_node = plist_dict_get_item(dict, \"Value\");\n\n\tif (value_node) {\n\t\tdebug_info(\"has a value\");\n\t\t*value = plist_copy(value_node);\n\t}\n\n\tplist_free(dict);\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_get_value(lockdownd_client_t client, const char *domain, const char *key, plist_t *value)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tplist_t dict = NULL;\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\t/* setup request plist */\n\tdict = plist_new_dict();\n\tplist_dict_add_label(dict, client->label);\n\tif (domain) {\n\t\tplist_dict_set_item(dict,\"Domain\", plist_new_string(domain));\n\t}\n\tif (key) {\n\t\tplist_dict_set_item(dict,\"Key\", plist_new_string(key));\n\t}\n\tplist_dict_set_item(dict,\"Request\", plist_new_string(\"GetValue\"));\n\n\t/* send to device */\n\tret = lockdownd_send(client, dict);\n\n\tplist_free(dict);\n\tdict = NULL;\n\n\tif (ret != LOCKDOWN_E_SUCCESS)\n\t\treturn ret;\n\n\t/* Now get device's answer */\n\tret = lockdownd_receive(client, &dict);\n\tif (ret != LOCKDOWN_E_SUCCESS)\n\t\treturn ret;\n\n\tret = lockdown_check_result(dict, \"GetValue\");\n\tif (ret == LOCKDOWN_E_SUCCESS) {\n\t\tdebug_info(\"success\");\n\t}\n\n\tif (ret != LOCKDOWN_E_SUCCESS) {\n\t\tplist_free(dict);\n\t\treturn ret;\n\t}\n\n\tplist_t value_node = plist_dict_get_item(dict, \"Value\");\n\n\tif (value_node) {\n\t\tdebug_info(\"has a value\");\n\t\t*value = plist_copy(value_node);\n\t}\n\n\tplist_free(dict);\n\treturn ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic lockdownd_error_t lockdownd_get_device_public_key_as_key_data(lockdownd_client_t client, key_data_t *public_key)\n{\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\tplist_t value = NULL;\n\tchar *value_value = NULL;\n\tuint64_t size = 0;\n\n\tret = lockdownd_get_value(client, NULL, \"DevicePublicKey\", &value);\n\tif (ret != LOCKDOWN_E_SUCCESS) {\n\t\treturn ret;\n\t}\n\tplist_get_data_val(value, &value_value, &size);\n\tpublic_key->data = (unsigned char*)value_value;\n\tpublic_key->size = size;\n\n\tplist_free(value);\n\tvalue = NULL;\n\n\treturn ret;\n}"
  },
  {
    "function_name": "lockdownd_get_device_udid",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
    "lines": "575-589",
    "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_get_device_udid(lockdownd_client_t client, char **udid)\n{\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\tplist_t value = NULL;\n\n\tret = lockdownd_get_value(client, NULL, \"UniqueDeviceID\", &value);\n\tif (ret != LOCKDOWN_E_SUCCESS) {\n\t\treturn ret;\n\t}\n\tplist_get_string_val(value, udid);\n\n\tplist_free(value);\n\tvalue = NULL;\n\treturn ret;\n}",
    "includes": [
      "#include <windows.h>",
      "#include \"asprintf.h\"",
      "#include \"common/utils.h\"",
      "#include \"common/userpref.h\"",
      "#include \"common/debug.h\"",
      "#include \"idevice.h\"",
      "#include \"lockdown.h\"",
      "#include \"property_list_service.h\"",
      "#include <plist/plist.h>",
      "#include <gnutls/crypto.h>",
      "#include <gnutls/x509.h>",
      "#include <libtasn1.h>",
      "#include <openssl/x509v3.h>",
      "#include <openssl/x509.h>",
      "#include <openssl/pem.h>",
      "#include <unistd.h>",
      "#include <ctype.h>",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "value"
          ],
          "line": 586
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_get_string_val",
          "args": [
            "value",
            "udid"
          ],
          "line": 584
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lockdownd_get_value",
          "args": [
            "client",
            "NULL",
            "\"UniqueDeviceID\"",
            "&value"
          ],
          "line": 580
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_get_value",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "426-478",
          "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_get_value(lockdownd_client_t client, const char *domain, const char *key, plist_t *value)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tplist_t dict = NULL;\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\t/* setup request plist */\n\tdict = plist_new_dict();\n\tplist_dict_add_label(dict, client->label);\n\tif (domain) {\n\t\tplist_dict_set_item(dict,\"Domain\", plist_new_string(domain));\n\t}\n\tif (key) {\n\t\tplist_dict_set_item(dict,\"Key\", plist_new_string(key));\n\t}\n\tplist_dict_set_item(dict,\"Request\", plist_new_string(\"GetValue\"));\n\n\t/* send to device */\n\tret = lockdownd_send(client, dict);\n\n\tplist_free(dict);\n\tdict = NULL;\n\n\tif (ret != LOCKDOWN_E_SUCCESS)\n\t\treturn ret;\n\n\t/* Now get device's answer */\n\tret = lockdownd_receive(client, &dict);\n\tif (ret != LOCKDOWN_E_SUCCESS)\n\t\treturn ret;\n\n\tret = lockdown_check_result(dict, \"GetValue\");\n\tif (ret == LOCKDOWN_E_SUCCESS) {\n\t\tdebug_info(\"success\");\n\t}\n\n\tif (ret != LOCKDOWN_E_SUCCESS) {\n\t\tplist_free(dict);\n\t\treturn ret;\n\t}\n\n\tplist_t value_node = plist_dict_get_item(dict, \"Value\");\n\n\tif (value_node) {\n\t\tdebug_info(\"has a value\");\n\t\t*value = plist_copy(value_node);\n\t}\n\n\tplist_free(dict);\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_get_value(lockdownd_client_t client, const char *domain, const char *key, plist_t *value)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tplist_t dict = NULL;\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\t/* setup request plist */\n\tdict = plist_new_dict();\n\tplist_dict_add_label(dict, client->label);\n\tif (domain) {\n\t\tplist_dict_set_item(dict,\"Domain\", plist_new_string(domain));\n\t}\n\tif (key) {\n\t\tplist_dict_set_item(dict,\"Key\", plist_new_string(key));\n\t}\n\tplist_dict_set_item(dict,\"Request\", plist_new_string(\"GetValue\"));\n\n\t/* send to device */\n\tret = lockdownd_send(client, dict);\n\n\tplist_free(dict);\n\tdict = NULL;\n\n\tif (ret != LOCKDOWN_E_SUCCESS)\n\t\treturn ret;\n\n\t/* Now get device's answer */\n\tret = lockdownd_receive(client, &dict);\n\tif (ret != LOCKDOWN_E_SUCCESS)\n\t\treturn ret;\n\n\tret = lockdown_check_result(dict, \"GetValue\");\n\tif (ret == LOCKDOWN_E_SUCCESS) {\n\t\tdebug_info(\"success\");\n\t}\n\n\tif (ret != LOCKDOWN_E_SUCCESS) {\n\t\tplist_free(dict);\n\t\treturn ret;\n\t}\n\n\tplist_t value_node = plist_dict_get_item(dict, \"Value\");\n\n\tif (value_node) {\n\t\tdebug_info(\"has a value\");\n\t\t*value = plist_copy(value_node);\n\t}\n\n\tplist_free(dict);\n\treturn ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_get_device_udid(lockdownd_client_t client, char **udid)\n{\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\tplist_t value = NULL;\n\n\tret = lockdownd_get_value(client, NULL, \"UniqueDeviceID\", &value);\n\tif (ret != LOCKDOWN_E_SUCCESS) {\n\t\treturn ret;\n\t}\n\tplist_get_string_val(value, udid);\n\n\tplist_free(value);\n\tvalue = NULL;\n\treturn ret;\n}"
  },
  {
    "function_name": "lockdownd_remove_value",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
    "lines": "528-573",
    "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_remove_value(lockdownd_client_t client, const char *domain, const char *key)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tplist_t dict = NULL;\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\t/* setup request plist */\n\tdict = plist_new_dict();\n\tplist_dict_add_label(dict, client->label);\n\tif (domain) {\n\t\tplist_dict_set_item(dict,\"Domain\", plist_new_string(domain));\n\t}\n\tif (key) {\n\t\tplist_dict_set_item(dict,\"Key\", plist_new_string(key));\n\t}\n\tplist_dict_set_item(dict,\"Request\", plist_new_string(\"RemoveValue\"));\n\n\t/* send to device */\n\tret = lockdownd_send(client, dict);\n\n\tplist_free(dict);\n\tdict = NULL;\n\n\tif (ret != LOCKDOWN_E_SUCCESS)\n\t\treturn ret;\n\n\t/* Now get device's answer */\n\tret = lockdownd_receive(client, &dict);\n\tif (ret != LOCKDOWN_E_SUCCESS)\n\t\treturn ret;\n\n\tret = lockdown_check_result(dict, \"RemoveValue\");\n\tif (ret == LOCKDOWN_E_SUCCESS) {\n\t\tdebug_info(\"success\");\n\t}\n\n\tif (ret != LOCKDOWN_E_SUCCESS) {\n\t\tplist_free(dict);\n\t\treturn ret;\n\t}\n\n\tplist_free(dict);\n\treturn ret;\n}",
    "includes": [
      "#include <windows.h>",
      "#include \"asprintf.h\"",
      "#include \"common/utils.h\"",
      "#include \"common/userpref.h\"",
      "#include \"common/debug.h\"",
      "#include \"idevice.h\"",
      "#include \"lockdown.h\"",
      "#include \"property_list_service.h\"",
      "#include <plist/plist.h>",
      "#include <gnutls/crypto.h>",
      "#include <gnutls/x509.h>",
      "#include <libtasn1.h>",
      "#include <openssl/x509v3.h>",
      "#include <openssl/x509.h>",
      "#include <openssl/pem.h>",
      "#include <unistd.h>",
      "#include <ctype.h>",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "dict"
          ],
          "line": 571
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "dict"
          ],
          "line": 567
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"success\""
          ],
          "line": 563
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lockdown_check_result",
          "args": [
            "dict",
            "\"RemoveValue\""
          ],
          "line": 561
        },
        "resolved": true,
        "details": {
          "function_name": "lockdown_check_result",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "150-223",
          "snippet": "static lockdownd_error_t lockdown_check_result(plist_t dict, const char *query_match)\n{\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tplist_t query_node = plist_dict_get_item(dict, \"Request\");\n\tif (!query_node) {\n\t\treturn ret;\n\t}\n\n\tif (plist_get_node_type(query_node) != PLIST_STRING) {\n\t\treturn ret;\n\t} else {\n\t\tchar *query_value = NULL;\n\n\t\tplist_get_string_val(query_node, &query_value);\n\t\tif (!query_value) {\n\t\t\treturn ret;\n\t\t}\n\n\t\tif (query_match && (strcmp(query_value, query_match) != 0)) {\n\t\t\tfree(query_value);\n\t\t\treturn ret;\n\t\t}\n\n\t\tfree(query_value);\n\t}\n\n\tplist_t result_node = plist_dict_get_item(dict, \"Result\");\n\tif (!result_node) {\n\t\t/* iOS 5: the 'Result' key is not present anymore.\n\t\t   But we need to check for the 'Error' key. */\n\t\tplist_t err_node = plist_dict_get_item(dict, \"Error\");\n\t\tif (err_node) {\n\t\t\tif (plist_get_node_type(err_node) == PLIST_STRING) {\n\t\t\t\tchar *err_value = NULL;\n\n\t\t\t\tplist_get_string_val(err_node, &err_value);\n\t\t\t\tif (err_value) {\n\t\t\t\t\tdebug_info(\"ERROR: %s\", err_value);\n\t\t\t\t\tret = lockdownd_strtoerr(err_value);\n\t\t\t\t\tfree(err_value);\n\t\t\t\t} else {\n\t\t\t\t\tdebug_info(\"ERROR: unknown error occured\");\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn ret;\n\t\t}\n\n\t\tret = LOCKDOWN_E_SUCCESS;\n\n\t\treturn ret;\n\t}\n\n\tplist_type result_type = plist_get_node_type(result_node);\n\tif (result_type == PLIST_STRING) {\n\t\tchar *result_value = NULL;\n\n\t\tplist_get_string_val(result_node, &result_value);\n\t\tif (result_value) {\n\t\t\tif (!strcmp(result_value, \"Success\")) {\n\t\t\t\tret = LOCKDOWN_E_SUCCESS;\n\t\t\t} else if (!strcmp(result_value, \"Failure\")) {\n\t\t\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t\t\t} else {\n\t\t\t\tdebug_info(\"ERROR: unknown result value '%s'\", result_value);\n\t\t\t}\n\t\t}\n\n\t\tif (result_value)\n\t\t\tfree(result_value);\n\t}\n\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic lockdownd_error_t lockdown_check_result(plist_t dict, const char *query_match)\n{\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tplist_t query_node = plist_dict_get_item(dict, \"Request\");\n\tif (!query_node) {\n\t\treturn ret;\n\t}\n\n\tif (plist_get_node_type(query_node) != PLIST_STRING) {\n\t\treturn ret;\n\t} else {\n\t\tchar *query_value = NULL;\n\n\t\tplist_get_string_val(query_node, &query_value);\n\t\tif (!query_value) {\n\t\t\treturn ret;\n\t\t}\n\n\t\tif (query_match && (strcmp(query_value, query_match) != 0)) {\n\t\t\tfree(query_value);\n\t\t\treturn ret;\n\t\t}\n\n\t\tfree(query_value);\n\t}\n\n\tplist_t result_node = plist_dict_get_item(dict, \"Result\");\n\tif (!result_node) {\n\t\t/* iOS 5: the 'Result' key is not present anymore.\n\t\t   But we need to check for the 'Error' key. */\n\t\tplist_t err_node = plist_dict_get_item(dict, \"Error\");\n\t\tif (err_node) {\n\t\t\tif (plist_get_node_type(err_node) == PLIST_STRING) {\n\t\t\t\tchar *err_value = NULL;\n\n\t\t\t\tplist_get_string_val(err_node, &err_value);\n\t\t\t\tif (err_value) {\n\t\t\t\t\tdebug_info(\"ERROR: %s\", err_value);\n\t\t\t\t\tret = lockdownd_strtoerr(err_value);\n\t\t\t\t\tfree(err_value);\n\t\t\t\t} else {\n\t\t\t\t\tdebug_info(\"ERROR: unknown error occured\");\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn ret;\n\t\t}\n\n\t\tret = LOCKDOWN_E_SUCCESS;\n\n\t\treturn ret;\n\t}\n\n\tplist_type result_type = plist_get_node_type(result_node);\n\tif (result_type == PLIST_STRING) {\n\t\tchar *result_value = NULL;\n\n\t\tplist_get_string_val(result_node, &result_value);\n\t\tif (result_value) {\n\t\t\tif (!strcmp(result_value, \"Success\")) {\n\t\t\t\tret = LOCKDOWN_E_SUCCESS;\n\t\t\t} else if (!strcmp(result_value, \"Failure\")) {\n\t\t\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t\t\t} else {\n\t\t\t\tdebug_info(\"ERROR: unknown result value '%s'\", result_value);\n\t\t\t}\n\t\t}\n\n\t\tif (result_value)\n\t\t\tfree(result_value);\n\t}\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lockdownd_receive",
          "args": [
            "client",
            "&dict"
          ],
          "line": 557
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_receive",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "348-364",
          "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_receive(lockdownd_client_t client, plist_t *plist)\n{\n\tif (!client || !plist || (plist && *plist))\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\tlockdownd_error_t ret = LOCKDOWN_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_receive_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t}\n\n\tif (!*plist)\n\t\tret = LOCKDOWN_E_PLIST_ERROR;\n\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_receive(lockdownd_client_t client, plist_t *plist)\n{\n\tif (!client || !plist || (plist && *plist))\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\tlockdownd_error_t ret = LOCKDOWN_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_receive_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t}\n\n\tif (!*plist)\n\t\tret = LOCKDOWN_E_PLIST_ERROR;\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "dict"
          ],
          "line": 550
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lockdownd_send",
          "args": [
            "client",
            "dict"
          ],
          "line": 548
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_send",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "366-379",
          "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_send(lockdownd_client_t client, plist_t plist)\n{\n\tif (!client || !plist)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_send_xml_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t}\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_send(lockdownd_client_t client, plist_t plist)\n{\n\tif (!client || !plist)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_send_xml_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t}\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"Request\"",
            "plist_new_string(\"RemoveValue\")"
          ],
          "line": 545
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "\"RemoveValue\""
          ],
          "line": 545
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"Key\"",
            "plist_new_string(key)"
          ],
          "line": 543
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "key"
          ],
          "line": 543
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"Domain\"",
            "plist_new_string(domain)"
          ],
          "line": 540
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "domain"
          ],
          "line": 540
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_add_label",
          "args": [
            "dict",
            "client->label"
          ],
          "line": 538
        },
        "resolved": true,
        "details": {
          "function_name": "plist_dict_add_label",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "232-238",
          "snippet": "static void plist_dict_add_label(plist_t plist, const char *label)\n{\n\tif (plist && label) {\n\t\tif (plist_get_node_type(plist) == PLIST_DICT)\n\t\t\tplist_dict_set_item(plist, \"Label\", plist_new_string(label));\n\t}\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic void plist_dict_add_label(plist_t plist, const char *label)\n{\n\tif (plist && label) {\n\t\tif (plist_get_node_type(plist) == PLIST_DICT)\n\t\t\tplist_dict_set_item(plist, \"Label\", plist_new_string(label));\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_new_dict",
          "args": [],
          "line": 537
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_remove_value(lockdownd_client_t client, const char *domain, const char *key)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tplist_t dict = NULL;\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\t/* setup request plist */\n\tdict = plist_new_dict();\n\tplist_dict_add_label(dict, client->label);\n\tif (domain) {\n\t\tplist_dict_set_item(dict,\"Domain\", plist_new_string(domain));\n\t}\n\tif (key) {\n\t\tplist_dict_set_item(dict,\"Key\", plist_new_string(key));\n\t}\n\tplist_dict_set_item(dict,\"Request\", plist_new_string(\"RemoveValue\"));\n\n\t/* send to device */\n\tret = lockdownd_send(client, dict);\n\n\tplist_free(dict);\n\tdict = NULL;\n\n\tif (ret != LOCKDOWN_E_SUCCESS)\n\t\treturn ret;\n\n\t/* Now get device's answer */\n\tret = lockdownd_receive(client, &dict);\n\tif (ret != LOCKDOWN_E_SUCCESS)\n\t\treturn ret;\n\n\tret = lockdown_check_result(dict, \"RemoveValue\");\n\tif (ret == LOCKDOWN_E_SUCCESS) {\n\t\tdebug_info(\"success\");\n\t}\n\n\tif (ret != LOCKDOWN_E_SUCCESS) {\n\t\tplist_free(dict);\n\t\treturn ret;\n\t}\n\n\tplist_free(dict);\n\treturn ret;\n}"
  },
  {
    "function_name": "lockdownd_set_value",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
    "lines": "480-526",
    "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_set_value(lockdownd_client_t client, const char *domain, const char *key, plist_t value)\n{\n\tif (!client || !value)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tplist_t dict = NULL;\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\t/* setup request plist */\n\tdict = plist_new_dict();\n\tplist_dict_add_label(dict, client->label);\n\tif (domain) {\n\t\tplist_dict_set_item(dict,\"Domain\", plist_new_string(domain));\n\t}\n\tif (key) {\n\t\tplist_dict_set_item(dict,\"Key\", plist_new_string(key));\n\t}\n\tplist_dict_set_item(dict,\"Request\", plist_new_string(\"SetValue\"));\n\tplist_dict_set_item(dict,\"Value\", value);\n\n\t/* send to device */\n\tret = lockdownd_send(client, dict);\n\n\tplist_free(dict);\n\tdict = NULL;\n\n\tif (ret != LOCKDOWN_E_SUCCESS)\n\t\treturn ret;\n\n\t/* Now get device's answer */\n\tret = lockdownd_receive(client, &dict);\n\tif (ret != LOCKDOWN_E_SUCCESS)\n\t\treturn ret;\n\n\tret = lockdown_check_result(dict, \"SetValue\");\n\tif (ret == LOCKDOWN_E_SUCCESS) {\n\t\tdebug_info(\"success\");\n\t}\n\n\tif (ret != LOCKDOWN_E_SUCCESS) {\n\t\tplist_free(dict);\n\t\treturn ret;\n\t}\n\n\tplist_free(dict);\n\treturn ret;\n}",
    "includes": [
      "#include <windows.h>",
      "#include \"asprintf.h\"",
      "#include \"common/utils.h\"",
      "#include \"common/userpref.h\"",
      "#include \"common/debug.h\"",
      "#include \"idevice.h\"",
      "#include \"lockdown.h\"",
      "#include \"property_list_service.h\"",
      "#include <plist/plist.h>",
      "#include <gnutls/crypto.h>",
      "#include <gnutls/x509.h>",
      "#include <libtasn1.h>",
      "#include <openssl/x509v3.h>",
      "#include <openssl/x509.h>",
      "#include <openssl/pem.h>",
      "#include <unistd.h>",
      "#include <ctype.h>",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "dict"
          ],
          "line": 524
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "dict"
          ],
          "line": 520
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"success\""
          ],
          "line": 516
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lockdown_check_result",
          "args": [
            "dict",
            "\"SetValue\""
          ],
          "line": 514
        },
        "resolved": true,
        "details": {
          "function_name": "lockdown_check_result",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "150-223",
          "snippet": "static lockdownd_error_t lockdown_check_result(plist_t dict, const char *query_match)\n{\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tplist_t query_node = plist_dict_get_item(dict, \"Request\");\n\tif (!query_node) {\n\t\treturn ret;\n\t}\n\n\tif (plist_get_node_type(query_node) != PLIST_STRING) {\n\t\treturn ret;\n\t} else {\n\t\tchar *query_value = NULL;\n\n\t\tplist_get_string_val(query_node, &query_value);\n\t\tif (!query_value) {\n\t\t\treturn ret;\n\t\t}\n\n\t\tif (query_match && (strcmp(query_value, query_match) != 0)) {\n\t\t\tfree(query_value);\n\t\t\treturn ret;\n\t\t}\n\n\t\tfree(query_value);\n\t}\n\n\tplist_t result_node = plist_dict_get_item(dict, \"Result\");\n\tif (!result_node) {\n\t\t/* iOS 5: the 'Result' key is not present anymore.\n\t\t   But we need to check for the 'Error' key. */\n\t\tplist_t err_node = plist_dict_get_item(dict, \"Error\");\n\t\tif (err_node) {\n\t\t\tif (plist_get_node_type(err_node) == PLIST_STRING) {\n\t\t\t\tchar *err_value = NULL;\n\n\t\t\t\tplist_get_string_val(err_node, &err_value);\n\t\t\t\tif (err_value) {\n\t\t\t\t\tdebug_info(\"ERROR: %s\", err_value);\n\t\t\t\t\tret = lockdownd_strtoerr(err_value);\n\t\t\t\t\tfree(err_value);\n\t\t\t\t} else {\n\t\t\t\t\tdebug_info(\"ERROR: unknown error occured\");\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn ret;\n\t\t}\n\n\t\tret = LOCKDOWN_E_SUCCESS;\n\n\t\treturn ret;\n\t}\n\n\tplist_type result_type = plist_get_node_type(result_node);\n\tif (result_type == PLIST_STRING) {\n\t\tchar *result_value = NULL;\n\n\t\tplist_get_string_val(result_node, &result_value);\n\t\tif (result_value) {\n\t\t\tif (!strcmp(result_value, \"Success\")) {\n\t\t\t\tret = LOCKDOWN_E_SUCCESS;\n\t\t\t} else if (!strcmp(result_value, \"Failure\")) {\n\t\t\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t\t\t} else {\n\t\t\t\tdebug_info(\"ERROR: unknown result value '%s'\", result_value);\n\t\t\t}\n\t\t}\n\n\t\tif (result_value)\n\t\t\tfree(result_value);\n\t}\n\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic lockdownd_error_t lockdown_check_result(plist_t dict, const char *query_match)\n{\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tplist_t query_node = plist_dict_get_item(dict, \"Request\");\n\tif (!query_node) {\n\t\treturn ret;\n\t}\n\n\tif (plist_get_node_type(query_node) != PLIST_STRING) {\n\t\treturn ret;\n\t} else {\n\t\tchar *query_value = NULL;\n\n\t\tplist_get_string_val(query_node, &query_value);\n\t\tif (!query_value) {\n\t\t\treturn ret;\n\t\t}\n\n\t\tif (query_match && (strcmp(query_value, query_match) != 0)) {\n\t\t\tfree(query_value);\n\t\t\treturn ret;\n\t\t}\n\n\t\tfree(query_value);\n\t}\n\n\tplist_t result_node = plist_dict_get_item(dict, \"Result\");\n\tif (!result_node) {\n\t\t/* iOS 5: the 'Result' key is not present anymore.\n\t\t   But we need to check for the 'Error' key. */\n\t\tplist_t err_node = plist_dict_get_item(dict, \"Error\");\n\t\tif (err_node) {\n\t\t\tif (plist_get_node_type(err_node) == PLIST_STRING) {\n\t\t\t\tchar *err_value = NULL;\n\n\t\t\t\tplist_get_string_val(err_node, &err_value);\n\t\t\t\tif (err_value) {\n\t\t\t\t\tdebug_info(\"ERROR: %s\", err_value);\n\t\t\t\t\tret = lockdownd_strtoerr(err_value);\n\t\t\t\t\tfree(err_value);\n\t\t\t\t} else {\n\t\t\t\t\tdebug_info(\"ERROR: unknown error occured\");\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn ret;\n\t\t}\n\n\t\tret = LOCKDOWN_E_SUCCESS;\n\n\t\treturn ret;\n\t}\n\n\tplist_type result_type = plist_get_node_type(result_node);\n\tif (result_type == PLIST_STRING) {\n\t\tchar *result_value = NULL;\n\n\t\tplist_get_string_val(result_node, &result_value);\n\t\tif (result_value) {\n\t\t\tif (!strcmp(result_value, \"Success\")) {\n\t\t\t\tret = LOCKDOWN_E_SUCCESS;\n\t\t\t} else if (!strcmp(result_value, \"Failure\")) {\n\t\t\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t\t\t} else {\n\t\t\t\tdebug_info(\"ERROR: unknown result value '%s'\", result_value);\n\t\t\t}\n\t\t}\n\n\t\tif (result_value)\n\t\t\tfree(result_value);\n\t}\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lockdownd_receive",
          "args": [
            "client",
            "&dict"
          ],
          "line": 510
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_receive",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "348-364",
          "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_receive(lockdownd_client_t client, plist_t *plist)\n{\n\tif (!client || !plist || (plist && *plist))\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\tlockdownd_error_t ret = LOCKDOWN_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_receive_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t}\n\n\tif (!*plist)\n\t\tret = LOCKDOWN_E_PLIST_ERROR;\n\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_receive(lockdownd_client_t client, plist_t *plist)\n{\n\tif (!client || !plist || (plist && *plist))\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\tlockdownd_error_t ret = LOCKDOWN_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_receive_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t}\n\n\tif (!*plist)\n\t\tret = LOCKDOWN_E_PLIST_ERROR;\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "dict"
          ],
          "line": 503
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lockdownd_send",
          "args": [
            "client",
            "dict"
          ],
          "line": 501
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_send",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "366-379",
          "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_send(lockdownd_client_t client, plist_t plist)\n{\n\tif (!client || !plist)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_send_xml_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t}\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_send(lockdownd_client_t client, plist_t plist)\n{\n\tif (!client || !plist)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_send_xml_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t}\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"Value\"",
            "value"
          ],
          "line": 498
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"Request\"",
            "plist_new_string(\"SetValue\")"
          ],
          "line": 497
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "\"SetValue\""
          ],
          "line": 497
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"Key\"",
            "plist_new_string(key)"
          ],
          "line": 495
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "key"
          ],
          "line": 495
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"Domain\"",
            "plist_new_string(domain)"
          ],
          "line": 492
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "domain"
          ],
          "line": 492
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_add_label",
          "args": [
            "dict",
            "client->label"
          ],
          "line": 490
        },
        "resolved": true,
        "details": {
          "function_name": "plist_dict_add_label",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "232-238",
          "snippet": "static void plist_dict_add_label(plist_t plist, const char *label)\n{\n\tif (plist && label) {\n\t\tif (plist_get_node_type(plist) == PLIST_DICT)\n\t\t\tplist_dict_set_item(plist, \"Label\", plist_new_string(label));\n\t}\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic void plist_dict_add_label(plist_t plist, const char *label)\n{\n\tif (plist && label) {\n\t\tif (plist_get_node_type(plist) == PLIST_DICT)\n\t\t\tplist_dict_set_item(plist, \"Label\", plist_new_string(label));\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_new_dict",
          "args": [],
          "line": 489
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_set_value(lockdownd_client_t client, const char *domain, const char *key, plist_t value)\n{\n\tif (!client || !value)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tplist_t dict = NULL;\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\t/* setup request plist */\n\tdict = plist_new_dict();\n\tplist_dict_add_label(dict, client->label);\n\tif (domain) {\n\t\tplist_dict_set_item(dict,\"Domain\", plist_new_string(domain));\n\t}\n\tif (key) {\n\t\tplist_dict_set_item(dict,\"Key\", plist_new_string(key));\n\t}\n\tplist_dict_set_item(dict,\"Request\", plist_new_string(\"SetValue\"));\n\tplist_dict_set_item(dict,\"Value\", value);\n\n\t/* send to device */\n\tret = lockdownd_send(client, dict);\n\n\tplist_free(dict);\n\tdict = NULL;\n\n\tif (ret != LOCKDOWN_E_SUCCESS)\n\t\treturn ret;\n\n\t/* Now get device's answer */\n\tret = lockdownd_receive(client, &dict);\n\tif (ret != LOCKDOWN_E_SUCCESS)\n\t\treturn ret;\n\n\tret = lockdown_check_result(dict, \"SetValue\");\n\tif (ret == LOCKDOWN_E_SUCCESS) {\n\t\tdebug_info(\"success\");\n\t}\n\n\tif (ret != LOCKDOWN_E_SUCCESS) {\n\t\tplist_free(dict);\n\t\treturn ret;\n\t}\n\n\tplist_free(dict);\n\treturn ret;\n}"
  },
  {
    "function_name": "lockdownd_get_value",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
    "lines": "426-478",
    "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_get_value(lockdownd_client_t client, const char *domain, const char *key, plist_t *value)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tplist_t dict = NULL;\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\t/* setup request plist */\n\tdict = plist_new_dict();\n\tplist_dict_add_label(dict, client->label);\n\tif (domain) {\n\t\tplist_dict_set_item(dict,\"Domain\", plist_new_string(domain));\n\t}\n\tif (key) {\n\t\tplist_dict_set_item(dict,\"Key\", plist_new_string(key));\n\t}\n\tplist_dict_set_item(dict,\"Request\", plist_new_string(\"GetValue\"));\n\n\t/* send to device */\n\tret = lockdownd_send(client, dict);\n\n\tplist_free(dict);\n\tdict = NULL;\n\n\tif (ret != LOCKDOWN_E_SUCCESS)\n\t\treturn ret;\n\n\t/* Now get device's answer */\n\tret = lockdownd_receive(client, &dict);\n\tif (ret != LOCKDOWN_E_SUCCESS)\n\t\treturn ret;\n\n\tret = lockdown_check_result(dict, \"GetValue\");\n\tif (ret == LOCKDOWN_E_SUCCESS) {\n\t\tdebug_info(\"success\");\n\t}\n\n\tif (ret != LOCKDOWN_E_SUCCESS) {\n\t\tplist_free(dict);\n\t\treturn ret;\n\t}\n\n\tplist_t value_node = plist_dict_get_item(dict, \"Value\");\n\n\tif (value_node) {\n\t\tdebug_info(\"has a value\");\n\t\t*value = plist_copy(value_node);\n\t}\n\n\tplist_free(dict);\n\treturn ret;\n}",
    "includes": [
      "#include <windows.h>",
      "#include \"asprintf.h\"",
      "#include \"common/utils.h\"",
      "#include \"common/userpref.h\"",
      "#include \"common/debug.h\"",
      "#include \"idevice.h\"",
      "#include \"lockdown.h\"",
      "#include \"property_list_service.h\"",
      "#include <plist/plist.h>",
      "#include <gnutls/crypto.h>",
      "#include <gnutls/x509.h>",
      "#include <libtasn1.h>",
      "#include <openssl/x509v3.h>",
      "#include <openssl/x509.h>",
      "#include <openssl/pem.h>",
      "#include <unistd.h>",
      "#include <ctype.h>",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "dict"
          ],
          "line": 476
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_copy",
          "args": [
            "value_node"
          ],
          "line": 473
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"has a value\""
          ],
          "line": 472
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_get_item",
          "args": [
            "dict",
            "\"Value\""
          ],
          "line": 469
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "dict"
          ],
          "line": 465
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"success\""
          ],
          "line": 461
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lockdown_check_result",
          "args": [
            "dict",
            "\"GetValue\""
          ],
          "line": 459
        },
        "resolved": true,
        "details": {
          "function_name": "lockdown_check_result",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "150-223",
          "snippet": "static lockdownd_error_t lockdown_check_result(plist_t dict, const char *query_match)\n{\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tplist_t query_node = plist_dict_get_item(dict, \"Request\");\n\tif (!query_node) {\n\t\treturn ret;\n\t}\n\n\tif (plist_get_node_type(query_node) != PLIST_STRING) {\n\t\treturn ret;\n\t} else {\n\t\tchar *query_value = NULL;\n\n\t\tplist_get_string_val(query_node, &query_value);\n\t\tif (!query_value) {\n\t\t\treturn ret;\n\t\t}\n\n\t\tif (query_match && (strcmp(query_value, query_match) != 0)) {\n\t\t\tfree(query_value);\n\t\t\treturn ret;\n\t\t}\n\n\t\tfree(query_value);\n\t}\n\n\tplist_t result_node = plist_dict_get_item(dict, \"Result\");\n\tif (!result_node) {\n\t\t/* iOS 5: the 'Result' key is not present anymore.\n\t\t   But we need to check for the 'Error' key. */\n\t\tplist_t err_node = plist_dict_get_item(dict, \"Error\");\n\t\tif (err_node) {\n\t\t\tif (plist_get_node_type(err_node) == PLIST_STRING) {\n\t\t\t\tchar *err_value = NULL;\n\n\t\t\t\tplist_get_string_val(err_node, &err_value);\n\t\t\t\tif (err_value) {\n\t\t\t\t\tdebug_info(\"ERROR: %s\", err_value);\n\t\t\t\t\tret = lockdownd_strtoerr(err_value);\n\t\t\t\t\tfree(err_value);\n\t\t\t\t} else {\n\t\t\t\t\tdebug_info(\"ERROR: unknown error occured\");\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn ret;\n\t\t}\n\n\t\tret = LOCKDOWN_E_SUCCESS;\n\n\t\treturn ret;\n\t}\n\n\tplist_type result_type = plist_get_node_type(result_node);\n\tif (result_type == PLIST_STRING) {\n\t\tchar *result_value = NULL;\n\n\t\tplist_get_string_val(result_node, &result_value);\n\t\tif (result_value) {\n\t\t\tif (!strcmp(result_value, \"Success\")) {\n\t\t\t\tret = LOCKDOWN_E_SUCCESS;\n\t\t\t} else if (!strcmp(result_value, \"Failure\")) {\n\t\t\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t\t\t} else {\n\t\t\t\tdebug_info(\"ERROR: unknown result value '%s'\", result_value);\n\t\t\t}\n\t\t}\n\n\t\tif (result_value)\n\t\t\tfree(result_value);\n\t}\n\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic lockdownd_error_t lockdown_check_result(plist_t dict, const char *query_match)\n{\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tplist_t query_node = plist_dict_get_item(dict, \"Request\");\n\tif (!query_node) {\n\t\treturn ret;\n\t}\n\n\tif (plist_get_node_type(query_node) != PLIST_STRING) {\n\t\treturn ret;\n\t} else {\n\t\tchar *query_value = NULL;\n\n\t\tplist_get_string_val(query_node, &query_value);\n\t\tif (!query_value) {\n\t\t\treturn ret;\n\t\t}\n\n\t\tif (query_match && (strcmp(query_value, query_match) != 0)) {\n\t\t\tfree(query_value);\n\t\t\treturn ret;\n\t\t}\n\n\t\tfree(query_value);\n\t}\n\n\tplist_t result_node = plist_dict_get_item(dict, \"Result\");\n\tif (!result_node) {\n\t\t/* iOS 5: the 'Result' key is not present anymore.\n\t\t   But we need to check for the 'Error' key. */\n\t\tplist_t err_node = plist_dict_get_item(dict, \"Error\");\n\t\tif (err_node) {\n\t\t\tif (plist_get_node_type(err_node) == PLIST_STRING) {\n\t\t\t\tchar *err_value = NULL;\n\n\t\t\t\tplist_get_string_val(err_node, &err_value);\n\t\t\t\tif (err_value) {\n\t\t\t\t\tdebug_info(\"ERROR: %s\", err_value);\n\t\t\t\t\tret = lockdownd_strtoerr(err_value);\n\t\t\t\t\tfree(err_value);\n\t\t\t\t} else {\n\t\t\t\t\tdebug_info(\"ERROR: unknown error occured\");\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn ret;\n\t\t}\n\n\t\tret = LOCKDOWN_E_SUCCESS;\n\n\t\treturn ret;\n\t}\n\n\tplist_type result_type = plist_get_node_type(result_node);\n\tif (result_type == PLIST_STRING) {\n\t\tchar *result_value = NULL;\n\n\t\tplist_get_string_val(result_node, &result_value);\n\t\tif (result_value) {\n\t\t\tif (!strcmp(result_value, \"Success\")) {\n\t\t\t\tret = LOCKDOWN_E_SUCCESS;\n\t\t\t} else if (!strcmp(result_value, \"Failure\")) {\n\t\t\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t\t\t} else {\n\t\t\t\tdebug_info(\"ERROR: unknown result value '%s'\", result_value);\n\t\t\t}\n\t\t}\n\n\t\tif (result_value)\n\t\t\tfree(result_value);\n\t}\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lockdownd_receive",
          "args": [
            "client",
            "&dict"
          ],
          "line": 455
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_receive",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "348-364",
          "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_receive(lockdownd_client_t client, plist_t *plist)\n{\n\tif (!client || !plist || (plist && *plist))\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\tlockdownd_error_t ret = LOCKDOWN_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_receive_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t}\n\n\tif (!*plist)\n\t\tret = LOCKDOWN_E_PLIST_ERROR;\n\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_receive(lockdownd_client_t client, plist_t *plist)\n{\n\tif (!client || !plist || (plist && *plist))\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\tlockdownd_error_t ret = LOCKDOWN_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_receive_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t}\n\n\tif (!*plist)\n\t\tret = LOCKDOWN_E_PLIST_ERROR;\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "dict"
          ],
          "line": 448
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lockdownd_send",
          "args": [
            "client",
            "dict"
          ],
          "line": 446
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_send",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "366-379",
          "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_send(lockdownd_client_t client, plist_t plist)\n{\n\tif (!client || !plist)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_send_xml_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t}\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_send(lockdownd_client_t client, plist_t plist)\n{\n\tif (!client || !plist)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_send_xml_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t}\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"Request\"",
            "plist_new_string(\"GetValue\")"
          ],
          "line": 443
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "\"GetValue\""
          ],
          "line": 443
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"Key\"",
            "plist_new_string(key)"
          ],
          "line": 441
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "key"
          ],
          "line": 441
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"Domain\"",
            "plist_new_string(domain)"
          ],
          "line": 438
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "domain"
          ],
          "line": 438
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_add_label",
          "args": [
            "dict",
            "client->label"
          ],
          "line": 436
        },
        "resolved": true,
        "details": {
          "function_name": "plist_dict_add_label",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "232-238",
          "snippet": "static void plist_dict_add_label(plist_t plist, const char *label)\n{\n\tif (plist && label) {\n\t\tif (plist_get_node_type(plist) == PLIST_DICT)\n\t\t\tplist_dict_set_item(plist, \"Label\", plist_new_string(label));\n\t}\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic void plist_dict_add_label(plist_t plist, const char *label)\n{\n\tif (plist && label) {\n\t\tif (plist_get_node_type(plist) == PLIST_DICT)\n\t\t\tplist_dict_set_item(plist, \"Label\", plist_new_string(label));\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_new_dict",
          "args": [],
          "line": 435
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_get_value(lockdownd_client_t client, const char *domain, const char *key, plist_t *value)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tplist_t dict = NULL;\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\t/* setup request plist */\n\tdict = plist_new_dict();\n\tplist_dict_add_label(dict, client->label);\n\tif (domain) {\n\t\tplist_dict_set_item(dict,\"Domain\", plist_new_string(domain));\n\t}\n\tif (key) {\n\t\tplist_dict_set_item(dict,\"Key\", plist_new_string(key));\n\t}\n\tplist_dict_set_item(dict,\"Request\", plist_new_string(\"GetValue\"));\n\n\t/* send to device */\n\tret = lockdownd_send(client, dict);\n\n\tplist_free(dict);\n\tdict = NULL;\n\n\tif (ret != LOCKDOWN_E_SUCCESS)\n\t\treturn ret;\n\n\t/* Now get device's answer */\n\tret = lockdownd_receive(client, &dict);\n\tif (ret != LOCKDOWN_E_SUCCESS)\n\t\treturn ret;\n\n\tret = lockdown_check_result(dict, \"GetValue\");\n\tif (ret == LOCKDOWN_E_SUCCESS) {\n\t\tdebug_info(\"success\");\n\t}\n\n\tif (ret != LOCKDOWN_E_SUCCESS) {\n\t\tplist_free(dict);\n\t\treturn ret;\n\t}\n\n\tplist_t value_node = plist_dict_get_item(dict, \"Value\");\n\n\tif (value_node) {\n\t\tdebug_info(\"has a value\");\n\t\t*value = plist_copy(value_node);\n\t}\n\n\tplist_free(dict);\n\treturn ret;\n}"
  },
  {
    "function_name": "lockdownd_query_type",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
    "lines": "381-424",
    "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_query_type(lockdownd_client_t client, char **type)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tplist_t dict = plist_new_dict();\n\tplist_dict_add_label(dict, client->label);\n\tplist_dict_set_item(dict,\"Request\", plist_new_string(\"QueryType\"));\n\n\tdebug_info(\"called\");\n\tret = lockdownd_send(client, dict);\n\n\tplist_free(dict);\n\tdict = NULL;\n\n\tret = lockdownd_receive(client, &dict);\n\n\tif (LOCKDOWN_E_SUCCESS != ret)\n\t\treturn ret;\n\n\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\tplist_t type_node = plist_dict_get_item(dict, \"Type\");\n\tif (type_node && (plist_get_node_type(type_node) == PLIST_STRING)) {\n\t\tchar* typestr = NULL;\n\t\tplist_get_string_val(type_node, &typestr);\n\t\tdebug_info(\"success with type %s\", typestr);\n\t\t/* return the type if requested */\n\t\tif (type != NULL) {\n\t\t\t*type = typestr;\n\t\t} else {\n\t\t\tfree(typestr);\n\t\t}\n\t\tret = LOCKDOWN_E_SUCCESS;\n\t} else {\n\t\tdebug_info(\"hmm. QueryType response does not contain a type?!\");\n\t\tdebug_plist(dict);\n\t}\n\tplist_free(dict);\n\tdict = NULL;\n\n\treturn ret;\n}",
    "includes": [
      "#include <windows.h>",
      "#include \"asprintf.h\"",
      "#include \"common/utils.h\"",
      "#include \"common/userpref.h\"",
      "#include \"common/debug.h\"",
      "#include \"idevice.h\"",
      "#include \"lockdown.h\"",
      "#include \"property_list_service.h\"",
      "#include <plist/plist.h>",
      "#include <gnutls/crypto.h>",
      "#include <gnutls/x509.h>",
      "#include <libtasn1.h>",
      "#include <openssl/x509v3.h>",
      "#include <openssl/x509.h>",
      "#include <openssl/pem.h>",
      "#include <unistd.h>",
      "#include <ctype.h>",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "dict"
          ],
          "line": 420
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_plist",
          "args": [
            "dict"
          ],
          "line": 418
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"hmm. QueryType response does not contain a type?!\""
          ],
          "line": 417
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "typestr"
          ],
          "line": 413
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_service_descriptor_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "1522-1528",
          "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_service_descriptor_free(lockdownd_service_descriptor_t service)\n{\n\tif (service)\n\t\tfree(service);\n\n\treturn LOCKDOWN_E_SUCCESS;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_service_descriptor_free(lockdownd_service_descriptor_t service)\n{\n\tif (service)\n\t\tfree(service);\n\n\treturn LOCKDOWN_E_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"success with type %s\"",
            "typestr"
          ],
          "line": 408
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_get_string_val",
          "args": [
            "type_node",
            "&typestr"
          ],
          "line": 407
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_get_node_type",
          "args": [
            "type_node"
          ],
          "line": 405
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_get_item",
          "args": [
            "dict",
            "\"Type\""
          ],
          "line": 404
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lockdownd_receive",
          "args": [
            "client",
            "&dict"
          ],
          "line": 398
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_receive",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "348-364",
          "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_receive(lockdownd_client_t client, plist_t *plist)\n{\n\tif (!client || !plist || (plist && *plist))\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\tlockdownd_error_t ret = LOCKDOWN_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_receive_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t}\n\n\tif (!*plist)\n\t\tret = LOCKDOWN_E_PLIST_ERROR;\n\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_receive(lockdownd_client_t client, plist_t *plist)\n{\n\tif (!client || !plist || (plist && *plist))\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\tlockdownd_error_t ret = LOCKDOWN_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_receive_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t}\n\n\tif (!*plist)\n\t\tret = LOCKDOWN_E_PLIST_ERROR;\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "dict"
          ],
          "line": 395
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lockdownd_send",
          "args": [
            "client",
            "dict"
          ],
          "line": 393
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_send",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "366-379",
          "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_send(lockdownd_client_t client, plist_t plist)\n{\n\tif (!client || !plist)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_send_xml_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t}\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_send(lockdownd_client_t client, plist_t plist)\n{\n\tif (!client || !plist)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_send_xml_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t}\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"called\""
          ],
          "line": 392
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"Request\"",
            "plist_new_string(\"QueryType\")"
          ],
          "line": 390
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "\"QueryType\""
          ],
          "line": 390
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_add_label",
          "args": [
            "dict",
            "client->label"
          ],
          "line": 389
        },
        "resolved": true,
        "details": {
          "function_name": "plist_dict_add_label",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "232-238",
          "snippet": "static void plist_dict_add_label(plist_t plist, const char *label)\n{\n\tif (plist && label) {\n\t\tif (plist_get_node_type(plist) == PLIST_DICT)\n\t\t\tplist_dict_set_item(plist, \"Label\", plist_new_string(label));\n\t}\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic void plist_dict_add_label(plist_t plist, const char *label)\n{\n\tif (plist && label) {\n\t\tif (plist_get_node_type(plist) == PLIST_DICT)\n\t\t\tplist_dict_set_item(plist, \"Label\", plist_new_string(label));\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_new_dict",
          "args": [],
          "line": 388
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_query_type(lockdownd_client_t client, char **type)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tplist_t dict = plist_new_dict();\n\tplist_dict_add_label(dict, client->label);\n\tplist_dict_set_item(dict,\"Request\", plist_new_string(\"QueryType\"));\n\n\tdebug_info(\"called\");\n\tret = lockdownd_send(client, dict);\n\n\tplist_free(dict);\n\tdict = NULL;\n\n\tret = lockdownd_receive(client, &dict);\n\n\tif (LOCKDOWN_E_SUCCESS != ret)\n\t\treturn ret;\n\n\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\tplist_t type_node = plist_dict_get_item(dict, \"Type\");\n\tif (type_node && (plist_get_node_type(type_node) == PLIST_STRING)) {\n\t\tchar* typestr = NULL;\n\t\tplist_get_string_val(type_node, &typestr);\n\t\tdebug_info(\"success with type %s\", typestr);\n\t\t/* return the type if requested */\n\t\tif (type != NULL) {\n\t\t\t*type = typestr;\n\t\t} else {\n\t\t\tfree(typestr);\n\t\t}\n\t\tret = LOCKDOWN_E_SUCCESS;\n\t} else {\n\t\tdebug_info(\"hmm. QueryType response does not contain a type?!\");\n\t\tdebug_plist(dict);\n\t}\n\tplist_free(dict);\n\tdict = NULL;\n\n\treturn ret;\n}"
  },
  {
    "function_name": "lockdownd_send",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
    "lines": "366-379",
    "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_send(lockdownd_client_t client, plist_t plist)\n{\n\tif (!client || !plist)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_send_xml_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t}\n\treturn ret;\n}",
    "includes": [
      "#include <windows.h>",
      "#include \"asprintf.h\"",
      "#include \"common/utils.h\"",
      "#include \"common/userpref.h\"",
      "#include \"common/debug.h\"",
      "#include \"idevice.h\"",
      "#include \"lockdown.h\"",
      "#include \"property_list_service.h\"",
      "#include <plist/plist.h>",
      "#include <gnutls/crypto.h>",
      "#include <gnutls/x509.h>",
      "#include <libtasn1.h>",
      "#include <openssl/x509v3.h>",
      "#include <openssl/x509.h>",
      "#include <openssl/pem.h>",
      "#include <unistd.h>",
      "#include <ctype.h>",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "property_list_service_send_xml_plist",
          "args": [
            "client->parent",
            "plist"
          ],
          "line": 374
        },
        "resolved": true,
        "details": {
          "function_name": "property_list_service_send_xml_plist",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
          "lines": "150-153",
          "snippet": "LIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_send_xml_plist(property_list_service_client_t client, plist_t plist)\n{\n\treturn internal_plist_send(client, plist, 0);\n}",
          "includes": [
            "#include \"endianness.h\"",
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_send_xml_plist(property_list_service_client_t client, plist_t plist)\n{\n\treturn internal_plist_send(client, plist, 0);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_send(lockdownd_client_t client, plist_t plist)\n{\n\tif (!client || !plist)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_send_xml_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t}\n\treturn ret;\n}"
  },
  {
    "function_name": "lockdownd_receive",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
    "lines": "348-364",
    "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_receive(lockdownd_client_t client, plist_t *plist)\n{\n\tif (!client || !plist || (plist && *plist))\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\tlockdownd_error_t ret = LOCKDOWN_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_receive_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t}\n\n\tif (!*plist)\n\t\tret = LOCKDOWN_E_PLIST_ERROR;\n\n\treturn ret;\n}",
    "includes": [
      "#include <windows.h>",
      "#include \"asprintf.h\"",
      "#include \"common/utils.h\"",
      "#include \"common/userpref.h\"",
      "#include \"common/debug.h\"",
      "#include \"idevice.h\"",
      "#include \"lockdown.h\"",
      "#include \"property_list_service.h\"",
      "#include <plist/plist.h>",
      "#include <gnutls/crypto.h>",
      "#include <gnutls/x509.h>",
      "#include <libtasn1.h>",
      "#include <openssl/x509v3.h>",
      "#include <openssl/x509.h>",
      "#include <openssl/pem.h>",
      "#include <unistd.h>",
      "#include <ctype.h>",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "property_list_service_receive_plist",
          "args": [
            "client->parent",
            "plist"
          ],
          "line": 355
        },
        "resolved": true,
        "details": {
          "function_name": "property_list_service_receive_plist",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
          "lines": "258-261",
          "snippet": "LIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_receive_plist(property_list_service_client_t client, plist_t *plist)\n{\n\treturn internal_plist_receive_timeout(client, plist, 10000);\n}",
          "includes": [
            "#include \"endianness.h\"",
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_receive_plist(property_list_service_client_t client, plist_t *plist)\n{\n\treturn internal_plist_receive_timeout(client, plist, 10000);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_receive(lockdownd_client_t client, plist_t *plist)\n{\n\tif (!client || !plist || (plist && *plist))\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\tlockdownd_error_t ret = LOCKDOWN_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_receive_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t}\n\n\tif (!*plist)\n\t\tret = LOCKDOWN_E_PLIST_ERROR;\n\n\treturn ret;\n}"
  },
  {
    "function_name": "lockdownd_client_set_label",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
    "lines": "338-346",
    "snippet": "LIBIMOBILEDEVICE_API void lockdownd_client_set_label(lockdownd_client_t client, const char *label)\n{\n\tif (client) {\n\t\tif (client->label)\n\t\t\tfree(client->label);\n\n\t\tclient->label = (label != NULL) ? strdup(label): NULL;\n\t}\n}",
    "includes": [
      "#include <windows.h>",
      "#include \"asprintf.h\"",
      "#include \"common/utils.h\"",
      "#include \"common/userpref.h\"",
      "#include \"common/debug.h\"",
      "#include \"idevice.h\"",
      "#include \"lockdown.h\"",
      "#include \"property_list_service.h\"",
      "#include <plist/plist.h>",
      "#include <gnutls/crypto.h>",
      "#include <gnutls/x509.h>",
      "#include <libtasn1.h>",
      "#include <openssl/x509v3.h>",
      "#include <openssl/x509.h>",
      "#include <openssl/pem.h>",
      "#include <unistd.h>",
      "#include <ctype.h>",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "label"
          ],
          "line": 344
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "client->label"
          ],
          "line": 342
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_service_descriptor_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "1522-1528",
          "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_service_descriptor_free(lockdownd_service_descriptor_t service)\n{\n\tif (service)\n\t\tfree(service);\n\n\treturn LOCKDOWN_E_SUCCESS;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_service_descriptor_free(lockdownd_service_descriptor_t service)\n{\n\tif (service)\n\t\tfree(service);\n\n\treturn LOCKDOWN_E_SUCCESS;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API void lockdownd_client_set_label(lockdownd_client_t client, const char *label)\n{\n\tif (client) {\n\t\tif (client->label)\n\t\t\tfree(client->label);\n\n\t\tclient->label = (label != NULL) ? strdup(label): NULL;\n\t}\n}"
  },
  {
    "function_name": "lockdownd_client_free",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
    "lines": "322-336",
    "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_client_free(lockdownd_client_t client)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tif (client->session_id) {\n\t\tlockdownd_stop_session(client, client->session_id);\n\t}\n\n\tret = lockdownd_client_free_simple(client);\n\n\treturn ret;\n}",
    "includes": [
      "#include <windows.h>",
      "#include \"asprintf.h\"",
      "#include \"common/utils.h\"",
      "#include \"common/userpref.h\"",
      "#include \"common/debug.h\"",
      "#include \"idevice.h\"",
      "#include \"lockdown.h\"",
      "#include \"property_list_service.h\"",
      "#include <plist/plist.h>",
      "#include <gnutls/crypto.h>",
      "#include <gnutls/x509.h>",
      "#include <libtasn1.h>",
      "#include <openssl/x509v3.h>",
      "#include <openssl/x509.h>",
      "#include <openssl/pem.h>",
      "#include <unistd.h>",
      "#include <ctype.h>",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "lockdownd_client_free_simple",
          "args": [
            "client"
          ],
          "line": 333
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_client_free_simple",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "292-320",
          "snippet": "static lockdownd_error_t lockdownd_client_free_simple(lockdownd_client_t client)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tif (client->parent) {\n\t\tif (property_list_service_client_free(client->parent) == PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\t\tret = LOCKDOWN_E_SUCCESS;\n\t\t}\n\t}\n\n\tif (client->session_id) {\n\t\tfree(client->session_id);\n\t\tclient->session_id = NULL;\n\t}\n\tif (client->udid) {\n\t\tfree(client->udid);\n\t}\n\tif (client->label) {\n\t\tfree(client->label);\n\t}\n\n\tfree(client);\n\tclient = NULL;\n\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic lockdownd_error_t lockdownd_client_free_simple(lockdownd_client_t client)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tif (client->parent) {\n\t\tif (property_list_service_client_free(client->parent) == PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\t\tret = LOCKDOWN_E_SUCCESS;\n\t\t}\n\t}\n\n\tif (client->session_id) {\n\t\tfree(client->session_id);\n\t\tclient->session_id = NULL;\n\t}\n\tif (client->udid) {\n\t\tfree(client->udid);\n\t}\n\tif (client->label) {\n\t\tfree(client->label);\n\t}\n\n\tfree(client);\n\tclient = NULL;\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lockdownd_stop_session",
          "args": [
            "client",
            "client->session_id"
          ],
          "line": 330
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_stop_session",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "240-290",
          "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_stop_session(lockdownd_client_t client, const char *session_id)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tif (!session_id) {\n\t\tdebug_info(\"no session_id given, cannot stop session\");\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\t}\n\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tplist_t dict = plist_new_dict();\n\tplist_dict_add_label(dict, client->label);\n\tplist_dict_set_item(dict,\"Request\", plist_new_string(\"StopSession\"));\n\tplist_dict_set_item(dict,\"SessionID\", plist_new_string(session_id));\n\n\tdebug_info(\"stopping session %s\", session_id);\n\n\tret = lockdownd_send(client, dict);\n\n\tplist_free(dict);\n\tdict = NULL;\n\n\tret = lockdownd_receive(client, &dict);\n\n\tif (!dict) {\n\t\tdebug_info(\"LOCKDOWN_E_PLIST_ERROR\");\n\t\treturn LOCKDOWN_E_PLIST_ERROR;\n\t}\n\n\tret = lockdown_check_result(dict, \"StopSession\");\n\tif (ret == LOCKDOWN_E_SUCCESS) {\n\t\tdebug_info(\"success\");\n\t}\n\n\tplist_free(dict);\n\tdict = NULL;\n\n\tif (client->session_id) {\n\t\tfree(client->session_id);\n\t\tclient->session_id = NULL;\n\t}\n\n\tif (client->ssl_enabled) {\n\t\tproperty_list_service_disable_ssl(client->parent);\n\t\tclient->ssl_enabled = 0;\n\t}\n\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_stop_session(lockdownd_client_t client, const char *session_id)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tif (!session_id) {\n\t\tdebug_info(\"no session_id given, cannot stop session\");\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\t}\n\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tplist_t dict = plist_new_dict();\n\tplist_dict_add_label(dict, client->label);\n\tplist_dict_set_item(dict,\"Request\", plist_new_string(\"StopSession\"));\n\tplist_dict_set_item(dict,\"SessionID\", plist_new_string(session_id));\n\n\tdebug_info(\"stopping session %s\", session_id);\n\n\tret = lockdownd_send(client, dict);\n\n\tplist_free(dict);\n\tdict = NULL;\n\n\tret = lockdownd_receive(client, &dict);\n\n\tif (!dict) {\n\t\tdebug_info(\"LOCKDOWN_E_PLIST_ERROR\");\n\t\treturn LOCKDOWN_E_PLIST_ERROR;\n\t}\n\n\tret = lockdown_check_result(dict, \"StopSession\");\n\tif (ret == LOCKDOWN_E_SUCCESS) {\n\t\tdebug_info(\"success\");\n\t}\n\n\tplist_free(dict);\n\tdict = NULL;\n\n\tif (client->session_id) {\n\t\tfree(client->session_id);\n\t\tclient->session_id = NULL;\n\t}\n\n\tif (client->ssl_enabled) {\n\t\tproperty_list_service_disable_ssl(client->parent);\n\t\tclient->ssl_enabled = 0;\n\t}\n\n\treturn ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_client_free(lockdownd_client_t client)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tif (client->session_id) {\n\t\tlockdownd_stop_session(client, client->session_id);\n\t}\n\n\tret = lockdownd_client_free_simple(client);\n\n\treturn ret;\n}"
  },
  {
    "function_name": "lockdownd_client_free_simple",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
    "lines": "292-320",
    "snippet": "static lockdownd_error_t lockdownd_client_free_simple(lockdownd_client_t client)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tif (client->parent) {\n\t\tif (property_list_service_client_free(client->parent) == PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\t\tret = LOCKDOWN_E_SUCCESS;\n\t\t}\n\t}\n\n\tif (client->session_id) {\n\t\tfree(client->session_id);\n\t\tclient->session_id = NULL;\n\t}\n\tif (client->udid) {\n\t\tfree(client->udid);\n\t}\n\tif (client->label) {\n\t\tfree(client->label);\n\t}\n\n\tfree(client);\n\tclient = NULL;\n\n\treturn ret;\n}",
    "includes": [
      "#include <windows.h>",
      "#include \"asprintf.h\"",
      "#include \"common/utils.h\"",
      "#include \"common/userpref.h\"",
      "#include \"common/debug.h\"",
      "#include \"idevice.h\"",
      "#include \"lockdown.h\"",
      "#include \"property_list_service.h\"",
      "#include <plist/plist.h>",
      "#include <gnutls/crypto.h>",
      "#include <gnutls/x509.h>",
      "#include <libtasn1.h>",
      "#include <openssl/x509v3.h>",
      "#include <openssl/x509.h>",
      "#include <openssl/pem.h>",
      "#include <unistd.h>",
      "#include <ctype.h>",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "client"
          ],
          "line": 316
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_service_descriptor_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "1522-1528",
          "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_service_descriptor_free(lockdownd_service_descriptor_t service)\n{\n\tif (service)\n\t\tfree(service);\n\n\treturn LOCKDOWN_E_SUCCESS;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_service_descriptor_free(lockdownd_service_descriptor_t service)\n{\n\tif (service)\n\t\tfree(service);\n\n\treturn LOCKDOWN_E_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "property_list_service_client_free",
          "args": [
            "client->parent"
          ],
          "line": 300
        },
        "resolved": true,
        "details": {
          "function_name": "property_list_service_client_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
          "lines": "77-88",
          "snippet": "LIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_client_free(property_list_service_client_t client)\n{\n\tif (!client)\n\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\n\tproperty_list_service_error_t err = service_to_property_list_service_error(service_client_free(client->parent));\n\n\tfree(client);\n\tclient = NULL;\n\n\treturn err;\n}",
          "includes": [
            "#include \"endianness.h\"",
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_client_free(property_list_service_client_t client)\n{\n\tif (!client)\n\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\n\tproperty_list_service_error_t err = service_to_property_list_service_error(service_client_free(client->parent));\n\n\tfree(client);\n\tclient = NULL;\n\n\treturn err;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic lockdownd_error_t lockdownd_client_free_simple(lockdownd_client_t client)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tif (client->parent) {\n\t\tif (property_list_service_client_free(client->parent) == PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\t\tret = LOCKDOWN_E_SUCCESS;\n\t\t}\n\t}\n\n\tif (client->session_id) {\n\t\tfree(client->session_id);\n\t\tclient->session_id = NULL;\n\t}\n\tif (client->udid) {\n\t\tfree(client->udid);\n\t}\n\tif (client->label) {\n\t\tfree(client->label);\n\t}\n\n\tfree(client);\n\tclient = NULL;\n\n\treturn ret;\n}"
  },
  {
    "function_name": "lockdownd_stop_session",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
    "lines": "240-290",
    "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_stop_session(lockdownd_client_t client, const char *session_id)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tif (!session_id) {\n\t\tdebug_info(\"no session_id given, cannot stop session\");\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\t}\n\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tplist_t dict = plist_new_dict();\n\tplist_dict_add_label(dict, client->label);\n\tplist_dict_set_item(dict,\"Request\", plist_new_string(\"StopSession\"));\n\tplist_dict_set_item(dict,\"SessionID\", plist_new_string(session_id));\n\n\tdebug_info(\"stopping session %s\", session_id);\n\n\tret = lockdownd_send(client, dict);\n\n\tplist_free(dict);\n\tdict = NULL;\n\n\tret = lockdownd_receive(client, &dict);\n\n\tif (!dict) {\n\t\tdebug_info(\"LOCKDOWN_E_PLIST_ERROR\");\n\t\treturn LOCKDOWN_E_PLIST_ERROR;\n\t}\n\n\tret = lockdown_check_result(dict, \"StopSession\");\n\tif (ret == LOCKDOWN_E_SUCCESS) {\n\t\tdebug_info(\"success\");\n\t}\n\n\tplist_free(dict);\n\tdict = NULL;\n\n\tif (client->session_id) {\n\t\tfree(client->session_id);\n\t\tclient->session_id = NULL;\n\t}\n\n\tif (client->ssl_enabled) {\n\t\tproperty_list_service_disable_ssl(client->parent);\n\t\tclient->ssl_enabled = 0;\n\t}\n\n\treturn ret;\n}",
    "includes": [
      "#include <windows.h>",
      "#include \"asprintf.h\"",
      "#include \"common/utils.h\"",
      "#include \"common/userpref.h\"",
      "#include \"common/debug.h\"",
      "#include \"idevice.h\"",
      "#include \"lockdown.h\"",
      "#include \"property_list_service.h\"",
      "#include <plist/plist.h>",
      "#include <gnutls/crypto.h>",
      "#include <gnutls/x509.h>",
      "#include <libtasn1.h>",
      "#include <openssl/x509v3.h>",
      "#include <openssl/x509.h>",
      "#include <openssl/pem.h>",
      "#include <unistd.h>",
      "#include <ctype.h>",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "property_list_service_disable_ssl",
          "args": [
            "client->parent"
          ],
          "line": 285
        },
        "resolved": true,
        "details": {
          "function_name": "property_list_service_disable_ssl",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
          "lines": "270-275",
          "snippet": "LIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_disable_ssl(property_list_service_client_t client)\n{\n\tif (!client || !client->parent)\n\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\treturn service_to_property_list_service_error(service_disable_ssl(client->parent));\n}",
          "includes": [
            "#include \"endianness.h\"",
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_disable_ssl(property_list_service_client_t client)\n{\n\tif (!client || !client->parent)\n\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\treturn service_to_property_list_service_error(service_disable_ssl(client->parent));\n}"
        }
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "client->session_id"
          ],
          "line": 280
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_service_descriptor_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "1522-1528",
          "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_service_descriptor_free(lockdownd_service_descriptor_t service)\n{\n\tif (service)\n\t\tfree(service);\n\n\treturn LOCKDOWN_E_SUCCESS;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_service_descriptor_free(lockdownd_service_descriptor_t service)\n{\n\tif (service)\n\t\tfree(service);\n\n\treturn LOCKDOWN_E_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "dict"
          ],
          "line": 276
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"success\""
          ],
          "line": 273
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lockdown_check_result",
          "args": [
            "dict",
            "\"StopSession\""
          ],
          "line": 271
        },
        "resolved": true,
        "details": {
          "function_name": "lockdown_check_result",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "150-223",
          "snippet": "static lockdownd_error_t lockdown_check_result(plist_t dict, const char *query_match)\n{\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tplist_t query_node = plist_dict_get_item(dict, \"Request\");\n\tif (!query_node) {\n\t\treturn ret;\n\t}\n\n\tif (plist_get_node_type(query_node) != PLIST_STRING) {\n\t\treturn ret;\n\t} else {\n\t\tchar *query_value = NULL;\n\n\t\tplist_get_string_val(query_node, &query_value);\n\t\tif (!query_value) {\n\t\t\treturn ret;\n\t\t}\n\n\t\tif (query_match && (strcmp(query_value, query_match) != 0)) {\n\t\t\tfree(query_value);\n\t\t\treturn ret;\n\t\t}\n\n\t\tfree(query_value);\n\t}\n\n\tplist_t result_node = plist_dict_get_item(dict, \"Result\");\n\tif (!result_node) {\n\t\t/* iOS 5: the 'Result' key is not present anymore.\n\t\t   But we need to check for the 'Error' key. */\n\t\tplist_t err_node = plist_dict_get_item(dict, \"Error\");\n\t\tif (err_node) {\n\t\t\tif (plist_get_node_type(err_node) == PLIST_STRING) {\n\t\t\t\tchar *err_value = NULL;\n\n\t\t\t\tplist_get_string_val(err_node, &err_value);\n\t\t\t\tif (err_value) {\n\t\t\t\t\tdebug_info(\"ERROR: %s\", err_value);\n\t\t\t\t\tret = lockdownd_strtoerr(err_value);\n\t\t\t\t\tfree(err_value);\n\t\t\t\t} else {\n\t\t\t\t\tdebug_info(\"ERROR: unknown error occured\");\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn ret;\n\t\t}\n\n\t\tret = LOCKDOWN_E_SUCCESS;\n\n\t\treturn ret;\n\t}\n\n\tplist_type result_type = plist_get_node_type(result_node);\n\tif (result_type == PLIST_STRING) {\n\t\tchar *result_value = NULL;\n\n\t\tplist_get_string_val(result_node, &result_value);\n\t\tif (result_value) {\n\t\t\tif (!strcmp(result_value, \"Success\")) {\n\t\t\t\tret = LOCKDOWN_E_SUCCESS;\n\t\t\t} else if (!strcmp(result_value, \"Failure\")) {\n\t\t\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t\t\t} else {\n\t\t\t\tdebug_info(\"ERROR: unknown result value '%s'\", result_value);\n\t\t\t}\n\t\t}\n\n\t\tif (result_value)\n\t\t\tfree(result_value);\n\t}\n\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic lockdownd_error_t lockdown_check_result(plist_t dict, const char *query_match)\n{\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tplist_t query_node = plist_dict_get_item(dict, \"Request\");\n\tif (!query_node) {\n\t\treturn ret;\n\t}\n\n\tif (plist_get_node_type(query_node) != PLIST_STRING) {\n\t\treturn ret;\n\t} else {\n\t\tchar *query_value = NULL;\n\n\t\tplist_get_string_val(query_node, &query_value);\n\t\tif (!query_value) {\n\t\t\treturn ret;\n\t\t}\n\n\t\tif (query_match && (strcmp(query_value, query_match) != 0)) {\n\t\t\tfree(query_value);\n\t\t\treturn ret;\n\t\t}\n\n\t\tfree(query_value);\n\t}\n\n\tplist_t result_node = plist_dict_get_item(dict, \"Result\");\n\tif (!result_node) {\n\t\t/* iOS 5: the 'Result' key is not present anymore.\n\t\t   But we need to check for the 'Error' key. */\n\t\tplist_t err_node = plist_dict_get_item(dict, \"Error\");\n\t\tif (err_node) {\n\t\t\tif (plist_get_node_type(err_node) == PLIST_STRING) {\n\t\t\t\tchar *err_value = NULL;\n\n\t\t\t\tplist_get_string_val(err_node, &err_value);\n\t\t\t\tif (err_value) {\n\t\t\t\t\tdebug_info(\"ERROR: %s\", err_value);\n\t\t\t\t\tret = lockdownd_strtoerr(err_value);\n\t\t\t\t\tfree(err_value);\n\t\t\t\t} else {\n\t\t\t\t\tdebug_info(\"ERROR: unknown error occured\");\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn ret;\n\t\t}\n\n\t\tret = LOCKDOWN_E_SUCCESS;\n\n\t\treturn ret;\n\t}\n\n\tplist_type result_type = plist_get_node_type(result_node);\n\tif (result_type == PLIST_STRING) {\n\t\tchar *result_value = NULL;\n\n\t\tplist_get_string_val(result_node, &result_value);\n\t\tif (result_value) {\n\t\t\tif (!strcmp(result_value, \"Success\")) {\n\t\t\t\tret = LOCKDOWN_E_SUCCESS;\n\t\t\t} else if (!strcmp(result_value, \"Failure\")) {\n\t\t\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t\t\t} else {\n\t\t\t\tdebug_info(\"ERROR: unknown result value '%s'\", result_value);\n\t\t\t}\n\t\t}\n\n\t\tif (result_value)\n\t\t\tfree(result_value);\n\t}\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"LOCKDOWN_E_PLIST_ERROR\""
          ],
          "line": 267
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lockdownd_receive",
          "args": [
            "client",
            "&dict"
          ],
          "line": 264
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_receive",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "348-364",
          "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_receive(lockdownd_client_t client, plist_t *plist)\n{\n\tif (!client || !plist || (plist && *plist))\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\tlockdownd_error_t ret = LOCKDOWN_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_receive_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t}\n\n\tif (!*plist)\n\t\tret = LOCKDOWN_E_PLIST_ERROR;\n\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_receive(lockdownd_client_t client, plist_t *plist)\n{\n\tif (!client || !plist || (plist && *plist))\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\tlockdownd_error_t ret = LOCKDOWN_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_receive_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t}\n\n\tif (!*plist)\n\t\tret = LOCKDOWN_E_PLIST_ERROR;\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "dict"
          ],
          "line": 261
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lockdownd_send",
          "args": [
            "client",
            "dict"
          ],
          "line": 259
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_send",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "366-379",
          "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_send(lockdownd_client_t client, plist_t plist)\n{\n\tif (!client || !plist)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_send_xml_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t}\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_send(lockdownd_client_t client, plist_t plist)\n{\n\tif (!client || !plist)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tlockdownd_error_t ret = LOCKDOWN_E_SUCCESS;\n\tproperty_list_service_error_t err;\n\n\terr = property_list_service_send_xml_plist(client->parent, plist);\n\tif (err != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t}\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"stopping session %s\"",
            "session_id"
          ],
          "line": 257
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"SessionID\"",
            "plist_new_string(session_id)"
          ],
          "line": 255
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "session_id"
          ],
          "line": 255
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"Request\"",
            "plist_new_string(\"StopSession\")"
          ],
          "line": 254
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "\"StopSession\""
          ],
          "line": 254
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_add_label",
          "args": [
            "dict",
            "client->label"
          ],
          "line": 253
        },
        "resolved": true,
        "details": {
          "function_name": "plist_dict_add_label",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "232-238",
          "snippet": "static void plist_dict_add_label(plist_t plist, const char *label)\n{\n\tif (plist && label) {\n\t\tif (plist_get_node_type(plist) == PLIST_DICT)\n\t\t\tplist_dict_set_item(plist, \"Label\", plist_new_string(label));\n\t}\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic void plist_dict_add_label(plist_t plist, const char *label)\n{\n\tif (plist && label) {\n\t\tif (plist_get_node_type(plist) == PLIST_DICT)\n\t\t\tplist_dict_set_item(plist, \"Label\", plist_new_string(label));\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_new_dict",
          "args": [],
          "line": 252
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"no session_id given, cannot stop session\""
          ],
          "line": 246
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_stop_session(lockdownd_client_t client, const char *session_id)\n{\n\tif (!client)\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\n\tif (!session_id) {\n\t\tdebug_info(\"no session_id given, cannot stop session\");\n\t\treturn LOCKDOWN_E_INVALID_ARG;\n\t}\n\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tplist_t dict = plist_new_dict();\n\tplist_dict_add_label(dict, client->label);\n\tplist_dict_set_item(dict,\"Request\", plist_new_string(\"StopSession\"));\n\tplist_dict_set_item(dict,\"SessionID\", plist_new_string(session_id));\n\n\tdebug_info(\"stopping session %s\", session_id);\n\n\tret = lockdownd_send(client, dict);\n\n\tplist_free(dict);\n\tdict = NULL;\n\n\tret = lockdownd_receive(client, &dict);\n\n\tif (!dict) {\n\t\tdebug_info(\"LOCKDOWN_E_PLIST_ERROR\");\n\t\treturn LOCKDOWN_E_PLIST_ERROR;\n\t}\n\n\tret = lockdown_check_result(dict, \"StopSession\");\n\tif (ret == LOCKDOWN_E_SUCCESS) {\n\t\tdebug_info(\"success\");\n\t}\n\n\tplist_free(dict);\n\tdict = NULL;\n\n\tif (client->session_id) {\n\t\tfree(client->session_id);\n\t\tclient->session_id = NULL;\n\t}\n\n\tif (client->ssl_enabled) {\n\t\tproperty_list_service_disable_ssl(client->parent);\n\t\tclient->ssl_enabled = 0;\n\t}\n\n\treturn ret;\n}"
  },
  {
    "function_name": "plist_dict_add_label",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
    "lines": "232-238",
    "snippet": "static void plist_dict_add_label(plist_t plist, const char *label)\n{\n\tif (plist && label) {\n\t\tif (plist_get_node_type(plist) == PLIST_DICT)\n\t\t\tplist_dict_set_item(plist, \"Label\", plist_new_string(label));\n\t}\n}",
    "includes": [
      "#include <windows.h>",
      "#include \"asprintf.h\"",
      "#include \"common/utils.h\"",
      "#include \"common/userpref.h\"",
      "#include \"common/debug.h\"",
      "#include \"idevice.h\"",
      "#include \"lockdown.h\"",
      "#include \"property_list_service.h\"",
      "#include <plist/plist.h>",
      "#include <gnutls/crypto.h>",
      "#include <gnutls/x509.h>",
      "#include <libtasn1.h>",
      "#include <openssl/x509v3.h>",
      "#include <openssl/x509.h>",
      "#include <openssl/pem.h>",
      "#include <unistd.h>",
      "#include <ctype.h>",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "plist",
            "\"Label\"",
            "plist_new_string(label)"
          ],
          "line": 236
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "label"
          ],
          "line": 236
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_get_node_type",
          "args": [
            "plist"
          ],
          "line": 235
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic void plist_dict_add_label(plist_t plist, const char *label)\n{\n\tif (plist && label) {\n\t\tif (plist_get_node_type(plist) == PLIST_DICT)\n\t\t\tplist_dict_set_item(plist, \"Label\", plist_new_string(label));\n\t}\n}"
  },
  {
    "function_name": "lockdown_check_result",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
    "lines": "150-223",
    "snippet": "static lockdownd_error_t lockdown_check_result(plist_t dict, const char *query_match)\n{\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tplist_t query_node = plist_dict_get_item(dict, \"Request\");\n\tif (!query_node) {\n\t\treturn ret;\n\t}\n\n\tif (plist_get_node_type(query_node) != PLIST_STRING) {\n\t\treturn ret;\n\t} else {\n\t\tchar *query_value = NULL;\n\n\t\tplist_get_string_val(query_node, &query_value);\n\t\tif (!query_value) {\n\t\t\treturn ret;\n\t\t}\n\n\t\tif (query_match && (strcmp(query_value, query_match) != 0)) {\n\t\t\tfree(query_value);\n\t\t\treturn ret;\n\t\t}\n\n\t\tfree(query_value);\n\t}\n\n\tplist_t result_node = plist_dict_get_item(dict, \"Result\");\n\tif (!result_node) {\n\t\t/* iOS 5: the 'Result' key is not present anymore.\n\t\t   But we need to check for the 'Error' key. */\n\t\tplist_t err_node = plist_dict_get_item(dict, \"Error\");\n\t\tif (err_node) {\n\t\t\tif (plist_get_node_type(err_node) == PLIST_STRING) {\n\t\t\t\tchar *err_value = NULL;\n\n\t\t\t\tplist_get_string_val(err_node, &err_value);\n\t\t\t\tif (err_value) {\n\t\t\t\t\tdebug_info(\"ERROR: %s\", err_value);\n\t\t\t\t\tret = lockdownd_strtoerr(err_value);\n\t\t\t\t\tfree(err_value);\n\t\t\t\t} else {\n\t\t\t\t\tdebug_info(\"ERROR: unknown error occured\");\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn ret;\n\t\t}\n\n\t\tret = LOCKDOWN_E_SUCCESS;\n\n\t\treturn ret;\n\t}\n\n\tplist_type result_type = plist_get_node_type(result_node);\n\tif (result_type == PLIST_STRING) {\n\t\tchar *result_value = NULL;\n\n\t\tplist_get_string_val(result_node, &result_value);\n\t\tif (result_value) {\n\t\t\tif (!strcmp(result_value, \"Success\")) {\n\t\t\t\tret = LOCKDOWN_E_SUCCESS;\n\t\t\t} else if (!strcmp(result_value, \"Failure\")) {\n\t\t\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t\t\t} else {\n\t\t\t\tdebug_info(\"ERROR: unknown result value '%s'\", result_value);\n\t\t\t}\n\t\t}\n\n\t\tif (result_value)\n\t\t\tfree(result_value);\n\t}\n\n\treturn ret;\n}",
    "includes": [
      "#include <windows.h>",
      "#include \"asprintf.h\"",
      "#include \"common/utils.h\"",
      "#include \"common/userpref.h\"",
      "#include \"common/debug.h\"",
      "#include \"idevice.h\"",
      "#include \"lockdown.h\"",
      "#include \"property_list_service.h\"",
      "#include <plist/plist.h>",
      "#include <gnutls/crypto.h>",
      "#include <gnutls/x509.h>",
      "#include <libtasn1.h>",
      "#include <openssl/x509v3.h>",
      "#include <openssl/x509.h>",
      "#include <openssl/pem.h>",
      "#include <unistd.h>",
      "#include <ctype.h>",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "result_value"
          ],
          "line": 219
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_service_descriptor_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "1522-1528",
          "snippet": "LIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_service_descriptor_free(lockdownd_service_descriptor_t service)\n{\n\tif (service)\n\t\tfree(service);\n\n\treturn LOCKDOWN_E_SUCCESS;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API lockdownd_error_t lockdownd_service_descriptor_free(lockdownd_service_descriptor_t service)\n{\n\tif (service)\n\t\tfree(service);\n\n\treturn LOCKDOWN_E_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"ERROR: unknown result value '%s'\"",
            "result_value"
          ],
          "line": 214
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "result_value",
            "\"Failure\""
          ],
          "line": 211
        },
        "resolved": true,
        "details": {
          "function_name": "plist_strcmp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/tools/idevicebackup.c",
          "lines": "296-309",
          "snippet": "static int plist_strcmp(plist_t node, const char *str)\n{\n\tchar *buffer = NULL;\n\tint ret = 0;\n\n\tif (plist_get_node_type(node) != PLIST_STRING)\n\t\treturn ret;\n\n\tplist_get_string_val(node, &buffer);\n\tret = strcmp(buffer, str);\n\tfree(buffer);\n\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"common/utils.h\"",
            "#include <libimobiledevice/afc.h>",
            "#include <libimobiledevice/notification_proxy.h>",
            "#include <libimobiledevice/mobilebackup.h>",
            "#include <libimobiledevice/lockdown.h>",
            "#include <libimobiledevice/libimobiledevice.h>",
            "#include <time.h>",
            "#include <ctype.h>",
            "#include <unistd.h>",
            "#include <gcrypt.h>",
            "#include <openssl/sha.h>",
            "#include <signal.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"common/utils.h\"\n#include <libimobiledevice/afc.h>\n#include <libimobiledevice/notification_proxy.h>\n#include <libimobiledevice/mobilebackup.h>\n#include <libimobiledevice/lockdown.h>\n#include <libimobiledevice/libimobiledevice.h>\n#include <time.h>\n#include <ctype.h>\n#include <unistd.h>\n#include <gcrypt.h>\n#include <openssl/sha.h>\n#include <signal.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int plist_strcmp(plist_t node, const char *str)\n{\n\tchar *buffer = NULL;\n\tint ret = 0;\n\n\tif (plist_get_node_type(node) != PLIST_STRING)\n\t\treturn ret;\n\n\tplist_get_string_val(node, &buffer);\n\tret = strcmp(buffer, str);\n\tfree(buffer);\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_get_string_val",
          "args": [
            "result_node",
            "&result_value"
          ],
          "line": 207
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_get_node_type",
          "args": [
            "result_node"
          ],
          "line": 203
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"ERROR: unknown error occured\""
          ],
          "line": 192
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lockdownd_strtoerr",
          "args": [
            "err_value"
          ],
          "line": 189
        },
        "resolved": true,
        "details": {
          "function_name": "lockdownd_strtoerr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
          "lines": "69-136",
          "snippet": "static lockdownd_error_t lockdownd_strtoerr(const char* name)\n{\n\tlockdownd_error_t err = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tif (strcmp(name, \"InvalidResponse\") == 0) {\n\t\terr = LOCKDOWN_E_INVALID_RESPONSE;\n\t} else if (strcmp(name, \"MissingKey\") == 0) {\n\t\terr = LOCKDOWN_E_MISSING_KEY;\n\t} else if (strcmp(name, \"MissingValue\") == 0) {\n\t\terr = LOCKDOWN_E_MISSING_VALUE;\n\t} else if (strcmp(name, \"GetProhibited\") == 0) {\n\t\terr = LOCKDOWN_E_GET_PROHIBITED;\n\t} else if (strcmp(name, \"SetProhibited\") == 0) {\n\t\terr = LOCKDOWN_E_SET_PROHIBITED;\n\t} else if (strcmp(name, \"RemoveProhibited\") == 0) {\n\t\terr = LOCKDOWN_E_REMOVE_PROHIBITED;\n\t} else if (strcmp(name, \"ImmutableValue\") == 0) {\n\t\terr = LOCKDOWN_E_IMMUTABLE_VALUE;\n\t} else if (strcmp(name, \"PasswordProtected\") == 0) {\n\t\terr = LOCKDOWN_E_PASSWORD_PROTECTED;\n\t} else if (strcmp(name, \"UserDeniedPairing\") == 0) {\n\t\terr = LOCKDOWN_E_USER_DENIED_PAIRING;\n\t} else if (strcmp(name, \"PairingDialogResponsePending\") == 0) {\n\t\terr = LOCKDOWN_E_PAIRING_DIALOG_RESPONSE_PENDING;\n\t} else if (strcmp(name, \"MissingHostID\") == 0) {\n\t\terr = LOCKDOWN_E_MISSING_HOST_ID;\n\t} else if (strcmp(name, \"InvalidHostID\") == 0) {\n\t\terr = LOCKDOWN_E_INVALID_HOST_ID;\n\t} else if (strcmp(name, \"SessionActive\") == 0) {\n\t\terr = LOCKDOWN_E_SESSION_ACTIVE;\n\t} else if (strcmp(name, \"SessionInactive\") == 0) {\n\t\terr = LOCKDOWN_E_SESSION_INACTIVE;\n\t} else if (strcmp(name, \"MissingSessionID\") == 0) {\n\t\terr = LOCKDOWN_E_MISSING_SESSION_ID;\n\t} else if (strcmp(name, \"InvalidSessionID\") == 0) {\n\t\terr = LOCKDOWN_E_INVALID_SESSION_ID;\n\t} else if (strcmp(name, \"MissingService\") == 0) {\n\t\terr = LOCKDOWN_E_MISSING_SERVICE;\n\t} else if (strcmp(name, \"InvalidService\") == 0) {\n\t\terr = LOCKDOWN_E_INVALID_SERVICE;\n\t} else if (strcmp(name, \"ServiceLimit\") == 0) {\n\t\terr = LOCKDOWN_E_SERVICE_LIMIT;\n\t} else if (strcmp(name, \"MissingPairRecord\") == 0) {\n\t\terr = LOCKDOWN_E_MISSING_PAIR_RECORD;\n\t} else if (strcmp(name, \"SavePairRecordFailed\") == 0) {\n\t\terr = LOCKDOWN_E_SAVE_PAIR_RECORD_FAILED;\n\t} else if (strcmp(name, \"InvalidPairRecord\") == 0) {\n\t\terr = LOCKDOWN_E_INVALID_PAIR_RECORD;\n\t} else if (strcmp(name, \"InvalidActivationRecord\") == 0) {\n\t\terr = LOCKDOWN_E_INVALID_ACTIVATION_RECORD;\n\t} else if (strcmp(name, \"MissingActivationRecord\") == 0) {\n\t\terr = LOCKDOWN_E_MISSING_ACTIVATION_RECORD;\n\t} else if (strcmp(name, \"ServiceProhibited\") == 0) {\n\t\terr = LOCKDOWN_E_SERVICE_PROHIBITED;\n\t} else if (strcmp(name, \"EscrowLocked\") == 0) {\n\t\terr = LOCKDOWN_E_ESCROW_LOCKED;\n\t} else if (strcmp(name, \"PairingProhibitedOverThisConnection\") == 0) {\n\t\terr = LOCKDOWN_E_PAIRING_PROHIBITED_OVER_THIS_CONNECTION;\n\t} else if (strcmp(name, \"FMiPProtected\") == 0) {\n\t\terr = LOCKDOWN_E_FMIP_PROTECTED;\n\t} else if (strcmp(name, \"MCProtected\") == 0) {\n\t\terr = LOCKDOWN_E_MC_PROTECTED;\n\t} else if (strcmp(name, \"MCChallengeRequired\") == 0) {\n\t\terr = LOCKDOWN_E_MC_CHALLENGE_REQUIRED;\n\t}\n\n\treturn err;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"asprintf.h\"",
            "#include \"common/utils.h\"",
            "#include \"common/userpref.h\"",
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"lockdown.h\"",
            "#include \"property_list_service.h\"",
            "#include <plist/plist.h>",
            "#include <gnutls/crypto.h>",
            "#include <gnutls/x509.h>",
            "#include <libtasn1.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/x509.h>",
            "#include <openssl/pem.h>",
            "#include <unistd.h>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic lockdownd_error_t lockdownd_strtoerr(const char* name)\n{\n\tlockdownd_error_t err = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tif (strcmp(name, \"InvalidResponse\") == 0) {\n\t\terr = LOCKDOWN_E_INVALID_RESPONSE;\n\t} else if (strcmp(name, \"MissingKey\") == 0) {\n\t\terr = LOCKDOWN_E_MISSING_KEY;\n\t} else if (strcmp(name, \"MissingValue\") == 0) {\n\t\terr = LOCKDOWN_E_MISSING_VALUE;\n\t} else if (strcmp(name, \"GetProhibited\") == 0) {\n\t\terr = LOCKDOWN_E_GET_PROHIBITED;\n\t} else if (strcmp(name, \"SetProhibited\") == 0) {\n\t\terr = LOCKDOWN_E_SET_PROHIBITED;\n\t} else if (strcmp(name, \"RemoveProhibited\") == 0) {\n\t\terr = LOCKDOWN_E_REMOVE_PROHIBITED;\n\t} else if (strcmp(name, \"ImmutableValue\") == 0) {\n\t\terr = LOCKDOWN_E_IMMUTABLE_VALUE;\n\t} else if (strcmp(name, \"PasswordProtected\") == 0) {\n\t\terr = LOCKDOWN_E_PASSWORD_PROTECTED;\n\t} else if (strcmp(name, \"UserDeniedPairing\") == 0) {\n\t\terr = LOCKDOWN_E_USER_DENIED_PAIRING;\n\t} else if (strcmp(name, \"PairingDialogResponsePending\") == 0) {\n\t\terr = LOCKDOWN_E_PAIRING_DIALOG_RESPONSE_PENDING;\n\t} else if (strcmp(name, \"MissingHostID\") == 0) {\n\t\terr = LOCKDOWN_E_MISSING_HOST_ID;\n\t} else if (strcmp(name, \"InvalidHostID\") == 0) {\n\t\terr = LOCKDOWN_E_INVALID_HOST_ID;\n\t} else if (strcmp(name, \"SessionActive\") == 0) {\n\t\terr = LOCKDOWN_E_SESSION_ACTIVE;\n\t} else if (strcmp(name, \"SessionInactive\") == 0) {\n\t\terr = LOCKDOWN_E_SESSION_INACTIVE;\n\t} else if (strcmp(name, \"MissingSessionID\") == 0) {\n\t\terr = LOCKDOWN_E_MISSING_SESSION_ID;\n\t} else if (strcmp(name, \"InvalidSessionID\") == 0) {\n\t\terr = LOCKDOWN_E_INVALID_SESSION_ID;\n\t} else if (strcmp(name, \"MissingService\") == 0) {\n\t\terr = LOCKDOWN_E_MISSING_SERVICE;\n\t} else if (strcmp(name, \"InvalidService\") == 0) {\n\t\terr = LOCKDOWN_E_INVALID_SERVICE;\n\t} else if (strcmp(name, \"ServiceLimit\") == 0) {\n\t\terr = LOCKDOWN_E_SERVICE_LIMIT;\n\t} else if (strcmp(name, \"MissingPairRecord\") == 0) {\n\t\terr = LOCKDOWN_E_MISSING_PAIR_RECORD;\n\t} else if (strcmp(name, \"SavePairRecordFailed\") == 0) {\n\t\terr = LOCKDOWN_E_SAVE_PAIR_RECORD_FAILED;\n\t} else if (strcmp(name, \"InvalidPairRecord\") == 0) {\n\t\terr = LOCKDOWN_E_INVALID_PAIR_RECORD;\n\t} else if (strcmp(name, \"InvalidActivationRecord\") == 0) {\n\t\terr = LOCKDOWN_E_INVALID_ACTIVATION_RECORD;\n\t} else if (strcmp(name, \"MissingActivationRecord\") == 0) {\n\t\terr = LOCKDOWN_E_MISSING_ACTIVATION_RECORD;\n\t} else if (strcmp(name, \"ServiceProhibited\") == 0) {\n\t\terr = LOCKDOWN_E_SERVICE_PROHIBITED;\n\t} else if (strcmp(name, \"EscrowLocked\") == 0) {\n\t\terr = LOCKDOWN_E_ESCROW_LOCKED;\n\t} else if (strcmp(name, \"PairingProhibitedOverThisConnection\") == 0) {\n\t\terr = LOCKDOWN_E_PAIRING_PROHIBITED_OVER_THIS_CONNECTION;\n\t} else if (strcmp(name, \"FMiPProtected\") == 0) {\n\t\terr = LOCKDOWN_E_FMIP_PROTECTED;\n\t} else if (strcmp(name, \"MCProtected\") == 0) {\n\t\terr = LOCKDOWN_E_MC_PROTECTED;\n\t} else if (strcmp(name, \"MCChallengeRequired\") == 0) {\n\t\terr = LOCKDOWN_E_MC_CHALLENGE_REQUIRED;\n\t}\n\n\treturn err;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"ERROR: %s\"",
            "err_value"
          ],
          "line": 188
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_get_string_val",
          "args": [
            "err_node",
            "&err_value"
          ],
          "line": 186
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_get_node_type",
          "args": [
            "err_node"
          ],
          "line": 183
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_get_item",
          "args": [
            "dict",
            "\"Error\""
          ],
          "line": 181
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_get_item",
          "args": [
            "dict",
            "\"Result\""
          ],
          "line": 177
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_get_string_val",
          "args": [
            "query_node",
            "&query_value"
          ],
          "line": 164
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_get_node_type",
          "args": [
            "query_node"
          ],
          "line": 159
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_get_item",
          "args": [
            "dict",
            "\"Request\""
          ],
          "line": 154
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic lockdownd_error_t lockdown_check_result(plist_t dict, const char *query_match)\n{\n\tlockdownd_error_t ret = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tplist_t query_node = plist_dict_get_item(dict, \"Request\");\n\tif (!query_node) {\n\t\treturn ret;\n\t}\n\n\tif (plist_get_node_type(query_node) != PLIST_STRING) {\n\t\treturn ret;\n\t} else {\n\t\tchar *query_value = NULL;\n\n\t\tplist_get_string_val(query_node, &query_value);\n\t\tif (!query_value) {\n\t\t\treturn ret;\n\t\t}\n\n\t\tif (query_match && (strcmp(query_value, query_match) != 0)) {\n\t\t\tfree(query_value);\n\t\t\treturn ret;\n\t\t}\n\n\t\tfree(query_value);\n\t}\n\n\tplist_t result_node = plist_dict_get_item(dict, \"Result\");\n\tif (!result_node) {\n\t\t/* iOS 5: the 'Result' key is not present anymore.\n\t\t   But we need to check for the 'Error' key. */\n\t\tplist_t err_node = plist_dict_get_item(dict, \"Error\");\n\t\tif (err_node) {\n\t\t\tif (plist_get_node_type(err_node) == PLIST_STRING) {\n\t\t\t\tchar *err_value = NULL;\n\n\t\t\t\tplist_get_string_val(err_node, &err_value);\n\t\t\t\tif (err_value) {\n\t\t\t\t\tdebug_info(\"ERROR: %s\", err_value);\n\t\t\t\t\tret = lockdownd_strtoerr(err_value);\n\t\t\t\t\tfree(err_value);\n\t\t\t\t} else {\n\t\t\t\t\tdebug_info(\"ERROR: unknown error occured\");\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn ret;\n\t\t}\n\n\t\tret = LOCKDOWN_E_SUCCESS;\n\n\t\treturn ret;\n\t}\n\n\tplist_type result_type = plist_get_node_type(result_node);\n\tif (result_type == PLIST_STRING) {\n\t\tchar *result_value = NULL;\n\n\t\tplist_get_string_val(result_node, &result_value);\n\t\tif (result_value) {\n\t\t\tif (!strcmp(result_value, \"Success\")) {\n\t\t\t\tret = LOCKDOWN_E_SUCCESS;\n\t\t\t} else if (!strcmp(result_value, \"Failure\")) {\n\t\t\t\tret = LOCKDOWN_E_UNKNOWN_ERROR;\n\t\t\t} else {\n\t\t\t\tdebug_info(\"ERROR: unknown result value '%s'\", result_value);\n\t\t\t}\n\t\t}\n\n\t\tif (result_value)\n\t\t\tfree(result_value);\n\t}\n\n\treturn ret;\n}"
  },
  {
    "function_name": "lockdownd_strtoerr",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/lockdown.c",
    "lines": "69-136",
    "snippet": "static lockdownd_error_t lockdownd_strtoerr(const char* name)\n{\n\tlockdownd_error_t err = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tif (strcmp(name, \"InvalidResponse\") == 0) {\n\t\terr = LOCKDOWN_E_INVALID_RESPONSE;\n\t} else if (strcmp(name, \"MissingKey\") == 0) {\n\t\terr = LOCKDOWN_E_MISSING_KEY;\n\t} else if (strcmp(name, \"MissingValue\") == 0) {\n\t\terr = LOCKDOWN_E_MISSING_VALUE;\n\t} else if (strcmp(name, \"GetProhibited\") == 0) {\n\t\terr = LOCKDOWN_E_GET_PROHIBITED;\n\t} else if (strcmp(name, \"SetProhibited\") == 0) {\n\t\terr = LOCKDOWN_E_SET_PROHIBITED;\n\t} else if (strcmp(name, \"RemoveProhibited\") == 0) {\n\t\terr = LOCKDOWN_E_REMOVE_PROHIBITED;\n\t} else if (strcmp(name, \"ImmutableValue\") == 0) {\n\t\terr = LOCKDOWN_E_IMMUTABLE_VALUE;\n\t} else if (strcmp(name, \"PasswordProtected\") == 0) {\n\t\terr = LOCKDOWN_E_PASSWORD_PROTECTED;\n\t} else if (strcmp(name, \"UserDeniedPairing\") == 0) {\n\t\terr = LOCKDOWN_E_USER_DENIED_PAIRING;\n\t} else if (strcmp(name, \"PairingDialogResponsePending\") == 0) {\n\t\terr = LOCKDOWN_E_PAIRING_DIALOG_RESPONSE_PENDING;\n\t} else if (strcmp(name, \"MissingHostID\") == 0) {\n\t\terr = LOCKDOWN_E_MISSING_HOST_ID;\n\t} else if (strcmp(name, \"InvalidHostID\") == 0) {\n\t\terr = LOCKDOWN_E_INVALID_HOST_ID;\n\t} else if (strcmp(name, \"SessionActive\") == 0) {\n\t\terr = LOCKDOWN_E_SESSION_ACTIVE;\n\t} else if (strcmp(name, \"SessionInactive\") == 0) {\n\t\terr = LOCKDOWN_E_SESSION_INACTIVE;\n\t} else if (strcmp(name, \"MissingSessionID\") == 0) {\n\t\terr = LOCKDOWN_E_MISSING_SESSION_ID;\n\t} else if (strcmp(name, \"InvalidSessionID\") == 0) {\n\t\terr = LOCKDOWN_E_INVALID_SESSION_ID;\n\t} else if (strcmp(name, \"MissingService\") == 0) {\n\t\terr = LOCKDOWN_E_MISSING_SERVICE;\n\t} else if (strcmp(name, \"InvalidService\") == 0) {\n\t\terr = LOCKDOWN_E_INVALID_SERVICE;\n\t} else if (strcmp(name, \"ServiceLimit\") == 0) {\n\t\terr = LOCKDOWN_E_SERVICE_LIMIT;\n\t} else if (strcmp(name, \"MissingPairRecord\") == 0) {\n\t\terr = LOCKDOWN_E_MISSING_PAIR_RECORD;\n\t} else if (strcmp(name, \"SavePairRecordFailed\") == 0) {\n\t\terr = LOCKDOWN_E_SAVE_PAIR_RECORD_FAILED;\n\t} else if (strcmp(name, \"InvalidPairRecord\") == 0) {\n\t\terr = LOCKDOWN_E_INVALID_PAIR_RECORD;\n\t} else if (strcmp(name, \"InvalidActivationRecord\") == 0) {\n\t\terr = LOCKDOWN_E_INVALID_ACTIVATION_RECORD;\n\t} else if (strcmp(name, \"MissingActivationRecord\") == 0) {\n\t\terr = LOCKDOWN_E_MISSING_ACTIVATION_RECORD;\n\t} else if (strcmp(name, \"ServiceProhibited\") == 0) {\n\t\terr = LOCKDOWN_E_SERVICE_PROHIBITED;\n\t} else if (strcmp(name, \"EscrowLocked\") == 0) {\n\t\terr = LOCKDOWN_E_ESCROW_LOCKED;\n\t} else if (strcmp(name, \"PairingProhibitedOverThisConnection\") == 0) {\n\t\terr = LOCKDOWN_E_PAIRING_PROHIBITED_OVER_THIS_CONNECTION;\n\t} else if (strcmp(name, \"FMiPProtected\") == 0) {\n\t\terr = LOCKDOWN_E_FMIP_PROTECTED;\n\t} else if (strcmp(name, \"MCProtected\") == 0) {\n\t\terr = LOCKDOWN_E_MC_PROTECTED;\n\t} else if (strcmp(name, \"MCChallengeRequired\") == 0) {\n\t\terr = LOCKDOWN_E_MC_CHALLENGE_REQUIRED;\n\t}\n\n\treturn err;\n}",
    "includes": [
      "#include <windows.h>",
      "#include \"asprintf.h\"",
      "#include \"common/utils.h\"",
      "#include \"common/userpref.h\"",
      "#include \"common/debug.h\"",
      "#include \"idevice.h\"",
      "#include \"lockdown.h\"",
      "#include \"property_list_service.h\"",
      "#include <plist/plist.h>",
      "#include <gnutls/crypto.h>",
      "#include <gnutls/x509.h>",
      "#include <libtasn1.h>",
      "#include <openssl/x509v3.h>",
      "#include <openssl/x509.h>",
      "#include <openssl/pem.h>",
      "#include <unistd.h>",
      "#include <ctype.h>",
      "#include <stdio.h>",
      "#include <stdlib.h>",
      "#include <string.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "name",
            "\"MCChallengeRequired\""
          ],
          "line": 131
        },
        "resolved": true,
        "details": {
          "function_name": "plist_strcmp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/tools/idevicebackup.c",
          "lines": "296-309",
          "snippet": "static int plist_strcmp(plist_t node, const char *str)\n{\n\tchar *buffer = NULL;\n\tint ret = 0;\n\n\tif (plist_get_node_type(node) != PLIST_STRING)\n\t\treturn ret;\n\n\tplist_get_string_val(node, &buffer);\n\tret = strcmp(buffer, str);\n\tfree(buffer);\n\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"common/utils.h\"",
            "#include <libimobiledevice/afc.h>",
            "#include <libimobiledevice/notification_proxy.h>",
            "#include <libimobiledevice/mobilebackup.h>",
            "#include <libimobiledevice/lockdown.h>",
            "#include <libimobiledevice/libimobiledevice.h>",
            "#include <time.h>",
            "#include <ctype.h>",
            "#include <unistd.h>",
            "#include <gcrypt.h>",
            "#include <openssl/sha.h>",
            "#include <signal.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"common/utils.h\"\n#include <libimobiledevice/afc.h>\n#include <libimobiledevice/notification_proxy.h>\n#include <libimobiledevice/mobilebackup.h>\n#include <libimobiledevice/lockdown.h>\n#include <libimobiledevice/libimobiledevice.h>\n#include <time.h>\n#include <ctype.h>\n#include <unistd.h>\n#include <gcrypt.h>\n#include <openssl/sha.h>\n#include <signal.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int plist_strcmp(plist_t node, const char *str)\n{\n\tchar *buffer = NULL;\n\tint ret = 0;\n\n\tif (plist_get_node_type(node) != PLIST_STRING)\n\t\treturn ret;\n\n\tplist_get_string_val(node, &buffer);\n\tret = strcmp(buffer, str);\n\tfree(buffer);\n\n\treturn ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <windows.h>\n#include \"asprintf.h\"\n#include \"common/utils.h\"\n#include \"common/userpref.h\"\n#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"lockdown.h\"\n#include \"property_list_service.h\"\n#include <plist/plist.h>\n#include <gnutls/crypto.h>\n#include <gnutls/x509.h>\n#include <libtasn1.h>\n#include <openssl/x509v3.h>\n#include <openssl/x509.h>\n#include <openssl/pem.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nstatic lockdownd_error_t lockdownd_strtoerr(const char* name)\n{\n\tlockdownd_error_t err = LOCKDOWN_E_UNKNOWN_ERROR;\n\n\tif (strcmp(name, \"InvalidResponse\") == 0) {\n\t\terr = LOCKDOWN_E_INVALID_RESPONSE;\n\t} else if (strcmp(name, \"MissingKey\") == 0) {\n\t\terr = LOCKDOWN_E_MISSING_KEY;\n\t} else if (strcmp(name, \"MissingValue\") == 0) {\n\t\terr = LOCKDOWN_E_MISSING_VALUE;\n\t} else if (strcmp(name, \"GetProhibited\") == 0) {\n\t\terr = LOCKDOWN_E_GET_PROHIBITED;\n\t} else if (strcmp(name, \"SetProhibited\") == 0) {\n\t\terr = LOCKDOWN_E_SET_PROHIBITED;\n\t} else if (strcmp(name, \"RemoveProhibited\") == 0) {\n\t\terr = LOCKDOWN_E_REMOVE_PROHIBITED;\n\t} else if (strcmp(name, \"ImmutableValue\") == 0) {\n\t\terr = LOCKDOWN_E_IMMUTABLE_VALUE;\n\t} else if (strcmp(name, \"PasswordProtected\") == 0) {\n\t\terr = LOCKDOWN_E_PASSWORD_PROTECTED;\n\t} else if (strcmp(name, \"UserDeniedPairing\") == 0) {\n\t\terr = LOCKDOWN_E_USER_DENIED_PAIRING;\n\t} else if (strcmp(name, \"PairingDialogResponsePending\") == 0) {\n\t\terr = LOCKDOWN_E_PAIRING_DIALOG_RESPONSE_PENDING;\n\t} else if (strcmp(name, \"MissingHostID\") == 0) {\n\t\terr = LOCKDOWN_E_MISSING_HOST_ID;\n\t} else if (strcmp(name, \"InvalidHostID\") == 0) {\n\t\terr = LOCKDOWN_E_INVALID_HOST_ID;\n\t} else if (strcmp(name, \"SessionActive\") == 0) {\n\t\terr = LOCKDOWN_E_SESSION_ACTIVE;\n\t} else if (strcmp(name, \"SessionInactive\") == 0) {\n\t\terr = LOCKDOWN_E_SESSION_INACTIVE;\n\t} else if (strcmp(name, \"MissingSessionID\") == 0) {\n\t\terr = LOCKDOWN_E_MISSING_SESSION_ID;\n\t} else if (strcmp(name, \"InvalidSessionID\") == 0) {\n\t\terr = LOCKDOWN_E_INVALID_SESSION_ID;\n\t} else if (strcmp(name, \"MissingService\") == 0) {\n\t\terr = LOCKDOWN_E_MISSING_SERVICE;\n\t} else if (strcmp(name, \"InvalidService\") == 0) {\n\t\terr = LOCKDOWN_E_INVALID_SERVICE;\n\t} else if (strcmp(name, \"ServiceLimit\") == 0) {\n\t\terr = LOCKDOWN_E_SERVICE_LIMIT;\n\t} else if (strcmp(name, \"MissingPairRecord\") == 0) {\n\t\terr = LOCKDOWN_E_MISSING_PAIR_RECORD;\n\t} else if (strcmp(name, \"SavePairRecordFailed\") == 0) {\n\t\terr = LOCKDOWN_E_SAVE_PAIR_RECORD_FAILED;\n\t} else if (strcmp(name, \"InvalidPairRecord\") == 0) {\n\t\terr = LOCKDOWN_E_INVALID_PAIR_RECORD;\n\t} else if (strcmp(name, \"InvalidActivationRecord\") == 0) {\n\t\terr = LOCKDOWN_E_INVALID_ACTIVATION_RECORD;\n\t} else if (strcmp(name, \"MissingActivationRecord\") == 0) {\n\t\terr = LOCKDOWN_E_MISSING_ACTIVATION_RECORD;\n\t} else if (strcmp(name, \"ServiceProhibited\") == 0) {\n\t\terr = LOCKDOWN_E_SERVICE_PROHIBITED;\n\t} else if (strcmp(name, \"EscrowLocked\") == 0) {\n\t\terr = LOCKDOWN_E_ESCROW_LOCKED;\n\t} else if (strcmp(name, \"PairingProhibitedOverThisConnection\") == 0) {\n\t\terr = LOCKDOWN_E_PAIRING_PROHIBITED_OVER_THIS_CONNECTION;\n\t} else if (strcmp(name, \"FMiPProtected\") == 0) {\n\t\terr = LOCKDOWN_E_FMIP_PROTECTED;\n\t} else if (strcmp(name, \"MCProtected\") == 0) {\n\t\terr = LOCKDOWN_E_MC_PROTECTED;\n\t} else if (strcmp(name, \"MCChallengeRequired\") == 0) {\n\t\terr = LOCKDOWN_E_MC_CHALLENGE_REQUIRED;\n\t}\n\n\treturn err;\n}"
  }
]