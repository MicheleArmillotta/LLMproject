[
  {
    "function_name": "print_usage",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/tools/idevicesyslog.c",
    "lines": "202-214",
    "snippet": "void print_usage(int argc, char **argv)\n{\n\tchar *name = NULL;\n\n\tname = strrchr(argv[0], '/');\n\tprintf(\"Usage: %s [OPTIONS]\\n\", (name ? name + 1: argv[0]));\n\tprintf(\"Relay syslog of a connected device.\\n\\n\");\n\tprintf(\"  -d, --debug\\t\\tenable communication debugging\\n\");\n\tprintf(\"  -u, --udid UDID\\ttarget specific device by its 40-digit device UDID\\n\");\n\tprintf(\"  -h, --help\\t\\tprints usage information\\n\");\n\tprintf(\"\\n\");\n\tprintf(\"Homepage: <\" PACKAGE_URL \">\\n\");\n}",
    "includes": [
      "#include <libimobiledevice/syslog_relay.h>",
      "#include <libimobiledevice/libimobiledevice.h>",
      "#include <windows.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <signal.h>",
      "#include <errno.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "void print_usage(int argc, char **argv);",
      "static char* udid = NULL;",
      "static idevice_t device = NULL;",
      "static syslog_relay_client_t syslog = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"Homepage: <\" PACKAGE_URL \">\\n\""
          ],
          "line": 213
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"\\n\""
          ],
          "line": 212
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"  -h, --help\\t\\tprints usage information\\n\""
          ],
          "line": 211
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"  -u, --udid UDID\\ttarget specific device by its 40-digit device UDID\\n\""
          ],
          "line": 210
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"  -d, --debug\\t\\tenable communication debugging\\n\""
          ],
          "line": 209
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"Relay syslog of a connected device.\\n\\n\""
          ],
          "line": 208
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"Usage: %s [OPTIONS]\\n\"",
            "(name ? name + 1: argv[0])"
          ],
          "line": 207
        },
        "resolved": true,
        "details": {
          "function_name": "asprintf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/include/asprintf.h",
          "lines": "23-31",
          "snippet": "static inline int asprintf(char **PTR, const char *TEMPLATE, ...)\n{\n\tint res;\n\tva_list AP;\n\tva_start(AP, TEMPLATE);\n\tres = vasprintf(PTR, TEMPLATE, AP);\n\tva_end(AP);\n\treturn res;\n}",
          "includes": [
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <config.h>\n\nstatic inline int asprintf(char **PTR, const char *TEMPLATE, ...)\n{\n\tint res;\n\tva_list AP;\n\tva_start(AP, TEMPLATE);\n\tres = vasprintf(PTR, TEMPLATE, AP);\n\tva_end(AP);\n\treturn res;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strrchr",
          "args": [
            "argv[0]",
            "'/'"
          ],
          "line": 206
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <libimobiledevice/syslog_relay.h>\n#include <libimobiledevice/libimobiledevice.h>\n#include <windows.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <errno.h>\n#include <string.h>\n#include <stdio.h>\n#include \"config.h\"\n\nvoid print_usage(int argc, char **argv);\nstatic char* udid = NULL;\nstatic idevice_t device = NULL;\nstatic syslog_relay_client_t syslog = NULL;\n\nvoid print_usage(int argc, char **argv)\n{\n\tchar *name = NULL;\n\n\tname = strrchr(argv[0], '/');\n\tprintf(\"Usage: %s [OPTIONS]\\n\", (name ? name + 1: argv[0]));\n\tprintf(\"Relay syslog of a connected device.\\n\\n\");\n\tprintf(\"  -d, --debug\\t\\tenable communication debugging\\n\");\n\tprintf(\"  -u, --udid UDID\\ttarget specific device by its 40-digit device UDID\\n\");\n\tprintf(\"  -h, --help\\t\\tprints usage information\\n\");\n\tprintf(\"\\n\");\n\tprintf(\"Homepage: <\" PACKAGE_URL \">\\n\");\n}"
  },
  {
    "function_name": "main",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/tools/idevicesyslog.c",
    "lines": "138-200",
    "snippet": "int main(int argc, char *argv[])\n{\n\tint i;\n\n\tsignal(SIGINT, clean_exit);\n\tsignal(SIGTERM, clean_exit);\n#ifndef WIN32\n\tsignal(SIGQUIT, clean_exit);\n\tsignal(SIGPIPE, SIG_IGN);\n#endif\n\n\t/* parse cmdline args */\n\tfor (i = 1; i < argc; i++) {\n\t\tif (!strcmp(argv[i], \"-d\") || !strcmp(argv[i], \"--debug\")) {\n\t\t\tidevice_set_debug_level(1);\n\t\t\tcontinue;\n\t\t}\n\t\telse if (!strcmp(argv[i], \"-u\") || !strcmp(argv[i], \"--udid\")) {\n\t\t\ti++;\n\t\t\tif (!argv[i] || (strlen(argv[i]) != 40)) {\n\t\t\t\tprint_usage(argc, argv);\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t\tudid = strdup(argv[i]);\n\t\t\tcontinue;\n\t\t}\n\t\telse if (!strcmp(argv[i], \"-h\") || !strcmp(argv[i], \"--help\")) {\n\t\t\tprint_usage(argc, argv);\n\t\t\treturn 0;\n\t\t}\n\t\telse {\n\t\t\tprint_usage(argc, argv);\n\t\t\treturn 0;\n\t\t}\n\t}\n\n\tint num = 0;\n\tchar **devices = NULL;\n\tidevice_get_device_list(&devices, &num);\n\tidevice_device_list_free(devices);\n\tif (num == 0) {\n\t\tif (!udid) {\n\t\t\tfprintf(stderr, \"No device found. Plug in a device or pass UDID with -u to wait for device to be available.\\n\");\n\t\t\treturn -1;\n\t\t} else {\n\t\t\tfprintf(stderr, \"Waiting for device with UDID %s to become available...\\n\", udid);\n\t\t}\n\t}\n\n\tidevice_event_subscribe(device_event_cb, NULL);\n\n\twhile (!quit_flag) {\n\t\tsleep(1);\n\t}\n\tidevice_event_unsubscribe();\n\tstop_logging();\n\n\tif (udid) {\n\t\tfree(udid);\n\t}\n\n\treturn 0;\n}",
    "includes": [
      "#include <libimobiledevice/syslog_relay.h>",
      "#include <libimobiledevice/libimobiledevice.h>",
      "#include <windows.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <signal.h>",
      "#include <errno.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static int quit_flag = 0;",
      "void print_usage(int argc, char **argv);",
      "static char* udid = NULL;",
      "static idevice_t device = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "udid"
          ],
          "line": 196
        },
        "resolved": true,
        "details": {
          "function_name": "thread_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/common/thread.c",
          "lines": "39-44",
          "snippet": "void thread_free(thread_t thread)\n{\n#ifdef WIN32\n\tCloseHandle(thread);\n#endif\n}",
          "includes": [
            "#include \"thread.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"thread.h\"\n\nvoid thread_free(thread_t thread)\n{\n#ifdef WIN32\n\tCloseHandle(thread);\n#endif\n}"
        }
      },
      {
        "call_info": {
          "callee": "stop_logging",
          "args": [],
          "line": 193
        },
        "resolved": true,
        "details": {
          "function_name": "stop_logging",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/tools/idevicesyslog.c",
          "lines": "93-106",
          "snippet": "static void stop_logging(void)\n{\n\tfflush(stdout);\n\n\tif (syslog) {\n\t\tsyslog_relay_client_free(syslog);\n\t\tsyslog = NULL;\n\t}\n\n\tif (device) {\n\t\tidevice_free(device);\n\t\tdevice = NULL;\n\t}\n}",
          "includes": [
            "#include <libimobiledevice/syslog_relay.h>",
            "#include <libimobiledevice/libimobiledevice.h>",
            "#include <windows.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static idevice_t device = NULL;",
            "static syslog_relay_client_t syslog = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <libimobiledevice/syslog_relay.h>\n#include <libimobiledevice/libimobiledevice.h>\n#include <windows.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <errno.h>\n#include <string.h>\n#include <stdio.h>\n#include \"config.h\"\n\nstatic idevice_t device = NULL;\nstatic syslog_relay_client_t syslog = NULL;\n\nstatic void stop_logging(void)\n{\n\tfflush(stdout);\n\n\tif (syslog) {\n\t\tsyslog_relay_client_free(syslog);\n\t\tsyslog = NULL;\n\t}\n\n\tif (device) {\n\t\tidevice_free(device);\n\t\tdevice = NULL;\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "idevice_event_unsubscribe",
          "args": [],
          "line": 192
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sleep",
          "args": [
            "1"
          ],
          "line": 190
        },
        "resolved": true,
        "details": {
          "function_name": "diagnostics_relay_sleep",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/diagnostics_relay.c",
          "lines": "199-229",
          "snippet": "LIBIMOBILEDEVICE_API diagnostics_relay_error_t diagnostics_relay_sleep(diagnostics_relay_client_t client)\n{\n\tif (!client)\n\t\treturn DIAGNOSTICS_RELAY_E_INVALID_ARG;\n\n\tdiagnostics_relay_error_t ret = DIAGNOSTICS_RELAY_E_UNKNOWN_ERROR;\n\n\tplist_t dict = plist_new_dict();\n\n\tplist_dict_set_item(dict,\"Request\", plist_new_string(\"Sleep\"));\n\tret = diagnostics_relay_send(client, dict);\n\tplist_free(dict);\n\tdict = NULL;\n\n\tret = diagnostics_relay_receive(client, &dict);\n\tif (!dict) {\n\t\treturn DIAGNOSTICS_RELAY_E_PLIST_ERROR;\n\t}\n\n\tint check = diagnostics_relay_check_result(dict);\n\tif (check == RESULT_SUCCESS) {\n\t\tret = DIAGNOSTICS_RELAY_E_SUCCESS;\n\t} else if (check == RESULT_UNKNOWN_REQUEST) {\n\t\tret = DIAGNOSTICS_RELAY_E_UNKNOWN_REQUEST;\n\t} else {\n\t\tret = DIAGNOSTICS_RELAY_E_UNKNOWN_ERROR;\n\t}\n\n\tplist_free(dict);\n\treturn ret;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include \"diagnostics_relay.h\"",
            "#include <stdlib.h>",
            "#include <string.h>"
          ],
          "macros_used": [
            "#define RESULT_UNKNOWN_REQUEST 2",
            "#define RESULT_SUCCESS 0"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"diagnostics_relay.h\"\n#include <stdlib.h>\n#include <string.h>\n\n#define RESULT_UNKNOWN_REQUEST 2\n#define RESULT_SUCCESS 0\n\nLIBIMOBILEDEVICE_API diagnostics_relay_error_t diagnostics_relay_sleep(diagnostics_relay_client_t client)\n{\n\tif (!client)\n\t\treturn DIAGNOSTICS_RELAY_E_INVALID_ARG;\n\n\tdiagnostics_relay_error_t ret = DIAGNOSTICS_RELAY_E_UNKNOWN_ERROR;\n\n\tplist_t dict = plist_new_dict();\n\n\tplist_dict_set_item(dict,\"Request\", plist_new_string(\"Sleep\"));\n\tret = diagnostics_relay_send(client, dict);\n\tplist_free(dict);\n\tdict = NULL;\n\n\tret = diagnostics_relay_receive(client, &dict);\n\tif (!dict) {\n\t\treturn DIAGNOSTICS_RELAY_E_PLIST_ERROR;\n\t}\n\n\tint check = diagnostics_relay_check_result(dict);\n\tif (check == RESULT_SUCCESS) {\n\t\tret = DIAGNOSTICS_RELAY_E_SUCCESS;\n\t} else if (check == RESULT_UNKNOWN_REQUEST) {\n\t\tret = DIAGNOSTICS_RELAY_E_UNKNOWN_REQUEST;\n\t} else {\n\t\tret = DIAGNOSTICS_RELAY_E_UNKNOWN_ERROR;\n\t}\n\n\tplist_free(dict);\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "idevice_event_subscribe",
          "args": [
            "device_event_cb",
            "NULL"
          ],
          "line": 187
        },
        "resolved": true,
        "details": {
          "function_name": "idevice_event_subscribe",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/idevice.c",
          "lines": "159-169",
          "snippet": "LIBIMOBILEDEVICE_API idevice_error_t idevice_event_subscribe(idevice_event_cb_t callback, void *user_data)\n{\n\tevent_cb = callback;\n\tint res = usbmuxd_subscribe(usbmux_event_cb, user_data);\n\tif (res != 0) {\n\t\tevent_cb = NULL;\n\t\tdebug_info(\"ERROR: usbmuxd_subscribe() returned %d!\", res);\n\t\treturn IDEVICE_E_UNKNOWN_ERROR;\n\t}\n\treturn IDEVICE_E_SUCCESS;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"common/thread.h\"",
            "#include \"common/userpref.h\"",
            "#include \"idevice.h\"",
            "#include <gnutls/gnutls.h>",
            "#include <openssl/ssl.h>",
            "#include <openssl/err.h>",
            "#include <usbmuxd.h>",
            "#include <windows.h>",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static idevice_event_cb_t event_cb = NULL;",
            "LIBIMOBILEDEVICE_API idevice_error_t"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"common/thread.h\"\n#include \"common/userpref.h\"\n#include \"idevice.h\"\n#include <gnutls/gnutls.h>\n#include <openssl/ssl.h>\n#include <openssl/err.h>\n#include <usbmuxd.h>\n#include <windows.h>\n#include <errno.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nstatic idevice_event_cb_t event_cb = NULL;\nLIBIMOBILEDEVICE_API idevice_error_t;\n\nLIBIMOBILEDEVICE_API idevice_error_t idevice_event_subscribe(idevice_event_cb_t callback, void *user_data)\n{\n\tevent_cb = callback;\n\tint res = usbmuxd_subscribe(usbmux_event_cb, user_data);\n\tif (res != 0) {\n\t\tevent_cb = NULL;\n\t\tdebug_info(\"ERROR: usbmuxd_subscribe() returned %d!\", res);\n\t\treturn IDEVICE_E_UNKNOWN_ERROR;\n\t}\n\treturn IDEVICE_E_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Waiting for device with UDID %s to become available...\\n\"",
            "udid"
          ],
          "line": 183
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"No device found. Plug in a device or pass UDID with -u to wait for device to be available.\\n\""
          ],
          "line": 180
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "idevice_device_list_free",
          "args": [
            "devices"
          ],
          "line": 177
        },
        "resolved": true,
        "details": {
          "function_name": "idevice_device_list_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/idevice.c",
          "lines": "212-223",
          "snippet": "LIBIMOBILEDEVICE_API idevice_error_t idevice_device_list_free(char **devices)\n{\n\tif (devices) {\n\t\tint i = 0;\n\t\twhile (devices[i]) {\n\t\t\tfree(devices[i]);\n\t\t\ti++;\n\t\t}\n\t\tfree(devices);\n\t}\n\treturn IDEVICE_E_SUCCESS;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"common/thread.h\"",
            "#include \"common/userpref.h\"",
            "#include \"idevice.h\"",
            "#include <gnutls/gnutls.h>",
            "#include <openssl/ssl.h>",
            "#include <openssl/err.h>",
            "#include <usbmuxd.h>",
            "#include <windows.h>",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "LIBIMOBILEDEVICE_API idevice_error_t"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"common/thread.h\"\n#include \"common/userpref.h\"\n#include \"idevice.h\"\n#include <gnutls/gnutls.h>\n#include <openssl/ssl.h>\n#include <openssl/err.h>\n#include <usbmuxd.h>\n#include <windows.h>\n#include <errno.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API idevice_error_t;\n\nLIBIMOBILEDEVICE_API idevice_error_t idevice_device_list_free(char **devices)\n{\n\tif (devices) {\n\t\tint i = 0;\n\t\twhile (devices[i]) {\n\t\t\tfree(devices[i]);\n\t\t\ti++;\n\t\t}\n\t\tfree(devices);\n\t}\n\treturn IDEVICE_E_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "idevice_get_device_list",
          "args": [
            "&devices",
            "&num"
          ],
          "line": 176
        },
        "resolved": true,
        "details": {
          "function_name": "idevice_get_device_list",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/idevice.c",
          "lines": "182-210",
          "snippet": "LIBIMOBILEDEVICE_API idevice_error_t idevice_get_device_list(char ***devices, int *count)\n{\n\tusbmuxd_device_info_t *dev_list;\n\n\t*devices = NULL;\n\t*count = 0;\n\n\tif (usbmuxd_get_device_list(&dev_list) < 0) {\n\t\tdebug_info(\"ERROR: usbmuxd is not running!\", __func__);\n\t\treturn IDEVICE_E_NO_DEVICE;\n\t}\n\n\tchar **newlist = NULL;\n\tint i, newcount = 0;\n\n\tfor (i = 0; dev_list[i].handle > 0; i++) {\n\t\tnewlist = realloc(*devices, sizeof(char*) * (newcount+1));\n\t\tnewlist[newcount++] = strdup(dev_list[i].udid);\n\t\t*devices = newlist;\n\t}\n\tusbmuxd_device_list_free(&dev_list);\n\n\t*count = newcount;\n\tnewlist = realloc(*devices, sizeof(char*) * (newcount+1));\n\tnewlist[newcount] = NULL;\n\t*devices = newlist;\n\n\treturn IDEVICE_E_SUCCESS;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"common/thread.h\"",
            "#include \"common/userpref.h\"",
            "#include \"idevice.h\"",
            "#include <gnutls/gnutls.h>",
            "#include <openssl/ssl.h>",
            "#include <openssl/err.h>",
            "#include <usbmuxd.h>",
            "#include <windows.h>",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "LIBIMOBILEDEVICE_API idevice_error_t"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"common/thread.h\"\n#include \"common/userpref.h\"\n#include \"idevice.h\"\n#include <gnutls/gnutls.h>\n#include <openssl/ssl.h>\n#include <openssl/err.h>\n#include <usbmuxd.h>\n#include <windows.h>\n#include <errno.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API idevice_error_t;\n\nLIBIMOBILEDEVICE_API idevice_error_t idevice_get_device_list(char ***devices, int *count)\n{\n\tusbmuxd_device_info_t *dev_list;\n\n\t*devices = NULL;\n\t*count = 0;\n\n\tif (usbmuxd_get_device_list(&dev_list) < 0) {\n\t\tdebug_info(\"ERROR: usbmuxd is not running!\", __func__);\n\t\treturn IDEVICE_E_NO_DEVICE;\n\t}\n\n\tchar **newlist = NULL;\n\tint i, newcount = 0;\n\n\tfor (i = 0; dev_list[i].handle > 0; i++) {\n\t\tnewlist = realloc(*devices, sizeof(char*) * (newcount+1));\n\t\tnewlist[newcount++] = strdup(dev_list[i].udid);\n\t\t*devices = newlist;\n\t}\n\tusbmuxd_device_list_free(&dev_list);\n\n\t*count = newcount;\n\tnewlist = realloc(*devices, sizeof(char*) * (newcount+1));\n\tnewlist[newcount] = NULL;\n\t*devices = newlist;\n\n\treturn IDEVICE_E_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "print_usage",
          "args": [
            "argc",
            "argv"
          ],
          "line": 169
        },
        "resolved": true,
        "details": {
          "function_name": "print_usage",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/tools/idevicesyslog.c",
          "lines": "202-214",
          "snippet": "void print_usage(int argc, char **argv)\n{\n\tchar *name = NULL;\n\n\tname = strrchr(argv[0], '/');\n\tprintf(\"Usage: %s [OPTIONS]\\n\", (name ? name + 1: argv[0]));\n\tprintf(\"Relay syslog of a connected device.\\n\\n\");\n\tprintf(\"  -d, --debug\\t\\tenable communication debugging\\n\");\n\tprintf(\"  -u, --udid UDID\\ttarget specific device by its 40-digit device UDID\\n\");\n\tprintf(\"  -h, --help\\t\\tprints usage information\\n\");\n\tprintf(\"\\n\");\n\tprintf(\"Homepage: <\" PACKAGE_URL \">\\n\");\n}",
          "includes": [
            "#include <libimobiledevice/syslog_relay.h>",
            "#include <libimobiledevice/libimobiledevice.h>",
            "#include <windows.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "void print_usage(int argc, char **argv);",
            "static char* udid = NULL;",
            "static idevice_t device = NULL;",
            "static syslog_relay_client_t syslog = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <libimobiledevice/syslog_relay.h>\n#include <libimobiledevice/libimobiledevice.h>\n#include <windows.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <errno.h>\n#include <string.h>\n#include <stdio.h>\n#include \"config.h\"\n\nvoid print_usage(int argc, char **argv);\nstatic char* udid = NULL;\nstatic idevice_t device = NULL;\nstatic syslog_relay_client_t syslog = NULL;\n\nvoid print_usage(int argc, char **argv)\n{\n\tchar *name = NULL;\n\n\tname = strrchr(argv[0], '/');\n\tprintf(\"Usage: %s [OPTIONS]\\n\", (name ? name + 1: argv[0]));\n\tprintf(\"Relay syslog of a connected device.\\n\\n\");\n\tprintf(\"  -d, --debug\\t\\tenable communication debugging\\n\");\n\tprintf(\"  -u, --udid UDID\\ttarget specific device by its 40-digit device UDID\\n\");\n\tprintf(\"  -h, --help\\t\\tprints usage information\\n\");\n\tprintf(\"\\n\");\n\tprintf(\"Homepage: <\" PACKAGE_URL \">\\n\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "argv[i]",
            "\"--help\""
          ],
          "line": 164
        },
        "resolved": true,
        "details": {
          "function_name": "plist_strcmp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/tools/idevicebackup.c",
          "lines": "296-309",
          "snippet": "static int plist_strcmp(plist_t node, const char *str)\n{\n\tchar *buffer = NULL;\n\tint ret = 0;\n\n\tif (plist_get_node_type(node) != PLIST_STRING)\n\t\treturn ret;\n\n\tplist_get_string_val(node, &buffer);\n\tret = strcmp(buffer, str);\n\tfree(buffer);\n\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"common/utils.h\"",
            "#include <libimobiledevice/afc.h>",
            "#include <libimobiledevice/notification_proxy.h>",
            "#include <libimobiledevice/mobilebackup.h>",
            "#include <libimobiledevice/lockdown.h>",
            "#include <libimobiledevice/libimobiledevice.h>",
            "#include <time.h>",
            "#include <ctype.h>",
            "#include <unistd.h>",
            "#include <gcrypt.h>",
            "#include <openssl/sha.h>",
            "#include <signal.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"common/utils.h\"\n#include <libimobiledevice/afc.h>\n#include <libimobiledevice/notification_proxy.h>\n#include <libimobiledevice/mobilebackup.h>\n#include <libimobiledevice/lockdown.h>\n#include <libimobiledevice/libimobiledevice.h>\n#include <time.h>\n#include <ctype.h>\n#include <unistd.h>\n#include <gcrypt.h>\n#include <openssl/sha.h>\n#include <signal.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int plist_strcmp(plist_t node, const char *str)\n{\n\tchar *buffer = NULL;\n\tint ret = 0;\n\n\tif (plist_get_node_type(node) != PLIST_STRING)\n\t\treturn ret;\n\n\tplist_get_string_val(node, &buffer);\n\tret = strcmp(buffer, str);\n\tfree(buffer);\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "argv[i]"
          ],
          "line": 161
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "argv[i]"
          ],
          "line": 157
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "idevice_set_debug_level",
          "args": [
            "1"
          ],
          "line": 152
        },
        "resolved": true,
        "details": {
          "function_name": "idevice_set_debug_level",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/idevice.c",
          "lines": "225-228",
          "snippet": "LIBIMOBILEDEVICE_API void idevice_set_debug_level(int level)\n{\n\tinternal_set_debug_level(level);\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"common/thread.h\"",
            "#include \"common/userpref.h\"",
            "#include \"idevice.h\"",
            "#include <gnutls/gnutls.h>",
            "#include <openssl/ssl.h>",
            "#include <openssl/err.h>",
            "#include <usbmuxd.h>",
            "#include <windows.h>",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"common/thread.h\"\n#include \"common/userpref.h\"\n#include \"idevice.h\"\n#include <gnutls/gnutls.h>\n#include <openssl/ssl.h>\n#include <openssl/err.h>\n#include <usbmuxd.h>\n#include <windows.h>\n#include <errno.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API void idevice_set_debug_level(int level)\n{\n\tinternal_set_debug_level(level);\n}"
        }
      },
      {
        "call_info": {
          "callee": "signal",
          "args": [
            "SIGPIPE",
            "SIG_IGN"
          ],
          "line": 146
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "signal",
          "args": [
            "SIGQUIT",
            "clean_exit"
          ],
          "line": 145
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "signal",
          "args": [
            "SIGTERM",
            "clean_exit"
          ],
          "line": 143
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "signal",
          "args": [
            "SIGINT",
            "clean_exit"
          ],
          "line": 142
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <libimobiledevice/syslog_relay.h>\n#include <libimobiledevice/libimobiledevice.h>\n#include <windows.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <errno.h>\n#include <string.h>\n#include <stdio.h>\n#include \"config.h\"\n\nstatic int quit_flag = 0;\nvoid print_usage(int argc, char **argv);\nstatic char* udid = NULL;\nstatic idevice_t device = NULL;\n\nint main(int argc, char *argv[])\n{\n\tint i;\n\n\tsignal(SIGINT, clean_exit);\n\tsignal(SIGTERM, clean_exit);\n#ifndef WIN32\n\tsignal(SIGQUIT, clean_exit);\n\tsignal(SIGPIPE, SIG_IGN);\n#endif\n\n\t/* parse cmdline args */\n\tfor (i = 1; i < argc; i++) {\n\t\tif (!strcmp(argv[i], \"-d\") || !strcmp(argv[i], \"--debug\")) {\n\t\t\tidevice_set_debug_level(1);\n\t\t\tcontinue;\n\t\t}\n\t\telse if (!strcmp(argv[i], \"-u\") || !strcmp(argv[i], \"--udid\")) {\n\t\t\ti++;\n\t\t\tif (!argv[i] || (strlen(argv[i]) != 40)) {\n\t\t\t\tprint_usage(argc, argv);\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t\tudid = strdup(argv[i]);\n\t\t\tcontinue;\n\t\t}\n\t\telse if (!strcmp(argv[i], \"-h\") || !strcmp(argv[i], \"--help\")) {\n\t\t\tprint_usage(argc, argv);\n\t\t\treturn 0;\n\t\t}\n\t\telse {\n\t\t\tprint_usage(argc, argv);\n\t\t\treturn 0;\n\t\t}\n\t}\n\n\tint num = 0;\n\tchar **devices = NULL;\n\tidevice_get_device_list(&devices, &num);\n\tidevice_device_list_free(devices);\n\tif (num == 0) {\n\t\tif (!udid) {\n\t\t\tfprintf(stderr, \"No device found. Plug in a device or pass UDID with -u to wait for device to be available.\\n\");\n\t\t\treturn -1;\n\t\t} else {\n\t\t\tfprintf(stderr, \"Waiting for device with UDID %s to become available...\\n\", udid);\n\t\t}\n\t}\n\n\tidevice_event_subscribe(device_event_cb, NULL);\n\n\twhile (!quit_flag) {\n\t\tsleep(1);\n\t}\n\tidevice_event_unsubscribe();\n\tstop_logging();\n\n\tif (udid) {\n\t\tfree(udid);\n\t}\n\n\treturn 0;\n}"
  },
  {
    "function_name": "clean_exit",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/tools/idevicesyslog.c",
    "lines": "132-136",
    "snippet": "static void clean_exit(int sig)\n{\n\tfprintf(stderr, \"\\nExiting...\\n\");\n\tquit_flag++;\n}",
    "includes": [
      "#include <libimobiledevice/syslog_relay.h>",
      "#include <libimobiledevice/libimobiledevice.h>",
      "#include <windows.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <signal.h>",
      "#include <errno.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static int quit_flag = 0;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"\\nExiting...\\n\""
          ],
          "line": 134
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <libimobiledevice/syslog_relay.h>\n#include <libimobiledevice/libimobiledevice.h>\n#include <windows.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <errno.h>\n#include <string.h>\n#include <stdio.h>\n#include \"config.h\"\n\nstatic int quit_flag = 0;\n\nstatic void clean_exit(int sig)\n{\n\tfprintf(stderr, \"\\nExiting...\\n\");\n\tquit_flag++;\n}"
  },
  {
    "function_name": "device_event_cb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/tools/idevicesyslog.c",
    "lines": "108-127",
    "snippet": "static void device_event_cb(const idevice_event_t* event, void* userdata)\n{\n\tif (event->event == IDEVICE_DEVICE_ADD) {\n\t\tif (!syslog) {\n\t\t\tif (!udid) {\n\t\t\t\tudid = strdup(event->udid);\n\t\t\t}\n\t\t\tif (strcmp(udid, event->udid) == 0) {\n\t\t\t\tif (start_logging() != 0) {\n\t\t\t\t\tfprintf(stderr, \"Could not start logger for udid %s\\n\", udid);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} else if (event->event == IDEVICE_DEVICE_REMOVE) {\n\t\tif (syslog && (strcmp(udid, event->udid) == 0)) {\n\t\t\tstop_logging();\n\t\t\tfprintf(stdout, \"[disconnected]\\n\");\n\t\t}\n\t}\n}",
    "includes": [
      "#include <libimobiledevice/syslog_relay.h>",
      "#include <libimobiledevice/libimobiledevice.h>",
      "#include <windows.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <signal.h>",
      "#include <errno.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static char* udid = NULL;",
      "static syslog_relay_client_t syslog = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stdout",
            "\"[disconnected]\\n\""
          ],
          "line": 124
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "stop_logging",
          "args": [],
          "line": 123
        },
        "resolved": true,
        "details": {
          "function_name": "stop_logging",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/tools/idevicesyslog.c",
          "lines": "93-106",
          "snippet": "static void stop_logging(void)\n{\n\tfflush(stdout);\n\n\tif (syslog) {\n\t\tsyslog_relay_client_free(syslog);\n\t\tsyslog = NULL;\n\t}\n\n\tif (device) {\n\t\tidevice_free(device);\n\t\tdevice = NULL;\n\t}\n}",
          "includes": [
            "#include <libimobiledevice/syslog_relay.h>",
            "#include <libimobiledevice/libimobiledevice.h>",
            "#include <windows.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static idevice_t device = NULL;",
            "static syslog_relay_client_t syslog = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <libimobiledevice/syslog_relay.h>\n#include <libimobiledevice/libimobiledevice.h>\n#include <windows.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <errno.h>\n#include <string.h>\n#include <stdio.h>\n#include \"config.h\"\n\nstatic idevice_t device = NULL;\nstatic syslog_relay_client_t syslog = NULL;\n\nstatic void stop_logging(void)\n{\n\tfflush(stdout);\n\n\tif (syslog) {\n\t\tsyslog_relay_client_free(syslog);\n\t\tsyslog = NULL;\n\t}\n\n\tif (device) {\n\t\tidevice_free(device);\n\t\tdevice = NULL;\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "udid",
            "event->udid"
          ],
          "line": 122
        },
        "resolved": true,
        "details": {
          "function_name": "plist_strcmp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/tools/idevicebackup.c",
          "lines": "296-309",
          "snippet": "static int plist_strcmp(plist_t node, const char *str)\n{\n\tchar *buffer = NULL;\n\tint ret = 0;\n\n\tif (plist_get_node_type(node) != PLIST_STRING)\n\t\treturn ret;\n\n\tplist_get_string_val(node, &buffer);\n\tret = strcmp(buffer, str);\n\tfree(buffer);\n\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"common/utils.h\"",
            "#include <libimobiledevice/afc.h>",
            "#include <libimobiledevice/notification_proxy.h>",
            "#include <libimobiledevice/mobilebackup.h>",
            "#include <libimobiledevice/lockdown.h>",
            "#include <libimobiledevice/libimobiledevice.h>",
            "#include <time.h>",
            "#include <ctype.h>",
            "#include <unistd.h>",
            "#include <gcrypt.h>",
            "#include <openssl/sha.h>",
            "#include <signal.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"common/utils.h\"\n#include <libimobiledevice/afc.h>\n#include <libimobiledevice/notification_proxy.h>\n#include <libimobiledevice/mobilebackup.h>\n#include <libimobiledevice/lockdown.h>\n#include <libimobiledevice/libimobiledevice.h>\n#include <time.h>\n#include <ctype.h>\n#include <unistd.h>\n#include <gcrypt.h>\n#include <openssl/sha.h>\n#include <signal.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int plist_strcmp(plist_t node, const char *str)\n{\n\tchar *buffer = NULL;\n\tint ret = 0;\n\n\tif (plist_get_node_type(node) != PLIST_STRING)\n\t\treturn ret;\n\n\tplist_get_string_val(node, &buffer);\n\tret = strcmp(buffer, str);\n\tfree(buffer);\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Could not start logger for udid %s\\n\"",
            "udid"
          ],
          "line": 117
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "start_logging",
          "args": [],
          "line": 116
        },
        "resolved": true,
        "details": {
          "function_name": "start_logging",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/tools/idevicesyslog.c",
          "lines": "58-91",
          "snippet": "static int start_logging(void)\n{\n\tidevice_error_t ret = idevice_new(&device, udid);\n\tif (ret != IDEVICE_E_SUCCESS) {\n\t\tfprintf(stderr, \"Device with udid %s not found!?\\n\", udid);\n\t\treturn -1;\n\t}\n\n\t/* start and connect to syslog_relay service */\n\tsyslog_relay_error_t serr = SYSLOG_RELAY_E_UNKNOWN_ERROR;\n\tserr = syslog_relay_client_start_service(device, &syslog, \"idevicesyslog\");\n\tif (serr != SYSLOG_RELAY_E_SUCCESS) {\n\t\tfprintf(stderr, \"ERROR: Could not start service com.apple.syslog_relay.\\n\");\n\t\tidevice_free(device);\n\t\tdevice = NULL;\n\t\treturn -1;\n\t}\n\n\t/* start capturing syslog */\n\tserr = syslog_relay_start_capture(syslog, syslog_callback, NULL);\n\tif (serr != SYSLOG_RELAY_E_SUCCESS) {\n\t\tfprintf(stderr, \"ERROR: Unable tot start capturing syslog.\\n\");\n\t\tsyslog_relay_client_free(syslog);\n\t\tsyslog = NULL;\n\t\tidevice_free(device);\n\t\tdevice = NULL;\n\t\treturn -1;\n\t}\n\n\tfprintf(stdout, \"[connected]\\n\");\n\tfflush(stdout);\n\n\treturn 0;\n}",
          "includes": [
            "#include <libimobiledevice/syslog_relay.h>",
            "#include <libimobiledevice/libimobiledevice.h>",
            "#include <windows.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static char* udid = NULL;",
            "static idevice_t device = NULL;",
            "static syslog_relay_client_t syslog = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <libimobiledevice/syslog_relay.h>\n#include <libimobiledevice/libimobiledevice.h>\n#include <windows.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <errno.h>\n#include <string.h>\n#include <stdio.h>\n#include \"config.h\"\n\nstatic char* udid = NULL;\nstatic idevice_t device = NULL;\nstatic syslog_relay_client_t syslog = NULL;\n\nstatic int start_logging(void)\n{\n\tidevice_error_t ret = idevice_new(&device, udid);\n\tif (ret != IDEVICE_E_SUCCESS) {\n\t\tfprintf(stderr, \"Device with udid %s not found!?\\n\", udid);\n\t\treturn -1;\n\t}\n\n\t/* start and connect to syslog_relay service */\n\tsyslog_relay_error_t serr = SYSLOG_RELAY_E_UNKNOWN_ERROR;\n\tserr = syslog_relay_client_start_service(device, &syslog, \"idevicesyslog\");\n\tif (serr != SYSLOG_RELAY_E_SUCCESS) {\n\t\tfprintf(stderr, \"ERROR: Could not start service com.apple.syslog_relay.\\n\");\n\t\tidevice_free(device);\n\t\tdevice = NULL;\n\t\treturn -1;\n\t}\n\n\t/* start capturing syslog */\n\tserr = syslog_relay_start_capture(syslog, syslog_callback, NULL);\n\tif (serr != SYSLOG_RELAY_E_SUCCESS) {\n\t\tfprintf(stderr, \"ERROR: Unable tot start capturing syslog.\\n\");\n\t\tsyslog_relay_client_free(syslog);\n\t\tsyslog = NULL;\n\t\tidevice_free(device);\n\t\tdevice = NULL;\n\t\treturn -1;\n\t}\n\n\tfprintf(stdout, \"[connected]\\n\");\n\tfflush(stdout);\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "event->udid"
          ],
          "line": 113
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <libimobiledevice/syslog_relay.h>\n#include <libimobiledevice/libimobiledevice.h>\n#include <windows.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <errno.h>\n#include <string.h>\n#include <stdio.h>\n#include \"config.h\"\n\nstatic char* udid = NULL;\nstatic syslog_relay_client_t syslog = NULL;\n\nstatic void device_event_cb(const idevice_event_t* event, void* userdata)\n{\n\tif (event->event == IDEVICE_DEVICE_ADD) {\n\t\tif (!syslog) {\n\t\t\tif (!udid) {\n\t\t\t\tudid = strdup(event->udid);\n\t\t\t}\n\t\t\tif (strcmp(udid, event->udid) == 0) {\n\t\t\t\tif (start_logging() != 0) {\n\t\t\t\t\tfprintf(stderr, \"Could not start logger for udid %s\\n\", udid);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} else if (event->event == IDEVICE_DEVICE_REMOVE) {\n\t\tif (syslog && (strcmp(udid, event->udid) == 0)) {\n\t\t\tstop_logging();\n\t\t\tfprintf(stdout, \"[disconnected]\\n\");\n\t\t}\n\t}\n}"
  },
  {
    "function_name": "stop_logging",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/tools/idevicesyslog.c",
    "lines": "93-106",
    "snippet": "static void stop_logging(void)\n{\n\tfflush(stdout);\n\n\tif (syslog) {\n\t\tsyslog_relay_client_free(syslog);\n\t\tsyslog = NULL;\n\t}\n\n\tif (device) {\n\t\tidevice_free(device);\n\t\tdevice = NULL;\n\t}\n}",
    "includes": [
      "#include <libimobiledevice/syslog_relay.h>",
      "#include <libimobiledevice/libimobiledevice.h>",
      "#include <windows.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <signal.h>",
      "#include <errno.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static idevice_t device = NULL;",
      "static syslog_relay_client_t syslog = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "idevice_free",
          "args": [
            "device"
          ],
          "line": 103
        },
        "resolved": true,
        "details": {
          "function_name": "idevice_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/idevice.c",
          "lines": "247-265",
          "snippet": "LIBIMOBILEDEVICE_API idevice_error_t idevice_free(idevice_t device)\n{\n\tif (!device)\n\t\treturn IDEVICE_E_INVALID_ARG;\n\tidevice_error_t ret = IDEVICE_E_UNKNOWN_ERROR;\n\n\tret = IDEVICE_E_SUCCESS;\n\n\tfree(device->udid);\n\n\tif (device->conn_type == CONNECTION_USBMUXD) {\n\t\tdevice->conn_data = 0;\n\t}\n\tif (device->conn_data) {\n\t\tfree(device->conn_data);\n\t}\n\tfree(device);\n\treturn ret;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"common/thread.h\"",
            "#include \"common/userpref.h\"",
            "#include \"idevice.h\"",
            "#include <gnutls/gnutls.h>",
            "#include <openssl/ssl.h>",
            "#include <openssl/err.h>",
            "#include <usbmuxd.h>",
            "#include <windows.h>",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "LIBIMOBILEDEVICE_API idevice_error_t"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"common/thread.h\"\n#include \"common/userpref.h\"\n#include \"idevice.h\"\n#include <gnutls/gnutls.h>\n#include <openssl/ssl.h>\n#include <openssl/err.h>\n#include <usbmuxd.h>\n#include <windows.h>\n#include <errno.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API idevice_error_t;\n\nLIBIMOBILEDEVICE_API idevice_error_t idevice_free(idevice_t device)\n{\n\tif (!device)\n\t\treturn IDEVICE_E_INVALID_ARG;\n\tidevice_error_t ret = IDEVICE_E_UNKNOWN_ERROR;\n\n\tret = IDEVICE_E_SUCCESS;\n\n\tfree(device->udid);\n\n\tif (device->conn_type == CONNECTION_USBMUXD) {\n\t\tdevice->conn_data = 0;\n\t}\n\tif (device->conn_data) {\n\t\tfree(device->conn_data);\n\t}\n\tfree(device);\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "syslog_relay_client_free",
          "args": [
            "syslog"
          ],
          "line": 98
        },
        "resolved": true,
        "details": {
          "function_name": "syslog_relay_client_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/syslog_relay.c",
          "lines": "99-115",
          "snippet": "LIBIMOBILEDEVICE_API syslog_relay_error_t syslog_relay_client_free(syslog_relay_client_t client)\n{\n\tif (!client)\n\t\treturn SYSLOG_RELAY_E_INVALID_ARG;\n\n\tsyslog_relay_error_t err = syslog_relay_error(service_client_free(client->parent));\n\tclient->parent = NULL;\n\tif (client->worker) {\n\t\tdebug_info(\"Joining syslog capture callback worker thread\");\n\t\tthread_join(client->worker);\n\t\tthread_free(client->worker);\n\t\tclient->worker = (thread_t)NULL;\n\t}\n\tfree(client);\n\n\treturn err;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"lockdown.h\"",
            "#include \"syslog_relay.h\"",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"syslog_relay.h\"\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API syslog_relay_error_t syslog_relay_client_free(syslog_relay_client_t client)\n{\n\tif (!client)\n\t\treturn SYSLOG_RELAY_E_INVALID_ARG;\n\n\tsyslog_relay_error_t err = syslog_relay_error(service_client_free(client->parent));\n\tclient->parent = NULL;\n\tif (client->worker) {\n\t\tdebug_info(\"Joining syslog capture callback worker thread\");\n\t\tthread_join(client->worker);\n\t\tthread_free(client->worker);\n\t\tclient->worker = (thread_t)NULL;\n\t}\n\tfree(client);\n\n\treturn err;\n}"
        }
      },
      {
        "call_info": {
          "callee": "fflush",
          "args": [
            "stdout"
          ],
          "line": 95
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <libimobiledevice/syslog_relay.h>\n#include <libimobiledevice/libimobiledevice.h>\n#include <windows.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <errno.h>\n#include <string.h>\n#include <stdio.h>\n#include \"config.h\"\n\nstatic idevice_t device = NULL;\nstatic syslog_relay_client_t syslog = NULL;\n\nstatic void stop_logging(void)\n{\n\tfflush(stdout);\n\n\tif (syslog) {\n\t\tsyslog_relay_client_free(syslog);\n\t\tsyslog = NULL;\n\t}\n\n\tif (device) {\n\t\tidevice_free(device);\n\t\tdevice = NULL;\n\t}\n}"
  },
  {
    "function_name": "start_logging",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/tools/idevicesyslog.c",
    "lines": "58-91",
    "snippet": "static int start_logging(void)\n{\n\tidevice_error_t ret = idevice_new(&device, udid);\n\tif (ret != IDEVICE_E_SUCCESS) {\n\t\tfprintf(stderr, \"Device with udid %s not found!?\\n\", udid);\n\t\treturn -1;\n\t}\n\n\t/* start and connect to syslog_relay service */\n\tsyslog_relay_error_t serr = SYSLOG_RELAY_E_UNKNOWN_ERROR;\n\tserr = syslog_relay_client_start_service(device, &syslog, \"idevicesyslog\");\n\tif (serr != SYSLOG_RELAY_E_SUCCESS) {\n\t\tfprintf(stderr, \"ERROR: Could not start service com.apple.syslog_relay.\\n\");\n\t\tidevice_free(device);\n\t\tdevice = NULL;\n\t\treturn -1;\n\t}\n\n\t/* start capturing syslog */\n\tserr = syslog_relay_start_capture(syslog, syslog_callback, NULL);\n\tif (serr != SYSLOG_RELAY_E_SUCCESS) {\n\t\tfprintf(stderr, \"ERROR: Unable tot start capturing syslog.\\n\");\n\t\tsyslog_relay_client_free(syslog);\n\t\tsyslog = NULL;\n\t\tidevice_free(device);\n\t\tdevice = NULL;\n\t\treturn -1;\n\t}\n\n\tfprintf(stdout, \"[connected]\\n\");\n\tfflush(stdout);\n\n\treturn 0;\n}",
    "includes": [
      "#include <libimobiledevice/syslog_relay.h>",
      "#include <libimobiledevice/libimobiledevice.h>",
      "#include <windows.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <signal.h>",
      "#include <errno.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static char* udid = NULL;",
      "static idevice_t device = NULL;",
      "static syslog_relay_client_t syslog = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "fflush",
          "args": [
            "stdout"
          ],
          "line": 88
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stdout",
            "\"[connected]\\n\""
          ],
          "line": 87
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "idevice_free",
          "args": [
            "device"
          ],
          "line": 82
        },
        "resolved": true,
        "details": {
          "function_name": "idevice_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/idevice.c",
          "lines": "247-265",
          "snippet": "LIBIMOBILEDEVICE_API idevice_error_t idevice_free(idevice_t device)\n{\n\tif (!device)\n\t\treturn IDEVICE_E_INVALID_ARG;\n\tidevice_error_t ret = IDEVICE_E_UNKNOWN_ERROR;\n\n\tret = IDEVICE_E_SUCCESS;\n\n\tfree(device->udid);\n\n\tif (device->conn_type == CONNECTION_USBMUXD) {\n\t\tdevice->conn_data = 0;\n\t}\n\tif (device->conn_data) {\n\t\tfree(device->conn_data);\n\t}\n\tfree(device);\n\treturn ret;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"common/thread.h\"",
            "#include \"common/userpref.h\"",
            "#include \"idevice.h\"",
            "#include <gnutls/gnutls.h>",
            "#include <openssl/ssl.h>",
            "#include <openssl/err.h>",
            "#include <usbmuxd.h>",
            "#include <windows.h>",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "LIBIMOBILEDEVICE_API idevice_error_t"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"common/thread.h\"\n#include \"common/userpref.h\"\n#include \"idevice.h\"\n#include <gnutls/gnutls.h>\n#include <openssl/ssl.h>\n#include <openssl/err.h>\n#include <usbmuxd.h>\n#include <windows.h>\n#include <errno.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API idevice_error_t;\n\nLIBIMOBILEDEVICE_API idevice_error_t idevice_free(idevice_t device)\n{\n\tif (!device)\n\t\treturn IDEVICE_E_INVALID_ARG;\n\tidevice_error_t ret = IDEVICE_E_UNKNOWN_ERROR;\n\n\tret = IDEVICE_E_SUCCESS;\n\n\tfree(device->udid);\n\n\tif (device->conn_type == CONNECTION_USBMUXD) {\n\t\tdevice->conn_data = 0;\n\t}\n\tif (device->conn_data) {\n\t\tfree(device->conn_data);\n\t}\n\tfree(device);\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "syslog_relay_client_free",
          "args": [
            "syslog"
          ],
          "line": 80
        },
        "resolved": true,
        "details": {
          "function_name": "syslog_relay_client_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/syslog_relay.c",
          "lines": "99-115",
          "snippet": "LIBIMOBILEDEVICE_API syslog_relay_error_t syslog_relay_client_free(syslog_relay_client_t client)\n{\n\tif (!client)\n\t\treturn SYSLOG_RELAY_E_INVALID_ARG;\n\n\tsyslog_relay_error_t err = syslog_relay_error(service_client_free(client->parent));\n\tclient->parent = NULL;\n\tif (client->worker) {\n\t\tdebug_info(\"Joining syslog capture callback worker thread\");\n\t\tthread_join(client->worker);\n\t\tthread_free(client->worker);\n\t\tclient->worker = (thread_t)NULL;\n\t}\n\tfree(client);\n\n\treturn err;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"lockdown.h\"",
            "#include \"syslog_relay.h\"",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"syslog_relay.h\"\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API syslog_relay_error_t syslog_relay_client_free(syslog_relay_client_t client)\n{\n\tif (!client)\n\t\treturn SYSLOG_RELAY_E_INVALID_ARG;\n\n\tsyslog_relay_error_t err = syslog_relay_error(service_client_free(client->parent));\n\tclient->parent = NULL;\n\tif (client->worker) {\n\t\tdebug_info(\"Joining syslog capture callback worker thread\");\n\t\tthread_join(client->worker);\n\t\tthread_free(client->worker);\n\t\tclient->worker = (thread_t)NULL;\n\t}\n\tfree(client);\n\n\treturn err;\n}"
        }
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"ERROR: Unable tot start capturing syslog.\\n\""
          ],
          "line": 79
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "syslog_relay_start_capture",
          "args": [
            "syslog",
            "syslog_callback",
            "NULL"
          ],
          "line": 77
        },
        "resolved": true,
        "details": {
          "function_name": "syslog_relay_start_capture",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/syslog_relay.c",
          "lines": "176-201",
          "snippet": "LIBIMOBILEDEVICE_API syslog_relay_error_t syslog_relay_start_capture(syslog_relay_client_t client, syslog_relay_receive_cb_t callback, void* user_data)\n{\n\tif (!client || !callback)\n\t\treturn SYSLOG_RELAY_E_INVALID_ARG;\n\n\tsyslog_relay_error_t res = SYSLOG_RELAY_E_UNKNOWN_ERROR;\n\n\tif (client->worker) {\n\t\tdebug_info(\"Another syslog capture thread appears to be running already.\");\n\t\treturn res;\n\t}\n\n\t/* start worker thread */\n\tstruct syslog_relay_worker_thread *srwt = (struct syslog_relay_worker_thread*)malloc(sizeof(struct syslog_relay_worker_thread));\n\tif (srwt) {\n\t\tsrwt->client = client;\n\t\tsrwt->cbfunc = callback;\n\t\tsrwt->user_data = user_data;\n\n\t\tif (thread_new(&client->worker, syslog_relay_worker, srwt) == 0) {\n\t\t\tres = SYSLOG_RELAY_E_SUCCESS;\n\t\t}\n\t}\n\n\treturn res;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"lockdown.h\"",
            "#include \"syslog_relay.h\"",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"syslog_relay.h\"\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API syslog_relay_error_t syslog_relay_start_capture(syslog_relay_client_t client, syslog_relay_receive_cb_t callback, void* user_data)\n{\n\tif (!client || !callback)\n\t\treturn SYSLOG_RELAY_E_INVALID_ARG;\n\n\tsyslog_relay_error_t res = SYSLOG_RELAY_E_UNKNOWN_ERROR;\n\n\tif (client->worker) {\n\t\tdebug_info(\"Another syslog capture thread appears to be running already.\");\n\t\treturn res;\n\t}\n\n\t/* start worker thread */\n\tstruct syslog_relay_worker_thread *srwt = (struct syslog_relay_worker_thread*)malloc(sizeof(struct syslog_relay_worker_thread));\n\tif (srwt) {\n\t\tsrwt->client = client;\n\t\tsrwt->cbfunc = callback;\n\t\tsrwt->user_data = user_data;\n\n\t\tif (thread_new(&client->worker, syslog_relay_worker, srwt) == 0) {\n\t\t\tres = SYSLOG_RELAY_E_SUCCESS;\n\t\t}\n\t}\n\n\treturn res;\n}"
        }
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"ERROR: Could not start service com.apple.syslog_relay.\\n\""
          ],
          "line": 70
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "syslog_relay_client_start_service",
          "args": [
            "device",
            "&syslog",
            "\"idevicesyslog\""
          ],
          "line": 68
        },
        "resolved": true,
        "details": {
          "function_name": "syslog_relay_client_start_service",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/syslog_relay.c",
          "lines": "92-97",
          "snippet": "LIBIMOBILEDEVICE_API syslog_relay_error_t syslog_relay_client_start_service(idevice_t device, syslog_relay_client_t * client, const char* label)\n{\n\tsyslog_relay_error_t err = SYSLOG_RELAY_E_UNKNOWN_ERROR;\n\tservice_client_factory_start_service(device, SYSLOG_RELAY_SERVICE_NAME, (void**)client, label, SERVICE_CONSTRUCTOR(syslog_relay_client_new), &err);\n\treturn err;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"lockdown.h\"",
            "#include \"syslog_relay.h\"",
            "#include <stdlib.h>",
            "#include <string.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"lockdown.h\"\n#include \"syslog_relay.h\"\n#include <stdlib.h>\n#include <string.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API syslog_relay_error_t syslog_relay_client_start_service(idevice_t device, syslog_relay_client_t * client, const char* label)\n{\n\tsyslog_relay_error_t err = SYSLOG_RELAY_E_UNKNOWN_ERROR;\n\tservice_client_factory_start_service(device, SYSLOG_RELAY_SERVICE_NAME, (void**)client, label, SERVICE_CONSTRUCTOR(syslog_relay_client_new), &err);\n\treturn err;\n}"
        }
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Device with udid %s not found!?\\n\"",
            "udid"
          ],
          "line": 62
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "idevice_new",
          "args": [
            "&device",
            "udid"
          ],
          "line": 60
        },
        "resolved": true,
        "details": {
          "function_name": "idevice_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/idevice.c",
          "lines": "230-245",
          "snippet": "LIBIMOBILEDEVICE_API idevice_error_t idevice_new(idevice_t * device, const char *udid)\n{\n\tusbmuxd_device_info_t muxdev;\n\tint res = usbmuxd_get_device_by_udid(udid, &muxdev);\n\tif (res > 0) {\n\t\tidevice_t dev = (idevice_t) malloc(sizeof(struct idevice_private));\n\t\tdev->udid = strdup(muxdev.udid);\n\t\tdev->conn_type = CONNECTION_USBMUXD;\n\t\tdev->conn_data = (void*)(long)muxdev.handle;\n\t\t*device = dev;\n\t\treturn IDEVICE_E_SUCCESS;\n\t}\n\t/* other connection types could follow here */\n\n\treturn IDEVICE_E_NO_DEVICE;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"common/thread.h\"",
            "#include \"common/userpref.h\"",
            "#include \"idevice.h\"",
            "#include <gnutls/gnutls.h>",
            "#include <openssl/ssl.h>",
            "#include <openssl/err.h>",
            "#include <usbmuxd.h>",
            "#include <windows.h>",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "LIBIMOBILEDEVICE_API idevice_error_t"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"common/thread.h\"\n#include \"common/userpref.h\"\n#include \"idevice.h\"\n#include <gnutls/gnutls.h>\n#include <openssl/ssl.h>\n#include <openssl/err.h>\n#include <usbmuxd.h>\n#include <windows.h>\n#include <errno.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API idevice_error_t;\n\nLIBIMOBILEDEVICE_API idevice_error_t idevice_new(idevice_t * device, const char *udid)\n{\n\tusbmuxd_device_info_t muxdev;\n\tint res = usbmuxd_get_device_by_udid(udid, &muxdev);\n\tif (res > 0) {\n\t\tidevice_t dev = (idevice_t) malloc(sizeof(struct idevice_private));\n\t\tdev->udid = strdup(muxdev.udid);\n\t\tdev->conn_type = CONNECTION_USBMUXD;\n\t\tdev->conn_data = (void*)(long)muxdev.handle;\n\t\t*device = dev;\n\t\treturn IDEVICE_E_SUCCESS;\n\t}\n\t/* other connection types could follow here */\n\n\treturn IDEVICE_E_NO_DEVICE;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <libimobiledevice/syslog_relay.h>\n#include <libimobiledevice/libimobiledevice.h>\n#include <windows.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <errno.h>\n#include <string.h>\n#include <stdio.h>\n#include \"config.h\"\n\nstatic char* udid = NULL;\nstatic idevice_t device = NULL;\nstatic syslog_relay_client_t syslog = NULL;\n\nstatic int start_logging(void)\n{\n\tidevice_error_t ret = idevice_new(&device, udid);\n\tif (ret != IDEVICE_E_SUCCESS) {\n\t\tfprintf(stderr, \"Device with udid %s not found!?\\n\", udid);\n\t\treturn -1;\n\t}\n\n\t/* start and connect to syslog_relay service */\n\tsyslog_relay_error_t serr = SYSLOG_RELAY_E_UNKNOWN_ERROR;\n\tserr = syslog_relay_client_start_service(device, &syslog, \"idevicesyslog\");\n\tif (serr != SYSLOG_RELAY_E_SUCCESS) {\n\t\tfprintf(stderr, \"ERROR: Could not start service com.apple.syslog_relay.\\n\");\n\t\tidevice_free(device);\n\t\tdevice = NULL;\n\t\treturn -1;\n\t}\n\n\t/* start capturing syslog */\n\tserr = syslog_relay_start_capture(syslog, syslog_callback, NULL);\n\tif (serr != SYSLOG_RELAY_E_SUCCESS) {\n\t\tfprintf(stderr, \"ERROR: Unable tot start capturing syslog.\\n\");\n\t\tsyslog_relay_client_free(syslog);\n\t\tsyslog = NULL;\n\t\tidevice_free(device);\n\t\tdevice = NULL;\n\t\treturn -1;\n\t}\n\n\tfprintf(stdout, \"[connected]\\n\");\n\tfflush(stdout);\n\n\treturn 0;\n}"
  },
  {
    "function_name": "syslog_callback",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/tools/idevicesyslog.c",
    "lines": "50-56",
    "snippet": "static void syslog_callback(char c, void *user_data)\n{\n\tputchar(c);\n\tif (c == '\\n') {\n\t\tfflush(stdout);\n\t}\n}",
    "includes": [
      "#include <libimobiledevice/syslog_relay.h>",
      "#include <libimobiledevice/libimobiledevice.h>",
      "#include <windows.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <signal.h>",
      "#include <errno.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include \"config.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "fflush",
          "args": [
            "stdout"
          ],
          "line": 54
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "putchar",
          "args": [
            "c"
          ],
          "line": 52
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <libimobiledevice/syslog_relay.h>\n#include <libimobiledevice/libimobiledevice.h>\n#include <windows.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <errno.h>\n#include <string.h>\n#include <stdio.h>\n#include \"config.h\"\n\nstatic void syslog_callback(char c, void *user_data)\n{\n\tputchar(c);\n\tif (c == '\\n') {\n\t\tfflush(stdout);\n\t}\n}"
  }
]