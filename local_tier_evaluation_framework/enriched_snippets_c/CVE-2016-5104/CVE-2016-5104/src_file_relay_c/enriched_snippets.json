[
  {
    "function_name": "file_relay_request_sources",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/file_relay.c",
    "lines": "157-160",
    "snippet": "LIBIMOBILEDEVICE_API file_relay_error_t file_relay_request_sources(file_relay_client_t client, const char **sources, idevice_connection_t *connection)\n{\n\treturn file_relay_request_sources_timeout(client, sources, connection, 60000);\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"property_list_service.h\"",
      "#include \"file_relay.h\"",
      "#include <stdlib.h>",
      "#include <string.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "file_relay_request_sources_timeout",
          "args": [
            "client",
            "sources",
            "connection",
            "60000"
          ],
          "line": 159
        },
        "resolved": true,
        "details": {
          "function_name": "file_relay_request_sources_timeout",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/file_relay.c",
          "lines": "65-155",
          "snippet": "LIBIMOBILEDEVICE_API file_relay_error_t file_relay_request_sources_timeout(file_relay_client_t client, const char **sources, idevice_connection_t *connection, unsigned int timeout)\n{\n\tif (!client || !client->parent || !sources || !sources[0]) {\n\t\treturn FILE_RELAY_E_INVALID_ARG;\n\t}\n\t*connection = NULL;\n\tfile_relay_error_t err = FILE_RELAY_E_UNKNOWN_ERROR;\n\t/* set up request plist */\n\tplist_t array = plist_new_array();\n\tint i = 0;\n\twhile (sources[i]) {\n\t\tplist_array_append_item(array, plist_new_string(sources[i]));\n\t\ti++;\n\t}\n\tplist_t dict = plist_new_dict();\n\tplist_dict_set_item(dict, \"Sources\", array);\n\n\tif (property_list_service_send_xml_plist(client->parent, dict) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tdebug_info(\"ERROR: Could not send request to device!\");\n\t\terr = FILE_RELAY_E_MUX_ERROR;\n\t\tgoto leave;\n\t}\n\tplist_free(dict);\n\n\tdict = NULL;\n\tif (property_list_service_receive_plist_with_timeout(client->parent, &dict, timeout) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tdebug_info(\"ERROR: Could not receive answer from device!\");\n\t\terr = FILE_RELAY_E_MUX_ERROR;\n\t\tgoto leave;\n\t}\n\n\tif (!dict) {\n\t\tdebug_info(\"ERROR: Did not receive any plist!\");\n\t\terr = FILE_RELAY_E_PLIST_ERROR;\n\t\tgoto leave;\n\t}\n\n\tplist_t error = plist_dict_get_item(dict, \"Error\");\n\tif (error) {\n\t\tchar *errmsg = NULL;\n\t\tplist_get_string_val(error, &errmsg);\n\t\tif (errmsg) {\n\t\t\tif (!strcmp(errmsg, \"InvalidSource\")) {\n\t\t\t\tdebug_info(\"ERROR: One or more given sources are invalid!\");\n\t\t\t\terr = FILE_RELAY_E_INVALID_SOURCE;\n\t\t\t} else if (!strcmp(errmsg, \"StagingEmpty\")) {\n\t\t\t\tdebug_info(\"ERROR: StagingEmpty - No data available!\");\n\t\t\t\terr = FILE_RELAY_E_STAGING_EMPTY;\n\t\t\t} else if (!strcmp(errmsg, \"PermissionDenied\")) {\n\t\t\t\tdebug_info(\"ERROR: Permission denied.\");\n\t\t\t\terr = FILE_RELAY_E_PERMISSION_DENIED;\n\t\t\t} else {\n\t\t\t\tdebug_info(\"ERROR: Unknown error '%s'\", errmsg);\n\t\t\t}\n\t\t\tfree(errmsg);\n\t\t} else {\n\t\t\tdebug_info(\"ERROR: Could not get error message!\");\n\t\t}\n\t\tgoto leave;\n\t}\n\n\tplist_t status = plist_dict_get_item(dict, \"Status\");\n\tif (!status) {\n\t\tdebug_info(\"ERROR: Unexpected plist received!\");\n\t\tdebug_plist(dict);\n\t\terr = FILE_RELAY_E_PLIST_ERROR;\n\t\tgoto leave;\n\t}\n\n\tchar *ack = NULL;\n\tplist_get_string_val(status, &ack);\n\tif (!ack) {\n\t\tdebug_info(\"ERROR: Could not get 'Acknowledged' string!\");\n\t\tgoto leave;\n\t}\n\n\tif (strcmp(ack, \"Acknowledged\")) {\n\t\tdebug_info(\"ERROR: Did not receive 'Acknowledged' but '%s'\", ack);\n\t\tgoto leave;\n\t}\n\tfree(ack);\n\terr = FILE_RELAY_E_SUCCESS;\n\n\t*connection = client->parent->parent->connection;\n\nleave:\n\tif (dict) {\n\t\tplist_free(dict);\n\t}\n\treturn err;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include \"file_relay.h\"",
            "#include <stdlib.h>",
            "#include <string.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"file_relay.h\"\n#include <stdlib.h>\n#include <string.h>\n\nLIBIMOBILEDEVICE_API file_relay_error_t file_relay_request_sources_timeout(file_relay_client_t client, const char **sources, idevice_connection_t *connection, unsigned int timeout)\n{\n\tif (!client || !client->parent || !sources || !sources[0]) {\n\t\treturn FILE_RELAY_E_INVALID_ARG;\n\t}\n\t*connection = NULL;\n\tfile_relay_error_t err = FILE_RELAY_E_UNKNOWN_ERROR;\n\t/* set up request plist */\n\tplist_t array = plist_new_array();\n\tint i = 0;\n\twhile (sources[i]) {\n\t\tplist_array_append_item(array, plist_new_string(sources[i]));\n\t\ti++;\n\t}\n\tplist_t dict = plist_new_dict();\n\tplist_dict_set_item(dict, \"Sources\", array);\n\n\tif (property_list_service_send_xml_plist(client->parent, dict) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tdebug_info(\"ERROR: Could not send request to device!\");\n\t\terr = FILE_RELAY_E_MUX_ERROR;\n\t\tgoto leave;\n\t}\n\tplist_free(dict);\n\n\tdict = NULL;\n\tif (property_list_service_receive_plist_with_timeout(client->parent, &dict, timeout) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tdebug_info(\"ERROR: Could not receive answer from device!\");\n\t\terr = FILE_RELAY_E_MUX_ERROR;\n\t\tgoto leave;\n\t}\n\n\tif (!dict) {\n\t\tdebug_info(\"ERROR: Did not receive any plist!\");\n\t\terr = FILE_RELAY_E_PLIST_ERROR;\n\t\tgoto leave;\n\t}\n\n\tplist_t error = plist_dict_get_item(dict, \"Error\");\n\tif (error) {\n\t\tchar *errmsg = NULL;\n\t\tplist_get_string_val(error, &errmsg);\n\t\tif (errmsg) {\n\t\t\tif (!strcmp(errmsg, \"InvalidSource\")) {\n\t\t\t\tdebug_info(\"ERROR: One or more given sources are invalid!\");\n\t\t\t\terr = FILE_RELAY_E_INVALID_SOURCE;\n\t\t\t} else if (!strcmp(errmsg, \"StagingEmpty\")) {\n\t\t\t\tdebug_info(\"ERROR: StagingEmpty - No data available!\");\n\t\t\t\terr = FILE_RELAY_E_STAGING_EMPTY;\n\t\t\t} else if (!strcmp(errmsg, \"PermissionDenied\")) {\n\t\t\t\tdebug_info(\"ERROR: Permission denied.\");\n\t\t\t\terr = FILE_RELAY_E_PERMISSION_DENIED;\n\t\t\t} else {\n\t\t\t\tdebug_info(\"ERROR: Unknown error '%s'\", errmsg);\n\t\t\t}\n\t\t\tfree(errmsg);\n\t\t} else {\n\t\t\tdebug_info(\"ERROR: Could not get error message!\");\n\t\t}\n\t\tgoto leave;\n\t}\n\n\tplist_t status = plist_dict_get_item(dict, \"Status\");\n\tif (!status) {\n\t\tdebug_info(\"ERROR: Unexpected plist received!\");\n\t\tdebug_plist(dict);\n\t\terr = FILE_RELAY_E_PLIST_ERROR;\n\t\tgoto leave;\n\t}\n\n\tchar *ack = NULL;\n\tplist_get_string_val(status, &ack);\n\tif (!ack) {\n\t\tdebug_info(\"ERROR: Could not get 'Acknowledged' string!\");\n\t\tgoto leave;\n\t}\n\n\tif (strcmp(ack, \"Acknowledged\")) {\n\t\tdebug_info(\"ERROR: Did not receive 'Acknowledged' but '%s'\", ack);\n\t\tgoto leave;\n\t}\n\tfree(ack);\n\terr = FILE_RELAY_E_SUCCESS;\n\n\t*connection = client->parent->parent->connection;\n\nleave:\n\tif (dict) {\n\t\tplist_free(dict);\n\t}\n\treturn err;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"file_relay.h\"\n#include <stdlib.h>\n#include <string.h>\n\nLIBIMOBILEDEVICE_API file_relay_error_t file_relay_request_sources(file_relay_client_t client, const char **sources, idevice_connection_t *connection)\n{\n\treturn file_relay_request_sources_timeout(client, sources, connection, 60000);\n}"
  },
  {
    "function_name": "file_relay_request_sources_timeout",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/file_relay.c",
    "lines": "65-155",
    "snippet": "LIBIMOBILEDEVICE_API file_relay_error_t file_relay_request_sources_timeout(file_relay_client_t client, const char **sources, idevice_connection_t *connection, unsigned int timeout)\n{\n\tif (!client || !client->parent || !sources || !sources[0]) {\n\t\treturn FILE_RELAY_E_INVALID_ARG;\n\t}\n\t*connection = NULL;\n\tfile_relay_error_t err = FILE_RELAY_E_UNKNOWN_ERROR;\n\t/* set up request plist */\n\tplist_t array = plist_new_array();\n\tint i = 0;\n\twhile (sources[i]) {\n\t\tplist_array_append_item(array, plist_new_string(sources[i]));\n\t\ti++;\n\t}\n\tplist_t dict = plist_new_dict();\n\tplist_dict_set_item(dict, \"Sources\", array);\n\n\tif (property_list_service_send_xml_plist(client->parent, dict) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tdebug_info(\"ERROR: Could not send request to device!\");\n\t\terr = FILE_RELAY_E_MUX_ERROR;\n\t\tgoto leave;\n\t}\n\tplist_free(dict);\n\n\tdict = NULL;\n\tif (property_list_service_receive_plist_with_timeout(client->parent, &dict, timeout) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tdebug_info(\"ERROR: Could not receive answer from device!\");\n\t\terr = FILE_RELAY_E_MUX_ERROR;\n\t\tgoto leave;\n\t}\n\n\tif (!dict) {\n\t\tdebug_info(\"ERROR: Did not receive any plist!\");\n\t\terr = FILE_RELAY_E_PLIST_ERROR;\n\t\tgoto leave;\n\t}\n\n\tplist_t error = plist_dict_get_item(dict, \"Error\");\n\tif (error) {\n\t\tchar *errmsg = NULL;\n\t\tplist_get_string_val(error, &errmsg);\n\t\tif (errmsg) {\n\t\t\tif (!strcmp(errmsg, \"InvalidSource\")) {\n\t\t\t\tdebug_info(\"ERROR: One or more given sources are invalid!\");\n\t\t\t\terr = FILE_RELAY_E_INVALID_SOURCE;\n\t\t\t} else if (!strcmp(errmsg, \"StagingEmpty\")) {\n\t\t\t\tdebug_info(\"ERROR: StagingEmpty - No data available!\");\n\t\t\t\terr = FILE_RELAY_E_STAGING_EMPTY;\n\t\t\t} else if (!strcmp(errmsg, \"PermissionDenied\")) {\n\t\t\t\tdebug_info(\"ERROR: Permission denied.\");\n\t\t\t\terr = FILE_RELAY_E_PERMISSION_DENIED;\n\t\t\t} else {\n\t\t\t\tdebug_info(\"ERROR: Unknown error '%s'\", errmsg);\n\t\t\t}\n\t\t\tfree(errmsg);\n\t\t} else {\n\t\t\tdebug_info(\"ERROR: Could not get error message!\");\n\t\t}\n\t\tgoto leave;\n\t}\n\n\tplist_t status = plist_dict_get_item(dict, \"Status\");\n\tif (!status) {\n\t\tdebug_info(\"ERROR: Unexpected plist received!\");\n\t\tdebug_plist(dict);\n\t\terr = FILE_RELAY_E_PLIST_ERROR;\n\t\tgoto leave;\n\t}\n\n\tchar *ack = NULL;\n\tplist_get_string_val(status, &ack);\n\tif (!ack) {\n\t\tdebug_info(\"ERROR: Could not get 'Acknowledged' string!\");\n\t\tgoto leave;\n\t}\n\n\tif (strcmp(ack, \"Acknowledged\")) {\n\t\tdebug_info(\"ERROR: Did not receive 'Acknowledged' but '%s'\", ack);\n\t\tgoto leave;\n\t}\n\tfree(ack);\n\terr = FILE_RELAY_E_SUCCESS;\n\n\t*connection = client->parent->parent->connection;\n\nleave:\n\tif (dict) {\n\t\tplist_free(dict);\n\t}\n\treturn err;\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"property_list_service.h\"",
      "#include \"file_relay.h\"",
      "#include <stdlib.h>",
      "#include <string.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "dict"
          ],
          "line": 152
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "ack"
          ],
          "line": 145
        },
        "resolved": true,
        "details": {
          "function_name": "file_relay_client_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/file_relay.c",
          "lines": "54-63",
          "snippet": "LIBIMOBILEDEVICE_API file_relay_error_t file_relay_client_free(file_relay_client_t client)\n{\n\tif (!client)\n\t\treturn FILE_RELAY_E_INVALID_ARG;\n\n\tif (property_list_service_client_free(client->parent) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\treturn FILE_RELAY_E_UNKNOWN_ERROR;\n\t}\n\treturn FILE_RELAY_E_SUCCESS;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include \"file_relay.h\"",
            "#include <stdlib.h>",
            "#include <string.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"file_relay.h\"\n#include <stdlib.h>\n#include <string.h>\n\nLIBIMOBILEDEVICE_API file_relay_error_t file_relay_client_free(file_relay_client_t client)\n{\n\tif (!client)\n\t\treturn FILE_RELAY_E_INVALID_ARG;\n\n\tif (property_list_service_client_free(client->parent) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\treturn FILE_RELAY_E_UNKNOWN_ERROR;\n\t}\n\treturn FILE_RELAY_E_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"ERROR: Did not receive 'Acknowledged' but '%s'\"",
            "ack"
          ],
          "line": 142
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "ack",
            "\"Acknowledged\""
          ],
          "line": 141
        },
        "resolved": true,
        "details": {
          "function_name": "plist_strcmp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/tools/idevicebackup.c",
          "lines": "296-309",
          "snippet": "static int plist_strcmp(plist_t node, const char *str)\n{\n\tchar *buffer = NULL;\n\tint ret = 0;\n\n\tif (plist_get_node_type(node) != PLIST_STRING)\n\t\treturn ret;\n\n\tplist_get_string_val(node, &buffer);\n\tret = strcmp(buffer, str);\n\tfree(buffer);\n\n\treturn ret;\n}",
          "includes": [
            "#include <windows.h>",
            "#include \"common/utils.h\"",
            "#include <libimobiledevice/afc.h>",
            "#include <libimobiledevice/notification_proxy.h>",
            "#include <libimobiledevice/mobilebackup.h>",
            "#include <libimobiledevice/lockdown.h>",
            "#include <libimobiledevice/libimobiledevice.h>",
            "#include <time.h>",
            "#include <ctype.h>",
            "#include <unistd.h>",
            "#include <gcrypt.h>",
            "#include <openssl/sha.h>",
            "#include <signal.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <windows.h>\n#include \"common/utils.h\"\n#include <libimobiledevice/afc.h>\n#include <libimobiledevice/notification_proxy.h>\n#include <libimobiledevice/mobilebackup.h>\n#include <libimobiledevice/lockdown.h>\n#include <libimobiledevice/libimobiledevice.h>\n#include <time.h>\n#include <ctype.h>\n#include <unistd.h>\n#include <gcrypt.h>\n#include <openssl/sha.h>\n#include <signal.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <string.h>\n#include <stdio.h>\n#include <config.h>\n\nstatic int plist_strcmp(plist_t node, const char *str)\n{\n\tchar *buffer = NULL;\n\tint ret = 0;\n\n\tif (plist_get_node_type(node) != PLIST_STRING)\n\t\treturn ret;\n\n\tplist_get_string_val(node, &buffer);\n\tret = strcmp(buffer, str);\n\tfree(buffer);\n\n\treturn ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"ERROR: Could not get 'Acknowledged' string!\""
          ],
          "line": 137
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_get_string_val",
          "args": [
            "status",
            "&ack"
          ],
          "line": 135
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_plist",
          "args": [
            "dict"
          ],
          "line": 129
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"ERROR: Unexpected plist received!\""
          ],
          "line": 128
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_get_item",
          "args": [
            "dict",
            "\"Status\""
          ],
          "line": 126
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"ERROR: Could not get error message!\""
          ],
          "line": 121
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"ERROR: Unknown error '%s'\"",
            "errmsg"
          ],
          "line": 117
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"ERROR: Permission denied.\""
          ],
          "line": 114
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"ERROR: StagingEmpty - No data available!\""
          ],
          "line": 111
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"ERROR: One or more given sources are invalid!\""
          ],
          "line": 108
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_get_string_val",
          "args": [
            "error",
            "&errmsg"
          ],
          "line": 105
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_dict_get_item",
          "args": [
            "dict",
            "\"Error\""
          ],
          "line": 102
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"ERROR: Did not receive any plist!\""
          ],
          "line": 97
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"ERROR: Could not receive answer from device!\""
          ],
          "line": 91
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "property_list_service_receive_plist_with_timeout",
          "args": [
            "client->parent",
            "&dict",
            "timeout"
          ],
          "line": 90
        },
        "resolved": true,
        "details": {
          "function_name": "property_list_service_receive_plist_with_timeout",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
          "lines": "253-256",
          "snippet": "LIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_receive_plist_with_timeout(property_list_service_client_t client, plist_t *plist, unsigned int timeout)\n{\n\treturn internal_plist_receive_timeout(client, plist, timeout);\n}",
          "includes": [
            "#include \"endianness.h\"",
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_receive_plist_with_timeout(property_list_service_client_t client, plist_t *plist, unsigned int timeout)\n{\n\treturn internal_plist_receive_timeout(client, plist, timeout);\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_free",
          "args": [
            "dict"
          ],
          "line": 87
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "debug_info",
          "args": [
            "\"ERROR: Could not send request to device!\""
          ],
          "line": 83
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "property_list_service_send_xml_plist",
          "args": [
            "client->parent",
            "dict"
          ],
          "line": 82
        },
        "resolved": true,
        "details": {
          "function_name": "property_list_service_send_xml_plist",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
          "lines": "150-153",
          "snippet": "LIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_send_xml_plist(property_list_service_client_t client, plist_t plist)\n{\n\treturn internal_plist_send(client, plist, 0);\n}",
          "includes": [
            "#include \"endianness.h\"",
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_send_xml_plist(property_list_service_client_t client, plist_t plist)\n{\n\treturn internal_plist_send(client, plist, 0);\n}"
        }
      },
      {
        "call_info": {
          "callee": "plist_dict_set_item",
          "args": [
            "dict",
            "\"Sources\"",
            "array"
          ],
          "line": 80
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_dict",
          "args": [],
          "line": 79
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_array_append_item",
          "args": [
            "array",
            "plist_new_string(sources[i])"
          ],
          "line": 76
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_string",
          "args": [
            "sources[i]"
          ],
          "line": 76
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plist_new_array",
          "args": [],
          "line": 73
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"file_relay.h\"\n#include <stdlib.h>\n#include <string.h>\n\nLIBIMOBILEDEVICE_API file_relay_error_t file_relay_request_sources_timeout(file_relay_client_t client, const char **sources, idevice_connection_t *connection, unsigned int timeout)\n{\n\tif (!client || !client->parent || !sources || !sources[0]) {\n\t\treturn FILE_RELAY_E_INVALID_ARG;\n\t}\n\t*connection = NULL;\n\tfile_relay_error_t err = FILE_RELAY_E_UNKNOWN_ERROR;\n\t/* set up request plist */\n\tplist_t array = plist_new_array();\n\tint i = 0;\n\twhile (sources[i]) {\n\t\tplist_array_append_item(array, plist_new_string(sources[i]));\n\t\ti++;\n\t}\n\tplist_t dict = plist_new_dict();\n\tplist_dict_set_item(dict, \"Sources\", array);\n\n\tif (property_list_service_send_xml_plist(client->parent, dict) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tdebug_info(\"ERROR: Could not send request to device!\");\n\t\terr = FILE_RELAY_E_MUX_ERROR;\n\t\tgoto leave;\n\t}\n\tplist_free(dict);\n\n\tdict = NULL;\n\tif (property_list_service_receive_plist_with_timeout(client->parent, &dict, timeout) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\tdebug_info(\"ERROR: Could not receive answer from device!\");\n\t\terr = FILE_RELAY_E_MUX_ERROR;\n\t\tgoto leave;\n\t}\n\n\tif (!dict) {\n\t\tdebug_info(\"ERROR: Did not receive any plist!\");\n\t\terr = FILE_RELAY_E_PLIST_ERROR;\n\t\tgoto leave;\n\t}\n\n\tplist_t error = plist_dict_get_item(dict, \"Error\");\n\tif (error) {\n\t\tchar *errmsg = NULL;\n\t\tplist_get_string_val(error, &errmsg);\n\t\tif (errmsg) {\n\t\t\tif (!strcmp(errmsg, \"InvalidSource\")) {\n\t\t\t\tdebug_info(\"ERROR: One or more given sources are invalid!\");\n\t\t\t\terr = FILE_RELAY_E_INVALID_SOURCE;\n\t\t\t} else if (!strcmp(errmsg, \"StagingEmpty\")) {\n\t\t\t\tdebug_info(\"ERROR: StagingEmpty - No data available!\");\n\t\t\t\terr = FILE_RELAY_E_STAGING_EMPTY;\n\t\t\t} else if (!strcmp(errmsg, \"PermissionDenied\")) {\n\t\t\t\tdebug_info(\"ERROR: Permission denied.\");\n\t\t\t\terr = FILE_RELAY_E_PERMISSION_DENIED;\n\t\t\t} else {\n\t\t\t\tdebug_info(\"ERROR: Unknown error '%s'\", errmsg);\n\t\t\t}\n\t\t\tfree(errmsg);\n\t\t} else {\n\t\t\tdebug_info(\"ERROR: Could not get error message!\");\n\t\t}\n\t\tgoto leave;\n\t}\n\n\tplist_t status = plist_dict_get_item(dict, \"Status\");\n\tif (!status) {\n\t\tdebug_info(\"ERROR: Unexpected plist received!\");\n\t\tdebug_plist(dict);\n\t\terr = FILE_RELAY_E_PLIST_ERROR;\n\t\tgoto leave;\n\t}\n\n\tchar *ack = NULL;\n\tplist_get_string_val(status, &ack);\n\tif (!ack) {\n\t\tdebug_info(\"ERROR: Could not get 'Acknowledged' string!\");\n\t\tgoto leave;\n\t}\n\n\tif (strcmp(ack, \"Acknowledged\")) {\n\t\tdebug_info(\"ERROR: Did not receive 'Acknowledged' but '%s'\", ack);\n\t\tgoto leave;\n\t}\n\tfree(ack);\n\terr = FILE_RELAY_E_SUCCESS;\n\n\t*connection = client->parent->parent->connection;\n\nleave:\n\tif (dict) {\n\t\tplist_free(dict);\n\t}\n\treturn err;\n}"
  },
  {
    "function_name": "file_relay_client_free",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/file_relay.c",
    "lines": "54-63",
    "snippet": "LIBIMOBILEDEVICE_API file_relay_error_t file_relay_client_free(file_relay_client_t client)\n{\n\tif (!client)\n\t\treturn FILE_RELAY_E_INVALID_ARG;\n\n\tif (property_list_service_client_free(client->parent) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\treturn FILE_RELAY_E_UNKNOWN_ERROR;\n\t}\n\treturn FILE_RELAY_E_SUCCESS;\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"property_list_service.h\"",
      "#include \"file_relay.h\"",
      "#include <stdlib.h>",
      "#include <string.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "property_list_service_client_free",
          "args": [
            "client->parent"
          ],
          "line": 59
        },
        "resolved": true,
        "details": {
          "function_name": "property_list_service_client_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
          "lines": "77-88",
          "snippet": "LIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_client_free(property_list_service_client_t client)\n{\n\tif (!client)\n\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\n\tproperty_list_service_error_t err = service_to_property_list_service_error(service_client_free(client->parent));\n\n\tfree(client);\n\tclient = NULL;\n\n\treturn err;\n}",
          "includes": [
            "#include \"endianness.h\"",
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_client_free(property_list_service_client_t client)\n{\n\tif (!client)\n\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\n\tproperty_list_service_error_t err = service_to_property_list_service_error(service_client_free(client->parent));\n\n\tfree(client);\n\tclient = NULL;\n\n\treturn err;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"file_relay.h\"\n#include <stdlib.h>\n#include <string.h>\n\nLIBIMOBILEDEVICE_API file_relay_error_t file_relay_client_free(file_relay_client_t client)\n{\n\tif (!client)\n\t\treturn FILE_RELAY_E_INVALID_ARG;\n\n\tif (property_list_service_client_free(client->parent) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\treturn FILE_RELAY_E_UNKNOWN_ERROR;\n\t}\n\treturn FILE_RELAY_E_SUCCESS;\n}"
  },
  {
    "function_name": "file_relay_client_start_service",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/file_relay.c",
    "lines": "47-52",
    "snippet": "LIBIMOBILEDEVICE_API file_relay_error_t file_relay_client_start_service(idevice_t device, file_relay_client_t * client, const char* label)\n{\n\tfile_relay_error_t err = FILE_RELAY_E_UNKNOWN_ERROR;\n\tservice_client_factory_start_service(device, FILE_RELAY_SERVICE_NAME, (void**)client, label, SERVICE_CONSTRUCTOR(file_relay_client_new), &err);\n\treturn err;\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"property_list_service.h\"",
      "#include \"file_relay.h\"",
      "#include <stdlib.h>",
      "#include <string.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "service_client_factory_start_service",
          "args": [
            "device",
            "FILE_RELAY_SERVICE_NAME",
            "(void**)client",
            "label",
            "SERVICE_CONSTRUCTOR(file_relay_client_new)",
            "&err"
          ],
          "line": 50
        },
        "resolved": true,
        "details": {
          "function_name": "service_client_factory_start_service",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/service.c",
          "lines": "79-116",
          "snippet": "LIBIMOBILEDEVICE_API service_error_t service_client_factory_start_service(idevice_t device, const char* service_name, void **client, const char* label, int32_t (*constructor_func)(idevice_t, lockdownd_service_descriptor_t, void**), int32_t *error_code)\n{\n\t*client = NULL;\n\n\tlockdownd_client_t lckd = NULL;\n\tif (LOCKDOWN_E_SUCCESS != lockdownd_client_new_with_handshake(device, &lckd, label)) {\n\t\tdebug_info(\"Could not create a lockdown client.\");\n\t\treturn SERVICE_E_START_SERVICE_ERROR;\n\t}\n\n\tlockdownd_service_descriptor_t service = NULL;\n\tlockdownd_start_service(lckd, service_name, &service);\n\tlockdownd_client_free(lckd);\n\n\tif (!service || service->port == 0) {\n\t\tdebug_info(\"Could not start service %s!\", service_name);\n\t\treturn SERVICE_E_START_SERVICE_ERROR;\n\t}\n\n\tint32_t ec;\n\tif (constructor_func) {\n\t\tec = (int32_t)constructor_func(device, service, client);\n\t} else {\n\t\tec = service_client_new(device, service, (service_client_t*)client);\n\t}\n\tif (error_code) {\n\t\t*error_code = ec;\n\t}\n\n\tif (ec != SERVICE_E_SUCCESS) {\n\t\tdebug_info(\"Could not connect to service %s! Port: %i, error: %i\", service_name, service->port, ec);\n\t}\n\n\tlockdownd_service_descriptor_free(service);\n\tservice = NULL;\n\n\treturn (ec == SERVICE_E_SUCCESS) ? SERVICE_E_SUCCESS : SERVICE_E_START_SERVICE_ERROR;\n}",
          "includes": [
            "#include \"common/debug.h\"",
            "#include \"idevice.h\"",
            "#include \"service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"common/debug.h\"\n#include \"idevice.h\"\n#include \"service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API service_error_t service_client_factory_start_service(idevice_t device, const char* service_name, void **client, const char* label, int32_t (*constructor_func)(idevice_t, lockdownd_service_descriptor_t, void**), int32_t *error_code)\n{\n\t*client = NULL;\n\n\tlockdownd_client_t lckd = NULL;\n\tif (LOCKDOWN_E_SUCCESS != lockdownd_client_new_with_handshake(device, &lckd, label)) {\n\t\tdebug_info(\"Could not create a lockdown client.\");\n\t\treturn SERVICE_E_START_SERVICE_ERROR;\n\t}\n\n\tlockdownd_service_descriptor_t service = NULL;\n\tlockdownd_start_service(lckd, service_name, &service);\n\tlockdownd_client_free(lckd);\n\n\tif (!service || service->port == 0) {\n\t\tdebug_info(\"Could not start service %s!\", service_name);\n\t\treturn SERVICE_E_START_SERVICE_ERROR;\n\t}\n\n\tint32_t ec;\n\tif (constructor_func) {\n\t\tec = (int32_t)constructor_func(device, service, client);\n\t} else {\n\t\tec = service_client_new(device, service, (service_client_t*)client);\n\t}\n\tif (error_code) {\n\t\t*error_code = ec;\n\t}\n\n\tif (ec != SERVICE_E_SUCCESS) {\n\t\tdebug_info(\"Could not connect to service %s! Port: %i, error: %i\", service_name, service->port, ec);\n\t}\n\n\tlockdownd_service_descriptor_free(service);\n\tservice = NULL;\n\n\treturn (ec == SERVICE_E_SUCCESS) ? SERVICE_E_SUCCESS : SERVICE_E_START_SERVICE_ERROR;\n}"
        }
      },
      {
        "call_info": {
          "callee": "SERVICE_CONSTRUCTOR",
          "args": [
            "file_relay_client_new"
          ],
          "line": 50
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"file_relay.h\"\n#include <stdlib.h>\n#include <string.h>\n\nLIBIMOBILEDEVICE_API file_relay_error_t file_relay_client_start_service(idevice_t device, file_relay_client_t * client, const char* label)\n{\n\tfile_relay_error_t err = FILE_RELAY_E_UNKNOWN_ERROR;\n\tservice_client_factory_start_service(device, FILE_RELAY_SERVICE_NAME, (void**)client, label, SERVICE_CONSTRUCTOR(file_relay_client_new), &err);\n\treturn err;\n}"
  },
  {
    "function_name": "file_relay_client_new",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/file_relay.c",
    "lines": "27-45",
    "snippet": "LIBIMOBILEDEVICE_API file_relay_error_t file_relay_client_new(idevice_t device, lockdownd_service_descriptor_t service, file_relay_client_t *client)\n{\n\tif (!device || !service || service->port == 0 || !client || *client) {\n\t\treturn FILE_RELAY_E_INVALID_ARG;\n\t}\n\n\tproperty_list_service_client_t plistclient = NULL;\n\tif (property_list_service_client_new(device, service, &plistclient) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\treturn FILE_RELAY_E_MUX_ERROR;\n\t}\n\n\t/* create client object */\n\tfile_relay_client_t client_loc = (file_relay_client_t) malloc(sizeof(struct file_relay_client_private));\n\tclient_loc->parent = plistclient;\n\n\t/* all done, return success */\n\t*client = client_loc;\n\treturn FILE_RELAY_E_SUCCESS;\n}",
    "includes": [
      "#include \"common/debug.h\"",
      "#include \"property_list_service.h\"",
      "#include \"file_relay.h\"",
      "#include <stdlib.h>",
      "#include <string.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "malloc",
          "args": [
            "sizeof(struct file_relay_client_private)"
          ],
          "line": 39
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "property_list_service_client_new",
          "args": [
            "device",
            "service",
            "&plistclient"
          ],
          "line": 34
        },
        "resolved": true,
        "details": {
          "function_name": "property_list_service_client_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-5104/repo/src/property_list_service.c",
          "lines": "57-75",
          "snippet": "LIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_client_new(idevice_t device, lockdownd_service_descriptor_t service, property_list_service_client_t *client)\n{\n\tif (!device || !service || service->port == 0 || !client || *client)\n\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\n\tservice_client_t parent = NULL;\n\tservice_error_t rerr = service_client_new(device, service, &parent);\n\tif (rerr != SERVICE_E_SUCCESS) {\n\t\treturn service_to_property_list_service_error(rerr);\n\t}\n\n\t/* create client object */\n\tproperty_list_service_client_t client_loc = (property_list_service_client_t)malloc(sizeof(struct property_list_service_client_private));\n\tclient_loc->parent = parent;\n\n\t/* all done, return success */\n\t*client = client_loc;\n\treturn PROPERTY_LIST_SERVICE_E_SUCCESS;\n}",
          "includes": [
            "#include \"endianness.h\"",
            "#include \"common/debug.h\"",
            "#include \"property_list_service.h\"",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"endianness.h\"\n#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nLIBIMOBILEDEVICE_API property_list_service_error_t property_list_service_client_new(idevice_t device, lockdownd_service_descriptor_t service, property_list_service_client_t *client)\n{\n\tif (!device || !service || service->port == 0 || !client || *client)\n\t\treturn PROPERTY_LIST_SERVICE_E_INVALID_ARG;\n\n\tservice_client_t parent = NULL;\n\tservice_error_t rerr = service_client_new(device, service, &parent);\n\tif (rerr != SERVICE_E_SUCCESS) {\n\t\treturn service_to_property_list_service_error(rerr);\n\t}\n\n\t/* create client object */\n\tproperty_list_service_client_t client_loc = (property_list_service_client_t)malloc(sizeof(struct property_list_service_client_private));\n\tclient_loc->parent = parent;\n\n\t/* all done, return success */\n\t*client = client_loc;\n\treturn PROPERTY_LIST_SERVICE_E_SUCCESS;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"common/debug.h\"\n#include \"property_list_service.h\"\n#include \"file_relay.h\"\n#include <stdlib.h>\n#include <string.h>\n\nLIBIMOBILEDEVICE_API file_relay_error_t file_relay_client_new(idevice_t device, lockdownd_service_descriptor_t service, file_relay_client_t *client)\n{\n\tif (!device || !service || service->port == 0 || !client || *client) {\n\t\treturn FILE_RELAY_E_INVALID_ARG;\n\t}\n\n\tproperty_list_service_client_t plistclient = NULL;\n\tif (property_list_service_client_new(device, service, &plistclient) != PROPERTY_LIST_SERVICE_E_SUCCESS) {\n\t\treturn FILE_RELAY_E_MUX_ERROR;\n\t}\n\n\t/* create client object */\n\tfile_relay_client_t client_loc = (file_relay_client_t) malloc(sizeof(struct file_relay_client_private));\n\tclient_loc->parent = plistclient;\n\n\t/* all done, return success */\n\t*client = client_loc;\n\treturn FILE_RELAY_E_SUCCESS;\n}"
  }
]