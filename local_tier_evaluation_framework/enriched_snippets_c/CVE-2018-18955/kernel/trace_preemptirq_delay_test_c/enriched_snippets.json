[
  {
    "function_name": "preemptirq_delay_exit",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18955/repo/kernel/trace/preemptirq_delay_test.c",
    "lines": "65-68",
    "snippet": "static void __exit preemptirq_delay_exit(void)\n{\n\treturn;\n}",
    "includes": [
      "#include <linux/string.h>",
      "#include <linux/printk.h>",
      "#include <linux/module.h>",
      "#include <linux/kthread.h>",
      "#include <linux/kernel.h>",
      "#include <linux/irq.h>",
      "#include <linux/interrupt.h>",
      "#include <linux/delay.h>",
      "#include <linux/trace_clock.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include <linux/string.h>\n#include <linux/printk.h>\n#include <linux/module.h>\n#include <linux/kthread.h>\n#include <linux/kernel.h>\n#include <linux/irq.h>\n#include <linux/interrupt.h>\n#include <linux/delay.h>\n#include <linux/trace_clock.h>\n\nstatic void __exit preemptirq_delay_exit(void)\n{\n\treturn;\n}"
  },
  {
    "function_name": "preemptirq_delay_init",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18955/repo/kernel/trace/preemptirq_delay_test.c",
    "lines": "54-63",
    "snippet": "static int __init preemptirq_delay_init(void)\n{\n\tchar task_name[50];\n\tstruct task_struct *test_task;\n\n\tsnprintf(task_name, sizeof(task_name), \"%s_test\", test_mode);\n\n\ttest_task = kthread_run(preemptirq_delay_run, NULL, task_name);\n\treturn PTR_ERR_OR_ZERO(test_task);\n}",
    "includes": [
      "#include <linux/string.h>",
      "#include <linux/printk.h>",
      "#include <linux/module.h>",
      "#include <linux/kthread.h>",
      "#include <linux/kernel.h>",
      "#include <linux/irq.h>",
      "#include <linux/interrupt.h>",
      "#include <linux/delay.h>",
      "#include <linux/trace_clock.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static char test_mode[10] = \"irq\";"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "PTR_ERR_OR_ZERO",
          "args": [
            "test_task"
          ],
          "line": 62
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kthread_run",
          "args": [
            "preemptirq_delay_run",
            "NULL",
            "task_name"
          ],
          "line": 61
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "task_name",
            "sizeof(task_name)",
            "\"%s_test\"",
            "test_mode"
          ],
          "line": 59
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/string.h>\n#include <linux/printk.h>\n#include <linux/module.h>\n#include <linux/kthread.h>\n#include <linux/kernel.h>\n#include <linux/irq.h>\n#include <linux/interrupt.h>\n#include <linux/delay.h>\n#include <linux/trace_clock.h>\n\nstatic char test_mode[10] = \"irq\";\n\nstatic int __init preemptirq_delay_init(void)\n{\n\tchar task_name[50];\n\tstruct task_struct *test_task;\n\n\tsnprintf(task_name, sizeof(task_name), \"%s_test\", test_mode);\n\n\ttest_task = kthread_run(preemptirq_delay_run, NULL, task_name);\n\treturn PTR_ERR_OR_ZERO(test_task);\n}"
  },
  {
    "function_name": "preemptirq_delay_run",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18955/repo/kernel/trace/preemptirq_delay_test.c",
    "lines": "37-52",
    "snippet": "static int preemptirq_delay_run(void *data)\n{\n\tunsigned long flags;\n\n\tif (!strcmp(test_mode, \"irq\")) {\n\t\tlocal_irq_save(flags);\n\t\tbusy_wait(delay);\n\t\tlocal_irq_restore(flags);\n\t} else if (!strcmp(test_mode, \"preempt\")) {\n\t\tpreempt_disable();\n\t\tbusy_wait(delay);\n\t\tpreempt_enable();\n\t}\n\n\treturn 0;\n}",
    "includes": [
      "#include <linux/string.h>",
      "#include <linux/printk.h>",
      "#include <linux/module.h>",
      "#include <linux/kthread.h>",
      "#include <linux/kernel.h>",
      "#include <linux/irq.h>",
      "#include <linux/interrupt.h>",
      "#include <linux/delay.h>",
      "#include <linux/trace_clock.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static ulong delay = 100;",
      "static char test_mode[10] = \"irq\";"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "preempt_enable",
          "args": [],
          "line": 48
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "busy_wait",
          "args": [
            "delay"
          ],
          "line": 47
        },
        "resolved": true,
        "details": {
          "function_name": "busy_wait",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18955/repo/kernel/trace/preemptirq_delay_test.c",
          "lines": "26-35",
          "snippet": "static void busy_wait(ulong time)\n{\n\tu64 start, end;\n\tstart = trace_clock_local();\n\tdo {\n\t\tend = trace_clock_local();\n\t\tif (kthread_should_stop())\n\t\t\tbreak;\n\t} while ((end - start) < (time * 1000));\n}",
          "includes": [
            "#include <linux/string.h>",
            "#include <linux/printk.h>",
            "#include <linux/module.h>",
            "#include <linux/kthread.h>",
            "#include <linux/kernel.h>",
            "#include <linux/irq.h>",
            "#include <linux/interrupt.h>",
            "#include <linux/delay.h>",
            "#include <linux/trace_clock.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/string.h>\n#include <linux/printk.h>\n#include <linux/module.h>\n#include <linux/kthread.h>\n#include <linux/kernel.h>\n#include <linux/irq.h>\n#include <linux/interrupt.h>\n#include <linux/delay.h>\n#include <linux/trace_clock.h>\n\nstatic void busy_wait(ulong time)\n{\n\tu64 start, end;\n\tstart = trace_clock_local();\n\tdo {\n\t\tend = trace_clock_local();\n\t\tif (kthread_should_stop())\n\t\t\tbreak;\n\t} while ((end - start) < (time * 1000));\n}"
        }
      },
      {
        "call_info": {
          "callee": "preempt_disable",
          "args": [],
          "line": 46
        },
        "resolved": true,
        "details": {
          "function_name": "schedule_preempt_disabled",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18955/repo/kernel/sched/core.c",
          "lines": "3571-3576",
          "snippet": "void __sched schedule_preempt_disabled(void)\n{\n\tsched_preempt_enable_no_resched();\n\tschedule();\n\tpreempt_disable();\n}",
          "includes": [
            "#include \"features.h\"",
            "#include <trace/events/sched.h>",
            "#include \"pelt.h\"",
            "#include \"../smpboot.h\"",
            "#include \"../workqueue_internal.h\"",
            "#include <asm/tlb.h>",
            "#include <asm/switch_to.h>",
            "#include <linux/kcov.h>",
            "#include <linux/nospec.h>",
            "#include \"sched.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void __sched",
            "static void __sched"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"features.h\"\n#include <trace/events/sched.h>\n#include \"pelt.h\"\n#include \"../smpboot.h\"\n#include \"../workqueue_internal.h\"\n#include <asm/tlb.h>\n#include <asm/switch_to.h>\n#include <linux/kcov.h>\n#include <linux/nospec.h>\n#include \"sched.h\"\n\nstatic void __sched;\nstatic void __sched;\n\nvoid __sched schedule_preempt_disabled(void)\n{\n\tsched_preempt_enable_no_resched();\n\tschedule();\n\tpreempt_disable();\n}"
        }
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "test_mode",
            "\"preempt\""
          ],
          "line": 45
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "local_irq_restore",
          "args": [
            "flags"
          ],
          "line": 44
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "local_irq_save",
          "args": [
            "flags"
          ],
          "line": 42
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "test_mode",
            "\"irq\""
          ],
          "line": 41
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/string.h>\n#include <linux/printk.h>\n#include <linux/module.h>\n#include <linux/kthread.h>\n#include <linux/kernel.h>\n#include <linux/irq.h>\n#include <linux/interrupt.h>\n#include <linux/delay.h>\n#include <linux/trace_clock.h>\n\nstatic ulong delay = 100;\nstatic char test_mode[10] = \"irq\";\n\nstatic int preemptirq_delay_run(void *data)\n{\n\tunsigned long flags;\n\n\tif (!strcmp(test_mode, \"irq\")) {\n\t\tlocal_irq_save(flags);\n\t\tbusy_wait(delay);\n\t\tlocal_irq_restore(flags);\n\t} else if (!strcmp(test_mode, \"preempt\")) {\n\t\tpreempt_disable();\n\t\tbusy_wait(delay);\n\t\tpreempt_enable();\n\t}\n\n\treturn 0;\n}"
  },
  {
    "function_name": "busy_wait",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18955/repo/kernel/trace/preemptirq_delay_test.c",
    "lines": "26-35",
    "snippet": "static void busy_wait(ulong time)\n{\n\tu64 start, end;\n\tstart = trace_clock_local();\n\tdo {\n\t\tend = trace_clock_local();\n\t\tif (kthread_should_stop())\n\t\t\tbreak;\n\t} while ((end - start) < (time * 1000));\n}",
    "includes": [
      "#include <linux/string.h>",
      "#include <linux/printk.h>",
      "#include <linux/module.h>",
      "#include <linux/kthread.h>",
      "#include <linux/kernel.h>",
      "#include <linux/irq.h>",
      "#include <linux/interrupt.h>",
      "#include <linux/delay.h>",
      "#include <linux/trace_clock.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "kthread_should_stop",
          "args": [],
          "line": 32
        },
        "resolved": true,
        "details": {
          "function_name": "kthread_should_stop",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18955/repo/kernel/kthread.c",
          "lines": "98-101",
          "snippet": "bool kthread_should_stop(void)\n{\n\treturn test_bit(KTHREAD_SHOULD_STOP, &to_kthread(current)->flags);\n}",
          "includes": [
            "#include <trace/events/sched.h>",
            "#include <linux/uaccess.h>",
            "#include <linux/ptrace.h>",
            "#include <linux/freezer.h>",
            "#include <linux/slab.h>",
            "#include <linux/mutex.h>",
            "#include <linux/export.h>",
            "#include <linux/file.h>",
            "#include <linux/unistd.h>",
            "#include <linux/cpuset.h>",
            "#include <linux/err.h>",
            "#include <linux/completion.h>",
            "#include <linux/kthread.h>",
            "#include <linux/sched/task.h>",
            "#include <linux/sched.h>",
            "#include <uapi/linux/sched/types.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <trace/events/sched.h>\n#include <linux/uaccess.h>\n#include <linux/ptrace.h>\n#include <linux/freezer.h>\n#include <linux/slab.h>\n#include <linux/mutex.h>\n#include <linux/export.h>\n#include <linux/file.h>\n#include <linux/unistd.h>\n#include <linux/cpuset.h>\n#include <linux/err.h>\n#include <linux/completion.h>\n#include <linux/kthread.h>\n#include <linux/sched/task.h>\n#include <linux/sched.h>\n#include <uapi/linux/sched/types.h>\n\nbool kthread_should_stop(void)\n{\n\treturn test_bit(KTHREAD_SHOULD_STOP, &to_kthread(current)->flags);\n}"
        }
      },
      {
        "call_info": {
          "callee": "trace_clock_local",
          "args": [],
          "line": 31
        },
        "resolved": true,
        "details": {
          "function_name": "trace_clock_local",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18955/repo/kernel/trace/trace_clock.c",
          "lines": "32-46",
          "snippet": "u64 notrace trace_clock_local(void)\n{\n\tu64 clock;\n\n\t/*\n\t * sched_clock() is an architecture implemented, fast, scalable,\n\t * lockless clock. It is not guaranteed to be coherent across\n\t * CPUs, nor across CPU idle events.\n\t */\n\tpreempt_disable_notrace();\n\tclock = sched_clock();\n\tpreempt_enable_notrace();\n\n\treturn clock;\n}",
          "includes": [
            "#include <linux/trace_clock.h>",
            "#include <linux/ktime.h>",
            "#include <linux/sched/clock.h>",
            "#include <linux/sched.h>",
            "#include <linux/percpu.h>",
            "#include <linux/module.h>",
            "#include <linux/hardirq.h>",
            "#include <linux/irqflags.h>",
            "#include <linux/spinlock.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/trace_clock.h>\n#include <linux/ktime.h>\n#include <linux/sched/clock.h>\n#include <linux/sched.h>\n#include <linux/percpu.h>\n#include <linux/module.h>\n#include <linux/hardirq.h>\n#include <linux/irqflags.h>\n#include <linux/spinlock.h>\n\nu64 notrace trace_clock_local(void)\n{\n\tu64 clock;\n\n\t/*\n\t * sched_clock() is an architecture implemented, fast, scalable,\n\t * lockless clock. It is not guaranteed to be coherent across\n\t * CPUs, nor across CPU idle events.\n\t */\n\tpreempt_disable_notrace();\n\tclock = sched_clock();\n\tpreempt_enable_notrace();\n\n\treturn clock;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/string.h>\n#include <linux/printk.h>\n#include <linux/module.h>\n#include <linux/kthread.h>\n#include <linux/kernel.h>\n#include <linux/irq.h>\n#include <linux/interrupt.h>\n#include <linux/delay.h>\n#include <linux/trace_clock.h>\n\nstatic void busy_wait(ulong time)\n{\n\tu64 start, end;\n\tstart = trace_clock_local();\n\tdo {\n\t\tend = trace_clock_local();\n\t\tif (kthread_should_stop())\n\t\t\tbreak;\n\t} while ((end - start) < (time * 1000));\n}"
  }
]