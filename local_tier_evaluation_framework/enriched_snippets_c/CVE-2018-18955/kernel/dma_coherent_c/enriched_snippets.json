[
  {
    "function_name": "dma_init_reserved_memory",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18955/repo/kernel/dma/coherent.c",
    "lines": "407-429",
    "snippet": "static int __init dma_init_reserved_memory(void)\n{\n\tconst struct reserved_mem_ops *ops;\n\tint ret;\n\n\tif (!dma_reserved_default_memory)\n\t\treturn -ENOMEM;\n\n\tops = dma_reserved_default_memory->ops;\n\n\t/*\n\t * We rely on rmem_dma_device_init() does not propagate error of\n\t * dma_assign_coherent_memory() for \"NULL\" device.\n\t */\n\tret = ops->device_init(dma_reserved_default_memory, NULL);\n\n\tif (!ret) {\n\t\tdma_coherent_default_memory = dma_reserved_default_memory->priv;\n\t\tpr_info(\"DMA: default coherent area is set\\n\");\n\t}\n\n\treturn ret;\n}",
    "includes": [
      "#include <linux/of_reserved_mem.h>",
      "#include <linux/of_fdt.h>",
      "#include <linux/of.h>",
      "#include <linux/dma-mapping.h>",
      "#include <linux/module.h>",
      "#include <linux/kernel.h>",
      "#include <linux/slab.h>",
      "#include <linux/io.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static struct dma_coherent_mem *dma_coherent_default_memory"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "pr_info",
          "args": [
            "\"DMA: default coherent area is set\\n\""
          ],
          "line": 425
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ops->device_init",
          "args": [
            "dma_reserved_default_memory",
            "NULL"
          ],
          "line": 421
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-mapping.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nstatic struct dma_coherent_mem *dma_coherent_default_memory;\n\nstatic int __init dma_init_reserved_memory(void)\n{\n\tconst struct reserved_mem_ops *ops;\n\tint ret;\n\n\tif (!dma_reserved_default_memory)\n\t\treturn -ENOMEM;\n\n\tops = dma_reserved_default_memory->ops;\n\n\t/*\n\t * We rely on rmem_dma_device_init() does not propagate error of\n\t * dma_assign_coherent_memory() for \"NULL\" device.\n\t */\n\tret = ops->device_init(dma_reserved_default_memory, NULL);\n\n\tif (!ret) {\n\t\tdma_coherent_default_memory = dma_reserved_default_memory->priv;\n\t\tpr_info(\"DMA: default coherent area is set\\n\");\n\t}\n\n\treturn ret;\n}"
  },
  {
    "function_name": "rmem_dma_setup",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18955/repo/kernel/dma/coherent.c",
    "lines": "381-405",
    "snippet": "static int __init rmem_dma_setup(struct reserved_mem *rmem)\n{\n\tunsigned long node = rmem->fdt_node;\n\n\tif (of_get_flat_dt_prop(node, \"reusable\", NULL))\n\t\treturn -EINVAL;\n\n#ifdef CONFIG_ARM\n\tif (!of_get_flat_dt_prop(node, \"no-map\", NULL)) {\n\t\tpr_err(\"Reserved memory: regions without no-map are not yet supported\\n\");\n\t\treturn -EINVAL;\n\t}\n\n\tif (of_get_flat_dt_prop(node, \"linux,dma-default\", NULL)) {\n\t\tWARN(dma_reserved_default_memory,\n\t\t     \"Reserved memory: region for default DMA coherent area is redefined\\n\");\n\t\tdma_reserved_default_memory = rmem;\n\t}\n#endif\n\n\trmem->ops = &rmem_dma_ops;\n\tpr_info(\"Reserved memory: created DMA memory pool at %pa, size %ld MiB\\n\",\n\t\t&rmem->base, (unsigned long)rmem->size / SZ_1M);\n\treturn 0;\n}",
    "includes": [
      "#include <linux/of_reserved_mem.h>",
      "#include <linux/of_fdt.h>",
      "#include <linux/of.h>",
      "#include <linux/dma-mapping.h>",
      "#include <linux/module.h>",
      "#include <linux/kernel.h>",
      "#include <linux/slab.h>",
      "#include <linux/io.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "pr_info",
          "args": [
            "\"Reserved memory: created DMA memory pool at %pa, size %ld MiB\\n\"",
            "&rmem->base",
            "(unsigned long)rmem->size / SZ_1M"
          ],
          "line": 402
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "WARN",
          "args": [
            "dma_reserved_default_memory",
            "\"Reserved memory: region for default DMA coherent area is redefined\\n\""
          ],
          "line": 395
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "of_get_flat_dt_prop",
          "args": [
            "node",
            "\"linux,dma-default\"",
            "NULL"
          ],
          "line": 394
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pr_err",
          "args": [
            "\"Reserved memory: regions without no-map are not yet supported\\n\""
          ],
          "line": 390
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "of_get_flat_dt_prop",
          "args": [
            "node",
            "\"no-map\"",
            "NULL"
          ],
          "line": 389
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "of_get_flat_dt_prop",
          "args": [
            "node",
            "\"reusable\"",
            "NULL"
          ],
          "line": 385
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-mapping.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nstatic int __init rmem_dma_setup(struct reserved_mem *rmem)\n{\n\tunsigned long node = rmem->fdt_node;\n\n\tif (of_get_flat_dt_prop(node, \"reusable\", NULL))\n\t\treturn -EINVAL;\n\n#ifdef CONFIG_ARM\n\tif (!of_get_flat_dt_prop(node, \"no-map\", NULL)) {\n\t\tpr_err(\"Reserved memory: regions without no-map are not yet supported\\n\");\n\t\treturn -EINVAL;\n\t}\n\n\tif (of_get_flat_dt_prop(node, \"linux,dma-default\", NULL)) {\n\t\tWARN(dma_reserved_default_memory,\n\t\t     \"Reserved memory: region for default DMA coherent area is redefined\\n\");\n\t\tdma_reserved_default_memory = rmem;\n\t}\n#endif\n\n\trmem->ops = &rmem_dma_ops;\n\tpr_info(\"Reserved memory: created DMA memory pool at %pa, size %ld MiB\\n\",\n\t\t&rmem->base, (unsigned long)rmem->size / SZ_1M);\n\treturn 0;\n}"
  },
  {
    "function_name": "rmem_dma_device_release",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18955/repo/kernel/dma/coherent.c",
    "lines": "369-374",
    "snippet": "static void rmem_dma_device_release(struct reserved_mem *rmem,\n\t\t\t\t    struct device *dev)\n{\n\tif (dev)\n\t\tdev->dma_mem = NULL;\n}",
    "includes": [
      "#include <linux/of_reserved_mem.h>",
      "#include <linux/of_fdt.h>",
      "#include <linux/of.h>",
      "#include <linux/dma-mapping.h>",
      "#include <linux/module.h>",
      "#include <linux/kernel.h>",
      "#include <linux/slab.h>",
      "#include <linux/io.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-mapping.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nstatic void rmem_dma_device_release(struct reserved_mem *rmem,\n\t\t\t\t    struct device *dev)\n{\n\tif (dev)\n\t\tdev->dma_mem = NULL;\n}"
  },
  {
    "function_name": "rmem_dma_device_init",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18955/repo/kernel/dma/coherent.c",
    "lines": "348-367",
    "snippet": "static int rmem_dma_device_init(struct reserved_mem *rmem, struct device *dev)\n{\n\tstruct dma_coherent_mem *mem = rmem->priv;\n\tint ret;\n\n\tif (!mem) {\n\t\tret = dma_init_coherent_memory(rmem->base, rmem->base,\n\t\t\t\t\t       rmem->size,\n\t\t\t\t\t       DMA_MEMORY_EXCLUSIVE, &mem);\n\t\tif (ret) {\n\t\t\tpr_err(\"Reserved memory: failed to init DMA memory pool at %pa, size %ld MiB\\n\",\n\t\t\t\t&rmem->base, (unsigned long)rmem->size / SZ_1M);\n\t\t\treturn ret;\n\t\t}\n\t}\n\tmem->use_dev_dma_pfn_offset = true;\n\trmem->priv = mem;\n\tdma_assign_coherent_memory(dev, mem);\n\treturn 0;\n}",
    "includes": [
      "#include <linux/of_reserved_mem.h>",
      "#include <linux/of_fdt.h>",
      "#include <linux/of.h>",
      "#include <linux/dma-mapping.h>",
      "#include <linux/module.h>",
      "#include <linux/kernel.h>",
      "#include <linux/slab.h>",
      "#include <linux/io.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dma_assign_coherent_memory",
          "args": [
            "dev",
            "mem"
          ],
          "line": 365
        },
        "resolved": true,
        "details": {
          "function_name": "dma_assign_coherent_memory",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18955/repo/kernel/dma/coherent.c",
          "lines": "99-110",
          "snippet": "static int dma_assign_coherent_memory(struct device *dev,\n\t\t\t\t      struct dma_coherent_mem *mem)\n{\n\tif (!dev)\n\t\treturn -ENODEV;\n\n\tif (dev->dma_mem)\n\t\treturn -EBUSY;\n\n\tdev->dma_mem = mem;\n\treturn 0;\n}",
          "includes": [
            "#include <linux/of_reserved_mem.h>",
            "#include <linux/of_fdt.h>",
            "#include <linux/of.h>",
            "#include <linux/dma-mapping.h>",
            "#include <linux/module.h>",
            "#include <linux/kernel.h>",
            "#include <linux/slab.h>",
            "#include <linux/io.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-mapping.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nstatic int dma_assign_coherent_memory(struct device *dev,\n\t\t\t\t      struct dma_coherent_mem *mem)\n{\n\tif (!dev)\n\t\treturn -ENODEV;\n\n\tif (dev->dma_mem)\n\t\treturn -EBUSY;\n\n\tdev->dma_mem = mem;\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "pr_err",
          "args": [
            "\"Reserved memory: failed to init DMA memory pool at %pa, size %ld MiB\\n\"",
            "&rmem->base",
            "(unsigned long)rmem->size / SZ_1M"
          ],
          "line": 358
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dma_init_coherent_memory",
          "args": [
            "rmem->base",
            "rmem->base",
            "rmem->size",
            "DMA_MEMORY_EXCLUSIVE",
            "&mem"
          ],
          "line": 354
        },
        "resolved": true,
        "details": {
          "function_name": "dma_init_coherent_memory",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18955/repo/kernel/dma/coherent.c",
          "lines": "41-87",
          "snippet": "static int dma_init_coherent_memory(\n\tphys_addr_t phys_addr, dma_addr_t device_addr, size_t size, int flags,\n\tstruct dma_coherent_mem **mem)\n{\n\tstruct dma_coherent_mem *dma_mem = NULL;\n\tvoid __iomem *mem_base = NULL;\n\tint pages = size >> PAGE_SHIFT;\n\tint bitmap_size = BITS_TO_LONGS(pages) * sizeof(long);\n\tint ret;\n\n\tif (!size) {\n\t\tret = -EINVAL;\n\t\tgoto out;\n\t}\n\n\tmem_base = memremap(phys_addr, size, MEMREMAP_WC);\n\tif (!mem_base) {\n\t\tret = -EINVAL;\n\t\tgoto out;\n\t}\n\tdma_mem = kzalloc(sizeof(struct dma_coherent_mem), GFP_KERNEL);\n\tif (!dma_mem) {\n\t\tret = -ENOMEM;\n\t\tgoto out;\n\t}\n\tdma_mem->bitmap = kzalloc(bitmap_size, GFP_KERNEL);\n\tif (!dma_mem->bitmap) {\n\t\tret = -ENOMEM;\n\t\tgoto out;\n\t}\n\n\tdma_mem->virt_base = mem_base;\n\tdma_mem->device_base = device_addr;\n\tdma_mem->pfn_base = PFN_DOWN(phys_addr);\n\tdma_mem->size = pages;\n\tdma_mem->flags = flags;\n\tspin_lock_init(&dma_mem->spinlock);\n\n\t*mem = dma_mem;\n\treturn 0;\n\nout:\n\tkfree(dma_mem);\n\tif (mem_base)\n\t\tmemunmap(mem_base);\n\treturn ret;\n}",
          "includes": [
            "#include <linux/of_reserved_mem.h>",
            "#include <linux/of_fdt.h>",
            "#include <linux/of.h>",
            "#include <linux/dma-mapping.h>",
            "#include <linux/module.h>",
            "#include <linux/kernel.h>",
            "#include <linux/slab.h>",
            "#include <linux/io.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-mapping.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nstatic int dma_init_coherent_memory(\n\tphys_addr_t phys_addr, dma_addr_t device_addr, size_t size, int flags,\n\tstruct dma_coherent_mem **mem)\n{\n\tstruct dma_coherent_mem *dma_mem = NULL;\n\tvoid __iomem *mem_base = NULL;\n\tint pages = size >> PAGE_SHIFT;\n\tint bitmap_size = BITS_TO_LONGS(pages) * sizeof(long);\n\tint ret;\n\n\tif (!size) {\n\t\tret = -EINVAL;\n\t\tgoto out;\n\t}\n\n\tmem_base = memremap(phys_addr, size, MEMREMAP_WC);\n\tif (!mem_base) {\n\t\tret = -EINVAL;\n\t\tgoto out;\n\t}\n\tdma_mem = kzalloc(sizeof(struct dma_coherent_mem), GFP_KERNEL);\n\tif (!dma_mem) {\n\t\tret = -ENOMEM;\n\t\tgoto out;\n\t}\n\tdma_mem->bitmap = kzalloc(bitmap_size, GFP_KERNEL);\n\tif (!dma_mem->bitmap) {\n\t\tret = -ENOMEM;\n\t\tgoto out;\n\t}\n\n\tdma_mem->virt_base = mem_base;\n\tdma_mem->device_base = device_addr;\n\tdma_mem->pfn_base = PFN_DOWN(phys_addr);\n\tdma_mem->size = pages;\n\tdma_mem->flags = flags;\n\tspin_lock_init(&dma_mem->spinlock);\n\n\t*mem = dma_mem;\n\treturn 0;\n\nout:\n\tkfree(dma_mem);\n\tif (mem_base)\n\t\tmemunmap(mem_base);\n\treturn ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-mapping.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nstatic int rmem_dma_device_init(struct reserved_mem *rmem, struct device *dev)\n{\n\tstruct dma_coherent_mem *mem = rmem->priv;\n\tint ret;\n\n\tif (!mem) {\n\t\tret = dma_init_coherent_memory(rmem->base, rmem->base,\n\t\t\t\t\t       rmem->size,\n\t\t\t\t\t       DMA_MEMORY_EXCLUSIVE, &mem);\n\t\tif (ret) {\n\t\t\tpr_err(\"Reserved memory: failed to init DMA memory pool at %pa, size %ld MiB\\n\",\n\t\t\t\t&rmem->base, (unsigned long)rmem->size / SZ_1M);\n\t\t\treturn ret;\n\t\t}\n\t}\n\tmem->use_dev_dma_pfn_offset = true;\n\trmem->priv = mem;\n\tdma_assign_coherent_memory(dev, mem);\n\treturn 0;\n}"
  },
  {
    "function_name": "dma_mmap_from_global_coherent",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18955/repo/kernel/dma/coherent.c",
    "lines": "328-336",
    "snippet": "int dma_mmap_from_global_coherent(struct vm_area_struct *vma, void *vaddr,\n\t\t\t\t   size_t size, int *ret)\n{\n\tif (!dma_coherent_default_memory)\n\t\treturn 0;\n\n\treturn __dma_mmap_from_coherent(dma_coherent_default_memory, vma,\n\t\t\t\t\tvaddr, size, ret);\n}",
    "includes": [
      "#include <linux/of_reserved_mem.h>",
      "#include <linux/of_fdt.h>",
      "#include <linux/of.h>",
      "#include <linux/dma-mapping.h>",
      "#include <linux/module.h>",
      "#include <linux/kernel.h>",
      "#include <linux/slab.h>",
      "#include <linux/io.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static struct dma_coherent_mem *dma_coherent_default_memory"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "__dma_mmap_from_coherent",
          "args": [
            "dma_coherent_default_memory",
            "vma",
            "vaddr",
            "size",
            "ret"
          ],
          "line": 334
        },
        "resolved": true,
        "details": {
          "function_name": "__dma_mmap_from_coherent",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18955/repo/kernel/dma/coherent.c",
          "lines": "282-302",
          "snippet": "static int __dma_mmap_from_coherent(struct dma_coherent_mem *mem,\n\t\tstruct vm_area_struct *vma, void *vaddr, size_t size, int *ret)\n{\n\tif (mem && vaddr >= mem->virt_base && vaddr + size <=\n\t\t   (mem->virt_base + (mem->size << PAGE_SHIFT))) {\n\t\tunsigned long off = vma->vm_pgoff;\n\t\tint start = (vaddr - mem->virt_base) >> PAGE_SHIFT;\n\t\tint user_count = vma_pages(vma);\n\t\tint count = PAGE_ALIGN(size) >> PAGE_SHIFT;\n\n\t\t*ret = -ENXIO;\n\t\tif (off < count && user_count <= count - off) {\n\t\t\tunsigned long pfn = mem->pfn_base + start + off;\n\t\t\t*ret = remap_pfn_range(vma, vma->vm_start, pfn,\n\t\t\t\t\t       user_count << PAGE_SHIFT,\n\t\t\t\t\t       vma->vm_page_prot);\n\t\t}\n\t\treturn 1;\n\t}\n\treturn 0;\n}",
          "includes": [
            "#include <linux/of_reserved_mem.h>",
            "#include <linux/of_fdt.h>",
            "#include <linux/of.h>",
            "#include <linux/dma-mapping.h>",
            "#include <linux/module.h>",
            "#include <linux/kernel.h>",
            "#include <linux/slab.h>",
            "#include <linux/io.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-mapping.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nstatic int __dma_mmap_from_coherent(struct dma_coherent_mem *mem,\n\t\tstruct vm_area_struct *vma, void *vaddr, size_t size, int *ret)\n{\n\tif (mem && vaddr >= mem->virt_base && vaddr + size <=\n\t\t   (mem->virt_base + (mem->size << PAGE_SHIFT))) {\n\t\tunsigned long off = vma->vm_pgoff;\n\t\tint start = (vaddr - mem->virt_base) >> PAGE_SHIFT;\n\t\tint user_count = vma_pages(vma);\n\t\tint count = PAGE_ALIGN(size) >> PAGE_SHIFT;\n\n\t\t*ret = -ENXIO;\n\t\tif (off < count && user_count <= count - off) {\n\t\t\tunsigned long pfn = mem->pfn_base + start + off;\n\t\t\t*ret = remap_pfn_range(vma, vma->vm_start, pfn,\n\t\t\t\t\t       user_count << PAGE_SHIFT,\n\t\t\t\t\t       vma->vm_page_prot);\n\t\t}\n\t\treturn 1;\n\t}\n\treturn 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-mapping.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nstatic struct dma_coherent_mem *dma_coherent_default_memory;\n\nint dma_mmap_from_global_coherent(struct vm_area_struct *vma, void *vaddr,\n\t\t\t\t   size_t size, int *ret)\n{\n\tif (!dma_coherent_default_memory)\n\t\treturn 0;\n\n\treturn __dma_mmap_from_coherent(dma_coherent_default_memory, vma,\n\t\t\t\t\tvaddr, size, ret);\n}"
  },
  {
    "function_name": "dma_mmap_from_dev_coherent",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18955/repo/kernel/dma/coherent.c",
    "lines": "319-325",
    "snippet": "int dma_mmap_from_dev_coherent(struct device *dev, struct vm_area_struct *vma,\n\t\t\t   void *vaddr, size_t size, int *ret)\n{\n\tstruct dma_coherent_mem *mem = dev_get_coherent_memory(dev);\n\n\treturn __dma_mmap_from_coherent(mem, vma, vaddr, size, ret);\n}",
    "includes": [
      "#include <linux/of_reserved_mem.h>",
      "#include <linux/of_fdt.h>",
      "#include <linux/of.h>",
      "#include <linux/dma-mapping.h>",
      "#include <linux/module.h>",
      "#include <linux/kernel.h>",
      "#include <linux/slab.h>",
      "#include <linux/io.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "__dma_mmap_from_coherent",
          "args": [
            "mem",
            "vma",
            "vaddr",
            "size",
            "ret"
          ],
          "line": 324
        },
        "resolved": true,
        "details": {
          "function_name": "__dma_mmap_from_coherent",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18955/repo/kernel/dma/coherent.c",
          "lines": "282-302",
          "snippet": "static int __dma_mmap_from_coherent(struct dma_coherent_mem *mem,\n\t\tstruct vm_area_struct *vma, void *vaddr, size_t size, int *ret)\n{\n\tif (mem && vaddr >= mem->virt_base && vaddr + size <=\n\t\t   (mem->virt_base + (mem->size << PAGE_SHIFT))) {\n\t\tunsigned long off = vma->vm_pgoff;\n\t\tint start = (vaddr - mem->virt_base) >> PAGE_SHIFT;\n\t\tint user_count = vma_pages(vma);\n\t\tint count = PAGE_ALIGN(size) >> PAGE_SHIFT;\n\n\t\t*ret = -ENXIO;\n\t\tif (off < count && user_count <= count - off) {\n\t\t\tunsigned long pfn = mem->pfn_base + start + off;\n\t\t\t*ret = remap_pfn_range(vma, vma->vm_start, pfn,\n\t\t\t\t\t       user_count << PAGE_SHIFT,\n\t\t\t\t\t       vma->vm_page_prot);\n\t\t}\n\t\treturn 1;\n\t}\n\treturn 0;\n}",
          "includes": [
            "#include <linux/of_reserved_mem.h>",
            "#include <linux/of_fdt.h>",
            "#include <linux/of.h>",
            "#include <linux/dma-mapping.h>",
            "#include <linux/module.h>",
            "#include <linux/kernel.h>",
            "#include <linux/slab.h>",
            "#include <linux/io.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-mapping.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nstatic int __dma_mmap_from_coherent(struct dma_coherent_mem *mem,\n\t\tstruct vm_area_struct *vma, void *vaddr, size_t size, int *ret)\n{\n\tif (mem && vaddr >= mem->virt_base && vaddr + size <=\n\t\t   (mem->virt_base + (mem->size << PAGE_SHIFT))) {\n\t\tunsigned long off = vma->vm_pgoff;\n\t\tint start = (vaddr - mem->virt_base) >> PAGE_SHIFT;\n\t\tint user_count = vma_pages(vma);\n\t\tint count = PAGE_ALIGN(size) >> PAGE_SHIFT;\n\n\t\t*ret = -ENXIO;\n\t\tif (off < count && user_count <= count - off) {\n\t\t\tunsigned long pfn = mem->pfn_base + start + off;\n\t\t\t*ret = remap_pfn_range(vma, vma->vm_start, pfn,\n\t\t\t\t\t       user_count << PAGE_SHIFT,\n\t\t\t\t\t       vma->vm_page_prot);\n\t\t}\n\t\treturn 1;\n\t}\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dev_get_coherent_memory",
          "args": [
            "dev"
          ],
          "line": 322
        },
        "resolved": true,
        "details": {
          "function_name": "dev_get_coherent_memory",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18955/repo/kernel/dma/coherent.c",
          "lines": "25-30",
          "snippet": "static inline struct dma_coherent_mem *dev_get_coherent_memory(struct device *dev)\n{\n\tif (dev && dev->dma_mem)\n\t\treturn dev->dma_mem;\n\treturn NULL;\n}",
          "includes": [
            "#include <linux/of_reserved_mem.h>",
            "#include <linux/of_fdt.h>",
            "#include <linux/of.h>",
            "#include <linux/dma-mapping.h>",
            "#include <linux/module.h>",
            "#include <linux/kernel.h>",
            "#include <linux/slab.h>",
            "#include <linux/io.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-mapping.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nstatic inline struct dma_coherent_mem *dev_get_coherent_memory(struct device *dev)\n{\n\tif (dev && dev->dma_mem)\n\t\treturn dev->dma_mem;\n\treturn NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-mapping.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nint dma_mmap_from_dev_coherent(struct device *dev, struct vm_area_struct *vma,\n\t\t\t   void *vaddr, size_t size, int *ret)\n{\n\tstruct dma_coherent_mem *mem = dev_get_coherent_memory(dev);\n\n\treturn __dma_mmap_from_coherent(mem, vma, vaddr, size, ret);\n}"
  },
  {
    "function_name": "__dma_mmap_from_coherent",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18955/repo/kernel/dma/coherent.c",
    "lines": "282-302",
    "snippet": "static int __dma_mmap_from_coherent(struct dma_coherent_mem *mem,\n\t\tstruct vm_area_struct *vma, void *vaddr, size_t size, int *ret)\n{\n\tif (mem && vaddr >= mem->virt_base && vaddr + size <=\n\t\t   (mem->virt_base + (mem->size << PAGE_SHIFT))) {\n\t\tunsigned long off = vma->vm_pgoff;\n\t\tint start = (vaddr - mem->virt_base) >> PAGE_SHIFT;\n\t\tint user_count = vma_pages(vma);\n\t\tint count = PAGE_ALIGN(size) >> PAGE_SHIFT;\n\n\t\t*ret = -ENXIO;\n\t\tif (off < count && user_count <= count - off) {\n\t\t\tunsigned long pfn = mem->pfn_base + start + off;\n\t\t\t*ret = remap_pfn_range(vma, vma->vm_start, pfn,\n\t\t\t\t\t       user_count << PAGE_SHIFT,\n\t\t\t\t\t       vma->vm_page_prot);\n\t\t}\n\t\treturn 1;\n\t}\n\treturn 0;\n}",
    "includes": [
      "#include <linux/of_reserved_mem.h>",
      "#include <linux/of_fdt.h>",
      "#include <linux/of.h>",
      "#include <linux/dma-mapping.h>",
      "#include <linux/module.h>",
      "#include <linux/kernel.h>",
      "#include <linux/slab.h>",
      "#include <linux/io.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "remap_pfn_range",
          "args": [
            "vma",
            "vma->vm_start",
            "pfn",
            "user_count << PAGE_SHIFT",
            "vma->vm_page_prot"
          ],
          "line": 295
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "PAGE_ALIGN",
          "args": [
            "size"
          ],
          "line": 290
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "vma_pages",
          "args": [
            "vma"
          ],
          "line": 289
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-mapping.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nstatic int __dma_mmap_from_coherent(struct dma_coherent_mem *mem,\n\t\tstruct vm_area_struct *vma, void *vaddr, size_t size, int *ret)\n{\n\tif (mem && vaddr >= mem->virt_base && vaddr + size <=\n\t\t   (mem->virt_base + (mem->size << PAGE_SHIFT))) {\n\t\tunsigned long off = vma->vm_pgoff;\n\t\tint start = (vaddr - mem->virt_base) >> PAGE_SHIFT;\n\t\tint user_count = vma_pages(vma);\n\t\tint count = PAGE_ALIGN(size) >> PAGE_SHIFT;\n\n\t\t*ret = -ENXIO;\n\t\tif (off < count && user_count <= count - off) {\n\t\t\tunsigned long pfn = mem->pfn_base + start + off;\n\t\t\t*ret = remap_pfn_range(vma, vma->vm_start, pfn,\n\t\t\t\t\t       user_count << PAGE_SHIFT,\n\t\t\t\t\t       vma->vm_page_prot);\n\t\t}\n\t\treturn 1;\n\t}\n\treturn 0;\n}"
  },
  {
    "function_name": "dma_release_from_global_coherent",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18955/repo/kernel/dma/coherent.c",
    "lines": "273-280",
    "snippet": "int dma_release_from_global_coherent(int order, void *vaddr)\n{\n\tif (!dma_coherent_default_memory)\n\t\treturn 0;\n\n\treturn __dma_release_from_coherent(dma_coherent_default_memory, order,\n\t\t\tvaddr);\n}",
    "includes": [
      "#include <linux/of_reserved_mem.h>",
      "#include <linux/of_fdt.h>",
      "#include <linux/of.h>",
      "#include <linux/dma-mapping.h>",
      "#include <linux/module.h>",
      "#include <linux/kernel.h>",
      "#include <linux/slab.h>",
      "#include <linux/io.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static struct dma_coherent_mem *dma_coherent_default_memory"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "__dma_release_from_coherent",
          "args": [
            "dma_coherent_default_memory",
            "order",
            "vaddr"
          ],
          "line": 278
        },
        "resolved": true,
        "details": {
          "function_name": "__dma_release_from_coherent",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18955/repo/kernel/dma/coherent.c",
          "lines": "237-251",
          "snippet": "static int __dma_release_from_coherent(struct dma_coherent_mem *mem,\n\t\t\t\t       int order, void *vaddr)\n{\n\tif (mem && vaddr >= mem->virt_base && vaddr <\n\t\t   (mem->virt_base + (mem->size << PAGE_SHIFT))) {\n\t\tint page = (vaddr - mem->virt_base) >> PAGE_SHIFT;\n\t\tunsigned long flags;\n\n\t\tspin_lock_irqsave(&mem->spinlock, flags);\n\t\tbitmap_release_region(mem->bitmap, page, order);\n\t\tspin_unlock_irqrestore(&mem->spinlock, flags);\n\t\treturn 1;\n\t}\n\treturn 0;\n}",
          "includes": [
            "#include <linux/of_reserved_mem.h>",
            "#include <linux/of_fdt.h>",
            "#include <linux/of.h>",
            "#include <linux/dma-mapping.h>",
            "#include <linux/module.h>",
            "#include <linux/kernel.h>",
            "#include <linux/slab.h>",
            "#include <linux/io.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-mapping.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nstatic int __dma_release_from_coherent(struct dma_coherent_mem *mem,\n\t\t\t\t       int order, void *vaddr)\n{\n\tif (mem && vaddr >= mem->virt_base && vaddr <\n\t\t   (mem->virt_base + (mem->size << PAGE_SHIFT))) {\n\t\tint page = (vaddr - mem->virt_base) >> PAGE_SHIFT;\n\t\tunsigned long flags;\n\n\t\tspin_lock_irqsave(&mem->spinlock, flags);\n\t\tbitmap_release_region(mem->bitmap, page, order);\n\t\tspin_unlock_irqrestore(&mem->spinlock, flags);\n\t\treturn 1;\n\t}\n\treturn 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-mapping.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nstatic struct dma_coherent_mem *dma_coherent_default_memory;\n\nint dma_release_from_global_coherent(int order, void *vaddr)\n{\n\tif (!dma_coherent_default_memory)\n\t\treturn 0;\n\n\treturn __dma_release_from_coherent(dma_coherent_default_memory, order,\n\t\t\tvaddr);\n}"
  },
  {
    "function_name": "dma_release_from_dev_coherent",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18955/repo/kernel/dma/coherent.c",
    "lines": "265-270",
    "snippet": "int dma_release_from_dev_coherent(struct device *dev, int order, void *vaddr)\n{\n\tstruct dma_coherent_mem *mem = dev_get_coherent_memory(dev);\n\n\treturn __dma_release_from_coherent(mem, order, vaddr);\n}",
    "includes": [
      "#include <linux/of_reserved_mem.h>",
      "#include <linux/of_fdt.h>",
      "#include <linux/of.h>",
      "#include <linux/dma-mapping.h>",
      "#include <linux/module.h>",
      "#include <linux/kernel.h>",
      "#include <linux/slab.h>",
      "#include <linux/io.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "__dma_release_from_coherent",
          "args": [
            "mem",
            "order",
            "vaddr"
          ],
          "line": 269
        },
        "resolved": true,
        "details": {
          "function_name": "__dma_release_from_coherent",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18955/repo/kernel/dma/coherent.c",
          "lines": "237-251",
          "snippet": "static int __dma_release_from_coherent(struct dma_coherent_mem *mem,\n\t\t\t\t       int order, void *vaddr)\n{\n\tif (mem && vaddr >= mem->virt_base && vaddr <\n\t\t   (mem->virt_base + (mem->size << PAGE_SHIFT))) {\n\t\tint page = (vaddr - mem->virt_base) >> PAGE_SHIFT;\n\t\tunsigned long flags;\n\n\t\tspin_lock_irqsave(&mem->spinlock, flags);\n\t\tbitmap_release_region(mem->bitmap, page, order);\n\t\tspin_unlock_irqrestore(&mem->spinlock, flags);\n\t\treturn 1;\n\t}\n\treturn 0;\n}",
          "includes": [
            "#include <linux/of_reserved_mem.h>",
            "#include <linux/of_fdt.h>",
            "#include <linux/of.h>",
            "#include <linux/dma-mapping.h>",
            "#include <linux/module.h>",
            "#include <linux/kernel.h>",
            "#include <linux/slab.h>",
            "#include <linux/io.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-mapping.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nstatic int __dma_release_from_coherent(struct dma_coherent_mem *mem,\n\t\t\t\t       int order, void *vaddr)\n{\n\tif (mem && vaddr >= mem->virt_base && vaddr <\n\t\t   (mem->virt_base + (mem->size << PAGE_SHIFT))) {\n\t\tint page = (vaddr - mem->virt_base) >> PAGE_SHIFT;\n\t\tunsigned long flags;\n\n\t\tspin_lock_irqsave(&mem->spinlock, flags);\n\t\tbitmap_release_region(mem->bitmap, page, order);\n\t\tspin_unlock_irqrestore(&mem->spinlock, flags);\n\t\treturn 1;\n\t}\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dev_get_coherent_memory",
          "args": [
            "dev"
          ],
          "line": 267
        },
        "resolved": true,
        "details": {
          "function_name": "dev_get_coherent_memory",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18955/repo/kernel/dma/coherent.c",
          "lines": "25-30",
          "snippet": "static inline struct dma_coherent_mem *dev_get_coherent_memory(struct device *dev)\n{\n\tif (dev && dev->dma_mem)\n\t\treturn dev->dma_mem;\n\treturn NULL;\n}",
          "includes": [
            "#include <linux/of_reserved_mem.h>",
            "#include <linux/of_fdt.h>",
            "#include <linux/of.h>",
            "#include <linux/dma-mapping.h>",
            "#include <linux/module.h>",
            "#include <linux/kernel.h>",
            "#include <linux/slab.h>",
            "#include <linux/io.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-mapping.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nstatic inline struct dma_coherent_mem *dev_get_coherent_memory(struct device *dev)\n{\n\tif (dev && dev->dma_mem)\n\t\treturn dev->dma_mem;\n\treturn NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-mapping.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nint dma_release_from_dev_coherent(struct device *dev, int order, void *vaddr)\n{\n\tstruct dma_coherent_mem *mem = dev_get_coherent_memory(dev);\n\n\treturn __dma_release_from_coherent(mem, order, vaddr);\n}"
  },
  {
    "function_name": "__dma_release_from_coherent",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18955/repo/kernel/dma/coherent.c",
    "lines": "237-251",
    "snippet": "static int __dma_release_from_coherent(struct dma_coherent_mem *mem,\n\t\t\t\t       int order, void *vaddr)\n{\n\tif (mem && vaddr >= mem->virt_base && vaddr <\n\t\t   (mem->virt_base + (mem->size << PAGE_SHIFT))) {\n\t\tint page = (vaddr - mem->virt_base) >> PAGE_SHIFT;\n\t\tunsigned long flags;\n\n\t\tspin_lock_irqsave(&mem->spinlock, flags);\n\t\tbitmap_release_region(mem->bitmap, page, order);\n\t\tspin_unlock_irqrestore(&mem->spinlock, flags);\n\t\treturn 1;\n\t}\n\treturn 0;\n}",
    "includes": [
      "#include <linux/of_reserved_mem.h>",
      "#include <linux/of_fdt.h>",
      "#include <linux/of.h>",
      "#include <linux/dma-mapping.h>",
      "#include <linux/module.h>",
      "#include <linux/kernel.h>",
      "#include <linux/slab.h>",
      "#include <linux/io.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "spin_unlock_irqrestore",
          "args": [
            "&mem->spinlock",
            "flags"
          ],
          "line": 247
        },
        "resolved": true,
        "details": {
          "function_name": "_raw_spin_unlock_irqrestore",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18955/repo/kernel/locking/spinlock.c",
          "lines": "182-185",
          "snippet": "void __lockfunc _raw_spin_unlock_irqrestore(raw_spinlock_t *lock, unsigned long flags)\n{\n\t__raw_spin_unlock_irqrestore(lock, flags);\n}",
          "includes": [
            "#include <linux/export.h>",
            "#include <linux/debug_locks.h>",
            "#include <linux/interrupt.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/preempt.h>",
            "#include <linux/linkage.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/export.h>\n#include <linux/debug_locks.h>\n#include <linux/interrupt.h>\n#include <linux/spinlock.h>\n#include <linux/preempt.h>\n#include <linux/linkage.h>\n\nvoid __lockfunc _raw_spin_unlock_irqrestore(raw_spinlock_t *lock, unsigned long flags)\n{\n\t__raw_spin_unlock_irqrestore(lock, flags);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bitmap_release_region",
          "args": [
            "mem->bitmap",
            "page",
            "order"
          ],
          "line": 246
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "spin_lock_irqsave",
          "args": [
            "&mem->spinlock",
            "flags"
          ],
          "line": 245
        },
        "resolved": true,
        "details": {
          "function_name": "_raw_spin_lock_irqsave_nested",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18955/repo/kernel/locking/spinlock.c",
          "lines": "359-370",
          "snippet": "unsigned long __lockfunc _raw_spin_lock_irqsave_nested(raw_spinlock_t *lock,\n\t\t\t\t\t\t   int subclass)\n{\n\tunsigned long flags;\n\n\tlocal_irq_save(flags);\n\tpreempt_disable();\n\tspin_acquire(&lock->dep_map, subclass, 0, _RET_IP_);\n\tLOCK_CONTENDED_FLAGS(lock, do_raw_spin_trylock, do_raw_spin_lock,\n\t\t\t\tdo_raw_spin_lock_flags, &flags);\n\treturn flags;\n}",
          "includes": [
            "#include <linux/export.h>",
            "#include <linux/debug_locks.h>",
            "#include <linux/interrupt.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/preempt.h>",
            "#include <linux/linkage.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/export.h>\n#include <linux/debug_locks.h>\n#include <linux/interrupt.h>\n#include <linux/spinlock.h>\n#include <linux/preempt.h>\n#include <linux/linkage.h>\n\nunsigned long __lockfunc _raw_spin_lock_irqsave_nested(raw_spinlock_t *lock,\n\t\t\t\t\t\t   int subclass)\n{\n\tunsigned long flags;\n\n\tlocal_irq_save(flags);\n\tpreempt_disable();\n\tspin_acquire(&lock->dep_map, subclass, 0, _RET_IP_);\n\tLOCK_CONTENDED_FLAGS(lock, do_raw_spin_trylock, do_raw_spin_lock,\n\t\t\t\tdo_raw_spin_lock_flags, &flags);\n\treturn flags;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-mapping.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nstatic int __dma_release_from_coherent(struct dma_coherent_mem *mem,\n\t\t\t\t       int order, void *vaddr)\n{\n\tif (mem && vaddr >= mem->virt_base && vaddr <\n\t\t   (mem->virt_base + (mem->size << PAGE_SHIFT))) {\n\t\tint page = (vaddr - mem->virt_base) >> PAGE_SHIFT;\n\t\tunsigned long flags;\n\n\t\tspin_lock_irqsave(&mem->spinlock, flags);\n\t\tbitmap_release_region(mem->bitmap, page, order);\n\t\tspin_unlock_irqrestore(&mem->spinlock, flags);\n\t\treturn 1;\n\t}\n\treturn 0;\n}"
  },
  {
    "function_name": "dma_alloc_from_global_coherent",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18955/repo/kernel/dma/coherent.c",
    "lines": "228-235",
    "snippet": "void *dma_alloc_from_global_coherent(ssize_t size, dma_addr_t *dma_handle)\n{\n\tif (!dma_coherent_default_memory)\n\t\treturn NULL;\n\n\treturn __dma_alloc_from_coherent(dma_coherent_default_memory, size,\n\t\t\tdma_handle);\n}",
    "includes": [
      "#include <linux/of_reserved_mem.h>",
      "#include <linux/of_fdt.h>",
      "#include <linux/of.h>",
      "#include <linux/dma-mapping.h>",
      "#include <linux/module.h>",
      "#include <linux/kernel.h>",
      "#include <linux/slab.h>",
      "#include <linux/io.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static struct dma_coherent_mem *dma_coherent_default_memory"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "__dma_alloc_from_coherent",
          "args": [
            "dma_coherent_default_memory",
            "size",
            "dma_handle"
          ],
          "line": 233
        },
        "resolved": true,
        "details": {
          "function_name": "__dma_alloc_from_coherent",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18955/repo/kernel/dma/coherent.c",
          "lines": "163-191",
          "snippet": "static void *__dma_alloc_from_coherent(struct dma_coherent_mem *mem,\n\t\tssize_t size, dma_addr_t *dma_handle)\n{\n\tint order = get_order(size);\n\tunsigned long flags;\n\tint pageno;\n\tvoid *ret;\n\n\tspin_lock_irqsave(&mem->spinlock, flags);\n\n\tif (unlikely(size > (mem->size << PAGE_SHIFT)))\n\t\tgoto err;\n\n\tpageno = bitmap_find_free_region(mem->bitmap, mem->size, order);\n\tif (unlikely(pageno < 0))\n\t\tgoto err;\n\n\t/*\n\t * Memory was found in the coherent area.\n\t */\n\t*dma_handle = mem->device_base + (pageno << PAGE_SHIFT);\n\tret = mem->virt_base + (pageno << PAGE_SHIFT);\n\tspin_unlock_irqrestore(&mem->spinlock, flags);\n\tmemset(ret, 0, size);\n\treturn ret;\nerr:\n\tspin_unlock_irqrestore(&mem->spinlock, flags);\n\treturn NULL;\n}",
          "includes": [
            "#include <linux/of_reserved_mem.h>",
            "#include <linux/of_fdt.h>",
            "#include <linux/of.h>",
            "#include <linux/dma-mapping.h>",
            "#include <linux/module.h>",
            "#include <linux/kernel.h>",
            "#include <linux/slab.h>",
            "#include <linux/io.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-mapping.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nstatic void *__dma_alloc_from_coherent(struct dma_coherent_mem *mem,\n\t\tssize_t size, dma_addr_t *dma_handle)\n{\n\tint order = get_order(size);\n\tunsigned long flags;\n\tint pageno;\n\tvoid *ret;\n\n\tspin_lock_irqsave(&mem->spinlock, flags);\n\n\tif (unlikely(size > (mem->size << PAGE_SHIFT)))\n\t\tgoto err;\n\n\tpageno = bitmap_find_free_region(mem->bitmap, mem->size, order);\n\tif (unlikely(pageno < 0))\n\t\tgoto err;\n\n\t/*\n\t * Memory was found in the coherent area.\n\t */\n\t*dma_handle = mem->device_base + (pageno << PAGE_SHIFT);\n\tret = mem->virt_base + (pageno << PAGE_SHIFT);\n\tspin_unlock_irqrestore(&mem->spinlock, flags);\n\tmemset(ret, 0, size);\n\treturn ret;\nerr:\n\tspin_unlock_irqrestore(&mem->spinlock, flags);\n\treturn NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-mapping.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nstatic struct dma_coherent_mem *dma_coherent_default_memory;\n\nvoid *dma_alloc_from_global_coherent(ssize_t size, dma_addr_t *dma_handle)\n{\n\tif (!dma_coherent_default_memory)\n\t\treturn NULL;\n\n\treturn __dma_alloc_from_coherent(dma_coherent_default_memory, size,\n\t\t\tdma_handle);\n}"
  },
  {
    "function_name": "dma_alloc_from_dev_coherent",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18955/repo/kernel/dma/coherent.c",
    "lines": "207-225",
    "snippet": "int dma_alloc_from_dev_coherent(struct device *dev, ssize_t size,\n\t\tdma_addr_t *dma_handle, void **ret)\n{\n\tstruct dma_coherent_mem *mem = dev_get_coherent_memory(dev);\n\n\tif (!mem)\n\t\treturn 0;\n\n\t*ret = __dma_alloc_from_coherent(mem, size, dma_handle);\n\tif (*ret)\n\t\treturn 1;\n\n\t/*\n\t * In the case where the allocation can not be satisfied from the\n\t * per-device area, try to fall back to generic memory if the\n\t * constraints allow it.\n\t */\n\treturn mem->flags & DMA_MEMORY_EXCLUSIVE;\n}",
    "includes": [
      "#include <linux/of_reserved_mem.h>",
      "#include <linux/of_fdt.h>",
      "#include <linux/of.h>",
      "#include <linux/dma-mapping.h>",
      "#include <linux/module.h>",
      "#include <linux/kernel.h>",
      "#include <linux/slab.h>",
      "#include <linux/io.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "__dma_alloc_from_coherent",
          "args": [
            "mem",
            "size",
            "dma_handle"
          ],
          "line": 215
        },
        "resolved": true,
        "details": {
          "function_name": "__dma_alloc_from_coherent",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18955/repo/kernel/dma/coherent.c",
          "lines": "163-191",
          "snippet": "static void *__dma_alloc_from_coherent(struct dma_coherent_mem *mem,\n\t\tssize_t size, dma_addr_t *dma_handle)\n{\n\tint order = get_order(size);\n\tunsigned long flags;\n\tint pageno;\n\tvoid *ret;\n\n\tspin_lock_irqsave(&mem->spinlock, flags);\n\n\tif (unlikely(size > (mem->size << PAGE_SHIFT)))\n\t\tgoto err;\n\n\tpageno = bitmap_find_free_region(mem->bitmap, mem->size, order);\n\tif (unlikely(pageno < 0))\n\t\tgoto err;\n\n\t/*\n\t * Memory was found in the coherent area.\n\t */\n\t*dma_handle = mem->device_base + (pageno << PAGE_SHIFT);\n\tret = mem->virt_base + (pageno << PAGE_SHIFT);\n\tspin_unlock_irqrestore(&mem->spinlock, flags);\n\tmemset(ret, 0, size);\n\treturn ret;\nerr:\n\tspin_unlock_irqrestore(&mem->spinlock, flags);\n\treturn NULL;\n}",
          "includes": [
            "#include <linux/of_reserved_mem.h>",
            "#include <linux/of_fdt.h>",
            "#include <linux/of.h>",
            "#include <linux/dma-mapping.h>",
            "#include <linux/module.h>",
            "#include <linux/kernel.h>",
            "#include <linux/slab.h>",
            "#include <linux/io.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-mapping.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nstatic void *__dma_alloc_from_coherent(struct dma_coherent_mem *mem,\n\t\tssize_t size, dma_addr_t *dma_handle)\n{\n\tint order = get_order(size);\n\tunsigned long flags;\n\tint pageno;\n\tvoid *ret;\n\n\tspin_lock_irqsave(&mem->spinlock, flags);\n\n\tif (unlikely(size > (mem->size << PAGE_SHIFT)))\n\t\tgoto err;\n\n\tpageno = bitmap_find_free_region(mem->bitmap, mem->size, order);\n\tif (unlikely(pageno < 0))\n\t\tgoto err;\n\n\t/*\n\t * Memory was found in the coherent area.\n\t */\n\t*dma_handle = mem->device_base + (pageno << PAGE_SHIFT);\n\tret = mem->virt_base + (pageno << PAGE_SHIFT);\n\tspin_unlock_irqrestore(&mem->spinlock, flags);\n\tmemset(ret, 0, size);\n\treturn ret;\nerr:\n\tspin_unlock_irqrestore(&mem->spinlock, flags);\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dev_get_coherent_memory",
          "args": [
            "dev"
          ],
          "line": 210
        },
        "resolved": true,
        "details": {
          "function_name": "dev_get_coherent_memory",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18955/repo/kernel/dma/coherent.c",
          "lines": "25-30",
          "snippet": "static inline struct dma_coherent_mem *dev_get_coherent_memory(struct device *dev)\n{\n\tif (dev && dev->dma_mem)\n\t\treturn dev->dma_mem;\n\treturn NULL;\n}",
          "includes": [
            "#include <linux/of_reserved_mem.h>",
            "#include <linux/of_fdt.h>",
            "#include <linux/of.h>",
            "#include <linux/dma-mapping.h>",
            "#include <linux/module.h>",
            "#include <linux/kernel.h>",
            "#include <linux/slab.h>",
            "#include <linux/io.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-mapping.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nstatic inline struct dma_coherent_mem *dev_get_coherent_memory(struct device *dev)\n{\n\tif (dev && dev->dma_mem)\n\t\treturn dev->dma_mem;\n\treturn NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-mapping.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nint dma_alloc_from_dev_coherent(struct device *dev, ssize_t size,\n\t\tdma_addr_t *dma_handle, void **ret)\n{\n\tstruct dma_coherent_mem *mem = dev_get_coherent_memory(dev);\n\n\tif (!mem)\n\t\treturn 0;\n\n\t*ret = __dma_alloc_from_coherent(mem, size, dma_handle);\n\tif (*ret)\n\t\treturn 1;\n\n\t/*\n\t * In the case where the allocation can not be satisfied from the\n\t * per-device area, try to fall back to generic memory if the\n\t * constraints allow it.\n\t */\n\treturn mem->flags & DMA_MEMORY_EXCLUSIVE;\n}"
  },
  {
    "function_name": "__dma_alloc_from_coherent",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18955/repo/kernel/dma/coherent.c",
    "lines": "163-191",
    "snippet": "static void *__dma_alloc_from_coherent(struct dma_coherent_mem *mem,\n\t\tssize_t size, dma_addr_t *dma_handle)\n{\n\tint order = get_order(size);\n\tunsigned long flags;\n\tint pageno;\n\tvoid *ret;\n\n\tspin_lock_irqsave(&mem->spinlock, flags);\n\n\tif (unlikely(size > (mem->size << PAGE_SHIFT)))\n\t\tgoto err;\n\n\tpageno = bitmap_find_free_region(mem->bitmap, mem->size, order);\n\tif (unlikely(pageno < 0))\n\t\tgoto err;\n\n\t/*\n\t * Memory was found in the coherent area.\n\t */\n\t*dma_handle = mem->device_base + (pageno << PAGE_SHIFT);\n\tret = mem->virt_base + (pageno << PAGE_SHIFT);\n\tspin_unlock_irqrestore(&mem->spinlock, flags);\n\tmemset(ret, 0, size);\n\treturn ret;\nerr:\n\tspin_unlock_irqrestore(&mem->spinlock, flags);\n\treturn NULL;\n}",
    "includes": [
      "#include <linux/of_reserved_mem.h>",
      "#include <linux/of_fdt.h>",
      "#include <linux/of.h>",
      "#include <linux/dma-mapping.h>",
      "#include <linux/module.h>",
      "#include <linux/kernel.h>",
      "#include <linux/slab.h>",
      "#include <linux/io.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "spin_unlock_irqrestore",
          "args": [
            "&mem->spinlock",
            "flags"
          ],
          "line": 189
        },
        "resolved": true,
        "details": {
          "function_name": "_raw_spin_unlock_irqrestore",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18955/repo/kernel/locking/spinlock.c",
          "lines": "182-185",
          "snippet": "void __lockfunc _raw_spin_unlock_irqrestore(raw_spinlock_t *lock, unsigned long flags)\n{\n\t__raw_spin_unlock_irqrestore(lock, flags);\n}",
          "includes": [
            "#include <linux/export.h>",
            "#include <linux/debug_locks.h>",
            "#include <linux/interrupt.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/preempt.h>",
            "#include <linux/linkage.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/export.h>\n#include <linux/debug_locks.h>\n#include <linux/interrupt.h>\n#include <linux/spinlock.h>\n#include <linux/preempt.h>\n#include <linux/linkage.h>\n\nvoid __lockfunc _raw_spin_unlock_irqrestore(raw_spinlock_t *lock, unsigned long flags)\n{\n\t__raw_spin_unlock_irqrestore(lock, flags);\n}"
        }
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "ret",
            "0",
            "size"
          ],
          "line": 186
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "unlikely",
          "args": [
            "pageno < 0"
          ],
          "line": 177
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bitmap_find_free_region",
          "args": [
            "mem->bitmap",
            "mem->size",
            "order"
          ],
          "line": 176
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "unlikely",
          "args": [
            "size > (mem->size << PAGE_SHIFT)"
          ],
          "line": 173
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "spin_lock_irqsave",
          "args": [
            "&mem->spinlock",
            "flags"
          ],
          "line": 171
        },
        "resolved": true,
        "details": {
          "function_name": "_raw_spin_lock_irqsave_nested",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18955/repo/kernel/locking/spinlock.c",
          "lines": "359-370",
          "snippet": "unsigned long __lockfunc _raw_spin_lock_irqsave_nested(raw_spinlock_t *lock,\n\t\t\t\t\t\t   int subclass)\n{\n\tunsigned long flags;\n\n\tlocal_irq_save(flags);\n\tpreempt_disable();\n\tspin_acquire(&lock->dep_map, subclass, 0, _RET_IP_);\n\tLOCK_CONTENDED_FLAGS(lock, do_raw_spin_trylock, do_raw_spin_lock,\n\t\t\t\tdo_raw_spin_lock_flags, &flags);\n\treturn flags;\n}",
          "includes": [
            "#include <linux/export.h>",
            "#include <linux/debug_locks.h>",
            "#include <linux/interrupt.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/preempt.h>",
            "#include <linux/linkage.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/export.h>\n#include <linux/debug_locks.h>\n#include <linux/interrupt.h>\n#include <linux/spinlock.h>\n#include <linux/preempt.h>\n#include <linux/linkage.h>\n\nunsigned long __lockfunc _raw_spin_lock_irqsave_nested(raw_spinlock_t *lock,\n\t\t\t\t\t\t   int subclass)\n{\n\tunsigned long flags;\n\n\tlocal_irq_save(flags);\n\tpreempt_disable();\n\tspin_acquire(&lock->dep_map, subclass, 0, _RET_IP_);\n\tLOCK_CONTENDED_FLAGS(lock, do_raw_spin_trylock, do_raw_spin_lock,\n\t\t\t\tdo_raw_spin_lock_flags, &flags);\n\treturn flags;\n}"
        }
      },
      {
        "call_info": {
          "callee": "get_order",
          "args": [
            "size"
          ],
          "line": 166
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-mapping.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nstatic void *__dma_alloc_from_coherent(struct dma_coherent_mem *mem,\n\t\tssize_t size, dma_addr_t *dma_handle)\n{\n\tint order = get_order(size);\n\tunsigned long flags;\n\tint pageno;\n\tvoid *ret;\n\n\tspin_lock_irqsave(&mem->spinlock, flags);\n\n\tif (unlikely(size > (mem->size << PAGE_SHIFT)))\n\t\tgoto err;\n\n\tpageno = bitmap_find_free_region(mem->bitmap, mem->size, order);\n\tif (unlikely(pageno < 0))\n\t\tgoto err;\n\n\t/*\n\t * Memory was found in the coherent area.\n\t */\n\t*dma_handle = mem->device_base + (pageno << PAGE_SHIFT);\n\tret = mem->virt_base + (pageno << PAGE_SHIFT);\n\tspin_unlock_irqrestore(&mem->spinlock, flags);\n\tmemset(ret, 0, size);\n\treturn ret;\nerr:\n\tspin_unlock_irqrestore(&mem->spinlock, flags);\n\treturn NULL;\n}"
  },
  {
    "function_name": "dma_mark_declared_memory_occupied",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18955/repo/kernel/dma/coherent.c",
    "lines": "140-160",
    "snippet": "void *dma_mark_declared_memory_occupied(struct device *dev,\n\t\t\t\t\tdma_addr_t device_addr, size_t size)\n{\n\tstruct dma_coherent_mem *mem = dev->dma_mem;\n\tunsigned long flags;\n\tint pos, err;\n\n\tsize += device_addr & ~PAGE_MASK;\n\n\tif (!mem)\n\t\treturn ERR_PTR(-EINVAL);\n\n\tspin_lock_irqsave(&mem->spinlock, flags);\n\tpos = PFN_DOWN(device_addr - dma_get_device_base(dev, mem));\n\terr = bitmap_allocate_region(mem->bitmap, pos, get_order(size));\n\tspin_unlock_irqrestore(&mem->spinlock, flags);\n\n\tif (err != 0)\n\t\treturn ERR_PTR(err);\n\treturn mem->virt_base + (pos << PAGE_SHIFT);\n}",
    "includes": [
      "#include <linux/of_reserved_mem.h>",
      "#include <linux/of_fdt.h>",
      "#include <linux/of.h>",
      "#include <linux/dma-mapping.h>",
      "#include <linux/module.h>",
      "#include <linux/kernel.h>",
      "#include <linux/slab.h>",
      "#include <linux/io.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ERR_PTR",
          "args": [
            "err"
          ],
          "line": 158
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "spin_unlock_irqrestore",
          "args": [
            "&mem->spinlock",
            "flags"
          ],
          "line": 155
        },
        "resolved": true,
        "details": {
          "function_name": "_raw_spin_unlock_irqrestore",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18955/repo/kernel/locking/spinlock.c",
          "lines": "182-185",
          "snippet": "void __lockfunc _raw_spin_unlock_irqrestore(raw_spinlock_t *lock, unsigned long flags)\n{\n\t__raw_spin_unlock_irqrestore(lock, flags);\n}",
          "includes": [
            "#include <linux/export.h>",
            "#include <linux/debug_locks.h>",
            "#include <linux/interrupt.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/preempt.h>",
            "#include <linux/linkage.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/export.h>\n#include <linux/debug_locks.h>\n#include <linux/interrupt.h>\n#include <linux/spinlock.h>\n#include <linux/preempt.h>\n#include <linux/linkage.h>\n\nvoid __lockfunc _raw_spin_unlock_irqrestore(raw_spinlock_t *lock, unsigned long flags)\n{\n\t__raw_spin_unlock_irqrestore(lock, flags);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bitmap_allocate_region",
          "args": [
            "mem->bitmap",
            "pos",
            "get_order(size)"
          ],
          "line": 154
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_order",
          "args": [
            "size"
          ],
          "line": 154
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "PFN_DOWN",
          "args": [
            "device_addr - dma_get_device_base(dev, mem)"
          ],
          "line": 153
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dma_get_device_base",
          "args": [
            "dev",
            "mem"
          ],
          "line": 153
        },
        "resolved": true,
        "details": {
          "function_name": "dma_get_device_base",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18955/repo/kernel/dma/coherent.c",
          "lines": "32-39",
          "snippet": "static inline dma_addr_t dma_get_device_base(struct device *dev,\n\t\t\t\t\t     struct dma_coherent_mem * mem)\n{\n\tif (mem->use_dev_dma_pfn_offset)\n\t\treturn (mem->pfn_base - dev->dma_pfn_offset) << PAGE_SHIFT;\n\telse\n\t\treturn mem->device_base;\n}",
          "includes": [
            "#include <linux/of_reserved_mem.h>",
            "#include <linux/of_fdt.h>",
            "#include <linux/of.h>",
            "#include <linux/dma-mapping.h>",
            "#include <linux/module.h>",
            "#include <linux/kernel.h>",
            "#include <linux/slab.h>",
            "#include <linux/io.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-mapping.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nstatic inline dma_addr_t dma_get_device_base(struct device *dev,\n\t\t\t\t\t     struct dma_coherent_mem * mem)\n{\n\tif (mem->use_dev_dma_pfn_offset)\n\t\treturn (mem->pfn_base - dev->dma_pfn_offset) << PAGE_SHIFT;\n\telse\n\t\treturn mem->device_base;\n}"
        }
      },
      {
        "call_info": {
          "callee": "spin_lock_irqsave",
          "args": [
            "&mem->spinlock",
            "flags"
          ],
          "line": 152
        },
        "resolved": true,
        "details": {
          "function_name": "_raw_spin_lock_irqsave_nested",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18955/repo/kernel/locking/spinlock.c",
          "lines": "359-370",
          "snippet": "unsigned long __lockfunc _raw_spin_lock_irqsave_nested(raw_spinlock_t *lock,\n\t\t\t\t\t\t   int subclass)\n{\n\tunsigned long flags;\n\n\tlocal_irq_save(flags);\n\tpreempt_disable();\n\tspin_acquire(&lock->dep_map, subclass, 0, _RET_IP_);\n\tLOCK_CONTENDED_FLAGS(lock, do_raw_spin_trylock, do_raw_spin_lock,\n\t\t\t\tdo_raw_spin_lock_flags, &flags);\n\treturn flags;\n}",
          "includes": [
            "#include <linux/export.h>",
            "#include <linux/debug_locks.h>",
            "#include <linux/interrupt.h>",
            "#include <linux/spinlock.h>",
            "#include <linux/preempt.h>",
            "#include <linux/linkage.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/export.h>\n#include <linux/debug_locks.h>\n#include <linux/interrupt.h>\n#include <linux/spinlock.h>\n#include <linux/preempt.h>\n#include <linux/linkage.h>\n\nunsigned long __lockfunc _raw_spin_lock_irqsave_nested(raw_spinlock_t *lock,\n\t\t\t\t\t\t   int subclass)\n{\n\tunsigned long flags;\n\n\tlocal_irq_save(flags);\n\tpreempt_disable();\n\tspin_acquire(&lock->dep_map, subclass, 0, _RET_IP_);\n\tLOCK_CONTENDED_FLAGS(lock, do_raw_spin_trylock, do_raw_spin_lock,\n\t\t\t\tdo_raw_spin_lock_flags, &flags);\n\treturn flags;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ERR_PTR",
          "args": [
            "-EINVAL"
          ],
          "line": 150
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-mapping.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nvoid *dma_mark_declared_memory_occupied(struct device *dev,\n\t\t\t\t\tdma_addr_t device_addr, size_t size)\n{\n\tstruct dma_coherent_mem *mem = dev->dma_mem;\n\tunsigned long flags;\n\tint pos, err;\n\n\tsize += device_addr & ~PAGE_MASK;\n\n\tif (!mem)\n\t\treturn ERR_PTR(-EINVAL);\n\n\tspin_lock_irqsave(&mem->spinlock, flags);\n\tpos = PFN_DOWN(device_addr - dma_get_device_base(dev, mem));\n\terr = bitmap_allocate_region(mem->bitmap, pos, get_order(size));\n\tspin_unlock_irqrestore(&mem->spinlock, flags);\n\n\tif (err != 0)\n\t\treturn ERR_PTR(err);\n\treturn mem->virt_base + (pos << PAGE_SHIFT);\n}"
  },
  {
    "function_name": "dma_release_declared_memory",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18955/repo/kernel/dma/coherent.c",
    "lines": "129-137",
    "snippet": "void dma_release_declared_memory(struct device *dev)\n{\n\tstruct dma_coherent_mem *mem = dev->dma_mem;\n\n\tif (!mem)\n\t\treturn;\n\tdma_release_coherent_memory(mem);\n\tdev->dma_mem = NULL;\n}",
    "includes": [
      "#include <linux/of_reserved_mem.h>",
      "#include <linux/of_fdt.h>",
      "#include <linux/of.h>",
      "#include <linux/dma-mapping.h>",
      "#include <linux/module.h>",
      "#include <linux/kernel.h>",
      "#include <linux/slab.h>",
      "#include <linux/io.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dma_release_coherent_memory",
          "args": [
            "mem"
          ],
          "line": 135
        },
        "resolved": true,
        "details": {
          "function_name": "dma_release_coherent_memory",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18955/repo/kernel/dma/coherent.c",
          "lines": "89-97",
          "snippet": "static void dma_release_coherent_memory(struct dma_coherent_mem *mem)\n{\n\tif (!mem)\n\t\treturn;\n\n\tmemunmap(mem->virt_base);\n\tkfree(mem->bitmap);\n\tkfree(mem);\n}",
          "includes": [
            "#include <linux/of_reserved_mem.h>",
            "#include <linux/of_fdt.h>",
            "#include <linux/of.h>",
            "#include <linux/dma-mapping.h>",
            "#include <linux/module.h>",
            "#include <linux/kernel.h>",
            "#include <linux/slab.h>",
            "#include <linux/io.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-mapping.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nstatic void dma_release_coherent_memory(struct dma_coherent_mem *mem)\n{\n\tif (!mem)\n\t\treturn;\n\n\tmemunmap(mem->virt_base);\n\tkfree(mem->bitmap);\n\tkfree(mem);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-mapping.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nvoid dma_release_declared_memory(struct device *dev)\n{\n\tstruct dma_coherent_mem *mem = dev->dma_mem;\n\n\tif (!mem)\n\t\treturn;\n\tdma_release_coherent_memory(mem);\n\tdev->dma_mem = NULL;\n}"
  },
  {
    "function_name": "dma_declare_coherent_memory",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18955/repo/kernel/dma/coherent.c",
    "lines": "112-126",
    "snippet": "int dma_declare_coherent_memory(struct device *dev, phys_addr_t phys_addr,\n\t\t\t\tdma_addr_t device_addr, size_t size, int flags)\n{\n\tstruct dma_coherent_mem *mem;\n\tint ret;\n\n\tret = dma_init_coherent_memory(phys_addr, device_addr, size, flags, &mem);\n\tif (ret)\n\t\treturn ret;\n\n\tret = dma_assign_coherent_memory(dev, mem);\n\tif (ret)\n\t\tdma_release_coherent_memory(mem);\n\treturn ret;\n}",
    "includes": [
      "#include <linux/of_reserved_mem.h>",
      "#include <linux/of_fdt.h>",
      "#include <linux/of.h>",
      "#include <linux/dma-mapping.h>",
      "#include <linux/module.h>",
      "#include <linux/kernel.h>",
      "#include <linux/slab.h>",
      "#include <linux/io.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dma_release_coherent_memory",
          "args": [
            "mem"
          ],
          "line": 124
        },
        "resolved": true,
        "details": {
          "function_name": "dma_release_coherent_memory",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18955/repo/kernel/dma/coherent.c",
          "lines": "89-97",
          "snippet": "static void dma_release_coherent_memory(struct dma_coherent_mem *mem)\n{\n\tif (!mem)\n\t\treturn;\n\n\tmemunmap(mem->virt_base);\n\tkfree(mem->bitmap);\n\tkfree(mem);\n}",
          "includes": [
            "#include <linux/of_reserved_mem.h>",
            "#include <linux/of_fdt.h>",
            "#include <linux/of.h>",
            "#include <linux/dma-mapping.h>",
            "#include <linux/module.h>",
            "#include <linux/kernel.h>",
            "#include <linux/slab.h>",
            "#include <linux/io.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-mapping.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nstatic void dma_release_coherent_memory(struct dma_coherent_mem *mem)\n{\n\tif (!mem)\n\t\treturn;\n\n\tmemunmap(mem->virt_base);\n\tkfree(mem->bitmap);\n\tkfree(mem);\n}"
        }
      },
      {
        "call_info": {
          "callee": "dma_assign_coherent_memory",
          "args": [
            "dev",
            "mem"
          ],
          "line": 122
        },
        "resolved": true,
        "details": {
          "function_name": "dma_assign_coherent_memory",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18955/repo/kernel/dma/coherent.c",
          "lines": "99-110",
          "snippet": "static int dma_assign_coherent_memory(struct device *dev,\n\t\t\t\t      struct dma_coherent_mem *mem)\n{\n\tif (!dev)\n\t\treturn -ENODEV;\n\n\tif (dev->dma_mem)\n\t\treturn -EBUSY;\n\n\tdev->dma_mem = mem;\n\treturn 0;\n}",
          "includes": [
            "#include <linux/of_reserved_mem.h>",
            "#include <linux/of_fdt.h>",
            "#include <linux/of.h>",
            "#include <linux/dma-mapping.h>",
            "#include <linux/module.h>",
            "#include <linux/kernel.h>",
            "#include <linux/slab.h>",
            "#include <linux/io.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-mapping.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nstatic int dma_assign_coherent_memory(struct device *dev,\n\t\t\t\t      struct dma_coherent_mem *mem)\n{\n\tif (!dev)\n\t\treturn -ENODEV;\n\n\tif (dev->dma_mem)\n\t\treturn -EBUSY;\n\n\tdev->dma_mem = mem;\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dma_init_coherent_memory",
          "args": [
            "phys_addr",
            "device_addr",
            "size",
            "flags",
            "&mem"
          ],
          "line": 118
        },
        "resolved": true,
        "details": {
          "function_name": "dma_init_coherent_memory",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18955/repo/kernel/dma/coherent.c",
          "lines": "41-87",
          "snippet": "static int dma_init_coherent_memory(\n\tphys_addr_t phys_addr, dma_addr_t device_addr, size_t size, int flags,\n\tstruct dma_coherent_mem **mem)\n{\n\tstruct dma_coherent_mem *dma_mem = NULL;\n\tvoid __iomem *mem_base = NULL;\n\tint pages = size >> PAGE_SHIFT;\n\tint bitmap_size = BITS_TO_LONGS(pages) * sizeof(long);\n\tint ret;\n\n\tif (!size) {\n\t\tret = -EINVAL;\n\t\tgoto out;\n\t}\n\n\tmem_base = memremap(phys_addr, size, MEMREMAP_WC);\n\tif (!mem_base) {\n\t\tret = -EINVAL;\n\t\tgoto out;\n\t}\n\tdma_mem = kzalloc(sizeof(struct dma_coherent_mem), GFP_KERNEL);\n\tif (!dma_mem) {\n\t\tret = -ENOMEM;\n\t\tgoto out;\n\t}\n\tdma_mem->bitmap = kzalloc(bitmap_size, GFP_KERNEL);\n\tif (!dma_mem->bitmap) {\n\t\tret = -ENOMEM;\n\t\tgoto out;\n\t}\n\n\tdma_mem->virt_base = mem_base;\n\tdma_mem->device_base = device_addr;\n\tdma_mem->pfn_base = PFN_DOWN(phys_addr);\n\tdma_mem->size = pages;\n\tdma_mem->flags = flags;\n\tspin_lock_init(&dma_mem->spinlock);\n\n\t*mem = dma_mem;\n\treturn 0;\n\nout:\n\tkfree(dma_mem);\n\tif (mem_base)\n\t\tmemunmap(mem_base);\n\treturn ret;\n}",
          "includes": [
            "#include <linux/of_reserved_mem.h>",
            "#include <linux/of_fdt.h>",
            "#include <linux/of.h>",
            "#include <linux/dma-mapping.h>",
            "#include <linux/module.h>",
            "#include <linux/kernel.h>",
            "#include <linux/slab.h>",
            "#include <linux/io.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-mapping.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nstatic int dma_init_coherent_memory(\n\tphys_addr_t phys_addr, dma_addr_t device_addr, size_t size, int flags,\n\tstruct dma_coherent_mem **mem)\n{\n\tstruct dma_coherent_mem *dma_mem = NULL;\n\tvoid __iomem *mem_base = NULL;\n\tint pages = size >> PAGE_SHIFT;\n\tint bitmap_size = BITS_TO_LONGS(pages) * sizeof(long);\n\tint ret;\n\n\tif (!size) {\n\t\tret = -EINVAL;\n\t\tgoto out;\n\t}\n\n\tmem_base = memremap(phys_addr, size, MEMREMAP_WC);\n\tif (!mem_base) {\n\t\tret = -EINVAL;\n\t\tgoto out;\n\t}\n\tdma_mem = kzalloc(sizeof(struct dma_coherent_mem), GFP_KERNEL);\n\tif (!dma_mem) {\n\t\tret = -ENOMEM;\n\t\tgoto out;\n\t}\n\tdma_mem->bitmap = kzalloc(bitmap_size, GFP_KERNEL);\n\tif (!dma_mem->bitmap) {\n\t\tret = -ENOMEM;\n\t\tgoto out;\n\t}\n\n\tdma_mem->virt_base = mem_base;\n\tdma_mem->device_base = device_addr;\n\tdma_mem->pfn_base = PFN_DOWN(phys_addr);\n\tdma_mem->size = pages;\n\tdma_mem->flags = flags;\n\tspin_lock_init(&dma_mem->spinlock);\n\n\t*mem = dma_mem;\n\treturn 0;\n\nout:\n\tkfree(dma_mem);\n\tif (mem_base)\n\t\tmemunmap(mem_base);\n\treturn ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-mapping.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nint dma_declare_coherent_memory(struct device *dev, phys_addr_t phys_addr,\n\t\t\t\tdma_addr_t device_addr, size_t size, int flags)\n{\n\tstruct dma_coherent_mem *mem;\n\tint ret;\n\n\tret = dma_init_coherent_memory(phys_addr, device_addr, size, flags, &mem);\n\tif (ret)\n\t\treturn ret;\n\n\tret = dma_assign_coherent_memory(dev, mem);\n\tif (ret)\n\t\tdma_release_coherent_memory(mem);\n\treturn ret;\n}"
  },
  {
    "function_name": "dma_assign_coherent_memory",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18955/repo/kernel/dma/coherent.c",
    "lines": "99-110",
    "snippet": "static int dma_assign_coherent_memory(struct device *dev,\n\t\t\t\t      struct dma_coherent_mem *mem)\n{\n\tif (!dev)\n\t\treturn -ENODEV;\n\n\tif (dev->dma_mem)\n\t\treturn -EBUSY;\n\n\tdev->dma_mem = mem;\n\treturn 0;\n}",
    "includes": [
      "#include <linux/of_reserved_mem.h>",
      "#include <linux/of_fdt.h>",
      "#include <linux/of.h>",
      "#include <linux/dma-mapping.h>",
      "#include <linux/module.h>",
      "#include <linux/kernel.h>",
      "#include <linux/slab.h>",
      "#include <linux/io.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-mapping.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nstatic int dma_assign_coherent_memory(struct device *dev,\n\t\t\t\t      struct dma_coherent_mem *mem)\n{\n\tif (!dev)\n\t\treturn -ENODEV;\n\n\tif (dev->dma_mem)\n\t\treturn -EBUSY;\n\n\tdev->dma_mem = mem;\n\treturn 0;\n}"
  },
  {
    "function_name": "dma_release_coherent_memory",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18955/repo/kernel/dma/coherent.c",
    "lines": "89-97",
    "snippet": "static void dma_release_coherent_memory(struct dma_coherent_mem *mem)\n{\n\tif (!mem)\n\t\treturn;\n\n\tmemunmap(mem->virt_base);\n\tkfree(mem->bitmap);\n\tkfree(mem);\n}",
    "includes": [
      "#include <linux/of_reserved_mem.h>",
      "#include <linux/of_fdt.h>",
      "#include <linux/of.h>",
      "#include <linux/dma-mapping.h>",
      "#include <linux/module.h>",
      "#include <linux/kernel.h>",
      "#include <linux/slab.h>",
      "#include <linux/io.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "kfree",
          "args": [
            "mem"
          ],
          "line": 96
        },
        "resolved": true,
        "details": {
          "function_name": "maybe_kfree_parameter",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18955/repo/kernel/params.c",
          "lines": "73-86",
          "snippet": "static void maybe_kfree_parameter(void *param)\n{\n\tstruct kmalloced_param *p;\n\n\tspin_lock(&kmalloced_params_lock);\n\tlist_for_each_entry(p, &kmalloced_params, list) {\n\t\tif (p->val == param) {\n\t\t\tlist_del(&p->list);\n\t\t\tkfree(p);\n\t\t\tbreak;\n\t\t}\n\t}\n\tspin_unlock(&kmalloced_params_lock);\n}",
          "includes": [
            "#include <linux/ctype.h>",
            "#include <linux/slab.h>",
            "#include <linux/err.h>",
            "#include <linux/device.h>",
            "#include <linux/moduleparam.h>",
            "#include <linux/module.h>",
            "#include <linux/errno.h>",
            "#include <linux/string.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static LIST_HEAD(kmalloced_params);",
            "static DEFINE_SPINLOCK(kmalloced_params_lock);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <linux/ctype.h>\n#include <linux/slab.h>\n#include <linux/err.h>\n#include <linux/device.h>\n#include <linux/moduleparam.h>\n#include <linux/module.h>\n#include <linux/errno.h>\n#include <linux/string.h>\n#include <linux/kernel.h>\n\nstatic LIST_HEAD(kmalloced_params);\nstatic DEFINE_SPINLOCK(kmalloced_params_lock);\n\nstatic void maybe_kfree_parameter(void *param)\n{\n\tstruct kmalloced_param *p;\n\n\tspin_lock(&kmalloced_params_lock);\n\tlist_for_each_entry(p, &kmalloced_params, list) {\n\t\tif (p->val == param) {\n\t\t\tlist_del(&p->list);\n\t\t\tkfree(p);\n\t\t\tbreak;\n\t\t}\n\t}\n\tspin_unlock(&kmalloced_params_lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "memunmap",
          "args": [
            "mem->virt_base"
          ],
          "line": 94
        },
        "resolved": true,
        "details": {
          "function_name": "memunmap",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18955/repo/kernel/iomem.c",
          "lines": "122-126",
          "snippet": "void memunmap(void *addr)\n{\n\tif (is_vmalloc_addr(addr))\n\t\tiounmap((void __iomem *) addr);\n}",
          "includes": [
            "#include <linux/mm.h>",
            "#include <linux/io.h>",
            "#include <linux/types.h>",
            "#include <linux/device.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/mm.h>\n#include <linux/io.h>\n#include <linux/types.h>\n#include <linux/device.h>\n\nvoid memunmap(void *addr)\n{\n\tif (is_vmalloc_addr(addr))\n\t\tiounmap((void __iomem *) addr);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-mapping.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nstatic void dma_release_coherent_memory(struct dma_coherent_mem *mem)\n{\n\tif (!mem)\n\t\treturn;\n\n\tmemunmap(mem->virt_base);\n\tkfree(mem->bitmap);\n\tkfree(mem);\n}"
  },
  {
    "function_name": "dma_init_coherent_memory",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18955/repo/kernel/dma/coherent.c",
    "lines": "41-87",
    "snippet": "static int dma_init_coherent_memory(\n\tphys_addr_t phys_addr, dma_addr_t device_addr, size_t size, int flags,\n\tstruct dma_coherent_mem **mem)\n{\n\tstruct dma_coherent_mem *dma_mem = NULL;\n\tvoid __iomem *mem_base = NULL;\n\tint pages = size >> PAGE_SHIFT;\n\tint bitmap_size = BITS_TO_LONGS(pages) * sizeof(long);\n\tint ret;\n\n\tif (!size) {\n\t\tret = -EINVAL;\n\t\tgoto out;\n\t}\n\n\tmem_base = memremap(phys_addr, size, MEMREMAP_WC);\n\tif (!mem_base) {\n\t\tret = -EINVAL;\n\t\tgoto out;\n\t}\n\tdma_mem = kzalloc(sizeof(struct dma_coherent_mem), GFP_KERNEL);\n\tif (!dma_mem) {\n\t\tret = -ENOMEM;\n\t\tgoto out;\n\t}\n\tdma_mem->bitmap = kzalloc(bitmap_size, GFP_KERNEL);\n\tif (!dma_mem->bitmap) {\n\t\tret = -ENOMEM;\n\t\tgoto out;\n\t}\n\n\tdma_mem->virt_base = mem_base;\n\tdma_mem->device_base = device_addr;\n\tdma_mem->pfn_base = PFN_DOWN(phys_addr);\n\tdma_mem->size = pages;\n\tdma_mem->flags = flags;\n\tspin_lock_init(&dma_mem->spinlock);\n\n\t*mem = dma_mem;\n\treturn 0;\n\nout:\n\tkfree(dma_mem);\n\tif (mem_base)\n\t\tmemunmap(mem_base);\n\treturn ret;\n}",
    "includes": [
      "#include <linux/of_reserved_mem.h>",
      "#include <linux/of_fdt.h>",
      "#include <linux/of.h>",
      "#include <linux/dma-mapping.h>",
      "#include <linux/module.h>",
      "#include <linux/kernel.h>",
      "#include <linux/slab.h>",
      "#include <linux/io.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "memunmap",
          "args": [
            "mem_base"
          ],
          "line": 85
        },
        "resolved": true,
        "details": {
          "function_name": "memunmap",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18955/repo/kernel/iomem.c",
          "lines": "122-126",
          "snippet": "void memunmap(void *addr)\n{\n\tif (is_vmalloc_addr(addr))\n\t\tiounmap((void __iomem *) addr);\n}",
          "includes": [
            "#include <linux/mm.h>",
            "#include <linux/io.h>",
            "#include <linux/types.h>",
            "#include <linux/device.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/mm.h>\n#include <linux/io.h>\n#include <linux/types.h>\n#include <linux/device.h>\n\nvoid memunmap(void *addr)\n{\n\tif (is_vmalloc_addr(addr))\n\t\tiounmap((void __iomem *) addr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "kfree",
          "args": [
            "dma_mem"
          ],
          "line": 83
        },
        "resolved": true,
        "details": {
          "function_name": "maybe_kfree_parameter",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18955/repo/kernel/params.c",
          "lines": "73-86",
          "snippet": "static void maybe_kfree_parameter(void *param)\n{\n\tstruct kmalloced_param *p;\n\n\tspin_lock(&kmalloced_params_lock);\n\tlist_for_each_entry(p, &kmalloced_params, list) {\n\t\tif (p->val == param) {\n\t\t\tlist_del(&p->list);\n\t\t\tkfree(p);\n\t\t\tbreak;\n\t\t}\n\t}\n\tspin_unlock(&kmalloced_params_lock);\n}",
          "includes": [
            "#include <linux/ctype.h>",
            "#include <linux/slab.h>",
            "#include <linux/err.h>",
            "#include <linux/device.h>",
            "#include <linux/moduleparam.h>",
            "#include <linux/module.h>",
            "#include <linux/errno.h>",
            "#include <linux/string.h>",
            "#include <linux/kernel.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static LIST_HEAD(kmalloced_params);",
            "static DEFINE_SPINLOCK(kmalloced_params_lock);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <linux/ctype.h>\n#include <linux/slab.h>\n#include <linux/err.h>\n#include <linux/device.h>\n#include <linux/moduleparam.h>\n#include <linux/module.h>\n#include <linux/errno.h>\n#include <linux/string.h>\n#include <linux/kernel.h>\n\nstatic LIST_HEAD(kmalloced_params);\nstatic DEFINE_SPINLOCK(kmalloced_params_lock);\n\nstatic void maybe_kfree_parameter(void *param)\n{\n\tstruct kmalloced_param *p;\n\n\tspin_lock(&kmalloced_params_lock);\n\tlist_for_each_entry(p, &kmalloced_params, list) {\n\t\tif (p->val == param) {\n\t\t\tlist_del(&p->list);\n\t\t\tkfree(p);\n\t\t\tbreak;\n\t\t}\n\t}\n\tspin_unlock(&kmalloced_params_lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "spin_lock_init",
          "args": [
            "&dma_mem->spinlock"
          ],
          "line": 77
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "PFN_DOWN",
          "args": [
            "phys_addr"
          ],
          "line": 74
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kzalloc",
          "args": [
            "bitmap_size",
            "GFP_KERNEL"
          ],
          "line": 66
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kzalloc",
          "args": [
            "sizeof(struct dma_coherent_mem)",
            "GFP_KERNEL"
          ],
          "line": 61
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memremap",
          "args": [
            "phys_addr",
            "size",
            "MEMREMAP_WC"
          ],
          "line": 56
        },
        "resolved": true,
        "details": {
          "function_name": "devm_memremap_match",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18955/repo/kernel/iomem.c",
          "lines": "134-137",
          "snippet": "static int devm_memremap_match(struct device *dev, void *res, void *match_data)\n{\n\treturn *(void **)res == match_data;\n}",
          "includes": [
            "#include <linux/mm.h>",
            "#include <linux/io.h>",
            "#include <linux/types.h>",
            "#include <linux/device.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/mm.h>\n#include <linux/io.h>\n#include <linux/types.h>\n#include <linux/device.h>\n\nstatic int devm_memremap_match(struct device *dev, void *res, void *match_data)\n{\n\treturn *(void **)res == match_data;\n}"
        }
      },
      {
        "call_info": {
          "callee": "BITS_TO_LONGS",
          "args": [
            "pages"
          ],
          "line": 48
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-mapping.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nstatic int dma_init_coherent_memory(\n\tphys_addr_t phys_addr, dma_addr_t device_addr, size_t size, int flags,\n\tstruct dma_coherent_mem **mem)\n{\n\tstruct dma_coherent_mem *dma_mem = NULL;\n\tvoid __iomem *mem_base = NULL;\n\tint pages = size >> PAGE_SHIFT;\n\tint bitmap_size = BITS_TO_LONGS(pages) * sizeof(long);\n\tint ret;\n\n\tif (!size) {\n\t\tret = -EINVAL;\n\t\tgoto out;\n\t}\n\n\tmem_base = memremap(phys_addr, size, MEMREMAP_WC);\n\tif (!mem_base) {\n\t\tret = -EINVAL;\n\t\tgoto out;\n\t}\n\tdma_mem = kzalloc(sizeof(struct dma_coherent_mem), GFP_KERNEL);\n\tif (!dma_mem) {\n\t\tret = -ENOMEM;\n\t\tgoto out;\n\t}\n\tdma_mem->bitmap = kzalloc(bitmap_size, GFP_KERNEL);\n\tif (!dma_mem->bitmap) {\n\t\tret = -ENOMEM;\n\t\tgoto out;\n\t}\n\n\tdma_mem->virt_base = mem_base;\n\tdma_mem->device_base = device_addr;\n\tdma_mem->pfn_base = PFN_DOWN(phys_addr);\n\tdma_mem->size = pages;\n\tdma_mem->flags = flags;\n\tspin_lock_init(&dma_mem->spinlock);\n\n\t*mem = dma_mem;\n\treturn 0;\n\nout:\n\tkfree(dma_mem);\n\tif (mem_base)\n\t\tmemunmap(mem_base);\n\treturn ret;\n}"
  },
  {
    "function_name": "dma_get_device_base",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18955/repo/kernel/dma/coherent.c",
    "lines": "32-39",
    "snippet": "static inline dma_addr_t dma_get_device_base(struct device *dev,\n\t\t\t\t\t     struct dma_coherent_mem * mem)\n{\n\tif (mem->use_dev_dma_pfn_offset)\n\t\treturn (mem->pfn_base - dev->dma_pfn_offset) << PAGE_SHIFT;\n\telse\n\t\treturn mem->device_base;\n}",
    "includes": [
      "#include <linux/of_reserved_mem.h>",
      "#include <linux/of_fdt.h>",
      "#include <linux/of.h>",
      "#include <linux/dma-mapping.h>",
      "#include <linux/module.h>",
      "#include <linux/kernel.h>",
      "#include <linux/slab.h>",
      "#include <linux/io.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-mapping.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nstatic inline dma_addr_t dma_get_device_base(struct device *dev,\n\t\t\t\t\t     struct dma_coherent_mem * mem)\n{\n\tif (mem->use_dev_dma_pfn_offset)\n\t\treturn (mem->pfn_base - dev->dma_pfn_offset) << PAGE_SHIFT;\n\telse\n\t\treturn mem->device_base;\n}"
  },
  {
    "function_name": "dev_get_coherent_memory",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18955/repo/kernel/dma/coherent.c",
    "lines": "25-30",
    "snippet": "static inline struct dma_coherent_mem *dev_get_coherent_memory(struct device *dev)\n{\n\tif (dev && dev->dma_mem)\n\t\treturn dev->dma_mem;\n\treturn NULL;\n}",
    "includes": [
      "#include <linux/of_reserved_mem.h>",
      "#include <linux/of_fdt.h>",
      "#include <linux/of.h>",
      "#include <linux/dma-mapping.h>",
      "#include <linux/module.h>",
      "#include <linux/kernel.h>",
      "#include <linux/slab.h>",
      "#include <linux/io.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include <linux/of_reserved_mem.h>\n#include <linux/of_fdt.h>\n#include <linux/of.h>\n#include <linux/dma-mapping.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\nstatic inline struct dma_coherent_mem *dev_get_coherent_memory(struct device *dev)\n{\n\tif (dev && dev->dma_mem)\n\t\treturn dev->dma_mem;\n\treturn NULL;\n}"
  }
]