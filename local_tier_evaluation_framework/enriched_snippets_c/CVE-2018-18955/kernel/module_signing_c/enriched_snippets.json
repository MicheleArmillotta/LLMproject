[
  {
    "function_name": "mod_verify_sig",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18955/repo/kernel/module_signing.c",
    "lines": "48-88",
    "snippet": "int mod_verify_sig(const void *mod, struct load_info *info)\n{\n\tstruct module_signature ms;\n\tsize_t sig_len, modlen = info->len;\n\n\tpr_devel(\"==>%s(,%zu)\\n\", __func__, modlen);\n\n\tif (modlen <= sizeof(ms))\n\t\treturn -EBADMSG;\n\n\tmemcpy(&ms, mod + (modlen - sizeof(ms)), sizeof(ms));\n\tmodlen -= sizeof(ms);\n\n\tsig_len = be32_to_cpu(ms.sig_len);\n\tif (sig_len >= modlen)\n\t\treturn -EBADMSG;\n\tmodlen -= sig_len;\n\tinfo->len = modlen;\n\n\tif (ms.id_type != PKEY_ID_PKCS7) {\n\t\tpr_err(\"%s: Module is not signed with expected PKCS#7 message\\n\",\n\t\t       info->name);\n\t\treturn -ENOPKG;\n\t}\n\n\tif (ms.algo != 0 ||\n\t    ms.hash != 0 ||\n\t    ms.signer_len != 0 ||\n\t    ms.key_id_len != 0 ||\n\t    ms.__pad[0] != 0 ||\n\t    ms.__pad[1] != 0 ||\n\t    ms.__pad[2] != 0) {\n\t\tpr_err(\"%s: PKCS#7 signature info has unexpected non-zero params\\n\",\n\t\t       info->name);\n\t\treturn -EBADMSG;\n\t}\n\n\treturn verify_pkcs7_signature(mod, modlen, mod + modlen, sig_len,\n\t\t\t\t      NULL, VERIFYING_MODULE_SIGNATURE,\n\t\t\t\t      NULL, NULL);\n}",
    "includes": [
      "#include \"module-internal.h\"",
      "#include <crypto/public_key.h>",
      "#include <linux/verification.h>",
      "#include <linux/string.h>",
      "#include <linux/errno.h>",
      "#include <linux/kernel.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "verify_pkcs7_signature",
          "args": [
            "mod",
            "modlen",
            "mod + modlen",
            "sig_len",
            "NULL",
            "VERIFYING_MODULE_SIGNATURE",
            "NULL",
            "NULL"
          ],
          "line": 85
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pr_err",
          "args": [
            "\"%s: PKCS#7 signature info has unexpected non-zero params\\n\"",
            "info->name"
          ],
          "line": 80
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pr_err",
          "args": [
            "\"%s: Module is not signed with expected PKCS#7 message\\n\"",
            "info->name"
          ],
          "line": 68
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "be32_to_cpu",
          "args": [
            "ms.sig_len"
          ],
          "line": 61
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "&ms",
            "mod + (modlen - sizeof(ms))",
            "sizeof(ms)"
          ],
          "line": 58
        },
        "resolved": true,
        "details": {
          "function_name": "memcpy_skip",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2018-18955/repo/kernel/events/internal.h",
          "lines": "178-182",
          "snippet": "static inline unsigned long\nmemcpy_skip(void *dst, const void *src, unsigned long n)\n{\n\treturn 0;\n}",
          "includes": [
            "#include <linux/uaccess.h>",
            "#include <linux/hardirq.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/uaccess.h>\n#include <linux/hardirq.h>\n\nstatic inline unsigned long\nmemcpy_skip(void *dst, const void *src, unsigned long n)\n{\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "pr_devel",
          "args": [
            "\"==>%s(,%zu)\\n\"",
            "__func__",
            "modlen"
          ],
          "line": 53
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"module-internal.h\"\n#include <crypto/public_key.h>\n#include <linux/verification.h>\n#include <linux/string.h>\n#include <linux/errno.h>\n#include <linux/kernel.h>\n\nint mod_verify_sig(const void *mod, struct load_info *info)\n{\n\tstruct module_signature ms;\n\tsize_t sig_len, modlen = info->len;\n\n\tpr_devel(\"==>%s(,%zu)\\n\", __func__, modlen);\n\n\tif (modlen <= sizeof(ms))\n\t\treturn -EBADMSG;\n\n\tmemcpy(&ms, mod + (modlen - sizeof(ms)), sizeof(ms));\n\tmodlen -= sizeof(ms);\n\n\tsig_len = be32_to_cpu(ms.sig_len);\n\tif (sig_len >= modlen)\n\t\treturn -EBADMSG;\n\tmodlen -= sig_len;\n\tinfo->len = modlen;\n\n\tif (ms.id_type != PKEY_ID_PKCS7) {\n\t\tpr_err(\"%s: Module is not signed with expected PKCS#7 message\\n\",\n\t\t       info->name);\n\t\treturn -ENOPKG;\n\t}\n\n\tif (ms.algo != 0 ||\n\t    ms.hash != 0 ||\n\t    ms.signer_len != 0 ||\n\t    ms.key_id_len != 0 ||\n\t    ms.__pad[0] != 0 ||\n\t    ms.__pad[1] != 0 ||\n\t    ms.__pad[2] != 0) {\n\t\tpr_err(\"%s: PKCS#7 signature info has unexpected non-zero params\\n\",\n\t\t       info->name);\n\t\treturn -EBADMSG;\n\t}\n\n\treturn verify_pkcs7_signature(mod, modlen, mod + modlen, sig_len,\n\t\t\t\t      NULL, VERIFYING_MODULE_SIGNATURE,\n\t\t\t\t      NULL, NULL);\n}"
  }
]