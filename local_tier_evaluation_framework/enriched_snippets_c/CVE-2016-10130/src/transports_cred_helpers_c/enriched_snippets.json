[
  {
    "function_name": "git_cred_userpass",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10130/repo/src/transports/cred_helpers.c",
    "lines": "11-52",
    "snippet": "int git_cred_userpass(\n\t\tgit_cred **cred,\n\t\tconst char *url,\n\t\tconst char *user_from_url,\n\t\tunsigned int allowed_types,\n\t\tvoid *payload)\n{\n\tgit_cred_userpass_payload *userpass = (git_cred_userpass_payload*)payload;\n\tconst char *effective_username = NULL;\n\n\tGIT_UNUSED(url);\n\n\tif (!userpass || !userpass->password) return -1;\n\n\t/* Username resolution: a username can be passed with the URL, the\n\t * credentials payload, or both. Here's what we do.  Note that if we get\n\t * this far, we know that any password the url may contain has already\n\t * failed at least once, so we ignore it.\n\t *\n\t * |  Payload    |   URL    |   Used    |\n\t * +-------------+----------+-----------+\n\t * |    yes      |   no     |  payload  |\n\t * |    yes      |   yes    |  payload  |\n\t * |    no       |   yes    |  url      |\n\t * |    no       |   no     |  FAIL     |\n\t */\n\tif (userpass->username)\n\t\teffective_username = userpass->username;\n\telse if (user_from_url)\n\t\teffective_username = user_from_url;\n\telse\n\t\treturn -1;\n\n\tif (GIT_CREDTYPE_USERNAME & allowed_types)\n\t\treturn git_cred_username_new(cred, effective_username);\n\n\tif ((GIT_CREDTYPE_USERPASS_PLAINTEXT & allowed_types) == 0 ||\n\t\t\tgit_cred_userpass_plaintext_new(cred, effective_username, userpass->password) < 0)\n\t\treturn -1;\n\n\treturn 0;\n}",
    "includes": [
      "#include \"git2/cred_helpers.h\"",
      "#include \"common.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "git_cred_userpass_plaintext_new",
          "args": [
            "cred",
            "effective_username",
            "userpass->password"
          ],
          "line": 48
        },
        "resolved": true,
        "details": {
          "function_name": "git_cred_userpass_plaintext_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10130/repo/src/transports/cred.c",
          "lines": "79-110",
          "snippet": "int git_cred_userpass_plaintext_new(\n\tgit_cred **cred,\n\tconst char *username,\n\tconst char *password)\n{\n\tgit_cred_userpass_plaintext *c;\n\n\tassert(cred && username && password);\n\n\tc = git__malloc(sizeof(git_cred_userpass_plaintext));\n\tGITERR_CHECK_ALLOC(c);\n\n\tc->parent.credtype = GIT_CREDTYPE_USERPASS_PLAINTEXT;\n\tc->parent.free = plaintext_free;\n\tc->username = git__strdup(username);\n\n\tif (!c->username) {\n\t\tgit__free(c);\n\t\treturn -1;\n\t}\n\n\tc->password = git__strdup(password);\n\n\tif (!c->password) {\n\t\tgit__free(c->username);\n\t\tgit__free(c);\n\t\treturn -1;\n\t}\n\n\t*cred = &c->parent;\n\treturn 0;\n}",
          "includes": [
            "#include \"git2/cred_helpers.h\"",
            "#include \"smart.h\"",
            "#include \"git2.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static int git_cred_ssh_key_type_new(\n\tgit_cred **cred,\n\tconst char *username,\n\tconst char *publickey,\n\tconst char *privatekey,\n\tconst char *passphrase,\n\tgit_credtype_t credtype);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"git2/cred_helpers.h\"\n#include \"smart.h\"\n#include \"git2.h\"\n\nstatic int git_cred_ssh_key_type_new(\n\tgit_cred **cred,\n\tconst char *username,\n\tconst char *publickey,\n\tconst char *privatekey,\n\tconst char *passphrase,\n\tgit_credtype_t credtype);\n\nint git_cred_userpass_plaintext_new(\n\tgit_cred **cred,\n\tconst char *username,\n\tconst char *password)\n{\n\tgit_cred_userpass_plaintext *c;\n\n\tassert(cred && username && password);\n\n\tc = git__malloc(sizeof(git_cred_userpass_plaintext));\n\tGITERR_CHECK_ALLOC(c);\n\n\tc->parent.credtype = GIT_CREDTYPE_USERPASS_PLAINTEXT;\n\tc->parent.free = plaintext_free;\n\tc->username = git__strdup(username);\n\n\tif (!c->username) {\n\t\tgit__free(c);\n\t\treturn -1;\n\t}\n\n\tc->password = git__strdup(password);\n\n\tif (!c->password) {\n\t\tgit__free(c->username);\n\t\tgit__free(c);\n\t\treturn -1;\n\t}\n\n\t*cred = &c->parent;\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "git_cred_username_new",
          "args": [
            "cred",
            "effective_username"
          ],
          "line": 45
        },
        "resolved": true,
        "details": {
          "function_name": "git_cred_username_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10130/repo/src/transports/cred.c",
          "lines": "360-380",
          "snippet": "int git_cred_username_new(git_cred **cred, const char *username)\n{\n\tgit_cred_username *c;\n\tsize_t len, allocsize;\n\n\tassert(cred);\n\n\tlen = strlen(username);\n\n\tGITERR_CHECK_ALLOC_ADD(&allocsize, sizeof(git_cred_username), len);\n\tGITERR_CHECK_ALLOC_ADD(&allocsize, allocsize, 1);\n\tc = git__malloc(allocsize);\n\tGITERR_CHECK_ALLOC(c);\n\n\tc->parent.credtype = GIT_CREDTYPE_USERNAME;\n\tc->parent.free = username_free;\n\tmemcpy(c->username, username, len + 1);\n\n\t*cred = (git_cred *) c;\n\treturn 0;\n}",
          "includes": [
            "#include \"git2/cred_helpers.h\"",
            "#include \"smart.h\"",
            "#include \"git2.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static int git_cred_ssh_key_type_new(\n\tgit_cred **cred,\n\tconst char *username,\n\tconst char *publickey,\n\tconst char *privatekey,\n\tconst char *passphrase,\n\tgit_credtype_t credtype);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"git2/cred_helpers.h\"\n#include \"smart.h\"\n#include \"git2.h\"\n\nstatic int git_cred_ssh_key_type_new(\n\tgit_cred **cred,\n\tconst char *username,\n\tconst char *publickey,\n\tconst char *privatekey,\n\tconst char *passphrase,\n\tgit_credtype_t credtype);\n\nint git_cred_username_new(git_cred **cred, const char *username)\n{\n\tgit_cred_username *c;\n\tsize_t len, allocsize;\n\n\tassert(cred);\n\n\tlen = strlen(username);\n\n\tGITERR_CHECK_ALLOC_ADD(&allocsize, sizeof(git_cred_username), len);\n\tGITERR_CHECK_ALLOC_ADD(&allocsize, allocsize, 1);\n\tc = git__malloc(allocsize);\n\tGITERR_CHECK_ALLOC(c);\n\n\tc->parent.credtype = GIT_CREDTYPE_USERNAME;\n\tc->parent.free = username_free;\n\tmemcpy(c->username, username, len + 1);\n\n\t*cred = (git_cred *) c;\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "GIT_UNUSED",
          "args": [
            "url"
          ],
          "line": 21
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"git2/cred_helpers.h\"\n#include \"common.h\"\n\nint git_cred_userpass(\n\t\tgit_cred **cred,\n\t\tconst char *url,\n\t\tconst char *user_from_url,\n\t\tunsigned int allowed_types,\n\t\tvoid *payload)\n{\n\tgit_cred_userpass_payload *userpass = (git_cred_userpass_payload*)payload;\n\tconst char *effective_username = NULL;\n\n\tGIT_UNUSED(url);\n\n\tif (!userpass || !userpass->password) return -1;\n\n\t/* Username resolution: a username can be passed with the URL, the\n\t * credentials payload, or both. Here's what we do.  Note that if we get\n\t * this far, we know that any password the url may contain has already\n\t * failed at least once, so we ignore it.\n\t *\n\t * |  Payload    |   URL    |   Used    |\n\t * +-------------+----------+-----------+\n\t * |    yes      |   no     |  payload  |\n\t * |    yes      |   yes    |  payload  |\n\t * |    no       |   yes    |  url      |\n\t * |    no       |   no     |  FAIL     |\n\t */\n\tif (userpass->username)\n\t\teffective_username = userpass->username;\n\telse if (user_from_url)\n\t\teffective_username = user_from_url;\n\telse\n\t\treturn -1;\n\n\tif (GIT_CREDTYPE_USERNAME & allowed_types)\n\t\treturn git_cred_username_new(cred, effective_username);\n\n\tif ((GIT_CREDTYPE_USERPASS_PLAINTEXT & allowed_types) == 0 ||\n\t\t\tgit_cred_userpass_plaintext_new(cred, effective_username, userpass->password) < 0)\n\t\treturn -1;\n\n\treturn 0;\n}"
  }
]