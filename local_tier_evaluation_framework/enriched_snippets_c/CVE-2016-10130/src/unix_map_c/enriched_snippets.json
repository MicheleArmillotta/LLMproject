[
  {
    "function_name": "p_munmap",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10130/repo/src/unix/map.c",
    "lines": "64-70",
    "snippet": "int p_munmap(git_map *map)\n{\n\tassert(map != NULL);\n\tmunmap(map->data, map->len);\n\n\treturn 0;\n}",
    "includes": [
      "#include <errno.h>",
      "#include <unistd.h>",
      "#include <sys/mman.h>",
      "#include \"map.h\"",
      "#include <git2/common.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "munmap",
          "args": [
            "map->data",
            "map->len"
          ],
          "line": 67
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "assert",
          "args": [
            "map != NULL"
          ],
          "line": 66
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <errno.h>\n#include <unistd.h>\n#include <sys/mman.h>\n#include \"map.h\"\n#include <git2/common.h>\n\nint p_munmap(git_map *map)\n{\n\tassert(map != NULL);\n\tmunmap(map->data, map->len);\n\n\treturn 0;\n}"
  },
  {
    "function_name": "p_mmap",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10130/repo/src/unix/map.c",
    "lines": "32-62",
    "snippet": "int p_mmap(git_map *out, size_t len, int prot, int flags, int fd, git_off_t offset)\n{\n\tint mprot = PROT_READ;\n\tint mflag = 0;\n\n\tGIT_MMAP_VALIDATE(out, len, prot, flags);\n\n\tout->data = NULL;\n\tout->len = 0;\n\n\tif (prot & GIT_PROT_WRITE)\n\t\tmprot |= PROT_WRITE;\n\n\tif ((flags & GIT_MAP_TYPE) == GIT_MAP_SHARED)\n\t\tmflag = MAP_SHARED;\n\telse if ((flags & GIT_MAP_TYPE) == GIT_MAP_PRIVATE)\n\t\tmflag = MAP_PRIVATE;\n\telse\n\t\tmflag = MAP_SHARED;\n\n\tout->data = mmap(NULL, len, mprot, mflag, fd, offset);\n\n\tif (!out->data || out->data == MAP_FAILED) {\n\t\tgiterr_set(GITERR_OS, \"Failed to mmap. Could not write data\");\n\t\treturn -1;\n\t}\n\n\tout->len = len;\n\n\treturn 0;\n}",
    "includes": [
      "#include <errno.h>",
      "#include <unistd.h>",
      "#include <sys/mman.h>",
      "#include \"map.h\"",
      "#include <git2/common.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "giterr_set",
          "args": [
            "GITERR_OS",
            "\"Failed to mmap. Could not write data\""
          ],
          "line": 55
        },
        "resolved": true,
        "details": {
          "function_name": "giterr_set_after_callback_function",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10130/repo/src/common.h",
          "lines": "122-132",
          "snippet": "GIT_INLINE(int) giterr_set_after_callback_function(\n\tint error_code, const char *action)\n{\n\tif (error_code) {\n\t\tconst git_error *e = giterr_last();\n\t\tif (!e || !e->message)\n\t\t\tgiterr_set(e ? e->klass : GITERR_CALLBACK,\n\t\t\t\t\"%s callback returned %d\", action, error_code);\n\t}\n\treturn error_code;\n}",
          "includes": [
            "#include \"util.h\"",
            "#include <regex.h>",
            "#include \"integer.h\"",
            "#include \"thread-utils.h\"",
            "#include \"git2/errors.h\"",
            "#include \"git2/types.h\"",
            "# include <arpa/inet.h>",
            "#\tinclude <sched.h>",
            "#\tinclude <pthread.h>",
            "# include <strings.h>",
            "# include <unistd.h>",
            "#   include \"win32/w32_crtdbg_stacktrace.h\"",
            "#   include \"win32/w32_stack.h\"",
            "#\tinclude \"win32/thread.h\"",
            "# include \"win32/version.h\"",
            "# include \"win32/error.h\"",
            "# include \"win32/win32-compat.h\"",
            "# include \"win32/mingw-compat.h\"",
            "# include \"win32/msvc-compat.h\"",
            "# include <ws2tcpip.h>",
            "# include <windows.h>",
            "# include <winsock2.h>",
            "# include <direct.h>",
            "# include <io.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <limits.h>",
            "#include <errno.h>",
            "#include <assert.h>",
            "#include \"cc-compat.h\"",
            "#include \"git2/common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util.h\"\n#include <regex.h>\n#include \"integer.h\"\n#include \"thread-utils.h\"\n#include \"git2/errors.h\"\n#include \"git2/types.h\"\n# include <arpa/inet.h>\n#\tinclude <sched.h>\n#\tinclude <pthread.h>\n# include <strings.h>\n# include <unistd.h>\n#   include \"win32/w32_crtdbg_stacktrace.h\"\n#   include \"win32/w32_stack.h\"\n#\tinclude \"win32/thread.h\"\n# include \"win32/version.h\"\n# include \"win32/error.h\"\n# include \"win32/win32-compat.h\"\n# include \"win32/mingw-compat.h\"\n# include \"win32/msvc-compat.h\"\n# include <ws2tcpip.h>\n# include <windows.h>\n# include <winsock2.h>\n# include <direct.h>\n# include <io.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <limits.h>\n#include <errno.h>\n#include <assert.h>\n#include \"cc-compat.h\"\n#include \"git2/common.h\"\n\nGIT_INLINE(int) giterr_set_after_callback_function(\n\tint error_code, const char *action)\n{\n\tif (error_code) {\n\t\tconst git_error *e = giterr_last();\n\t\tif (!e || !e->message)\n\t\t\tgiterr_set(e ? e->klass : GITERR_CALLBACK,\n\t\t\t\t\"%s callback returned %d\", action, error_code);\n\t}\n\treturn error_code;\n}"
        }
      },
      {
        "call_info": {
          "callee": "mmap",
          "args": [
            "NULL",
            "len",
            "mprot",
            "mflag",
            "fd",
            "offset"
          ],
          "line": 52
        },
        "resolved": true,
        "details": {
          "function_name": "p_mmap",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10130/repo/src/unix/map.c",
          "lines": "32-62",
          "snippet": "int p_mmap(git_map *out, size_t len, int prot, int flags, int fd, git_off_t offset)\n{\n\tint mprot = PROT_READ;\n\tint mflag = 0;\n\n\tGIT_MMAP_VALIDATE(out, len, prot, flags);\n\n\tout->data = NULL;\n\tout->len = 0;\n\n\tif (prot & GIT_PROT_WRITE)\n\t\tmprot |= PROT_WRITE;\n\n\tif ((flags & GIT_MAP_TYPE) == GIT_MAP_SHARED)\n\t\tmflag = MAP_SHARED;\n\telse if ((flags & GIT_MAP_TYPE) == GIT_MAP_PRIVATE)\n\t\tmflag = MAP_PRIVATE;\n\telse\n\t\tmflag = MAP_SHARED;\n\n\tout->data = mmap(NULL, len, mprot, mflag, fd, offset);\n\n\tif (!out->data || out->data == MAP_FAILED) {\n\t\tgiterr_set(GITERR_OS, \"Failed to mmap. Could not write data\");\n\t\treturn -1;\n\t}\n\n\tout->len = len;\n\n\treturn 0;\n}",
          "note": "cyclic_reference_detected"
        }
      },
      {
        "call_info": {
          "callee": "GIT_MMAP_VALIDATE",
          "args": [
            "out",
            "len",
            "prot",
            "flags"
          ],
          "line": 37
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <errno.h>\n#include <unistd.h>\n#include <sys/mman.h>\n#include \"map.h\"\n#include <git2/common.h>\n\nint p_mmap(git_map *out, size_t len, int prot, int flags, int fd, git_off_t offset)\n{\n\tint mprot = PROT_READ;\n\tint mflag = 0;\n\n\tGIT_MMAP_VALIDATE(out, len, prot, flags);\n\n\tout->data = NULL;\n\tout->len = 0;\n\n\tif (prot & GIT_PROT_WRITE)\n\t\tmprot |= PROT_WRITE;\n\n\tif ((flags & GIT_MAP_TYPE) == GIT_MAP_SHARED)\n\t\tmflag = MAP_SHARED;\n\telse if ((flags & GIT_MAP_TYPE) == GIT_MAP_PRIVATE)\n\t\tmflag = MAP_PRIVATE;\n\telse\n\t\tmflag = MAP_SHARED;\n\n\tout->data = mmap(NULL, len, mprot, mflag, fd, offset);\n\n\tif (!out->data || out->data == MAP_FAILED) {\n\t\tgiterr_set(GITERR_OS, \"Failed to mmap. Could not write data\");\n\t\treturn -1;\n\t}\n\n\tout->len = len;\n\n\treturn 0;\n}"
  },
  {
    "function_name": "git__mmap_alignment",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10130/repo/src/unix/map.c",
    "lines": "27-30",
    "snippet": "int git__mmap_alignment(size_t *alignment)\n{\n  return git__page_size(alignment);\n}",
    "includes": [
      "#include <errno.h>",
      "#include <unistd.h>",
      "#include <sys/mman.h>",
      "#include \"map.h\"",
      "#include <git2/common.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "git__page_size",
          "args": [
            "alignment"
          ],
          "line": 29
        },
        "resolved": true,
        "details": {
          "function_name": "git__page_size",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10130/repo/src/unix/map.c",
          "lines": "16-25",
          "snippet": "int git__page_size(size_t *page_size)\n{\n\tlong sc_page_size = sysconf(_SC_PAGE_SIZE);\n\tif (sc_page_size < 0) {\n\t\tgiterr_set(GITERR_OS, \"can't determine system page size\");\n\t\treturn -1;\n\t}\n\t*page_size = (size_t) sc_page_size;\n\treturn 0;\n}",
          "includes": [
            "#include <errno.h>",
            "#include <unistd.h>",
            "#include <sys/mman.h>",
            "#include \"map.h\"",
            "#include <git2/common.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <errno.h>\n#include <unistd.h>\n#include <sys/mman.h>\n#include \"map.h\"\n#include <git2/common.h>\n\nint git__page_size(size_t *page_size)\n{\n\tlong sc_page_size = sysconf(_SC_PAGE_SIZE);\n\tif (sc_page_size < 0) {\n\t\tgiterr_set(GITERR_OS, \"can't determine system page size\");\n\t\treturn -1;\n\t}\n\t*page_size = (size_t) sc_page_size;\n\treturn 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <errno.h>\n#include <unistd.h>\n#include <sys/mman.h>\n#include \"map.h\"\n#include <git2/common.h>\n\nint git__mmap_alignment(size_t *alignment)\n{\n  return git__page_size(alignment);\n}"
  },
  {
    "function_name": "git__page_size",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10130/repo/src/unix/map.c",
    "lines": "16-25",
    "snippet": "int git__page_size(size_t *page_size)\n{\n\tlong sc_page_size = sysconf(_SC_PAGE_SIZE);\n\tif (sc_page_size < 0) {\n\t\tgiterr_set(GITERR_OS, \"can't determine system page size\");\n\t\treturn -1;\n\t}\n\t*page_size = (size_t) sc_page_size;\n\treturn 0;\n}",
    "includes": [
      "#include <errno.h>",
      "#include <unistd.h>",
      "#include <sys/mman.h>",
      "#include \"map.h\"",
      "#include <git2/common.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "giterr_set",
          "args": [
            "GITERR_OS",
            "\"can't determine system page size\""
          ],
          "line": 20
        },
        "resolved": true,
        "details": {
          "function_name": "giterr_set_after_callback_function",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10130/repo/src/common.h",
          "lines": "122-132",
          "snippet": "GIT_INLINE(int) giterr_set_after_callback_function(\n\tint error_code, const char *action)\n{\n\tif (error_code) {\n\t\tconst git_error *e = giterr_last();\n\t\tif (!e || !e->message)\n\t\t\tgiterr_set(e ? e->klass : GITERR_CALLBACK,\n\t\t\t\t\"%s callback returned %d\", action, error_code);\n\t}\n\treturn error_code;\n}",
          "includes": [
            "#include \"util.h\"",
            "#include <regex.h>",
            "#include \"integer.h\"",
            "#include \"thread-utils.h\"",
            "#include \"git2/errors.h\"",
            "#include \"git2/types.h\"",
            "# include <arpa/inet.h>",
            "#\tinclude <sched.h>",
            "#\tinclude <pthread.h>",
            "# include <strings.h>",
            "# include <unistd.h>",
            "#   include \"win32/w32_crtdbg_stacktrace.h\"",
            "#   include \"win32/w32_stack.h\"",
            "#\tinclude \"win32/thread.h\"",
            "# include \"win32/version.h\"",
            "# include \"win32/error.h\"",
            "# include \"win32/win32-compat.h\"",
            "# include \"win32/mingw-compat.h\"",
            "# include \"win32/msvc-compat.h\"",
            "# include <ws2tcpip.h>",
            "# include <windows.h>",
            "# include <winsock2.h>",
            "# include <direct.h>",
            "# include <io.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <limits.h>",
            "#include <errno.h>",
            "#include <assert.h>",
            "#include \"cc-compat.h\"",
            "#include \"git2/common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util.h\"\n#include <regex.h>\n#include \"integer.h\"\n#include \"thread-utils.h\"\n#include \"git2/errors.h\"\n#include \"git2/types.h\"\n# include <arpa/inet.h>\n#\tinclude <sched.h>\n#\tinclude <pthread.h>\n# include <strings.h>\n# include <unistd.h>\n#   include \"win32/w32_crtdbg_stacktrace.h\"\n#   include \"win32/w32_stack.h\"\n#\tinclude \"win32/thread.h\"\n# include \"win32/version.h\"\n# include \"win32/error.h\"\n# include \"win32/win32-compat.h\"\n# include \"win32/mingw-compat.h\"\n# include \"win32/msvc-compat.h\"\n# include <ws2tcpip.h>\n# include <windows.h>\n# include <winsock2.h>\n# include <direct.h>\n# include <io.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <limits.h>\n#include <errno.h>\n#include <assert.h>\n#include \"cc-compat.h\"\n#include \"git2/common.h\"\n\nGIT_INLINE(int) giterr_set_after_callback_function(\n\tint error_code, const char *action)\n{\n\tif (error_code) {\n\t\tconst git_error *e = giterr_last();\n\t\tif (!e || !e->message)\n\t\t\tgiterr_set(e ? e->klass : GITERR_CALLBACK,\n\t\t\t\t\"%s callback returned %d\", action, error_code);\n\t}\n\treturn error_code;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sysconf",
          "args": [
            "_SC_PAGE_SIZE"
          ],
          "line": 18
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <errno.h>\n#include <unistd.h>\n#include <sys/mman.h>\n#include \"map.h\"\n#include <git2/common.h>\n\nint git__page_size(size_t *page_size)\n{\n\tlong sc_page_size = sysconf(_SC_PAGE_SIZE);\n\tif (sc_page_size < 0) {\n\t\tgiterr_set(GITERR_OS, \"can't determine system page size\");\n\t\treturn -1;\n\t}\n\t*page_size = (size_t) sc_page_size;\n\treturn 0;\n}"
  }
]