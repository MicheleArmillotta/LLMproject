[
  {
    "function_name": "git_tls_stream_new",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10130/repo/src/tls_stream.c",
    "lines": "23-41",
    "snippet": "int git_tls_stream_new(git_stream **out, const char *host, const char *port)\n{\n\n\tif (tls_ctor)\n\t\treturn tls_ctor(out, host, port);\n\n#ifdef GIT_SECURE_TRANSPORT\n\treturn git_stransport_stream_new(out, host, port);\n#elif defined(GIT_OPENSSL)\n\treturn git_openssl_stream_new(out, host, port);\n#else\n\tGIT_UNUSED(out);\n\tGIT_UNUSED(host);\n\tGIT_UNUSED(port);\n\n\tgiterr_set(GITERR_SSL, \"there is no TLS stream available\");\n\treturn -1;\n#endif\n}",
    "includes": [
      "#include \"stransport_stream.h\"",
      "#include \"openssl_stream.h\"",
      "#include \"common.h\"",
      "#include \"git2/errors.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static git_stream_cb tls_ctor;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "giterr_set",
          "args": [
            "GITERR_SSL",
            "\"there is no TLS stream available\""
          ],
          "line": 38
        },
        "resolved": true,
        "details": {
          "function_name": "giterr_set_after_callback_function",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10130/repo/src/common.h",
          "lines": "122-132",
          "snippet": "GIT_INLINE(int) giterr_set_after_callback_function(\n\tint error_code, const char *action)\n{\n\tif (error_code) {\n\t\tconst git_error *e = giterr_last();\n\t\tif (!e || !e->message)\n\t\t\tgiterr_set(e ? e->klass : GITERR_CALLBACK,\n\t\t\t\t\"%s callback returned %d\", action, error_code);\n\t}\n\treturn error_code;\n}",
          "includes": [
            "#include \"util.h\"",
            "#include <regex.h>",
            "#include \"integer.h\"",
            "#include \"thread-utils.h\"",
            "#include \"git2/errors.h\"",
            "#include \"git2/types.h\"",
            "# include <arpa/inet.h>",
            "#\tinclude <sched.h>",
            "#\tinclude <pthread.h>",
            "# include <strings.h>",
            "# include <unistd.h>",
            "#   include \"win32/w32_crtdbg_stacktrace.h\"",
            "#   include \"win32/w32_stack.h\"",
            "#\tinclude \"win32/thread.h\"",
            "# include \"win32/version.h\"",
            "# include \"win32/error.h\"",
            "# include \"win32/win32-compat.h\"",
            "# include \"win32/mingw-compat.h\"",
            "# include \"win32/msvc-compat.h\"",
            "# include <ws2tcpip.h>",
            "# include <windows.h>",
            "# include <winsock2.h>",
            "# include <direct.h>",
            "# include <io.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <limits.h>",
            "#include <errno.h>",
            "#include <assert.h>",
            "#include \"cc-compat.h\"",
            "#include \"git2/common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util.h\"\n#include <regex.h>\n#include \"integer.h\"\n#include \"thread-utils.h\"\n#include \"git2/errors.h\"\n#include \"git2/types.h\"\n# include <arpa/inet.h>\n#\tinclude <sched.h>\n#\tinclude <pthread.h>\n# include <strings.h>\n# include <unistd.h>\n#   include \"win32/w32_crtdbg_stacktrace.h\"\n#   include \"win32/w32_stack.h\"\n#\tinclude \"win32/thread.h\"\n# include \"win32/version.h\"\n# include \"win32/error.h\"\n# include \"win32/win32-compat.h\"\n# include \"win32/mingw-compat.h\"\n# include \"win32/msvc-compat.h\"\n# include <ws2tcpip.h>\n# include <windows.h>\n# include <winsock2.h>\n# include <direct.h>\n# include <io.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <limits.h>\n#include <errno.h>\n#include <assert.h>\n#include \"cc-compat.h\"\n#include \"git2/common.h\"\n\nGIT_INLINE(int) giterr_set_after_callback_function(\n\tint error_code, const char *action)\n{\n\tif (error_code) {\n\t\tconst git_error *e = giterr_last();\n\t\tif (!e || !e->message)\n\t\t\tgiterr_set(e ? e->klass : GITERR_CALLBACK,\n\t\t\t\t\"%s callback returned %d\", action, error_code);\n\t}\n\treturn error_code;\n}"
        }
      },
      {
        "call_info": {
          "callee": "GIT_UNUSED",
          "args": [
            "port"
          ],
          "line": 36
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "GIT_UNUSED",
          "args": [
            "host"
          ],
          "line": 35
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "GIT_UNUSED",
          "args": [
            "out"
          ],
          "line": 34
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "git_openssl_stream_new",
          "args": [
            "out",
            "host",
            "port"
          ],
          "line": 32
        },
        "resolved": true,
        "details": {
          "function_name": "git_openssl_stream_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10130/repo/src/openssl_stream.c",
          "lines": "640-648",
          "snippet": "int git_openssl_stream_new(git_stream **out, const char *host, const char *port)\n{\n\tGIT_UNUSED(out);\n\tGIT_UNUSED(host);\n\tGIT_UNUSED(port);\n\n\tgiterr_set(GITERR_SSL, \"openssl is not supported in this version\");\n\treturn -1;\n}",
          "includes": [
            "#include \"git2/sys/openssl.h\"",
            "#include \"stream.h\"",
            "#include <openssl/bio.h>",
            "#include <openssl/x509v3.h>",
            "#include <openssl/err.h>",
            "#include <openssl/ssl.h>",
            "# include <netinet/in.h>",
            "# include <sys/socket.h>",
            "# include <sys/types.h>",
            "# include \"curl_stream.h\"",
            "#include \"git2/sys/openssl.h\"",
            "#include \"git2/transport.h\"",
            "#include \"netops.h\"",
            "#include \"openssl_stream.h\"",
            "#include \"socket_stream.h\"",
            "#include \"stream.h\"",
            "#include \"posix.h\"",
            "#include \"global.h\"",
            "#include <ctype.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"git2/sys/openssl.h\"\n#include \"stream.h\"\n#include <openssl/bio.h>\n#include <openssl/x509v3.h>\n#include <openssl/err.h>\n#include <openssl/ssl.h>\n# include <netinet/in.h>\n# include <sys/socket.h>\n# include <sys/types.h>\n# include \"curl_stream.h\"\n#include \"git2/sys/openssl.h\"\n#include \"git2/transport.h\"\n#include \"netops.h\"\n#include \"openssl_stream.h\"\n#include \"socket_stream.h\"\n#include \"stream.h\"\n#include \"posix.h\"\n#include \"global.h\"\n#include <ctype.h>\n\nint git_openssl_stream_new(git_stream **out, const char *host, const char *port)\n{\n\tGIT_UNUSED(out);\n\tGIT_UNUSED(host);\n\tGIT_UNUSED(port);\n\n\tgiterr_set(GITERR_SSL, \"openssl is not supported in this version\");\n\treturn -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "git_stransport_stream_new",
          "args": [
            "out",
            "host",
            "port"
          ],
          "line": 30
        },
        "resolved": true,
        "details": {
          "function_name": "git_stransport_stream_new",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10130/repo/src/stransport_stream.c",
          "lines": "237-290",
          "snippet": "int git_stransport_stream_new(git_stream **out, const char *host, const char *port)\n{\n\tstransport_stream *st;\n\tint error;\n\tOSStatus ret;\n\n\tassert(out && host);\n\n\tst = git__calloc(1, sizeof(stransport_stream));\n\tGITERR_CHECK_ALLOC(st);\n\n#ifdef GIT_CURL\n\terror = git_curl_stream_new(&st->io, host, port);\n#else\n\terror = git_socket_stream_new(&st->io, host, port);\n#endif\n\n\tif (error < 0){\n\t\tgit__free(st);\n\t\treturn error;\n\t}\n\n\tst->ctx = SSLCreateContext(NULL, kSSLClientSide, kSSLStreamType);\n\tif (!st->ctx) {\n\t\tgiterr_set(GITERR_NET, \"failed to create SSL context\");\n\t\tgit__free(st);\n\t\treturn -1;\n\t}\n\n\tif ((ret = SSLSetIOFuncs(st->ctx, read_cb, write_cb)) != noErr ||\n\t    (ret = SSLSetConnection(st->ctx, st->io)) != noErr ||\n\t    (ret = SSLSetSessionOption(st->ctx, kSSLSessionOptionBreakOnServerAuth, true)) != noErr ||\n\t    (ret = SSLSetProtocolVersionMin(st->ctx, kTLSProtocol1)) != noErr ||\n\t    (ret = SSLSetProtocolVersionMax(st->ctx, kTLSProtocol12)) != noErr ||\n\t    (ret = SSLSetPeerDomainName(st->ctx, host, strlen(host))) != noErr) {\n\t\tCFRelease(st->ctx);\n\t\tgit__free(st);\n\t\treturn stransport_error(ret);\n\t}\n\n\tst->parent.version = GIT_STREAM_VERSION;\n\tst->parent.encrypted = 1;\n\tst->parent.proxy_support = git_stream_supports_proxy(st->io);\n\tst->parent.connect = stransport_connect;\n\tst->parent.certificate = stransport_certificate;\n\tst->parent.set_proxy = stransport_set_proxy;\n\tst->parent.read = stransport_read;\n\tst->parent.write = stransport_write;\n\tst->parent.close = stransport_close;\n\tst->parent.free = stransport_free;\n\n\t*out = (git_stream *) st;\n\treturn 0;\n}",
          "includes": [
            "#include \"curl_stream.h\"",
            "#include \"socket_stream.h\"",
            "#include \"git2/transport.h\"",
            "#include <Security/SecCertificate.h>",
            "#include <Security/SecureTransport.h>",
            "#include <CoreFoundation/CoreFoundation.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"curl_stream.h\"\n#include \"socket_stream.h\"\n#include \"git2/transport.h\"\n#include <Security/SecCertificate.h>\n#include <Security/SecureTransport.h>\n#include <CoreFoundation/CoreFoundation.h>\n\nint git_stransport_stream_new(git_stream **out, const char *host, const char *port)\n{\n\tstransport_stream *st;\n\tint error;\n\tOSStatus ret;\n\n\tassert(out && host);\n\n\tst = git__calloc(1, sizeof(stransport_stream));\n\tGITERR_CHECK_ALLOC(st);\n\n#ifdef GIT_CURL\n\terror = git_curl_stream_new(&st->io, host, port);\n#else\n\terror = git_socket_stream_new(&st->io, host, port);\n#endif\n\n\tif (error < 0){\n\t\tgit__free(st);\n\t\treturn error;\n\t}\n\n\tst->ctx = SSLCreateContext(NULL, kSSLClientSide, kSSLStreamType);\n\tif (!st->ctx) {\n\t\tgiterr_set(GITERR_NET, \"failed to create SSL context\");\n\t\tgit__free(st);\n\t\treturn -1;\n\t}\n\n\tif ((ret = SSLSetIOFuncs(st->ctx, read_cb, write_cb)) != noErr ||\n\t    (ret = SSLSetConnection(st->ctx, st->io)) != noErr ||\n\t    (ret = SSLSetSessionOption(st->ctx, kSSLSessionOptionBreakOnServerAuth, true)) != noErr ||\n\t    (ret = SSLSetProtocolVersionMin(st->ctx, kTLSProtocol1)) != noErr ||\n\t    (ret = SSLSetProtocolVersionMax(st->ctx, kTLSProtocol12)) != noErr ||\n\t    (ret = SSLSetPeerDomainName(st->ctx, host, strlen(host))) != noErr) {\n\t\tCFRelease(st->ctx);\n\t\tgit__free(st);\n\t\treturn stransport_error(ret);\n\t}\n\n\tst->parent.version = GIT_STREAM_VERSION;\n\tst->parent.encrypted = 1;\n\tst->parent.proxy_support = git_stream_supports_proxy(st->io);\n\tst->parent.connect = stransport_connect;\n\tst->parent.certificate = stransport_certificate;\n\tst->parent.set_proxy = stransport_set_proxy;\n\tst->parent.read = stransport_read;\n\tst->parent.write = stransport_write;\n\tst->parent.close = stransport_close;\n\tst->parent.free = stransport_free;\n\n\t*out = (git_stream *) st;\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "tls_ctor",
          "args": [
            "out",
            "host",
            "port"
          ],
          "line": 27
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"stransport_stream.h\"\n#include \"openssl_stream.h\"\n#include \"common.h\"\n#include \"git2/errors.h\"\n\nstatic git_stream_cb tls_ctor;\n\nint git_tls_stream_new(git_stream **out, const char *host, const char *port)\n{\n\n\tif (tls_ctor)\n\t\treturn tls_ctor(out, host, port);\n\n#ifdef GIT_SECURE_TRANSPORT\n\treturn git_stransport_stream_new(out, host, port);\n#elif defined(GIT_OPENSSL)\n\treturn git_openssl_stream_new(out, host, port);\n#else\n\tGIT_UNUSED(out);\n\tGIT_UNUSED(host);\n\tGIT_UNUSED(port);\n\n\tgiterr_set(GITERR_SSL, \"there is no TLS stream available\");\n\treturn -1;\n#endif\n}"
  },
  {
    "function_name": "git_stream_register_tls",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10130/repo/src/tls_stream.c",
    "lines": "16-21",
    "snippet": "int git_stream_register_tls(git_stream_cb ctor)\n{\n\ttls_ctor = ctor;\n\n\treturn 0;\n}",
    "includes": [
      "#include \"stransport_stream.h\"",
      "#include \"openssl_stream.h\"",
      "#include \"common.h\"",
      "#include \"git2/errors.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static git_stream_cb tls_ctor;"
    ],
    "called_functions": [],
    "contextual_snippet": "#include \"stransport_stream.h\"\n#include \"openssl_stream.h\"\n#include \"common.h\"\n#include \"git2/errors.h\"\n\nstatic git_stream_cb tls_ctor;\n\nint git_stream_register_tls(git_stream_cb ctor)\n{\n\ttls_ctor = ctor;\n\n\treturn 0;\n}"
  }
]