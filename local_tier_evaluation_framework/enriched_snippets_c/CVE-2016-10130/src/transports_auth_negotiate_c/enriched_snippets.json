[
  {
    "function_name": "git_http_auth_negotiate",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10130/repo/src/transports/auth_negotiate.c",
    "lines": "247-272",
    "snippet": "int git_http_auth_negotiate(\n\tgit_http_auth_context **out,\n\tconst gitno_connection_data *connection_data)\n{\n\thttp_auth_negotiate_context *ctx;\n\n\t*out = NULL;\n\n\tctx = git__calloc(1, sizeof(http_auth_negotiate_context));\n\tGITERR_CHECK_ALLOC(ctx);\n\n\tif (negotiate_init_context(ctx, connection_data) < 0) {\n\t\tgit__free(ctx);\n\t\treturn -1;\n\t}\n\n\tctx->parent.type = GIT_AUTHTYPE_NEGOTIATE;\n\tctx->parent.credtypes = GIT_CREDTYPE_DEFAULT;\n\tctx->parent.set_challenge = negotiate_set_challenge;\n\tctx->parent.next_token = negotiate_next_token;\n\tctx->parent.free = negotiate_context_free;\n\n\t*out = (git_http_auth_context *)ctx;\n\n\treturn 0;\n}",
    "includes": [
      "#include <krb5.h>",
      "#include <gssapi.h>",
      "#include \"auth.h\"",
      "#include \"buffer.h\"",
      "#include \"common.h\"",
      "#include \"git2.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "git__free",
          "args": [
            "ctx"
          ],
          "line": 259
        },
        "resolved": true,
        "details": {
          "function_name": "git__free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10130/repo/src/util.h",
          "lines": "244-247",
          "snippet": "GIT_INLINE(void) git__free(void *ptr)\n{\n\tfree(ptr);\n}",
          "includes": [
            "#include <sys/time.h>",
            "#include <proto/timer.h>",
            "#include <mach/mach_time.h>",
            "#include \"thread-utils.h\"",
            "#include \"strnlen.h\"",
            "#include \"common.h\"",
            "#include \"win32/w32_crtdbg_stacktrace.h\"",
            "#include <crtdbg.h>",
            "#include <stdlib.h>",
            "#include \"buffer.h\"",
            "#include \"git2/buffer.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/time.h>\n#include <proto/timer.h>\n#include <mach/mach_time.h>\n#include \"thread-utils.h\"\n#include \"strnlen.h\"\n#include \"common.h\"\n#include \"win32/w32_crtdbg_stacktrace.h\"\n#include <crtdbg.h>\n#include <stdlib.h>\n#include \"buffer.h\"\n#include \"git2/buffer.h\"\n\nGIT_INLINE(void) git__free(void *ptr)\n{\n\tfree(ptr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "negotiate_init_context",
          "args": [
            "ctx",
            "connection_data"
          ],
          "line": 258
        },
        "resolved": true,
        "details": {
          "function_name": "negotiate_init_context",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10130/repo/src/transports/auth_negotiate.c",
          "lines": "193-245",
          "snippet": "static int negotiate_init_context(\n\thttp_auth_negotiate_context *ctx,\n\tconst gitno_connection_data *connection_data)\n{\n\tOM_uint32 status_major, status_minor;\n\tgss_OID item, *oid;\n\tgss_OID_set mechanism_list;\n\tsize_t i;\n\n\t/* Query supported mechanisms looking for SPNEGO) */\n\tif (GSS_ERROR(status_major =\n\t\tgss_indicate_mechs(&status_minor, &mechanism_list))) {\n\t\tnegotiate_err_set(status_major, status_minor,\n\t\t\t\"could not query mechanisms\");\n\t\treturn -1;\n\t}\n\n\tif (mechanism_list) {\n\t\tfor (oid = negotiate_oids; *oid; oid++) {\n\t\t\tfor (i = 0; i < mechanism_list->count; i++) {\n\t\t\t\titem = &mechanism_list->elements[i];\n\n\t\t\t\tif (item->length == (*oid)->length &&\n\t\t\t\t\tmemcmp(item->elements, (*oid)->elements, item->length) == 0) {\n\t\t\t\t\tctx->oid = *oid;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif (ctx->oid)\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tgss_release_oid_set(&status_minor, &mechanism_list);\n\n\tif (!ctx->oid) {\n\t\tgiterr_set(GITERR_NET, \"Negotiate authentication is not supported\");\n\t\treturn -1;\n\t}\n\n\tgit_buf_puts(&ctx->target, \"HTTP@\");\n\tgit_buf_puts(&ctx->target, connection_data->host);\n\n\tif (git_buf_oom(&ctx->target))\n\t\treturn -1;\n\n\tctx->gss_context = GSS_C_NO_CONTEXT;\n\tctx->configured = 1;\n\n\treturn 0;\n}",
          "includes": [
            "#include <krb5.h>",
            "#include <gssapi.h>",
            "#include \"auth.h\"",
            "#include \"buffer.h\"",
            "#include \"common.h\"",
            "#include \"git2.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <krb5.h>\n#include <gssapi.h>\n#include \"auth.h\"\n#include \"buffer.h\"\n#include \"common.h\"\n#include \"git2.h\"\n\nstatic int negotiate_init_context(\n\thttp_auth_negotiate_context *ctx,\n\tconst gitno_connection_data *connection_data)\n{\n\tOM_uint32 status_major, status_minor;\n\tgss_OID item, *oid;\n\tgss_OID_set mechanism_list;\n\tsize_t i;\n\n\t/* Query supported mechanisms looking for SPNEGO) */\n\tif (GSS_ERROR(status_major =\n\t\tgss_indicate_mechs(&status_minor, &mechanism_list))) {\n\t\tnegotiate_err_set(status_major, status_minor,\n\t\t\t\"could not query mechanisms\");\n\t\treturn -1;\n\t}\n\n\tif (mechanism_list) {\n\t\tfor (oid = negotiate_oids; *oid; oid++) {\n\t\t\tfor (i = 0; i < mechanism_list->count; i++) {\n\t\t\t\titem = &mechanism_list->elements[i];\n\n\t\t\t\tif (item->length == (*oid)->length &&\n\t\t\t\t\tmemcmp(item->elements, (*oid)->elements, item->length) == 0) {\n\t\t\t\t\tctx->oid = *oid;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif (ctx->oid)\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tgss_release_oid_set(&status_minor, &mechanism_list);\n\n\tif (!ctx->oid) {\n\t\tgiterr_set(GITERR_NET, \"Negotiate authentication is not supported\");\n\t\treturn -1;\n\t}\n\n\tgit_buf_puts(&ctx->target, \"HTTP@\");\n\tgit_buf_puts(&ctx->target, connection_data->host);\n\n\tif (git_buf_oom(&ctx->target))\n\t\treturn -1;\n\n\tctx->gss_context = GSS_C_NO_CONTEXT;\n\tctx->configured = 1;\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "GITERR_CHECK_ALLOC",
          "args": [
            "ctx"
          ],
          "line": 256
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "git__calloc",
          "args": [
            "1",
            "sizeof(http_auth_negotiate_context)"
          ],
          "line": 255
        },
        "resolved": true,
        "details": {
          "function_name": "git__calloc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10130/repo/src/util.h",
          "lines": "167-172",
          "snippet": "GIT_INLINE(void *) git__calloc(size_t nelem, size_t elsize)\n{\n\tvoid *ptr = calloc(nelem, elsize);\n\tif (!ptr) giterr_set_oom();\n\treturn ptr;\n}",
          "includes": [
            "#include <sys/time.h>",
            "#include <proto/timer.h>",
            "#include <mach/mach_time.h>",
            "#include \"thread-utils.h\"",
            "#include \"strnlen.h\"",
            "#include \"common.h\"",
            "#include \"win32/w32_crtdbg_stacktrace.h\"",
            "#include <crtdbg.h>",
            "#include <stdlib.h>",
            "#include \"buffer.h\"",
            "#include \"git2/buffer.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/time.h>\n#include <proto/timer.h>\n#include <mach/mach_time.h>\n#include \"thread-utils.h\"\n#include \"strnlen.h\"\n#include \"common.h\"\n#include \"win32/w32_crtdbg_stacktrace.h\"\n#include <crtdbg.h>\n#include <stdlib.h>\n#include \"buffer.h\"\n#include \"git2/buffer.h\"\n\nGIT_INLINE(void *) git__calloc(size_t nelem, size_t elsize)\n{\n\tvoid *ptr = calloc(nelem, elsize);\n\tif (!ptr) giterr_set_oom();\n\treturn ptr;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <krb5.h>\n#include <gssapi.h>\n#include \"auth.h\"\n#include \"buffer.h\"\n#include \"common.h\"\n#include \"git2.h\"\n\nint git_http_auth_negotiate(\n\tgit_http_auth_context **out,\n\tconst gitno_connection_data *connection_data)\n{\n\thttp_auth_negotiate_context *ctx;\n\n\t*out = NULL;\n\n\tctx = git__calloc(1, sizeof(http_auth_negotiate_context));\n\tGITERR_CHECK_ALLOC(ctx);\n\n\tif (negotiate_init_context(ctx, connection_data) < 0) {\n\t\tgit__free(ctx);\n\t\treturn -1;\n\t}\n\n\tctx->parent.type = GIT_AUTHTYPE_NEGOTIATE;\n\tctx->parent.credtypes = GIT_CREDTYPE_DEFAULT;\n\tctx->parent.set_challenge = negotiate_set_challenge;\n\tctx->parent.next_token = negotiate_next_token;\n\tctx->parent.free = negotiate_context_free;\n\n\t*out = (git_http_auth_context *)ctx;\n\n\treturn 0;\n}"
  },
  {
    "function_name": "negotiate_init_context",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10130/repo/src/transports/auth_negotiate.c",
    "lines": "193-245",
    "snippet": "static int negotiate_init_context(\n\thttp_auth_negotiate_context *ctx,\n\tconst gitno_connection_data *connection_data)\n{\n\tOM_uint32 status_major, status_minor;\n\tgss_OID item, *oid;\n\tgss_OID_set mechanism_list;\n\tsize_t i;\n\n\t/* Query supported mechanisms looking for SPNEGO) */\n\tif (GSS_ERROR(status_major =\n\t\tgss_indicate_mechs(&status_minor, &mechanism_list))) {\n\t\tnegotiate_err_set(status_major, status_minor,\n\t\t\t\"could not query mechanisms\");\n\t\treturn -1;\n\t}\n\n\tif (mechanism_list) {\n\t\tfor (oid = negotiate_oids; *oid; oid++) {\n\t\t\tfor (i = 0; i < mechanism_list->count; i++) {\n\t\t\t\titem = &mechanism_list->elements[i];\n\n\t\t\t\tif (item->length == (*oid)->length &&\n\t\t\t\t\tmemcmp(item->elements, (*oid)->elements, item->length) == 0) {\n\t\t\t\t\tctx->oid = *oid;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif (ctx->oid)\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tgss_release_oid_set(&status_minor, &mechanism_list);\n\n\tif (!ctx->oid) {\n\t\tgiterr_set(GITERR_NET, \"Negotiate authentication is not supported\");\n\t\treturn -1;\n\t}\n\n\tgit_buf_puts(&ctx->target, \"HTTP@\");\n\tgit_buf_puts(&ctx->target, connection_data->host);\n\n\tif (git_buf_oom(&ctx->target))\n\t\treturn -1;\n\n\tctx->gss_context = GSS_C_NO_CONTEXT;\n\tctx->configured = 1;\n\n\treturn 0;\n}",
    "includes": [
      "#include <krb5.h>",
      "#include <gssapi.h>",
      "#include \"auth.h\"",
      "#include \"buffer.h\"",
      "#include \"common.h\"",
      "#include \"git2.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "git_buf_oom",
          "args": [
            "&ctx->target"
          ],
          "line": 238
        },
        "resolved": true,
        "details": {
          "function_name": "git_buf_oom",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10130/repo/src/buffer.h",
          "lines": "94-97",
          "snippet": "GIT_INLINE(bool) git_buf_oom(const git_buf *buf)\n{\n\treturn (buf->ptr == git_buf__oom);\n}",
          "includes": [
            "#include \"git2/buffer.h\"",
            "#include \"git2/strarray.h\"",
            "#include \"common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"git2/buffer.h\"\n#include \"git2/strarray.h\"\n#include \"common.h\"\n\nGIT_INLINE(bool) git_buf_oom(const git_buf *buf)\n{\n\treturn (buf->ptr == git_buf__oom);\n}"
        }
      },
      {
        "call_info": {
          "callee": "git_buf_puts",
          "args": [
            "&ctx->target",
            "connection_data->host"
          ],
          "line": 236
        },
        "resolved": true,
        "details": {
          "function_name": "git_buf_puts",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10130/repo/src/buffer.c",
          "lines": "225-229",
          "snippet": "int git_buf_puts(git_buf *buf, const char *string)\n{\n\tassert(string);\n\treturn git_buf_put(buf, string, strlen(string));\n}",
          "includes": [
            "#include <ctype.h>",
            "#include \"buf_text.h\"",
            "#include \"git2/buffer.h\"",
            "#include \"posix.h\"",
            "#include \"buffer.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <ctype.h>\n#include \"buf_text.h\"\n#include \"git2/buffer.h\"\n#include \"posix.h\"\n#include \"buffer.h\"\n\nint git_buf_puts(git_buf *buf, const char *string)\n{\n\tassert(string);\n\treturn git_buf_put(buf, string, strlen(string));\n}"
        }
      },
      {
        "call_info": {
          "callee": "giterr_set",
          "args": [
            "GITERR_NET",
            "\"Negotiate authentication is not supported\""
          ],
          "line": 231
        },
        "resolved": true,
        "details": {
          "function_name": "giterr_set_after_callback_function",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10130/repo/src/common.h",
          "lines": "122-132",
          "snippet": "GIT_INLINE(int) giterr_set_after_callback_function(\n\tint error_code, const char *action)\n{\n\tif (error_code) {\n\t\tconst git_error *e = giterr_last();\n\t\tif (!e || !e->message)\n\t\t\tgiterr_set(e ? e->klass : GITERR_CALLBACK,\n\t\t\t\t\"%s callback returned %d\", action, error_code);\n\t}\n\treturn error_code;\n}",
          "includes": [
            "#include \"util.h\"",
            "#include <regex.h>",
            "#include \"integer.h\"",
            "#include \"thread-utils.h\"",
            "#include \"git2/errors.h\"",
            "#include \"git2/types.h\"",
            "# include <arpa/inet.h>",
            "#\tinclude <sched.h>",
            "#\tinclude <pthread.h>",
            "# include <strings.h>",
            "# include <unistd.h>",
            "#   include \"win32/w32_crtdbg_stacktrace.h\"",
            "#   include \"win32/w32_stack.h\"",
            "#\tinclude \"win32/thread.h\"",
            "# include \"win32/version.h\"",
            "# include \"win32/error.h\"",
            "# include \"win32/win32-compat.h\"",
            "# include \"win32/mingw-compat.h\"",
            "# include \"win32/msvc-compat.h\"",
            "# include <ws2tcpip.h>",
            "# include <windows.h>",
            "# include <winsock2.h>",
            "# include <direct.h>",
            "# include <io.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <limits.h>",
            "#include <errno.h>",
            "#include <assert.h>",
            "#include \"cc-compat.h\"",
            "#include \"git2/common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util.h\"\n#include <regex.h>\n#include \"integer.h\"\n#include \"thread-utils.h\"\n#include \"git2/errors.h\"\n#include \"git2/types.h\"\n# include <arpa/inet.h>\n#\tinclude <sched.h>\n#\tinclude <pthread.h>\n# include <strings.h>\n# include <unistd.h>\n#   include \"win32/w32_crtdbg_stacktrace.h\"\n#   include \"win32/w32_stack.h\"\n#\tinclude \"win32/thread.h\"\n# include \"win32/version.h\"\n# include \"win32/error.h\"\n# include \"win32/win32-compat.h\"\n# include \"win32/mingw-compat.h\"\n# include \"win32/msvc-compat.h\"\n# include <ws2tcpip.h>\n# include <windows.h>\n# include <winsock2.h>\n# include <direct.h>\n# include <io.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <limits.h>\n#include <errno.h>\n#include <assert.h>\n#include \"cc-compat.h\"\n#include \"git2/common.h\"\n\nGIT_INLINE(int) giterr_set_after_callback_function(\n\tint error_code, const char *action)\n{\n\tif (error_code) {\n\t\tconst git_error *e = giterr_last();\n\t\tif (!e || !e->message)\n\t\t\tgiterr_set(e ? e->klass : GITERR_CALLBACK,\n\t\t\t\t\"%s callback returned %d\", action, error_code);\n\t}\n\treturn error_code;\n}"
        }
      },
      {
        "call_info": {
          "callee": "gss_release_oid_set",
          "args": [
            "&status_minor",
            "&mechanism_list"
          ],
          "line": 228
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcmp",
          "args": [
            "item->elements",
            "(*oid)->elements",
            "item->length"
          ],
          "line": 216
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "negotiate_err_set",
          "args": [
            "status_major",
            "status_minor",
            "\"could not query mechanisms\""
          ],
          "line": 205
        },
        "resolved": true,
        "details": {
          "function_name": "negotiate_err_set",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10130/repo/src/transports/auth_negotiate.c",
          "lines": "36-54",
          "snippet": "static void negotiate_err_set(\n\tOM_uint32 status_major,\n\tOM_uint32 status_minor,\n\tconst char *message)\n{\n\tgss_buffer_desc buffer = GSS_C_EMPTY_BUFFER;\n\tOM_uint32 status_display, context = 0;\n\n\tif (gss_display_status(&status_display, status_major, GSS_C_GSS_CODE,\n\t\tGSS_C_NO_OID, &context, &buffer) == GSS_S_COMPLETE) {\n\t\tgiterr_set(GITERR_NET, \"%s: %.*s (%d.%d)\",\n\t\t\tmessage, (int)buffer.length, (const char *)buffer.value,\n\t\t\tstatus_major, status_minor);\n\t\tgss_release_buffer(&status_minor, &buffer);\n\t} else {\n\t\tgiterr_set(GITERR_NET, \"%s: unknown negotiate error (%d.%d)\",\n\t\t\tmessage, status_major, status_minor);\n\t}\n}",
          "includes": [
            "#include <krb5.h>",
            "#include <gssapi.h>",
            "#include \"auth.h\"",
            "#include \"buffer.h\"",
            "#include \"common.h\"",
            "#include \"git2.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <krb5.h>\n#include <gssapi.h>\n#include \"auth.h\"\n#include \"buffer.h\"\n#include \"common.h\"\n#include \"git2.h\"\n\nstatic void negotiate_err_set(\n\tOM_uint32 status_major,\n\tOM_uint32 status_minor,\n\tconst char *message)\n{\n\tgss_buffer_desc buffer = GSS_C_EMPTY_BUFFER;\n\tOM_uint32 status_display, context = 0;\n\n\tif (gss_display_status(&status_display, status_major, GSS_C_GSS_CODE,\n\t\tGSS_C_NO_OID, &context, &buffer) == GSS_S_COMPLETE) {\n\t\tgiterr_set(GITERR_NET, \"%s: %.*s (%d.%d)\",\n\t\t\tmessage, (int)buffer.length, (const char *)buffer.value,\n\t\t\tstatus_major, status_minor);\n\t\tgss_release_buffer(&status_minor, &buffer);\n\t} else {\n\t\tgiterr_set(GITERR_NET, \"%s: unknown negotiate error (%d.%d)\",\n\t\t\tmessage, status_major, status_minor);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "GSS_ERROR",
          "args": [
            "status_major =\n\t\tgss_indicate_mechs(&status_minor, &mechanism_list)"
          ],
          "line": 203
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gss_indicate_mechs",
          "args": [
            "&status_minor",
            "&mechanism_list"
          ],
          "line": 204
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <krb5.h>\n#include <gssapi.h>\n#include \"auth.h\"\n#include \"buffer.h\"\n#include \"common.h\"\n#include \"git2.h\"\n\nstatic int negotiate_init_context(\n\thttp_auth_negotiate_context *ctx,\n\tconst gitno_connection_data *connection_data)\n{\n\tOM_uint32 status_major, status_minor;\n\tgss_OID item, *oid;\n\tgss_OID_set mechanism_list;\n\tsize_t i;\n\n\t/* Query supported mechanisms looking for SPNEGO) */\n\tif (GSS_ERROR(status_major =\n\t\tgss_indicate_mechs(&status_minor, &mechanism_list))) {\n\t\tnegotiate_err_set(status_major, status_minor,\n\t\t\t\"could not query mechanisms\");\n\t\treturn -1;\n\t}\n\n\tif (mechanism_list) {\n\t\tfor (oid = negotiate_oids; *oid; oid++) {\n\t\t\tfor (i = 0; i < mechanism_list->count; i++) {\n\t\t\t\titem = &mechanism_list->elements[i];\n\n\t\t\t\tif (item->length == (*oid)->length &&\n\t\t\t\t\tmemcmp(item->elements, (*oid)->elements, item->length) == 0) {\n\t\t\t\t\tctx->oid = *oid;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif (ctx->oid)\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tgss_release_oid_set(&status_minor, &mechanism_list);\n\n\tif (!ctx->oid) {\n\t\tgiterr_set(GITERR_NET, \"Negotiate authentication is not supported\");\n\t\treturn -1;\n\t}\n\n\tgit_buf_puts(&ctx->target, \"HTTP@\");\n\tgit_buf_puts(&ctx->target, connection_data->host);\n\n\tif (git_buf_oom(&ctx->target))\n\t\treturn -1;\n\n\tctx->gss_context = GSS_C_NO_CONTEXT;\n\tctx->configured = 1;\n\n\treturn 0;\n}"
  },
  {
    "function_name": "negotiate_context_free",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10130/repo/src/transports/auth_negotiate.c",
    "lines": "171-191",
    "snippet": "static void negotiate_context_free(git_http_auth_context *c)\n{\n\thttp_auth_negotiate_context *ctx = (http_auth_negotiate_context *)c;\n\tOM_uint32 status_minor;\n\n\tif (ctx->gss_context != GSS_C_NO_CONTEXT) {\n\t\tgss_delete_sec_context(\n\t\t\t&status_minor, &ctx->gss_context, GSS_C_NO_BUFFER);\n\t\tctx->gss_context = GSS_C_NO_CONTEXT;\n\t}\n\n\tgit_buf_free(&ctx->target);\n\n\tgit__free(ctx->challenge);\n\n\tctx->configured = 0;\n\tctx->complete = 0;\n\tctx->oid = NULL;\n\n\tgit__free(ctx);\n}",
    "includes": [
      "#include <krb5.h>",
      "#include <gssapi.h>",
      "#include \"auth.h\"",
      "#include \"buffer.h\"",
      "#include \"common.h\"",
      "#include \"git2.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "git__free",
          "args": [
            "ctx"
          ],
          "line": 190
        },
        "resolved": true,
        "details": {
          "function_name": "git__free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10130/repo/src/util.h",
          "lines": "244-247",
          "snippet": "GIT_INLINE(void) git__free(void *ptr)\n{\n\tfree(ptr);\n}",
          "includes": [
            "#include <sys/time.h>",
            "#include <proto/timer.h>",
            "#include <mach/mach_time.h>",
            "#include \"thread-utils.h\"",
            "#include \"strnlen.h\"",
            "#include \"common.h\"",
            "#include \"win32/w32_crtdbg_stacktrace.h\"",
            "#include <crtdbg.h>",
            "#include <stdlib.h>",
            "#include \"buffer.h\"",
            "#include \"git2/buffer.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/time.h>\n#include <proto/timer.h>\n#include <mach/mach_time.h>\n#include \"thread-utils.h\"\n#include \"strnlen.h\"\n#include \"common.h\"\n#include \"win32/w32_crtdbg_stacktrace.h\"\n#include <crtdbg.h>\n#include <stdlib.h>\n#include \"buffer.h\"\n#include \"git2/buffer.h\"\n\nGIT_INLINE(void) git__free(void *ptr)\n{\n\tfree(ptr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "git_buf_free",
          "args": [
            "&ctx->target"
          ],
          "line": 182
        },
        "resolved": true,
        "details": {
          "function_name": "git_buf_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10130/repo/src/buffer.c",
          "lines": "118-126",
          "snippet": "void git_buf_free(git_buf *buf)\n{\n\tif (!buf) return;\n\n\tif (buf->asize > 0 && buf->ptr != NULL && buf->ptr != git_buf__oom)\n\t\tgit__free(buf->ptr);\n\n\tgit_buf_init(buf, 0);\n}",
          "includes": [
            "#include <ctype.h>",
            "#include \"buf_text.h\"",
            "#include \"git2/buffer.h\"",
            "#include \"posix.h\"",
            "#include \"buffer.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "char git_buf__oom[1];"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <ctype.h>\n#include \"buf_text.h\"\n#include \"git2/buffer.h\"\n#include \"posix.h\"\n#include \"buffer.h\"\n\nchar git_buf__oom[1];\n\nvoid git_buf_free(git_buf *buf)\n{\n\tif (!buf) return;\n\n\tif (buf->asize > 0 && buf->ptr != NULL && buf->ptr != git_buf__oom)\n\t\tgit__free(buf->ptr);\n\n\tgit_buf_init(buf, 0);\n}"
        }
      },
      {
        "call_info": {
          "callee": "gss_delete_sec_context",
          "args": [
            "&status_minor",
            "&ctx->gss_context",
            "GSS_C_NO_BUFFER"
          ],
          "line": 177
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <krb5.h>\n#include <gssapi.h>\n#include \"auth.h\"\n#include \"buffer.h\"\n#include \"common.h\"\n#include \"git2.h\"\n\nstatic void negotiate_context_free(git_http_auth_context *c)\n{\n\thttp_auth_negotiate_context *ctx = (http_auth_negotiate_context *)c;\n\tOM_uint32 status_minor;\n\n\tif (ctx->gss_context != GSS_C_NO_CONTEXT) {\n\t\tgss_delete_sec_context(\n\t\t\t&status_minor, &ctx->gss_context, GSS_C_NO_BUFFER);\n\t\tctx->gss_context = GSS_C_NO_CONTEXT;\n\t}\n\n\tgit_buf_free(&ctx->target);\n\n\tgit__free(ctx->challenge);\n\n\tctx->configured = 0;\n\tctx->complete = 0;\n\tctx->oid = NULL;\n\n\tgit__free(ctx);\n}"
  },
  {
    "function_name": "negotiate_next_token",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10130/repo/src/transports/auth_negotiate.c",
    "lines": "72-169",
    "snippet": "static int negotiate_next_token(\n\tgit_buf *buf,\n\tgit_http_auth_context *c,\n\tgit_cred *cred)\n{\n\thttp_auth_negotiate_context *ctx = (http_auth_negotiate_context *)c;\n\tOM_uint32 status_major, status_minor;\n\tgss_buffer_desc target_buffer = GSS_C_EMPTY_BUFFER,\n\t\tinput_token = GSS_C_EMPTY_BUFFER,\n\t\toutput_token = GSS_C_EMPTY_BUFFER;\n\tgss_buffer_t input_token_ptr = GSS_C_NO_BUFFER;\n\tgit_buf input_buf = GIT_BUF_INIT;\n\tgss_name_t server = NULL;\n\tgss_OID mech;\n\tsize_t challenge_len;\n\tint error = 0;\n\n\tassert(buf && ctx && ctx->configured && cred && cred->credtype == GIT_CREDTYPE_DEFAULT);\n\n\tif (ctx->complete)\n\t\treturn 0;\n\n\ttarget_buffer.value = (void *)ctx->target.ptr;\n\ttarget_buffer.length = ctx->target.size;\n\n\tstatus_major = gss_import_name(&status_minor, &target_buffer,\n\t\tGSS_C_NT_HOSTBASED_SERVICE, &server);\n\n\tif (GSS_ERROR(status_major)) {\n\t\tnegotiate_err_set(status_major, status_minor,\n\t\t\t\"Could not parse principal\");\n\t\terror = -1;\n\t\tgoto done;\n\t}\n\n\tchallenge_len = ctx->challenge ? strlen(ctx->challenge) : 0;\n\n\tif (challenge_len < 9) {\n\t\tgiterr_set(GITERR_NET, \"No negotiate challenge sent from server\");\n\t\terror = -1;\n\t\tgoto done;\n\t} else if (challenge_len > 9) {\n\t\tif (git_buf_decode_base64(&input_buf,\n\t\t\t\tctx->challenge + 10, challenge_len - 10) < 0) {\n\t\t\tgiterr_set(GITERR_NET, \"Invalid negotiate challenge from server\");\n\t\t\terror = -1;\n\t\t\tgoto done;\n\t\t}\n\n\t\tinput_token.value = input_buf.ptr;\n\t\tinput_token.length = input_buf.size;\n\t\tinput_token_ptr = &input_token;\n\t} else if (ctx->gss_context != GSS_C_NO_CONTEXT) {\n\t\tgiterr_set(GITERR_NET, \"Could not restart authentication\");\n\t\terror = -1;\n\t\tgoto done;\n\t}\n\n\tmech = &negotiate_oid_spnego;\n\n\tif (GSS_ERROR(status_major = gss_init_sec_context(\n\t\t&status_minor,\n\t\tGSS_C_NO_CREDENTIAL,\n\t\t&ctx->gss_context,\n\t\tserver,\n\t\tmech,\n\t\tGSS_C_DELEG_FLAG | GSS_C_MUTUAL_FLAG,\n\t\tGSS_C_INDEFINITE,\n\t\tGSS_C_NO_CHANNEL_BINDINGS,\n\t\tinput_token_ptr,\n\t\tNULL,\n\t\t&output_token,\n\t\tNULL,\n\t\tNULL))) {\n\t\tnegotiate_err_set(status_major, status_minor, \"Negotiate failure\");\n\t\terror = -1;\n\t\tgoto done;\n\t}\n\n\t/* This message merely told us auth was complete; we do not respond. */\n\tif (status_major == GSS_S_COMPLETE) {\n\t\tctx->complete = 1;\n\t\tgoto done;\n\t}\n\n\tgit_buf_puts(buf, \"Authorization: Negotiate \");\n\tgit_buf_encode_base64(buf, output_token.value, output_token.length);\n\tgit_buf_puts(buf, \"\\r\\n\");\n\n\tif (git_buf_oom(buf))\n\t\terror = -1;\n\ndone:\n\tgss_release_name(&status_minor, &server);\n\tgss_release_buffer(&status_minor, (gss_buffer_t) &output_token);\n\tgit_buf_free(&input_buf);\n\treturn error;\n}",
    "includes": [
      "#include <krb5.h>",
      "#include <gssapi.h>",
      "#include \"auth.h\"",
      "#include \"buffer.h\"",
      "#include \"common.h\"",
      "#include \"git2.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "git_buf_free",
          "args": [
            "&input_buf"
          ],
          "line": 167
        },
        "resolved": true,
        "details": {
          "function_name": "git_buf_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10130/repo/src/buffer.c",
          "lines": "118-126",
          "snippet": "void git_buf_free(git_buf *buf)\n{\n\tif (!buf) return;\n\n\tif (buf->asize > 0 && buf->ptr != NULL && buf->ptr != git_buf__oom)\n\t\tgit__free(buf->ptr);\n\n\tgit_buf_init(buf, 0);\n}",
          "includes": [
            "#include <ctype.h>",
            "#include \"buf_text.h\"",
            "#include \"git2/buffer.h\"",
            "#include \"posix.h\"",
            "#include \"buffer.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "char git_buf__oom[1];"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <ctype.h>\n#include \"buf_text.h\"\n#include \"git2/buffer.h\"\n#include \"posix.h\"\n#include \"buffer.h\"\n\nchar git_buf__oom[1];\n\nvoid git_buf_free(git_buf *buf)\n{\n\tif (!buf) return;\n\n\tif (buf->asize > 0 && buf->ptr != NULL && buf->ptr != git_buf__oom)\n\t\tgit__free(buf->ptr);\n\n\tgit_buf_init(buf, 0);\n}"
        }
      },
      {
        "call_info": {
          "callee": "gss_release_buffer",
          "args": [
            "&status_minor",
            "(gss_buffer_t) &output_token"
          ],
          "line": 166
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gss_release_name",
          "args": [
            "&status_minor",
            "&server"
          ],
          "line": 165
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "git_buf_oom",
          "args": [
            "buf"
          ],
          "line": 161
        },
        "resolved": true,
        "details": {
          "function_name": "git_buf_oom",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10130/repo/src/buffer.h",
          "lines": "94-97",
          "snippet": "GIT_INLINE(bool) git_buf_oom(const git_buf *buf)\n{\n\treturn (buf->ptr == git_buf__oom);\n}",
          "includes": [
            "#include \"git2/buffer.h\"",
            "#include \"git2/strarray.h\"",
            "#include \"common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"git2/buffer.h\"\n#include \"git2/strarray.h\"\n#include \"common.h\"\n\nGIT_INLINE(bool) git_buf_oom(const git_buf *buf)\n{\n\treturn (buf->ptr == git_buf__oom);\n}"
        }
      },
      {
        "call_info": {
          "callee": "git_buf_puts",
          "args": [
            "buf",
            "\"\\r\\n\""
          ],
          "line": 159
        },
        "resolved": true,
        "details": {
          "function_name": "git_buf_puts",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10130/repo/src/buffer.c",
          "lines": "225-229",
          "snippet": "int git_buf_puts(git_buf *buf, const char *string)\n{\n\tassert(string);\n\treturn git_buf_put(buf, string, strlen(string));\n}",
          "includes": [
            "#include <ctype.h>",
            "#include \"buf_text.h\"",
            "#include \"git2/buffer.h\"",
            "#include \"posix.h\"",
            "#include \"buffer.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <ctype.h>\n#include \"buf_text.h\"\n#include \"git2/buffer.h\"\n#include \"posix.h\"\n#include \"buffer.h\"\n\nint git_buf_puts(git_buf *buf, const char *string)\n{\n\tassert(string);\n\treturn git_buf_put(buf, string, strlen(string));\n}"
        }
      },
      {
        "call_info": {
          "callee": "git_buf_encode_base64",
          "args": [
            "buf",
            "output_token.value",
            "output_token.length"
          ],
          "line": 158
        },
        "resolved": true,
        "details": {
          "function_name": "git_buf_encode_base64",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10130/repo/src/buffer.c",
          "lines": "234-274",
          "snippet": "int git_buf_encode_base64(git_buf *buf, const char *data, size_t len)\n{\n\tsize_t extra = len % 3;\n\tuint8_t *write, a, b, c;\n\tconst uint8_t *read = (const uint8_t *)data;\n\tsize_t blocks = (len / 3) + !!extra, alloclen;\n\n\tGITERR_CHECK_ALLOC_ADD(&blocks, blocks, 1);\n\tGITERR_CHECK_ALLOC_MULTIPLY(&alloclen, blocks, 4);\n\tGITERR_CHECK_ALLOC_ADD(&alloclen, alloclen, buf->size);\n\n\tENSURE_SIZE(buf, alloclen);\n\twrite = (uint8_t *)&buf->ptr[buf->size];\n\n\t/* convert each run of 3 bytes into 4 output bytes */\n\tfor (len -= extra; len > 0; len -= 3) {\n\t\ta = *read++;\n\t\tb = *read++;\n\t\tc = *read++;\n\n\t\t*write++ = base64_encode[a >> 2];\n\t\t*write++ = base64_encode[(a & 0x03) << 4 | b >> 4];\n\t\t*write++ = base64_encode[(b & 0x0f) << 2 | c >> 6];\n\t\t*write++ = base64_encode[c & 0x3f];\n\t}\n\n\tif (extra > 0) {\n\t\ta = *read++;\n\t\tb = (extra > 1) ? *read++ : 0;\n\n\t\t*write++ = base64_encode[a >> 2];\n\t\t*write++ = base64_encode[(a & 0x03) << 4 | b >> 4];\n\t\t*write++ = (extra > 1) ? base64_encode[(b & 0x0f) << 2] : '=';\n\t\t*write++ = '=';\n\t}\n\n\tbuf->size = ((char *)write) - buf->ptr;\n\tbuf->ptr[buf->size] = '\\0';\n\n\treturn 0;\n}",
          "includes": [
            "#include <ctype.h>",
            "#include \"buf_text.h\"",
            "#include \"git2/buffer.h\"",
            "#include \"posix.h\"",
            "#include \"buffer.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static const char base64_encode[] =\n\t\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\";"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <ctype.h>\n#include \"buf_text.h\"\n#include \"git2/buffer.h\"\n#include \"posix.h\"\n#include \"buffer.h\"\n\nstatic const char base64_encode[] =\n\t\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\";\n\nint git_buf_encode_base64(git_buf *buf, const char *data, size_t len)\n{\n\tsize_t extra = len % 3;\n\tuint8_t *write, a, b, c;\n\tconst uint8_t *read = (const uint8_t *)data;\n\tsize_t blocks = (len / 3) + !!extra, alloclen;\n\n\tGITERR_CHECK_ALLOC_ADD(&blocks, blocks, 1);\n\tGITERR_CHECK_ALLOC_MULTIPLY(&alloclen, blocks, 4);\n\tGITERR_CHECK_ALLOC_ADD(&alloclen, alloclen, buf->size);\n\n\tENSURE_SIZE(buf, alloclen);\n\twrite = (uint8_t *)&buf->ptr[buf->size];\n\n\t/* convert each run of 3 bytes into 4 output bytes */\n\tfor (len -= extra; len > 0; len -= 3) {\n\t\ta = *read++;\n\t\tb = *read++;\n\t\tc = *read++;\n\n\t\t*write++ = base64_encode[a >> 2];\n\t\t*write++ = base64_encode[(a & 0x03) << 4 | b >> 4];\n\t\t*write++ = base64_encode[(b & 0x0f) << 2 | c >> 6];\n\t\t*write++ = base64_encode[c & 0x3f];\n\t}\n\n\tif (extra > 0) {\n\t\ta = *read++;\n\t\tb = (extra > 1) ? *read++ : 0;\n\n\t\t*write++ = base64_encode[a >> 2];\n\t\t*write++ = base64_encode[(a & 0x03) << 4 | b >> 4];\n\t\t*write++ = (extra > 1) ? base64_encode[(b & 0x0f) << 2] : '=';\n\t\t*write++ = '=';\n\t}\n\n\tbuf->size = ((char *)write) - buf->ptr;\n\tbuf->ptr[buf->size] = '\\0';\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "negotiate_err_set",
          "args": [
            "status_major",
            "status_minor",
            "\"Negotiate failure\""
          ],
          "line": 146
        },
        "resolved": true,
        "details": {
          "function_name": "negotiate_err_set",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10130/repo/src/transports/auth_negotiate.c",
          "lines": "36-54",
          "snippet": "static void negotiate_err_set(\n\tOM_uint32 status_major,\n\tOM_uint32 status_minor,\n\tconst char *message)\n{\n\tgss_buffer_desc buffer = GSS_C_EMPTY_BUFFER;\n\tOM_uint32 status_display, context = 0;\n\n\tif (gss_display_status(&status_display, status_major, GSS_C_GSS_CODE,\n\t\tGSS_C_NO_OID, &context, &buffer) == GSS_S_COMPLETE) {\n\t\tgiterr_set(GITERR_NET, \"%s: %.*s (%d.%d)\",\n\t\t\tmessage, (int)buffer.length, (const char *)buffer.value,\n\t\t\tstatus_major, status_minor);\n\t\tgss_release_buffer(&status_minor, &buffer);\n\t} else {\n\t\tgiterr_set(GITERR_NET, \"%s: unknown negotiate error (%d.%d)\",\n\t\t\tmessage, status_major, status_minor);\n\t}\n}",
          "includes": [
            "#include <krb5.h>",
            "#include <gssapi.h>",
            "#include \"auth.h\"",
            "#include \"buffer.h\"",
            "#include \"common.h\"",
            "#include \"git2.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <krb5.h>\n#include <gssapi.h>\n#include \"auth.h\"\n#include \"buffer.h\"\n#include \"common.h\"\n#include \"git2.h\"\n\nstatic void negotiate_err_set(\n\tOM_uint32 status_major,\n\tOM_uint32 status_minor,\n\tconst char *message)\n{\n\tgss_buffer_desc buffer = GSS_C_EMPTY_BUFFER;\n\tOM_uint32 status_display, context = 0;\n\n\tif (gss_display_status(&status_display, status_major, GSS_C_GSS_CODE,\n\t\tGSS_C_NO_OID, &context, &buffer) == GSS_S_COMPLETE) {\n\t\tgiterr_set(GITERR_NET, \"%s: %.*s (%d.%d)\",\n\t\t\tmessage, (int)buffer.length, (const char *)buffer.value,\n\t\t\tstatus_major, status_minor);\n\t\tgss_release_buffer(&status_minor, &buffer);\n\t} else {\n\t\tgiterr_set(GITERR_NET, \"%s: unknown negotiate error (%d.%d)\",\n\t\t\tmessage, status_major, status_minor);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "GSS_ERROR",
          "args": [
            "status_major = gss_init_sec_context(\n\t\t&status_minor,\n\t\tGSS_C_NO_CREDENTIAL,\n\t\t&ctx->gss_context,\n\t\tserver,\n\t\tmech,\n\t\tGSS_C_DELEG_FLAG | GSS_C_MUTUAL_FLAG,\n\t\tGSS_C_INDEFINITE,\n\t\tGSS_C_NO_CHANNEL_BINDINGS,\n\t\tinput_token_ptr,\n\t\tNULL,\n\t\t&output_token,\n\t\tNULL,\n\t\tNULL)"
          ],
          "line": 132
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gss_init_sec_context",
          "args": [
            "&status_minor",
            "GSS_C_NO_CREDENTIAL",
            "&ctx->gss_context",
            "server",
            "mech",
            "GSS_C_DELEG_FLAG | GSS_C_MUTUAL_FLAG",
            "GSS_C_INDEFINITE",
            "GSS_C_NO_CHANNEL_BINDINGS",
            "input_token_ptr",
            "NULL",
            "&output_token",
            "NULL",
            "NULL"
          ],
          "line": 132
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "giterr_set",
          "args": [
            "GITERR_NET",
            "\"Could not restart authentication\""
          ],
          "line": 125
        },
        "resolved": true,
        "details": {
          "function_name": "giterr_set_after_callback_function",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10130/repo/src/common.h",
          "lines": "122-132",
          "snippet": "GIT_INLINE(int) giterr_set_after_callback_function(\n\tint error_code, const char *action)\n{\n\tif (error_code) {\n\t\tconst git_error *e = giterr_last();\n\t\tif (!e || !e->message)\n\t\t\tgiterr_set(e ? e->klass : GITERR_CALLBACK,\n\t\t\t\t\"%s callback returned %d\", action, error_code);\n\t}\n\treturn error_code;\n}",
          "includes": [
            "#include \"util.h\"",
            "#include <regex.h>",
            "#include \"integer.h\"",
            "#include \"thread-utils.h\"",
            "#include \"git2/errors.h\"",
            "#include \"git2/types.h\"",
            "# include <arpa/inet.h>",
            "#\tinclude <sched.h>",
            "#\tinclude <pthread.h>",
            "# include <strings.h>",
            "# include <unistd.h>",
            "#   include \"win32/w32_crtdbg_stacktrace.h\"",
            "#   include \"win32/w32_stack.h\"",
            "#\tinclude \"win32/thread.h\"",
            "# include \"win32/version.h\"",
            "# include \"win32/error.h\"",
            "# include \"win32/win32-compat.h\"",
            "# include \"win32/mingw-compat.h\"",
            "# include \"win32/msvc-compat.h\"",
            "# include <ws2tcpip.h>",
            "# include <windows.h>",
            "# include <winsock2.h>",
            "# include <direct.h>",
            "# include <io.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdlib.h>",
            "#include <limits.h>",
            "#include <errno.h>",
            "#include <assert.h>",
            "#include \"cc-compat.h\"",
            "#include \"git2/common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util.h\"\n#include <regex.h>\n#include \"integer.h\"\n#include \"thread-utils.h\"\n#include \"git2/errors.h\"\n#include \"git2/types.h\"\n# include <arpa/inet.h>\n#\tinclude <sched.h>\n#\tinclude <pthread.h>\n# include <strings.h>\n# include <unistd.h>\n#   include \"win32/w32_crtdbg_stacktrace.h\"\n#   include \"win32/w32_stack.h\"\n#\tinclude \"win32/thread.h\"\n# include \"win32/version.h\"\n# include \"win32/error.h\"\n# include \"win32/win32-compat.h\"\n# include \"win32/mingw-compat.h\"\n# include \"win32/msvc-compat.h\"\n# include <ws2tcpip.h>\n# include <windows.h>\n# include <winsock2.h>\n# include <direct.h>\n# include <io.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <string.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <limits.h>\n#include <errno.h>\n#include <assert.h>\n#include \"cc-compat.h\"\n#include \"git2/common.h\"\n\nGIT_INLINE(int) giterr_set_after_callback_function(\n\tint error_code, const char *action)\n{\n\tif (error_code) {\n\t\tconst git_error *e = giterr_last();\n\t\tif (!e || !e->message)\n\t\t\tgiterr_set(e ? e->klass : GITERR_CALLBACK,\n\t\t\t\t\"%s callback returned %d\", action, error_code);\n\t}\n\treturn error_code;\n}"
        }
      },
      {
        "call_info": {
          "callee": "git_buf_decode_base64",
          "args": [
            "&input_buf",
            "ctx->challenge + 10",
            "challenge_len - 10"
          ],
          "line": 114
        },
        "resolved": true,
        "details": {
          "function_name": "git_buf_decode_base64",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10130/repo/src/buffer.c",
          "lines": "292-322",
          "snippet": "int git_buf_decode_base64(git_buf *buf, const char *base64, size_t len)\n{\n\tsize_t i;\n\tint8_t a, b, c, d;\n\tsize_t orig_size = buf->size, new_size;\n\n\tassert(len % 4 == 0);\n\tGITERR_CHECK_ALLOC_ADD(&new_size, (len / 4 * 3), buf->size);\n\tGITERR_CHECK_ALLOC_ADD(&new_size, new_size, 1);\n\tENSURE_SIZE(buf, new_size);\n\n\tfor (i = 0; i < len; i += 4) {\n\t\tif ((a = BASE64_DECODE_VALUE(base64[i])) < 0 ||\n\t\t\t(b = BASE64_DECODE_VALUE(base64[i+1])) < 0 ||\n\t\t\t(c = BASE64_DECODE_VALUE(base64[i+2])) < 0 ||\n\t\t\t(d = BASE64_DECODE_VALUE(base64[i+3])) < 0) {\n\t\t\tbuf->size = orig_size;\n\t\t\tbuf->ptr[buf->size] = '\\0';\n\n\t\t\tgiterr_set(GITERR_INVALID, \"Invalid base64 input\");\n\t\t\treturn -1;\n\t\t}\n\n\t\tbuf->ptr[buf->size++] = ((a << 2) | (b & 0x30) >> 4);\n\t\tbuf->ptr[buf->size++] = ((b & 0x0f) << 4) | ((c & 0x3c) >> 2);\n\t\tbuf->ptr[buf->size++] = (c & 0x03) << 6 | (d & 0x3f);\n\t}\n\n\tbuf->ptr[buf->size] = '\\0';\n\treturn 0;\n}",
          "includes": [
            "#include <ctype.h>",
            "#include \"buf_text.h\"",
            "#include \"git2/buffer.h\"",
            "#include \"posix.h\"",
            "#include \"buffer.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <ctype.h>\n#include \"buf_text.h\"\n#include \"git2/buffer.h\"\n#include \"posix.h\"\n#include \"buffer.h\"\n\nint git_buf_decode_base64(git_buf *buf, const char *base64, size_t len)\n{\n\tsize_t i;\n\tint8_t a, b, c, d;\n\tsize_t orig_size = buf->size, new_size;\n\n\tassert(len % 4 == 0);\n\tGITERR_CHECK_ALLOC_ADD(&new_size, (len / 4 * 3), buf->size);\n\tGITERR_CHECK_ALLOC_ADD(&new_size, new_size, 1);\n\tENSURE_SIZE(buf, new_size);\n\n\tfor (i = 0; i < len; i += 4) {\n\t\tif ((a = BASE64_DECODE_VALUE(base64[i])) < 0 ||\n\t\t\t(b = BASE64_DECODE_VALUE(base64[i+1])) < 0 ||\n\t\t\t(c = BASE64_DECODE_VALUE(base64[i+2])) < 0 ||\n\t\t\t(d = BASE64_DECODE_VALUE(base64[i+3])) < 0) {\n\t\t\tbuf->size = orig_size;\n\t\t\tbuf->ptr[buf->size] = '\\0';\n\n\t\t\tgiterr_set(GITERR_INVALID, \"Invalid base64 input\");\n\t\t\treturn -1;\n\t\t}\n\n\t\tbuf->ptr[buf->size++] = ((a << 2) | (b & 0x30) >> 4);\n\t\tbuf->ptr[buf->size++] = ((b & 0x0f) << 4) | ((c & 0x3c) >> 2);\n\t\tbuf->ptr[buf->size++] = (c & 0x03) << 6 | (d & 0x3f);\n\t}\n\n\tbuf->ptr[buf->size] = '\\0';\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "ctx->challenge"
          ],
          "line": 107
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "GSS_ERROR",
          "args": [
            "status_major"
          ],
          "line": 100
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gss_import_name",
          "args": [
            "&status_minor",
            "&target_buffer",
            "GSS_C_NT_HOSTBASED_SERVICE",
            "&server"
          ],
          "line": 97
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "assert",
          "args": [
            "buf && ctx && ctx->configured && cred && cred->credtype == GIT_CREDTYPE_DEFAULT"
          ],
          "line": 89
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <krb5.h>\n#include <gssapi.h>\n#include \"auth.h\"\n#include \"buffer.h\"\n#include \"common.h\"\n#include \"git2.h\"\n\nstatic int negotiate_next_token(\n\tgit_buf *buf,\n\tgit_http_auth_context *c,\n\tgit_cred *cred)\n{\n\thttp_auth_negotiate_context *ctx = (http_auth_negotiate_context *)c;\n\tOM_uint32 status_major, status_minor;\n\tgss_buffer_desc target_buffer = GSS_C_EMPTY_BUFFER,\n\t\tinput_token = GSS_C_EMPTY_BUFFER,\n\t\toutput_token = GSS_C_EMPTY_BUFFER;\n\tgss_buffer_t input_token_ptr = GSS_C_NO_BUFFER;\n\tgit_buf input_buf = GIT_BUF_INIT;\n\tgss_name_t server = NULL;\n\tgss_OID mech;\n\tsize_t challenge_len;\n\tint error = 0;\n\n\tassert(buf && ctx && ctx->configured && cred && cred->credtype == GIT_CREDTYPE_DEFAULT);\n\n\tif (ctx->complete)\n\t\treturn 0;\n\n\ttarget_buffer.value = (void *)ctx->target.ptr;\n\ttarget_buffer.length = ctx->target.size;\n\n\tstatus_major = gss_import_name(&status_minor, &target_buffer,\n\t\tGSS_C_NT_HOSTBASED_SERVICE, &server);\n\n\tif (GSS_ERROR(status_major)) {\n\t\tnegotiate_err_set(status_major, status_minor,\n\t\t\t\"Could not parse principal\");\n\t\terror = -1;\n\t\tgoto done;\n\t}\n\n\tchallenge_len = ctx->challenge ? strlen(ctx->challenge) : 0;\n\n\tif (challenge_len < 9) {\n\t\tgiterr_set(GITERR_NET, \"No negotiate challenge sent from server\");\n\t\terror = -1;\n\t\tgoto done;\n\t} else if (challenge_len > 9) {\n\t\tif (git_buf_decode_base64(&input_buf,\n\t\t\t\tctx->challenge + 10, challenge_len - 10) < 0) {\n\t\t\tgiterr_set(GITERR_NET, \"Invalid negotiate challenge from server\");\n\t\t\terror = -1;\n\t\t\tgoto done;\n\t\t}\n\n\t\tinput_token.value = input_buf.ptr;\n\t\tinput_token.length = input_buf.size;\n\t\tinput_token_ptr = &input_token;\n\t} else if (ctx->gss_context != GSS_C_NO_CONTEXT) {\n\t\tgiterr_set(GITERR_NET, \"Could not restart authentication\");\n\t\terror = -1;\n\t\tgoto done;\n\t}\n\n\tmech = &negotiate_oid_spnego;\n\n\tif (GSS_ERROR(status_major = gss_init_sec_context(\n\t\t&status_minor,\n\t\tGSS_C_NO_CREDENTIAL,\n\t\t&ctx->gss_context,\n\t\tserver,\n\t\tmech,\n\t\tGSS_C_DELEG_FLAG | GSS_C_MUTUAL_FLAG,\n\t\tGSS_C_INDEFINITE,\n\t\tGSS_C_NO_CHANNEL_BINDINGS,\n\t\tinput_token_ptr,\n\t\tNULL,\n\t\t&output_token,\n\t\tNULL,\n\t\tNULL))) {\n\t\tnegotiate_err_set(status_major, status_minor, \"Negotiate failure\");\n\t\terror = -1;\n\t\tgoto done;\n\t}\n\n\t/* This message merely told us auth was complete; we do not respond. */\n\tif (status_major == GSS_S_COMPLETE) {\n\t\tctx->complete = 1;\n\t\tgoto done;\n\t}\n\n\tgit_buf_puts(buf, \"Authorization: Negotiate \");\n\tgit_buf_encode_base64(buf, output_token.value, output_token.length);\n\tgit_buf_puts(buf, \"\\r\\n\");\n\n\tif (git_buf_oom(buf))\n\t\terror = -1;\n\ndone:\n\tgss_release_name(&status_minor, &server);\n\tgss_release_buffer(&status_minor, (gss_buffer_t) &output_token);\n\tgit_buf_free(&input_buf);\n\treturn error;\n}"
  },
  {
    "function_name": "negotiate_set_challenge",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10130/repo/src/transports/auth_negotiate.c",
    "lines": "56-70",
    "snippet": "static int negotiate_set_challenge(\n\tgit_http_auth_context *c,\n\tconst char *challenge)\n{\n\thttp_auth_negotiate_context *ctx = (http_auth_negotiate_context *)c;\n\n\tassert(ctx && ctx->configured && challenge);\n\n\tgit__free(ctx->challenge);\n\n\tctx->challenge = git__strdup(challenge);\n\tGITERR_CHECK_ALLOC(ctx->challenge);\n\n\treturn 0;\n}",
    "includes": [
      "#include <krb5.h>",
      "#include <gssapi.h>",
      "#include \"auth.h\"",
      "#include \"buffer.h\"",
      "#include \"common.h\"",
      "#include \"git2.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "GITERR_CHECK_ALLOC",
          "args": [
            "ctx->challenge"
          ],
          "line": 67
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "git__strdup",
          "args": [
            "challenge"
          ],
          "line": 66
        },
        "resolved": true,
        "details": {
          "function_name": "git__strdup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10130/repo/src/util.h",
          "lines": "174-179",
          "snippet": "GIT_INLINE(char *) git__strdup(const char *str)\n{\n\tchar *ptr = strdup(str);\n\tif (!ptr) giterr_set_oom();\n\treturn ptr;\n}",
          "includes": [
            "#include <sys/time.h>",
            "#include <proto/timer.h>",
            "#include <mach/mach_time.h>",
            "#include \"thread-utils.h\"",
            "#include \"strnlen.h\"",
            "#include \"common.h\"",
            "#include \"win32/w32_crtdbg_stacktrace.h\"",
            "#include <crtdbg.h>",
            "#include <stdlib.h>",
            "#include \"buffer.h\"",
            "#include \"git2/buffer.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/time.h>\n#include <proto/timer.h>\n#include <mach/mach_time.h>\n#include \"thread-utils.h\"\n#include \"strnlen.h\"\n#include \"common.h\"\n#include \"win32/w32_crtdbg_stacktrace.h\"\n#include <crtdbg.h>\n#include <stdlib.h>\n#include \"buffer.h\"\n#include \"git2/buffer.h\"\n\nGIT_INLINE(char *) git__strdup(const char *str)\n{\n\tchar *ptr = strdup(str);\n\tif (!ptr) giterr_set_oom();\n\treturn ptr;\n}"
        }
      },
      {
        "call_info": {
          "callee": "git__free",
          "args": [
            "ctx->challenge"
          ],
          "line": 64
        },
        "resolved": true,
        "details": {
          "function_name": "git__free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10130/repo/src/util.h",
          "lines": "244-247",
          "snippet": "GIT_INLINE(void) git__free(void *ptr)\n{\n\tfree(ptr);\n}",
          "includes": [
            "#include <sys/time.h>",
            "#include <proto/timer.h>",
            "#include <mach/mach_time.h>",
            "#include \"thread-utils.h\"",
            "#include \"strnlen.h\"",
            "#include \"common.h\"",
            "#include \"win32/w32_crtdbg_stacktrace.h\"",
            "#include <crtdbg.h>",
            "#include <stdlib.h>",
            "#include \"buffer.h\"",
            "#include \"git2/buffer.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/time.h>\n#include <proto/timer.h>\n#include <mach/mach_time.h>\n#include \"thread-utils.h\"\n#include \"strnlen.h\"\n#include \"common.h\"\n#include \"win32/w32_crtdbg_stacktrace.h\"\n#include <crtdbg.h>\n#include <stdlib.h>\n#include \"buffer.h\"\n#include \"git2/buffer.h\"\n\nGIT_INLINE(void) git__free(void *ptr)\n{\n\tfree(ptr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "assert",
          "args": [
            "ctx && ctx->configured && challenge"
          ],
          "line": 62
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <krb5.h>\n#include <gssapi.h>\n#include \"auth.h\"\n#include \"buffer.h\"\n#include \"common.h\"\n#include \"git2.h\"\n\nstatic int negotiate_set_challenge(\n\tgit_http_auth_context *c,\n\tconst char *challenge)\n{\n\thttp_auth_negotiate_context *ctx = (http_auth_negotiate_context *)c;\n\n\tassert(ctx && ctx->configured && challenge);\n\n\tgit__free(ctx->challenge);\n\n\tctx->challenge = git__strdup(challenge);\n\tGITERR_CHECK_ALLOC(ctx->challenge);\n\n\treturn 0;\n}"
  },
  {
    "function_name": "negotiate_err_set",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10130/repo/src/transports/auth_negotiate.c",
    "lines": "36-54",
    "snippet": "static void negotiate_err_set(\n\tOM_uint32 status_major,\n\tOM_uint32 status_minor,\n\tconst char *message)\n{\n\tgss_buffer_desc buffer = GSS_C_EMPTY_BUFFER;\n\tOM_uint32 status_display, context = 0;\n\n\tif (gss_display_status(&status_display, status_major, GSS_C_GSS_CODE,\n\t\tGSS_C_NO_OID, &context, &buffer) == GSS_S_COMPLETE) {\n\t\tgiterr_set(GITERR_NET, \"%s: %.*s (%d.%d)\",\n\t\t\tmessage, (int)buffer.length, (const char *)buffer.value,\n\t\t\tstatus_major, status_minor);\n\t\tgss_release_buffer(&status_minor, &buffer);\n\t} else {\n\t\tgiterr_set(GITERR_NET, \"%s: unknown negotiate error (%d.%d)\",\n\t\t\tmessage, status_major, status_minor);\n\t}\n}",
    "includes": [
      "#include <krb5.h>",
      "#include <gssapi.h>",
      "#include \"auth.h\"",
      "#include \"buffer.h\"",
      "#include \"common.h\"",
      "#include \"git2.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "giterr_set",
          "args": [
            "GITERR_NET",
            "\"%s: unknown negotiate error (%d.%d)\"",
            "message",
            "status_major",
            "status_minor"
          ],
          "line": 51
        },
        "resolved": true,
        "details": {
          "function_name": "giterr_set",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10130/repo/src/errors.c",
          "lines": "50-89",
          "snippet": "void giterr_set(int error_class, const char *string, ...)\n{\n\tva_list arglist;\n#ifdef GIT_WIN32\n\tDWORD win32_error_code = (error_class == GITERR_OS) ? GetLastError() : 0;\n#endif\n\tint error_code = (error_class == GITERR_OS) ? errno : 0;\n\tgit_buf *buf = &GIT_GLOBAL->error_buf;\n\n\tgit_buf_clear(buf);\n\tif (string) {\n\t\tva_start(arglist, string);\n\t\tgit_buf_vprintf(buf, string, arglist);\n\t\tva_end(arglist);\n\n\t\tif (error_class == GITERR_OS)\n\t\t\tgit_buf_PUTS(buf, \": \");\n\t}\n\n\tif (error_class == GITERR_OS) {\n#ifdef GIT_WIN32\n\t\tchar * win32_error = git_win32_get_error_message(win32_error_code);\n\t\tif (win32_error) {\n\t\t\tgit_buf_puts(buf, win32_error);\n\t\t\tgit__free(win32_error);\n\n\t\t\tSetLastError(0);\n\t\t}\n\t\telse\n#endif\n\t\tif (error_code)\n\t\t\tgit_buf_puts(buf, strerror(error_code));\n\n\t\tif (error_code)\n\t\t\terrno = 0;\n\t}\n\n\tif (!git_buf_oom(buf))\n\t\tset_error_from_buffer(error_class);\n}",
          "includes": [
            "#include \"buffer.h\"",
            "#include \"posix.h\"",
            "#include \"global.h\"",
            "#include \"common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"buffer.h\"\n#include \"posix.h\"\n#include \"global.h\"\n#include \"common.h\"\n\nvoid giterr_set(int error_class, const char *string, ...)\n{\n\tva_list arglist;\n#ifdef GIT_WIN32\n\tDWORD win32_error_code = (error_class == GITERR_OS) ? GetLastError() : 0;\n#endif\n\tint error_code = (error_class == GITERR_OS) ? errno : 0;\n\tgit_buf *buf = &GIT_GLOBAL->error_buf;\n\n\tgit_buf_clear(buf);\n\tif (string) {\n\t\tva_start(arglist, string);\n\t\tgit_buf_vprintf(buf, string, arglist);\n\t\tva_end(arglist);\n\n\t\tif (error_class == GITERR_OS)\n\t\t\tgit_buf_PUTS(buf, \": \");\n\t}\n\n\tif (error_class == GITERR_OS) {\n#ifdef GIT_WIN32\n\t\tchar * win32_error = git_win32_get_error_message(win32_error_code);\n\t\tif (win32_error) {\n\t\t\tgit_buf_puts(buf, win32_error);\n\t\t\tgit__free(win32_error);\n\n\t\t\tSetLastError(0);\n\t\t}\n\t\telse\n#endif\n\t\tif (error_code)\n\t\t\tgit_buf_puts(buf, strerror(error_code));\n\n\t\tif (error_code)\n\t\t\terrno = 0;\n\t}\n\n\tif (!git_buf_oom(buf))\n\t\tset_error_from_buffer(error_class);\n}"
        }
      },
      {
        "call_info": {
          "callee": "gss_release_buffer",
          "args": [
            "&status_minor",
            "&buffer"
          ],
          "line": 49
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gss_display_status",
          "args": [
            "&status_display",
            "status_major",
            "GSS_C_GSS_CODE",
            "GSS_C_NO_OID",
            "&context",
            "&buffer"
          ],
          "line": 44
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <krb5.h>\n#include <gssapi.h>\n#include \"auth.h\"\n#include \"buffer.h\"\n#include \"common.h\"\n#include \"git2.h\"\n\nstatic void negotiate_err_set(\n\tOM_uint32 status_major,\n\tOM_uint32 status_minor,\n\tconst char *message)\n{\n\tgss_buffer_desc buffer = GSS_C_EMPTY_BUFFER;\n\tOM_uint32 status_display, context = 0;\n\n\tif (gss_display_status(&status_display, status_major, GSS_C_GSS_CODE,\n\t\tGSS_C_NO_OID, &context, &buffer) == GSS_S_COMPLETE) {\n\t\tgiterr_set(GITERR_NET, \"%s: %.*s (%d.%d)\",\n\t\t\tmessage, (int)buffer.length, (const char *)buffer.value,\n\t\t\tstatus_major, status_minor);\n\t\tgss_release_buffer(&status_minor, &buffer);\n\t} else {\n\t\tgiterr_set(GITERR_NET, \"%s: unknown negotiate error (%d.%d)\",\n\t\t\tmessage, status_major, status_minor);\n\t}\n}"
  }
]