[
  {
    "function_name": "git_message_prettify",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10130/repo/src/message.c",
    "lines": "24-62",
    "snippet": "int git_message_prettify(git_buf *message_out, const char *message, int strip_comments, char comment_char)\n{\n\tconst size_t message_len = strlen(message);\n\n\tint consecutive_empty_lines = 0;\n\tsize_t i, line_length, rtrimmed_line_length;\n\tchar *next_newline;\n\n\tgit_buf_sanitize(message_out);\n\n\tfor (i = 0; i < strlen(message); i += line_length) {\n\t\tnext_newline = memchr(message + i, '\\n', message_len - i);\n\n\t\tif (next_newline != NULL) {\n\t\t\tline_length = next_newline - (message + i) + 1;\n\t\t} else {\n\t\t\tline_length = message_len - i;\n\t\t}\n\n\t\tif (strip_comments && line_length && message[i] == comment_char)\n\t\t\tcontinue;\n\n\t\trtrimmed_line_length = line_length_without_trailing_spaces(message + i, line_length);\n\n\t\tif (!rtrimmed_line_length) {\n\t\t\tconsecutive_empty_lines++;\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (consecutive_empty_lines > 0 && message_out->size > 0)\n\t\t\tgit_buf_putc(message_out, '\\n');\n\n\t\tconsecutive_empty_lines = 0;\n\t\tgit_buf_put(message_out, message + i, rtrimmed_line_length);\n\t\tgit_buf_putc(message_out, '\\n');\n\t}\n\n\treturn git_buf_oom(message_out) ? -1 : 0;\n}",
    "includes": [
      "#include \"message.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "git_buf_oom",
          "args": [
            "message_out"
          ],
          "line": 61
        },
        "resolved": true,
        "details": {
          "function_name": "git_buf_oom",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10130/repo/src/buffer.h",
          "lines": "94-97",
          "snippet": "GIT_INLINE(bool) git_buf_oom(const git_buf *buf)\n{\n\treturn (buf->ptr == git_buf__oom);\n}",
          "includes": [
            "#include \"git2/buffer.h\"",
            "#include \"git2/strarray.h\"",
            "#include \"common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"git2/buffer.h\"\n#include \"git2/strarray.h\"\n#include \"common.h\"\n\nGIT_INLINE(bool) git_buf_oom(const git_buf *buf)\n{\n\treturn (buf->ptr == git_buf__oom);\n}"
        }
      },
      {
        "call_info": {
          "callee": "git_buf_putc",
          "args": [
            "message_out",
            "'\\n'"
          ],
          "line": 58
        },
        "resolved": true,
        "details": {
          "function_name": "git_buf_putc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10130/repo/src/buffer.c",
          "lines": "186-194",
          "snippet": "int git_buf_putc(git_buf *buf, char c)\n{\n\tsize_t new_size;\n\tGITERR_CHECK_ALLOC_ADD(&new_size, buf->size, 2);\n\tENSURE_SIZE(buf, new_size);\n\tbuf->ptr[buf->size++] = c;\n\tbuf->ptr[buf->size] = '\\0';\n\treturn 0;\n}",
          "includes": [
            "#include <ctype.h>",
            "#include \"buf_text.h\"",
            "#include \"git2/buffer.h\"",
            "#include \"posix.h\"",
            "#include \"buffer.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <ctype.h>\n#include \"buf_text.h\"\n#include \"git2/buffer.h\"\n#include \"posix.h\"\n#include \"buffer.h\"\n\nint git_buf_putc(git_buf *buf, char c)\n{\n\tsize_t new_size;\n\tGITERR_CHECK_ALLOC_ADD(&new_size, buf->size, 2);\n\tENSURE_SIZE(buf, new_size);\n\tbuf->ptr[buf->size++] = c;\n\tbuf->ptr[buf->size] = '\\0';\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "git_buf_put",
          "args": [
            "message_out",
            "message + i",
            "rtrimmed_line_length"
          ],
          "line": 57
        },
        "resolved": true,
        "details": {
          "function_name": "git_buf_put",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10130/repo/src/buffer.c",
          "lines": "208-223",
          "snippet": "int git_buf_put(git_buf *buf, const char *data, size_t len)\n{\n\tif (len) {\n\t\tsize_t new_size;\n\n\t\tassert(data);\n\t\t\n\t\tGITERR_CHECK_ALLOC_ADD(&new_size, buf->size, len);\n\t\tGITERR_CHECK_ALLOC_ADD(&new_size, new_size, 1);\n\t\tENSURE_SIZE(buf, new_size);\n\t\tmemmove(buf->ptr + buf->size, data, len);\n\t\tbuf->size += len;\n\t\tbuf->ptr[buf->size] = '\\0';\n\t}\n\treturn 0;\n}",
          "includes": [
            "#include <ctype.h>",
            "#include \"buf_text.h\"",
            "#include \"git2/buffer.h\"",
            "#include \"posix.h\"",
            "#include \"buffer.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <ctype.h>\n#include \"buf_text.h\"\n#include \"git2/buffer.h\"\n#include \"posix.h\"\n#include \"buffer.h\"\n\nint git_buf_put(git_buf *buf, const char *data, size_t len)\n{\n\tif (len) {\n\t\tsize_t new_size;\n\n\t\tassert(data);\n\t\t\n\t\tGITERR_CHECK_ALLOC_ADD(&new_size, buf->size, len);\n\t\tGITERR_CHECK_ALLOC_ADD(&new_size, new_size, 1);\n\t\tENSURE_SIZE(buf, new_size);\n\t\tmemmove(buf->ptr + buf->size, data, len);\n\t\tbuf->size += len;\n\t\tbuf->ptr[buf->size] = '\\0';\n\t}\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "line_length_without_trailing_spaces",
          "args": [
            "message + i",
            "line_length"
          ],
          "line": 46
        },
        "resolved": true,
        "details": {
          "function_name": "line_length_without_trailing_spaces",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10130/repo/src/message.c",
          "lines": "10-20",
          "snippet": "static size_t line_length_without_trailing_spaces(const char *line, size_t len)\n{\n\twhile (len) {\n\t\tunsigned char c = line[len - 1];\n\t\tif (!git__isspace(c))\n\t\t\tbreak;\n\t\tlen--;\n\t}\n\n\treturn len;\n}",
          "includes": [
            "#include \"message.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"message.h\"\n\nstatic size_t line_length_without_trailing_spaces(const char *line, size_t len)\n{\n\twhile (len) {\n\t\tunsigned char c = line[len - 1];\n\t\tif (!git__isspace(c))\n\t\t\tbreak;\n\t\tlen--;\n\t}\n\n\treturn len;\n}"
        }
      },
      {
        "call_info": {
          "callee": "memchr",
          "args": [
            "message + i",
            "'\\n'",
            "message_len - i"
          ],
          "line": 35
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "message"
          ],
          "line": 34
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "git_buf_sanitize",
          "args": [
            "message_out"
          ],
          "line": 32
        },
        "resolved": true,
        "details": {
          "function_name": "git_buf_sanitize",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10130/repo/src/buffer.c",
          "lines": "128-135",
          "snippet": "void git_buf_sanitize(git_buf *buf)\n{\n\tif (buf->ptr == NULL) {\n\t\tassert(buf->size == 0 && buf->asize == 0);\n\t\tbuf->ptr = git_buf__initbuf;\n\t} else if (buf->asize > buf->size)\n\t\tbuf->ptr[buf->size] = '\\0';\n}",
          "includes": [
            "#include <ctype.h>",
            "#include \"buf_text.h\"",
            "#include \"git2/buffer.h\"",
            "#include \"posix.h\"",
            "#include \"buffer.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "char git_buf__initbuf[1];"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <ctype.h>\n#include \"buf_text.h\"\n#include \"git2/buffer.h\"\n#include \"posix.h\"\n#include \"buffer.h\"\n\nchar git_buf__initbuf[1];\n\nvoid git_buf_sanitize(git_buf *buf)\n{\n\tif (buf->ptr == NULL) {\n\t\tassert(buf->size == 0 && buf->asize == 0);\n\t\tbuf->ptr = git_buf__initbuf;\n\t} else if (buf->asize > buf->size)\n\t\tbuf->ptr[buf->size] = '\\0';\n}"
        }
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "message"
          ],
          "line": 26
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"message.h\"\n\nint git_message_prettify(git_buf *message_out, const char *message, int strip_comments, char comment_char)\n{\n\tconst size_t message_len = strlen(message);\n\n\tint consecutive_empty_lines = 0;\n\tsize_t i, line_length, rtrimmed_line_length;\n\tchar *next_newline;\n\n\tgit_buf_sanitize(message_out);\n\n\tfor (i = 0; i < strlen(message); i += line_length) {\n\t\tnext_newline = memchr(message + i, '\\n', message_len - i);\n\n\t\tif (next_newline != NULL) {\n\t\t\tline_length = next_newline - (message + i) + 1;\n\t\t} else {\n\t\t\tline_length = message_len - i;\n\t\t}\n\n\t\tif (strip_comments && line_length && message[i] == comment_char)\n\t\t\tcontinue;\n\n\t\trtrimmed_line_length = line_length_without_trailing_spaces(message + i, line_length);\n\n\t\tif (!rtrimmed_line_length) {\n\t\t\tconsecutive_empty_lines++;\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (consecutive_empty_lines > 0 && message_out->size > 0)\n\t\t\tgit_buf_putc(message_out, '\\n');\n\n\t\tconsecutive_empty_lines = 0;\n\t\tgit_buf_put(message_out, message + i, rtrimmed_line_length);\n\t\tgit_buf_putc(message_out, '\\n');\n\t}\n\n\treturn git_buf_oom(message_out) ? -1 : 0;\n}"
  },
  {
    "function_name": "line_length_without_trailing_spaces",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10130/repo/src/message.c",
    "lines": "10-20",
    "snippet": "static size_t line_length_without_trailing_spaces(const char *line, size_t len)\n{\n\twhile (len) {\n\t\tunsigned char c = line[len - 1];\n\t\tif (!git__isspace(c))\n\t\t\tbreak;\n\t\tlen--;\n\t}\n\n\treturn len;\n}",
    "includes": [
      "#include \"message.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "git__isspace",
          "args": [
            "c"
          ],
          "line": 14
        },
        "resolved": true,
        "details": {
          "function_name": "git__isspace_nonlf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10130/repo/src/util.h",
          "lines": "459-462",
          "snippet": "GIT_INLINE(bool) git__isspace_nonlf(int c)\n{\n\treturn (c == ' ' || c == '\\t' || c == '\\f' || c == '\\r' || c == '\\v');\n}",
          "includes": [
            "#include <sys/time.h>",
            "#include <proto/timer.h>",
            "#include <mach/mach_time.h>",
            "#include \"thread-utils.h\"",
            "#include \"strnlen.h\"",
            "#include \"common.h\"",
            "#include \"win32/w32_crtdbg_stacktrace.h\"",
            "#include <crtdbg.h>",
            "#include <stdlib.h>",
            "#include \"buffer.h\"",
            "#include \"git2/buffer.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/time.h>\n#include <proto/timer.h>\n#include <mach/mach_time.h>\n#include \"thread-utils.h\"\n#include \"strnlen.h\"\n#include \"common.h\"\n#include \"win32/w32_crtdbg_stacktrace.h\"\n#include <crtdbg.h>\n#include <stdlib.h>\n#include \"buffer.h\"\n#include \"git2/buffer.h\"\n\nGIT_INLINE(bool) git__isspace_nonlf(int c)\n{\n\treturn (c == ' ' || c == '\\t' || c == '\\f' || c == '\\r' || c == '\\v');\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"message.h\"\n\nstatic size_t line_length_without_trailing_spaces(const char *line, size_t len)\n{\n\twhile (len) {\n\t\tunsigned char c = line[len - 1];\n\t\tif (!git__isspace(c))\n\t\t\tbreak;\n\t\tlen--;\n\t}\n\n\treturn len;\n}"
  }
]