[
  {
    "function_name": "git__utf16_to_8_alloc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10130/repo/src/win32/utf-conv.c",
    "lines": "113-147",
    "snippet": "int git__utf16_to_8_alloc(char **dest, const wchar_t *src)\n{\n\tint utf8_size;\n\n\t*dest = NULL;\n\n\t/* Length of -1 indicates NULL termination of the input string */\n\tutf8_size = WideCharToMultiByte(CP_UTF8, WC_ERR_INVALID_CHARS, src, -1, NULL, 0, NULL, NULL);\n\n\tif (!utf8_size) {\n\t\tgit__set_errno();\n\t\treturn -1;\n\t}\n\n\t*dest = git__malloc(utf8_size);\n\n\tif (!*dest) {\n\t\terrno = ENOMEM;\n\t\treturn -1;\n\t}\n\n\tutf8_size = WideCharToMultiByte(CP_UTF8, WC_ERR_INVALID_CHARS, src, -1, *dest, utf8_size, NULL, NULL);\n\n\tif (!utf8_size) {\n\t\tgit__set_errno();\n\n\t\tgit__free(*dest);\n\t\t*dest = NULL;\n\t}\n\n\t/* Subtract 1 from the result to turn 0 into -1 (an error code) and to not count the NULL\n\t * terminator as part of the string's length. MultiByteToWideChar never returns int's minvalue,\n\t * so underflow is not possible */\n\treturn utf8_size - 1;\n}",
    "includes": [
      "#include \"utf-conv.h\"",
      "#include \"common.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "git__free",
          "args": [
            "*dest"
          ],
          "line": 139
        },
        "resolved": true,
        "details": {
          "function_name": "git__free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10130/repo/src/util.h",
          "lines": "244-247",
          "snippet": "GIT_INLINE(void) git__free(void *ptr)\n{\n\tfree(ptr);\n}",
          "includes": [
            "#include <sys/time.h>",
            "#include <proto/timer.h>",
            "#include <mach/mach_time.h>",
            "#include \"thread-utils.h\"",
            "#include \"strnlen.h\"",
            "#include \"common.h\"",
            "#include \"win32/w32_crtdbg_stacktrace.h\"",
            "#include <crtdbg.h>",
            "#include <stdlib.h>",
            "#include \"buffer.h\"",
            "#include \"git2/buffer.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/time.h>\n#include <proto/timer.h>\n#include <mach/mach_time.h>\n#include \"thread-utils.h\"\n#include \"strnlen.h\"\n#include \"common.h\"\n#include \"win32/w32_crtdbg_stacktrace.h\"\n#include <crtdbg.h>\n#include <stdlib.h>\n#include \"buffer.h\"\n#include \"git2/buffer.h\"\n\nGIT_INLINE(void) git__free(void *ptr)\n{\n\tfree(ptr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "git__set_errno",
          "args": [],
          "line": 137
        },
        "resolved": true,
        "details": {
          "function_name": "git__set_errno",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10130/repo/src/win32/utf-conv.c",
          "lines": "11-17",
          "snippet": "GIT_INLINE(void) git__set_errno(void)\n{\n\tif (GetLastError() == ERROR_INSUFFICIENT_BUFFER)\n\t\terrno = ENAMETOOLONG;\n\telse\n\t\terrno = EINVAL;\n}",
          "includes": [
            "#include \"utf-conv.h\"",
            "#include \"common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"utf-conv.h\"\n#include \"common.h\"\n\nGIT_INLINE(void) git__set_errno(void)\n{\n\tif (GetLastError() == ERROR_INSUFFICIENT_BUFFER)\n\t\terrno = ENAMETOOLONG;\n\telse\n\t\terrno = EINVAL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "WideCharToMultiByte",
          "args": [
            "CP_UTF8",
            "WC_ERR_INVALID_CHARS",
            "src",
            "-1",
            "*dest",
            "utf8_size",
            "NULL",
            "NULL"
          ],
          "line": 134
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "git__malloc",
          "args": [
            "utf8_size"
          ],
          "line": 127
        },
        "resolved": true,
        "details": {
          "function_name": "git__malloc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10130/repo/src/util.h",
          "lines": "160-165",
          "snippet": "GIT_INLINE(void *) git__malloc(size_t len)\n{\n\tvoid *ptr = malloc(len);\n\tif (!ptr) giterr_set_oom();\n\treturn ptr;\n}",
          "includes": [
            "#include <sys/time.h>",
            "#include <proto/timer.h>",
            "#include <mach/mach_time.h>",
            "#include \"thread-utils.h\"",
            "#include \"strnlen.h\"",
            "#include \"common.h\"",
            "#include \"win32/w32_crtdbg_stacktrace.h\"",
            "#include <crtdbg.h>",
            "#include <stdlib.h>",
            "#include \"buffer.h\"",
            "#include \"git2/buffer.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/time.h>\n#include <proto/timer.h>\n#include <mach/mach_time.h>\n#include \"thread-utils.h\"\n#include \"strnlen.h\"\n#include \"common.h\"\n#include \"win32/w32_crtdbg_stacktrace.h\"\n#include <crtdbg.h>\n#include <stdlib.h>\n#include \"buffer.h\"\n#include \"git2/buffer.h\"\n\nGIT_INLINE(void *) git__malloc(size_t len)\n{\n\tvoid *ptr = malloc(len);\n\tif (!ptr) giterr_set_oom();\n\treturn ptr;\n}"
        }
      },
      {
        "call_info": {
          "callee": "WideCharToMultiByte",
          "args": [
            "CP_UTF8",
            "WC_ERR_INVALID_CHARS",
            "src",
            "-1",
            "NULL",
            "0",
            "NULL",
            "NULL"
          ],
          "line": 120
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"utf-conv.h\"\n#include \"common.h\"\n\nint git__utf16_to_8_alloc(char **dest, const wchar_t *src)\n{\n\tint utf8_size;\n\n\t*dest = NULL;\n\n\t/* Length of -1 indicates NULL termination of the input string */\n\tutf8_size = WideCharToMultiByte(CP_UTF8, WC_ERR_INVALID_CHARS, src, -1, NULL, 0, NULL, NULL);\n\n\tif (!utf8_size) {\n\t\tgit__set_errno();\n\t\treturn -1;\n\t}\n\n\t*dest = git__malloc(utf8_size);\n\n\tif (!*dest) {\n\t\terrno = ENOMEM;\n\t\treturn -1;\n\t}\n\n\tutf8_size = WideCharToMultiByte(CP_UTF8, WC_ERR_INVALID_CHARS, src, -1, *dest, utf8_size, NULL, NULL);\n\n\tif (!utf8_size) {\n\t\tgit__set_errno();\n\n\t\tgit__free(*dest);\n\t\t*dest = NULL;\n\t}\n\n\t/* Subtract 1 from the result to turn 0 into -1 (an error code) and to not count the NULL\n\t * terminator as part of the string's length. MultiByteToWideChar never returns int's minvalue,\n\t * so underflow is not possible */\n\treturn utf8_size - 1;\n}"
  },
  {
    "function_name": "git__utf8_to_16_alloc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10130/repo/src/win32/utf-conv.c",
    "lines": "70-102",
    "snippet": "int git__utf8_to_16_alloc(wchar_t **dest, const char *src)\n{\n\tint utf16_size;\n\n\t*dest = NULL;\n\n\t/* Length of -1 indicates NULL termination of the input string */\n\tutf16_size = MultiByteToWideChar(CP_UTF8, MB_ERR_INVALID_CHARS, src, -1, NULL, 0);\n\n\tif (!utf16_size) {\n\t\tgit__set_errno();\n\t\treturn -1;\n\t}\n\n\tif (!(*dest = git__mallocarray(utf16_size, sizeof(wchar_t)))) {\n\t\terrno = ENOMEM;\n\t\treturn -1;\n\t}\n\n\tutf16_size = MultiByteToWideChar(CP_UTF8, MB_ERR_INVALID_CHARS, src, -1, *dest, utf16_size);\n\n\tif (!utf16_size) {\n\t\tgit__set_errno();\n\n\t\tgit__free(*dest);\n\t\t*dest = NULL;\n\t}\n\n\t/* Subtract 1 from the result to turn 0 into -1 (an error code) and to not count the NULL\n\t * terminator as part of the string's length. MultiByteToWideChar never returns int's minvalue,\n\t * so underflow is not possible */\n\treturn utf16_size - 1;\n}",
    "includes": [
      "#include \"utf-conv.h\"",
      "#include \"common.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "git__free",
          "args": [
            "*dest"
          ],
          "line": 94
        },
        "resolved": true,
        "details": {
          "function_name": "git__free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10130/repo/src/util.h",
          "lines": "244-247",
          "snippet": "GIT_INLINE(void) git__free(void *ptr)\n{\n\tfree(ptr);\n}",
          "includes": [
            "#include <sys/time.h>",
            "#include <proto/timer.h>",
            "#include <mach/mach_time.h>",
            "#include \"thread-utils.h\"",
            "#include \"strnlen.h\"",
            "#include \"common.h\"",
            "#include \"win32/w32_crtdbg_stacktrace.h\"",
            "#include <crtdbg.h>",
            "#include <stdlib.h>",
            "#include \"buffer.h\"",
            "#include \"git2/buffer.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/time.h>\n#include <proto/timer.h>\n#include <mach/mach_time.h>\n#include \"thread-utils.h\"\n#include \"strnlen.h\"\n#include \"common.h\"\n#include \"win32/w32_crtdbg_stacktrace.h\"\n#include <crtdbg.h>\n#include <stdlib.h>\n#include \"buffer.h\"\n#include \"git2/buffer.h\"\n\nGIT_INLINE(void) git__free(void *ptr)\n{\n\tfree(ptr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "git__set_errno",
          "args": [],
          "line": 92
        },
        "resolved": true,
        "details": {
          "function_name": "git__set_errno",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10130/repo/src/win32/utf-conv.c",
          "lines": "11-17",
          "snippet": "GIT_INLINE(void) git__set_errno(void)\n{\n\tif (GetLastError() == ERROR_INSUFFICIENT_BUFFER)\n\t\terrno = ENAMETOOLONG;\n\telse\n\t\terrno = EINVAL;\n}",
          "includes": [
            "#include \"utf-conv.h\"",
            "#include \"common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"utf-conv.h\"\n#include \"common.h\"\n\nGIT_INLINE(void) git__set_errno(void)\n{\n\tif (GetLastError() == ERROR_INSUFFICIENT_BUFFER)\n\t\terrno = ENAMETOOLONG;\n\telse\n\t\terrno = EINVAL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "MultiByteToWideChar",
          "args": [
            "CP_UTF8",
            "MB_ERR_INVALID_CHARS",
            "src",
            "-1",
            "*dest",
            "utf16_size"
          ],
          "line": 89
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "git__mallocarray",
          "args": [
            "utf16_size",
            "sizeof(wchar_t)"
          ],
          "line": 84
        },
        "resolved": true,
        "details": {
          "function_name": "git__mallocarray",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10130/repo/src/util.h",
          "lines": "237-240",
          "snippet": "GIT_INLINE(void *) git__mallocarray(size_t nelem, size_t elsize)\n{\n\treturn git__reallocarray(NULL, nelem, elsize);\n}",
          "includes": [
            "#include <sys/time.h>",
            "#include <proto/timer.h>",
            "#include <mach/mach_time.h>",
            "#include \"thread-utils.h\"",
            "#include \"strnlen.h\"",
            "#include \"common.h\"",
            "#include \"win32/w32_crtdbg_stacktrace.h\"",
            "#include <crtdbg.h>",
            "#include <stdlib.h>",
            "#include \"buffer.h\"",
            "#include \"git2/buffer.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/time.h>\n#include <proto/timer.h>\n#include <mach/mach_time.h>\n#include \"thread-utils.h\"\n#include \"strnlen.h\"\n#include \"common.h\"\n#include \"win32/w32_crtdbg_stacktrace.h\"\n#include <crtdbg.h>\n#include <stdlib.h>\n#include \"buffer.h\"\n#include \"git2/buffer.h\"\n\nGIT_INLINE(void *) git__mallocarray(size_t nelem, size_t elsize)\n{\n\treturn git__reallocarray(NULL, nelem, elsize);\n}"
        }
      },
      {
        "call_info": {
          "callee": "MultiByteToWideChar",
          "args": [
            "CP_UTF8",
            "MB_ERR_INVALID_CHARS",
            "src",
            "-1",
            "NULL",
            "0"
          ],
          "line": 77
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"utf-conv.h\"\n#include \"common.h\"\n\nint git__utf8_to_16_alloc(wchar_t **dest, const char *src)\n{\n\tint utf16_size;\n\n\t*dest = NULL;\n\n\t/* Length of -1 indicates NULL termination of the input string */\n\tutf16_size = MultiByteToWideChar(CP_UTF8, MB_ERR_INVALID_CHARS, src, -1, NULL, 0);\n\n\tif (!utf16_size) {\n\t\tgit__set_errno();\n\t\treturn -1;\n\t}\n\n\tif (!(*dest = git__mallocarray(utf16_size, sizeof(wchar_t)))) {\n\t\terrno = ENOMEM;\n\t\treturn -1;\n\t}\n\n\tutf16_size = MultiByteToWideChar(CP_UTF8, MB_ERR_INVALID_CHARS, src, -1, *dest, utf16_size);\n\n\tif (!utf16_size) {\n\t\tgit__set_errno();\n\n\t\tgit__free(*dest);\n\t\t*dest = NULL;\n\t}\n\n\t/* Subtract 1 from the result to turn 0 into -1 (an error code) and to not count the NULL\n\t * terminator as part of the string's length. MultiByteToWideChar never returns int's minvalue,\n\t * so underflow is not possible */\n\treturn utf16_size - 1;\n}"
  },
  {
    "function_name": "git__utf16_to_8",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10130/repo/src/win32/utf-conv.c",
    "lines": "48-59",
    "snippet": "int git__utf16_to_8(char *dest, size_t dest_size, const wchar_t *src)\n{\n\tint len;\n\n\t/* Length of -1 indicates NULL termination of the input string. Subtract 1 from the result to\n\t * turn 0 into -1 (an error code) and to not count the NULL terminator as part of the string's\n\t * length. WideCharToMultiByte never returns int's minvalue, so underflow is not possible */\n\tif ((len = WideCharToMultiByte(CP_UTF8, WC_ERR_INVALID_CHARS, src, -1, dest, (int)dest_size, NULL, NULL) - 1) < 0)\n\t\tgit__set_errno();\n\n\treturn len;\n}",
    "includes": [
      "#include \"utf-conv.h\"",
      "#include \"common.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "git__set_errno",
          "args": [],
          "line": 56
        },
        "resolved": true,
        "details": {
          "function_name": "git__set_errno",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10130/repo/src/win32/utf-conv.c",
          "lines": "11-17",
          "snippet": "GIT_INLINE(void) git__set_errno(void)\n{\n\tif (GetLastError() == ERROR_INSUFFICIENT_BUFFER)\n\t\terrno = ENAMETOOLONG;\n\telse\n\t\terrno = EINVAL;\n}",
          "includes": [
            "#include \"utf-conv.h\"",
            "#include \"common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"utf-conv.h\"\n#include \"common.h\"\n\nGIT_INLINE(void) git__set_errno(void)\n{\n\tif (GetLastError() == ERROR_INSUFFICIENT_BUFFER)\n\t\terrno = ENAMETOOLONG;\n\telse\n\t\terrno = EINVAL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "WideCharToMultiByte",
          "args": [
            "CP_UTF8",
            "WC_ERR_INVALID_CHARS",
            "src",
            "-1",
            "dest",
            "(int)dest_size",
            "NULL",
            "NULL"
          ],
          "line": 55
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"utf-conv.h\"\n#include \"common.h\"\n\nint git__utf16_to_8(char *dest, size_t dest_size, const wchar_t *src)\n{\n\tint len;\n\n\t/* Length of -1 indicates NULL termination of the input string. Subtract 1 from the result to\n\t * turn 0 into -1 (an error code) and to not count the NULL terminator as part of the string's\n\t * length. WideCharToMultiByte never returns int's minvalue, so underflow is not possible */\n\tif ((len = WideCharToMultiByte(CP_UTF8, WC_ERR_INVALID_CHARS, src, -1, dest, (int)dest_size, NULL, NULL) - 1) < 0)\n\t\tgit__set_errno();\n\n\treturn len;\n}"
  },
  {
    "function_name": "git__utf8_to_16",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10130/repo/src/win32/utf-conv.c",
    "lines": "27-38",
    "snippet": "int git__utf8_to_16(wchar_t *dest, size_t dest_size, const char *src)\n{\n\tint len;\n\n\t/* Length of -1 indicates NULL termination of the input string. Subtract 1 from the result to\n\t* turn 0 into -1 (an error code) and to not count the NULL terminator as part of the string's\n\t* length. MultiByteToWideChar never returns int's minvalue, so underflow is not possible */\n\tif ((len = MultiByteToWideChar(CP_UTF8, MB_ERR_INVALID_CHARS, src, -1, dest, (int)dest_size) - 1) < 0)\n\t\tgit__set_errno();\n\n\treturn len;\n}",
    "includes": [
      "#include \"utf-conv.h\"",
      "#include \"common.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "git__set_errno",
          "args": [],
          "line": 35
        },
        "resolved": true,
        "details": {
          "function_name": "git__set_errno",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10130/repo/src/win32/utf-conv.c",
          "lines": "11-17",
          "snippet": "GIT_INLINE(void) git__set_errno(void)\n{\n\tif (GetLastError() == ERROR_INSUFFICIENT_BUFFER)\n\t\terrno = ENAMETOOLONG;\n\telse\n\t\terrno = EINVAL;\n}",
          "includes": [
            "#include \"utf-conv.h\"",
            "#include \"common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"utf-conv.h\"\n#include \"common.h\"\n\nGIT_INLINE(void) git__set_errno(void)\n{\n\tif (GetLastError() == ERROR_INSUFFICIENT_BUFFER)\n\t\terrno = ENAMETOOLONG;\n\telse\n\t\terrno = EINVAL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "MultiByteToWideChar",
          "args": [
            "CP_UTF8",
            "MB_ERR_INVALID_CHARS",
            "src",
            "-1",
            "dest",
            "(int)dest_size"
          ],
          "line": 34
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"utf-conv.h\"\n#include \"common.h\"\n\nint git__utf8_to_16(wchar_t *dest, size_t dest_size, const char *src)\n{\n\tint len;\n\n\t/* Length of -1 indicates NULL termination of the input string. Subtract 1 from the result to\n\t* turn 0 into -1 (an error code) and to not count the NULL terminator as part of the string's\n\t* length. MultiByteToWideChar never returns int's minvalue, so underflow is not possible */\n\tif ((len = MultiByteToWideChar(CP_UTF8, MB_ERR_INVALID_CHARS, src, -1, dest, (int)dest_size) - 1) < 0)\n\t\tgit__set_errno();\n\n\treturn len;\n}"
  },
  {
    "function_name": "git__set_errno",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-10130/repo/src/win32/utf-conv.c",
    "lines": "11-17",
    "snippet": "GIT_INLINE(void) git__set_errno(void)\n{\n\tif (GetLastError() == ERROR_INSUFFICIENT_BUFFER)\n\t\terrno = ENAMETOOLONG;\n\telse\n\t\terrno = EINVAL;\n}",
    "includes": [
      "#include \"utf-conv.h\"",
      "#include \"common.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "GetLastError",
          "args": [],
          "line": 13
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"utf-conv.h\"\n#include \"common.h\"\n\nGIT_INLINE(void) git__set_errno(void)\n{\n\tif (GetLastError() == ERROR_INSUFFICIENT_BUFFER)\n\t\terrno = ENAMETOOLONG;\n\telse\n\t\terrno = EINVAL;\n}"
  }
]