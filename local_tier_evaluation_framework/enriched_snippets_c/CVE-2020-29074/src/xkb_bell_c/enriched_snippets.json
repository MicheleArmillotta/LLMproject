[
  {
    "function_name": "check_bell_event",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-29074/repo/src/xkb_bell.c",
    "lines": "145-145",
    "snippet": "void check_bell_event(void) {}",
    "includes": [
      "#include \"connections.h\"",
      "#include \"xwrappers.h\"",
      "#include \"x11vnc.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "void check_bell_event(void);"
    ],
    "called_functions": [],
    "contextual_snippet": "#include \"connections.h\"\n#include \"xwrappers.h\"\n#include \"x11vnc.h\"\n\nvoid check_bell_event(void);\n\nvoid check_bell_event(void) {}"
  },
  {
    "function_name": "initialize_watch_bell",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-29074/repo/src/xkb_bell.c",
    "lines": "141-144",
    "snippet": "void initialize_watch_bell(void) {\n\twatch_bell = 0;\n\tsound_bell = 0;\n}",
    "includes": [
      "#include \"connections.h\"",
      "#include \"xwrappers.h\"",
      "#include \"x11vnc.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "void initialize_watch_bell(void);"
    ],
    "called_functions": [],
    "contextual_snippet": "#include \"connections.h\"\n#include \"xwrappers.h\"\n#include \"x11vnc.h\"\n\nvoid initialize_watch_bell(void);\n\nvoid initialize_watch_bell(void) {\n\twatch_bell = 0;\n\tsound_bell = 0;\n}"
  },
  {
    "function_name": "check_bell_event",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-29074/repo/src/xkb_bell.c",
    "lines": "105-139",
    "snippet": "void check_bell_event(void) {\n\tXEvent xev;\n\tXkbAnyEvent *xkb_ev;\n\tint got_bell = 0;\n\n\tif (! xkb_base_event_type) {\n\t\treturn;\n\t}\n\tRAWFB_RET_VOID\n\n\t/* caller does X_LOCK */\n\tif (! XCheckTypedEvent(dpy, xkb_base_event_type, &xev)) {\n\t\treturn;\n\t}\n\tif (! watch_bell) {\n\t\t/* we return here to avoid xkb events piling up */\n\t\treturn;\n\t}\n\n\txkb_ev = (XkbAnyEvent *) &xev;\n\tif (xkb_ev->xkb_type == XkbBellNotify) {\n\t\tgot_bell = 1;\n\t}\n\n\tif (got_bell && sound_bell) {\n\t\tif (! all_clients_initialized()) {\n\t\t\trfbLog(\"check_bell_event: not sending bell: \"\n\t\t\t    \"uninitialized clients\\n\");\n\t\t} else {\n\t\t\tif (screen && client_count) {\n\t\t\t\trfbSendBell(screen);\n\t\t\t}\n\t\t}\n\t}\n}",
    "includes": [
      "#include \"connections.h\"",
      "#include \"xwrappers.h\"",
      "#include \"x11vnc.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int xkb_base_event_type = 0;",
      "void check_bell_event(void);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "rfbSendBell",
          "args": [
            "screen"
          ],
          "line": 135
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rfbLog",
          "args": [
            "\"check_bell_event: not sending bell: \"\n\t\t\t    \"uninitialized clients\\n\""
          ],
          "line": 131
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "all_clients_initialized",
          "args": [],
          "line": 130
        },
        "resolved": true,
        "details": {
          "function_name": "all_clients_initialized",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-29074/repo/src/connections.c",
          "lines": "122-142",
          "snippet": "int all_clients_initialized(void) {\n\trfbClientIteratorPtr iter;\n\trfbClientPtr cl;\n\tint ok = 1;\n\n\tif (! screen) {\n\t\treturn ok;\n\t}\n\n\titer = rfbGetClientIterator(screen);\n\twhile( (cl = rfbClientIteratorNext(iter)) ) {\n\t\tif (cl->state != RFB_NORMAL) {\n\t\t\tok = 0;\n\t\t} else {\n\t\t\tclient_normal_count++;\n\t\t}\n\t}\n\trfbReleaseClientIterator(iter);\n\n\treturn ok;\n}",
          "includes": [
            "#include \"xi2_devices.h\"",
            "#include \"xrandr.h\"",
            "#include \"pointer.h\"",
            "#include \"userinput.h\"",
            "#include \"macosxCG.h\"",
            "#include \"macosx.h\"",
            "#include \"win_utils.h\"",
            "#include \"xevents.h\"",
            "#include \"xwrappers.h\"",
            "#include \"sslhelper.h\"",
            "#include \"sslcmds.h\"",
            "#include \"scan.h\"",
            "#include \"user.h\"",
            "#include \"unixpw.h\"",
            "#include \"screen.h\"",
            "#include \"rates.h\"",
            "#include \"solid.h\"",
            "#include \"gui.h\"",
            "#include \"cleanup.h\"",
            "#include \"keyboard.h\"",
            "#include \"remote.h\"",
            "#include \"inet.h\"",
            "#include \"x11vnc.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int all_clients_initialized(void);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"xi2_devices.h\"\n#include \"xrandr.h\"\n#include \"pointer.h\"\n#include \"userinput.h\"\n#include \"macosxCG.h\"\n#include \"macosx.h\"\n#include \"win_utils.h\"\n#include \"xevents.h\"\n#include \"xwrappers.h\"\n#include \"sslhelper.h\"\n#include \"sslcmds.h\"\n#include \"scan.h\"\n#include \"user.h\"\n#include \"unixpw.h\"\n#include \"screen.h\"\n#include \"rates.h\"\n#include \"solid.h\"\n#include \"gui.h\"\n#include \"cleanup.h\"\n#include \"keyboard.h\"\n#include \"remote.h\"\n#include \"inet.h\"\n#include \"x11vnc.h\"\n\nint all_clients_initialized(void);\n\nint all_clients_initialized(void) {\n\trfbClientIteratorPtr iter;\n\trfbClientPtr cl;\n\tint ok = 1;\n\n\tif (! screen) {\n\t\treturn ok;\n\t}\n\n\titer = rfbGetClientIterator(screen);\n\twhile( (cl = rfbClientIteratorNext(iter)) ) {\n\t\tif (cl->state != RFB_NORMAL) {\n\t\t\tok = 0;\n\t\t} else {\n\t\t\tclient_normal_count++;\n\t\t}\n\t}\n\trfbReleaseClientIterator(iter);\n\n\treturn ok;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"connections.h\"\n#include \"xwrappers.h\"\n#include \"x11vnc.h\"\n\nint xkb_base_event_type = 0;\nvoid check_bell_event(void);\n\nvoid check_bell_event(void) {\n\tXEvent xev;\n\tXkbAnyEvent *xkb_ev;\n\tint got_bell = 0;\n\n\tif (! xkb_base_event_type) {\n\t\treturn;\n\t}\n\tRAWFB_RET_VOID\n\n\t/* caller does X_LOCK */\n\tif (! XCheckTypedEvent(dpy, xkb_base_event_type, &xev)) {\n\t\treturn;\n\t}\n\tif (! watch_bell) {\n\t\t/* we return here to avoid xkb events piling up */\n\t\treturn;\n\t}\n\n\txkb_ev = (XkbAnyEvent *) &xev;\n\tif (xkb_ev->xkb_type == XkbBellNotify) {\n\t\tgot_bell = 1;\n\t}\n\n\tif (got_bell && sound_bell) {\n\t\tif (! all_clients_initialized()) {\n\t\t\trfbLog(\"check_bell_event: not sending bell: \"\n\t\t\t    \"uninitialized clients\\n\");\n\t\t} else {\n\t\t\tif (screen && client_count) {\n\t\t\t\trfbSendBell(screen);\n\t\t\t}\n\t\t}\n\t}\n}"
  },
  {
    "function_name": "initialize_watch_bell",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-29074/repo/src/xkb_bell.c",
    "lines": "72-99",
    "snippet": "void initialize_watch_bell(void) {\n\tif (! xkb_present) {\n\t\tif (! quiet) {\n\t\t\trfbLog(\"warning: disabling bell. XKEYBOARD ext. \"\n\t\t\t    \"not present.\\n\");\n\t\t}\n\t\twatch_bell = 0;\n\t\tsound_bell = 0;\n\t\treturn;\n\t}\n\n\tRAWFB_RET_VOID\n\n\tXkbSelectEvents(dpy, XkbUseCoreKbd, XkbBellNotifyMask, 0);\n\n\tif (! watch_bell) {\n\t\treturn;\n\t}\n\tif (! XkbSelectEvents(dpy, XkbUseCoreKbd, XkbBellNotifyMask,\n\t    XkbBellNotifyMask) ) {\n\t\tif (! quiet) {\n\t\t\trfbLog(\"warning: disabling bell. XkbSelectEvents\"\n\t\t\t    \" failed.\\n\");\n\t\t}\n\t\twatch_bell = 0;\n\t\tsound_bell = 0;\n\t}\n}",
    "includes": [
      "#include \"connections.h\"",
      "#include \"xwrappers.h\"",
      "#include \"x11vnc.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "void initialize_watch_bell(void);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "rfbLog",
          "args": [
            "\"warning: disabling bell. XkbSelectEvents\"\n\t\t\t    \" failed.\\n\""
          ],
          "line": 93
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "XkbSelectEvents",
          "args": [
            "dpy",
            "XkbUseCoreKbd",
            "XkbBellNotifyMask",
            "XkbBellNotifyMask"
          ],
          "line": 90
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rfbLog",
          "args": [
            "\"warning: disabling bell. XKEYBOARD ext. \"\n\t\t\t    \"not present.\\n\""
          ],
          "line": 75
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"connections.h\"\n#include \"xwrappers.h\"\n#include \"x11vnc.h\"\n\nvoid initialize_watch_bell(void);\n\nvoid initialize_watch_bell(void) {\n\tif (! xkb_present) {\n\t\tif (! quiet) {\n\t\t\trfbLog(\"warning: disabling bell. XKEYBOARD ext. \"\n\t\t\t    \"not present.\\n\");\n\t\t}\n\t\twatch_bell = 0;\n\t\tsound_bell = 0;\n\t\treturn;\n\t}\n\n\tRAWFB_RET_VOID\n\n\tXkbSelectEvents(dpy, XkbUseCoreKbd, XkbBellNotifyMask, 0);\n\n\tif (! watch_bell) {\n\t\treturn;\n\t}\n\tif (! XkbSelectEvents(dpy, XkbUseCoreKbd, XkbBellNotifyMask,\n\t    XkbBellNotifyMask) ) {\n\t\tif (! quiet) {\n\t\t\trfbLog(\"warning: disabling bell. XkbSelectEvents\"\n\t\t\t    \" failed.\\n\");\n\t\t}\n\t\twatch_bell = 0;\n\t\tsound_bell = 0;\n\t}\n}"
  },
  {
    "function_name": "initialize_xkb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-29074/repo/src/xkb_bell.c",
    "lines": "54-70",
    "snippet": "void initialize_xkb(void) {\n\tint op, er, maj, min;\n\t\n\tRAWFB_RET_VOID\n\n\tif (xkbcompat) {\n\t\txkb_present = 0;\n\t} else if (! XkbQueryExtension(dpy, &op, &xkb_base_event_type, &er, &maj, &min)) {\n\t\tif (! quiet) {\n\t\t\trfbLog(\"warning: XKEYBOARD extension not present.\\n\");\n\t\t}\n\t\txkb_present = 0;\n\t\txkb_base_event_type = 0;\n\t} else {\n\t\txkb_present = 1;\n\t}\n}",
    "includes": [
      "#include \"connections.h\"",
      "#include \"xwrappers.h\"",
      "#include \"x11vnc.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int xkb_base_event_type = 0;",
      "void initialize_xkb(void);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "rfbLog",
          "args": [
            "\"warning: XKEYBOARD extension not present.\\n\""
          ],
          "line": 63
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "XkbQueryExtension",
          "args": [
            "dpy",
            "&op",
            "&xkb_base_event_type",
            "&er",
            "&maj",
            "&min"
          ],
          "line": 61
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"connections.h\"\n#include \"xwrappers.h\"\n#include \"x11vnc.h\"\n\nint xkb_base_event_type = 0;\nvoid initialize_xkb(void);\n\nvoid initialize_xkb(void) {\n\tint op, er, maj, min;\n\t\n\tRAWFB_RET_VOID\n\n\tif (xkbcompat) {\n\t\txkb_present = 0;\n\t} else if (! XkbQueryExtension(dpy, &op, &xkb_base_event_type, &er, &maj, &min)) {\n\t\tif (! quiet) {\n\t\t\trfbLog(\"warning: XKEYBOARD extension not present.\\n\");\n\t\t}\n\t\txkb_present = 0;\n\t\txkb_base_event_type = 0;\n\t} else {\n\t\txkb_present = 1;\n\t}\n}"
  }
]