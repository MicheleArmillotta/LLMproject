[
  {
    "function_name": "kvm_page_track_write",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-3713/repo/arch/x86/kvm/page_track.c",
    "lines": "210-227",
    "snippet": "void kvm_page_track_write(struct kvm_vcpu *vcpu, gpa_t gpa, const u8 *new,\n\t\t\t  int bytes)\n{\n\tstruct kvm_page_track_notifier_head *head;\n\tstruct kvm_page_track_notifier_node *n;\n\tint idx;\n\n\thead = &vcpu->kvm->arch.track_notifier_head;\n\n\tif (hlist_empty(&head->track_notifier_list))\n\t\treturn;\n\n\tidx = srcu_read_lock(&head->track_srcu);\n\thlist_for_each_entry_rcu(n, &head->track_notifier_list, node)\n\t\tif (n->track_write)\n\t\t\tn->track_write(vcpu, gpa, new, bytes);\n\tsrcu_read_unlock(&head->track_srcu, idx);\n}",
    "includes": [
      "#include \"mmu.h\"",
      "#include <asm/kvm_page_track.h>",
      "#include <asm/kvm_host.h>",
      "#include <linux/kvm_host.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "srcu_read_unlock",
          "args": [
            "&head->track_srcu",
            "idx"
          ],
          "line": 226
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "n->track_write",
          "args": [
            "vcpu",
            "gpa",
            "new",
            "bytes"
          ],
          "line": 225
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hlist_for_each_entry_rcu",
          "args": [
            "n",
            "&head->track_notifier_list",
            "node"
          ],
          "line": 223
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "srcu_read_lock",
          "args": [
            "&head->track_srcu"
          ],
          "line": 222
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hlist_empty",
          "args": [
            "&head->track_notifier_list"
          ],
          "line": 219
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"mmu.h\"\n#include <asm/kvm_page_track.h>\n#include <asm/kvm_host.h>\n#include <linux/kvm_host.h>\n\nvoid kvm_page_track_write(struct kvm_vcpu *vcpu, gpa_t gpa, const u8 *new,\n\t\t\t  int bytes)\n{\n\tstruct kvm_page_track_notifier_head *head;\n\tstruct kvm_page_track_notifier_node *n;\n\tint idx;\n\n\thead = &vcpu->kvm->arch.track_notifier_head;\n\n\tif (hlist_empty(&head->track_notifier_list))\n\t\treturn;\n\n\tidx = srcu_read_lock(&head->track_srcu);\n\thlist_for_each_entry_rcu(n, &head->track_notifier_list, node)\n\t\tif (n->track_write)\n\t\t\tn->track_write(vcpu, gpa, new, bytes);\n\tsrcu_read_unlock(&head->track_srcu, idx);\n}"
  },
  {
    "function_name": "kvm_page_track_unregister_notifier",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-3713/repo/arch/x86/kvm/page_track.c",
    "lines": "189-201",
    "snippet": "void\nkvm_page_track_unregister_notifier(struct kvm *kvm,\n\t\t\t\t   struct kvm_page_track_notifier_node *n)\n{\n\tstruct kvm_page_track_notifier_head *head;\n\n\thead = &kvm->arch.track_notifier_head;\n\n\tspin_lock(&kvm->mmu_lock);\n\thlist_del_rcu(&n->node);\n\tspin_unlock(&kvm->mmu_lock);\n\tsynchronize_srcu(&head->track_srcu);\n}",
    "includes": [
      "#include \"mmu.h\"",
      "#include <asm/kvm_page_track.h>",
      "#include <asm/kvm_host.h>",
      "#include <linux/kvm_host.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "synchronize_srcu",
          "args": [
            "&head->track_srcu"
          ],
          "line": 200
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "spin_unlock",
          "args": [
            "&kvm->mmu_lock"
          ],
          "line": 199
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hlist_del_rcu",
          "args": [
            "&n->node"
          ],
          "line": 198
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "spin_lock",
          "args": [
            "&kvm->mmu_lock"
          ],
          "line": 197
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"mmu.h\"\n#include <asm/kvm_page_track.h>\n#include <asm/kvm_host.h>\n#include <linux/kvm_host.h>\n\nvoid\nkvm_page_track_unregister_notifier(struct kvm *kvm,\n\t\t\t\t   struct kvm_page_track_notifier_node *n)\n{\n\tstruct kvm_page_track_notifier_head *head;\n\n\thead = &kvm->arch.track_notifier_head;\n\n\tspin_lock(&kvm->mmu_lock);\n\thlist_del_rcu(&n->node);\n\tspin_unlock(&kvm->mmu_lock);\n\tsynchronize_srcu(&head->track_srcu);\n}"
  },
  {
    "function_name": "kvm_page_track_register_notifier",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-3713/repo/arch/x86/kvm/page_track.c",
    "lines": "172-183",
    "snippet": "void\nkvm_page_track_register_notifier(struct kvm *kvm,\n\t\t\t\t struct kvm_page_track_notifier_node *n)\n{\n\tstruct kvm_page_track_notifier_head *head;\n\n\thead = &kvm->arch.track_notifier_head;\n\n\tspin_lock(&kvm->mmu_lock);\n\thlist_add_head_rcu(&n->node, &head->track_notifier_list);\n\tspin_unlock(&kvm->mmu_lock);\n}",
    "includes": [
      "#include \"mmu.h\"",
      "#include <asm/kvm_page_track.h>",
      "#include <asm/kvm_host.h>",
      "#include <linux/kvm_host.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "spin_unlock",
          "args": [
            "&kvm->mmu_lock"
          ],
          "line": 182
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hlist_add_head_rcu",
          "args": [
            "&n->node",
            "&head->track_notifier_list"
          ],
          "line": 181
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "spin_lock",
          "args": [
            "&kvm->mmu_lock"
          ],
          "line": 180
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"mmu.h\"\n#include <asm/kvm_page_track.h>\n#include <asm/kvm_host.h>\n#include <linux/kvm_host.h>\n\nvoid\nkvm_page_track_register_notifier(struct kvm *kvm,\n\t\t\t\t struct kvm_page_track_notifier_node *n)\n{\n\tstruct kvm_page_track_notifier_head *head;\n\n\thead = &kvm->arch.track_notifier_head;\n\n\tspin_lock(&kvm->mmu_lock);\n\thlist_add_head_rcu(&n->node, &head->track_notifier_list);\n\tspin_unlock(&kvm->mmu_lock);\n}"
  },
  {
    "function_name": "kvm_page_track_init",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-3713/repo/arch/x86/kvm/page_track.c",
    "lines": "159-166",
    "snippet": "void kvm_page_track_init(struct kvm *kvm)\n{\n\tstruct kvm_page_track_notifier_head *head;\n\n\thead = &kvm->arch.track_notifier_head;\n\tinit_srcu_struct(&head->track_srcu);\n\tINIT_HLIST_HEAD(&head->track_notifier_list);\n}",
    "includes": [
      "#include \"mmu.h\"",
      "#include <asm/kvm_page_track.h>",
      "#include <asm/kvm_host.h>",
      "#include <linux/kvm_host.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "INIT_HLIST_HEAD",
          "args": [
            "&head->track_notifier_list"
          ],
          "line": 165
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "init_srcu_struct",
          "args": [
            "&head->track_srcu"
          ],
          "line": 164
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"mmu.h\"\n#include <asm/kvm_page_track.h>\n#include <asm/kvm_host.h>\n#include <linux/kvm_host.h>\n\nvoid kvm_page_track_init(struct kvm *kvm)\n{\n\tstruct kvm_page_track_notifier_head *head;\n\n\thead = &kvm->arch.track_notifier_head;\n\tinit_srcu_struct(&head->track_srcu);\n\tINIT_HLIST_HEAD(&head->track_notifier_list);\n}"
  },
  {
    "function_name": "kvm_page_track_is_active",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-3713/repo/arch/x86/kvm/page_track.c",
    "lines": "142-157",
    "snippet": "bool kvm_page_track_is_active(struct kvm_vcpu *vcpu, gfn_t gfn,\n\t\t\t      enum kvm_page_track_mode mode)\n{\n\tstruct kvm_memory_slot *slot;\n\tint index;\n\n\tif (WARN_ON(!page_track_mode_is_valid(mode)))\n\t\treturn false;\n\n\tslot = kvm_vcpu_gfn_to_memslot(vcpu, gfn);\n\tif (!slot)\n\t\treturn false;\n\n\tindex = gfn_to_index(gfn, slot->base_gfn, PT_PAGE_TABLE_LEVEL);\n\treturn !!ACCESS_ONCE(slot->arch.gfn_track[mode][index]);\n}",
    "includes": [
      "#include \"mmu.h\"",
      "#include <asm/kvm_page_track.h>",
      "#include <asm/kvm_host.h>",
      "#include <linux/kvm_host.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ACCESS_ONCE",
          "args": [
            "slot->arch.gfn_track[mode][index]"
          ],
          "line": 156
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gfn_to_index",
          "args": [
            "gfn",
            "slot->base_gfn",
            "PT_PAGE_TABLE_LEVEL"
          ],
          "line": 155
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kvm_vcpu_gfn_to_memslot",
          "args": [
            "vcpu",
            "gfn"
          ],
          "line": 151
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "WARN_ON",
          "args": [
            "!page_track_mode_is_valid(mode)"
          ],
          "line": 148
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "page_track_mode_is_valid",
          "args": [
            "mode"
          ],
          "line": 148
        },
        "resolved": true,
        "details": {
          "function_name": "page_track_mode_is_valid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-3713/repo/arch/x86/kvm/page_track.c",
          "lines": "54-60",
          "snippet": "static inline bool page_track_mode_is_valid(enum kvm_page_track_mode mode)\n{\n\tif (mode < 0 || mode >= KVM_PAGE_TRACK_MAX)\n\t\treturn false;\n\n\treturn true;\n}",
          "includes": [
            "#include \"mmu.h\"",
            "#include <asm/kvm_page_track.h>",
            "#include <asm/kvm_host.h>",
            "#include <linux/kvm_host.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"mmu.h\"\n#include <asm/kvm_page_track.h>\n#include <asm/kvm_host.h>\n#include <linux/kvm_host.h>\n\nstatic inline bool page_track_mode_is_valid(enum kvm_page_track_mode mode)\n{\n\tif (mode < 0 || mode >= KVM_PAGE_TRACK_MAX)\n\t\treturn false;\n\n\treturn true;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"mmu.h\"\n#include <asm/kvm_page_track.h>\n#include <asm/kvm_host.h>\n#include <linux/kvm_host.h>\n\nbool kvm_page_track_is_active(struct kvm_vcpu *vcpu, gfn_t gfn,\n\t\t\t      enum kvm_page_track_mode mode)\n{\n\tstruct kvm_memory_slot *slot;\n\tint index;\n\n\tif (WARN_ON(!page_track_mode_is_valid(mode)))\n\t\treturn false;\n\n\tslot = kvm_vcpu_gfn_to_memslot(vcpu, gfn);\n\tif (!slot)\n\t\treturn false;\n\n\tindex = gfn_to_index(gfn, slot->base_gfn, PT_PAGE_TABLE_LEVEL);\n\treturn !!ACCESS_ONCE(slot->arch.gfn_track[mode][index]);\n}"
  },
  {
    "function_name": "kvm_slot_page_track_remove_page",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-3713/repo/arch/x86/kvm/page_track.c",
    "lines": "123-137",
    "snippet": "void kvm_slot_page_track_remove_page(struct kvm *kvm,\n\t\t\t\t     struct kvm_memory_slot *slot, gfn_t gfn,\n\t\t\t\t     enum kvm_page_track_mode mode)\n{\n\tif (WARN_ON(!page_track_mode_is_valid(mode)))\n\t\treturn;\n\n\tupdate_gfn_track(slot, gfn, mode, -1);\n\n\t/*\n\t * allow large page mapping for the tracked page\n\t * after the tracker is gone.\n\t */\n\tkvm_mmu_gfn_allow_lpage(slot, gfn);\n}",
    "includes": [
      "#include \"mmu.h\"",
      "#include <asm/kvm_page_track.h>",
      "#include <asm/kvm_host.h>",
      "#include <linux/kvm_host.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "kvm_mmu_gfn_allow_lpage",
          "args": [
            "slot",
            "gfn"
          ],
          "line": 136
        },
        "resolved": true,
        "details": {
          "function_name": "kvm_mmu_gfn_allow_lpage",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-3713/repo/arch/x86/kvm/mmu.c",
          "lines": "805-808",
          "snippet": "void kvm_mmu_gfn_allow_lpage(struct kvm_memory_slot *slot, gfn_t gfn)\n{\n\tupdate_gfn_disallow_lpage_count(slot, gfn, -1);\n}",
          "includes": [
            "#include \"paging_tmpl.h\"",
            "#include \"paging_tmpl.h\"",
            "#include \"paging_tmpl.h\"",
            "#include \"mmu_audit.c\"",
            "#include \"mmutrace.h\"",
            "#include <trace/events/kvm.h>",
            "#include <asm/kvm_page_track.h>",
            "#include <asm/vmx.h>",
            "#include <asm/io.h>",
            "#include <asm/cmpxchg.h>",
            "#include <asm/page.h>",
            "#include <linux/uaccess.h>",
            "#include <linux/slab.h>",
            "#include <linux/srcu.h>",
            "#include <linux/compiler.h>",
            "#include <linux/hugetlb.h>",
            "#include <linux/swap.h>",
            "#include <linux/module.h>",
            "#include <linux/highmem.h>",
            "#include <linux/mm.h>",
            "#include <linux/string.h>",
            "#include <linux/types.h>",
            "#include <linux/kvm_host.h>",
            "#include \"cpuid.h\"",
            "#include \"kvm_cache_regs.h\"",
            "#include \"x86.h\"",
            "#include \"mmu.h\"",
            "#include \"irq.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"paging_tmpl.h\"\n#include \"paging_tmpl.h\"\n#include \"paging_tmpl.h\"\n#include \"mmu_audit.c\"\n#include \"mmutrace.h\"\n#include <trace/events/kvm.h>\n#include <asm/kvm_page_track.h>\n#include <asm/vmx.h>\n#include <asm/io.h>\n#include <asm/cmpxchg.h>\n#include <asm/page.h>\n#include <linux/uaccess.h>\n#include <linux/slab.h>\n#include <linux/srcu.h>\n#include <linux/compiler.h>\n#include <linux/hugetlb.h>\n#include <linux/swap.h>\n#include <linux/module.h>\n#include <linux/highmem.h>\n#include <linux/mm.h>\n#include <linux/string.h>\n#include <linux/types.h>\n#include <linux/kvm_host.h>\n#include \"cpuid.h\"\n#include \"kvm_cache_regs.h\"\n#include \"x86.h\"\n#include \"mmu.h\"\n#include \"irq.h\"\n\nvoid kvm_mmu_gfn_allow_lpage(struct kvm_memory_slot *slot, gfn_t gfn)\n{\n\tupdate_gfn_disallow_lpage_count(slot, gfn, -1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "update_gfn_track",
          "args": [
            "slot",
            "gfn",
            "mode",
            "-1"
          ],
          "line": 130
        },
        "resolved": true,
        "details": {
          "function_name": "update_gfn_track",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-3713/repo/arch/x86/kvm/page_track.c",
          "lines": "62-75",
          "snippet": "static void update_gfn_track(struct kvm_memory_slot *slot, gfn_t gfn,\n\t\t\t     enum kvm_page_track_mode mode, short count)\n{\n\tint index, val;\n\n\tindex = gfn_to_index(gfn, slot->base_gfn, PT_PAGE_TABLE_LEVEL);\n\n\tval = slot->arch.gfn_track[mode][index];\n\n\tif (WARN_ON(val + count < 0 || val + count > USHRT_MAX))\n\t\treturn;\n\n\tslot->arch.gfn_track[mode][index] += count;\n}",
          "includes": [
            "#include \"mmu.h\"",
            "#include <asm/kvm_page_track.h>",
            "#include <asm/kvm_host.h>",
            "#include <linux/kvm_host.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"mmu.h\"\n#include <asm/kvm_page_track.h>\n#include <asm/kvm_host.h>\n#include <linux/kvm_host.h>\n\nstatic void update_gfn_track(struct kvm_memory_slot *slot, gfn_t gfn,\n\t\t\t     enum kvm_page_track_mode mode, short count)\n{\n\tint index, val;\n\n\tindex = gfn_to_index(gfn, slot->base_gfn, PT_PAGE_TABLE_LEVEL);\n\n\tval = slot->arch.gfn_track[mode][index];\n\n\tif (WARN_ON(val + count < 0 || val + count > USHRT_MAX))\n\t\treturn;\n\n\tslot->arch.gfn_track[mode][index] += count;\n}"
        }
      },
      {
        "call_info": {
          "callee": "WARN_ON",
          "args": [
            "!page_track_mode_is_valid(mode)"
          ],
          "line": 127
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "page_track_mode_is_valid",
          "args": [
            "mode"
          ],
          "line": 127
        },
        "resolved": true,
        "details": {
          "function_name": "page_track_mode_is_valid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-3713/repo/arch/x86/kvm/page_track.c",
          "lines": "54-60",
          "snippet": "static inline bool page_track_mode_is_valid(enum kvm_page_track_mode mode)\n{\n\tif (mode < 0 || mode >= KVM_PAGE_TRACK_MAX)\n\t\treturn false;\n\n\treturn true;\n}",
          "includes": [
            "#include \"mmu.h\"",
            "#include <asm/kvm_page_track.h>",
            "#include <asm/kvm_host.h>",
            "#include <linux/kvm_host.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"mmu.h\"\n#include <asm/kvm_page_track.h>\n#include <asm/kvm_host.h>\n#include <linux/kvm_host.h>\n\nstatic inline bool page_track_mode_is_valid(enum kvm_page_track_mode mode)\n{\n\tif (mode < 0 || mode >= KVM_PAGE_TRACK_MAX)\n\t\treturn false;\n\n\treturn true;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"mmu.h\"\n#include <asm/kvm_page_track.h>\n#include <asm/kvm_host.h>\n#include <linux/kvm_host.h>\n\nvoid kvm_slot_page_track_remove_page(struct kvm *kvm,\n\t\t\t\t     struct kvm_memory_slot *slot, gfn_t gfn,\n\t\t\t\t     enum kvm_page_track_mode mode)\n{\n\tif (WARN_ON(!page_track_mode_is_valid(mode)))\n\t\treturn;\n\n\tupdate_gfn_track(slot, gfn, mode, -1);\n\n\t/*\n\t * allow large page mapping for the tracked page\n\t * after the tracker is gone.\n\t */\n\tkvm_mmu_gfn_allow_lpage(slot, gfn);\n}"
  },
  {
    "function_name": "kvm_slot_page_track_add_page",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-3713/repo/arch/x86/kvm/page_track.c",
    "lines": "89-108",
    "snippet": "void kvm_slot_page_track_add_page(struct kvm *kvm,\n\t\t\t\t  struct kvm_memory_slot *slot, gfn_t gfn,\n\t\t\t\t  enum kvm_page_track_mode mode)\n{\n\n\tif (WARN_ON(!page_track_mode_is_valid(mode)))\n\t\treturn;\n\n\tupdate_gfn_track(slot, gfn, mode, 1);\n\n\t/*\n\t * new track stops large page mapping for the\n\t * tracked page.\n\t */\n\tkvm_mmu_gfn_disallow_lpage(slot, gfn);\n\n\tif (mode == KVM_PAGE_TRACK_WRITE)\n\t\tif (kvm_mmu_slot_gfn_write_protect(kvm, slot, gfn))\n\t\t\tkvm_flush_remote_tlbs(kvm);\n}",
    "includes": [
      "#include \"mmu.h\"",
      "#include <asm/kvm_page_track.h>",
      "#include <asm/kvm_host.h>",
      "#include <linux/kvm_host.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "kvm_flush_remote_tlbs",
          "args": [
            "kvm"
          ],
          "line": 107
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kvm_mmu_slot_gfn_write_protect",
          "args": [
            "kvm",
            "slot",
            "gfn"
          ],
          "line": 106
        },
        "resolved": true,
        "details": {
          "function_name": "kvm_mmu_slot_gfn_write_protect",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-3713/repo/arch/x86/kvm/mmu.c",
          "lines": "1357-1370",
          "snippet": "bool kvm_mmu_slot_gfn_write_protect(struct kvm *kvm,\n\t\t\t\t    struct kvm_memory_slot *slot, u64 gfn)\n{\n\tstruct kvm_rmap_head *rmap_head;\n\tint i;\n\tbool write_protected = false;\n\n\tfor (i = PT_PAGE_TABLE_LEVEL; i <= PT_MAX_HUGEPAGE_LEVEL; ++i) {\n\t\trmap_head = __gfn_to_rmap(gfn, i, slot);\n\t\twrite_protected |= __rmap_write_protect(kvm, rmap_head, true);\n\t}\n\n\treturn write_protected;\n}",
          "includes": [
            "#include \"paging_tmpl.h\"",
            "#include \"paging_tmpl.h\"",
            "#include \"paging_tmpl.h\"",
            "#include \"mmu_audit.c\"",
            "#include \"mmutrace.h\"",
            "#include <trace/events/kvm.h>",
            "#include <asm/kvm_page_track.h>",
            "#include <asm/vmx.h>",
            "#include <asm/io.h>",
            "#include <asm/cmpxchg.h>",
            "#include <asm/page.h>",
            "#include <linux/uaccess.h>",
            "#include <linux/slab.h>",
            "#include <linux/srcu.h>",
            "#include <linux/compiler.h>",
            "#include <linux/hugetlb.h>",
            "#include <linux/swap.h>",
            "#include <linux/module.h>",
            "#include <linux/highmem.h>",
            "#include <linux/mm.h>",
            "#include <linux/string.h>",
            "#include <linux/types.h>",
            "#include <linux/kvm_host.h>",
            "#include \"cpuid.h\"",
            "#include \"kvm_cache_regs.h\"",
            "#include \"x86.h\"",
            "#include \"mmu.h\"",
            "#include \"irq.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"paging_tmpl.h\"\n#include \"paging_tmpl.h\"\n#include \"paging_tmpl.h\"\n#include \"mmu_audit.c\"\n#include \"mmutrace.h\"\n#include <trace/events/kvm.h>\n#include <asm/kvm_page_track.h>\n#include <asm/vmx.h>\n#include <asm/io.h>\n#include <asm/cmpxchg.h>\n#include <asm/page.h>\n#include <linux/uaccess.h>\n#include <linux/slab.h>\n#include <linux/srcu.h>\n#include <linux/compiler.h>\n#include <linux/hugetlb.h>\n#include <linux/swap.h>\n#include <linux/module.h>\n#include <linux/highmem.h>\n#include <linux/mm.h>\n#include <linux/string.h>\n#include <linux/types.h>\n#include <linux/kvm_host.h>\n#include \"cpuid.h\"\n#include \"kvm_cache_regs.h\"\n#include \"x86.h\"\n#include \"mmu.h\"\n#include \"irq.h\"\n\nbool kvm_mmu_slot_gfn_write_protect(struct kvm *kvm,\n\t\t\t\t    struct kvm_memory_slot *slot, u64 gfn)\n{\n\tstruct kvm_rmap_head *rmap_head;\n\tint i;\n\tbool write_protected = false;\n\n\tfor (i = PT_PAGE_TABLE_LEVEL; i <= PT_MAX_HUGEPAGE_LEVEL; ++i) {\n\t\trmap_head = __gfn_to_rmap(gfn, i, slot);\n\t\twrite_protected |= __rmap_write_protect(kvm, rmap_head, true);\n\t}\n\n\treturn write_protected;\n}"
        }
      },
      {
        "call_info": {
          "callee": "kvm_mmu_gfn_disallow_lpage",
          "args": [
            "slot",
            "gfn"
          ],
          "line": 103
        },
        "resolved": true,
        "details": {
          "function_name": "kvm_mmu_gfn_disallow_lpage",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-3713/repo/arch/x86/kvm/mmu.c",
          "lines": "800-803",
          "snippet": "void kvm_mmu_gfn_disallow_lpage(struct kvm_memory_slot *slot, gfn_t gfn)\n{\n\tupdate_gfn_disallow_lpage_count(slot, gfn, 1);\n}",
          "includes": [
            "#include \"paging_tmpl.h\"",
            "#include \"paging_tmpl.h\"",
            "#include \"paging_tmpl.h\"",
            "#include \"mmu_audit.c\"",
            "#include \"mmutrace.h\"",
            "#include <trace/events/kvm.h>",
            "#include <asm/kvm_page_track.h>",
            "#include <asm/vmx.h>",
            "#include <asm/io.h>",
            "#include <asm/cmpxchg.h>",
            "#include <asm/page.h>",
            "#include <linux/uaccess.h>",
            "#include <linux/slab.h>",
            "#include <linux/srcu.h>",
            "#include <linux/compiler.h>",
            "#include <linux/hugetlb.h>",
            "#include <linux/swap.h>",
            "#include <linux/module.h>",
            "#include <linux/highmem.h>",
            "#include <linux/mm.h>",
            "#include <linux/string.h>",
            "#include <linux/types.h>",
            "#include <linux/kvm_host.h>",
            "#include \"cpuid.h\"",
            "#include \"kvm_cache_regs.h\"",
            "#include \"x86.h\"",
            "#include \"mmu.h\"",
            "#include \"irq.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"paging_tmpl.h\"\n#include \"paging_tmpl.h\"\n#include \"paging_tmpl.h\"\n#include \"mmu_audit.c\"\n#include \"mmutrace.h\"\n#include <trace/events/kvm.h>\n#include <asm/kvm_page_track.h>\n#include <asm/vmx.h>\n#include <asm/io.h>\n#include <asm/cmpxchg.h>\n#include <asm/page.h>\n#include <linux/uaccess.h>\n#include <linux/slab.h>\n#include <linux/srcu.h>\n#include <linux/compiler.h>\n#include <linux/hugetlb.h>\n#include <linux/swap.h>\n#include <linux/module.h>\n#include <linux/highmem.h>\n#include <linux/mm.h>\n#include <linux/string.h>\n#include <linux/types.h>\n#include <linux/kvm_host.h>\n#include \"cpuid.h\"\n#include \"kvm_cache_regs.h\"\n#include \"x86.h\"\n#include \"mmu.h\"\n#include \"irq.h\"\n\nvoid kvm_mmu_gfn_disallow_lpage(struct kvm_memory_slot *slot, gfn_t gfn)\n{\n\tupdate_gfn_disallow_lpage_count(slot, gfn, 1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "update_gfn_track",
          "args": [
            "slot",
            "gfn",
            "mode",
            "1"
          ],
          "line": 97
        },
        "resolved": true,
        "details": {
          "function_name": "update_gfn_track",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-3713/repo/arch/x86/kvm/page_track.c",
          "lines": "62-75",
          "snippet": "static void update_gfn_track(struct kvm_memory_slot *slot, gfn_t gfn,\n\t\t\t     enum kvm_page_track_mode mode, short count)\n{\n\tint index, val;\n\n\tindex = gfn_to_index(gfn, slot->base_gfn, PT_PAGE_TABLE_LEVEL);\n\n\tval = slot->arch.gfn_track[mode][index];\n\n\tif (WARN_ON(val + count < 0 || val + count > USHRT_MAX))\n\t\treturn;\n\n\tslot->arch.gfn_track[mode][index] += count;\n}",
          "includes": [
            "#include \"mmu.h\"",
            "#include <asm/kvm_page_track.h>",
            "#include <asm/kvm_host.h>",
            "#include <linux/kvm_host.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"mmu.h\"\n#include <asm/kvm_page_track.h>\n#include <asm/kvm_host.h>\n#include <linux/kvm_host.h>\n\nstatic void update_gfn_track(struct kvm_memory_slot *slot, gfn_t gfn,\n\t\t\t     enum kvm_page_track_mode mode, short count)\n{\n\tint index, val;\n\n\tindex = gfn_to_index(gfn, slot->base_gfn, PT_PAGE_TABLE_LEVEL);\n\n\tval = slot->arch.gfn_track[mode][index];\n\n\tif (WARN_ON(val + count < 0 || val + count > USHRT_MAX))\n\t\treturn;\n\n\tslot->arch.gfn_track[mode][index] += count;\n}"
        }
      },
      {
        "call_info": {
          "callee": "WARN_ON",
          "args": [
            "!page_track_mode_is_valid(mode)"
          ],
          "line": 94
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "page_track_mode_is_valid",
          "args": [
            "mode"
          ],
          "line": 94
        },
        "resolved": true,
        "details": {
          "function_name": "page_track_mode_is_valid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-3713/repo/arch/x86/kvm/page_track.c",
          "lines": "54-60",
          "snippet": "static inline bool page_track_mode_is_valid(enum kvm_page_track_mode mode)\n{\n\tif (mode < 0 || mode >= KVM_PAGE_TRACK_MAX)\n\t\treturn false;\n\n\treturn true;\n}",
          "includes": [
            "#include \"mmu.h\"",
            "#include <asm/kvm_page_track.h>",
            "#include <asm/kvm_host.h>",
            "#include <linux/kvm_host.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"mmu.h\"\n#include <asm/kvm_page_track.h>\n#include <asm/kvm_host.h>\n#include <linux/kvm_host.h>\n\nstatic inline bool page_track_mode_is_valid(enum kvm_page_track_mode mode)\n{\n\tif (mode < 0 || mode >= KVM_PAGE_TRACK_MAX)\n\t\treturn false;\n\n\treturn true;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"mmu.h\"\n#include <asm/kvm_page_track.h>\n#include <asm/kvm_host.h>\n#include <linux/kvm_host.h>\n\nvoid kvm_slot_page_track_add_page(struct kvm *kvm,\n\t\t\t\t  struct kvm_memory_slot *slot, gfn_t gfn,\n\t\t\t\t  enum kvm_page_track_mode mode)\n{\n\n\tif (WARN_ON(!page_track_mode_is_valid(mode)))\n\t\treturn;\n\n\tupdate_gfn_track(slot, gfn, mode, 1);\n\n\t/*\n\t * new track stops large page mapping for the\n\t * tracked page.\n\t */\n\tkvm_mmu_gfn_disallow_lpage(slot, gfn);\n\n\tif (mode == KVM_PAGE_TRACK_WRITE)\n\t\tif (kvm_mmu_slot_gfn_write_protect(kvm, slot, gfn))\n\t\t\tkvm_flush_remote_tlbs(kvm);\n}"
  },
  {
    "function_name": "update_gfn_track",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-3713/repo/arch/x86/kvm/page_track.c",
    "lines": "62-75",
    "snippet": "static void update_gfn_track(struct kvm_memory_slot *slot, gfn_t gfn,\n\t\t\t     enum kvm_page_track_mode mode, short count)\n{\n\tint index, val;\n\n\tindex = gfn_to_index(gfn, slot->base_gfn, PT_PAGE_TABLE_LEVEL);\n\n\tval = slot->arch.gfn_track[mode][index];\n\n\tif (WARN_ON(val + count < 0 || val + count > USHRT_MAX))\n\t\treturn;\n\n\tslot->arch.gfn_track[mode][index] += count;\n}",
    "includes": [
      "#include \"mmu.h\"",
      "#include <asm/kvm_page_track.h>",
      "#include <asm/kvm_host.h>",
      "#include <linux/kvm_host.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "WARN_ON",
          "args": [
            "val + count < 0 || val + count > USHRT_MAX"
          ],
          "line": 71
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gfn_to_index",
          "args": [
            "gfn",
            "slot->base_gfn",
            "PT_PAGE_TABLE_LEVEL"
          ],
          "line": 67
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"mmu.h\"\n#include <asm/kvm_page_track.h>\n#include <asm/kvm_host.h>\n#include <linux/kvm_host.h>\n\nstatic void update_gfn_track(struct kvm_memory_slot *slot, gfn_t gfn,\n\t\t\t     enum kvm_page_track_mode mode, short count)\n{\n\tint index, val;\n\n\tindex = gfn_to_index(gfn, slot->base_gfn, PT_PAGE_TABLE_LEVEL);\n\n\tval = slot->arch.gfn_track[mode][index];\n\n\tif (WARN_ON(val + count < 0 || val + count > USHRT_MAX))\n\t\treturn;\n\n\tslot->arch.gfn_track[mode][index] += count;\n}"
  },
  {
    "function_name": "page_track_mode_is_valid",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-3713/repo/arch/x86/kvm/page_track.c",
    "lines": "54-60",
    "snippet": "static inline bool page_track_mode_is_valid(enum kvm_page_track_mode mode)\n{\n\tif (mode < 0 || mode >= KVM_PAGE_TRACK_MAX)\n\t\treturn false;\n\n\treturn true;\n}",
    "includes": [
      "#include \"mmu.h\"",
      "#include <asm/kvm_page_track.h>",
      "#include <asm/kvm_host.h>",
      "#include <linux/kvm_host.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"mmu.h\"\n#include <asm/kvm_page_track.h>\n#include <asm/kvm_host.h>\n#include <linux/kvm_host.h>\n\nstatic inline bool page_track_mode_is_valid(enum kvm_page_track_mode mode)\n{\n\tif (mode < 0 || mode >= KVM_PAGE_TRACK_MAX)\n\t\treturn false;\n\n\treturn true;\n}"
  },
  {
    "function_name": "kvm_page_track_create_memslot",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-3713/repo/arch/x86/kvm/page_track.c",
    "lines": "35-52",
    "snippet": "int kvm_page_track_create_memslot(struct kvm_memory_slot *slot,\n\t\t\t\t  unsigned long npages)\n{\n\tint  i;\n\n\tfor (i = 0; i < KVM_PAGE_TRACK_MAX; i++) {\n\t\tslot->arch.gfn_track[i] = kvm_kvzalloc(npages *\n\t\t\t\t\t    sizeof(*slot->arch.gfn_track[i]));\n\t\tif (!slot->arch.gfn_track[i])\n\t\t\tgoto track_free;\n\t}\n\n\treturn 0;\n\ntrack_free:\n\tkvm_page_track_free_memslot(slot, NULL);\n\treturn -ENOMEM;\n}",
    "includes": [
      "#include \"mmu.h\"",
      "#include <asm/kvm_page_track.h>",
      "#include <asm/kvm_host.h>",
      "#include <linux/kvm_host.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "kvm_page_track_free_memslot",
          "args": [
            "slot",
            "NULL"
          ],
          "line": 50
        },
        "resolved": true,
        "details": {
          "function_name": "kvm_page_track_free_memslot",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-3713/repo/arch/x86/kvm/page_track.c",
          "lines": "22-33",
          "snippet": "void kvm_page_track_free_memslot(struct kvm_memory_slot *free,\n\t\t\t\t struct kvm_memory_slot *dont)\n{\n\tint i;\n\n\tfor (i = 0; i < KVM_PAGE_TRACK_MAX; i++)\n\t\tif (!dont || free->arch.gfn_track[i] !=\n\t\t      dont->arch.gfn_track[i]) {\n\t\t\tkvfree(free->arch.gfn_track[i]);\n\t\t\tfree->arch.gfn_track[i] = NULL;\n\t\t}\n}",
          "includes": [
            "#include \"mmu.h\"",
            "#include <asm/kvm_page_track.h>",
            "#include <asm/kvm_host.h>",
            "#include <linux/kvm_host.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"mmu.h\"\n#include <asm/kvm_page_track.h>\n#include <asm/kvm_host.h>\n#include <linux/kvm_host.h>\n\nvoid kvm_page_track_free_memslot(struct kvm_memory_slot *free,\n\t\t\t\t struct kvm_memory_slot *dont)\n{\n\tint i;\n\n\tfor (i = 0; i < KVM_PAGE_TRACK_MAX; i++)\n\t\tif (!dont || free->arch.gfn_track[i] !=\n\t\t      dont->arch.gfn_track[i]) {\n\t\t\tkvfree(free->arch.gfn_track[i]);\n\t\t\tfree->arch.gfn_track[i] = NULL;\n\t\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "kvm_kvzalloc",
          "args": [
            "npages *\n\t\t\t\t\t    sizeof(*slot->arch.gfn_track[i])"
          ],
          "line": 41
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"mmu.h\"\n#include <asm/kvm_page_track.h>\n#include <asm/kvm_host.h>\n#include <linux/kvm_host.h>\n\nint kvm_page_track_create_memslot(struct kvm_memory_slot *slot,\n\t\t\t\t  unsigned long npages)\n{\n\tint  i;\n\n\tfor (i = 0; i < KVM_PAGE_TRACK_MAX; i++) {\n\t\tslot->arch.gfn_track[i] = kvm_kvzalloc(npages *\n\t\t\t\t\t    sizeof(*slot->arch.gfn_track[i]));\n\t\tif (!slot->arch.gfn_track[i])\n\t\t\tgoto track_free;\n\t}\n\n\treturn 0;\n\ntrack_free:\n\tkvm_page_track_free_memslot(slot, NULL);\n\treturn -ENOMEM;\n}"
  },
  {
    "function_name": "kvm_page_track_free_memslot",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2016-3713/repo/arch/x86/kvm/page_track.c",
    "lines": "22-33",
    "snippet": "void kvm_page_track_free_memslot(struct kvm_memory_slot *free,\n\t\t\t\t struct kvm_memory_slot *dont)\n{\n\tint i;\n\n\tfor (i = 0; i < KVM_PAGE_TRACK_MAX; i++)\n\t\tif (!dont || free->arch.gfn_track[i] !=\n\t\t      dont->arch.gfn_track[i]) {\n\t\t\tkvfree(free->arch.gfn_track[i]);\n\t\t\tfree->arch.gfn_track[i] = NULL;\n\t\t}\n}",
    "includes": [
      "#include \"mmu.h\"",
      "#include <asm/kvm_page_track.h>",
      "#include <asm/kvm_host.h>",
      "#include <linux/kvm_host.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "kvfree",
          "args": [
            "free->arch.gfn_track[i]"
          ],
          "line": 30
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"mmu.h\"\n#include <asm/kvm_page_track.h>\n#include <asm/kvm_host.h>\n#include <linux/kvm_host.h>\n\nvoid kvm_page_track_free_memslot(struct kvm_memory_slot *free,\n\t\t\t\t struct kvm_memory_slot *dont)\n{\n\tint i;\n\n\tfor (i = 0; i < KVM_PAGE_TRACK_MAX; i++)\n\t\tif (!dont || free->arch.gfn_track[i] !=\n\t\t      dont->arch.gfn_track[i]) {\n\t\t\tkvfree(free->arch.gfn_track[i]);\n\t\t\tfree->arch.gfn_track[i] = NULL;\n\t\t}\n}"
  }
]