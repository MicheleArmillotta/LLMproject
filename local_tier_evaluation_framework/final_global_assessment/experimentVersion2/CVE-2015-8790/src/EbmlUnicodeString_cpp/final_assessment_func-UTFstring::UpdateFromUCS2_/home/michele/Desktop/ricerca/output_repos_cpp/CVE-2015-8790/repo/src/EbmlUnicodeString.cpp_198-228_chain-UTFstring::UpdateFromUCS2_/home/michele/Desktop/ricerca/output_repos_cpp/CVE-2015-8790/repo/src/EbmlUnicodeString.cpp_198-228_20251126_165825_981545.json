{
  "assessment_type": "combined",
  "id": [
    "UTFstring::UpdateFromUCS2",
    "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-8790/repo/src/EbmlUnicodeString.cpp",
    "198-228"
  ],
  "file_path": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-8790/repo/src/EbmlUnicodeString.cpp",
  "function_name": "UTFstring::UpdateFromUCS2",
  "function_code": "#include \"ebml/EbmlUnicodeString.h\"\n#include <wchar.h>\n#include <cassert>\n\nvoid UTFstring::UpdateFromUCS2()\n{\n  // find the size of the final UTF-8 string\n  size_t i,Size=0;\n  for (i=0; i<_Length; i++) {\n    if (_Data[i] < 0x80) {\n      Size++;\n    } else if (_Data[i] < 0x800) {\n      Size += 2;\n    } else {\n      Size += 3;\n    }\n  }\n  std::string::value_type *tmpStr = new std::string::value_type[Size+1];\n  for (i=0, Size=0; i<_Length; i++) {\n    if (_Data[i] < 0x80) {\n      tmpStr[Size++] = _Data[i];\n    } else if (_Data[i] < 0x800) {\n      tmpStr[Size++] = 0xC0 | (_Data[i] >> 6);\n      tmpStr[Size++] = 0x80 | (_Data[i] & 0x3F);\n    } else {\n      tmpStr[Size++] = 0xE0 | (_Data[i] >> 12);\n      tmpStr[Size++] = 0x80 | ((_Data[i] >> 6) & 0x3F);\n      tmpStr[Size++] = 0x80 | (_Data[i] & 0x3F);\n    }\n  }\n  tmpStr[Size] = 0;\n  UTF8string = tmpStr; // implicit conversion\n  delete [] tmpStr;\n\n}\n\n-------- CONTEXTUAL INFORMATIONS - CALLEES CODE --------\n-------- Code of the functions used by the analyzed function -------- \n\n",
  "chain_code": "---- CALL CHAIN SNIPPETS ----\n\n---- TARGET FUNCTION ----\nvoid UTFstring::UpdateFromUCS2()\n{\n  // find the size of the final UTF-8 string\n  size_t i,Size=0;\n  for (i=0; i<_Length; i++) {\n    if (_Data[i] < 0x80) {\n      Size++;\n    } else if (_Data[i] < 0x800) {\n      Size += 2;\n    } else {\n      Size += 3;\n    }\n  }\n  std::string::value_type *tmpStr = new std::string::value_type[Size+1];\n  for (i=0, Size=0; i<_Length; i++) {\n    if (_Data[i] < 0x80) {\n      tmpStr[Size++] = _Data[i];\n    } else if (_Data[i] < 0x800) {\n      tmpStr[Size++] = 0xC0 | (_Data[i] >> 6);\n      tmpStr[Size++] = 0x80 | (_Data[i] & 0x3F);\n    } else {\n      tmpStr[Size++] =",
  "False_positive_reason": "",
  "Preconditions": [
    "User-provided _Data array with attacker-controlled _Length field",
    "Length value large enough to cause integer overflow during UTF-8 size calculation"
  ],
  "Trigger_actions": [
    "Supply crafted UCS-2 string with malicious _Length value via cin >> _Data",
    "Call ConvertToUTF8() which triggers UpdateFromUCS2() without input validation"
  ],
  "Dangerous_post_conditions": [
    "Buffer allocation results in insufficient memory for UTF-8 data",
    "Heap-based buffer overflow when writing UTF-8 encoded data"
  ],
  "Initial_conditions": [
    "_Data array must be initialized from untrusted input via cin >> _Data",
    "UpdateFromUCS2() is called as part of ConvertToUTF8() without prior input validation"
  ]
}