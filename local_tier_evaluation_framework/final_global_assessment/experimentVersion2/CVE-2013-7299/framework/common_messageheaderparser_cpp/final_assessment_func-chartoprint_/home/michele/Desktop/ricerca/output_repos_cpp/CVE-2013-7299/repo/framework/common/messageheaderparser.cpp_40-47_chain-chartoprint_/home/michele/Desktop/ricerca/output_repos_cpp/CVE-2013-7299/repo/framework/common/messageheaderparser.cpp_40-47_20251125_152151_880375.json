{
  "assessment_type": "combined",
  "id": [
    "chartoprint",
    "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/messageheaderparser.cpp",
    "40-47"
  ],
  "file_path": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/messageheaderparser.cpp",
  "function_name": "chartoprint",
  "function_code": "#include <cxxtools/log.h>\n#include <cctype>\n#include <tnt/http.h>\n#include <tnt/httperror.h>\n#include <tnt/messageheaderparser.h>\n\nstd::string chartoprint(char ch)\n    {\n      const static char hex[] = \"0123456789abcdef\";\n      if (std::isprint(ch))\n        return std::string(1, '\\'') + ch + '\\'';\n      else\n        return std::string(\"'\\\\x\") + hex[ch >> 4] + hex[ch & 0xf] + '\\'';\n    }\n\n-------- CONTEXTUAL INFORMATIONS - CALLEES CODE --------\n-------- Code of the functions used by the analyzed function -------- \n\n",
  "chain_code": "---- CALL CHAIN SNIPPETS ----\n\n---- TARGET FUNCTION ----\nstd::string chartoprint(char ch)\n    {\n      const static char hex[] = \"0123456789abcdef\";\n      if (std::isprint(ch))\n        return std::string(1, '\\'') + ch + '\\'';\n      else\n        return std::string(\"'\\\\x\") + hex[ch >> 4] + hex[ch & 0xf] + '\\'';\n    }\n\n---- CALLER 1 ----\nbool HttpRequest::Parser::state_url(char ch)\n  {\n    if (ch == '?')\n    {\n      log_debug(\"url=\" << message.url);\n      SET_STATE(state_qparam);\n    }\n    else if (ch == '\\r')\n    {\n      log_debug(\"url=\" << message.url);\n      SET_STATE(state_end0);\n    }\n    else if (ch == '\\n')\n    {\n      log_debug(\"url=\" << message.url);\n      SET_STATE(state_header);\n    }\n    else if (ch == ' ' || ch == '\\t')\n    {\n      log_debug(\"url=\" << message.url);\n      SET_STATE(state_version);\n    }\n    else if (ch == '%')\n    {\n      SET_STATE(state_urlesc);\n      message.url += ch;\n    }\n    else if (ch > ' '\n\n---- CALLER 2 ----\nbool HttpRequest::Parser::state_urlesc(char ch)\n  {\n    if (isHexDigit(ch))\n    {\n      if (message.url.size() >= 2 && message.url[message.url.size() - 2] == '%')\n      {\n        unsigned v = (valueOfHexDigit(message.url[message.url.size() - 1]) << 4) | valueOfHexDigit(ch);\n        if (v == 0)\n          throw HttpError(HTTP_BAD_REQUEST, \"invalid value in url\");\n        message.url[message.url.size() - 2] = static_cast<char>(v);\n        message.url.resize(message.url.size() - 1);\n        SET_STATE(state_url);\n      }\n      else\n      {\n        message.url += ch;\n      }\n      return false;",
  "False_positive_reason": "",
  "Preconditions": [
    "An attacker crafts a URL containing bytes with high bit set (e.g., 0x80-0xFF) during URL decoding in HttpRequest::Parser",
    "The URL decoding process stores these bytes as signed char values in message.url"
  ],
  "Trigger_actions": [
    "HTTPRequest::Parser::state_urlesc decodes URL escape sequences containing high-bit-set bytes",
    "The decoded byte (as negative signed char) is passed to chartoprint() via some invocation flow"
  ],
  "Dangerous_post_conditions": [
    "hex[ch >> 4] and hex[ch & 0xf] perform out-of-bounds memory reads from the static hex[] array (length 16)",
    "This accesses arbitrary memory addresses adjacent to the hex array in the stack",
    "May disclose sensitive information through the resulting string output"
  ],
  "Initial_conditions": [
    "The tnt::HttpRequest::Parser must be processing a request with URL-encoded input containing high-bit-set bytes",
    "The chartoprint() function must be called from somewhere in the execution flow to process this decoded data"
  ]
}