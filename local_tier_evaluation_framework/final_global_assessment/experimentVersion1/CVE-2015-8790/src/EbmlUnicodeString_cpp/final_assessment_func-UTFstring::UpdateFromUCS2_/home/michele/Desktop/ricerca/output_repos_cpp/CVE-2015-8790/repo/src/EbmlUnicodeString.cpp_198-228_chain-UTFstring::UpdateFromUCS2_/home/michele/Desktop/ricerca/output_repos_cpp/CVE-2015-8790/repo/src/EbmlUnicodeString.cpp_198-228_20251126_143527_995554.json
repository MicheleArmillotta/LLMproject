{
  "assessment_type": "combined",
  "id": [
    "UTFstring::UpdateFromUCS2",
    "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-8790/repo/src/EbmlUnicodeString.cpp",
    "198-228"
  ],
  "file_path": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-8790/repo/src/EbmlUnicodeString.cpp",
  "function_name": "UTFstring::UpdateFromUCS2",
  "function_code": "#include \"ebml/EbmlUnicodeString.h\"\n#include <wchar.h>\n#include <cassert>\n\nvoid UTFstring::UpdateFromUCS2()\n{\n  // find the size of the final UTF-8 string\n  size_t i,Size=0;\n  for (i=0; i<_Length; i++) {\n    if (_Data[i] < 0x80) {\n      Size++;\n    } else if (_Data[i] < 0x800) {\n      Size += 2;\n    } else {\n      Size += 3;\n    }\n  }\n  std::string::value_type *tmpStr = new std::string::value_type[Size+1];\n  for (i=0, Size=0; i<_Length; i++) {\n    if (_Data[i] < 0x80) {\n      tmpStr[Size++] = _Data[i];\n    } else if (_Data[i] < 0x800) {\n      tmpStr[Size++] = 0xC0 | (_Data[i] >> 6);\n      tmpStr[Size++] = 0x80 | (_Data[i] & 0x3F);\n    } else {\n      tmpStr[Size++] = 0xE0 | (_Data[i] >> 12);\n      tmpStr[Size++] = 0x80 | ((_Data[i] >> 6) & 0x3F);\n      tmpStr[Size++] = 0x80 | (_Data[i] & 0x3F);\n    }\n  }\n  tmpStr[Size] = 0;\n  UTF8string = tmpStr; // implicit conversion\n  delete [] tmpStr;\n\n}\n\n-------- CONTEXTUAL INFORMATIONS - CALLEES CODE --------\n-------- Code of the functions used by the analyzed function -------- \n\n",
  "chain_code": "---- CALL CHAIN SNIPPETS ----\n\n---- TARGET FUNCTION ----\nvoid UTFstring::UpdateFromUCS2()\n{\n  // find the size of the final UTF-8 string\n  size_t i,Size=0;\n  for (i=0; i<_Length; i++) {\n    if (_Data[i] < 0x80) {\n      Size++;\n    } else if (_Data[i] < 0x800) {\n      Size += 2;\n    } else {\n      Size += 3;\n    }\n  }\n  std::string::value_type *tmpStr = new std::string::value_type[Size+1];\n  for (i=0, Size=0; i<_Length; i++) {\n    if (_Data[i] < 0x80) {\n      tmpStr[Size++] = _Data[i];\n    } else if (_Data[i] < 0x800) {\n      tmpStr[Size++] = 0xC0 | (_Data[i] >> 6);\n      tmpStr[Size++] = 0x80 | (_Data[i] & 0x3F);\n    } else {\n      tmpStr[Size++] =",
  "False_positive_reason": "",
  "Preconditions": [
    "UTFstring object must be in valid state with _Data initialized to UCS-2 characters",
    "Function must be called to execute UpdateFromUCS2()"
  ],
  "Trigger_actions": [
    "Calling UTFstring::UpdateFromUCS2() with attacker-controlled UCS-2 input (through _Data)"
  ],
  "Dangerous_post_conditions": [
    "Use-after-free on UTF8string's dangling pointer to tmpStr",
    "Double-free when UTF8string is destroyed or modified later"
  ],
  "Initial_conditions": [
    "_Data must contain valid UCS-2 characters to trigger buffer creation",
    "UTF8string must be a class member using raw pointer-based memory management (non-compliant with RAII)"
  ]
}