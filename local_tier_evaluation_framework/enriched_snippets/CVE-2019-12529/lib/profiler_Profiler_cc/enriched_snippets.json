[
  {
    "function_name": "xprof_stop",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2019-12529/repo/lib/profiler/Profiler.cc",
    "lines": "189-213",
    "snippet": "void\nxprof_stop(xprof_type type, const char *timer)\n{\n    hrtime_t tt = get_tick();\n    assert(cstack_head > 0);\n    --cstack_head;\n    assert(cstack[cstack_head].timer == type);\n\n    /* Record timer details */\n    cstack[cstack_head].accum += tt - cstack[cstack_head].start;\n    xprof_Timers[type]->accu.delta = cstack[cstack_head].accum;\n    xprof_Timers[type]->name = timer;\n\n    /* Update */\n    xprof_update(&xprof_Timers[type]->accu);\n\n    /* Restart previous timer if we're not at the top level */\n    if (cstack_head > 0) {\n        cstack[cstack_head - 1].start = tt;\n        cstack[cstack_head - 1].stop = 0;\n        return;\n    }\n    /* Get here? We're at the top level; unaccounted */\n    xp_UNACCOUNTED->start = tt;\n}",
    "includes": [
      "#include <unistd.h>",
      "#include <malloc.h>",
      "#include <gnumalloc.h>",
      "#include <cassert>",
      "#include \"profiler/Profiler.h\"",
      "#include \"squid.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "xprof_update",
          "args": [
            "&xprof_Timers[type]->accu"
          ],
          "line": 203
        },
        "resolved": true,
        "details": {
          "function_name": "xprof_update",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2019-12529/repo/lib/profiler/Profiler.cc",
          "lines": "129-137",
          "snippet": "xprof_update(xprof_stats_data * head)\n{\n    if (head->delta < head->best)\n        head->best = head->delta;\n    if (head->worst < head->delta)\n        head->worst = head->delta;\n    head->summ += head->delta;\n    ++head->count;\n}",
          "includes": [
            "#include <unistd.h>",
            "#include <malloc.h>",
            "#include <gnumalloc.h>",
            "#include <cassert>",
            "#include \"profiler/Profiler.h\"",
            "#include \"squid.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <unistd.h>\n#include <malloc.h>\n#include <gnumalloc.h>\n#include <cassert>\n#include \"profiler/Profiler.h\"\n#include \"squid.h\"\n\nxprof_update(xprof_stats_data * head)\n{\n    if (head->delta < head->best)\n        head->best = head->delta;\n    if (head->worst < head->delta)\n        head->worst = head->delta;\n    head->summ += head->delta;\n    ++head->count;\n}"
        }
      },
      {
        "call_info": {
          "callee": "assert",
          "args": [
            "cstack[cstack_head].timer == type"
          ],
          "line": 195
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "assert",
          "args": [
            "cstack_head > 0"
          ],
          "line": 193
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_tick",
          "args": [],
          "line": 192
        },
        "resolved": true,
        "details": {
          "function_name": "get_tick",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2019-12529/repo/lib/profiler/get_tick.h",
          "lines": "73-77",
          "snippet": "static inline hrtime_t\nget_tick()\n{\n    return clock_gettime_nsec_np(CLOCK_MONOTONIC_RAW);\n}",
          "includes": [
            "#include <ctime>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <ctime>\n\nstatic inline hrtime_t\nget_tick()\n{\n    return clock_gettime_nsec_np(CLOCK_MONOTONIC_RAW);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <unistd.h>\n#include <malloc.h>\n#include <gnumalloc.h>\n#include <cassert>\n#include \"profiler/Profiler.h\"\n#include \"squid.h\"\n\nvoid\nxprof_stop(xprof_type type, const char *timer)\n{\n    hrtime_t tt = get_tick();\n    assert(cstack_head > 0);\n    --cstack_head;\n    assert(cstack[cstack_head].timer == type);\n\n    /* Record timer details */\n    cstack[cstack_head].accum += tt - cstack[cstack_head].start;\n    xprof_Timers[type]->accu.delta = cstack[cstack_head].accum;\n    xprof_Timers[type]->name = timer;\n\n    /* Update */\n    xprof_update(&xprof_Timers[type]->accu);\n\n    /* Restart previous timer if we're not at the top level */\n    if (cstack_head > 0) {\n        cstack[cstack_head - 1].start = tt;\n        cstack[cstack_head - 1].stop = 0;\n        return;\n    }\n    /* Get here? We're at the top level; unaccounted */\n    xp_UNACCOUNTED->start = tt;\n}"
  },
  {
    "function_name": "xprof_start",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2019-12529/repo/lib/profiler/Profiler.cc",
    "lines": "157-187",
    "snippet": "void\nxprof_start(xprof_type type, const char *timer)\n{\n    hrtime_t tt = get_tick();\n    if (!xprof_inited)\n        xprof_InitLib();\n\n    /* If nested, stop current stack frame */\n    if (cstack_head > 0) {\n        cstack[cstack_head - 1].accum += get_tick() - cstack[cstack_head - 1].start;\n        cstack[cstack_head - 1].start = -1;\n    }\n\n    /* Are we at the first level? If so; stop the unaccounted timer */\n    if (cstack_head == 0) {\n        assert(xp_UNACCOUNTED->start != -1);\n        xp_UNACCOUNTED->delta = tt - xp_UNACCOUNTED->start;\n        xp_UNACCOUNTED->start = -1;\n        xprof_update(xp_UNACCOUNTED);\n    }\n\n    /* Allocate new stack frame */\n    cstack[cstack_head].start = tt;\n    cstack[cstack_head].stop = -1;\n    cstack[cstack_head].accum = 0;\n    cstack[cstack_head].timer = type;\n    cstack[cstack_head].name = timer;\n    ++cstack_head;\n    assert(cstack_head < MAXSTACKDEPTH);\n\n}",
    "includes": [
      "#include <unistd.h>",
      "#include <malloc.h>",
      "#include <gnumalloc.h>",
      "#include <cassert>",
      "#include \"profiler/Profiler.h\"",
      "#include \"squid.h\""
    ],
    "macros_used": [
      "#define MAXSTACKDEPTH   512"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "assert",
          "args": [
            "cstack_head < MAXSTACKDEPTH"
          ],
          "line": 185
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xprof_update",
          "args": [
            "xp_UNACCOUNTED"
          ],
          "line": 175
        },
        "resolved": true,
        "details": {
          "function_name": "xprof_update",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2019-12529/repo/lib/profiler/Profiler.cc",
          "lines": "129-137",
          "snippet": "xprof_update(xprof_stats_data * head)\n{\n    if (head->delta < head->best)\n        head->best = head->delta;\n    if (head->worst < head->delta)\n        head->worst = head->delta;\n    head->summ += head->delta;\n    ++head->count;\n}",
          "includes": [
            "#include <unistd.h>",
            "#include <malloc.h>",
            "#include <gnumalloc.h>",
            "#include <cassert>",
            "#include \"profiler/Profiler.h\"",
            "#include \"squid.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <unistd.h>\n#include <malloc.h>\n#include <gnumalloc.h>\n#include <cassert>\n#include \"profiler/Profiler.h\"\n#include \"squid.h\"\n\nxprof_update(xprof_stats_data * head)\n{\n    if (head->delta < head->best)\n        head->best = head->delta;\n    if (head->worst < head->delta)\n        head->worst = head->delta;\n    head->summ += head->delta;\n    ++head->count;\n}"
        }
      },
      {
        "call_info": {
          "callee": "assert",
          "args": [
            "xp_UNACCOUNTED->start != -1"
          ],
          "line": 172
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_tick",
          "args": [],
          "line": 166
        },
        "resolved": true,
        "details": {
          "function_name": "get_tick",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2019-12529/repo/lib/profiler/get_tick.h",
          "lines": "73-77",
          "snippet": "static inline hrtime_t\nget_tick()\n{\n    return clock_gettime_nsec_np(CLOCK_MONOTONIC_RAW);\n}",
          "includes": [
            "#include <ctime>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <ctime>\n\nstatic inline hrtime_t\nget_tick()\n{\n    return clock_gettime_nsec_np(CLOCK_MONOTONIC_RAW);\n}"
        }
      },
      {
        "call_info": {
          "callee": "xprof_InitLib",
          "args": [],
          "line": 162
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <unistd.h>\n#include <malloc.h>\n#include <gnumalloc.h>\n#include <cassert>\n#include \"profiler/Profiler.h\"\n#include \"squid.h\"\n\n#define MAXSTACKDEPTH   512\n\nvoid\nxprof_start(xprof_type type, const char *timer)\n{\n    hrtime_t tt = get_tick();\n    if (!xprof_inited)\n        xprof_InitLib();\n\n    /* If nested, stop current stack frame */\n    if (cstack_head > 0) {\n        cstack[cstack_head - 1].accum += get_tick() - cstack[cstack_head - 1].start;\n        cstack[cstack_head - 1].start = -1;\n    }\n\n    /* Are we at the first level? If so; stop the unaccounted timer */\n    if (cstack_head == 0) {\n        assert(xp_UNACCOUNTED->start != -1);\n        xp_UNACCOUNTED->delta = tt - xp_UNACCOUNTED->start;\n        xp_UNACCOUNTED->start = -1;\n        xprof_update(xp_UNACCOUNTED);\n    }\n\n    /* Allocate new stack frame */\n    cstack[cstack_head].start = tt;\n    cstack[cstack_head].stop = -1;\n    cstack[cstack_head].accum = 0;\n    cstack[cstack_head].timer = type;\n    cstack[cstack_head].name = timer;\n    ++cstack_head;\n    assert(cstack_head < MAXSTACKDEPTH);\n\n}"
  },
  {
    "function_name": "xprof_InitLib",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2019-12529/repo/lib/profiler/Profiler.cc",
    "lines": "142-155",
    "snippet": "static void\nxprof_InitLib(void)\n{\n    if (xprof_inited)\n        return;\n\n    xprof_Timers = static_cast<TimersArray *>(calloc(XPROF_LAST + 2, sizeof(xprof_stats_node)));\n\n    xprof_Timers[XPROF_PROF_UNACCOUNTED]->name = \"PROF_UNACCOUNTED\";\n    xprof_Timers[XPROF_PROF_UNACCOUNTED]->accu.start = get_tick();\n    xp_UNACCOUNTED = &xprof_Timers[XPROF_PROF_UNACCOUNTED]->accu;\n    cstack_head = 0;\n    xprof_inited = 1;\n}",
    "includes": [
      "#include <unistd.h>",
      "#include <malloc.h>",
      "#include <gnumalloc.h>",
      "#include <cassert>",
      "#include \"profiler/Profiler.h\"",
      "#include \"squid.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "get_tick",
          "args": [],
          "line": 151
        },
        "resolved": true,
        "details": {
          "function_name": "get_tick",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2019-12529/repo/lib/profiler/get_tick.h",
          "lines": "73-77",
          "snippet": "static inline hrtime_t\nget_tick()\n{\n    return clock_gettime_nsec_np(CLOCK_MONOTONIC_RAW);\n}",
          "includes": [
            "#include <ctime>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <ctime>\n\nstatic inline hrtime_t\nget_tick()\n{\n    return clock_gettime_nsec_np(CLOCK_MONOTONIC_RAW);\n}"
        }
      },
      {
        "call_info": {
          "callee": "static_cast<TimersArray *>",
          "args": [
            "calloc(XPROF_LAST + 2, sizeof(xprof_stats_node))"
          ],
          "line": 148
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "calloc",
          "args": [
            "XPROF_LAST + 2",
            "sizeof(xprof_stats_node)"
          ],
          "line": 148
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <unistd.h>\n#include <malloc.h>\n#include <gnumalloc.h>\n#include <cassert>\n#include \"profiler/Profiler.h\"\n#include \"squid.h\"\n\nstatic void\nxprof_InitLib(void)\n{\n    if (xprof_inited)\n        return;\n\n    xprof_Timers = static_cast<TimersArray *>(calloc(XPROF_LAST + 2, sizeof(xprof_stats_node)));\n\n    xprof_Timers[XPROF_PROF_UNACCOUNTED]->name = \"PROF_UNACCOUNTED\";\n    xprof_Timers[XPROF_PROF_UNACCOUNTED]->accu.start = get_tick();\n    xp_UNACCOUNTED = &xprof_Timers[XPROF_PROF_UNACCOUNTED]->accu;\n    cstack_head = 0;\n    xprof_inited = 1;\n}"
  },
  {
    "function_name": "xprof_update",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2019-12529/repo/lib/profiler/Profiler.cc",
    "lines": "129-137",
    "snippet": "xprof_update(xprof_stats_data * head)\n{\n    if (head->delta < head->best)\n        head->best = head->delta;\n    if (head->worst < head->delta)\n        head->worst = head->delta;\n    head->summ += head->delta;\n    ++head->count;\n}",
    "includes": [
      "#include <unistd.h>",
      "#include <malloc.h>",
      "#include <gnumalloc.h>",
      "#include <cassert>",
      "#include \"profiler/Profiler.h\"",
      "#include \"squid.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include <unistd.h>\n#include <malloc.h>\n#include <gnumalloc.h>\n#include <cassert>\n#include \"profiler/Profiler.h\"\n#include \"squid.h\"\n\nxprof_update(xprof_stats_data * head)\n{\n    if (head->delta < head->best)\n        head->best = head->delta;\n    if (head->worst < head->delta)\n        head->worst = head->delta;\n    head->summ += head->delta;\n    ++head->count;\n}"
  }
]