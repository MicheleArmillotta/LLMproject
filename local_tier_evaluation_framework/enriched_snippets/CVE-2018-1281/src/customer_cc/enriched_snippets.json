[
  {
    "function_name": "Receiving",
    "container": "Customer",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2018-1281/repo/src/customer.cc",
    "lines": "49-64",
    "snippet": "void Customer::Receiving() {\n  while (true) {\n    Message recv;\n    recv_queue_.WaitAndPop(&recv);\n    if (!recv.meta.control.empty() &&\n        recv.meta.control.cmd == Control::TERMINATE) {\n      break;\n    }\n    recv_handle_(recv);\n    if (!recv.meta.request) {\n      std::lock_guard<std::mutex> lk(tracker_mu_);\n      tracker_[recv.meta.timestamp].second++;\n      tracker_cond_.notify_all();\n    }\n  }\n}",
    "includes": [
      "#include \"ps/internal/postoffice.h\"",
      "#include \"ps/internal/customer.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "tracker_cond_.notify_all",
          "args": [],
          "line": 61
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "recv_handle_",
          "args": [
            "recv"
          ],
          "line": 57
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "recv.meta.control.empty",
          "args": [],
          "line": 53
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "recv_queue_.WaitAndPop",
          "args": [
            "&recv"
          ],
          "line": 52
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"ps/internal/postoffice.h\"\n#include \"ps/internal/customer.h\"\n\nCustomer {\n  void Customer::Receiving() {\n    while (true) {\n      Message recv;\n      recv_queue_.WaitAndPop(&recv);\n      if (!recv.meta.control.empty() &&\n          recv.meta.control.cmd == Control::TERMINATE) {\n        break;\n      }\n      recv_handle_(recv);\n      if (!recv.meta.request) {\n        std::lock_guard<std::mutex> lk(tracker_mu_);\n        tracker_[recv.meta.timestamp].second++;\n        tracker_cond_.notify_all();\n      }\n    }\n  }\n}"
  },
  {
    "function_name": "AddResponse",
    "container": "Customer",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2018-1281/repo/src/customer.cc",
    "lines": "44-47",
    "snippet": "void Customer::AddResponse(int timestamp, int num) {\n  std::lock_guard<std::mutex> lk(tracker_mu_);\n  tracker_[timestamp].second += num;\n}",
    "includes": [
      "#include \"ps/internal/postoffice.h\"",
      "#include \"ps/internal/customer.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"ps/internal/postoffice.h\"\n#include \"ps/internal/customer.h\"\n\nCustomer {\n  void Customer::AddResponse(int timestamp, int num) {\n    std::lock_guard<std::mutex> lk(tracker_mu_);\n    tracker_[timestamp].second += num;\n  }\n}"
  },
  {
    "function_name": "NumResponse",
    "container": "Customer",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2018-1281/repo/src/customer.cc",
    "lines": "39-42",
    "snippet": "int Customer::NumResponse(int timestamp) {\n  std::lock_guard<std::mutex> lk(tracker_mu_);\n  return tracker_[timestamp].second;\n}",
    "includes": [
      "#include \"ps/internal/postoffice.h\"",
      "#include \"ps/internal/customer.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"ps/internal/postoffice.h\"\n#include \"ps/internal/customer.h\"\n\nCustomer {\n  int Customer::NumResponse(int timestamp) {\n    std::lock_guard<std::mutex> lk(tracker_mu_);\n    return tracker_[timestamp].second;\n  }\n}"
  },
  {
    "function_name": "WaitRequest",
    "container": "Customer",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2018-1281/repo/src/customer.cc",
    "lines": "32-37",
    "snippet": "void Customer::WaitRequest(int timestamp) {\n  std::unique_lock<std::mutex> lk(tracker_mu_);\n  tracker_cond_.wait(lk, [this, timestamp]{\n      return tracker_[timestamp].first == tracker_[timestamp].second;\n    });\n}",
    "includes": [
      "#include \"ps/internal/postoffice.h\"",
      "#include \"ps/internal/customer.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "tracker_cond_.wait",
          "args": [
            "lk",
            "[this, timestamp]{\n      return tracker_[timestamp].first == tracker_[timestamp].second;\n    }"
          ],
          "line": 34
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"ps/internal/postoffice.h\"\n#include \"ps/internal/customer.h\"\n\nCustomer {\n  void Customer::WaitRequest(int timestamp) {\n    std::unique_lock<std::mutex> lk(tracker_mu_);\n    tracker_cond_.wait(lk, [this, timestamp]{\n        return tracker_[timestamp].first == tracker_[timestamp].second;\n      });\n  }\n}"
  },
  {
    "function_name": "NewRequest",
    "container": "Customer",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2018-1281/repo/src/customer.cc",
    "lines": "25-30",
    "snippet": "int Customer::NewRequest(int recver) {\n  std::lock_guard<std::mutex> lk(tracker_mu_);\n  int num = Postoffice::Get()->GetNodeIDs(recver).size();\n  tracker_.push_back(std::make_pair(num, 0));\n  return tracker_.size() - 1;\n}",
    "includes": [
      "#include \"ps/internal/postoffice.h\"",
      "#include \"ps/internal/customer.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "tracker_.size",
          "args": [],
          "line": 29
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tracker_.push_back",
          "args": [
            "std::make_pair(num, 0)"
          ],
          "line": 28
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "std::make_pair",
          "args": [
            "num",
            "0"
          ],
          "line": 28
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Postoffice::Get",
          "args": [],
          "line": 27
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Postoffice::Get",
          "args": [
            "recver"
          ],
          "line": 27
        },
        "resolved": true,
        "details": {
          "function_name": "GetDeadNodes",
          "container": "Postoffice",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2018-1281/repo/src/postoffice.cc",
          "lines": "156-175",
          "snippet": "std::vector<int> Postoffice::GetDeadNodes(int t) {\n  std::vector<int> dead_nodes;\n  if (!van_->IsReady() || t == 0) return dead_nodes;\n\n  time_t curr_time = time(NULL);\n  const auto& nodes = is_scheduler_\n    ? GetNodeIDs(kWorkerGroup + kServerGroup)\n    : GetNodeIDs(kScheduler);\n  {\n    std::lock_guard<std::mutex> lk(heartbeat_mu_);\n    for (int r : nodes) {\n      auto it = heartbeats_.find(r);\n      if ((it == heartbeats_.end() || it->second + t < curr_time)\n            && start_time_ + t < curr_time) {\n        dead_nodes.push_back(r);\n      }\n    }\n  }\n  return dead_nodes;\n}",
          "includes": [
            "#include \"ps/base.h\"",
            "#include \"ps/internal/message.h\"",
            "#include \"ps/internal/postoffice.h\"",
            "#include <chrono>",
            "#include <thread>",
            "#include <unistd.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"ps/base.h\"\n#include \"ps/internal/message.h\"\n#include \"ps/internal/postoffice.h\"\n#include <chrono>\n#include <thread>\n#include <unistd.h>\n\nPostoffice {\n  std::vector<int> Postoffice::GetDeadNodes(int t) {\n    std::vector<int> dead_nodes;\n    if (!van_->IsReady() || t == 0) return dead_nodes;\n  \n    time_t curr_time = time(NULL);\n    const auto& nodes = is_scheduler_\n      ? GetNodeIDs(kWorkerGroup + kServerGroup)\n      : GetNodeIDs(kScheduler);\n    {\n      std::lock_guard<std::mutex> lk(heartbeat_mu_);\n      for (int r : nodes) {\n        auto it = heartbeats_.find(r);\n        if ((it == heartbeats_.end() || it->second + t < curr_time)\n              && start_time_ + t < curr_time) {\n          dead_nodes.push_back(r);\n        }\n      }\n    }\n    return dead_nodes;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "Postoffice::Get",
          "args": [],
          "line": 27
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"ps/internal/postoffice.h\"\n#include \"ps/internal/customer.h\"\n\nCustomer {\n  int Customer::NewRequest(int recver) {\n    std::lock_guard<std::mutex> lk(tracker_mu_);\n    int num = Postoffice::Get()->GetNodeIDs(recver).size();\n    tracker_.push_back(std::make_pair(num, 0));\n    return tracker_.size() - 1;\n  }\n}"
  },
  {
    "function_name": "~Customer",
    "container": "Customer",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2018-1281/repo/src/customer.cc",
    "lines": "17-23",
    "snippet": "Customer::~Customer() {\n  Postoffice::Get()->RemoveCustomer(this);\n  Message msg;\n  msg.meta.control.cmd = Control::TERMINATE;\n  recv_queue_.Push(msg);\n  recv_thread_->join();\n}",
    "includes": [
      "#include \"ps/internal/postoffice.h\"",
      "#include \"ps/internal/customer.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "recv_thread_->join",
          "args": [],
          "line": 22
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "recv_queue_.Push",
          "args": [
            "msg"
          ],
          "line": 21
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Postoffice::Get",
          "args": [
            "this"
          ],
          "line": 18
        },
        "resolved": true,
        "details": {
          "function_name": "GetDeadNodes",
          "container": "Postoffice",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2018-1281/repo/src/postoffice.cc",
          "lines": "156-175",
          "snippet": "std::vector<int> Postoffice::GetDeadNodes(int t) {\n  std::vector<int> dead_nodes;\n  if (!van_->IsReady() || t == 0) return dead_nodes;\n\n  time_t curr_time = time(NULL);\n  const auto& nodes = is_scheduler_\n    ? GetNodeIDs(kWorkerGroup + kServerGroup)\n    : GetNodeIDs(kScheduler);\n  {\n    std::lock_guard<std::mutex> lk(heartbeat_mu_);\n    for (int r : nodes) {\n      auto it = heartbeats_.find(r);\n      if ((it == heartbeats_.end() || it->second + t < curr_time)\n            && start_time_ + t < curr_time) {\n        dead_nodes.push_back(r);\n      }\n    }\n  }\n  return dead_nodes;\n}",
          "includes": [
            "#include \"ps/base.h\"",
            "#include \"ps/internal/message.h\"",
            "#include \"ps/internal/postoffice.h\"",
            "#include <chrono>",
            "#include <thread>",
            "#include <unistd.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"ps/base.h\"\n#include \"ps/internal/message.h\"\n#include \"ps/internal/postoffice.h\"\n#include <chrono>\n#include <thread>\n#include <unistd.h>\n\nPostoffice {\n  std::vector<int> Postoffice::GetDeadNodes(int t) {\n    std::vector<int> dead_nodes;\n    if (!van_->IsReady() || t == 0) return dead_nodes;\n  \n    time_t curr_time = time(NULL);\n    const auto& nodes = is_scheduler_\n      ? GetNodeIDs(kWorkerGroup + kServerGroup)\n      : GetNodeIDs(kScheduler);\n    {\n      std::lock_guard<std::mutex> lk(heartbeat_mu_);\n      for (int r : nodes) {\n        auto it = heartbeats_.find(r);\n        if ((it == heartbeats_.end() || it->second + t < curr_time)\n              && start_time_ + t < curr_time) {\n          dead_nodes.push_back(r);\n        }\n      }\n    }\n    return dead_nodes;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "Postoffice::Get",
          "args": [],
          "line": 18
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"ps/internal/postoffice.h\"\n#include \"ps/internal/customer.h\"\n\nCustomer {\n  Customer::~Customer() {\n    Postoffice::Get()->RemoveCustomer(this);\n    Message msg;\n    msg.meta.control.cmd = Control::TERMINATE;\n    recv_queue_.Push(msg);\n    recv_thread_->join();\n  }\n}"
  },
  {
    "function_name": "Customer",
    "container": "Customer",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2018-1281/repo/src/customer.cc",
    "lines": "11-15",
    "snippet": "Customer::Customer(int id, const Customer::RecvHandle& recv_handle)\n    : id_(id), recv_handle_(recv_handle) {\n  Postoffice::Get()->AddCustomer(this);\n  recv_thread_ = std::unique_ptr<std::thread>(new std::thread(&Customer::Receiving, this));\n}",
    "includes": [
      "#include \"ps/internal/postoffice.h\"",
      "#include \"ps/internal/customer.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "std::unique_ptr<std::thread>",
          "args": [
            "new std::thread(&Customer::Receiving, this)"
          ],
          "line": 14
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Postoffice::Get",
          "args": [
            "this"
          ],
          "line": 13
        },
        "resolved": true,
        "details": {
          "function_name": "GetDeadNodes",
          "container": "Postoffice",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2018-1281/repo/src/postoffice.cc",
          "lines": "156-175",
          "snippet": "std::vector<int> Postoffice::GetDeadNodes(int t) {\n  std::vector<int> dead_nodes;\n  if (!van_->IsReady() || t == 0) return dead_nodes;\n\n  time_t curr_time = time(NULL);\n  const auto& nodes = is_scheduler_\n    ? GetNodeIDs(kWorkerGroup + kServerGroup)\n    : GetNodeIDs(kScheduler);\n  {\n    std::lock_guard<std::mutex> lk(heartbeat_mu_);\n    for (int r : nodes) {\n      auto it = heartbeats_.find(r);\n      if ((it == heartbeats_.end() || it->second + t < curr_time)\n            && start_time_ + t < curr_time) {\n        dead_nodes.push_back(r);\n      }\n    }\n  }\n  return dead_nodes;\n}",
          "includes": [
            "#include \"ps/base.h\"",
            "#include \"ps/internal/message.h\"",
            "#include \"ps/internal/postoffice.h\"",
            "#include <chrono>",
            "#include <thread>",
            "#include <unistd.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"ps/base.h\"\n#include \"ps/internal/message.h\"\n#include \"ps/internal/postoffice.h\"\n#include <chrono>\n#include <thread>\n#include <unistd.h>\n\nPostoffice {\n  std::vector<int> Postoffice::GetDeadNodes(int t) {\n    std::vector<int> dead_nodes;\n    if (!van_->IsReady() || t == 0) return dead_nodes;\n  \n    time_t curr_time = time(NULL);\n    const auto& nodes = is_scheduler_\n      ? GetNodeIDs(kWorkerGroup + kServerGroup)\n      : GetNodeIDs(kScheduler);\n    {\n      std::lock_guard<std::mutex> lk(heartbeat_mu_);\n      for (int r : nodes) {\n        auto it = heartbeats_.find(r);\n        if ((it == heartbeats_.end() || it->second + t < curr_time)\n              && start_time_ + t < curr_time) {\n          dead_nodes.push_back(r);\n        }\n      }\n    }\n    return dead_nodes;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "Postoffice::Get",
          "args": [],
          "line": 13
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"ps/internal/postoffice.h\"\n#include \"ps/internal/customer.h\"\n\nCustomer {\n  Customer::Customer(int id, const Customer::RecvHandle& recv_handle)\n      : id_(id), recv_handle_(recv_handle) {\n    Postoffice::Get()->AddCustomer(this);\n    recv_thread_ = std::unique_ptr<std::thread>(new std::thread(&Customer::Receiving, this));\n  }\n}"
  }
]