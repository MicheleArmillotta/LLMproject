[
  {
    "function_name": "normalize_path",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
    "lines": "1119-1182",
    "snippet": "std::string normalize_path(const std::string &p1)\n{\n\tif (p1.empty()) return p1;\n\n\tstd::string p2;\n#ifdef _WIN32\n\tif (p1.size() >= 2 && p1[1] == ':')\n\t\t// Windows relative paths with explicit drive name are not handled.\n\t\tp2 = p1;\n\telse\n#endif\n\tif (!is_path_sep(p1[0]))\n\t\tp2 = get_cwd() + \"/\" + p1;\n\telse\n\t\tp2 = p1;\n\n#ifdef _WIN32\n\tstd::string drive;\n\tif (p2.size() >= 2 && p2[1] == ':') {\n\t\tdrive = p2.substr(0, 2);\n\t\tp2.erase(0, 2);\n\t}\n#endif\n\n\tstd::vector<std::string> components(1);\n\tfor (int i = 0, i_end = p2.size(); i <= i_end; ++i)\n\t{\n\t\tstd::string &last = components[components.size() - 1];\n\t\tchar c = p2.c_str()[i];\n\t\tif (is_path_sep(c) || c == 0)\n\t\t{\n\t\t\tif (last == \".\")\n\t\t\t\tlast.clear();\n\t\t\telse if (last == \"..\")\n\t\t\t{\n\t\t\t\tif (components.size() >= 2) {\n\t\t\t\t\tcomponents.pop_back();\n\t\t\t\t\tcomponents[components.size() - 1].clear();\n\t\t\t\t} else\n\t\t\t\t\tlast.clear();\n\t\t\t}\n\t\t\telse if (!last.empty())\n\t\t\t\tcomponents.push_back(std::string());\n\t\t}\n\t\telse\n\t\t\tlast += c;\n\t}\n\n\tstd::ostringstream p4;\n\tcomponents.pop_back();\n\n#ifdef _WIN32\n\tp4 << drive;\n#endif\n\n\tBOOST_FOREACH(const std::string &s, components)\n\t{\n\t\tp4 << '/' << s;\n\t}\n\n\tDBG_FS << \"Normalizing '\" << p2 << \"' to '\" << p4.str() << \"'\" << std::endl;\n\n\treturn p4.str();\n}",
    "includes": [
      "#include <CoreFoundation/CFBase.h>",
      "#include <CoreFoundation/CFString.h>",
      "#include <CoreFoundation/CoreFoundation.h>",
      "#include <boost/foreach.hpp>",
      "#include \"version.hpp\"",
      "#include \"serialization/unicode.hpp\"",
      "#include \"serialization/string_utils.hpp\"",
      "#include \"scoped_resource.hpp\"",
      "#include \"log.hpp\"",
      "#include \"game_preferences.hpp\"",
      "#include \"game_config.hpp\"",
      "#include \"filesystem.hpp\"",
      "#include \"config.hpp\"",
      "#include <cstring>",
      "#include <boost/algorithm/string.hpp>",
      "#include <set>",
      "#include <iomanip>",
      "#include <fstream>",
      "#include <cerrno>",
      "#include <libgen.h>",
      "#include <dirent.h>",
      "#include <unistd.h>",
      "#include <cctype>",
      "#include \"filesystem_win32.ii\"",
      "#include <sys/stat.h>",
      "#include \"global.hpp\""
    ],
    "macros_used": [
      "#define DBG_FS LOG_STREAM(debug, log_filesystem)"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "p4.str",
          "args": [],
          "line": 1181
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "p4.str",
          "args": [],
          "line": 1179
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "components.pop_back",
          "args": [],
          "line": 1168
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "components.push_back",
          "args": [
            "std::string()"
          ],
          "line": 1161
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "std::string",
          "args": [],
          "line": 1161
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "last.empty",
          "args": [],
          "line": 1160
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "last.clear",
          "args": [],
          "line": 1158
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "components[components.size",
          "args": [],
          "line": 1156
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "components.size",
          "args": [],
          "line": 1156
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "components.pop_back",
          "args": [],
          "line": 1155
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "components.size",
          "args": [],
          "line": 1154
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "last.clear",
          "args": [],
          "line": 1151
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "is_path_sep",
          "args": [
            "c"
          ],
          "line": 1148
        },
        "resolved": true,
        "details": {
          "function_name": "is_path_sep",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
          "lines": "1109-1117",
          "snippet": "bool is_path_sep(char c)\n{\n#ifdef _WIN32\n\tif (c == '/' || c == '\\\\') return true;\n#else\n\tif (c == '/') return true;\n#endif\n\treturn false;\n}",
          "includes": [
            "#include <CoreFoundation/CFBase.h>",
            "#include <CoreFoundation/CFString.h>",
            "#include <CoreFoundation/CoreFoundation.h>",
            "#include <boost/foreach.hpp>",
            "#include \"version.hpp\"",
            "#include \"serialization/unicode.hpp\"",
            "#include \"serialization/string_utils.hpp\"",
            "#include \"scoped_resource.hpp\"",
            "#include \"log.hpp\"",
            "#include \"game_preferences.hpp\"",
            "#include \"game_config.hpp\"",
            "#include \"filesystem.hpp\"",
            "#include \"config.hpp\"",
            "#include <cstring>",
            "#include <boost/algorithm/string.hpp>",
            "#include <set>",
            "#include <iomanip>",
            "#include <fstream>",
            "#include <cerrno>",
            "#include <libgen.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <cctype>",
            "#include \"filesystem_win32.ii\"",
            "#include <sys/stat.h>",
            "#include \"global.hpp\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\nbool is_path_sep(char c)\n{\n#ifdef _WIN32\n\tif (c == '/' || c == '\\\\') return true;\n#else\n\tif (c == '/') return true;\n#endif\n\treturn false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "p2.c_str",
          "args": [],
          "line": 1147
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "components.size",
          "args": [],
          "line": 1146
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "p2.size",
          "args": [],
          "line": 1144
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "p2.erase",
          "args": [
            "0",
            "2"
          ],
          "line": 1139
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "p2.substr",
          "args": [
            "0",
            "2"
          ],
          "line": 1138
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "p2.size",
          "args": [],
          "line": 1137
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_cwd",
          "args": [],
          "line": 1131
        },
        "resolved": true,
        "details": {
          "function_name": "get_cwd",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
          "lines": "344-359",
          "snippet": "std::string get_cwd()\n{\n\tchar buf[1024];\n\tconst char* const res = getcwd(buf,sizeof(buf));\n\tif(res != NULL) {\n\t\tstd::string str(res);\n\n#ifdef _WIN32\n\t\tstd::replace(str.begin(),str.end(),'\\\\','/');\n#endif\n\n\t\treturn str;\n\t} else {\n\t\treturn \"\";\n\t}\n}",
          "includes": [
            "#include <CoreFoundation/CFBase.h>",
            "#include <CoreFoundation/CFString.h>",
            "#include <CoreFoundation/CoreFoundation.h>",
            "#include <boost/foreach.hpp>",
            "#include \"version.hpp\"",
            "#include \"serialization/unicode.hpp\"",
            "#include \"serialization/string_utils.hpp\"",
            "#include \"scoped_resource.hpp\"",
            "#include \"log.hpp\"",
            "#include \"game_preferences.hpp\"",
            "#include \"game_config.hpp\"",
            "#include \"filesystem.hpp\"",
            "#include \"config.hpp\"",
            "#include <cstring>",
            "#include <boost/algorithm/string.hpp>",
            "#include <set>",
            "#include <iomanip>",
            "#include <fstream>",
            "#include <cerrno>",
            "#include <libgen.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <cctype>",
            "#include \"filesystem_win32.ii\"",
            "#include <sys/stat.h>",
            "#include \"global.hpp\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\nstd::string get_cwd()\n{\n\tchar buf[1024];\n\tconst char* const res = getcwd(buf,sizeof(buf));\n\tif(res != NULL) {\n\t\tstd::string str(res);\n\n#ifdef _WIN32\n\t\tstd::replace(str.begin(),str.end(),'\\\\','/');\n#endif\n\n\t\treturn str;\n\t} else {\n\t\treturn \"\";\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "p1.size",
          "args": [],
          "line": 1125
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "p1.empty",
          "args": [],
          "line": 1121
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\n#define DBG_FS LOG_STREAM(debug, log_filesystem)\n\nstd::string normalize_path(const std::string &p1)\n{\n\tif (p1.empty()) return p1;\n\n\tstd::string p2;\n#ifdef _WIN32\n\tif (p1.size() >= 2 && p1[1] == ':')\n\t\t// Windows relative paths with explicit drive name are not handled.\n\t\tp2 = p1;\n\telse\n#endif\n\tif (!is_path_sep(p1[0]))\n\t\tp2 = get_cwd() + \"/\" + p1;\n\telse\n\t\tp2 = p1;\n\n#ifdef _WIN32\n\tstd::string drive;\n\tif (p2.size() >= 2 && p2[1] == ':') {\n\t\tdrive = p2.substr(0, 2);\n\t\tp2.erase(0, 2);\n\t}\n#endif\n\n\tstd::vector<std::string> components(1);\n\tfor (int i = 0, i_end = p2.size(); i <= i_end; ++i)\n\t{\n\t\tstd::string &last = components[components.size() - 1];\n\t\tchar c = p2.c_str()[i];\n\t\tif (is_path_sep(c) || c == 0)\n\t\t{\n\t\t\tif (last == \".\")\n\t\t\t\tlast.clear();\n\t\t\telse if (last == \"..\")\n\t\t\t{\n\t\t\t\tif (components.size() >= 2) {\n\t\t\t\t\tcomponents.pop_back();\n\t\t\t\t\tcomponents[components.size() - 1].clear();\n\t\t\t\t} else\n\t\t\t\t\tlast.clear();\n\t\t\t}\n\t\t\telse if (!last.empty())\n\t\t\t\tcomponents.push_back(std::string());\n\t\t}\n\t\telse\n\t\t\tlast += c;\n\t}\n\n\tstd::ostringstream p4;\n\tcomponents.pop_back();\n\n#ifdef _WIN32\n\tp4 << drive;\n#endif\n\n\tBOOST_FOREACH(const std::string &s, components)\n\t{\n\t\tp4 << '/' << s;\n\t}\n\n\tDBG_FS << \"Normalizing '\" << p2 << \"' to '\" << p4.str() << \"'\" << std::endl;\n\n\treturn p4.str();\n}"
  },
  {
    "function_name": "is_path_sep",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
    "lines": "1109-1117",
    "snippet": "bool is_path_sep(char c)\n{\n#ifdef _WIN32\n\tif (c == '/' || c == '\\\\') return true;\n#else\n\tif (c == '/') return true;\n#endif\n\treturn false;\n}",
    "includes": [
      "#include <CoreFoundation/CFBase.h>",
      "#include <CoreFoundation/CFString.h>",
      "#include <CoreFoundation/CoreFoundation.h>",
      "#include <boost/foreach.hpp>",
      "#include \"version.hpp\"",
      "#include \"serialization/unicode.hpp\"",
      "#include \"serialization/string_utils.hpp\"",
      "#include \"scoped_resource.hpp\"",
      "#include \"log.hpp\"",
      "#include \"game_preferences.hpp\"",
      "#include \"game_config.hpp\"",
      "#include \"filesystem.hpp\"",
      "#include \"config.hpp\"",
      "#include <cstring>",
      "#include <boost/algorithm/string.hpp>",
      "#include <set>",
      "#include <iomanip>",
      "#include <fstream>",
      "#include <cerrno>",
      "#include <libgen.h>",
      "#include <dirent.h>",
      "#include <unistd.h>",
      "#include <cctype>",
      "#include \"filesystem_win32.ii\"",
      "#include <sys/stat.h>",
      "#include \"global.hpp\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\nbool is_path_sep(char c)\n{\n#ifdef _WIN32\n\tif (c == '/' || c == '\\\\') return true;\n#else\n\tif (c == '/') return true;\n#endif\n\treturn false;\n}"
  },
  {
    "function_name": "get_program_invocation",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
    "lines": "1085-1107",
    "snippet": "std::string get_program_invocation(const std::string& program_name) {\n#ifdef DEBUG\n  #ifdef _WIN32\n\tconst char *program_suffix = \"-debug.exe\";\n  #else\n\tconst char *program_suffix = \"-debug\";\n  #endif\n#else\n  #ifdef _WIN32\n\tconst char *program_suffix = \".exe\";\n  #else\n\tconst char *program_suffix = \"\";\n  #endif\n#endif\n\n\tconst std::string real_program_name(program_name + program_suffix);\n\tif(game_config::wesnoth_program_dir.empty()) return real_program_name;\n#ifdef _WIN32\n\treturn game_config::wesnoth_program_dir + \"\\\\\" + real_program_name;\n#else\n\treturn game_config::wesnoth_program_dir + \"/\" + real_program_name;\n#endif\n}",
    "includes": [
      "#include <CoreFoundation/CFBase.h>",
      "#include <CoreFoundation/CFString.h>",
      "#include <CoreFoundation/CoreFoundation.h>",
      "#include <boost/foreach.hpp>",
      "#include \"version.hpp\"",
      "#include \"serialization/unicode.hpp\"",
      "#include \"serialization/string_utils.hpp\"",
      "#include \"scoped_resource.hpp\"",
      "#include \"log.hpp\"",
      "#include \"game_preferences.hpp\"",
      "#include \"game_config.hpp\"",
      "#include \"filesystem.hpp\"",
      "#include \"config.hpp\"",
      "#include <cstring>",
      "#include <boost/algorithm/string.hpp>",
      "#include <set>",
      "#include <iomanip>",
      "#include <fstream>",
      "#include <cerrno>",
      "#include <libgen.h>",
      "#include <dirent.h>",
      "#include <unistd.h>",
      "#include <cctype>",
      "#include \"filesystem_win32.ii\"",
      "#include <sys/stat.h>",
      "#include \"global.hpp\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "game_config::wesnoth_program_dir.empty",
          "args": [],
          "line": 1101
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\nstd::string get_program_invocation(const std::string& program_name) {\n#ifdef DEBUG\n  #ifdef _WIN32\n\tconst char *program_suffix = \"-debug.exe\";\n  #else\n\tconst char *program_suffix = \"-debug\";\n  #endif\n#else\n  #ifdef _WIN32\n\tconst char *program_suffix = \".exe\";\n  #else\n\tconst char *program_suffix = \"\";\n  #endif\n#endif\n\n\tconst std::string real_program_name(program_name + program_suffix);\n\tif(game_config::wesnoth_program_dir.empty()) return real_program_name;\n#ifdef _WIN32\n\treturn game_config::wesnoth_program_dir + \"\\\\\" + real_program_name;\n#else\n\treturn game_config::wesnoth_program_dir + \"/\" + real_program_name;\n#endif\n}"
  },
  {
    "function_name": "get_independent_image_path",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
    "lines": "1067-1083",
    "snippet": "std::string get_independent_image_path(const std::string &filename)\n{\n\tstd::string full_path = get_binary_file_location(\"images\", filename);\n\n\tif(!full_path.empty()) {\n\t\tstd::string match = get_user_data_dir() + \"/\";\n\t\tif(full_path.find(match) == 0) {\n\t\t\treturn full_path.substr(match.size());\n\t\t}\n\t\tmatch = game_config::path + \"/\";\n\t\tif(full_path.find(match) == 0) {\n\t\t\treturn full_path.substr(match.size());\n\t\t}\n\t}\n\n\treturn full_path;\n}",
    "includes": [
      "#include <CoreFoundation/CFBase.h>",
      "#include <CoreFoundation/CFString.h>",
      "#include <CoreFoundation/CoreFoundation.h>",
      "#include <boost/foreach.hpp>",
      "#include \"version.hpp\"",
      "#include \"serialization/unicode.hpp\"",
      "#include \"serialization/string_utils.hpp\"",
      "#include \"scoped_resource.hpp\"",
      "#include \"log.hpp\"",
      "#include \"game_preferences.hpp\"",
      "#include \"game_config.hpp\"",
      "#include \"filesystem.hpp\"",
      "#include \"config.hpp\"",
      "#include <cstring>",
      "#include <boost/algorithm/string.hpp>",
      "#include <set>",
      "#include <iomanip>",
      "#include <fstream>",
      "#include <cerrno>",
      "#include <libgen.h>",
      "#include <dirent.h>",
      "#include <unistd.h>",
      "#include <cctype>",
      "#include \"filesystem_win32.ii\"",
      "#include <sys/stat.h>",
      "#include \"global.hpp\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "full_path.substr",
          "args": [
            "match.size()"
          ],
          "line": 1078
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "match.size",
          "args": [],
          "line": 1078
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "full_path.find",
          "args": [
            "match"
          ],
          "line": 1077
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "full_path.substr",
          "args": [
            "match.size()"
          ],
          "line": 1074
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "match.size",
          "args": [],
          "line": 1074
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "full_path.find",
          "args": [
            "match"
          ],
          "line": 1073
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_user_data_dir",
          "args": [],
          "line": 1072
        },
        "resolved": true,
        "details": {
          "function_name": "get_user_data_dir",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
          "lines": "561-571",
          "snippet": "std::string get_user_data_dir()\n{\n\t// ensure setup gets called only once per session\n\t// FIXME: this is okay and optimized, but how should we react\n\t// if the user deletes a dir while we are running?\n\tif (user_data_dir.empty())\n\t{\n\t\tset_user_data_dir(std::string());\n\t}\n\treturn user_data_dir;\n}",
          "includes": [
            "#include <CoreFoundation/CFBase.h>",
            "#include <CoreFoundation/CFString.h>",
            "#include <CoreFoundation/CoreFoundation.h>",
            "#include <boost/foreach.hpp>",
            "#include \"version.hpp\"",
            "#include \"serialization/unicode.hpp\"",
            "#include \"serialization/string_utils.hpp\"",
            "#include \"scoped_resource.hpp\"",
            "#include \"log.hpp\"",
            "#include \"game_preferences.hpp\"",
            "#include \"game_config.hpp\"",
            "#include \"filesystem.hpp\"",
            "#include \"config.hpp\"",
            "#include <cstring>",
            "#include <boost/algorithm/string.hpp>",
            "#include <set>",
            "#include <iomanip>",
            "#include <fstream>",
            "#include <cerrno>",
            "#include <libgen.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <cctype>",
            "#include \"filesystem_win32.ii\"",
            "#include <sys/stat.h>",
            "#include \"global.hpp\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\nstd::string get_user_data_dir()\n{\n\t// ensure setup gets called only once per session\n\t// FIXME: this is okay and optimized, but how should we react\n\t// if the user deletes a dir while we are running?\n\tif (user_data_dir.empty())\n\t{\n\t\tset_user_data_dir(std::string());\n\t}\n\treturn user_data_dir;\n}"
        }
      },
      {
        "call_info": {
          "callee": "full_path.empty",
          "args": [],
          "line": 1071
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_binary_file_location",
          "args": [
            "\"images\"",
            "filename"
          ],
          "line": 1069
        },
        "resolved": true,
        "details": {
          "function_name": "get_binary_file_location",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
          "lines": "928-963",
          "snippet": "std::string get_binary_file_location(const std::string& type, const std::string& filename)\n{\n\tDBG_FS << \"Looking for '\" << filename << \"'.\" << std::endl;\n\n\tif (filename.empty()) {\n\t\tLOG_FS << \"  invalid filename (type: \" << type <<\")\" << std::endl;\n\t\treturn std::string();\n\t}\n\n\t// Some parts of Wesnoth enjoy putting \"..\" inside filenames. This is\n\t// bad and should be fixed. But in the meantime, deal with them in a dumb way.\n\tstd::string::size_type pos = filename.rfind(\"../\");\n\tif (pos != std::string::npos) {\n\t\tstd::string nf = filename.substr(pos + 3);\n\t\tLOG_FS << \"Illegal path '\" << filename << \"' replaced by '\" << nf << \"'\" << std::endl;\n\t\treturn get_binary_file_location(type, nf);\n\t}\n\n\tif (filename.find(\"..\") != std::string::npos) {\n\t\tERR_FS << \"Illegal path '\" << filename << \"' (\\\"..\\\" not allowed).\" << std::endl;\n\t\treturn std::string();\n\t}\n\n\tBOOST_FOREACH(const std::string &path, get_binary_paths(type))\n\t{\n\t\tconst std::string file = path + filename;\n\t\tDBG_FS << \"  checking '\" << path << \"'\" << std::endl;\n\t\tif(file_exists(file)) {\n\t\t\tDBG_FS << \"  found at '\" << file << \"'\" << std::endl;\n\t\t\treturn file;\n\t\t}\n\t}\n\n\tDBG_FS << \"  not found\" << std::endl;\n\treturn std::string();\n}",
          "includes": [
            "#include <CoreFoundation/CFBase.h>",
            "#include <CoreFoundation/CFString.h>",
            "#include <CoreFoundation/CoreFoundation.h>",
            "#include <boost/foreach.hpp>",
            "#include \"version.hpp\"",
            "#include \"serialization/unicode.hpp\"",
            "#include \"serialization/string_utils.hpp\"",
            "#include \"scoped_resource.hpp\"",
            "#include \"log.hpp\"",
            "#include \"game_preferences.hpp\"",
            "#include \"game_config.hpp\"",
            "#include \"filesystem.hpp\"",
            "#include \"config.hpp\"",
            "#include <cstring>",
            "#include <boost/algorithm/string.hpp>",
            "#include <set>",
            "#include <iomanip>",
            "#include <fstream>",
            "#include <cerrno>",
            "#include <libgen.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <cctype>",
            "#include \"filesystem_win32.ii\"",
            "#include <sys/stat.h>",
            "#include \"global.hpp\""
          ],
          "macros_used": [
            "#define ERR_FS LOG_STREAM(err, log_filesystem)",
            "#define LOG_FS LOG_STREAM(info, log_filesystem)",
            "#define DBG_FS LOG_STREAM(debug, log_filesystem)"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\n#define ERR_FS LOG_STREAM(err, log_filesystem)\n#define LOG_FS LOG_STREAM(info, log_filesystem)\n#define DBG_FS LOG_STREAM(debug, log_filesystem)\n\nstd::string get_binary_file_location(const std::string& type, const std::string& filename)\n{\n\tDBG_FS << \"Looking for '\" << filename << \"'.\" << std::endl;\n\n\tif (filename.empty()) {\n\t\tLOG_FS << \"  invalid filename (type: \" << type <<\")\" << std::endl;\n\t\treturn std::string();\n\t}\n\n\t// Some parts of Wesnoth enjoy putting \"..\" inside filenames. This is\n\t// bad and should be fixed. But in the meantime, deal with them in a dumb way.\n\tstd::string::size_type pos = filename.rfind(\"../\");\n\tif (pos != std::string::npos) {\n\t\tstd::string nf = filename.substr(pos + 3);\n\t\tLOG_FS << \"Illegal path '\" << filename << \"' replaced by '\" << nf << \"'\" << std::endl;\n\t\treturn get_binary_file_location(type, nf);\n\t}\n\n\tif (filename.find(\"..\") != std::string::npos) {\n\t\tERR_FS << \"Illegal path '\" << filename << \"' (\\\"..\\\" not allowed).\" << std::endl;\n\t\treturn std::string();\n\t}\n\n\tBOOST_FOREACH(const std::string &path, get_binary_paths(type))\n\t{\n\t\tconst std::string file = path + filename;\n\t\tDBG_FS << \"  checking '\" << path << \"'\" << std::endl;\n\t\tif(file_exists(file)) {\n\t\t\tDBG_FS << \"  found at '\" << file << \"'\" << std::endl;\n\t\t\treturn file;\n\t\t}\n\t}\n\n\tDBG_FS << \"  not found\" << std::endl;\n\treturn std::string();\n}"
        }
      }
    ],
    "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\nstd::string get_independent_image_path(const std::string &filename)\n{\n\tstd::string full_path = get_binary_file_location(\"images\", filename);\n\n\tif(!full_path.empty()) {\n\t\tstd::string match = get_user_data_dir() + \"/\";\n\t\tif(full_path.find(match) == 0) {\n\t\t\treturn full_path.substr(match.size());\n\t\t}\n\t\tmatch = game_config::path + \"/\";\n\t\tif(full_path.find(match) == 0) {\n\t\t\treturn full_path.substr(match.size());\n\t\t}\n\t}\n\n\treturn full_path;\n}"
  },
  {
    "function_name": "get_short_wml_path",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
    "lines": "1054-1065",
    "snippet": "std::string get_short_wml_path(const std::string &filename)\n{\n\tstd::string match = get_user_data_dir() + \"/data/\";\n\tif (filename.find(match) == 0) {\n\t\treturn \"~\" + filename.substr(match.size());\n\t}\n\tmatch = game_config::path + \"/data/\";\n\tif (filename.find(match) == 0) {\n\t\treturn filename.substr(match.size());\n\t}\n\treturn filename;\n}",
    "includes": [
      "#include <CoreFoundation/CFBase.h>",
      "#include <CoreFoundation/CFString.h>",
      "#include <CoreFoundation/CoreFoundation.h>",
      "#include <boost/foreach.hpp>",
      "#include \"version.hpp\"",
      "#include \"serialization/unicode.hpp\"",
      "#include \"serialization/string_utils.hpp\"",
      "#include \"scoped_resource.hpp\"",
      "#include \"log.hpp\"",
      "#include \"game_preferences.hpp\"",
      "#include \"game_config.hpp\"",
      "#include \"filesystem.hpp\"",
      "#include \"config.hpp\"",
      "#include <cstring>",
      "#include <boost/algorithm/string.hpp>",
      "#include <set>",
      "#include <iomanip>",
      "#include <fstream>",
      "#include <cerrno>",
      "#include <libgen.h>",
      "#include <dirent.h>",
      "#include <unistd.h>",
      "#include <cctype>",
      "#include \"filesystem_win32.ii\"",
      "#include <sys/stat.h>",
      "#include \"global.hpp\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "filename.substr",
          "args": [
            "match.size()"
          ],
          "line": 1062
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "match.size",
          "args": [],
          "line": 1062
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "filename.find",
          "args": [
            "match"
          ],
          "line": 1061
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "filename.substr",
          "args": [
            "match.size()"
          ],
          "line": 1058
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "match.size",
          "args": [],
          "line": 1058
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "filename.find",
          "args": [
            "match"
          ],
          "line": 1057
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_user_data_dir",
          "args": [],
          "line": 1056
        },
        "resolved": true,
        "details": {
          "function_name": "get_user_data_dir",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
          "lines": "561-571",
          "snippet": "std::string get_user_data_dir()\n{\n\t// ensure setup gets called only once per session\n\t// FIXME: this is okay and optimized, but how should we react\n\t// if the user deletes a dir while we are running?\n\tif (user_data_dir.empty())\n\t{\n\t\tset_user_data_dir(std::string());\n\t}\n\treturn user_data_dir;\n}",
          "includes": [
            "#include <CoreFoundation/CFBase.h>",
            "#include <CoreFoundation/CFString.h>",
            "#include <CoreFoundation/CoreFoundation.h>",
            "#include <boost/foreach.hpp>",
            "#include \"version.hpp\"",
            "#include \"serialization/unicode.hpp\"",
            "#include \"serialization/string_utils.hpp\"",
            "#include \"scoped_resource.hpp\"",
            "#include \"log.hpp\"",
            "#include \"game_preferences.hpp\"",
            "#include \"game_config.hpp\"",
            "#include \"filesystem.hpp\"",
            "#include \"config.hpp\"",
            "#include <cstring>",
            "#include <boost/algorithm/string.hpp>",
            "#include <set>",
            "#include <iomanip>",
            "#include <fstream>",
            "#include <cerrno>",
            "#include <libgen.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <cctype>",
            "#include \"filesystem_win32.ii\"",
            "#include <sys/stat.h>",
            "#include \"global.hpp\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\nstd::string get_user_data_dir()\n{\n\t// ensure setup gets called only once per session\n\t// FIXME: this is okay and optimized, but how should we react\n\t// if the user deletes a dir while we are running?\n\tif (user_data_dir.empty())\n\t{\n\t\tset_user_data_dir(std::string());\n\t}\n\treturn user_data_dir;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\nstd::string get_short_wml_path(const std::string &filename)\n{\n\tstd::string match = get_user_data_dir() + \"/data/\";\n\tif (filename.find(match) == 0) {\n\t\treturn \"~\" + filename.substr(match.size());\n\t}\n\tmatch = game_config::path + \"/data/\";\n\tif (filename.find(match) == 0) {\n\t\treturn filename.substr(match.size());\n\t}\n\treturn filename;\n}"
  },
  {
    "function_name": "get_wml_location",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
    "lines": "993-1052",
    "snippet": "std::string get_wml_location(const std::string &filename, const std::string &current_dir)\n{\n\tDBG_FS << \"Looking for '\" << filename << \"'.\" << std::endl;\n\n\tassert(game_config::path.empty() == false);\n\n\tstd::string result;\n\n\tif (filename.empty()) {\n\t\tLOG_FS << \"  invalid filename\" << std::endl;\n\t\treturn result;\n\t}\n\n\tif (filename.find(\"..\") != std::string::npos) {\n\t\tERR_FS << \"Illegal path '\" << filename << \"' (\\\"..\\\" not allowed).\" << std::endl;\n\t\treturn result;\n\t}\n\n\tbool already_found = false;\n\n\tif (filename[0] == '~')\n\t{\n\t\t// If the filename starts with '~', look in the user data directory.\n\t\tresult = get_user_data_dir() + \"/data/\" + filename.substr(1);\n\t\tDBG_FS << \"  trying '\" << result << \"'\" << std::endl;\n\n\t\talready_found = file_exists(result) || is_directory(result);\n\t}\n\telse if (filename.size() >= 2 && filename[0] == '.' && filename[1] == '/')\n\t{\n\t\t// If the filename begins with a \"./\", look in the same directory\n\t\t// as the file currently being preprocessed.\n\n\t\tif (!current_dir.empty())\n\t\t{\n\t\t\tresult = current_dir;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult = game_config::path;\n\t\t}\n\n\t\tresult += filename.substr(2);\n\t}\n\telse if (!game_config::path.empty())\n\t\tresult = game_config::path + \"/data/\" + filename;\n\n\tDBG_FS << \"  trying '\" << result << \"'\" << std::endl;\n\n\tif (result.empty() ||\n\t    (!already_found && !file_exists(result) && !is_directory(result)))\n\t{\n\t\tDBG_FS << \"  not found\" << std::endl;\n\t\tresult.clear();\n\t}\n\telse\n\t\tDBG_FS << \"  found: '\" << result << \"'\" << std::endl;\n\n\treturn result;\n}",
    "includes": [
      "#include <CoreFoundation/CFBase.h>",
      "#include <CoreFoundation/CFString.h>",
      "#include <CoreFoundation/CoreFoundation.h>",
      "#include <boost/foreach.hpp>",
      "#include \"version.hpp\"",
      "#include \"serialization/unicode.hpp\"",
      "#include \"serialization/string_utils.hpp\"",
      "#include \"scoped_resource.hpp\"",
      "#include \"log.hpp\"",
      "#include \"game_preferences.hpp\"",
      "#include \"game_config.hpp\"",
      "#include \"filesystem.hpp\"",
      "#include \"config.hpp\"",
      "#include <cstring>",
      "#include <boost/algorithm/string.hpp>",
      "#include <set>",
      "#include <iomanip>",
      "#include <fstream>",
      "#include <cerrno>",
      "#include <libgen.h>",
      "#include <dirent.h>",
      "#include <unistd.h>",
      "#include <cctype>",
      "#include \"filesystem_win32.ii\"",
      "#include <sys/stat.h>",
      "#include \"global.hpp\""
    ],
    "macros_used": [
      "#define ERR_FS LOG_STREAM(err, log_filesystem)",
      "#define LOG_FS LOG_STREAM(info, log_filesystem)",
      "#define DBG_FS LOG_STREAM(debug, log_filesystem)"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "result.clear",
          "args": [],
          "line": 1046
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "is_directory",
          "args": [
            "result"
          ],
          "line": 1043
        },
        "resolved": true,
        "details": {
          "function_name": "is_directory",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
          "lines": "708-719",
          "snippet": "bool is_directory(const std::string& fname)\n{\n\tif(fname.empty()) {\n\t\treturn false;\n\t}\n\tif(fname[0] != '/' && !game_config::path.empty()) {\n\t\tif(is_directory_internal(game_config::path + \"/\" + fname))\n\t\t\treturn true;\n\t}\n\n\treturn is_directory_internal(fname);\n}",
          "includes": [
            "#include <CoreFoundation/CFBase.h>",
            "#include <CoreFoundation/CFString.h>",
            "#include <CoreFoundation/CoreFoundation.h>",
            "#include <boost/foreach.hpp>",
            "#include \"version.hpp\"",
            "#include \"serialization/unicode.hpp\"",
            "#include \"serialization/string_utils.hpp\"",
            "#include \"scoped_resource.hpp\"",
            "#include \"log.hpp\"",
            "#include \"game_preferences.hpp\"",
            "#include \"game_config.hpp\"",
            "#include \"filesystem.hpp\"",
            "#include \"config.hpp\"",
            "#include <cstring>",
            "#include <boost/algorithm/string.hpp>",
            "#include <set>",
            "#include <iomanip>",
            "#include <fstream>",
            "#include <cerrno>",
            "#include <libgen.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <cctype>",
            "#include \"filesystem_win32.ii\"",
            "#include <sys/stat.h>",
            "#include \"global.hpp\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\nbool is_directory(const std::string& fname)\n{\n\tif(fname.empty()) {\n\t\treturn false;\n\t}\n\tif(fname[0] != '/' && !game_config::path.empty()) {\n\t\tif(is_directory_internal(game_config::path + \"/\" + fname))\n\t\t\treturn true;\n\t}\n\n\treturn is_directory_internal(fname);\n}"
        }
      },
      {
        "call_info": {
          "callee": "file_exists",
          "args": [
            "result"
          ],
          "line": 1043
        },
        "resolved": true,
        "details": {
          "function_name": "file_exists",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
          "lines": "721-730",
          "snippet": "bool file_exists(const std::string& name)\n{\n#ifdef _WIN32\n       struct stat st;\n       return (::stat(name.c_str(), &st) == 0);\n#else\n\tstruct stat st;\n\treturn (::stat(name.c_str(), &st) != -1);\n#endif\n}",
          "includes": [
            "#include <CoreFoundation/CFBase.h>",
            "#include <CoreFoundation/CFString.h>",
            "#include <CoreFoundation/CoreFoundation.h>",
            "#include <boost/foreach.hpp>",
            "#include \"version.hpp\"",
            "#include \"serialization/unicode.hpp\"",
            "#include \"serialization/string_utils.hpp\"",
            "#include \"scoped_resource.hpp\"",
            "#include \"log.hpp\"",
            "#include \"game_preferences.hpp\"",
            "#include \"game_config.hpp\"",
            "#include \"filesystem.hpp\"",
            "#include \"config.hpp\"",
            "#include <cstring>",
            "#include <boost/algorithm/string.hpp>",
            "#include <set>",
            "#include <iomanip>",
            "#include <fstream>",
            "#include <cerrno>",
            "#include <libgen.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <cctype>",
            "#include \"filesystem_win32.ii\"",
            "#include <sys/stat.h>",
            "#include \"global.hpp\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\nbool file_exists(const std::string& name)\n{\n#ifdef _WIN32\n       struct stat st;\n       return (::stat(name.c_str(), &st) == 0);\n#else\n\tstruct stat st;\n\treturn (::stat(name.c_str(), &st) != -1);\n#endif\n}"
        }
      },
      {
        "call_info": {
          "callee": "result.empty",
          "args": [],
          "line": 1042
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "game_config::path.empty",
          "args": [],
          "line": 1037
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "filename.substr",
          "args": [
            "2"
          ],
          "line": 1035
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "current_dir.empty",
          "args": [],
          "line": 1026
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "filename.size",
          "args": [],
          "line": 1021
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "filename.substr",
          "args": [
            "1"
          ],
          "line": 1016
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_user_data_dir",
          "args": [],
          "line": 1016
        },
        "resolved": true,
        "details": {
          "function_name": "get_user_data_dir",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
          "lines": "561-571",
          "snippet": "std::string get_user_data_dir()\n{\n\t// ensure setup gets called only once per session\n\t// FIXME: this is okay and optimized, but how should we react\n\t// if the user deletes a dir while we are running?\n\tif (user_data_dir.empty())\n\t{\n\t\tset_user_data_dir(std::string());\n\t}\n\treturn user_data_dir;\n}",
          "includes": [
            "#include <CoreFoundation/CFBase.h>",
            "#include <CoreFoundation/CFString.h>",
            "#include <CoreFoundation/CoreFoundation.h>",
            "#include <boost/foreach.hpp>",
            "#include \"version.hpp\"",
            "#include \"serialization/unicode.hpp\"",
            "#include \"serialization/string_utils.hpp\"",
            "#include \"scoped_resource.hpp\"",
            "#include \"log.hpp\"",
            "#include \"game_preferences.hpp\"",
            "#include \"game_config.hpp\"",
            "#include \"filesystem.hpp\"",
            "#include \"config.hpp\"",
            "#include <cstring>",
            "#include <boost/algorithm/string.hpp>",
            "#include <set>",
            "#include <iomanip>",
            "#include <fstream>",
            "#include <cerrno>",
            "#include <libgen.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <cctype>",
            "#include \"filesystem_win32.ii\"",
            "#include <sys/stat.h>",
            "#include \"global.hpp\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\nstd::string get_user_data_dir()\n{\n\t// ensure setup gets called only once per session\n\t// FIXME: this is okay and optimized, but how should we react\n\t// if the user deletes a dir while we are running?\n\tif (user_data_dir.empty())\n\t{\n\t\tset_user_data_dir(std::string());\n\t}\n\treturn user_data_dir;\n}"
        }
      },
      {
        "call_info": {
          "callee": "filename.find",
          "args": [
            "\"..\""
          ],
          "line": 1006
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "filename.empty",
          "args": [],
          "line": 1001
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "assert",
          "args": [
            "game_config::path.empty() == false"
          ],
          "line": 997
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "game_config::path.empty",
          "args": [],
          "line": 997
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\n#define ERR_FS LOG_STREAM(err, log_filesystem)\n#define LOG_FS LOG_STREAM(info, log_filesystem)\n#define DBG_FS LOG_STREAM(debug, log_filesystem)\n\nstd::string get_wml_location(const std::string &filename, const std::string &current_dir)\n{\n\tDBG_FS << \"Looking for '\" << filename << \"'.\" << std::endl;\n\n\tassert(game_config::path.empty() == false);\n\n\tstd::string result;\n\n\tif (filename.empty()) {\n\t\tLOG_FS << \"  invalid filename\" << std::endl;\n\t\treturn result;\n\t}\n\n\tif (filename.find(\"..\") != std::string::npos) {\n\t\tERR_FS << \"Illegal path '\" << filename << \"' (\\\"..\\\" not allowed).\" << std::endl;\n\t\treturn result;\n\t}\n\n\tbool already_found = false;\n\n\tif (filename[0] == '~')\n\t{\n\t\t// If the filename starts with '~', look in the user data directory.\n\t\tresult = get_user_data_dir() + \"/data/\" + filename.substr(1);\n\t\tDBG_FS << \"  trying '\" << result << \"'\" << std::endl;\n\n\t\talready_found = file_exists(result) || is_directory(result);\n\t}\n\telse if (filename.size() >= 2 && filename[0] == '.' && filename[1] == '/')\n\t{\n\t\t// If the filename begins with a \"./\", look in the same directory\n\t\t// as the file currently being preprocessed.\n\n\t\tif (!current_dir.empty())\n\t\t{\n\t\t\tresult = current_dir;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult = game_config::path;\n\t\t}\n\n\t\tresult += filename.substr(2);\n\t}\n\telse if (!game_config::path.empty())\n\t\tresult = game_config::path + \"/data/\" + filename;\n\n\tDBG_FS << \"  trying '\" << result << \"'\" << std::endl;\n\n\tif (result.empty() ||\n\t    (!already_found && !file_exists(result) && !is_directory(result)))\n\t{\n\t\tDBG_FS << \"  not found\" << std::endl;\n\t\tresult.clear();\n\t}\n\telse\n\t\tDBG_FS << \"  found: '\" << result << \"'\" << std::endl;\n\n\treturn result;\n}"
  },
  {
    "function_name": "get_binary_dir_location",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
    "lines": "965-991",
    "snippet": "std::string get_binary_dir_location(const std::string &type, const std::string &filename)\n{\n\tDBG_FS << \"Looking for '\" << filename << \"'.\" << std::endl;\n\n\tif (filename.empty()) {\n\t\tLOG_FS << \"  invalid filename (type: \" << type <<\")\" << std::endl;\n\t\treturn std::string();\n\t}\n\n\tif (filename.find(\"..\") != std::string::npos) {\n\t\tERR_FS << \"Illegal path '\" << filename << \"' (\\\"..\\\" not allowed).\" << std::endl;\n\t\treturn std::string();\n\t}\n\n\tBOOST_FOREACH(const std::string &path, get_binary_paths(type))\n\t{\n\t\tconst std::string file = path + filename;\n\t\tDBG_FS << \"  checking '\" << path << \"'\" << std::endl;\n\t\tif (is_directory(file)) {\n\t\t\tDBG_FS << \"  found at '\" << file << \"'\" << std::endl;\n\t\t\treturn file;\n\t\t}\n\t}\n\n\tDBG_FS << \"  not found\" << std::endl;\n\treturn std::string();\n}",
    "includes": [
      "#include <CoreFoundation/CFBase.h>",
      "#include <CoreFoundation/CFString.h>",
      "#include <CoreFoundation/CoreFoundation.h>",
      "#include <boost/foreach.hpp>",
      "#include \"version.hpp\"",
      "#include \"serialization/unicode.hpp\"",
      "#include \"serialization/string_utils.hpp\"",
      "#include \"scoped_resource.hpp\"",
      "#include \"log.hpp\"",
      "#include \"game_preferences.hpp\"",
      "#include \"game_config.hpp\"",
      "#include \"filesystem.hpp\"",
      "#include \"config.hpp\"",
      "#include <cstring>",
      "#include <boost/algorithm/string.hpp>",
      "#include <set>",
      "#include <iomanip>",
      "#include <fstream>",
      "#include <cerrno>",
      "#include <libgen.h>",
      "#include <dirent.h>",
      "#include <unistd.h>",
      "#include <cctype>",
      "#include \"filesystem_win32.ii\"",
      "#include <sys/stat.h>",
      "#include \"global.hpp\""
    ],
    "macros_used": [
      "#define ERR_FS LOG_STREAM(err, log_filesystem)",
      "#define LOG_FS LOG_STREAM(info, log_filesystem)",
      "#define DBG_FS LOG_STREAM(debug, log_filesystem)"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "std::string",
          "args": [],
          "line": 990
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "is_directory",
          "args": [
            "file"
          ],
          "line": 983
        },
        "resolved": true,
        "details": {
          "function_name": "is_directory",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
          "lines": "708-719",
          "snippet": "bool is_directory(const std::string& fname)\n{\n\tif(fname.empty()) {\n\t\treturn false;\n\t}\n\tif(fname[0] != '/' && !game_config::path.empty()) {\n\t\tif(is_directory_internal(game_config::path + \"/\" + fname))\n\t\t\treturn true;\n\t}\n\n\treturn is_directory_internal(fname);\n}",
          "includes": [
            "#include <CoreFoundation/CFBase.h>",
            "#include <CoreFoundation/CFString.h>",
            "#include <CoreFoundation/CoreFoundation.h>",
            "#include <boost/foreach.hpp>",
            "#include \"version.hpp\"",
            "#include \"serialization/unicode.hpp\"",
            "#include \"serialization/string_utils.hpp\"",
            "#include \"scoped_resource.hpp\"",
            "#include \"log.hpp\"",
            "#include \"game_preferences.hpp\"",
            "#include \"game_config.hpp\"",
            "#include \"filesystem.hpp\"",
            "#include \"config.hpp\"",
            "#include <cstring>",
            "#include <boost/algorithm/string.hpp>",
            "#include <set>",
            "#include <iomanip>",
            "#include <fstream>",
            "#include <cerrno>",
            "#include <libgen.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <cctype>",
            "#include \"filesystem_win32.ii\"",
            "#include <sys/stat.h>",
            "#include \"global.hpp\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\nbool is_directory(const std::string& fname)\n{\n\tif(fname.empty()) {\n\t\treturn false;\n\t}\n\tif(fname[0] != '/' && !game_config::path.empty()) {\n\t\tif(is_directory_internal(game_config::path + \"/\" + fname))\n\t\t\treturn true;\n\t}\n\n\treturn is_directory_internal(fname);\n}"
        }
      },
      {
        "call_info": {
          "callee": "std::string",
          "args": [],
          "line": 976
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "filename.find",
          "args": [
            "\"..\""
          ],
          "line": 974
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "std::string",
          "args": [],
          "line": 971
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "filename.empty",
          "args": [],
          "line": 969
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\n#define ERR_FS LOG_STREAM(err, log_filesystem)\n#define LOG_FS LOG_STREAM(info, log_filesystem)\n#define DBG_FS LOG_STREAM(debug, log_filesystem)\n\nstd::string get_binary_dir_location(const std::string &type, const std::string &filename)\n{\n\tDBG_FS << \"Looking for '\" << filename << \"'.\" << std::endl;\n\n\tif (filename.empty()) {\n\t\tLOG_FS << \"  invalid filename (type: \" << type <<\")\" << std::endl;\n\t\treturn std::string();\n\t}\n\n\tif (filename.find(\"..\") != std::string::npos) {\n\t\tERR_FS << \"Illegal path '\" << filename << \"' (\\\"..\\\" not allowed).\" << std::endl;\n\t\treturn std::string();\n\t}\n\n\tBOOST_FOREACH(const std::string &path, get_binary_paths(type))\n\t{\n\t\tconst std::string file = path + filename;\n\t\tDBG_FS << \"  checking '\" << path << \"'\" << std::endl;\n\t\tif (is_directory(file)) {\n\t\t\tDBG_FS << \"  found at '\" << file << \"'\" << std::endl;\n\t\t\treturn file;\n\t\t}\n\t}\n\n\tDBG_FS << \"  not found\" << std::endl;\n\treturn std::string();\n}"
  },
  {
    "function_name": "get_binary_file_location",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
    "lines": "928-963",
    "snippet": "std::string get_binary_file_location(const std::string& type, const std::string& filename)\n{\n\tDBG_FS << \"Looking for '\" << filename << \"'.\" << std::endl;\n\n\tif (filename.empty()) {\n\t\tLOG_FS << \"  invalid filename (type: \" << type <<\")\" << std::endl;\n\t\treturn std::string();\n\t}\n\n\t// Some parts of Wesnoth enjoy putting \"..\" inside filenames. This is\n\t// bad and should be fixed. But in the meantime, deal with them in a dumb way.\n\tstd::string::size_type pos = filename.rfind(\"../\");\n\tif (pos != std::string::npos) {\n\t\tstd::string nf = filename.substr(pos + 3);\n\t\tLOG_FS << \"Illegal path '\" << filename << \"' replaced by '\" << nf << \"'\" << std::endl;\n\t\treturn get_binary_file_location(type, nf);\n\t}\n\n\tif (filename.find(\"..\") != std::string::npos) {\n\t\tERR_FS << \"Illegal path '\" << filename << \"' (\\\"..\\\" not allowed).\" << std::endl;\n\t\treturn std::string();\n\t}\n\n\tBOOST_FOREACH(const std::string &path, get_binary_paths(type))\n\t{\n\t\tconst std::string file = path + filename;\n\t\tDBG_FS << \"  checking '\" << path << \"'\" << std::endl;\n\t\tif(file_exists(file)) {\n\t\t\tDBG_FS << \"  found at '\" << file << \"'\" << std::endl;\n\t\t\treturn file;\n\t\t}\n\t}\n\n\tDBG_FS << \"  not found\" << std::endl;\n\treturn std::string();\n}",
    "includes": [
      "#include <CoreFoundation/CFBase.h>",
      "#include <CoreFoundation/CFString.h>",
      "#include <CoreFoundation/CoreFoundation.h>",
      "#include <boost/foreach.hpp>",
      "#include \"version.hpp\"",
      "#include \"serialization/unicode.hpp\"",
      "#include \"serialization/string_utils.hpp\"",
      "#include \"scoped_resource.hpp\"",
      "#include \"log.hpp\"",
      "#include \"game_preferences.hpp\"",
      "#include \"game_config.hpp\"",
      "#include \"filesystem.hpp\"",
      "#include \"config.hpp\"",
      "#include <cstring>",
      "#include <boost/algorithm/string.hpp>",
      "#include <set>",
      "#include <iomanip>",
      "#include <fstream>",
      "#include <cerrno>",
      "#include <libgen.h>",
      "#include <dirent.h>",
      "#include <unistd.h>",
      "#include <cctype>",
      "#include \"filesystem_win32.ii\"",
      "#include <sys/stat.h>",
      "#include \"global.hpp\""
    ],
    "macros_used": [
      "#define ERR_FS LOG_STREAM(err, log_filesystem)",
      "#define LOG_FS LOG_STREAM(info, log_filesystem)",
      "#define DBG_FS LOG_STREAM(debug, log_filesystem)"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "std::string",
          "args": [],
          "line": 962
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "file_exists",
          "args": [
            "file"
          ],
          "line": 955
        },
        "resolved": true,
        "details": {
          "function_name": "file_exists",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
          "lines": "721-730",
          "snippet": "bool file_exists(const std::string& name)\n{\n#ifdef _WIN32\n       struct stat st;\n       return (::stat(name.c_str(), &st) == 0);\n#else\n\tstruct stat st;\n\treturn (::stat(name.c_str(), &st) != -1);\n#endif\n}",
          "includes": [
            "#include <CoreFoundation/CFBase.h>",
            "#include <CoreFoundation/CFString.h>",
            "#include <CoreFoundation/CoreFoundation.h>",
            "#include <boost/foreach.hpp>",
            "#include \"version.hpp\"",
            "#include \"serialization/unicode.hpp\"",
            "#include \"serialization/string_utils.hpp\"",
            "#include \"scoped_resource.hpp\"",
            "#include \"log.hpp\"",
            "#include \"game_preferences.hpp\"",
            "#include \"game_config.hpp\"",
            "#include \"filesystem.hpp\"",
            "#include \"config.hpp\"",
            "#include <cstring>",
            "#include <boost/algorithm/string.hpp>",
            "#include <set>",
            "#include <iomanip>",
            "#include <fstream>",
            "#include <cerrno>",
            "#include <libgen.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <cctype>",
            "#include \"filesystem_win32.ii\"",
            "#include <sys/stat.h>",
            "#include \"global.hpp\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\nbool file_exists(const std::string& name)\n{\n#ifdef _WIN32\n       struct stat st;\n       return (::stat(name.c_str(), &st) == 0);\n#else\n\tstruct stat st;\n\treturn (::stat(name.c_str(), &st) != -1);\n#endif\n}"
        }
      },
      {
        "call_info": {
          "callee": "std::string",
          "args": [],
          "line": 948
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "filename.find",
          "args": [
            "\"..\""
          ],
          "line": 946
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_binary_file_location",
          "args": [
            "type",
            "nf"
          ],
          "line": 943
        },
        "resolved": true,
        "details": {
          "function_name": "get_binary_file_location",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
          "lines": "928-963",
          "snippet": "std::string get_binary_file_location(const std::string& type, const std::string& filename)\n{\n\tDBG_FS << \"Looking for '\" << filename << \"'.\" << std::endl;\n\n\tif (filename.empty()) {\n\t\tLOG_FS << \"  invalid filename (type: \" << type <<\")\" << std::endl;\n\t\treturn std::string();\n\t}\n\n\t// Some parts of Wesnoth enjoy putting \"..\" inside filenames. This is\n\t// bad and should be fixed. But in the meantime, deal with them in a dumb way.\n\tstd::string::size_type pos = filename.rfind(\"../\");\n\tif (pos != std::string::npos) {\n\t\tstd::string nf = filename.substr(pos + 3);\n\t\tLOG_FS << \"Illegal path '\" << filename << \"' replaced by '\" << nf << \"'\" << std::endl;\n\t\treturn get_binary_file_location(type, nf);\n\t}\n\n\tif (filename.find(\"..\") != std::string::npos) {\n\t\tERR_FS << \"Illegal path '\" << filename << \"' (\\\"..\\\" not allowed).\" << std::endl;\n\t\treturn std::string();\n\t}\n\n\tBOOST_FOREACH(const std::string &path, get_binary_paths(type))\n\t{\n\t\tconst std::string file = path + filename;\n\t\tDBG_FS << \"  checking '\" << path << \"'\" << std::endl;\n\t\tif(file_exists(file)) {\n\t\t\tDBG_FS << \"  found at '\" << file << \"'\" << std::endl;\n\t\t\treturn file;\n\t\t}\n\t}\n\n\tDBG_FS << \"  not found\" << std::endl;\n\treturn std::string();\n}",
          "note": "cyclic_reference_detected"
        }
      },
      {
        "call_info": {
          "callee": "filename.substr",
          "args": [
            "pos + 3"
          ],
          "line": 941
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "filename.rfind",
          "args": [
            "\"../\""
          ],
          "line": 939
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "std::string",
          "args": [],
          "line": 934
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "filename.empty",
          "args": [],
          "line": 932
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\n#define ERR_FS LOG_STREAM(err, log_filesystem)\n#define LOG_FS LOG_STREAM(info, log_filesystem)\n#define DBG_FS LOG_STREAM(debug, log_filesystem)\n\nstd::string get_binary_file_location(const std::string& type, const std::string& filename)\n{\n\tDBG_FS << \"Looking for '\" << filename << \"'.\" << std::endl;\n\n\tif (filename.empty()) {\n\t\tLOG_FS << \"  invalid filename (type: \" << type <<\")\" << std::endl;\n\t\treturn std::string();\n\t}\n\n\t// Some parts of Wesnoth enjoy putting \"..\" inside filenames. This is\n\t// bad and should be fixed. But in the meantime, deal with them in a dumb way.\n\tstd::string::size_type pos = filename.rfind(\"../\");\n\tif (pos != std::string::npos) {\n\t\tstd::string nf = filename.substr(pos + 3);\n\t\tLOG_FS << \"Illegal path '\" << filename << \"' replaced by '\" << nf << \"'\" << std::endl;\n\t\treturn get_binary_file_location(type, nf);\n\t}\n\n\tif (filename.find(\"..\") != std::string::npos) {\n\t\tERR_FS << \"Illegal path '\" << filename << \"' (\\\"..\\\" not allowed).\" << std::endl;\n\t\treturn std::string();\n\t}\n\n\tBOOST_FOREACH(const std::string &path, get_binary_paths(type))\n\t{\n\t\tconst std::string file = path + filename;\n\t\tDBG_FS << \"  checking '\" << path << \"'\" << std::endl;\n\t\tif(file_exists(file)) {\n\t\t\tDBG_FS << \"  found at '\" << file << \"'\" << std::endl;\n\t\t\treturn file;\n\t\t}\n\t}\n\n\tDBG_FS << \"  not found\" << std::endl;\n\treturn std::string();\n}"
  },
  {
    "function_name": "clear_binary_paths_cache",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
    "lines": "887-890",
    "snippet": "void clear_binary_paths_cache()\n{\n\tbinary_paths_cache.clear();\n}",
    "includes": [
      "#include <CoreFoundation/CFBase.h>",
      "#include <CoreFoundation/CFString.h>",
      "#include <CoreFoundation/CoreFoundation.h>",
      "#include <boost/foreach.hpp>",
      "#include \"version.hpp\"",
      "#include \"serialization/unicode.hpp\"",
      "#include \"serialization/string_utils.hpp\"",
      "#include \"scoped_resource.hpp\"",
      "#include \"log.hpp\"",
      "#include \"game_preferences.hpp\"",
      "#include \"game_config.hpp\"",
      "#include \"filesystem.hpp\"",
      "#include \"config.hpp\"",
      "#include <cstring>",
      "#include <boost/algorithm/string.hpp>",
      "#include <set>",
      "#include <iomanip>",
      "#include <fstream>",
      "#include <cerrno>",
      "#include <libgen.h>",
      "#include <dirent.h>",
      "#include <unistd.h>",
      "#include <cctype>",
      "#include \"filesystem_win32.ii\"",
      "#include <sys/stat.h>",
      "#include \"global.hpp\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "binary_paths_cache.clear",
          "args": [],
          "line": 889
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\nvoid clear_binary_paths_cache()\n{\n\tbinary_paths_cache.clear();\n}"
  },
  {
    "function_name": "cleanup",
    "container": "binary_paths_manager",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
    "lines": "878-885",
    "snippet": "void binary_paths_manager::cleanup()\n{\n\tbinary_paths_cache.clear();\n\n\tfor(std::vector<std::string>::const_iterator i = paths_.begin(); i != paths_.end(); ++i) {\n\t\tbinary_paths.erase(*i);\n\t}\n}",
    "includes": [
      "#include <CoreFoundation/CFBase.h>",
      "#include <CoreFoundation/CFString.h>",
      "#include <CoreFoundation/CoreFoundation.h>",
      "#include <boost/foreach.hpp>",
      "#include \"version.hpp\"",
      "#include \"serialization/unicode.hpp\"",
      "#include \"serialization/string_utils.hpp\"",
      "#include \"scoped_resource.hpp\"",
      "#include \"log.hpp\"",
      "#include \"game_preferences.hpp\"",
      "#include \"game_config.hpp\"",
      "#include \"filesystem.hpp\"",
      "#include \"config.hpp\"",
      "#include <cstring>",
      "#include <boost/algorithm/string.hpp>",
      "#include <set>",
      "#include <iomanip>",
      "#include <fstream>",
      "#include <cerrno>",
      "#include <libgen.h>",
      "#include <dirent.h>",
      "#include <unistd.h>",
      "#include <cctype>",
      "#include \"filesystem_win32.ii\"",
      "#include <sys/stat.h>",
      "#include \"global.hpp\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "binary_paths.erase",
          "args": [
            "*i"
          ],
          "line": 883
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "paths_.end",
          "args": [],
          "line": 882
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "paths_.begin",
          "args": [],
          "line": 882
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "binary_paths_cache.clear",
          "args": [],
          "line": 880
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\nbinary_paths_manager {\n  void binary_paths_manager::cleanup()\n  {\n  \tbinary_paths_cache.clear();\n  \n  \tfor(std::vector<std::string>::const_iterator i = paths_.begin(); i != paths_.end(); ++i) {\n  \t\tbinary_paths.erase(*i);\n  \t}\n  }\n}"
  },
  {
    "function_name": "set_paths",
    "container": "binary_paths_manager",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
    "lines": "858-876",
    "snippet": "void binary_paths_manager::set_paths(const config& cfg)\n{\n\tcleanup();\n\tinit_binary_paths();\n\n\tBOOST_FOREACH(const config &bp, cfg.child_range(\"binary_path\"))\n\t{\n\t\tstd::string path = bp[\"path\"].str();\n\t\tif (path.find(\"..\") != std::string::npos) {\n\t\t\tERR_FS << \"Invalid binary path '\" << path << \"'\" << std::endl;\n\t\t\tcontinue;\n\t\t}\n\t\tif (!path.empty() && path[path.size()-1] != '/') path += \"/\";\n\t\tif(binary_paths.count(path) == 0) {\n\t\t\tbinary_paths.insert(path);\n\t\t\tpaths_.push_back(path);\n\t\t}\n\t}\n}",
    "includes": [
      "#include <CoreFoundation/CFBase.h>",
      "#include <CoreFoundation/CFString.h>",
      "#include <CoreFoundation/CoreFoundation.h>",
      "#include <boost/foreach.hpp>",
      "#include \"version.hpp\"",
      "#include \"serialization/unicode.hpp\"",
      "#include \"serialization/string_utils.hpp\"",
      "#include \"scoped_resource.hpp\"",
      "#include \"log.hpp\"",
      "#include \"game_preferences.hpp\"",
      "#include \"game_config.hpp\"",
      "#include \"filesystem.hpp\"",
      "#include \"config.hpp\"",
      "#include <cstring>",
      "#include <boost/algorithm/string.hpp>",
      "#include <set>",
      "#include <iomanip>",
      "#include <fstream>",
      "#include <cerrno>",
      "#include <libgen.h>",
      "#include <dirent.h>",
      "#include <unistd.h>",
      "#include <cctype>",
      "#include \"filesystem_win32.ii\"",
      "#include <sys/stat.h>",
      "#include \"global.hpp\""
    ],
    "macros_used": [
      "#define ERR_FS LOG_STREAM(err, log_filesystem)"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "paths_.push_back",
          "args": [
            "path"
          ],
          "line": 873
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "binary_paths.insert",
          "args": [
            "path"
          ],
          "line": 872
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "binary_paths.count",
          "args": [
            "path"
          ],
          "line": 871
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "path.size",
          "args": [],
          "line": 870
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "path.empty",
          "args": [],
          "line": 870
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "path.find",
          "args": [
            "\"..\""
          ],
          "line": 866
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bp[\"path\"].str",
          "args": [],
          "line": 865
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "init_binary_paths",
          "args": [],
          "line": 861
        },
        "resolved": true,
        "details": {
          "function_name": "init_binary_paths",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
          "lines": "838-843",
          "snippet": "static void init_binary_paths()\n{\n\tif(binary_paths.empty()) {\n\t\tbinary_paths.insert(\"\");\n\t}\n}",
          "includes": [
            "#include <CoreFoundation/CFBase.h>",
            "#include <CoreFoundation/CFString.h>",
            "#include <CoreFoundation/CoreFoundation.h>",
            "#include <boost/foreach.hpp>",
            "#include \"version.hpp\"",
            "#include \"serialization/unicode.hpp\"",
            "#include \"serialization/string_utils.hpp\"",
            "#include \"scoped_resource.hpp\"",
            "#include \"log.hpp\"",
            "#include \"game_preferences.hpp\"",
            "#include \"game_config.hpp\"",
            "#include \"filesystem.hpp\"",
            "#include \"config.hpp\"",
            "#include <cstring>",
            "#include <boost/algorithm/string.hpp>",
            "#include <set>",
            "#include <iomanip>",
            "#include <fstream>",
            "#include <cerrno>",
            "#include <libgen.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <cctype>",
            "#include \"filesystem_win32.ii\"",
            "#include <sys/stat.h>",
            "#include \"global.hpp\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\nstatic void init_binary_paths()\n{\n\tif(binary_paths.empty()) {\n\t\tbinary_paths.insert(\"\");\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "cleanup",
          "args": [],
          "line": 860
        },
        "resolved": true,
        "details": {
          "function_name": "cleanup",
          "container": "binary_paths_manager",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
          "lines": "878-885",
          "snippet": "void binary_paths_manager::cleanup()\n{\n\tbinary_paths_cache.clear();\n\n\tfor(std::vector<std::string>::const_iterator i = paths_.begin(); i != paths_.end(); ++i) {\n\t\tbinary_paths.erase(*i);\n\t}\n}",
          "includes": [
            "#include <CoreFoundation/CFBase.h>",
            "#include <CoreFoundation/CFString.h>",
            "#include <CoreFoundation/CoreFoundation.h>",
            "#include <boost/foreach.hpp>",
            "#include \"version.hpp\"",
            "#include \"serialization/unicode.hpp\"",
            "#include \"serialization/string_utils.hpp\"",
            "#include \"scoped_resource.hpp\"",
            "#include \"log.hpp\"",
            "#include \"game_preferences.hpp\"",
            "#include \"game_config.hpp\"",
            "#include \"filesystem.hpp\"",
            "#include \"config.hpp\"",
            "#include <cstring>",
            "#include <boost/algorithm/string.hpp>",
            "#include <set>",
            "#include <iomanip>",
            "#include <fstream>",
            "#include <cerrno>",
            "#include <libgen.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <cctype>",
            "#include \"filesystem_win32.ii\"",
            "#include <sys/stat.h>",
            "#include \"global.hpp\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\nbinary_paths_manager {\n  void binary_paths_manager::cleanup()\n  {\n  \tbinary_paths_cache.clear();\n  \n  \tfor(std::vector<std::string>::const_iterator i = paths_.begin(); i != paths_.end(); ++i) {\n  \t\tbinary_paths.erase(*i);\n  \t}\n  }\n}"
        }
      }
    ],
    "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\n#define ERR_FS LOG_STREAM(err, log_filesystem)\n\nbinary_paths_manager {\n  void binary_paths_manager::set_paths(const config& cfg)\n  {\n  \tcleanup();\n  \tinit_binary_paths();\n  \n  \tBOOST_FOREACH(const config &bp, cfg.child_range(\"binary_path\"))\n  \t{\n  \t\tstd::string path = bp[\"path\"].str();\n  \t\tif (path.find(\"..\") != std::string::npos) {\n  \t\t\tERR_FS << \"Invalid binary path '\" << path << \"'\" << std::endl;\n  \t\t\tcontinue;\n  \t\t}\n  \t\tif (!path.empty() && path[path.size()-1] != '/') path += \"/\";\n  \t\tif(binary_paths.count(path) == 0) {\n  \t\t\tbinary_paths.insert(path);\n  \t\t\tpaths_.push_back(path);\n  \t\t}\n  \t}\n  }\n}"
  },
  {
    "function_name": "~binary_paths_manager",
    "container": "binary_paths_manager",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
    "lines": "853-856",
    "snippet": "binary_paths_manager::~binary_paths_manager()\n{\n\tcleanup();\n}",
    "includes": [
      "#include <CoreFoundation/CFBase.h>",
      "#include <CoreFoundation/CFString.h>",
      "#include <CoreFoundation/CoreFoundation.h>",
      "#include <boost/foreach.hpp>",
      "#include \"version.hpp\"",
      "#include \"serialization/unicode.hpp\"",
      "#include \"serialization/string_utils.hpp\"",
      "#include \"scoped_resource.hpp\"",
      "#include \"log.hpp\"",
      "#include \"game_preferences.hpp\"",
      "#include \"game_config.hpp\"",
      "#include \"filesystem.hpp\"",
      "#include \"config.hpp\"",
      "#include <cstring>",
      "#include <boost/algorithm/string.hpp>",
      "#include <set>",
      "#include <iomanip>",
      "#include <fstream>",
      "#include <cerrno>",
      "#include <libgen.h>",
      "#include <dirent.h>",
      "#include <unistd.h>",
      "#include <cctype>",
      "#include \"filesystem_win32.ii\"",
      "#include <sys/stat.h>",
      "#include \"global.hpp\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "cleanup",
          "args": [],
          "line": 855
        },
        "resolved": true,
        "details": {
          "function_name": "cleanup",
          "container": "binary_paths_manager",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
          "lines": "878-885",
          "snippet": "void binary_paths_manager::cleanup()\n{\n\tbinary_paths_cache.clear();\n\n\tfor(std::vector<std::string>::const_iterator i = paths_.begin(); i != paths_.end(); ++i) {\n\t\tbinary_paths.erase(*i);\n\t}\n}",
          "includes": [
            "#include <CoreFoundation/CFBase.h>",
            "#include <CoreFoundation/CFString.h>",
            "#include <CoreFoundation/CoreFoundation.h>",
            "#include <boost/foreach.hpp>",
            "#include \"version.hpp\"",
            "#include \"serialization/unicode.hpp\"",
            "#include \"serialization/string_utils.hpp\"",
            "#include \"scoped_resource.hpp\"",
            "#include \"log.hpp\"",
            "#include \"game_preferences.hpp\"",
            "#include \"game_config.hpp\"",
            "#include \"filesystem.hpp\"",
            "#include \"config.hpp\"",
            "#include <cstring>",
            "#include <boost/algorithm/string.hpp>",
            "#include <set>",
            "#include <iomanip>",
            "#include <fstream>",
            "#include <cerrno>",
            "#include <libgen.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <cctype>",
            "#include \"filesystem_win32.ii\"",
            "#include <sys/stat.h>",
            "#include \"global.hpp\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\nbinary_paths_manager {\n  void binary_paths_manager::cleanup()\n  {\n  \tbinary_paths_cache.clear();\n  \n  \tfor(std::vector<std::string>::const_iterator i = paths_.begin(); i != paths_.end(); ++i) {\n  \t\tbinary_paths.erase(*i);\n  \t}\n  }\n}"
        }
      }
    ],
    "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\nbinary_paths_manager {\n  binary_paths_manager::~binary_paths_manager()\n  {\n  \tcleanup();\n  }\n}"
  },
  {
    "function_name": "binary_paths_manager",
    "container": "binary_paths_manager",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
    "lines": "848-851",
    "snippet": "binary_paths_manager::binary_paths_manager(const config& cfg) : paths_()\n{\n\tset_paths(cfg);\n}",
    "includes": [
      "#include <CoreFoundation/CFBase.h>",
      "#include <CoreFoundation/CFString.h>",
      "#include <CoreFoundation/CoreFoundation.h>",
      "#include <boost/foreach.hpp>",
      "#include \"version.hpp\"",
      "#include \"serialization/unicode.hpp\"",
      "#include \"serialization/string_utils.hpp\"",
      "#include \"scoped_resource.hpp\"",
      "#include \"log.hpp\"",
      "#include \"game_preferences.hpp\"",
      "#include \"game_config.hpp\"",
      "#include \"filesystem.hpp\"",
      "#include \"config.hpp\"",
      "#include <cstring>",
      "#include <boost/algorithm/string.hpp>",
      "#include <set>",
      "#include <iomanip>",
      "#include <fstream>",
      "#include <cerrno>",
      "#include <libgen.h>",
      "#include <dirent.h>",
      "#include <unistd.h>",
      "#include <cctype>",
      "#include \"filesystem_win32.ii\"",
      "#include <sys/stat.h>",
      "#include \"global.hpp\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "set_paths",
          "args": [
            "cfg"
          ],
          "line": 850
        },
        "resolved": true,
        "details": {
          "function_name": "set_paths",
          "container": "binary_paths_manager",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
          "lines": "858-876",
          "snippet": "void binary_paths_manager::set_paths(const config& cfg)\n{\n\tcleanup();\n\tinit_binary_paths();\n\n\tBOOST_FOREACH(const config &bp, cfg.child_range(\"binary_path\"))\n\t{\n\t\tstd::string path = bp[\"path\"].str();\n\t\tif (path.find(\"..\") != std::string::npos) {\n\t\t\tERR_FS << \"Invalid binary path '\" << path << \"'\" << std::endl;\n\t\t\tcontinue;\n\t\t}\n\t\tif (!path.empty() && path[path.size()-1] != '/') path += \"/\";\n\t\tif(binary_paths.count(path) == 0) {\n\t\t\tbinary_paths.insert(path);\n\t\t\tpaths_.push_back(path);\n\t\t}\n\t}\n}",
          "includes": [
            "#include <CoreFoundation/CFBase.h>",
            "#include <CoreFoundation/CFString.h>",
            "#include <CoreFoundation/CoreFoundation.h>",
            "#include <boost/foreach.hpp>",
            "#include \"version.hpp\"",
            "#include \"serialization/unicode.hpp\"",
            "#include \"serialization/string_utils.hpp\"",
            "#include \"scoped_resource.hpp\"",
            "#include \"log.hpp\"",
            "#include \"game_preferences.hpp\"",
            "#include \"game_config.hpp\"",
            "#include \"filesystem.hpp\"",
            "#include \"config.hpp\"",
            "#include <cstring>",
            "#include <boost/algorithm/string.hpp>",
            "#include <set>",
            "#include <iomanip>",
            "#include <fstream>",
            "#include <cerrno>",
            "#include <libgen.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <cctype>",
            "#include \"filesystem_win32.ii\"",
            "#include <sys/stat.h>",
            "#include \"global.hpp\""
          ],
          "macros_used": [
            "#define ERR_FS LOG_STREAM(err, log_filesystem)"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\n#define ERR_FS LOG_STREAM(err, log_filesystem)\n\nbinary_paths_manager {\n  void binary_paths_manager::set_paths(const config& cfg)\n  {\n  \tcleanup();\n  \tinit_binary_paths();\n  \n  \tBOOST_FOREACH(const config &bp, cfg.child_range(\"binary_path\"))\n  \t{\n  \t\tstd::string path = bp[\"path\"].str();\n  \t\tif (path.find(\"..\") != std::string::npos) {\n  \t\t\tERR_FS << \"Invalid binary path '\" << path << \"'\" << std::endl;\n  \t\t\tcontinue;\n  \t\t}\n  \t\tif (!path.empty() && path[path.size()-1] != '/') path += \"/\";\n  \t\tif(binary_paths.count(path) == 0) {\n  \t\t\tbinary_paths.insert(path);\n  \t\t\tpaths_.push_back(path);\n  \t\t}\n  \t}\n  }\n}"
        }
      }
    ],
    "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\nbinary_paths_manager {\n  binary_paths_manager::binary_paths_manager(const config& cfg) : paths_()\n  {\n  \tset_paths(cfg);\n  }\n}"
  },
  {
    "function_name": "binary_paths_manager",
    "container": "binary_paths_manager",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
    "lines": "845-846",
    "snippet": "binary_paths_manager::binary_paths_manager() : paths_()\n{}",
    "includes": [
      "#include <CoreFoundation/CFBase.h>",
      "#include <CoreFoundation/CFString.h>",
      "#include <CoreFoundation/CoreFoundation.h>",
      "#include <boost/foreach.hpp>",
      "#include \"version.hpp\"",
      "#include \"serialization/unicode.hpp\"",
      "#include \"serialization/string_utils.hpp\"",
      "#include \"scoped_resource.hpp\"",
      "#include \"log.hpp\"",
      "#include \"game_preferences.hpp\"",
      "#include \"game_config.hpp\"",
      "#include \"filesystem.hpp\"",
      "#include \"config.hpp\"",
      "#include <cstring>",
      "#include <boost/algorithm/string.hpp>",
      "#include <set>",
      "#include <iomanip>",
      "#include <fstream>",
      "#include <cerrno>",
      "#include <libgen.h>",
      "#include <dirent.h>",
      "#include <unistd.h>",
      "#include <cctype>",
      "#include \"filesystem_win32.ii\"",
      "#include <sys/stat.h>",
      "#include \"global.hpp\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\nbinary_paths_manager {\n  binary_paths_manager::binary_paths_manager() : paths_()\n  {}\n}"
  },
  {
    "function_name": "init_binary_paths",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
    "lines": "838-843",
    "snippet": "static void init_binary_paths()\n{\n\tif(binary_paths.empty()) {\n\t\tbinary_paths.insert(\"\");\n\t}\n}",
    "includes": [
      "#include <CoreFoundation/CFBase.h>",
      "#include <CoreFoundation/CFString.h>",
      "#include <CoreFoundation/CoreFoundation.h>",
      "#include <boost/foreach.hpp>",
      "#include \"version.hpp\"",
      "#include \"serialization/unicode.hpp\"",
      "#include \"serialization/string_utils.hpp\"",
      "#include \"scoped_resource.hpp\"",
      "#include \"log.hpp\"",
      "#include \"game_preferences.hpp\"",
      "#include \"game_config.hpp\"",
      "#include \"filesystem.hpp\"",
      "#include \"config.hpp\"",
      "#include <cstring>",
      "#include <boost/algorithm/string.hpp>",
      "#include <set>",
      "#include <iomanip>",
      "#include <fstream>",
      "#include <cerrno>",
      "#include <libgen.h>",
      "#include <dirent.h>",
      "#include <unistd.h>",
      "#include <cctype>",
      "#include \"filesystem_win32.ii\"",
      "#include <sys/stat.h>",
      "#include \"global.hpp\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "binary_paths.insert",
          "args": [
            "\"\""
          ],
          "line": 841
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "binary_paths.empty",
          "args": [],
          "line": 840
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\nstatic void init_binary_paths()\n{\n\tif(binary_paths.empty()) {\n\t\tbinary_paths.insert(\"\");\n\t}\n}"
  },
  {
    "function_name": "directory_name",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
    "lines": "812-827",
    "snippet": "std::string directory_name(const std::string& file)\n// Analogous to POSIX dirname(3), but for C++ string-object pathnames\n{\n#ifdef _WIN32\n\tstatic const std::string dir_separators = \"\\\\/:\";\n#else\n\tstatic const std::string dir_separators = \"/\";\n#endif\n\n\tstd::string::size_type pos = file.find_last_of(dir_separators);\n\n\tif(pos == std::string::npos)\n\t\treturn \"\";\n\n\treturn file.substr(0,pos+1);\n}",
    "includes": [
      "#include <CoreFoundation/CFBase.h>",
      "#include <CoreFoundation/CFString.h>",
      "#include <CoreFoundation/CoreFoundation.h>",
      "#include <boost/foreach.hpp>",
      "#include \"version.hpp\"",
      "#include \"serialization/unicode.hpp\"",
      "#include \"serialization/string_utils.hpp\"",
      "#include \"scoped_resource.hpp\"",
      "#include \"log.hpp\"",
      "#include \"game_preferences.hpp\"",
      "#include \"game_config.hpp\"",
      "#include \"filesystem.hpp\"",
      "#include \"config.hpp\"",
      "#include <cstring>",
      "#include <boost/algorithm/string.hpp>",
      "#include <set>",
      "#include <iomanip>",
      "#include <fstream>",
      "#include <cerrno>",
      "#include <libgen.h>",
      "#include <dirent.h>",
      "#include <unistd.h>",
      "#include <cctype>",
      "#include \"filesystem_win32.ii\"",
      "#include <sys/stat.h>",
      "#include \"global.hpp\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "file.substr",
          "args": [
            "0",
            "pos+1"
          ],
          "line": 826
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "file.find_last_of",
          "args": [
            "dir_separators"
          ],
          "line": 821
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\nstd::string directory_name(const std::string& file)\n// Analogous to POSIX dirname(3), but for C++ string-object pathnames\n{\n#ifdef _WIN32\n\tstatic const std::string dir_separators = \"\\\\/:\";\n#else\n\tstatic const std::string dir_separators = \"/\";\n#endif\n\n\tstd::string::size_type pos = file.find_last_of(dir_separators);\n\n\tif(pos == std::string::npos)\n\t\treturn \"\";\n\n\treturn file.substr(0,pos+1);\n}"
  },
  {
    "function_name": "base_name",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
    "lines": "793-810",
    "snippet": "std::string base_name(const std::string& file)\n// Analogous to POSIX basename(3), but for C++ string-object pathnames\n{\n#ifdef _WIN32\n\tstatic const std::string dir_separators = \"\\\\/:\";\n#else\n\tstatic const std::string dir_separators = \"/\";\n#endif\n\n\tstd::string::size_type pos = file.find_last_of(dir_separators);\n\n\tif(pos == std::string::npos)\n\t\treturn file;\n\tif(pos >= file.size()-1)\n\t\treturn \"\";\n\n\treturn file.substr(pos+1);\n}",
    "includes": [
      "#include <CoreFoundation/CFBase.h>",
      "#include <CoreFoundation/CFString.h>",
      "#include <CoreFoundation/CoreFoundation.h>",
      "#include <boost/foreach.hpp>",
      "#include \"version.hpp\"",
      "#include \"serialization/unicode.hpp\"",
      "#include \"serialization/string_utils.hpp\"",
      "#include \"scoped_resource.hpp\"",
      "#include \"log.hpp\"",
      "#include \"game_preferences.hpp\"",
      "#include \"game_config.hpp\"",
      "#include \"filesystem.hpp\"",
      "#include \"config.hpp\"",
      "#include <cstring>",
      "#include <boost/algorithm/string.hpp>",
      "#include <set>",
      "#include <iomanip>",
      "#include <fstream>",
      "#include <cerrno>",
      "#include <libgen.h>",
      "#include <dirent.h>",
      "#include <unistd.h>",
      "#include <cctype>",
      "#include \"filesystem_win32.ii\"",
      "#include <sys/stat.h>",
      "#include \"global.hpp\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "file.substr",
          "args": [
            "pos+1"
          ],
          "line": 809
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "file.size",
          "args": [],
          "line": 806
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "file.find_last_of",
          "args": [
            "dir_separators"
          ],
          "line": 802
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\nstd::string base_name(const std::string& file)\n// Analogous to POSIX basename(3), but for C++ string-object pathnames\n{\n#ifdef _WIN32\n\tstatic const std::string dir_separators = \"\\\\/:\";\n#else\n\tstatic const std::string dir_separators = \"/\";\n#endif\n\n\tstd::string::size_type pos = file.find_last_of(dir_separators);\n\n\tif(pos == std::string::npos)\n\t\treturn file;\n\tif(pos >= file.size()-1)\n\t\treturn \"\";\n\n\treturn file.substr(pos+1);\n}"
  },
  {
    "function_name": "dir_size",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
    "lines": "772-791",
    "snippet": "int dir_size(const std::string& path)\n{\n\tstd::vector<std::string> files, dirs;\n\tget_files_in_dir(path, &files, &dirs, ENTIRE_FILE_PATH);\n\n\tint res = 0;\n\n\tBOOST_FOREACH(const std::string& file_path, files)\n\t{\n\t\tres += file_size(file_path);\n\t}\n\n\tBOOST_FOREACH(const std::string& dir_path, dirs)\n\t{\n\t\t// FIXME: this could result in infinite recursion with symlinks!!\n\t\tres += dir_size(dir_path);\n\t}\n\n\treturn res;\n}",
    "includes": [
      "#include <CoreFoundation/CFBase.h>",
      "#include <CoreFoundation/CFString.h>",
      "#include <CoreFoundation/CoreFoundation.h>",
      "#include <boost/foreach.hpp>",
      "#include \"version.hpp\"",
      "#include \"serialization/unicode.hpp\"",
      "#include \"serialization/string_utils.hpp\"",
      "#include \"scoped_resource.hpp\"",
      "#include \"log.hpp\"",
      "#include \"game_preferences.hpp\"",
      "#include \"game_config.hpp\"",
      "#include \"filesystem.hpp\"",
      "#include \"config.hpp\"",
      "#include <cstring>",
      "#include <boost/algorithm/string.hpp>",
      "#include <set>",
      "#include <iomanip>",
      "#include <fstream>",
      "#include <cerrno>",
      "#include <libgen.h>",
      "#include <dirent.h>",
      "#include <unistd.h>",
      "#include <cctype>",
      "#include \"filesystem_win32.ii\"",
      "#include <sys/stat.h>",
      "#include \"global.hpp\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dir_size",
          "args": [
            "dir_path"
          ],
          "line": 787
        },
        "resolved": true,
        "details": {
          "function_name": "dir_size",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
          "lines": "772-791",
          "snippet": "int dir_size(const std::string& path)\n{\n\tstd::vector<std::string> files, dirs;\n\tget_files_in_dir(path, &files, &dirs, ENTIRE_FILE_PATH);\n\n\tint res = 0;\n\n\tBOOST_FOREACH(const std::string& file_path, files)\n\t{\n\t\tres += file_size(file_path);\n\t}\n\n\tBOOST_FOREACH(const std::string& dir_path, dirs)\n\t{\n\t\t// FIXME: this could result in infinite recursion with symlinks!!\n\t\tres += dir_size(dir_path);\n\t}\n\n\treturn res;\n}",
          "note": "cyclic_reference_detected"
        }
      },
      {
        "call_info": {
          "callee": "file_size",
          "args": [
            "file_path"
          ],
          "line": 781
        },
        "resolved": true,
        "details": {
          "function_name": "file_size",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
          "lines": "763-770",
          "snippet": "int file_size(const std::string& fname)\n{\n\tstruct stat buf;\n\tif(::stat(fname.c_str(),&buf) == -1)\n\t\treturn -1;\n\n\treturn buf.st_size;\n}",
          "includes": [
            "#include <CoreFoundation/CFBase.h>",
            "#include <CoreFoundation/CFString.h>",
            "#include <CoreFoundation/CoreFoundation.h>",
            "#include <boost/foreach.hpp>",
            "#include \"version.hpp\"",
            "#include \"serialization/unicode.hpp\"",
            "#include \"serialization/string_utils.hpp\"",
            "#include \"scoped_resource.hpp\"",
            "#include \"log.hpp\"",
            "#include \"game_preferences.hpp\"",
            "#include \"game_config.hpp\"",
            "#include \"filesystem.hpp\"",
            "#include \"config.hpp\"",
            "#include <cstring>",
            "#include <boost/algorithm/string.hpp>",
            "#include <set>",
            "#include <iomanip>",
            "#include <fstream>",
            "#include <cerrno>",
            "#include <libgen.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <cctype>",
            "#include \"filesystem_win32.ii\"",
            "#include <sys/stat.h>",
            "#include \"global.hpp\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\nint file_size(const std::string& fname)\n{\n\tstruct stat buf;\n\tif(::stat(fname.c_str(),&buf) == -1)\n\t\treturn -1;\n\n\treturn buf.st_size;\n}"
        }
      },
      {
        "call_info": {
          "callee": "get_files_in_dir",
          "args": [
            "path",
            "&files",
            "&dirs",
            "ENTIRE_FILE_PATH"
          ],
          "line": 775
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\nint dir_size(const std::string& path)\n{\n\tstd::vector<std::string> files, dirs;\n\tget_files_in_dir(path, &files, &dirs, ENTIRE_FILE_PATH);\n\n\tint res = 0;\n\n\tBOOST_FOREACH(const std::string& file_path, files)\n\t{\n\t\tres += file_size(file_path);\n\t}\n\n\tBOOST_FOREACH(const std::string& dir_path, dirs)\n\t{\n\t\t// FIXME: this could result in infinite recursion with symlinks!!\n\t\tres += dir_size(dir_path);\n\t}\n\n\treturn res;\n}"
  },
  {
    "function_name": "file_size",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
    "lines": "763-770",
    "snippet": "int file_size(const std::string& fname)\n{\n\tstruct stat buf;\n\tif(::stat(fname.c_str(),&buf) == -1)\n\t\treturn -1;\n\n\treturn buf.st_size;\n}",
    "includes": [
      "#include <CoreFoundation/CFBase.h>",
      "#include <CoreFoundation/CFString.h>",
      "#include <CoreFoundation/CoreFoundation.h>",
      "#include <boost/foreach.hpp>",
      "#include \"version.hpp\"",
      "#include \"serialization/unicode.hpp\"",
      "#include \"serialization/string_utils.hpp\"",
      "#include \"scoped_resource.hpp\"",
      "#include \"log.hpp\"",
      "#include \"game_preferences.hpp\"",
      "#include \"game_config.hpp\"",
      "#include \"filesystem.hpp\"",
      "#include \"config.hpp\"",
      "#include <cstring>",
      "#include <boost/algorithm/string.hpp>",
      "#include <set>",
      "#include <iomanip>",
      "#include <fstream>",
      "#include <cerrno>",
      "#include <libgen.h>",
      "#include <dirent.h>",
      "#include <unistd.h>",
      "#include <cctype>",
      "#include \"filesystem_win32.ii\"",
      "#include <sys/stat.h>",
      "#include \"global.hpp\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "::stat",
          "args": [
            "fname.c_str()",
            "&buf"
          ],
          "line": 766
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fname.c_str",
          "args": [],
          "line": 766
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\nint file_size(const std::string& fname)\n{\n\tstruct stat buf;\n\tif(::stat(fname.c_str(),&buf) == -1)\n\t\treturn -1;\n\n\treturn buf.st_size;\n}"
  },
  {
    "function_name": "is_bzip2_file",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
    "lines": "757-761",
    "snippet": "bool is_bzip2_file(const std::string& filename)\n{\n\treturn (filename.length() > 4\n\t\t&& filename.substr(filename.length() - 4) == \".bz2\");\n}",
    "includes": [
      "#include <CoreFoundation/CFBase.h>",
      "#include <CoreFoundation/CFString.h>",
      "#include <CoreFoundation/CoreFoundation.h>",
      "#include <boost/foreach.hpp>",
      "#include \"version.hpp\"",
      "#include \"serialization/unicode.hpp\"",
      "#include \"serialization/string_utils.hpp\"",
      "#include \"scoped_resource.hpp\"",
      "#include \"log.hpp\"",
      "#include \"game_preferences.hpp\"",
      "#include \"game_config.hpp\"",
      "#include \"filesystem.hpp\"",
      "#include \"config.hpp\"",
      "#include <cstring>",
      "#include <boost/algorithm/string.hpp>",
      "#include <set>",
      "#include <iomanip>",
      "#include <fstream>",
      "#include <cerrno>",
      "#include <libgen.h>",
      "#include <dirent.h>",
      "#include <unistd.h>",
      "#include <cctype>",
      "#include \"filesystem_win32.ii\"",
      "#include <sys/stat.h>",
      "#include \"global.hpp\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "filename.substr",
          "args": [
            "filename.length() - 4"
          ],
          "line": 760
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "filename.length",
          "args": [],
          "line": 760
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "filename.length",
          "args": [],
          "line": 759
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\nbool is_bzip2_file(const std::string& filename)\n{\n\treturn (filename.length() > 4\n\t\t&& filename.substr(filename.length() - 4) == \".bz2\");\n}"
  },
  {
    "function_name": "is_gzip_file",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
    "lines": "746-750",
    "snippet": "bool is_gzip_file(const std::string& filename)\n{\n\treturn (filename.length() > 3\n\t\t&& filename.substr(filename.length() - 3) == \".gz\");\n}",
    "includes": [
      "#include <CoreFoundation/CFBase.h>",
      "#include <CoreFoundation/CFString.h>",
      "#include <CoreFoundation/CoreFoundation.h>",
      "#include <boost/foreach.hpp>",
      "#include \"version.hpp\"",
      "#include \"serialization/unicode.hpp\"",
      "#include \"serialization/string_utils.hpp\"",
      "#include \"scoped_resource.hpp\"",
      "#include \"log.hpp\"",
      "#include \"game_preferences.hpp\"",
      "#include \"game_config.hpp\"",
      "#include \"filesystem.hpp\"",
      "#include \"config.hpp\"",
      "#include <cstring>",
      "#include <boost/algorithm/string.hpp>",
      "#include <set>",
      "#include <iomanip>",
      "#include <fstream>",
      "#include <cerrno>",
      "#include <libgen.h>",
      "#include <dirent.h>",
      "#include <unistd.h>",
      "#include <cctype>",
      "#include \"filesystem_win32.ii\"",
      "#include <sys/stat.h>",
      "#include \"global.hpp\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "filename.substr",
          "args": [
            "filename.length() - 3"
          ],
          "line": 749
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "filename.length",
          "args": [],
          "line": 749
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "filename.length",
          "args": [],
          "line": 748
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\nbool is_gzip_file(const std::string& filename)\n{\n\treturn (filename.length() > 3\n\t\t&& filename.substr(filename.length() - 3) == \".gz\");\n}"
  },
  {
    "function_name": "file_modified_time",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
    "lines": "732-739",
    "snippet": "time_t file_modified_time(const std::string& fname)\n{\n\tstruct stat buf;\n\tif(::stat(fname.c_str(),&buf) == -1)\n\t\treturn 0;\n\n\treturn buf.st_mtime;\n}",
    "includes": [
      "#include <CoreFoundation/CFBase.h>",
      "#include <CoreFoundation/CFString.h>",
      "#include <CoreFoundation/CoreFoundation.h>",
      "#include <boost/foreach.hpp>",
      "#include \"version.hpp\"",
      "#include \"serialization/unicode.hpp\"",
      "#include \"serialization/string_utils.hpp\"",
      "#include \"scoped_resource.hpp\"",
      "#include \"log.hpp\"",
      "#include \"game_preferences.hpp\"",
      "#include \"game_config.hpp\"",
      "#include \"filesystem.hpp\"",
      "#include \"config.hpp\"",
      "#include <cstring>",
      "#include <boost/algorithm/string.hpp>",
      "#include <set>",
      "#include <iomanip>",
      "#include <fstream>",
      "#include <cerrno>",
      "#include <libgen.h>",
      "#include <dirent.h>",
      "#include <unistd.h>",
      "#include <cctype>",
      "#include \"filesystem_win32.ii\"",
      "#include <sys/stat.h>",
      "#include \"global.hpp\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "::stat",
          "args": [
            "fname.c_str()",
            "&buf"
          ],
          "line": 735
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fname.c_str",
          "args": [],
          "line": 735
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\ntime_t file_modified_time(const std::string& fname)\n{\n\tstruct stat buf;\n\tif(::stat(fname.c_str(),&buf) == -1)\n\t\treturn 0;\n\n\treturn buf.st_mtime;\n}"
  },
  {
    "function_name": "file_exists",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
    "lines": "721-730",
    "snippet": "bool file_exists(const std::string& name)\n{\n#ifdef _WIN32\n       struct stat st;\n       return (::stat(name.c_str(), &st) == 0);\n#else\n\tstruct stat st;\n\treturn (::stat(name.c_str(), &st) != -1);\n#endif\n}",
    "includes": [
      "#include <CoreFoundation/CFBase.h>",
      "#include <CoreFoundation/CFString.h>",
      "#include <CoreFoundation/CoreFoundation.h>",
      "#include <boost/foreach.hpp>",
      "#include \"version.hpp\"",
      "#include \"serialization/unicode.hpp\"",
      "#include \"serialization/string_utils.hpp\"",
      "#include \"scoped_resource.hpp\"",
      "#include \"log.hpp\"",
      "#include \"game_preferences.hpp\"",
      "#include \"game_config.hpp\"",
      "#include \"filesystem.hpp\"",
      "#include \"config.hpp\"",
      "#include <cstring>",
      "#include <boost/algorithm/string.hpp>",
      "#include <set>",
      "#include <iomanip>",
      "#include <fstream>",
      "#include <cerrno>",
      "#include <libgen.h>",
      "#include <dirent.h>",
      "#include <unistd.h>",
      "#include <cctype>",
      "#include \"filesystem_win32.ii\"",
      "#include <sys/stat.h>",
      "#include \"global.hpp\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "::stat",
          "args": [
            "name.c_str()",
            "&st"
          ],
          "line": 728
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "name.c_str",
          "args": [],
          "line": 728
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "::stat",
          "args": [
            "name.c_str()",
            "&st"
          ],
          "line": 725
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "name.c_str",
          "args": [],
          "line": 725
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\nbool file_exists(const std::string& name)\n{\n#ifdef _WIN32\n       struct stat st;\n       return (::stat(name.c_str(), &st) == 0);\n#else\n\tstruct stat st;\n\treturn (::stat(name.c_str(), &st) != -1);\n#endif\n}"
  },
  {
    "function_name": "is_directory",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
    "lines": "708-719",
    "snippet": "bool is_directory(const std::string& fname)\n{\n\tif(fname.empty()) {\n\t\treturn false;\n\t}\n\tif(fname[0] != '/' && !game_config::path.empty()) {\n\t\tif(is_directory_internal(game_config::path + \"/\" + fname))\n\t\t\treturn true;\n\t}\n\n\treturn is_directory_internal(fname);\n}",
    "includes": [
      "#include <CoreFoundation/CFBase.h>",
      "#include <CoreFoundation/CFString.h>",
      "#include <CoreFoundation/CoreFoundation.h>",
      "#include <boost/foreach.hpp>",
      "#include \"version.hpp\"",
      "#include \"serialization/unicode.hpp\"",
      "#include \"serialization/string_utils.hpp\"",
      "#include \"scoped_resource.hpp\"",
      "#include \"log.hpp\"",
      "#include \"game_preferences.hpp\"",
      "#include \"game_config.hpp\"",
      "#include \"filesystem.hpp\"",
      "#include \"config.hpp\"",
      "#include <cstring>",
      "#include <boost/algorithm/string.hpp>",
      "#include <set>",
      "#include <iomanip>",
      "#include <fstream>",
      "#include <cerrno>",
      "#include <libgen.h>",
      "#include <dirent.h>",
      "#include <unistd.h>",
      "#include <cctype>",
      "#include \"filesystem_win32.ii\"",
      "#include <sys/stat.h>",
      "#include \"global.hpp\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "is_directory_internal",
          "args": [
            "fname"
          ],
          "line": 718
        },
        "resolved": true,
        "details": {
          "function_name": "is_directory_internal",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
          "lines": "687-706",
          "snippet": "static bool is_directory_internal(const std::string& fname)\n{\n#ifdef _WIN32\n\t_finddata_t info;\n\tconst long handle = _findfirst((fname + \"/*\").c_str(),&info);\n\tif(handle >= 0) {\n\t\t_findclose(handle);\n\t\treturn true;\n\t} else {\n\t\treturn false;\n\t}\n\n#else\n\tstruct stat dir_stat;\n\tif(::stat(fname.c_str(), &dir_stat) == -1) {\n\t\treturn false;\n\t}\n\treturn S_ISDIR(dir_stat.st_mode);\n#endif\n}",
          "includes": [
            "#include <CoreFoundation/CFBase.h>",
            "#include <CoreFoundation/CFString.h>",
            "#include <CoreFoundation/CoreFoundation.h>",
            "#include <boost/foreach.hpp>",
            "#include \"version.hpp\"",
            "#include \"serialization/unicode.hpp\"",
            "#include \"serialization/string_utils.hpp\"",
            "#include \"scoped_resource.hpp\"",
            "#include \"log.hpp\"",
            "#include \"game_preferences.hpp\"",
            "#include \"game_config.hpp\"",
            "#include \"filesystem.hpp\"",
            "#include \"config.hpp\"",
            "#include <cstring>",
            "#include <boost/algorithm/string.hpp>",
            "#include <set>",
            "#include <iomanip>",
            "#include <fstream>",
            "#include <cerrno>",
            "#include <libgen.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <cctype>",
            "#include \"filesystem_win32.ii\"",
            "#include <sys/stat.h>",
            "#include \"global.hpp\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\nstatic bool is_directory_internal(const std::string& fname)\n{\n#ifdef _WIN32\n\t_finddata_t info;\n\tconst long handle = _findfirst((fname + \"/*\").c_str(),&info);\n\tif(handle >= 0) {\n\t\t_findclose(handle);\n\t\treturn true;\n\t} else {\n\t\treturn false;\n\t}\n\n#else\n\tstruct stat dir_stat;\n\tif(::stat(fname.c_str(), &dir_stat) == -1) {\n\t\treturn false;\n\t}\n\treturn S_ISDIR(dir_stat.st_mode);\n#endif\n}"
        }
      },
      {
        "call_info": {
          "callee": "game_config::path.empty",
          "args": [],
          "line": 713
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fname.empty",
          "args": [],
          "line": 710
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\nbool is_directory(const std::string& fname)\n{\n\tif(fname.empty()) {\n\t\treturn false;\n\t}\n\tif(fname[0] != '/' && !game_config::path.empty()) {\n\t\tif(is_directory_internal(game_config::path + \"/\" + fname))\n\t\t\treturn true;\n\t}\n\n\treturn is_directory_internal(fname);\n}"
  },
  {
    "function_name": "is_directory_internal",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
    "lines": "687-706",
    "snippet": "static bool is_directory_internal(const std::string& fname)\n{\n#ifdef _WIN32\n\t_finddata_t info;\n\tconst long handle = _findfirst((fname + \"/*\").c_str(),&info);\n\tif(handle >= 0) {\n\t\t_findclose(handle);\n\t\treturn true;\n\t} else {\n\t\treturn false;\n\t}\n\n#else\n\tstruct stat dir_stat;\n\tif(::stat(fname.c_str(), &dir_stat) == -1) {\n\t\treturn false;\n\t}\n\treturn S_ISDIR(dir_stat.st_mode);\n#endif\n}",
    "includes": [
      "#include <CoreFoundation/CFBase.h>",
      "#include <CoreFoundation/CFString.h>",
      "#include <CoreFoundation/CoreFoundation.h>",
      "#include <boost/foreach.hpp>",
      "#include \"version.hpp\"",
      "#include \"serialization/unicode.hpp\"",
      "#include \"serialization/string_utils.hpp\"",
      "#include \"scoped_resource.hpp\"",
      "#include \"log.hpp\"",
      "#include \"game_preferences.hpp\"",
      "#include \"game_config.hpp\"",
      "#include \"filesystem.hpp\"",
      "#include \"config.hpp\"",
      "#include <cstring>",
      "#include <boost/algorithm/string.hpp>",
      "#include <set>",
      "#include <iomanip>",
      "#include <fstream>",
      "#include <cerrno>",
      "#include <libgen.h>",
      "#include <dirent.h>",
      "#include <unistd.h>",
      "#include <cctype>",
      "#include \"filesystem_win32.ii\"",
      "#include <sys/stat.h>",
      "#include \"global.hpp\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "S_ISDIR",
          "args": [
            "dir_stat.st_mode"
          ],
          "line": 704
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "::stat",
          "args": [
            "fname.c_str()",
            "&dir_stat"
          ],
          "line": 701
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fname.c_str",
          "args": [],
          "line": 701
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_findclose",
          "args": [
            "handle"
          ],
          "line": 693
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_findfirst",
          "args": [
            "(fname + \"/*\").c_str()",
            "&info"
          ],
          "line": 691
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "",
          "args": [],
          "line": 691
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\nstatic bool is_directory_internal(const std::string& fname)\n{\n#ifdef _WIN32\n\t_finddata_t info;\n\tconst long handle = _findfirst((fname + \"/*\").c_str(),&info);\n\tif(handle >= 0) {\n\t\t_findclose(handle);\n\t\treturn true;\n\t} else {\n\t\treturn false;\n\t}\n\n#else\n\tstruct stat dir_stat;\n\tif(::stat(fname.c_str(), &dir_stat) == -1) {\n\t\treturn false;\n\t}\n\treturn S_ISDIR(dir_stat.st_mode);\n#endif\n}"
  },
  {
    "function_name": "write_file",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
    "lines": "666-685",
    "snippet": "void write_file(const std::string& fname, const std::string& data)\n{\n\t//const util::scoped_resource<FILE*,close_FILE> file(fopen(fname.c_str(),\"wb\"));\n\tconst util::scoped_FILE file(fopen(fname.c_str(),\"wb\"));\n\tif(file.get() == NULL) {\n\t\tthrow io_exception(\"Could not open file for writing: '\" + fname + \"'\");\n\t}\n\n\tconst size_t block_size = 4096;\n\tchar buf[block_size];\n\n\tfor(size_t i = 0; i < data.size(); i += block_size) {\n\t\tconst size_t bytes = std::min<size_t>(block_size,data.size() - i);\n\t\tstd::copy(data.begin() + i, data.begin() + i + bytes,buf);\n\t\tconst size_t res = fwrite(buf,1,bytes,file.get());\n\t\tif(res != bytes) {\n\t\t\tthrow io_exception(\"Error writing to file: '\" + fname + \"'\");\n\t\t}\n\t}\n}",
    "includes": [
      "#include <CoreFoundation/CFBase.h>",
      "#include <CoreFoundation/CFString.h>",
      "#include <CoreFoundation/CoreFoundation.h>",
      "#include <boost/foreach.hpp>",
      "#include \"version.hpp\"",
      "#include \"serialization/unicode.hpp\"",
      "#include \"serialization/string_utils.hpp\"",
      "#include \"scoped_resource.hpp\"",
      "#include \"log.hpp\"",
      "#include \"game_preferences.hpp\"",
      "#include \"game_config.hpp\"",
      "#include \"filesystem.hpp\"",
      "#include \"config.hpp\"",
      "#include <cstring>",
      "#include <boost/algorithm/string.hpp>",
      "#include <set>",
      "#include <iomanip>",
      "#include <fstream>",
      "#include <cerrno>",
      "#include <libgen.h>",
      "#include <dirent.h>",
      "#include <unistd.h>",
      "#include <cctype>",
      "#include \"filesystem_win32.ii\"",
      "#include <sys/stat.h>",
      "#include \"global.hpp\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "io_exception",
          "args": [
            "\"Error writing to file: '\" + fname + \"'\""
          ],
          "line": 682
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fwrite",
          "args": [
            "buf",
            "1",
            "bytes",
            "file.get()"
          ],
          "line": 680
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "file.get",
          "args": [],
          "line": 680
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "std::copy",
          "args": [
            "data.begin() + i",
            "data.begin() + i + bytes",
            "buf"
          ],
          "line": 679
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "data.begin",
          "args": [],
          "line": 679
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "data.begin",
          "args": [],
          "line": 679
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "std::min<size_t>",
          "args": [
            "block_size",
            "data.size() - i"
          ],
          "line": 678
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "data.size",
          "args": [],
          "line": 678
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "data.size",
          "args": [],
          "line": 677
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "io_exception",
          "args": [
            "\"Could not open file for writing: '\" + fname + \"'\""
          ],
          "line": 671
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "file.get",
          "args": [],
          "line": 670
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fopen",
          "args": [
            "fname.c_str()",
            "\"wb\""
          ],
          "line": 669
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fname.c_str",
          "args": [],
          "line": 669
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\nvoid write_file(const std::string& fname, const std::string& data)\n{\n\t//const util::scoped_resource<FILE*,close_FILE> file(fopen(fname.c_str(),\"wb\"));\n\tconst util::scoped_FILE file(fopen(fname.c_str(),\"wb\"));\n\tif(file.get() == NULL) {\n\t\tthrow io_exception(\"Could not open file for writing: '\" + fname + \"'\");\n\t}\n\n\tconst size_t block_size = 4096;\n\tchar buf[block_size];\n\n\tfor(size_t i = 0; i < data.size(); i += block_size) {\n\t\tconst size_t bytes = std::min<size_t>(block_size,data.size() - i);\n\t\tstd::copy(data.begin() + i, data.begin() + i + bytes,buf);\n\t\tconst size_t res = fwrite(buf,1,bytes,file.get());\n\t\tif(res != bytes) {\n\t\t\tthrow io_exception(\"Error writing to file: '\" + fname + \"'\");\n\t\t}\n\t}\n}"
  },
  {
    "function_name": "read_file",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
    "lines": "653-657",
    "snippet": "std::string read_file(const std::string &fname)\n{\n\tscoped_istream s = istream_file(fname);\n\treturn read_stream(*s);\n}",
    "includes": [
      "#include <CoreFoundation/CFBase.h>",
      "#include <CoreFoundation/CFString.h>",
      "#include <CoreFoundation/CoreFoundation.h>",
      "#include <boost/foreach.hpp>",
      "#include \"version.hpp\"",
      "#include \"serialization/unicode.hpp\"",
      "#include \"serialization/string_utils.hpp\"",
      "#include \"scoped_resource.hpp\"",
      "#include \"log.hpp\"",
      "#include \"game_preferences.hpp\"",
      "#include \"game_config.hpp\"",
      "#include \"filesystem.hpp\"",
      "#include \"config.hpp\"",
      "#include <cstring>",
      "#include <boost/algorithm/string.hpp>",
      "#include <set>",
      "#include <iomanip>",
      "#include <fstream>",
      "#include <cerrno>",
      "#include <libgen.h>",
      "#include <dirent.h>",
      "#include <unistd.h>",
      "#include <cctype>",
      "#include \"filesystem_win32.ii\"",
      "#include <sys/stat.h>",
      "#include \"global.hpp\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "read_stream",
          "args": [
            "*s"
          ],
          "line": 656
        },
        "resolved": true,
        "details": {
          "function_name": "read_stream",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
          "lines": "622-627",
          "snippet": "static std::string read_stream(std::istream& s)\n{\n\tstd::stringstream ss;\n\tss << s.rdbuf();\n\treturn ss.str();\n}",
          "includes": [
            "#include <CoreFoundation/CFBase.h>",
            "#include <CoreFoundation/CFString.h>",
            "#include <CoreFoundation/CoreFoundation.h>",
            "#include <boost/foreach.hpp>",
            "#include \"version.hpp\"",
            "#include \"serialization/unicode.hpp\"",
            "#include \"serialization/string_utils.hpp\"",
            "#include \"scoped_resource.hpp\"",
            "#include \"log.hpp\"",
            "#include \"game_preferences.hpp\"",
            "#include \"game_config.hpp\"",
            "#include \"filesystem.hpp\"",
            "#include \"config.hpp\"",
            "#include <cstring>",
            "#include <boost/algorithm/string.hpp>",
            "#include <set>",
            "#include <iomanip>",
            "#include <fstream>",
            "#include <cerrno>",
            "#include <libgen.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <cctype>",
            "#include \"filesystem_win32.ii\"",
            "#include <sys/stat.h>",
            "#include \"global.hpp\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\nstatic std::string read_stream(std::istream& s)\n{\n\tstd::stringstream ss;\n\tss << s.rdbuf();\n\treturn ss.str();\n}"
        }
      },
      {
        "call_info": {
          "callee": "istream_file",
          "args": [
            "fname"
          ],
          "line": 655
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\nstd::string read_file(const std::string &fname)\n{\n\tscoped_istream s = istream_file(fname);\n\treturn read_stream(*s);\n}"
  },
  {
    "function_name": "read_stream",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
    "lines": "622-627",
    "snippet": "static std::string read_stream(std::istream& s)\n{\n\tstd::stringstream ss;\n\tss << s.rdbuf();\n\treturn ss.str();\n}",
    "includes": [
      "#include <CoreFoundation/CFBase.h>",
      "#include <CoreFoundation/CFString.h>",
      "#include <CoreFoundation/CoreFoundation.h>",
      "#include <boost/foreach.hpp>",
      "#include \"version.hpp\"",
      "#include \"serialization/unicode.hpp\"",
      "#include \"serialization/string_utils.hpp\"",
      "#include \"scoped_resource.hpp\"",
      "#include \"log.hpp\"",
      "#include \"game_preferences.hpp\"",
      "#include \"game_config.hpp\"",
      "#include \"filesystem.hpp\"",
      "#include \"config.hpp\"",
      "#include <cstring>",
      "#include <boost/algorithm/string.hpp>",
      "#include <set>",
      "#include <iomanip>",
      "#include <fstream>",
      "#include <cerrno>",
      "#include <libgen.h>",
      "#include <dirent.h>",
      "#include <unistd.h>",
      "#include <cctype>",
      "#include \"filesystem_win32.ii\"",
      "#include <sys/stat.h>",
      "#include \"global.hpp\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ss.str",
          "args": [],
          "line": 626
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "s.rdbuf",
          "args": [],
          "line": 625
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\nstatic std::string read_stream(std::istream& s)\n{\n\tstd::stringstream ss;\n\tss << s.rdbuf();\n\treturn ss.str();\n}"
  },
  {
    "function_name": "get_cache_dir",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
    "lines": "598-620",
    "snippet": "std::string get_cache_dir()\n{\n\tif (cache_dir.empty())\n\t{\n#if defined(_X11) && !defined(PREFERENCES_DIR)\n\t\tchar const *xdg_cache = getenv(\"XDG_CACHE_HOME\");\n\t\tif (!xdg_cache || xdg_cache[0] == '\\0') {\n\t\t\txdg_cache = getenv(\"HOME\");\n\t\t\tif (!xdg_cache) {\n\t\t\t\tcache_dir = get_dir(get_user_data_dir() + \"/cache\");\n\t\t\t\treturn cache_dir;\n\t\t\t}\n\t\t\tcache_dir = xdg_cache;\n\t\t\tcache_dir += \"/.cache\";\n\t\t} else cache_dir = xdg_cache;\n\t\tcache_dir += \"/wesnoth\";\n\t\tcreate_directory_if_missing_recursive(cache_dir);\n#else\n\t\tcache_dir = get_dir(get_user_data_dir() + \"/cache\");\n#endif\n\t}\n\treturn cache_dir;\n}",
    "includes": [
      "#include <CoreFoundation/CFBase.h>",
      "#include <CoreFoundation/CFString.h>",
      "#include <CoreFoundation/CoreFoundation.h>",
      "#include <boost/foreach.hpp>",
      "#include \"version.hpp\"",
      "#include \"serialization/unicode.hpp\"",
      "#include \"serialization/string_utils.hpp\"",
      "#include \"scoped_resource.hpp\"",
      "#include \"log.hpp\"",
      "#include \"game_preferences.hpp\"",
      "#include \"game_config.hpp\"",
      "#include \"filesystem.hpp\"",
      "#include \"config.hpp\"",
      "#include <cstring>",
      "#include <boost/algorithm/string.hpp>",
      "#include <set>",
      "#include <iomanip>",
      "#include <fstream>",
      "#include <cerrno>",
      "#include <libgen.h>",
      "#include <dirent.h>",
      "#include <unistd.h>",
      "#include <cctype>",
      "#include \"filesystem_win32.ii\"",
      "#include <sys/stat.h>",
      "#include \"global.hpp\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "get_dir",
          "args": [
            "get_user_data_dir() + \"/cache\""
          ],
          "line": 616
        },
        "resolved": true,
        "details": {
          "function_name": "get_dir",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
          "lines": "267-285",
          "snippet": "std::string get_dir(const std::string& dir_path)\n{\n\tDIR* dir = opendir(dir_path.c_str());\n\tif(dir == NULL) {\n\t\tconst int res = mkdir(dir_path.c_str(),AccessMode);\n\t\tif(res == 0) {\n\t\t\tdir = opendir(dir_path.c_str());\n\t\t} else {\n\t\t\tERR_FS << \"could not open or create directory: \" << dir_path << std::endl;\n\t\t}\n\t}\n\n\tif(dir == NULL)\n\t\treturn \"\";\n\n\tclosedir(dir);\n\n\treturn dir_path;\n}",
          "includes": [
            "#include <CoreFoundation/CFBase.h>",
            "#include <CoreFoundation/CFString.h>",
            "#include <CoreFoundation/CoreFoundation.h>",
            "#include <boost/foreach.hpp>",
            "#include \"version.hpp\"",
            "#include \"serialization/unicode.hpp\"",
            "#include \"serialization/string_utils.hpp\"",
            "#include \"scoped_resource.hpp\"",
            "#include \"log.hpp\"",
            "#include \"game_preferences.hpp\"",
            "#include \"game_config.hpp\"",
            "#include \"filesystem.hpp\"",
            "#include \"config.hpp\"",
            "#include <cstring>",
            "#include <boost/algorithm/string.hpp>",
            "#include <set>",
            "#include <iomanip>",
            "#include <fstream>",
            "#include <cerrno>",
            "#include <libgen.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <cctype>",
            "#include \"filesystem_win32.ii\"",
            "#include <sys/stat.h>",
            "#include \"global.hpp\""
          ],
          "macros_used": [
            "#define ERR_FS LOG_STREAM(err, log_filesystem)"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\n#define ERR_FS LOG_STREAM(err, log_filesystem)\n\nstd::string get_dir(const std::string& dir_path)\n{\n\tDIR* dir = opendir(dir_path.c_str());\n\tif(dir == NULL) {\n\t\tconst int res = mkdir(dir_path.c_str(),AccessMode);\n\t\tif(res == 0) {\n\t\t\tdir = opendir(dir_path.c_str());\n\t\t} else {\n\t\t\tERR_FS << \"could not open or create directory: \" << dir_path << std::endl;\n\t\t}\n\t}\n\n\tif(dir == NULL)\n\t\treturn \"\";\n\n\tclosedir(dir);\n\n\treturn dir_path;\n}"
        }
      },
      {
        "call_info": {
          "callee": "get_user_data_dir",
          "args": [],
          "line": 616
        },
        "resolved": true,
        "details": {
          "function_name": "get_user_data_dir",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
          "lines": "561-571",
          "snippet": "std::string get_user_data_dir()\n{\n\t// ensure setup gets called only once per session\n\t// FIXME: this is okay and optimized, but how should we react\n\t// if the user deletes a dir while we are running?\n\tif (user_data_dir.empty())\n\t{\n\t\tset_user_data_dir(std::string());\n\t}\n\treturn user_data_dir;\n}",
          "includes": [
            "#include <CoreFoundation/CFBase.h>",
            "#include <CoreFoundation/CFString.h>",
            "#include <CoreFoundation/CoreFoundation.h>",
            "#include <boost/foreach.hpp>",
            "#include \"version.hpp\"",
            "#include \"serialization/unicode.hpp\"",
            "#include \"serialization/string_utils.hpp\"",
            "#include \"scoped_resource.hpp\"",
            "#include \"log.hpp\"",
            "#include \"game_preferences.hpp\"",
            "#include \"game_config.hpp\"",
            "#include \"filesystem.hpp\"",
            "#include \"config.hpp\"",
            "#include <cstring>",
            "#include <boost/algorithm/string.hpp>",
            "#include <set>",
            "#include <iomanip>",
            "#include <fstream>",
            "#include <cerrno>",
            "#include <libgen.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <cctype>",
            "#include \"filesystem_win32.ii\"",
            "#include <sys/stat.h>",
            "#include \"global.hpp\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\nstd::string get_user_data_dir()\n{\n\t// ensure setup gets called only once per session\n\t// FIXME: this is okay and optimized, but how should we react\n\t// if the user deletes a dir while we are running?\n\tif (user_data_dir.empty())\n\t{\n\t\tset_user_data_dir(std::string());\n\t}\n\treturn user_data_dir;\n}"
        }
      },
      {
        "call_info": {
          "callee": "create_directory_if_missing_recursive",
          "args": [
            "cache_dir"
          ],
          "line": 614
        },
        "resolved": true,
        "details": {
          "function_name": "create_directory_if_missing_recursive",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
          "lines": "387-416",
          "snippet": "bool create_directory_if_missing_recursive(const std::string& dirname)\n{\n\tDBG_FS<<\"creating recursive directory: \"<<dirname<<'\\n';\n\tif (is_directory(dirname) == false && dirname.empty() == false)\n\t{\n\t\tstd::string tmp_dirname = dirname;\n\t\t// remove trailing slashes or backslashes\n\t\twhile ((tmp_dirname[tmp_dirname.size()-1] == '/' ||\n\t\t\t  tmp_dirname[tmp_dirname.size()-1] == '\\\\') &&\n\t\t\t  !tmp_dirname.empty())\n\t\t{\n\t\t\ttmp_dirname.erase(tmp_dirname.size()-1);\n\t\t}\n\n\t\t// create the first non-existing directory\n\t\tsize_t pos = tmp_dirname.rfind(\"/\");\n\n\t\t// we get the most right directory and *skip* it\n\t\t// we are creating it when we get back here\n\t\tif (tmp_dirname.rfind('\\\\') != std::string::npos &&\n\t\t\ttmp_dirname.rfind('\\\\') > pos )\n\t\t\tpos = tmp_dirname.rfind('\\\\');\n\n\t\tif (pos != std::string::npos)\n\t\t\tcreate_directory_if_missing_recursive(tmp_dirname.substr(0,pos));\n\n\t\treturn create_directory_if_missing(tmp_dirname);\n\t}\n\treturn create_directory_if_missing(dirname);\n}",
          "includes": [
            "#include <CoreFoundation/CFBase.h>",
            "#include <CoreFoundation/CFString.h>",
            "#include <CoreFoundation/CoreFoundation.h>",
            "#include <boost/foreach.hpp>",
            "#include \"version.hpp\"",
            "#include \"serialization/unicode.hpp\"",
            "#include \"serialization/string_utils.hpp\"",
            "#include \"scoped_resource.hpp\"",
            "#include \"log.hpp\"",
            "#include \"game_preferences.hpp\"",
            "#include \"game_config.hpp\"",
            "#include \"filesystem.hpp\"",
            "#include \"config.hpp\"",
            "#include <cstring>",
            "#include <boost/algorithm/string.hpp>",
            "#include <set>",
            "#include <iomanip>",
            "#include <fstream>",
            "#include <cerrno>",
            "#include <libgen.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <cctype>",
            "#include \"filesystem_win32.ii\"",
            "#include <sys/stat.h>",
            "#include \"global.hpp\""
          ],
          "macros_used": [
            "#define DBG_FS LOG_STREAM(debug, log_filesystem)"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\n#define DBG_FS LOG_STREAM(debug, log_filesystem)\n\nbool create_directory_if_missing_recursive(const std::string& dirname)\n{\n\tDBG_FS<<\"creating recursive directory: \"<<dirname<<'\\n';\n\tif (is_directory(dirname) == false && dirname.empty() == false)\n\t{\n\t\tstd::string tmp_dirname = dirname;\n\t\t// remove trailing slashes or backslashes\n\t\twhile ((tmp_dirname[tmp_dirname.size()-1] == '/' ||\n\t\t\t  tmp_dirname[tmp_dirname.size()-1] == '\\\\') &&\n\t\t\t  !tmp_dirname.empty())\n\t\t{\n\t\t\ttmp_dirname.erase(tmp_dirname.size()-1);\n\t\t}\n\n\t\t// create the first non-existing directory\n\t\tsize_t pos = tmp_dirname.rfind(\"/\");\n\n\t\t// we get the most right directory and *skip* it\n\t\t// we are creating it when we get back here\n\t\tif (tmp_dirname.rfind('\\\\') != std::string::npos &&\n\t\t\ttmp_dirname.rfind('\\\\') > pos )\n\t\t\tpos = tmp_dirname.rfind('\\\\');\n\n\t\tif (pos != std::string::npos)\n\t\t\tcreate_directory_if_missing_recursive(tmp_dirname.substr(0,pos));\n\n\t\treturn create_directory_if_missing(tmp_dirname);\n\t}\n\treturn create_directory_if_missing(dirname);\n}"
        }
      },
      {
        "call_info": {
          "callee": "getenv",
          "args": [
            "\"HOME\""
          ],
          "line": 605
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getenv",
          "args": [
            "\"XDG_CACHE_HOME\""
          ],
          "line": 603
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "cache_dir.empty",
          "args": [],
          "line": 600
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\nstd::string get_cache_dir()\n{\n\tif (cache_dir.empty())\n\t{\n#if defined(_X11) && !defined(PREFERENCES_DIR)\n\t\tchar const *xdg_cache = getenv(\"XDG_CACHE_HOME\");\n\t\tif (!xdg_cache || xdg_cache[0] == '\\0') {\n\t\t\txdg_cache = getenv(\"HOME\");\n\t\t\tif (!xdg_cache) {\n\t\t\t\tcache_dir = get_dir(get_user_data_dir() + \"/cache\");\n\t\t\t\treturn cache_dir;\n\t\t\t}\n\t\t\tcache_dir = xdg_cache;\n\t\t\tcache_dir += \"/.cache\";\n\t\t} else cache_dir = xdg_cache;\n\t\tcache_dir += \"/wesnoth\";\n\t\tcreate_directory_if_missing_recursive(cache_dir);\n#else\n\t\tcache_dir = get_dir(get_user_data_dir() + \"/cache\");\n#endif\n\t}\n\treturn cache_dir;\n}"
  },
  {
    "function_name": "get_user_config_dir",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
    "lines": "573-596",
    "snippet": "std::string get_user_config_dir()\n{\n\tif (user_config_dir.empty())\n\t{\n#if defined(_X11) && !defined(PREFERENCES_DIR)\n\t\tchar const *xdg_config = getenv(\"XDG_CONFIG_HOME\");\n\t\tstd::string path;\n\t\tif (!xdg_config || xdg_config[0] == '\\0') {\n\t\t\txdg_config = getenv(\"HOME\");\n\t\t\tif (!xdg_config) {\n\t\t\t\tuser_config_dir = get_user_data_dir();\n\t\t\t\treturn user_config_dir;\n\t\t\t}\n\t\t\tpath = xdg_config;\n\t\t\tpath += \"/.config\";\n\t\t} else path = xdg_config;\n\t\tpath += \"/wesnoth\";\n\t\tset_user_config_dir(path);\n#else\n\t\tuser_config_dir = get_user_data_dir();\n#endif\n\t}\n\treturn user_config_dir;\n}",
    "includes": [
      "#include <CoreFoundation/CFBase.h>",
      "#include <CoreFoundation/CFString.h>",
      "#include <CoreFoundation/CoreFoundation.h>",
      "#include <boost/foreach.hpp>",
      "#include \"version.hpp\"",
      "#include \"serialization/unicode.hpp\"",
      "#include \"serialization/string_utils.hpp\"",
      "#include \"scoped_resource.hpp\"",
      "#include \"log.hpp\"",
      "#include \"game_preferences.hpp\"",
      "#include \"game_config.hpp\"",
      "#include \"filesystem.hpp\"",
      "#include \"config.hpp\"",
      "#include <cstring>",
      "#include <boost/algorithm/string.hpp>",
      "#include <set>",
      "#include <iomanip>",
      "#include <fstream>",
      "#include <cerrno>",
      "#include <libgen.h>",
      "#include <dirent.h>",
      "#include <unistd.h>",
      "#include <cctype>",
      "#include \"filesystem_win32.ii\"",
      "#include <sys/stat.h>",
      "#include \"global.hpp\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "get_user_data_dir",
          "args": [],
          "line": 592
        },
        "resolved": true,
        "details": {
          "function_name": "get_user_data_dir",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
          "lines": "561-571",
          "snippet": "std::string get_user_data_dir()\n{\n\t// ensure setup gets called only once per session\n\t// FIXME: this is okay and optimized, but how should we react\n\t// if the user deletes a dir while we are running?\n\tif (user_data_dir.empty())\n\t{\n\t\tset_user_data_dir(std::string());\n\t}\n\treturn user_data_dir;\n}",
          "includes": [
            "#include <CoreFoundation/CFBase.h>",
            "#include <CoreFoundation/CFString.h>",
            "#include <CoreFoundation/CoreFoundation.h>",
            "#include <boost/foreach.hpp>",
            "#include \"version.hpp\"",
            "#include \"serialization/unicode.hpp\"",
            "#include \"serialization/string_utils.hpp\"",
            "#include \"scoped_resource.hpp\"",
            "#include \"log.hpp\"",
            "#include \"game_preferences.hpp\"",
            "#include \"game_config.hpp\"",
            "#include \"filesystem.hpp\"",
            "#include \"config.hpp\"",
            "#include <cstring>",
            "#include <boost/algorithm/string.hpp>",
            "#include <set>",
            "#include <iomanip>",
            "#include <fstream>",
            "#include <cerrno>",
            "#include <libgen.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <cctype>",
            "#include \"filesystem_win32.ii\"",
            "#include <sys/stat.h>",
            "#include \"global.hpp\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\nstd::string get_user_data_dir()\n{\n\t// ensure setup gets called only once per session\n\t// FIXME: this is okay and optimized, but how should we react\n\t// if the user deletes a dir while we are running?\n\tif (user_data_dir.empty())\n\t{\n\t\tset_user_data_dir(std::string());\n\t}\n\treturn user_data_dir;\n}"
        }
      },
      {
        "call_info": {
          "callee": "set_user_config_dir",
          "args": [
            "path"
          ],
          "line": 590
        },
        "resolved": true,
        "details": {
          "function_name": "set_user_config_dir",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
          "lines": "521-525",
          "snippet": "void set_user_config_dir(std::string path)\n{\n\tuser_config_dir = path;\n\tcreate_directory_if_missing(user_config_dir);\n}",
          "includes": [
            "#include <CoreFoundation/CFBase.h>",
            "#include <CoreFoundation/CFString.h>",
            "#include <CoreFoundation/CoreFoundation.h>",
            "#include <boost/foreach.hpp>",
            "#include \"version.hpp\"",
            "#include \"serialization/unicode.hpp\"",
            "#include \"serialization/string_utils.hpp\"",
            "#include \"scoped_resource.hpp\"",
            "#include \"log.hpp\"",
            "#include \"game_preferences.hpp\"",
            "#include \"game_config.hpp\"",
            "#include \"filesystem.hpp\"",
            "#include \"config.hpp\"",
            "#include <cstring>",
            "#include <boost/algorithm/string.hpp>",
            "#include <set>",
            "#include <iomanip>",
            "#include <fstream>",
            "#include <cerrno>",
            "#include <libgen.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <cctype>",
            "#include \"filesystem_win32.ii\"",
            "#include <sys/stat.h>",
            "#include \"global.hpp\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\nvoid set_user_config_dir(std::string path)\n{\n\tuser_config_dir = path;\n\tcreate_directory_if_missing(user_config_dir);\n}"
        }
      },
      {
        "call_info": {
          "callee": "getenv",
          "args": [
            "\"HOME\""
          ],
          "line": 581
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getenv",
          "args": [
            "\"XDG_CONFIG_HOME\""
          ],
          "line": 578
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "user_config_dir.empty",
          "args": [],
          "line": 575
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\nstd::string get_user_config_dir()\n{\n\tif (user_config_dir.empty())\n\t{\n#if defined(_X11) && !defined(PREFERENCES_DIR)\n\t\tchar const *xdg_config = getenv(\"XDG_CONFIG_HOME\");\n\t\tstd::string path;\n\t\tif (!xdg_config || xdg_config[0] == '\\0') {\n\t\t\txdg_config = getenv(\"HOME\");\n\t\t\tif (!xdg_config) {\n\t\t\t\tuser_config_dir = get_user_data_dir();\n\t\t\t\treturn user_config_dir;\n\t\t\t}\n\t\t\tpath = xdg_config;\n\t\t\tpath += \"/.config\";\n\t\t} else path = xdg_config;\n\t\tpath += \"/wesnoth\";\n\t\tset_user_config_dir(path);\n#else\n\t\tuser_config_dir = get_user_data_dir();\n#endif\n\t}\n\treturn user_config_dir;\n}"
  },
  {
    "function_name": "get_user_data_dir",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
    "lines": "561-571",
    "snippet": "std::string get_user_data_dir()\n{\n\t// ensure setup gets called only once per session\n\t// FIXME: this is okay and optimized, but how should we react\n\t// if the user deletes a dir while we are running?\n\tif (user_data_dir.empty())\n\t{\n\t\tset_user_data_dir(std::string());\n\t}\n\treturn user_data_dir;\n}",
    "includes": [
      "#include <CoreFoundation/CFBase.h>",
      "#include <CoreFoundation/CFString.h>",
      "#include <CoreFoundation/CoreFoundation.h>",
      "#include <boost/foreach.hpp>",
      "#include \"version.hpp\"",
      "#include \"serialization/unicode.hpp\"",
      "#include \"serialization/string_utils.hpp\"",
      "#include \"scoped_resource.hpp\"",
      "#include \"log.hpp\"",
      "#include \"game_preferences.hpp\"",
      "#include \"game_config.hpp\"",
      "#include \"filesystem.hpp\"",
      "#include \"config.hpp\"",
      "#include <cstring>",
      "#include <boost/algorithm/string.hpp>",
      "#include <set>",
      "#include <iomanip>",
      "#include <fstream>",
      "#include <cerrno>",
      "#include <libgen.h>",
      "#include <dirent.h>",
      "#include <unistd.h>",
      "#include <cctype>",
      "#include \"filesystem_win32.ii\"",
      "#include <sys/stat.h>",
      "#include \"global.hpp\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "set_user_data_dir",
          "args": [
            "std::string()"
          ],
          "line": 568
        },
        "resolved": true,
        "details": {
          "function_name": "set_user_data_dir",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
          "lines": "441-519",
          "snippet": "void set_user_data_dir(std::string path)\n{\n#ifdef _WIN32\n\tif(path.empty()) {\n\t\tuser_data_dir = get_cwd() + \"/userdata\";\n\t} else if (path.size() > 2 && path[1] == ':') {\n\t\t//allow absolute path override\n\t\tuser_data_dir = path;\n\t} else {\n\t\ttypedef BOOL (WINAPI *SHGSFPAddress)(HWND, LPSTR, int, BOOL);\n\t\tSHGSFPAddress SHGetSpecialFolderPathA;\n\t\tHMODULE module = LoadLibraryA(\"shell32\");\n\t\tSHGetSpecialFolderPathA = reinterpret_cast<SHGSFPAddress>(GetProcAddress(module, \"SHGetSpecialFolderPathA\"));\n\t\tif(SHGetSpecialFolderPathA) {\n\t\t\tLOG_FS << \"Using SHGetSpecialFolderPath to find My Documents\" << std::endl;\n\t\t\tchar my_documents_path[MAX_PATH];\n\t\t\tif(SHGetSpecialFolderPathA(NULL, my_documents_path, 5, 1)) {\n\t\t\t\tstd::string mygames_path = std::string(my_documents_path) + \"/\" + \"My Games\";\n\t\t\t\tboost::algorithm::replace_all(mygames_path, std::string(\"\\\\\"), std::string(\"/\"));\n\t\t\t\tcreate_directory_if_missing(mygames_path);\n\t\t\t\tuser_data_dir = mygames_path + \"/\" + path;\n\t\t\t} else {\n\t\t\t\tWRN_FS << \"SHGetSpecialFolderPath failed\" << std::endl;\n\t\t\t\tuser_data_dir = get_cwd() + \"/\" + path;\n\t\t\t}\n\t\t} else {\n\t\t\tLOG_FS << \"Failed to load SHGetSpecialFolderPath function\" << std::endl;\n\t\t\tuser_data_dir = get_cwd() + \"/\" + path;\n\t\t}\n\t}\n\n#else /*_WIN32*/\n\n#ifdef PREFERENCES_DIR\n\tif (path.empty()) path = PREFERENCES_DIR;\n#endif\n\n\tstd::string path2 = \".wesnoth\" + get_version_path_suffix();\n\n#ifdef _X11\n\tconst char *home_str = getenv(\"HOME\");\n\n\tif (path.empty()) {\n\t\tchar const *xdg_data = getenv(\"XDG_DATA_HOME\");\n\t\tif (!xdg_data || xdg_data[0] == '\\0') {\n\t\t\tif (!home_str) {\n\t\t\t\tpath = path2;\n\t\t\t\tgoto other;\n\t\t\t}\n\t\t\tuser_data_dir = home_str;\n\t\t\tuser_data_dir += \"/.local/share\";\n\t\t} else user_data_dir = xdg_data;\n\t\tuser_data_dir += \"/wesnoth/\";\n\t\tuser_data_dir += get_version_path_suffix();\n\t\tcreate_directory_if_missing_recursive(user_data_dir);\n\t} else {\n\t\tother:\n\t\tstd::string home = home_str ? home_str : \".\";\n\n\t\tif (path[0] == '/')\n\t\t\tuser_data_dir = path;\n\t\telse\n\t\t\tuser_data_dir = home + \"/\" + path;\n\t}\n#else\n\tif (path.empty()) path = path2;\n\n\tconst char* home_str = getenv(\"HOME\");\n\tstd::string home = home_str ? home_str : \".\";\n\n\tif (path[0] == '/')\n\t\tuser_data_dir = path;\n\telse\n\t\tuser_data_dir = home + std::string(\"/\") + path;\n#endif\n\n#endif /*_WIN32*/\n\tsetup_user_data_dir();\n}",
          "includes": [
            "#include <CoreFoundation/CFBase.h>",
            "#include <CoreFoundation/CFString.h>",
            "#include <CoreFoundation/CoreFoundation.h>",
            "#include <boost/foreach.hpp>",
            "#include \"version.hpp\"",
            "#include \"serialization/unicode.hpp\"",
            "#include \"serialization/string_utils.hpp\"",
            "#include \"scoped_resource.hpp\"",
            "#include \"log.hpp\"",
            "#include \"game_preferences.hpp\"",
            "#include \"game_config.hpp\"",
            "#include \"filesystem.hpp\"",
            "#include \"config.hpp\"",
            "#include <cstring>",
            "#include <boost/algorithm/string.hpp>",
            "#include <set>",
            "#include <iomanip>",
            "#include <fstream>",
            "#include <cerrno>",
            "#include <libgen.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <cctype>",
            "#include \"filesystem_win32.ii\"",
            "#include <sys/stat.h>",
            "#include \"global.hpp\""
          ],
          "macros_used": [
            "#define WRN_FS LOG_STREAM(warn, log_filesystem)",
            "#define LOG_FS LOG_STREAM(info, log_filesystem)"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\n#define WRN_FS LOG_STREAM(warn, log_filesystem)\n#define LOG_FS LOG_STREAM(info, log_filesystem)\n\nvoid set_user_data_dir(std::string path)\n{\n#ifdef _WIN32\n\tif(path.empty()) {\n\t\tuser_data_dir = get_cwd() + \"/userdata\";\n\t} else if (path.size() > 2 && path[1] == ':') {\n\t\t//allow absolute path override\n\t\tuser_data_dir = path;\n\t} else {\n\t\ttypedef BOOL (WINAPI *SHGSFPAddress)(HWND, LPSTR, int, BOOL);\n\t\tSHGSFPAddress SHGetSpecialFolderPathA;\n\t\tHMODULE module = LoadLibraryA(\"shell32\");\n\t\tSHGetSpecialFolderPathA = reinterpret_cast<SHGSFPAddress>(GetProcAddress(module, \"SHGetSpecialFolderPathA\"));\n\t\tif(SHGetSpecialFolderPathA) {\n\t\t\tLOG_FS << \"Using SHGetSpecialFolderPath to find My Documents\" << std::endl;\n\t\t\tchar my_documents_path[MAX_PATH];\n\t\t\tif(SHGetSpecialFolderPathA(NULL, my_documents_path, 5, 1)) {\n\t\t\t\tstd::string mygames_path = std::string(my_documents_path) + \"/\" + \"My Games\";\n\t\t\t\tboost::algorithm::replace_all(mygames_path, std::string(\"\\\\\"), std::string(\"/\"));\n\t\t\t\tcreate_directory_if_missing(mygames_path);\n\t\t\t\tuser_data_dir = mygames_path + \"/\" + path;\n\t\t\t} else {\n\t\t\t\tWRN_FS << \"SHGetSpecialFolderPath failed\" << std::endl;\n\t\t\t\tuser_data_dir = get_cwd() + \"/\" + path;\n\t\t\t}\n\t\t} else {\n\t\t\tLOG_FS << \"Failed to load SHGetSpecialFolderPath function\" << std::endl;\n\t\t\tuser_data_dir = get_cwd() + \"/\" + path;\n\t\t}\n\t}\n\n#else /*_WIN32*/\n\n#ifdef PREFERENCES_DIR\n\tif (path.empty()) path = PREFERENCES_DIR;\n#endif\n\n\tstd::string path2 = \".wesnoth\" + get_version_path_suffix();\n\n#ifdef _X11\n\tconst char *home_str = getenv(\"HOME\");\n\n\tif (path.empty()) {\n\t\tchar const *xdg_data = getenv(\"XDG_DATA_HOME\");\n\t\tif (!xdg_data || xdg_data[0] == '\\0') {\n\t\t\tif (!home_str) {\n\t\t\t\tpath = path2;\n\t\t\t\tgoto other;\n\t\t\t}\n\t\t\tuser_data_dir = home_str;\n\t\t\tuser_data_dir += \"/.local/share\";\n\t\t} else user_data_dir = xdg_data;\n\t\tuser_data_dir += \"/wesnoth/\";\n\t\tuser_data_dir += get_version_path_suffix();\n\t\tcreate_directory_if_missing_recursive(user_data_dir);\n\t} else {\n\t\tother:\n\t\tstd::string home = home_str ? home_str : \".\";\n\n\t\tif (path[0] == '/')\n\t\t\tuser_data_dir = path;\n\t\telse\n\t\t\tuser_data_dir = home + \"/\" + path;\n\t}\n#else\n\tif (path.empty()) path = path2;\n\n\tconst char* home_str = getenv(\"HOME\");\n\tstd::string home = home_str ? home_str : \".\";\n\n\tif (path[0] == '/')\n\t\tuser_data_dir = path;\n\telse\n\t\tuser_data_dir = home + std::string(\"/\") + path;\n#endif\n\n#endif /*_WIN32*/\n\tsetup_user_data_dir();\n}"
        }
      },
      {
        "call_info": {
          "callee": "std::string",
          "args": [],
          "line": 568
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "user_data_dir.empty",
          "args": [],
          "line": 566
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\nstd::string get_user_data_dir()\n{\n\t// ensure setup gets called only once per session\n\t// FIXME: this is okay and optimized, but how should we react\n\t// if the user deletes a dir while we are running?\n\tif (user_data_dir.empty())\n\t{\n\t\tset_user_data_dir(std::string());\n\t}\n\treturn user_data_dir;\n}"
  },
  {
    "function_name": "setup_user_data_dir",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
    "lines": "527-559",
    "snippet": "static void setup_user_data_dir()\n{\n#ifdef _WIN32\n\t_mkdir(user_data_dir.c_str());\n\t_mkdir((user_data_dir + \"/editor\").c_str());\n\t_mkdir((user_data_dir + \"/editor/maps\").c_str());\n\t_mkdir((user_data_dir + \"/editor/scenarios\").c_str());\n\t_mkdir((user_data_dir + \"/data\").c_str());\n\t_mkdir((user_data_dir + \"/data/add-ons\").c_str());\n\t_mkdir((user_data_dir + \"/saves\").c_str());\n\t_mkdir((user_data_dir + \"/persist\").c_str());\n#else\n\tconst std::string& dir_path = user_data_dir;\n\n\tconst bool res = create_directory_if_missing(dir_path);\n\t// probe read permissions (if we could make the directory)\n\tDIR* const dir = res ? opendir(dir_path.c_str()) : NULL;\n\tif(dir == NULL) {\n\t\tERR_FS << \"could not open or create preferences directory at \" << dir_path << std::endl;\n\t\treturn;\n\t}\n\tclosedir(dir);\n\n\t// Create user data and add-on directories\n\tcreate_directory_if_missing(dir_path + \"/editor\");\n\tcreate_directory_if_missing(dir_path + \"/editor/maps\");\n\tcreate_directory_if_missing(dir_path + \"/editor/scenarios\");\n\tcreate_directory_if_missing(dir_path + \"/data\");\n\tcreate_directory_if_missing(dir_path + \"/data/add-ons\");\n\tcreate_directory_if_missing(dir_path + \"/saves\");\n\tcreate_directory_if_missing(dir_path + \"/persist\");\n#endif\n}",
    "includes": [
      "#include <CoreFoundation/CFBase.h>",
      "#include <CoreFoundation/CFString.h>",
      "#include <CoreFoundation/CoreFoundation.h>",
      "#include <boost/foreach.hpp>",
      "#include \"version.hpp\"",
      "#include \"serialization/unicode.hpp\"",
      "#include \"serialization/string_utils.hpp\"",
      "#include \"scoped_resource.hpp\"",
      "#include \"log.hpp\"",
      "#include \"game_preferences.hpp\"",
      "#include \"game_config.hpp\"",
      "#include \"filesystem.hpp\"",
      "#include \"config.hpp\"",
      "#include <cstring>",
      "#include <boost/algorithm/string.hpp>",
      "#include <set>",
      "#include <iomanip>",
      "#include <fstream>",
      "#include <cerrno>",
      "#include <libgen.h>",
      "#include <dirent.h>",
      "#include <unistd.h>",
      "#include <cctype>",
      "#include \"filesystem_win32.ii\"",
      "#include <sys/stat.h>",
      "#include \"global.hpp\""
    ],
    "macros_used": [
      "#define ERR_FS LOG_STREAM(err, log_filesystem)"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "create_directory_if_missing",
          "args": [
            "dir_path + \"/persist\""
          ],
          "line": 557
        },
        "resolved": true,
        "details": {
          "function_name": "create_directory_if_missing_recursive",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
          "lines": "387-416",
          "snippet": "bool create_directory_if_missing_recursive(const std::string& dirname)\n{\n\tDBG_FS<<\"creating recursive directory: \"<<dirname<<'\\n';\n\tif (is_directory(dirname) == false && dirname.empty() == false)\n\t{\n\t\tstd::string tmp_dirname = dirname;\n\t\t// remove trailing slashes or backslashes\n\t\twhile ((tmp_dirname[tmp_dirname.size()-1] == '/' ||\n\t\t\t  tmp_dirname[tmp_dirname.size()-1] == '\\\\') &&\n\t\t\t  !tmp_dirname.empty())\n\t\t{\n\t\t\ttmp_dirname.erase(tmp_dirname.size()-1);\n\t\t}\n\n\t\t// create the first non-existing directory\n\t\tsize_t pos = tmp_dirname.rfind(\"/\");\n\n\t\t// we get the most right directory and *skip* it\n\t\t// we are creating it when we get back here\n\t\tif (tmp_dirname.rfind('\\\\') != std::string::npos &&\n\t\t\ttmp_dirname.rfind('\\\\') > pos )\n\t\t\tpos = tmp_dirname.rfind('\\\\');\n\n\t\tif (pos != std::string::npos)\n\t\t\tcreate_directory_if_missing_recursive(tmp_dirname.substr(0,pos));\n\n\t\treturn create_directory_if_missing(tmp_dirname);\n\t}\n\treturn create_directory_if_missing(dirname);\n}",
          "includes": [
            "#include <CoreFoundation/CFBase.h>",
            "#include <CoreFoundation/CFString.h>",
            "#include <CoreFoundation/CoreFoundation.h>",
            "#include <boost/foreach.hpp>",
            "#include \"version.hpp\"",
            "#include \"serialization/unicode.hpp\"",
            "#include \"serialization/string_utils.hpp\"",
            "#include \"scoped_resource.hpp\"",
            "#include \"log.hpp\"",
            "#include \"game_preferences.hpp\"",
            "#include \"game_config.hpp\"",
            "#include \"filesystem.hpp\"",
            "#include \"config.hpp\"",
            "#include <cstring>",
            "#include <boost/algorithm/string.hpp>",
            "#include <set>",
            "#include <iomanip>",
            "#include <fstream>",
            "#include <cerrno>",
            "#include <libgen.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <cctype>",
            "#include \"filesystem_win32.ii\"",
            "#include <sys/stat.h>",
            "#include \"global.hpp\""
          ],
          "macros_used": [
            "#define DBG_FS LOG_STREAM(debug, log_filesystem)"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\n#define DBG_FS LOG_STREAM(debug, log_filesystem)\n\nbool create_directory_if_missing_recursive(const std::string& dirname)\n{\n\tDBG_FS<<\"creating recursive directory: \"<<dirname<<'\\n';\n\tif (is_directory(dirname) == false && dirname.empty() == false)\n\t{\n\t\tstd::string tmp_dirname = dirname;\n\t\t// remove trailing slashes or backslashes\n\t\twhile ((tmp_dirname[tmp_dirname.size()-1] == '/' ||\n\t\t\t  tmp_dirname[tmp_dirname.size()-1] == '\\\\') &&\n\t\t\t  !tmp_dirname.empty())\n\t\t{\n\t\t\ttmp_dirname.erase(tmp_dirname.size()-1);\n\t\t}\n\n\t\t// create the first non-existing directory\n\t\tsize_t pos = tmp_dirname.rfind(\"/\");\n\n\t\t// we get the most right directory and *skip* it\n\t\t// we are creating it when we get back here\n\t\tif (tmp_dirname.rfind('\\\\') != std::string::npos &&\n\t\t\ttmp_dirname.rfind('\\\\') > pos )\n\t\t\tpos = tmp_dirname.rfind('\\\\');\n\n\t\tif (pos != std::string::npos)\n\t\t\tcreate_directory_if_missing_recursive(tmp_dirname.substr(0,pos));\n\n\t\treturn create_directory_if_missing(tmp_dirname);\n\t}\n\treturn create_directory_if_missing(dirname);\n}"
        }
      },
      {
        "call_info": {
          "callee": "closedir",
          "args": [
            "dir"
          ],
          "line": 548
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "opendir",
          "args": [
            "dir_path.c_str()"
          ],
          "line": 543
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dir_path.c_str",
          "args": [],
          "line": 543
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_mkdir",
          "args": [
            "(user_data_dir + \"/persist\").c_str()"
          ],
          "line": 537
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "",
          "args": [],
          "line": 537
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_mkdir",
          "args": [
            "(user_data_dir + \"/saves\").c_str()"
          ],
          "line": 536
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "",
          "args": [],
          "line": 536
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_mkdir",
          "args": [
            "(user_data_dir + \"/data/add-ons\").c_str()"
          ],
          "line": 535
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "",
          "args": [],
          "line": 535
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_mkdir",
          "args": [
            "(user_data_dir + \"/data\").c_str()"
          ],
          "line": 534
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "",
          "args": [],
          "line": 534
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_mkdir",
          "args": [
            "(user_data_dir + \"/editor/scenarios\").c_str()"
          ],
          "line": 533
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "",
          "args": [],
          "line": 533
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_mkdir",
          "args": [
            "(user_data_dir + \"/editor/maps\").c_str()"
          ],
          "line": 532
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "",
          "args": [],
          "line": 532
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_mkdir",
          "args": [
            "(user_data_dir + \"/editor\").c_str()"
          ],
          "line": 531
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "",
          "args": [],
          "line": 531
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_mkdir",
          "args": [
            "user_data_dir.c_str()"
          ],
          "line": 530
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "user_data_dir.c_str",
          "args": [],
          "line": 530
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\n#define ERR_FS LOG_STREAM(err, log_filesystem)\n\nstatic void setup_user_data_dir()\n{\n#ifdef _WIN32\n\t_mkdir(user_data_dir.c_str());\n\t_mkdir((user_data_dir + \"/editor\").c_str());\n\t_mkdir((user_data_dir + \"/editor/maps\").c_str());\n\t_mkdir((user_data_dir + \"/editor/scenarios\").c_str());\n\t_mkdir((user_data_dir + \"/data\").c_str());\n\t_mkdir((user_data_dir + \"/data/add-ons\").c_str());\n\t_mkdir((user_data_dir + \"/saves\").c_str());\n\t_mkdir((user_data_dir + \"/persist\").c_str());\n#else\n\tconst std::string& dir_path = user_data_dir;\n\n\tconst bool res = create_directory_if_missing(dir_path);\n\t// probe read permissions (if we could make the directory)\n\tDIR* const dir = res ? opendir(dir_path.c_str()) : NULL;\n\tif(dir == NULL) {\n\t\tERR_FS << \"could not open or create preferences directory at \" << dir_path << std::endl;\n\t\treturn;\n\t}\n\tclosedir(dir);\n\n\t// Create user data and add-on directories\n\tcreate_directory_if_missing(dir_path + \"/editor\");\n\tcreate_directory_if_missing(dir_path + \"/editor/maps\");\n\tcreate_directory_if_missing(dir_path + \"/editor/scenarios\");\n\tcreate_directory_if_missing(dir_path + \"/data\");\n\tcreate_directory_if_missing(dir_path + \"/data/add-ons\");\n\tcreate_directory_if_missing(dir_path + \"/saves\");\n\tcreate_directory_if_missing(dir_path + \"/persist\");\n#endif\n}"
  },
  {
    "function_name": "set_user_config_dir",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
    "lines": "521-525",
    "snippet": "void set_user_config_dir(std::string path)\n{\n\tuser_config_dir = path;\n\tcreate_directory_if_missing(user_config_dir);\n}",
    "includes": [
      "#include <CoreFoundation/CFBase.h>",
      "#include <CoreFoundation/CFString.h>",
      "#include <CoreFoundation/CoreFoundation.h>",
      "#include <boost/foreach.hpp>",
      "#include \"version.hpp\"",
      "#include \"serialization/unicode.hpp\"",
      "#include \"serialization/string_utils.hpp\"",
      "#include \"scoped_resource.hpp\"",
      "#include \"log.hpp\"",
      "#include \"game_preferences.hpp\"",
      "#include \"game_config.hpp\"",
      "#include \"filesystem.hpp\"",
      "#include \"config.hpp\"",
      "#include <cstring>",
      "#include <boost/algorithm/string.hpp>",
      "#include <set>",
      "#include <iomanip>",
      "#include <fstream>",
      "#include <cerrno>",
      "#include <libgen.h>",
      "#include <dirent.h>",
      "#include <unistd.h>",
      "#include <cctype>",
      "#include \"filesystem_win32.ii\"",
      "#include <sys/stat.h>",
      "#include \"global.hpp\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "create_directory_if_missing",
          "args": [
            "user_config_dir"
          ],
          "line": 524
        },
        "resolved": true,
        "details": {
          "function_name": "create_directory_if_missing_recursive",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
          "lines": "387-416",
          "snippet": "bool create_directory_if_missing_recursive(const std::string& dirname)\n{\n\tDBG_FS<<\"creating recursive directory: \"<<dirname<<'\\n';\n\tif (is_directory(dirname) == false && dirname.empty() == false)\n\t{\n\t\tstd::string tmp_dirname = dirname;\n\t\t// remove trailing slashes or backslashes\n\t\twhile ((tmp_dirname[tmp_dirname.size()-1] == '/' ||\n\t\t\t  tmp_dirname[tmp_dirname.size()-1] == '\\\\') &&\n\t\t\t  !tmp_dirname.empty())\n\t\t{\n\t\t\ttmp_dirname.erase(tmp_dirname.size()-1);\n\t\t}\n\n\t\t// create the first non-existing directory\n\t\tsize_t pos = tmp_dirname.rfind(\"/\");\n\n\t\t// we get the most right directory and *skip* it\n\t\t// we are creating it when we get back here\n\t\tif (tmp_dirname.rfind('\\\\') != std::string::npos &&\n\t\t\ttmp_dirname.rfind('\\\\') > pos )\n\t\t\tpos = tmp_dirname.rfind('\\\\');\n\n\t\tif (pos != std::string::npos)\n\t\t\tcreate_directory_if_missing_recursive(tmp_dirname.substr(0,pos));\n\n\t\treturn create_directory_if_missing(tmp_dirname);\n\t}\n\treturn create_directory_if_missing(dirname);\n}",
          "includes": [
            "#include <CoreFoundation/CFBase.h>",
            "#include <CoreFoundation/CFString.h>",
            "#include <CoreFoundation/CoreFoundation.h>",
            "#include <boost/foreach.hpp>",
            "#include \"version.hpp\"",
            "#include \"serialization/unicode.hpp\"",
            "#include \"serialization/string_utils.hpp\"",
            "#include \"scoped_resource.hpp\"",
            "#include \"log.hpp\"",
            "#include \"game_preferences.hpp\"",
            "#include \"game_config.hpp\"",
            "#include \"filesystem.hpp\"",
            "#include \"config.hpp\"",
            "#include <cstring>",
            "#include <boost/algorithm/string.hpp>",
            "#include <set>",
            "#include <iomanip>",
            "#include <fstream>",
            "#include <cerrno>",
            "#include <libgen.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <cctype>",
            "#include \"filesystem_win32.ii\"",
            "#include <sys/stat.h>",
            "#include \"global.hpp\""
          ],
          "macros_used": [
            "#define DBG_FS LOG_STREAM(debug, log_filesystem)"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\n#define DBG_FS LOG_STREAM(debug, log_filesystem)\n\nbool create_directory_if_missing_recursive(const std::string& dirname)\n{\n\tDBG_FS<<\"creating recursive directory: \"<<dirname<<'\\n';\n\tif (is_directory(dirname) == false && dirname.empty() == false)\n\t{\n\t\tstd::string tmp_dirname = dirname;\n\t\t// remove trailing slashes or backslashes\n\t\twhile ((tmp_dirname[tmp_dirname.size()-1] == '/' ||\n\t\t\t  tmp_dirname[tmp_dirname.size()-1] == '\\\\') &&\n\t\t\t  !tmp_dirname.empty())\n\t\t{\n\t\t\ttmp_dirname.erase(tmp_dirname.size()-1);\n\t\t}\n\n\t\t// create the first non-existing directory\n\t\tsize_t pos = tmp_dirname.rfind(\"/\");\n\n\t\t// we get the most right directory and *skip* it\n\t\t// we are creating it when we get back here\n\t\tif (tmp_dirname.rfind('\\\\') != std::string::npos &&\n\t\t\ttmp_dirname.rfind('\\\\') > pos )\n\t\t\tpos = tmp_dirname.rfind('\\\\');\n\n\t\tif (pos != std::string::npos)\n\t\t\tcreate_directory_if_missing_recursive(tmp_dirname.substr(0,pos));\n\n\t\treturn create_directory_if_missing(tmp_dirname);\n\t}\n\treturn create_directory_if_missing(dirname);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\nvoid set_user_config_dir(std::string path)\n{\n\tuser_config_dir = path;\n\tcreate_directory_if_missing(user_config_dir);\n}"
  },
  {
    "function_name": "set_user_data_dir",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
    "lines": "441-519",
    "snippet": "void set_user_data_dir(std::string path)\n{\n#ifdef _WIN32\n\tif(path.empty()) {\n\t\tuser_data_dir = get_cwd() + \"/userdata\";\n\t} else if (path.size() > 2 && path[1] == ':') {\n\t\t//allow absolute path override\n\t\tuser_data_dir = path;\n\t} else {\n\t\ttypedef BOOL (WINAPI *SHGSFPAddress)(HWND, LPSTR, int, BOOL);\n\t\tSHGSFPAddress SHGetSpecialFolderPathA;\n\t\tHMODULE module = LoadLibraryA(\"shell32\");\n\t\tSHGetSpecialFolderPathA = reinterpret_cast<SHGSFPAddress>(GetProcAddress(module, \"SHGetSpecialFolderPathA\"));\n\t\tif(SHGetSpecialFolderPathA) {\n\t\t\tLOG_FS << \"Using SHGetSpecialFolderPath to find My Documents\" << std::endl;\n\t\t\tchar my_documents_path[MAX_PATH];\n\t\t\tif(SHGetSpecialFolderPathA(NULL, my_documents_path, 5, 1)) {\n\t\t\t\tstd::string mygames_path = std::string(my_documents_path) + \"/\" + \"My Games\";\n\t\t\t\tboost::algorithm::replace_all(mygames_path, std::string(\"\\\\\"), std::string(\"/\"));\n\t\t\t\tcreate_directory_if_missing(mygames_path);\n\t\t\t\tuser_data_dir = mygames_path + \"/\" + path;\n\t\t\t} else {\n\t\t\t\tWRN_FS << \"SHGetSpecialFolderPath failed\" << std::endl;\n\t\t\t\tuser_data_dir = get_cwd() + \"/\" + path;\n\t\t\t}\n\t\t} else {\n\t\t\tLOG_FS << \"Failed to load SHGetSpecialFolderPath function\" << std::endl;\n\t\t\tuser_data_dir = get_cwd() + \"/\" + path;\n\t\t}\n\t}\n\n#else /*_WIN32*/\n\n#ifdef PREFERENCES_DIR\n\tif (path.empty()) path = PREFERENCES_DIR;\n#endif\n\n\tstd::string path2 = \".wesnoth\" + get_version_path_suffix();\n\n#ifdef _X11\n\tconst char *home_str = getenv(\"HOME\");\n\n\tif (path.empty()) {\n\t\tchar const *xdg_data = getenv(\"XDG_DATA_HOME\");\n\t\tif (!xdg_data || xdg_data[0] == '\\0') {\n\t\t\tif (!home_str) {\n\t\t\t\tpath = path2;\n\t\t\t\tgoto other;\n\t\t\t}\n\t\t\tuser_data_dir = home_str;\n\t\t\tuser_data_dir += \"/.local/share\";\n\t\t} else user_data_dir = xdg_data;\n\t\tuser_data_dir += \"/wesnoth/\";\n\t\tuser_data_dir += get_version_path_suffix();\n\t\tcreate_directory_if_missing_recursive(user_data_dir);\n\t} else {\n\t\tother:\n\t\tstd::string home = home_str ? home_str : \".\";\n\n\t\tif (path[0] == '/')\n\t\t\tuser_data_dir = path;\n\t\telse\n\t\t\tuser_data_dir = home + \"/\" + path;\n\t}\n#else\n\tif (path.empty()) path = path2;\n\n\tconst char* home_str = getenv(\"HOME\");\n\tstd::string home = home_str ? home_str : \".\";\n\n\tif (path[0] == '/')\n\t\tuser_data_dir = path;\n\telse\n\t\tuser_data_dir = home + std::string(\"/\") + path;\n#endif\n\n#endif /*_WIN32*/\n\tsetup_user_data_dir();\n}",
    "includes": [
      "#include <CoreFoundation/CFBase.h>",
      "#include <CoreFoundation/CFString.h>",
      "#include <CoreFoundation/CoreFoundation.h>",
      "#include <boost/foreach.hpp>",
      "#include \"version.hpp\"",
      "#include \"serialization/unicode.hpp\"",
      "#include \"serialization/string_utils.hpp\"",
      "#include \"scoped_resource.hpp\"",
      "#include \"log.hpp\"",
      "#include \"game_preferences.hpp\"",
      "#include \"game_config.hpp\"",
      "#include \"filesystem.hpp\"",
      "#include \"config.hpp\"",
      "#include <cstring>",
      "#include <boost/algorithm/string.hpp>",
      "#include <set>",
      "#include <iomanip>",
      "#include <fstream>",
      "#include <cerrno>",
      "#include <libgen.h>",
      "#include <dirent.h>",
      "#include <unistd.h>",
      "#include <cctype>",
      "#include \"filesystem_win32.ii\"",
      "#include <sys/stat.h>",
      "#include \"global.hpp\""
    ],
    "macros_used": [
      "#define WRN_FS LOG_STREAM(warn, log_filesystem)",
      "#define LOG_FS LOG_STREAM(info, log_filesystem)"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "setup_user_data_dir",
          "args": [],
          "line": 518
        },
        "resolved": true,
        "details": {
          "function_name": "setup_user_data_dir",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
          "lines": "527-559",
          "snippet": "static void setup_user_data_dir()\n{\n#ifdef _WIN32\n\t_mkdir(user_data_dir.c_str());\n\t_mkdir((user_data_dir + \"/editor\").c_str());\n\t_mkdir((user_data_dir + \"/editor/maps\").c_str());\n\t_mkdir((user_data_dir + \"/editor/scenarios\").c_str());\n\t_mkdir((user_data_dir + \"/data\").c_str());\n\t_mkdir((user_data_dir + \"/data/add-ons\").c_str());\n\t_mkdir((user_data_dir + \"/saves\").c_str());\n\t_mkdir((user_data_dir + \"/persist\").c_str());\n#else\n\tconst std::string& dir_path = user_data_dir;\n\n\tconst bool res = create_directory_if_missing(dir_path);\n\t// probe read permissions (if we could make the directory)\n\tDIR* const dir = res ? opendir(dir_path.c_str()) : NULL;\n\tif(dir == NULL) {\n\t\tERR_FS << \"could not open or create preferences directory at \" << dir_path << std::endl;\n\t\treturn;\n\t}\n\tclosedir(dir);\n\n\t// Create user data and add-on directories\n\tcreate_directory_if_missing(dir_path + \"/editor\");\n\tcreate_directory_if_missing(dir_path + \"/editor/maps\");\n\tcreate_directory_if_missing(dir_path + \"/editor/scenarios\");\n\tcreate_directory_if_missing(dir_path + \"/data\");\n\tcreate_directory_if_missing(dir_path + \"/data/add-ons\");\n\tcreate_directory_if_missing(dir_path + \"/saves\");\n\tcreate_directory_if_missing(dir_path + \"/persist\");\n#endif\n}",
          "includes": [
            "#include <CoreFoundation/CFBase.h>",
            "#include <CoreFoundation/CFString.h>",
            "#include <CoreFoundation/CoreFoundation.h>",
            "#include <boost/foreach.hpp>",
            "#include \"version.hpp\"",
            "#include \"serialization/unicode.hpp\"",
            "#include \"serialization/string_utils.hpp\"",
            "#include \"scoped_resource.hpp\"",
            "#include \"log.hpp\"",
            "#include \"game_preferences.hpp\"",
            "#include \"game_config.hpp\"",
            "#include \"filesystem.hpp\"",
            "#include \"config.hpp\"",
            "#include <cstring>",
            "#include <boost/algorithm/string.hpp>",
            "#include <set>",
            "#include <iomanip>",
            "#include <fstream>",
            "#include <cerrno>",
            "#include <libgen.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <cctype>",
            "#include \"filesystem_win32.ii\"",
            "#include <sys/stat.h>",
            "#include \"global.hpp\""
          ],
          "macros_used": [
            "#define ERR_FS LOG_STREAM(err, log_filesystem)"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\n#define ERR_FS LOG_STREAM(err, log_filesystem)\n\nstatic void setup_user_data_dir()\n{\n#ifdef _WIN32\n\t_mkdir(user_data_dir.c_str());\n\t_mkdir((user_data_dir + \"/editor\").c_str());\n\t_mkdir((user_data_dir + \"/editor/maps\").c_str());\n\t_mkdir((user_data_dir + \"/editor/scenarios\").c_str());\n\t_mkdir((user_data_dir + \"/data\").c_str());\n\t_mkdir((user_data_dir + \"/data/add-ons\").c_str());\n\t_mkdir((user_data_dir + \"/saves\").c_str());\n\t_mkdir((user_data_dir + \"/persist\").c_str());\n#else\n\tconst std::string& dir_path = user_data_dir;\n\n\tconst bool res = create_directory_if_missing(dir_path);\n\t// probe read permissions (if we could make the directory)\n\tDIR* const dir = res ? opendir(dir_path.c_str()) : NULL;\n\tif(dir == NULL) {\n\t\tERR_FS << \"could not open or create preferences directory at \" << dir_path << std::endl;\n\t\treturn;\n\t}\n\tclosedir(dir);\n\n\t// Create user data and add-on directories\n\tcreate_directory_if_missing(dir_path + \"/editor\");\n\tcreate_directory_if_missing(dir_path + \"/editor/maps\");\n\tcreate_directory_if_missing(dir_path + \"/editor/scenarios\");\n\tcreate_directory_if_missing(dir_path + \"/data\");\n\tcreate_directory_if_missing(dir_path + \"/data/add-ons\");\n\tcreate_directory_if_missing(dir_path + \"/saves\");\n\tcreate_directory_if_missing(dir_path + \"/persist\");\n#endif\n}"
        }
      },
      {
        "call_info": {
          "callee": "std::string",
          "args": [
            "\"/\""
          ],
          "line": 514
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getenv",
          "args": [
            "\"HOME\""
          ],
          "line": 508
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "path.empty",
          "args": [],
          "line": 506
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "create_directory_if_missing_recursive",
          "args": [
            "user_data_dir"
          ],
          "line": 495
        },
        "resolved": true,
        "details": {
          "function_name": "create_directory_if_missing_recursive",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
          "lines": "387-416",
          "snippet": "bool create_directory_if_missing_recursive(const std::string& dirname)\n{\n\tDBG_FS<<\"creating recursive directory: \"<<dirname<<'\\n';\n\tif (is_directory(dirname) == false && dirname.empty() == false)\n\t{\n\t\tstd::string tmp_dirname = dirname;\n\t\t// remove trailing slashes or backslashes\n\t\twhile ((tmp_dirname[tmp_dirname.size()-1] == '/' ||\n\t\t\t  tmp_dirname[tmp_dirname.size()-1] == '\\\\') &&\n\t\t\t  !tmp_dirname.empty())\n\t\t{\n\t\t\ttmp_dirname.erase(tmp_dirname.size()-1);\n\t\t}\n\n\t\t// create the first non-existing directory\n\t\tsize_t pos = tmp_dirname.rfind(\"/\");\n\n\t\t// we get the most right directory and *skip* it\n\t\t// we are creating it when we get back here\n\t\tif (tmp_dirname.rfind('\\\\') != std::string::npos &&\n\t\t\ttmp_dirname.rfind('\\\\') > pos )\n\t\t\tpos = tmp_dirname.rfind('\\\\');\n\n\t\tif (pos != std::string::npos)\n\t\t\tcreate_directory_if_missing_recursive(tmp_dirname.substr(0,pos));\n\n\t\treturn create_directory_if_missing(tmp_dirname);\n\t}\n\treturn create_directory_if_missing(dirname);\n}",
          "includes": [
            "#include <CoreFoundation/CFBase.h>",
            "#include <CoreFoundation/CFString.h>",
            "#include <CoreFoundation/CoreFoundation.h>",
            "#include <boost/foreach.hpp>",
            "#include \"version.hpp\"",
            "#include \"serialization/unicode.hpp\"",
            "#include \"serialization/string_utils.hpp\"",
            "#include \"scoped_resource.hpp\"",
            "#include \"log.hpp\"",
            "#include \"game_preferences.hpp\"",
            "#include \"game_config.hpp\"",
            "#include \"filesystem.hpp\"",
            "#include \"config.hpp\"",
            "#include <cstring>",
            "#include <boost/algorithm/string.hpp>",
            "#include <set>",
            "#include <iomanip>",
            "#include <fstream>",
            "#include <cerrno>",
            "#include <libgen.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <cctype>",
            "#include \"filesystem_win32.ii\"",
            "#include <sys/stat.h>",
            "#include \"global.hpp\""
          ],
          "macros_used": [
            "#define DBG_FS LOG_STREAM(debug, log_filesystem)"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\n#define DBG_FS LOG_STREAM(debug, log_filesystem)\n\nbool create_directory_if_missing_recursive(const std::string& dirname)\n{\n\tDBG_FS<<\"creating recursive directory: \"<<dirname<<'\\n';\n\tif (is_directory(dirname) == false && dirname.empty() == false)\n\t{\n\t\tstd::string tmp_dirname = dirname;\n\t\t// remove trailing slashes or backslashes\n\t\twhile ((tmp_dirname[tmp_dirname.size()-1] == '/' ||\n\t\t\t  tmp_dirname[tmp_dirname.size()-1] == '\\\\') &&\n\t\t\t  !tmp_dirname.empty())\n\t\t{\n\t\t\ttmp_dirname.erase(tmp_dirname.size()-1);\n\t\t}\n\n\t\t// create the first non-existing directory\n\t\tsize_t pos = tmp_dirname.rfind(\"/\");\n\n\t\t// we get the most right directory and *skip* it\n\t\t// we are creating it when we get back here\n\t\tif (tmp_dirname.rfind('\\\\') != std::string::npos &&\n\t\t\ttmp_dirname.rfind('\\\\') > pos )\n\t\t\tpos = tmp_dirname.rfind('\\\\');\n\n\t\tif (pos != std::string::npos)\n\t\t\tcreate_directory_if_missing_recursive(tmp_dirname.substr(0,pos));\n\n\t\treturn create_directory_if_missing(tmp_dirname);\n\t}\n\treturn create_directory_if_missing(dirname);\n}"
        }
      },
      {
        "call_info": {
          "callee": "get_version_path_suffix",
          "args": [],
          "line": 494
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getenv",
          "args": [
            "\"XDG_DATA_HOME\""
          ],
          "line": 484
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "path.empty",
          "args": [],
          "line": 483
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getenv",
          "args": [
            "\"HOME\""
          ],
          "line": 481
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_version_path_suffix",
          "args": [],
          "line": 478
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "path.empty",
          "args": [],
          "line": 475
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_cwd",
          "args": [],
          "line": 468
        },
        "resolved": true,
        "details": {
          "function_name": "get_cwd",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
          "lines": "344-359",
          "snippet": "std::string get_cwd()\n{\n\tchar buf[1024];\n\tconst char* const res = getcwd(buf,sizeof(buf));\n\tif(res != NULL) {\n\t\tstd::string str(res);\n\n#ifdef _WIN32\n\t\tstd::replace(str.begin(),str.end(),'\\\\','/');\n#endif\n\n\t\treturn str;\n\t} else {\n\t\treturn \"\";\n\t}\n}",
          "includes": [
            "#include <CoreFoundation/CFBase.h>",
            "#include <CoreFoundation/CFString.h>",
            "#include <CoreFoundation/CoreFoundation.h>",
            "#include <boost/foreach.hpp>",
            "#include \"version.hpp\"",
            "#include \"serialization/unicode.hpp\"",
            "#include \"serialization/string_utils.hpp\"",
            "#include \"scoped_resource.hpp\"",
            "#include \"log.hpp\"",
            "#include \"game_preferences.hpp\"",
            "#include \"game_config.hpp\"",
            "#include \"filesystem.hpp\"",
            "#include \"config.hpp\"",
            "#include <cstring>",
            "#include <boost/algorithm/string.hpp>",
            "#include <set>",
            "#include <iomanip>",
            "#include <fstream>",
            "#include <cerrno>",
            "#include <libgen.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <cctype>",
            "#include \"filesystem_win32.ii\"",
            "#include <sys/stat.h>",
            "#include \"global.hpp\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\nstd::string get_cwd()\n{\n\tchar buf[1024];\n\tconst char* const res = getcwd(buf,sizeof(buf));\n\tif(res != NULL) {\n\t\tstd::string str(res);\n\n#ifdef _WIN32\n\t\tstd::replace(str.begin(),str.end(),'\\\\','/');\n#endif\n\n\t\treturn str;\n\t} else {\n\t\treturn \"\";\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "boost::algorithm::replace_all",
          "args": [
            "mygames_path",
            "std::string(\"\\\\\")",
            "std::string(\"/\")"
          ],
          "line": 459
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "std::string",
          "args": [
            "\"/\""
          ],
          "line": 459
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "std::string",
          "args": [
            "\"\\\\\""
          ],
          "line": 459
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "std::string",
          "args": [
            "my_documents_path"
          ],
          "line": 458
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SHGetSpecialFolderPathA",
          "args": [
            "NULL",
            "my_documents_path",
            "5",
            "1"
          ],
          "line": 457
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "reinterpret_cast<SHGSFPAddress>",
          "args": [
            "GetProcAddress(module, \"SHGetSpecialFolderPathA\")"
          ],
          "line": 453
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "GetProcAddress",
          "args": [
            "module",
            "\"SHGetSpecialFolderPathA\""
          ],
          "line": 453
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "LoadLibraryA",
          "args": [
            "\"shell32\""
          ],
          "line": 452
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "path.size",
          "args": [],
          "line": 446
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "path.empty",
          "args": [],
          "line": 444
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\n#define WRN_FS LOG_STREAM(warn, log_filesystem)\n#define LOG_FS LOG_STREAM(info, log_filesystem)\n\nvoid set_user_data_dir(std::string path)\n{\n#ifdef _WIN32\n\tif(path.empty()) {\n\t\tuser_data_dir = get_cwd() + \"/userdata\";\n\t} else if (path.size() > 2 && path[1] == ':') {\n\t\t//allow absolute path override\n\t\tuser_data_dir = path;\n\t} else {\n\t\ttypedef BOOL (WINAPI *SHGSFPAddress)(HWND, LPSTR, int, BOOL);\n\t\tSHGSFPAddress SHGetSpecialFolderPathA;\n\t\tHMODULE module = LoadLibraryA(\"shell32\");\n\t\tSHGetSpecialFolderPathA = reinterpret_cast<SHGSFPAddress>(GetProcAddress(module, \"SHGetSpecialFolderPathA\"));\n\t\tif(SHGetSpecialFolderPathA) {\n\t\t\tLOG_FS << \"Using SHGetSpecialFolderPath to find My Documents\" << std::endl;\n\t\t\tchar my_documents_path[MAX_PATH];\n\t\t\tif(SHGetSpecialFolderPathA(NULL, my_documents_path, 5, 1)) {\n\t\t\t\tstd::string mygames_path = std::string(my_documents_path) + \"/\" + \"My Games\";\n\t\t\t\tboost::algorithm::replace_all(mygames_path, std::string(\"\\\\\"), std::string(\"/\"));\n\t\t\t\tcreate_directory_if_missing(mygames_path);\n\t\t\t\tuser_data_dir = mygames_path + \"/\" + path;\n\t\t\t} else {\n\t\t\t\tWRN_FS << \"SHGetSpecialFolderPath failed\" << std::endl;\n\t\t\t\tuser_data_dir = get_cwd() + \"/\" + path;\n\t\t\t}\n\t\t} else {\n\t\t\tLOG_FS << \"Failed to load SHGetSpecialFolderPath function\" << std::endl;\n\t\t\tuser_data_dir = get_cwd() + \"/\" + path;\n\t\t}\n\t}\n\n#else /*_WIN32*/\n\n#ifdef PREFERENCES_DIR\n\tif (path.empty()) path = PREFERENCES_DIR;\n#endif\n\n\tstd::string path2 = \".wesnoth\" + get_version_path_suffix();\n\n#ifdef _X11\n\tconst char *home_str = getenv(\"HOME\");\n\n\tif (path.empty()) {\n\t\tchar const *xdg_data = getenv(\"XDG_DATA_HOME\");\n\t\tif (!xdg_data || xdg_data[0] == '\\0') {\n\t\t\tif (!home_str) {\n\t\t\t\tpath = path2;\n\t\t\t\tgoto other;\n\t\t\t}\n\t\t\tuser_data_dir = home_str;\n\t\t\tuser_data_dir += \"/.local/share\";\n\t\t} else user_data_dir = xdg_data;\n\t\tuser_data_dir += \"/wesnoth/\";\n\t\tuser_data_dir += get_version_path_suffix();\n\t\tcreate_directory_if_missing_recursive(user_data_dir);\n\t} else {\n\t\tother:\n\t\tstd::string home = home_str ? home_str : \".\";\n\n\t\tif (path[0] == '/')\n\t\t\tuser_data_dir = path;\n\t\telse\n\t\t\tuser_data_dir = home + \"/\" + path;\n\t}\n#else\n\tif (path.empty()) path = path2;\n\n\tconst char* home_str = getenv(\"HOME\");\n\tstd::string home = home_str ? home_str : \".\";\n\n\tif (path[0] == '/')\n\t\tuser_data_dir = path;\n\telse\n\t\tuser_data_dir = home + std::string(\"/\") + path;\n#endif\n\n#endif /*_WIN32*/\n\tsetup_user_data_dir();\n}"
  },
  {
    "function_name": "create_directory_if_missing_recursive",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
    "lines": "387-416",
    "snippet": "bool create_directory_if_missing_recursive(const std::string& dirname)\n{\n\tDBG_FS<<\"creating recursive directory: \"<<dirname<<'\\n';\n\tif (is_directory(dirname) == false && dirname.empty() == false)\n\t{\n\t\tstd::string tmp_dirname = dirname;\n\t\t// remove trailing slashes or backslashes\n\t\twhile ((tmp_dirname[tmp_dirname.size()-1] == '/' ||\n\t\t\t  tmp_dirname[tmp_dirname.size()-1] == '\\\\') &&\n\t\t\t  !tmp_dirname.empty())\n\t\t{\n\t\t\ttmp_dirname.erase(tmp_dirname.size()-1);\n\t\t}\n\n\t\t// create the first non-existing directory\n\t\tsize_t pos = tmp_dirname.rfind(\"/\");\n\n\t\t// we get the most right directory and *skip* it\n\t\t// we are creating it when we get back here\n\t\tif (tmp_dirname.rfind('\\\\') != std::string::npos &&\n\t\t\ttmp_dirname.rfind('\\\\') > pos )\n\t\t\tpos = tmp_dirname.rfind('\\\\');\n\n\t\tif (pos != std::string::npos)\n\t\t\tcreate_directory_if_missing_recursive(tmp_dirname.substr(0,pos));\n\n\t\treturn create_directory_if_missing(tmp_dirname);\n\t}\n\treturn create_directory_if_missing(dirname);\n}",
    "includes": [
      "#include <CoreFoundation/CFBase.h>",
      "#include <CoreFoundation/CFString.h>",
      "#include <CoreFoundation/CoreFoundation.h>",
      "#include <boost/foreach.hpp>",
      "#include \"version.hpp\"",
      "#include \"serialization/unicode.hpp\"",
      "#include \"serialization/string_utils.hpp\"",
      "#include \"scoped_resource.hpp\"",
      "#include \"log.hpp\"",
      "#include \"game_preferences.hpp\"",
      "#include \"game_config.hpp\"",
      "#include \"filesystem.hpp\"",
      "#include \"config.hpp\"",
      "#include <cstring>",
      "#include <boost/algorithm/string.hpp>",
      "#include <set>",
      "#include <iomanip>",
      "#include <fstream>",
      "#include <cerrno>",
      "#include <libgen.h>",
      "#include <dirent.h>",
      "#include <unistd.h>",
      "#include <cctype>",
      "#include \"filesystem_win32.ii\"",
      "#include <sys/stat.h>",
      "#include \"global.hpp\""
    ],
    "macros_used": [
      "#define DBG_FS LOG_STREAM(debug, log_filesystem)"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "create_directory_if_missing",
          "args": [
            "dirname"
          ],
          "line": 415
        },
        "resolved": true,
        "details": {
          "function_name": "create_directory_if_missing_recursive",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
          "lines": "387-416",
          "snippet": "bool create_directory_if_missing_recursive(const std::string& dirname)\n{\n\tDBG_FS<<\"creating recursive directory: \"<<dirname<<'\\n';\n\tif (is_directory(dirname) == false && dirname.empty() == false)\n\t{\n\t\tstd::string tmp_dirname = dirname;\n\t\t// remove trailing slashes or backslashes\n\t\twhile ((tmp_dirname[tmp_dirname.size()-1] == '/' ||\n\t\t\t  tmp_dirname[tmp_dirname.size()-1] == '\\\\') &&\n\t\t\t  !tmp_dirname.empty())\n\t\t{\n\t\t\ttmp_dirname.erase(tmp_dirname.size()-1);\n\t\t}\n\n\t\t// create the first non-existing directory\n\t\tsize_t pos = tmp_dirname.rfind(\"/\");\n\n\t\t// we get the most right directory and *skip* it\n\t\t// we are creating it when we get back here\n\t\tif (tmp_dirname.rfind('\\\\') != std::string::npos &&\n\t\t\ttmp_dirname.rfind('\\\\') > pos )\n\t\t\tpos = tmp_dirname.rfind('\\\\');\n\n\t\tif (pos != std::string::npos)\n\t\t\tcreate_directory_if_missing_recursive(tmp_dirname.substr(0,pos));\n\n\t\treturn create_directory_if_missing(tmp_dirname);\n\t}\n\treturn create_directory_if_missing(dirname);\n}",
          "note": "cyclic_reference_detected"
        }
      },
      {
        "call_info": {
          "callee": "tmp_dirname.substr",
          "args": [
            "0",
            "pos"
          ],
          "line": 411
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tmp_dirname.rfind",
          "args": [
            "'\\\\'"
          ],
          "line": 408
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tmp_dirname.rfind",
          "args": [
            "'\\\\'"
          ],
          "line": 407
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tmp_dirname.rfind",
          "args": [
            "'\\\\'"
          ],
          "line": 406
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tmp_dirname.rfind",
          "args": [
            "\"/\""
          ],
          "line": 402
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tmp_dirname.erase",
          "args": [
            "tmp_dirname.size()-1"
          ],
          "line": 398
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tmp_dirname.size",
          "args": [],
          "line": 398
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tmp_dirname.empty",
          "args": [],
          "line": 396
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tmp_dirname.size",
          "args": [],
          "line": 395
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tmp_dirname.size",
          "args": [],
          "line": 394
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dirname.empty",
          "args": [],
          "line": 390
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "is_directory",
          "args": [
            "dirname"
          ],
          "line": 390
        },
        "resolved": true,
        "details": {
          "function_name": "is_directory",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
          "lines": "708-719",
          "snippet": "bool is_directory(const std::string& fname)\n{\n\tif(fname.empty()) {\n\t\treturn false;\n\t}\n\tif(fname[0] != '/' && !game_config::path.empty()) {\n\t\tif(is_directory_internal(game_config::path + \"/\" + fname))\n\t\t\treturn true;\n\t}\n\n\treturn is_directory_internal(fname);\n}",
          "includes": [
            "#include <CoreFoundation/CFBase.h>",
            "#include <CoreFoundation/CFString.h>",
            "#include <CoreFoundation/CoreFoundation.h>",
            "#include <boost/foreach.hpp>",
            "#include \"version.hpp\"",
            "#include \"serialization/unicode.hpp\"",
            "#include \"serialization/string_utils.hpp\"",
            "#include \"scoped_resource.hpp\"",
            "#include \"log.hpp\"",
            "#include \"game_preferences.hpp\"",
            "#include \"game_config.hpp\"",
            "#include \"filesystem.hpp\"",
            "#include \"config.hpp\"",
            "#include <cstring>",
            "#include <boost/algorithm/string.hpp>",
            "#include <set>",
            "#include <iomanip>",
            "#include <fstream>",
            "#include <cerrno>",
            "#include <libgen.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <cctype>",
            "#include \"filesystem_win32.ii\"",
            "#include <sys/stat.h>",
            "#include \"global.hpp\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\nbool is_directory(const std::string& fname)\n{\n\tif(fname.empty()) {\n\t\treturn false;\n\t}\n\tif(fname[0] != '/' && !game_config::path.empty()) {\n\t\tif(is_directory_internal(game_config::path + \"/\" + fname))\n\t\t\treturn true;\n\t}\n\n\treturn is_directory_internal(fname);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\n#define DBG_FS LOG_STREAM(debug, log_filesystem)\n\nbool create_directory_if_missing_recursive(const std::string& dirname)\n{\n\tDBG_FS<<\"creating recursive directory: \"<<dirname<<'\\n';\n\tif (is_directory(dirname) == false && dirname.empty() == false)\n\t{\n\t\tstd::string tmp_dirname = dirname;\n\t\t// remove trailing slashes or backslashes\n\t\twhile ((tmp_dirname[tmp_dirname.size()-1] == '/' ||\n\t\t\t  tmp_dirname[tmp_dirname.size()-1] == '\\\\') &&\n\t\t\t  !tmp_dirname.empty())\n\t\t{\n\t\t\ttmp_dirname.erase(tmp_dirname.size()-1);\n\t\t}\n\n\t\t// create the first non-existing directory\n\t\tsize_t pos = tmp_dirname.rfind(\"/\");\n\n\t\t// we get the most right directory and *skip* it\n\t\t// we are creating it when we get back here\n\t\tif (tmp_dirname.rfind('\\\\') != std::string::npos &&\n\t\t\ttmp_dirname.rfind('\\\\') > pos )\n\t\t\tpos = tmp_dirname.rfind('\\\\');\n\n\t\tif (pos != std::string::npos)\n\t\t\tcreate_directory_if_missing_recursive(tmp_dirname.substr(0,pos));\n\n\t\treturn create_directory_if_missing(tmp_dirname);\n\t}\n\treturn create_directory_if_missing(dirname);\n}"
  },
  {
    "function_name": "create_directory_if_missing",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
    "lines": "375-386",
    "snippet": "bool create_directory_if_missing(const std::string& dirname)\n{\n\tif(is_directory(dirname)) {\n\t\tDBG_FS << \"directory \" << dirname << \" exists, not creating\" << std::endl;\n\t\treturn true;\n\t} else if(file_exists(dirname)) {\n\t\tERR_FS << \"cannot create directory \" << dirname << \"; file exists\" << std::endl;\n\t\treturn false;\n\t}\n\tDBG_FS << \"creating missing directory \" << dirname << '\\n';\n\treturn make_directory(dirname);\n}",
    "includes": [
      "#include <CoreFoundation/CFBase.h>",
      "#include <CoreFoundation/CFString.h>",
      "#include <CoreFoundation/CoreFoundation.h>",
      "#include <boost/foreach.hpp>",
      "#include \"version.hpp\"",
      "#include \"serialization/unicode.hpp\"",
      "#include \"serialization/string_utils.hpp\"",
      "#include \"scoped_resource.hpp\"",
      "#include \"log.hpp\"",
      "#include \"game_preferences.hpp\"",
      "#include \"game_config.hpp\"",
      "#include \"filesystem.hpp\"",
      "#include \"config.hpp\"",
      "#include <cstring>",
      "#include <boost/algorithm/string.hpp>",
      "#include <set>",
      "#include <iomanip>",
      "#include <fstream>",
      "#include <cerrno>",
      "#include <libgen.h>",
      "#include <dirent.h>",
      "#include <unistd.h>",
      "#include <cctype>",
      "#include \"filesystem_win32.ii\"",
      "#include <sys/stat.h>",
      "#include \"global.hpp\""
    ],
    "macros_used": [
      "#define ERR_FS LOG_STREAM(err, log_filesystem)",
      "#define DBG_FS LOG_STREAM(debug, log_filesystem)"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "make_directory",
          "args": [
            "dirname"
          ],
          "line": 385
        },
        "resolved": true,
        "details": {
          "function_name": "make_directory",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
          "lines": "287-290",
          "snippet": "bool make_directory(const std::string& path)\n{\n\treturn (mkdir(path.c_str(),AccessMode) == 0);\n}",
          "includes": [
            "#include <CoreFoundation/CFBase.h>",
            "#include <CoreFoundation/CFString.h>",
            "#include <CoreFoundation/CoreFoundation.h>",
            "#include <boost/foreach.hpp>",
            "#include \"version.hpp\"",
            "#include \"serialization/unicode.hpp\"",
            "#include \"serialization/string_utils.hpp\"",
            "#include \"scoped_resource.hpp\"",
            "#include \"log.hpp\"",
            "#include \"game_preferences.hpp\"",
            "#include \"game_config.hpp\"",
            "#include \"filesystem.hpp\"",
            "#include \"config.hpp\"",
            "#include <cstring>",
            "#include <boost/algorithm/string.hpp>",
            "#include <set>",
            "#include <iomanip>",
            "#include <fstream>",
            "#include <cerrno>",
            "#include <libgen.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <cctype>",
            "#include \"filesystem_win32.ii\"",
            "#include <sys/stat.h>",
            "#include \"global.hpp\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\nbool make_directory(const std::string& path)\n{\n\treturn (mkdir(path.c_str(),AccessMode) == 0);\n}"
        }
      },
      {
        "call_info": {
          "callee": "file_exists",
          "args": [
            "dirname"
          ],
          "line": 380
        },
        "resolved": true,
        "details": {
          "function_name": "file_exists",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
          "lines": "721-730",
          "snippet": "bool file_exists(const std::string& name)\n{\n#ifdef _WIN32\n       struct stat st;\n       return (::stat(name.c_str(), &st) == 0);\n#else\n\tstruct stat st;\n\treturn (::stat(name.c_str(), &st) != -1);\n#endif\n}",
          "includes": [
            "#include <CoreFoundation/CFBase.h>",
            "#include <CoreFoundation/CFString.h>",
            "#include <CoreFoundation/CoreFoundation.h>",
            "#include <boost/foreach.hpp>",
            "#include \"version.hpp\"",
            "#include \"serialization/unicode.hpp\"",
            "#include \"serialization/string_utils.hpp\"",
            "#include \"scoped_resource.hpp\"",
            "#include \"log.hpp\"",
            "#include \"game_preferences.hpp\"",
            "#include \"game_config.hpp\"",
            "#include \"filesystem.hpp\"",
            "#include \"config.hpp\"",
            "#include <cstring>",
            "#include <boost/algorithm/string.hpp>",
            "#include <set>",
            "#include <iomanip>",
            "#include <fstream>",
            "#include <cerrno>",
            "#include <libgen.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <cctype>",
            "#include \"filesystem_win32.ii\"",
            "#include <sys/stat.h>",
            "#include \"global.hpp\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\nbool file_exists(const std::string& name)\n{\n#ifdef _WIN32\n       struct stat st;\n       return (::stat(name.c_str(), &st) == 0);\n#else\n\tstruct stat st;\n\treturn (::stat(name.c_str(), &st) != -1);\n#endif\n}"
        }
      },
      {
        "call_info": {
          "callee": "is_directory",
          "args": [
            "dirname"
          ],
          "line": 377
        },
        "resolved": true,
        "details": {
          "function_name": "is_directory",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
          "lines": "708-719",
          "snippet": "bool is_directory(const std::string& fname)\n{\n\tif(fname.empty()) {\n\t\treturn false;\n\t}\n\tif(fname[0] != '/' && !game_config::path.empty()) {\n\t\tif(is_directory_internal(game_config::path + \"/\" + fname))\n\t\t\treturn true;\n\t}\n\n\treturn is_directory_internal(fname);\n}",
          "includes": [
            "#include <CoreFoundation/CFBase.h>",
            "#include <CoreFoundation/CFString.h>",
            "#include <CoreFoundation/CoreFoundation.h>",
            "#include <boost/foreach.hpp>",
            "#include \"version.hpp\"",
            "#include \"serialization/unicode.hpp\"",
            "#include \"serialization/string_utils.hpp\"",
            "#include \"scoped_resource.hpp\"",
            "#include \"log.hpp\"",
            "#include \"game_preferences.hpp\"",
            "#include \"game_config.hpp\"",
            "#include \"filesystem.hpp\"",
            "#include \"config.hpp\"",
            "#include <cstring>",
            "#include <boost/algorithm/string.hpp>",
            "#include <set>",
            "#include <iomanip>",
            "#include <fstream>",
            "#include <cerrno>",
            "#include <libgen.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <cctype>",
            "#include \"filesystem_win32.ii\"",
            "#include <sys/stat.h>",
            "#include \"global.hpp\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\nbool is_directory(const std::string& fname)\n{\n\tif(fname.empty()) {\n\t\treturn false;\n\t}\n\tif(fname[0] != '/' && !game_config::path.empty()) {\n\t\tif(is_directory_internal(game_config::path + \"/\" + fname))\n\t\t\treturn true;\n\t}\n\n\treturn is_directory_internal(fname);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\n#define ERR_FS LOG_STREAM(err, log_filesystem)\n#define DBG_FS LOG_STREAM(debug, log_filesystem)\n\nbool create_directory_if_missing(const std::string& dirname)\n{\n\tif(is_directory(dirname)) {\n\t\tDBG_FS << \"directory \" << dirname << \" exists, not creating\" << std::endl;\n\t\treturn true;\n\t} else if(file_exists(dirname)) {\n\t\tERR_FS << \"cannot create directory \" << dirname << \"; file exists\" << std::endl;\n\t\treturn false;\n\t}\n\tDBG_FS << \"creating missing directory \" << dirname << '\\n';\n\treturn make_directory(dirname);\n}"
  },
  {
    "function_name": "get_exe_dir",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
    "lines": "361-373",
    "snippet": "std::string get_exe_dir()\n{\n#ifndef _WIN32\n\tchar buf[1024];\n\tsize_t path_size = readlink(\"/proc/self/exe\", buf, sizeof(buf)-1);\n\tif(path_size == static_cast<size_t>(-1))\n\t\treturn std::string();\n\tbuf[path_size] = 0;\n\treturn std::string(dirname(buf));\n#else\n\treturn get_cwd();\n#endif\n}",
    "includes": [
      "#include <CoreFoundation/CFBase.h>",
      "#include <CoreFoundation/CFString.h>",
      "#include <CoreFoundation/CoreFoundation.h>",
      "#include <boost/foreach.hpp>",
      "#include \"version.hpp\"",
      "#include \"serialization/unicode.hpp\"",
      "#include \"serialization/string_utils.hpp\"",
      "#include \"scoped_resource.hpp\"",
      "#include \"log.hpp\"",
      "#include \"game_preferences.hpp\"",
      "#include \"game_config.hpp\"",
      "#include \"filesystem.hpp\"",
      "#include \"config.hpp\"",
      "#include <cstring>",
      "#include <boost/algorithm/string.hpp>",
      "#include <set>",
      "#include <iomanip>",
      "#include <fstream>",
      "#include <cerrno>",
      "#include <libgen.h>",
      "#include <dirent.h>",
      "#include <unistd.h>",
      "#include <cctype>",
      "#include \"filesystem_win32.ii\"",
      "#include <sys/stat.h>",
      "#include \"global.hpp\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "get_cwd",
          "args": [],
          "line": 371
        },
        "resolved": true,
        "details": {
          "function_name": "get_cwd",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
          "lines": "344-359",
          "snippet": "std::string get_cwd()\n{\n\tchar buf[1024];\n\tconst char* const res = getcwd(buf,sizeof(buf));\n\tif(res != NULL) {\n\t\tstd::string str(res);\n\n#ifdef _WIN32\n\t\tstd::replace(str.begin(),str.end(),'\\\\','/');\n#endif\n\n\t\treturn str;\n\t} else {\n\t\treturn \"\";\n\t}\n}",
          "includes": [
            "#include <CoreFoundation/CFBase.h>",
            "#include <CoreFoundation/CFString.h>",
            "#include <CoreFoundation/CoreFoundation.h>",
            "#include <boost/foreach.hpp>",
            "#include \"version.hpp\"",
            "#include \"serialization/unicode.hpp\"",
            "#include \"serialization/string_utils.hpp\"",
            "#include \"scoped_resource.hpp\"",
            "#include \"log.hpp\"",
            "#include \"game_preferences.hpp\"",
            "#include \"game_config.hpp\"",
            "#include \"filesystem.hpp\"",
            "#include \"config.hpp\"",
            "#include <cstring>",
            "#include <boost/algorithm/string.hpp>",
            "#include <set>",
            "#include <iomanip>",
            "#include <fstream>",
            "#include <cerrno>",
            "#include <libgen.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <cctype>",
            "#include \"filesystem_win32.ii\"",
            "#include <sys/stat.h>",
            "#include \"global.hpp\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\nstd::string get_cwd()\n{\n\tchar buf[1024];\n\tconst char* const res = getcwd(buf,sizeof(buf));\n\tif(res != NULL) {\n\t\tstd::string str(res);\n\n#ifdef _WIN32\n\t\tstd::replace(str.begin(),str.end(),'\\\\','/');\n#endif\n\n\t\treturn str;\n\t} else {\n\t\treturn \"\";\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "std::string",
          "args": [
            "dirname(buf)"
          ],
          "line": 369
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dirname",
          "args": [
            "buf"
          ],
          "line": 369
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "std::string",
          "args": [],
          "line": 367
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "static_cast<size_t>",
          "args": [
            "-1"
          ],
          "line": 366
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "readlink",
          "args": [
            "\"/proc/self/exe\"",
            "buf",
            "sizeof(buf)-1"
          ],
          "line": 365
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\nstd::string get_exe_dir()\n{\n#ifndef _WIN32\n\tchar buf[1024];\n\tsize_t path_size = readlink(\"/proc/self/exe\", buf, sizeof(buf)-1);\n\tif(path_size == static_cast<size_t>(-1))\n\t\treturn std::string();\n\tbuf[path_size] = 0;\n\treturn std::string(dirname(buf));\n#else\n\treturn get_cwd();\n#endif\n}"
  },
  {
    "function_name": "get_cwd",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
    "lines": "344-359",
    "snippet": "std::string get_cwd()\n{\n\tchar buf[1024];\n\tconst char* const res = getcwd(buf,sizeof(buf));\n\tif(res != NULL) {\n\t\tstd::string str(res);\n\n#ifdef _WIN32\n\t\tstd::replace(str.begin(),str.end(),'\\\\','/');\n#endif\n\n\t\treturn str;\n\t} else {\n\t\treturn \"\";\n\t}\n}",
    "includes": [
      "#include <CoreFoundation/CFBase.h>",
      "#include <CoreFoundation/CFString.h>",
      "#include <CoreFoundation/CoreFoundation.h>",
      "#include <boost/foreach.hpp>",
      "#include \"version.hpp\"",
      "#include \"serialization/unicode.hpp\"",
      "#include \"serialization/string_utils.hpp\"",
      "#include \"scoped_resource.hpp\"",
      "#include \"log.hpp\"",
      "#include \"game_preferences.hpp\"",
      "#include \"game_config.hpp\"",
      "#include \"filesystem.hpp\"",
      "#include \"config.hpp\"",
      "#include <cstring>",
      "#include <boost/algorithm/string.hpp>",
      "#include <set>",
      "#include <iomanip>",
      "#include <fstream>",
      "#include <cerrno>",
      "#include <libgen.h>",
      "#include <dirent.h>",
      "#include <unistd.h>",
      "#include <cctype>",
      "#include \"filesystem_win32.ii\"",
      "#include <sys/stat.h>",
      "#include \"global.hpp\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "std::replace",
          "args": [
            "str.begin()",
            "str.end()",
            "'\\\\'",
            "'/'"
          ],
          "line": 352
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "str.end",
          "args": [],
          "line": 352
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "str.begin",
          "args": [],
          "line": 352
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getcwd",
          "args": [
            "buf",
            "sizeof(buf)"
          ],
          "line": 347
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\nstd::string get_cwd()\n{\n\tchar buf[1024];\n\tconst char* const res = getcwd(buf,sizeof(buf));\n\tif(res != NULL) {\n\t\tstd::string str(res);\n\n#ifdef _WIN32\n\t\tstd::replace(str.begin(),str.end(),'\\\\','/');\n#endif\n\n\t\treturn str;\n\t} else {\n\t\treturn \"\";\n\t}\n}"
  },
  {
    "function_name": "delete_file",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
    "lines": "334-342",
    "snippet": "bool delete_file(const std::string& path)\n{\n\tbool ret = true;\n\tif(remove(path.c_str()) != 0 && errno != ENOENT) {\n\t\tERR_FS << \"remove(\" << path << \"): \" << strerror(errno) << \"\\n\";\n\t\tret = false;\n\t}\n\treturn ret;\n}",
    "includes": [
      "#include <CoreFoundation/CFBase.h>",
      "#include <CoreFoundation/CFString.h>",
      "#include <CoreFoundation/CoreFoundation.h>",
      "#include <boost/foreach.hpp>",
      "#include \"version.hpp\"",
      "#include \"serialization/unicode.hpp\"",
      "#include \"serialization/string_utils.hpp\"",
      "#include \"scoped_resource.hpp\"",
      "#include \"log.hpp\"",
      "#include \"game_preferences.hpp\"",
      "#include \"game_config.hpp\"",
      "#include \"filesystem.hpp\"",
      "#include \"config.hpp\"",
      "#include <cstring>",
      "#include <boost/algorithm/string.hpp>",
      "#include <set>",
      "#include <iomanip>",
      "#include <fstream>",
      "#include <cerrno>",
      "#include <libgen.h>",
      "#include <dirent.h>",
      "#include <unistd.h>",
      "#include <cctype>",
      "#include \"filesystem_win32.ii\"",
      "#include <sys/stat.h>",
      "#include \"global.hpp\""
    ],
    "macros_used": [
      "#define ERR_FS LOG_STREAM(err, log_filesystem)"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "strerror",
          "args": [
            "errno"
          ],
          "line": 338
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "remove",
          "args": [
            "path.c_str()"
          ],
          "line": 337
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "path.c_str",
          "args": [],
          "line": 337
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\n#define ERR_FS LOG_STREAM(err, log_filesystem)\n\nbool delete_file(const std::string& path)\n{\n\tbool ret = true;\n\tif(remove(path.c_str()) != 0 && errno != ENOENT) {\n\t\tERR_FS << \"remove(\" << path << \"): \" << strerror(errno) << \"\\n\";\n\t\tret = false;\n\t}\n\treturn ret;\n}"
  },
  {
    "function_name": "delete_directory",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
    "lines": "294-333",
    "snippet": "bool delete_directory(const std::string& path, const bool keep_pbl)\n{\n\tbool ret = true;\n\tstd::vector<std::string> files;\n\tstd::vector<std::string> dirs;\n\n\tget_files_in_dir(path, &files, &dirs, ENTIRE_FILE_PATH, keep_pbl ? SKIP_PBL_FILES : NO_FILTER);\n\n\tif(!files.empty()) {\n\t\tfor(std::vector<std::string>::const_iterator i = files.begin(); i != files.end(); ++i) {\n\t\t\terrno = 0;\n\t\t\tif(remove((*i).c_str()) != 0) {\n\t\t\t\tLOG_FS << \"remove(\" << (*i) << \"): \" << strerror(errno) << std::endl;\n\t\t\t\tret = false;\n\t\t\t}\n\t\t}\n\t}\n\n\tif(!dirs.empty()) {\n\t\tfor(std::vector<std::string>::const_iterator j = dirs.begin(); j != dirs.end(); ++j) {\n\t\t\tif(!delete_directory(*j))\n\t\t\t\tret = false;\n\t\t}\n\t}\n\n\terrno = 0;\n#ifdef _WIN32\n\t// remove() doesn't delete directories on windows.\n\tint (*remove)(const char*);\n\tif(is_directory(path))\n\t\tremove = rmdir;\n\telse\n\t\tremove = ::remove;\n#endif\n\tif(remove(path.c_str()) != 0) {\n\t\tLOG_FS << \"remove(\" << path << \"): \" << strerror(errno) << std::endl;\n\t\tret = false;\n\t}\n\treturn ret;\n}",
    "includes": [
      "#include <CoreFoundation/CFBase.h>",
      "#include <CoreFoundation/CFString.h>",
      "#include <CoreFoundation/CoreFoundation.h>",
      "#include <boost/foreach.hpp>",
      "#include \"version.hpp\"",
      "#include \"serialization/unicode.hpp\"",
      "#include \"serialization/string_utils.hpp\"",
      "#include \"scoped_resource.hpp\"",
      "#include \"log.hpp\"",
      "#include \"game_preferences.hpp\"",
      "#include \"game_config.hpp\"",
      "#include \"filesystem.hpp\"",
      "#include \"config.hpp\"",
      "#include <cstring>",
      "#include <boost/algorithm/string.hpp>",
      "#include <set>",
      "#include <iomanip>",
      "#include <fstream>",
      "#include <cerrno>",
      "#include <libgen.h>",
      "#include <dirent.h>",
      "#include <unistd.h>",
      "#include <cctype>",
      "#include \"filesystem_win32.ii\"",
      "#include <sys/stat.h>",
      "#include \"global.hpp\""
    ],
    "macros_used": [
      "#define LOG_FS LOG_STREAM(info, log_filesystem)"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "strerror",
          "args": [
            "errno"
          ],
          "line": 329
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "remove",
          "args": [
            "path.c_str()"
          ],
          "line": 328
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "path.c_str",
          "args": [],
          "line": 328
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "is_directory",
          "args": [
            "path"
          ],
          "line": 323
        },
        "resolved": true,
        "details": {
          "function_name": "is_directory",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
          "lines": "708-719",
          "snippet": "bool is_directory(const std::string& fname)\n{\n\tif(fname.empty()) {\n\t\treturn false;\n\t}\n\tif(fname[0] != '/' && !game_config::path.empty()) {\n\t\tif(is_directory_internal(game_config::path + \"/\" + fname))\n\t\t\treturn true;\n\t}\n\n\treturn is_directory_internal(fname);\n}",
          "includes": [
            "#include <CoreFoundation/CFBase.h>",
            "#include <CoreFoundation/CFString.h>",
            "#include <CoreFoundation/CoreFoundation.h>",
            "#include <boost/foreach.hpp>",
            "#include \"version.hpp\"",
            "#include \"serialization/unicode.hpp\"",
            "#include \"serialization/string_utils.hpp\"",
            "#include \"scoped_resource.hpp\"",
            "#include \"log.hpp\"",
            "#include \"game_preferences.hpp\"",
            "#include \"game_config.hpp\"",
            "#include \"filesystem.hpp\"",
            "#include \"config.hpp\"",
            "#include <cstring>",
            "#include <boost/algorithm/string.hpp>",
            "#include <set>",
            "#include <iomanip>",
            "#include <fstream>",
            "#include <cerrno>",
            "#include <libgen.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <cctype>",
            "#include \"filesystem_win32.ii\"",
            "#include <sys/stat.h>",
            "#include \"global.hpp\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\nbool is_directory(const std::string& fname)\n{\n\tif(fname.empty()) {\n\t\treturn false;\n\t}\n\tif(fname[0] != '/' && !game_config::path.empty()) {\n\t\tif(is_directory_internal(game_config::path + \"/\" + fname))\n\t\t\treturn true;\n\t}\n\n\treturn is_directory_internal(fname);\n}"
        }
      },
      {
        "call_info": {
          "callee": "delete_directory",
          "args": [
            "*j"
          ],
          "line": 314
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dirs.end",
          "args": [],
          "line": 313
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dirs.begin",
          "args": [],
          "line": 313
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dirs.empty",
          "args": [],
          "line": 312
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strerror",
          "args": [
            "errno"
          ],
          "line": 306
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "remove",
          "args": [
            "(*i).c_str()"
          ],
          "line": 305
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "",
          "args": [],
          "line": 305
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "files.end",
          "args": [],
          "line": 303
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "files.begin",
          "args": [],
          "line": 303
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "files.empty",
          "args": [],
          "line": 302
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_files_in_dir",
          "args": [
            "path",
            "&files",
            "&dirs",
            "ENTIRE_FILE_PATH",
            "keep_pbl ? SKIP_PBL_FILES : NO_FILTER"
          ],
          "line": 300
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\n#define LOG_FS LOG_STREAM(info, log_filesystem)\n\nbool delete_directory(const std::string& path, const bool keep_pbl)\n{\n\tbool ret = true;\n\tstd::vector<std::string> files;\n\tstd::vector<std::string> dirs;\n\n\tget_files_in_dir(path, &files, &dirs, ENTIRE_FILE_PATH, keep_pbl ? SKIP_PBL_FILES : NO_FILTER);\n\n\tif(!files.empty()) {\n\t\tfor(std::vector<std::string>::const_iterator i = files.begin(); i != files.end(); ++i) {\n\t\t\terrno = 0;\n\t\t\tif(remove((*i).c_str()) != 0) {\n\t\t\t\tLOG_FS << \"remove(\" << (*i) << \"): \" << strerror(errno) << std::endl;\n\t\t\t\tret = false;\n\t\t\t}\n\t\t}\n\t}\n\n\tif(!dirs.empty()) {\n\t\tfor(std::vector<std::string>::const_iterator j = dirs.begin(); j != dirs.end(); ++j) {\n\t\t\tif(!delete_directory(*j))\n\t\t\t\tret = false;\n\t\t}\n\t}\n\n\terrno = 0;\n#ifdef _WIN32\n\t// remove() doesn't delete directories on windows.\n\tint (*remove)(const char*);\n\tif(is_directory(path))\n\t\tremove = rmdir;\n\telse\n\t\tremove = ::remove;\n#endif\n\tif(remove(path.c_str()) != 0) {\n\t\tLOG_FS << \"remove(\" << path << \"): \" << strerror(errno) << std::endl;\n\t\tret = false;\n\t}\n\treturn ret;\n}"
  },
  {
    "function_name": "make_directory",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
    "lines": "287-290",
    "snippet": "bool make_directory(const std::string& path)\n{\n\treturn (mkdir(path.c_str(),AccessMode) == 0);\n}",
    "includes": [
      "#include <CoreFoundation/CFBase.h>",
      "#include <CoreFoundation/CFString.h>",
      "#include <CoreFoundation/CoreFoundation.h>",
      "#include <boost/foreach.hpp>",
      "#include \"version.hpp\"",
      "#include \"serialization/unicode.hpp\"",
      "#include \"serialization/string_utils.hpp\"",
      "#include \"scoped_resource.hpp\"",
      "#include \"log.hpp\"",
      "#include \"game_preferences.hpp\"",
      "#include \"game_config.hpp\"",
      "#include \"filesystem.hpp\"",
      "#include \"config.hpp\"",
      "#include <cstring>",
      "#include <boost/algorithm/string.hpp>",
      "#include <set>",
      "#include <iomanip>",
      "#include <fstream>",
      "#include <cerrno>",
      "#include <libgen.h>",
      "#include <dirent.h>",
      "#include <unistd.h>",
      "#include <cctype>",
      "#include \"filesystem_win32.ii\"",
      "#include <sys/stat.h>",
      "#include \"global.hpp\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "mkdir",
          "args": [
            "path.c_str()",
            "AccessMode"
          ],
          "line": 289
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "path.c_str",
          "args": [],
          "line": 289
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\nbool make_directory(const std::string& path)\n{\n\treturn (mkdir(path.c_str(),AccessMode) == 0);\n}"
  },
  {
    "function_name": "get_dir",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
    "lines": "267-285",
    "snippet": "std::string get_dir(const std::string& dir_path)\n{\n\tDIR* dir = opendir(dir_path.c_str());\n\tif(dir == NULL) {\n\t\tconst int res = mkdir(dir_path.c_str(),AccessMode);\n\t\tif(res == 0) {\n\t\t\tdir = opendir(dir_path.c_str());\n\t\t} else {\n\t\t\tERR_FS << \"could not open or create directory: \" << dir_path << std::endl;\n\t\t}\n\t}\n\n\tif(dir == NULL)\n\t\treturn \"\";\n\n\tclosedir(dir);\n\n\treturn dir_path;\n}",
    "includes": [
      "#include <CoreFoundation/CFBase.h>",
      "#include <CoreFoundation/CFString.h>",
      "#include <CoreFoundation/CoreFoundation.h>",
      "#include <boost/foreach.hpp>",
      "#include \"version.hpp\"",
      "#include \"serialization/unicode.hpp\"",
      "#include \"serialization/string_utils.hpp\"",
      "#include \"scoped_resource.hpp\"",
      "#include \"log.hpp\"",
      "#include \"game_preferences.hpp\"",
      "#include \"game_config.hpp\"",
      "#include \"filesystem.hpp\"",
      "#include \"config.hpp\"",
      "#include <cstring>",
      "#include <boost/algorithm/string.hpp>",
      "#include <set>",
      "#include <iomanip>",
      "#include <fstream>",
      "#include <cerrno>",
      "#include <libgen.h>",
      "#include <dirent.h>",
      "#include <unistd.h>",
      "#include <cctype>",
      "#include \"filesystem_win32.ii\"",
      "#include <sys/stat.h>",
      "#include \"global.hpp\""
    ],
    "macros_used": [
      "#define ERR_FS LOG_STREAM(err, log_filesystem)"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "closedir",
          "args": [
            "dir"
          ],
          "line": 282
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "opendir",
          "args": [
            "dir_path.c_str()"
          ],
          "line": 273
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dir_path.c_str",
          "args": [],
          "line": 273
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mkdir",
          "args": [
            "dir_path.c_str()",
            "AccessMode"
          ],
          "line": 271
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dir_path.c_str",
          "args": [],
          "line": 271
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "opendir",
          "args": [
            "dir_path.c_str()"
          ],
          "line": 269
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dir_path.c_str",
          "args": [],
          "line": 269
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\n#define ERR_FS LOG_STREAM(err, log_filesystem)\n\nstd::string get_dir(const std::string& dir_path)\n{\n\tDIR* dir = opendir(dir_path.c_str());\n\tif(dir == NULL) {\n\t\tconst int res = mkdir(dir_path.c_str(),AccessMode);\n\t\tif(res == 0) {\n\t\t\tdir = opendir(dir_path.c_str());\n\t\t} else {\n\t\t\tERR_FS << \"could not open or create directory: \" << dir_path << std::endl;\n\t\t}\n\t}\n\n\tif(dir == NULL)\n\t\treturn \"\";\n\n\tclosedir(dir);\n\n\treturn dir_path;\n}"
  },
  {
    "function_name": "get_next_filename",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
    "lines": "247-264",
    "snippet": "std::string get_next_filename(const std::string& name, const std::string& extension)\n{\n\tstd::string next_filename;\n\tint counter = 0;\n\n\tdo {\n\t\tstd::stringstream filename;\n\n\t\tfilename << name;\n\t\tfilename.width(3);\n\t\tfilename.fill('0');\n\t\tfilename.setf(std::ios_base::right);\n\t\tfilename << counter << extension;\n\t\tcounter++;\n\t\tnext_filename = filename.str();\n\t} while(file_exists(next_filename) && counter < 1000);\n\treturn next_filename;\n}",
    "includes": [
      "#include <CoreFoundation/CFBase.h>",
      "#include <CoreFoundation/CFString.h>",
      "#include <CoreFoundation/CoreFoundation.h>",
      "#include <boost/foreach.hpp>",
      "#include \"version.hpp\"",
      "#include \"serialization/unicode.hpp\"",
      "#include \"serialization/string_utils.hpp\"",
      "#include \"scoped_resource.hpp\"",
      "#include \"log.hpp\"",
      "#include \"game_preferences.hpp\"",
      "#include \"game_config.hpp\"",
      "#include \"filesystem.hpp\"",
      "#include \"config.hpp\"",
      "#include <cstring>",
      "#include <boost/algorithm/string.hpp>",
      "#include <set>",
      "#include <iomanip>",
      "#include <fstream>",
      "#include <cerrno>",
      "#include <libgen.h>",
      "#include <dirent.h>",
      "#include <unistd.h>",
      "#include <cctype>",
      "#include \"filesystem_win32.ii\"",
      "#include <sys/stat.h>",
      "#include \"global.hpp\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "file_exists",
          "args": [
            "next_filename"
          ],
          "line": 262
        },
        "resolved": true,
        "details": {
          "function_name": "file_exists",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
          "lines": "721-730",
          "snippet": "bool file_exists(const std::string& name)\n{\n#ifdef _WIN32\n       struct stat st;\n       return (::stat(name.c_str(), &st) == 0);\n#else\n\tstruct stat st;\n\treturn (::stat(name.c_str(), &st) != -1);\n#endif\n}",
          "includes": [
            "#include <CoreFoundation/CFBase.h>",
            "#include <CoreFoundation/CFString.h>",
            "#include <CoreFoundation/CoreFoundation.h>",
            "#include <boost/foreach.hpp>",
            "#include \"version.hpp\"",
            "#include \"serialization/unicode.hpp\"",
            "#include \"serialization/string_utils.hpp\"",
            "#include \"scoped_resource.hpp\"",
            "#include \"log.hpp\"",
            "#include \"game_preferences.hpp\"",
            "#include \"game_config.hpp\"",
            "#include \"filesystem.hpp\"",
            "#include \"config.hpp\"",
            "#include <cstring>",
            "#include <boost/algorithm/string.hpp>",
            "#include <set>",
            "#include <iomanip>",
            "#include <fstream>",
            "#include <cerrno>",
            "#include <libgen.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <cctype>",
            "#include \"filesystem_win32.ii\"",
            "#include <sys/stat.h>",
            "#include \"global.hpp\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\nbool file_exists(const std::string& name)\n{\n#ifdef _WIN32\n       struct stat st;\n       return (::stat(name.c_str(), &st) == 0);\n#else\n\tstruct stat st;\n\treturn (::stat(name.c_str(), &st) != -1);\n#endif\n}"
        }
      },
      {
        "call_info": {
          "callee": "filename.str",
          "args": [],
          "line": 261
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "filename.setf",
          "args": [
            "std::ios_base::right"
          ],
          "line": 258
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "filename.fill",
          "args": [
            "'0'"
          ],
          "line": 257
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "filename.width",
          "args": [
            "3"
          ],
          "line": 256
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\nstd::string get_next_filename(const std::string& name, const std::string& extension)\n{\n\tstd::string next_filename;\n\tint counter = 0;\n\n\tdo {\n\t\tstd::stringstream filename;\n\n\t\tfilename << name;\n\t\tfilename.width(3);\n\t\tfilename.fill('0');\n\t\tfilename.setf(std::ios_base::right);\n\t\tfilename << counter << extension;\n\t\tcounter++;\n\t\tnext_filename = filename.str();\n\t} while(file_exists(next_filename) && counter < 1000);\n\treturn next_filename;\n}"
  },
  {
    "function_name": "get_files_in_dir",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
    "lines": "85-245",
    "snippet": "void get_files_in_dir(const std::string &directory,\n\t\t\t\t\t  std::vector<std::string>* files,\n\t\t\t\t\t  std::vector<std::string>* dirs,\n\t\t\t\t\t  file_name_option mode,\n\t\t\t\t\t  file_filter_option filter,\n\t\t\t\t\t  file_reorder_option reorder,\n\t\t\t\t\t  file_tree_checksum* checksum)\n{\n\t// If we have a path to find directories in,\n\t// then convert relative pathnames to be rooted\n\t// on the wesnoth path\n\tif(!directory.empty() && directory[0] != '/' && !game_config::path.empty()){\n\t\tstd::string dir = game_config::path + \"/\" + directory;\n\t\tif(is_directory(dir)) {\n\t\t\tget_files_in_dir(dir,files,dirs,mode,filter,reorder,checksum);\n\t\t\treturn;\n\t\t}\n\t}\n\n\tstruct stat st;\n\n\tif (reorder == DO_REORDER) {\n\t\tLOG_FS << \"searching for _main.cfg in directory \" << directory << '\\n';\n\t\tstd::string maincfg;\n\t\tif (directory.empty() || directory[directory.size()-1] == '/')\n\t\t\tmaincfg = directory + maincfg_filename;\n\t\telse\n\t\t\tmaincfg = (directory + \"/\") + maincfg_filename;\n\n\t\tif (::stat(maincfg.c_str(), &st) != -1) {\n\t\t\tLOG_FS << \"_main.cfg found : \" << maincfg << '\\n';\n\t\t\tif (files != NULL) {\n\t\t\t\tif (mode == ENTIRE_FILE_PATH)\n\t\t\t\t\tfiles->push_back(maincfg);\n\t\t\t\telse\n\t\t\t\t\tfiles->push_back(maincfg_filename);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t}\n\n\tDIR* dir = opendir(directory.c_str());\n\n\tif(dir == NULL) {\n\t\t// Probably not a directory, let the caller deal with it.\n\t\treturn;\n\t}\n\n\tstruct dirent* entry;\n\twhile((entry = readdir(dir)) != NULL) {\n\t\tif(entry->d_name[0] == '.')\n\t\t\tcontinue;\n#ifdef __APPLE__\n\t\t// HFS Mac OS X decomposes filenames using combining unicode characters.\n\t\t// Try to get the precomposed form.\n\t\tchar macname[MAXNAMLEN+1];\n\t\tCFStringRef cstr = CFStringCreateWithCString(NULL,\n\t\t\t\t\t\t\t entry->d_name,\n\t\t\t\t\t\t\t kCFStringEncodingUTF8);\n\t\tCFMutableStringRef mut_str = CFStringCreateMutableCopy(NULL,\n\t\t\t\t\t\t\t 0, cstr);\n\t\tCFStringNormalize(mut_str, kCFStringNormalizationFormC);\n\t\tCFStringGetCString(mut_str,\n\t\t\t\tmacname,sizeof(macname)-1,\n\t\t\t\tkCFStringEncodingUTF8);\n\t\tCFRelease(cstr);\n\t\tCFRelease(mut_str);\n\t\tconst std::string basename = macname;\n#else\n\t\t// generic Unix\n\t\tconst std::string basename = entry->d_name;\n#endif /* !APPLE */\n\n\t\tstd::string fullname;\n\t\tif (directory.empty() || directory[directory.size()-1] == '/')\n\t\t\tfullname = directory + basename;\n\t\telse\n\t\t\tfullname = directory + \"/\" + basename;\n\n\t\tif (::stat(fullname.c_str(), &st) != -1) {\n\t\t\tif (S_ISREG(st.st_mode)) {\n\t\t\t\tif(filter == SKIP_PBL_FILES && looks_like_pbl(basename)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tif (files != NULL) {\n\t\t\t\t\tif (mode == ENTIRE_FILE_PATH)\n\t\t\t\t\t\tfiles->push_back(fullname);\n\t\t\t\t\telse\n\t\t\t\t\t\tfiles->push_back(basename);\n\t\t\t\t}\n\t\t\t\tif (checksum != NULL) {\n\t\t\t\t\tif(st.st_mtime > checksum->modified) {\n\t\t\t\t\t\tchecksum->modified = st.st_mtime;\n\t\t\t\t\t}\n\t\t\t\t\tchecksum->sum_size += st.st_size;\n\t\t\t\t\tchecksum->nfiles++;\n\t\t\t\t}\n\t\t\t} else if (S_ISDIR(st.st_mode)) {\n\t\t\t\tif (filter == SKIP_MEDIA_DIR\n\t\t\t\t\t\t&& (basename == \"images\"|| basename == \"sounds\"))\n\t\t\t\t\tcontinue;\n\n\t\t\t\tif (reorder == DO_REORDER &&\n\t\t\t\t\t\t::stat((fullname+\"/\"+maincfg_filename).c_str(), &st)!=-1 &&\n\t\t\t\t\t\tS_ISREG(st.st_mode)) {\n\t\t\t\t\tLOG_FS << \"_main.cfg found : \";\n\t\t\t\t\tif (files != NULL) {\n\t\t\t\t\t\tif (mode == ENTIRE_FILE_PATH) {\n\t\t\t\t\t\t\tfiles->push_back(fullname + \"/\" + maincfg_filename);\n\t\t\t\t\t\t\tLOG_FS << fullname << \"/\" << maincfg_filename << '\\n';\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tfiles->push_back(basename + \"/\" + maincfg_filename);\n\t\t\t\t\t\t\tLOG_FS << basename << \"/\" << maincfg_filename << '\\n';\n\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t// Show what I consider strange\n\t\t\t\t\t\tLOG_FS << fullname << \"/\" << maincfg_filename << \" not used now but skip the directory \" << std::endl;\n\t\t\t\t\t}\n\t\t\t\t} else if (dirs != NULL) {\n\t\t\t\t\tif (mode == ENTIRE_FILE_PATH)\n\t\t\t\t\t\tdirs->push_back(fullname);\n\t\t\t\t\telse\n\t\t\t\t\t\tdirs->push_back(basename);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tclosedir(dir);\n\n\tif(files != NULL)\n\t\tstd::sort(files->begin(),files->end());\n\n\tif (dirs != NULL)\n\t\tstd::sort(dirs->begin(),dirs->end());\n\n\tif (files != NULL && reorder == DO_REORDER) {\n\t\t// move finalcfg_filename, if present, to the end of the vector\n\t\tfor (unsigned int i = 0; i < files->size(); i++) {\n\t\t\tif (ends_with((*files)[i], \"/\" + finalcfg_filename)) {\n\t\t\t\tfiles->push_back((*files)[i]);\n\t\t\t\tfiles->erase(files->begin()+i);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\t// move initialcfg_filename, if present, to the beginning of the vector\n\t\tunsigned int foundit = 0;\n\t\tfor (unsigned int i = 0; i < files->size(); i++)\n\t\t\tif (ends_with((*files)[i], \"/\" + initialcfg_filename)) {\n\t\t\t\tfoundit = i;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t// If _initial.cfg needs to be moved (it was found, but not at index 0).\n\t\tif (foundit > 0) {\n\t\t\tstd::string initialcfg = (*files)[foundit];\n\t\t\tfor (unsigned int i = foundit; i > 0; --i)\n\t\t\t\t(*files)[i] = (*files)[i-1];\n\t\t\t(*files)[0] = initialcfg;\n\t\t}\n\t}\n}",
    "includes": [
      "#include <CoreFoundation/CFBase.h>",
      "#include <CoreFoundation/CFString.h>",
      "#include <CoreFoundation/CoreFoundation.h>",
      "#include <boost/foreach.hpp>",
      "#include \"version.hpp\"",
      "#include \"serialization/unicode.hpp\"",
      "#include \"serialization/string_utils.hpp\"",
      "#include \"scoped_resource.hpp\"",
      "#include \"log.hpp\"",
      "#include \"game_preferences.hpp\"",
      "#include \"game_config.hpp\"",
      "#include \"filesystem.hpp\"",
      "#include \"config.hpp\"",
      "#include <cstring>",
      "#include <boost/algorithm/string.hpp>",
      "#include <set>",
      "#include <iomanip>",
      "#include <fstream>",
      "#include <cerrno>",
      "#include <libgen.h>",
      "#include <dirent.h>",
      "#include <unistd.h>",
      "#include <cctype>",
      "#include \"filesystem_win32.ii\"",
      "#include <sys/stat.h>",
      "#include \"global.hpp\""
    ],
    "macros_used": [
      "#define LOG_FS LOG_STREAM(info, log_filesystem)"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ends_with",
          "args": [
            "(*files)[i]",
            "\"/\" + initialcfg_filename"
          ],
          "line": 233
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "files->size",
          "args": [],
          "line": 232
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "files->erase",
          "args": [
            "files->begin()+i"
          ],
          "line": 226
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "files->begin",
          "args": [],
          "line": 226
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "files->push_back",
          "args": [
            "(*files)[i]"
          ],
          "line": 225
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ends_with",
          "args": [
            "(*files)[i]",
            "\"/\" + finalcfg_filename"
          ],
          "line": 224
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "files->size",
          "args": [],
          "line": 223
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "std::sort",
          "args": [
            "dirs->begin()",
            "dirs->end()"
          ],
          "line": 219
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dirs->end",
          "args": [],
          "line": 219
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dirs->begin",
          "args": [],
          "line": 219
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "std::sort",
          "args": [
            "files->begin()",
            "files->end()"
          ],
          "line": 216
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "files->end",
          "args": [],
          "line": 216
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "files->begin",
          "args": [],
          "line": 216
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "closedir",
          "args": [
            "dir"
          ],
          "line": 213
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dirs->push_back",
          "args": [
            "basename"
          ],
          "line": 207
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dirs->push_back",
          "args": [
            "fullname"
          ],
          "line": 205
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "files->push_back",
          "args": [
            "basename + \"/\" + maincfg_filename"
          ],
          "line": 196
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "files->push_back",
          "args": [
            "fullname + \"/\" + maincfg_filename"
          ],
          "line": 193
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "S_ISREG",
          "args": [
            "st.st_mode"
          ],
          "line": 189
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "::stat",
          "args": [
            "(fullname+\"/\"+maincfg_filename).c_str()",
            "&st"
          ],
          "line": 188
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "",
          "args": [],
          "line": 188
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "S_ISDIR",
          "args": [
            "st.st_mode"
          ],
          "line": 182
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "files->push_back",
          "args": [
            "basename"
          ],
          "line": 173
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "files->push_back",
          "args": [
            "fullname"
          ],
          "line": 171
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "looks_like_pbl",
          "args": [
            "basename"
          ],
          "line": 166
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "S_ISREG",
          "args": [
            "st.st_mode"
          ],
          "line": 165
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "::stat",
          "args": [
            "fullname.c_str()",
            "&st"
          ],
          "line": 164
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fullname.c_str",
          "args": [],
          "line": 164
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "directory.size",
          "args": [],
          "line": 159
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "directory.empty",
          "args": [],
          "line": 159
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "CFRelease",
          "args": [
            "mut_str"
          ],
          "line": 151
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "CFRelease",
          "args": [
            "cstr"
          ],
          "line": 150
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "CFStringGetCString",
          "args": [
            "mut_str",
            "macname",
            "sizeof(macname)-1",
            "kCFStringEncodingUTF8"
          ],
          "line": 147
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "CFStringNormalize",
          "args": [
            "mut_str",
            "kCFStringNormalizationFormC"
          ],
          "line": 146
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "CFStringCreateMutableCopy",
          "args": [
            "NULL",
            "0",
            "cstr"
          ],
          "line": 144
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "CFStringCreateWithCString",
          "args": [
            "NULL",
            "entry->d_name",
            "kCFStringEncodingUTF8"
          ],
          "line": 141
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "readdir",
          "args": [
            "dir"
          ],
          "line": 134
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "opendir",
          "args": [
            "directory.c_str()"
          ],
          "line": 126
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "directory.c_str",
          "args": [],
          "line": 126
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "files->push_back",
          "args": [
            "maincfg_filename"
          ],
          "line": 120
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "files->push_back",
          "args": [
            "maincfg"
          ],
          "line": 118
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "::stat",
          "args": [
            "maincfg.c_str()",
            "&st"
          ],
          "line": 114
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "maincfg.c_str",
          "args": [],
          "line": 114
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "directory.size",
          "args": [],
          "line": 109
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "directory.empty",
          "args": [],
          "line": 109
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_files_in_dir",
          "args": [
            "dir",
            "files",
            "dirs",
            "mode",
            "filter",
            "reorder",
            "checksum"
          ],
          "line": 99
        },
        "resolved": true,
        "details": {
          "function_name": "get_files_in_dir",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
          "lines": "85-245",
          "snippet": "void get_files_in_dir(const std::string &directory,\n\t\t\t\t\t  std::vector<std::string>* files,\n\t\t\t\t\t  std::vector<std::string>* dirs,\n\t\t\t\t\t  file_name_option mode,\n\t\t\t\t\t  file_filter_option filter,\n\t\t\t\t\t  file_reorder_option reorder,\n\t\t\t\t\t  file_tree_checksum* checksum)\n{\n\t// If we have a path to find directories in,\n\t// then convert relative pathnames to be rooted\n\t// on the wesnoth path\n\tif(!directory.empty() && directory[0] != '/' && !game_config::path.empty()){\n\t\tstd::string dir = game_config::path + \"/\" + directory;\n\t\tif(is_directory(dir)) {\n\t\t\tget_files_in_dir(dir,files,dirs,mode,filter,reorder,checksum);\n\t\t\treturn;\n\t\t}\n\t}\n\n\tstruct stat st;\n\n\tif (reorder == DO_REORDER) {\n\t\tLOG_FS << \"searching for _main.cfg in directory \" << directory << '\\n';\n\t\tstd::string maincfg;\n\t\tif (directory.empty() || directory[directory.size()-1] == '/')\n\t\t\tmaincfg = directory + maincfg_filename;\n\t\telse\n\t\t\tmaincfg = (directory + \"/\") + maincfg_filename;\n\n\t\tif (::stat(maincfg.c_str(), &st) != -1) {\n\t\t\tLOG_FS << \"_main.cfg found : \" << maincfg << '\\n';\n\t\t\tif (files != NULL) {\n\t\t\t\tif (mode == ENTIRE_FILE_PATH)\n\t\t\t\t\tfiles->push_back(maincfg);\n\t\t\t\telse\n\t\t\t\t\tfiles->push_back(maincfg_filename);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t}\n\n\tDIR* dir = opendir(directory.c_str());\n\n\tif(dir == NULL) {\n\t\t// Probably not a directory, let the caller deal with it.\n\t\treturn;\n\t}\n\n\tstruct dirent* entry;\n\twhile((entry = readdir(dir)) != NULL) {\n\t\tif(entry->d_name[0] == '.')\n\t\t\tcontinue;\n#ifdef __APPLE__\n\t\t// HFS Mac OS X decomposes filenames using combining unicode characters.\n\t\t// Try to get the precomposed form.\n\t\tchar macname[MAXNAMLEN+1];\n\t\tCFStringRef cstr = CFStringCreateWithCString(NULL,\n\t\t\t\t\t\t\t entry->d_name,\n\t\t\t\t\t\t\t kCFStringEncodingUTF8);\n\t\tCFMutableStringRef mut_str = CFStringCreateMutableCopy(NULL,\n\t\t\t\t\t\t\t 0, cstr);\n\t\tCFStringNormalize(mut_str, kCFStringNormalizationFormC);\n\t\tCFStringGetCString(mut_str,\n\t\t\t\tmacname,sizeof(macname)-1,\n\t\t\t\tkCFStringEncodingUTF8);\n\t\tCFRelease(cstr);\n\t\tCFRelease(mut_str);\n\t\tconst std::string basename = macname;\n#else\n\t\t// generic Unix\n\t\tconst std::string basename = entry->d_name;\n#endif /* !APPLE */\n\n\t\tstd::string fullname;\n\t\tif (directory.empty() || directory[directory.size()-1] == '/')\n\t\t\tfullname = directory + basename;\n\t\telse\n\t\t\tfullname = directory + \"/\" + basename;\n\n\t\tif (::stat(fullname.c_str(), &st) != -1) {\n\t\t\tif (S_ISREG(st.st_mode)) {\n\t\t\t\tif(filter == SKIP_PBL_FILES && looks_like_pbl(basename)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tif (files != NULL) {\n\t\t\t\t\tif (mode == ENTIRE_FILE_PATH)\n\t\t\t\t\t\tfiles->push_back(fullname);\n\t\t\t\t\telse\n\t\t\t\t\t\tfiles->push_back(basename);\n\t\t\t\t}\n\t\t\t\tif (checksum != NULL) {\n\t\t\t\t\tif(st.st_mtime > checksum->modified) {\n\t\t\t\t\t\tchecksum->modified = st.st_mtime;\n\t\t\t\t\t}\n\t\t\t\t\tchecksum->sum_size += st.st_size;\n\t\t\t\t\tchecksum->nfiles++;\n\t\t\t\t}\n\t\t\t} else if (S_ISDIR(st.st_mode)) {\n\t\t\t\tif (filter == SKIP_MEDIA_DIR\n\t\t\t\t\t\t&& (basename == \"images\"|| basename == \"sounds\"))\n\t\t\t\t\tcontinue;\n\n\t\t\t\tif (reorder == DO_REORDER &&\n\t\t\t\t\t\t::stat((fullname+\"/\"+maincfg_filename).c_str(), &st)!=-1 &&\n\t\t\t\t\t\tS_ISREG(st.st_mode)) {\n\t\t\t\t\tLOG_FS << \"_main.cfg found : \";\n\t\t\t\t\tif (files != NULL) {\n\t\t\t\t\t\tif (mode == ENTIRE_FILE_PATH) {\n\t\t\t\t\t\t\tfiles->push_back(fullname + \"/\" + maincfg_filename);\n\t\t\t\t\t\t\tLOG_FS << fullname << \"/\" << maincfg_filename << '\\n';\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tfiles->push_back(basename + \"/\" + maincfg_filename);\n\t\t\t\t\t\t\tLOG_FS << basename << \"/\" << maincfg_filename << '\\n';\n\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t// Show what I consider strange\n\t\t\t\t\t\tLOG_FS << fullname << \"/\" << maincfg_filename << \" not used now but skip the directory \" << std::endl;\n\t\t\t\t\t}\n\t\t\t\t} else if (dirs != NULL) {\n\t\t\t\t\tif (mode == ENTIRE_FILE_PATH)\n\t\t\t\t\t\tdirs->push_back(fullname);\n\t\t\t\t\telse\n\t\t\t\t\t\tdirs->push_back(basename);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tclosedir(dir);\n\n\tif(files != NULL)\n\t\tstd::sort(files->begin(),files->end());\n\n\tif (dirs != NULL)\n\t\tstd::sort(dirs->begin(),dirs->end());\n\n\tif (files != NULL && reorder == DO_REORDER) {\n\t\t// move finalcfg_filename, if present, to the end of the vector\n\t\tfor (unsigned int i = 0; i < files->size(); i++) {\n\t\t\tif (ends_with((*files)[i], \"/\" + finalcfg_filename)) {\n\t\t\t\tfiles->push_back((*files)[i]);\n\t\t\t\tfiles->erase(files->begin()+i);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\t// move initialcfg_filename, if present, to the beginning of the vector\n\t\tunsigned int foundit = 0;\n\t\tfor (unsigned int i = 0; i < files->size(); i++)\n\t\t\tif (ends_with((*files)[i], \"/\" + initialcfg_filename)) {\n\t\t\t\tfoundit = i;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t// If _initial.cfg needs to be moved (it was found, but not at index 0).\n\t\tif (foundit > 0) {\n\t\t\tstd::string initialcfg = (*files)[foundit];\n\t\t\tfor (unsigned int i = foundit; i > 0; --i)\n\t\t\t\t(*files)[i] = (*files)[i-1];\n\t\t\t(*files)[0] = initialcfg;\n\t\t}\n\t}\n}",
          "note": "cyclic_reference_detected"
        }
      },
      {
        "call_info": {
          "callee": "is_directory",
          "args": [
            "dir"
          ],
          "line": 98
        },
        "resolved": true,
        "details": {
          "function_name": "is_directory",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
          "lines": "708-719",
          "snippet": "bool is_directory(const std::string& fname)\n{\n\tif(fname.empty()) {\n\t\treturn false;\n\t}\n\tif(fname[0] != '/' && !game_config::path.empty()) {\n\t\tif(is_directory_internal(game_config::path + \"/\" + fname))\n\t\t\treturn true;\n\t}\n\n\treturn is_directory_internal(fname);\n}",
          "includes": [
            "#include <CoreFoundation/CFBase.h>",
            "#include <CoreFoundation/CFString.h>",
            "#include <CoreFoundation/CoreFoundation.h>",
            "#include <boost/foreach.hpp>",
            "#include \"version.hpp\"",
            "#include \"serialization/unicode.hpp\"",
            "#include \"serialization/string_utils.hpp\"",
            "#include \"scoped_resource.hpp\"",
            "#include \"log.hpp\"",
            "#include \"game_preferences.hpp\"",
            "#include \"game_config.hpp\"",
            "#include \"filesystem.hpp\"",
            "#include \"config.hpp\"",
            "#include <cstring>",
            "#include <boost/algorithm/string.hpp>",
            "#include <set>",
            "#include <iomanip>",
            "#include <fstream>",
            "#include <cerrno>",
            "#include <libgen.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "#include <cctype>",
            "#include \"filesystem_win32.ii\"",
            "#include <sys/stat.h>",
            "#include \"global.hpp\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\nbool is_directory(const std::string& fname)\n{\n\tif(fname.empty()) {\n\t\treturn false;\n\t}\n\tif(fname[0] != '/' && !game_config::path.empty()) {\n\t\tif(is_directory_internal(game_config::path + \"/\" + fname))\n\t\t\treturn true;\n\t}\n\n\treturn is_directory_internal(fname);\n}"
        }
      },
      {
        "call_info": {
          "callee": "game_config::path.empty",
          "args": [],
          "line": 96
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "directory.empty",
          "args": [],
          "line": 96
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\n#define LOG_FS LOG_STREAM(info, log_filesystem)\n\nvoid get_files_in_dir(const std::string &directory,\n\t\t\t\t\t  std::vector<std::string>* files,\n\t\t\t\t\t  std::vector<std::string>* dirs,\n\t\t\t\t\t  file_name_option mode,\n\t\t\t\t\t  file_filter_option filter,\n\t\t\t\t\t  file_reorder_option reorder,\n\t\t\t\t\t  file_tree_checksum* checksum)\n{\n\t// If we have a path to find directories in,\n\t// then convert relative pathnames to be rooted\n\t// on the wesnoth path\n\tif(!directory.empty() && directory[0] != '/' && !game_config::path.empty()){\n\t\tstd::string dir = game_config::path + \"/\" + directory;\n\t\tif(is_directory(dir)) {\n\t\t\tget_files_in_dir(dir,files,dirs,mode,filter,reorder,checksum);\n\t\t\treturn;\n\t\t}\n\t}\n\n\tstruct stat st;\n\n\tif (reorder == DO_REORDER) {\n\t\tLOG_FS << \"searching for _main.cfg in directory \" << directory << '\\n';\n\t\tstd::string maincfg;\n\t\tif (directory.empty() || directory[directory.size()-1] == '/')\n\t\t\tmaincfg = directory + maincfg_filename;\n\t\telse\n\t\t\tmaincfg = (directory + \"/\") + maincfg_filename;\n\n\t\tif (::stat(maincfg.c_str(), &st) != -1) {\n\t\t\tLOG_FS << \"_main.cfg found : \" << maincfg << '\\n';\n\t\t\tif (files != NULL) {\n\t\t\t\tif (mode == ENTIRE_FILE_PATH)\n\t\t\t\t\tfiles->push_back(maincfg);\n\t\t\t\telse\n\t\t\t\t\tfiles->push_back(maincfg_filename);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t}\n\n\tDIR* dir = opendir(directory.c_str());\n\n\tif(dir == NULL) {\n\t\t// Probably not a directory, let the caller deal with it.\n\t\treturn;\n\t}\n\n\tstruct dirent* entry;\n\twhile((entry = readdir(dir)) != NULL) {\n\t\tif(entry->d_name[0] == '.')\n\t\t\tcontinue;\n#ifdef __APPLE__\n\t\t// HFS Mac OS X decomposes filenames using combining unicode characters.\n\t\t// Try to get the precomposed form.\n\t\tchar macname[MAXNAMLEN+1];\n\t\tCFStringRef cstr = CFStringCreateWithCString(NULL,\n\t\t\t\t\t\t\t entry->d_name,\n\t\t\t\t\t\t\t kCFStringEncodingUTF8);\n\t\tCFMutableStringRef mut_str = CFStringCreateMutableCopy(NULL,\n\t\t\t\t\t\t\t 0, cstr);\n\t\tCFStringNormalize(mut_str, kCFStringNormalizationFormC);\n\t\tCFStringGetCString(mut_str,\n\t\t\t\tmacname,sizeof(macname)-1,\n\t\t\t\tkCFStringEncodingUTF8);\n\t\tCFRelease(cstr);\n\t\tCFRelease(mut_str);\n\t\tconst std::string basename = macname;\n#else\n\t\t// generic Unix\n\t\tconst std::string basename = entry->d_name;\n#endif /* !APPLE */\n\n\t\tstd::string fullname;\n\t\tif (directory.empty() || directory[directory.size()-1] == '/')\n\t\t\tfullname = directory + basename;\n\t\telse\n\t\t\tfullname = directory + \"/\" + basename;\n\n\t\tif (::stat(fullname.c_str(), &st) != -1) {\n\t\t\tif (S_ISREG(st.st_mode)) {\n\t\t\t\tif(filter == SKIP_PBL_FILES && looks_like_pbl(basename)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tif (files != NULL) {\n\t\t\t\t\tif (mode == ENTIRE_FILE_PATH)\n\t\t\t\t\t\tfiles->push_back(fullname);\n\t\t\t\t\telse\n\t\t\t\t\t\tfiles->push_back(basename);\n\t\t\t\t}\n\t\t\t\tif (checksum != NULL) {\n\t\t\t\t\tif(st.st_mtime > checksum->modified) {\n\t\t\t\t\t\tchecksum->modified = st.st_mtime;\n\t\t\t\t\t}\n\t\t\t\t\tchecksum->sum_size += st.st_size;\n\t\t\t\t\tchecksum->nfiles++;\n\t\t\t\t}\n\t\t\t} else if (S_ISDIR(st.st_mode)) {\n\t\t\t\tif (filter == SKIP_MEDIA_DIR\n\t\t\t\t\t\t&& (basename == \"images\"|| basename == \"sounds\"))\n\t\t\t\t\tcontinue;\n\n\t\t\t\tif (reorder == DO_REORDER &&\n\t\t\t\t\t\t::stat((fullname+\"/\"+maincfg_filename).c_str(), &st)!=-1 &&\n\t\t\t\t\t\tS_ISREG(st.st_mode)) {\n\t\t\t\t\tLOG_FS << \"_main.cfg found : \";\n\t\t\t\t\tif (files != NULL) {\n\t\t\t\t\t\tif (mode == ENTIRE_FILE_PATH) {\n\t\t\t\t\t\t\tfiles->push_back(fullname + \"/\" + maincfg_filename);\n\t\t\t\t\t\t\tLOG_FS << fullname << \"/\" << maincfg_filename << '\\n';\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tfiles->push_back(basename + \"/\" + maincfg_filename);\n\t\t\t\t\t\t\tLOG_FS << basename << \"/\" << maincfg_filename << '\\n';\n\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t// Show what I consider strange\n\t\t\t\t\t\tLOG_FS << fullname << \"/\" << maincfg_filename << \" not used now but skip the directory \" << std::endl;\n\t\t\t\t\t}\n\t\t\t\t} else if (dirs != NULL) {\n\t\t\t\t\tif (mode == ENTIRE_FILE_PATH)\n\t\t\t\t\t\tdirs->push_back(fullname);\n\t\t\t\t\telse\n\t\t\t\t\t\tdirs->push_back(basename);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tclosedir(dir);\n\n\tif(files != NULL)\n\t\tstd::sort(files->begin(),files->end());\n\n\tif (dirs != NULL)\n\t\tstd::sort(dirs->begin(),dirs->end());\n\n\tif (files != NULL && reorder == DO_REORDER) {\n\t\t// move finalcfg_filename, if present, to the end of the vector\n\t\tfor (unsigned int i = 0; i < files->size(); i++) {\n\t\t\tif (ends_with((*files)[i], \"/\" + finalcfg_filename)) {\n\t\t\t\tfiles->push_back((*files)[i]);\n\t\t\t\tfiles->erase(files->begin()+i);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\t// move initialcfg_filename, if present, to the beginning of the vector\n\t\tunsigned int foundit = 0;\n\t\tfor (unsigned int i = 0; i < files->size(); i++)\n\t\t\tif (ends_with((*files)[i], \"/\" + initialcfg_filename)) {\n\t\t\t\tfoundit = i;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t// If _initial.cfg needs to be moved (it was found, but not at index 0).\n\t\tif (foundit > 0) {\n\t\t\tstd::string initialcfg = (*files)[foundit];\n\t\t\tfor (unsigned int i = foundit; i > 0; --i)\n\t\t\t\t(*files)[i] = (*files)[i-1];\n\t\t\t(*files)[0] = initialcfg;\n\t\t}\n\t}\n}"
  }
]