[
  {
    "function_name": "main",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-2313/repo/c++/src/benchmark/null-catrank.c++",
    "lines": "163-167",
    "snippet": "int main(int argc, char* argv[]) {\n  return capnp::benchmark::benchmarkMain<\n      capnp::benchmark::null::BenchmarkTypes,\n      capnp::benchmark::null::CatRankTestCase>(argc, argv);\n}",
    "includes": [
      "#include \"null-common.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "capnp::benchmark::benchmarkMain<\n      capnp::benchmark::null::BenchmarkTypes,\n      capnp::benchmark::null::CatRankTestCase>",
          "args": [
            "argc",
            "argv"
          ],
          "line": 164
        },
        "resolved": true,
        "details": {
          "function_name": "benchmarkMain",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-2313/repo/c++/src/benchmark/common.h",
          "lines": "281-292",
          "snippet": "int benchmarkMain(int argc, char* argv[]) {\n  if (argc != 5) {\n    fprintf(stderr, \"USAGE:  %s MODE REUSE COMPRESSION ITERATION_COUNT\\n\", argv[0]);\n    return 1;\n  }\n\n  uint64_t iters = strtoull(argv[4], nullptr, 0);\n  uint64_t throughput = doBenchmark3<BenchmarkTypes, TestCase>(argv[1], argv[2], argv[3], iters);\n  fprintf(stdout, \"%llu\\n\", (long long unsigned int)throughput);\n\n  return 0;\n}",
          "includes": [
            "#include <vector>",
            "#include <string>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdexcept>",
            "#include <algorithm>",
            "#include <semaphore.h>",
            "#include <stdlib.h>",
            "#include <sys/wait.h>",
            "#include <sys/resource.h>",
            "#include <sys/time.h>",
            "#include <sys/types.h>",
            "#include <errno.h>",
            "#include <limits>",
            "#include <unistd.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <vector>\n#include <string>\n#include <string.h>\n#include <stdio.h>\n#include <stdexcept>\n#include <algorithm>\n#include <semaphore.h>\n#include <stdlib.h>\n#include <sys/wait.h>\n#include <sys/resource.h>\n#include <sys/time.h>\n#include <sys/types.h>\n#include <errno.h>\n#include <limits>\n#include <unistd.h>\n\nint benchmarkMain(int argc, char* argv[]) {\n  if (argc != 5) {\n    fprintf(stderr, \"USAGE:  %s MODE REUSE COMPRESSION ITERATION_COUNT\\n\", argv[0]);\n    return 1;\n  }\n\n  uint64_t iters = strtoull(argv[4], nullptr, 0);\n  uint64_t throughput = doBenchmark3<BenchmarkTypes, TestCase>(argv[1], argv[2], argv[3], iters);\n  fprintf(stdout, \"%llu\\n\", (long long unsigned int)throughput);\n\n  return 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"null-common.h\"\n\nint main(int argc, char* argv[]) {\n  return capnp::benchmark::benchmarkMain<\n      capnp::benchmark::null::BenchmarkTypes,\n      capnp::benchmark::null::CatRankTestCase>(argc, argv);\n}"
  },
  {
    "function_name": "checkResponse",
    "container": "CatRankTestCase",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-2313/repo/c++/src/benchmark/null-catrank.c++",
    "lines": "145-156",
    "snippet": "static bool checkResponse(const List<SearchResult>& response, int expectedGoodCount) {\n    int goodCount = 0;\n    for (auto& result: response) {\n      if (result.score > 1001) {\n        ++goodCount;\n      } else {\n        break;\n      }\n    }\n\n    return goodCount == expectedGoodCount;\n  }",
    "includes": [
      "#include \"null-common.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"null-common.h\"\n\nCatRankTestCase {\n  static bool checkResponse(const List<SearchResult>& response, int expectedGoodCount) {\n      int goodCount = 0;\n      for (auto& result: response) {\n        if (result.score > 1001) {\n          ++goodCount;\n        } else {\n          break;\n        }\n      }\n  \n      return goodCount == expectedGoodCount;\n    }\n}"
  },
  {
    "function_name": "handleRequest",
    "container": "CatRankTestCase",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-2313/repo/c++/src/benchmark/null-catrank.c++",
    "lines": "118-143",
    "snippet": "static void handleRequest(const List<SearchResult>& request, List<SearchResult>* response) {\n    std::vector<ScoredResult> scoredResults;\n    scoredResults.reserve(request.size);\n\n    for (auto& result: request) {\n      double score = result.score;\n      if (strstr(result.snippet, \" cat \") != nullptr) {\n        score *= 10000;\n      }\n      if (strstr(result.snippet, \" dog \") != nullptr) {\n        score /= 10000;\n      }\n      scoredResults.emplace_back(score, &result);\n    }\n\n    std::sort(scoredResults.begin(), scoredResults.end());\n\n    response->init(scoredResults.size());\n    SearchResult* dst = response->items;\n    for (auto& result: scoredResults) {\n      dst->url = copyString(result.result->url);\n      dst->score = result.score;\n      dst->snippet = copyString(result.result->snippet);\n      ++dst;\n    }\n  }",
    "includes": [
      "#include \"null-common.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "copyString",
          "args": [
            "result.result->snippet"
          ],
          "line": 140
        },
        "resolved": true,
        "details": {
          "function_name": "Arena::copyString",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-2313/repo/c++/src/kj/arena.c++",
          "lines": "153-157",
          "snippet": "StringPtr Arena::copyString(StringPtr content) {\n  char* data = reinterpret_cast<char*>(allocateBytes(content.size() + 1, 1, false));\n  memcpy(data, content.cStr(), content.size() + 1);\n  return StringPtr(data, content.size());\n}",
          "includes": [
            "#include <stdint.h>",
            "#include \"debug.h\"",
            "#include \"arena.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <stdint.h>\n#include \"debug.h\"\n#include \"arena.h\"\n\nStringPtr Arena::copyString(StringPtr content) {\n  char* data = reinterpret_cast<char*>(allocateBytes(content.size() + 1, 1, false));\n  memcpy(data, content.cStr(), content.size() + 1);\n  return StringPtr(data, content.size());\n}"
        }
      },
      {
        "call_info": {
          "callee": "response->init",
          "args": [
            "scoredResults.size()"
          ],
          "line": 135
        },
        "resolved": true,
        "details": {
          "function_name": "init",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-2313/repo/c++/src/capnp/pointer-helpers.h",
          "lines": "51-53",
          "snippet": "static inline typename T::Builder init(PointerBuilder builder) {\n    return typename T::Builder(builder.initStruct(structSize<T>()));\n  }",
          "includes": [
            "#include \"list.h\"",
            "#include \"layout.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"list.h\"\n#include \"layout.h\"\n\nstatic inline typename T::Builder init(PointerBuilder builder) {\n    return typename T::Builder(builder.initStruct(structSize<T>()));\n  }"
        }
      },
      {
        "call_info": {
          "callee": "scoredResults.size",
          "args": [],
          "line": 135
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-2313/repo/c++/src/capnp/any.h",
          "lines": "599-599",
          "snippet": "inline uint size() { return _builder.size() / ELEMENTS; }",
          "includes": [
            "#include \"list.h\"",
            "#include \"orphan.h\"",
            "#include \"pointer-helpers.h\"",
            "#include \"layout.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"list.h\"\n#include \"orphan.h\"\n#include \"pointer-helpers.h\"\n#include \"layout.h\"\n\ninline uint size() { return _builder.size() / ELEMENTS; }"
        }
      },
      {
        "call_info": {
          "callee": "std::sort",
          "args": [
            "scoredResults.begin()",
            "scoredResults.end()"
          ],
          "line": 133
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "scoredResults.end",
          "args": [],
          "line": 133
        },
        "resolved": true,
        "details": {
          "function_name": "end",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-2313/repo/c++/src/capnp/any.h",
          "lines": "551-551",
          "snippet": "inline Iterator end() { return Iterator(this, size()); }",
          "includes": [
            "#include \"list.h\"",
            "#include \"orphan.h\"",
            "#include \"pointer-helpers.h\"",
            "#include \"layout.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"list.h\"\n#include \"orphan.h\"\n#include \"pointer-helpers.h\"\n#include \"layout.h\"\n\ninline Iterator end() { return Iterator(this, size()); }"
        }
      },
      {
        "call_info": {
          "callee": "scoredResults.begin",
          "args": [],
          "line": 133
        },
        "resolved": true,
        "details": {
          "function_name": "begin",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-2313/repo/c++/src/capnp/any.h",
          "lines": "550-550",
          "snippet": "inline Iterator begin() { return Iterator(this, 0); }",
          "includes": [
            "#include \"list.h\"",
            "#include \"orphan.h\"",
            "#include \"pointer-helpers.h\"",
            "#include \"layout.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"list.h\"\n#include \"orphan.h\"\n#include \"pointer-helpers.h\"\n#include \"layout.h\"\n\ninline Iterator begin() { return Iterator(this, 0); }"
        }
      },
      {
        "call_info": {
          "callee": "scoredResults.emplace_back",
          "args": [
            "score",
            "&result"
          ],
          "line": 130
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strstr",
          "args": [
            "result.snippet",
            "\" dog \""
          ],
          "line": 127
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strstr",
          "args": [
            "result.snippet",
            "\" cat \""
          ],
          "line": 124
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "scoredResults.reserve",
          "args": [
            "request.size"
          ],
          "line": 120
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"null-common.h\"\n\nCatRankTestCase {\n  static void handleRequest(const List<SearchResult>& request, List<SearchResult>* response) {\n      std::vector<ScoredResult> scoredResults;\n      scoredResults.reserve(request.size);\n  \n      for (auto& result: request) {\n        double score = result.score;\n        if (strstr(result.snippet, \" cat \") != nullptr) {\n          score *= 10000;\n        }\n        if (strstr(result.snippet, \" dog \") != nullptr) {\n          score /= 10000;\n        }\n        scoredResults.emplace_back(score, &result);\n      }\n  \n      std::sort(scoredResults.begin(), scoredResults.end());\n  \n      response->init(scoredResults.size());\n      SearchResult* dst = response->items;\n      for (auto& result: scoredResults) {\n        dst->url = copyString(result.result->url);\n        dst->score = result.score;\n        dst->snippet = copyString(result.result->snippet);\n        ++dst;\n      }\n    }\n}"
  },
  {
    "function_name": "setupRequest",
    "container": "CatRankTestCase",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-2313/repo/c++/src/benchmark/null-catrank.c++",
    "lines": "50-116",
    "snippet": "static int setupRequest(List<SearchResult>* request) {\n    int count = fastRand(1000);\n    int goodCount = 0;\n\n    request->init(count);\n    for (int i = 0; i < count; i++) {\n      SearchResult& result = request->items[i];\n      result.score = 1000 - i;\n      char* pos = reinterpret_cast<char*>(arenaPos);\n      result.url = pos;\n\n      strcpy(pos, \"http://example.com/\");\n      pos += strlen(\"http://example.com/\");\n      int urlSize = fastRand(100);\n      for (int j = 0; j < urlSize; j++) {\n        *pos++ = 'a' + fastRand(26);\n      }\n      *pos++ = '\\0';\n\n      // Retroactively allocate the space we used.\n      if (allocate<char>(pos - result.url) != result.url) {\n        throw std::bad_alloc();\n      }\n\n      bool isCat = fastRand(8) == 0;\n      bool isDog = fastRand(8) == 0;\n      goodCount += isCat && !isDog;\n\n      pos = reinterpret_cast<char*>(arenaPos);\n      result.snippet = pos;\n\n      *pos++ = ' ';\n\n      int prefix = fastRand(20);\n      for (int j = 0; j < prefix; j++) {\n        const char* word = WORDS[fastRand(WORDS_COUNT)];\n        size_t len = strlen(word);\n        memcpy(pos, word, len);\n        pos += len;\n      }\n\n      if (isCat) {\n        strcpy(pos, \"cat \");\n        pos += 4;\n      }\n      if (isDog) {\n        strcpy(pos, \"dog \");\n        pos += 4;\n      }\n\n      int suffix = fastRand(20);\n      for (int j = 0; j < suffix; j++) {\n        const char* word = WORDS[fastRand(WORDS_COUNT)];\n        size_t len = strlen(word);\n        memcpy(pos, word, len);\n        pos += len;\n      }\n      *pos++ = '\\0';\n\n      // Retroactively allocate the space we used.\n      if (allocate<char>(pos - result.snippet) != result.snippet) {\n        throw std::bad_alloc();\n      }\n    }\n\n    return goodCount;\n  }",
    "includes": [
      "#include \"null-common.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "std::bad_alloc",
          "args": [],
          "line": 111
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "allocate<char>",
          "args": [
            "pos - result.snippet"
          ],
          "line": 110
        },
        "resolved": true,
        "details": {
          "function_name": "allocateSegment",
          "container": "TestInitMessageBuilder",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-2313/repo/c++/src/capnp/message-test.c++",
          "lines": "55-60",
          "snippet": "kj::ArrayPtr<word> allocateSegment(uint minimumSize) override {\n    auto array = kj::heapArray<word>(minimumSize);\n    memset(array.begin(), 0, array.asBytes().size());\n    allocations.add(kj::mv(array));\n    return allocations.back();\n  }",
          "includes": [
            "#include <kj/compat/gtest.h>",
            "#include <kj/debug.h>",
            "#include <kj/vector.h>",
            "#include <kj/array.h>",
            "#include \"test-util.h\"",
            "#include \"message.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <kj/compat/gtest.h>\n#include <kj/debug.h>\n#include <kj/vector.h>\n#include <kj/array.h>\n#include \"test-util.h\"\n#include \"message.h\"\n\nTestInitMessageBuilder {\n  kj::ArrayPtr<word> allocateSegment(uint minimumSize) override {\n      auto array = kj::heapArray<word>(minimumSize);\n      memset(array.begin(), 0, array.asBytes().size());\n      allocations.add(kj::mv(array));\n      return allocations.back();\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "pos",
            "word",
            "len"
          ],
          "line": 104
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "word"
          ],
          "line": 103
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fastRand",
          "args": [
            "WORDS_COUNT"
          ],
          "line": 102
        },
        "resolved": true,
        "details": {
          "function_name": "fastRand",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-2313/repo/c++/src/benchmark/common.h",
          "lines": "64-66",
          "snippet": "static inline uint32_t fastRand(uint32_t range) {\n  return nextFastRand() % range;\n}",
          "includes": [
            "#include <vector>",
            "#include <string>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdexcept>",
            "#include <algorithm>",
            "#include <semaphore.h>",
            "#include <stdlib.h>",
            "#include <sys/wait.h>",
            "#include <sys/resource.h>",
            "#include <sys/time.h>",
            "#include <sys/types.h>",
            "#include <errno.h>",
            "#include <limits>",
            "#include <unistd.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <vector>\n#include <string>\n#include <string.h>\n#include <stdio.h>\n#include <stdexcept>\n#include <algorithm>\n#include <semaphore.h>\n#include <stdlib.h>\n#include <sys/wait.h>\n#include <sys/resource.h>\n#include <sys/time.h>\n#include <sys/types.h>\n#include <errno.h>\n#include <limits>\n#include <unistd.h>\n\nstatic inline uint32_t fastRand(uint32_t range) {\n  return nextFastRand() % range;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "pos",
            "\"dog \""
          ],
          "line": 96
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "pos",
            "\"cat \""
          ],
          "line": 92
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "pos",
            "word",
            "len"
          ],
          "line": 87
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "word"
          ],
          "line": 86
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "reinterpret_cast<char*>",
          "args": [
            "arenaPos"
          ],
          "line": 78
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "std::bad_alloc",
          "args": [],
          "line": 71
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "\"http://example.com/\""
          ],
          "line": 62
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "pos",
            "\"http://example.com/\""
          ],
          "line": 61
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "reinterpret_cast<char*>",
          "args": [
            "arenaPos"
          ],
          "line": 58
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "request->init",
          "args": [
            "count"
          ],
          "line": 54
        },
        "resolved": true,
        "details": {
          "function_name": "init",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-2313/repo/c++/src/capnp/pointer-helpers.h",
          "lines": "51-53",
          "snippet": "static inline typename T::Builder init(PointerBuilder builder) {\n    return typename T::Builder(builder.initStruct(structSize<T>()));\n  }",
          "includes": [
            "#include \"list.h\"",
            "#include \"layout.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"list.h\"\n#include \"layout.h\"\n\nstatic inline typename T::Builder init(PointerBuilder builder) {\n    return typename T::Builder(builder.initStruct(structSize<T>()));\n  }"
        }
      }
    ],
    "contextual_snippet": "#include \"null-common.h\"\n\nCatRankTestCase {\n  static int setupRequest(List<SearchResult>* request) {\n      int count = fastRand(1000);\n      int goodCount = 0;\n  \n      request->init(count);\n      for (int i = 0; i < count; i++) {\n        SearchResult& result = request->items[i];\n        result.score = 1000 - i;\n        char* pos = reinterpret_cast<char*>(arenaPos);\n        result.url = pos;\n  \n        strcpy(pos, \"http://example.com/\");\n        pos += strlen(\"http://example.com/\");\n        int urlSize = fastRand(100);\n        for (int j = 0; j < urlSize; j++) {\n          *pos++ = 'a' + fastRand(26);\n        }\n        *pos++ = '\\0';\n  \n        // Retroactively allocate the space we used.\n        if (allocate<char>(pos - result.url) != result.url) {\n          throw std::bad_alloc();\n        }\n  \n        bool isCat = fastRand(8) == 0;\n        bool isDog = fastRand(8) == 0;\n        goodCount += isCat && !isDog;\n  \n        pos = reinterpret_cast<char*>(arenaPos);\n        result.snippet = pos;\n  \n        *pos++ = ' ';\n  \n        int prefix = fastRand(20);\n        for (int j = 0; j < prefix; j++) {\n          const char* word = WORDS[fastRand(WORDS_COUNT)];\n          size_t len = strlen(word);\n          memcpy(pos, word, len);\n          pos += len;\n        }\n  \n        if (isCat) {\n          strcpy(pos, \"cat \");\n          pos += 4;\n        }\n        if (isDog) {\n          strcpy(pos, \"dog \");\n          pos += 4;\n        }\n  \n        int suffix = fastRand(20);\n        for (int j = 0; j < suffix; j++) {\n          const char* word = WORDS[fastRand(WORDS_COUNT)];\n          size_t len = strlen(word);\n          memcpy(pos, word, len);\n          pos += len;\n        }\n        *pos++ = '\\0';\n  \n        // Retroactively allocate the space we used.\n        if (allocate<char>(pos - result.snippet) != result.snippet) {\n          throw std::bad_alloc();\n        }\n      }\n  \n      return goodCount;\n    }\n}"
  },
  {
    "function_name": "ScoredResult",
    "container": "ScoredResult",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-2313/repo/c++/src/benchmark/null-catrank.c++",
    "lines": "39-39",
    "snippet": "ScoredResult(double score, const SearchResult* result): score(score), result(result) {}",
    "includes": [
      "#include \"null-common.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"null-common.h\"\n\nScoredResult {\n  ScoredResult(double score, const SearchResult* result): score(score), result(result) {}\n}"
  }
]