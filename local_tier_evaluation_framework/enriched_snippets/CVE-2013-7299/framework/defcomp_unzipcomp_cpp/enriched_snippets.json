[
  {
    "function_name": "operator()",
    "container": "Unzip",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/defcomp/unzipcomp.cpp",
    "lines": "65-93",
    "snippet": "unsigned Unzip::operator() (tnt::HttpRequest& request,\n    tnt::HttpReply& reply, tnt::QueryParams& qparams)\n  {\n    std::string pi = request.getPathInfo();\n\n    log_debug(\"unzip archive \\\"\" << request.getArg(\"file\") << \"\\\" file \\\"\" << pi << '\"');\n\n    try\n    {\n      unzipFile f(request.getArg(\"file\"));\n      unzipFileStream in(f, pi, false);\n\n      // set Content-Type\n      std::string contentType = request.getArg(\"contenttype\");\n      if (contentType.empty())\n        setContentType(request, reply);\n      else\n        reply.setContentType(contentType);\n\n      reply.out() << in.rdbuf();\n    }\n    catch (const unzipEndOfListOfFile&)\n    {\n      log_debug(\"file \\\"\" << pi << \"\\\" not found in archive\");\n      return DECLINED;\n    }\n\n    return HTTP_OK;\n  }",
    "includes": [
      "#include <cxxtools/log.h>",
      "#include <tnt/unzipfile.h>",
      "#include <tnt/httperror.h>",
      "#include <tnt/http.h>",
      "#include <tnt/httpreply.h>",
      "#include <tnt/httprequest.h>",
      "#include <tnt/componentfactory.h>",
      "#include <tnt/component.h>",
      "#include \"unzip.h\"",
      "#include \"static.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"file \\\"\" << pi << \"\\\" not found in archive\""
          ],
          "line": 88
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "in.rdbuf",
          "args": [],
          "line": 84
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "reply.out",
          "args": [],
          "line": 84
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "reply.setContentType",
          "args": [
            "contentType"
          ],
          "line": 82
        },
        "resolved": true,
        "details": {
          "function_name": "setContentType",
          "container": "HttpReply",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/httpreply.h",
          "lines": "61-61",
          "snippet": "void setContentType(const std::string& t)     { setHeader(httpheader::contentType, t); }",
          "includes": [
            "#include <iosfwd>",
            "#include <tnt/http.h>",
            "#include <tnt/httpmessage.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <iosfwd>\n#include <tnt/http.h>\n#include <tnt/httpmessage.h>\n\nHttpReply {\n  void setContentType(const std::string& t)     { setHeader(httpheader::contentType, t); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "setContentType",
          "args": [
            "request",
            "reply"
          ],
          "line": 80
        },
        "resolved": true,
        "details": {
          "function_name": "setContentType",
          "container": "Static",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/defcomp/static.cpp",
          "lines": "248-252",
          "snippet": "void Static::setContentType(HttpRequest& request, HttpReply& reply)\n  {\n    if (handler)\n      reply.setContentType(handler->getMimeType(request.getPathInfo()).c_str());\n  }",
          "includes": [
            "#include <errno.h>",
            "#include <typeinfo>",
            "#include <unistd.h>",
            "#include <sys/poll.h>",
            "#include <netinet/tcp.h>",
            "#include <netinet/in.h>",
            "#include <sys/socket.h>",
            "#include <cxxtools/net/tcpstream.h>",
            "#include <sys/sendfile.h>",
            "#include <fcntl.h>",
            "#include <limits>",
            "#include <config.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <cxxtools/convert.h>",
            "#include <cxxtools/ioerror.h>",
            "#include <cxxtools/systemerror.h>",
            "#include <cxxtools/log.h>",
            "#include <fstream>",
            "#include <tnt/tntconfig.h>",
            "#include <tnt/comploader.h>",
            "#include <tnt/httpheader.h>",
            "#include <tnt/http.h>",
            "#include <tnt/httperror.h>",
            "#include <tnt/httpreply.h>",
            "#include <tnt/httprequest.h>",
            "#include \"mimehandler.h\"",
            "#include \"static.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <errno.h>\n#include <typeinfo>\n#include <unistd.h>\n#include <sys/poll.h>\n#include <netinet/tcp.h>\n#include <netinet/in.h>\n#include <sys/socket.h>\n#include <cxxtools/net/tcpstream.h>\n#include <sys/sendfile.h>\n#include <fcntl.h>\n#include <limits>\n#include <config.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <cxxtools/convert.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/systemerror.h>\n#include <cxxtools/log.h>\n#include <fstream>\n#include <tnt/tntconfig.h>\n#include <tnt/comploader.h>\n#include <tnt/httpheader.h>\n#include <tnt/http.h>\n#include <tnt/httperror.h>\n#include <tnt/httpreply.h>\n#include <tnt/httprequest.h>\n#include \"mimehandler.h\"\n#include \"static.h\"\n\nStatic {\n  void Static::setContentType(HttpRequest& request, HttpReply& reply)\n    {\n      if (handler)\n        reply.setContentType(handler->getMimeType(request.getPathInfo()).c_str());\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "contentType.empty",
          "args": [],
          "line": 79
        },
        "resolved": true,
        "details": {
          "function_name": "empty",
          "container": "Pstr",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/httpmessage.cpp",
          "lines": "156-156",
          "snippet": "bool empty() const      { return start == end; }",
          "includes": [
            "#include <stdio.h>",
            "#include <sstream>",
            "#include <list>",
            "#include <cxxtools/mutex.h>",
            "#include <cxxtools/log.h>",
            "#include <tnt/httpmessage.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <stdio.h>\n#include <sstream>\n#include <list>\n#include <cxxtools/mutex.h>\n#include <cxxtools/log.h>\n#include <tnt/httpmessage.h>\n\nPstr {\n  bool empty() const      { return start == end; }\n}"
        }
      },
      {
        "call_info": {
          "callee": "request.getArg",
          "args": [
            "\"contenttype\""
          ],
          "line": 78
        },
        "resolved": true,
        "details": {
          "function_name": "getArg",
          "container": "HttpRequest",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/httprequest.h",
          "lines": "163-163",
          "snippet": "std::string getArg(args_type::size_type n) const { return getArgDef(n); }",
          "includes": [
            "#include <cstring>",
            "#include <string>",
            "#include <cxxtools/atomicity.h>",
            "#include <map>",
            "#include <locale>",
            "#include <tnt/threadcontext.h>",
            "#include <tnt/scope.h>",
            "#include <tnt/query_params.h>",
            "#include <tnt/encoding.h>",
            "#include <tnt/cookie.h>",
            "#include <tnt/multipart.h>",
            "#include <tnt/contenttype.h>",
            "#include <tnt/socketif.h>",
            "#include <tnt/httpheader.h>",
            "#include <tnt/httpmessage.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <cstring>\n#include <string>\n#include <cxxtools/atomicity.h>\n#include <map>\n#include <locale>\n#include <tnt/threadcontext.h>\n#include <tnt/scope.h>\n#include <tnt/query_params.h>\n#include <tnt/encoding.h>\n#include <tnt/cookie.h>\n#include <tnt/multipart.h>\n#include <tnt/contenttype.h>\n#include <tnt/socketif.h>\n#include <tnt/httpheader.h>\n#include <tnt/httpmessage.h>\n\nHttpRequest {\n  std::string getArg(args_type::size_type n) const { return getArgDef(n); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"unzip archive \\\"\" << request.getArg(\"file\") << \"\\\" file \\\"\" << pi << '\"'"
          ],
          "line": 70
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "request.getPathInfo",
          "args": [],
          "line": 68
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <cxxtools/log.h>\n#include <tnt/unzipfile.h>\n#include <tnt/httperror.h>\n#include <tnt/http.h>\n#include <tnt/httpreply.h>\n#include <tnt/httprequest.h>\n#include <tnt/componentfactory.h>\n#include <tnt/component.h>\n#include \"unzip.h\"\n#include \"static.h\"\n\nUnzip {\n  unsigned Unzip::operator() (tnt::HttpRequest& request,\n      tnt::HttpReply& reply, tnt::QueryParams& qparams)\n    {\n      std::string pi = request.getPathInfo();\n  \n      log_debug(\"unzip archive \\\"\" << request.getArg(\"file\") << \"\\\" file \\\"\" << pi << '\"');\n  \n      try\n      {\n        unzipFile f(request.getArg(\"file\"));\n        unzipFileStream in(f, pi, false);\n  \n        // set Content-Type\n        std::string contentType = request.getArg(\"contenttype\");\n        if (contentType.empty())\n          setContentType(request, reply);\n        else\n          reply.setContentType(contentType);\n  \n        reply.out() << in.rdbuf();\n      }\n      catch (const unzipEndOfListOfFile&)\n      {\n        log_debug(\"file \\\"\" << pi << \"\\\" not found in archive\");\n        return DECLINED;\n      }\n  \n      return HTTP_OK;\n    }\n}"
  }
]