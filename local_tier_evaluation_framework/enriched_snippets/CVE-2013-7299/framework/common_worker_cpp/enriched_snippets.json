[
  {
    "function_name": "Worker::getCountThreads",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/worker.cpp",
    "lines": "532-536",
    "snippet": "Worker::workers_type::size_type Worker::getCountThreads()\n  {\n    cxxtools::MutexLock lock(mutex);\n    return workers.size();\n  }",
    "includes": [
      "#include \"config.h\"",
      "#include <string.h>",
      "#include <pthread.h>",
      "#include <cxxtools/net/tcpserver.h>",
      "#include <cxxtools/atomicity.h>",
      "#include <cxxtools/ioerror.h>",
      "#include <cxxtools/dlloader.h>",
      "#include <sys/poll.h>",
      "#include <arpa/inet.h>",
      "#include <sys/socket.h>",
      "#include <sys/types.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <cxxtools/log.h>",
      "#include <tnt/tntconfig.h>",
      "#include <tnt/poller.h>",
      "#include <tnt/http.h>",
      "#include <tnt/httperror.h>",
      "#include <tnt/httpreply.h>",
      "#include <tnt/httprequest.h>",
      "#include \"tnt/job.h\"",
      "#include \"tnt/dispatcher.h\"",
      "#include \"tnt/worker.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "workers.size",
          "args": [],
          "line": 535
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "Pstr",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/httpmessage.cpp",
          "lines": "155-155",
          "snippet": "size_type size() const  { return end - start; }",
          "includes": [
            "#include <stdio.h>",
            "#include <sstream>",
            "#include <list>",
            "#include <cxxtools/mutex.h>",
            "#include <cxxtools/log.h>",
            "#include <tnt/httpmessage.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <stdio.h>\n#include <sstream>\n#include <list>\n#include <cxxtools/mutex.h>\n#include <cxxtools/log.h>\n#include <tnt/httpmessage.h>\n\nPstr {\n  size_type size() const  { return end - start; }\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"config.h\"\n#include <string.h>\n#include <pthread.h>\n#include <cxxtools/net/tcpserver.h>\n#include <cxxtools/atomicity.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/dlloader.h>\n#include <sys/poll.h>\n#include <arpa/inet.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <cxxtools/log.h>\n#include <tnt/tntconfig.h>\n#include <tnt/poller.h>\n#include <tnt/http.h>\n#include <tnt/httperror.h>\n#include <tnt/httpreply.h>\n#include <tnt/httprequest.h>\n#include \"tnt/job.h\"\n#include \"tnt/dispatcher.h\"\n#include \"tnt/worker.h\"\n\nWorker::workers_type::size_type Worker::getCountThreads()\n  {\n    cxxtools::MutexLock lock(mutex);\n    return workers.size();\n  }"
  },
  {
    "function_name": "Worker::touch",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/worker.cpp",
    "lines": "522-525",
    "snippet": "void Worker::touch()\n  {\n    time(&lastWaitTime);\n  }",
    "includes": [
      "#include \"config.h\"",
      "#include <string.h>",
      "#include <pthread.h>",
      "#include <cxxtools/net/tcpserver.h>",
      "#include <cxxtools/atomicity.h>",
      "#include <cxxtools/ioerror.h>",
      "#include <cxxtools/dlloader.h>",
      "#include <sys/poll.h>",
      "#include <arpa/inet.h>",
      "#include <sys/socket.h>",
      "#include <sys/types.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <cxxtools/log.h>",
      "#include <tnt/tntconfig.h>",
      "#include <tnt/poller.h>",
      "#include <tnt/http.h>",
      "#include <tnt/httperror.h>",
      "#include <tnt/httpreply.h>",
      "#include <tnt/httprequest.h>",
      "#include \"tnt/job.h\"",
      "#include \"tnt/dispatcher.h\"",
      "#include \"tnt/worker.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "time",
          "args": [
            "&lastWaitTime"
          ],
          "line": 524
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"config.h\"\n#include <string.h>\n#include <pthread.h>\n#include <cxxtools/net/tcpserver.h>\n#include <cxxtools/atomicity.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/dlloader.h>\n#include <sys/poll.h>\n#include <arpa/inet.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <cxxtools/log.h>\n#include <tnt/tntconfig.h>\n#include <tnt/poller.h>\n#include <tnt/http.h>\n#include <tnt/httperror.h>\n#include <tnt/httpreply.h>\n#include <tnt/httprequest.h>\n#include \"tnt/job.h\"\n#include \"tnt/dispatcher.h\"\n#include \"tnt/worker.h\"\n\nvoid Worker::touch()\n  {\n    time(&lastWaitTime);\n  }"
  },
  {
    "function_name": "Worker::healthCheck",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/worker.cpp",
    "lines": "506-520",
    "snippet": "void Worker::healthCheck(time_t currentTime)\n  {\n    if (state == stateProcessingRequest\n        && lastWaitTime != 0\n        && TntConfig::it().maxRequestTime > 0)\n    {\n      if (static_cast<unsigned>(currentTime - lastWaitTime) > TntConfig::it().maxRequestTime)\n      {\n        log_fatal(\"requesttime \" << TntConfig::it().maxRequestTime << \" seconds in thread \"\n          << threadId << \" exceeded - exit process\");\n        log_info(\"current state: \" << state);\n        ::_exit(111);\n      }\n    }\n  }",
    "includes": [
      "#include \"config.h\"",
      "#include <string.h>",
      "#include <pthread.h>",
      "#include <cxxtools/net/tcpserver.h>",
      "#include <cxxtools/atomicity.h>",
      "#include <cxxtools/ioerror.h>",
      "#include <cxxtools/dlloader.h>",
      "#include <sys/poll.h>",
      "#include <arpa/inet.h>",
      "#include <sys/socket.h>",
      "#include <sys/types.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <cxxtools/log.h>",
      "#include <tnt/tntconfig.h>",
      "#include <tnt/poller.h>",
      "#include <tnt/http.h>",
      "#include <tnt/httperror.h>",
      "#include <tnt/httpreply.h>",
      "#include <tnt/httprequest.h>",
      "#include \"tnt/job.h\"",
      "#include \"tnt/dispatcher.h\"",
      "#include \"tnt/worker.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "::_exit",
          "args": [
            "111"
          ],
          "line": 517
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_info",
          "args": [
            "\"current state: \" << state"
          ],
          "line": 516
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_fatal",
          "args": [
            "\"requesttime \" << TntConfig::it().maxRequestTime << \" seconds in thread \"\n          << threadId << \" exceeded - exit process\""
          ],
          "line": 514
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TntConfig::it",
          "args": [],
          "line": 514
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TntConfig::it",
          "args": [],
          "line": 512
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "static_cast<unsigned>",
          "args": [
            "currentTime - lastWaitTime"
          ],
          "line": 512
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TntConfig::it",
          "args": [],
          "line": 510
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"config.h\"\n#include <string.h>\n#include <pthread.h>\n#include <cxxtools/net/tcpserver.h>\n#include <cxxtools/atomicity.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/dlloader.h>\n#include <sys/poll.h>\n#include <arpa/inet.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <cxxtools/log.h>\n#include <tnt/tntconfig.h>\n#include <tnt/poller.h>\n#include <tnt/http.h>\n#include <tnt/httperror.h>\n#include <tnt/httpreply.h>\n#include <tnt/httprequest.h>\n#include \"tnt/job.h\"\n#include \"tnt/dispatcher.h\"\n#include \"tnt/worker.h\"\n\nvoid Worker::healthCheck(time_t currentTime)\n  {\n    if (state == stateProcessingRequest\n        && lastWaitTime != 0\n        && TntConfig::it().maxRequestTime > 0)\n    {\n      if (static_cast<unsigned>(currentTime - lastWaitTime) > TntConfig::it().maxRequestTime)\n      {\n        log_fatal(\"requesttime \" << TntConfig::it().maxRequestTime << \" seconds in thread \"\n          << threadId << \" exceeded - exit process\");\n        log_info(\"current state: \" << state);\n        ::_exit(111);\n      }\n    }\n  }"
  },
  {
    "function_name": "Worker::timer",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/worker.cpp",
    "lines": "493-504",
    "snippet": "void Worker::timer()\n  {\n    time_t currentTime;\n    time(&currentTime);\n\n    cxxtools::MutexLock lock(mutex);\n    for (workers_type::iterator it = workers.begin();\n         it != workers.end(); ++it)\n    {\n      (*it)->healthCheck(currentTime);\n    }\n  }",
    "includes": [
      "#include \"config.h\"",
      "#include <string.h>",
      "#include <pthread.h>",
      "#include <cxxtools/net/tcpserver.h>",
      "#include <cxxtools/atomicity.h>",
      "#include <cxxtools/ioerror.h>",
      "#include <cxxtools/dlloader.h>",
      "#include <sys/poll.h>",
      "#include <arpa/inet.h>",
      "#include <sys/socket.h>",
      "#include <sys/types.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <cxxtools/log.h>",
      "#include <tnt/tntconfig.h>",
      "#include <tnt/poller.h>",
      "#include <tnt/http.h>",
      "#include <tnt/httperror.h>",
      "#include <tnt/httpreply.h>",
      "#include <tnt/httprequest.h>",
      "#include \"tnt/job.h\"",
      "#include \"tnt/dispatcher.h\"",
      "#include \"tnt/worker.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "",
          "args": [
            "currentTime"
          ],
          "line": 502
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "workers.end",
          "args": [],
          "line": 500
        },
        "resolved": true,
        "details": {
          "function_name": "end",
          "container": "Messageheader",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/messageheader.h",
          "lines": "130-131",
          "snippet": "const_iterator end() const\n        { return const_iterator(); }",
          "includes": [
            "#include <utility>",
            "#include <cstring>",
            "#include <string>",
            "#include <istream>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <utility>\n#include <cstring>\n#include <string>\n#include <istream>\n\nMessageheader {\n  const_iterator end() const\n          { return const_iterator(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "workers.begin",
          "args": [],
          "line": 499
        },
        "resolved": true,
        "details": {
          "function_name": "begin",
          "container": "Messageheader",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/messageheader.h",
          "lines": "128-129",
          "snippet": "const_iterator begin() const\n        { return const_iterator(rawdata); }",
          "includes": [
            "#include <utility>",
            "#include <cstring>",
            "#include <string>",
            "#include <istream>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <utility>\n#include <cstring>\n#include <string>\n#include <istream>\n\nMessageheader {\n  const_iterator begin() const\n          { return const_iterator(rawdata); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "time",
          "args": [
            "&currentTime"
          ],
          "line": 496
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"config.h\"\n#include <string.h>\n#include <pthread.h>\n#include <cxxtools/net/tcpserver.h>\n#include <cxxtools/atomicity.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/dlloader.h>\n#include <sys/poll.h>\n#include <arpa/inet.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <cxxtools/log.h>\n#include <tnt/tntconfig.h>\n#include <tnt/poller.h>\n#include <tnt/http.h>\n#include <tnt/httperror.h>\n#include <tnt/httpreply.h>\n#include <tnt/httprequest.h>\n#include \"tnt/job.h\"\n#include \"tnt/dispatcher.h\"\n#include \"tnt/worker.h\"\n\nvoid Worker::timer()\n  {\n    time_t currentTime;\n    time(&currentTime);\n\n    cxxtools::MutexLock lock(mutex);\n    for (workers_type::iterator it = workers.begin();\n         it != workers.end(); ++it)\n    {\n      (*it)->healthCheck(currentTime);\n    }\n  }"
  },
  {
    "function_name": "Worker::dispatch",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/worker.cpp",
    "lines": "376-491",
    "snippet": "void Worker::dispatch(HttpRequest& request, HttpReply& reply)\n  {\n    state = stateDispatch;\n    const std::string& url = request.getUrl();\n\n    if (!HttpRequest::checkUrl(url))\n    {\n      log_info(\"illegal url <\" << url << '>');\n      throw HttpError(HTTP_BAD_REQUEST, \"illegal url\");\n    }\n\n    request.setThreadContext(this);\n\n    Dispatcher::PosType pos(application.getDispatcher(), request);\n    while (true)\n    {\n      state = stateDispatch;\n\n      // pos.getNext() throws NotFoundException at end\n      Maptarget ci = pos.getNext();\n      try\n      {\n        Component* comp = 0;\n        try\n        {\n          if (ci.libname == application.getAppName())\n          {\n            // if the libname is the app name look first, if the component is\n            // linked directly\n            try\n            {\n              Compident cii = ci;\n              cii.libname = std::string();\n              comp = &comploader.fetchComp(cii, application.getDispatcher());\n            }\n            catch (const NotFoundException&)\n            {\n              // if the component is not found in the binary, fetchComp throws\n              // NotFoundException and comp remains 0.\n              // so we can ignore the exceptioni and just continue\n            }\n          }\n\n          if (comp == 0)\n            comp = &comploader.fetchComp(ci, application.getDispatcher());\n        }\n        catch (const NotFoundException& e)\n        {\n          log_debug(\"NotFoundException catched - url \" << e.getUrl() << \" try next mapping\");\n          continue;\n        }\n\n        request.setPathInfo(ci.hasPathInfo() ? ci.getPathInfo() : url);\n        request.setArgs(ci.getArgs());\n\n        std::string appname = application.getAppName().empty() ? ci.libname : application.getAppName();\n\n        application.getScopemanager().preCall(request, appname);\n\n        state = stateProcessingRequest;\n        unsigned http_return;\n        const char* http_msg;\n        std::string msg;\n        try\n        {\n          http_return = comp->topCall(request, reply, request.getQueryParams());\n          http_msg = HttpReturn::httpMessage(http_return);\n        }\n        catch (const HttpReturn& e)\n        {\n          http_return = e.getReturnCode();\n          msg = e.getMessage();\n          http_msg = msg.c_str();\n        }\n\n        if (http_return != DECLINED)\n        {\n          if (reply.isDirectMode())\n          {\n            log_info(\"request \" << request.getMethod_cstr() << ' ' << request.getQuery() << \" ready, returncode \" << http_return << ' ' << http_msg);\n            state = stateFlush;\n            reply.out().flush();\n          }\n          else\n          {\n            log_info(\"request \" << request.getMethod_cstr() << ' ' << request.getQuery() << \" ready, returncode \" << http_return << ' ' << http_msg << \" - ContentSize: \" << reply.getContentSize());\n\n            application.getScopemanager().postCall(request, reply, appname);\n\n            state = stateSendReply;\n            reply.sendReply(http_return, http_msg);\n          }\n\n          logRequest(request, reply, http_return);\n\n          if (reply.out())\n            log_debug(\"reply sent\");\n          else\n          {\n            reply.setKeepAliveCounter(0);\n            log_warn(\"sending failed\");\n          }\n\n          return;\n        }\n        else\n          log_debug(\"component \" << ci << \" returned DECLINED\");\n      }\n      catch (const LibraryNotFound& e)\n      {\n        log_warn(\"library \" << e.getLibname() << \" not found\");\n      }\n    }\n\n    throw NotFoundException(request.getUrl());\n  }",
    "includes": [
      "#include \"config.h\"",
      "#include <string.h>",
      "#include <pthread.h>",
      "#include <cxxtools/net/tcpserver.h>",
      "#include <cxxtools/atomicity.h>",
      "#include <cxxtools/ioerror.h>",
      "#include <cxxtools/dlloader.h>",
      "#include <sys/poll.h>",
      "#include <arpa/inet.h>",
      "#include <sys/socket.h>",
      "#include <sys/types.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <cxxtools/log.h>",
      "#include <tnt/tntconfig.h>",
      "#include <tnt/poller.h>",
      "#include <tnt/http.h>",
      "#include <tnt/httperror.h>",
      "#include <tnt/httpreply.h>",
      "#include <tnt/httprequest.h>",
      "#include \"tnt/job.h\"",
      "#include \"tnt/dispatcher.h\"",
      "#include \"tnt/worker.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "NotFoundException",
          "args": [
            "request.getUrl()"
          ],
          "line": 490
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "request.getUrl",
          "args": [],
          "line": 490
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_warn",
          "args": [
            "\"library \" << e.getLibname() << \" not found\""
          ],
          "line": 486
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e.getLibname",
          "args": [],
          "line": 486
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"component \" << ci << \" returned DECLINED\""
          ],
          "line": 482
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_warn",
          "args": [
            "\"sending failed\""
          ],
          "line": 476
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "reply.setKeepAliveCounter",
          "args": [
            "0"
          ],
          "line": 475
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"reply sent\""
          ],
          "line": 472
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "reply.out",
          "args": [],
          "line": 471
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "logRequest",
          "args": [
            "request",
            "reply",
            "http_return"
          ],
          "line": 469
        },
        "resolved": true,
        "details": {
          "function_name": "Worker::logRequest",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/worker.cpp",
          "lines": "299-374",
          "snippet": "void Worker::logRequest(const HttpRequest& request, const HttpReply& reply, unsigned httpReturn)\n  {\n    static cxxtools::atomic_t waitCount = 0;\n    cxxtools::atomicIncrement(waitCount);\n\n    const std::string& fname = TntConfig::it().accessLog;\n    if (fname.empty())\n      return;\n\n    std::ofstream& accessLog = application.accessLog;\n\n    if (!accessLog.is_open())\n    {\n      cxxtools::MutexLock lock(application.accessLogMutex);\n\n      if (!accessLog.is_open())\n      {\n        log_debug(\"access log is not open - open now\");\n        accessLog.open(fname.c_str(), std::ios::out | std::ios::app);\n        if (accessLog.fail())\n        {\n          std::cerr << \"failed to open access log \\\"\" << fname << '\"' << std::endl;\n          TntConfig::it().accessLog.clear();\n        }\n      }\n    }\n\n    log_debug(\"log request to access log with return code \" << httpReturn);\n\n    static const std::string unknown(\"-\");\n\n    std::string user = request.getUsername();\n    if (user.empty())\n      user = unknown;\n\n    std::string peerIp = request.getPeerIp();\n    if (peerIp.empty())\n      peerIp = unknown;\n\n    std::string query = request.getQuery();\n    if (query.empty())\n      query = unknown;\n\n    time_t t;\n    ::time(&t);\n\n    cxxtools::MutexLock lock(application.accessLogMutex);\n\n    // cache for timestamp of access log\n    static time_t lastLogTime = 0;\n    static char timebuf[40];\n\n    if (t != lastLogTime)\n    {\n      struct tm tm;\n      ::localtime_r(&t, &tm);\n      strftime(timebuf, sizeof(timebuf), \"%d/%b/%Y:%H:%M:%S %z\", &tm);\n      lastLogTime = t;\n    }\n\n    accessLog << peerIp\n              << \" - \" << user << \" [\" << timebuf << \"] \\\"\"\n              << request.getMethod_cstr() << ' '\n              << query << ' '\n              << \"HTTP/\" << request.getMajorVersion() << '.' << request.getMinorVersion() << \"\\\" \"\n              << httpReturn << ' ';\n    std::string::size_type contentSize = reply.getContentSize();\n    if (contentSize != 0)\n      accessLog << contentSize;\n    else\n      accessLog << '-';\n    accessLog << \" \\\"\" << request.getHeader(httpheader::referer, \"-\") << \"\\\" \\\"\"\n              << request.getHeader(httpheader::userAgent, \"-\") << \"\\\"\\n\";\n    if (cxxtools::atomicDecrement(waitCount) == 0)\n      accessLog.flush();\n  }",
          "includes": [
            "#include \"config.h\"",
            "#include <string.h>",
            "#include <pthread.h>",
            "#include <cxxtools/net/tcpserver.h>",
            "#include <cxxtools/atomicity.h>",
            "#include <cxxtools/ioerror.h>",
            "#include <cxxtools/dlloader.h>",
            "#include <sys/poll.h>",
            "#include <arpa/inet.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <cxxtools/log.h>",
            "#include <tnt/tntconfig.h>",
            "#include <tnt/poller.h>",
            "#include <tnt/http.h>",
            "#include <tnt/httperror.h>",
            "#include <tnt/httpreply.h>",
            "#include <tnt/httprequest.h>",
            "#include \"tnt/job.h\"",
            "#include \"tnt/dispatcher.h\"",
            "#include \"tnt/worker.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"config.h\"\n#include <string.h>\n#include <pthread.h>\n#include <cxxtools/net/tcpserver.h>\n#include <cxxtools/atomicity.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/dlloader.h>\n#include <sys/poll.h>\n#include <arpa/inet.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <cxxtools/log.h>\n#include <tnt/tntconfig.h>\n#include <tnt/poller.h>\n#include <tnt/http.h>\n#include <tnt/httperror.h>\n#include <tnt/httpreply.h>\n#include <tnt/httprequest.h>\n#include \"tnt/job.h\"\n#include \"tnt/dispatcher.h\"\n#include \"tnt/worker.h\"\n\nvoid Worker::logRequest(const HttpRequest& request, const HttpReply& reply, unsigned httpReturn)\n  {\n    static cxxtools::atomic_t waitCount = 0;\n    cxxtools::atomicIncrement(waitCount);\n\n    const std::string& fname = TntConfig::it().accessLog;\n    if (fname.empty())\n      return;\n\n    std::ofstream& accessLog = application.accessLog;\n\n    if (!accessLog.is_open())\n    {\n      cxxtools::MutexLock lock(application.accessLogMutex);\n\n      if (!accessLog.is_open())\n      {\n        log_debug(\"access log is not open - open now\");\n        accessLog.open(fname.c_str(), std::ios::out | std::ios::app);\n        if (accessLog.fail())\n        {\n          std::cerr << \"failed to open access log \\\"\" << fname << '\"' << std::endl;\n          TntConfig::it().accessLog.clear();\n        }\n      }\n    }\n\n    log_debug(\"log request to access log with return code \" << httpReturn);\n\n    static const std::string unknown(\"-\");\n\n    std::string user = request.getUsername();\n    if (user.empty())\n      user = unknown;\n\n    std::string peerIp = request.getPeerIp();\n    if (peerIp.empty())\n      peerIp = unknown;\n\n    std::string query = request.getQuery();\n    if (query.empty())\n      query = unknown;\n\n    time_t t;\n    ::time(&t);\n\n    cxxtools::MutexLock lock(application.accessLogMutex);\n\n    // cache for timestamp of access log\n    static time_t lastLogTime = 0;\n    static char timebuf[40];\n\n    if (t != lastLogTime)\n    {\n      struct tm tm;\n      ::localtime_r(&t, &tm);\n      strftime(timebuf, sizeof(timebuf), \"%d/%b/%Y:%H:%M:%S %z\", &tm);\n      lastLogTime = t;\n    }\n\n    accessLog << peerIp\n              << \" - \" << user << \" [\" << timebuf << \"] \\\"\"\n              << request.getMethod_cstr() << ' '\n              << query << ' '\n              << \"HTTP/\" << request.getMajorVersion() << '.' << request.getMinorVersion() << \"\\\" \"\n              << httpReturn << ' ';\n    std::string::size_type contentSize = reply.getContentSize();\n    if (contentSize != 0)\n      accessLog << contentSize;\n    else\n      accessLog << '-';\n    accessLog << \" \\\"\" << request.getHeader(httpheader::referer, \"-\") << \"\\\" \\\"\"\n              << request.getHeader(httpheader::userAgent, \"-\") << \"\\\"\\n\";\n    if (cxxtools::atomicDecrement(waitCount) == 0)\n      accessLog.flush();\n  }"
        }
      },
      {
        "call_info": {
          "callee": "reply.sendReply",
          "args": [
            "http_return",
            "http_msg"
          ],
          "line": 466
        },
        "resolved": true,
        "details": {
          "function_name": "sendReply",
          "container": "HttpReply",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/httpreply.h",
          "lines": "84-85",
          "snippet": "void sendReply(unsigned ret, const std::string& msg)\n        { sendReply(ret, msg.c_str()); }",
          "includes": [
            "#include <iosfwd>",
            "#include <tnt/http.h>",
            "#include <tnt/httpmessage.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <iosfwd>\n#include <tnt/http.h>\n#include <tnt/httpmessage.h>\n\nHttpReply {\n  void sendReply(unsigned ret, const std::string& msg)\n          { sendReply(ret, msg.c_str()); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "application.getScopemanager",
          "args": [
            "request",
            "reply",
            "appname"
          ],
          "line": 463
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "application.getScopemanager",
          "args": [],
          "line": 463
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_info",
          "args": [
            "\"request \" << request.getMethod_cstr() << ' ' << request.getQuery() << \" ready, returncode \" << http_return << ' ' << http_msg << \" - ContentSize: \" << reply.getContentSize()"
          ],
          "line": 461
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "reply.getContentSize",
          "args": [],
          "line": 461
        },
        "resolved": true,
        "details": {
          "function_name": "getContentSize",
          "container": "HttpRequest",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/httprequest.h",
          "lines": "240-241",
          "snippet": "size_t getContentSize() const\n        { return contentSize; }",
          "includes": [
            "#include <cstring>",
            "#include <string>",
            "#include <cxxtools/atomicity.h>",
            "#include <map>",
            "#include <locale>",
            "#include <tnt/threadcontext.h>",
            "#include <tnt/scope.h>",
            "#include <tnt/query_params.h>",
            "#include <tnt/encoding.h>",
            "#include <tnt/cookie.h>",
            "#include <tnt/multipart.h>",
            "#include <tnt/contenttype.h>",
            "#include <tnt/socketif.h>",
            "#include <tnt/httpheader.h>",
            "#include <tnt/httpmessage.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <cstring>\n#include <string>\n#include <cxxtools/atomicity.h>\n#include <map>\n#include <locale>\n#include <tnt/threadcontext.h>\n#include <tnt/scope.h>\n#include <tnt/query_params.h>\n#include <tnt/encoding.h>\n#include <tnt/cookie.h>\n#include <tnt/multipart.h>\n#include <tnt/contenttype.h>\n#include <tnt/socketif.h>\n#include <tnt/httpheader.h>\n#include <tnt/httpmessage.h>\n\nHttpRequest {\n  size_t getContentSize() const\n          { return contentSize; }\n}"
        }
      },
      {
        "call_info": {
          "callee": "request.getQuery",
          "args": [],
          "line": 461
        },
        "resolved": true,
        "details": {
          "function_name": "getQuery",
          "container": "HttpRequest",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/httprequest.h",
          "lines": "143-144",
          "snippet": "std::string getQuery() const\n        { return queryString.empty() ? url : url + '?' + queryString; }",
          "includes": [
            "#include <cstring>",
            "#include <string>",
            "#include <cxxtools/atomicity.h>",
            "#include <map>",
            "#include <locale>",
            "#include <tnt/threadcontext.h>",
            "#include <tnt/scope.h>",
            "#include <tnt/query_params.h>",
            "#include <tnt/encoding.h>",
            "#include <tnt/cookie.h>",
            "#include <tnt/multipart.h>",
            "#include <tnt/contenttype.h>",
            "#include <tnt/socketif.h>",
            "#include <tnt/httpheader.h>",
            "#include <tnt/httpmessage.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <cstring>\n#include <string>\n#include <cxxtools/atomicity.h>\n#include <map>\n#include <locale>\n#include <tnt/threadcontext.h>\n#include <tnt/scope.h>\n#include <tnt/query_params.h>\n#include <tnt/encoding.h>\n#include <tnt/cookie.h>\n#include <tnt/multipart.h>\n#include <tnt/contenttype.h>\n#include <tnt/socketif.h>\n#include <tnt/httpheader.h>\n#include <tnt/httpmessage.h>\n\nHttpRequest {\n  std::string getQuery() const\n          { return queryString.empty() ? url : url + '?' + queryString; }\n}"
        }
      },
      {
        "call_info": {
          "callee": "request.getMethod_cstr",
          "args": [],
          "line": 461
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "reply.out",
          "args": [],
          "line": 457
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "reply.out",
          "args": [],
          "line": 457
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_info",
          "args": [
            "\"request \" << request.getMethod_cstr() << ' ' << request.getQuery() << \" ready, returncode \" << http_return << ' ' << http_msg"
          ],
          "line": 455
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "request.getMethod_cstr",
          "args": [],
          "line": 455
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "reply.isDirectMode",
          "args": [],
          "line": 453
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "msg.c_str",
          "args": [],
          "line": 448
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e.getMessage",
          "args": [],
          "line": 447
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e.getReturnCode",
          "args": [],
          "line": 446
        },
        "resolved": true,
        "details": {
          "function_name": "getReturnCode",
          "container": "HttpReturn",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/httperror.h",
          "lines": "48-49",
          "snippet": "unsigned getReturnCode() const\n        { return returncode; }",
          "includes": [
            "#include <tnt/httpmessage.h>",
            "#include <string>",
            "#include <stdexcept>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <tnt/httpmessage.h>\n#include <string>\n#include <stdexcept>\n\nHttpReturn {\n  unsigned getReturnCode() const\n          { return returncode; }\n}"
        }
      },
      {
        "call_info": {
          "callee": "HttpReturn::httpMessage",
          "args": [
            "http_return"
          ],
          "line": 442
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "comp->topCall",
          "args": [
            "request",
            "reply",
            "request.getQueryParams()"
          ],
          "line": 441
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "request.getQueryParams",
          "args": [],
          "line": 441
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "application.getScopemanager",
          "args": [
            "request",
            "appname"
          ],
          "line": 433
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "application.getScopemanager",
          "args": [],
          "line": 433
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "application.getAppName",
          "args": [],
          "line": 431
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "application.getAppName",
          "args": [],
          "line": 431
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "application.getAppName",
          "args": [],
          "line": 431
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "request.setArgs",
          "args": [
            "ci.getArgs()"
          ],
          "line": 429
        },
        "resolved": true,
        "details": {
          "function_name": "setArgs",
          "container": "HttpRequest",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/httprequest.h",
          "lines": "156-156",
          "snippet": "void setArgs(const args_type& a)             { args = a; }",
          "includes": [
            "#include <cstring>",
            "#include <string>",
            "#include <cxxtools/atomicity.h>",
            "#include <map>",
            "#include <locale>",
            "#include <tnt/threadcontext.h>",
            "#include <tnt/scope.h>",
            "#include <tnt/query_params.h>",
            "#include <tnt/encoding.h>",
            "#include <tnt/cookie.h>",
            "#include <tnt/multipart.h>",
            "#include <tnt/contenttype.h>",
            "#include <tnt/socketif.h>",
            "#include <tnt/httpheader.h>",
            "#include <tnt/httpmessage.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <cstring>\n#include <string>\n#include <cxxtools/atomicity.h>\n#include <map>\n#include <locale>\n#include <tnt/threadcontext.h>\n#include <tnt/scope.h>\n#include <tnt/query_params.h>\n#include <tnt/encoding.h>\n#include <tnt/cookie.h>\n#include <tnt/multipart.h>\n#include <tnt/contenttype.h>\n#include <tnt/socketif.h>\n#include <tnt/httpheader.h>\n#include <tnt/httpmessage.h>\n\nHttpRequest {\n  void setArgs(const args_type& a)             { args = a; }\n}"
        }
      },
      {
        "call_info": {
          "callee": "ci.getArgs",
          "args": [],
          "line": 429
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "request.setPathInfo",
          "args": [
            "ci.hasPathInfo() ? ci.getPathInfo() : url"
          ],
          "line": 428
        },
        "resolved": true,
        "details": {
          "function_name": "setPathInfo",
          "container": "HttpRequest",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/httprequest.h",
          "lines": "153-153",
          "snippet": "void setPathInfo(const std::string& p)       { pathinfo = p; }",
          "includes": [
            "#include <cstring>",
            "#include <string>",
            "#include <cxxtools/atomicity.h>",
            "#include <map>",
            "#include <locale>",
            "#include <tnt/threadcontext.h>",
            "#include <tnt/scope.h>",
            "#include <tnt/query_params.h>",
            "#include <tnt/encoding.h>",
            "#include <tnt/cookie.h>",
            "#include <tnt/multipart.h>",
            "#include <tnt/contenttype.h>",
            "#include <tnt/socketif.h>",
            "#include <tnt/httpheader.h>",
            "#include <tnt/httpmessage.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <cstring>\n#include <string>\n#include <cxxtools/atomicity.h>\n#include <map>\n#include <locale>\n#include <tnt/threadcontext.h>\n#include <tnt/scope.h>\n#include <tnt/query_params.h>\n#include <tnt/encoding.h>\n#include <tnt/cookie.h>\n#include <tnt/multipart.h>\n#include <tnt/contenttype.h>\n#include <tnt/socketif.h>\n#include <tnt/httpheader.h>\n#include <tnt/httpmessage.h>\n\nHttpRequest {\n  void setPathInfo(const std::string& p)       { pathinfo = p; }\n}"
        }
      },
      {
        "call_info": {
          "callee": "ci.getPathInfo",
          "args": [],
          "line": 428
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ci.hasPathInfo",
          "args": [],
          "line": 428
        },
        "resolved": true,
        "details": {
          "function_name": "hasPathInfo",
          "container": "Maptarget",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/maptarget.h",
          "lines": "66-67",
          "snippet": "bool hasPathInfo() const\n        { return pathinfo_set; }",
          "includes": [
            "#include <string>",
            "#include <map>",
            "#include <tnt/compident.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string>\n#include <map>\n#include <tnt/compident.h>\n\nMaptarget {\n  bool hasPathInfo() const\n          { return pathinfo_set; }\n}"
        }
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"NotFoundException catched - url \" << e.getUrl() << \" try next mapping\""
          ],
          "line": 424
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e.getUrl",
          "args": [],
          "line": 424
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "comploader.fetchComp",
          "args": [
            "ci",
            "application.getDispatcher()"
          ],
          "line": 420
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "application.getDispatcher",
          "args": [],
          "line": 420
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "comploader.fetchComp",
          "args": [
            "cii",
            "application.getDispatcher()"
          ],
          "line": 409
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "application.getDispatcher",
          "args": [],
          "line": 409
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "std::string",
          "args": [],
          "line": 408
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "application.getAppName",
          "args": [],
          "line": 401
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pos.getNext",
          "args": [],
          "line": 395
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "application.getDispatcher",
          "args": [],
          "line": 389
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "request.setThreadContext",
          "args": [
            "this"
          ],
          "line": 387
        },
        "resolved": true,
        "details": {
          "function_name": "setThreadContext",
          "container": "HttpRequest",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/httprequest.h",
          "lines": "229-229",
          "snippet": "void setThreadContext(ThreadContext* ctx)    { threadContext = ctx; }",
          "includes": [
            "#include <cstring>",
            "#include <string>",
            "#include <cxxtools/atomicity.h>",
            "#include <map>",
            "#include <locale>",
            "#include <tnt/threadcontext.h>",
            "#include <tnt/scope.h>",
            "#include <tnt/query_params.h>",
            "#include <tnt/encoding.h>",
            "#include <tnt/cookie.h>",
            "#include <tnt/multipart.h>",
            "#include <tnt/contenttype.h>",
            "#include <tnt/socketif.h>",
            "#include <tnt/httpheader.h>",
            "#include <tnt/httpmessage.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <cstring>\n#include <string>\n#include <cxxtools/atomicity.h>\n#include <map>\n#include <locale>\n#include <tnt/threadcontext.h>\n#include <tnt/scope.h>\n#include <tnt/query_params.h>\n#include <tnt/encoding.h>\n#include <tnt/cookie.h>\n#include <tnt/multipart.h>\n#include <tnt/contenttype.h>\n#include <tnt/socketif.h>\n#include <tnt/httpheader.h>\n#include <tnt/httpmessage.h>\n\nHttpRequest {\n  void setThreadContext(ThreadContext* ctx)    { threadContext = ctx; }\n}"
        }
      },
      {
        "call_info": {
          "callee": "HttpError",
          "args": [
            "HTTP_BAD_REQUEST",
            "\"illegal url\""
          ],
          "line": 384
        },
        "resolved": true,
        "details": {
          "function_name": "HttpError::HttpError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/httperror.cpp",
          "lines": "146-158",
          "snippet": "HttpError::HttpError(unsigned errcode)\n    : msg(HttpReturn::httpMessage(errcode))\n  {\n    std::ostringstream b;\n    HtmlEscOstream sb(b);\n\n    b << \"<html><body><h1>Error</h1><p>\";\n    sb << msg;\n    b << \"</p></body></html>\";\n    body = b.str();\n\n    msg = httpErrorFormat(errcode, msg);\n  }",
          "includes": [
            "#include <algorithm>",
            "#include <sstream>",
            "#include <iostream>",
            "#include <tnt/htmlescostream.h>",
            "#include <tnt/http.h>",
            "#include <tnt/httperror.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <algorithm>\n#include <sstream>\n#include <iostream>\n#include <tnt/htmlescostream.h>\n#include <tnt/http.h>\n#include <tnt/httperror.h>\n\nHttpError::HttpError(unsigned errcode)\n    : msg(HttpReturn::httpMessage(errcode))\n  {\n    std::ostringstream b;\n    HtmlEscOstream sb(b);\n\n    b << \"<html><body><h1>Error</h1><p>\";\n    sb << msg;\n    b << \"</p></body></html>\";\n    body = b.str();\n\n    msg = httpErrorFormat(errcode, msg);\n  }"
        }
      },
      {
        "call_info": {
          "callee": "log_info",
          "args": [
            "\"illegal url <\" << url << '>'"
          ],
          "line": 383
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HttpRequest::checkUrl",
          "args": [
            "url"
          ],
          "line": 381
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "request.getUrl",
          "args": [],
          "line": 379
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"config.h\"\n#include <string.h>\n#include <pthread.h>\n#include <cxxtools/net/tcpserver.h>\n#include <cxxtools/atomicity.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/dlloader.h>\n#include <sys/poll.h>\n#include <arpa/inet.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <cxxtools/log.h>\n#include <tnt/tntconfig.h>\n#include <tnt/poller.h>\n#include <tnt/http.h>\n#include <tnt/httperror.h>\n#include <tnt/httpreply.h>\n#include <tnt/httprequest.h>\n#include \"tnt/job.h\"\n#include \"tnt/dispatcher.h\"\n#include \"tnt/worker.h\"\n\nvoid Worker::dispatch(HttpRequest& request, HttpReply& reply)\n  {\n    state = stateDispatch;\n    const std::string& url = request.getUrl();\n\n    if (!HttpRequest::checkUrl(url))\n    {\n      log_info(\"illegal url <\" << url << '>');\n      throw HttpError(HTTP_BAD_REQUEST, \"illegal url\");\n    }\n\n    request.setThreadContext(this);\n\n    Dispatcher::PosType pos(application.getDispatcher(), request);\n    while (true)\n    {\n      state = stateDispatch;\n\n      // pos.getNext() throws NotFoundException at end\n      Maptarget ci = pos.getNext();\n      try\n      {\n        Component* comp = 0;\n        try\n        {\n          if (ci.libname == application.getAppName())\n          {\n            // if the libname is the app name look first, if the component is\n            // linked directly\n            try\n            {\n              Compident cii = ci;\n              cii.libname = std::string();\n              comp = &comploader.fetchComp(cii, application.getDispatcher());\n            }\n            catch (const NotFoundException&)\n            {\n              // if the component is not found in the binary, fetchComp throws\n              // NotFoundException and comp remains 0.\n              // so we can ignore the exceptioni and just continue\n            }\n          }\n\n          if (comp == 0)\n            comp = &comploader.fetchComp(ci, application.getDispatcher());\n        }\n        catch (const NotFoundException& e)\n        {\n          log_debug(\"NotFoundException catched - url \" << e.getUrl() << \" try next mapping\");\n          continue;\n        }\n\n        request.setPathInfo(ci.hasPathInfo() ? ci.getPathInfo() : url);\n        request.setArgs(ci.getArgs());\n\n        std::string appname = application.getAppName().empty() ? ci.libname : application.getAppName();\n\n        application.getScopemanager().preCall(request, appname);\n\n        state = stateProcessingRequest;\n        unsigned http_return;\n        const char* http_msg;\n        std::string msg;\n        try\n        {\n          http_return = comp->topCall(request, reply, request.getQueryParams());\n          http_msg = HttpReturn::httpMessage(http_return);\n        }\n        catch (const HttpReturn& e)\n        {\n          http_return = e.getReturnCode();\n          msg = e.getMessage();\n          http_msg = msg.c_str();\n        }\n\n        if (http_return != DECLINED)\n        {\n          if (reply.isDirectMode())\n          {\n            log_info(\"request \" << request.getMethod_cstr() << ' ' << request.getQuery() << \" ready, returncode \" << http_return << ' ' << http_msg);\n            state = stateFlush;\n            reply.out().flush();\n          }\n          else\n          {\n            log_info(\"request \" << request.getMethod_cstr() << ' ' << request.getQuery() << \" ready, returncode \" << http_return << ' ' << http_msg << \" - ContentSize: \" << reply.getContentSize());\n\n            application.getScopemanager().postCall(request, reply, appname);\n\n            state = stateSendReply;\n            reply.sendReply(http_return, http_msg);\n          }\n\n          logRequest(request, reply, http_return);\n\n          if (reply.out())\n            log_debug(\"reply sent\");\n          else\n          {\n            reply.setKeepAliveCounter(0);\n            log_warn(\"sending failed\");\n          }\n\n          return;\n        }\n        else\n          log_debug(\"component \" << ci << \" returned DECLINED\");\n      }\n      catch (const LibraryNotFound& e)\n      {\n        log_warn(\"library \" << e.getLibname() << \" not found\");\n      }\n    }\n\n    throw NotFoundException(request.getUrl());\n  }"
  },
  {
    "function_name": "Worker::logRequest",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/worker.cpp",
    "lines": "299-374",
    "snippet": "void Worker::logRequest(const HttpRequest& request, const HttpReply& reply, unsigned httpReturn)\n  {\n    static cxxtools::atomic_t waitCount = 0;\n    cxxtools::atomicIncrement(waitCount);\n\n    const std::string& fname = TntConfig::it().accessLog;\n    if (fname.empty())\n      return;\n\n    std::ofstream& accessLog = application.accessLog;\n\n    if (!accessLog.is_open())\n    {\n      cxxtools::MutexLock lock(application.accessLogMutex);\n\n      if (!accessLog.is_open())\n      {\n        log_debug(\"access log is not open - open now\");\n        accessLog.open(fname.c_str(), std::ios::out | std::ios::app);\n        if (accessLog.fail())\n        {\n          std::cerr << \"failed to open access log \\\"\" << fname << '\"' << std::endl;\n          TntConfig::it().accessLog.clear();\n        }\n      }\n    }\n\n    log_debug(\"log request to access log with return code \" << httpReturn);\n\n    static const std::string unknown(\"-\");\n\n    std::string user = request.getUsername();\n    if (user.empty())\n      user = unknown;\n\n    std::string peerIp = request.getPeerIp();\n    if (peerIp.empty())\n      peerIp = unknown;\n\n    std::string query = request.getQuery();\n    if (query.empty())\n      query = unknown;\n\n    time_t t;\n    ::time(&t);\n\n    cxxtools::MutexLock lock(application.accessLogMutex);\n\n    // cache for timestamp of access log\n    static time_t lastLogTime = 0;\n    static char timebuf[40];\n\n    if (t != lastLogTime)\n    {\n      struct tm tm;\n      ::localtime_r(&t, &tm);\n      strftime(timebuf, sizeof(timebuf), \"%d/%b/%Y:%H:%M:%S %z\", &tm);\n      lastLogTime = t;\n    }\n\n    accessLog << peerIp\n              << \" - \" << user << \" [\" << timebuf << \"] \\\"\"\n              << request.getMethod_cstr() << ' '\n              << query << ' '\n              << \"HTTP/\" << request.getMajorVersion() << '.' << request.getMinorVersion() << \"\\\" \"\n              << httpReturn << ' ';\n    std::string::size_type contentSize = reply.getContentSize();\n    if (contentSize != 0)\n      accessLog << contentSize;\n    else\n      accessLog << '-';\n    accessLog << \" \\\"\" << request.getHeader(httpheader::referer, \"-\") << \"\\\" \\\"\"\n              << request.getHeader(httpheader::userAgent, \"-\") << \"\\\"\\n\";\n    if (cxxtools::atomicDecrement(waitCount) == 0)\n      accessLog.flush();\n  }",
    "includes": [
      "#include \"config.h\"",
      "#include <string.h>",
      "#include <pthread.h>",
      "#include <cxxtools/net/tcpserver.h>",
      "#include <cxxtools/atomicity.h>",
      "#include <cxxtools/ioerror.h>",
      "#include <cxxtools/dlloader.h>",
      "#include <sys/poll.h>",
      "#include <arpa/inet.h>",
      "#include <sys/socket.h>",
      "#include <sys/types.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <cxxtools/log.h>",
      "#include <tnt/tntconfig.h>",
      "#include <tnt/poller.h>",
      "#include <tnt/http.h>",
      "#include <tnt/httperror.h>",
      "#include <tnt/httpreply.h>",
      "#include <tnt/httprequest.h>",
      "#include \"tnt/job.h\"",
      "#include \"tnt/dispatcher.h\"",
      "#include \"tnt/worker.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "accessLog.flush",
          "args": [],
          "line": 373
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "cxxtools::atomicDecrement",
          "args": [
            "waitCount"
          ],
          "line": 372
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "request.getHeader",
          "args": [
            "httpheader::userAgent",
            "\"-\""
          ],
          "line": 371
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "request.getHeader",
          "args": [
            "httpheader::referer",
            "\"-\""
          ],
          "line": 370
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "reply.getContentSize",
          "args": [],
          "line": 365
        },
        "resolved": true,
        "details": {
          "function_name": "getContentSize",
          "container": "HttpRequest",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/httprequest.h",
          "lines": "240-241",
          "snippet": "size_t getContentSize() const\n        { return contentSize; }",
          "includes": [
            "#include <cstring>",
            "#include <string>",
            "#include <cxxtools/atomicity.h>",
            "#include <map>",
            "#include <locale>",
            "#include <tnt/threadcontext.h>",
            "#include <tnt/scope.h>",
            "#include <tnt/query_params.h>",
            "#include <tnt/encoding.h>",
            "#include <tnt/cookie.h>",
            "#include <tnt/multipart.h>",
            "#include <tnt/contenttype.h>",
            "#include <tnt/socketif.h>",
            "#include <tnt/httpheader.h>",
            "#include <tnt/httpmessage.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <cstring>\n#include <string>\n#include <cxxtools/atomicity.h>\n#include <map>\n#include <locale>\n#include <tnt/threadcontext.h>\n#include <tnt/scope.h>\n#include <tnt/query_params.h>\n#include <tnt/encoding.h>\n#include <tnt/cookie.h>\n#include <tnt/multipart.h>\n#include <tnt/contenttype.h>\n#include <tnt/socketif.h>\n#include <tnt/httpheader.h>\n#include <tnt/httpmessage.h>\n\nHttpRequest {\n  size_t getContentSize() const\n          { return contentSize; }\n}"
        }
      },
      {
        "call_info": {
          "callee": "request.getMinorVersion",
          "args": [],
          "line": 363
        },
        "resolved": true,
        "details": {
          "function_name": "getMinorVersion",
          "container": "HttpMessage",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/httpmessage.h",
          "lines": "76-77",
          "snippet": "unsigned short getMinorVersion() const\n        { return minorVersion; }",
          "includes": [
            "#include <time.h>",
            "#include <tnt/cookie.h>",
            "#include <tnt/httpheader.h>",
            "#include <tnt/messageheader.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <time.h>\n#include <tnt/cookie.h>\n#include <tnt/httpheader.h>\n#include <tnt/messageheader.h>\n\nHttpMessage {\n  unsigned short getMinorVersion() const\n          { return minorVersion; }\n}"
        }
      },
      {
        "call_info": {
          "callee": "request.getMajorVersion",
          "args": [],
          "line": 363
        },
        "resolved": true,
        "details": {
          "function_name": "getMajorVersion",
          "container": "HttpMessage",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/httpmessage.h",
          "lines": "73-74",
          "snippet": "unsigned short getMajorVersion() const\n        { return majorVersion; }",
          "includes": [
            "#include <time.h>",
            "#include <tnt/cookie.h>",
            "#include <tnt/httpheader.h>",
            "#include <tnt/messageheader.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <time.h>\n#include <tnt/cookie.h>\n#include <tnt/httpheader.h>\n#include <tnt/messageheader.h>\n\nHttpMessage {\n  unsigned short getMajorVersion() const\n          { return majorVersion; }\n}"
        }
      },
      {
        "call_info": {
          "callee": "request.getMethod_cstr",
          "args": [],
          "line": 361
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strftime",
          "args": [
            "timebuf",
            "sizeof(timebuf)",
            "\"%d/%b/%Y:%H:%M:%S %z\"",
            "&tm"
          ],
          "line": 355
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "::localtime_r",
          "args": [
            "&t",
            "&tm"
          ],
          "line": 354
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "::time",
          "args": [
            "&t"
          ],
          "line": 343
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "query.empty",
          "args": [],
          "line": 339
        },
        "resolved": true,
        "details": {
          "function_name": "empty",
          "container": "Pstr",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/httpmessage.cpp",
          "lines": "156-156",
          "snippet": "bool empty() const      { return start == end; }",
          "includes": [
            "#include <stdio.h>",
            "#include <sstream>",
            "#include <list>",
            "#include <cxxtools/mutex.h>",
            "#include <cxxtools/log.h>",
            "#include <tnt/httpmessage.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <stdio.h>\n#include <sstream>\n#include <list>\n#include <cxxtools/mutex.h>\n#include <cxxtools/log.h>\n#include <tnt/httpmessage.h>\n\nPstr {\n  bool empty() const      { return start == end; }\n}"
        }
      },
      {
        "call_info": {
          "callee": "request.getQuery",
          "args": [],
          "line": 338
        },
        "resolved": true,
        "details": {
          "function_name": "getQuery",
          "container": "HttpRequest",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/httprequest.h",
          "lines": "143-144",
          "snippet": "std::string getQuery() const\n        { return queryString.empty() ? url : url + '?' + queryString; }",
          "includes": [
            "#include <cstring>",
            "#include <string>",
            "#include <cxxtools/atomicity.h>",
            "#include <map>",
            "#include <locale>",
            "#include <tnt/threadcontext.h>",
            "#include <tnt/scope.h>",
            "#include <tnt/query_params.h>",
            "#include <tnt/encoding.h>",
            "#include <tnt/cookie.h>",
            "#include <tnt/multipart.h>",
            "#include <tnt/contenttype.h>",
            "#include <tnt/socketif.h>",
            "#include <tnt/httpheader.h>",
            "#include <tnt/httpmessage.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <cstring>\n#include <string>\n#include <cxxtools/atomicity.h>\n#include <map>\n#include <locale>\n#include <tnt/threadcontext.h>\n#include <tnt/scope.h>\n#include <tnt/query_params.h>\n#include <tnt/encoding.h>\n#include <tnt/cookie.h>\n#include <tnt/multipart.h>\n#include <tnt/contenttype.h>\n#include <tnt/socketif.h>\n#include <tnt/httpheader.h>\n#include <tnt/httpmessage.h>\n\nHttpRequest {\n  std::string getQuery() const\n          { return queryString.empty() ? url : url + '?' + queryString; }\n}"
        }
      },
      {
        "call_info": {
          "callee": "request.getPeerIp",
          "args": [],
          "line": 334
        },
        "resolved": true,
        "details": {
          "function_name": "getPeerIp",
          "container": "Cmd::NullSocketIf",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/cmd.h",
          "lines": "56-57",
          "snippet": "std::string getPeerIp() const\n          { return std::string(); }",
          "includes": [
            "#include <tnt/component.h>",
            "#include <tnt/compident.h>",
            "#include <tnt/comploader.h>",
            "#include <tnt/scopemanager.h>",
            "#include <tnt/scope.h>",
            "#include <tnt/httpreply.h>",
            "#include <tnt/httprequest.h>",
            "#include <tnt/tntnet.h>",
            "#include <iosfwd>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <tnt/component.h>\n#include <tnt/compident.h>\n#include <tnt/comploader.h>\n#include <tnt/scopemanager.h>\n#include <tnt/scope.h>\n#include <tnt/httpreply.h>\n#include <tnt/httprequest.h>\n#include <tnt/tntnet.h>\n#include <iosfwd>\n\nCmd {\n  NullSocketIf {\n    std::string getPeerIp() const\n              { return std::string(); }\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "request.getUsername",
          "args": [],
          "line": 330
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"log request to access log with return code \" << httpReturn"
          ],
          "line": 326
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TntConfig::it",
          "args": [],
          "line": 321
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TntConfig::it",
          "args": [],
          "line": 321
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "accessLog.fail",
          "args": [],
          "line": 318
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "accessLog.open",
          "args": [
            "fname.c_str()",
            "std::ios::out | std::ios::app"
          ],
          "line": 317
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fname.c_str",
          "args": [],
          "line": 317
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"access log is not open - open now\""
          ],
          "line": 316
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "accessLog.is_open",
          "args": [],
          "line": 314
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "accessLog.is_open",
          "args": [],
          "line": 310
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TntConfig::it",
          "args": [],
          "line": 304
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "cxxtools::atomicIncrement",
          "args": [
            "waitCount"
          ],
          "line": 302
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"config.h\"\n#include <string.h>\n#include <pthread.h>\n#include <cxxtools/net/tcpserver.h>\n#include <cxxtools/atomicity.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/dlloader.h>\n#include <sys/poll.h>\n#include <arpa/inet.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <cxxtools/log.h>\n#include <tnt/tntconfig.h>\n#include <tnt/poller.h>\n#include <tnt/http.h>\n#include <tnt/httperror.h>\n#include <tnt/httpreply.h>\n#include <tnt/httprequest.h>\n#include \"tnt/job.h\"\n#include \"tnt/dispatcher.h\"\n#include \"tnt/worker.h\"\n\nvoid Worker::logRequest(const HttpRequest& request, const HttpReply& reply, unsigned httpReturn)\n  {\n    static cxxtools::atomic_t waitCount = 0;\n    cxxtools::atomicIncrement(waitCount);\n\n    const std::string& fname = TntConfig::it().accessLog;\n    if (fname.empty())\n      return;\n\n    std::ofstream& accessLog = application.accessLog;\n\n    if (!accessLog.is_open())\n    {\n      cxxtools::MutexLock lock(application.accessLogMutex);\n\n      if (!accessLog.is_open())\n      {\n        log_debug(\"access log is not open - open now\");\n        accessLog.open(fname.c_str(), std::ios::out | std::ios::app);\n        if (accessLog.fail())\n        {\n          std::cerr << \"failed to open access log \\\"\" << fname << '\"' << std::endl;\n          TntConfig::it().accessLog.clear();\n        }\n      }\n    }\n\n    log_debug(\"log request to access log with return code \" << httpReturn);\n\n    static const std::string unknown(\"-\");\n\n    std::string user = request.getUsername();\n    if (user.empty())\n      user = unknown;\n\n    std::string peerIp = request.getPeerIp();\n    if (peerIp.empty())\n      peerIp = unknown;\n\n    std::string query = request.getQuery();\n    if (query.empty())\n      query = unknown;\n\n    time_t t;\n    ::time(&t);\n\n    cxxtools::MutexLock lock(application.accessLogMutex);\n\n    // cache for timestamp of access log\n    static time_t lastLogTime = 0;\n    static char timebuf[40];\n\n    if (t != lastLogTime)\n    {\n      struct tm tm;\n      ::localtime_r(&t, &tm);\n      strftime(timebuf, sizeof(timebuf), \"%d/%b/%Y:%H:%M:%S %z\", &tm);\n      lastLogTime = t;\n    }\n\n    accessLog << peerIp\n              << \" - \" << user << \" [\" << timebuf << \"] \\\"\"\n              << request.getMethod_cstr() << ' '\n              << query << ' '\n              << \"HTTP/\" << request.getMajorVersion() << '.' << request.getMinorVersion() << \"\\\" \"\n              << httpReturn << ' ';\n    std::string::size_type contentSize = reply.getContentSize();\n    if (contentSize != 0)\n      accessLog << contentSize;\n    else\n      accessLog << '-';\n    accessLog << \" \\\"\" << request.getHeader(httpheader::referer, \"-\") << \"\\\" \\\"\"\n              << request.getHeader(httpheader::userAgent, \"-\") << \"\\\"\\n\";\n    if (cxxtools::atomicDecrement(waitCount) == 0)\n      accessLog.flush();\n  }"
  },
  {
    "function_name": "Worker::processRequest",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/worker.cpp",
    "lines": "221-297",
    "snippet": "bool Worker::processRequest(HttpRequest& request, std::iostream& socket,\n         unsigned keepAliveCount)\n  {\n    // log message\n    log_info(\"request \" << request.getMethod_cstr() << ' ' << request.getQuery()\n      << \" from client \" << request.getPeerIp() << \" user-Agent \\\"\" << request.getUserAgent()\n      << \"\\\" user \\\"\" << request.getUsername() << '\"');\n\n    // create reply-object\n    HttpReply reply(socket);\n    reply.setVersion(request.getMajorVersion(), request.getMinorVersion());\n    if (request.isMethodHEAD())\n      reply.setHeadRequest();\n\n#ifdef ENABLE_LOCALE\n    reply.setLocale(request.getLocale());\n#endif\n\n    if (request.keepAlive())\n      reply.setKeepAliveCounter(keepAliveCount);\n\n    if (TntConfig::it().enableCompression)\n      reply.setAcceptEncoding(request.getEncoding());\n\n    // process request\n    try\n    {\n      try\n      {\n        dispatch(request, reply);\n\n        if (!request.keepAlive() || !reply.keepAlive())\n          keepAliveCount = 0;\n\n        if (keepAliveCount > 0)\n          log_debug(\"keep alive\");\n        else\n        {\n          log_debug(\"no keep alive request/reply=\"\n              << request.keepAlive() << '/' << reply.keepAlive());\n        }\n      }\n      catch (const HttpError& e)\n      {\n        throw;\n      }\n      catch (const std::exception& e)\n      {\n        throw HttpError(HTTP_INTERNAL_SERVER_ERROR, e.what());\n      }\n      catch (...)\n      {\n        log_error(\"unknown exception\");\n        throw HttpError(HTTP_INTERNAL_SERVER_ERROR, \"unknown error\");\n      }\n    }\n    catch (const HttpError& e)\n    {\n      state = stateSendError;\n      log_warn(\"http-Error: \" << e.what());\n      HttpReply errorReply(socket);\n      errorReply.setVersion(request.getMajorVersion(), request.getMinorVersion());\n      if (request.keepAlive())\n        errorReply.setKeepAliveCounter(keepAliveCount);\n      else\n        keepAliveCount = 0;\n      for (HttpMessage::header_type::const_iterator it = e.header_begin();\n           it != e.header_end(); ++it)\n        errorReply.setHeader(it->first, it->second);\n\n      errorReply.out() << e.getBody() << '\\n';\n      errorReply.sendReply(e.getErrcode(), e.getErrmsg());\n      logRequest(request, errorReply, e.getErrcode());\n    }\n\n    return keepAliveCount > 0;\n  }",
    "includes": [
      "#include \"config.h\"",
      "#include <string.h>",
      "#include <pthread.h>",
      "#include <cxxtools/net/tcpserver.h>",
      "#include <cxxtools/atomicity.h>",
      "#include <cxxtools/ioerror.h>",
      "#include <cxxtools/dlloader.h>",
      "#include <sys/poll.h>",
      "#include <arpa/inet.h>",
      "#include <sys/socket.h>",
      "#include <sys/types.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <cxxtools/log.h>",
      "#include <tnt/tntconfig.h>",
      "#include <tnt/poller.h>",
      "#include <tnt/http.h>",
      "#include <tnt/httperror.h>",
      "#include <tnt/httpreply.h>",
      "#include <tnt/httprequest.h>",
      "#include \"tnt/job.h\"",
      "#include \"tnt/dispatcher.h\"",
      "#include \"tnt/worker.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "logRequest",
          "args": [
            "request",
            "errorReply",
            "e.getErrcode()"
          ],
          "line": 293
        },
        "resolved": true,
        "details": {
          "function_name": "Worker::logRequest",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/worker.cpp",
          "lines": "299-374",
          "snippet": "void Worker::logRequest(const HttpRequest& request, const HttpReply& reply, unsigned httpReturn)\n  {\n    static cxxtools::atomic_t waitCount = 0;\n    cxxtools::atomicIncrement(waitCount);\n\n    const std::string& fname = TntConfig::it().accessLog;\n    if (fname.empty())\n      return;\n\n    std::ofstream& accessLog = application.accessLog;\n\n    if (!accessLog.is_open())\n    {\n      cxxtools::MutexLock lock(application.accessLogMutex);\n\n      if (!accessLog.is_open())\n      {\n        log_debug(\"access log is not open - open now\");\n        accessLog.open(fname.c_str(), std::ios::out | std::ios::app);\n        if (accessLog.fail())\n        {\n          std::cerr << \"failed to open access log \\\"\" << fname << '\"' << std::endl;\n          TntConfig::it().accessLog.clear();\n        }\n      }\n    }\n\n    log_debug(\"log request to access log with return code \" << httpReturn);\n\n    static const std::string unknown(\"-\");\n\n    std::string user = request.getUsername();\n    if (user.empty())\n      user = unknown;\n\n    std::string peerIp = request.getPeerIp();\n    if (peerIp.empty())\n      peerIp = unknown;\n\n    std::string query = request.getQuery();\n    if (query.empty())\n      query = unknown;\n\n    time_t t;\n    ::time(&t);\n\n    cxxtools::MutexLock lock(application.accessLogMutex);\n\n    // cache for timestamp of access log\n    static time_t lastLogTime = 0;\n    static char timebuf[40];\n\n    if (t != lastLogTime)\n    {\n      struct tm tm;\n      ::localtime_r(&t, &tm);\n      strftime(timebuf, sizeof(timebuf), \"%d/%b/%Y:%H:%M:%S %z\", &tm);\n      lastLogTime = t;\n    }\n\n    accessLog << peerIp\n              << \" - \" << user << \" [\" << timebuf << \"] \\\"\"\n              << request.getMethod_cstr() << ' '\n              << query << ' '\n              << \"HTTP/\" << request.getMajorVersion() << '.' << request.getMinorVersion() << \"\\\" \"\n              << httpReturn << ' ';\n    std::string::size_type contentSize = reply.getContentSize();\n    if (contentSize != 0)\n      accessLog << contentSize;\n    else\n      accessLog << '-';\n    accessLog << \" \\\"\" << request.getHeader(httpheader::referer, \"-\") << \"\\\" \\\"\"\n              << request.getHeader(httpheader::userAgent, \"-\") << \"\\\"\\n\";\n    if (cxxtools::atomicDecrement(waitCount) == 0)\n      accessLog.flush();\n  }",
          "includes": [
            "#include \"config.h\"",
            "#include <string.h>",
            "#include <pthread.h>",
            "#include <cxxtools/net/tcpserver.h>",
            "#include <cxxtools/atomicity.h>",
            "#include <cxxtools/ioerror.h>",
            "#include <cxxtools/dlloader.h>",
            "#include <sys/poll.h>",
            "#include <arpa/inet.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <cxxtools/log.h>",
            "#include <tnt/tntconfig.h>",
            "#include <tnt/poller.h>",
            "#include <tnt/http.h>",
            "#include <tnt/httperror.h>",
            "#include <tnt/httpreply.h>",
            "#include <tnt/httprequest.h>",
            "#include \"tnt/job.h\"",
            "#include \"tnt/dispatcher.h\"",
            "#include \"tnt/worker.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"config.h\"\n#include <string.h>\n#include <pthread.h>\n#include <cxxtools/net/tcpserver.h>\n#include <cxxtools/atomicity.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/dlloader.h>\n#include <sys/poll.h>\n#include <arpa/inet.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <cxxtools/log.h>\n#include <tnt/tntconfig.h>\n#include <tnt/poller.h>\n#include <tnt/http.h>\n#include <tnt/httperror.h>\n#include <tnt/httpreply.h>\n#include <tnt/httprequest.h>\n#include \"tnt/job.h\"\n#include \"tnt/dispatcher.h\"\n#include \"tnt/worker.h\"\n\nvoid Worker::logRequest(const HttpRequest& request, const HttpReply& reply, unsigned httpReturn)\n  {\n    static cxxtools::atomic_t waitCount = 0;\n    cxxtools::atomicIncrement(waitCount);\n\n    const std::string& fname = TntConfig::it().accessLog;\n    if (fname.empty())\n      return;\n\n    std::ofstream& accessLog = application.accessLog;\n\n    if (!accessLog.is_open())\n    {\n      cxxtools::MutexLock lock(application.accessLogMutex);\n\n      if (!accessLog.is_open())\n      {\n        log_debug(\"access log is not open - open now\");\n        accessLog.open(fname.c_str(), std::ios::out | std::ios::app);\n        if (accessLog.fail())\n        {\n          std::cerr << \"failed to open access log \\\"\" << fname << '\"' << std::endl;\n          TntConfig::it().accessLog.clear();\n        }\n      }\n    }\n\n    log_debug(\"log request to access log with return code \" << httpReturn);\n\n    static const std::string unknown(\"-\");\n\n    std::string user = request.getUsername();\n    if (user.empty())\n      user = unknown;\n\n    std::string peerIp = request.getPeerIp();\n    if (peerIp.empty())\n      peerIp = unknown;\n\n    std::string query = request.getQuery();\n    if (query.empty())\n      query = unknown;\n\n    time_t t;\n    ::time(&t);\n\n    cxxtools::MutexLock lock(application.accessLogMutex);\n\n    // cache for timestamp of access log\n    static time_t lastLogTime = 0;\n    static char timebuf[40];\n\n    if (t != lastLogTime)\n    {\n      struct tm tm;\n      ::localtime_r(&t, &tm);\n      strftime(timebuf, sizeof(timebuf), \"%d/%b/%Y:%H:%M:%S %z\", &tm);\n      lastLogTime = t;\n    }\n\n    accessLog << peerIp\n              << \" - \" << user << \" [\" << timebuf << \"] \\\"\"\n              << request.getMethod_cstr() << ' '\n              << query << ' '\n              << \"HTTP/\" << request.getMajorVersion() << '.' << request.getMinorVersion() << \"\\\" \"\n              << httpReturn << ' ';\n    std::string::size_type contentSize = reply.getContentSize();\n    if (contentSize != 0)\n      accessLog << contentSize;\n    else\n      accessLog << '-';\n    accessLog << \" \\\"\" << request.getHeader(httpheader::referer, \"-\") << \"\\\" \\\"\"\n              << request.getHeader(httpheader::userAgent, \"-\") << \"\\\"\\n\";\n    if (cxxtools::atomicDecrement(waitCount) == 0)\n      accessLog.flush();\n  }"
        }
      },
      {
        "call_info": {
          "callee": "e.getErrcode",
          "args": [],
          "line": 293
        },
        "resolved": true,
        "details": {
          "function_name": "getErrcode",
          "container": "HttpError",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/httperror.h",
          "lines": "75-80",
          "snippet": "unsigned getErrcode() const\n      {\n        return (msg[0] - '0') * 100\n             + (msg[1] - '0') * 10\n             + (msg[2] - '0');\n      }",
          "includes": [
            "#include <tnt/httpmessage.h>",
            "#include <string>",
            "#include <stdexcept>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <tnt/httpmessage.h>\n#include <string>\n#include <stdexcept>\n\nHttpError {\n  unsigned getErrcode() const\n        {\n          return (msg[0] - '0') * 100\n               + (msg[1] - '0') * 10\n               + (msg[2] - '0');\n        }\n}"
        }
      },
      {
        "call_info": {
          "callee": "errorReply.sendReply",
          "args": [
            "e.getErrcode()",
            "e.getErrmsg()"
          ],
          "line": 292
        },
        "resolved": true,
        "details": {
          "function_name": "sendReply",
          "container": "HttpReply",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/httpreply.h",
          "lines": "84-85",
          "snippet": "void sendReply(unsigned ret, const std::string& msg)\n        { sendReply(ret, msg.c_str()); }",
          "includes": [
            "#include <iosfwd>",
            "#include <tnt/http.h>",
            "#include <tnt/httpmessage.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <iosfwd>\n#include <tnt/http.h>\n#include <tnt/httpmessage.h>\n\nHttpReply {\n  void sendReply(unsigned ret, const std::string& msg)\n          { sendReply(ret, msg.c_str()); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "e.getErrmsg",
          "args": [],
          "line": 292
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e.getBody",
          "args": [],
          "line": 291
        },
        "resolved": true,
        "details": {
          "function_name": "getBody",
          "container": "Part",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/multipart.h",
          "lines": "102-103",
          "snippet": "std::string getBody() const\n        { return std::string(getBodyBegin(), getBodyEnd()); }",
          "includes": [
            "#include <iterator>",
            "#include <vector>",
            "#include <tnt/contentdisposition.h>",
            "#include <tnt/messageheader.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <iterator>\n#include <vector>\n#include <tnt/contentdisposition.h>\n#include <tnt/messageheader.h>\n\nPart {\n  std::string getBody() const\n          { return std::string(getBodyBegin(), getBodyEnd()); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "errorReply.out",
          "args": [],
          "line": 291
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "errorReply.setHeader",
          "args": [
            "it->first",
            "it->second"
          ],
          "line": 289
        },
        "resolved": true,
        "details": {
          "function_name": "setHeader",
          "container": "HttpMessage",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/httpmessage.h",
          "lines": "91-92",
          "snippet": "void setHeader(const std::string& key, const std::string& value, bool replace = true)\n        { header.setHeader(key, value, replace); }",
          "includes": [
            "#include <time.h>",
            "#include <tnt/cookie.h>",
            "#include <tnt/httpheader.h>",
            "#include <tnt/messageheader.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <time.h>\n#include <tnt/cookie.h>\n#include <tnt/httpheader.h>\n#include <tnt/messageheader.h>\n\nHttpMessage {\n  void setHeader(const std::string& key, const std::string& value, bool replace = true)\n          { header.setHeader(key, value, replace); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "e.header_end",
          "args": [],
          "line": 288
        },
        "resolved": true,
        "details": {
          "function_name": "header_end",
          "container": "HttpMessage",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/httpmessage.h",
          "lines": "87-88",
          "snippet": "header_type::const_iterator header_end() const\n        { return header.end(); }",
          "includes": [
            "#include <time.h>",
            "#include <tnt/cookie.h>",
            "#include <tnt/httpheader.h>",
            "#include <tnt/messageheader.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <time.h>\n#include <tnt/cookie.h>\n#include <tnt/httpheader.h>\n#include <tnt/messageheader.h>\n\nHttpMessage {\n  header_type::const_iterator header_end() const\n          { return header.end(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "e.header_begin",
          "args": [],
          "line": 287
        },
        "resolved": true,
        "details": {
          "function_name": "header_begin",
          "container": "HttpMessage",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/httpmessage.h",
          "lines": "84-85",
          "snippet": "header_type::const_iterator header_begin() const\n        { return header.begin(); }",
          "includes": [
            "#include <time.h>",
            "#include <tnt/cookie.h>",
            "#include <tnt/httpheader.h>",
            "#include <tnt/messageheader.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <time.h>\n#include <tnt/cookie.h>\n#include <tnt/httpheader.h>\n#include <tnt/messageheader.h>\n\nHttpMessage {\n  header_type::const_iterator header_begin() const\n          { return header.begin(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "errorReply.setKeepAliveCounter",
          "args": [
            "keepAliveCount"
          ],
          "line": 284
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "request.keepAlive",
          "args": [],
          "line": 283
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "errorReply.setVersion",
          "args": [
            "request.getMajorVersion()",
            "request.getMinorVersion()"
          ],
          "line": 282
        },
        "resolved": true,
        "details": {
          "function_name": "setVersion",
          "container": "HttpMessage",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/httpmessage.h",
          "lines": "79-80",
          "snippet": "void setVersion(unsigned short major, unsigned short minor)\n        { majorVersion = major; minorVersion = minor; }",
          "includes": [
            "#include <time.h>",
            "#include <tnt/cookie.h>",
            "#include <tnt/httpheader.h>",
            "#include <tnt/messageheader.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <time.h>\n#include <tnt/cookie.h>\n#include <tnt/httpheader.h>\n#include <tnt/messageheader.h>\n\nHttpMessage {\n  void setVersion(unsigned short major, unsigned short minor)\n          { majorVersion = major; minorVersion = minor; }\n}"
        }
      },
      {
        "call_info": {
          "callee": "request.getMinorVersion",
          "args": [],
          "line": 282
        },
        "resolved": true,
        "details": {
          "function_name": "getMinorVersion",
          "container": "HttpMessage",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/httpmessage.h",
          "lines": "76-77",
          "snippet": "unsigned short getMinorVersion() const\n        { return minorVersion; }",
          "includes": [
            "#include <time.h>",
            "#include <tnt/cookie.h>",
            "#include <tnt/httpheader.h>",
            "#include <tnt/messageheader.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <time.h>\n#include <tnt/cookie.h>\n#include <tnt/httpheader.h>\n#include <tnt/messageheader.h>\n\nHttpMessage {\n  unsigned short getMinorVersion() const\n          { return minorVersion; }\n}"
        }
      },
      {
        "call_info": {
          "callee": "request.getMajorVersion",
          "args": [],
          "line": 282
        },
        "resolved": true,
        "details": {
          "function_name": "getMajorVersion",
          "container": "HttpMessage",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/httpmessage.h",
          "lines": "73-74",
          "snippet": "unsigned short getMajorVersion() const\n        { return majorVersion; }",
          "includes": [
            "#include <time.h>",
            "#include <tnt/cookie.h>",
            "#include <tnt/httpheader.h>",
            "#include <tnt/messageheader.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <time.h>\n#include <tnt/cookie.h>\n#include <tnt/httpheader.h>\n#include <tnt/messageheader.h>\n\nHttpMessage {\n  unsigned short getMajorVersion() const\n          { return majorVersion; }\n}"
        }
      },
      {
        "call_info": {
          "callee": "log_warn",
          "args": [
            "\"http-Error: \" << e.what()"
          ],
          "line": 280
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e.what",
          "args": [],
          "line": 280
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HttpError",
          "args": [
            "HTTP_INTERNAL_SERVER_ERROR",
            "\"unknown error\""
          ],
          "line": 274
        },
        "resolved": true,
        "details": {
          "function_name": "HttpError::HttpError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/httperror.cpp",
          "lines": "146-158",
          "snippet": "HttpError::HttpError(unsigned errcode)\n    : msg(HttpReturn::httpMessage(errcode))\n  {\n    std::ostringstream b;\n    HtmlEscOstream sb(b);\n\n    b << \"<html><body><h1>Error</h1><p>\";\n    sb << msg;\n    b << \"</p></body></html>\";\n    body = b.str();\n\n    msg = httpErrorFormat(errcode, msg);\n  }",
          "includes": [
            "#include <algorithm>",
            "#include <sstream>",
            "#include <iostream>",
            "#include <tnt/htmlescostream.h>",
            "#include <tnt/http.h>",
            "#include <tnt/httperror.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <algorithm>\n#include <sstream>\n#include <iostream>\n#include <tnt/htmlescostream.h>\n#include <tnt/http.h>\n#include <tnt/httperror.h>\n\nHttpError::HttpError(unsigned errcode)\n    : msg(HttpReturn::httpMessage(errcode))\n  {\n    std::ostringstream b;\n    HtmlEscOstream sb(b);\n\n    b << \"<html><body><h1>Error</h1><p>\";\n    sb << msg;\n    b << \"</p></body></html>\";\n    body = b.str();\n\n    msg = httpErrorFormat(errcode, msg);\n  }"
        }
      },
      {
        "call_info": {
          "callee": "log_error",
          "args": [
            "\"unknown exception\""
          ],
          "line": 273
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e.what",
          "args": [],
          "line": 269
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"no keep alive request/reply=\"\n              << request.keepAlive() << '/' << reply.keepAlive()"
          ],
          "line": 259
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "reply.keepAlive",
          "args": [],
          "line": 260
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "request.keepAlive",
          "args": [],
          "line": 260
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"keep alive\""
          ],
          "line": 256
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "reply.keepAlive",
          "args": [],
          "line": 252
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "request.keepAlive",
          "args": [],
          "line": 252
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dispatch",
          "args": [
            "request",
            "reply"
          ],
          "line": 250
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "reply.setAcceptEncoding",
          "args": [
            "request.getEncoding()"
          ],
          "line": 243
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "request.getEncoding",
          "args": [],
          "line": 243
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TntConfig::it",
          "args": [],
          "line": 242
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "reply.setKeepAliveCounter",
          "args": [
            "keepAliveCount"
          ],
          "line": 240
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "request.keepAlive",
          "args": [],
          "line": 239
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "reply.setLocale",
          "args": [
            "request.getLocale()"
          ],
          "line": 236
        },
        "resolved": true,
        "details": {
          "function_name": "setLocale",
          "container": "HttpReply",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/httpreply.h",
          "lines": "128-128",
          "snippet": "void setLocale(const std::locale& loc)    { out().imbue(loc); sout().imbue(loc); }",
          "includes": [
            "#include <iosfwd>",
            "#include <tnt/http.h>",
            "#include <tnt/httpmessage.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <iosfwd>\n#include <tnt/http.h>\n#include <tnt/httpmessage.h>\n\nHttpReply {\n  void setLocale(const std::locale& loc)    { out().imbue(loc); sout().imbue(loc); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "request.getLocale",
          "args": [],
          "line": 236
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "reply.setHeadRequest",
          "args": [],
          "line": 233
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "request.isMethodHEAD",
          "args": [],
          "line": 232
        },
        "resolved": true,
        "details": {
          "function_name": "isMethodHEAD",
          "container": "HttpRequest",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/httprequest.h",
          "lines": "138-138",
          "snippet": "bool isMethodHEAD() const                 { return std::strcmp(method, \"HEAD\") == 0; }",
          "includes": [
            "#include <cstring>",
            "#include <string>",
            "#include <cxxtools/atomicity.h>",
            "#include <map>",
            "#include <locale>",
            "#include <tnt/threadcontext.h>",
            "#include <tnt/scope.h>",
            "#include <tnt/query_params.h>",
            "#include <tnt/encoding.h>",
            "#include <tnt/cookie.h>",
            "#include <tnt/multipart.h>",
            "#include <tnt/contenttype.h>",
            "#include <tnt/socketif.h>",
            "#include <tnt/httpheader.h>",
            "#include <tnt/httpmessage.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <cstring>\n#include <string>\n#include <cxxtools/atomicity.h>\n#include <map>\n#include <locale>\n#include <tnt/threadcontext.h>\n#include <tnt/scope.h>\n#include <tnt/query_params.h>\n#include <tnt/encoding.h>\n#include <tnt/cookie.h>\n#include <tnt/multipart.h>\n#include <tnt/contenttype.h>\n#include <tnt/socketif.h>\n#include <tnt/httpheader.h>\n#include <tnt/httpmessage.h>\n\nHttpRequest {\n  bool isMethodHEAD() const                 { return std::strcmp(method, \"HEAD\") == 0; }\n}"
        }
      },
      {
        "call_info": {
          "callee": "log_info",
          "args": [
            "\"request \" << request.getMethod_cstr() << ' ' << request.getQuery()\n      << \" from client \" << request.getPeerIp() << \" user-Agent \\\"\" << request.getUserAgent()\n      << \"\\\" user \\\"\" << request.getUsername() << '\"'"
          ],
          "line": 225
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "request.getUsername",
          "args": [],
          "line": 227
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "request.getUserAgent",
          "args": [],
          "line": 226
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "request.getPeerIp",
          "args": [],
          "line": 226
        },
        "resolved": true,
        "details": {
          "function_name": "getPeerIp",
          "container": "Cmd::NullSocketIf",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/cmd.h",
          "lines": "56-57",
          "snippet": "std::string getPeerIp() const\n          { return std::string(); }",
          "includes": [
            "#include <tnt/component.h>",
            "#include <tnt/compident.h>",
            "#include <tnt/comploader.h>",
            "#include <tnt/scopemanager.h>",
            "#include <tnt/scope.h>",
            "#include <tnt/httpreply.h>",
            "#include <tnt/httprequest.h>",
            "#include <tnt/tntnet.h>",
            "#include <iosfwd>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <tnt/component.h>\n#include <tnt/compident.h>\n#include <tnt/comploader.h>\n#include <tnt/scopemanager.h>\n#include <tnt/scope.h>\n#include <tnt/httpreply.h>\n#include <tnt/httprequest.h>\n#include <tnt/tntnet.h>\n#include <iosfwd>\n\nCmd {\n  NullSocketIf {\n    std::string getPeerIp() const\n              { return std::string(); }\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "request.getQuery",
          "args": [],
          "line": 225
        },
        "resolved": true,
        "details": {
          "function_name": "getQuery",
          "container": "HttpRequest",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/httprequest.h",
          "lines": "143-144",
          "snippet": "std::string getQuery() const\n        { return queryString.empty() ? url : url + '?' + queryString; }",
          "includes": [
            "#include <cstring>",
            "#include <string>",
            "#include <cxxtools/atomicity.h>",
            "#include <map>",
            "#include <locale>",
            "#include <tnt/threadcontext.h>",
            "#include <tnt/scope.h>",
            "#include <tnt/query_params.h>",
            "#include <tnt/encoding.h>",
            "#include <tnt/cookie.h>",
            "#include <tnt/multipart.h>",
            "#include <tnt/contenttype.h>",
            "#include <tnt/socketif.h>",
            "#include <tnt/httpheader.h>",
            "#include <tnt/httpmessage.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <cstring>\n#include <string>\n#include <cxxtools/atomicity.h>\n#include <map>\n#include <locale>\n#include <tnt/threadcontext.h>\n#include <tnt/scope.h>\n#include <tnt/query_params.h>\n#include <tnt/encoding.h>\n#include <tnt/cookie.h>\n#include <tnt/multipart.h>\n#include <tnt/contenttype.h>\n#include <tnt/socketif.h>\n#include <tnt/httpheader.h>\n#include <tnt/httpmessage.h>\n\nHttpRequest {\n  std::string getQuery() const\n          { return queryString.empty() ? url : url + '?' + queryString; }\n}"
        }
      },
      {
        "call_info": {
          "callee": "request.getMethod_cstr",
          "args": [],
          "line": 225
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"config.h\"\n#include <string.h>\n#include <pthread.h>\n#include <cxxtools/net/tcpserver.h>\n#include <cxxtools/atomicity.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/dlloader.h>\n#include <sys/poll.h>\n#include <arpa/inet.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <cxxtools/log.h>\n#include <tnt/tntconfig.h>\n#include <tnt/poller.h>\n#include <tnt/http.h>\n#include <tnt/httperror.h>\n#include <tnt/httpreply.h>\n#include <tnt/httprequest.h>\n#include \"tnt/job.h\"\n#include \"tnt/dispatcher.h\"\n#include \"tnt/worker.h\"\n\nbool Worker::processRequest(HttpRequest& request, std::iostream& socket,\n         unsigned keepAliveCount)\n  {\n    // log message\n    log_info(\"request \" << request.getMethod_cstr() << ' ' << request.getQuery()\n      << \" from client \" << request.getPeerIp() << \" user-Agent \\\"\" << request.getUserAgent()\n      << \"\\\" user \\\"\" << request.getUsername() << '\"');\n\n    // create reply-object\n    HttpReply reply(socket);\n    reply.setVersion(request.getMajorVersion(), request.getMinorVersion());\n    if (request.isMethodHEAD())\n      reply.setHeadRequest();\n\n#ifdef ENABLE_LOCALE\n    reply.setLocale(request.getLocale());\n#endif\n\n    if (request.keepAlive())\n      reply.setKeepAliveCounter(keepAliveCount);\n\n    if (TntConfig::it().enableCompression)\n      reply.setAcceptEncoding(request.getEncoding());\n\n    // process request\n    try\n    {\n      try\n      {\n        dispatch(request, reply);\n\n        if (!request.keepAlive() || !reply.keepAlive())\n          keepAliveCount = 0;\n\n        if (keepAliveCount > 0)\n          log_debug(\"keep alive\");\n        else\n        {\n          log_debug(\"no keep alive request/reply=\"\n              << request.keepAlive() << '/' << reply.keepAlive());\n        }\n      }\n      catch (const HttpError& e)\n      {\n        throw;\n      }\n      catch (const std::exception& e)\n      {\n        throw HttpError(HTTP_INTERNAL_SERVER_ERROR, e.what());\n      }\n      catch (...)\n      {\n        log_error(\"unknown exception\");\n        throw HttpError(HTTP_INTERNAL_SERVER_ERROR, \"unknown error\");\n      }\n    }\n    catch (const HttpError& e)\n    {\n      state = stateSendError;\n      log_warn(\"http-Error: \" << e.what());\n      HttpReply errorReply(socket);\n      errorReply.setVersion(request.getMajorVersion(), request.getMinorVersion());\n      if (request.keepAlive())\n        errorReply.setKeepAliveCounter(keepAliveCount);\n      else\n        keepAliveCount = 0;\n      for (HttpMessage::header_type::const_iterator it = e.header_begin();\n           it != e.header_end(); ++it)\n        errorReply.setHeader(it->first, it->second);\n\n      errorReply.out() << e.getBody() << '\\n';\n      errorReply.sendReply(e.getErrcode(), e.getErrmsg());\n      logRequest(request, errorReply, e.getErrcode());\n    }\n\n    return keepAliveCount > 0;\n  }"
  },
  {
    "function_name": "Worker::run",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/worker.cpp",
    "lines": "86-219",
    "snippet": "void Worker::run()\n  {\n    threadId = pthread_self();\n    Jobqueue& queue = application.getQueue();\n    log_debug(\"start thread \" << threadId);\n    while (queue.getWaitThreadCount() < application.getMinThreads())\n    {\n      state = stateWaitingForJob;\n      Jobqueue::JobPtr j = queue.get();\n      if (Tntnet::shouldStop())\n      {\n        // put job back to queue to wake up next worker if any left\n        queue.put(j);\n        break;\n      }\n\n      try\n      {\n        std::iostream& socket = j->getStream();\n        if (Tntnet::shouldStop())\n          break;\n\n        bool keepAlive;\n        do\n        {\n          time(&lastWaitTime);\n\n          keepAlive = false;\n          state = stateParsing;\n          try\n          {\n            j->getParser().parse(socket);\n            state = statePostParsing;\n\n            if (socket.eof())\n              log_debug(\"eof\");\n            else if (j->getParser().failed())\n            {\n              state = stateSendError;\n              log_warn(\"bad request\");\n              tnt::HttpReply errorReply(socket);\n              errorReply.setVersion(1, 0);\n              errorReply.setContentType(\"text/html\");\n              errorReply.setKeepAliveCounter(0);\n              errorReply.out() << \"<html><body><h1>Error</h1><p>bad request</p></body></html>\\n\";\n              errorReply.sendReply(400, \"Bad Request\");\n              logRequest(j->getRequest(), errorReply, 400);\n            }\n            else if (socket.fail())\n              log_debug(\"socket failed\");\n            else\n            {\n              j->getRequest().doPostParse();\n\n              j->setWrite();\n              keepAlive = processRequest(j->getRequest(), socket,\n                j->decrementKeepAliveCounter());\n\n              if (keepAlive)\n              {\n                j->setRead();\n                j->clear();\n\n                if (!socket.rdbuf()->in_avail())\n                {\n                  if (queue.getWaitThreadCount() == 0\n                    && !queue.empty())\n                  {\n                    // if there is something to do and no threads waiting, we take\n                    // the next job just to improve responsiveness.\n                    log_debug(\"put job back into queue\");\n                    queue.put(j, true);\n                    keepAlive = false;\n                  }\n                  else\n                  {\n                    struct pollfd fd;\n                    fd.fd = j->getFd();\n                    fd.events = POLLIN;\n                    if (::poll(&fd, 1, TntConfig::it().socketReadTimeout) == 0)\n                    {\n                      log_debug(\"pass job to poll-thread\");\n                      application.getPoller().addIdleJob(j);\n                      keepAlive = false;\n                    }\n                  }\n                }\n              }\n            }\n          }\n          catch (const HttpError& e)\n          {\n            keepAlive = false;\n            state = stateSendError;\n            log_warn(\"http-Error: \" << e.what());\n            HttpReply errorReply(socket);\n            errorReply.setVersion(1, 0);\n            errorReply.setKeepAliveCounter(0);\n            for (HttpMessage::header_type::const_iterator it = e.header_begin();\n                 it != e.header_end(); ++it)\n              errorReply.setHeader(it->first, it->second);\n\n            errorReply.out() << e.getBody() << '\\n';\n            errorReply.sendReply(e.getErrcode(), e.getErrmsg());\n            logRequest(j->getRequest(), errorReply, e.getErrcode());\n          }\n        } while (keepAlive);\n      }\n      catch (const cxxtools::IOTimeout& e)\n      {\n        application.getPoller().addIdleJob(j);\n      }\n      catch (const cxxtools::net::AcceptTerminated&)\n      {\n        log_debug(\"listener terminated\");\n        break;\n      }\n      catch (const std::exception& e)\n      {\n        log_warn(\"unexpected exception: \" << e.what());\n      }\n    }\n\n    time(&lastWaitTime);\n\n    state = stateStopping;\n\n    cxxtools::MutexLock lock(mutex);\n    workers.erase(this);\n\n    log_debug(\"end worker thread \" << threadId << \" - \" << workers.size()\n      << \" threads left - \" << application.getQueue().getWaitThreadCount()\n      << \" waiting threads\");\n  }",
    "includes": [
      "#include \"config.h\"",
      "#include <string.h>",
      "#include <pthread.h>",
      "#include <cxxtools/net/tcpserver.h>",
      "#include <cxxtools/atomicity.h>",
      "#include <cxxtools/ioerror.h>",
      "#include <cxxtools/dlloader.h>",
      "#include <sys/poll.h>",
      "#include <arpa/inet.h>",
      "#include <sys/socket.h>",
      "#include <sys/types.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <cxxtools/log.h>",
      "#include <tnt/tntconfig.h>",
      "#include <tnt/poller.h>",
      "#include <tnt/http.h>",
      "#include <tnt/httperror.h>",
      "#include <tnt/httpreply.h>",
      "#include <tnt/httprequest.h>",
      "#include \"tnt/job.h\"",
      "#include \"tnt/dispatcher.h\"",
      "#include \"tnt/worker.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"end worker thread \" << threadId << \" - \" << workers.size()\n      << \" threads left - \" << application.getQueue().getWaitThreadCount()\n      << \" waiting threads\""
          ],
          "line": 216
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "application.getQueue",
          "args": [],
          "line": 217
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "application.getQueue",
          "args": [],
          "line": 217
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "workers.size",
          "args": [],
          "line": 216
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "Pstr",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/httpmessage.cpp",
          "lines": "155-155",
          "snippet": "size_type size() const  { return end - start; }",
          "includes": [
            "#include <stdio.h>",
            "#include <sstream>",
            "#include <list>",
            "#include <cxxtools/mutex.h>",
            "#include <cxxtools/log.h>",
            "#include <tnt/httpmessage.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <stdio.h>\n#include <sstream>\n#include <list>\n#include <cxxtools/mutex.h>\n#include <cxxtools/log.h>\n#include <tnt/httpmessage.h>\n\nPstr {\n  size_type size() const  { return end - start; }\n}"
        }
      },
      {
        "call_info": {
          "callee": "workers.erase",
          "args": [
            "this"
          ],
          "line": 214
        },
        "resolved": true,
        "details": {
          "function_name": "erase",
          "container": "Scope",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/scope.h",
          "lines": "111-111",
          "snippet": "void erase(const std::string& key)  { data.erase(key); }",
          "includes": [
            "#include <cxxtools/refcounted.h>",
            "#include <cxxtools/mutex.h>",
            "#include <tnt/object.h>",
            "#include <string>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <cxxtools/refcounted.h>\n#include <cxxtools/mutex.h>\n#include <tnt/object.h>\n#include <string>\n#include <map>\n\nScope {\n  void erase(const std::string& key)  { data.erase(key); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "time",
          "args": [
            "&lastWaitTime"
          ],
          "line": 209
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_warn",
          "args": [
            "\"unexpected exception: \" << e.what()"
          ],
          "line": 205
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e.what",
          "args": [],
          "line": 205
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"listener terminated\""
          ],
          "line": 200
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "application.getPoller",
          "args": [
            "j"
          ],
          "line": 196
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "application.getPoller",
          "args": [],
          "line": 196
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "logRequest",
          "args": [
            "j->getRequest()",
            "errorReply",
            "e.getErrcode()"
          ],
          "line": 190
        },
        "resolved": true,
        "details": {
          "function_name": "Worker::logRequest",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/worker.cpp",
          "lines": "299-374",
          "snippet": "void Worker::logRequest(const HttpRequest& request, const HttpReply& reply, unsigned httpReturn)\n  {\n    static cxxtools::atomic_t waitCount = 0;\n    cxxtools::atomicIncrement(waitCount);\n\n    const std::string& fname = TntConfig::it().accessLog;\n    if (fname.empty())\n      return;\n\n    std::ofstream& accessLog = application.accessLog;\n\n    if (!accessLog.is_open())\n    {\n      cxxtools::MutexLock lock(application.accessLogMutex);\n\n      if (!accessLog.is_open())\n      {\n        log_debug(\"access log is not open - open now\");\n        accessLog.open(fname.c_str(), std::ios::out | std::ios::app);\n        if (accessLog.fail())\n        {\n          std::cerr << \"failed to open access log \\\"\" << fname << '\"' << std::endl;\n          TntConfig::it().accessLog.clear();\n        }\n      }\n    }\n\n    log_debug(\"log request to access log with return code \" << httpReturn);\n\n    static const std::string unknown(\"-\");\n\n    std::string user = request.getUsername();\n    if (user.empty())\n      user = unknown;\n\n    std::string peerIp = request.getPeerIp();\n    if (peerIp.empty())\n      peerIp = unknown;\n\n    std::string query = request.getQuery();\n    if (query.empty())\n      query = unknown;\n\n    time_t t;\n    ::time(&t);\n\n    cxxtools::MutexLock lock(application.accessLogMutex);\n\n    // cache for timestamp of access log\n    static time_t lastLogTime = 0;\n    static char timebuf[40];\n\n    if (t != lastLogTime)\n    {\n      struct tm tm;\n      ::localtime_r(&t, &tm);\n      strftime(timebuf, sizeof(timebuf), \"%d/%b/%Y:%H:%M:%S %z\", &tm);\n      lastLogTime = t;\n    }\n\n    accessLog << peerIp\n              << \" - \" << user << \" [\" << timebuf << \"] \\\"\"\n              << request.getMethod_cstr() << ' '\n              << query << ' '\n              << \"HTTP/\" << request.getMajorVersion() << '.' << request.getMinorVersion() << \"\\\" \"\n              << httpReturn << ' ';\n    std::string::size_type contentSize = reply.getContentSize();\n    if (contentSize != 0)\n      accessLog << contentSize;\n    else\n      accessLog << '-';\n    accessLog << \" \\\"\" << request.getHeader(httpheader::referer, \"-\") << \"\\\" \\\"\"\n              << request.getHeader(httpheader::userAgent, \"-\") << \"\\\"\\n\";\n    if (cxxtools::atomicDecrement(waitCount) == 0)\n      accessLog.flush();\n  }",
          "includes": [
            "#include \"config.h\"",
            "#include <string.h>",
            "#include <pthread.h>",
            "#include <cxxtools/net/tcpserver.h>",
            "#include <cxxtools/atomicity.h>",
            "#include <cxxtools/ioerror.h>",
            "#include <cxxtools/dlloader.h>",
            "#include <sys/poll.h>",
            "#include <arpa/inet.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include <cxxtools/log.h>",
            "#include <tnt/tntconfig.h>",
            "#include <tnt/poller.h>",
            "#include <tnt/http.h>",
            "#include <tnt/httperror.h>",
            "#include <tnt/httpreply.h>",
            "#include <tnt/httprequest.h>",
            "#include \"tnt/job.h\"",
            "#include \"tnt/dispatcher.h\"",
            "#include \"tnt/worker.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"config.h\"\n#include <string.h>\n#include <pthread.h>\n#include <cxxtools/net/tcpserver.h>\n#include <cxxtools/atomicity.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/dlloader.h>\n#include <sys/poll.h>\n#include <arpa/inet.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <cxxtools/log.h>\n#include <tnt/tntconfig.h>\n#include <tnt/poller.h>\n#include <tnt/http.h>\n#include <tnt/httperror.h>\n#include <tnt/httpreply.h>\n#include <tnt/httprequest.h>\n#include \"tnt/job.h\"\n#include \"tnt/dispatcher.h\"\n#include \"tnt/worker.h\"\n\nvoid Worker::logRequest(const HttpRequest& request, const HttpReply& reply, unsigned httpReturn)\n  {\n    static cxxtools::atomic_t waitCount = 0;\n    cxxtools::atomicIncrement(waitCount);\n\n    const std::string& fname = TntConfig::it().accessLog;\n    if (fname.empty())\n      return;\n\n    std::ofstream& accessLog = application.accessLog;\n\n    if (!accessLog.is_open())\n    {\n      cxxtools::MutexLock lock(application.accessLogMutex);\n\n      if (!accessLog.is_open())\n      {\n        log_debug(\"access log is not open - open now\");\n        accessLog.open(fname.c_str(), std::ios::out | std::ios::app);\n        if (accessLog.fail())\n        {\n          std::cerr << \"failed to open access log \\\"\" << fname << '\"' << std::endl;\n          TntConfig::it().accessLog.clear();\n        }\n      }\n    }\n\n    log_debug(\"log request to access log with return code \" << httpReturn);\n\n    static const std::string unknown(\"-\");\n\n    std::string user = request.getUsername();\n    if (user.empty())\n      user = unknown;\n\n    std::string peerIp = request.getPeerIp();\n    if (peerIp.empty())\n      peerIp = unknown;\n\n    std::string query = request.getQuery();\n    if (query.empty())\n      query = unknown;\n\n    time_t t;\n    ::time(&t);\n\n    cxxtools::MutexLock lock(application.accessLogMutex);\n\n    // cache for timestamp of access log\n    static time_t lastLogTime = 0;\n    static char timebuf[40];\n\n    if (t != lastLogTime)\n    {\n      struct tm tm;\n      ::localtime_r(&t, &tm);\n      strftime(timebuf, sizeof(timebuf), \"%d/%b/%Y:%H:%M:%S %z\", &tm);\n      lastLogTime = t;\n    }\n\n    accessLog << peerIp\n              << \" - \" << user << \" [\" << timebuf << \"] \\\"\"\n              << request.getMethod_cstr() << ' '\n              << query << ' '\n              << \"HTTP/\" << request.getMajorVersion() << '.' << request.getMinorVersion() << \"\\\" \"\n              << httpReturn << ' ';\n    std::string::size_type contentSize = reply.getContentSize();\n    if (contentSize != 0)\n      accessLog << contentSize;\n    else\n      accessLog << '-';\n    accessLog << \" \\\"\" << request.getHeader(httpheader::referer, \"-\") << \"\\\" \\\"\"\n              << request.getHeader(httpheader::userAgent, \"-\") << \"\\\"\\n\";\n    if (cxxtools::atomicDecrement(waitCount) == 0)\n      accessLog.flush();\n  }"
        }
      },
      {
        "call_info": {
          "callee": "e.getErrcode",
          "args": [],
          "line": 190
        },
        "resolved": true,
        "details": {
          "function_name": "getErrcode",
          "container": "HttpError",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/httperror.h",
          "lines": "75-80",
          "snippet": "unsigned getErrcode() const\n      {\n        return (msg[0] - '0') * 100\n             + (msg[1] - '0') * 10\n             + (msg[2] - '0');\n      }",
          "includes": [
            "#include <tnt/httpmessage.h>",
            "#include <string>",
            "#include <stdexcept>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <tnt/httpmessage.h>\n#include <string>\n#include <stdexcept>\n\nHttpError {\n  unsigned getErrcode() const\n        {\n          return (msg[0] - '0') * 100\n               + (msg[1] - '0') * 10\n               + (msg[2] - '0');\n        }\n}"
        }
      },
      {
        "call_info": {
          "callee": "j->getRequest",
          "args": [],
          "line": 190
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "errorReply.sendReply",
          "args": [
            "e.getErrcode()",
            "e.getErrmsg()"
          ],
          "line": 189
        },
        "resolved": true,
        "details": {
          "function_name": "sendReply",
          "container": "HttpReply",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/httpreply.h",
          "lines": "84-85",
          "snippet": "void sendReply(unsigned ret, const std::string& msg)\n        { sendReply(ret, msg.c_str()); }",
          "includes": [
            "#include <iosfwd>",
            "#include <tnt/http.h>",
            "#include <tnt/httpmessage.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <iosfwd>\n#include <tnt/http.h>\n#include <tnt/httpmessage.h>\n\nHttpReply {\n  void sendReply(unsigned ret, const std::string& msg)\n          { sendReply(ret, msg.c_str()); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "e.getErrmsg",
          "args": [],
          "line": 189
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e.getBody",
          "args": [],
          "line": 188
        },
        "resolved": true,
        "details": {
          "function_name": "getBody",
          "container": "Part",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/multipart.h",
          "lines": "102-103",
          "snippet": "std::string getBody() const\n        { return std::string(getBodyBegin(), getBodyEnd()); }",
          "includes": [
            "#include <iterator>",
            "#include <vector>",
            "#include <tnt/contentdisposition.h>",
            "#include <tnt/messageheader.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <iterator>\n#include <vector>\n#include <tnt/contentdisposition.h>\n#include <tnt/messageheader.h>\n\nPart {\n  std::string getBody() const\n          { return std::string(getBodyBegin(), getBodyEnd()); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "errorReply.out",
          "args": [],
          "line": 188
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "errorReply.setHeader",
          "args": [
            "it->first",
            "it->second"
          ],
          "line": 186
        },
        "resolved": true,
        "details": {
          "function_name": "setHeader",
          "container": "HttpMessage",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/httpmessage.h",
          "lines": "91-92",
          "snippet": "void setHeader(const std::string& key, const std::string& value, bool replace = true)\n        { header.setHeader(key, value, replace); }",
          "includes": [
            "#include <time.h>",
            "#include <tnt/cookie.h>",
            "#include <tnt/httpheader.h>",
            "#include <tnt/messageheader.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <time.h>\n#include <tnt/cookie.h>\n#include <tnt/httpheader.h>\n#include <tnt/messageheader.h>\n\nHttpMessage {\n  void setHeader(const std::string& key, const std::string& value, bool replace = true)\n          { header.setHeader(key, value, replace); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "e.header_end",
          "args": [],
          "line": 185
        },
        "resolved": true,
        "details": {
          "function_name": "header_end",
          "container": "HttpMessage",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/httpmessage.h",
          "lines": "87-88",
          "snippet": "header_type::const_iterator header_end() const\n        { return header.end(); }",
          "includes": [
            "#include <time.h>",
            "#include <tnt/cookie.h>",
            "#include <tnt/httpheader.h>",
            "#include <tnt/messageheader.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <time.h>\n#include <tnt/cookie.h>\n#include <tnt/httpheader.h>\n#include <tnt/messageheader.h>\n\nHttpMessage {\n  header_type::const_iterator header_end() const\n          { return header.end(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "e.header_begin",
          "args": [],
          "line": 184
        },
        "resolved": true,
        "details": {
          "function_name": "header_begin",
          "container": "HttpMessage",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/httpmessage.h",
          "lines": "84-85",
          "snippet": "header_type::const_iterator header_begin() const\n        { return header.begin(); }",
          "includes": [
            "#include <time.h>",
            "#include <tnt/cookie.h>",
            "#include <tnt/httpheader.h>",
            "#include <tnt/messageheader.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <time.h>\n#include <tnt/cookie.h>\n#include <tnt/httpheader.h>\n#include <tnt/messageheader.h>\n\nHttpMessage {\n  header_type::const_iterator header_begin() const\n          { return header.begin(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "errorReply.setKeepAliveCounter",
          "args": [
            "0"
          ],
          "line": 183
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "errorReply.setVersion",
          "args": [
            "1",
            "0"
          ],
          "line": 182
        },
        "resolved": true,
        "details": {
          "function_name": "setVersion",
          "container": "HttpMessage",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/httpmessage.h",
          "lines": "79-80",
          "snippet": "void setVersion(unsigned short major, unsigned short minor)\n        { majorVersion = major; minorVersion = minor; }",
          "includes": [
            "#include <time.h>",
            "#include <tnt/cookie.h>",
            "#include <tnt/httpheader.h>",
            "#include <tnt/messageheader.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <time.h>\n#include <tnt/cookie.h>\n#include <tnt/httpheader.h>\n#include <tnt/messageheader.h>\n\nHttpMessage {\n  void setVersion(unsigned short major, unsigned short minor)\n          { majorVersion = major; minorVersion = minor; }\n}"
        }
      },
      {
        "call_info": {
          "callee": "log_warn",
          "args": [
            "\"http-Error: \" << e.what()"
          ],
          "line": 180
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e.what",
          "args": [],
          "line": 180
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "application.getPoller",
          "args": [
            "j"
          ],
          "line": 168
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "application.getPoller",
          "args": [],
          "line": 168
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"pass job to poll-thread\""
          ],
          "line": 167
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "::poll",
          "args": [
            "&fd",
            "1",
            "TntConfig::it().socketReadTimeout"
          ],
          "line": 165
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TntConfig::it",
          "args": [],
          "line": 165
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "j->getFd",
          "args": [],
          "line": 163
        },
        "resolved": true,
        "details": {
          "function_name": "getFd",
          "container": "Fdfile",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/defcomp/static.cpp",
          "lines": "202-202",
          "snippet": "int getFd() const  { return fd; }",
          "includes": [
            "#include <errno.h>",
            "#include <typeinfo>",
            "#include <unistd.h>",
            "#include <sys/poll.h>",
            "#include <netinet/tcp.h>",
            "#include <netinet/in.h>",
            "#include <sys/socket.h>",
            "#include <cxxtools/net/tcpstream.h>",
            "#include <sys/sendfile.h>",
            "#include <fcntl.h>",
            "#include <limits>",
            "#include <config.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <cxxtools/convert.h>",
            "#include <cxxtools/ioerror.h>",
            "#include <cxxtools/systemerror.h>",
            "#include <cxxtools/log.h>",
            "#include <fstream>",
            "#include <tnt/tntconfig.h>",
            "#include <tnt/comploader.h>",
            "#include <tnt/httpheader.h>",
            "#include <tnt/http.h>",
            "#include <tnt/httperror.h>",
            "#include <tnt/httpreply.h>",
            "#include <tnt/httprequest.h>",
            "#include \"mimehandler.h\"",
            "#include \"static.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <errno.h>\n#include <typeinfo>\n#include <unistd.h>\n#include <sys/poll.h>\n#include <netinet/tcp.h>\n#include <netinet/in.h>\n#include <sys/socket.h>\n#include <cxxtools/net/tcpstream.h>\n#include <sys/sendfile.h>\n#include <fcntl.h>\n#include <limits>\n#include <config.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <cxxtools/convert.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/systemerror.h>\n#include <cxxtools/log.h>\n#include <fstream>\n#include <tnt/tntconfig.h>\n#include <tnt/comploader.h>\n#include <tnt/httpheader.h>\n#include <tnt/http.h>\n#include <tnt/httperror.h>\n#include <tnt/httpreply.h>\n#include <tnt/httprequest.h>\n#include \"mimehandler.h\"\n#include \"static.h\"\n\nFdfile {\n  int getFd() const  { return fd; }\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue.put",
          "args": [
            "j",
            "true"
          ],
          "line": 157
        },
        "resolved": true,
        "details": {
          "function_name": "put",
          "container": "Scope",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/scope.h",
          "lines": "99-100",
          "snippet": "void put(const std::string& key, T* o)\n      { put<T, cxxtools::DeletePolicy>(key, o); }",
          "includes": [
            "#include <cxxtools/refcounted.h>",
            "#include <cxxtools/mutex.h>",
            "#include <tnt/object.h>",
            "#include <string>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <cxxtools/refcounted.h>\n#include <cxxtools/mutex.h>\n#include <tnt/object.h>\n#include <string>\n#include <map>\n\nScope {\n  void put(const std::string& key, T* o)\n        { put<T, cxxtools::DeletePolicy>(key, o); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"put job back into queue\""
          ],
          "line": 156
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "queue.empty",
          "args": [],
          "line": 152
        },
        "resolved": true,
        "details": {
          "function_name": "empty",
          "container": "Jobqueue",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/job.h",
          "lines": "132-133",
          "snippet": "bool empty() const\n        { return jobs.empty(); }",
          "includes": [
            "#include <cxxtools/smartptr.h>",
            "#include <cxxtools/refcounted.h>",
            "#include <cxxtools/condition.h>",
            "#include <cxxtools/mutex.h>",
            "#include <tnt/httpparser.h>",
            "#include <tnt/httprequest.h>",
            "#include <deque>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <cxxtools/smartptr.h>\n#include <cxxtools/refcounted.h>\n#include <cxxtools/condition.h>\n#include <cxxtools/mutex.h>\n#include <tnt/httpparser.h>\n#include <tnt/httprequest.h>\n#include <deque>\n\nJobqueue {\n  bool empty() const\n          { return jobs.empty(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "queue.getWaitThreadCount",
          "args": [],
          "line": 151
        },
        "resolved": true,
        "details": {
          "function_name": "getWaitThreadCount",
          "container": "Jobqueue",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/job.h",
          "lines": "130-131",
          "snippet": "unsigned getWaitThreadCount() const\n        { return waitThreads; }",
          "includes": [
            "#include <cxxtools/smartptr.h>",
            "#include <cxxtools/refcounted.h>",
            "#include <cxxtools/condition.h>",
            "#include <cxxtools/mutex.h>",
            "#include <tnt/httpparser.h>",
            "#include <tnt/httprequest.h>",
            "#include <deque>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <cxxtools/smartptr.h>\n#include <cxxtools/refcounted.h>\n#include <cxxtools/condition.h>\n#include <cxxtools/mutex.h>\n#include <tnt/httpparser.h>\n#include <tnt/httprequest.h>\n#include <deque>\n\nJobqueue {\n  unsigned getWaitThreadCount() const\n          { return waitThreads; }\n}"
        }
      },
      {
        "call_info": {
          "callee": "socket.rdbuf",
          "args": [],
          "line": 149
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "socket.rdbuf",
          "args": [],
          "line": 149
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "j->clear",
          "args": [],
          "line": 147
        },
        "resolved": true,
        "details": {
          "function_name": "clear",
          "container": "Compident",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/compident.h",
          "lines": "76-77",
          "snippet": "void clear()\n    { libname.clear(); compname.clear(); }",
          "includes": [
            "#include <iostream>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <iostream>\n#include <string>\n\nCompident {\n  void clear()\n      { libname.clear(); compname.clear(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "j->setRead",
          "args": [],
          "line": 146
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "processRequest",
          "args": [
            "j->getRequest()",
            "socket",
            "j->decrementKeepAliveCounter()"
          ],
          "line": 141
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "j->decrementKeepAliveCounter",
          "args": [],
          "line": 142
        },
        "resolved": true,
        "details": {
          "function_name": "decrementKeepAliveCounter",
          "container": "Job",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/job.h",
          "lines": "94-95",
          "snippet": "unsigned decrementKeepAliveCounter()\n        { return keepAliveCounter > 0 ? --keepAliveCounter : 0; }",
          "includes": [
            "#include <cxxtools/smartptr.h>",
            "#include <cxxtools/refcounted.h>",
            "#include <cxxtools/condition.h>",
            "#include <cxxtools/mutex.h>",
            "#include <tnt/httpparser.h>",
            "#include <tnt/httprequest.h>",
            "#include <deque>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <cxxtools/smartptr.h>\n#include <cxxtools/refcounted.h>\n#include <cxxtools/condition.h>\n#include <cxxtools/mutex.h>\n#include <tnt/httpparser.h>\n#include <tnt/httprequest.h>\n#include <deque>\n\nJob {\n  unsigned decrementKeepAliveCounter()\n          { return keepAliveCounter > 0 ? --keepAliveCounter : 0; }\n}"
        }
      },
      {
        "call_info": {
          "callee": "j->getRequest",
          "args": [],
          "line": 141
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "j->setWrite",
          "args": [],
          "line": 140
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "j->getRequest",
          "args": [],
          "line": 138
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "j->getRequest",
          "args": [],
          "line": 138
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"socket failed\""
          ],
          "line": 135
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "socket.fail",
          "args": [],
          "line": 134
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "j->getRequest",
          "args": [],
          "line": 132
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "errorReply.out",
          "args": [],
          "line": 130
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "errorReply.setKeepAliveCounter",
          "args": [
            "0"
          ],
          "line": 129
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "errorReply.setContentType",
          "args": [
            "\"text/html\""
          ],
          "line": 128
        },
        "resolved": true,
        "details": {
          "function_name": "setContentType",
          "container": "HttpReply",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/httpreply.h",
          "lines": "61-61",
          "snippet": "void setContentType(const std::string& t)     { setHeader(httpheader::contentType, t); }",
          "includes": [
            "#include <iosfwd>",
            "#include <tnt/http.h>",
            "#include <tnt/httpmessage.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <iosfwd>\n#include <tnt/http.h>\n#include <tnt/httpmessage.h>\n\nHttpReply {\n  void setContentType(const std::string& t)     { setHeader(httpheader::contentType, t); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "log_warn",
          "args": [
            "\"bad request\""
          ],
          "line": 125
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "j->getParser",
          "args": [],
          "line": 122
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "j->getParser",
          "args": [],
          "line": 122
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"eof\""
          ],
          "line": 121
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "socket.eof",
          "args": [],
          "line": 120
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "j->getParser",
          "args": [
            "socket"
          ],
          "line": 117
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "j->getParser",
          "args": [],
          "line": 117
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "time",
          "args": [
            "&lastWaitTime"
          ],
          "line": 111
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Tntnet::shouldStop",
          "args": [],
          "line": 105
        },
        "resolved": true,
        "details": {
          "function_name": "shouldStop",
          "container": "Tntnet",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/tntnet.h",
          "lines": "126-126",
          "snippet": "static bool shouldStop()   { return stop; }",
          "includes": [
            "#include <fstream>",
            "#include <set>",
            "#include <cxxtools/mutex.h>",
            "#include <cxxtools/condition.h>",
            "#include <tnt/scopemanager.h>",
            "#include <tnt/maptarget.h>",
            "#include <tnt/dispatcher.h>",
            "#include <tnt/poller.h>",
            "#include <tnt/job.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <fstream>\n#include <set>\n#include <cxxtools/mutex.h>\n#include <cxxtools/condition.h>\n#include <tnt/scopemanager.h>\n#include <tnt/maptarget.h>\n#include <tnt/dispatcher.h>\n#include <tnt/poller.h>\n#include <tnt/job.h>\n\nTntnet {\n  static bool shouldStop()   { return stop; }\n}"
        }
      },
      {
        "call_info": {
          "callee": "j->getStream",
          "args": [],
          "line": 104
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "queue.put",
          "args": [
            "j"
          ],
          "line": 98
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "application.getMinThreads",
          "args": [],
          "line": 91
        },
        "resolved": true,
        "details": {
          "function_name": "getMinThreads",
          "container": "Configurator",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/configurator.h",
          "lines": "61-62",
          "snippet": "unsigned getMinThreads() const\n        { return TntConfig::it().minThreads; }",
          "includes": [
            "#include <tnt/tntconfig.h>",
            "#include <tnt/backgroundworker.h>",
            "#include <tnt/httpreply.h>",
            "#include <tnt/sessionscope.h>",
            "#include <tnt/worker.h>",
            "#include <tnt/tntnet.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <tnt/tntconfig.h>\n#include <tnt/backgroundworker.h>\n#include <tnt/httpreply.h>\n#include <tnt/sessionscope.h>\n#include <tnt/worker.h>\n#include <tnt/tntnet.h>\n\nConfigurator {\n  unsigned getMinThreads() const\n          { return TntConfig::it().minThreads; }\n}"
        }
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"start thread \" << threadId"
          ],
          "line": 90
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "application.getQueue",
          "args": [],
          "line": 89
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pthread_self",
          "args": [],
          "line": 88
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"config.h\"\n#include <string.h>\n#include <pthread.h>\n#include <cxxtools/net/tcpserver.h>\n#include <cxxtools/atomicity.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/dlloader.h>\n#include <sys/poll.h>\n#include <arpa/inet.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <cxxtools/log.h>\n#include <tnt/tntconfig.h>\n#include <tnt/poller.h>\n#include <tnt/http.h>\n#include <tnt/httperror.h>\n#include <tnt/httpreply.h>\n#include <tnt/httprequest.h>\n#include \"tnt/job.h\"\n#include \"tnt/dispatcher.h\"\n#include \"tnt/worker.h\"\n\nvoid Worker::run()\n  {\n    threadId = pthread_self();\n    Jobqueue& queue = application.getQueue();\n    log_debug(\"start thread \" << threadId);\n    while (queue.getWaitThreadCount() < application.getMinThreads())\n    {\n      state = stateWaitingForJob;\n      Jobqueue::JobPtr j = queue.get();\n      if (Tntnet::shouldStop())\n      {\n        // put job back to queue to wake up next worker if any left\n        queue.put(j);\n        break;\n      }\n\n      try\n      {\n        std::iostream& socket = j->getStream();\n        if (Tntnet::shouldStop())\n          break;\n\n        bool keepAlive;\n        do\n        {\n          time(&lastWaitTime);\n\n          keepAlive = false;\n          state = stateParsing;\n          try\n          {\n            j->getParser().parse(socket);\n            state = statePostParsing;\n\n            if (socket.eof())\n              log_debug(\"eof\");\n            else if (j->getParser().failed())\n            {\n              state = stateSendError;\n              log_warn(\"bad request\");\n              tnt::HttpReply errorReply(socket);\n              errorReply.setVersion(1, 0);\n              errorReply.setContentType(\"text/html\");\n              errorReply.setKeepAliveCounter(0);\n              errorReply.out() << \"<html><body><h1>Error</h1><p>bad request</p></body></html>\\n\";\n              errorReply.sendReply(400, \"Bad Request\");\n              logRequest(j->getRequest(), errorReply, 400);\n            }\n            else if (socket.fail())\n              log_debug(\"socket failed\");\n            else\n            {\n              j->getRequest().doPostParse();\n\n              j->setWrite();\n              keepAlive = processRequest(j->getRequest(), socket,\n                j->decrementKeepAliveCounter());\n\n              if (keepAlive)\n              {\n                j->setRead();\n                j->clear();\n\n                if (!socket.rdbuf()->in_avail())\n                {\n                  if (queue.getWaitThreadCount() == 0\n                    && !queue.empty())\n                  {\n                    // if there is something to do and no threads waiting, we take\n                    // the next job just to improve responsiveness.\n                    log_debug(\"put job back into queue\");\n                    queue.put(j, true);\n                    keepAlive = false;\n                  }\n                  else\n                  {\n                    struct pollfd fd;\n                    fd.fd = j->getFd();\n                    fd.events = POLLIN;\n                    if (::poll(&fd, 1, TntConfig::it().socketReadTimeout) == 0)\n                    {\n                      log_debug(\"pass job to poll-thread\");\n                      application.getPoller().addIdleJob(j);\n                      keepAlive = false;\n                    }\n                  }\n                }\n              }\n            }\n          }\n          catch (const HttpError& e)\n          {\n            keepAlive = false;\n            state = stateSendError;\n            log_warn(\"http-Error: \" << e.what());\n            HttpReply errorReply(socket);\n            errorReply.setVersion(1, 0);\n            errorReply.setKeepAliveCounter(0);\n            for (HttpMessage::header_type::const_iterator it = e.header_begin();\n                 it != e.header_end(); ++it)\n              errorReply.setHeader(it->first, it->second);\n\n            errorReply.out() << e.getBody() << '\\n';\n            errorReply.sendReply(e.getErrcode(), e.getErrmsg());\n            logRequest(j->getRequest(), errorReply, e.getErrcode());\n          }\n        } while (keepAlive);\n      }\n      catch (const cxxtools::IOTimeout& e)\n      {\n        application.getPoller().addIdleJob(j);\n      }\n      catch (const cxxtools::net::AcceptTerminated&)\n      {\n        log_debug(\"listener terminated\");\n        break;\n      }\n      catch (const std::exception& e)\n      {\n        log_warn(\"unexpected exception: \" << e.what());\n      }\n    }\n\n    time(&lastWaitTime);\n\n    state = stateStopping;\n\n    cxxtools::MutexLock lock(mutex);\n    workers.erase(this);\n\n    log_debug(\"end worker thread \" << threadId << \" - \" << workers.size()\n      << \" threads left - \" << application.getQueue().getWaitThreadCount()\n      << \" waiting threads\");\n  }"
  },
  {
    "function_name": "Worker::Worker",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/worker.cpp",
    "lines": "76-84",
    "snippet": "Worker::Worker(Tntnet& app)\n    : application(app),\n      threadId(0),\n      state(stateStarting),\n      lastWaitTime(0)\n  {\n    cxxtools::MutexLock lock(mutex);\n    workers.insert(this);\n  }",
    "includes": [
      "#include \"config.h\"",
      "#include <string.h>",
      "#include <pthread.h>",
      "#include <cxxtools/net/tcpserver.h>",
      "#include <cxxtools/atomicity.h>",
      "#include <cxxtools/ioerror.h>",
      "#include <cxxtools/dlloader.h>",
      "#include <sys/poll.h>",
      "#include <arpa/inet.h>",
      "#include <sys/socket.h>",
      "#include <sys/types.h>",
      "#include <unistd.h>",
      "#include <stdlib.h>",
      "#include <cxxtools/log.h>",
      "#include <tnt/tntconfig.h>",
      "#include <tnt/poller.h>",
      "#include <tnt/http.h>",
      "#include <tnt/httperror.h>",
      "#include <tnt/httpreply.h>",
      "#include <tnt/httprequest.h>",
      "#include \"tnt/job.h\"",
      "#include \"tnt/dispatcher.h\"",
      "#include \"tnt/worker.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "workers.insert",
          "args": [
            "this"
          ],
          "line": 83
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"config.h\"\n#include <string.h>\n#include <pthread.h>\n#include <cxxtools/net/tcpserver.h>\n#include <cxxtools/atomicity.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/dlloader.h>\n#include <sys/poll.h>\n#include <arpa/inet.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include <unistd.h>\n#include <stdlib.h>\n#include <cxxtools/log.h>\n#include <tnt/tntconfig.h>\n#include <tnt/poller.h>\n#include <tnt/http.h>\n#include <tnt/httperror.h>\n#include <tnt/httpreply.h>\n#include <tnt/httprequest.h>\n#include \"tnt/job.h\"\n#include \"tnt/dispatcher.h\"\n#include \"tnt/worker.h\"\n\nWorker::Worker(Tntnet& app)\n    : application(app),\n      threadId(0),\n      state(stateStarting),\n      lastWaitTime(0)\n  {\n    cxxtools::MutexLock lock(mutex);\n    workers.insert(this);\n  }"
  }
]