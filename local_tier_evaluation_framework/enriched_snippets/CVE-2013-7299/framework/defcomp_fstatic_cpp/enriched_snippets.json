[
  {
    "function_name": "Fstatic::drop",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/defcomp/fstatic.cpp",
    "lines": "125-128",
    "snippet": "void Fstatic::drop()\n  {\n    factory.drop(this);\n  }",
    "includes": [
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <cxxtools/log.h>",
      "#include <fstream>",
      "#include <tnt/comploader.h>",
      "#include <tnt/httperror.h>",
      "#include <tnt/httpheader.h>",
      "#include <tnt/http.h>",
      "#include <tnt/httperror.h>",
      "#include <tnt/httpreply.h>",
      "#include <tnt/httprequest.h>",
      "#include <tnt/componentfactory.h>",
      "#include \"fstatic.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "factory.drop",
          "args": [
            "this"
          ],
          "line": 127
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <sys/stat.h>\n#include <sys/types.h>\n#include <cxxtools/log.h>\n#include <fstream>\n#include <tnt/comploader.h>\n#include <tnt/httperror.h>\n#include <tnt/httpheader.h>\n#include <tnt/http.h>\n#include <tnt/httperror.h>\n#include <tnt/httpreply.h>\n#include <tnt/httprequest.h>\n#include <tnt/componentfactory.h>\n#include \"fstatic.h\"\n\nvoid Fstatic::drop()\n  {\n    factory.drop(this);\n  }"
  },
  {
    "function_name": "Fstatic::operator()",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/defcomp/fstatic.cpp",
    "lines": "71-123",
    "snippet": "unsigned Fstatic::operator() (tnt::HttpRequest& request,\n    tnt::HttpReply& reply, tnt::QueryParams& qparams)\n  {\n    if (!tnt::HttpRequest::checkUrl(request.getPathInfo()))\n      throw tnt::HttpError(HTTP_BAD_REQUEST, \"illegal url\");\n\n    std::string file;\n    if (!getDocumentRoot().empty())\n      file = getDocumentRoot() + '/';\n    file += request.getPathInfo();\n\n    log_debug(\"file: \" << file);\n\n    struct stat st;\n    if (stat(file.c_str(), &st) != 0)\n    {\n      log_warn(\"error in stat for file \\\"\" << file << \"\\\"\");\n      reply.throwNotFound(request.getPathInfo());\n    }\n\n    if (!S_ISREG(st.st_mode))\n    {\n      log_warn(\"no regular file \\\"\" << file << \"\\\"\");\n      reply.throwNotFound(request.getPathInfo());\n    }\n\n    std::ifstream in(file.c_str());\n\n    if (!in)\n    {\n      log_warn(\"file \\\"\" << file << \"\\\" not found\");\n      reply.throwNotFound(request.getPathInfo());\n    }\n\n    // set Content-Type\n    if (request.getArgs().size() > 0)\n      reply.setContentType(request.getArg(0));\n\n    // set Content-Length\n    reply.setContentLengthHeader(st.st_size);\n\n    // set Keep-Alive\n    if (request.keepAlive())\n      reply.setHeader(tnt::httpheader::connection,\n                      tnt::httpheader::connectionKeepAlive);\n\n    // send data\n    log_info(\"send static file \\\"\" << file << \"\\\" size \" << st.st_size << \" bytes\");\n    reply.setDirectMode();\n    reply.out() << in.rdbuf();\n\n    return HTTP_OK;\n  }",
    "includes": [
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <cxxtools/log.h>",
      "#include <fstream>",
      "#include <tnt/comploader.h>",
      "#include <tnt/httperror.h>",
      "#include <tnt/httpheader.h>",
      "#include <tnt/http.h>",
      "#include <tnt/httperror.h>",
      "#include <tnt/httpreply.h>",
      "#include <tnt/httprequest.h>",
      "#include <tnt/componentfactory.h>",
      "#include \"fstatic.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "in.rdbuf",
          "args": [],
          "line": 120
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "reply.out",
          "args": [],
          "line": 120
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "reply.setDirectMode",
          "args": [],
          "line": 119
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_info",
          "args": [
            "\"send static file \\\"\" << file << \"\\\" size \" << st.st_size << \" bytes\""
          ],
          "line": 118
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "reply.setHeader",
          "args": [
            "tnt::httpheader::connection",
            "tnt::httpheader::connectionKeepAlive"
          ],
          "line": 114
        },
        "resolved": true,
        "details": {
          "function_name": "setHeader",
          "container": "HttpMessage",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/httpmessage.h",
          "lines": "91-92",
          "snippet": "void setHeader(const std::string& key, const std::string& value, bool replace = true)\n        { header.setHeader(key, value, replace); }",
          "includes": [
            "#include <time.h>",
            "#include <tnt/cookie.h>",
            "#include <tnt/httpheader.h>",
            "#include <tnt/messageheader.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <time.h>\n#include <tnt/cookie.h>\n#include <tnt/httpheader.h>\n#include <tnt/messageheader.h>\n\nHttpMessage {\n  void setHeader(const std::string& key, const std::string& value, bool replace = true)\n          { header.setHeader(key, value, replace); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "request.keepAlive",
          "args": [],
          "line": 113
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "reply.setContentLengthHeader",
          "args": [
            "st.st_size"
          ],
          "line": 110
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "reply.setContentType",
          "args": [
            "request.getArg(0)"
          ],
          "line": 107
        },
        "resolved": true,
        "details": {
          "function_name": "setContentType",
          "container": "HttpReply",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/httpreply.h",
          "lines": "61-61",
          "snippet": "void setContentType(const std::string& t)     { setHeader(httpheader::contentType, t); }",
          "includes": [
            "#include <iosfwd>",
            "#include <tnt/http.h>",
            "#include <tnt/httpmessage.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <iosfwd>\n#include <tnt/http.h>\n#include <tnt/httpmessage.h>\n\nHttpReply {\n  void setContentType(const std::string& t)     { setHeader(httpheader::contentType, t); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "request.getArg",
          "args": [
            "0"
          ],
          "line": 107
        },
        "resolved": true,
        "details": {
          "function_name": "getArg",
          "container": "HttpRequest",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/httprequest.h",
          "lines": "163-163",
          "snippet": "std::string getArg(args_type::size_type n) const { return getArgDef(n); }",
          "includes": [
            "#include <cstring>",
            "#include <string>",
            "#include <cxxtools/atomicity.h>",
            "#include <map>",
            "#include <locale>",
            "#include <tnt/threadcontext.h>",
            "#include <tnt/scope.h>",
            "#include <tnt/query_params.h>",
            "#include <tnt/encoding.h>",
            "#include <tnt/cookie.h>",
            "#include <tnt/multipart.h>",
            "#include <tnt/contenttype.h>",
            "#include <tnt/socketif.h>",
            "#include <tnt/httpheader.h>",
            "#include <tnt/httpmessage.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <cstring>\n#include <string>\n#include <cxxtools/atomicity.h>\n#include <map>\n#include <locale>\n#include <tnt/threadcontext.h>\n#include <tnt/scope.h>\n#include <tnt/query_params.h>\n#include <tnt/encoding.h>\n#include <tnt/cookie.h>\n#include <tnt/multipart.h>\n#include <tnt/contenttype.h>\n#include <tnt/socketif.h>\n#include <tnt/httpheader.h>\n#include <tnt/httpmessage.h>\n\nHttpRequest {\n  std::string getArg(args_type::size_type n) const { return getArgDef(n); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "request.getArgs",
          "args": [],
          "line": 106
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "request.getArgs",
          "args": [],
          "line": 106
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "reply.throwNotFound",
          "args": [
            "request.getPathInfo()"
          ],
          "line": 102
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "request.getPathInfo",
          "args": [],
          "line": 102
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_warn",
          "args": [
            "\"file \\\"\" << file << \"\\\" not found\""
          ],
          "line": 101
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "file.c_str",
          "args": [],
          "line": 97
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "reply.throwNotFound",
          "args": [
            "request.getPathInfo()"
          ],
          "line": 94
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "request.getPathInfo",
          "args": [],
          "line": 94
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_warn",
          "args": [
            "\"no regular file \\\"\" << file << \"\\\"\""
          ],
          "line": 93
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "S_ISREG",
          "args": [
            "st.st_mode"
          ],
          "line": 91
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "reply.throwNotFound",
          "args": [
            "request.getPathInfo()"
          ],
          "line": 88
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "request.getPathInfo",
          "args": [],
          "line": 88
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_warn",
          "args": [
            "\"error in stat for file \\\"\" << file << \"\\\"\""
          ],
          "line": 87
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "stat",
          "args": [
            "file.c_str()",
            "&st"
          ],
          "line": 85
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "file.c_str",
          "args": [],
          "line": 85
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"file: \" << file"
          ],
          "line": 82
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "request.getPathInfo",
          "args": [],
          "line": 80
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getDocumentRoot",
          "args": [],
          "line": 79
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getDocumentRoot",
          "args": [],
          "line": 78
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getDocumentRoot",
          "args": [],
          "line": 78
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tnt::HttpError",
          "args": [
            "HTTP_BAD_REQUEST",
            "\"illegal url\""
          ],
          "line": 75
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tnt::HttpRequest::checkUrl",
          "args": [
            "request.getPathInfo()"
          ],
          "line": 74
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "request.getPathInfo",
          "args": [],
          "line": 74
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <sys/stat.h>\n#include <sys/types.h>\n#include <cxxtools/log.h>\n#include <fstream>\n#include <tnt/comploader.h>\n#include <tnt/httperror.h>\n#include <tnt/httpheader.h>\n#include <tnt/http.h>\n#include <tnt/httperror.h>\n#include <tnt/httpreply.h>\n#include <tnt/httprequest.h>\n#include <tnt/componentfactory.h>\n#include \"fstatic.h\"\n\nunsigned Fstatic::operator() (tnt::HttpRequest& request,\n    tnt::HttpReply& reply, tnt::QueryParams& qparams)\n  {\n    if (!tnt::HttpRequest::checkUrl(request.getPathInfo()))\n      throw tnt::HttpError(HTTP_BAD_REQUEST, \"illegal url\");\n\n    std::string file;\n    if (!getDocumentRoot().empty())\n      file = getDocumentRoot() + '/';\n    file += request.getPathInfo();\n\n    log_debug(\"file: \" << file);\n\n    struct stat st;\n    if (stat(file.c_str(), &st) != 0)\n    {\n      log_warn(\"error in stat for file \\\"\" << file << \"\\\"\");\n      reply.throwNotFound(request.getPathInfo());\n    }\n\n    if (!S_ISREG(st.st_mode))\n    {\n      log_warn(\"no regular file \\\"\" << file << \"\\\"\");\n      reply.throwNotFound(request.getPathInfo());\n    }\n\n    std::ifstream in(file.c_str());\n\n    if (!in)\n    {\n      log_warn(\"file \\\"\" << file << \"\\\" not found\");\n      reply.throwNotFound(request.getPathInfo());\n    }\n\n    // set Content-Type\n    if (request.getArgs().size() > 0)\n      reply.setContentType(request.getArg(0));\n\n    // set Content-Length\n    reply.setContentLengthHeader(st.st_size);\n\n    // set Keep-Alive\n    if (request.keepAlive())\n      reply.setHeader(tnt::httpheader::connection,\n                      tnt::httpheader::connectionKeepAlive);\n\n    // send data\n    log_info(\"send static file \\\"\" << file << \"\\\" size \" << st.st_size << \" bytes\");\n    reply.setDirectMode();\n    reply.out() << in.rdbuf();\n\n    return HTTP_OK;\n  }"
  },
  {
    "function_name": "FstaticFactory",
    "container": "FstaticFactory",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/defcomp/fstatic.cpp",
    "lines": "53-55",
    "snippet": "FstaticFactory(const std::string& componentName)\n        : tnt::SingletonComponentFactory(componentName)\n        { }",
    "includes": [
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <cxxtools/log.h>",
      "#include <fstream>",
      "#include <tnt/comploader.h>",
      "#include <tnt/httperror.h>",
      "#include <tnt/httpheader.h>",
      "#include <tnt/http.h>",
      "#include <tnt/httperror.h>",
      "#include <tnt/httpreply.h>",
      "#include <tnt/httprequest.h>",
      "#include <tnt/componentfactory.h>",
      "#include \"fstatic.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include <sys/stat.h>\n#include <sys/types.h>\n#include <cxxtools/log.h>\n#include <fstream>\n#include <tnt/comploader.h>\n#include <tnt/httperror.h>\n#include <tnt/httpheader.h>\n#include <tnt/http.h>\n#include <tnt/httperror.h>\n#include <tnt/httpreply.h>\n#include <tnt/httprequest.h>\n#include <tnt/componentfactory.h>\n#include \"fstatic.h\"\n\nFstaticFactory {\n  FstaticFactory(const std::string& componentName)\n          : tnt::SingletonComponentFactory(componentName)\n          { }\n}"
  }
]