[
  {
    "function_name": "Static::doCall",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/defcomp/static.cpp",
    "lines": "266-467",
    "snippet": "unsigned Static::doCall(HttpRequest& request,\n    HttpReply& reply, QueryParams& qparams, bool top)\n  {\n    // fetch document root from arguments or take global setting as default\n\n    std::string file = request.getArg(\"documentRoot\", TntConfig::it().documentRoot);\n    log_debug(\"document root =\\\"\" << file << '\"');\n\n    if (!file.empty() && *file.rbegin() != '/')\n      file += '/';\n\n    file += request.getPathInfo();\n\n    log_debug(\"file: \" << file);\n\n    struct stat st;\n\n    bool localEnableGzip = false;\n    if (request.getEncoding().accept(\"gzip\") && TntConfig::it().enableCompression)\n    {\n      std::string gzfile = file + \".gz\";\n      if (stat(gzfile.c_str(), &st) == 0 && S_ISREG(st.st_mode))\n      {\n        log_debug(\"enable compression\");\n        file = gzfile;\n        localEnableGzip = true;\n        reply.setHeader(httpheader::contentEncoding, \"gzip\");\n      }\n      else\n      {\n        log_debug(\"compressed file \\\"\" << gzfile << \"\\\" not found or not a regular file\");\n      }\n    }\n\n    if (!localEnableGzip)\n    {\n      if (stat(file.c_str(), &st) != 0)\n      {\n        log_debug(\"can't stat file \\\"\" << file << \"\\\"\");\n        return DECLINED;\n      }\n\n      if (!S_ISREG(st.st_mode))\n      {\n        log_debug(\"no regular file \\\"\" << file << \"\\\"\");\n        return DECLINED;\n      }\n    }\n\n    off_t offset = 0;\n    off_t count = st.st_size;\n    unsigned httpOkReturn = HTTP_OK;\n\n    if (top)\n    {\n      // set Content-Type\n      std::string contentType = request.getArg(\"contentType\");\n      if (!contentType.empty())\n      {\n        log_debug(\"content type is \\\"\" << contentType << '\"');\n        reply.setContentType(contentType.c_str());\n      }\n      else\n        setContentType(request, reply);\n\n      std::string lastModified = HttpMessage::htdate(st.st_ctime);\n\n      {\n        std::string s = request.getHeader(httpheader::ifModifiedSince);\n        if (s == lastModified)\n          return HTTP_NOT_MODIFIED;\n      }\n\n      reply.setHeader(httpheader::lastModified, lastModified);\n      reply.setKeepAliveHeader();\n      reply.setHeader(httpheader::acceptRanges, \"bytes\");\n\n      std::string maxAgeStr = request.getArg(\"maxAge\");\n      unsigned maxAge = maxAgeStr.empty() ? 14400 : cxxtools::convert<unsigned>(maxAgeStr);\n      reply.setMaxAgeHeader(maxAge);\n\n      // check for byte range (only \"bytes=from-\" or \"bytes=from-to\" are supported)\n      const char* range = request.getHeader(httpheader::range, 0);\n      if (range)\n      {\n        if (parseRange(range, offset, count))\n        {\n          if (offset > st.st_size)\n            return HTTP_RANGE_NOT_SATISFIABLE;\n\n          reply.setHeader(httpheader::contentLocation, request.getUrl());\n          std::ostringstream contentRange;\n          contentRange << offset << '-' << (offset+count)-1 << '/' << st.st_size;\n          reply.setHeader(httpheader::contentRange, contentRange.str());\n\n          httpOkReturn = HTTP_PARTIAL_CONTENT;\n        }\n        else\n          log_debug(\"ignore invalid byte range \" << range);\n      }\n\n      // set Content-Length\n      reply.setContentLengthHeader(count);\n\n      if (request.isMethodHEAD())\n      {\n        log_debug(\"head request\");\n        return httpOkReturn;\n      }\n      else\n      {\n        log_debug(\"no head request\");\n      }\n\n      // send data\n      log_info(\"send file \\\"\" << file << \"\\\" size \" << st.st_size << \" bytes; offset=\" << offset << \" count=\" << count);\n\n#if defined(HAVE_SENDFILE) && defined(HAVE_SYS_SENDFILE_H)\n      int on = 1;\n      int off = 0;\n      try\n      {\n        cxxtools::net::iostream& tcpStream = dynamic_cast<cxxtools::net::iostream&>(reply.getDirectStream());\n\n        if (::setsockopt(tcpStream.getFd(), SOL_TCP, TCP_NODELAY,\n            &off, sizeof(off)) < 0)\n          throw cxxtools::SystemError(\"setsockopt(TCP_NODELAY)\");\n\n        if (::setsockopt(tcpStream.getFd(), SOL_TCP, TCP_CORK,\n            &on, sizeof(on)) < 0)\n          throw cxxtools::SystemError(\"setsockopt(TCP_CORK)\");\n\n        reply.setDirectMode(httpOkReturn, HttpReturn::httpMessage(httpOkReturn));\n        tcpStream.flush();\n\n        Fdfile in(file.c_str(), O_RDONLY);\n        ssize_t s;\n        while(tcpStream)\n        {\n          do\n          {\n            log_debug(\"sendfile offset \" << offset << \" size \" << count);\n            s = sendfile(tcpStream.getFd(), in.getFd(), &offset, count);\n            log_debug(\"sendfile returns \" << s);\n          } while (s < 0 && errno == EINTR);\n\n          if (s < 0 && errno != EAGAIN)\n            throw cxxtools::SystemError(\"sendfile\");\n\n          if (offset >= count)\n            break;\n\n          log_debug(\"poll\");\n          pollout(tcpStream.getFd(), tcpStream.getTimeout());\n        }\n\n        if (::setsockopt(tcpStream.getFd(), SOL_TCP, TCP_CORK,\n            &off, sizeof(off)) < 0)\n          throw cxxtools::SystemError(\"setsockopt(TCP_CORK)\");\n\n        if (::setsockopt(tcpStream.getFd(), SOL_TCP, TCP_NODELAY,\n            &on, sizeof(on)) < 0)\n          throw cxxtools::SystemError(\"setsockopt(TCP_NODELAY)\");\n\n        return httpOkReturn;\n      }\n      catch (const std::bad_cast& e)\n      {\n        log_debug(\"stream is no tcpstream - don't use sendfile\");\n        reply.setDirectMode();\n      }\n#else\n      reply.setDirectMode();\n#endif\n    }\n\n    std::ifstream in(file.c_str());\n    in.seekg(offset);\n    if (!in)\n    {\n      log_debug(\"can't open file \\\"\" << file << '\"');\n      return DECLINED;\n    }\n\n    if (offset == 0 && count == st.st_size)\n    {\n      reply.out() << in.rdbuf() << std::flush;\n      if (in.fail())\n        throw std::runtime_error(\"failed to send file \\\"\" + file + '\"');\n    }\n    else\n    {\n      char ch;\n      off_t o;\n      for (o = 0; in.get(ch) && o < count; ++o)\n        reply.out().put(ch);\n      if (o < count)\n        throw std::runtime_error(\"failed to send file \\\"\" + file + '\"');\n    }\n\n    return httpOkReturn;\n  }",
    "includes": [
      "#include <errno.h>",
      "#include <typeinfo>",
      "#include <unistd.h>",
      "#include <sys/poll.h>",
      "#include <netinet/tcp.h>",
      "#include <netinet/in.h>",
      "#include <sys/socket.h>",
      "#include <cxxtools/net/tcpstream.h>",
      "#include <sys/sendfile.h>",
      "#include <fcntl.h>",
      "#include <limits>",
      "#include <config.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <cxxtools/convert.h>",
      "#include <cxxtools/ioerror.h>",
      "#include <cxxtools/systemerror.h>",
      "#include <cxxtools/log.h>",
      "#include <fstream>",
      "#include <tnt/tntconfig.h>",
      "#include <tnt/comploader.h>",
      "#include <tnt/httpheader.h>",
      "#include <tnt/http.h>",
      "#include <tnt/httperror.h>",
      "#include <tnt/httpreply.h>",
      "#include <tnt/httprequest.h>",
      "#include \"mimehandler.h\"",
      "#include \"static.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "std::runtime_error",
          "args": [
            "\"failed to send file \\\"\" + file + '\"'"
          ],
          "line": 463
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "reply.out",
          "args": [
            "ch"
          ],
          "line": 461
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "reply.out",
          "args": [],
          "line": 461
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "in.get",
          "args": [
            "ch"
          ],
          "line": 460
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "std::runtime_error",
          "args": [
            "\"failed to send file \\\"\" + file + '\"'"
          ],
          "line": 454
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "in.fail",
          "args": [],
          "line": 453
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "in.rdbuf",
          "args": [],
          "line": 452
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "reply.out",
          "args": [],
          "line": 452
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"can't open file \\\"\" << file << '\"'"
          ],
          "line": 446
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "in.seekg",
          "args": [
            "offset"
          ],
          "line": 443
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "file.c_str",
          "args": [],
          "line": 442
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "reply.setDirectMode",
          "args": [],
          "line": 438
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "reply.setDirectMode",
          "args": [],
          "line": 435
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"stream is no tcpstream - don't use sendfile\""
          ],
          "line": 434
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "cxxtools::SystemError",
          "args": [
            "\"setsockopt(TCP_NODELAY)\""
          ],
          "line": 428
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "::setsockopt",
          "args": [
            "tcpStream.getFd()",
            "SOL_TCP",
            "TCP_NODELAY",
            "&on",
            "sizeof(on)"
          ],
          "line": 426
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tcpStream.getFd",
          "args": [],
          "line": 426
        },
        "resolved": true,
        "details": {
          "function_name": "getFd",
          "container": "Fdfile",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/defcomp/static.cpp",
          "lines": "202-202",
          "snippet": "int getFd() const  { return fd; }",
          "includes": [
            "#include <errno.h>",
            "#include <typeinfo>",
            "#include <unistd.h>",
            "#include <sys/poll.h>",
            "#include <netinet/tcp.h>",
            "#include <netinet/in.h>",
            "#include <sys/socket.h>",
            "#include <cxxtools/net/tcpstream.h>",
            "#include <sys/sendfile.h>",
            "#include <fcntl.h>",
            "#include <limits>",
            "#include <config.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <cxxtools/convert.h>",
            "#include <cxxtools/ioerror.h>",
            "#include <cxxtools/systemerror.h>",
            "#include <cxxtools/log.h>",
            "#include <fstream>",
            "#include <tnt/tntconfig.h>",
            "#include <tnt/comploader.h>",
            "#include <tnt/httpheader.h>",
            "#include <tnt/http.h>",
            "#include <tnt/httperror.h>",
            "#include <tnt/httpreply.h>",
            "#include <tnt/httprequest.h>",
            "#include \"mimehandler.h\"",
            "#include \"static.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <errno.h>\n#include <typeinfo>\n#include <unistd.h>\n#include <sys/poll.h>\n#include <netinet/tcp.h>\n#include <netinet/in.h>\n#include <sys/socket.h>\n#include <cxxtools/net/tcpstream.h>\n#include <sys/sendfile.h>\n#include <fcntl.h>\n#include <limits>\n#include <config.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <cxxtools/convert.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/systemerror.h>\n#include <cxxtools/log.h>\n#include <fstream>\n#include <tnt/tntconfig.h>\n#include <tnt/comploader.h>\n#include <tnt/httpheader.h>\n#include <tnt/http.h>\n#include <tnt/httperror.h>\n#include <tnt/httpreply.h>\n#include <tnt/httprequest.h>\n#include \"mimehandler.h\"\n#include \"static.h\"\n\nFdfile {\n  int getFd() const  { return fd; }\n}"
        }
      },
      {
        "call_info": {
          "callee": "cxxtools::SystemError",
          "args": [
            "\"setsockopt(TCP_CORK)\""
          ],
          "line": 424
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "::setsockopt",
          "args": [
            "tcpStream.getFd()",
            "SOL_TCP",
            "TCP_CORK",
            "&off",
            "sizeof(off)"
          ],
          "line": 422
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pollout",
          "args": [
            "tcpStream.getFd()",
            "tcpStream.getTimeout()"
          ],
          "line": 419
        },
        "resolved": true,
        "details": {
          "function_name": "pollout",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/defcomp/static.cpp",
          "lines": "205-227",
          "snippet": "void pollout(int fd, int timeout)\n    {\n      struct pollfd fds;\n      fds.fd = fd;\n      fds.events = POLLOUT;\n\n      log_debug(\"poll timeout \" << timeout);\n\n      int p = ::poll(&fds, 1, timeout);\n\n      log_debug(\"poll returns \" << p << \" revents \" << fds.revents);\n\n      if (p < 0)\n      {\n        log_error(\"error in poll; errno=\" << errno);\n        throw cxxtools::SystemError(\"poll\");\n      }\n      else if (p == 0)\n      {\n        log_debug(\"poll timeout (\" << timeout << ')');\n        throw cxxtools::IOTimeout();\n      }\n    }",
          "includes": [
            "#include <errno.h>",
            "#include <typeinfo>",
            "#include <unistd.h>",
            "#include <sys/poll.h>",
            "#include <netinet/tcp.h>",
            "#include <netinet/in.h>",
            "#include <sys/socket.h>",
            "#include <cxxtools/net/tcpstream.h>",
            "#include <sys/sendfile.h>",
            "#include <fcntl.h>",
            "#include <limits>",
            "#include <config.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <cxxtools/convert.h>",
            "#include <cxxtools/ioerror.h>",
            "#include <cxxtools/systemerror.h>",
            "#include <cxxtools/log.h>",
            "#include <fstream>",
            "#include <tnt/tntconfig.h>",
            "#include <tnt/comploader.h>",
            "#include <tnt/httpheader.h>",
            "#include <tnt/http.h>",
            "#include <tnt/httperror.h>",
            "#include <tnt/httpreply.h>",
            "#include <tnt/httprequest.h>",
            "#include \"mimehandler.h\"",
            "#include \"static.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <errno.h>\n#include <typeinfo>\n#include <unistd.h>\n#include <sys/poll.h>\n#include <netinet/tcp.h>\n#include <netinet/in.h>\n#include <sys/socket.h>\n#include <cxxtools/net/tcpstream.h>\n#include <sys/sendfile.h>\n#include <fcntl.h>\n#include <limits>\n#include <config.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <cxxtools/convert.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/systemerror.h>\n#include <cxxtools/log.h>\n#include <fstream>\n#include <tnt/tntconfig.h>\n#include <tnt/comploader.h>\n#include <tnt/httpheader.h>\n#include <tnt/http.h>\n#include <tnt/httperror.h>\n#include <tnt/httpreply.h>\n#include <tnt/httprequest.h>\n#include \"mimehandler.h\"\n#include \"static.h\"\n\nvoid pollout(int fd, int timeout)\n    {\n      struct pollfd fds;\n      fds.fd = fd;\n      fds.events = POLLOUT;\n\n      log_debug(\"poll timeout \" << timeout);\n\n      int p = ::poll(&fds, 1, timeout);\n\n      log_debug(\"poll returns \" << p << \" revents \" << fds.revents);\n\n      if (p < 0)\n      {\n        log_error(\"error in poll; errno=\" << errno);\n        throw cxxtools::SystemError(\"poll\");\n      }\n      else if (p == 0)\n      {\n        log_debug(\"poll timeout (\" << timeout << ')');\n        throw cxxtools::IOTimeout();\n      }\n    }"
        }
      },
      {
        "call_info": {
          "callee": "tcpStream.getTimeout",
          "args": [],
          "line": 419
        },
        "resolved": true,
        "details": {
          "function_name": "getTimeout",
          "container": "Sessionscope",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/sessionscope.h",
          "lines": "51-51",
          "snippet": "unsigned getTimeout() const                { return timeout; }",
          "includes": [
            "#include <time.h>",
            "#include <tnt/tntconfig.h>",
            "#include <tnt/scope.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <time.h>\n#include <tnt/tntconfig.h>\n#include <tnt/scope.h>\n\nSessionscope {\n  unsigned getTimeout() const                { return timeout; }\n}"
        }
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"poll\""
          ],
          "line": 418
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "cxxtools::SystemError",
          "args": [
            "\"sendfile\""
          ],
          "line": 413
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"sendfile returns \" << s"
          ],
          "line": 409
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sendfile",
          "args": [
            "tcpStream.getFd()",
            "in.getFd()",
            "&offset",
            "count"
          ],
          "line": 408
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"sendfile offset \" << offset << \" size \" << count"
          ],
          "line": 407
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "file.c_str",
          "args": [],
          "line": 401
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tcpStream.flush",
          "args": [],
          "line": 399
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "reply.setDirectMode",
          "args": [
            "httpOkReturn",
            "HttpReturn::httpMessage(httpOkReturn)"
          ],
          "line": 398
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HttpReturn::httpMessage",
          "args": [
            "httpOkReturn"
          ],
          "line": 398
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "cxxtools::SystemError",
          "args": [
            "\"setsockopt(TCP_CORK)\""
          ],
          "line": 396
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "::setsockopt",
          "args": [
            "tcpStream.getFd()",
            "SOL_TCP",
            "TCP_CORK",
            "&on",
            "sizeof(on)"
          ],
          "line": 394
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "cxxtools::SystemError",
          "args": [
            "\"setsockopt(TCP_NODELAY)\""
          ],
          "line": 392
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "::setsockopt",
          "args": [
            "tcpStream.getFd()",
            "SOL_TCP",
            "TCP_NODELAY",
            "&off",
            "sizeof(off)"
          ],
          "line": 390
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dynamic_cast<cxxtools::net::iostream&>",
          "args": [
            "reply.getDirectStream()"
          ],
          "line": 388
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "reply.getDirectStream",
          "args": [],
          "line": 388
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_info",
          "args": [
            "\"send file \\\"\" << file << \"\\\" size \" << st.st_size << \" bytes; offset=\" << offset << \" count=\" << count"
          ],
          "line": 381
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"no head request\""
          ],
          "line": 377
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"head request\""
          ],
          "line": 372
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "request.isMethodHEAD",
          "args": [],
          "line": 370
        },
        "resolved": true,
        "details": {
          "function_name": "isMethodHEAD",
          "container": "HttpRequest",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/httprequest.h",
          "lines": "138-138",
          "snippet": "bool isMethodHEAD() const                 { return std::strcmp(method, \"HEAD\") == 0; }",
          "includes": [
            "#include <cstring>",
            "#include <string>",
            "#include <cxxtools/atomicity.h>",
            "#include <map>",
            "#include <locale>",
            "#include <tnt/threadcontext.h>",
            "#include <tnt/scope.h>",
            "#include <tnt/query_params.h>",
            "#include <tnt/encoding.h>",
            "#include <tnt/cookie.h>",
            "#include <tnt/multipart.h>",
            "#include <tnt/contenttype.h>",
            "#include <tnt/socketif.h>",
            "#include <tnt/httpheader.h>",
            "#include <tnt/httpmessage.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <cstring>\n#include <string>\n#include <cxxtools/atomicity.h>\n#include <map>\n#include <locale>\n#include <tnt/threadcontext.h>\n#include <tnt/scope.h>\n#include <tnt/query_params.h>\n#include <tnt/encoding.h>\n#include <tnt/cookie.h>\n#include <tnt/multipart.h>\n#include <tnt/contenttype.h>\n#include <tnt/socketif.h>\n#include <tnt/httpheader.h>\n#include <tnt/httpmessage.h>\n\nHttpRequest {\n  bool isMethodHEAD() const                 { return std::strcmp(method, \"HEAD\") == 0; }\n}"
        }
      },
      {
        "call_info": {
          "callee": "reply.setContentLengthHeader",
          "args": [
            "count"
          ],
          "line": 368
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"ignore invalid byte range \" << range"
          ],
          "line": 364
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "reply.setHeader",
          "args": [
            "httpheader::contentRange",
            "contentRange.str()"
          ],
          "line": 359
        },
        "resolved": true,
        "details": {
          "function_name": "setHeader",
          "container": "HttpMessage",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/httpmessage.h",
          "lines": "91-92",
          "snippet": "void setHeader(const std::string& key, const std::string& value, bool replace = true)\n        { header.setHeader(key, value, replace); }",
          "includes": [
            "#include <time.h>",
            "#include <tnt/cookie.h>",
            "#include <tnt/httpheader.h>",
            "#include <tnt/messageheader.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <time.h>\n#include <tnt/cookie.h>\n#include <tnt/httpheader.h>\n#include <tnt/messageheader.h>\n\nHttpMessage {\n  void setHeader(const std::string& key, const std::string& value, bool replace = true)\n          { header.setHeader(key, value, replace); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "contentRange.str",
          "args": [],
          "line": 359
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "request.getUrl",
          "args": [],
          "line": 356
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "parseRange",
          "args": [
            "range",
            "offset",
            "count"
          ],
          "line": 351
        },
        "resolved": true,
        "details": {
          "function_name": "parseRange",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/defcomp/static.cpp",
          "lines": "67-182",
          "snippet": "bool parseRange(const char* range, off_t& offset, off_t& count)\n    {\n      enum\n      {\n        state_0,\n        state_1,\n        state_from0,\n        state_from,\n        state_from_e,\n        state_to0,\n        state_to,\n        state_e\n      } state = state_0;\n\n      std::string token;\n\n      const char* prefix = \"bytes=\";\n      off_t firstPos = 0;\n      off_t lastPos = count;\n      for (const char* p = range; *p && state != state_e; ++p)\n      {\n        char ch = *p;\n        switch (state)\n        {\n          case state_0:\n          case state_1:\n            if (ch == *prefix)\n            {\n              ++prefix;\n              if (*prefix == '\\0')\n              {\n                log_debug(\"prefix ends\");\n                state = state_from0;\n              }\n              else\n                state = state_1;\n            }\n            else if (state == state_1 || ch != ' ')\n              return false;\n            break;\n\n          case state_from0:\n            if (std::isdigit(ch))\n            {\n              log_debug(\"from found\");\n              firstPos = ch - '0';\n              state = state_from;\n            }\n            else if (ch == '-')\n              state = state_to0;\n            else if (ch != ' ')\n              return false;\n            break;\n\n          case state_from:\n            if (std::isdigit(ch))\n              firstPos = firstPos * 10 + ch - '0';\n            else if (ch == '-')\n              state = state_to0;\n            else if (ch == ' ')\n              state = state_from_e;\n            else\n              return false;\n            break;\n\n          case state_from_e:\n            if (ch == '-')\n              state = state_to0;\n            else if (ch != ' ')\n              return false;\n            break;\n\n          case state_to0:\n            if (std::isdigit(ch))\n            {\n              lastPos = ch - '0';\n              state = state_to;\n            }\n            else if (ch != ' ')\n              return false;\n            break;\n\n          case state_to:\n            if (std::isdigit(ch))\n              lastPos = lastPos * 10 + ch - '0';\n            else if (ch == ' ')\n              state = state_e;\n            else\n              return false;\n            break;\n\n          case state_e:\n            break;\n        }\n      }\n\n      switch (state)\n      {\n        case state_to0:\n        case state_to:\n        case state_e:\n          if (lastPos > firstPos)\n          {\n            offset = firstPos;\n            count = lastPos - firstPos;\n            log_debug(\"firstPos=\" << firstPos << \" lastPos=\" << lastPos << \" offset=\" << offset << \" count=\" << count);\n            return true;\n          }\n          break;\n\n        default:\n          break;\n      }\n\n      return false;\n    }",
          "includes": [
            "#include <errno.h>",
            "#include <typeinfo>",
            "#include <unistd.h>",
            "#include <sys/poll.h>",
            "#include <netinet/tcp.h>",
            "#include <netinet/in.h>",
            "#include <sys/socket.h>",
            "#include <cxxtools/net/tcpstream.h>",
            "#include <sys/sendfile.h>",
            "#include <fcntl.h>",
            "#include <limits>",
            "#include <config.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <cxxtools/convert.h>",
            "#include <cxxtools/ioerror.h>",
            "#include <cxxtools/systemerror.h>",
            "#include <cxxtools/log.h>",
            "#include <fstream>",
            "#include <tnt/tntconfig.h>",
            "#include <tnt/comploader.h>",
            "#include <tnt/httpheader.h>",
            "#include <tnt/http.h>",
            "#include <tnt/httperror.h>",
            "#include <tnt/httpreply.h>",
            "#include <tnt/httprequest.h>",
            "#include \"mimehandler.h\"",
            "#include \"static.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <errno.h>\n#include <typeinfo>\n#include <unistd.h>\n#include <sys/poll.h>\n#include <netinet/tcp.h>\n#include <netinet/in.h>\n#include <sys/socket.h>\n#include <cxxtools/net/tcpstream.h>\n#include <sys/sendfile.h>\n#include <fcntl.h>\n#include <limits>\n#include <config.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <cxxtools/convert.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/systemerror.h>\n#include <cxxtools/log.h>\n#include <fstream>\n#include <tnt/tntconfig.h>\n#include <tnt/comploader.h>\n#include <tnt/httpheader.h>\n#include <tnt/http.h>\n#include <tnt/httperror.h>\n#include <tnt/httpreply.h>\n#include <tnt/httprequest.h>\n#include \"mimehandler.h\"\n#include \"static.h\"\n\nbool parseRange(const char* range, off_t& offset, off_t& count)\n    {\n      enum\n      {\n        state_0,\n        state_1,\n        state_from0,\n        state_from,\n        state_from_e,\n        state_to0,\n        state_to,\n        state_e\n      } state = state_0;\n\n      std::string token;\n\n      const char* prefix = \"bytes=\";\n      off_t firstPos = 0;\n      off_t lastPos = count;\n      for (const char* p = range; *p && state != state_e; ++p)\n      {\n        char ch = *p;\n        switch (state)\n        {\n          case state_0:\n          case state_1:\n            if (ch == *prefix)\n            {\n              ++prefix;\n              if (*prefix == '\\0')\n              {\n                log_debug(\"prefix ends\");\n                state = state_from0;\n              }\n              else\n                state = state_1;\n            }\n            else if (state == state_1 || ch != ' ')\n              return false;\n            break;\n\n          case state_from0:\n            if (std::isdigit(ch))\n            {\n              log_debug(\"from found\");\n              firstPos = ch - '0';\n              state = state_from;\n            }\n            else if (ch == '-')\n              state = state_to0;\n            else if (ch != ' ')\n              return false;\n            break;\n\n          case state_from:\n            if (std::isdigit(ch))\n              firstPos = firstPos * 10 + ch - '0';\n            else if (ch == '-')\n              state = state_to0;\n            else if (ch == ' ')\n              state = state_from_e;\n            else\n              return false;\n            break;\n\n          case state_from_e:\n            if (ch == '-')\n              state = state_to0;\n            else if (ch != ' ')\n              return false;\n            break;\n\n          case state_to0:\n            if (std::isdigit(ch))\n            {\n              lastPos = ch - '0';\n              state = state_to;\n            }\n            else if (ch != ' ')\n              return false;\n            break;\n\n          case state_to:\n            if (std::isdigit(ch))\n              lastPos = lastPos * 10 + ch - '0';\n            else if (ch == ' ')\n              state = state_e;\n            else\n              return false;\n            break;\n\n          case state_e:\n            break;\n        }\n      }\n\n      switch (state)\n      {\n        case state_to0:\n        case state_to:\n        case state_e:\n          if (lastPos > firstPos)\n          {\n            offset = firstPos;\n            count = lastPos - firstPos;\n            log_debug(\"firstPos=\" << firstPos << \" lastPos=\" << lastPos << \" offset=\" << offset << \" count=\" << count);\n            return true;\n          }\n          break;\n\n        default:\n          break;\n      }\n\n      return false;\n    }"
        }
      },
      {
        "call_info": {
          "callee": "request.getHeader",
          "args": [
            "httpheader::range",
            "0"
          ],
          "line": 348
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "reply.setMaxAgeHeader",
          "args": [
            "maxAge"
          ],
          "line": 345
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "cxxtools::convert<unsigned>",
          "args": [
            "maxAgeStr"
          ],
          "line": 344
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "maxAgeStr.empty",
          "args": [],
          "line": 344
        },
        "resolved": true,
        "details": {
          "function_name": "empty",
          "container": "Pstr",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/httpmessage.cpp",
          "lines": "156-156",
          "snippet": "bool empty() const      { return start == end; }",
          "includes": [
            "#include <stdio.h>",
            "#include <sstream>",
            "#include <list>",
            "#include <cxxtools/mutex.h>",
            "#include <cxxtools/log.h>",
            "#include <tnt/httpmessage.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <stdio.h>\n#include <sstream>\n#include <list>\n#include <cxxtools/mutex.h>\n#include <cxxtools/log.h>\n#include <tnt/httpmessage.h>\n\nPstr {\n  bool empty() const      { return start == end; }\n}"
        }
      },
      {
        "call_info": {
          "callee": "request.getArg",
          "args": [
            "\"maxAge\""
          ],
          "line": 343
        },
        "resolved": true,
        "details": {
          "function_name": "getArg",
          "container": "HttpRequest",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/httprequest.h",
          "lines": "163-163",
          "snippet": "std::string getArg(args_type::size_type n) const { return getArgDef(n); }",
          "includes": [
            "#include <cstring>",
            "#include <string>",
            "#include <cxxtools/atomicity.h>",
            "#include <map>",
            "#include <locale>",
            "#include <tnt/threadcontext.h>",
            "#include <tnt/scope.h>",
            "#include <tnt/query_params.h>",
            "#include <tnt/encoding.h>",
            "#include <tnt/cookie.h>",
            "#include <tnt/multipart.h>",
            "#include <tnt/contenttype.h>",
            "#include <tnt/socketif.h>",
            "#include <tnt/httpheader.h>",
            "#include <tnt/httpmessage.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <cstring>\n#include <string>\n#include <cxxtools/atomicity.h>\n#include <map>\n#include <locale>\n#include <tnt/threadcontext.h>\n#include <tnt/scope.h>\n#include <tnt/query_params.h>\n#include <tnt/encoding.h>\n#include <tnt/cookie.h>\n#include <tnt/multipart.h>\n#include <tnt/contenttype.h>\n#include <tnt/socketif.h>\n#include <tnt/httpheader.h>\n#include <tnt/httpmessage.h>\n\nHttpRequest {\n  std::string getArg(args_type::size_type n) const { return getArgDef(n); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "reply.setKeepAliveHeader",
          "args": [],
          "line": 340
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "request.getHeader",
          "args": [
            "httpheader::ifModifiedSince"
          ],
          "line": 334
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HttpMessage::htdate",
          "args": [
            "st.st_ctime"
          ],
          "line": 331
        },
        "resolved": true,
        "details": {
          "function_name": "HttpMessage::htdate",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/httpmessage.cpp",
          "lines": "76-87",
          "snippet": "std::string HttpMessage::htdate(struct ::tm* tm)\n  {\n    static const char* wday[] = {\"Sun\", \"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\"};\n    static const char* monthn[] = {\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"Jun\",\n                            \"Jul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\"};\n    char buffer[80];\n\n    sprintf(buffer, \"%s, %02d %s %d %02d:%02d:%02d GMT\",\n      wday[tm->tm_wday], tm->tm_mday, monthn[tm->tm_mon], tm->tm_year + 1900,\n      tm->tm_hour, tm->tm_min, tm->tm_sec);\n    return buffer;\n  }",
          "includes": [
            "#include <stdio.h>",
            "#include <sstream>",
            "#include <list>",
            "#include <cxxtools/mutex.h>",
            "#include <cxxtools/log.h>",
            "#include <tnt/httpmessage.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <stdio.h>\n#include <sstream>\n#include <list>\n#include <cxxtools/mutex.h>\n#include <cxxtools/log.h>\n#include <tnt/httpmessage.h>\n\nstd::string HttpMessage::htdate(struct ::tm* tm)\n  {\n    static const char* wday[] = {\"Sun\", \"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\"};\n    static const char* monthn[] = {\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"Jun\",\n                            \"Jul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\"};\n    char buffer[80];\n\n    sprintf(buffer, \"%s, %02d %s %d %02d:%02d:%02d GMT\",\n      wday[tm->tm_wday], tm->tm_mday, monthn[tm->tm_mon], tm->tm_year + 1900,\n      tm->tm_hour, tm->tm_min, tm->tm_sec);\n    return buffer;\n  }"
        }
      },
      {
        "call_info": {
          "callee": "setContentType",
          "args": [
            "request",
            "reply"
          ],
          "line": 329
        },
        "resolved": true,
        "details": {
          "function_name": "Static::setContentType",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/defcomp/static.cpp",
          "lines": "248-252",
          "snippet": "void Static::setContentType(HttpRequest& request, HttpReply& reply)\n  {\n    if (handler)\n      reply.setContentType(handler->getMimeType(request.getPathInfo()).c_str());\n  }",
          "includes": [
            "#include <errno.h>",
            "#include <typeinfo>",
            "#include <unistd.h>",
            "#include <sys/poll.h>",
            "#include <netinet/tcp.h>",
            "#include <netinet/in.h>",
            "#include <sys/socket.h>",
            "#include <cxxtools/net/tcpstream.h>",
            "#include <sys/sendfile.h>",
            "#include <fcntl.h>",
            "#include <limits>",
            "#include <config.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <cxxtools/convert.h>",
            "#include <cxxtools/ioerror.h>",
            "#include <cxxtools/systemerror.h>",
            "#include <cxxtools/log.h>",
            "#include <fstream>",
            "#include <tnt/tntconfig.h>",
            "#include <tnt/comploader.h>",
            "#include <tnt/httpheader.h>",
            "#include <tnt/http.h>",
            "#include <tnt/httperror.h>",
            "#include <tnt/httpreply.h>",
            "#include <tnt/httprequest.h>",
            "#include \"mimehandler.h\"",
            "#include \"static.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <errno.h>\n#include <typeinfo>\n#include <unistd.h>\n#include <sys/poll.h>\n#include <netinet/tcp.h>\n#include <netinet/in.h>\n#include <sys/socket.h>\n#include <cxxtools/net/tcpstream.h>\n#include <sys/sendfile.h>\n#include <fcntl.h>\n#include <limits>\n#include <config.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <cxxtools/convert.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/systemerror.h>\n#include <cxxtools/log.h>\n#include <fstream>\n#include <tnt/tntconfig.h>\n#include <tnt/comploader.h>\n#include <tnt/httpheader.h>\n#include <tnt/http.h>\n#include <tnt/httperror.h>\n#include <tnt/httpreply.h>\n#include <tnt/httprequest.h>\n#include \"mimehandler.h\"\n#include \"static.h\"\n\nvoid Static::setContentType(HttpRequest& request, HttpReply& reply)\n  {\n    if (handler)\n      reply.setContentType(handler->getMimeType(request.getPathInfo()).c_str());\n  }"
        }
      },
      {
        "call_info": {
          "callee": "reply.setContentType",
          "args": [
            "contentType.c_str()"
          ],
          "line": 326
        },
        "resolved": true,
        "details": {
          "function_name": "setContentType",
          "container": "HttpReply",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/httpreply.h",
          "lines": "61-61",
          "snippet": "void setContentType(const std::string& t)     { setHeader(httpheader::contentType, t); }",
          "includes": [
            "#include <iosfwd>",
            "#include <tnt/http.h>",
            "#include <tnt/httpmessage.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <iosfwd>\n#include <tnt/http.h>\n#include <tnt/httpmessage.h>\n\nHttpReply {\n  void setContentType(const std::string& t)     { setHeader(httpheader::contentType, t); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "contentType.c_str",
          "args": [],
          "line": 326
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"content type is \\\"\" << contentType << '\"'"
          ],
          "line": 325
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"no regular file \\\"\" << file << \"\\\"\""
          ],
          "line": 310
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "S_ISREG",
          "args": [
            "st.st_mode"
          ],
          "line": 308
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"can't stat file \\\"\" << file << \"\\\"\""
          ],
          "line": 304
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "stat",
          "args": [
            "file.c_str()",
            "&st"
          ],
          "line": 302
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "file.c_str",
          "args": [],
          "line": 302
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"compressed file \\\"\" << gzfile << \"\\\" not found or not a regular file\""
          ],
          "line": 296
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"enable compression\""
          ],
          "line": 289
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "S_ISREG",
          "args": [
            "st.st_mode"
          ],
          "line": 287
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "stat",
          "args": [
            "gzfile.c_str()",
            "&st"
          ],
          "line": 287
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gzfile.c_str",
          "args": [],
          "line": 287
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TntConfig::it",
          "args": [],
          "line": 284
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "request.getEncoding",
          "args": [
            "\"gzip\""
          ],
          "line": 284
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "request.getEncoding",
          "args": [],
          "line": 284
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"file: \" << file"
          ],
          "line": 279
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "request.getPathInfo",
          "args": [],
          "line": 277
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "file.rbegin",
          "args": [],
          "line": 274
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"document root =\\\"\" << file << '\"'"
          ],
          "line": 272
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "request.getArg",
          "args": [
            "\"documentRoot\"",
            "TntConfig::it().documentRoot"
          ],
          "line": 271
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TntConfig::it",
          "args": [],
          "line": 271
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <errno.h>\n#include <typeinfo>\n#include <unistd.h>\n#include <sys/poll.h>\n#include <netinet/tcp.h>\n#include <netinet/in.h>\n#include <sys/socket.h>\n#include <cxxtools/net/tcpstream.h>\n#include <sys/sendfile.h>\n#include <fcntl.h>\n#include <limits>\n#include <config.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <cxxtools/convert.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/systemerror.h>\n#include <cxxtools/log.h>\n#include <fstream>\n#include <tnt/tntconfig.h>\n#include <tnt/comploader.h>\n#include <tnt/httpheader.h>\n#include <tnt/http.h>\n#include <tnt/httperror.h>\n#include <tnt/httpreply.h>\n#include <tnt/httprequest.h>\n#include \"mimehandler.h\"\n#include \"static.h\"\n\nunsigned Static::doCall(HttpRequest& request,\n    HttpReply& reply, QueryParams& qparams, bool top)\n  {\n    // fetch document root from arguments or take global setting as default\n\n    std::string file = request.getArg(\"documentRoot\", TntConfig::it().documentRoot);\n    log_debug(\"document root =\\\"\" << file << '\"');\n\n    if (!file.empty() && *file.rbegin() != '/')\n      file += '/';\n\n    file += request.getPathInfo();\n\n    log_debug(\"file: \" << file);\n\n    struct stat st;\n\n    bool localEnableGzip = false;\n    if (request.getEncoding().accept(\"gzip\") && TntConfig::it().enableCompression)\n    {\n      std::string gzfile = file + \".gz\";\n      if (stat(gzfile.c_str(), &st) == 0 && S_ISREG(st.st_mode))\n      {\n        log_debug(\"enable compression\");\n        file = gzfile;\n        localEnableGzip = true;\n        reply.setHeader(httpheader::contentEncoding, \"gzip\");\n      }\n      else\n      {\n        log_debug(\"compressed file \\\"\" << gzfile << \"\\\" not found or not a regular file\");\n      }\n    }\n\n    if (!localEnableGzip)\n    {\n      if (stat(file.c_str(), &st) != 0)\n      {\n        log_debug(\"can't stat file \\\"\" << file << \"\\\"\");\n        return DECLINED;\n      }\n\n      if (!S_ISREG(st.st_mode))\n      {\n        log_debug(\"no regular file \\\"\" << file << \"\\\"\");\n        return DECLINED;\n      }\n    }\n\n    off_t offset = 0;\n    off_t count = st.st_size;\n    unsigned httpOkReturn = HTTP_OK;\n\n    if (top)\n    {\n      // set Content-Type\n      std::string contentType = request.getArg(\"contentType\");\n      if (!contentType.empty())\n      {\n        log_debug(\"content type is \\\"\" << contentType << '\"');\n        reply.setContentType(contentType.c_str());\n      }\n      else\n        setContentType(request, reply);\n\n      std::string lastModified = HttpMessage::htdate(st.st_ctime);\n\n      {\n        std::string s = request.getHeader(httpheader::ifModifiedSince);\n        if (s == lastModified)\n          return HTTP_NOT_MODIFIED;\n      }\n\n      reply.setHeader(httpheader::lastModified, lastModified);\n      reply.setKeepAliveHeader();\n      reply.setHeader(httpheader::acceptRanges, \"bytes\");\n\n      std::string maxAgeStr = request.getArg(\"maxAge\");\n      unsigned maxAge = maxAgeStr.empty() ? 14400 : cxxtools::convert<unsigned>(maxAgeStr);\n      reply.setMaxAgeHeader(maxAge);\n\n      // check for byte range (only \"bytes=from-\" or \"bytes=from-to\" are supported)\n      const char* range = request.getHeader(httpheader::range, 0);\n      if (range)\n      {\n        if (parseRange(range, offset, count))\n        {\n          if (offset > st.st_size)\n            return HTTP_RANGE_NOT_SATISFIABLE;\n\n          reply.setHeader(httpheader::contentLocation, request.getUrl());\n          std::ostringstream contentRange;\n          contentRange << offset << '-' << (offset+count)-1 << '/' << st.st_size;\n          reply.setHeader(httpheader::contentRange, contentRange.str());\n\n          httpOkReturn = HTTP_PARTIAL_CONTENT;\n        }\n        else\n          log_debug(\"ignore invalid byte range \" << range);\n      }\n\n      // set Content-Length\n      reply.setContentLengthHeader(count);\n\n      if (request.isMethodHEAD())\n      {\n        log_debug(\"head request\");\n        return httpOkReturn;\n      }\n      else\n      {\n        log_debug(\"no head request\");\n      }\n\n      // send data\n      log_info(\"send file \\\"\" << file << \"\\\" size \" << st.st_size << \" bytes; offset=\" << offset << \" count=\" << count);\n\n#if defined(HAVE_SENDFILE) && defined(HAVE_SYS_SENDFILE_H)\n      int on = 1;\n      int off = 0;\n      try\n      {\n        cxxtools::net::iostream& tcpStream = dynamic_cast<cxxtools::net::iostream&>(reply.getDirectStream());\n\n        if (::setsockopt(tcpStream.getFd(), SOL_TCP, TCP_NODELAY,\n            &off, sizeof(off)) < 0)\n          throw cxxtools::SystemError(\"setsockopt(TCP_NODELAY)\");\n\n        if (::setsockopt(tcpStream.getFd(), SOL_TCP, TCP_CORK,\n            &on, sizeof(on)) < 0)\n          throw cxxtools::SystemError(\"setsockopt(TCP_CORK)\");\n\n        reply.setDirectMode(httpOkReturn, HttpReturn::httpMessage(httpOkReturn));\n        tcpStream.flush();\n\n        Fdfile in(file.c_str(), O_RDONLY);\n        ssize_t s;\n        while(tcpStream)\n        {\n          do\n          {\n            log_debug(\"sendfile offset \" << offset << \" size \" << count);\n            s = sendfile(tcpStream.getFd(), in.getFd(), &offset, count);\n            log_debug(\"sendfile returns \" << s);\n          } while (s < 0 && errno == EINTR);\n\n          if (s < 0 && errno != EAGAIN)\n            throw cxxtools::SystemError(\"sendfile\");\n\n          if (offset >= count)\n            break;\n\n          log_debug(\"poll\");\n          pollout(tcpStream.getFd(), tcpStream.getTimeout());\n        }\n\n        if (::setsockopt(tcpStream.getFd(), SOL_TCP, TCP_CORK,\n            &off, sizeof(off)) < 0)\n          throw cxxtools::SystemError(\"setsockopt(TCP_CORK)\");\n\n        if (::setsockopt(tcpStream.getFd(), SOL_TCP, TCP_NODELAY,\n            &on, sizeof(on)) < 0)\n          throw cxxtools::SystemError(\"setsockopt(TCP_NODELAY)\");\n\n        return httpOkReturn;\n      }\n      catch (const std::bad_cast& e)\n      {\n        log_debug(\"stream is no tcpstream - don't use sendfile\");\n        reply.setDirectMode();\n      }\n#else\n      reply.setDirectMode();\n#endif\n    }\n\n    std::ifstream in(file.c_str());\n    in.seekg(offset);\n    if (!in)\n    {\n      log_debug(\"can't open file \\\"\" << file << '\"');\n      return DECLINED;\n    }\n\n    if (offset == 0 && count == st.st_size)\n    {\n      reply.out() << in.rdbuf() << std::flush;\n      if (in.fail())\n        throw std::runtime_error(\"failed to send file \\\"\" + file + '\"');\n    }\n    else\n    {\n      char ch;\n      off_t o;\n      for (o = 0; in.get(ch) && o < count; ++o)\n        reply.out().put(ch);\n      if (o < count)\n        throw std::runtime_error(\"failed to send file \\\"\" + file + '\"');\n    }\n\n    return httpOkReturn;\n  }"
  },
  {
    "function_name": "Static::topCall",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/defcomp/static.cpp",
    "lines": "260-264",
    "snippet": "unsigned Static::topCall(HttpRequest& request,\n    HttpReply& reply, QueryParams& qparams)\n  {\n    return doCall(request, reply, qparams, true);\n  }",
    "includes": [
      "#include <errno.h>",
      "#include <typeinfo>",
      "#include <unistd.h>",
      "#include <sys/poll.h>",
      "#include <netinet/tcp.h>",
      "#include <netinet/in.h>",
      "#include <sys/socket.h>",
      "#include <cxxtools/net/tcpstream.h>",
      "#include <sys/sendfile.h>",
      "#include <fcntl.h>",
      "#include <limits>",
      "#include <config.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <cxxtools/convert.h>",
      "#include <cxxtools/ioerror.h>",
      "#include <cxxtools/systemerror.h>",
      "#include <cxxtools/log.h>",
      "#include <fstream>",
      "#include <tnt/tntconfig.h>",
      "#include <tnt/comploader.h>",
      "#include <tnt/httpheader.h>",
      "#include <tnt/http.h>",
      "#include <tnt/httperror.h>",
      "#include <tnt/httpreply.h>",
      "#include <tnt/httprequest.h>",
      "#include \"mimehandler.h\"",
      "#include \"static.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "doCall",
          "args": [
            "request",
            "reply",
            "qparams",
            "true"
          ],
          "line": 263
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <errno.h>\n#include <typeinfo>\n#include <unistd.h>\n#include <sys/poll.h>\n#include <netinet/tcp.h>\n#include <netinet/in.h>\n#include <sys/socket.h>\n#include <cxxtools/net/tcpstream.h>\n#include <sys/sendfile.h>\n#include <fcntl.h>\n#include <limits>\n#include <config.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <cxxtools/convert.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/systemerror.h>\n#include <cxxtools/log.h>\n#include <fstream>\n#include <tnt/tntconfig.h>\n#include <tnt/comploader.h>\n#include <tnt/httpheader.h>\n#include <tnt/http.h>\n#include <tnt/httperror.h>\n#include <tnt/httpreply.h>\n#include <tnt/httprequest.h>\n#include \"mimehandler.h\"\n#include \"static.h\"\n\nunsigned Static::topCall(HttpRequest& request,\n    HttpReply& reply, QueryParams& qparams)\n  {\n    return doCall(request, reply, qparams, true);\n  }"
  },
  {
    "function_name": "Static::operator()",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/defcomp/static.cpp",
    "lines": "254-258",
    "snippet": "unsigned Static::operator() (HttpRequest& request,\n    HttpReply& reply, QueryParams& qparams)\n  {\n    return doCall(request, reply, qparams, false);\n  }",
    "includes": [
      "#include <errno.h>",
      "#include <typeinfo>",
      "#include <unistd.h>",
      "#include <sys/poll.h>",
      "#include <netinet/tcp.h>",
      "#include <netinet/in.h>",
      "#include <sys/socket.h>",
      "#include <cxxtools/net/tcpstream.h>",
      "#include <sys/sendfile.h>",
      "#include <fcntl.h>",
      "#include <limits>",
      "#include <config.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <cxxtools/convert.h>",
      "#include <cxxtools/ioerror.h>",
      "#include <cxxtools/systemerror.h>",
      "#include <cxxtools/log.h>",
      "#include <fstream>",
      "#include <tnt/tntconfig.h>",
      "#include <tnt/comploader.h>",
      "#include <tnt/httpheader.h>",
      "#include <tnt/http.h>",
      "#include <tnt/httperror.h>",
      "#include <tnt/httpreply.h>",
      "#include <tnt/httprequest.h>",
      "#include \"mimehandler.h\"",
      "#include \"static.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "doCall",
          "args": [
            "request",
            "reply",
            "qparams",
            "false"
          ],
          "line": 257
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <errno.h>\n#include <typeinfo>\n#include <unistd.h>\n#include <sys/poll.h>\n#include <netinet/tcp.h>\n#include <netinet/in.h>\n#include <sys/socket.h>\n#include <cxxtools/net/tcpstream.h>\n#include <sys/sendfile.h>\n#include <fcntl.h>\n#include <limits>\n#include <config.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <cxxtools/convert.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/systemerror.h>\n#include <cxxtools/log.h>\n#include <fstream>\n#include <tnt/tntconfig.h>\n#include <tnt/comploader.h>\n#include <tnt/httpheader.h>\n#include <tnt/http.h>\n#include <tnt/httperror.h>\n#include <tnt/httpreply.h>\n#include <tnt/httprequest.h>\n#include \"mimehandler.h\"\n#include \"static.h\"\n\nunsigned Static::operator() (HttpRequest& request,\n    HttpReply& reply, QueryParams& qparams)\n  {\n    return doCall(request, reply, qparams, false);\n  }"
  },
  {
    "function_name": "Static::setContentType",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/defcomp/static.cpp",
    "lines": "248-252",
    "snippet": "void Static::setContentType(HttpRequest& request, HttpReply& reply)\n  {\n    if (handler)\n      reply.setContentType(handler->getMimeType(request.getPathInfo()).c_str());\n  }",
    "includes": [
      "#include <errno.h>",
      "#include <typeinfo>",
      "#include <unistd.h>",
      "#include <sys/poll.h>",
      "#include <netinet/tcp.h>",
      "#include <netinet/in.h>",
      "#include <sys/socket.h>",
      "#include <cxxtools/net/tcpstream.h>",
      "#include <sys/sendfile.h>",
      "#include <fcntl.h>",
      "#include <limits>",
      "#include <config.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <cxxtools/convert.h>",
      "#include <cxxtools/ioerror.h>",
      "#include <cxxtools/systemerror.h>",
      "#include <cxxtools/log.h>",
      "#include <fstream>",
      "#include <tnt/tntconfig.h>",
      "#include <tnt/comploader.h>",
      "#include <tnt/httpheader.h>",
      "#include <tnt/http.h>",
      "#include <tnt/httperror.h>",
      "#include <tnt/httpreply.h>",
      "#include <tnt/httprequest.h>",
      "#include \"mimehandler.h\"",
      "#include \"static.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "reply.setContentType",
          "args": [
            "handler->getMimeType(request.getPathInfo()).c_str()"
          ],
          "line": 251
        },
        "resolved": true,
        "details": {
          "function_name": "setContentType",
          "container": "HttpReply",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/httpreply.h",
          "lines": "61-61",
          "snippet": "void setContentType(const std::string& t)     { setHeader(httpheader::contentType, t); }",
          "includes": [
            "#include <iosfwd>",
            "#include <tnt/http.h>",
            "#include <tnt/httpmessage.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <iosfwd>\n#include <tnt/http.h>\n#include <tnt/httpmessage.h>\n\nHttpReply {\n  void setContentType(const std::string& t)     { setHeader(httpheader::contentType, t); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "handler->getMimeType",
          "args": [],
          "line": 251
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "handler->getMimeType",
          "args": [
            "request.getPathInfo()"
          ],
          "line": 251
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "request.getPathInfo",
          "args": [],
          "line": 251
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <errno.h>\n#include <typeinfo>\n#include <unistd.h>\n#include <sys/poll.h>\n#include <netinet/tcp.h>\n#include <netinet/in.h>\n#include <sys/socket.h>\n#include <cxxtools/net/tcpstream.h>\n#include <sys/sendfile.h>\n#include <fcntl.h>\n#include <limits>\n#include <config.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <cxxtools/convert.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/systemerror.h>\n#include <cxxtools/log.h>\n#include <fstream>\n#include <tnt/tntconfig.h>\n#include <tnt/comploader.h>\n#include <tnt/httpheader.h>\n#include <tnt/http.h>\n#include <tnt/httperror.h>\n#include <tnt/httpreply.h>\n#include <tnt/httprequest.h>\n#include \"mimehandler.h\"\n#include \"static.h\"\n\nvoid Static::setContentType(HttpRequest& request, HttpReply& reply)\n  {\n    if (handler)\n      reply.setContentType(handler->getMimeType(request.getPathInfo()).c_str());\n  }"
  },
  {
    "function_name": "Static::configure",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/defcomp/static.cpp",
    "lines": "237-241",
    "snippet": "void Static::configure(const TntConfig& config)\n  {\n    if (handler == 0)\n      handler = new MimeHandler();\n  }",
    "includes": [
      "#include <errno.h>",
      "#include <typeinfo>",
      "#include <unistd.h>",
      "#include <sys/poll.h>",
      "#include <netinet/tcp.h>",
      "#include <netinet/in.h>",
      "#include <sys/socket.h>",
      "#include <cxxtools/net/tcpstream.h>",
      "#include <sys/sendfile.h>",
      "#include <fcntl.h>",
      "#include <limits>",
      "#include <config.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <cxxtools/convert.h>",
      "#include <cxxtools/ioerror.h>",
      "#include <cxxtools/systemerror.h>",
      "#include <cxxtools/log.h>",
      "#include <fstream>",
      "#include <tnt/tntconfig.h>",
      "#include <tnt/comploader.h>",
      "#include <tnt/httpheader.h>",
      "#include <tnt/http.h>",
      "#include <tnt/httperror.h>",
      "#include <tnt/httpreply.h>",
      "#include <tnt/httprequest.h>",
      "#include \"mimehandler.h\"",
      "#include \"static.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include <errno.h>\n#include <typeinfo>\n#include <unistd.h>\n#include <sys/poll.h>\n#include <netinet/tcp.h>\n#include <netinet/in.h>\n#include <sys/socket.h>\n#include <cxxtools/net/tcpstream.h>\n#include <sys/sendfile.h>\n#include <fcntl.h>\n#include <limits>\n#include <config.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <cxxtools/convert.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/systemerror.h>\n#include <cxxtools/log.h>\n#include <fstream>\n#include <tnt/tntconfig.h>\n#include <tnt/comploader.h>\n#include <tnt/httpheader.h>\n#include <tnt/http.h>\n#include <tnt/httperror.h>\n#include <tnt/httpreply.h>\n#include <tnt/httprequest.h>\n#include \"mimehandler.h\"\n#include \"static.h\"\n\nvoid Static::configure(const TntConfig& config)\n  {\n    if (handler == 0)\n      handler = new MimeHandler();\n  }"
  },
  {
    "function_name": "Static::~Static",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/defcomp/static.cpp",
    "lines": "232-235",
    "snippet": "Static::~Static()\n  {\n    delete handler;\n  }",
    "includes": [
      "#include <errno.h>",
      "#include <typeinfo>",
      "#include <unistd.h>",
      "#include <sys/poll.h>",
      "#include <netinet/tcp.h>",
      "#include <netinet/in.h>",
      "#include <sys/socket.h>",
      "#include <cxxtools/net/tcpstream.h>",
      "#include <sys/sendfile.h>",
      "#include <fcntl.h>",
      "#include <limits>",
      "#include <config.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <cxxtools/convert.h>",
      "#include <cxxtools/ioerror.h>",
      "#include <cxxtools/systemerror.h>",
      "#include <cxxtools/log.h>",
      "#include <fstream>",
      "#include <tnt/tntconfig.h>",
      "#include <tnt/comploader.h>",
      "#include <tnt/httpheader.h>",
      "#include <tnt/http.h>",
      "#include <tnt/httperror.h>",
      "#include <tnt/httpreply.h>",
      "#include <tnt/httprequest.h>",
      "#include \"mimehandler.h\"",
      "#include \"static.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include <errno.h>\n#include <typeinfo>\n#include <unistd.h>\n#include <sys/poll.h>\n#include <netinet/tcp.h>\n#include <netinet/in.h>\n#include <sys/socket.h>\n#include <cxxtools/net/tcpstream.h>\n#include <sys/sendfile.h>\n#include <fcntl.h>\n#include <limits>\n#include <config.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <cxxtools/convert.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/systemerror.h>\n#include <cxxtools/log.h>\n#include <fstream>\n#include <tnt/tntconfig.h>\n#include <tnt/comploader.h>\n#include <tnt/httpheader.h>\n#include <tnt/http.h>\n#include <tnt/httperror.h>\n#include <tnt/httpreply.h>\n#include <tnt/httprequest.h>\n#include \"mimehandler.h\"\n#include \"static.h\"\n\nStatic::~Static()\n  {\n    delete handler;\n  }"
  },
  {
    "function_name": "pollout",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/defcomp/static.cpp",
    "lines": "205-227",
    "snippet": "void pollout(int fd, int timeout)\n    {\n      struct pollfd fds;\n      fds.fd = fd;\n      fds.events = POLLOUT;\n\n      log_debug(\"poll timeout \" << timeout);\n\n      int p = ::poll(&fds, 1, timeout);\n\n      log_debug(\"poll returns \" << p << \" revents \" << fds.revents);\n\n      if (p < 0)\n      {\n        log_error(\"error in poll; errno=\" << errno);\n        throw cxxtools::SystemError(\"poll\");\n      }\n      else if (p == 0)\n      {\n        log_debug(\"poll timeout (\" << timeout << ')');\n        throw cxxtools::IOTimeout();\n      }\n    }",
    "includes": [
      "#include <errno.h>",
      "#include <typeinfo>",
      "#include <unistd.h>",
      "#include <sys/poll.h>",
      "#include <netinet/tcp.h>",
      "#include <netinet/in.h>",
      "#include <sys/socket.h>",
      "#include <cxxtools/net/tcpstream.h>",
      "#include <sys/sendfile.h>",
      "#include <fcntl.h>",
      "#include <limits>",
      "#include <config.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <cxxtools/convert.h>",
      "#include <cxxtools/ioerror.h>",
      "#include <cxxtools/systemerror.h>",
      "#include <cxxtools/log.h>",
      "#include <fstream>",
      "#include <tnt/tntconfig.h>",
      "#include <tnt/comploader.h>",
      "#include <tnt/httpheader.h>",
      "#include <tnt/http.h>",
      "#include <tnt/httperror.h>",
      "#include <tnt/httpreply.h>",
      "#include <tnt/httprequest.h>",
      "#include \"mimehandler.h\"",
      "#include \"static.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "cxxtools::IOTimeout",
          "args": [],
          "line": 225
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"poll timeout (\" << timeout << ')'"
          ],
          "line": 224
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "cxxtools::SystemError",
          "args": [
            "\"poll\""
          ],
          "line": 220
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_error",
          "args": [
            "\"error in poll; errno=\" << errno"
          ],
          "line": 219
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"poll returns \" << p << \" revents \" << fds.revents"
          ],
          "line": 215
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "::poll",
          "args": [
            "&fds",
            "1",
            "timeout"
          ],
          "line": 213
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"poll timeout \" << timeout"
          ],
          "line": 211
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <errno.h>\n#include <typeinfo>\n#include <unistd.h>\n#include <sys/poll.h>\n#include <netinet/tcp.h>\n#include <netinet/in.h>\n#include <sys/socket.h>\n#include <cxxtools/net/tcpstream.h>\n#include <sys/sendfile.h>\n#include <fcntl.h>\n#include <limits>\n#include <config.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <cxxtools/convert.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/systemerror.h>\n#include <cxxtools/log.h>\n#include <fstream>\n#include <tnt/tntconfig.h>\n#include <tnt/comploader.h>\n#include <tnt/httpheader.h>\n#include <tnt/http.h>\n#include <tnt/httperror.h>\n#include <tnt/httpreply.h>\n#include <tnt/httprequest.h>\n#include \"mimehandler.h\"\n#include \"static.h\"\n\nvoid pollout(int fd, int timeout)\n    {\n      struct pollfd fds;\n      fds.fd = fd;\n      fds.events = POLLOUT;\n\n      log_debug(\"poll timeout \" << timeout);\n\n      int p = ::poll(&fds, 1, timeout);\n\n      log_debug(\"poll returns \" << p << \" revents \" << fds.revents);\n\n      if (p < 0)\n      {\n        log_error(\"error in poll; errno=\" << errno);\n        throw cxxtools::SystemError(\"poll\");\n      }\n      else if (p == 0)\n      {\n        log_debug(\"poll timeout (\" << timeout << ')');\n        throw cxxtools::IOTimeout();\n      }\n    }"
  },
  {
    "function_name": "getFd",
    "container": "Fdfile",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/defcomp/static.cpp",
    "lines": "202-202",
    "snippet": "int getFd() const  { return fd; }",
    "includes": [
      "#include <errno.h>",
      "#include <typeinfo>",
      "#include <unistd.h>",
      "#include <sys/poll.h>",
      "#include <netinet/tcp.h>",
      "#include <netinet/in.h>",
      "#include <sys/socket.h>",
      "#include <cxxtools/net/tcpstream.h>",
      "#include <sys/sendfile.h>",
      "#include <fcntl.h>",
      "#include <limits>",
      "#include <config.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <cxxtools/convert.h>",
      "#include <cxxtools/ioerror.h>",
      "#include <cxxtools/systemerror.h>",
      "#include <cxxtools/log.h>",
      "#include <fstream>",
      "#include <tnt/tntconfig.h>",
      "#include <tnt/comploader.h>",
      "#include <tnt/httpheader.h>",
      "#include <tnt/http.h>",
      "#include <tnt/httperror.h>",
      "#include <tnt/httpreply.h>",
      "#include <tnt/httprequest.h>",
      "#include \"mimehandler.h\"",
      "#include \"static.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include <errno.h>\n#include <typeinfo>\n#include <unistd.h>\n#include <sys/poll.h>\n#include <netinet/tcp.h>\n#include <netinet/in.h>\n#include <sys/socket.h>\n#include <cxxtools/net/tcpstream.h>\n#include <sys/sendfile.h>\n#include <fcntl.h>\n#include <limits>\n#include <config.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <cxxtools/convert.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/systemerror.h>\n#include <cxxtools/log.h>\n#include <fstream>\n#include <tnt/tntconfig.h>\n#include <tnt/comploader.h>\n#include <tnt/httpheader.h>\n#include <tnt/http.h>\n#include <tnt/httperror.h>\n#include <tnt/httpreply.h>\n#include <tnt/httprequest.h>\n#include \"mimehandler.h\"\n#include \"static.h\"\n\nFdfile {\n  int getFd() const  { return fd; }\n}"
  },
  {
    "function_name": "Fdfile",
    "container": "Fdfile",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/defcomp/static.cpp",
    "lines": "189-194",
    "snippet": "Fdfile(const char* pathname, int flags)\n          : fd(open(pathname, flags))\n        {\n          if (fd < 0)\n            throw cxxtools::SystemError(\"open\");\n        }",
    "includes": [
      "#include <errno.h>",
      "#include <typeinfo>",
      "#include <unistd.h>",
      "#include <sys/poll.h>",
      "#include <netinet/tcp.h>",
      "#include <netinet/in.h>",
      "#include <sys/socket.h>",
      "#include <cxxtools/net/tcpstream.h>",
      "#include <sys/sendfile.h>",
      "#include <fcntl.h>",
      "#include <limits>",
      "#include <config.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <cxxtools/convert.h>",
      "#include <cxxtools/ioerror.h>",
      "#include <cxxtools/systemerror.h>",
      "#include <cxxtools/log.h>",
      "#include <fstream>",
      "#include <tnt/tntconfig.h>",
      "#include <tnt/comploader.h>",
      "#include <tnt/httpheader.h>",
      "#include <tnt/http.h>",
      "#include <tnt/httperror.h>",
      "#include <tnt/httpreply.h>",
      "#include <tnt/httprequest.h>",
      "#include \"mimehandler.h\"",
      "#include \"static.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "cxxtools::SystemError",
          "args": [
            "\"open\""
          ],
          "line": 193
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "open",
          "args": [
            "pathname",
            "flags"
          ],
          "line": 190
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <errno.h>\n#include <typeinfo>\n#include <unistd.h>\n#include <sys/poll.h>\n#include <netinet/tcp.h>\n#include <netinet/in.h>\n#include <sys/socket.h>\n#include <cxxtools/net/tcpstream.h>\n#include <sys/sendfile.h>\n#include <fcntl.h>\n#include <limits>\n#include <config.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <cxxtools/convert.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/systemerror.h>\n#include <cxxtools/log.h>\n#include <fstream>\n#include <tnt/tntconfig.h>\n#include <tnt/comploader.h>\n#include <tnt/httpheader.h>\n#include <tnt/http.h>\n#include <tnt/httperror.h>\n#include <tnt/httpreply.h>\n#include <tnt/httprequest.h>\n#include \"mimehandler.h\"\n#include \"static.h\"\n\nFdfile {\n  Fdfile(const char* pathname, int flags)\n            : fd(open(pathname, flags))\n          {\n            if (fd < 0)\n              throw cxxtools::SystemError(\"open\");\n          }\n}"
  },
  {
    "function_name": "parseRange",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/defcomp/static.cpp",
    "lines": "67-182",
    "snippet": "bool parseRange(const char* range, off_t& offset, off_t& count)\n    {\n      enum\n      {\n        state_0,\n        state_1,\n        state_from0,\n        state_from,\n        state_from_e,\n        state_to0,\n        state_to,\n        state_e\n      } state = state_0;\n\n      std::string token;\n\n      const char* prefix = \"bytes=\";\n      off_t firstPos = 0;\n      off_t lastPos = count;\n      for (const char* p = range; *p && state != state_e; ++p)\n      {\n        char ch = *p;\n        switch (state)\n        {\n          case state_0:\n          case state_1:\n            if (ch == *prefix)\n            {\n              ++prefix;\n              if (*prefix == '\\0')\n              {\n                log_debug(\"prefix ends\");\n                state = state_from0;\n              }\n              else\n                state = state_1;\n            }\n            else if (state == state_1 || ch != ' ')\n              return false;\n            break;\n\n          case state_from0:\n            if (std::isdigit(ch))\n            {\n              log_debug(\"from found\");\n              firstPos = ch - '0';\n              state = state_from;\n            }\n            else if (ch == '-')\n              state = state_to0;\n            else if (ch != ' ')\n              return false;\n            break;\n\n          case state_from:\n            if (std::isdigit(ch))\n              firstPos = firstPos * 10 + ch - '0';\n            else if (ch == '-')\n              state = state_to0;\n            else if (ch == ' ')\n              state = state_from_e;\n            else\n              return false;\n            break;\n\n          case state_from_e:\n            if (ch == '-')\n              state = state_to0;\n            else if (ch != ' ')\n              return false;\n            break;\n\n          case state_to0:\n            if (std::isdigit(ch))\n            {\n              lastPos = ch - '0';\n              state = state_to;\n            }\n            else if (ch != ' ')\n              return false;\n            break;\n\n          case state_to:\n            if (std::isdigit(ch))\n              lastPos = lastPos * 10 + ch - '0';\n            else if (ch == ' ')\n              state = state_e;\n            else\n              return false;\n            break;\n\n          case state_e:\n            break;\n        }\n      }\n\n      switch (state)\n      {\n        case state_to0:\n        case state_to:\n        case state_e:\n          if (lastPos > firstPos)\n          {\n            offset = firstPos;\n            count = lastPos - firstPos;\n            log_debug(\"firstPos=\" << firstPos << \" lastPos=\" << lastPos << \" offset=\" << offset << \" count=\" << count);\n            return true;\n          }\n          break;\n\n        default:\n          break;\n      }\n\n      return false;\n    }",
    "includes": [
      "#include <errno.h>",
      "#include <typeinfo>",
      "#include <unistd.h>",
      "#include <sys/poll.h>",
      "#include <netinet/tcp.h>",
      "#include <netinet/in.h>",
      "#include <sys/socket.h>",
      "#include <cxxtools/net/tcpstream.h>",
      "#include <sys/sendfile.h>",
      "#include <fcntl.h>",
      "#include <limits>",
      "#include <config.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <cxxtools/convert.h>",
      "#include <cxxtools/ioerror.h>",
      "#include <cxxtools/systemerror.h>",
      "#include <cxxtools/log.h>",
      "#include <fstream>",
      "#include <tnt/tntconfig.h>",
      "#include <tnt/comploader.h>",
      "#include <tnt/httpheader.h>",
      "#include <tnt/http.h>",
      "#include <tnt/httperror.h>",
      "#include <tnt/httpreply.h>",
      "#include <tnt/httprequest.h>",
      "#include \"mimehandler.h\"",
      "#include \"static.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"firstPos=\" << firstPos << \" lastPos=\" << lastPos << \" offset=\" << offset << \" count=\" << count"
          ],
          "line": 172
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "std::isdigit",
          "args": [
            "ch"
          ],
          "line": 150
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "std::isdigit",
          "args": [
            "ch"
          ],
          "line": 140
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "std::isdigit",
          "args": [
            "ch"
          ],
          "line": 122
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"from found\""
          ],
          "line": 111
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "std::isdigit",
          "args": [
            "ch"
          ],
          "line": 109
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"prefix ends\""
          ],
          "line": 98
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <errno.h>\n#include <typeinfo>\n#include <unistd.h>\n#include <sys/poll.h>\n#include <netinet/tcp.h>\n#include <netinet/in.h>\n#include <sys/socket.h>\n#include <cxxtools/net/tcpstream.h>\n#include <sys/sendfile.h>\n#include <fcntl.h>\n#include <limits>\n#include <config.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <cxxtools/convert.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/systemerror.h>\n#include <cxxtools/log.h>\n#include <fstream>\n#include <tnt/tntconfig.h>\n#include <tnt/comploader.h>\n#include <tnt/httpheader.h>\n#include <tnt/http.h>\n#include <tnt/httperror.h>\n#include <tnt/httpreply.h>\n#include <tnt/httprequest.h>\n#include \"mimehandler.h\"\n#include \"static.h\"\n\nbool parseRange(const char* range, off_t& offset, off_t& count)\n    {\n      enum\n      {\n        state_0,\n        state_1,\n        state_from0,\n        state_from,\n        state_from_e,\n        state_to0,\n        state_to,\n        state_e\n      } state = state_0;\n\n      std::string token;\n\n      const char* prefix = \"bytes=\";\n      off_t firstPos = 0;\n      off_t lastPos = count;\n      for (const char* p = range; *p && state != state_e; ++p)\n      {\n        char ch = *p;\n        switch (state)\n        {\n          case state_0:\n          case state_1:\n            if (ch == *prefix)\n            {\n              ++prefix;\n              if (*prefix == '\\0')\n              {\n                log_debug(\"prefix ends\");\n                state = state_from0;\n              }\n              else\n                state = state_1;\n            }\n            else if (state == state_1 || ch != ' ')\n              return false;\n            break;\n\n          case state_from0:\n            if (std::isdigit(ch))\n            {\n              log_debug(\"from found\");\n              firstPos = ch - '0';\n              state = state_from;\n            }\n            else if (ch == '-')\n              state = state_to0;\n            else if (ch != ' ')\n              return false;\n            break;\n\n          case state_from:\n            if (std::isdigit(ch))\n              firstPos = firstPos * 10 + ch - '0';\n            else if (ch == '-')\n              state = state_to0;\n            else if (ch == ' ')\n              state = state_from_e;\n            else\n              return false;\n            break;\n\n          case state_from_e:\n            if (ch == '-')\n              state = state_to0;\n            else if (ch != ' ')\n              return false;\n            break;\n\n          case state_to0:\n            if (std::isdigit(ch))\n            {\n              lastPos = ch - '0';\n              state = state_to;\n            }\n            else if (ch != ' ')\n              return false;\n            break;\n\n          case state_to:\n            if (std::isdigit(ch))\n              lastPos = lastPos * 10 + ch - '0';\n            else if (ch == ' ')\n              state = state_e;\n            else\n              return false;\n            break;\n\n          case state_e:\n            break;\n        }\n      }\n\n      switch (state)\n      {\n        case state_to0:\n        case state_to:\n        case state_e:\n          if (lastPos > firstPos)\n          {\n            offset = firstPos;\n            count = lastPos - firstPos;\n            log_debug(\"firstPos=\" << firstPos << \" lastPos=\" << lastPos << \" offset=\" << offset << \" count=\" << count);\n            return true;\n          }\n          break;\n\n        default:\n          break;\n      }\n\n      return false;\n    }"
  }
]