[
  {
    "function_name": "sync",
    "container": "openssl_streambuf",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/openssl.cpp",
    "lines": "420-439",
    "snippet": "int openssl_streambuf::sync()\n  {\n    try\n    {\n      if (pptr() != pbase())\n      {\n        int n = m_stream.sslWrite(pbase(), pptr() - pbase());\n        if (n <= 0)\n          return -1;\n        else\n          setp(m_buffer, m_buffer + m_bufsize);\n      }\n      return 0;\n    }\n    catch (const std::exception& e)\n    {\n      log_error(\"error in openssl_streambuf::sync(): \" << e.what());\n      return traits_type::eof();\n    }\n  }",
    "includes": [
      "#include <pthread.h>",
      "#include <sys/poll.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <cxxtools/ioerror.h>",
      "#include <cxxtools/log.h>",
      "#include <openssl/err.h>",
      "#include <cxxtools/mutex.h>",
      "#include \"tnt/tntnet.h\"",
      "#include \"tnt/openssl.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "traits_type::eof",
          "args": [],
          "line": 437
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_error",
          "args": [
            "\"error in openssl_streambuf::sync(): \" << e.what()"
          ],
          "line": 436
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e.what",
          "args": [],
          "line": 436
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setp",
          "args": [
            "m_buffer",
            "m_buffer + m_bufsize"
          ],
          "line": 430
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "m_stream.sslWrite",
          "args": [
            "pbase()",
            "pptr() - pbase()"
          ],
          "line": 426
        },
        "resolved": true,
        "details": {
          "function_name": "sslWrite",
          "container": "OpensslStream",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/openssl.cpp",
          "lines": "276-316",
          "snippet": "int OpensslStream::sslWrite(const char* buffer, int bufsize) const\n  {\n    // I had crashes without this (and the lock in sslRead) lock:\n    // openssl should be thread-safe, with the installed callbacks, but I did not\n    // get it working\n    cxxtools::MutexLock lock(mutex);\n\n    int n = 0;\n    int s = bufsize;\n\n    while (true)\n    {\n      log_debug(\"SSL_write(\" << ssl << \", buffer, \" << s << ')');\n      n = SSL_write(ssl, buffer, s);\n      checkSslError();\n\n      int err = SSL_ERROR_WANT_WRITE;\n      if (n > 0)\n      {\n        buffer += n;\n        s -= n;\n      }\n      else if (n < 0\n              && (err = SSL_get_error(ssl, n)) != SSL_ERROR_WANT_READ\n              && err != SSL_ERROR_WANT_WRITE\n              && (err != SSL_ERROR_SYSCALL || errno != EAGAIN))\n      {\n        log_debug(\"error \" << err << \" occured in SSL_write; n=\" << n);\n        throwOpensslException(\"error from TLS/SSL I/O operation\", err);\n      }\n\n      if (s <= 0)\n        break;\n\n      log_debug(\"poll with \" << (err == SSL_ERROR_WANT_READ ? \"POLLIN\" : \"POLLIN|POLLOUT\"));\n      poll(err == SSL_ERROR_WANT_READ ? POLLIN : POLLIN|POLLOUT);\n    }\n\n    log_debug(\"OpensslStream::sslWrite returns \" << bufsize);\n    return bufsize;\n  }",
          "includes": [
            "#include <pthread.h>",
            "#include <sys/poll.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <cxxtools/ioerror.h>",
            "#include <cxxtools/log.h>",
            "#include <openssl/err.h>",
            "#include <cxxtools/mutex.h>",
            "#include \"tnt/tntnet.h\"",
            "#include \"tnt/openssl.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <pthread.h>\n#include <sys/poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/log.h>\n#include <openssl/err.h>\n#include <cxxtools/mutex.h>\n#include \"tnt/tntnet.h\"\n#include \"tnt/openssl.h\"\n\nOpensslStream {\n  int OpensslStream::sslWrite(const char* buffer, int bufsize) const\n    {\n      // I had crashes without this (and the lock in sslRead) lock:\n      // openssl should be thread-safe, with the installed callbacks, but I did not\n      // get it working\n      cxxtools::MutexLock lock(mutex);\n  \n      int n = 0;\n      int s = bufsize;\n  \n      while (true)\n      {\n        log_debug(\"SSL_write(\" << ssl << \", buffer, \" << s << ')');\n        n = SSL_write(ssl, buffer, s);\n        checkSslError();\n  \n        int err = SSL_ERROR_WANT_WRITE;\n        if (n > 0)\n        {\n          buffer += n;\n          s -= n;\n        }\n        else if (n < 0\n                && (err = SSL_get_error(ssl, n)) != SSL_ERROR_WANT_READ\n                && err != SSL_ERROR_WANT_WRITE\n                && (err != SSL_ERROR_SYSCALL || errno != EAGAIN))\n        {\n          log_debug(\"error \" << err << \" occured in SSL_write; n=\" << n);\n          throwOpensslException(\"error from TLS/SSL I/O operation\", err);\n        }\n  \n        if (s <= 0)\n          break;\n  \n        log_debug(\"poll with \" << (err == SSL_ERROR_WANT_READ ? \"POLLIN\" : \"POLLIN|POLLOUT\"));\n        poll(err == SSL_ERROR_WANT_READ ? POLLIN : POLLIN|POLLOUT);\n      }\n  \n      log_debug(\"OpensslStream::sslWrite returns \" << bufsize);\n      return bufsize;\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "pbase",
          "args": [],
          "line": 426
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pptr",
          "args": [],
          "line": 426
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pbase",
          "args": [],
          "line": 426
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pbase",
          "args": [],
          "line": 424
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pptr",
          "args": [],
          "line": 424
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <pthread.h>\n#include <sys/poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/log.h>\n#include <openssl/err.h>\n#include <cxxtools/mutex.h>\n#include \"tnt/tntnet.h\"\n#include \"tnt/openssl.h\"\n\nopenssl_streambuf {\n  int openssl_streambuf::sync()\n    {\n      try\n      {\n        if (pptr() != pbase())\n        {\n          int n = m_stream.sslWrite(pbase(), pptr() - pbase());\n          if (n <= 0)\n            return -1;\n          else\n            setp(m_buffer, m_buffer + m_bufsize);\n        }\n        return 0;\n      }\n      catch (const std::exception& e)\n      {\n        log_error(\"error in openssl_streambuf::sync(): \" << e.what());\n        return traits_type::eof();\n      }\n    }\n}"
  },
  {
    "function_name": "underflow",
    "container": "openssl_streambuf",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/openssl.cpp",
    "lines": "410-418",
    "snippet": "openssl_streambuf::int_type openssl_streambuf::underflow()\n  {\n    int n = m_stream.sslRead(m_buffer, m_bufsize);\n    if (n <= 0)\n      return traits_type::eof();\n\n    setg(m_buffer, m_buffer, m_buffer + n);\n    return (int_type)(unsigned char)m_buffer[0];\n  }",
    "includes": [
      "#include <pthread.h>",
      "#include <sys/poll.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <cxxtools/ioerror.h>",
      "#include <cxxtools/log.h>",
      "#include <openssl/err.h>",
      "#include <cxxtools/mutex.h>",
      "#include \"tnt/tntnet.h\"",
      "#include \"tnt/openssl.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "setg",
          "args": [
            "m_buffer",
            "m_buffer",
            "m_buffer + n"
          ],
          "line": 416
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "traits_type::eof",
          "args": [],
          "line": 414
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "m_stream.sslRead",
          "args": [
            "m_buffer",
            "m_bufsize"
          ],
          "line": 412
        },
        "resolved": true,
        "details": {
          "function_name": "sslRead",
          "container": "OpensslStream",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/openssl.cpp",
          "lines": "224-274",
          "snippet": "int OpensslStream::sslRead(char* buffer, int bufsize) const\n  {\n    // I had crashes without this (and the lock in sslWrite) lock:\n    // openssl should be thread-safe, with the installed callbacks, but I did not\n    // get it working\n    cxxtools::MutexLock lock(mutex);\n\n    log_debug(\"read\");\n\n    int n;\n    int err;\n\n    // non-blocking/with timeout\n\n    // try read\n    log_debug(\"SSL_read(\" << ssl << \", buffer, \" << bufsize << ')');\n    n = ::SSL_read(ssl, buffer, bufsize);\n    log_debug(\"ssl-read => \" << n);\n\n    if (n > 0)\n      return n;\n\n    log_debug(\"SSL_get_error(\" << ssl << \", \" << n << ')');\n    if ((err = SSL_get_error(ssl, n)) != SSL_ERROR_WANT_READ\n     && err != SSL_ERROR_WANT_WRITE)\n      checkSslError();\n\n    if (getTimeout() == 0)\n    {\n      log_debug(\"read-timeout\");\n      throw cxxtools::IOTimeout();\n    }\n\n    // no read, timeout > 0 - poll\n    do\n    {\n      poll(SSL_get_error(ssl, n) == SSL_ERROR_WANT_WRITE\n                  ? POLLIN|POLLOUT : POLLIN);\n\n      log_debug(\"SSL_read(\" << ssl << \", buffer, \" << bufsize << ')');\n      n = ::SSL_read(ssl, buffer, bufsize);\n      log_debug(\"SSL_read returns \" << n);\n      checkSslError();\n\n    } while (n < 0\n       && ((err = SSL_get_error(ssl, n)) == SSL_ERROR_WANT_READ\n        || err == SSL_ERROR_WANT_WRITE\n        || (err == SSL_ERROR_SYSCALL && errno == EAGAIN)));\n\n    return n;\n  }",
          "includes": [
            "#include <pthread.h>",
            "#include <sys/poll.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <cxxtools/ioerror.h>",
            "#include <cxxtools/log.h>",
            "#include <openssl/err.h>",
            "#include <cxxtools/mutex.h>",
            "#include \"tnt/tntnet.h\"",
            "#include \"tnt/openssl.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <pthread.h>\n#include <sys/poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/log.h>\n#include <openssl/err.h>\n#include <cxxtools/mutex.h>\n#include \"tnt/tntnet.h\"\n#include \"tnt/openssl.h\"\n\nOpensslStream {\n  int OpensslStream::sslRead(char* buffer, int bufsize) const\n    {\n      // I had crashes without this (and the lock in sslWrite) lock:\n      // openssl should be thread-safe, with the installed callbacks, but I did not\n      // get it working\n      cxxtools::MutexLock lock(mutex);\n  \n      log_debug(\"read\");\n  \n      int n;\n      int err;\n  \n      // non-blocking/with timeout\n  \n      // try read\n      log_debug(\"SSL_read(\" << ssl << \", buffer, \" << bufsize << ')');\n      n = ::SSL_read(ssl, buffer, bufsize);\n      log_debug(\"ssl-read => \" << n);\n  \n      if (n > 0)\n        return n;\n  \n      log_debug(\"SSL_get_error(\" << ssl << \", \" << n << ')');\n      if ((err = SSL_get_error(ssl, n)) != SSL_ERROR_WANT_READ\n       && err != SSL_ERROR_WANT_WRITE)\n        checkSslError();\n  \n      if (getTimeout() == 0)\n      {\n        log_debug(\"read-timeout\");\n        throw cxxtools::IOTimeout();\n      }\n  \n      // no read, timeout > 0 - poll\n      do\n      {\n        poll(SSL_get_error(ssl, n) == SSL_ERROR_WANT_WRITE\n                    ? POLLIN|POLLOUT : POLLIN);\n  \n        log_debug(\"SSL_read(\" << ssl << \", buffer, \" << bufsize << ')');\n        n = ::SSL_read(ssl, buffer, bufsize);\n        log_debug(\"SSL_read returns \" << n);\n        checkSslError();\n  \n      } while (n < 0\n         && ((err = SSL_get_error(ssl, n)) == SSL_ERROR_WANT_READ\n          || err == SSL_ERROR_WANT_WRITE\n          || (err == SSL_ERROR_SYSCALL && errno == EAGAIN)));\n  \n      return n;\n    }\n}"
        }
      }
    ],
    "contextual_snippet": "#include <pthread.h>\n#include <sys/poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/log.h>\n#include <openssl/err.h>\n#include <cxxtools/mutex.h>\n#include \"tnt/tntnet.h\"\n#include \"tnt/openssl.h\"\n\nopenssl_streambuf {\n  openssl_streambuf::int_type openssl_streambuf::underflow()\n    {\n      int n = m_stream.sslRead(m_buffer, m_bufsize);\n      if (n <= 0)\n        return traits_type::eof();\n  \n      setg(m_buffer, m_buffer, m_buffer + n);\n      return (int_type)(unsigned char)m_buffer[0];\n    }\n}"
  },
  {
    "function_name": "overflow",
    "container": "openssl_streambuf",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/openssl.cpp",
    "lines": "383-408",
    "snippet": "openssl_streambuf::int_type openssl_streambuf::overflow(openssl_streambuf::int_type c)\n  {\n    try\n    {\n      if (pptr() != pbase())\n      {\n        int n = m_stream.sslWrite(pbase(), pptr() - pbase());\n        if (n <= 0)\n          return traits_type::eof();\n      }\n\n      setp(m_buffer, m_buffer + m_bufsize);\n      if (c != traits_type::eof())\n      {\n        *pptr() = (char_type)c;\n        pbump(1);\n      }\n\n      return 0;\n    }\n    catch (const std::exception& e)\n    {\n      log_error(\"error int openssl_streambuf::overflow: \" << e.what());\n      return traits_type::eof();\n    }\n  }",
    "includes": [
      "#include <pthread.h>",
      "#include <sys/poll.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <cxxtools/ioerror.h>",
      "#include <cxxtools/log.h>",
      "#include <openssl/err.h>",
      "#include <cxxtools/mutex.h>",
      "#include \"tnt/tntnet.h\"",
      "#include \"tnt/openssl.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "traits_type::eof",
          "args": [],
          "line": 406
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_error",
          "args": [
            "\"error int openssl_streambuf::overflow: \" << e.what()"
          ],
          "line": 405
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e.what",
          "args": [],
          "line": 405
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pbump",
          "args": [
            "1"
          ],
          "line": 398
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pptr",
          "args": [],
          "line": 397
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "traits_type::eof",
          "args": [],
          "line": 395
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setp",
          "args": [
            "m_buffer",
            "m_buffer + m_bufsize"
          ],
          "line": 394
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "traits_type::eof",
          "args": [],
          "line": 391
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "m_stream.sslWrite",
          "args": [
            "pbase()",
            "pptr() - pbase()"
          ],
          "line": 389
        },
        "resolved": true,
        "details": {
          "function_name": "sslWrite",
          "container": "OpensslStream",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/openssl.cpp",
          "lines": "276-316",
          "snippet": "int OpensslStream::sslWrite(const char* buffer, int bufsize) const\n  {\n    // I had crashes without this (and the lock in sslRead) lock:\n    // openssl should be thread-safe, with the installed callbacks, but I did not\n    // get it working\n    cxxtools::MutexLock lock(mutex);\n\n    int n = 0;\n    int s = bufsize;\n\n    while (true)\n    {\n      log_debug(\"SSL_write(\" << ssl << \", buffer, \" << s << ')');\n      n = SSL_write(ssl, buffer, s);\n      checkSslError();\n\n      int err = SSL_ERROR_WANT_WRITE;\n      if (n > 0)\n      {\n        buffer += n;\n        s -= n;\n      }\n      else if (n < 0\n              && (err = SSL_get_error(ssl, n)) != SSL_ERROR_WANT_READ\n              && err != SSL_ERROR_WANT_WRITE\n              && (err != SSL_ERROR_SYSCALL || errno != EAGAIN))\n      {\n        log_debug(\"error \" << err << \" occured in SSL_write; n=\" << n);\n        throwOpensslException(\"error from TLS/SSL I/O operation\", err);\n      }\n\n      if (s <= 0)\n        break;\n\n      log_debug(\"poll with \" << (err == SSL_ERROR_WANT_READ ? \"POLLIN\" : \"POLLIN|POLLOUT\"));\n      poll(err == SSL_ERROR_WANT_READ ? POLLIN : POLLIN|POLLOUT);\n    }\n\n    log_debug(\"OpensslStream::sslWrite returns \" << bufsize);\n    return bufsize;\n  }",
          "includes": [
            "#include <pthread.h>",
            "#include <sys/poll.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <cxxtools/ioerror.h>",
            "#include <cxxtools/log.h>",
            "#include <openssl/err.h>",
            "#include <cxxtools/mutex.h>",
            "#include \"tnt/tntnet.h\"",
            "#include \"tnt/openssl.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <pthread.h>\n#include <sys/poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/log.h>\n#include <openssl/err.h>\n#include <cxxtools/mutex.h>\n#include \"tnt/tntnet.h\"\n#include \"tnt/openssl.h\"\n\nOpensslStream {\n  int OpensslStream::sslWrite(const char* buffer, int bufsize) const\n    {\n      // I had crashes without this (and the lock in sslRead) lock:\n      // openssl should be thread-safe, with the installed callbacks, but I did not\n      // get it working\n      cxxtools::MutexLock lock(mutex);\n  \n      int n = 0;\n      int s = bufsize;\n  \n      while (true)\n      {\n        log_debug(\"SSL_write(\" << ssl << \", buffer, \" << s << ')');\n        n = SSL_write(ssl, buffer, s);\n        checkSslError();\n  \n        int err = SSL_ERROR_WANT_WRITE;\n        if (n > 0)\n        {\n          buffer += n;\n          s -= n;\n        }\n        else if (n < 0\n                && (err = SSL_get_error(ssl, n)) != SSL_ERROR_WANT_READ\n                && err != SSL_ERROR_WANT_WRITE\n                && (err != SSL_ERROR_SYSCALL || errno != EAGAIN))\n        {\n          log_debug(\"error \" << err << \" occured in SSL_write; n=\" << n);\n          throwOpensslException(\"error from TLS/SSL I/O operation\", err);\n        }\n  \n        if (s <= 0)\n          break;\n  \n        log_debug(\"poll with \" << (err == SSL_ERROR_WANT_READ ? \"POLLIN\" : \"POLLIN|POLLOUT\"));\n        poll(err == SSL_ERROR_WANT_READ ? POLLIN : POLLIN|POLLOUT);\n      }\n  \n      log_debug(\"OpensslStream::sslWrite returns \" << bufsize);\n      return bufsize;\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "pbase",
          "args": [],
          "line": 389
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pptr",
          "args": [],
          "line": 389
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pbase",
          "args": [],
          "line": 389
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pbase",
          "args": [],
          "line": 387
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pptr",
          "args": [],
          "line": 387
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <pthread.h>\n#include <sys/poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/log.h>\n#include <openssl/err.h>\n#include <cxxtools/mutex.h>\n#include \"tnt/tntnet.h\"\n#include \"tnt/openssl.h\"\n\nopenssl_streambuf {\n  openssl_streambuf::int_type openssl_streambuf::overflow(openssl_streambuf::int_type c)\n    {\n      try\n      {\n        if (pptr() != pbase())\n        {\n          int n = m_stream.sslWrite(pbase(), pptr() - pbase());\n          if (n <= 0)\n            return traits_type::eof();\n        }\n  \n        setp(m_buffer, m_buffer + m_bufsize);\n        if (c != traits_type::eof())\n        {\n          *pptr() = (char_type)c;\n          pbump(1);\n        }\n  \n        return 0;\n      }\n      catch (const std::exception& e)\n      {\n        log_error(\"error int openssl_streambuf::overflow: \" << e.what());\n        return traits_type::eof();\n      }\n    }\n}"
  },
  {
    "function_name": "openssl_streambuf",
    "container": "openssl_streambuf",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/openssl.cpp",
    "lines": "375-381",
    "snippet": "openssl_streambuf::openssl_streambuf(OpensslStream& stream, unsigned bufsize, int timeout)\n    : m_stream(stream),\n      m_buffer(new char_type[bufsize]),\n      m_bufsize(bufsize)\n  {\n    setTimeout(timeout);\n  }",
    "includes": [
      "#include <pthread.h>",
      "#include <sys/poll.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <cxxtools/ioerror.h>",
      "#include <cxxtools/log.h>",
      "#include <openssl/err.h>",
      "#include <cxxtools/mutex.h>",
      "#include \"tnt/tntnet.h\"",
      "#include \"tnt/openssl.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "setTimeout",
          "args": [
            "timeout"
          ],
          "line": 380
        },
        "resolved": true,
        "details": {
          "function_name": "setTimeout",
          "container": "openssl_iostream",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/openssl.h",
          "lines": "139-139",
          "snippet": "void setTimeout(int timeout)  { m_buffer.setTimeout(timeout); }",
          "includes": [
            "#include <openssl/ssl.h>",
            "#include <cxxtools/smartptr.h>",
            "#include <cxxtools/net/tcpstream.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <openssl/ssl.h>\n#include <cxxtools/smartptr.h>\n#include <cxxtools/net/tcpstream.h>\n\nopenssl_iostream {\n  void setTimeout(int timeout)  { m_buffer.setTimeout(timeout); }\n}"
        }
      }
    ],
    "contextual_snippet": "#include <pthread.h>\n#include <sys/poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/log.h>\n#include <openssl/err.h>\n#include <cxxtools/mutex.h>\n#include \"tnt/tntnet.h\"\n#include \"tnt/openssl.h\"\n\nopenssl_streambuf {\n  openssl_streambuf::openssl_streambuf(OpensslStream& stream, unsigned bufsize, int timeout)\n      : m_stream(stream),\n        m_buffer(new char_type[bufsize]),\n        m_bufsize(bufsize)\n    {\n      setTimeout(timeout);\n    }\n}"
  },
  {
    "function_name": "shutdown",
    "container": "OpensslStream",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/openssl.cpp",
    "lines": "318-370",
    "snippet": "void OpensslStream::shutdown() const\n  {\n    cxxtools::MutexLock lock(mutex);\n\n    int n, err;\n    // non-blocking/with timeout\n\n    // try read\n    log_debug(\"SSL_shutdown(\" << ssl << ')');\n    n = ::SSL_shutdown(ssl);\n    log_debug(\"ssl-shutdown => \" << n);\n\n    if (n == 1)\n      return;\n\n    if (n == -1)\n    {\n      log_debug(\"SSL_get_error(\" << ssl << \", \" << n << ')');\n\n      err = SSL_get_error(ssl, n);\n\n      if (err != SSL_ERROR_WANT_READ\n       && err != SSL_ERROR_WANT_WRITE)\n        checkSslError();\n\n      if (getTimeout() == 0)\n      {\n        log_debug(\"shutdown-timeout\");\n        throw cxxtools::IOTimeout();\n      }\n    }\n\n    do\n    {\n      log_debug(\"poll\");\n      poll(err == SSL_ERROR_WANT_WRITE ? POLLIN|POLLOUT : POLLIN);\n\n      log_debug(\"SSL_shutdown(\" << ssl << ')');\n      n = ::SSL_shutdown(ssl);\n      log_debug(\"SSL_shutdown returns \" << n);\n\n      if (n == 1)\n        return;\n\n      if (n == 0)\n        continue;\n\n      checkSslError();\n      err = SSL_get_error(ssl, n);\n\n    } while (err == SSL_ERROR_WANT_READ\n          || err == SSL_ERROR_WANT_WRITE);\n  }",
    "includes": [
      "#include <pthread.h>",
      "#include <sys/poll.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <cxxtools/ioerror.h>",
      "#include <cxxtools/log.h>",
      "#include <openssl/err.h>",
      "#include <cxxtools/mutex.h>",
      "#include \"tnt/tntnet.h\"",
      "#include \"tnt/openssl.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "SSL_get_error",
          "args": [
            "ssl",
            "n"
          ],
          "line": 366
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "checkSslError",
          "args": [],
          "line": 365
        },
        "resolved": true,
        "details": {
          "function_name": "checkSslError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/openssl.cpp",
          "lines": "52-69",
          "snippet": "void checkSslError()\n    {\n      unsigned long code = ERR_get_error();\n      if (code != 0)\n      {\n        char buffer[120];\n        if (ERR_error_string(code, buffer))\n        {\n          log_debug(\"SSL-Error \" << code << \": \\\"\" << buffer << '\"');\n          throwOpensslException(buffer, code);\n        }\n        else\n        {\n          log_debug(\"unknown SSL-Error \" << code);\n          throwOpensslException(\"unknown SSL-Error\", code);\n        }\n      }\n    }",
          "includes": [
            "#include <pthread.h>",
            "#include <sys/poll.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <cxxtools/ioerror.h>",
            "#include <cxxtools/log.h>",
            "#include <openssl/err.h>",
            "#include <cxxtools/mutex.h>",
            "#include \"tnt/tntnet.h\"",
            "#include \"tnt/openssl.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <pthread.h>\n#include <sys/poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/log.h>\n#include <openssl/err.h>\n#include <cxxtools/mutex.h>\n#include \"tnt/tntnet.h\"\n#include \"tnt/openssl.h\"\n\nvoid checkSslError()\n    {\n      unsigned long code = ERR_get_error();\n      if (code != 0)\n      {\n        char buffer[120];\n        if (ERR_error_string(code, buffer))\n        {\n          log_debug(\"SSL-Error \" << code << \": \\\"\" << buffer << '\"');\n          throwOpensslException(buffer, code);\n        }\n        else\n        {\n          log_debug(\"unknown SSL-Error \" << code);\n          throwOpensslException(\"unknown SSL-Error\", code);\n        }\n      }\n    }"
        }
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"SSL_shutdown returns \" << n"
          ],
          "line": 357
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "::SSL_shutdown",
          "args": [
            "ssl"
          ],
          "line": 356
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"SSL_shutdown(\" << ssl << ')'"
          ],
          "line": 355
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "poll",
          "args": [
            "err == SSL_ERROR_WANT_WRITE ? POLLIN|POLLOUT : POLLIN"
          ],
          "line": 353
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"poll\""
          ],
          "line": 352
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "cxxtools::IOTimeout",
          "args": [],
          "line": 346
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"shutdown-timeout\""
          ],
          "line": 345
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getTimeout",
          "args": [],
          "line": 343
        },
        "resolved": true,
        "details": {
          "function_name": "getTimeout",
          "container": "openssl_iostream",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/openssl.h",
          "lines": "140-140",
          "snippet": "int getTimeout() const        { return m_buffer.getTimeout(); }",
          "includes": [
            "#include <openssl/ssl.h>",
            "#include <cxxtools/smartptr.h>",
            "#include <cxxtools/net/tcpstream.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <openssl/ssl.h>\n#include <cxxtools/smartptr.h>\n#include <cxxtools/net/tcpstream.h>\n\nopenssl_iostream {\n  int getTimeout() const        { return m_buffer.getTimeout(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "SSL_get_error",
          "args": [
            "ssl",
            "n"
          ],
          "line": 337
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"SSL_get_error(\" << ssl << \", \" << n << ')'"
          ],
          "line": 335
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"ssl-shutdown => \" << n"
          ],
          "line": 328
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "::SSL_shutdown",
          "args": [
            "ssl"
          ],
          "line": 327
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"SSL_shutdown(\" << ssl << ')'"
          ],
          "line": 326
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <pthread.h>\n#include <sys/poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/log.h>\n#include <openssl/err.h>\n#include <cxxtools/mutex.h>\n#include \"tnt/tntnet.h\"\n#include \"tnt/openssl.h\"\n\nOpensslStream {\n  void OpensslStream::shutdown() const\n    {\n      cxxtools::MutexLock lock(mutex);\n  \n      int n, err;\n      // non-blocking/with timeout\n  \n      // try read\n      log_debug(\"SSL_shutdown(\" << ssl << ')');\n      n = ::SSL_shutdown(ssl);\n      log_debug(\"ssl-shutdown => \" << n);\n  \n      if (n == 1)\n        return;\n  \n      if (n == -1)\n      {\n        log_debug(\"SSL_get_error(\" << ssl << \", \" << n << ')');\n  \n        err = SSL_get_error(ssl, n);\n  \n        if (err != SSL_ERROR_WANT_READ\n         && err != SSL_ERROR_WANT_WRITE)\n          checkSslError();\n  \n        if (getTimeout() == 0)\n        {\n          log_debug(\"shutdown-timeout\");\n          throw cxxtools::IOTimeout();\n        }\n      }\n  \n      do\n      {\n        log_debug(\"poll\");\n        poll(err == SSL_ERROR_WANT_WRITE ? POLLIN|POLLOUT : POLLIN);\n  \n        log_debug(\"SSL_shutdown(\" << ssl << ')');\n        n = ::SSL_shutdown(ssl);\n        log_debug(\"SSL_shutdown returns \" << n);\n  \n        if (n == 1)\n          return;\n  \n        if (n == 0)\n          continue;\n  \n        checkSslError();\n        err = SSL_get_error(ssl, n);\n  \n      } while (err == SSL_ERROR_WANT_READ\n            || err == SSL_ERROR_WANT_WRITE);\n    }\n}"
  },
  {
    "function_name": "sslWrite",
    "container": "OpensslStream",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/openssl.cpp",
    "lines": "276-316",
    "snippet": "int OpensslStream::sslWrite(const char* buffer, int bufsize) const\n  {\n    // I had crashes without this (and the lock in sslRead) lock:\n    // openssl should be thread-safe, with the installed callbacks, but I did not\n    // get it working\n    cxxtools::MutexLock lock(mutex);\n\n    int n = 0;\n    int s = bufsize;\n\n    while (true)\n    {\n      log_debug(\"SSL_write(\" << ssl << \", buffer, \" << s << ')');\n      n = SSL_write(ssl, buffer, s);\n      checkSslError();\n\n      int err = SSL_ERROR_WANT_WRITE;\n      if (n > 0)\n      {\n        buffer += n;\n        s -= n;\n      }\n      else if (n < 0\n              && (err = SSL_get_error(ssl, n)) != SSL_ERROR_WANT_READ\n              && err != SSL_ERROR_WANT_WRITE\n              && (err != SSL_ERROR_SYSCALL || errno != EAGAIN))\n      {\n        log_debug(\"error \" << err << \" occured in SSL_write; n=\" << n);\n        throwOpensslException(\"error from TLS/SSL I/O operation\", err);\n      }\n\n      if (s <= 0)\n        break;\n\n      log_debug(\"poll with \" << (err == SSL_ERROR_WANT_READ ? \"POLLIN\" : \"POLLIN|POLLOUT\"));\n      poll(err == SSL_ERROR_WANT_READ ? POLLIN : POLLIN|POLLOUT);\n    }\n\n    log_debug(\"OpensslStream::sslWrite returns \" << bufsize);\n    return bufsize;\n  }",
    "includes": [
      "#include <pthread.h>",
      "#include <sys/poll.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <cxxtools/ioerror.h>",
      "#include <cxxtools/log.h>",
      "#include <openssl/err.h>",
      "#include <cxxtools/mutex.h>",
      "#include \"tnt/tntnet.h\"",
      "#include \"tnt/openssl.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"OpensslStream::sslWrite returns \" << bufsize"
          ],
          "line": 314
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "poll",
          "args": [
            "err == SSL_ERROR_WANT_READ ? POLLIN : POLLIN|POLLOUT"
          ],
          "line": 311
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"poll with \" << (err == SSL_ERROR_WANT_READ ? \"POLLIN\" : \"POLLIN|POLLOUT\")"
          ],
          "line": 310
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "throwOpensslException",
          "args": [
            "\"error from TLS/SSL I/O operation\"",
            "err"
          ],
          "line": 304
        },
        "resolved": true,
        "details": {
          "function_name": "throwOpensslException",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/openssl.cpp",
          "lines": "47-50",
          "snippet": "void throwOpensslException(const char* what, unsigned long code)\n    {\n      throw OpensslException(what, code);\n    }",
          "includes": [
            "#include <pthread.h>",
            "#include <sys/poll.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <cxxtools/ioerror.h>",
            "#include <cxxtools/log.h>",
            "#include <openssl/err.h>",
            "#include <cxxtools/mutex.h>",
            "#include \"tnt/tntnet.h\"",
            "#include \"tnt/openssl.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <pthread.h>\n#include <sys/poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/log.h>\n#include <openssl/err.h>\n#include <cxxtools/mutex.h>\n#include \"tnt/tntnet.h\"\n#include \"tnt/openssl.h\"\n\nvoid throwOpensslException(const char* what, unsigned long code)\n    {\n      throw OpensslException(what, code);\n    }"
        }
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"error \" << err << \" occured in SSL_write; n=\" << n"
          ],
          "line": 303
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SSL_get_error",
          "args": [
            "ssl",
            "n"
          ],
          "line": 299
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "checkSslError",
          "args": [],
          "line": 290
        },
        "resolved": true,
        "details": {
          "function_name": "checkSslError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/openssl.cpp",
          "lines": "52-69",
          "snippet": "void checkSslError()\n    {\n      unsigned long code = ERR_get_error();\n      if (code != 0)\n      {\n        char buffer[120];\n        if (ERR_error_string(code, buffer))\n        {\n          log_debug(\"SSL-Error \" << code << \": \\\"\" << buffer << '\"');\n          throwOpensslException(buffer, code);\n        }\n        else\n        {\n          log_debug(\"unknown SSL-Error \" << code);\n          throwOpensslException(\"unknown SSL-Error\", code);\n        }\n      }\n    }",
          "includes": [
            "#include <pthread.h>",
            "#include <sys/poll.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <cxxtools/ioerror.h>",
            "#include <cxxtools/log.h>",
            "#include <openssl/err.h>",
            "#include <cxxtools/mutex.h>",
            "#include \"tnt/tntnet.h\"",
            "#include \"tnt/openssl.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <pthread.h>\n#include <sys/poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/log.h>\n#include <openssl/err.h>\n#include <cxxtools/mutex.h>\n#include \"tnt/tntnet.h\"\n#include \"tnt/openssl.h\"\n\nvoid checkSslError()\n    {\n      unsigned long code = ERR_get_error();\n      if (code != 0)\n      {\n        char buffer[120];\n        if (ERR_error_string(code, buffer))\n        {\n          log_debug(\"SSL-Error \" << code << \": \\\"\" << buffer << '\"');\n          throwOpensslException(buffer, code);\n        }\n        else\n        {\n          log_debug(\"unknown SSL-Error \" << code);\n          throwOpensslException(\"unknown SSL-Error\", code);\n        }\n      }\n    }"
        }
      },
      {
        "call_info": {
          "callee": "SSL_write",
          "args": [
            "ssl",
            "buffer",
            "s"
          ],
          "line": 289
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"SSL_write(\" << ssl << \", buffer, \" << s << ')'"
          ],
          "line": 288
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <pthread.h>\n#include <sys/poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/log.h>\n#include <openssl/err.h>\n#include <cxxtools/mutex.h>\n#include \"tnt/tntnet.h\"\n#include \"tnt/openssl.h\"\n\nOpensslStream {\n  int OpensslStream::sslWrite(const char* buffer, int bufsize) const\n    {\n      // I had crashes without this (and the lock in sslRead) lock:\n      // openssl should be thread-safe, with the installed callbacks, but I did not\n      // get it working\n      cxxtools::MutexLock lock(mutex);\n  \n      int n = 0;\n      int s = bufsize;\n  \n      while (true)\n      {\n        log_debug(\"SSL_write(\" << ssl << \", buffer, \" << s << ')');\n        n = SSL_write(ssl, buffer, s);\n        checkSslError();\n  \n        int err = SSL_ERROR_WANT_WRITE;\n        if (n > 0)\n        {\n          buffer += n;\n          s -= n;\n        }\n        else if (n < 0\n                && (err = SSL_get_error(ssl, n)) != SSL_ERROR_WANT_READ\n                && err != SSL_ERROR_WANT_WRITE\n                && (err != SSL_ERROR_SYSCALL || errno != EAGAIN))\n        {\n          log_debug(\"error \" << err << \" occured in SSL_write; n=\" << n);\n          throwOpensslException(\"error from TLS/SSL I/O operation\", err);\n        }\n  \n        if (s <= 0)\n          break;\n  \n        log_debug(\"poll with \" << (err == SSL_ERROR_WANT_READ ? \"POLLIN\" : \"POLLIN|POLLOUT\"));\n        poll(err == SSL_ERROR_WANT_READ ? POLLIN : POLLIN|POLLOUT);\n      }\n  \n      log_debug(\"OpensslStream::sslWrite returns \" << bufsize);\n      return bufsize;\n    }\n}"
  },
  {
    "function_name": "sslRead",
    "container": "OpensslStream",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/openssl.cpp",
    "lines": "224-274",
    "snippet": "int OpensslStream::sslRead(char* buffer, int bufsize) const\n  {\n    // I had crashes without this (and the lock in sslWrite) lock:\n    // openssl should be thread-safe, with the installed callbacks, but I did not\n    // get it working\n    cxxtools::MutexLock lock(mutex);\n\n    log_debug(\"read\");\n\n    int n;\n    int err;\n\n    // non-blocking/with timeout\n\n    // try read\n    log_debug(\"SSL_read(\" << ssl << \", buffer, \" << bufsize << ')');\n    n = ::SSL_read(ssl, buffer, bufsize);\n    log_debug(\"ssl-read => \" << n);\n\n    if (n > 0)\n      return n;\n\n    log_debug(\"SSL_get_error(\" << ssl << \", \" << n << ')');\n    if ((err = SSL_get_error(ssl, n)) != SSL_ERROR_WANT_READ\n     && err != SSL_ERROR_WANT_WRITE)\n      checkSslError();\n\n    if (getTimeout() == 0)\n    {\n      log_debug(\"read-timeout\");\n      throw cxxtools::IOTimeout();\n    }\n\n    // no read, timeout > 0 - poll\n    do\n    {\n      poll(SSL_get_error(ssl, n) == SSL_ERROR_WANT_WRITE\n                  ? POLLIN|POLLOUT : POLLIN);\n\n      log_debug(\"SSL_read(\" << ssl << \", buffer, \" << bufsize << ')');\n      n = ::SSL_read(ssl, buffer, bufsize);\n      log_debug(\"SSL_read returns \" << n);\n      checkSslError();\n\n    } while (n < 0\n       && ((err = SSL_get_error(ssl, n)) == SSL_ERROR_WANT_READ\n        || err == SSL_ERROR_WANT_WRITE\n        || (err == SSL_ERROR_SYSCALL && errno == EAGAIN)));\n\n    return n;\n  }",
    "includes": [
      "#include <pthread.h>",
      "#include <sys/poll.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <cxxtools/ioerror.h>",
      "#include <cxxtools/log.h>",
      "#include <openssl/err.h>",
      "#include <cxxtools/mutex.h>",
      "#include \"tnt/tntnet.h\"",
      "#include \"tnt/openssl.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "SSL_get_error",
          "args": [
            "ssl",
            "n"
          ],
          "line": 269
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "checkSslError",
          "args": [],
          "line": 266
        },
        "resolved": true,
        "details": {
          "function_name": "checkSslError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/openssl.cpp",
          "lines": "52-69",
          "snippet": "void checkSslError()\n    {\n      unsigned long code = ERR_get_error();\n      if (code != 0)\n      {\n        char buffer[120];\n        if (ERR_error_string(code, buffer))\n        {\n          log_debug(\"SSL-Error \" << code << \": \\\"\" << buffer << '\"');\n          throwOpensslException(buffer, code);\n        }\n        else\n        {\n          log_debug(\"unknown SSL-Error \" << code);\n          throwOpensslException(\"unknown SSL-Error\", code);\n        }\n      }\n    }",
          "includes": [
            "#include <pthread.h>",
            "#include <sys/poll.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <cxxtools/ioerror.h>",
            "#include <cxxtools/log.h>",
            "#include <openssl/err.h>",
            "#include <cxxtools/mutex.h>",
            "#include \"tnt/tntnet.h\"",
            "#include \"tnt/openssl.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <pthread.h>\n#include <sys/poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/log.h>\n#include <openssl/err.h>\n#include <cxxtools/mutex.h>\n#include \"tnt/tntnet.h\"\n#include \"tnt/openssl.h\"\n\nvoid checkSslError()\n    {\n      unsigned long code = ERR_get_error();\n      if (code != 0)\n      {\n        char buffer[120];\n        if (ERR_error_string(code, buffer))\n        {\n          log_debug(\"SSL-Error \" << code << \": \\\"\" << buffer << '\"');\n          throwOpensslException(buffer, code);\n        }\n        else\n        {\n          log_debug(\"unknown SSL-Error \" << code);\n          throwOpensslException(\"unknown SSL-Error\", code);\n        }\n      }\n    }"
        }
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"SSL_read returns \" << n"
          ],
          "line": 265
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "::SSL_read",
          "args": [
            "ssl",
            "buffer",
            "bufsize"
          ],
          "line": 264
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"SSL_read(\" << ssl << \", buffer, \" << bufsize << ')'"
          ],
          "line": 263
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "poll",
          "args": [
            "SSL_get_error(ssl, n) == SSL_ERROR_WANT_WRITE\n                  ? POLLIN|POLLOUT : POLLIN"
          ],
          "line": 260
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SSL_get_error",
          "args": [
            "ssl",
            "n"
          ],
          "line": 260
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "cxxtools::IOTimeout",
          "args": [],
          "line": 254
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"read-timeout\""
          ],
          "line": 253
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getTimeout",
          "args": [],
          "line": 251
        },
        "resolved": true,
        "details": {
          "function_name": "getTimeout",
          "container": "openssl_iostream",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/openssl.h",
          "lines": "140-140",
          "snippet": "int getTimeout() const        { return m_buffer.getTimeout(); }",
          "includes": [
            "#include <openssl/ssl.h>",
            "#include <cxxtools/smartptr.h>",
            "#include <cxxtools/net/tcpstream.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <openssl/ssl.h>\n#include <cxxtools/smartptr.h>\n#include <cxxtools/net/tcpstream.h>\n\nopenssl_iostream {\n  int getTimeout() const        { return m_buffer.getTimeout(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "SSL_get_error",
          "args": [
            "ssl",
            "n"
          ],
          "line": 247
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"SSL_get_error(\" << ssl << \", \" << n << ')'"
          ],
          "line": 246
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"ssl-read => \" << n"
          ],
          "line": 241
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "::SSL_read",
          "args": [
            "ssl",
            "buffer",
            "bufsize"
          ],
          "line": 240
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"SSL_read(\" << ssl << \", buffer, \" << bufsize << ')'"
          ],
          "line": 239
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"read\""
          ],
          "line": 231
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <pthread.h>\n#include <sys/poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/log.h>\n#include <openssl/err.h>\n#include <cxxtools/mutex.h>\n#include \"tnt/tntnet.h\"\n#include \"tnt/openssl.h\"\n\nOpensslStream {\n  int OpensslStream::sslRead(char* buffer, int bufsize) const\n    {\n      // I had crashes without this (and the lock in sslWrite) lock:\n      // openssl should be thread-safe, with the installed callbacks, but I did not\n      // get it working\n      cxxtools::MutexLock lock(mutex);\n  \n      log_debug(\"read\");\n  \n      int n;\n      int err;\n  \n      // non-blocking/with timeout\n  \n      // try read\n      log_debug(\"SSL_read(\" << ssl << \", buffer, \" << bufsize << ')');\n      n = ::SSL_read(ssl, buffer, bufsize);\n      log_debug(\"ssl-read => \" << n);\n  \n      if (n > 0)\n        return n;\n  \n      log_debug(\"SSL_get_error(\" << ssl << \", \" << n << ')');\n      if ((err = SSL_get_error(ssl, n)) != SSL_ERROR_WANT_READ\n       && err != SSL_ERROR_WANT_WRITE)\n        checkSslError();\n  \n      if (getTimeout() == 0)\n      {\n        log_debug(\"read-timeout\");\n        throw cxxtools::IOTimeout();\n      }\n  \n      // no read, timeout > 0 - poll\n      do\n      {\n        poll(SSL_get_error(ssl, n) == SSL_ERROR_WANT_WRITE\n                    ? POLLIN|POLLOUT : POLLIN);\n  \n        log_debug(\"SSL_read(\" << ssl << \", buffer, \" << bufsize << ')');\n        n = ::SSL_read(ssl, buffer, bufsize);\n        log_debug(\"SSL_read returns \" << n);\n        checkSslError();\n  \n      } while (n < 0\n         && ((err = SSL_get_error(ssl, n)) == SSL_ERROR_WANT_READ\n          || err == SSL_ERROR_WANT_WRITE\n          || (err == SSL_ERROR_SYSCALL && errno == EAGAIN)));\n  \n      return n;\n    }\n}"
  },
  {
    "function_name": "handshake",
    "container": "OpensslStream",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/openssl.cpp",
    "lines": "209-222",
    "snippet": "void OpensslStream::handshake(const OpensslServer& server)\n  {\n    log_debug(\"tcp-connection established - build ssltunnel\");\n\n    log_debug(\"SSL_new(\" << server.getSslContext().getPointer() << ')');\n    ssl = SSL_new( server.getSslContext().getPointer() );\n    checkSslError();\n\n    log_debug(\"SSL_set_fd(\" << ssl << \", \" << getFd() << ')');\n    SSL_set_fd(ssl, getFd());\n\n    log_debug(\"SSL_set_accept_state(\" << ssl << ')');\n    SSL_set_accept_state(ssl);\n  }",
    "includes": [
      "#include <pthread.h>",
      "#include <sys/poll.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <cxxtools/ioerror.h>",
      "#include <cxxtools/log.h>",
      "#include <openssl/err.h>",
      "#include <cxxtools/mutex.h>",
      "#include \"tnt/tntnet.h\"",
      "#include \"tnt/openssl.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "SSL_set_accept_state",
          "args": [
            "ssl"
          ],
          "line": 221
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"SSL_set_accept_state(\" << ssl << ')'"
          ],
          "line": 220
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SSL_set_fd",
          "args": [
            "ssl",
            "getFd()"
          ],
          "line": 218
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getFd",
          "args": [],
          "line": 218
        },
        "resolved": true,
        "details": {
          "function_name": "getFd",
          "container": "SslTcpjob",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/job.cpp",
          "lines": "214-217",
          "snippet": "int SslTcpjob::getFd() const\n  {\n    return socket.getFd();\n  }",
          "includes": [
            "#include <fcntl.h>",
            "#include <config.h>",
            "#include <arpa/inet.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#include <cxxtools/log.h>",
            "#include <tnt/ssl.h>",
            "#include <tnt/httpreply.h>",
            "#include \"tnt/tntnet.h\"",
            "#include \"tnt/tcpjob.h\"",
            "#include \"tnt/job.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <fcntl.h>\n#include <config.h>\n#include <arpa/inet.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include <cxxtools/log.h>\n#include <tnt/ssl.h>\n#include <tnt/httpreply.h>\n#include \"tnt/tntnet.h\"\n#include \"tnt/tcpjob.h\"\n#include \"tnt/job.h\"\n\nSslTcpjob {\n  int SslTcpjob::getFd() const\n    {\n      return socket.getFd();\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"SSL_set_fd(\" << ssl << \", \" << getFd() << ')'"
          ],
          "line": 217
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "checkSslError",
          "args": [],
          "line": 215
        },
        "resolved": true,
        "details": {
          "function_name": "checkSslError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/openssl.cpp",
          "lines": "52-69",
          "snippet": "void checkSslError()\n    {\n      unsigned long code = ERR_get_error();\n      if (code != 0)\n      {\n        char buffer[120];\n        if (ERR_error_string(code, buffer))\n        {\n          log_debug(\"SSL-Error \" << code << \": \\\"\" << buffer << '\"');\n          throwOpensslException(buffer, code);\n        }\n        else\n        {\n          log_debug(\"unknown SSL-Error \" << code);\n          throwOpensslException(\"unknown SSL-Error\", code);\n        }\n      }\n    }",
          "includes": [
            "#include <pthread.h>",
            "#include <sys/poll.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <cxxtools/ioerror.h>",
            "#include <cxxtools/log.h>",
            "#include <openssl/err.h>",
            "#include <cxxtools/mutex.h>",
            "#include \"tnt/tntnet.h\"",
            "#include \"tnt/openssl.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <pthread.h>\n#include <sys/poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/log.h>\n#include <openssl/err.h>\n#include <cxxtools/mutex.h>\n#include \"tnt/tntnet.h\"\n#include \"tnt/openssl.h\"\n\nvoid checkSslError()\n    {\n      unsigned long code = ERR_get_error();\n      if (code != 0)\n      {\n        char buffer[120];\n        if (ERR_error_string(code, buffer))\n        {\n          log_debug(\"SSL-Error \" << code << \": \\\"\" << buffer << '\"');\n          throwOpensslException(buffer, code);\n        }\n        else\n        {\n          log_debug(\"unknown SSL-Error \" << code);\n          throwOpensslException(\"unknown SSL-Error\", code);\n        }\n      }\n    }"
        }
      },
      {
        "call_info": {
          "callee": "SSL_new",
          "args": [
            "server.getSslContext().getPointer()"
          ],
          "line": 214
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "server.getSslContext",
          "args": [],
          "line": 214
        },
        "resolved": true,
        "details": {
          "function_name": "getSslContext",
          "container": "OpensslServer",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/openssl.h",
          "lines": "79-79",
          "snippet": "SslCtxPtr getSslContext() const        { return ctx; }",
          "includes": [
            "#include <openssl/ssl.h>",
            "#include <cxxtools/smartptr.h>",
            "#include <cxxtools/net/tcpstream.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <openssl/ssl.h>\n#include <cxxtools/smartptr.h>\n#include <cxxtools/net/tcpstream.h>\n\nOpensslServer {\n  SslCtxPtr getSslContext() const        { return ctx; }\n}"
        }
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"SSL_new(\" << server.getSslContext().getPointer() << ')'"
          ],
          "line": 213
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"tcp-connection established - build ssltunnel\""
          ],
          "line": 211
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <pthread.h>\n#include <sys/poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/log.h>\n#include <openssl/err.h>\n#include <cxxtools/mutex.h>\n#include \"tnt/tntnet.h\"\n#include \"tnt/openssl.h\"\n\nOpensslStream {\n  void OpensslStream::handshake(const OpensslServer& server)\n    {\n      log_debug(\"tcp-connection established - build ssltunnel\");\n  \n      log_debug(\"SSL_new(\" << server.getSslContext().getPointer() << ')');\n      ssl = SSL_new( server.getSslContext().getPointer() );\n      checkSslError();\n  \n      log_debug(\"SSL_set_fd(\" << ssl << \", \" << getFd() << ')');\n      SSL_set_fd(ssl, getFd());\n  \n      log_debug(\"SSL_set_accept_state(\" << ssl << ')');\n      SSL_set_accept_state(ssl);\n    }\n}"
  },
  {
    "function_name": "accept",
    "container": "OpensslStream",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/openssl.cpp",
    "lines": "203-207",
    "snippet": "void OpensslStream::accept(const OpensslServer& server, bool inherit)\n  {\n    log_trace(\"accept\");\n    cxxtools::net::TcpSocket::accept(server, inherit);\n  }",
    "includes": [
      "#include <pthread.h>",
      "#include <sys/poll.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <cxxtools/ioerror.h>",
      "#include <cxxtools/log.h>",
      "#include <openssl/err.h>",
      "#include <cxxtools/mutex.h>",
      "#include \"tnt/tntnet.h\"",
      "#include \"tnt/openssl.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "cxxtools::net::TcpSocket::accept",
          "args": [
            "server",
            "inherit"
          ],
          "line": 206
        },
        "resolved": true,
        "details": {
          "function_name": "accept",
          "container": "OpensslStream",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/openssl.cpp",
          "lines": "203-207",
          "snippet": "void OpensslStream::accept(const OpensslServer& server, bool inherit)\n  {\n    log_trace(\"accept\");\n    cxxtools::net::TcpSocket::accept(server, inherit);\n  }",
          "note": "cyclic_reference_detected"
        }
      },
      {
        "call_info": {
          "callee": "log_trace",
          "args": [
            "\"accept\""
          ],
          "line": 205
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <pthread.h>\n#include <sys/poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/log.h>\n#include <openssl/err.h>\n#include <cxxtools/mutex.h>\n#include \"tnt/tntnet.h\"\n#include \"tnt/openssl.h\"\n\nOpensslStream {\n  void OpensslStream::accept(const OpensslServer& server, bool inherit)\n    {\n      log_trace(\"accept\");\n      cxxtools::net::TcpSocket::accept(server, inherit);\n    }\n}"
  },
  {
    "function_name": "~OpensslStream",
    "container": "OpensslStream",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/openssl.cpp",
    "lines": "186-201",
    "snippet": "OpensslStream::~OpensslStream()\n  {\n    if (ssl && !Tntnet::shouldStop())\n    {\n      try\n      {\n        shutdown();\n      }\n      catch (const std::exception& e)\n      {\n        log_debug(\"error shutting down ssl-conneciton: \" << e.what());\n      }\n\n      SSL_free(ssl);\n    }\n  }",
    "includes": [
      "#include <pthread.h>",
      "#include <sys/poll.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <cxxtools/ioerror.h>",
      "#include <cxxtools/log.h>",
      "#include <openssl/err.h>",
      "#include <cxxtools/mutex.h>",
      "#include \"tnt/tntnet.h\"",
      "#include \"tnt/openssl.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "SSL_free",
          "args": [
            "ssl"
          ],
          "line": 199
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"error shutting down ssl-conneciton: \" << e.what()"
          ],
          "line": 196
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e.what",
          "args": [],
          "line": 196
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "shutdown",
          "args": [],
          "line": 192
        },
        "resolved": true,
        "details": {
          "function_name": "shutdown",
          "container": "OpensslStream",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/openssl.cpp",
          "lines": "318-370",
          "snippet": "void OpensslStream::shutdown() const\n  {\n    cxxtools::MutexLock lock(mutex);\n\n    int n, err;\n    // non-blocking/with timeout\n\n    // try read\n    log_debug(\"SSL_shutdown(\" << ssl << ')');\n    n = ::SSL_shutdown(ssl);\n    log_debug(\"ssl-shutdown => \" << n);\n\n    if (n == 1)\n      return;\n\n    if (n == -1)\n    {\n      log_debug(\"SSL_get_error(\" << ssl << \", \" << n << ')');\n\n      err = SSL_get_error(ssl, n);\n\n      if (err != SSL_ERROR_WANT_READ\n       && err != SSL_ERROR_WANT_WRITE)\n        checkSslError();\n\n      if (getTimeout() == 0)\n      {\n        log_debug(\"shutdown-timeout\");\n        throw cxxtools::IOTimeout();\n      }\n    }\n\n    do\n    {\n      log_debug(\"poll\");\n      poll(err == SSL_ERROR_WANT_WRITE ? POLLIN|POLLOUT : POLLIN);\n\n      log_debug(\"SSL_shutdown(\" << ssl << ')');\n      n = ::SSL_shutdown(ssl);\n      log_debug(\"SSL_shutdown returns \" << n);\n\n      if (n == 1)\n        return;\n\n      if (n == 0)\n        continue;\n\n      checkSslError();\n      err = SSL_get_error(ssl, n);\n\n    } while (err == SSL_ERROR_WANT_READ\n          || err == SSL_ERROR_WANT_WRITE);\n  }",
          "includes": [
            "#include <pthread.h>",
            "#include <sys/poll.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <cxxtools/ioerror.h>",
            "#include <cxxtools/log.h>",
            "#include <openssl/err.h>",
            "#include <cxxtools/mutex.h>",
            "#include \"tnt/tntnet.h\"",
            "#include \"tnt/openssl.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <pthread.h>\n#include <sys/poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/log.h>\n#include <openssl/err.h>\n#include <cxxtools/mutex.h>\n#include \"tnt/tntnet.h\"\n#include \"tnt/openssl.h\"\n\nOpensslStream {\n  void OpensslStream::shutdown() const\n    {\n      cxxtools::MutexLock lock(mutex);\n  \n      int n, err;\n      // non-blocking/with timeout\n  \n      // try read\n      log_debug(\"SSL_shutdown(\" << ssl << ')');\n      n = ::SSL_shutdown(ssl);\n      log_debug(\"ssl-shutdown => \" << n);\n  \n      if (n == 1)\n        return;\n  \n      if (n == -1)\n      {\n        log_debug(\"SSL_get_error(\" << ssl << \", \" << n << ')');\n  \n        err = SSL_get_error(ssl, n);\n  \n        if (err != SSL_ERROR_WANT_READ\n         && err != SSL_ERROR_WANT_WRITE)\n          checkSslError();\n  \n        if (getTimeout() == 0)\n        {\n          log_debug(\"shutdown-timeout\");\n          throw cxxtools::IOTimeout();\n        }\n      }\n  \n      do\n      {\n        log_debug(\"poll\");\n        poll(err == SSL_ERROR_WANT_WRITE ? POLLIN|POLLOUT : POLLIN);\n  \n        log_debug(\"SSL_shutdown(\" << ssl << ')');\n        n = ::SSL_shutdown(ssl);\n        log_debug(\"SSL_shutdown returns \" << n);\n  \n        if (n == 1)\n          return;\n  \n        if (n == 0)\n          continue;\n  \n        checkSslError();\n        err = SSL_get_error(ssl, n);\n  \n      } while (err == SSL_ERROR_WANT_READ\n            || err == SSL_ERROR_WANT_WRITE);\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "Tntnet::shouldStop",
          "args": [],
          "line": 188
        },
        "resolved": true,
        "details": {
          "function_name": "shouldStop",
          "container": "Tntnet",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/tntnet.h",
          "lines": "126-126",
          "snippet": "static bool shouldStop()   { return stop; }",
          "includes": [
            "#include <fstream>",
            "#include <set>",
            "#include <cxxtools/mutex.h>",
            "#include <cxxtools/condition.h>",
            "#include <tnt/scopemanager.h>",
            "#include <tnt/maptarget.h>",
            "#include <tnt/dispatcher.h>",
            "#include <tnt/poller.h>",
            "#include <tnt/job.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <fstream>\n#include <set>\n#include <cxxtools/mutex.h>\n#include <cxxtools/condition.h>\n#include <tnt/scopemanager.h>\n#include <tnt/maptarget.h>\n#include <tnt/dispatcher.h>\n#include <tnt/poller.h>\n#include <tnt/job.h>\n\nTntnet {\n  static bool shouldStop()   { return stop; }\n}"
        }
      }
    ],
    "contextual_snippet": "#include <pthread.h>\n#include <sys/poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/log.h>\n#include <openssl/err.h>\n#include <cxxtools/mutex.h>\n#include \"tnt/tntnet.h\"\n#include \"tnt/openssl.h\"\n\nOpensslStream {\n  OpensslStream::~OpensslStream()\n    {\n      if (ssl && !Tntnet::shouldStop())\n      {\n        try\n        {\n          shutdown();\n        }\n        catch (const std::exception& e)\n        {\n          log_debug(\"error shutting down ssl-conneciton: \" << e.what());\n        }\n  \n        SSL_free(ssl);\n      }\n    }\n}"
  },
  {
    "function_name": "OpensslStream",
    "container": "OpensslStream",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/openssl.cpp",
    "lines": "178-184",
    "snippet": "OpensslStream::OpensslStream(const OpensslServer& server, bool inherit)\n    : ctx(server.getSslContext()),\n      ssl(0)\n  {\n    openssl_init();\n    accept(server, inherit);\n  }",
    "includes": [
      "#include <pthread.h>",
      "#include <sys/poll.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <cxxtools/ioerror.h>",
      "#include <cxxtools/log.h>",
      "#include <openssl/err.h>",
      "#include <cxxtools/mutex.h>",
      "#include \"tnt/tntnet.h\"",
      "#include \"tnt/openssl.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "accept",
          "args": [
            "server",
            "inherit"
          ],
          "line": 183
        },
        "resolved": true,
        "details": {
          "function_name": "accept",
          "container": "OpensslStream",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/openssl.cpp",
          "lines": "203-207",
          "snippet": "void OpensslStream::accept(const OpensslServer& server, bool inherit)\n  {\n    log_trace(\"accept\");\n    cxxtools::net::TcpSocket::accept(server, inherit);\n  }",
          "includes": [
            "#include <pthread.h>",
            "#include <sys/poll.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <cxxtools/ioerror.h>",
            "#include <cxxtools/log.h>",
            "#include <openssl/err.h>",
            "#include <cxxtools/mutex.h>",
            "#include \"tnt/tntnet.h\"",
            "#include \"tnt/openssl.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <pthread.h>\n#include <sys/poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/log.h>\n#include <openssl/err.h>\n#include <cxxtools/mutex.h>\n#include \"tnt/tntnet.h\"\n#include \"tnt/openssl.h\"\n\nOpensslStream {\n  void OpensslStream::accept(const OpensslServer& server, bool inherit)\n    {\n      log_trace(\"accept\");\n      cxxtools::net::TcpSocket::accept(server, inherit);\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "openssl_init",
          "args": [],
          "line": 182
        },
        "resolved": true,
        "details": {
          "function_name": "openssl_init",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/openssl.cpp",
          "lines": "103-122",
          "snippet": "static void openssl_init()\n  {\n    static bool initialized = false;\n\n    if (!initialized)\n    {\n      cxxtools::MutexLock lock(mutex);\n      if (!initialized)\n      {\n        log_debug(\"SSL_load_error_strings\");\n        SSL_load_error_strings();\n        log_debug(\"SSL_library_init\");\n        SSL_library_init();\n\n        checkSslError();\n        thread_setup();\n        initialized = true;\n      }\n    }\n  }",
          "includes": [
            "#include <pthread.h>",
            "#include <sys/poll.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <cxxtools/ioerror.h>",
            "#include <cxxtools/log.h>",
            "#include <openssl/err.h>",
            "#include <cxxtools/mutex.h>",
            "#include \"tnt/tntnet.h\"",
            "#include \"tnt/openssl.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <pthread.h>\n#include <sys/poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/log.h>\n#include <openssl/err.h>\n#include <cxxtools/mutex.h>\n#include \"tnt/tntnet.h\"\n#include \"tnt/openssl.h\"\n\nstatic void openssl_init()\n  {\n    static bool initialized = false;\n\n    if (!initialized)\n    {\n      cxxtools::MutexLock lock(mutex);\n      if (!initialized)\n      {\n        log_debug(\"SSL_load_error_strings\");\n        SSL_load_error_strings();\n        log_debug(\"SSL_library_init\");\n        SSL_library_init();\n\n        checkSslError();\n        thread_setup();\n        initialized = true;\n      }\n    }\n  }"
        }
      },
      {
        "call_info": {
          "callee": "server.getSslContext",
          "args": [],
          "line": 179
        },
        "resolved": true,
        "details": {
          "function_name": "getSslContext",
          "container": "OpensslServer",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/openssl.h",
          "lines": "79-79",
          "snippet": "SslCtxPtr getSslContext() const        { return ctx; }",
          "includes": [
            "#include <openssl/ssl.h>",
            "#include <cxxtools/smartptr.h>",
            "#include <cxxtools/net/tcpstream.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <openssl/ssl.h>\n#include <cxxtools/smartptr.h>\n#include <cxxtools/net/tcpstream.h>\n\nOpensslServer {\n  SslCtxPtr getSslContext() const        { return ctx; }\n}"
        }
      }
    ],
    "contextual_snippet": "#include <pthread.h>\n#include <sys/poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/log.h>\n#include <openssl/err.h>\n#include <cxxtools/mutex.h>\n#include \"tnt/tntnet.h\"\n#include \"tnt/openssl.h\"\n\nOpensslStream {\n  OpensslStream::OpensslStream(const OpensslServer& server, bool inherit)\n      : ctx(server.getSslContext()),\n        ssl(0)\n    {\n      openssl_init();\n      accept(server, inherit);\n    }\n}"
  },
  {
    "function_name": "OpensslStream",
    "container": "OpensslStream",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/openssl.cpp",
    "lines": "172-176",
    "snippet": "OpensslStream::OpensslStream()\n    : ssl(0)\n  {\n    openssl_init();\n  }",
    "includes": [
      "#include <pthread.h>",
      "#include <sys/poll.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <cxxtools/ioerror.h>",
      "#include <cxxtools/log.h>",
      "#include <openssl/err.h>",
      "#include <cxxtools/mutex.h>",
      "#include \"tnt/tntnet.h\"",
      "#include \"tnt/openssl.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "openssl_init",
          "args": [],
          "line": 175
        },
        "resolved": true,
        "details": {
          "function_name": "openssl_init",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/openssl.cpp",
          "lines": "103-122",
          "snippet": "static void openssl_init()\n  {\n    static bool initialized = false;\n\n    if (!initialized)\n    {\n      cxxtools::MutexLock lock(mutex);\n      if (!initialized)\n      {\n        log_debug(\"SSL_load_error_strings\");\n        SSL_load_error_strings();\n        log_debug(\"SSL_library_init\");\n        SSL_library_init();\n\n        checkSslError();\n        thread_setup();\n        initialized = true;\n      }\n    }\n  }",
          "includes": [
            "#include <pthread.h>",
            "#include <sys/poll.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <cxxtools/ioerror.h>",
            "#include <cxxtools/log.h>",
            "#include <openssl/err.h>",
            "#include <cxxtools/mutex.h>",
            "#include \"tnt/tntnet.h\"",
            "#include \"tnt/openssl.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <pthread.h>\n#include <sys/poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/log.h>\n#include <openssl/err.h>\n#include <cxxtools/mutex.h>\n#include \"tnt/tntnet.h\"\n#include \"tnt/openssl.h\"\n\nstatic void openssl_init()\n  {\n    static bool initialized = false;\n\n    if (!initialized)\n    {\n      cxxtools::MutexLock lock(mutex);\n      if (!initialized)\n      {\n        log_debug(\"SSL_load_error_strings\");\n        SSL_load_error_strings();\n        log_debug(\"SSL_library_init\");\n        SSL_library_init();\n\n        checkSslError();\n        thread_setup();\n        initialized = true;\n      }\n    }\n  }"
        }
      }
    ],
    "contextual_snippet": "#include <pthread.h>\n#include <sys/poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/log.h>\n#include <openssl/err.h>\n#include <cxxtools/mutex.h>\n#include \"tnt/tntnet.h\"\n#include \"tnt/openssl.h\"\n\nOpensslStream {\n  OpensslStream::OpensslStream()\n      : ssl(0)\n    {\n      openssl_init();\n    }\n}"
  },
  {
    "function_name": "destroy",
    "container": "SslCtxReleaser<SSL_CTX>",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/openssl.cpp",
    "lines": "163-167",
    "snippet": "void SslCtxReleaser<SSL_CTX>::destroy(SSL_CTX* ctx)\n  {\n    log_debug(\"SSL_CTX_free(ctx)\");\n    SSL_CTX_free(ctx);\n  }",
    "includes": [
      "#include <pthread.h>",
      "#include <sys/poll.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <cxxtools/ioerror.h>",
      "#include <cxxtools/log.h>",
      "#include <openssl/err.h>",
      "#include <cxxtools/mutex.h>",
      "#include \"tnt/tntnet.h\"",
      "#include \"tnt/openssl.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "SSL_CTX_free",
          "args": [
            "ctx"
          ],
          "line": 166
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"SSL_CTX_free(ctx)\""
          ],
          "line": 165
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <pthread.h>\n#include <sys/poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/log.h>\n#include <openssl/err.h>\n#include <cxxtools/mutex.h>\n#include \"tnt/tntnet.h\"\n#include \"tnt/openssl.h\"\n\nSslCtxReleaser<SSL_CTX> {\n  void SslCtxReleaser<SSL_CTX>::destroy(SSL_CTX* ctx)\n    {\n      log_debug(\"SSL_CTX_free(ctx)\");\n      SSL_CTX_free(ctx);\n    }\n}"
  },
  {
    "function_name": "OpensslServer",
    "container": "OpensslServer",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/openssl.cpp",
    "lines": "152-161",
    "snippet": "OpensslServer::OpensslServer(const char* certificateFile, const char* privateKeyFile)\n  {\n    openssl_init();\n\n    log_debug(\"SSL_CTX_new(SSLv23_server_method())\");\n    ctx = SSL_CTX_new(SSLv23_server_method());\n    checkSslError();\n\n    installCertificates(certificateFile, privateKeyFile);\n  }",
    "includes": [
      "#include <pthread.h>",
      "#include <sys/poll.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <cxxtools/ioerror.h>",
      "#include <cxxtools/log.h>",
      "#include <openssl/err.h>",
      "#include <cxxtools/mutex.h>",
      "#include \"tnt/tntnet.h\"",
      "#include \"tnt/openssl.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "installCertificates",
          "args": [
            "certificateFile",
            "privateKeyFile"
          ],
          "line": 160
        },
        "resolved": true,
        "details": {
          "function_name": "installCertificates",
          "container": "OpensslServer",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/openssl.cpp",
          "lines": "124-139",
          "snippet": "void OpensslServer::installCertificates(const char* certificateFile, const char* privateKeyFile)\n  {\n    log_debug(\"use certificate file \" << certificateFile);\n    if (SSL_CTX_use_certificate_chain_file(ctx.getPointer(), certificateFile) <= 0)\n      checkSslError();\n\n    log_debug(\"use private key file \" << privateKeyFile);\n    if (SSL_CTX_use_PrivateKey_file(ctx.getPointer(), privateKeyFile, SSL_FILETYPE_PEM) <= 0)\n      checkSslError();\n\n    log_debug(\"check private key\");\n    if (!SSL_CTX_check_private_key(ctx.getPointer()))\n      throwOpensslException(\"private key does not match the certificate public key\", 0);\n\n    log_debug(\"private key ok\");\n  }",
          "includes": [
            "#include <pthread.h>",
            "#include <sys/poll.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <cxxtools/ioerror.h>",
            "#include <cxxtools/log.h>",
            "#include <openssl/err.h>",
            "#include <cxxtools/mutex.h>",
            "#include \"tnt/tntnet.h\"",
            "#include \"tnt/openssl.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <pthread.h>\n#include <sys/poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/log.h>\n#include <openssl/err.h>\n#include <cxxtools/mutex.h>\n#include \"tnt/tntnet.h\"\n#include \"tnt/openssl.h\"\n\nOpensslServer {\n  void OpensslServer::installCertificates(const char* certificateFile, const char* privateKeyFile)\n    {\n      log_debug(\"use certificate file \" << certificateFile);\n      if (SSL_CTX_use_certificate_chain_file(ctx.getPointer(), certificateFile) <= 0)\n        checkSslError();\n  \n      log_debug(\"use private key file \" << privateKeyFile);\n      if (SSL_CTX_use_PrivateKey_file(ctx.getPointer(), privateKeyFile, SSL_FILETYPE_PEM) <= 0)\n        checkSslError();\n  \n      log_debug(\"check private key\");\n      if (!SSL_CTX_check_private_key(ctx.getPointer()))\n        throwOpensslException(\"private key does not match the certificate public key\", 0);\n  \n      log_debug(\"private key ok\");\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "checkSslError",
          "args": [],
          "line": 158
        },
        "resolved": true,
        "details": {
          "function_name": "checkSslError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/openssl.cpp",
          "lines": "52-69",
          "snippet": "void checkSslError()\n    {\n      unsigned long code = ERR_get_error();\n      if (code != 0)\n      {\n        char buffer[120];\n        if (ERR_error_string(code, buffer))\n        {\n          log_debug(\"SSL-Error \" << code << \": \\\"\" << buffer << '\"');\n          throwOpensslException(buffer, code);\n        }\n        else\n        {\n          log_debug(\"unknown SSL-Error \" << code);\n          throwOpensslException(\"unknown SSL-Error\", code);\n        }\n      }\n    }",
          "includes": [
            "#include <pthread.h>",
            "#include <sys/poll.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <cxxtools/ioerror.h>",
            "#include <cxxtools/log.h>",
            "#include <openssl/err.h>",
            "#include <cxxtools/mutex.h>",
            "#include \"tnt/tntnet.h\"",
            "#include \"tnt/openssl.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <pthread.h>\n#include <sys/poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/log.h>\n#include <openssl/err.h>\n#include <cxxtools/mutex.h>\n#include \"tnt/tntnet.h\"\n#include \"tnt/openssl.h\"\n\nvoid checkSslError()\n    {\n      unsigned long code = ERR_get_error();\n      if (code != 0)\n      {\n        char buffer[120];\n        if (ERR_error_string(code, buffer))\n        {\n          log_debug(\"SSL-Error \" << code << \": \\\"\" << buffer << '\"');\n          throwOpensslException(buffer, code);\n        }\n        else\n        {\n          log_debug(\"unknown SSL-Error \" << code);\n          throwOpensslException(\"unknown SSL-Error\", code);\n        }\n      }\n    }"
        }
      },
      {
        "call_info": {
          "callee": "SSL_CTX_new",
          "args": [
            "SSLv23_server_method()"
          ],
          "line": 157
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SSLv23_server_method",
          "args": [],
          "line": 157
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"SSL_CTX_new(SSLv23_server_method())\""
          ],
          "line": 156
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "openssl_init",
          "args": [],
          "line": 154
        },
        "resolved": true,
        "details": {
          "function_name": "openssl_init",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/openssl.cpp",
          "lines": "103-122",
          "snippet": "static void openssl_init()\n  {\n    static bool initialized = false;\n\n    if (!initialized)\n    {\n      cxxtools::MutexLock lock(mutex);\n      if (!initialized)\n      {\n        log_debug(\"SSL_load_error_strings\");\n        SSL_load_error_strings();\n        log_debug(\"SSL_library_init\");\n        SSL_library_init();\n\n        checkSslError();\n        thread_setup();\n        initialized = true;\n      }\n    }\n  }",
          "includes": [
            "#include <pthread.h>",
            "#include <sys/poll.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <cxxtools/ioerror.h>",
            "#include <cxxtools/log.h>",
            "#include <openssl/err.h>",
            "#include <cxxtools/mutex.h>",
            "#include \"tnt/tntnet.h\"",
            "#include \"tnt/openssl.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <pthread.h>\n#include <sys/poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/log.h>\n#include <openssl/err.h>\n#include <cxxtools/mutex.h>\n#include \"tnt/tntnet.h\"\n#include \"tnt/openssl.h\"\n\nstatic void openssl_init()\n  {\n    static bool initialized = false;\n\n    if (!initialized)\n    {\n      cxxtools::MutexLock lock(mutex);\n      if (!initialized)\n      {\n        log_debug(\"SSL_load_error_strings\");\n        SSL_load_error_strings();\n        log_debug(\"SSL_library_init\");\n        SSL_library_init();\n\n        checkSslError();\n        thread_setup();\n        initialized = true;\n      }\n    }\n  }"
        }
      }
    ],
    "contextual_snippet": "#include <pthread.h>\n#include <sys/poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/log.h>\n#include <openssl/err.h>\n#include <cxxtools/mutex.h>\n#include \"tnt/tntnet.h\"\n#include \"tnt/openssl.h\"\n\nOpensslServer {\n  OpensslServer::OpensslServer(const char* certificateFile, const char* privateKeyFile)\n    {\n      openssl_init();\n  \n      log_debug(\"SSL_CTX_new(SSLv23_server_method())\");\n      ctx = SSL_CTX_new(SSLv23_server_method());\n      checkSslError();\n  \n      installCertificates(certificateFile, privateKeyFile);\n    }\n}"
  },
  {
    "function_name": "OpensslServer",
    "container": "OpensslServer",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/openssl.cpp",
    "lines": "141-150",
    "snippet": "OpensslServer::OpensslServer(const char* certificateFile)\n  {\n    openssl_init();\n\n    log_debug(\"SSL_CTX_new(SSLv23_server_method())\");\n    ctx = SSL_CTX_new(SSLv23_server_method());\n    checkSslError();\n\n    installCertificates(certificateFile, certificateFile);\n  }",
    "includes": [
      "#include <pthread.h>",
      "#include <sys/poll.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <cxxtools/ioerror.h>",
      "#include <cxxtools/log.h>",
      "#include <openssl/err.h>",
      "#include <cxxtools/mutex.h>",
      "#include \"tnt/tntnet.h\"",
      "#include \"tnt/openssl.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "installCertificates",
          "args": [
            "certificateFile",
            "certificateFile"
          ],
          "line": 149
        },
        "resolved": true,
        "details": {
          "function_name": "installCertificates",
          "container": "OpensslServer",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/openssl.cpp",
          "lines": "124-139",
          "snippet": "void OpensslServer::installCertificates(const char* certificateFile, const char* privateKeyFile)\n  {\n    log_debug(\"use certificate file \" << certificateFile);\n    if (SSL_CTX_use_certificate_chain_file(ctx.getPointer(), certificateFile) <= 0)\n      checkSslError();\n\n    log_debug(\"use private key file \" << privateKeyFile);\n    if (SSL_CTX_use_PrivateKey_file(ctx.getPointer(), privateKeyFile, SSL_FILETYPE_PEM) <= 0)\n      checkSslError();\n\n    log_debug(\"check private key\");\n    if (!SSL_CTX_check_private_key(ctx.getPointer()))\n      throwOpensslException(\"private key does not match the certificate public key\", 0);\n\n    log_debug(\"private key ok\");\n  }",
          "includes": [
            "#include <pthread.h>",
            "#include <sys/poll.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <cxxtools/ioerror.h>",
            "#include <cxxtools/log.h>",
            "#include <openssl/err.h>",
            "#include <cxxtools/mutex.h>",
            "#include \"tnt/tntnet.h\"",
            "#include \"tnt/openssl.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <pthread.h>\n#include <sys/poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/log.h>\n#include <openssl/err.h>\n#include <cxxtools/mutex.h>\n#include \"tnt/tntnet.h\"\n#include \"tnt/openssl.h\"\n\nOpensslServer {\n  void OpensslServer::installCertificates(const char* certificateFile, const char* privateKeyFile)\n    {\n      log_debug(\"use certificate file \" << certificateFile);\n      if (SSL_CTX_use_certificate_chain_file(ctx.getPointer(), certificateFile) <= 0)\n        checkSslError();\n  \n      log_debug(\"use private key file \" << privateKeyFile);\n      if (SSL_CTX_use_PrivateKey_file(ctx.getPointer(), privateKeyFile, SSL_FILETYPE_PEM) <= 0)\n        checkSslError();\n  \n      log_debug(\"check private key\");\n      if (!SSL_CTX_check_private_key(ctx.getPointer()))\n        throwOpensslException(\"private key does not match the certificate public key\", 0);\n  \n      log_debug(\"private key ok\");\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "checkSslError",
          "args": [],
          "line": 147
        },
        "resolved": true,
        "details": {
          "function_name": "checkSslError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/openssl.cpp",
          "lines": "52-69",
          "snippet": "void checkSslError()\n    {\n      unsigned long code = ERR_get_error();\n      if (code != 0)\n      {\n        char buffer[120];\n        if (ERR_error_string(code, buffer))\n        {\n          log_debug(\"SSL-Error \" << code << \": \\\"\" << buffer << '\"');\n          throwOpensslException(buffer, code);\n        }\n        else\n        {\n          log_debug(\"unknown SSL-Error \" << code);\n          throwOpensslException(\"unknown SSL-Error\", code);\n        }\n      }\n    }",
          "includes": [
            "#include <pthread.h>",
            "#include <sys/poll.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <cxxtools/ioerror.h>",
            "#include <cxxtools/log.h>",
            "#include <openssl/err.h>",
            "#include <cxxtools/mutex.h>",
            "#include \"tnt/tntnet.h\"",
            "#include \"tnt/openssl.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <pthread.h>\n#include <sys/poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/log.h>\n#include <openssl/err.h>\n#include <cxxtools/mutex.h>\n#include \"tnt/tntnet.h\"\n#include \"tnt/openssl.h\"\n\nvoid checkSslError()\n    {\n      unsigned long code = ERR_get_error();\n      if (code != 0)\n      {\n        char buffer[120];\n        if (ERR_error_string(code, buffer))\n        {\n          log_debug(\"SSL-Error \" << code << \": \\\"\" << buffer << '\"');\n          throwOpensslException(buffer, code);\n        }\n        else\n        {\n          log_debug(\"unknown SSL-Error \" << code);\n          throwOpensslException(\"unknown SSL-Error\", code);\n        }\n      }\n    }"
        }
      },
      {
        "call_info": {
          "callee": "SSL_CTX_new",
          "args": [
            "SSLv23_server_method()"
          ],
          "line": 146
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SSLv23_server_method",
          "args": [],
          "line": 146
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"SSL_CTX_new(SSLv23_server_method())\""
          ],
          "line": 145
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "openssl_init",
          "args": [],
          "line": 143
        },
        "resolved": true,
        "details": {
          "function_name": "openssl_init",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/openssl.cpp",
          "lines": "103-122",
          "snippet": "static void openssl_init()\n  {\n    static bool initialized = false;\n\n    if (!initialized)\n    {\n      cxxtools::MutexLock lock(mutex);\n      if (!initialized)\n      {\n        log_debug(\"SSL_load_error_strings\");\n        SSL_load_error_strings();\n        log_debug(\"SSL_library_init\");\n        SSL_library_init();\n\n        checkSslError();\n        thread_setup();\n        initialized = true;\n      }\n    }\n  }",
          "includes": [
            "#include <pthread.h>",
            "#include <sys/poll.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <cxxtools/ioerror.h>",
            "#include <cxxtools/log.h>",
            "#include <openssl/err.h>",
            "#include <cxxtools/mutex.h>",
            "#include \"tnt/tntnet.h\"",
            "#include \"tnt/openssl.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <pthread.h>\n#include <sys/poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/log.h>\n#include <openssl/err.h>\n#include <cxxtools/mutex.h>\n#include \"tnt/tntnet.h\"\n#include \"tnt/openssl.h\"\n\nstatic void openssl_init()\n  {\n    static bool initialized = false;\n\n    if (!initialized)\n    {\n      cxxtools::MutexLock lock(mutex);\n      if (!initialized)\n      {\n        log_debug(\"SSL_load_error_strings\");\n        SSL_load_error_strings();\n        log_debug(\"SSL_library_init\");\n        SSL_library_init();\n\n        checkSslError();\n        thread_setup();\n        initialized = true;\n      }\n    }\n  }"
        }
      }
    ],
    "contextual_snippet": "#include <pthread.h>\n#include <sys/poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/log.h>\n#include <openssl/err.h>\n#include <cxxtools/mutex.h>\n#include \"tnt/tntnet.h\"\n#include \"tnt/openssl.h\"\n\nOpensslServer {\n  OpensslServer::OpensslServer(const char* certificateFile)\n    {\n      openssl_init();\n  \n      log_debug(\"SSL_CTX_new(SSLv23_server_method())\");\n      ctx = SSL_CTX_new(SSLv23_server_method());\n      checkSslError();\n  \n      installCertificates(certificateFile, certificateFile);\n    }\n}"
  },
  {
    "function_name": "installCertificates",
    "container": "OpensslServer",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/openssl.cpp",
    "lines": "124-139",
    "snippet": "void OpensslServer::installCertificates(const char* certificateFile, const char* privateKeyFile)\n  {\n    log_debug(\"use certificate file \" << certificateFile);\n    if (SSL_CTX_use_certificate_chain_file(ctx.getPointer(), certificateFile) <= 0)\n      checkSslError();\n\n    log_debug(\"use private key file \" << privateKeyFile);\n    if (SSL_CTX_use_PrivateKey_file(ctx.getPointer(), privateKeyFile, SSL_FILETYPE_PEM) <= 0)\n      checkSslError();\n\n    log_debug(\"check private key\");\n    if (!SSL_CTX_check_private_key(ctx.getPointer()))\n      throwOpensslException(\"private key does not match the certificate public key\", 0);\n\n    log_debug(\"private key ok\");\n  }",
    "includes": [
      "#include <pthread.h>",
      "#include <sys/poll.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <cxxtools/ioerror.h>",
      "#include <cxxtools/log.h>",
      "#include <openssl/err.h>",
      "#include <cxxtools/mutex.h>",
      "#include \"tnt/tntnet.h\"",
      "#include \"tnt/openssl.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"private key ok\""
          ],
          "line": 138
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "throwOpensslException",
          "args": [
            "\"private key does not match the certificate public key\"",
            "0"
          ],
          "line": 136
        },
        "resolved": true,
        "details": {
          "function_name": "throwOpensslException",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/openssl.cpp",
          "lines": "47-50",
          "snippet": "void throwOpensslException(const char* what, unsigned long code)\n    {\n      throw OpensslException(what, code);\n    }",
          "includes": [
            "#include <pthread.h>",
            "#include <sys/poll.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <cxxtools/ioerror.h>",
            "#include <cxxtools/log.h>",
            "#include <openssl/err.h>",
            "#include <cxxtools/mutex.h>",
            "#include \"tnt/tntnet.h\"",
            "#include \"tnt/openssl.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <pthread.h>\n#include <sys/poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/log.h>\n#include <openssl/err.h>\n#include <cxxtools/mutex.h>\n#include \"tnt/tntnet.h\"\n#include \"tnt/openssl.h\"\n\nvoid throwOpensslException(const char* what, unsigned long code)\n    {\n      throw OpensslException(what, code);\n    }"
        }
      },
      {
        "call_info": {
          "callee": "SSL_CTX_check_private_key",
          "args": [
            "ctx.getPointer()"
          ],
          "line": 135
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ctx.getPointer",
          "args": [],
          "line": 135
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"check private key\""
          ],
          "line": 134
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "checkSslError",
          "args": [],
          "line": 132
        },
        "resolved": true,
        "details": {
          "function_name": "checkSslError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/openssl.cpp",
          "lines": "52-69",
          "snippet": "void checkSslError()\n    {\n      unsigned long code = ERR_get_error();\n      if (code != 0)\n      {\n        char buffer[120];\n        if (ERR_error_string(code, buffer))\n        {\n          log_debug(\"SSL-Error \" << code << \": \\\"\" << buffer << '\"');\n          throwOpensslException(buffer, code);\n        }\n        else\n        {\n          log_debug(\"unknown SSL-Error \" << code);\n          throwOpensslException(\"unknown SSL-Error\", code);\n        }\n      }\n    }",
          "includes": [
            "#include <pthread.h>",
            "#include <sys/poll.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <cxxtools/ioerror.h>",
            "#include <cxxtools/log.h>",
            "#include <openssl/err.h>",
            "#include <cxxtools/mutex.h>",
            "#include \"tnt/tntnet.h\"",
            "#include \"tnt/openssl.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <pthread.h>\n#include <sys/poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/log.h>\n#include <openssl/err.h>\n#include <cxxtools/mutex.h>\n#include \"tnt/tntnet.h\"\n#include \"tnt/openssl.h\"\n\nvoid checkSslError()\n    {\n      unsigned long code = ERR_get_error();\n      if (code != 0)\n      {\n        char buffer[120];\n        if (ERR_error_string(code, buffer))\n        {\n          log_debug(\"SSL-Error \" << code << \": \\\"\" << buffer << '\"');\n          throwOpensslException(buffer, code);\n        }\n        else\n        {\n          log_debug(\"unknown SSL-Error \" << code);\n          throwOpensslException(\"unknown SSL-Error\", code);\n        }\n      }\n    }"
        }
      },
      {
        "call_info": {
          "callee": "SSL_CTX_use_PrivateKey_file",
          "args": [
            "ctx.getPointer()",
            "privateKeyFile",
            "SSL_FILETYPE_PEM"
          ],
          "line": 131
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ctx.getPointer",
          "args": [],
          "line": 131
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"use private key file \" << privateKeyFile"
          ],
          "line": 130
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SSL_CTX_use_certificate_chain_file",
          "args": [
            "ctx.getPointer()",
            "certificateFile"
          ],
          "line": 127
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ctx.getPointer",
          "args": [],
          "line": 127
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"use certificate file \" << certificateFile"
          ],
          "line": 126
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <pthread.h>\n#include <sys/poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/log.h>\n#include <openssl/err.h>\n#include <cxxtools/mutex.h>\n#include \"tnt/tntnet.h\"\n#include \"tnt/openssl.h\"\n\nOpensslServer {\n  void OpensslServer::installCertificates(const char* certificateFile, const char* privateKeyFile)\n    {\n      log_debug(\"use certificate file \" << certificateFile);\n      if (SSL_CTX_use_certificate_chain_file(ctx.getPointer(), certificateFile) <= 0)\n        checkSslError();\n  \n      log_debug(\"use private key file \" << privateKeyFile);\n      if (SSL_CTX_use_PrivateKey_file(ctx.getPointer(), privateKeyFile, SSL_FILETYPE_PEM) <= 0)\n        checkSslError();\n  \n      log_debug(\"check private key\");\n      if (!SSL_CTX_check_private_key(ctx.getPointer()))\n        throwOpensslException(\"private key does not match the certificate public key\", 0);\n  \n      log_debug(\"private key ok\");\n    }\n}"
  },
  {
    "function_name": "openssl_init",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/openssl.cpp",
    "lines": "103-122",
    "snippet": "static void openssl_init()\n  {\n    static bool initialized = false;\n\n    if (!initialized)\n    {\n      cxxtools::MutexLock lock(mutex);\n      if (!initialized)\n      {\n        log_debug(\"SSL_load_error_strings\");\n        SSL_load_error_strings();\n        log_debug(\"SSL_library_init\");\n        SSL_library_init();\n\n        checkSslError();\n        thread_setup();\n        initialized = true;\n      }\n    }\n  }",
    "includes": [
      "#include <pthread.h>",
      "#include <sys/poll.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <cxxtools/ioerror.h>",
      "#include <cxxtools/log.h>",
      "#include <openssl/err.h>",
      "#include <cxxtools/mutex.h>",
      "#include \"tnt/tntnet.h\"",
      "#include \"tnt/openssl.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "thread_setup",
          "args": [],
          "line": 118
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "checkSslError",
          "args": [],
          "line": 117
        },
        "resolved": true,
        "details": {
          "function_name": "checkSslError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/openssl.cpp",
          "lines": "52-69",
          "snippet": "void checkSslError()\n    {\n      unsigned long code = ERR_get_error();\n      if (code != 0)\n      {\n        char buffer[120];\n        if (ERR_error_string(code, buffer))\n        {\n          log_debug(\"SSL-Error \" << code << \": \\\"\" << buffer << '\"');\n          throwOpensslException(buffer, code);\n        }\n        else\n        {\n          log_debug(\"unknown SSL-Error \" << code);\n          throwOpensslException(\"unknown SSL-Error\", code);\n        }\n      }\n    }",
          "includes": [
            "#include <pthread.h>",
            "#include <sys/poll.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <cxxtools/ioerror.h>",
            "#include <cxxtools/log.h>",
            "#include <openssl/err.h>",
            "#include <cxxtools/mutex.h>",
            "#include \"tnt/tntnet.h\"",
            "#include \"tnt/openssl.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <pthread.h>\n#include <sys/poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/log.h>\n#include <openssl/err.h>\n#include <cxxtools/mutex.h>\n#include \"tnt/tntnet.h\"\n#include \"tnt/openssl.h\"\n\nvoid checkSslError()\n    {\n      unsigned long code = ERR_get_error();\n      if (code != 0)\n      {\n        char buffer[120];\n        if (ERR_error_string(code, buffer))\n        {\n          log_debug(\"SSL-Error \" << code << \": \\\"\" << buffer << '\"');\n          throwOpensslException(buffer, code);\n        }\n        else\n        {\n          log_debug(\"unknown SSL-Error \" << code);\n          throwOpensslException(\"unknown SSL-Error\", code);\n        }\n      }\n    }"
        }
      },
      {
        "call_info": {
          "callee": "SSL_library_init",
          "args": [],
          "line": 115
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"SSL_library_init\""
          ],
          "line": 114
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SSL_load_error_strings",
          "args": [],
          "line": 113
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"SSL_load_error_strings\""
          ],
          "line": 112
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <pthread.h>\n#include <sys/poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/log.h>\n#include <openssl/err.h>\n#include <cxxtools/mutex.h>\n#include \"tnt/tntnet.h\"\n#include \"tnt/openssl.h\"\n\nstatic void openssl_init()\n  {\n    static bool initialized = false;\n\n    if (!initialized)\n    {\n      cxxtools::MutexLock lock(mutex);\n      if (!initialized)\n      {\n        log_debug(\"SSL_load_error_strings\");\n        SSL_load_error_strings();\n        log_debug(\"SSL_library_init\");\n        SSL_library_init();\n\n        checkSslError();\n        thread_setup();\n        initialized = true;\n      }\n    }\n  }"
  },
  {
    "function_name": "thread_setup",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/openssl.cpp",
    "lines": "94-100",
    "snippet": "static void thread_setup(void)\n  {\n    openssl_mutex = new cxxtools::Mutex[CRYPTO_num_locks()];\n\n    CRYPTO_set_id_callback(pthreads_thread_id);\n    CRYPTO_set_locking_callback(pthreads_locking_callback);\n  }",
    "includes": [
      "#include <pthread.h>",
      "#include <sys/poll.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <cxxtools/ioerror.h>",
      "#include <cxxtools/log.h>",
      "#include <openssl/err.h>",
      "#include <cxxtools/mutex.h>",
      "#include \"tnt/tntnet.h\"",
      "#include \"tnt/openssl.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "CRYPTO_set_locking_callback",
          "args": [
            "pthreads_locking_callback"
          ],
          "line": 99
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "CRYPTO_set_id_callback",
          "args": [
            "pthreads_thread_id"
          ],
          "line": 98
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "CRYPTO_num_locks",
          "args": [],
          "line": 96
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <pthread.h>\n#include <sys/poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/log.h>\n#include <openssl/err.h>\n#include <cxxtools/mutex.h>\n#include \"tnt/tntnet.h\"\n#include \"tnt/openssl.h\"\n\nstatic void thread_setup(void)\n  {\n    openssl_mutex = new cxxtools::Mutex[CRYPTO_num_locks()];\n\n    CRYPTO_set_id_callback(pthreads_thread_id);\n    CRYPTO_set_locking_callback(pthreads_locking_callback);\n  }"
  },
  {
    "function_name": "pthreads_locking_callback",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/openssl.cpp",
    "lines": "79-92",
    "snippet": "static void pthreads_locking_callback(int mode, int n, const char *file,\n    int line)\n  {\n    /*\n    log_debug(\"pthreads_locking_callback \" << CRYPTO_thread_id()\n      << \" n=\" << n\n      << \" mode=\" << ((mode & CRYPTO_LOCK) ? 'l' : 'u')\n      << ' ' << file << ':' << line); */\n\n    if (mode & CRYPTO_LOCK)\n      openssl_mutex[n].lock();\n    else\n      openssl_mutex[n].unlock();\n  }",
    "includes": [
      "#include <pthread.h>",
      "#include <sys/poll.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <cxxtools/ioerror.h>",
      "#include <cxxtools/log.h>",
      "#include <openssl/err.h>",
      "#include <cxxtools/mutex.h>",
      "#include \"tnt/tntnet.h\"",
      "#include \"tnt/openssl.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "openssl_mutex[n].unlock",
          "args": [],
          "line": 91
        },
        "resolved": true,
        "details": {
          "function_name": "unlock",
          "container": "Scope",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/scope.h",
          "lines": "70-70",
          "snippet": "void unlock() { mutex.unlock(); }",
          "includes": [
            "#include <cxxtools/refcounted.h>",
            "#include <cxxtools/mutex.h>",
            "#include <tnt/object.h>",
            "#include <string>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <cxxtools/refcounted.h>\n#include <cxxtools/mutex.h>\n#include <tnt/object.h>\n#include <string>\n#include <map>\n\nScope {\n  void unlock() { mutex.unlock(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "openssl_mutex[n].lock",
          "args": [],
          "line": 89
        },
        "resolved": true,
        "details": {
          "function_name": "lock",
          "container": "Scope",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/scope.h",
          "lines": "69-69",
          "snippet": "void lock()   { mutex.lock(); }",
          "includes": [
            "#include <cxxtools/refcounted.h>",
            "#include <cxxtools/mutex.h>",
            "#include <tnt/object.h>",
            "#include <string>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <cxxtools/refcounted.h>\n#include <cxxtools/mutex.h>\n#include <tnt/object.h>\n#include <string>\n#include <map>\n\nScope {\n  void lock()   { mutex.lock(); }\n}"
        }
      }
    ],
    "contextual_snippet": "#include <pthread.h>\n#include <sys/poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/log.h>\n#include <openssl/err.h>\n#include <cxxtools/mutex.h>\n#include \"tnt/tntnet.h\"\n#include \"tnt/openssl.h\"\n\nstatic void pthreads_locking_callback(int mode, int n, const char *file,\n    int line)\n  {\n    /*\n    log_debug(\"pthreads_locking_callback \" << CRYPTO_thread_id()\n      << \" n=\" << n\n      << \" mode=\" << ((mode & CRYPTO_LOCK) ? 'l' : 'u')\n      << ' ' << file << ':' << line); */\n\n    if (mode & CRYPTO_LOCK)\n      openssl_mutex[n].lock();\n    else\n      openssl_mutex[n].unlock();\n  }"
  },
  {
    "function_name": "pthreads_thread_id",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/openssl.cpp",
    "lines": "74-77",
    "snippet": "static unsigned long pthreads_thread_id()\n  {\n    return (unsigned long)pthread_self();\n  }",
    "includes": [
      "#include <pthread.h>",
      "#include <sys/poll.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <cxxtools/ioerror.h>",
      "#include <cxxtools/log.h>",
      "#include <openssl/err.h>",
      "#include <cxxtools/mutex.h>",
      "#include \"tnt/tntnet.h\"",
      "#include \"tnt/openssl.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "pthread_self",
          "args": [],
          "line": 76
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <pthread.h>\n#include <sys/poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/log.h>\n#include <openssl/err.h>\n#include <cxxtools/mutex.h>\n#include \"tnt/tntnet.h\"\n#include \"tnt/openssl.h\"\n\nstatic unsigned long pthreads_thread_id()\n  {\n    return (unsigned long)pthread_self();\n  }"
  },
  {
    "function_name": "checkSslError",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/openssl.cpp",
    "lines": "52-69",
    "snippet": "void checkSslError()\n    {\n      unsigned long code = ERR_get_error();\n      if (code != 0)\n      {\n        char buffer[120];\n        if (ERR_error_string(code, buffer))\n        {\n          log_debug(\"SSL-Error \" << code << \": \\\"\" << buffer << '\"');\n          throwOpensslException(buffer, code);\n        }\n        else\n        {\n          log_debug(\"unknown SSL-Error \" << code);\n          throwOpensslException(\"unknown SSL-Error\", code);\n        }\n      }\n    }",
    "includes": [
      "#include <pthread.h>",
      "#include <sys/poll.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <cxxtools/ioerror.h>",
      "#include <cxxtools/log.h>",
      "#include <openssl/err.h>",
      "#include <cxxtools/mutex.h>",
      "#include \"tnt/tntnet.h\"",
      "#include \"tnt/openssl.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "throwOpensslException",
          "args": [
            "\"unknown SSL-Error\"",
            "code"
          ],
          "line": 66
        },
        "resolved": true,
        "details": {
          "function_name": "throwOpensslException",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/openssl.cpp",
          "lines": "47-50",
          "snippet": "void throwOpensslException(const char* what, unsigned long code)\n    {\n      throw OpensslException(what, code);\n    }",
          "includes": [
            "#include <pthread.h>",
            "#include <sys/poll.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <cxxtools/ioerror.h>",
            "#include <cxxtools/log.h>",
            "#include <openssl/err.h>",
            "#include <cxxtools/mutex.h>",
            "#include \"tnt/tntnet.h\"",
            "#include \"tnt/openssl.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <pthread.h>\n#include <sys/poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/log.h>\n#include <openssl/err.h>\n#include <cxxtools/mutex.h>\n#include \"tnt/tntnet.h\"\n#include \"tnt/openssl.h\"\n\nvoid throwOpensslException(const char* what, unsigned long code)\n    {\n      throw OpensslException(what, code);\n    }"
        }
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"unknown SSL-Error \" << code"
          ],
          "line": 65
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"SSL-Error \" << code << \": \\\"\" << buffer << '\"'"
          ],
          "line": 60
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ERR_error_string",
          "args": [
            "code",
            "buffer"
          ],
          "line": 58
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ERR_get_error",
          "args": [],
          "line": 54
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <pthread.h>\n#include <sys/poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/log.h>\n#include <openssl/err.h>\n#include <cxxtools/mutex.h>\n#include \"tnt/tntnet.h\"\n#include \"tnt/openssl.h\"\n\nvoid checkSslError()\n    {\n      unsigned long code = ERR_get_error();\n      if (code != 0)\n      {\n        char buffer[120];\n        if (ERR_error_string(code, buffer))\n        {\n          log_debug(\"SSL-Error \" << code << \": \\\"\" << buffer << '\"');\n          throwOpensslException(buffer, code);\n        }\n        else\n        {\n          log_debug(\"unknown SSL-Error \" << code);\n          throwOpensslException(\"unknown SSL-Error\", code);\n        }\n      }\n    }"
  },
  {
    "function_name": "throwOpensslException",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/openssl.cpp",
    "lines": "47-50",
    "snippet": "void throwOpensslException(const char* what, unsigned long code)\n    {\n      throw OpensslException(what, code);\n    }",
    "includes": [
      "#include <pthread.h>",
      "#include <sys/poll.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <cxxtools/ioerror.h>",
      "#include <cxxtools/log.h>",
      "#include <openssl/err.h>",
      "#include <cxxtools/mutex.h>",
      "#include \"tnt/tntnet.h\"",
      "#include \"tnt/openssl.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "OpensslException",
          "args": [
            "what",
            "code"
          ],
          "line": 49
        },
        "resolved": true,
        "details": {
          "function_name": "throwOpensslException",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/openssl.cpp",
          "lines": "47-50",
          "snippet": "void throwOpensslException(const char* what, unsigned long code)\n    {\n      throw OpensslException(what, code);\n    }",
          "note": "cyclic_reference_detected"
        }
      }
    ],
    "contextual_snippet": "#include <pthread.h>\n#include <sys/poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <cxxtools/ioerror.h>\n#include <cxxtools/log.h>\n#include <openssl/err.h>\n#include <cxxtools/mutex.h>\n#include \"tnt/tntnet.h\"\n#include \"tnt/openssl.h\"\n\nvoid throwOpensslException(const char* what, unsigned long code)\n    {\n      throw OpensslException(what, code);\n    }"
  }
]