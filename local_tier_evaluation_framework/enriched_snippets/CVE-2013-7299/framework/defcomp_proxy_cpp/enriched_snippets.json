[
  {
    "function_name": "operator()",
    "container": "Proxy",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/defcomp/proxy.cpp",
    "lines": "90-230",
    "snippet": "unsigned Proxy::operator() (tnt::HttpRequest& request,\n    tnt::HttpReply& reply, tnt::QueryParams& qparam)\n  {\n    if (request.getArgs().size() < 1)\n    {\n      log_error(\"proxy uri missing in configuration\");\n      throw std::runtime_error(\"proxy uri missing in configuration\");\n    }\n\n    TNT_THREAD_COMPONENT_VAR(std::string, currentProxyHost, ());\n    TNT_THREAD_COMPONENT_VAR(unsigned short, currentProxyPort, ());\n    TNT_THREAD_COMPONENT_VAR(cxxtools::http::Client, client, ());\n\n    cxxtools::net::Uri uri(request.getArg(0));\n\n    std::string url = uri.path();\n    bool urlEndsWithSlash = !url.empty() && url[url.size()-1] == '/';\n    bool pathInfoStartsWithSlash = !request.getPathInfo().empty() && request.getPathInfo()[0] == '/';\n\n    if (urlEndsWithSlash\n      && pathInfoStartsWithSlash)\n    {\n      // Avoid double slash, if getPathInfo starts with '/' (which is normally the case).\n      url.erase (url.size()-1, 1);\n    }\n    else if (!urlEndsWithSlash\n      && !pathInfoStartsWithSlash)\n    {\n      url += '/';\n    }\n\n    url += request.getPathInfo();\n    if (!request.getQueryString().empty())\n    {\n      url += '?';\n      url += request.getQueryString();\n    }\n\n    if (currentProxyHost != uri.host() || currentProxyPort != uri.port())\n    {\n      log_debug(\"connect to \" << uri.host() << ':' << uri.port());\n      client.connect(uri.host(), uri.port());\n      currentProxyHost = uri.host();\n      currentProxyPort = uri.port();\n    }\n    else\n      log_debug(\"already connected to \" << uri.host() << ':' << uri.port());\n\n    log_info(\"get file \" << url << \" qparam=\" << qparam.getUrl() << \" from \" << uri.host() << ':' << uri.port() << \" body size=\" << request.getBody().size());\n\n    // set up client request\n    cxxtools::http::Request clientRequest(url);\n\n    clientRequest.method(request.getMethod());\n\n    clientRequest.body() << request.getBody();\n\n    const char* value;\n\n    clientRequest.setHeader (\"Host\", uri.host().c_str());\n\n    std::string peerIp = request.getPeerIp();\n    clientRequest.setHeader (\"X-Real-IP\", peerIp.c_str());\n    clientRequest.addHeader (\"X-Forwarded-For\", peerIp.c_str());\n\n    value = request.getHeader(tnt::httpheader::contentType, 0);\n    if (value)\n      clientRequest.header().setHeader(\"Content-Type\", value);\n\n    value = request.getHeader(tnt::httpheader::cookie, 0);\n    if (value)\n      clientRequest.header().setHeader(\"Cookie\", value);\n\n    value = request.getHeader(tnt::httpheader::authorization, 0);\n    if (value)\n      clientRequest.header().setHeader(\"Authorization\", value);\n\n    value = request.getHeader(tnt::httpheader::ifModifiedSince, 0);\n    if (value)\n      clientRequest.header().setHeader(\"If-Modified-Since\", value);\n\n    // execute client request\n    client.execute(clientRequest);\n\n    // retrieve result\n    std::string body = client.readBody();\n\n    unsigned httpReturnCode = client.header().httpReturnCode();\n    const char* contentType = client.header().getHeader(\"Content-type\");\n\n    for (cxxtools::http::MessageHeader::const_iterator it = client.header().begin();\n        it != client.header().end(); ++it)\n    {\n      if (strcasecmp(it->first, \"Set-Cookie\") == 0)\n      {\n        log_info(\"cookie: \" << it->first << \" value: \" << it->second);\n        reply.setHeader(tnt::httpheader::setCookie, it->second, false);\n      }\n    }\n\n    value = client.header().getHeader (\"p3p\");\n    if (value)\n      reply.setHeader(\"p3p:\", value);\n\n    value = client.header().getHeader(\"Cache-Control\");\n    if (value)\n      reply.setHeader(tnt::httpheader::cacheControl, value);\n\n    value = client.header().getHeader(\"Expires\");\n    if (value)\n      reply.setHeader(tnt::httpheader::expires, value);\n\n    value = client.header().getHeader(\"Last-Modified\");\n    if (value)\n      reply.setHeader(tnt::httpheader::lastModified, value);\n\n    value = client.header().getHeader(\"Location\");\n    if (value)\n      reply.setHeader(tnt::httpheader::location, value);\n\n    value = client.header().getHeader(\"Content-Disposition\");\n    if (value)\n      reply.setHeader(\"Content-Disposition:\", value);\n\n    value = client.header().getHeader(\"WWW-Authenticate\");\n    if (value)\n      reply.setHeader(tnt::httpheader::wwwAuthenticate, value);\n\n    log_debug(\"got file \" << request.getPathInfo() << \" with http return code=\" << httpReturnCode << \" content type=\" << (contentType ? contentType : \"NULL\"));\n\n    if (httpReturnCode == HTTP_NOT_FOUND)\n      return DECLINED;\n\n    if (contentType)\n      reply.setContentType(contentType);\n\n    reply.out() << body;\n\n    return httpReturnCode;\n\n  }",
    "includes": [
      "#include <string.h>",
      "#include <cxxtools/log.h>",
      "#include <cxxtools/net/uri.h>",
      "#include <cxxtools/http/reply.h>",
      "#include <cxxtools/http/request.h>",
      "#include <cxxtools/http/client.h>",
      "#include <tnt/http.h>",
      "#include <tnt/httpreply.h>",
      "#include <tnt/httprequest.h>",
      "#include <tnt/ecpp.h>",
      "#include <tnt/componentfactory.h>",
      "#include <tnt/component.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "reply.out",
          "args": [],
          "line": 226
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "reply.setContentType",
          "args": [
            "contentType"
          ],
          "line": 224
        },
        "resolved": true,
        "details": {
          "function_name": "setContentType",
          "container": "HttpReply",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/httpreply.h",
          "lines": "61-61",
          "snippet": "void setContentType(const std::string& t)     { setHeader(httpheader::contentType, t); }",
          "includes": [
            "#include <iosfwd>",
            "#include <tnt/http.h>",
            "#include <tnt/httpmessage.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <iosfwd>\n#include <tnt/http.h>\n#include <tnt/httpmessage.h>\n\nHttpReply {\n  void setContentType(const std::string& t)     { setHeader(httpheader::contentType, t); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"got file \" << request.getPathInfo() << \" with http return code=\" << httpReturnCode << \" content type=\" << (contentType ? contentType : \"NULL\")"
          ],
          "line": 218
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "request.getPathInfo",
          "args": [],
          "line": 218
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "reply.setHeader",
          "args": [
            "tnt::httpheader::wwwAuthenticate",
            "value"
          ],
          "line": 216
        },
        "resolved": true,
        "details": {
          "function_name": "setHeader",
          "container": "HttpMessage",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/httpmessage.h",
          "lines": "91-92",
          "snippet": "void setHeader(const std::string& key, const std::string& value, bool replace = true)\n        { header.setHeader(key, value, replace); }",
          "includes": [
            "#include <time.h>",
            "#include <tnt/cookie.h>",
            "#include <tnt/httpheader.h>",
            "#include <tnt/messageheader.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <time.h>\n#include <tnt/cookie.h>\n#include <tnt/httpheader.h>\n#include <tnt/messageheader.h>\n\nHttpMessage {\n  void setHeader(const std::string& key, const std::string& value, bool replace = true)\n          { header.setHeader(key, value, replace); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "client.header",
          "args": [
            "\"WWW-Authenticate\""
          ],
          "line": 214
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "client.header",
          "args": [],
          "line": 214
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "client.header",
          "args": [
            "\"Content-Disposition\""
          ],
          "line": 210
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "client.header",
          "args": [],
          "line": 210
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "client.header",
          "args": [
            "\"Location\""
          ],
          "line": 206
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "client.header",
          "args": [],
          "line": 206
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "client.header",
          "args": [
            "\"Last-Modified\""
          ],
          "line": 202
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "client.header",
          "args": [],
          "line": 202
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "client.header",
          "args": [
            "\"Expires\""
          ],
          "line": 198
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "client.header",
          "args": [],
          "line": 198
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "client.header",
          "args": [
            "\"Cache-Control\""
          ],
          "line": 194
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "client.header",
          "args": [],
          "line": 194
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "client.header",
          "args": [
            "\"p3p\""
          ],
          "line": 190
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "client.header",
          "args": [],
          "line": 190
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "reply.setHeader",
          "args": [
            "tnt::httpheader::setCookie",
            "it->second",
            "false"
          ],
          "line": 186
        },
        "resolved": true,
        "details": {
          "function_name": "setHeader",
          "container": "Messageheader",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/messageheader.cpp",
          "lines": "101-126",
          "snippet": "void Messageheader::setHeader(const char* key, const char* value, bool replace)\n  {\n    if (!*key)\n      throw std::runtime_error(\"empty key not allowed in messageheader\");\n\n    if (replace)\n      removeHeader(key);\n\n    char* p = getEnd();\n\n    size_t lk = std::strlen(key);     // length of key\n    size_t lk2 = key[lk-1] == ':' ? lk + 1 : lk + 2;  // length of key including trailing ':' and terminator\n    size_t lv = std::strlen(value);   // length of value\n\n    if (p - rawdata + lk2 + lv + 3 > MAXHEADERSIZE)\n      throw std::runtime_error(\"message header too big\");\n\n    std::strcpy(p, key);   // copy key\n    p += lk2;\n    *(p - 2) = ':';        // make sure, key is prepended by ':'\n    *(p - 1) = '\\0';\n    std::strcpy(p, value); // copy value\n    p[lv + 1] = '\\0';      // put new message end marker in place\n\n    endOffset = (p + lv + 1) - rawdata;\n  }",
          "includes": [
            "#include <cstring>",
            "#include <tnt/stringlessignorecase.h>",
            "#include <stdexcept>",
            "#include <cxxtools/log.h>",
            "#include <tnt/messageheaderparser.h>",
            "#include <tnt/messageheader.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <cstring>\n#include <tnt/stringlessignorecase.h>\n#include <stdexcept>\n#include <cxxtools/log.h>\n#include <tnt/messageheaderparser.h>\n#include <tnt/messageheader.h>\n\nMessageheader {\n  void Messageheader::setHeader(const char* key, const char* value, bool replace)\n    {\n      if (!*key)\n        throw std::runtime_error(\"empty key not allowed in messageheader\");\n  \n      if (replace)\n        removeHeader(key);\n  \n      char* p = getEnd();\n  \n      size_t lk = std::strlen(key);     // length of key\n      size_t lk2 = key[lk-1] == ':' ? lk + 1 : lk + 2;  // length of key including trailing ':' and terminator\n      size_t lv = std::strlen(value);   // length of value\n  \n      if (p - rawdata + lk2 + lv + 3 > MAXHEADERSIZE)\n        throw std::runtime_error(\"message header too big\");\n  \n      std::strcpy(p, key);   // copy key\n      p += lk2;\n      *(p - 2) = ':';        // make sure, key is prepended by ':'\n      *(p - 1) = '\\0';\n      std::strcpy(p, value); // copy value\n      p[lv + 1] = '\\0';      // put new message end marker in place\n  \n      endOffset = (p + lv + 1) - rawdata;\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "log_info",
          "args": [
            "\"cookie: \" << it->first << \" value: \" << it->second"
          ],
          "line": 185
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcasecmp",
          "args": [
            "it->first",
            "\"Set-Cookie\""
          ],
          "line": 183
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "client.header",
          "args": [],
          "line": 181
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "client.header",
          "args": [],
          "line": 181
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "client.header",
          "args": [],
          "line": 180
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "client.header",
          "args": [],
          "line": 180
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "client.header",
          "args": [
            "\"Content-type\""
          ],
          "line": 178
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "client.header",
          "args": [],
          "line": 178
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "client.header",
          "args": [],
          "line": 177
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "client.header",
          "args": [],
          "line": 177
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "client.readBody",
          "args": [],
          "line": 175
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "client.execute",
          "args": [
            "clientRequest"
          ],
          "line": 172
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "clientRequest.header",
          "args": [
            "\"If-Modified-Since\"",
            "value"
          ],
          "line": 169
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "clientRequest.header",
          "args": [],
          "line": 169
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "request.getHeader",
          "args": [
            "tnt::httpheader::ifModifiedSince",
            "0"
          ],
          "line": 167
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "clientRequest.header",
          "args": [
            "\"Authorization\"",
            "value"
          ],
          "line": 165
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "clientRequest.header",
          "args": [],
          "line": 165
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "request.getHeader",
          "args": [
            "tnt::httpheader::authorization",
            "0"
          ],
          "line": 163
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "clientRequest.header",
          "args": [
            "\"Cookie\"",
            "value"
          ],
          "line": 161
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "clientRequest.header",
          "args": [],
          "line": 161
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "request.getHeader",
          "args": [
            "tnt::httpheader::cookie",
            "0"
          ],
          "line": 159
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "clientRequest.header",
          "args": [
            "\"Content-Type\"",
            "value"
          ],
          "line": 157
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "clientRequest.header",
          "args": [],
          "line": 157
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "request.getHeader",
          "args": [
            "tnt::httpheader::contentType",
            "0"
          ],
          "line": 155
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "clientRequest.addHeader",
          "args": [
            "\"X-Forwarded-For\"",
            "peerIp.c_str()"
          ],
          "line": 153
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "peerIp.c_str",
          "args": [],
          "line": 153
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "peerIp.c_str",
          "args": [],
          "line": 152
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "request.getPeerIp",
          "args": [],
          "line": 151
        },
        "resolved": true,
        "details": {
          "function_name": "getPeerIp",
          "container": "SslTcpjob",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/job.cpp",
          "lines": "148-151",
          "snippet": "std::string SslTcpjob::getPeerIp() const\n  {\n    return socket.getPeerAddr();\n  }",
          "includes": [
            "#include <fcntl.h>",
            "#include <config.h>",
            "#include <arpa/inet.h>",
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#include <cxxtools/log.h>",
            "#include <tnt/ssl.h>",
            "#include <tnt/httpreply.h>",
            "#include \"tnt/tntnet.h\"",
            "#include \"tnt/tcpjob.h\"",
            "#include \"tnt/job.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <fcntl.h>\n#include <config.h>\n#include <arpa/inet.h>\n#include <sys/socket.h>\n#include <sys/types.h>\n#include <cxxtools/log.h>\n#include <tnt/ssl.h>\n#include <tnt/httpreply.h>\n#include \"tnt/tntnet.h\"\n#include \"tnt/tcpjob.h\"\n#include \"tnt/job.h\"\n\nSslTcpjob {\n  std::string SslTcpjob::getPeerIp() const\n    {\n      return socket.getPeerAddr();\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "uri.host",
          "args": [],
          "line": 149
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "uri.host",
          "args": [],
          "line": 149
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "request.getBody",
          "args": [],
          "line": 145
        },
        "resolved": true,
        "details": {
          "function_name": "getBody",
          "container": "Part",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/multipart.h",
          "lines": "102-103",
          "snippet": "std::string getBody() const\n        { return std::string(getBodyBegin(), getBodyEnd()); }",
          "includes": [
            "#include <iterator>",
            "#include <vector>",
            "#include <tnt/contentdisposition.h>",
            "#include <tnt/messageheader.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <iterator>\n#include <vector>\n#include <tnt/contentdisposition.h>\n#include <tnt/messageheader.h>\n\nPart {\n  std::string getBody() const\n          { return std::string(getBodyBegin(), getBodyEnd()); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "clientRequest.body",
          "args": [],
          "line": 145
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "clientRequest.method",
          "args": [
            "request.getMethod()"
          ],
          "line": 143
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "request.getMethod",
          "args": [],
          "line": 143
        },
        "resolved": true,
        "details": {
          "function_name": "getMethod",
          "container": "HttpRequest",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/httprequest.h",
          "lines": "134-134",
          "snippet": "std::string getMethod() const             { return method; }",
          "includes": [
            "#include <cstring>",
            "#include <string>",
            "#include <cxxtools/atomicity.h>",
            "#include <map>",
            "#include <locale>",
            "#include <tnt/threadcontext.h>",
            "#include <tnt/scope.h>",
            "#include <tnt/query_params.h>",
            "#include <tnt/encoding.h>",
            "#include <tnt/cookie.h>",
            "#include <tnt/multipart.h>",
            "#include <tnt/contenttype.h>",
            "#include <tnt/socketif.h>",
            "#include <tnt/httpheader.h>",
            "#include <tnt/httpmessage.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <cstring>\n#include <string>\n#include <cxxtools/atomicity.h>\n#include <map>\n#include <locale>\n#include <tnt/threadcontext.h>\n#include <tnt/scope.h>\n#include <tnt/query_params.h>\n#include <tnt/encoding.h>\n#include <tnt/cookie.h>\n#include <tnt/multipart.h>\n#include <tnt/contenttype.h>\n#include <tnt/socketif.h>\n#include <tnt/httpheader.h>\n#include <tnt/httpmessage.h>\n\nHttpRequest {\n  std::string getMethod() const             { return method; }\n}"
        }
      },
      {
        "call_info": {
          "callee": "log_info",
          "args": [
            "\"get file \" << url << \" qparam=\" << qparam.getUrl() << \" from \" << uri.host() << ':' << uri.port() << \" body size=\" << request.getBody().size()"
          ],
          "line": 138
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "uri.port",
          "args": [],
          "line": 138
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "uri.host",
          "args": [],
          "line": 138
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "qparam.getUrl",
          "args": [],
          "line": 138
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"already connected to \" << uri.host() << ':' << uri.port()"
          ],
          "line": 136
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "uri.port",
          "args": [],
          "line": 136
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "uri.host",
          "args": [],
          "line": 136
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "uri.port",
          "args": [],
          "line": 133
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "uri.host",
          "args": [],
          "line": 132
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "client.connect",
          "args": [
            "uri.host()",
            "uri.port()"
          ],
          "line": 131
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "uri.port",
          "args": [],
          "line": 131
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "uri.host",
          "args": [],
          "line": 131
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_debug",
          "args": [
            "\"connect to \" << uri.host() << ':' << uri.port()"
          ],
          "line": 130
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "uri.port",
          "args": [],
          "line": 130
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "uri.host",
          "args": [],
          "line": 130
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "uri.port",
          "args": [],
          "line": 128
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "uri.host",
          "args": [],
          "line": 128
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "request.getQueryString",
          "args": [],
          "line": 125
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "request.getQueryString",
          "args": [],
          "line": 122
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "request.getQueryString",
          "args": [],
          "line": 122
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "request.getPathInfo",
          "args": [],
          "line": 121
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "url.erase",
          "args": [
            "url.size()-1",
            "1"
          ],
          "line": 113
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "url.size",
          "args": [],
          "line": 113
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "Pstr",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/httpmessage.cpp",
          "lines": "155-155",
          "snippet": "size_type size() const  { return end - start; }",
          "includes": [
            "#include <stdio.h>",
            "#include <sstream>",
            "#include <list>",
            "#include <cxxtools/mutex.h>",
            "#include <cxxtools/log.h>",
            "#include <tnt/httpmessage.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <stdio.h>\n#include <sstream>\n#include <list>\n#include <cxxtools/mutex.h>\n#include <cxxtools/log.h>\n#include <tnt/httpmessage.h>\n\nPstr {\n  size_type size() const  { return end - start; }\n}"
        }
      },
      {
        "call_info": {
          "callee": "request.getPathInfo",
          "args": [],
          "line": 107
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "request.getPathInfo",
          "args": [],
          "line": 107
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "request.getPathInfo",
          "args": [],
          "line": 107
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "url.empty",
          "args": [],
          "line": 106
        },
        "resolved": true,
        "details": {
          "function_name": "empty",
          "container": "Pstr",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/httpmessage.cpp",
          "lines": "156-156",
          "snippet": "bool empty() const      { return start == end; }",
          "includes": [
            "#include <stdio.h>",
            "#include <sstream>",
            "#include <list>",
            "#include <cxxtools/mutex.h>",
            "#include <cxxtools/log.h>",
            "#include <tnt/httpmessage.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <stdio.h>\n#include <sstream>\n#include <list>\n#include <cxxtools/mutex.h>\n#include <cxxtools/log.h>\n#include <tnt/httpmessage.h>\n\nPstr {\n  bool empty() const      { return start == end; }\n}"
        }
      },
      {
        "call_info": {
          "callee": "uri.path",
          "args": [],
          "line": 105
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "request.getArg",
          "args": [
            "0"
          ],
          "line": 103
        },
        "resolved": true,
        "details": {
          "function_name": "getArg",
          "container": "HttpRequest",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/common/tnt/httprequest.h",
          "lines": "163-163",
          "snippet": "std::string getArg(args_type::size_type n) const { return getArgDef(n); }",
          "includes": [
            "#include <cstring>",
            "#include <string>",
            "#include <cxxtools/atomicity.h>",
            "#include <map>",
            "#include <locale>",
            "#include <tnt/threadcontext.h>",
            "#include <tnt/scope.h>",
            "#include <tnt/query_params.h>",
            "#include <tnt/encoding.h>",
            "#include <tnt/cookie.h>",
            "#include <tnt/multipart.h>",
            "#include <tnt/contenttype.h>",
            "#include <tnt/socketif.h>",
            "#include <tnt/httpheader.h>",
            "#include <tnt/httpmessage.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <cstring>\n#include <string>\n#include <cxxtools/atomicity.h>\n#include <map>\n#include <locale>\n#include <tnt/threadcontext.h>\n#include <tnt/scope.h>\n#include <tnt/query_params.h>\n#include <tnt/encoding.h>\n#include <tnt/cookie.h>\n#include <tnt/multipart.h>\n#include <tnt/contenttype.h>\n#include <tnt/socketif.h>\n#include <tnt/httpheader.h>\n#include <tnt/httpmessage.h>\n\nHttpRequest {\n  std::string getArg(args_type::size_type n) const { return getArgDef(n); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "TNT_THREAD_COMPONENT_VAR",
          "args": [
            "cxxtools::http::Client",
            "client",
            "()"
          ],
          "line": 101
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TNT_THREAD_COMPONENT_VAR",
          "args": [
            "std::string",
            "currentProxyHost",
            "()"
          ],
          "line": 99
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "std::runtime_error",
          "args": [
            "\"proxy uri missing in configuration\""
          ],
          "line": 96
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "log_error",
          "args": [
            "\"proxy uri missing in configuration\""
          ],
          "line": 95
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "request.getArgs",
          "args": [],
          "line": 93
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "request.getArgs",
          "args": [],
          "line": 93
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <string.h>\n#include <cxxtools/log.h>\n#include <cxxtools/net/uri.h>\n#include <cxxtools/http/reply.h>\n#include <cxxtools/http/request.h>\n#include <cxxtools/http/client.h>\n#include <tnt/http.h>\n#include <tnt/httpreply.h>\n#include <tnt/httprequest.h>\n#include <tnt/ecpp.h>\n#include <tnt/componentfactory.h>\n#include <tnt/component.h>\n\nProxy {\n  unsigned Proxy::operator() (tnt::HttpRequest& request,\n      tnt::HttpReply& reply, tnt::QueryParams& qparam)\n    {\n      if (request.getArgs().size() < 1)\n      {\n        log_error(\"proxy uri missing in configuration\");\n        throw std::runtime_error(\"proxy uri missing in configuration\");\n      }\n  \n      TNT_THREAD_COMPONENT_VAR(std::string, currentProxyHost, ());\n      TNT_THREAD_COMPONENT_VAR(unsigned short, currentProxyPort, ());\n      TNT_THREAD_COMPONENT_VAR(cxxtools::http::Client, client, ());\n  \n      cxxtools::net::Uri uri(request.getArg(0));\n  \n      std::string url = uri.path();\n      bool urlEndsWithSlash = !url.empty() && url[url.size()-1] == '/';\n      bool pathInfoStartsWithSlash = !request.getPathInfo().empty() && request.getPathInfo()[0] == '/';\n  \n      if (urlEndsWithSlash\n        && pathInfoStartsWithSlash)\n      {\n        // Avoid double slash, if getPathInfo starts with '/' (which is normally the case).\n        url.erase (url.size()-1, 1);\n      }\n      else if (!urlEndsWithSlash\n        && !pathInfoStartsWithSlash)\n      {\n        url += '/';\n      }\n  \n      url += request.getPathInfo();\n      if (!request.getQueryString().empty())\n      {\n        url += '?';\n        url += request.getQueryString();\n      }\n  \n      if (currentProxyHost != uri.host() || currentProxyPort != uri.port())\n      {\n        log_debug(\"connect to \" << uri.host() << ':' << uri.port());\n        client.connect(uri.host(), uri.port());\n        currentProxyHost = uri.host();\n        currentProxyPort = uri.port();\n      }\n      else\n        log_debug(\"already connected to \" << uri.host() << ':' << uri.port());\n  \n      log_info(\"get file \" << url << \" qparam=\" << qparam.getUrl() << \" from \" << uri.host() << ':' << uri.port() << \" body size=\" << request.getBody().size());\n  \n      // set up client request\n      cxxtools::http::Request clientRequest(url);\n  \n      clientRequest.method(request.getMethod());\n  \n      clientRequest.body() << request.getBody();\n  \n      const char* value;\n  \n      clientRequest.setHeader (\"Host\", uri.host().c_str());\n  \n      std::string peerIp = request.getPeerIp();\n      clientRequest.setHeader (\"X-Real-IP\", peerIp.c_str());\n      clientRequest.addHeader (\"X-Forwarded-For\", peerIp.c_str());\n  \n      value = request.getHeader(tnt::httpheader::contentType, 0);\n      if (value)\n        clientRequest.header().setHeader(\"Content-Type\", value);\n  \n      value = request.getHeader(tnt::httpheader::cookie, 0);\n      if (value)\n        clientRequest.header().setHeader(\"Cookie\", value);\n  \n      value = request.getHeader(tnt::httpheader::authorization, 0);\n      if (value)\n        clientRequest.header().setHeader(\"Authorization\", value);\n  \n      value = request.getHeader(tnt::httpheader::ifModifiedSince, 0);\n      if (value)\n        clientRequest.header().setHeader(\"If-Modified-Since\", value);\n  \n      // execute client request\n      client.execute(clientRequest);\n  \n      // retrieve result\n      std::string body = client.readBody();\n  \n      unsigned httpReturnCode = client.header().httpReturnCode();\n      const char* contentType = client.header().getHeader(\"Content-type\");\n  \n      for (cxxtools::http::MessageHeader::const_iterator it = client.header().begin();\n          it != client.header().end(); ++it)\n      {\n        if (strcasecmp(it->first, \"Set-Cookie\") == 0)\n        {\n          log_info(\"cookie: \" << it->first << \" value: \" << it->second);\n          reply.setHeader(tnt::httpheader::setCookie, it->second, false);\n        }\n      }\n  \n      value = client.header().getHeader (\"p3p\");\n      if (value)\n        reply.setHeader(\"p3p:\", value);\n  \n      value = client.header().getHeader(\"Cache-Control\");\n      if (value)\n        reply.setHeader(tnt::httpheader::cacheControl, value);\n  \n      value = client.header().getHeader(\"Expires\");\n      if (value)\n        reply.setHeader(tnt::httpheader::expires, value);\n  \n      value = client.header().getHeader(\"Last-Modified\");\n      if (value)\n        reply.setHeader(tnt::httpheader::lastModified, value);\n  \n      value = client.header().getHeader(\"Location\");\n      if (value)\n        reply.setHeader(tnt::httpheader::location, value);\n  \n      value = client.header().getHeader(\"Content-Disposition\");\n      if (value)\n        reply.setHeader(\"Content-Disposition:\", value);\n  \n      value = client.header().getHeader(\"WWW-Authenticate\");\n      if (value)\n        reply.setHeader(tnt::httpheader::wwwAuthenticate, value);\n  \n      log_debug(\"got file \" << request.getPathInfo() << \" with http return code=\" << httpReturnCode << \" content type=\" << (contentType ? contentType : \"NULL\"));\n  \n      if (httpReturnCode == HTTP_NOT_FOUND)\n        return DECLINED;\n  \n      if (contentType)\n        reply.setContentType(contentType);\n  \n      reply.out() << body;\n  \n      return httpReturnCode;\n  \n    }\n}"
  },
  {
    "function_name": "ProxyFactory",
    "container": "ProxyFactory",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/defcomp/proxy.cpp",
    "lines": "71-73",
    "snippet": "ProxyFactory(const std::string& componentName)\n        : tnt::ComponentFactory(componentName)\n        { }",
    "includes": [
      "#include <string.h>",
      "#include <cxxtools/log.h>",
      "#include <cxxtools/net/uri.h>",
      "#include <cxxtools/http/reply.h>",
      "#include <cxxtools/http/request.h>",
      "#include <cxxtools/http/client.h>",
      "#include <tnt/http.h>",
      "#include <tnt/httpreply.h>",
      "#include <tnt/httprequest.h>",
      "#include <tnt/ecpp.h>",
      "#include <tnt/componentfactory.h>",
      "#include <tnt/component.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include <string.h>\n#include <cxxtools/log.h>\n#include <cxxtools/net/uri.h>\n#include <cxxtools/http/reply.h>\n#include <cxxtools/http/request.h>\n#include <cxxtools/http/client.h>\n#include <tnt/http.h>\n#include <tnt/httpreply.h>\n#include <tnt/httprequest.h>\n#include <tnt/ecpp.h>\n#include <tnt/componentfactory.h>\n#include <tnt/component.h>\n\nProxyFactory {\n  ProxyFactory(const std::string& componentName)\n          : tnt::ComponentFactory(componentName)\n          { }\n}"
  },
  {
    "function_name": "Proxy",
    "container": "Proxy",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2013-7299/repo/framework/defcomp/proxy.cpp",
    "lines": "57-59",
    "snippet": "Proxy(const tnt::Compident& ci, const tnt::Urlmapper& um, tnt::Comploader& cl)\n        : EcppComponent(ci, um, cl)\n        { }",
    "includes": [
      "#include <string.h>",
      "#include <cxxtools/log.h>",
      "#include <cxxtools/net/uri.h>",
      "#include <cxxtools/http/reply.h>",
      "#include <cxxtools/http/request.h>",
      "#include <cxxtools/http/client.h>",
      "#include <tnt/http.h>",
      "#include <tnt/httpreply.h>",
      "#include <tnt/httprequest.h>",
      "#include <tnt/ecpp.h>",
      "#include <tnt/componentfactory.h>",
      "#include <tnt/component.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include <string.h>\n#include <cxxtools/log.h>\n#include <cxxtools/net/uri.h>\n#include <cxxtools/http/reply.h>\n#include <cxxtools/http/request.h>\n#include <cxxtools/http/client.h>\n#include <tnt/http.h>\n#include <tnt/httpreply.h>\n#include <tnt/httprequest.h>\n#include <tnt/ecpp.h>\n#include <tnt/componentfactory.h>\n#include <tnt/component.h>\n\nProxy {\n  Proxy(const tnt::Compident& ci, const tnt::Urlmapper& um, tnt::Comploader& cl)\n          : EcppComponent(ci, um, cl)\n          { }\n}"
  }
]