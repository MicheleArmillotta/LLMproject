[
  {
    "function_name": "ToString",
    "container": "Status",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/util/status.cc",
    "lines": "36-73",
    "snippet": "std::string Status::ToString() const {\n  if (state_ == NULL) {\n    return \"OK\";\n  } else {\n    char tmp[30];\n    const char* type;\n    switch (code()) {\n      case kOk:\n        type = \"OK\";\n        break;\n      case kNotFound:\n        type = \"NotFound: \";\n        break;\n      case kCorruption:\n        type = \"Corruption: \";\n        break;\n      case kNotSupported:\n        type = \"Not implemented: \";\n        break;\n      case kInvalidArgument:\n        type = \"Invalid argument: \";\n        break;\n      case kIOError:\n        type = \"IO error: \";\n        break;\n      default:\n        snprintf(tmp, sizeof(tmp), \"Unknown code(%d): \",\n                 static_cast<int>(code()));\n        type = tmp;\n        break;\n    }\n    std::string result(type);\n    uint32_t length;\n    memcpy(&length, state_, sizeof(length));\n    result.append(state_ + 5, length);\n    return result;\n  }\n}",
    "includes": [
      "#include \"leveldb/status.h\"",
      "#include \"port/port.h\"",
      "#include <stdio.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "result.append",
          "args": [
            "state_ + 5",
            "length"
          ],
          "line": 70
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "&length",
            "state_",
            "sizeof(length)"
          ],
          "line": 69
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "tmp",
            "sizeof(tmp)",
            "\"Unknown code(%d): \"",
            "static_cast<int>(code())"
          ],
          "line": 62
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "static_cast<int>",
          "args": [
            "code()"
          ],
          "line": 63
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "code",
          "args": [],
          "line": 63
        },
        "resolved": true,
        "details": {
          "function_name": "code",
          "container": "Status",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/include/leveldb/status.h",
          "lines": "84-86",
          "snippet": "Code code() const {\n    return (state_ == NULL) ? kOk : static_cast<Code>(state_[4]);\n  }",
          "includes": [
            "#include \"leveldb/slice.h\"",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"leveldb/slice.h\"\n#include <string>\n\nStatus {\n  Code code() const {\n      return (state_ == NULL) ? kOk : static_cast<Code>(state_[4]);\n    }\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"leveldb/status.h\"\n#include \"port/port.h\"\n#include <stdio.h>\n\nStatus {\n  std::string Status::ToString() const {\n    if (state_ == NULL) {\n      return \"OK\";\n    } else {\n      char tmp[30];\n      const char* type;\n      switch (code()) {\n        case kOk:\n          type = \"OK\";\n          break;\n        case kNotFound:\n          type = \"NotFound: \";\n          break;\n        case kCorruption:\n          type = \"Corruption: \";\n          break;\n        case kNotSupported:\n          type = \"Not implemented: \";\n          break;\n        case kInvalidArgument:\n          type = \"Invalid argument: \";\n          break;\n        case kIOError:\n          type = \"IO error: \";\n          break;\n        default:\n          snprintf(tmp, sizeof(tmp), \"Unknown code(%d): \",\n                   static_cast<int>(code()));\n          type = tmp;\n          break;\n      }\n      std::string result(type);\n      uint32_t length;\n      memcpy(&length, state_, sizeof(length));\n      result.append(state_ + 5, length);\n      return result;\n    }\n  }\n}"
  },
  {
    "function_name": "Status",
    "container": "Status",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/util/status.cc",
    "lines": "19-34",
    "snippet": "Status::Status(Code code, const Slice& msg, const Slice& msg2) {\n  assert(code != kOk);\n  const uint32_t len1 = msg.size();\n  const uint32_t len2 = msg2.size();\n  const uint32_t size = len1 + (len2 ? (2 + len2) : 0);\n  char* result = new char[size + 5];\n  memcpy(result, &size, sizeof(size));\n  result[4] = static_cast<char>(code);\n  memcpy(result + 5, msg.data(), len1);\n  if (len2) {\n    result[5 + len1] = ':';\n    result[6 + len1] = ' ';\n    memcpy(result + 7 + len1, msg2.data(), len2);\n  }\n  state_ = result;\n}",
    "includes": [
      "#include \"leveldb/status.h\"",
      "#include \"port/port.h\"",
      "#include <stdio.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "result + 7 + len1",
            "msg2.data()",
            "len2"
          ],
          "line": 31
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "msg2.data",
          "args": [],
          "line": 31
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "result + 5",
            "msg.data()",
            "len1"
          ],
          "line": 27
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "msg.data",
          "args": [],
          "line": 27
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "static_cast<char>",
          "args": [
            "code"
          ],
          "line": 26
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "result",
            "&size",
            "sizeof(size)"
          ],
          "line": 25
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "msg2.size",
          "args": [],
          "line": 22
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "base_uint",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/uint256.h",
          "lines": "354-357",
          "snippet": "unsigned int size()\n    {\n        return sizeof(pn);\n    }",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <vector>\n#include <string>\n\nbase_uint {\n  unsigned int size()\n      {\n          return sizeof(pn);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "assert",
          "args": [
            "code != kOk"
          ],
          "line": 20
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"leveldb/status.h\"\n#include \"port/port.h\"\n#include <stdio.h>\n\nStatus {\n  Status::Status(Code code, const Slice& msg, const Slice& msg2) {\n    assert(code != kOk);\n    const uint32_t len1 = msg.size();\n    const uint32_t len2 = msg2.size();\n    const uint32_t size = len1 + (len2 ? (2 + len2) : 0);\n    char* result = new char[size + 5];\n    memcpy(result, &size, sizeof(size));\n    result[4] = static_cast<char>(code);\n    memcpy(result + 5, msg.data(), len1);\n    if (len2) {\n      result[5 + len1] = ':';\n      result[6 + len1] = ' ';\n      memcpy(result + 7 + len1, msg2.data(), len2);\n    }\n    state_ = result;\n  }\n}"
  }
]